{"pr_number": 1625, "pr_title": "Automatic rebuild of Fedora to OCFL Index on start", "pr_createdAt": "2020-02-03T18:38:47Z", "pr_url": "https://github.com/fcrepo/fcrepo/pull/1625", "timeline": [{"oid": "90451b2e4a4319601ff8a4ea593daa74783718f8", "url": "https://github.com/fcrepo/fcrepo/commit/90451b2e4a4319601ff8a4ea593daa74783718f8", "message": "Enables automatic rebuild on start when fedora to ocfl index file is not present.\nResolves: https://jira.lyrasis.org/browse/FCREPO-3195", "committedDate": "2020-02-03T18:30:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDI5NTI5NQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r374295295", "bodyText": "The stream should be closed when you're done with it.\ntry (final Stream ocflIds = ocflReposiotry.listObjectIds()) {\n}\nshould do the trick.", "author": "pwinckles", "createdAt": "2020-02-03T19:29:12Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/FedoraToOCFLObjectIndexUtilImpl.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.persistence.ocfl.impl;\n+\n+import edu.wisc.library.ocfl.api.OcflRepository;\n+import org.fcrepo.kernel.api.exception.RepositoryRuntimeException;\n+import org.fcrepo.persistence.api.exceptions.PersistentStorageException;\n+import org.fcrepo.persistence.ocfl.api.FedoraToOCFLObjectIndex;\n+import org.fcrepo.persistence.ocfl.api.FedoraToOCFLObjectIndexUtil;\n+import org.fcrepo.persistence.ocfl.api.OCFLObjectSessionFactory;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+import javax.inject.Inject;\n+\n+import java.util.stream.Stream;\n+\n+import static org.fcrepo.persistence.common.ResourceHeaderSerializationUtils.deserializeHeaders;\n+import static org.fcrepo.persistence.ocfl.impl.OCFLPersistentStorageUtils.getSidecarSubpath;\n+\n+/**\n+ * An implementation of {@link FedoraToOCFLObjectIndexUtil}\n+ *\n+ * @author dbernstein\n+ * @since 6.0.0\n+ */\n+@Component\n+public class FedoraToOCFLObjectIndexUtilImpl implements FedoraToOCFLObjectIndexUtil {\n+\n+    private static Logger LOGGER = LoggerFactory.getLogger(FedoraToOCFLObjectIndexUtilImpl.class);\n+\n+    @Inject\n+    private OCFLObjectSessionFactory objectSessionFactory;\n+\n+    @Inject\n+    private FedoraToOCFLObjectIndex fedoraToOCFLObjectIndex;\n+\n+    @Inject\n+    private OcflRepository ocflRepository;\n+\n+    /**\n+     * Default constructor\n+     */\n+    public FedoraToOCFLObjectIndexUtilImpl() {\n+    }\n+\n+\n+    @Override\n+    public void rebuild() {\n+\n+        final Stream<String> ocflIds = ocflRepository.listObjectIds();", "originalCommit": "90451b2e4a4319601ff8a4ea593daa74783718f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTg5MDg5OQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r375890899", "bodyText": "I will fix that.  Thanks.", "author": "dbernstein", "createdAt": "2020-02-06T15:10:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDI5NTI5NQ=="}], "type": "inlineReview"}, {"oid": "68f721f18faaef0dbf156e73b691f75c8af30380", "url": "https://github.com/fcrepo/fcrepo/commit/68f721f18faaef0dbf156e73b691f75c8af30380", "message": "Ensures ocfl id stream is closed properly.", "committedDate": "2020-02-06T15:36:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk0Njk1Nw==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r375946957", "bodyText": "An empty public constructor is implicit and can be removed here.", "author": "awoods", "createdAt": "2020-02-06T16:37:09Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/FedoraToOCFLObjectIndexUtilImpl.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.persistence.ocfl.impl;\n+\n+import edu.wisc.library.ocfl.api.OcflRepository;\n+import org.fcrepo.kernel.api.exception.RepositoryRuntimeException;\n+import org.fcrepo.persistence.api.exceptions.PersistentStorageException;\n+import org.fcrepo.persistence.ocfl.api.FedoraToOCFLObjectIndex;\n+import org.fcrepo.persistence.ocfl.api.FedoraToOCFLObjectIndexUtil;\n+import org.fcrepo.persistence.ocfl.api.OCFLObjectSessionFactory;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+import javax.inject.Inject;\n+\n+import static org.fcrepo.persistence.common.ResourceHeaderSerializationUtils.deserializeHeaders;\n+import static org.fcrepo.persistence.ocfl.impl.OCFLPersistentStorageUtils.getSidecarSubpath;\n+\n+/**\n+ * An implementation of {@link FedoraToOCFLObjectIndexUtil}\n+ *\n+ * @author dbernstein\n+ * @since 6.0.0\n+ */\n+@Component\n+public class FedoraToOCFLObjectIndexUtilImpl implements FedoraToOCFLObjectIndexUtil {\n+\n+    private static Logger LOGGER = LoggerFactory.getLogger(FedoraToOCFLObjectIndexUtilImpl.class);\n+\n+    @Inject\n+    private OCFLObjectSessionFactory objectSessionFactory;\n+\n+    @Inject\n+    private FedoraToOCFLObjectIndex fedoraToOCFLObjectIndex;\n+\n+    @Inject\n+    private OcflRepository ocflRepository;\n+\n+    /**\n+     * Default constructor\n+     */\n+    public FedoraToOCFLObjectIndexUtilImpl() {", "originalCommit": "68f721f18faaef0dbf156e73b691f75c8af30380", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ2OTE2NQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377469165", "bodyText": "fixed.", "author": "dbernstein", "createdAt": "2020-02-11T07:05:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk0Njk1Nw=="}], "type": "inlineReview"}, {"oid": "0416872f7988460cc67b18f2123847e4d3aeafe2", "url": "https://github.com/fcrepo/fcrepo/commit/0416872f7988460cc67b18f2123847e4d3aeafe2", "message": "Remove implied empty default constructor", "committedDate": "2020-02-10T19:09:56Z", "type": "commit"}, {"oid": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc", "url": "https://github.com/fcrepo/fcrepo/commit/7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc", "message": "Ensures that binaries and nested ocfl resources are included in the rebuild.", "committedDate": "2020-02-11T06:49:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg3MDk5NA==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377870994", "bodyText": "space", "author": "bbpennel", "createdAt": "2020-02-11T20:09:41Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/RepositoryInitializer.java", "diffHunk": "@@ -58,6 +71,12 @@ public void initialize() {\n         final PersistentStorageSession session = this.sessionManager.getSession(\"initializationSession\" +\n                                                                                  System.currentTimeMillis());\n \n+        if(!FEDORA_TO_OCFL_INDEX_FILE.exists()) {", "originalCommit": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg3NjIwNw==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377876207", "bodyText": "This isn't being used in this class", "author": "bbpennel", "createdAt": "2020-02-11T20:21:15Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/RepositoryInitializer.java", "diffHunk": "@@ -49,6 +53,15 @@\n     @Inject\n     private RdfSourceOperationFactory operationFactory;\n \n+    @Inject\n+    private FedoraToOCFLObjectIndex fedoraToOCFLObjectIndex;", "originalCommit": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg3NjI1NA==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377876254", "bodyText": "This isn't being used in this class", "author": "bbpennel", "createdAt": "2020-02-11T20:21:20Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/RepositoryInitializer.java", "diffHunk": "@@ -49,6 +53,15 @@\n     @Inject\n     private RdfSourceOperationFactory operationFactory;\n \n+    @Inject\n+    private FedoraToOCFLObjectIndex fedoraToOCFLObjectIndex;\n+\n+    @Inject\n+    private FedoraToOCFLObjectIndexUtil fedoraToOCFLObjectIndexUtil;\n+\n+    @Inject\n+    private OCFLObjectSessionFactory objectSessionFactory;", "originalCommit": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg4NjEwNQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377886105", "bodyText": "You're welcome to disagree, but even though java is pretty lose with conventions, in my experience Util usually denotes a class containing static utility methods. That seems to be the case in the fedora codebase too (See FedoraIdUtils, OCFLPersistentStorageUtils, StreamUtils, ResourceHeaderSerializationUtils, etc).\nBased on your javadoc here, I wonder if FedoraToOCFLObjectIndexManager might be better", "author": "bbpennel", "createdAt": "2020-02-11T20:41:54Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/api/FedoraToOCFLObjectIndexUtil.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.persistence.ocfl.api;\n+\n+\n+/**\n+ * Utility for managing the FedoraToOCFLObjectIndex.\n+ * @author dbernstein\n+ * @since 6.0.0\n+ */\n+public interface FedoraToOCFLObjectIndexUtil {", "originalCommit": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ0NzMwNQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378447305", "bodyText": "That's valid.", "author": "dbernstein", "createdAt": "2020-02-12T18:55:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg4NjEwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ0ODkxMw==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378448913", "bodyText": "I  was thinking that  it was a utility in the sense that it performs useful operations on the FedoraToOCFLObjectIndex.  I don't think it is really managing the index.    I'm incline to leave it as is as I expect that we may be renaming this class in the near future when we bring in the rebuilding of the containment relationships.", "author": "dbernstein", "createdAt": "2020-02-12T18:58:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg4NjEwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg4NjM2Mg==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377886362", "bodyText": "fix indent", "author": "bbpennel", "createdAt": "2020-02-11T20:42:24Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/DefaultOCFLObjectSessionFactory.java", "diffHunk": "@@ -56,31 +54,20 @@\n      * are not set, default directories will be created in java.io.tmpdir.\n      */\n     public DefaultOCFLObjectSessionFactory() {\n-        this(STAGING_DIR, OCFL_STORAGE_ROOT_DIR, OCFL_WORK_DIR);\n+        this(STAGING_DIR);\n     }\n \n     /**\n      * Constructor\n      *\n      * @param ocflStagingDir     The OCFL staging directory\n-     * @param ocflStorageRootDir The OCFL storage root directory\n-     * @param ocflWorkDir        The OCFL work directory\n      */\n-    public DefaultOCFLObjectSessionFactory(final File ocflStagingDir, final File ocflStorageRootDir,\n-                                           final File ocflWorkDir) {\n-        LOGGER.info(\"Fedora OCFL persistence directories:\\n- {}\\n- {}\\n- {}\",\n-                ocflStagingDir, ocflStorageRootDir, ocflWorkDir);\n+    public DefaultOCFLObjectSessionFactory(final File ocflStagingDir) {\n+        LOGGER.info(\"Fedora OCFL persistence staging directory:\\n- {}\",\n+                ocflStagingDir);\n \n         ocflStagingDir.mkdirs();\n-        ocflStorageRootDir.mkdirs();\n-        ocflWorkDir.mkdirs();\n-\n-        this.ocflStagingDir = ocflStagingDir;\n-        this.ocflRepository = new OcflRepositoryBuilder()\n-                .layoutConfig(DefaultLayoutConfig.nTupleHashConfig())\n-                .buildMutable(FileSystemOcflStorage.builder().build(\n-                        ocflStorageRootDir.toPath()), ocflWorkDir.toPath());\n-\n+       this.ocflStagingDir = ocflStagingDir;", "originalCommit": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg4NzA4OQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377887089", "bodyText": "This isn't being used", "author": "bbpennel", "createdAt": "2020-02-11T20:43:58Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/FedoraToOCFLObjectIndexImpl.java", "diffHunk": "@@ -47,6 +48,9 @@\n \n     private Map<String, FedoraOCFLMapping> fedoraOCFLMappingMap = Collections.synchronizedMap(new HashMap<>());\n \n+    @Inject\n+    private OCFLObjectSessionFactory objectSessionFactory;", "originalCommit": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg5MjU1MQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377892551", "bodyText": "Its probably premature to worry about efficiency here, but might as well mention that the sidecar files are isolated in a single subdirectory the OCFL object. So it seems like the ocfl client would have to walk and return at least double the number of files it would if we were able to ask the client for a subpath of the object.", "author": "bbpennel", "createdAt": "2020-02-11T20:55:02Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/FedoraToOCFLObjectIndexUtilImpl.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.persistence.ocfl.impl;\n+\n+import edu.wisc.library.ocfl.api.OcflRepository;\n+import org.fcrepo.kernel.api.exception.RepositoryRuntimeException;\n+import org.fcrepo.persistence.api.exceptions.PersistentStorageException;\n+import org.fcrepo.persistence.ocfl.api.FedoraToOCFLObjectIndex;\n+import org.fcrepo.persistence.ocfl.api.FedoraToOCFLObjectIndexUtil;\n+import org.fcrepo.persistence.ocfl.api.OCFLObjectSessionFactory;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+import javax.inject.Inject;\n+\n+import static java.lang.String.format;\n+import static org.fcrepo.persistence.common.ResourceHeaderSerializationUtils.deserializeHeaders;\n+import static org.fcrepo.persistence.ocfl.impl.OCFLPersistentStorageUtils.getSidecarSubpath;\n+import static org.fcrepo.persistence.ocfl.impl.OCFLPersistentStorageUtils.isSidecarSubpath;\n+\n+/**\n+ * An implementation of {@link FedoraToOCFLObjectIndexUtil}\n+ *\n+ * @author dbernstein\n+ * @since 6.0.0\n+ */\n+@Component\n+public class FedoraToOCFLObjectIndexUtilImpl implements FedoraToOCFLObjectIndexUtil {\n+\n+    private static Logger LOGGER = LoggerFactory.getLogger(FedoraToOCFLObjectIndexUtilImpl.class);\n+\n+    @Inject\n+    private OCFLObjectSessionFactory objectSessionFactory;\n+\n+    @Inject\n+    private FedoraToOCFLObjectIndex fedoraToOCFLObjectIndex;\n+\n+    @Inject\n+    private OcflRepository ocflRepository;\n+\n+    @Override\n+    public void rebuild() {\n+\n+        LOGGER.info(\"Initiating index rebuild.\");\n+        fedoraToOCFLObjectIndex.reset();\n+        LOGGER.debug(\"Reading object ids...\");\n+        try (final var ocflIds = ocflRepository.listObjectIds()) {\n+            ocflIds.forEach(ocflId -> {\n+                LOGGER.debug(\"Reading {}\", ocflId);\n+                final var objSession = objectSessionFactory.create(ocflId, null);\n+\n+                //list all the subpaths\n+                try (final var subpaths = objSession.listHeadSubpaths()) {\n+\n+                    //but first resolve the root identifier\n+                    final var sidecarSubpath = getSidecarSubpath(ocflId);\n+                    final var rootHeaders = deserializeHeaders(objSession.read(sidecarSubpath));\n+                    final var fedoraRootIdentifier = rootHeaders.getId();\n+\n+                    subpaths.forEach(subpath -> {\n+                        if (isSidecarSubpath(subpath)) {", "originalCommit": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0ODczNA==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377948734", "bodyText": "Looking at the implementation of listHeadSubpaths(), it's calling OcflRepository.describeObject(), which does not do anything other than return a view of the object's inventory file. The filesystem is not touch, other than to load the inventory if it isn't cached. The only slight optimization that you could do here is to call OcflRepository.describeVersion() instead of describeObject().", "author": "pwinckles", "createdAt": "2020-02-11T22:54:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg5MjU1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI0MzExNg==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378243116", "bodyText": "Ah okay, from some discussion on slack the other day it thought there was a file walk involved.", "author": "bbpennel", "createdAt": "2020-02-12T13:17:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg5MjU1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI0NDg3Mg==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378244872", "bodyText": "Ah, the file walk is only to identify all of the object ids in the repository.", "author": "pwinckles", "createdAt": "2020-02-12T13:20:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg5MjU1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU2MzI2Ng==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378563266", "bodyText": "I can resolve this comment now, just hadn't done so yet since I wasn't sure if we were wanting to do something with OcflRepository.describeVersion() instead of describeObject()", "author": "bbpennel", "createdAt": "2020-02-12T23:01:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg5MjU1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkwMDIzOA==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377900238", "bodyText": "not used", "author": "bbpennel", "createdAt": "2020-02-11T21:10:35Z", "path": "fcrepo-persistence-ocfl/src/test/java/org/fcrepo/persistence/ocfl/impl/FedoraToOCFLObjectIndexUtilImplTest.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.persistence.ocfl.impl;\n+\n+import org.fcrepo.kernel.api.operations.CreateResourceOperation;\n+import org.fcrepo.kernel.api.operations.NonRdfSourceOperation;\n+import org.fcrepo.kernel.api.operations.RdfSourceOperation;\n+import org.fcrepo.persistence.ocfl.api.FedoraOCFLMappingNotFoundException;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+\n+import java.io.ByteArrayInputStream;\n+\n+import static org.fcrepo.kernel.api.operations.ResourceOperationType.CREATE;\n+import static org.fcrepo.persistence.ocfl.impl.OCFLPersistentStorageUtils.createRepository;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.fail;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+import static org.mockito.Mockito.withSettings;\n+import static org.springframework.test.util.ReflectionTestUtils.setField;\n+\n+/**\n+ * @author dbernstein\n+ * @since 6.0.0\n+ */\n+public class FedoraToOCFLObjectIndexUtilImplTest {\n+\n+    private static final String RESOURCE_ID_1 = \"info:fedora/resource\";", "originalCommit": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkwMTc5OA==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377901798", "bodyText": "not currently being used", "author": "bbpennel", "createdAt": "2020-02-11T21:13:52Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/OCFLPersistenceConfig.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.persistence.ocfl.impl;\n+\n+import edu.wisc.library.ocfl.api.MutableOcflRepository;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+\n+import static org.fcrepo.persistence.ocfl.impl.OCFLConstants.OCFL_STORAGE_ROOT_DIR;\n+import static org.fcrepo.persistence.ocfl.impl.OCFLConstants.OCFL_WORK_DIR;\n+import static org.fcrepo.persistence.ocfl.impl.OCFLPersistentStorageUtils.createRepository;\n+\n+/**\n+ * A Configuration for OCFL dependencies\n+ *\n+ * @author dbernstein\n+ * @since 6.0.0\n+ */\n+\n+@Configuration\n+public class OCFLPersistenceConfig {\n+\n+    private static final Logger log = LoggerFactory.getLogger(OCFLPersistenceConfig.class);", "originalCommit": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkwMzE5NA==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377903194", "bodyText": "I don't think this is doing anything and can be removed", "author": "bbpennel", "createdAt": "2020-02-11T21:16:52Z", "path": "fcrepo-persistence-ocfl/src/test/java/org/fcrepo/persistence/ocfl/impl/FedoraToOCFLObjectIndexUtilImplTest.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.persistence.ocfl.impl;\n+\n+import org.fcrepo.kernel.api.operations.CreateResourceOperation;\n+import org.fcrepo.kernel.api.operations.NonRdfSourceOperation;\n+import org.fcrepo.kernel.api.operations.RdfSourceOperation;\n+import org.fcrepo.persistence.ocfl.api.FedoraOCFLMappingNotFoundException;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+\n+import java.io.ByteArrayInputStream;\n+\n+import static org.fcrepo.kernel.api.operations.ResourceOperationType.CREATE;\n+import static org.fcrepo.persistence.ocfl.impl.OCFLPersistentStorageUtils.createRepository;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.fail;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+import static org.mockito.Mockito.withSettings;\n+import static org.springframework.test.util.ReflectionTestUtils.setField;\n+\n+/**\n+ * @author dbernstein\n+ * @since 6.0.0\n+ */\n+public class FedoraToOCFLObjectIndexUtilImplTest {\n+\n+    private static final String RESOURCE_ID_1 = \"info:fedora/resource\";\n+\n+    @Rule\n+    public TemporaryFolder tempFolder = new TemporaryFolder();\n+\n+    @Test\n+    public void testRebuild() throws Exception {\n+\n+        final var repoDir = tempFolder.newFolder(\"ocfl-repo\");\n+        final var workDir = tempFolder.newFolder(\"ocfl-work\");\n+        final var staging = tempFolder.newFolder(\"ocfl-staging\");\n+        final var repository = createRepository(repoDir, workDir);\n+\n+        final var index = new FedoraToOCFLObjectIndexImpl();\n+\n+        final var ocflObjectSessionFactory = new DefaultOCFLObjectSessionFactory(staging);\n+        setField(ocflObjectSessionFactory, \"ocflRepository\", repository);\n+\n+        final var sessionManager = new OCFLPersistentSessionManager();\n+        setField(sessionManager, \"fedoraOcflIndex\", index);\n+        setField(sessionManager, \"objectSessionFactory\", ocflObjectSessionFactory);\n+\n+        final var util = new FedoraToOCFLObjectIndexUtilImpl();\n+        setField(util, \"ocflRepository\", repository);\n+        setField(util, \"fedoraToOCFLObjectIndex\", index);\n+        setField(util, \"objectSessionFactory\", ocflObjectSessionFactory);\n+\n+        final var session1Id = \"session1\";\n+        final var resource1 = \"info:fedora/resource1\";\n+        final var resource2 =  resource1 + \"/resource2\";\n+\n+        final var session = sessionManager.getSession(session1Id);\n+\n+        final var operation = mock(RdfSourceOperation.class, withSettings().extraInterfaces(\n+                CreateResourceOperation.class));\n+        when(operation.getResourceId()).thenReturn(resource1);\n+        when(operation.getType()).thenReturn(CREATE);\n+        when(((CreateResourceOperation)operation).isArchivalGroup()).thenReturn(true);\n+        session.persist(operation);\n+\n+        final var operation2 = mock(NonRdfSourceOperation.class, withSettings().extraInterfaces(\n+                CreateResourceOperation.class));\n+        when(operation2.getResourceId()).thenReturn(resource2);\n+        when(operation2.getType()).thenReturn(CREATE);\n+        final var bytes = \"test\".getBytes();\n+        final var stream = new ByteArrayInputStream(bytes);\n+        when(operation2.getContentSize()).thenReturn((long)bytes.length);\n+        when(operation2.getContentStream()).thenReturn(stream);\n+        when(operation2.getMimeType()).thenReturn(\"text/plain\");\n+        when(operation2.getFilename()).thenReturn(\"test\");\n+        when(((CreateResourceOperation)operation2).getParentId()).thenReturn(resource1);\n+        session.persist(operation2);\n+        session.commit();\n+        assertNotNull(index.getMapping(resource1));\n+        index.reset();\n+\n+        try {\n+            index.getMapping(resource1);\n+            fail(resource1 + \" should not exist in index\");\n+        } catch (final FedoraOCFLMappingNotFoundException e) {\n+            //do nothing - expected\n+        }\n+\n+        ocflObjectSessionFactory.create(resource1, session1Id);", "originalCommit": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAxNzU1Mw==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378017553", "bodyText": "Remove newline.", "author": "awoods", "createdAt": "2020-02-12T03:00:11Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/api/OCFLObjectSession.java", "diffHunk": "@@ -123,5 +125,17 @@\n      * The instant at which the session was created.\n      * @return\n      */\n+", "originalCommit": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAxNzYwMw==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378017603", "bodyText": "Remove newline", "author": "awoods", "createdAt": "2020-02-12T03:00:21Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/api/OCFLObjectSession.java", "diffHunk": "@@ -123,5 +125,17 @@\n      * The instant at which the session was created.\n      * @return\n      */\n+\n     Instant getCreated();\n-}\n\\ No newline at end of file\n+\n+    /**\n+     * Lists the subpaths associated with the HEAD (ie the latest committed state)\n+     *\n+     * @return the subpaths as a stream\n+     * @throws PersistentStorageException If subpaths cannot be listed due to the underlying session being closed\n+     *                                    or for some other reason.\n+     */\n+", "originalCommit": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAxNzg4Ng==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378017886", "bodyText": "Changes to this file can be reverted.", "author": "awoods", "createdAt": "2020-02-12T03:01:37Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/api/OCFLObjectSessionFactory.java", "diffHunk": "@@ -31,4 +31,6 @@\n      * @return The newly created session.\n      */\n     OCFLObjectSession create(final String ocflId, final String persistentStorageSessionId);\n+", "originalCommit": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNjI4Ng==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378036286", "bodyText": "Please add log message indicating location of storageRootDir and workDir.\n..like: https://github.com/fcrepo4/fcrepo4/pull/1625/files#diff-f2c25ea789161a21300d5fa03b8a3965L71-L72", "author": "awoods", "createdAt": "2020-02-12T04:32:37Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/OCFLPersistentStorageUtils.java", "diffHunk": "@@ -338,4 +352,21 @@ public static String mintOCFLObjectId(final String fedoraIdentifier) {\n \n         return bareFedoraIdentifier;\n     }\n+\n+    /**\n+     * Create a new ocfl repository\n+     * @param ocflStorageRootDir The ocfl storage root directory\n+     * @param ocflWorkDir The ocfl work directory\n+     * @return the repository\n+     */\n+    public static MutableOcflRepository createRepository(final File ocflStorageRootDir, final File ocflWorkDir) {\n+        ocflStorageRootDir.mkdirs();\n+        ocflWorkDir.mkdirs();", "originalCommit": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNjk3Mw==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378036973", "bodyText": "Unit tests should only write test artifacts to the Maven module's target directory.", "author": "awoods", "createdAt": "2020-02-12T04:36:24Z", "path": "fcrepo-persistence-ocfl/src/test/java/org/fcrepo/persistence/ocfl/impl/FedoraToOCFLObjectIndexUtilImplTest.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.persistence.ocfl.impl;\n+\n+import org.fcrepo.kernel.api.operations.CreateResourceOperation;\n+import org.fcrepo.kernel.api.operations.NonRdfSourceOperation;\n+import org.fcrepo.kernel.api.operations.RdfSourceOperation;\n+import org.fcrepo.persistence.ocfl.api.FedoraOCFLMappingNotFoundException;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+\n+import java.io.ByteArrayInputStream;\n+\n+import static org.fcrepo.kernel.api.operations.ResourceOperationType.CREATE;\n+import static org.fcrepo.persistence.ocfl.impl.OCFLPersistentStorageUtils.createRepository;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.fail;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+import static org.mockito.Mockito.withSettings;\n+import static org.springframework.test.util.ReflectionTestUtils.setField;\n+\n+/**\n+ * @author dbernstein\n+ * @since 6.0.0\n+ */\n+public class FedoraToOCFLObjectIndexUtilImplTest {\n+\n+    private static final String RESOURCE_ID_1 = \"info:fedora/resource\";\n+\n+    @Rule\n+    public TemporaryFolder tempFolder = new TemporaryFolder();", "originalCommit": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI0MjM2MA==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378242360", "bodyText": "I can see some value in this, but TemporaryFolder is pretty standard junit and does guarantee a cleaner state between runs without having to perform a maven clean", "author": "bbpennel", "createdAt": "2020-02-12T13:16:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNjk3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ5NTQ5Mw==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378495493", "bodyText": "The question is, do we align more closely with Maven or with Junit?\nMaybe because I do all of my builds on the commandline, I align with Maven, and am adverse to the build leaving files/directories on my local machine after mvn clean.", "author": "awoods", "createdAt": "2020-02-12T20:30:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNjk3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ5ODQ5OQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378498499", "bodyText": "TemporaryFolder doesn't leave files on disk. But, you can have it both ways.\n@Rule\npublic TemporaryFolder tempFolder = new TemporaryFolder(new File(\"target/junit-temp\"));\n(Not sure if it will automatically handle creating the parent directory if it doesn't exist.)", "author": "pwinckles", "createdAt": "2020-02-12T20:36:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNjk3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUwMjQ1NA==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378502454", "bodyText": "On the flip side, I do like to have test files left on-disk (target) in case I want to inspect them after a build... but want my system to be clean after running mvn clean.", "author": "awoods", "createdAt": "2020-02-12T20:45:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNjk3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUwNDE0Nw==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378504147", "bodyText": "Fair enough! That is sometimes useful.", "author": "pwinckles", "createdAt": "2020-02-12T20:48:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNjk3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU2MjkwMw==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378562903", "bodyText": "I guess I view maven as the build tool and junit as the testing framework, with the hope that if something works in junit (particularly unit tests) it should work in maven or other test environments. I'm biased though since I usually run individual tests via an IDE, and mainly rely on maven when running the full suite. Usually in order to see what state was produced I end up setting break points, but its just a different workflow.\nI don't think it makes too much difference one way or the other for this particular case, so I'm okay with whatever we decide on here. It would be good to know if the project standard is to use target though. There are only a few places using TemporaryFolders at the moment, so maybe that is the case.", "author": "bbpennel", "createdAt": "2020-02-12T23:00:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNjk3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODYxNzIxMA==", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378617210", "bodyText": "Historically, Fedora has left a clean system after mvn clean.\nAgreed, if we want to change, we can... but it should be a decision.", "author": "awoods", "createdAt": "2020-02-13T02:12:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNjk3Mw=="}], "type": "inlineReview"}, {"oid": "d5021bbebc6afdce5b6f77109168fd346a97f771", "url": "https://github.com/fcrepo/fcrepo/commit/d5021bbebc6afdce5b6f77109168fd346a97f771", "message": "Fixes formatting issues and ensures unit test directory\nis both nested in target/ and is not destroyed after the test completes.", "committedDate": "2020-02-13T05:30:49Z", "type": "commit"}, {"oid": "d5021bbebc6afdce5b6f77109168fd346a97f771", "url": "https://github.com/fcrepo/fcrepo/commit/d5021bbebc6afdce5b6f77109168fd346a97f771", "message": "Fixes formatting issues and ensures unit test directory\nis both nested in target/ and is not destroyed after the test completes.", "committedDate": "2020-02-13T05:30:49Z", "type": "forcePushed"}]}