{"pr_number": 1721, "pr_title": "Ensures that Fedora docker image is rebuilt and published to docker h\u2026", "pr_createdAt": "2020-07-13T21:33:37Z", "pr_url": "https://github.com/fcrepo/fcrepo/pull/1721", "timeline": [{"oid": "aa1163d80e2d85f7ec67d7c8c5b6ed77eef9b38d", "url": "https://github.com/fcrepo/fcrepo/commit/aa1163d80e2d85f7ec67d7c8c5b6ed77eef9b38d", "message": "Ensures that Fedora docker image is rebuilt and published to docker hub on\nupdates to main.\nResolves: https://jira.lyrasis.org/browse/FCREPO-3319", "committedDate": "2020-07-13T21:29:09Z", "type": "commit"}, {"oid": "b5b31a0dd334cc35ca1105b8974be523c62320e7", "url": "https://github.com/fcrepo/fcrepo/commit/b5b31a0dd334cc35ca1105b8974be523c62320e7", "message": "Changes travis branch from master to main.", "committedDate": "2020-07-13T21:35:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk2MzQxNw==", "url": "https://github.com/fcrepo/fcrepo/pull/1721#discussion_r453963417", "bodyText": "Should this be uncommented?", "author": "awoods", "createdAt": "2020-07-13T22:02:25Z", "path": ".travis/deploy.sh", "diffHunk": "@@ -2,6 +2,18 @@ if [ ! -z \"$TRAVIS_TAG\" ]\n then\n     echo \"on a tag -> $TRAVIS_TAG and therefore we will do nothing. Tagged releases are deployed to sonatype manually.\"\n else\n-    echo \"not on a tag -> deploying to sonatype snapshot repo...\"\n-    ./mvnw clean deploy --settings .travis/settings.xml -DskipTests=true -B -U\n+    echo \"not on a tag -> deploying to dockerhub and sonatype...\"\n+    FCREPO_VERSION=$(./mvnw org.apache.maven.plugins:maven-help-plugin:3.1.0:evaluate -Dexpression=project.version -q -DforceStdout)\n+    \n+    echo \"clone fcrepo4-labs/fcrepo-docker repository\"\n+    git clone https://github.com/fcrepo4-labs/fcrepo-docker.git\n+    echo \"building docker container\"\n+    cd fcrepo-docker\n+    ./build.sh ../fcrepo-webapp/target/fcrepo-webapp-${FCREPO_VERSION}.war\n+    echo \"push image to dockerhub\"\n+    ./push.sh latest ${FCREPO_VERSION}\n+    cd ..\n+\n+    echo \"deploying to sonatype snapshot repo...\"\n+#    ./mvnw clean deploy --settings .travis/settings.xml -DskipTests=true -B -U", "originalCommit": "b5b31a0dd334cc35ca1105b8974be523c62320e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU0NDg5Ng==", "url": "https://github.com/fcrepo/fcrepo/pull/1721#discussion_r454544896", "bodyText": "oops - yes - good catch.", "author": "dbernstein", "createdAt": "2020-07-14T18:04:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk2MzQxNw=="}], "type": "inlineReview"}, {"oid": "25ae09e188eef52f5f93d79297600d817c2b2ccb", "url": "https://github.com/fcrepo/fcrepo/commit/25ae09e188eef52f5f93d79297600d817c2b2ccb", "message": "uncomments mvnw command", "committedDate": "2020-07-14T18:07:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTYxMjc3MQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1721#discussion_r455612771", "bodyText": "We might want to build the container within the default travis pipeline instead of in the deploy part and only include the push command here.", "author": "tomcbe", "createdAt": "2020-07-16T08:25:07Z", "path": ".travis/deploy.sh", "diffHunk": "@@ -2,6 +2,18 @@ if [ ! -z \"$TRAVIS_TAG\" ]\n then\n     echo \"on a tag -> $TRAVIS_TAG and therefore we will do nothing. Tagged releases are deployed to sonatype manually.\"\n else\n-    echo \"not on a tag -> deploying to sonatype snapshot repo...\"\n+    echo \"not on a tag -> deploying to dockerhub and sonatype...\"\n+    FCREPO_VERSION=$(./mvnw org.apache.maven.plugins:maven-help-plugin:3.1.0:evaluate -Dexpression=project.version -q -DforceStdout)\n+    \n+    echo \"clone fcrepo4-labs/fcrepo-docker repository\"\n+    git clone https://github.com/fcrepo4-labs/fcrepo-docker.git\n+    echo \"building docker container\"\n+    cd fcrepo-docker\n+    ./build.sh ../fcrepo-webapp/target/fcrepo-webapp-${FCREPO_VERSION}.war", "originalCommit": "25ae09e188eef52f5f93d79297600d817c2b2ccb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA0MjY4OQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1721#discussion_r456042689", "bodyText": "Per our conversation in the meeting this morning,  we can defer until this change becomes necessary.", "author": "dbernstein", "createdAt": "2020-07-16T19:58:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTYxMjc3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTYxMzUyNg==", "url": "https://github.com/fcrepo/fcrepo/pull/1721#discussion_r455613526", "bodyText": "Change message to: \"on a tag -> $TRAVIS_TAG and therefore we will do nothing. Tagged releases are deployed to sonatype and Docker Hub manually.\"", "author": "tomcbe", "createdAt": "2020-07-16T08:26:19Z", "path": ".travis/deploy.sh", "diffHunk": "@@ -2,6 +2,18 @@ if [ ! -z \"$TRAVIS_TAG\" ]\n then\n     echo \"on a tag -> $TRAVIS_TAG and therefore we will do nothing. Tagged releases are deployed to sonatype manually.\"", "originalCommit": "25ae09e188eef52f5f93d79297600d817c2b2ccb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "475e5f06c3c016483f20dd8f52666486428fddaf", "url": "https://github.com/fcrepo/fcrepo/commit/475e5f06c3c016483f20dd8f52666486428fddaf", "message": "Impoves log message in deploy.sh", "committedDate": "2020-07-16T19:55:30Z", "type": "commit"}]}