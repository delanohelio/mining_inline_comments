{"pr_number": 1643, "pr_title": "resource version creation", "pr_createdAt": "2020-03-06T20:57:16Z", "pr_url": "https://github.com/fcrepo/fcrepo/pull/1643", "timeline": [{"oid": "38c65e634181f0c6dde8923990ce7898cbb83281", "url": "https://github.com/fcrepo/fcrepo/commit/38c65e634181f0c6dde8923990ce7898cbb83281", "message": "added functionality for creating resource versions", "committedDate": "2020-03-06T20:46:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM4MDA5NA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389380094", "bodyText": "It is probably ok to remove this commented-out line... since creating a version at a given time is no longer supported.", "author": "awoods", "createdAt": "2020-03-08T15:33:04Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -177,97 +177,99 @@ public void testDeleteTimeMapNotAllowed() throws Exception {\n                      getStatus(new HttpDelete(serverAddress + id + \"/\" + FCR_VERSIONS)));\n     }\n \n-    @Ignore //TODO Fix this test\n     @Test\n     public void testGetTimeMapResponse() throws Exception {\n         createVersionedContainer(id);\n \n-        createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);\n-        verifyTimemapResponse(subjectUri, id, MEMENTO_DATETIME);\n+        createContainerMementoWithBody(subjectUri);\n+//        createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNTgxOQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389635819", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:43:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM4MDA5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDAwMA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420000", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:52:01Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -402,130 +404,37 @@ public void testCreateVersionWithSlugHeader() throws Exception {\n         createVersionedContainer(id);\n \n         // Bad request with Slug header to create memento\n-        final String mementoDateTime = \"Tue, 3 Jun 2008 11:05:30 GMT\";\n-        final String body = createContainerMementoBodyContent(subjectUri, N3);\n         final HttpPost post = postObjMethod(id + \"/\" + FCR_VERSIONS);\n-\n         post.addHeader(\"Slug\", \"version_label\");\n-        post.addHeader(MEMENTO_DATETIME_HEADER, mementoDateTime);\n-        post.addHeader(CONTENT_TYPE, N3);\n-        post.setEntity(new StringEntity(body));\n \n         assertEquals(\"Created memento with Slug!\",\n                 BAD_REQUEST.getStatusCode(), getStatus(post));\n     }\n \n-    @Ignore //TODO Fix this test\n     @Test\n-    public void testCreateVersionWithMementoDatetimeFormat() throws Exception {\n+    public void testCreateVersionWithMementoDateTimeHeader() throws Exception {\n         createVersionedContainer(id);\n \n-        // Create memento with RFC-1123 date-time format\n+        // Bad request with Memento-Datetime header to create memento\n         final String mementoDateTime = \"Tue, 3 Jun 2008 11:05:30 GMT\";\n         final String body = createContainerMementoBodyContent(subjectUri, N3);\n-\n         final HttpPost post = postObjMethod(id + \"/\" + FCR_VERSIONS);\n \n         post.addHeader(MEMENTO_DATETIME_HEADER, mementoDateTime);\n         post.addHeader(CONTENT_TYPE, N3);\n         post.setEntity(new StringEntity(body));\n \n-        assertEquals(\"Unable to create memento with RFC-1123 date-time format!\",\n-                CREATED.getStatusCode(), getStatus(post));\n-\n-        // Create memento with RFC-1123 date-time format in wrong value\n-        final String dateTime1 = \"Tue, 13 Jun 2008 11:05:35 ANYTIMEZONE\";\n-        final HttpPost post1 = postObjMethod(id + \"/\" + FCR_VERSIONS);\n-\n-        post1.addHeader(CONTENT_TYPE, N3);\n-        post1.setEntity(new StringEntity(body));\n-        post1.addHeader(MEMENTO_DATETIME_HEADER, dateTime1);\n-\n-        assertEquals(BAD_REQUEST.getStatusCode(), getStatus(post1));\n-\n-        // Create memento in date-time format other than RFC-1123\n-        final String dateTime2 = \"2000-01-01T01:01:01.11Z\";\n-        final HttpPost post2 = postObjMethod(id + \"/\" + FCR_VERSIONS);\n-\n-        post2.addHeader(CONTENT_TYPE, N3);\n-        post2.setEntity(new StringEntity(body));\n-        post2.addHeader(MEMENTO_DATETIME_HEADER, dateTime2);\n-\n-        assertEquals(BAD_REQUEST.getStatusCode(), getStatus(post2));\n-    }\n-\n-    @Ignore //TODO Fix this test\n-    @Test\n-    public void testCreateVersionWithDatetime() throws Exception {\n-        createVersionedContainer(id);\n-\n-        final HttpPost createVersionMethod = postObjMethod(id + \"/\" + FCR_VERSIONS);\n-        createVersionMethod.addHeader(CONTENT_TYPE, N3);\n-        createVersionMethod.addHeader(MEMENTO_DATETIME_HEADER, MEMENTO_DATETIME);\n-\n-        // Attempt to create memento with no body\n-        try (final CloseableHttpResponse response = execute(createVersionMethod)) {\n-            assertEquals(\"Didn't get a BAD_REQUEST response!\", BAD_REQUEST.getStatusCode(), getStatus(response));\n-\n-            // Request must fail with constrained exception due to empty body\n-            assertConstrainedByPresent(response);\n-        }\n-    }\n-\n-    @Ignore //TODO Fix this test\n-    @Test\n-    public void testCreateContainerWithoutServerManagedTriples() throws Exception {\n-        createVersionedContainer(id);\n-\n-        final HttpPost createMethod = postObjMethod(id + \"/\" + FCR_VERSIONS);\n-        createMethod.addHeader(CONTENT_TYPE, N3);\n-        createMethod.setEntity(new StringEntity(\"<\" + subjectUri + \"> <info:test#label> \\\"part\\\"\"));\n-        createMethod.addHeader(MEMENTO_DATETIME_HEADER, MEMENTO_DATETIME);\n-\n-        // Attempt to create memento with partial record\n-        try (final CloseableHttpResponse response = execute(createMethod)) {\n-            assertEquals(\"Didn't get a BAD_REQUEST response!\", BAD_REQUEST.getStatusCode(), getStatus(response));\n-\n-            // Request must fail with constrained exception due to empty body\n-            assertConstrainedByPresent(response);\n-        }\n-    }\n-\n-    /**\n-     * POST to create LDPCv without memento-datetime must ignore body\n-     *\n-     * @throws Exception in case of error with test\n-     */\n-    @Ignore //TODO Fix this test\n-    @Test\n-    public void testCreateVersionWithBody() throws Exception {\n-        createVersionedContainer(id);\n-\n-        final String mementoUri = createContainerMementoWithBody(subjectUri, null);\n-        assertMementoUri(mementoUri, subjectUri);\n-\n-        final HttpGet httpGet = new HttpGet(mementoUri);\n-        try (final CloseableDataset dataset = getDataset(httpGet)) {\n-            final DatasetGraph results = dataset.asDatasetGraph();\n-\n-            final Node mementoSubject = createURI(subjectUri);\n-\n-            assertTrue(\"Memento created without datetime must retain original state\",\n-                    results.contains(ANY, mementoSubject, TEST_PROPERTY_NODE, createLiteral(\"foo\")));\n-            assertFalse(\"Memento created without datetime must ignore updates\",\n-                    results.contains(ANY, mementoSubject, TEST_PROPERTY_NODE, createLiteral(\"bar\")));\n-\n-            // memento should be the same as original, in this case\n-            assertMementoEqualsOriginal(mementoUri);\n-        }\n+        assertEquals(\"Created memento with Memento-Datetime!\",\n+                BAD_REQUEST.getStatusCode(), getStatus(post));\n     }\n \n-    @Ignore //TODO Fix this test\n+    @Ignore(\"get memento not implemented\")\n     @Test\n     public void testCreateVersionWithDatetimeAndBody() throws Exception {\n         createVersionedContainer(id);\n \n-        final String mementoUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);\n+        final String mementoUri = createContainerMementoWithBody(subjectUri);\n+//        final String mementoUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyOTcwOA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389429708", "bodyText": "I accidently hit the button that resolved the previous your previous comment when I was trying to reply...\nI commented out these lines because often the context of the original test makes it easier to understand what they're supposed to be testing, making them easier to recreate. Personally, I'd prefer to keep the commented out lines incase they proves useful when I'm working on reenabling them, but will remove them if you insist.", "author": "pwinckles", "createdAt": "2020-03-09T01:28:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDAwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNTkzNA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389635934", "bodyText": "I removed the commented out lines", "author": "pwinckles", "createdAt": "2020-03-09T12:43:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDAwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDA0Ng==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420046", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:52:46Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -555,70 +464,22 @@ public void testCreateVersionWithDatetimeAndBody() throws Exception {\n         }\n     }\n \n-    @Ignore //TODO Fix this test\n-    @Test\n-    public void testCreateVersionDuplicateMementoDatetime() throws Exception {\n-        createVersionedContainer(id);\n-\n-        // Create first memento\n-        final String mementoUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);\n-\n-        // Attempt to create second memento with same datetime, which should fail\n-        final HttpPost createVersionMethod = postObjMethod(id + \"/\" + FCR_VERSIONS);\n-        createVersionMethod.addHeader(CONTENT_TYPE, N3);\n-        final String body = \"<\" + subjectUri + \"> <info:test#label> \\\"far\\\"\";\n-        createVersionMethod.setEntity(new StringEntity(body));\n-        createVersionMethod.addHeader(MEMENTO_DATETIME_HEADER, MEMENTO_DATETIME);\n-\n-        try (final CloseableHttpResponse response = execute(createVersionMethod)) {\n-            assertEquals(\"Duplicate memento datetime should return 409 status\",\n-                    CONFLICT.getStatusCode(), getStatus(response));\n-        }\n-\n-        final Node mementoSubject = createURI(subjectUri);\n-        // Verify first memento content persists\n-        try (final CloseableDataset dataset = getDataset(new HttpGet(mementoUri))) {\n-            final DatasetGraph results = dataset.asDatasetGraph();\n-\n-            assertTrue(\"Memento must have first updated property\",\n-                    results.contains(ANY, mementoSubject, TEST_PROPERTY_NODE, createLiteral(\"bar\")));\n-            assertFalse(\"Memento must not have second updated property\",\n-                    results.contains(ANY, mementoSubject, TEST_PROPERTY_NODE, createLiteral(\"far\")));\n-        }\n-    }\n-\n-    @Ignore //TODO Fix this test\n-    @Test\n-    public void testCreateVersionWithDatetimeAndEmptyBody() throws Exception {\n-        createVersionedContainer(id);\n-\n-        final HttpPost createVersionMethod = new HttpPost(subjectUri + \"/\" + FCR_VERSIONS);\n-        createVersionMethod.setEntity(new StringEntity(\"\"));\n-        createVersionMethod.addHeader(MEMENTO_DATETIME_HEADER, MEMENTO_DATETIME);\n-\n-        // Create new memento of resource with updated body\n-        try (final CloseableHttpResponse response = execute(createVersionMethod)) {\n-            assertEquals(\"Didn't get a BAD_REQUEST response!\", BAD_REQUEST.getStatusCode(), getStatus(response));\n-            final String responseMsg = IOUtils.toString(response.getEntity().getContent(), \"UTF-8\");\n-            assertTrue(\"Expected error message indicating empty body provided, received: \" + responseMsg,\n-                    responseMsg.contains(\"Cannot create historic memento from an empty body\"));\n-        }\n-    }\n-\n     @Ignore //TODO Fix this test\n     @Test\n     public void testDeleteAndPostContainerMemento() throws Exception {\n         createVersionedContainer(id);\n \n-        final String mementoUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);\n+        final String mementoUri = createContainerMementoWithBody(subjectUri);\n+//        final String mementoUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNTk5OA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389635998", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:43:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDA0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDA2Mw==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420063", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:52:53Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -555,70 +464,22 @@ public void testCreateVersionWithDatetimeAndBody() throws Exception {\n         }\n     }\n \n-    @Ignore //TODO Fix this test\n-    @Test\n-    public void testCreateVersionDuplicateMementoDatetime() throws Exception {\n-        createVersionedContainer(id);\n-\n-        // Create first memento\n-        final String mementoUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);\n-\n-        // Attempt to create second memento with same datetime, which should fail\n-        final HttpPost createVersionMethod = postObjMethod(id + \"/\" + FCR_VERSIONS);\n-        createVersionMethod.addHeader(CONTENT_TYPE, N3);\n-        final String body = \"<\" + subjectUri + \"> <info:test#label> \\\"far\\\"\";\n-        createVersionMethod.setEntity(new StringEntity(body));\n-        createVersionMethod.addHeader(MEMENTO_DATETIME_HEADER, MEMENTO_DATETIME);\n-\n-        try (final CloseableHttpResponse response = execute(createVersionMethod)) {\n-            assertEquals(\"Duplicate memento datetime should return 409 status\",\n-                    CONFLICT.getStatusCode(), getStatus(response));\n-        }\n-\n-        final Node mementoSubject = createURI(subjectUri);\n-        // Verify first memento content persists\n-        try (final CloseableDataset dataset = getDataset(new HttpGet(mementoUri))) {\n-            final DatasetGraph results = dataset.asDatasetGraph();\n-\n-            assertTrue(\"Memento must have first updated property\",\n-                    results.contains(ANY, mementoSubject, TEST_PROPERTY_NODE, createLiteral(\"bar\")));\n-            assertFalse(\"Memento must not have second updated property\",\n-                    results.contains(ANY, mementoSubject, TEST_PROPERTY_NODE, createLiteral(\"far\")));\n-        }\n-    }\n-\n-    @Ignore //TODO Fix this test\n-    @Test\n-    public void testCreateVersionWithDatetimeAndEmptyBody() throws Exception {\n-        createVersionedContainer(id);\n-\n-        final HttpPost createVersionMethod = new HttpPost(subjectUri + \"/\" + FCR_VERSIONS);\n-        createVersionMethod.setEntity(new StringEntity(\"\"));\n-        createVersionMethod.addHeader(MEMENTO_DATETIME_HEADER, MEMENTO_DATETIME);\n-\n-        // Create new memento of resource with updated body\n-        try (final CloseableHttpResponse response = execute(createVersionMethod)) {\n-            assertEquals(\"Didn't get a BAD_REQUEST response!\", BAD_REQUEST.getStatusCode(), getStatus(response));\n-            final String responseMsg = IOUtils.toString(response.getEntity().getContent(), \"UTF-8\");\n-            assertTrue(\"Expected error message indicating empty body provided, received: \" + responseMsg,\n-                    responseMsg.contains(\"Cannot create historic memento from an empty body\"));\n-        }\n-    }\n-\n     @Ignore //TODO Fix this test\n     @Test\n     public void testDeleteAndPostContainerMemento() throws Exception {\n         createVersionedContainer(id);\n \n-        final String mementoUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);\n+        final String mementoUri = createContainerMementoWithBody(subjectUri);\n+//        final String mementoUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);\n \n         assertEquals(\"Expected delete to succeed\",\n                 NO_CONTENT.getStatusCode(), getStatus(new HttpDelete(mementoUri)));\n \n         assertEquals(\"Deleted memento must be removed\",\n                 NOT_FOUND.getStatusCode(), getStatus(new HttpGet(mementoUri)));\n \n-        final String recreatedUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);\n+        final String recreatedUri = createContainerMementoWithBody(subjectUri);\n+//        final String recreatedUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNjA0Mw==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389636043", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:43:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDA2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDA3MA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420070", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:52:59Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -628,15 +489,17 @@ public void testDeleteAndPostContainerMemento() throws Exception {\n     public void testDeleteAndPostBinaryMemento() throws Exception {\n         createVersionedBinary(id);\n \n-        final String mementoUri = createLDPNRMementoWithExistingBody(MEMENTO_DATETIME);\n+        final String mementoUri = createLDPNRMementoWithExistingBody();\n+//        final String mementoUri = createLDPNRMementoWithExistingBody(MEMENTO_DATETIME);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNjExNg==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389636116", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:44:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDA3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDA3NA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420074", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:53:06Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -628,15 +489,17 @@ public void testDeleteAndPostContainerMemento() throws Exception {\n     public void testDeleteAndPostBinaryMemento() throws Exception {\n         createVersionedBinary(id);\n \n-        final String mementoUri = createLDPNRMementoWithExistingBody(MEMENTO_DATETIME);\n+        final String mementoUri = createLDPNRMementoWithExistingBody();\n+//        final String mementoUri = createLDPNRMementoWithExistingBody(MEMENTO_DATETIME);\n \n         assertEquals(\"Expected delete to succeed\",\n                 NO_CONTENT.getStatusCode(), getStatus(new HttpDelete(mementoUri)));\n \n         assertEquals(\"Deleted memento must be removed\",\n                 NOT_FOUND.getStatusCode(), getStatus(new HttpGet(mementoUri)));\n \n-        final String recreatedUri = createLDPNRMementoWithExistingBody(MEMENTO_DATETIME);\n+        final String recreatedUri = createLDPNRMementoWithExistingBody();\n+//        final String recreatedUri = createLDPNRMementoWithExistingBody(MEMENTO_DATETIME);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNjE4Mg==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389636182", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:44:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDA3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDEwMg==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420102", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:53:13Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -648,15 +511,17 @@ public void testDeleteAndPostDescriptionMemento() throws Exception {\n \n         final String descId = id + \"/\" + FCR_METADATA;\n         final String descUri = serverAddress + descId;\n-        final String mementoUri = createMementoWithExistingBody(descId, MEMENTO_DATETIME, false);\n+        final String mementoUri = createMementoWithExistingBody(descId, false);\n+//        final String mementoUri = createMementoWithExistingBody(descId, MEMENTO_DATETIME, false);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNjIxNQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389636215", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:44:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDEwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDEwNg==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420106", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:53:18Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -648,15 +511,17 @@ public void testDeleteAndPostDescriptionMemento() throws Exception {\n \n         final String descId = id + \"/\" + FCR_METADATA;\n         final String descUri = serverAddress + descId;\n-        final String mementoUri = createMementoWithExistingBody(descId, MEMENTO_DATETIME, false);\n+        final String mementoUri = createMementoWithExistingBody(descId, false);\n+//        final String mementoUri = createMementoWithExistingBody(descId, MEMENTO_DATETIME, false);\n \n         assertEquals(\"Expected delete to succeed\",\n                 NO_CONTENT.getStatusCode(), getStatus(new HttpDelete(mementoUri)));\n \n         assertEquals(\"Deleted memento must be removed\",\n                 NOT_FOUND.getStatusCode(), getStatus(new HttpGet(mementoUri)));\n \n-        final String recreatedUri = createContainerMementoWithBody(descUri, MEMENTO_DATETIME);\n+        final String recreatedUri = createContainerMementoWithBody(descUri);\n+//        final String recreatedUri = createContainerMementoWithBody(descUri, MEMENTO_DATETIME);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNjI1Mw==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389636253", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:44:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDEwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDEyNA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420124", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:53:26Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -670,7 +535,8 @@ public void testMementoContainmentReferences() throws Exception {\n         createObjectAndClose(id + \"/x\");\n \n         // create memento\n-        final String mementoUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);\n+        final String mementoUri = createContainerMementoWithBody(subjectUri);\n+//        final String mementoUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNjI4OQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389636289", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:44:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDEyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDE0Mg==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420142", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:53:33Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -700,7 +566,8 @@ public void testHeadOnMemento() throws Exception {\n         createVersionedContainer(id);\n         final String mementoDateTime =\n             MEMENTO_RFC_1123_FORMATTER.format(ISO_INSTANT.parse(\"2017-06-10T11:41:00Z\", Instant::from));\n-        final String mementoUri = createLDPRSMementoWithExistingBody(mementoDateTime);\n+        final String mementoUri = createLDPRSMementoWithExistingBody();\n+//        final String mementoUri = createLDPRSMementoWithExistingBody(mementoDateTime);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNjMyMA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389636320", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:44:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDE0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDE0OA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420148", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:53:40Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -723,7 +590,8 @@ public void testGetOnMemento() throws Exception {\n         createVersionedContainer(id);\n         final String mementoDateTime =\n             MEMENTO_RFC_1123_FORMATTER.format(ISO_INSTANT.parse(\"2017-06-10T11:41:00Z\", Instant::from));\n-        final String mementoUri = createLDPRSMementoWithExistingBody(mementoDateTime);\n+        final String mementoUri = createLDPRSMementoWithExistingBody();\n+//        final String mementoUri = createLDPRSMementoWithExistingBody(mementoDateTime);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNjM2Mg==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389636362", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:44:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDE0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDE1Ng==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420156", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:53:47Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -745,7 +613,8 @@ public void testGetOnMementoWithAcceptDatetimePresent() throws Exception {\n         createVersionedContainer(id);\n         final String mementoDateTime =\n             MEMENTO_RFC_1123_FORMATTER.format(ISO_INSTANT.parse(\"2017-06-10T11:41:00Z\", Instant::from));\n-        final String mementoUri = createLDPRSMementoWithExistingBody(mementoDateTime);\n+        final String mementoUri = createLDPRSMementoWithExistingBody();\n+//        final String mementoUri = createLDPRSMementoWithExistingBody(mementoDateTime);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNjQ1NA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389636454", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:44:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDE1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDE2OA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420168", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:53:54Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -760,7 +629,8 @@ public void testHeadOnMementoWithAcceptDatetimePresent() throws Exception {\n         createVersionedContainer(id);\n         final String mementoDateTime =\n                 MEMENTO_RFC_1123_FORMATTER.format(ISO_INSTANT.parse(\"2017-06-10T11:41:00Z\", Instant::from));\n-        final String mementoUri = createLDPRSMementoWithExistingBody(mementoDateTime);\n+        final String mementoUri = createLDPRSMementoWithExistingBody();\n+//        final String mementoUri = createLDPRSMementoWithExistingBody(mementoDateTime);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNzI1Mg==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389637252", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:46:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDE2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDE3Ng==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420176", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:54:00Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -776,7 +646,8 @@ public void testOptionsOnMemento() throws Exception {\n         createVersionedContainer(id);\n         final String mementoDateTime =\n             MEMENTO_RFC_1123_FORMATTER.format(ISO_INSTANT.parse(\"2017-06-10T11:41:00Z\", Instant::from));\n-        final String mementoUri = createLDPRSMementoWithExistingBody(mementoDateTime);\n+        final String mementoUri = createLDPRSMementoWithExistingBody();\n+//        final String mementoUri = createLDPRSMementoWithExistingBody(mementoDateTime);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNzI4Nw==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389637287", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:46:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDE3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDE4Mw==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420183", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:54:08Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -809,7 +680,8 @@ public void testMementoExternalReference() throws Exception {\n         executeAndClose(updateObjectGraphMethod);\n \n         // create memento\n-        final String mementoUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);\n+        final String mementoUri = createContainerMementoWithBody(subjectUri);\n+//        final String mementoUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNzMzNg==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389637336", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:46:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDE4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDIwMQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420201", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:54:36Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -1134,13 +1004,14 @@ public void testCreateVersionOfBinary() throws Exception {\n         }\n     }\n \n-    @Ignore //TODO Fix this test\n+    @Ignore(\"get memento not implemented\")\n     @Test\n     public void testCreateVersionOfBinaryWithDatetimeAndContentType() throws Exception {\n         createVersionedBinary(id);\n \n-        final String mementoUri = createMemento(subjectUri, MEMENTO_DATETIME,\n-                OCTET_STREAM_TYPE, null);\n+        final String mementoUri = createMemento(subjectUri);\n+//        final String mementoUri = createMemento(subjectUri, MEMENTO_DATETIME,", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNzM4MA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389637380", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:46:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDIwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDIwNw==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420207", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:54:44Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -1153,13 +1024,14 @@ public void testCreateVersionOfBinaryWithDatetimeAndContentType() throws Excepti\n         }\n     }\n \n-    @Ignore //TODO Fix this test\n+    @Ignore(\"get memento not implemented\")\n     @Test\n     public void testCreateVersionOfBinaryWithBody() throws Exception {\n         createVersionedBinary(id);\n \n-        final String mementoUri = createMemento(subjectUri, null,\n-                OCTET_STREAM_TYPE, BINARY_UPDATED);\n+        final String mementoUri = createMemento(subjectUri);\n+//        final String mementoUri = createMemento(subjectUri, null,", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNzQxMg==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389637412", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:46:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDIwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDIxNQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420215", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:54:51Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -1171,13 +1043,14 @@ public void testCreateVersionOfBinaryWithBody() throws Exception {\n         }\n     }\n \n-    @Ignore //TODO Fix this test\n+    @Ignore(\"get memento not implemented\")\n     @Test\n     public void testCreateVersionOfBinaryWithDatetimeAndBody() throws Exception {\n         createVersionedBinary(id);\n \n-        final String mementoUri = createMemento(subjectUri, MEMENTO_DATETIME,\n-                \"text/plain\", BINARY_UPDATED);\n+        final String mementoUri = createMemento(subjectUri);\n+//        final String mementoUri = createMemento(subjectUri, MEMENTO_DATETIME,", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNzQ1Mw==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389637453", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:47:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDIxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDIyMA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420220", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:55:01Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -1236,39 +1109,15 @@ public void testCreateVersionOfBinaryDescription() throws Exception {\n         assertEquals(NOT_FOUND.getStatusCode(), getStatus(new HttpGet(hypotheticalBinaryUri)));\n     }\n \n-    /*\n-     * Attempt to create binary description with container triples\n-     */\n-    @Ignore //TODO Fix this test\n-    @Test\n-    public void testCreateVersionOfBinaryDescriptionInvalidTriples() throws Exception {\n-        final String containerId = getRandomUniqueId();\n-        final String containerSubjectUri = serverAddress + containerId;\n-        createObjectAndClose(containerId);\n-\n-        createVersionedBinary(id);\n-\n-        final String descriptionUri = subjectUri + \"/fcr:metadata\";\n-\n-        final String containerBody = createContainerMementoBodyContent(containerSubjectUri, \"text/n3\");\n-        final HttpPost createMethod = postObjMethod(descriptionUri);\n-        createMethod.addHeader(CONTENT_TYPE, \"text/n3\");\n-        createMethod.setEntity(new StringEntity(containerBody));\n-\n-        // Attempt to create memento with partial record\n-        try (final CloseableHttpResponse response = execute(createMethod)) {\n-            assertEquals(\"Didn't get a BAD_REQUEST response!\", BAD_REQUEST.getStatusCode(), getStatus(response));\n-        }\n-    }\n-\n     @Ignore //TODO Fix this test\n     @Test\n     public void testCreateVersionBinaryDescriptionWithBodyAndDatetime() throws Exception {\n         createVersionedBinary(id);\n \n         final String descriptionUri = subjectUri + \"/fcr:metadata\";\n \n-        final String mementoUri = createContainerMementoWithBody(descriptionUri, MEMENTO_DATETIME);\n+        final String mementoUri = createContainerMementoWithBody(descriptionUri);\n+//        final String mementoUri = createContainerMementoWithBody(descriptionUri, MEMENTO_DATETIME);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNzUwNw==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389637507", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:47:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDIyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDIyOQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420229", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:55:07Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -1292,11 +1141,13 @@ public void testCreateVersionHistoricBinaryAndDescription() throws Exception {\n \n         final String descriptionUri = subjectUri + \"/fcr:metadata\";\n \n-        final String binaryMementoUri = createMemento(subjectUri, MEMENTO_DATETIME,\n-                null, \"content\");\n+        final String binaryMementoUri = createMemento(subjectUri);\n+//        final String binaryMementoUri = createMemento(subjectUri, MEMENTO_DATETIME,", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNzUzNw==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389637537", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:47:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDIyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDIzNg==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420236", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:55:13Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -1292,11 +1141,13 @@ public void testCreateVersionHistoricBinaryAndDescription() throws Exception {\n \n         final String descriptionUri = subjectUri + \"/fcr:metadata\";\n \n-        final String binaryMementoUri = createMemento(subjectUri, MEMENTO_DATETIME,\n-                null, \"content\");\n+        final String binaryMementoUri = createMemento(subjectUri);\n+//        final String binaryMementoUri = createMemento(subjectUri, MEMENTO_DATETIME,\n+//                null, \"content\");\n         assertMementoUri(binaryMementoUri, subjectUri);\n \n-        final String mementoUri = createContainerMementoWithBody(descriptionUri, MEMENTO_DATETIME);\n+        final String mementoUri = createContainerMementoWithBody(descriptionUri);\n+//        final String mementoUri = createContainerMementoWithBody(descriptionUri, MEMENTO_DATETIME);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNzU2OQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389637569", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:47:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDIzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDI1MA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420250", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:55:21Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -1388,7 +1221,8 @@ public void testTimeMapResponseContentTypes() throws Exception {\n     @Test\n     public void testGetVersionResponseContentTypes() throws Exception {\n         createVersionedContainer(id);\n-        final String versionUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);\n+        final String versionUri = createContainerMementoWithBody(subjectUri);\n+//        final String versionUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNzYwNQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389637605", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:47:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDI1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDI1NA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420254", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:55:28Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -1406,10 +1240,12 @@ public void testDatetimeNegotiationLDPRv() throws Exception {\n         createVersionedContainer(id);\n         final String memento1 =\n             MEMENTO_RFC_1123_FORMATTER.format(ISO_INSTANT.parse(\"2017-06-10T11:41:00Z\", Instant::from));\n-        final String version1Uri = createLDPRSMementoWithExistingBody(memento1);\n+        final String version1Uri = createLDPRSMementoWithExistingBody();\n+//        final String version1Uri = createLDPRSMementoWithExistingBody(memento1);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNzYzMw==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389637633", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:47:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDI1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDI2MA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420260", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:55:34Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -1406,10 +1240,12 @@ public void testDatetimeNegotiationLDPRv() throws Exception {\n         createVersionedContainer(id);\n         final String memento1 =\n             MEMENTO_RFC_1123_FORMATTER.format(ISO_INSTANT.parse(\"2017-06-10T11:41:00Z\", Instant::from));\n-        final String version1Uri = createLDPRSMementoWithExistingBody(memento1);\n+        final String version1Uri = createLDPRSMementoWithExistingBody();\n+//        final String version1Uri = createLDPRSMementoWithExistingBody(memento1);\n         final String memento2 =\n             MEMENTO_RFC_1123_FORMATTER.format(ISO_INSTANT.parse(\"2016-06-17T11:41:00Z\", Instant::from));\n-        final String version2Uri = createLDPRSMementoWithExistingBody(memento2);\n+        final String version2Uri = createLDPRSMementoWithExistingBody();\n+//        final String version2Uri = createLDPRSMementoWithExistingBody(memento2);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNzY3MQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389637671", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:47:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDI2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDI2Nw==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420267", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:55:40Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -1459,7 +1295,8 @@ public void testDatetimeNegotiationExactMatch() throws Exception {\n         final String originalUri = createVersionedContainer(id);\n \n         // Create a current memento\n-        final String version1Uri = createMemento(originalUri, null, \"text/turtle\", null);\n+        final String version1Uri = createMemento(originalUri);\n+//        final String version1Uri = createMemento(originalUri, null, \"text/turtle\", null);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNzcwNQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389637705", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:47:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDI2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDI3Ng==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420276", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:55:45Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -1470,7 +1307,8 @@ public void testDatetimeNegotiationExactMatch() throws Exception {\n         final Instant version2Instant =\n             Instant.from(MEMENTO_RFC_1123_FORMATTER.parse(version1Datetime)).minus(5, ChronoUnit.SECONDS);\n         final String version2Datetime = MEMENTO_RFC_1123_FORMATTER.format(version2Instant);\n-        final String version2Uri = createLDPRSMementoWithExistingBody(version2Datetime);\n+        final String version2Uri = createLDPRSMementoWithExistingBody();\n+//        final String version2Uri = createLDPRSMementoWithExistingBody(version2Datetime);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNzc2Mg==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389637762", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:47:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDI3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDMxOA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420318", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:55:52Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -1530,7 +1368,8 @@ public void testGetWithDateTimeNegotiation() throws Exception {\n             NOT_ACCEPTABLE.getStatusCode(), getStatus(customClient.execute(getMethod1)));\n \n         // Create memento\n-        final String mementoUri = createLDPRSMementoWithExistingBody(mementoDateTime);\n+        final String mementoUri = createLDPRSMementoWithExistingBody();\n+//        final String mementoUri = createLDPRSMementoWithExistingBody(mementoDateTime);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNzc5OQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389637799", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:47:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDMxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDMzMA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420330", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:56:00Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -1577,7 +1416,8 @@ public void testOptionsMemento() throws Exception {\n     public void testPatchOnMemento() throws Exception {\n         createVersionedContainer(id);\n \n-        final String mementoUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);\n+        final String mementoUri = createContainerMementoWithBody(subjectUri);\n+//        final String mementoUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNzg1Mg==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389637852", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:47:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDMzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDMzNw==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420337", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:56:06Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -1606,7 +1446,8 @@ public void testPatchOnInvalidMementoPath() throws Exception {\n     public void testPostOnMemento() throws Exception {\n         createVersionedContainer(id);\n \n-        final String mementoUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);\n+        final String mementoUri = createContainerMementoWithBody(subjectUri);\n+//        final String mementoUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNzg5Ng==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389637896", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:48:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDMzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDM0NA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420344", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:56:11Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -1635,7 +1476,8 @@ public void testPostOnInvalidMementoPath() throws Exception {\n     public void testPutOnMemento() throws Exception {\n         createVersionedContainer(id);\n \n-        final String mementoUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);\n+        final String mementoUri = createContainerMementoWithBody(subjectUri);\n+//        final String mementoUri = createContainerMementoWithBody(subjectUri, MEMENTO_DATETIME);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzNzk3Mg==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389637972", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:48:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDM0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDM0OQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420349", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:56:18Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -1666,7 +1508,8 @@ public void testGetLDPRSMementoHeaders() throws Exception {\n \n         final String memento1 =\n             MEMENTO_RFC_1123_FORMATTER.format(ISO_INSTANT.parse(\"2001-06-10T16:41:00Z\", Instant::from));\n-        final String version1Uri = createLDPRSMementoWithExistingBody(memento1);\n+        final String version1Uri = createLDPRSMementoWithExistingBody();\n+//        final String version1Uri = createLDPRSMementoWithExistingBody(memento1);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzODAyMg==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389638022", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:48:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDM0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDM1NA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420354", "bodyText": "Remove commented-out code.", "author": "awoods", "createdAt": "2020-03-08T23:56:24Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -1690,7 +1533,8 @@ public void testGetLDPNRMementoHeaders() throws Exception {\n \n         final String memento1 =\n             MEMENTO_RFC_1123_FORMATTER.format(ISO_INSTANT.parse(\"2001-06-10T16:41:00Z\", Instant::from));\n-        final String version1Uri = createLDPNRMementoWithExistingBody(memento1);\n+        final String version1Uri = createLDPNRMementoWithExistingBody();\n+//        final String version1Uri = createLDPNRMementoWithExistingBody(memento1);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzODA1OQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389638059", "bodyText": "done", "author": "pwinckles", "createdAt": "2020-03-09T12:48:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDM1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDYyNw==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389420627", "bodyText": "This still seems like a valid test, no?", "author": "awoods", "createdAt": "2020-03-08T23:59:29Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -1236,39 +1109,15 @@ public void testCreateVersionOfBinaryDescription() throws Exception {\n         assertEquals(NOT_FOUND.getStatusCode(), getStatus(new HttpGet(hypotheticalBinaryUri)));\n     }\n \n-    /*\n-     * Attempt to create binary description with container triples\n-     */\n-    @Ignore //TODO Fix this test\n-    @Test\n-    public void testCreateVersionOfBinaryDescriptionInvalidTriples() throws Exception {", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYyOTU1OA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389629558", "bodyText": "I don't believe so because the create version api no longer supports content.", "author": "pwinckles", "createdAt": "2020-03-09T12:30:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyMDYyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyNDg4Ng==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389424886", "bodyText": "session.toString() only provides the session Object reference ID... is this the desired behavior? It may be valuable to add an OCFLPersistentStorageSession.toString() method.\n    public String toString() {\n        return ToStringBuilder.reflectionToString(this);\n    }\n\n..or something with a little more more terse/targeted output.", "author": "awoods", "createdAt": "2020-03-09T00:48:09Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/CreateVersionPersister.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.fcrepo.persistence.ocfl.impl;\n+\n+import org.fcrepo.kernel.api.operations.CreateVersionResourceOperation;\n+import org.fcrepo.kernel.api.operations.ResourceOperation;\n+import org.fcrepo.kernel.api.operations.ResourceOperationType;\n+import org.fcrepo.persistence.api.CommitOption;\n+import org.fcrepo.persistence.api.exceptions.PersistentItemConflictException;\n+import org.fcrepo.persistence.api.exceptions.PersistentStorageException;\n+import org.fcrepo.persistence.ocfl.api.FedoraToOCFLObjectIndex;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Persister for creating a new OCFL version of a resource. The new version is not created until the session\n+ * is committed.\n+ */\n+public class CreateVersionPersister extends AbstractPersister {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(CreateVersionPersister.class);\n+\n+    protected CreateVersionPersister(final FedoraToOCFLObjectIndex index) {\n+        super(CreateVersionResourceOperation.class, ResourceOperationType.UPDATE, index);\n+    }\n+\n+    @Override\n+    public void persist(final OCFLPersistentStorageSession session, final ResourceOperation operation)\n+            throws PersistentStorageException {\n+\n+        final var resourceId = operation.getResourceId();\n+        LOG.debug(\"creating new version of <{}> in session <{}>\", resourceId, session);", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzODM3NA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389638374", "bodyText": "Added tostring", "author": "pwinckles", "createdAt": "2020-03-09T12:48:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyNDg4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyNTY3Mg==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389425672", "bodyText": "This behavior (as well as other versioning updates from this pull-request) should be reflected in the wiki documentation:\nhttps://jira.lyrasis.org/browse/FCREPO-3242", "author": "awoods", "createdAt": "2020-03-09T00:55:22Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/CreateVersionPersister.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.fcrepo.persistence.ocfl.impl;\n+\n+import org.fcrepo.kernel.api.operations.CreateVersionResourceOperation;\n+import org.fcrepo.kernel.api.operations.ResourceOperation;\n+import org.fcrepo.kernel.api.operations.ResourceOperationType;\n+import org.fcrepo.persistence.api.CommitOption;\n+import org.fcrepo.persistence.api.exceptions.PersistentItemConflictException;\n+import org.fcrepo.persistence.api.exceptions.PersistentStorageException;\n+import org.fcrepo.persistence.ocfl.api.FedoraToOCFLObjectIndex;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Persister for creating a new OCFL version of a resource. The new version is not created until the session\n+ * is committed.\n+ */\n+public class CreateVersionPersister extends AbstractPersister {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(CreateVersionPersister.class);\n+\n+    protected CreateVersionPersister(final FedoraToOCFLObjectIndex index) {\n+        super(CreateVersionResourceOperation.class, ResourceOperationType.UPDATE, index);\n+    }\n+\n+    @Override\n+    public void persist(final OCFLPersistentStorageSession session, final ResourceOperation operation)\n+            throws PersistentStorageException {\n+\n+        final var resourceId = operation.getResourceId();\n+        LOG.debug(\"creating new version of <{}> in session <{}>\", resourceId, session);\n+\n+        final var archivalGroupId = findArchivalGroupInAncestry(resourceId, session);\n+\n+        if (archivalGroupId != null && !archivalGroupId.equals(resourceId)) {\n+            throw new PersistentItemConflictException(\n+                    String.format(\"Resource <%s> is contained in Archival Group <%s> and cannot be versioned directly.\"", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyNjM1NA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389426354", "bodyText": "Very minor... but it seems that this import statement should be together with the above edu.wisc imports.", "author": "awoods", "createdAt": "2020-03-09T01:00:51Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/DefaultOCFLObjectSession.java", "diffHunk": "@@ -47,11 +46,12 @@\n import java.util.function.Consumer;\n import java.util.stream.Collectors;\n import java.util.stream.Stream;\n+\n+import edu.wisc.library.ocfl.api.model.VersionId;", "originalCommit": "38c65e634181f0c6dde8923990ce7898cbb83281", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyODg5MA==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389428890", "bodyText": "I'm usually an agrressive import organizer, but I've been fighting hard to resist my urge to organize them because my IDE (intellij) organizes them differently than they are currently (I assume eclipse's work). If people don't care about resides import reorgs, I'll fire away.", "author": "pwinckles", "createdAt": "2020-03-09T01:23:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyNjM1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzODU0MQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1643#discussion_r389638541", "bodyText": "organized imports", "author": "pwinckles", "createdAt": "2020-03-09T12:49:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyNjM1NA=="}], "type": "inlineReview"}, {"oid": "a640b5d9e2dc55caffe3497c14df97b1dd37fb72", "url": "https://github.com/fcrepo/fcrepo/commit/a640b5d9e2dc55caffe3497c14df97b1dd37fb72", "message": "update based on pr comments", "committedDate": "2020-03-09T12:40:53Z", "type": "commit"}, {"oid": "75d476cbcff8a275ceaf9e5d4f09365837b26890", "url": "https://github.com/fcrepo/fcrepo/commit/75d476cbcff8a275ceaf9e5d4f09365837b26890", "message": "slight improvement to the logic that determines whether or not an object session needs to be committed", "committedDate": "2020-03-09T14:32:12Z", "type": "commit"}]}