{"pr_number": 322, "pr_title": "KOGITO-2214: Integrate Task Form Building Block with the runtime endpoints", "pr_createdAt": "2020-07-14T16:42:38Z", "pr_url": "https://github.com/kiegroup/kogito-apps/pull/322", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTYxNTE1NA==", "url": "https://github.com/kiegroup/kogito-apps/pull/322#discussion_r455615154", "bodyText": "we could mock the icon", "author": "jstastny-cz", "createdAt": "2020-07-16T08:28:57Z", "path": "ui-packages/packages/task-console/src/components/Atoms/FormNotification/tests/__snapshots__/FormNotification.test.tsx.snap", "diffHunk": "@@ -0,0 +1,430 @@\n+// Jest Snapshot v1, https://goo.gl/fbAQLP\n+\n+exports[`Form Footer test Snapshot testing 1`] = `\n+<FormNotification\n+  closeAction={[MockFunction]}\n+  message=\"The form has been submitted\"\n+>\n+  <Modal\n+    actions={\n+      Array [\n+        <Unknown\n+          onClick={[MockFunction]}\n+          variant=\"primary\"\n+        >\n+          OK\n+        </Unknown>,\n+      ]\n+    }\n+    appendTo={\n+      <body\n+        class=\"pf-c-backdrop__open\"\n+      >\n+        <div>\n+          <div\n+            class=\"pf-c-backdrop\"\n+          >\n+            <div\n+              class=\"pf-l-bullseye\"\n+            >\n+              <div\n+                aria-describedby=\"pf-modal-0\"\n+                aria-label=\"\"\n+                aria-modal=\"true\"\n+                class=\"pf-c-modal-box pf-m-sm\"\n+                role=\"dialog\"\n+              >\n+                <button\n+                  aria-label=\"Close\"\n+                  class=\"pf-c-button pf-m-plain\"\n+                  type=\"button\"\n+                >\n+                  <svg\n+                    aria-hidden=\"true\"\n+                    fill=\"currentColor\"\n+                    height=\"1em\"\n+                    role=\"img\"\n+                    style=\"vertical-align: -0.125em;\"\n+                    viewBox=\"0 0 352 512\"\n+                    width=\"1em\"\n+                  >\n+                    <path\n+                      d=\"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z\"\n+                      transform=\"\"\n+                    />\n+                  </svg>\n+                </button>\n+                <div\n+                  class=\"pf-c-title\"\n+                >\n+                  <h1\n+                    class=\"pf-c-title pf-m-2xl\"\n+                  >\n+                    Executing Task\n+                  </h1>\n+                </div>\n+                <div\n+                  class=\"pf-c-modal-box__body\"\n+                  id=\"pf-modal-0\"\n+                >\n+                  <div\n+                    class=\"pf-c-content\"\n+                  >\n+                    <p\n+                      class=\"\"\n+                      data-pf-content=\"true\"\n+                    >\n+                      The form has been submitted\n+                    </p>\n+                  </div>\n+                </div>\n+                <div\n+                  class=\"pf-c-modal-box__footer\"\n+                >\n+                  <button\n+                    class=\"pf-c-button pf-m-primary\"\n+                    type=\"button\"\n+                  >\n+                    OK\n+                  </button>\n+                </div>\n+              </div>\n+            </div>\n+          </div>\n+        </div>\n+      </body>\n+    }\n+    ariaDescribedById=\"\"\n+    className=\"\"\n+    header={\n+      <Title\n+        headingLevel=\"h1\"\n+        size=\"2xl\"\n+      >\n+        Executing Task\n+      </Title>\n+    }\n+    hideTitle={false}\n+    isFooterLeftAligned={false}\n+    isLarge={false}\n+    isOpen={true}\n+    isSmall={true}\n+    onClose={[MockFunction]}\n+    showClose={true}\n+    title=\"\"\n+  >\n+    <Portal\n+      containerInfo={\n+        <div>\n+          <div\n+            class=\"pf-c-backdrop\"\n+          >\n+            <div\n+              class=\"pf-l-bullseye\"\n+            >\n+              <div\n+                aria-describedby=\"pf-modal-0\"\n+                aria-label=\"\"\n+                aria-modal=\"true\"\n+                class=\"pf-c-modal-box pf-m-sm\"\n+                role=\"dialog\"\n+              >\n+                <button\n+                  aria-label=\"Close\"\n+                  class=\"pf-c-button pf-m-plain\"\n+                  type=\"button\"\n+                >\n+                  <svg\n+                    aria-hidden=\"true\"\n+                    fill=\"currentColor\"\n+                    height=\"1em\"\n+                    role=\"img\"\n+                    style=\"vertical-align: -0.125em;\"\n+                    viewBox=\"0 0 352 512\"\n+                    width=\"1em\"\n+                  >\n+                    <path\n+                      d=\"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z\"\n+                      transform=\"\"\n+                    />\n+                  </svg>\n+                </button>\n+                <div\n+                  class=\"pf-c-title\"\n+                >\n+                  <h1\n+                    class=\"pf-c-title pf-m-2xl\"\n+                  >\n+                    Executing Task\n+                  </h1>\n+                </div>\n+                <div\n+                  class=\"pf-c-modal-box__body\"\n+                  id=\"pf-modal-0\"\n+                >\n+                  <div\n+                    class=\"pf-c-content\"\n+                  >\n+                    <p\n+                      class=\"\"\n+                      data-pf-content=\"true\"\n+                    >\n+                      The form has been submitted\n+                    </p>\n+                  </div>\n+                </div>\n+                <div\n+                  class=\"pf-c-modal-box__footer\"\n+                >\n+                  <button\n+                    class=\"pf-c-button pf-m-primary\"\n+                    type=\"button\"\n+                  >\n+                    OK\n+                  </button>\n+                </div>\n+              </div>\n+            </div>\n+          </div>\n+        </div>\n+      }\n+    >\n+      <ModalContent\n+        actions={\n+          Array [\n+            <Unknown\n+              onClick={[MockFunction]}\n+              variant=\"primary\"\n+            >\n+              OK\n+            </Unknown>,\n+          ]\n+        }\n+        ariaDescribedById=\"\"\n+        className=\"\"\n+        header={\n+          <Title\n+            headingLevel=\"h1\"\n+            size=\"2xl\"\n+          >\n+            Executing Task\n+          </Title>\n+        }\n+        hideTitle={false}\n+        id=\"pf-modal-0\"\n+        isFooterLeftAligned={false}\n+        isLarge={false}\n+        isOpen={true}\n+        isSmall={true}\n+        onClose={[MockFunction]}\n+        showClose={true}\n+        title=\"\"\n+      >\n+        <Backdrop>\n+          <div\n+            className=\"pf-c-backdrop\"\n+          >\n+            <FocusTrap\n+              active={true}\n+              className=\"pf-l-bullseye\"\n+              focusTrapOptions={\n+                Object {\n+                  \"clickOutsideDeactivates\": true,\n+                }\n+              }\n+              paused={false}\n+            >\n+              <div\n+                className=\"pf-l-bullseye\"\n+              >\n+                <ModalBox\n+                  className=\"\"\n+                  id=\"pf-modal-0\"\n+                  isLarge={false}\n+                  isSmall={true}\n+                  style={Object {}}\n+                  title=\"\"\n+                >\n+                  <div\n+                    aria-describedby=\"pf-modal-0\"\n+                    aria-label=\"\"\n+                    aria-modal=\"true\"\n+                    className=\"pf-c-modal-box pf-m-sm\"\n+                    role=\"dialog\"\n+                    style={Object {}}\n+                  >\n+                    <ModalBoxCloseButton\n+                      onClose={[MockFunction]}\n+                    >\n+                      <Component\n+                        aria-label=\"Close\"\n+                        className=\"\"\n+                        onClick={[MockFunction]}\n+                        variant=\"plain\"\n+                      >\n+                        <ComponentWithOuia\n+                          component={[Function]}\n+                          componentProps={\n+                            Object {\n+                              \"aria-label\": \"Close\",\n+                              \"children\": <TimesIcon\n+                                color=\"currentColor\"\n+                                noVerticalAlign={false}\n+                                size=\"sm\"\n+                                title={null}\n+                              />,\n+                              \"className\": \"\",\n+                              \"onClick\": [MockFunction],\n+                              \"variant\": \"plain\",\n+                            }\n+                          }\n+                          consumerContext={null}\n+                        >\n+                          <Button\n+                            aria-label=\"Close\"\n+                            className=\"\"\n+                            onClick={[MockFunction]}\n+                            ouiaContext={\n+                              Object {\n+                                \"isOuia\": false,\n+                                \"ouiaId\": null,\n+                              }\n+                            }\n+                            variant=\"plain\"\n+                          >\n+                            <button\n+                              aria-disabled={null}\n+                              aria-label=\"Close\"\n+                              className=\"pf-c-button pf-m-plain\"\n+                              disabled={false}\n+                              onClick={[MockFunction]}\n+                              tabIndex={null}\n+                              type=\"button\"\n+                            >\n+                              <TimesIcon", "originalCommit": "fafb7c9f6ff3a442d6f7cc949028690f83b251be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTYyNzczMw==", "url": "https://github.com/kiegroup/kogito-apps/pull/322#discussion_r455627733", "bodyText": "should this still be called action? I've seen lots of changes from action to phase, is this something different?", "author": "jstastny-cz", "createdAt": "2020-07-16T08:49:32Z", "path": "ui-packages/packages/task-console/src/components/Atoms/FormFooter/FormFooter.tsx", "diffHunk": "@@ -12,17 +11,20 @@ interface IOwnProps {\n }\n \n const FormFooter: React.FC<IOwnProps> = ({ actions }) => {\n+  const capitalize = label => {\n+    return label.charAt(0).toUpperCase() + label.slice(1);\n+  };\n+\n   return actions && actions.length > 0 ? (\n     <ActionGroup>\n       {actions.map(action => {\n         return (\n           <Button\n             key={'submit-' + action.name}\n             type=\"submit\"\n-            variant={action.primary ? 'primary' : 'secondary'}\n             onClick={action.onActionClick}\n           >\n-            {action.name}\n+            {capitalize(action.name)}", "originalCommit": "fafb7c9f6ff3a442d6f7cc949028690f83b251be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY2NzU1MA==", "url": "https://github.com/kiegroup/kogito-apps/pull/322#discussion_r455667550", "bodyText": "In this case it makes sense, I'd like the footer only being able to execute the actions provided the renderer so its not aware of the runtime specifics.", "author": "pefernan", "createdAt": "2020-07-16T09:54:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTYyNzczMw=="}], "type": "inlineReview"}, {"oid": "d5f57904ddc474924618a2af761d77b37fd5f4ca", "url": "https://github.com/kiegroup/kogito-apps/commit/d5f57904ddc474924618a2af761d77b37fd5f4ca", "message": "- Moved form submission to a separate handler", "committedDate": "2020-07-16T16:32:38Z", "type": "forcePushed"}, {"oid": "f59df39193806be6c47b9589095c0c450486eb44", "url": "https://github.com/kiegroup/kogito-apps/commit/f59df39193806be6c47b9589095c0c450486eb44", "message": "- Moved form submission to a separate handler", "committedDate": "2020-07-16T16:37:08Z", "type": "forcePushed"}, {"oid": "8341b268f18fbc38e509bb6b407a4329f5ec4eb6", "url": "https://github.com/kiegroup/kogito-apps/commit/8341b268f18fbc38e509bb6b407a4329f5ec4eb6", "message": "- Updating Uniforms-patternfly version", "committedDate": "2020-07-17T13:18:34Z", "type": "forcePushed"}, {"oid": "d7b25229f32a2fe6d90b47ca05bd18dbd9370d40", "url": "https://github.com/kiegroup/kogito-apps/commit/d7b25229f32a2fe6d90b47ca05bd18dbd9370d40", "message": "KOGITO-2214: Integrate Task Form Building Block with the runtime endpoints", "committedDate": "2020-07-21T07:35:59Z", "type": "commit"}, {"oid": "a6c7f76c5d57d8ccb11a9805a1386b4b2f6bc067", "url": "https://github.com/kiegroup/kogito-apps/commit/a6c7f76c5d57d8ccb11a9805a1386b4b2f6bc067", "message": "- Fixed tests", "committedDate": "2020-07-21T07:35:59Z", "type": "commit"}, {"oid": "dc72d3f5a53d504cae0ae4c9d26c60c9725741e2", "url": "https://github.com/kiegroup/kogito-apps/commit/dc72d3f5a53d504cae0ae4c9d26c60c9725741e2", "message": "- Moved form submission to a separate handler", "committedDate": "2020-07-21T07:35:59Z", "type": "commit"}, {"oid": "dcc6a5f7991b48425f9c88d00b9786056e8d6431", "url": "https://github.com/kiegroup/kogito-apps/commit/dcc6a5f7991b48425f9c88d00b9786056e8d6431", "message": "- test fixes", "committedDate": "2020-07-21T07:35:59Z", "type": "commit"}, {"oid": "85558c984004b522f2db64ac8ddb4da62851904c", "url": "https://github.com/kiegroup/kogito-apps/commit/85558c984004b522f2db64ac8ddb4da62851904c", "message": "- Updating Uniforms-patternfly version", "committedDate": "2020-07-21T07:35:59Z", "type": "commit"}, {"oid": "b5be852d74e85aacbb763a4d6156541c1c029bad", "url": "https://github.com/kiegroup/kogito-apps/commit/b5be852d74e85aacbb763a4d6156541c1c029bad", "message": "- query fix", "committedDate": "2020-07-21T11:06:00Z", "type": "commit"}, {"oid": "b5be852d74e85aacbb763a4d6156541c1c029bad", "url": "https://github.com/kiegroup/kogito-apps/commit/b5be852d74e85aacbb763a4d6156541c1c029bad", "message": "- query fix", "committedDate": "2020-07-21T11:06:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA4NjI4OQ==", "url": "https://github.com/kiegroup/kogito-apps/pull/322#discussion_r458086289", "bodyText": "whitespace inconsistency - once if( below is if (", "author": "jstastny-cz", "createdAt": "2020-07-21T13:15:16Z", "path": "ui-packages/packages/task-console/src/util/uniforms/TaskFormSubmitHandler/TaskFormSubmitHandler.ts", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import axios from 'axios';\n+\n+import { IFormAction, IFormSubmitHandler } from '../FormSubmitHandler/FormSubmitHandler';\n+import { FormSchema } from '../FormSchema';\n+import { TaskInfo } from '../../../model/TaskInfo';\n+\n+interface FormAssignments {\n+  inputs: string[];\n+  outputs: string[];\n+}\n+\n+export class TaskFormSubmitHandler implements IFormSubmitHandler {\n+\n+  private readonly taskInfo: TaskInfo;\n+  private readonly formSchema: FormSchema;\n+  private readonly successCallback?: (result: string) => void;\n+  private readonly errorCallback?: (errorMessage: string, error?: string) => void;\n+\n+  private readonly assignments;\n+  private readonly actions: IFormAction[] = [];\n+\n+  private selectedPhase: string;\n+\n+  constructor(taskInfo: TaskInfo,\n+              formSchema: FormSchema,\n+              successCallback?: (phase: string) => void,\n+              errorCallback?: (phase: string, errorMessage?: string) => void) {\n+\n+    this.taskInfo = taskInfo;\n+    this.formSchema = formSchema;\n+    this.successCallback = successCallback;\n+    this.errorCallback = errorCallback;\n+\n+    this.assignments = readSchemaAssignments(this.formSchema);\n+\n+    if (!taskInfo.task.completed && formSchema.phases) {\n+\n+      this.actions = formSchema.phases.map(phase => {\n+        return {\n+          name: phase,\n+          execute: () => {\n+            this.setSelectedPhase(phase);\n+          }\n+        };\n+      });\n+    }\n+  }\n+\n+  public setSelectedPhase(phase: string): void {\n+    this.selectedPhase = phase;\n+  }\n+\n+  getActions = () => {\n+    return this.actions;\n+  }\n+\n+  doSubmit = async (formData: any) => {\n+\n+    if(this.actions.length === 0 || !this.selectedPhase) {", "originalCommit": "b5be852d74e85aacbb763a4d6156541c1c029bad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA5NjIzNg==", "url": "https://github.com/kiegroup/kogito-apps/pull/322#discussion_r458096236", "bodyText": "@jstastny-cz cool. I'll wait for @nmirasch's review to do the change along with her suggestions.", "author": "pefernan", "createdAt": "2020-07-21T13:28:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA4NjI4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDEzNTQxMw==", "url": "https://github.com/kiegroup/kogito-apps/pull/322#discussion_r460135413", "bodyText": "@pefernan  This comment could be removed?", "author": "nmirasch", "createdAt": "2020-07-24T15:45:07Z", "path": "ui-packages/packages/task-console/src/util/uniforms/TaskFormSubmitHandler/tests/TaskFormSubmitHandler.test.ts", "diffHunk": "@@ -0,0 +1,208 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import _ from 'lodash';\n+import axios from 'axios';\n+\n+import ApplyForVisaForm from '../../../tests/mocks/ApplyForVisa';\n+import { UserTaskInstance } from '../../../../graphql/types';\n+import { TaskInfoImpl } from '../../../../model/TaskInfo';\n+import { TaskFormSubmitHandler } from '../TaskFormSubmitHandler';\n+/*import { mount } from 'enzyme';", "originalCommit": "b5be852d74e85aacbb763a4d6156541c1c029bad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "751dba6020dbb0feb3925b99727bd721eb34abfb", "url": "https://github.com/kiegroup/kogito-apps/commit/751dba6020dbb0feb3925b99727bd721eb34abfb", "message": "- removed unneeded comments", "committedDate": "2020-07-24T15:50:44Z", "type": "commit"}]}