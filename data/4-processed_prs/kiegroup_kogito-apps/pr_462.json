{"pr_number": 462, "pr_title": "KOGITO-3339 Integrate sorting in task inbox", "pr_createdAt": "2020-09-18T04:01:45Z", "pr_url": "https://github.com/kiegroup/kogito-apps/pull/462", "timeline": [{"oid": "8c68065e5fee800ce6916855272041861b8303b5", "url": "https://github.com/kiegroup/kogito-apps/commit/8c68065e5fee800ce6916855272041861b8303b5", "message": "KOGITO-3339 Integrate sorting in task inbox", "committedDate": "2020-09-18T05:13:52Z", "type": "forcePushed"}, {"oid": "a09d38b6e9ea81edb272ec9f7775d765a2edce2a", "url": "https://github.com/kiegroup/kogito-apps/commit/a09d38b6e9ea81edb272ec9f7775d765a2edce2a", "message": "KOGITO-3339 Integrate sorting in task inbox", "committedDate": "2020-09-18T05:22:20Z", "type": "forcePushed"}, {"oid": "e3d1cef355882e40b4eab2acba5a43ca961b80ee", "url": "https://github.com/kiegroup/kogito-apps/commit/e3d1cef355882e40b4eab2acba5a43ca961b80ee", "message": "KOGITO-3339 Integrate sorting in task inbox", "committedDate": "2020-09-18T09:34:49Z", "type": "forcePushed"}, {"oid": "ffba14f97f588f0b77089c62485987eb757b6524", "url": "https://github.com/kiegroup/kogito-apps/commit/ffba14f97f588f0b77089c62485987eb757b6524", "message": "KOGITO-3339 Integrate sorting in task inbox", "committedDate": "2020-09-18T09:59:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE1Mzg1Mw==", "url": "https://github.com/kiegroup/kogito-apps/pull/462#discussion_r492153853", "bodyText": "since we keep the sortBy in context, do we still need it as a state of the component?", "author": "pefernan", "createdAt": "2020-09-21T15:30:13Z", "path": "ui-packages/packages/task-console/src/components/Organisms/TaskInbox/TaskInbox.tsx", "diffHunk": "@@ -39,31 +41,40 @@ const UserTaskLoadingComponent = (\n );\n \n const TaskInbox: React.FC = props => {\n+  const context: IContext<UserTaskInstance> = useContext(TaskConsoleContext);\n   const [defaultPageSize] = useState<number>(10);\n   const [isLoaded, setIsLoaded] = useState<boolean>(false);\n   const [isLoading, setIsLoading] = useState<boolean>(false);\n   const [queryOffset, setOffset] = useState<number>(0);\n   const [pageSize, setPageSize] = useState<number>(defaultPageSize);\n   const [isLoadingMore, setIsLoadingMore] = useState<boolean>(false);\n   const [tableData, setTableData] = useState<any[]>([]);\n-\n-  const context: IContext<UserTaskInstance> = useContext(TaskConsoleContext);\n+  const [sortBy, setSortBy] = useState<SortBy>(", "originalCommit": "ffba14f97f588f0b77089c62485987eb757b6524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ2MzI3Mg==", "url": "https://github.com/kiegroup/kogito-apps/pull/462#discussion_r492463272", "bodyText": "removed \ud83d\udc4d", "author": "AjayJagan", "createdAt": "2020-09-22T04:05:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE1Mzg1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE1NTE4Ng==", "url": "https://github.com/kiegroup/kogito-apps/pull/462#discussion_r492155186", "bodyText": "Same here!", "author": "pefernan", "createdAt": "2020-09-21T15:32:08Z", "path": "ui-packages/packages/task-console/src/components/Organisms/TaskInbox/TaskInbox.tsx", "diffHunk": "@@ -74,41 +85,102 @@ const TaskInbox: React.FC = props => {\n       setPageSize(_pageSize);\n     }\n \n+    if (!_.isEmpty(sortBy)) {\n+      newQueryOffset = 0;\n+      newQueryLimit = tableData.length + newQueryLimit;\n+    }\n+\n+    context.getActiveQueryInfo().offset = newQueryOffset;\n+    context.getActiveQueryInfo().maxElements += _pageSize;\n+\n+    fetchUserTasks(newQueryOffset, newQueryLimit);\n+  };\n+  const fetchUserTasks = (_queryOffset, _queryLimit) => {\n     getUserTasks({\n       variables: {\n         user: context.getUser().id,\n         groups: context.getUser().groups,\n         offset: _queryOffset,\n-        limit: _pageSize\n+        limit: _queryLimit,\n+        orderBy: getSortByObject()\n       }\n     });\n   };\n-\n   useEffect(() => {\n-    onGetMoreInstances(queryOffset, pageSize, false);\n+    if (!context.getActiveQueryInfo().maxElements) {\n+      context.getActiveQueryInfo().maxElements = pageSize;\n+    }\n+    if (context.getActiveQueryInfo().offset) {\n+      setOffset(context.getActiveQueryInfo().offset);\n+    }\n+    fetchUserTasks(0, context.getActiveQueryInfo().maxElements);\n   }, []);\n \n   useEffect(() => {\n     if (isLoadingMore === undefined || !isLoadingMore) {\n       setIsLoading(loading);\n     }\n+\n     if (!loading && data !== undefined) {\n-      const newData = tableData.concat(data.UserTaskInstances);\n-      setTableData(newData);\n+      setSorting(false);\n+\n+      if (_.isEmpty(sortBy)) {\n+        const newData = tableData.concat(data.UserTaskInstances);\n+        setTableData(newData);\n+      } else {\n+        setTableData(data.UserTaskInstances);\n+      }\n+\n       if (queryOffset > 0 && tableData.length > 0) {\n         setIsLoadingMore(false);\n       }\n+\n       if (!isLoaded) {\n         setIsLoaded(true);\n       }\n     }\n   }, [data]);\n \n+  const onSorting = (index, direction) => {\n+    setSorting(true);\n+    if (direction) {\n+      setSortBy({ index, direction });", "originalCommit": "ffba14f97f588f0b77089c62485987eb757b6524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ2MzI5Mg==", "url": "https://github.com/kiegroup/kogito-apps/pull/462#discussion_r492463292", "bodyText": "removed \ud83d\udc4d", "author": "AjayJagan", "createdAt": "2020-09-22T04:05:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE1NTE4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE1NTI4NA==", "url": "https://github.com/kiegroup/kogito-apps/pull/462#discussion_r492155284", "bodyText": "same here!", "author": "pefernan", "createdAt": "2020-09-21T15:32:16Z", "path": "ui-packages/packages/task-console/src/components/Organisms/TaskInbox/TaskInbox.tsx", "diffHunk": "@@ -74,41 +85,102 @@ const TaskInbox: React.FC = props => {\n       setPageSize(_pageSize);\n     }\n \n+    if (!_.isEmpty(sortBy)) {\n+      newQueryOffset = 0;\n+      newQueryLimit = tableData.length + newQueryLimit;\n+    }\n+\n+    context.getActiveQueryInfo().offset = newQueryOffset;\n+    context.getActiveQueryInfo().maxElements += _pageSize;\n+\n+    fetchUserTasks(newQueryOffset, newQueryLimit);\n+  };\n+  const fetchUserTasks = (_queryOffset, _queryLimit) => {\n     getUserTasks({\n       variables: {\n         user: context.getUser().id,\n         groups: context.getUser().groups,\n         offset: _queryOffset,\n-        limit: _pageSize\n+        limit: _queryLimit,\n+        orderBy: getSortByObject()\n       }\n     });\n   };\n-\n   useEffect(() => {\n-    onGetMoreInstances(queryOffset, pageSize, false);\n+    if (!context.getActiveQueryInfo().maxElements) {\n+      context.getActiveQueryInfo().maxElements = pageSize;\n+    }\n+    if (context.getActiveQueryInfo().offset) {\n+      setOffset(context.getActiveQueryInfo().offset);\n+    }\n+    fetchUserTasks(0, context.getActiveQueryInfo().maxElements);\n   }, []);\n \n   useEffect(() => {\n     if (isLoadingMore === undefined || !isLoadingMore) {\n       setIsLoading(loading);\n     }\n+\n     if (!loading && data !== undefined) {\n-      const newData = tableData.concat(data.UserTaskInstances);\n-      setTableData(newData);\n+      setSorting(false);\n+\n+      if (_.isEmpty(sortBy)) {\n+        const newData = tableData.concat(data.UserTaskInstances);\n+        setTableData(newData);\n+      } else {\n+        setTableData(data.UserTaskInstances);\n+      }\n+\n       if (queryOffset > 0 && tableData.length > 0) {\n         setIsLoadingMore(false);\n       }\n+\n       if (!isLoaded) {\n         setIsLoaded(true);\n       }\n     }\n   }, [data]);\n \n+  const onSorting = (index, direction) => {\n+    setSorting(true);\n+    if (direction) {\n+      setSortBy({ index, direction });\n+      context.getActiveQueryInfo().sortBy = { index, direction };\n+    } else {\n+      context.getActiveQueryInfo().sortBy = null;\n+    }\n+  };\n+\n+  const getSortByObject = () => {\n+    if (!_.isEmpty(sortBy)) {", "originalCommit": "ffba14f97f588f0b77089c62485987eb757b6524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ2MzMwMA==", "url": "https://github.com/kiegroup/kogito-apps/pull/462#discussion_r492463300", "bodyText": "removed \ud83d\udc4d", "author": "AjayJagan", "createdAt": "2020-09-22T04:05:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE1NTI4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE1NTMzMg==", "url": "https://github.com/kiegroup/kogito-apps/pull/462#discussion_r492155332", "bodyText": "can we use the fetchUserTasks method here??", "author": "pefernan", "createdAt": "2020-09-21T15:32:21Z", "path": "ui-packages/packages/task-console/src/components/Organisms/TaskInbox/TaskInbox.tsx", "diffHunk": "@@ -74,41 +85,102 @@ const TaskInbox: React.FC = props => {\n       setPageSize(_pageSize);\n     }\n \n+    if (!_.isEmpty(sortBy)) {\n+      newQueryOffset = 0;\n+      newQueryLimit = tableData.length + newQueryLimit;\n+    }\n+\n+    context.getActiveQueryInfo().offset = newQueryOffset;\n+    context.getActiveQueryInfo().maxElements += _pageSize;\n+\n+    fetchUserTasks(newQueryOffset, newQueryLimit);\n+  };\n+  const fetchUserTasks = (_queryOffset, _queryLimit) => {\n     getUserTasks({\n       variables: {\n         user: context.getUser().id,\n         groups: context.getUser().groups,\n         offset: _queryOffset,\n-        limit: _pageSize\n+        limit: _queryLimit,\n+        orderBy: getSortByObject()\n       }\n     });\n   };\n-\n   useEffect(() => {\n-    onGetMoreInstances(queryOffset, pageSize, false);\n+    if (!context.getActiveQueryInfo().maxElements) {\n+      context.getActiveQueryInfo().maxElements = pageSize;\n+    }\n+    if (context.getActiveQueryInfo().offset) {\n+      setOffset(context.getActiveQueryInfo().offset);\n+    }\n+    fetchUserTasks(0, context.getActiveQueryInfo().maxElements);\n   }, []);\n \n   useEffect(() => {\n     if (isLoadingMore === undefined || !isLoadingMore) {\n       setIsLoading(loading);\n     }\n+\n     if (!loading && data !== undefined) {\n-      const newData = tableData.concat(data.UserTaskInstances);\n-      setTableData(newData);\n+      setSorting(false);\n+\n+      if (_.isEmpty(sortBy)) {\n+        const newData = tableData.concat(data.UserTaskInstances);\n+        setTableData(newData);\n+      } else {\n+        setTableData(data.UserTaskInstances);\n+      }\n+\n       if (queryOffset > 0 && tableData.length > 0) {\n         setIsLoadingMore(false);\n       }\n+\n       if (!isLoaded) {\n         setIsLoaded(true);\n       }\n     }\n   }, [data]);\n \n+  const onSorting = (index, direction) => {\n+    setSorting(true);\n+    if (direction) {\n+      setSortBy({ index, direction });\n+      context.getActiveQueryInfo().sortBy = { index, direction };\n+    } else {\n+      context.getActiveQueryInfo().sortBy = null;\n+    }\n+  };\n+\n+  const getSortByObject = () => {\n+    if (!_.isEmpty(sortBy)) {\n+      return _.set(\n+        {},\n+        columns[sortBy.index].path,\n+        sortBy.direction.toUpperCase()\n+      );\n+    }\n+    return null;\n+  };\n+\n+  useEffect(() => {\n+    if (!_.isEmpty(sortBy)) {\n+      getUserTasks({", "originalCommit": "ffba14f97f588f0b77089c62485987eb757b6524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ2MzM2Mw==", "url": "https://github.com/kiegroup/kogito-apps/pull/462#discussion_r492463363", "bodyText": "used fetchUserTasks :)", "author": "AjayJagan", "createdAt": "2020-09-22T04:05:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE1NTMzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE1NTUwMA==", "url": "https://github.com/kiegroup/kogito-apps/pull/462#discussion_r492155500", "bodyText": "same here!", "author": "pefernan", "createdAt": "2020-09-21T15:32:35Z", "path": "ui-packages/packages/task-console/src/components/Organisms/TaskInbox/TaskInbox.tsx", "diffHunk": "@@ -144,6 +206,8 @@ const TaskInbox: React.FC = props => {\n         error={error}\n         refetch={refetch}\n         LoadingComponent={UserTaskLoadingComponent}\n+        onSorting={onSorting}\n+        sortBy={sortBy}", "originalCommit": "ffba14f97f588f0b77089c62485987eb757b6524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ2MzQwMQ==", "url": "https://github.com/kiegroup/kogito-apps/pull/462#discussion_r492463401", "bodyText": "removed \ud83d\udc4d", "author": "AjayJagan", "createdAt": "2020-09-22T04:06:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE1NTUwMA=="}], "type": "inlineReview"}, {"oid": "6ea567ce4ff7082f0823ec70af2023d79e911f8e", "url": "https://github.com/kiegroup/kogito-apps/commit/6ea567ce4ff7082f0823ec70af2023d79e911f8e", "message": "KOGITO-3339 Integrate sorting in task inbox", "committedDate": "2020-09-21T16:27:36Z", "type": "forcePushed"}, {"oid": "2fefe027eefca8e8a113413041231db7782a2f5c", "url": "https://github.com/kiegroup/kogito-apps/commit/2fefe027eefca8e8a113413041231db7782a2f5c", "message": "KOGITO-3339 Integrate sorting in task inbox", "committedDate": "2020-09-23T14:56:19Z", "type": "forcePushed"}, {"oid": "e2b4507f9d1fd17ee06e7b4274e762cb42c4ffdc", "url": "https://github.com/kiegroup/kogito-apps/commit/e2b4507f9d1fd17ee06e7b4274e762cb42c4ffdc", "message": "KOGITO-3339 Integrate sorting in task inbox", "committedDate": "2020-09-25T07:23:39Z", "type": "forcePushed"}, {"oid": "66caeca05b8fd936a1f0bc6cce041a1f7dd52ace", "url": "https://github.com/kiegroup/kogito-apps/commit/66caeca05b8fd936a1f0bc6cce041a1f7dd52ace", "message": "KOGITO-3339 Integrate sorting in task inbox", "committedDate": "2020-09-25T08:22:41Z", "type": "commit"}, {"oid": "66caeca05b8fd936a1f0bc6cce041a1f7dd52ace", "url": "https://github.com/kiegroup/kogito-apps/commit/66caeca05b8fd936a1f0bc6cce041a1f7dd52ace", "message": "KOGITO-3339 Integrate sorting in task inbox", "committedDate": "2020-09-25T08:22:41Z", "type": "forcePushed"}]}