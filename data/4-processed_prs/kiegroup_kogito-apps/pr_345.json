{"pr_number": 345, "pr_title": "KOGITO-2741 Enrich TrustyService with data types information from TraceEvents", "pr_createdAt": "2020-07-24T13:31:11Z", "pr_url": "https://github.com/kiegroup/kogito-apps/pull/345", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU0NTY5OQ==", "url": "https://github.com/kiegroup/kogito-apps/pull/345#discussion_r461545699", "bodyText": "Would it be possible split these long lines to make code more readable?", "author": "jiripetrlik", "createdAt": "2020-07-28T12:37:31Z", "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceTestUtils.java", "diffHunk": "@@ -363,19 +397,19 @@ private static TraceHeader buildHeader(String executionId, Long startTs, Long en\n     }\n \n     private static TraceInputValue buildInputDriver(String value, List<Message> messages) {\n-        return new TraceInputValue(INPUT_DRIVER_NODE_ID, INPUT_DRIVER_NODE_NAME, tDriverType, toJsonNode(value), messages);\n+        return new TraceInputValue(INPUT_DRIVER_NODE_ID, INPUT_DRIVER_NODE_NAME, value == null ? vEventDriverNull : vEventDriver, messages);\n     }\n \n     private static TraceInputValue buildInputViolation(String value, List<Message> messages) {\n-        return new TraceInputValue(INPUT_VIOLATION_NODE_ID, INPUT_VIOLATION_NODE_NAME, tViolationType, toJsonNode(value), messages);\n+        return new TraceInputValue(INPUT_VIOLATION_NODE_ID, INPUT_VIOLATION_NODE_NAME, vEventViolation, messages);\n     }\n \n     private static TraceOutputValue buildOutputFine(String value, List<Message> messages) {\n-        return new TraceOutputValue(OUTPUT_FINE_NODE_ID, OUTPUT_FINE_NODE_NAME, EVALUATION_STATUS_SUCCEEDED, tFineType, toJsonNode(value), messages);\n+        return new TraceOutputValue(OUTPUT_FINE_NODE_ID, OUTPUT_FINE_NODE_NAME, EVALUATION_STATUS_SUCCEEDED, vEventFine, Map.of(INPUT_VIOLATION_NODE_NAME, vEventViolation), messages);\n     }\n \n     private static TraceOutputValue buildOutputShouldTheDriverBeSuspended(String status, String value, List<Message> messages) {\n-        return new TraceOutputValue(OUTPUT_SHOULD_THE_DRIVER_BE_SUSPENDED_NODE_ID, OUTPUT_SHOULD_THE_DRIVER_BE_SUSPENDED_NODE_NAME, status, stringType, toJsonNode(value), messages);\n+        return new TraceOutputValue(OUTPUT_SHOULD_THE_DRIVER_BE_SUSPENDED_NODE_ID, OUTPUT_SHOULD_THE_DRIVER_BE_SUSPENDED_NODE_NAME, status, value == null ? null : vEventSuspended, value == null ? Map.of(\"Fine\", vEventFine) : Map.of(\"Driver\", vEventDriver, \"Fine\", vEventFine), messages);", "originalCommit": "c00361c416a0a60906f8c9957eace8678a96a9cb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4NTExOQ==", "url": "https://github.com/kiegroup/kogito-apps/pull/345#discussion_r471485119", "bodyText": "Done", "author": "kostola", "createdAt": "2020-08-17T13:39:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU0NTY5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUzNDQwMw==", "url": "https://github.com/kiegroup/kogito-apps/pull/345#discussion_r462534403", "bodyText": "It's quite hard to understand what are the created objects and what it's really tested. Isnt't better to create a resource file and deserialize it?\nIf this is not a stable implementation and you prefer to create the things programmatically, do you mind to create a ticket so that we keep track that we have to change it in the future?", "author": "r00ta", "createdAt": "2020-07-29T19:25:48Z", "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/responses/TypedVariableResponseTest.java", "diffHunk": "@@ -0,0 +1,204 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.trusty.service.responses;\n+\n+import java.util.List;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import io.cloudevents.json.Json;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+import org.kie.kogito.trusty.storage.api.model.TypedVariable;\n+\n+class TypedVariableResponseTest {\n+\n+    private static final String FIELD_COMPONENTS = \"components\";\n+    private static final String FIELD_NAME = \"name\";\n+    private static final String FIELD_TYPE_REF = \"typeRef\";\n+    private static final String FIELD_VALUE = \"value\";\n+    private static final String TYPE_REF_NUMBER = \"number\";\n+    private static final String TYPE_REF_STRING = \"string\";\n+    private static final String TYPE_REF_STRUCT = \"StructType\";\n+    private static final String VAR_NAME_COLLECTION = \"tstCollection\";\n+    private static final String VAR_NAME_STRUCT = \"tstStruct\";\n+    private static final String VAR_NAME_UNIT = \"tstUnit\";\n+    private static final String VALUE_AGE = \"age\";\n+    private static final String VALUE_COUNT_ONE = \"One\";\n+    private static final String VALUE_COUNT_TWO = \"Two\";\n+    private static final String VALUE_COUNT_THREE = \"Three\";\n+    private static final String VALUE_HELLO_THIS_IS_A_TEST = \"hello this is a test\";\n+    private static final String VALUE_MILANO = \"Milano\";\n+    private static final String VALUE_MONZA = \"Monza\";\n+    private static final String VALUE_TAVULLIA = \"Tavullia\";\n+    private static final String VALUE_TOWN = \"town\";\n+    private static final int VALUE_34 = 34;\n+    private static final int VALUE_41 = 41;\n+    private static final int VALUE_50 = 50;\n+\n+    @Test\n+    void testCollection() throws JsonProcessingException {\n+        TypedVariableResponse response = TypedVariableResponse.from(buildTestCollection());\n+\n+        Assertions.assertEquals(VAR_NAME_COLLECTION, response.getName());\n+        Assertions.assertEquals(TYPE_REF_STRING, response.getTypeRef());\n+        Assertions.assertNotNull(response.getValue());\n+        Assertions.assertNull(response.getComponents());\n+\n+        Assertions.assertTrue(response.getValue().isArray());\n+        Assertions.assertSame(3, response.getValue().size());\n+        Assertions.assertTrue(response.getValue().get(0).isTextual());\n+        Assertions.assertEquals(VALUE_COUNT_ONE, response.getValue().get(0).textValue());\n+        Assertions.assertTrue(response.getValue().get(1).isTextual());\n+        Assertions.assertEquals(VALUE_COUNT_TWO, response.getValue().get(1).textValue());\n+        Assertions.assertTrue(response.getValue().get(2).isTextual());\n+        Assertions.assertEquals(VALUE_COUNT_THREE, response.getValue().get(2).textValue());\n+    }\n+\n+    @Test\n+    void testCollectionOfStructures() throws JsonProcessingException {", "originalCommit": "7b68a0f6f29b150e0e75b7e3b6de1d8411d6e5ad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODU5MTk1Ng==", "url": "https://github.com/kiegroup/kogito-apps/pull/345#discussion_r468591956", "bodyText": "This is something that @danielezonca asked me to do.\nImho we should discuss which approach we want to use once for all when he comes back, so that from that moment we'll be all on the same page.", "author": "kostola", "createdAt": "2020-08-11T13:47:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUzNDQwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODU5NjQzNg==", "url": "https://github.com/kiegroup/kogito-apps/pull/345#discussion_r468596436", "bodyText": "Here is the original comment: #294 (comment)", "author": "kostola", "createdAt": "2020-08-11T13:53:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUzNDQwMw=="}], "type": "inlineReview"}, {"oid": "63791dfa4dbae03ffc20972333080479cd73902b", "url": "https://github.com/kiegroup/kogito-apps/commit/63791dfa4dbae03ffc20972333080479cd73902b", "message": "[KOGITO-2741] Fix TypedVariableResponse and add TypedVariableResponseTest", "committedDate": "2020-08-11T08:16:58Z", "type": "forcePushed"}, {"oid": "0d7f369485d4cdbb4e93e8ea6b05ef8faa30cbf6", "url": "https://github.com/kiegroup/kogito-apps/commit/0d7f369485d4cdbb4e93e8ea6b05ef8faa30cbf6", "message": "[KOGITO-2741] Minor fixes to make trusty-service work with Audit UI", "committedDate": "2020-08-13T14:48:30Z", "type": "forcePushed"}, {"oid": "3b757f57a3b1e7c4ee43f2314fd6fab8a2d3bb21", "url": "https://github.com/kiegroup/kogito-apps/commit/3b757f57a3b1e7c4ee43f2314fd6fab8a2d3bb21", "message": "[KOGITO-2741] Minor fixes to make trusty-service work with Audit UI", "committedDate": "2020-08-17T13:28:27Z", "type": "forcePushed"}, {"oid": "fd93a73c0d94ea69e867ace1dd9dc1adc4e79b07", "url": "https://github.com/kiegroup/kogito-apps/commit/fd93a73c0d94ea69e867ace1dd9dc1adc4e79b07", "message": "[KOGITO-2741] Fix ExecutionHeaderResponse hasSucceeded property name to align with Audit UI", "committedDate": "2020-08-17T16:20:57Z", "type": "forcePushed"}, {"oid": "8849e5cbc8306a299909484cd820ed50d2683c59", "url": "https://github.com/kiegroup/kogito-apps/commit/8849e5cbc8306a299909484cd820ed50d2683c59", "message": "[KOGITO-2741] Enhance TypedVariable", "committedDate": "2020-08-18T07:37:01Z", "type": "commit"}, {"oid": "5a822450ff2ac0bfbf1c6a0553e0dbe1745ade33", "url": "https://github.com/kiegroup/kogito-apps/commit/5a822450ff2ac0bfbf1c6a0553e0dbe1745ade33", "message": "[KOGITO-2741] Improve tests", "committedDate": "2020-08-18T07:37:01Z", "type": "commit"}, {"oid": "ae91b35faac7ecca484b2e52b3e33b651bc2321f", "url": "https://github.com/kiegroup/kogito-apps/commit/ae91b35faac7ecca484b2e52b3e33b651bc2321f", "message": "[KOGITO-2741] Fix TypedVariableResponse and add TypedVariableResponseTest", "committedDate": "2020-08-18T07:37:01Z", "type": "commit"}, {"oid": "7d5b37680ac4a876977340cf42234402d23f7c7e", "url": "https://github.com/kiegroup/kogito-apps/commit/7d5b37680ac4a876977340cf42234402d23f7c7e", "message": "[KOGITO-2741] Minor fixes to make trusty-service work with Audit UI", "committedDate": "2020-08-18T07:37:01Z", "type": "commit"}, {"oid": "22203cfeab6ae19c91dcb8f541a743b37c2da9f3", "url": "https://github.com/kiegroup/kogito-apps/commit/22203cfeab6ae19c91dcb8f541a743b37c2da9f3", "message": "[KOGITO-2741] Small code polish", "committedDate": "2020-08-18T07:37:01Z", "type": "commit"}, {"oid": "ea450b675fb096f9073c2a1ec10247b57ef6a64e", "url": "https://github.com/kiegroup/kogito-apps/commit/ea450b675fb096f9073c2a1ec10247b57ef6a64e", "message": "[KOGITO-2741] Fix ExecutionHeaderResponse hasSucceeded property name to align with Audit UI", "committedDate": "2020-08-18T07:37:01Z", "type": "commit"}, {"oid": "dc01ca04c51da77646d80f56b4c6ddcedf90a29d", "url": "https://github.com/kiegroup/kogito-apps/commit/dc01ca04c51da77646d80f56b4c6ddcedf90a29d", "message": "[KOGITO-2741] Test hasSucceeded field", "committedDate": "2020-08-18T11:37:41Z", "type": "commit"}, {"oid": "dc01ca04c51da77646d80f56b4c6ddcedf90a29d", "url": "https://github.com/kiegroup/kogito-apps/commit/dc01ca04c51da77646d80f56b4c6ddcedf90a29d", "message": "[KOGITO-2741] Test hasSucceeded field", "committedDate": "2020-08-18T11:37:41Z", "type": "forcePushed"}, {"oid": "6db551fc24d342e326bb351d428d706d29b0c177", "url": "https://github.com/kiegroup/kogito-apps/commit/6db551fc24d342e326bb351d428d706d29b0c177", "message": "[KOGITO-2741] Persist execution source URL and return it via API", "committedDate": "2020-08-18T16:53:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ4MzE5MQ==", "url": "https://github.com/kiegroup/kogito-apps/pull/345#discussion_r472483191", "bodyText": "Is this the rest response object?\nDo we need this information in UI side?", "author": "danielezonca", "createdAt": "2020-08-18T20:46:54Z", "path": "trusty/trusty-service/src/main/java/org/kie/kogito/trusty/service/responses/ExecutionHeaderResponse.java", "diffHunk": "@@ -33,11 +33,14 @@\n     @JsonProperty(\"executionId\")\n     private String executionId;\n \n+    @JsonProperty(\"sourceUrl\")\n+    private String sourceUrl;", "originalCommit": "6db551fc24d342e326bb351d428d706d29b0c177", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjc5MzUxOA==", "url": "https://github.com/kiegroup/kogito-apps/pull/345#discussion_r472793518", "bodyText": "Well...I assumed so but I am not sure actually...should I remove it?", "author": "kostola", "createdAt": "2020-08-19T07:16:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ4MzE5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkzMDQ4MA==", "url": "https://github.com/kiegroup/kogito-apps/pull/345#discussion_r472930480", "bodyText": "Removed", "author": "kostola", "createdAt": "2020-08-19T10:34:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ4MzE5MQ=="}], "type": "inlineReview"}, {"oid": "22972f343818d1f7c89cc0d3cbef3d781f8c348c", "url": "https://github.com/kiegroup/kogito-apps/commit/22972f343818d1f7c89cc0d3cbef3d781f8c348c", "message": "[KOGITO-2741] Increase coverage of trusty-service", "committedDate": "2020-08-19T10:22:00Z", "type": "commit"}, {"oid": "5b8251f47787096e9489ad1cb85b39e57f0c8d8b", "url": "https://github.com/kiegroup/kogito-apps/commit/5b8251f47787096e9489ad1cb85b39e57f0c8d8b", "message": "[KOGITO-2741] Remove sourceUrl from ExecutionHeaderResponse", "committedDate": "2020-08-19T10:33:12Z", "type": "commit"}]}