{"pr_number": 1137, "pr_title": "CAM-12763: feat(qa): add daily pipeline scaffold", "pr_createdAt": "2020-11-20T12:27:20Z", "pr_url": "https://github.com/camunda/camunda-bpm-platform/pull/1137", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc3NjI3MQ==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1137#discussion_r527776271", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          runMaven(true, true, true, 'qa/test-db-upgrade/', 'verify -Pupgrade-db,h2')\n          \n          \n            \n                          runMaven(true, false, false, 'qa/test-db-upgrade/', 'verify -Pupgrade-db,h2')", "author": "yanavasileva", "createdAt": "2020-11-20T15:40:58Z", "path": ".ci/daily/Jenkinsfile", "diffHunk": "@@ -0,0 +1,562 @@\n+// https://github.com/camunda/jenkins-global-shared-library\n+@Library('camunda-ci') _\n+\n+String getAgent(String dockerImage = 'gcr.io/ci-30-162810/centos:v0.4.6', Integer cpuLimit = 4){\n+  String mavenForkCount = cpuLimit;\n+  String mavenMemoryLimit = cpuLimit * 2;\n+  \"\"\"\n+metadata:\n+  labels:\n+    agent: ci-cambpm-camunda-cloud-build\n+spec:\n+  nodeSelector:\n+    cloud.google.com/gke-nodepool: agents-n1-standard-32-netssd-preempt\n+  tolerations:\n+  - key: \"agents-n1-standard-32-netssd-preempt\"\n+    operator: \"Exists\"\n+    effect: \"NoSchedule\"\n+  containers:\n+  - name: \"jnlp\"\n+    image: \"${dockerImage}\"\n+    args: ['\\$(JENKINS_SECRET)', '\\$(JENKINS_NAME)']\n+    tty: true\n+    env:\n+    - name: LIMITS_CPU\n+      value: ${mavenForkCount}\n+    - name: TZ\n+      value: Europe/Berlin\n+    resources:\n+      limits:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+      requests:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+    workingDir: \"/home/work\"\n+    volumeMounts:\n+      - mountPath: /home/work\n+        name: workspace-volume\n+  \"\"\"\n+}\n+\n+pipeline {\n+  agent none\n+  options {\n+    buildDiscarder(logRotator(numToKeepStr: '5')) //, artifactNumToKeepStr: '30'\n+  }\n+  triggers {\n+    pollSCM('H H(0-7) * * *')\n+  }\n+  stages {\n+    stage('check-sql-scripts') {\n+      agent {\n+        kubernetes {\n+          yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+        }\n+      }\n+      steps {\n+        sh '.ci/scripts/check-sql-scripts.sh'\n+      }\n+    }\n+    stage('H2 QA tests') {\n+      parallel {\n+        stage('sql-scripts-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true,'distro/sql-script/', 'install -Pcheck-sql,h2')\n+            }\n+          }\n+        }\n+        stage('UPGRADE-databases-from-714-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true, 'qa/test-db-upgrade/', 'verify -Pupgrade-db,h2')", "originalCommit": "8b4f475871ad128a3c155c71c58a891e92a8ebc4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc3Njg5Nw==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1137#discussion_r527776897", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          runMaven(true, true, true, 'qa/test-db-instance-migration/', 'verify -Pinstance-migration,h2')\n          \n          \n            \n                          runMaven(true, false, true, 'qa/test-db-instance-migration/', 'verify -Pinstance-migration,h2')", "author": "yanavasileva", "createdAt": "2020-11-20T15:41:54Z", "path": ".ci/daily/Jenkinsfile", "diffHunk": "@@ -0,0 +1,562 @@\n+// https://github.com/camunda/jenkins-global-shared-library\n+@Library('camunda-ci') _\n+\n+String getAgent(String dockerImage = 'gcr.io/ci-30-162810/centos:v0.4.6', Integer cpuLimit = 4){\n+  String mavenForkCount = cpuLimit;\n+  String mavenMemoryLimit = cpuLimit * 2;\n+  \"\"\"\n+metadata:\n+  labels:\n+    agent: ci-cambpm-camunda-cloud-build\n+spec:\n+  nodeSelector:\n+    cloud.google.com/gke-nodepool: agents-n1-standard-32-netssd-preempt\n+  tolerations:\n+  - key: \"agents-n1-standard-32-netssd-preempt\"\n+    operator: \"Exists\"\n+    effect: \"NoSchedule\"\n+  containers:\n+  - name: \"jnlp\"\n+    image: \"${dockerImage}\"\n+    args: ['\\$(JENKINS_SECRET)', '\\$(JENKINS_NAME)']\n+    tty: true\n+    env:\n+    - name: LIMITS_CPU\n+      value: ${mavenForkCount}\n+    - name: TZ\n+      value: Europe/Berlin\n+    resources:\n+      limits:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+      requests:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+    workingDir: \"/home/work\"\n+    volumeMounts:\n+      - mountPath: /home/work\n+        name: workspace-volume\n+  \"\"\"\n+}\n+\n+pipeline {\n+  agent none\n+  options {\n+    buildDiscarder(logRotator(numToKeepStr: '5')) //, artifactNumToKeepStr: '30'\n+  }\n+  triggers {\n+    pollSCM('H H(0-7) * * *')\n+  }\n+  stages {\n+    stage('check-sql-scripts') {\n+      agent {\n+        kubernetes {\n+          yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+        }\n+      }\n+      steps {\n+        sh '.ci/scripts/check-sql-scripts.sh'\n+      }\n+    }\n+    stage('H2 QA tests') {\n+      parallel {\n+        stage('sql-scripts-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true,'distro/sql-script/', 'install -Pcheck-sql,h2')\n+            }\n+          }\n+        }\n+        stage('UPGRADE-databases-from-714-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true, 'qa/test-db-upgrade/', 'verify -Pupgrade-db,h2')\n+            }\n+          }\n+        }\n+        stage('UPGRADE-instance-migration-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true, 'qa/test-db-instance-migration/', 'verify -Pinstance-migration,h2')", "originalCommit": "8b4f475871ad128a3c155c71c58a891e92a8ebc4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc3Nzk0Nw==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1137#discussion_r527777947", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          runMaven(true, true, true, 'qa/', 'verify -Pold-engine,h2')\n          \n          \n            \n                          runMaven(true, false, false, 'qa/', 'verify -Pold-engine,h2')", "author": "yanavasileva", "createdAt": "2020-11-20T15:43:21Z", "path": ".ci/daily/Jenkinsfile", "diffHunk": "@@ -0,0 +1,562 @@\n+// https://github.com/camunda/jenkins-global-shared-library\n+@Library('camunda-ci') _\n+\n+String getAgent(String dockerImage = 'gcr.io/ci-30-162810/centos:v0.4.6', Integer cpuLimit = 4){\n+  String mavenForkCount = cpuLimit;\n+  String mavenMemoryLimit = cpuLimit * 2;\n+  \"\"\"\n+metadata:\n+  labels:\n+    agent: ci-cambpm-camunda-cloud-build\n+spec:\n+  nodeSelector:\n+    cloud.google.com/gke-nodepool: agents-n1-standard-32-netssd-preempt\n+  tolerations:\n+  - key: \"agents-n1-standard-32-netssd-preempt\"\n+    operator: \"Exists\"\n+    effect: \"NoSchedule\"\n+  containers:\n+  - name: \"jnlp\"\n+    image: \"${dockerImage}\"\n+    args: ['\\$(JENKINS_SECRET)', '\\$(JENKINS_NAME)']\n+    tty: true\n+    env:\n+    - name: LIMITS_CPU\n+      value: ${mavenForkCount}\n+    - name: TZ\n+      value: Europe/Berlin\n+    resources:\n+      limits:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+      requests:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+    workingDir: \"/home/work\"\n+    volumeMounts:\n+      - mountPath: /home/work\n+        name: workspace-volume\n+  \"\"\"\n+}\n+\n+pipeline {\n+  agent none\n+  options {\n+    buildDiscarder(logRotator(numToKeepStr: '5')) //, artifactNumToKeepStr: '30'\n+  }\n+  triggers {\n+    pollSCM('H H(0-7) * * *')\n+  }\n+  stages {\n+    stage('check-sql-scripts') {\n+      agent {\n+        kubernetes {\n+          yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+        }\n+      }\n+      steps {\n+        sh '.ci/scripts/check-sql-scripts.sh'\n+      }\n+    }\n+    stage('H2 QA tests') {\n+      parallel {\n+        stage('sql-scripts-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true,'distro/sql-script/', 'install -Pcheck-sql,h2')\n+            }\n+          }\n+        }\n+        stage('UPGRADE-databases-from-714-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true, 'qa/test-db-upgrade/', 'verify -Pupgrade-db,h2')\n+            }\n+          }\n+        }\n+        stage('UPGRADE-instance-migration-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true, 'qa/test-db-instance-migration/', 'verify -Pinstance-migration,h2')\n+            }\n+          }\n+        }\n+        stage('UPGRADE-old-engine-from-714-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true, 'qa/', 'verify -Pold-engine,h2')", "originalCommit": "8b4f475871ad128a3c155c71c58a891e92a8ebc4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc3ODc5OA==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1137#discussion_r527778798", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          runMaven(true, true, true, 'qa/test-db-rolling-update/', 'verify -Prolling-update,h2')\n          \n          \n            \n                          runMaven(true, false, false, 'qa/test-db-rolling-update/', 'verify -Prolling-update,h2')", "author": "yanavasileva", "createdAt": "2020-11-20T15:44:25Z", "path": ".ci/daily/Jenkinsfile", "diffHunk": "@@ -0,0 +1,562 @@\n+// https://github.com/camunda/jenkins-global-shared-library\n+@Library('camunda-ci') _\n+\n+String getAgent(String dockerImage = 'gcr.io/ci-30-162810/centos:v0.4.6', Integer cpuLimit = 4){\n+  String mavenForkCount = cpuLimit;\n+  String mavenMemoryLimit = cpuLimit * 2;\n+  \"\"\"\n+metadata:\n+  labels:\n+    agent: ci-cambpm-camunda-cloud-build\n+spec:\n+  nodeSelector:\n+    cloud.google.com/gke-nodepool: agents-n1-standard-32-netssd-preempt\n+  tolerations:\n+  - key: \"agents-n1-standard-32-netssd-preempt\"\n+    operator: \"Exists\"\n+    effect: \"NoSchedule\"\n+  containers:\n+  - name: \"jnlp\"\n+    image: \"${dockerImage}\"\n+    args: ['\\$(JENKINS_SECRET)', '\\$(JENKINS_NAME)']\n+    tty: true\n+    env:\n+    - name: LIMITS_CPU\n+      value: ${mavenForkCount}\n+    - name: TZ\n+      value: Europe/Berlin\n+    resources:\n+      limits:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+      requests:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+    workingDir: \"/home/work\"\n+    volumeMounts:\n+      - mountPath: /home/work\n+        name: workspace-volume\n+  \"\"\"\n+}\n+\n+pipeline {\n+  agent none\n+  options {\n+    buildDiscarder(logRotator(numToKeepStr: '5')) //, artifactNumToKeepStr: '30'\n+  }\n+  triggers {\n+    pollSCM('H H(0-7) * * *')\n+  }\n+  stages {\n+    stage('check-sql-scripts') {\n+      agent {\n+        kubernetes {\n+          yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+        }\n+      }\n+      steps {\n+        sh '.ci/scripts/check-sql-scripts.sh'\n+      }\n+    }\n+    stage('H2 QA tests') {\n+      parallel {\n+        stage('sql-scripts-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true,'distro/sql-script/', 'install -Pcheck-sql,h2')\n+            }\n+          }\n+        }\n+        stage('UPGRADE-databases-from-714-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true, 'qa/test-db-upgrade/', 'verify -Pupgrade-db,h2')\n+            }\n+          }\n+        }\n+        stage('UPGRADE-instance-migration-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true, 'qa/test-db-instance-migration/', 'verify -Pinstance-migration,h2')\n+            }\n+          }\n+        }\n+        stage('UPGRADE-old-engine-from-714-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true, 'qa/', 'verify -Pold-engine,h2')\n+            }\n+          }\n+        }\n+        stage('UPGRADE-rolling-update-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true, 'qa/test-db-rolling-update/', 'verify -Prolling-update,h2')", "originalCommit": "8b4f475871ad128a3c155c71c58a891e92a8ebc4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc4NDUzOQ==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1137#discussion_r527784539", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          runMaven(true, true, true, 'qa/large-data-tests/', 'verify -Plarge-data-tests,h2')\n          \n          \n            \n                          runMaven(true, false, false, 'qa/large-data-tests/', 'verify -Plarge-data-tests,h2')", "author": "yanavasileva", "createdAt": "2020-11-20T15:52:38Z", "path": ".ci/daily/Jenkinsfile", "diffHunk": "@@ -0,0 +1,562 @@\n+// https://github.com/camunda/jenkins-global-shared-library\n+@Library('camunda-ci') _\n+\n+String getAgent(String dockerImage = 'gcr.io/ci-30-162810/centos:v0.4.6', Integer cpuLimit = 4){\n+  String mavenForkCount = cpuLimit;\n+  String mavenMemoryLimit = cpuLimit * 2;\n+  \"\"\"\n+metadata:\n+  labels:\n+    agent: ci-cambpm-camunda-cloud-build\n+spec:\n+  nodeSelector:\n+    cloud.google.com/gke-nodepool: agents-n1-standard-32-netssd-preempt\n+  tolerations:\n+  - key: \"agents-n1-standard-32-netssd-preempt\"\n+    operator: \"Exists\"\n+    effect: \"NoSchedule\"\n+  containers:\n+  - name: \"jnlp\"\n+    image: \"${dockerImage}\"\n+    args: ['\\$(JENKINS_SECRET)', '\\$(JENKINS_NAME)']\n+    tty: true\n+    env:\n+    - name: LIMITS_CPU\n+      value: ${mavenForkCount}\n+    - name: TZ\n+      value: Europe/Berlin\n+    resources:\n+      limits:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+      requests:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+    workingDir: \"/home/work\"\n+    volumeMounts:\n+      - mountPath: /home/work\n+        name: workspace-volume\n+  \"\"\"\n+}\n+\n+pipeline {\n+  agent none\n+  options {\n+    buildDiscarder(logRotator(numToKeepStr: '5')) //, artifactNumToKeepStr: '30'\n+  }\n+  triggers {\n+    pollSCM('H H(0-7) * * *')\n+  }\n+  stages {\n+    stage('check-sql-scripts') {\n+      agent {\n+        kubernetes {\n+          yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+        }\n+      }\n+      steps {\n+        sh '.ci/scripts/check-sql-scripts.sh'\n+      }\n+    }\n+    stage('H2 QA tests') {\n+      parallel {\n+        stage('sql-scripts-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true,'distro/sql-script/', 'install -Pcheck-sql,h2')\n+            }\n+          }\n+        }\n+        stage('UPGRADE-databases-from-714-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true, 'qa/test-db-upgrade/', 'verify -Pupgrade-db,h2')\n+            }\n+          }\n+        }\n+        stage('UPGRADE-instance-migration-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true, 'qa/test-db-instance-migration/', 'verify -Pinstance-migration,h2')\n+            }\n+          }\n+        }\n+        stage('UPGRADE-old-engine-from-714-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true, 'qa/', 'verify -Pold-engine,h2')\n+            }\n+          }\n+        }\n+        stage('UPGRADE-rolling-update-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true, 'qa/test-db-rolling-update/', 'verify -Prolling-update,h2')\n+            }\n+          }\n+        }\n+        stage('PERFORMANCE-large-data-h2') {\n+          agent {\n+            kubernetes {\n+              yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+            }\n+          }\n+//          when {\n+//            anyOf {\n+//              branch 'pipeline-qa-master';\n+//              allOf {\n+//                changeRequest();\n+//                expression {\n+//                  withLabels('h2')\n+//                }\n+//              }\n+//            }\n+//          }\n+          steps {\n+            withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'maven-nexus-settings') {\n+              runMaven(true, true, true, 'qa/large-data-tests/', 'verify -Plarge-data-tests,h2')", "originalCommit": "8b4f475871ad128a3c155c71c58a891e92a8ebc4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "82975289503e056429a2e3c3a1d8b62d142ca0ae", "url": "https://github.com/camunda/camunda-bpm-platform/commit/82975289503e056429a2e3c3a1d8b62d142ca0ae", "message": "feat(qa): add daily pipeline scaffold\n\n* Add trigger for pipeline - once a day on SCM change;\n* Add check-sql-scripts stage;\n* Add shell script for check-sql-scripts stage;\n* Add H2 QA stages;\n* Define matrix stages;\n* Define structure of DB matrix stages;\n* Define JDK matrix stages;\n* [TMP] Disable `when` block, so that stages are always executed;\n* [TMP] Disable `post` blocks for non-maven stages;\n* [TMP] Disable non-H2 DB stages, so we get a successfull view of the pipeline;\n* [TMP] Disable stashing/unstashing of artifacts, we want to obtain a successful execution first.\n\nRelated to CAM-12712, CAM-12763", "committedDate": "2020-11-23T12:54:49Z", "type": "commit"}, {"oid": "82975289503e056429a2e3c3a1d8b62d142ca0ae", "url": "https://github.com/camunda/camunda-bpm-platform/commit/82975289503e056429a2e3c3a1d8b62d142ca0ae", "message": "feat(qa): add daily pipeline scaffold\n\n* Add trigger for pipeline - once a day on SCM change;\n* Add check-sql-scripts stage;\n* Add shell script for check-sql-scripts stage;\n* Add H2 QA stages;\n* Define matrix stages;\n* Define structure of DB matrix stages;\n* Define JDK matrix stages;\n* [TMP] Disable `when` block, so that stages are always executed;\n* [TMP] Disable `post` blocks for non-maven stages;\n* [TMP] Disable non-H2 DB stages, so we get a successfull view of the pipeline;\n* [TMP] Disable stashing/unstashing of artifacts, we want to obtain a successful execution first.\n\nRelated to CAM-12712, CAM-12763", "committedDate": "2020-11-23T12:54:49Z", "type": "forcePushed"}, {"oid": "c48dfc845a82adfbe7625c03729d19351b27b6f5", "url": "https://github.com/camunda/camunda-bpm-platform/commit/c48dfc845a82adfbe7625c03729d19351b27b6f5", "message": "Update .ci/daily/Jenkinsfile\n\nCo-authored-by: yanavasileva <yanavasileva@users.noreply.github.com>", "committedDate": "2020-11-23T12:59:21Z", "type": "commit"}, {"oid": "46a35490e1a2071189624b2c95a48fc4fa132d8b", "url": "https://github.com/camunda/camunda-bpm-platform/commit/46a35490e1a2071189624b2c95a48fc4fa132d8b", "message": "Update .ci/daily/Jenkinsfile\n\nCo-authored-by: yanavasileva <yanavasileva@users.noreply.github.com>", "committedDate": "2020-11-23T12:59:55Z", "type": "commit"}, {"oid": "4a8b561c076bf62adc0e8027340aec082433ec1a", "url": "https://github.com/camunda/camunda-bpm-platform/commit/4a8b561c076bf62adc0e8027340aec082433ec1a", "message": "Update .ci/daily/Jenkinsfile\n\nCo-authored-by: yanavasileva <yanavasileva@users.noreply.github.com>", "committedDate": "2020-11-23T13:00:02Z", "type": "commit"}, {"oid": "aa90ac2278d1f98f2371c88a54a000b27c9d0b7d", "url": "https://github.com/camunda/camunda-bpm-platform/commit/aa90ac2278d1f98f2371c88a54a000b27c9d0b7d", "message": "Update .ci/daily/Jenkinsfile\n\nCo-authored-by: yanavasileva <yanavasileva@users.noreply.github.com>", "committedDate": "2020-11-23T13:00:08Z", "type": "commit"}, {"oid": "0f422ed6ab1ab7beb49cd69906ca5c8f2b69b65a", "url": "https://github.com/camunda/camunda-bpm-platform/commit/0f422ed6ab1ab7beb49cd69906ca5c8f2b69b65a", "message": "Update .ci/daily/Jenkinsfile\n\nCo-authored-by: yanavasileva <yanavasileva@users.noreply.github.com>", "committedDate": "2020-11-23T13:00:14Z", "type": "commit"}]}