{"pr_number": 1193, "pr_title": "feat(engine): config flag to skip output mappings on canceled activities", "pr_createdAt": "2020-12-14T10:49:16Z", "pr_url": "https://github.com/camunda/camunda-bpm-platform/pull/1193", "timeline": [{"oid": "c2da24057cd8fa794f71579480f1ea5455fb562f", "url": "https://github.com/camunda/camunda-bpm-platform/commit/c2da24057cd8fa794f71579480f1ea5455fb562f", "message": "feat(engine): config flag to skip output mappings on canceled activities\n\nRelated to CAM-12894", "committedDate": "2020-12-14T12:28:21Z", "type": "commit"}, {"oid": "c2da24057cd8fa794f71579480f1ea5455fb562f", "url": "https://github.com/camunda/camunda-bpm-platform/commit/c2da24057cd8fa794f71579480f1ea5455fb562f", "message": "feat(engine): config flag to skip output mappings on canceled activities\n\nRelated to CAM-12894", "committedDate": "2020-12-14T12:28:21Z", "type": "forcePushed"}, {"oid": "0f5dec4fdfe84400aba47ea2f8b70d18b16319ec", "url": "https://github.com/camunda/camunda-bpm-platform/commit/0f5dec4fdfe84400aba47ea2f8b70d18b16319ec", "message": "trigger ci", "committedDate": "2020-12-14T14:37:37Z", "type": "commit"}, {"oid": "38339a41aa03e53faffeea84b036057afbb2e21a", "url": "https://github.com/camunda/camunda-bpm-platform/commit/38339a41aa03e53faffeea84b036057afbb2e21a", "message": "chore(engine): reset config flag after test", "committedDate": "2020-12-15T08:53:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDU1ODk1Mg==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1193#discussion_r544558952", "bodyText": "It took quite a while for me to understand which elements we are trying to get to here specifically.\nWhat do you think about adding a little one-line explanation here to state which executions this is meant for?\nAlso, how confident are we that we do not include any unwanted executions with this as well? I have to admit that getting a good grip on which executions this might unwantedly include is quite tough. From a gut feeling, I would say this could also include other activity types, e.g. user tasks with boundary events?\nDo you think it makes sense to add some test cases for other activity types to ensure they are not affected by this? Or, if we already know there will be others affected by this, add test cases for them as well of course?", "author": "tmetzke", "createdAt": "2020-12-16T19:19:16Z", "path": "engine/src/main/java/org/camunda/bpm/engine/impl/pvm/runtime/operation/PvmAtomicOperationDeleteCascadeFireActivityEnd.java", "diffHunk": "@@ -71,6 +72,9 @@ protected void eventNotificationsCompleted(PvmExecutionImpl execution) {\n \n     } else {\n       if (execution.isScope()) {\n+        if(execution instanceof ExecutionEntity && !execution.isProcessInstanceExecution() && execution.isCanceled()) {\n+          execution.setSkipIoMappings(execution.isSkipIoMappings() || execution.getProcessEngine().getProcessEngineConfiguration().isSkipOutputMappingOnCanceledTasks());\n+        }", "originalCommit": "38339a41aa03e53faffeea84b036057afbb2e21a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcwMDMyMA==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1193#discussion_r545700320", "bodyText": "As discussed I simplified the condition and made sure only external tasks are included. Will discuss this decision next year. Let's put this on hold for now.", "author": "mboskamp", "createdAt": "2020-12-18T09:22:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDU1ODk1Mg=="}], "type": "inlineReview"}, {"oid": "5c1b5b462170fc0379ed33d49d8271527ccd63bf", "url": "https://github.com/camunda/camunda-bpm-platform/commit/5c1b5b462170fc0379ed33d49d8271527ccd63bf", "message": "chore(engine): only include externalTasks", "committedDate": "2020-12-18T09:19:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcwNjIyMA==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1193#discussion_r545706220", "bodyText": "I know it's a micro-optimization \ud83d\ude01, but the execution.isCanceled() is quite cheap and probably very selective (doesn't occur that often) - putting it first, we don't have to check the activity type in most cases I would imagine?\nFeel free to ignore it, it just caught my eye \ud83d\ude03", "author": "tmetzke", "createdAt": "2020-12-18T09:28:00Z", "path": "engine/src/main/java/org/camunda/bpm/engine/impl/pvm/runtime/operation/PvmAtomicOperationDeleteCascadeFireActivityEnd.java", "diffHunk": "@@ -72,7 +72,8 @@ protected void eventNotificationsCompleted(PvmExecutionImpl execution) {\n \n     } else {\n       if (execution.isScope()) {\n-        if(execution instanceof ExecutionEntity && !execution.isProcessInstanceExecution() && execution.isCanceled()) {\n+        if(isOutputMappingSkippableForActivity(activity) && execution.isCanceled()) {", "originalCommit": "5c1b5b462170fc0379ed33d49d8271527ccd63bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcwNzcwNg==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1193#discussion_r545707706", "bodyText": "Sure let's do it :)", "author": "mboskamp", "createdAt": "2020-12-18T09:29:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcwNjIyMA=="}], "type": "inlineReview"}, {"oid": "f4f054b96c5ddfd2b9c0cc38d0d330e23ec64489", "url": "https://github.com/camunda/camunda-bpm-platform/commit/f4f054b96c5ddfd2b9c0cc38d0d330e23ec64489", "message": "chore(engine): swap conditions", "committedDate": "2020-12-18T09:32:02Z", "type": "commit"}, {"oid": "9392d3ffcdf6840b87cf3b7ed47824ab709adaf6", "url": "https://github.com/camunda/camunda-bpm-platform/commit/9392d3ffcdf6840b87cf3b7ed47824ab709adaf6", "message": "chore(engine): extend for all activity types\n\n* move test in dedicated class\n* add test including a subprocess\n* rename config property", "committedDate": "2021-01-04T14:11:21Z", "type": "commit"}, {"oid": "e2c4f7964b3d3e31ddb2da1dfebafe76aab7d73e", "url": "https://github.com/camunda/camunda-bpm-platform/commit/e2c4f7964b3d3e31ddb2da1dfebafe76aab7d73e", "message": "trigger CI", "committedDate": "2021-01-05T07:08:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTgxNTI0OQ==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1193#discussion_r551815249", "bodyText": "I think this will not be necessary anymore as the tests have been moved. \ud83d\ude03", "author": "tmetzke", "createdAt": "2021-01-05T09:33:04Z", "path": "engine/src/test/java/org/camunda/bpm/engine/test/api/externaltask/ExternalTaskServiceTest.java", "diffHunk": "@@ -103,6 +103,7 @@ public void setUp() throws Exception {\n   @After\n   public void tearDown() throws Exception {\n     ClockUtil.reset();\n+    processEngineConfiguration.setSkipOutputMappingOnCanceledActivities(false);", "originalCommit": "e2c4f7964b3d3e31ddb2da1dfebafe76aab7d73e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTgxNzQ0Mg==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1193#discussion_r551817442", "bodyText": "damn it! :D", "author": "mboskamp", "createdAt": "2021-01-05T09:36:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTgxNTI0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTgyMDA5Ng==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1193#discussion_r551820096", "bodyText": "I left the other changes to the test class although they are not related to the ticket.", "author": "mboskamp", "createdAt": "2021-01-05T09:42:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTgxNTI0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTgyMTk5Mg==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1193#discussion_r551821992", "bodyText": "Yeah, that is absolutely fine, improving test classes is always nice \ud83d\udc4d", "author": "tmetzke", "createdAt": "2021-01-05T09:45:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTgxNTI0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTgxODE4OA==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1193#discussion_r551818188", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                processEngineConfiguration.setSkipOutputMappingOnCanceledActivities(false);", "author": "mboskamp", "createdAt": "2021-01-05T09:38:22Z", "path": "engine/src/test/java/org/camunda/bpm/engine/test/api/externaltask/ExternalTaskServiceTest.java", "diffHunk": "@@ -103,6 +103,7 @@ public void setUp() throws Exception {\n   @After\n   public void tearDown() throws Exception {\n     ClockUtil.reset();\n+    processEngineConfiguration.setSkipOutputMappingOnCanceledActivities(false);", "originalCommit": "e2c4f7964b3d3e31ddb2da1dfebafe76aab7d73e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "02abf0ee44321e70617019febf290a2b91a0c919", "url": "https://github.com/camunda/camunda-bpm-platform/commit/02abf0ee44321e70617019febf290a2b91a0c919", "message": "Update engine/src/test/java/org/camunda/bpm/engine/test/api/externaltask/ExternalTaskServiceTest.java", "committedDate": "2021-01-05T09:39:28Z", "type": "commit"}]}