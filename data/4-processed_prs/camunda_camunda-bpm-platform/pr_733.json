{"pr_number": 733, "pr_title": "CAM-11550: feat(open-api): add task comment endpoints", "pr_createdAt": "2020-03-17T13:27:22Z", "pr_url": "https://github.com/camunda/camunda-bpm-platform/pull/733", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMzMDY4NA==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/733#discussion_r394330684", "bodyText": "We should document that only the message property is respected and other properties from the DTO are ignored.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  dto = \"CommentDto\"\n          \n          \n            \n                  dto = \"CommentDto\"\n          \n          \n            \n                  requestDesc = \"**Note:** Only the `message` property will be used. Every other property passed to this endpoint will be ignored.\"", "author": "mboskamp", "createdAt": "2020-03-18T13:05:59Z", "path": "engine-rest/engine-rest-openapi/src/main/templates/paths/task/{id}/comment/create/post.ftl", "diffHunk": "@@ -0,0 +1,72 @@\n+{\n+\n+  <@lib.endpointInfo\n+      id = \"createComment\"\n+      tag = \"Comment\"\n+      desc = \"Creates a comment for a task by id.\" />\n+\n+  \"parameters\" : [\n+\n+    <@lib.parameter\n+        name = \"id\"\n+        location = \"path\"\n+        type = \"string\"\n+        required = true\n+        last = true\n+        desc = \"The id of the task to add the comment to.\" />\n+\n+  ],\n+\n+  <@lib.requestBody\n+      mediaType = \"application/json\"\n+      dto = \"CommentDto\"", "originalCommit": "ee3bcf011bd4445462d3a6ac5537ea8f3fb3c0f9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMzMzA2OQ==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/733#discussion_r394333069", "bodyText": "This property should be inherited from LinkableDto to reflect the implementation structure.", "author": "mboskamp", "createdAt": "2020-03-18T13:09:54Z", "path": "engine-rest/engine-rest-openapi/src/main/templates/models/org/camunda/bpm/engine/rest/dto/runtime/task/CommentDto.ftl", "diffHunk": "@@ -0,0 +1,53 @@\n+{\n+  \"type\": \"object\",\n+  \"properties\": {\n+\n+    <@lib.property\n+        name = \"id\"\n+        type = \"string\"\n+        desc = \"The id of the task comment.\" />\n+\n+    <@lib.property\n+        name = \"userId\"\n+        type = \"string\"\n+        desc = \"The id of the user who created the comment.\" />\n+\n+    <@lib.property\n+        name = \"taskId\"\n+        type = \"string\"\n+        desc = \"The id of the task to which the comment belongs.\" />\n+\n+    <@lib.property\n+        name = \"time\"\n+        type = \"string\"\n+        format = \"date-time\"\n+        desc = \"The time when the comment was created.\" />\n+\n+    <@lib.property\n+        name = \"message\"\n+        type = \"string\"\n+        desc = \"The content of the comment.\" />\n+\n+    <@lib.property\n+        name = \"removalTime\"\n+        type = \"string\"\n+        format = \"date-time\"\n+        desc = \"The time after which the comment should be removed by the History Cleanup job.\n+                [Default format]($(docsUrl)/reference/rest/overview/date-format/)\n+                `yyyy-MM-dd'T'HH:mm:ss.SSSZ`.\" />\n+\n+    <@lib.property\n+        name = \"rootProcessInstanceId\"\n+        type = \"string\"\n+        desc = \"The process instance id of the root process instance that initiated the process\n+                containing the task.\" />\n+\n+    <@lib.property\n+        name = \"links\"\n+        type = \"array\"\n+        dto = \"AtomLink\"\n+        last = true\n+        desc = \"Link to the newly created task comment with `method`, `href` and `rel`.\" />\n+\n+  }", "originalCommit": "ee3bcf011bd4445462d3a6ac5537ea8f3fb3c0f9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTAxOTYxMA==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/733#discussion_r395019610", "bodyText": "I added a FTL template in lib/commons for the LinkableDto since the class is abstract and any properties it defines will be included only in child classes. I made the description of the links property more uniform, with the only dynamic part being the type of resource(task comment, deployment or process instace, which are the child classes).", "author": "koevskinikola", "createdAt": "2020-03-19T13:22:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMzMzA2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTUzNDkxMg==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/733#discussion_r395534912", "bodyText": "@mboskamp I changed the implementation so that it uses allOf. To do this, I added an extra attribute to the dto macro called extends. This way we don't have to mix JSON and FTL syntax in Dto.ftl files.\nThe \"extended\" DTO is referenced at the end of the definition so that its properties are last when seen in the Swagger UI.", "author": "koevskinikola", "createdAt": "2020-03-20T09:58:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMzMzA2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMzODM4MA==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/733#discussion_r394338380", "bodyText": "Do we need to use ${docsUrl} here in order to resolve the version in the URL?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            [Introduction](/reference/rest/overview/#error-handling)\n          \n          \n            \n                            [Introduction](${docsUrl}/reference/rest/overview/#error-handling)", "author": "mboskamp", "createdAt": "2020-03-18T13:18:31Z", "path": "engine-rest/engine-rest-openapi/src/main/templates/paths/task/{id}/comment/create/post.ftl", "diffHunk": "@@ -0,0 +1,72 @@\n+{\n+\n+  <@lib.endpointInfo\n+      id = \"createComment\"\n+      tag = \"Comment\"\n+      desc = \"Creates a comment for a task by id.\" />\n+\n+  \"parameters\" : [\n+\n+    <@lib.parameter\n+        name = \"id\"\n+        location = \"path\"\n+        type = \"string\"\n+        required = true\n+        last = true\n+        desc = \"The id of the task to add the comment to.\" />\n+\n+  ],\n+\n+  <@lib.requestBody\n+      mediaType = \"application/json\"\n+      dto = \"CommentDto\"\n+      examples = ['\"example-1\": {\n+                       \"summary\": \"POST /task/aTaskId/comment/create\",\n+                       \"value\": {\n+                         \"message\": \"a task comment\"\n+                       }\n+                     }'] />\n+\n+  \"responses\" : {\n+\n+    <@lib.response\n+        code = \"200\"\n+        dto = \"CommentDto\"\n+        desc = \"Request successful.\"\n+        examples = ['\"example-1\": {\n+                       \"summary\": \"Status 200 Response\",\n+                       \"value\": {\n+                         \"links\": [\n+                           {\n+                             \"method\": \"GET\",\n+                             \"href\": \"http://localhost:38080/rest-test/task/aTaskId/comment/aTaskCommentId\",\n+                             \"rel\": \"self\"\n+                           }\n+                         ],\n+                         \"id\": \"aTaskCommentId\",\n+                         \"userId\": \"userId\",\n+                         \"taskId\": \"aTaskId\",\n+                         \"time\": \"2013-01-02T21:37:03.887+0200\",\n+                         \"message\": \"comment message\",\n+                         \"removalTime\": \"2018-02-10T14:33:19.000+0200\",\n+                         \"rootProcessInstanceId\": \"aRootProcessInstanceId\"\n+                       }\n+                     }'] />\n+\n+    <@lib.response\n+        code = \"400\"\n+        dto = \"ExceptionDto\"\n+        desc = \"The task does not exist or no comment message was submitted. See the\n+                [Introduction](/reference/rest/overview/#error-handling)", "originalCommit": "ee3bcf011bd4445462d3a6ac5537ea8f3fb3c0f9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDg3NjkxOQ==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/733#discussion_r394876919", "bodyText": "Yes! Good catch, I completely missed it in a lot of places.", "author": "koevskinikola", "createdAt": "2020-03-19T09:02:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMzODM4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM0MTMwNg==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/733#discussion_r394341306", "bodyText": "Same as above.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            [Introduction](/reference/rest/overview/#error-handling)\n          \n          \n            \n                            [Introduction](${docsUrl}/reference/rest/overview/#error-handling)", "author": "mboskamp", "createdAt": "2020-03-18T13:23:00Z", "path": "engine-rest/engine-rest-openapi/src/main/templates/paths/task/{id}/comment/create/post.ftl", "diffHunk": "@@ -0,0 +1,72 @@\n+{\n+\n+  <@lib.endpointInfo\n+      id = \"createComment\"\n+      tag = \"Comment\"\n+      desc = \"Creates a comment for a task by id.\" />\n+\n+  \"parameters\" : [\n+\n+    <@lib.parameter\n+        name = \"id\"\n+        location = \"path\"\n+        type = \"string\"\n+        required = true\n+        last = true\n+        desc = \"The id of the task to add the comment to.\" />\n+\n+  ],\n+\n+  <@lib.requestBody\n+      mediaType = \"application/json\"\n+      dto = \"CommentDto\"\n+      examples = ['\"example-1\": {\n+                       \"summary\": \"POST /task/aTaskId/comment/create\",\n+                       \"value\": {\n+                         \"message\": \"a task comment\"\n+                       }\n+                     }'] />\n+\n+  \"responses\" : {\n+\n+    <@lib.response\n+        code = \"200\"\n+        dto = \"CommentDto\"\n+        desc = \"Request successful.\"\n+        examples = ['\"example-1\": {\n+                       \"summary\": \"Status 200 Response\",\n+                       \"value\": {\n+                         \"links\": [\n+                           {\n+                             \"method\": \"GET\",\n+                             \"href\": \"http://localhost:38080/rest-test/task/aTaskId/comment/aTaskCommentId\",\n+                             \"rel\": \"self\"\n+                           }\n+                         ],\n+                         \"id\": \"aTaskCommentId\",\n+                         \"userId\": \"userId\",\n+                         \"taskId\": \"aTaskId\",\n+                         \"time\": \"2013-01-02T21:37:03.887+0200\",\n+                         \"message\": \"comment message\",\n+                         \"removalTime\": \"2018-02-10T14:33:19.000+0200\",\n+                         \"rootProcessInstanceId\": \"aRootProcessInstanceId\"\n+                       }\n+                     }'] />\n+\n+    <@lib.response\n+        code = \"400\"\n+        dto = \"ExceptionDto\"\n+        desc = \"The task does not exist or no comment message was submitted. See the\n+                [Introduction](/reference/rest/overview/#error-handling)\n+                for the error response format.\" />\n+\n+    <@lib.response\n+        code = \"403\"\n+        dto = \"ExceptionDto\"\n+        last = true\n+        desc = \"The history of the engine is disabled. See the\n+                [Introduction](/reference/rest/overview/#error-handling)", "originalCommit": "ee3bcf011bd4445462d3a6ac5537ea8f3fb3c0f9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM2NTAxMg==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/733#discussion_r394365012", "bodyText": "Same as above.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            [Introduction](/reference/rest/overview/#error-handling)\n          \n          \n            \n                            [Introduction](${docsUrl}/reference/rest/overview/#error-handling)", "author": "mboskamp", "createdAt": "2020-03-18T13:57:33Z", "path": "engine-rest/engine-rest-openapi/src/main/templates/paths/task/{id}/comment/get.ftl", "diffHunk": "@@ -0,0 +1,70 @@\n+{\n+\n+  <@lib.endpointInfo\n+      id = \"getComments\"\n+      tag = \"Comment\"\n+      desc = \"Gets the comments for a task by id.\" />\n+\n+  \"parameters\" : [\n+\n+    <@lib.parameter\n+        name = \"id\"\n+        location = \"path\"\n+        type = \"string\"\n+        required = true\n+        last = true\n+        desc = \"The id of the task to retrieve the comments for.\" />\n+\n+  ],\n+\n+  \"responses\" : {\n+\n+    <@lib.response\n+        code = \"200\"\n+        dto = \"CommentDto\"\n+        array = true\n+        desc = \"Request successful.\"\n+        examples = ['\"example-1\": {\n+                       \"summary\": \"GET /task/aTaskId/comment\",\n+                       \"value\": [\n+                         {\n+                           \"id\": \"commentId\",\n+                           \"userId\": \"userId\",\n+                           \"taskId\": \"aTaskId\",\n+                           \"time\": \"2013-01-02T21:37:03.764+0200\",\n+                           \"message\": \"message\",\n+                           \"removalTime\": \"2018-02-10T14:33:19.000+0200\",\n+                           \"rootProcessInstanceId\": \"aRootProcessInstanceId\"\n+                         },\n+                         {\n+                           \"id\": \"anotherCommentId\",\n+                           \"userId\": \"anotherUserId\",\n+                           \"taskId\": \"aTaskId\",\n+                           \"time\": \"2013-02-23T20:37:43.975+0200\",\n+                           \"message\": \"anotherMessage\",\n+                           \"removalTime\": \"2018-02-10T14:33:19.000+0200\",\n+                           \"rootProcessInstanceId\": \"aRootProcessInstanceId\"\n+                         },\n+                         {\n+                           \"id\": \"yetAnotherCommentId\",\n+                           \"userId\": \"yetAnotherUserId\",\n+                           \"taskId\": \"aTaskId\",\n+                           \"time\": \"2013-04-21T10:15:23.764+0200\",\n+                           \"message\": \"yetAnotherMessage\",\n+                           \"removalTime\": \"2018-02-10T14:33:19.000+0200\",\n+                           \"rootProcessInstanceId\": \"aRootProcessInstanceId\"\n+                         }\n+                       ]\n+                     }'\n+        ] />\n+\n+    <@lib.response\n+        code = \"404\"\n+        dto = \"ExceptionDto\"\n+        last = true\n+        desc = \"No task exists for the given task id. See the\n+                [Introduction](/reference/rest/overview/#error-handling)", "originalCommit": "ee3bcf011bd4445462d3a6ac5537ea8f3fb3c0f9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM2NjIyNw==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/733#discussion_r394366227", "bodyText": "Same as above.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            [Introduction](/reference/rest/overview/#error-handling)\n          \n          \n            \n                            [Introduction](${docsUrl}/reference/rest/overview/#error-handling)", "author": "mboskamp", "createdAt": "2020-03-18T13:59:12Z", "path": "engine-rest/engine-rest-openapi/src/main/templates/paths/task/{id}/comment/{commentId}/get.ftl", "diffHunk": "@@ -0,0 +1,57 @@\n+{\n+\n+  <@lib.endpointInfo\n+      id = \"getComment\"\n+      tag = \"Comment\"\n+      desc = \"Retrieves a task comment by task id and comment id.\" />\n+\n+  \"parameters\" : [\n+\n+    <@lib.parameter\n+        name = \"id\"\n+        location = \"path\"\n+        type = \"string\"\n+        required = true\n+        desc = \"The id of the task.\" />\n+\n+    <@lib.parameter\n+        name = \"commentId\"\n+        location = \"path\"\n+        type = \"string\"\n+        required = true\n+        last = true\n+        desc = \"The id of the comment to be retrieved.\" />\n+\n+  ],\n+\n+  \"responses\" : {\n+\n+    <@lib.response\n+        code = \"200\"\n+        dto = \"CommentDto\"\n+        desc = \"Request successful.\"\n+        examples = ['\"example-1\": {\n+                       \"summary\": \"GET /task/aTaskId/comment\",\n+                       \"value\": {\n+                         \"id\": \"aTaskCommentId\",\n+                         \"userId\": \"userId\",\n+                         \"taskId\": \"aTaskId\",\n+                         \"time\": \"2013-01-02T21:37:03.664+0200\",\n+                         \"message\": \"comment content\",\n+                         \"removalTime\": \"2018-02-10T14:33:19.000+0200\",\n+                         \"rootProcessInstanceId\": \"aRootProcessInstanceId\"\n+                       }\n+                     }'\n+        ] />\n+\n+    <@lib.response\n+        code = \"404\"\n+        dto = \"ExceptionDto\"\n+        last = true\n+        desc = \"The task or comment with given task and comment id does not exist, or the history of\n+                the engine is disabled. See the\n+                [Introduction](/reference/rest/overview/#error-handling)", "originalCommit": "ee3bcf011bd4445462d3a6ac5537ea8f3fb3c0f9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e008d7289e0018f48b7ac74c9f9a39522b883565", "url": "https://github.com/camunda/camunda-bpm-platform/commit/e008d7289e0018f48b7ac74c9f9a39522b883565", "message": "feat(open-api): add task comment endpoints\n\nRelated to CAM-11550", "committedDate": "2020-03-19T13:10:39Z", "type": "commit"}, {"oid": "cc2283b60c8fc81aa14b503f96d51f6c5012ae0c", "url": "https://github.com/camunda/camunda-bpm-platform/commit/cc2283b60c8fc81aa14b503f96d51f6c5012ae0c", "message": "SQUASH ME: add new files", "committedDate": "2020-03-19T13:10:39Z", "type": "commit"}, {"oid": "289ecee8e1aee2ac91632256c8328356a26d26ae", "url": "https://github.com/camunda/camunda-bpm-platform/commit/289ecee8e1aee2ac91632256c8328356a26d26ae", "message": "SQUASH ME: update description\n\nCo-Authored-By: Miklas Boskamp <miklas.boskamp@camunda.com>", "committedDate": "2020-03-19T13:10:40Z", "type": "commit"}, {"oid": "07c56eef7c054b467d00c7baf1f78e151157b854", "url": "https://github.com/camunda/camunda-bpm-platform/commit/07c56eef7c054b467d00c7baf1f78e151157b854", "message": "SQUASH ME: fix link\n\nCo-Authored-By: Miklas Boskamp <miklas.boskamp@camunda.com>", "committedDate": "2020-03-19T13:10:40Z", "type": "commit"}, {"oid": "92513990ccef32e5ddd5b7eadd6cf609a18d1c46", "url": "https://github.com/camunda/camunda-bpm-platform/commit/92513990ccef32e5ddd5b7eadd6cf609a18d1c46", "message": "SQUASH ME: fix link\n\nCo-Authored-By: Miklas Boskamp <miklas.boskamp@camunda.com>", "committedDate": "2020-03-19T13:10:40Z", "type": "commit"}, {"oid": "37bbc184781b56e839a24b0392c7d61d9f17a7de", "url": "https://github.com/camunda/camunda-bpm-platform/commit/37bbc184781b56e839a24b0392c7d61d9f17a7de", "message": "SQUASH ME: fix link\n\nCo-Authored-By: Miklas Boskamp <miklas.boskamp@camunda.com>", "committedDate": "2020-03-19T13:10:40Z", "type": "commit"}, {"oid": "1900fe45228c8c7be7af062df1df26ba5157b529", "url": "https://github.com/camunda/camunda-bpm-platform/commit/1900fe45228c8c7be7af062df1df26ba5157b529", "message": "SQUASH ME: fix link\n\nCo-Authored-By: Miklas Boskamp <miklas.boskamp@camunda.com>", "committedDate": "2020-03-19T13:10:40Z", "type": "commit"}, {"oid": "96a020c309a84da5f1b18d525230788075eec174", "url": "https://github.com/camunda/camunda-bpm-platform/commit/96a020c309a84da5f1b18d525230788075eec174", "message": "SQUASH ME: add common LinkableDto props", "committedDate": "2020-03-19T13:10:40Z", "type": "commit"}, {"oid": "96a020c309a84da5f1b18d525230788075eec174", "url": "https://github.com/camunda/camunda-bpm-platform/commit/96a020c309a84da5f1b18d525230788075eec174", "message": "SQUASH ME: add common LinkableDto props", "committedDate": "2020-03-19T13:10:40Z", "type": "forcePushed"}, {"oid": "d9a1ae18f388025607ddd3ee0cc13ad0d8c328ba", "url": "https://github.com/camunda/camunda-bpm-platform/commit/d9a1ae18f388025607ddd3ee0cc13ad0d8c328ba", "message": "SQUASH ME: enable DTO macro to extend other DTOs (allOf); remove\nlikable-dto-props", "committedDate": "2020-03-20T09:53:38Z", "type": "commit"}]}