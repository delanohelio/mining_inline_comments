{"pr_number": 1162, "pr_title": "CAM-12819: feat(side-pipe): add slow pipeline with crdb", "pr_createdAt": "2020-12-02T09:02:14Z", "pr_url": "https://github.com/camunda/camunda-bpm-platform/pull/1162", "timeline": [{"oid": "a71c6935881fe2f1bfde0c45eb027b91d9c5ed3b", "url": "https://github.com/camunda/camunda-bpm-platform/commit/a71c6935881fe2f1bfde0c45eb027b91d9c5ed3b", "message": "feat(side-pipeline): add side pipeline with crdb", "committedDate": "2020-12-02T09:02:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg5NzU4Ng==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1162#discussion_r534897586", "bodyText": "We should update this block with the changes introduced in the PR-label topic. We should also consider the default-build, rolling-update or migration labels here. Otherwise, nothing will be triggered for this pipeline for these labels.", "author": "koevskinikola", "createdAt": "2020-12-03T08:21:16Z", "path": ".ci/sidetrack/Jenkinsfile", "diffHunk": "@@ -0,0 +1,239 @@\n+// https://github.com/camunda/jenkins-global-shared-library\n+@Library('camunda-ci') _\n+\n+String getAgent(String dockerImage = 'gcr.io/ci-30-162810/centos:v0.4.6', Integer cpuLimit = 4){\n+  String mavenForkCount = cpuLimit;\n+  String mavenMemoryLimit = cpuLimit * 2;\n+  \"\"\"\n+metadata:\n+  labels:\n+    agent: ci-cambpm-camunda-cloud-build\n+spec:\n+  nodeSelector:\n+    cloud.google.com/gke-nodepool: agents-n1-standard-32-netssd-preempt\n+  tolerations:\n+  - key: \"agents-n1-standard-32-netssd-preempt\"\n+    operator: \"Exists\"\n+    effect: \"NoSchedule\"\n+  containers:\n+  - name: \"jnlp\"\n+    image: \"${dockerImage}\"\n+    args: ['\\$(JENKINS_SECRET)', '\\$(JENKINS_NAME)']\n+    tty: true\n+    env:\n+    - name: LIMITS_CPU\n+      value: ${mavenForkCount}\n+    - name: TZ\n+      value: Europe/Berlin\n+    resources:\n+      limits:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+      requests:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+    workingDir: \"/home/work\"\n+    volumeMounts:\n+      - mountPath: /home/work\n+        name: workspace-volume\n+  \"\"\"\n+}\n+\n+pipeline {\n+  agent none\n+  parameters {\n+    buildSelector(\n+        name: 'copyArtifactSelector',\n+        description: 'A build to take the artifacts from'\n+    )\n+    booleanParam defaultValue: true, description: '', name: 'STANDALONE'\n+  }\n+  options {\n+    buildDiscarder(logRotator(numToKeepStr: '5')) //, artifactNumToKeepStr: '30'\n+  }\n+  stages {\n+    stage('Prepare') {\n+      agent {\n+        kubernetes {\n+          yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+        }\n+      }\n+      when {\n+        expression { params.STANDALONE == false }\n+      }\n+      steps {\n+        copyArtifacts(projectName: \"cambpm-jenkins-pipelines/${env.BRANCH_NAME}\", fingerprintArtifacts: true, selector: buildParameter('copyArtifactSelector'), optional: true)\n+        stash name: \"platform-stash-runtime\", includes: \".m2/org/camunda/**/*-SNAPSHOT/**\", excludes: \"**/qa/**,**/*qa*/**,**/*.zip,**/*.tar.gz\"\n+        stash name: \"platform-stash-qa\", includes: \".m2/org/camunda/bpm/**/qa/**/*-SNAPSHOT/**,.m2/org/camunda/bpm/**/*qa*/**/*-SNAPSHOT/**\", excludes: \"**/*.zip,**/*.tar.gz\"\n+      }\n+    }\n+    stage('UNIT DB tests') {\n+      matrix {\n+        axes {\n+          axis {\n+            name 'DB'\n+            values 'h2'// TODO 'cockroach'\n+          }\n+          axis {\n+            name 'PROFILE'\n+            values 'engine-unit', 'engine-unit-authorizations', 'webapps-unit', 'webapps-unit-authorizations', 'check-sql', 'upgrade-db', 'instance-migration', 'old-engine', 'rolling-update', 'large-data-tests'\n+          }\n+        }\n+        when {\n+          expression {\n+            return withLabels('all-db','cockroachdb') // TODO\n+          }\n+          beforeAgent true\n+        }", "originalCommit": "a71c6935881fe2f1bfde0c45eb027b91d9c5ed3b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg5OTg2NA==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1162#discussion_r534899864", "bodyText": "Let's document in the main ticket, or create a different one, when we want to enable the full (CRDB) features of this pipeline.", "author": "koevskinikola", "createdAt": "2020-12-03T08:22:35Z", "path": ".ci/sidetrack/Jenkinsfile", "diffHunk": "@@ -0,0 +1,239 @@\n+// https://github.com/camunda/jenkins-global-shared-library\n+@Library('camunda-ci') _\n+\n+String getAgent(String dockerImage = 'gcr.io/ci-30-162810/centos:v0.4.6', Integer cpuLimit = 4){\n+  String mavenForkCount = cpuLimit;\n+  String mavenMemoryLimit = cpuLimit * 2;\n+  \"\"\"\n+metadata:\n+  labels:\n+    agent: ci-cambpm-camunda-cloud-build\n+spec:\n+  nodeSelector:\n+    cloud.google.com/gke-nodepool: agents-n1-standard-32-netssd-preempt\n+  tolerations:\n+  - key: \"agents-n1-standard-32-netssd-preempt\"\n+    operator: \"Exists\"\n+    effect: \"NoSchedule\"\n+  containers:\n+  - name: \"jnlp\"\n+    image: \"${dockerImage}\"\n+    args: ['\\$(JENKINS_SECRET)', '\\$(JENKINS_NAME)']\n+    tty: true\n+    env:\n+    - name: LIMITS_CPU\n+      value: ${mavenForkCount}\n+    - name: TZ\n+      value: Europe/Berlin\n+    resources:\n+      limits:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+      requests:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+    workingDir: \"/home/work\"\n+    volumeMounts:\n+      - mountPath: /home/work\n+        name: workspace-volume\n+  \"\"\"\n+}\n+\n+pipeline {\n+  agent none\n+  parameters {\n+    buildSelector(\n+        name: 'copyArtifactSelector',\n+        description: 'A build to take the artifacts from'\n+    )\n+    booleanParam defaultValue: true, description: '', name: 'STANDALONE'\n+  }\n+  options {\n+    buildDiscarder(logRotator(numToKeepStr: '5')) //, artifactNumToKeepStr: '30'\n+  }\n+  stages {\n+    stage('Prepare') {\n+      agent {\n+        kubernetes {\n+          yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+        }\n+      }\n+      when {\n+        expression { params.STANDALONE == false }\n+      }\n+      steps {\n+        copyArtifacts(projectName: \"cambpm-jenkins-pipelines/${env.BRANCH_NAME}\", fingerprintArtifacts: true, selector: buildParameter('copyArtifactSelector'), optional: true)\n+        stash name: \"platform-stash-runtime\", includes: \".m2/org/camunda/**/*-SNAPSHOT/**\", excludes: \"**/qa/**,**/*qa*/**,**/*.zip,**/*.tar.gz\"\n+        stash name: \"platform-stash-qa\", includes: \".m2/org/camunda/bpm/**/qa/**/*-SNAPSHOT/**,.m2/org/camunda/bpm/**/*qa*/**/*-SNAPSHOT/**\", excludes: \"**/*.zip,**/*.tar.gz\"\n+      }\n+    }\n+    stage('UNIT DB tests') {\n+      matrix {\n+        axes {\n+          axis {\n+            name 'DB'\n+            values 'h2'// TODO 'cockroach'\n+          }\n+          axis {\n+            name 'PROFILE'\n+            values 'engine-unit', 'engine-unit-authorizations', 'webapps-unit', 'webapps-unit-authorizations', 'check-sql', 'upgrade-db', 'instance-migration', 'old-engine', 'rolling-update', 'large-data-tests'\n+          }\n+        }\n+        when {\n+          expression {\n+            return withLabels('all-db','cockroachdb') // TODO\n+          }\n+          beforeAgent true\n+        }\n+        agent {\n+          kubernetes {\n+            yaml getAgent()\n+          }\n+        }\n+        stages {\n+          stage('UNIT test') {\n+            steps {\n+              echo(\"UNIT DB Test Stage: ${env.PROFILE}-${env.DB}\")\n+              //withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'camunda-maven-settings', options: [artifactsPublisher(disabled: true), junitPublisher(disabled: true)]) {", "originalCommit": "a71c6935881fe2f1bfde0c45eb027b91d9c5ed3b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTE0MDE2NA==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1162#discussion_r535140164", "bodyText": "Resolving this, as the comment below covers the same topic.", "author": "koevskinikola", "createdAt": "2020-12-03T11:35:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg5OTg2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDkwMDY1NQ==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1162#discussion_r534900655", "bodyText": "We should confirm that this pipeline executes successfully with CockroachDB before merging it. We will need to provide a DB agent for this purpose.\nAfter the confirmation, we can temporarily use H2 and document in the main ticket, or create a different one, when we want to enable the full (CRDB) features of this pipeline.\nAlternatively, we can temporarily disable the complete pipeline through the trigger in the main Pipeline.", "author": "koevskinikola", "createdAt": "2020-12-03T08:23:00Z", "path": ".ci/sidetrack/Jenkinsfile", "diffHunk": "@@ -0,0 +1,239 @@\n+// https://github.com/camunda/jenkins-global-shared-library\n+@Library('camunda-ci') _\n+\n+String getAgent(String dockerImage = 'gcr.io/ci-30-162810/centos:v0.4.6', Integer cpuLimit = 4){\n+  String mavenForkCount = cpuLimit;\n+  String mavenMemoryLimit = cpuLimit * 2;\n+  \"\"\"\n+metadata:\n+  labels:\n+    agent: ci-cambpm-camunda-cloud-build\n+spec:\n+  nodeSelector:\n+    cloud.google.com/gke-nodepool: agents-n1-standard-32-netssd-preempt\n+  tolerations:\n+  - key: \"agents-n1-standard-32-netssd-preempt\"\n+    operator: \"Exists\"\n+    effect: \"NoSchedule\"\n+  containers:\n+  - name: \"jnlp\"\n+    image: \"${dockerImage}\"\n+    args: ['\\$(JENKINS_SECRET)', '\\$(JENKINS_NAME)']\n+    tty: true\n+    env:\n+    - name: LIMITS_CPU\n+      value: ${mavenForkCount}\n+    - name: TZ\n+      value: Europe/Berlin\n+    resources:\n+      limits:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+      requests:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+    workingDir: \"/home/work\"\n+    volumeMounts:\n+      - mountPath: /home/work\n+        name: workspace-volume\n+  \"\"\"\n+}\n+\n+pipeline {\n+  agent none\n+  parameters {\n+    buildSelector(\n+        name: 'copyArtifactSelector',\n+        description: 'A build to take the artifacts from'\n+    )\n+    booleanParam defaultValue: true, description: '', name: 'STANDALONE'\n+  }\n+  options {\n+    buildDiscarder(logRotator(numToKeepStr: '5')) //, artifactNumToKeepStr: '30'\n+  }\n+  stages {\n+    stage('Prepare') {\n+      agent {\n+        kubernetes {\n+          yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+        }\n+      }\n+      when {\n+        expression { params.STANDALONE == false }\n+      }\n+      steps {\n+        copyArtifacts(projectName: \"cambpm-jenkins-pipelines/${env.BRANCH_NAME}\", fingerprintArtifacts: true, selector: buildParameter('copyArtifactSelector'), optional: true)\n+        stash name: \"platform-stash-runtime\", includes: \".m2/org/camunda/**/*-SNAPSHOT/**\", excludes: \"**/qa/**,**/*qa*/**,**/*.zip,**/*.tar.gz\"\n+        stash name: \"platform-stash-qa\", includes: \".m2/org/camunda/bpm/**/qa/**/*-SNAPSHOT/**,.m2/org/camunda/bpm/**/*qa*/**/*-SNAPSHOT/**\", excludes: \"**/*.zip,**/*.tar.gz\"\n+      }\n+    }\n+    stage('UNIT DB tests') {\n+      matrix {\n+        axes {\n+          axis {\n+            name 'DB'\n+            values 'h2'// TODO 'cockroach'", "originalCommit": "a71c6935881fe2f1bfde0c45eb027b91d9c5ed3b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDkwMTkxOA==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1162#discussion_r534901918", "bodyText": "We should update this method with the changes introduced in the PR-labels ticket.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            void withLabels(String... labels) {\n          \n          \n            \n              for ( l in labels) {\n          \n          \n            \n                pullRequest.labels.contains(labelName)\n          \n          \n            \n              }\n          \n          \n            \n            }\n          \n          \n            \n            boolean withLabels(String... labels) {\n          \n          \n            \n              for ( l in labels) {\n          \n          \n            \n                pullRequest.labels.contains(')\n          \n          \n            \n              }\n          \n          \n            \n            }", "author": "koevskinikola", "createdAt": "2020-12-03T08:23:48Z", "path": ".ci/sidetrack/Jenkinsfile", "diffHunk": "@@ -0,0 +1,239 @@\n+// https://github.com/camunda/jenkins-global-shared-library\n+@Library('camunda-ci') _\n+\n+String getAgent(String dockerImage = 'gcr.io/ci-30-162810/centos:v0.4.6', Integer cpuLimit = 4){\n+  String mavenForkCount = cpuLimit;\n+  String mavenMemoryLimit = cpuLimit * 2;\n+  \"\"\"\n+metadata:\n+  labels:\n+    agent: ci-cambpm-camunda-cloud-build\n+spec:\n+  nodeSelector:\n+    cloud.google.com/gke-nodepool: agents-n1-standard-32-netssd-preempt\n+  tolerations:\n+  - key: \"agents-n1-standard-32-netssd-preempt\"\n+    operator: \"Exists\"\n+    effect: \"NoSchedule\"\n+  containers:\n+  - name: \"jnlp\"\n+    image: \"${dockerImage}\"\n+    args: ['\\$(JENKINS_SECRET)', '\\$(JENKINS_NAME)']\n+    tty: true\n+    env:\n+    - name: LIMITS_CPU\n+      value: ${mavenForkCount}\n+    - name: TZ\n+      value: Europe/Berlin\n+    resources:\n+      limits:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+      requests:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+    workingDir: \"/home/work\"\n+    volumeMounts:\n+      - mountPath: /home/work\n+        name: workspace-volume\n+  \"\"\"\n+}\n+\n+pipeline {\n+  agent none\n+  parameters {\n+    buildSelector(\n+        name: 'copyArtifactSelector',\n+        description: 'A build to take the artifacts from'\n+    )\n+    booleanParam defaultValue: true, description: '', name: 'STANDALONE'\n+  }\n+  options {\n+    buildDiscarder(logRotator(numToKeepStr: '5')) //, artifactNumToKeepStr: '30'\n+  }\n+  stages {\n+    stage('Prepare') {\n+      agent {\n+        kubernetes {\n+          yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6', 16)\n+        }\n+      }\n+      when {\n+        expression { params.STANDALONE == false }\n+      }\n+      steps {\n+        copyArtifacts(projectName: \"cambpm-jenkins-pipelines/${env.BRANCH_NAME}\", fingerprintArtifacts: true, selector: buildParameter('copyArtifactSelector'), optional: true)\n+        stash name: \"platform-stash-runtime\", includes: \".m2/org/camunda/**/*-SNAPSHOT/**\", excludes: \"**/qa/**,**/*qa*/**,**/*.zip,**/*.tar.gz\"\n+        stash name: \"platform-stash-qa\", includes: \".m2/org/camunda/bpm/**/qa/**/*-SNAPSHOT/**,.m2/org/camunda/bpm/**/*qa*/**/*-SNAPSHOT/**\", excludes: \"**/*.zip,**/*.tar.gz\"\n+      }\n+    }\n+    stage('UNIT DB tests') {\n+      matrix {\n+        axes {\n+          axis {\n+            name 'DB'\n+            values 'h2'// TODO 'cockroach'\n+          }\n+          axis {\n+            name 'PROFILE'\n+            values 'engine-unit', 'engine-unit-authorizations', 'webapps-unit', 'webapps-unit-authorizations', 'check-sql', 'upgrade-db', 'instance-migration', 'old-engine', 'rolling-update', 'large-data-tests'\n+          }\n+        }\n+        when {\n+          expression {\n+            return withLabels('all-db','cockroachdb') // TODO\n+          }\n+          beforeAgent true\n+        }\n+        agent {\n+          kubernetes {\n+            yaml getAgent()\n+          }\n+        }\n+        stages {\n+          stage('UNIT test') {\n+            steps {\n+              echo(\"UNIT DB Test Stage: ${env.PROFILE}-${env.DB}\")\n+              //withMaven(jdk: 'jdk-8-latest', maven: 'maven-3.2-latest', mavenSettingsConfig: 'camunda-maven-settings', options: [artifactsPublisher(disabled: true), junitPublisher(disabled: true)]) {\n+              //  runMaven(true, false, isQaStashEnabled(env.PROFILE), getMavenProfileDir(env.PROFILE), getMavenProfileCmd(env.PROFILE) + getDbProfiles(env.DB) + \" \" + getDbExtras(env.DB), true)\n+              //}\n+            }\n+            post {\n+              //always {\n+              //  junit testResults: '**/target/*-reports/TEST-*.xml', keepLongStdio: true\n+              //}\n+            }\n+          }\n+        }\n+      }\n+    }\n+  }\n+  post {\n+    changed {\n+      script {\n+        if (!agentDisconnected()){\n+          // send email if the slave disconnected\n+        }\n+      }\n+    }\n+    always {\n+      script {\n+        if (agentDisconnected()) {// Retrigger the build if the slave disconnected\n+          //currentBuild.result = 'ABORTED'\n+          //currentBuild.description = \"Aborted due to connection error\"\n+          build job: currentBuild.projectName, propagate: false, quietPeriod: 60, wait: false\n+        }\n+      }\n+    }\n+  }\n+}\n+\n+void runMaven(boolean runtimeStash, boolean archivesStash, boolean qaStash, String directory, String cmd, boolean singleThreaded = false) {\n+  if (!params.STANDALONE && runtimeStash) unstash \"platform-stash-runtime\"\n+  if (!params.STANDALONE && archivesStash) unstash \"platform-stash-archives\"\n+  if (!params.STANDALONE && qaStash) unstash \"platform-stash-qa\"\n+  String forkCount = singleThreaded? \"-DforkCount=1\" : '';\n+  configFileProvider([configFile(fileId: 'maven-nexus-settings', variable: 'MAVEN_SETTINGS_XML')]) {\n+    sh(\"mvn -s \\$MAVEN_SETTINGS_XML ${forkCount} ${cmd} -nsu -Dmaven.repo.local=\\${WORKSPACE}/.m2 -B -f ${directory}/pom.xml\")\n+  }\n+}\n+\n+void withLabels(String... labels) {\n+  for ( l in labels) {\n+    pullRequest.labels.contains(labelName)\n+  }\n+}", "originalCommit": "a71c6935881fe2f1bfde0c45eb027b91d9c5ed3b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "20752ffe73b075c57a1a36c3406ef92ef0b7a6fd", "url": "https://github.com/camunda/camunda-bpm-platform/commit/20752ffe73b075c57a1a36c3406ef92ef0b7a6fd", "message": "add PR handling", "committedDate": "2020-12-03T13:13:11Z", "type": "forcePushed"}, {"oid": "7513c57b5ca8d4a6bd3d9cd609d7190f0b76ab7b", "url": "https://github.com/camunda/camunda-bpm-platform/commit/7513c57b5ca8d4a6bd3d9cd609d7190f0b76ab7b", "message": "add PR handling", "committedDate": "2020-12-03T13:15:14Z", "type": "forcePushed"}, {"oid": "21f57f3d52ddfa35c2b006abd5550b9843665a79", "url": "https://github.com/camunda/camunda-bpm-platform/commit/21f57f3d52ddfa35c2b006abd5550b9843665a79", "message": "add PR handling", "committedDate": "2020-12-03T13:19:34Z", "type": "forcePushed"}, {"oid": "df8f154b77dd3b0fd88e0fbaae6b6311cc2ce14f", "url": "https://github.com/camunda/camunda-bpm-platform/commit/df8f154b77dd3b0fd88e0fbaae6b6311cc2ce14f", "message": "add PR handling", "committedDate": "2020-12-03T13:22:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI0NzQ0Mw==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1162#discussion_r535247443", "bodyText": "We need to add a CRDB check here:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        withLabels(getLabels(env.PROFILE))\n          \n          \n            \n                        withLabels(getLabels(env.PROFILE)) && withDbLabel(env.DB)", "author": "koevskinikola", "createdAt": "2020-12-03T13:57:33Z", "path": ".ci/sidetrack/Jenkinsfile", "diffHunk": "@@ -0,0 +1,286 @@\n+import groovy.json.JsonSlurper\n+\n+// https://github.com/camunda/jenkins-global-shared-library\n+@Library('camunda-ci') _\n+\n+String getAgent(String dockerImage = 'gcr.io/ci-30-162810/centos:v0.4.6', Integer cpuLimit = 4){\n+  String mavenForkCount = cpuLimit;\n+  String mavenMemoryLimit = cpuLimit * 2;\n+  \"\"\"\n+metadata:\n+  labels:\n+    agent: ci-cambpm-camunda-cloud-build\n+spec:\n+  nodeSelector:\n+    cloud.google.com/gke-nodepool: agents-n1-standard-32-netssd-preempt\n+  tolerations:\n+  - key: \"agents-n1-standard-32-netssd-preempt\"\n+    operator: \"Exists\"\n+    effect: \"NoSchedule\"\n+  containers:\n+  - name: \"jnlp\"\n+    image: \"${dockerImage}\"\n+    args: ['\\$(JENKINS_SECRET)', '\\$(JENKINS_NAME)']\n+    tty: true\n+    env:\n+    - name: LIMITS_CPU\n+      value: ${mavenForkCount}\n+    - name: TZ\n+      value: Europe/Berlin\n+    resources:\n+      limits:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+      requests:\n+        cpu: ${cpuLimit}\n+        memory: ${mavenMemoryLimit}Gi\n+    workingDir: \"/home/work\"\n+    volumeMounts:\n+      - mountPath: /home/work\n+        name: workspace-volume\n+  \"\"\"\n+}\n+\n+pipeline {\n+  agent none\n+  parameters {\n+    buildSelector(\n+        name: 'copyArtifactSelector',\n+        description: 'A build to take the artifacts from'\n+    )\n+    booleanParam defaultValue: true, description: '', name: 'STANDALONE'\n+    string defaultValue: '', description: 'The labels assigned to the CE pull request', name: 'PR_LABELS'\n+  }\n+  options {\n+    buildDiscarder(logRotator(numToKeepStr: '5')) //, artifactNumToKeepStr: '30'\n+  }\n+  stages {\n+    stage('Prepare') {\n+      when {\n+        expression { params.STANDALONE == false }\n+        beforeAgent true\n+      }\n+      agent {\n+        kubernetes {\n+          yaml getAgent('gcr.io/ci-30-162810/centos:v0.4.6')\n+        }\n+      }\n+      steps {\n+        copyArtifacts(projectName: \"cambpm-jenkins-pipelines/${env.BRANCH_NAME}\", fingerprintArtifacts: true, selector: buildParameter('copyArtifactSelector'), optional: true)\n+        stash name: \"platform-stash-runtime\", includes: \".m2/org/camunda/**/*-SNAPSHOT/**\", excludes: \"**/qa/**,**/*qa*/**,**/*.zip,**/*.tar.gz\"\n+        stash name: \"platform-stash-qa\", includes: \".m2/org/camunda/bpm/**/qa/**/*-SNAPSHOT/**,.m2/org/camunda/bpm/**/*qa*/**/*-SNAPSHOT/**\", excludes: \"**/*.zip,**/*.tar.gz\"\n+      }\n+    }\n+    stage('UNIT DB tests') {\n+      matrix {\n+        axes {\n+          axis {\n+            name 'DB'\n+            values 'cockroachdb'\n+          }\n+          axis {\n+            name 'PROFILE'\n+            values 'engine-unit', 'engine-unit-authorizations', 'webapps-unit', 'webapps-unit-authorizations', 'check-sql', 'upgrade-db', 'instance-migration', 'old-engine', 'rolling-update', 'large-data-tests'\n+          }\n+        }\n+        when {\n+          expression {\n+            withLabels(getLabels(env.PROFILE))", "originalCommit": "df8f154b77dd3b0fd88e0fbaae6b6311cc2ce14f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI1NDExNQ==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1162#discussion_r535254115", "bodyText": "We're only using CRDB here, so a DB check is not necessary currently.", "author": "koevskinikola", "createdAt": "2020-12-03T14:06:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI0NzQ0Mw=="}], "type": "inlineReview"}, {"oid": "986c7801f0db8e37ee7d5189d0bd21678890dfcf", "url": "https://github.com/camunda/camunda-bpm-platform/commit/986c7801f0db8e37ee7d5189d0bd21678890dfcf", "message": "add PR handling", "committedDate": "2020-12-03T15:15:31Z", "type": "forcePushed"}, {"oid": "c8ae2be5a61277e25aaaffa8e1970bc776c6e6fc", "url": "https://github.com/camunda/camunda-bpm-platform/commit/c8ae2be5a61277e25aaaffa8e1970bc776c6e6fc", "message": "add PR handling", "committedDate": "2020-12-03T15:19:22Z", "type": "forcePushed"}, {"oid": "bb67f4da051b3cc94fd099c4ef93caaed9171788", "url": "https://github.com/camunda/camunda-bpm-platform/commit/bb67f4da051b3cc94fd099c4ef93caaed9171788", "message": "feat(side-pipeline): add side pipeline with crdb", "committedDate": "2020-12-04T09:28:28Z", "type": "commit"}, {"oid": "bb67f4da051b3cc94fd099c4ef93caaed9171788", "url": "https://github.com/camunda/camunda-bpm-platform/commit/bb67f4da051b3cc94fd099c4ef93caaed9171788", "message": "feat(side-pipeline): add side pipeline with crdb", "committedDate": "2020-12-04T09:28:28Z", "type": "forcePushed"}]}