{"pr_number": 875, "pr_title": "Add support for custom extension properties in external tasks", "pr_createdAt": "2020-06-29T12:49:10Z", "pr_url": "https://github.com/camunda/camunda-bpm-platform/pull/875", "timeline": [{"oid": "3effa29446d4d6494ca0b4714420aac8d2fd514a", "url": "https://github.com/camunda/camunda-bpm-platform/commit/3effa29446d4d6494ca0b4714420aac8d2fd514a", "message": "feat(engine-rest): support for external task extension properties (REST)\n\nRelated to CAM-12080", "committedDate": "2020-06-30T06:42:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzUyMDg2Mg==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/875#discussion_r447520862", "bodyText": "It is suggested to use the functions rather than the constants for type-safety.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    properties = Collections.EMPTY_MAP;\n          \n          \n            \n                    properties = Collections.emptyMap();", "author": "tmetzke", "createdAt": "2020-06-30T08:50:50Z", "path": "engine/src/main/java/org/camunda/bpm/engine/impl/externaltask/LockedExternalTaskImpl.java", "diffHunk": "@@ -164,6 +174,14 @@ public static LockedExternalTaskImpl fromEntity(ExternalTaskEntity externalTaskE\n     result.variables = new VariableMapImpl();\n     execution.collectVariables(result.variables, variablesToFetch, isLocal, deserializeVariables);\n \n+    if(includeExtensionProperties) {\n+      Map<String, String> properties = (Map<String, String>) execution.getActivity().getProperty(BpmnProperties.EXTENSION_PROPERTIES.getName());\n+      if(properties == null) {\n+        properties = Collections.EMPTY_MAP;", "originalCommit": "31080c0d5d5bd8282bef8fe4dcf9e7b26ee52411", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzUyOTY3MA==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/875#discussion_r447529670", "bodyText": "I feared you might say that. :D Although, I think it's nice to have that additional info, I agree that there seems to be rarely a use-case for it. I am fine with changing it to always return an empty map. Using the function instead of constant for that makes sense.", "author": "mboskamp", "createdAt": "2020-06-30T09:04:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzUyMDg2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzUzMDczNg==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/875#discussion_r447530736", "bodyText": "I think it makes sense from a consumer's point of view. I don't really want to care if I enabled the option or not and I don't want to change my implementation with regards to that in case I disable/enable the option.", "author": "tmetzke", "createdAt": "2020-06-30T09:06:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzUyMDg2Mg=="}], "type": "inlineReview"}, {"oid": "66b8de4162d1040e53d4e5bd052e1a70a820af94", "url": "https://github.com/camunda/camunda-bpm-platform/commit/66b8de4162d1040e53d4e5bd052e1a70a820af94", "message": "chore(rest): add OpenAPI doc for fetchAndLock with extension properties\n\nRelated to CAM-12080", "committedDate": "2020-07-01T05:59:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE0MTg0MA==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/875#discussion_r448141840", "bodyText": "I guess it's self-explanatory that a map can be empty and it's an implementation detail as well.\nI think the \"never null\" contract is more interesting for consumers.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * @return the properties or {@link Collections#emptyMap()} if no properties were configured\n          \n          \n            \n               * @return the properties, never <code>null</code>", "author": "tmetzke", "createdAt": "2020-07-01T06:27:31Z", "path": "engine/src/main/java/org/camunda/bpm/engine/externaltask/ExternalTask.java", "diffHunk": "@@ -121,6 +123,12 @@\n    */\n   long getPriority();\n \n+  /**\n+   * Returns a map containing all custom extension properties of the external task.\n+   * \n+   * @return the properties or {@link Collections#emptyMap()} if no properties were configured", "originalCommit": "66b8de4162d1040e53d4e5bd052e1a70a820af94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE0MjM0MQ==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/875#discussion_r448142341", "bodyText": "You explained the circumstances pretty well beforehand, no need for duplicated information I would say, the \"never null\" part is more interesting API-wise I would say\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * @return a potentially empty map of all defined custom extension properties\n          \n          \n            \n               *         if the fetch-and-lock instructions include extension properties,\n          \n          \n            \n               *         otherwise {@link Collections#emptyMap()}\n          \n          \n            \n               * @return all defined custom extension properties, never <code>null</code>", "author": "tmetzke", "createdAt": "2020-07-01T06:28:54Z", "path": "engine/src/main/java/org/camunda/bpm/engine/externaltask/LockedExternalTask.java", "diffHunk": "@@ -134,4 +136,19 @@\n    */\n   String getBusinessKey();\n \n+  /**\n+   * Returns a map of custom extension properties if the fetch instructions\n+   * indicate to include extension properties.\n+   * \n+   * If extension properties are included, the returned map contains any\n+   * extension property that is defined in the model definition of the external\n+   * task. If extension properties not included or no properties are defined for\n+   * the external task, the map will be empty.\n+   * \n+   * @return a potentially empty map of all defined custom extension properties\n+   *         if the fetch-and-lock instructions include extension properties,\n+   *         otherwise {@link Collections#emptyMap()}", "originalCommit": "66b8de4162d1040e53d4e5bd052e1a70a820af94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "54f3a844ace78fc8a88005928fd2182c6b6f02d9", "url": "https://github.com/camunda/camunda-bpm-platform/commit/54f3a844ace78fc8a88005928fd2182c6b6f02d9", "message": "feat(external-task): add extension properties to external task results\n\nRelated to CAM-12080", "committedDate": "2020-07-01T07:15:02Z", "type": "commit"}, {"oid": "1adad014e68fa6db5069ef2032a9f7a7cfd00ab6", "url": "https://github.com/camunda/camunda-bpm-platform/commit/1adad014e68fa6db5069ef2032a9f7a7cfd00ab6", "message": "feat(engine-rest): support for external task extension properties (REST)\n\nRelated to CAM-12080", "committedDate": "2020-07-01T07:15:14Z", "type": "commit"}, {"oid": "1e27b01c9d85c8f76a7c5a805020bf4ef2bbff22", "url": "https://github.com/camunda/camunda-bpm-platform/commit/1e27b01c9d85c8f76a7c5a805020bf4ef2bbff22", "message": "chore(rest): add OpenAPI doc for fetchAndLock with extension properties\n\nRelated to CAM-12080", "committedDate": "2020-07-01T07:15:15Z", "type": "commit"}, {"oid": "1e27b01c9d85c8f76a7c5a805020bf4ef2bbff22", "url": "https://github.com/camunda/camunda-bpm-platform/commit/1e27b01c9d85c8f76a7c5a805020bf4ef2bbff22", "message": "chore(rest): add OpenAPI doc for fetchAndLock with extension properties\n\nRelated to CAM-12080", "committedDate": "2020-07-01T07:15:15Z", "type": "forcePushed"}]}