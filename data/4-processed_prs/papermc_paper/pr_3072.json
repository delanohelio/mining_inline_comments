{"pr_number": 3072, "pr_title": "Add PlayerAttackEntityCooldownResetEvent", "pr_createdAt": "2020-03-27T03:07:09Z", "pr_url": "https://github.com/PaperMC/Paper/pull/3072", "timeline": [{"oid": "21d0c7d812f9c1e7cc6eb4fe98f90d62388bd0ab", "url": "https://github.com/PaperMC/Paper/commit/21d0c7d812f9c1e7cc6eb4fe98f90d62388bd0ab", "message": "Add PlayerAttackEntityCooldownResetEvent\nThis event is called when processing a player's attack on an entity\nright before their attack strength cd is reset, there are no existing\nevents that fire within this period of time so it was impossible to\ncapture the players attack strength via API prior to this commit.\n\nThe event is cancellable, which will just skip over the normal reset of\nattack strength cd", "committedDate": "2020-03-27T03:33:23Z", "type": "forcePushed"}, {"oid": "9726d2c49a7bfde984b02eaa96b430cfd46065d0", "url": "https://github.com/PaperMC/Paper/commit/9726d2c49a7bfde984b02eaa96b430cfd46065d0", "message": "Add PlayerAttackEntityCooldownResetEvent\nThis event is called when processing a player's attack on an entity\nright before their attack strength cd is reset, there are no existing\nevents that fire within this period of time so it was impossible to\ncapture the players attack strength via API prior to this commit.\n\nThe event is cancellable, which will just skip over the normal reset of\nattack strength cd", "committedDate": "2020-03-27T03:37:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAxOTU0MQ==", "url": "https://github.com/PaperMC/Paper/pull/3072#discussion_r399019541", "bodyText": "Should probably use an OBFHELPER", "author": "JRoy", "createdAt": "2020-03-27T03:46:22Z", "path": "Spigot-Server-Patches/0450-Add-PlayerAttackEntityCooldownResetEvent.patch", "diffHunk": "@@ -0,0 +1,37 @@\n+From 31dc251b27488c93d817655c6913c69e61f9486b Mon Sep 17 00:00:00 2001\n+From: nossr50 <nossr50@gmail.com>\n+Date: Thu, 26 Mar 2020 19:44:50 -0700\n+Subject: [PATCH] Add PlayerAttackEntityCooldownResetEvent\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/EntityHuman.java b/src/main/java/net/minecraft/server/EntityHuman.java\n+index 584166f22..768d724be 100644\n+--- a/src/main/java/net/minecraft/server/EntityHuman.java\n++++ b/src/main/java/net/minecraft/server/EntityHuman.java\n+@@ -1,5 +1,6 @@\n+ package net.minecraft.server;\n+ \n++import com.destroystokyo.paper.event.player.PlayerAttackEntityCooldownResetEvent;\n+ import com.google.common.collect.ImmutableMap;\n+ import com.google.common.collect.Lists;\n+ import com.mojang.authlib.GameProfile;\n+@@ -1057,7 +1058,15 @@ public abstract class EntityHuman extends EntityLiving {\n+ \n+                 f *= 0.2F + f2 * f2 * 0.8F;\n+                 f1 *= f2;\n+-                this.ey();\n++                //Paper start - PlayerAttackEntityCooldownResetEvent\n++                PlayerAttackEntityCooldownResetEvent playerAttackEntityCooldownResetEvent\n++                    = new PlayerAttackEntityCooldownResetEvent((Player) this.getBukkitEntity(), entity.getBukkitEntity(), this.getCooledAttackStrength(0F));\n++                playerAttackEntityCooldownResetEvent.callEvent();\n++\n++                if(!playerAttackEntityCooldownResetEvent.isCancelled()) {\n++                        this.ey(); //reset it like normal", "originalCommit": "9726d2c49a7bfde984b02eaa96b430cfd46065d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAxOTY4Ng==", "url": "https://github.com/PaperMC/Paper/pull/3072#discussion_r399019686", "bodyText": "in this case it's fine as the diff moves the method", "author": "Spottedleaf", "createdAt": "2020-03-27T03:46:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAxOTU0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAxOTg5NA==", "url": "https://github.com/PaperMC/Paper/pull/3072#discussion_r399019894", "bodyText": "I didn't know whether or not I should use the obfhelper, sounds like I should have", "author": "nossr50", "createdAt": "2020-03-27T03:47:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAxOTU0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU0NzQ5NQ==", "url": "https://github.com/PaperMC/Paper/pull/3072#discussion_r399547495", "bodyText": "I fixed it, and in the process discovered I might be the most dyslexic person in the world.", "author": "nossr50", "createdAt": "2020-03-27T21:30:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAxOTU0MQ=="}], "type": "inlineReview"}, {"oid": "95b432ca8f132d328c09d215e799502f7dbb1175", "url": "https://github.com/PaperMC/Paper/commit/95b432ca8f132d328c09d215e799502f7dbb1175", "message": "Add PlayerAttackEntityCooldownResetEvent\nThis event is called when processing a player's attack on an entity\nright before their attack strength cd is reset, there are no existing\nevents that fire within this period of time so it was impossible to\ncapture the players attack strength via API prior to this commit.\n\nThe event is cancellable, which will just skip over the normal reset of\nattack strength cd", "committedDate": "2020-03-27T21:22:22Z", "type": "forcePushed"}, {"oid": "dac9d54d7ca01aef91f043e4f092b5ed486dc8a0", "url": "https://github.com/PaperMC/Paper/commit/dac9d54d7ca01aef91f043e4f092b5ed486dc8a0", "message": "Add PlayerAttackEntityCooldownResetEvent\nThis event is called when processing a player's attack on an entity\nright before their attack strength cd is reset, there are no existing\nevents that fire within this period of time so it was impossible to\ncapture the players attack strength via API prior to this commit.\n\nThe event is cancellable, which will just skip over the normal reset of\nattack strength cd", "committedDate": "2020-03-27T21:24:45Z", "type": "forcePushed"}, {"oid": "35dc7052329ee3171ae22ec722e4a9fbff7a13d9", "url": "https://github.com/PaperMC/Paper/commit/35dc7052329ee3171ae22ec722e4a9fbff7a13d9", "message": "Add PlayerAttackEntityCooldownResetEvent\nThis event is called when processing a player's attack on an entity\nright before their attack strength cd is reset, there are no existing\nevents that fire within this period of time so it was impossible to\ncapture the players attack strength via API prior to this commit.\n\nThe event is cancellable, which will just skip over the normal reset of\nattack strength cd", "committedDate": "2020-03-27T21:27:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU2Njc0NA==", "url": "https://github.com/PaperMC/Paper/pull/3072#discussion_r399566744", "bodyText": "you need\n    @NotNull\n    public static HandlerList getHandlerList() {\n        return handlers;\n    }\n\nas well somewhere in here", "author": "Spottedleaf", "createdAt": "2020-03-27T22:29:23Z", "path": "Spigot-API-Patches/0193-Add-PlayerAttackEntityCooldownResetEvent.patch", "diffHunk": "@@ -0,0 +1,87 @@\n+From 8569d485d64336a0b3357f905a5ba95940d8f19b Mon Sep 17 00:00:00 2001\n+From: nossr50 <nossr50@gmail.com>\n+Date: Thu, 26 Mar 2020 19:30:58 -0700\n+Subject: [PATCH] Add PlayerAttackEntityCooldownResetEvent\n+\n+\n+diff --git a/src/main/java/com/destroystokyo/paper/event/player/PlayerAttackEntityCooldownResetEvent.java b/src/main/java/com/destroystokyo/paper/event/player/PlayerAttackEntityCooldownResetEvent.java\n+new file mode 100644\n+index 00000000..05a0f2f5\n+--- /dev/null\n++++ b/src/main/java/com/destroystokyo/paper/event/player/PlayerAttackEntityCooldownResetEvent.java\n+@@ -0,0 +1,72 @@\n++package com.destroystokyo.paper.event.player;\n++\n++import org.bukkit.entity.Entity;\n++import org.bukkit.entity.Player;\n++import org.bukkit.event.Cancellable;\n++import org.bukkit.event.HandlerList;\n++import org.bukkit.event.player.PlayerEvent;\n++import org.jetbrains.annotations.NotNull;\n++\n++/**\n++ * Called when processing a player's attack on an entity when the player's attack strength cooldown is reset\n++ */\n++public class PlayerAttackEntityCooldownResetEvent extends PlayerEvent implements Cancellable {\n++\n++    private final float cooledAttackStrength;\n++    private boolean cancel = false;\n++    private static final HandlerList handlers = new HandlerList();\n++    @NotNull private final Entity attackedEntity;\n++\n++    public PlayerAttackEntityCooldownResetEvent(@NotNull Player who, @NotNull Entity attackedEntity, float cooledAttackStrength) {\n++        super(who);\n++        this.attackedEntity = attackedEntity;\n++        this.cooledAttackStrength = cooledAttackStrength;\n++    }\n++", "originalCommit": "35dc7052329ee3171ae22ec722e4a9fbff7a13d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU3NjI1NQ==", "url": "https://github.com/PaperMC/Paper/pull/3072#discussion_r399576255", "bodyText": "That's strange, I'm pretty sure I had that in the project. I'll look over it later.", "author": "nossr50", "createdAt": "2020-03-27T23:05:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU2Njc0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTgzOTM1Ng==", "url": "https://github.com/PaperMC/Paper/pull/3072#discussion_r399839356", "bodyText": "@Spottedleaf getHandlers() is present, I just checked.", "author": "nossr50", "createdAt": "2020-03-29T19:06:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU2Njc0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTgzOTg4Nw==", "url": "https://github.com/PaperMC/Paper/pull/3072#discussion_r399839887", "bodyText": "You need both, this is how it should look - https://imgur.com/a/GNDYdzy. You're missing the latter.", "author": "Callahhh", "createdAt": "2020-03-29T19:10:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU2Njc0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg0MDkyNQ==", "url": "https://github.com/PaperMC/Paper/pull/3072#discussion_r399840925", "bodyText": "Ah thanks, I misread then. I'll fix it.", "author": "nossr50", "createdAt": "2020-03-29T19:20:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU2Njc0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg0MTIxMw==", "url": "https://github.com/PaperMC/Paper/pull/3072#discussion_r399841213", "bodyText": "Added", "author": "nossr50", "createdAt": "2020-03-29T19:23:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU2Njc0NA=="}], "type": "inlineReview"}, {"oid": "0ed873d3073374e2f3dd1b37a1f11767a5eb2656", "url": "https://github.com/PaperMC/Paper/commit/0ed873d3073374e2f3dd1b37a1f11767a5eb2656", "message": "Add PlayerAttackEntityCooldownResetEvent\nThis event is called when processing a player's attack on an entity\nright before their attack strength cd is reset, there are no existing\nevents that fire within this period of time so it was impossible to\ncapture the players attack strength via API prior to this commit.\n\nThe event is cancellable, which will just skip over the normal reset of\nattack strength cd", "committedDate": "2020-03-29T19:22:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI4ODA0Nw==", "url": "https://github.com/PaperMC/Paper/pull/3072#discussion_r401288047", "bodyText": "this can be a single line, space after comment start\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            +                //Paper start - PlayerAttackEntityCooldownResetEvent\n          \n          \n            \n            +                PlayerAttackEntityCooldownResetEvent playerAttackEntityCooldownResetEvent\n          \n          \n            \n            +                    = new PlayerAttackEntityCooldownResetEvent((Player) this.getBukkitEntity(), entity.getBukkitEntity(), this.getCooledAttackStrength(0F));\n          \n          \n            \n            +                // Paper start - PlayerAttackEntityCooldownResetEvent\n          \n          \n            \n            +                PlayerAttackEntityCooldownResetEvent playerAttackEntityCooldownResetEvent  = new PlayerAttackEntityCooldownResetEvent((Player) this.getBukkitEntity(), entity.getBukkitEntity(), this.getCooledAttackStrength(0F));", "author": "zachbr", "createdAt": "2020-04-01T00:20:42Z", "path": "Spigot-Server-Patches/0450-Add-PlayerAttackEntityCooldownResetEvent.patch", "diffHunk": "@@ -0,0 +1,37 @@\n+From 39c9d80f9162c26c3a2f0bf616a39d082a05b7c9 Mon Sep 17 00:00:00 2001\n+From: nossr50 <nossr50@gmail.com>\n+Date: Thu, 26 Mar 2020 19:44:50 -0700\n+Subject: [PATCH] Add PlayerAttackEntityCooldownResetEvent\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/EntityHuman.java b/src/main/java/net/minecraft/server/EntityHuman.java\n+index 584166f2..3d5ddf2d 100644\n+--- a/src/main/java/net/minecraft/server/EntityHuman.java\n++++ b/src/main/java/net/minecraft/server/EntityHuman.java\n+@@ -1,5 +1,6 @@\n+ package net.minecraft.server;\n+ \n++import com.destroystokyo.paper.event.player.PlayerAttackEntityCooldownResetEvent;\n+ import com.google.common.collect.ImmutableMap;\n+ import com.google.common.collect.Lists;\n+ import com.mojang.authlib.GameProfile;\n+@@ -1057,7 +1058,15 @@ public abstract class EntityHuman extends EntityLiving {\n+ \n+                 f *= 0.2F + f2 * f2 * 0.8F;\n+                 f1 *= f2;\n+-                this.ey();\n++                //Paper start - PlayerAttackEntityCooldownResetEvent\n++                PlayerAttackEntityCooldownResetEvent playerAttackEntityCooldownResetEvent\n++                    = new PlayerAttackEntityCooldownResetEvent((Player) this.getBukkitEntity(), entity.getBukkitEntity(), this.getCooledAttackStrength(0F));", "originalCommit": "0ed873d3073374e2f3dd1b37a1f11767a5eb2656", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk0MTMxMg==", "url": "https://github.com/PaperMC/Paper/pull/3072#discussion_r406941312", "bodyText": "Your suggestions have been added", "author": "nossr50", "createdAt": "2020-04-10T20:58:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI4ODA0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI4ODA2Mg==", "url": "https://github.com/PaperMC/Paper/pull/3072#discussion_r401288062", "bodyText": "space after if on conditionals, 4 space indents.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            +                if(!playerAttackEntityCooldownResetEvent.isCancelled()) {\n          \n          \n            \n            +                        this.resetCooldown(); //reset it like normal\n          \n          \n            \n            +                if (!playerAttackEntityCooldownResetEvent.isCancelled()) {\n          \n          \n            \n            +                    this.resetCooldown(); // reset it like normal", "author": "zachbr", "createdAt": "2020-04-01T00:20:46Z", "path": "Spigot-Server-Patches/0450-Add-PlayerAttackEntityCooldownResetEvent.patch", "diffHunk": "@@ -0,0 +1,37 @@\n+From 39c9d80f9162c26c3a2f0bf616a39d082a05b7c9 Mon Sep 17 00:00:00 2001\n+From: nossr50 <nossr50@gmail.com>\n+Date: Thu, 26 Mar 2020 19:44:50 -0700\n+Subject: [PATCH] Add PlayerAttackEntityCooldownResetEvent\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/EntityHuman.java b/src/main/java/net/minecraft/server/EntityHuman.java\n+index 584166f2..3d5ddf2d 100644\n+--- a/src/main/java/net/minecraft/server/EntityHuman.java\n++++ b/src/main/java/net/minecraft/server/EntityHuman.java\n+@@ -1,5 +1,6 @@\n+ package net.minecraft.server;\n+ \n++import com.destroystokyo.paper.event.player.PlayerAttackEntityCooldownResetEvent;\n+ import com.google.common.collect.ImmutableMap;\n+ import com.google.common.collect.Lists;\n+ import com.mojang.authlib.GameProfile;\n+@@ -1057,7 +1058,15 @@ public abstract class EntityHuman extends EntityLiving {\n+ \n+                 f *= 0.2F + f2 * f2 * 0.8F;\n+                 f1 *= f2;\n+-                this.ey();\n++                //Paper start - PlayerAttackEntityCooldownResetEvent\n++                PlayerAttackEntityCooldownResetEvent playerAttackEntityCooldownResetEvent\n++                    = new PlayerAttackEntityCooldownResetEvent((Player) this.getBukkitEntity(), entity.getBukkitEntity(), this.getCooledAttackStrength(0F));\n++                playerAttackEntityCooldownResetEvent.callEvent();\n++\n++                if(!playerAttackEntityCooldownResetEvent.isCancelled()) {\n++                        this.resetCooldown(); //reset it like normal", "originalCommit": "0ed873d3073374e2f3dd1b37a1f11767a5eb2656", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk0MTM5MA==", "url": "https://github.com/PaperMC/Paper/pull/3072#discussion_r406941390", "bodyText": "Your suggestions have been added", "author": "nossr50", "createdAt": "2020-04-10T20:58:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI4ODA2Mg=="}], "type": "inlineReview"}, {"oid": "592b0ad046f6121054bccf49fb3e7b6c6ad5c8b4", "url": "https://github.com/PaperMC/Paper/commit/592b0ad046f6121054bccf49fb3e7b6c6ad5c8b4", "message": "Add PlayerAttackEntityCooldownResetEvent\nThis event is called when processing a player's attack on an entity\nright before their attack strength cd is reset, there are no existing\nevents that fire within this period of time so it was impossible to\ncapture the players attack strength via API prior to this commit.\n\nThe event is cancellable, which will just skip over the normal reset of\nattack strength cd", "committedDate": "2020-04-10T20:57:13Z", "type": "forcePushed"}, {"oid": "79d29176ebc3d68a6f1ac946cf3851c7a37dafb5", "url": "https://github.com/PaperMC/Paper/commit/79d29176ebc3d68a6f1ac946cf3851c7a37dafb5", "message": "Add PlayerAttackEntityCooldownResetEvent\nThis event is called when processing a player's attack on an entity\nright before their attack strength cd is reset, there are no existing\nevents that fire within this period of time so it was impossible to\ncapture the players attack strength via API prior to this commit.\n\nThe event is cancellable, which will just skip over the normal reset of\nattack strength cd", "committedDate": "2020-04-10T20:59:18Z", "type": "forcePushed"}, {"oid": "a2064a41351fd6705f3c5ba52b7b9cfa1e949a59", "url": "https://github.com/PaperMC/Paper/commit/a2064a41351fd6705f3c5ba52b7b9cfa1e949a59", "message": "Add PlayerAttackEntityCooldownResetEvent\nThis event is called when processing a player's attack on an entity\nright before their attack strength cd is reset, there are no existing\nevents that fire within this period of time so it was impossible to\ncapture the players attack strength via API prior to this commit.\n\nThe event is cancellable, which will just skip over the normal reset of\nattack strength cd", "committedDate": "2020-04-21T06:10:43Z", "type": "commit"}, {"oid": "a2064a41351fd6705f3c5ba52b7b9cfa1e949a59", "url": "https://github.com/PaperMC/Paper/commit/a2064a41351fd6705f3c5ba52b7b9cfa1e949a59", "message": "Add PlayerAttackEntityCooldownResetEvent\nThis event is called when processing a player's attack on an entity\nright before their attack strength cd is reset, there are no existing\nevents that fire within this period of time so it was impossible to\ncapture the players attack strength via API prior to this commit.\n\nThe event is cancellable, which will just skip over the normal reset of\nattack strength cd", "committedDate": "2020-04-21T06:10:43Z", "type": "forcePushed"}]}