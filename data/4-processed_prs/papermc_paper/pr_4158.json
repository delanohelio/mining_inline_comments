{"pr_number": 4158, "pr_title": "Add Wandering Trader spawn rate config options", "pr_createdAt": "2020-08-20T06:53:49Z", "pr_url": "https://github.com/PaperMC/Paper/pull/4158", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzk3OTkyNg==", "url": "https://github.com/PaperMC/Paper/pull/4158#discussion_r473979926", "bodyText": "Do no remove fields, this breaks plugins relying on nms", "author": "JRoy", "createdAt": "2020-08-20T13:35:38Z", "path": "Spigot-Server-Patches/0553-Add-Wandering-Trader-spawn-rate-config-options.patch", "diffHunk": "@@ -0,0 +1,128 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: jmp <jasonpenilla2@me.com>\n+Date: Wed, 19 Aug 2020 23:33:43 -0700\n+Subject: [PATCH] Add Wandering Trader spawn rate config options\n+\n+Removes usages of the Vanilla wanderingTraderSpawnDelay and wanderingTraderSpawnChance values from the level.dat.\n+These were only used in some places, with hardcoded values in others (there are reports online of odd behaviour which match this).\n+This patch also simplifies the spawn delay logic and allows for arbitrary tick delays set in the Paper world config\n+(vanilla 24000 / 20 mins / 1 mc day), as well as adds config options for the minimum spawn chance, maximum spawn chance, and the\n+spawn chance increment on failed spawn attempts. These values are all easy to grasp and configure after a quick glance at\n+this page on the Minecraft wiki: https://minecraft.gamepedia.com/Wandering_Trader#Spawning\n+\n+diff --git a/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java b/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java\n+index d5a1ade21749bba420257f3ece7878f32148d6ff..d940481880155d97b992c045b801b820ed4c6532 100644\n+--- a/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java\n++++ b/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java\n+@@ -654,4 +654,15 @@ public class PaperWorldConfig {\n+             maxLightningFlashDistance = 512; // Vanilla value\n+         }\n+     }\n++\n++    public int villagerTraderSpawnAttemptDelay = 24000;\n++    public int villagerTraderSpawnChanceFailureIncrement = 25;\n++    public int villagerTraderSpawnChanceMin = 25;\n++    public int villagerTraderSpawnChanceMax = 75;\n++    private void villagerTraderSettings() {\n++        villagerTraderSpawnAttemptDelay = getInt(\"wandering_trader.spawn-attempt-delay\", villagerTraderSpawnAttemptDelay);\n++        villagerTraderSpawnChanceFailureIncrement = getInt(\"wandering_trader.spawn-chance-failure-increment\", villagerTraderSpawnChanceFailureIncrement);\n++        villagerTraderSpawnChanceMin = getInt(\"wandering_trader.spawn-chance-min\", villagerTraderSpawnChanceMin);\n++        villagerTraderSpawnChanceMin = getInt(\"wandering_trader.spawn-chance-max\", villagerTraderSpawnChanceMax);\n++    }\n+ }\n+diff --git a/src/main/java/net/minecraft/server/MobSpawnerTrader.java b/src/main/java/net/minecraft/server/MobSpawnerTrader.java\n+index 502cb0ea40b5df1962c5a6d4b57d34de9d413e7f..419baf0e5aba3d0b31d2dbb95feb2d58e411fc60 100644\n+--- a/src/main/java/net/minecraft/server/MobSpawnerTrader.java\n++++ b/src/main/java/net/minecraft/server/MobSpawnerTrader.java\n+@@ -10,54 +10,62 @@ public class MobSpawnerTrader implements MobSpawner {\n+     private final Random a = new Random();\n+     private final IWorldDataServer b;\n+     private int c;\n+-    private int d;\n++    //private int d; // Paper", "originalCommit": "a5abeaa339bb6a7123a382c6a3fa3ef38f8ef0cb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzk4MTE1MA==", "url": "https://github.com/PaperMC/Paper/pull/4158#discussion_r473981150", "bodyText": "Please don't comment code out, just remove it as commenting increases the diff", "author": "JRoy", "createdAt": "2020-08-20T13:36:51Z", "path": "Spigot-Server-Patches/0553-Add-Wandering-Trader-spawn-rate-config-options.patch", "diffHunk": "@@ -0,0 +1,128 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: jmp <jasonpenilla2@me.com>\n+Date: Wed, 19 Aug 2020 23:33:43 -0700\n+Subject: [PATCH] Add Wandering Trader spawn rate config options\n+\n+Removes usages of the Vanilla wanderingTraderSpawnDelay and wanderingTraderSpawnChance values from the level.dat.\n+These were only used in some places, with hardcoded values in others (there are reports online of odd behaviour which match this).\n+This patch also simplifies the spawn delay logic and allows for arbitrary tick delays set in the Paper world config\n+(vanilla 24000 / 20 mins / 1 mc day), as well as adds config options for the minimum spawn chance, maximum spawn chance, and the\n+spawn chance increment on failed spawn attempts. These values are all easy to grasp and configure after a quick glance at\n+this page on the Minecraft wiki: https://minecraft.gamepedia.com/Wandering_Trader#Spawning\n+\n+diff --git a/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java b/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java\n+index d5a1ade21749bba420257f3ece7878f32148d6ff..d940481880155d97b992c045b801b820ed4c6532 100644\n+--- a/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java\n++++ b/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java\n+@@ -654,4 +654,15 @@ public class PaperWorldConfig {\n+             maxLightningFlashDistance = 512; // Vanilla value\n+         }\n+     }\n++\n++    public int villagerTraderSpawnAttemptDelay = 24000;\n++    public int villagerTraderSpawnChanceFailureIncrement = 25;\n++    public int villagerTraderSpawnChanceMin = 25;\n++    public int villagerTraderSpawnChanceMax = 75;\n++    private void villagerTraderSettings() {\n++        villagerTraderSpawnAttemptDelay = getInt(\"wandering_trader.spawn-attempt-delay\", villagerTraderSpawnAttemptDelay);\n++        villagerTraderSpawnChanceFailureIncrement = getInt(\"wandering_trader.spawn-chance-failure-increment\", villagerTraderSpawnChanceFailureIncrement);\n++        villagerTraderSpawnChanceMin = getInt(\"wandering_trader.spawn-chance-min\", villagerTraderSpawnChanceMin);\n++        villagerTraderSpawnChanceMin = getInt(\"wandering_trader.spawn-chance-max\", villagerTraderSpawnChanceMax);\n++    }\n+ }\n+diff --git a/src/main/java/net/minecraft/server/MobSpawnerTrader.java b/src/main/java/net/minecraft/server/MobSpawnerTrader.java\n+index 502cb0ea40b5df1962c5a6d4b57d34de9d413e7f..419baf0e5aba3d0b31d2dbb95feb2d58e411fc60 100644\n+--- a/src/main/java/net/minecraft/server/MobSpawnerTrader.java\n++++ b/src/main/java/net/minecraft/server/MobSpawnerTrader.java\n+@@ -10,54 +10,62 @@ public class MobSpawnerTrader implements MobSpawner {\n+     private final Random a = new Random();\n+     private final IWorldDataServer b;\n+     private int c;\n+-    private int d;\n++    //private int d; // Paper\n+     private int e;\n+ \n+     public MobSpawnerTrader(IWorldDataServer iworlddataserver) {\n+         this.b = iworlddataserver;\n+-        this.c = 1200;\n+-        this.d = iworlddataserver.v();\n+-        this.e = iworlddataserver.w();\n+-        if (this.d == 0 && this.e == 0) {\n+-            this.d = 24000;\n+-            iworlddataserver.g(this.d);\n+-            this.e = 25;\n+-            iworlddataserver.h(this.e);\n+-        }\n+-\n++        // Paper start\n++        this.c = Integer.MAX_VALUE;\n++        //this.d = iworlddataserver.v();", "originalCommit": "a5abeaa339bb6a7123a382c6a3fa3ef38f8ef0cb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "db2123d6e752463ebf571298e7d1b2a71e58ac62", "url": "https://github.com/PaperMC/Paper/commit/db2123d6e752463ebf571298e7d1b2a71e58ac62", "message": "Add Wandering Trader spawn rate config options\n\nAdds config options for modifying the spawn rates of Wandering Traders. These values are all easy to understand and configure after a quick read of this page on the Minecraft wiki: https://minecraft.gamepedia.com/Wandering_Trader#Spawning\nUsages of the vanilla WanderingTraderSpawnDelay and WanderingTraderSpawnChance values in IWorldServerData are removed as they were only used in certain places, with hardcoded values used in other places.", "committedDate": "2020-08-20T19:20:17Z", "type": "forcePushed"}, {"oid": "14bab67d968fd00cd4c15343f4cc4c82766f2567", "url": "https://github.com/PaperMC/Paper/commit/14bab67d968fd00cd4c15343f4cc4c82766f2567", "message": "Add Wandering Trader spawn rate config options\n\nAdds config options for modifying the spawn rates of Wandering Traders. These values are all easy to understand and configure after a quick read of this page on the Minecraft wiki: https://minecraft.gamepedia.com/Wandering_Trader#Spawning\nUsages of the vanilla WanderingTraderSpawnDelay and WanderingTraderSpawnChance values in IWorldServerData are removed as they were only used in certain places, with hardcoded values used in other places.", "committedDate": "2020-08-25T05:19:16Z", "type": "forcePushed"}, {"oid": "1b66ff5a7f9bb64b0d1e8d857d5a765ba56e0954", "url": "https://github.com/PaperMC/Paper/commit/1b66ff5a7f9bb64b0d1e8d857d5a765ba56e0954", "message": "Add Wandering Trader spawn rate config options", "committedDate": "2020-08-29T01:27:30Z", "type": "forcePushed"}, {"oid": "9d60521a1e510ff2828ec2aadf7daf2b4ad63a53", "url": "https://github.com/PaperMC/Paper/commit/9d60521a1e510ff2828ec2aadf7daf2b4ad63a53", "message": "Add Wandering Trader spawn rate config options", "committedDate": "2020-09-23T02:46:29Z", "type": "forcePushed"}, {"oid": "d181911ee8b99fb97ede5680852e561386471b32", "url": "https://github.com/PaperMC/Paper/commit/d181911ee8b99fb97ede5680852e561386471b32", "message": "Add Wandering Trader spawn rate config options", "committedDate": "2020-09-23T02:51:04Z", "type": "forcePushed"}, {"oid": "ca5e7ed7e80525866071c80a609595d20fd79e66", "url": "https://github.com/PaperMC/Paper/commit/ca5e7ed7e80525866071c80a609595d20fd79e66", "message": "Add Wandering Trader spawn rate config options", "committedDate": "2020-09-23T17:28:11Z", "type": "forcePushed"}, {"oid": "b1371a73c62b5dff0136f3fc490b21c41d0d00dc", "url": "https://github.com/PaperMC/Paper/commit/b1371a73c62b5dff0136f3fc490b21c41d0d00dc", "message": "Add Wandering Trader spawn rate config options", "committedDate": "2020-11-19T19:34:07Z", "type": "commit"}, {"oid": "b1371a73c62b5dff0136f3fc490b21c41d0d00dc", "url": "https://github.com/PaperMC/Paper/commit/b1371a73c62b5dff0136f3fc490b21c41d0d00dc", "message": "Add Wandering Trader spawn rate config options", "committedDate": "2020-11-19T19:34:07Z", "type": "forcePushed"}]}