{"pr_number": 3552, "pr_title": "Track EnderDragon in View Distance", "pr_createdAt": "2020-06-13T01:49:43Z", "pr_url": "https://github.com/PaperMC/Paper/pull/3552", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcwMzY1NA==", "url": "https://github.com/PaperMC/Paper/pull/3552#discussion_r439703654", "bodyText": "defaultRange is 10 for enderdragon", "author": "Spottedleaf", "createdAt": "2020-06-13T03:09:03Z", "path": "Spigot-Server-Patches/0543-Always-track-EnderDragon.patch", "diffHunk": "@@ -0,0 +1,34 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: kickash32 <kickash32@gmail.com>\n+Date: Fri, 12 Jun 2020 21:18:33 -0400\n+Subject: [PATCH] Always track EnderDragon\n+\n+\n+diff --git a/src/main/java/org/spigotmc/TrackingRange.java b/src/main/java/org/spigotmc/TrackingRange.java\n+index 43b5ed8e396e5312f7de1f160f596f58baead28a..eed715c446a3febd660c157029f7445900bbee83 100644\n+--- a/src/main/java/org/spigotmc/TrackingRange.java\n++++ b/src/main/java/org/spigotmc/TrackingRange.java\n+@@ -1,5 +1,6 @@\n+ package org.spigotmc;\n+ \n++import com.destroystokyo.paper.PaperWorldConfig; // Paper\n+ import net.minecraft.server.Entity;\n+ import net.minecraft.server.EntityEnderDragon; // Paper\n+ import net.minecraft.server.EntityExperienceOrb;\n+@@ -23,6 +24,7 @@ public class TrackingRange\n+     public static int getEntityTrackingRange(Entity entity, int defaultRange)\n+     {\n+         SpigotWorldConfig config = entity.world.spigotConfig;\n++        PaperWorldConfig paperConfig = entity.world.paperConfig; // Paper\n+         if ( entity instanceof EntityPlayer )\n+         {\n+             return config.playerTrackingRange;\n+@@ -45,7 +47,7 @@ public class TrackingRange\n+             return config.miscTrackingRange;\n+         } else\n+         {\n+-            if (entity instanceof EntityEnderDragon) return defaultRange; // Paper - enderdragon is exempt", "originalCommit": "5a84a10099c9624766955e738bec6a3c07a4f37a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcwMzgzNg==", "url": "https://github.com/PaperMC/Paper/pull/3552#discussion_r439703836", "bodyText": "can't use config values as these are variable on runtime", "author": "Spottedleaf", "createdAt": "2020-06-13T03:12:07Z", "path": "Spigot-Server-Patches/0543-Always-track-EnderDragon.patch", "diffHunk": "@@ -0,0 +1,34 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: kickash32 <kickash32@gmail.com>\n+Date: Fri, 12 Jun 2020 21:18:33 -0400\n+Subject: [PATCH] Always track EnderDragon\n+\n+\n+diff --git a/src/main/java/org/spigotmc/TrackingRange.java b/src/main/java/org/spigotmc/TrackingRange.java\n+index 43b5ed8e396e5312f7de1f160f596f58baead28a..eed715c446a3febd660c157029f7445900bbee83 100644\n+--- a/src/main/java/org/spigotmc/TrackingRange.java\n++++ b/src/main/java/org/spigotmc/TrackingRange.java\n+@@ -1,5 +1,6 @@\n+ package org.spigotmc;\n+ \n++import com.destroystokyo.paper.PaperWorldConfig; // Paper\n+ import net.minecraft.server.Entity;\n+ import net.minecraft.server.EntityEnderDragon; // Paper\n+ import net.minecraft.server.EntityExperienceOrb;\n+@@ -23,6 +24,7 @@ public class TrackingRange\n+     public static int getEntityTrackingRange(Entity entity, int defaultRange)\n+     {\n+         SpigotWorldConfig config = entity.world.spigotConfig;\n++        PaperWorldConfig paperConfig = entity.world.paperConfig; // Paper\n+         if ( entity instanceof EntityPlayer )\n+         {\n+             return config.playerTrackingRange;\n+@@ -45,7 +47,7 @@ public class TrackingRange\n+             return config.miscTrackingRange;\n+         } else\n+         {\n+-            if (entity instanceof EntityEnderDragon) return defaultRange; // Paper - enderdragon is exempt\n++            if (entity instanceof EntityEnderDragon) return Math.max(Math.max(config.viewDistance * 16, defaultRange),  paperConfig.noTickViewDistance); // Paper - enderdragon is exempt", "originalCommit": "5a84a10099c9624766955e738bec6a3c07a4f37a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NjQ0Ng==", "url": "https://github.com/PaperMC/Paper/pull/3552#discussion_r439746446", "bodyText": "This took me too long to figure out what you were talking about x.x", "author": "kickash32", "createdAt": "2020-06-13T15:15:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcwMzgzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDIzMjA3Ng==", "url": "https://github.com/PaperMC/Paper/pull/3552#discussion_r440232076", "bodyText": "Isn't this meant to be no-tick-view?\n\nif the view distance or no-tick view distance is set higher than 10, the enderdragon can be invisible even though the chunks it is in are visible.\n\n(emphasis mine)", "author": "A248", "createdAt": "2020-06-15T14:49:37Z", "path": "Spigot-Server-Patches/0543-Always-track-EnderDragon.patch", "diffHunk": "@@ -0,0 +1,27 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: kickash32 <kickash32@gmail.com>\n+Date: Fri, 12 Jun 2020 21:18:33 -0400\n+Subject: [PATCH] Always track EnderDragon\n+\n+\n+diff --git a/src/main/java/org/spigotmc/TrackingRange.java b/src/main/java/org/spigotmc/TrackingRange.java\n+index 43b5ed8e396e5312f7de1f160f596f58baead28a..2ba1c1b9160e8d24cb338fa9b6b844423119dc73 100644\n+--- a/src/main/java/org/spigotmc/TrackingRange.java\n++++ b/src/main/java/org/spigotmc/TrackingRange.java\n+@@ -2,6 +2,7 @@ package org.spigotmc;\n+ \n+ import net.minecraft.server.Entity;\n+ import net.minecraft.server.EntityEnderDragon; // Paper\n++import net.minecraft.server.WorldServer; // Paper\n+ import net.minecraft.server.EntityExperienceOrb;\n+ import net.minecraft.server.EntityGhast;\n+ import net.minecraft.server.EntityItem;\n+@@ -45,7 +46,7 @@ public class TrackingRange\n+             return config.miscTrackingRange;\n+         } else\n+         {\n+-            if (entity instanceof EntityEnderDragon) return defaultRange; // Paper - enderdragon is exempt\n++            if (entity instanceof EntityEnderDragon) return ((WorldServer)(entity.getWorld())).getChunkProvider().playerChunkMap.getLoadViewDistance(); // Paper - enderdragon is exempt", "originalCommit": "5ca93d290cffd97fb3fa81978f23da8d1732a315", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1Njg5NA==", "url": "https://github.com/PaperMC/Paper/pull/3552#discussion_r443156894", "bodyText": "load is no tick + 1", "author": "aikar", "createdAt": "2020-06-20T20:14:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDIzMjA3Ng=="}], "type": "inlineReview"}, {"oid": "246af15ddcca03cdad00956819ec3e14983a2910", "url": "https://github.com/PaperMC/Paper/commit/246af15ddcca03cdad00956819ec3e14983a2910", "message": "Track Ender Dragon at current (no tick) view distance", "committedDate": "2020-06-20T20:20:00Z", "type": "commit"}, {"oid": "246af15ddcca03cdad00956819ec3e14983a2910", "url": "https://github.com/PaperMC/Paper/commit/246af15ddcca03cdad00956819ec3e14983a2910", "message": "Track Ender Dragon at current (no tick) view distance", "committedDate": "2020-06-20T20:20:00Z", "type": "forcePushed"}]}