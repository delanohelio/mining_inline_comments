{"pr_number": 4210, "pr_title": "Fix Entity Teleportation and cancel velocity if teleported", "pr_createdAt": "2020-08-26T01:49:55Z", "pr_url": "https://github.com/PaperMC/Paper/pull/4210", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI0NDQ2Mg==", "url": "https://github.com/PaperMC/Paper/pull/4210#discussion_r478244462", "bodyText": "Vec3D.a otherwise ram go kaboom", "author": "MrIvanPlays", "createdAt": "2020-08-27T08:24:37Z", "path": "Spigot-Server-Patches/0565-Fix-Entity-Teleportation-and-cancel-velocity-if-tele.patch", "diffHunk": "@@ -0,0 +1,57 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Aikar <aikar@aikar.co>\n+Date: Tue, 25 Aug 2020 20:45:36 -0400\n+Subject: [PATCH] Fix Entity Teleportation and cancel velocity if teleported\n+\n+Uses correct setPositionRotation for Entity teleporting instead of setLocation\n+as this is how Vanilla teleports entities.\n+\n+Cancel any pending motion when teleported.\n+\n+diff --git a/src/main/java/net/minecraft/server/Entity.java b/src/main/java/net/minecraft/server/Entity.java\n+index 97e61dae7927d7da18fcb23d9e4bf639234af4a5..f34eed12718e1a83d8a203abea72760476c84c5d 100644\n+--- a/src/main/java/net/minecraft/server/Entity.java\n++++ b/src/main/java/net/minecraft/server/Entity.java\n+@@ -1318,6 +1318,7 @@ public abstract class Entity implements INamableTileEntity, ICommandListener, Ke\n+     }\n+ \n+     public void setPositionRotation(double d0, double d1, double d2, float f, float f1) {\n++        this.mot = new Vec3D(0, 0, 0); // Paper - cancel entity velocity if teleported", "originalCommit": "84fd1b6314490d34746e8468bde5a2b8a3bd54e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI4ODg5MQ==", "url": "https://github.com/PaperMC/Paper/pull/4210#discussion_r478288891", "bodyText": "I'd say it's likely that the variable is modified in place elsewhere to avoid many more allocations; wouldn't wanna modify a global shared with all entities' movements...", "author": "Proximyst", "createdAt": "2020-08-27T09:39:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI0NDQ2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI5MDM0Mg==", "url": "https://github.com/PaperMC/Paper/pull/4210#discussion_r478290342", "bodyText": "That object is immutable anyways, any sort of add function or similar will always create a new Vec3D object (so using the static zero vector should be fine)", "author": "kennytv", "createdAt": "2020-08-27T09:41:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI0NDQ2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQyODU4Mw==", "url": "https://github.com/PaperMC/Paper/pull/4210#discussion_r478428583", "bodyText": "Vec3D's are spam created every single movement operation, so this usage is like 5% or less comparative to that.\nSo no it won't \"go boom\", as these call sites are lower velocity. but yes it could be the static version.", "author": "aikar", "createdAt": "2020-08-27T13:42:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI0NDQ2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQzOTQ3Mw==", "url": "https://github.com/PaperMC/Paper/pull/4210#discussion_r478439473", "bodyText": "as you say but i think using the one already in memory is better.", "author": "MrIvanPlays", "createdAt": "2020-08-27T13:57:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI0NDQ2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQ0NTI1MQ==", "url": "https://github.com/PaperMC/Paper/pull/4210#discussion_r478445251", "bodyText": "The conversation was left unresolved and he did admit it could (and probably will) be the static version. You agree on it...", "author": "Proximyst", "createdAt": "2020-08-27T14:05:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI0NDQ2Mg=="}], "type": "inlineReview"}, {"oid": "6cf4a9a359fd598b57d8518e99965b253a972364", "url": "https://github.com/PaperMC/Paper/commit/6cf4a9a359fd598b57d8518e99965b253a972364", "message": "Fix Entity Teleportation and cancel velocity if teleported\n\nUses correct setPositionRotation for Entity teleporting instead of setLocation\nas this is how Vanilla teleports entities.\n\nCancel any pending motion when teleported.", "committedDate": "2020-08-27T21:43:28Z", "type": "forcePushed"}, {"oid": "c123ab69e3d6a43f7b2c06525c861405902a3c17", "url": "https://github.com/PaperMC/Paper/commit/c123ab69e3d6a43f7b2c06525c861405902a3c17", "message": "Fix Entity Teleportation and cancel velocity if teleported\n\nUses correct setPositionRotation for Entity teleporting instead of setLocation\nas this is how Vanilla teleports entities.\n\nCancel any pending motion when teleported.", "committedDate": "2020-08-28T15:22:52Z", "type": "forcePushed"}, {"oid": "12f276b7db6c463ebd7d9d33a8a56ee214d6dd77", "url": "https://github.com/PaperMC/Paper/commit/12f276b7db6c463ebd7d9d33a8a56ee214d6dd77", "message": "Fix Entity Teleportation and cancel velocity if teleported\n\nUses correct setPositionRotation for Entity teleporting instead of setLocation\nas this is how Vanilla teleports entities.\n\nCancel any pending motion when teleported.", "committedDate": "2020-08-31T15:53:36Z", "type": "forcePushed"}, {"oid": "057edab75a7786d00a4f76d4c6444635eab2c0ec", "url": "https://github.com/PaperMC/Paper/commit/057edab75a7786d00a4f76d4c6444635eab2c0ec", "message": "Fix Entity Teleportation and cancel velocity if teleported\n\nUses correct setPositionRotation for Entity teleporting instead of setLocation\nas this is how Vanilla teleports entities.\n\nCancel any pending motion when teleported.", "committedDate": "2020-08-31T15:55:10Z", "type": "commit"}, {"oid": "057edab75a7786d00a4f76d4c6444635eab2c0ec", "url": "https://github.com/PaperMC/Paper/commit/057edab75a7786d00a4f76d4c6444635eab2c0ec", "message": "Fix Entity Teleportation and cancel velocity if teleported\n\nUses correct setPositionRotation for Entity teleporting instead of setLocation\nas this is how Vanilla teleports entities.\n\nCancel any pending motion when teleported.", "committedDate": "2020-08-31T15:55:10Z", "type": "forcePushed"}]}