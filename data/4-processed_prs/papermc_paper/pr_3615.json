{"pr_number": 3615, "pr_title": "Add PlayerChangeBeaconEffectEvent", "pr_createdAt": "2020-06-24T23:26:39Z", "pr_url": "https://github.com/PaperMC/Paper/pull/3615", "timeline": [{"oid": "20e92f90d42fbd25ab3fdd457c1ee3611ede1a44", "url": "https://github.com/PaperMC/Paper/commit/20e92f90d42fbd25ab3fdd457c1ee3611ede1a44", "message": "Disable the memory information in /tps unless argument is passed\n\nMemory usage is a pretty useless value in any modern garbage collector\nas the way memory is used makes this information not representive of\nany actionable data.\n\nIn the recommended GC flags, this memory value will constantly rise until\nit is near max and then goes down. This is perfectly normal and expected.\n\nHaving this information shown will lead to confusion.\n\nPlus, many servers give this command to end users, which now really might\nnot want to expose this memory data.\n\nSo this disables it unless /tps mem is used, and also requires a permission\nnode to even run this subcommand.", "committedDate": "2020-06-28T05:34:28Z", "type": "forcePushed"}, {"oid": "7464e6327a1d0d1b841d83972831e93a70971b97", "url": "https://github.com/PaperMC/Paper/commit/7464e6327a1d0d1b841d83972831e93a70971b97", "message": "update to 1.16", "committedDate": "2020-09-12T04:37:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc3MzE1MQ==", "url": "https://github.com/PaperMC/Paper/pull/3615#discussion_r497773151", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            +package com.destroystokyo.paper.event.player;\n          \n          \n            \n            +package io.papermc.paper.event.player;", "author": "Proximyst", "createdAt": "2020-09-30T20:14:03Z", "path": "Spigot-API-Patches/0214-Added-PlayerChangeBeaconEffectEvent.patch", "diffHunk": "@@ -0,0 +1,114 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Jake Potrebic <jake.m.potrebic@gmail.com>\n+Date: Wed, 24 Jun 2020 15:12:18 -0600\n+Subject: [PATCH] Added PlayerChangeBeaconEffectEvent\n+\n+\n+diff --git a/src/main/java/com/destroystokyo/paper/event/player/PlayerChangeBeaconEffectEvent.java b/src/main/java/com/destroystokyo/paper/event/player/PlayerChangeBeaconEffectEvent.java\n+new file mode 100644\n+index 0000000000000000000000000000000000000000..0d861a44549dbbaa38f5a6e66762d4d32c7f1ac0\n+--- /dev/null\n++++ b/src/main/java/com/destroystokyo/paper/event/player/PlayerChangeBeaconEffectEvent.java\n+@@ -0,0 +1,102 @@\n++package com.destroystokyo.paper.event.player;", "originalCommit": "7464e6327a1d0d1b841d83972831e93a70971b97", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc3MzM0Ng==", "url": "https://github.com/PaperMC/Paper/pull/3615#discussion_r497773346", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            + * Called when a player sets the effect for a beacon\n          \n          \n            \n            + *\n          \n          \n            \n            + */\n          \n          \n            \n            + * Called when a player sets the effect for a beacon\n          \n          \n            \n            + */", "author": "Proximyst", "createdAt": "2020-09-30T20:14:29Z", "path": "Spigot-API-Patches/0214-Added-PlayerChangeBeaconEffectEvent.patch", "diffHunk": "@@ -0,0 +1,114 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Jake Potrebic <jake.m.potrebic@gmail.com>\n+Date: Wed, 24 Jun 2020 15:12:18 -0600\n+Subject: [PATCH] Added PlayerChangeBeaconEffectEvent\n+\n+\n+diff --git a/src/main/java/com/destroystokyo/paper/event/player/PlayerChangeBeaconEffectEvent.java b/src/main/java/com/destroystokyo/paper/event/player/PlayerChangeBeaconEffectEvent.java\n+new file mode 100644\n+index 0000000000000000000000000000000000000000..0d861a44549dbbaa38f5a6e66762d4d32c7f1ac0\n+--- /dev/null\n++++ b/src/main/java/com/destroystokyo/paper/event/player/PlayerChangeBeaconEffectEvent.java\n+@@ -0,0 +1,102 @@\n++package com.destroystokyo.paper.event.player;\n++\n++import org.bukkit.entity.Player;\n++import org.bukkit.event.Cancellable;\n++import org.bukkit.event.HandlerList;\n++import org.bukkit.event.player.PlayerEvent;\n++import org.bukkit.potion.PotionEffectType;\n++import org.jetbrains.annotations.NotNull;\n++import org.jetbrains.annotations.Nullable;\n++\n++/**\n++ * Called when a player sets the effect for a beacon\n++ *\n++ */", "originalCommit": "7464e6327a1d0d1b841d83972831e93a70971b97", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc3MzUyNA==", "url": "https://github.com/PaperMC/Paper/pull/3615#discussion_r497773524", "bodyText": "Inline this.", "author": "Proximyst", "createdAt": "2020-09-30T20:14:48Z", "path": "Spigot-API-Patches/0214-Added-PlayerChangeBeaconEffectEvent.patch", "diffHunk": "@@ -0,0 +1,114 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Jake Potrebic <jake.m.potrebic@gmail.com>\n+Date: Wed, 24 Jun 2020 15:12:18 -0600\n+Subject: [PATCH] Added PlayerChangeBeaconEffectEvent\n+\n+\n+diff --git a/src/main/java/com/destroystokyo/paper/event/player/PlayerChangeBeaconEffectEvent.java b/src/main/java/com/destroystokyo/paper/event/player/PlayerChangeBeaconEffectEvent.java\n+new file mode 100644\n+index 0000000000000000000000000000000000000000..0d861a44549dbbaa38f5a6e66762d4d32c7f1ac0\n+--- /dev/null\n++++ b/src/main/java/com/destroystokyo/paper/event/player/PlayerChangeBeaconEffectEvent.java\n+@@ -0,0 +1,102 @@\n++package com.destroystokyo.paper.event.player;\n++\n++import org.bukkit.entity.Player;\n++import org.bukkit.event.Cancellable;\n++import org.bukkit.event.HandlerList;\n++import org.bukkit.event.player.PlayerEvent;\n++import org.bukkit.potion.PotionEffectType;\n++import org.jetbrains.annotations.NotNull;\n++import org.jetbrains.annotations.Nullable;\n++\n++/**\n++ * Called when a player sets the effect for a beacon\n++ *\n++ */\n++public class PlayerChangeBeaconEffectEvent extends PlayerEvent implements Cancellable {\n++    private static final HandlerList handlers = new HandlerList();\n++\n++    private PotionEffectType primary;\n++    private PotionEffectType secondary;\n++\n++    private boolean isCancelled;\n++\n++    public PlayerChangeBeaconEffectEvent(@NotNull Player player, @NotNull PotionEffectType primary, @NotNull PotionEffectType secondary) {\n++        super(player);\n++        this.primary = primary;\n++        this.secondary = secondary;\n++        this.isCancelled = false;", "originalCommit": "7464e6327a1d0d1b841d83972831e93a70971b97", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjIwODU0Ng==", "url": "https://github.com/PaperMC/Paper/pull/3615#discussion_r516208546", "bodyText": "You mean put them all on the same line?", "author": "Machine-Maker", "createdAt": "2020-11-02T19:34:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc3MzUyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc3Mzg5OQ==", "url": "https://github.com/PaperMC/Paper/pull/3615#discussion_r497773899", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            +     * @param primary the primary effect\n          \n          \n            \n            +\n          \n          \n            \n            +     * @param primary the primary effect", "author": "Proximyst", "createdAt": "2020-09-30T20:15:28Z", "path": "Spigot-API-Patches/0214-Added-PlayerChangeBeaconEffectEvent.patch", "diffHunk": "@@ -0,0 +1,114 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Jake Potrebic <jake.m.potrebic@gmail.com>\n+Date: Wed, 24 Jun 2020 15:12:18 -0600\n+Subject: [PATCH] Added PlayerChangeBeaconEffectEvent\n+\n+\n+diff --git a/src/main/java/com/destroystokyo/paper/event/player/PlayerChangeBeaconEffectEvent.java b/src/main/java/com/destroystokyo/paper/event/player/PlayerChangeBeaconEffectEvent.java\n+new file mode 100644\n+index 0000000000000000000000000000000000000000..0d861a44549dbbaa38f5a6e66762d4d32c7f1ac0\n+--- /dev/null\n++++ b/src/main/java/com/destroystokyo/paper/event/player/PlayerChangeBeaconEffectEvent.java\n+@@ -0,0 +1,102 @@\n++package com.destroystokyo.paper.event.player;\n++\n++import org.bukkit.entity.Player;\n++import org.bukkit.event.Cancellable;\n++import org.bukkit.event.HandlerList;\n++import org.bukkit.event.player.PlayerEvent;\n++import org.bukkit.potion.PotionEffectType;\n++import org.jetbrains.annotations.NotNull;\n++import org.jetbrains.annotations.Nullable;\n++\n++/**\n++ * Called when a player sets the effect for a beacon\n++ *\n++ */\n++public class PlayerChangeBeaconEffectEvent extends PlayerEvent implements Cancellable {\n++    private static final HandlerList handlers = new HandlerList();\n++\n++    private PotionEffectType primary;\n++    private PotionEffectType secondary;\n++\n++    private boolean isCancelled;\n++\n++    public PlayerChangeBeaconEffectEvent(@NotNull Player player, @NotNull PotionEffectType primary, @NotNull PotionEffectType secondary) {\n++        super(player);\n++        this.primary = primary;\n++        this.secondary = secondary;\n++        this.isCancelled = false;\n++    }\n++\n++    /**\n++     * @return the primary effect\n++     */\n++    @Nullable public PotionEffectType getPrimary() {\n++        return primary;\n++    }\n++\n++    /**\n++     * Sets the primary effect\n++     * <p>\n++     * NOTE: The primary effect still has to be one of the valid effects for a beacon.\n++     * @param primary the primary effect", "originalCommit": "7464e6327a1d0d1b841d83972831e93a70971b97", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc3Mzk3NA==", "url": "https://github.com/PaperMC/Paper/pull/3615#discussion_r497773974", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            +     * @param secondary the secondary effect\n          \n          \n            \n            +\n          \n          \n            \n            +     * @param secondary the secondary effect", "author": "Proximyst", "createdAt": "2020-09-30T20:15:37Z", "path": "Spigot-API-Patches/0214-Added-PlayerChangeBeaconEffectEvent.patch", "diffHunk": "@@ -0,0 +1,114 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Jake Potrebic <jake.m.potrebic@gmail.com>\n+Date: Wed, 24 Jun 2020 15:12:18 -0600\n+Subject: [PATCH] Added PlayerChangeBeaconEffectEvent\n+\n+\n+diff --git a/src/main/java/com/destroystokyo/paper/event/player/PlayerChangeBeaconEffectEvent.java b/src/main/java/com/destroystokyo/paper/event/player/PlayerChangeBeaconEffectEvent.java\n+new file mode 100644\n+index 0000000000000000000000000000000000000000..0d861a44549dbbaa38f5a6e66762d4d32c7f1ac0\n+--- /dev/null\n++++ b/src/main/java/com/destroystokyo/paper/event/player/PlayerChangeBeaconEffectEvent.java\n+@@ -0,0 +1,102 @@\n++package com.destroystokyo.paper.event.player;\n++\n++import org.bukkit.entity.Player;\n++import org.bukkit.event.Cancellable;\n++import org.bukkit.event.HandlerList;\n++import org.bukkit.event.player.PlayerEvent;\n++import org.bukkit.potion.PotionEffectType;\n++import org.jetbrains.annotations.NotNull;\n++import org.jetbrains.annotations.Nullable;\n++\n++/**\n++ * Called when a player sets the effect for a beacon\n++ *\n++ */\n++public class PlayerChangeBeaconEffectEvent extends PlayerEvent implements Cancellable {\n++    private static final HandlerList handlers = new HandlerList();\n++\n++    private PotionEffectType primary;\n++    private PotionEffectType secondary;\n++\n++    private boolean isCancelled;\n++\n++    public PlayerChangeBeaconEffectEvent(@NotNull Player player, @NotNull PotionEffectType primary, @NotNull PotionEffectType secondary) {\n++        super(player);\n++        this.primary = primary;\n++        this.secondary = secondary;\n++        this.isCancelled = false;\n++    }\n++\n++    /**\n++     * @return the primary effect\n++     */\n++    @Nullable public PotionEffectType getPrimary() {\n++        return primary;\n++    }\n++\n++    /**\n++     * Sets the primary effect\n++     * <p>\n++     * NOTE: The primary effect still has to be one of the valid effects for a beacon.\n++     * @param primary the primary effect\n++     */\n++    public void setPrimary(@Nullable PotionEffectType primary) {\n++        this.primary = primary;\n++    }\n++\n++    /**\n++     * @return the secondary effect\n++     */\n++    @Nullable public PotionEffectType getSecondary() {\n++        return secondary;\n++    }\n++\n++    /**\n++     * Sets the secondary effect\n++     * <p>\n++     * This only has an effect when the beacon is able to accept a secondary effect.\n++     * NOTE: The secondary effect still has to be a valid effect for a beacon.\n++     * @param secondary the secondary effect", "originalCommit": "7464e6327a1d0d1b841d83972831e93a70971b97", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc3NDIzOA==", "url": "https://github.com/PaperMC/Paper/pull/3615#discussion_r497774238", "bodyText": "Unless I'm missing something, this should be commented with Paper start & Paper end.", "author": "Proximyst", "createdAt": "2020-09-30T20:16:13Z", "path": "Spigot-Server-Patches/0524-Added-firing-of-PlayerChangeBeaconEffectEvent.patch", "diffHunk": "@@ -0,0 +1,57 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Jake Potrebic <jake.m.potrebic@gmail.com>\n+Date: Wed, 24 Jun 2020 15:14:51 -0600\n+Subject: [PATCH] Added firing of PlayerChangeBeaconEffectEvent\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/PlayerConnection.java b/src/main/java/net/minecraft/server/PlayerConnection.java\n+index 10e3bf60f13fbc8e26071bcfe8d19cbb635662a9..77c23c2f38c0778fe01820366612fc9b17414f35 100644\n+--- a/src/main/java/net/minecraft/server/PlayerConnection.java\n++++ b/src/main/java/net/minecraft/server/PlayerConnection.java\n+@@ -1,5 +1,6 @@\n+ package net.minecraft.server;\n+ \n++import com.destroystokyo.paper.event.player.PlayerChangeBeaconEffectEvent;\n+ import com.google.common.primitives.Doubles;\n+ import com.google.common.primitives.Floats;\n+ import com.mojang.brigadier.ParseResults;\n+@@ -26,6 +27,7 @@ import org.bukkit.Location;\n+ import org.bukkit.craftbukkit.entity.CraftPlayer;\n+ import org.bukkit.craftbukkit.event.CraftEventFactory;\n+ import org.bukkit.craftbukkit.inventory.CraftItemStack;\n++import org.bukkit.craftbukkit.potion.CraftPotionEffectType;\n+ import org.bukkit.craftbukkit.util.CraftChatMessage;\n+ import org.bukkit.craftbukkit.util.CraftMagicNumbers;\n+ import org.bukkit.craftbukkit.util.LazyPlayerSet;\n+@@ -58,6 +60,8 @@ import org.bukkit.event.player.PlayerToggleSprintEvent;\n+ import org.bukkit.inventory.CraftingInventory;\n+ import org.bukkit.inventory.EquipmentSlot;\n+ import org.bukkit.inventory.InventoryView;\n++import org.bukkit.potion.PotionEffect;\n++import org.bukkit.potion.PotionEffectType;\n+ import org.bukkit.util.NumberConversions;\n+ import com.destroystokyo.paper.event.player.IllegalPacketEvent; // Paper\n+ import com.destroystokyo.paper.event.player.PlayerJumpEvent; // Paper\n+@@ -728,9 +732,20 @@ public class PlayerConnection implements PacketListenerPlayIn {\n+     public void a(PacketPlayInBeacon packetplayinbeacon) {\n+         PlayerConnectionUtils.ensureMainThread(packetplayinbeacon, this, this.player.getWorldServer());\n+         if (this.player.activeContainer instanceof ContainerBeacon) {\n+-            ((ContainerBeacon) this.player.activeContainer).c(packetplayinbeacon.b(), packetplayinbeacon.c());\n+-        }\n++            ContainerBeacon containerBeacon = (ContainerBeacon) this.player.activeContainer;", "originalCommit": "7464e6327a1d0d1b841d83972831e93a70971b97", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc3NDQ2Nw==", "url": "https://github.com/PaperMC/Paper/pull/3615#discussion_r497774467", "bodyText": "obfhelpers", "author": "Proximyst", "createdAt": "2020-09-30T20:16:38Z", "path": "Spigot-Server-Patches/0524-Added-firing-of-PlayerChangeBeaconEffectEvent.patch", "diffHunk": "@@ -0,0 +1,57 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Jake Potrebic <jake.m.potrebic@gmail.com>\n+Date: Wed, 24 Jun 2020 15:14:51 -0600\n+Subject: [PATCH] Added firing of PlayerChangeBeaconEffectEvent\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/PlayerConnection.java b/src/main/java/net/minecraft/server/PlayerConnection.java\n+index 10e3bf60f13fbc8e26071bcfe8d19cbb635662a9..77c23c2f38c0778fe01820366612fc9b17414f35 100644\n+--- a/src/main/java/net/minecraft/server/PlayerConnection.java\n++++ b/src/main/java/net/minecraft/server/PlayerConnection.java\n+@@ -1,5 +1,6 @@\n+ package net.minecraft.server;\n+ \n++import com.destroystokyo.paper.event.player.PlayerChangeBeaconEffectEvent;\n+ import com.google.common.primitives.Doubles;\n+ import com.google.common.primitives.Floats;\n+ import com.mojang.brigadier.ParseResults;\n+@@ -26,6 +27,7 @@ import org.bukkit.Location;\n+ import org.bukkit.craftbukkit.entity.CraftPlayer;\n+ import org.bukkit.craftbukkit.event.CraftEventFactory;\n+ import org.bukkit.craftbukkit.inventory.CraftItemStack;\n++import org.bukkit.craftbukkit.potion.CraftPotionEffectType;\n+ import org.bukkit.craftbukkit.util.CraftChatMessage;\n+ import org.bukkit.craftbukkit.util.CraftMagicNumbers;\n+ import org.bukkit.craftbukkit.util.LazyPlayerSet;\n+@@ -58,6 +60,8 @@ import org.bukkit.event.player.PlayerToggleSprintEvent;\n+ import org.bukkit.inventory.CraftingInventory;\n+ import org.bukkit.inventory.EquipmentSlot;\n+ import org.bukkit.inventory.InventoryView;\n++import org.bukkit.potion.PotionEffect;\n++import org.bukkit.potion.PotionEffectType;\n+ import org.bukkit.util.NumberConversions;\n+ import com.destroystokyo.paper.event.player.IllegalPacketEvent; // Paper\n+ import com.destroystokyo.paper.event.player.PlayerJumpEvent; // Paper\n+@@ -728,9 +732,20 @@ public class PlayerConnection implements PacketListenerPlayIn {\n+     public void a(PacketPlayInBeacon packetplayinbeacon) {\n+         PlayerConnectionUtils.ensureMainThread(packetplayinbeacon, this, this.player.getWorldServer());\n+         if (this.player.activeContainer instanceof ContainerBeacon) {\n+-            ((ContainerBeacon) this.player.activeContainer).c(packetplayinbeacon.b(), packetplayinbeacon.c());\n+-        }\n++            ContainerBeacon containerBeacon = (ContainerBeacon) this.player.activeContainer;\n++\n++            PotionEffectType primary = PotionEffectType.getById(packetplayinbeacon.b());\n++            PotionEffectType secondary = PotionEffectType.getById(packetplayinbeacon.c());", "originalCommit": "7464e6327a1d0d1b841d83972831e93a70971b97", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc3NDU3NA==", "url": "https://github.com/PaperMC/Paper/pull/3615#discussion_r497774574", "bodyText": "obfhelper", "author": "Proximyst", "createdAt": "2020-09-30T20:16:50Z", "path": "Spigot-Server-Patches/0524-Added-firing-of-PlayerChangeBeaconEffectEvent.patch", "diffHunk": "@@ -0,0 +1,57 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Jake Potrebic <jake.m.potrebic@gmail.com>\n+Date: Wed, 24 Jun 2020 15:14:51 -0600\n+Subject: [PATCH] Added firing of PlayerChangeBeaconEffectEvent\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/PlayerConnection.java b/src/main/java/net/minecraft/server/PlayerConnection.java\n+index 10e3bf60f13fbc8e26071bcfe8d19cbb635662a9..77c23c2f38c0778fe01820366612fc9b17414f35 100644\n+--- a/src/main/java/net/minecraft/server/PlayerConnection.java\n++++ b/src/main/java/net/minecraft/server/PlayerConnection.java\n+@@ -1,5 +1,6 @@\n+ package net.minecraft.server;\n+ \n++import com.destroystokyo.paper.event.player.PlayerChangeBeaconEffectEvent;\n+ import com.google.common.primitives.Doubles;\n+ import com.google.common.primitives.Floats;\n+ import com.mojang.brigadier.ParseResults;\n+@@ -26,6 +27,7 @@ import org.bukkit.Location;\n+ import org.bukkit.craftbukkit.entity.CraftPlayer;\n+ import org.bukkit.craftbukkit.event.CraftEventFactory;\n+ import org.bukkit.craftbukkit.inventory.CraftItemStack;\n++import org.bukkit.craftbukkit.potion.CraftPotionEffectType;\n+ import org.bukkit.craftbukkit.util.CraftChatMessage;\n+ import org.bukkit.craftbukkit.util.CraftMagicNumbers;\n+ import org.bukkit.craftbukkit.util.LazyPlayerSet;\n+@@ -58,6 +60,8 @@ import org.bukkit.event.player.PlayerToggleSprintEvent;\n+ import org.bukkit.inventory.CraftingInventory;\n+ import org.bukkit.inventory.EquipmentSlot;\n+ import org.bukkit.inventory.InventoryView;\n++import org.bukkit.potion.PotionEffect;\n++import org.bukkit.potion.PotionEffectType;\n+ import org.bukkit.util.NumberConversions;\n+ import com.destroystokyo.paper.event.player.IllegalPacketEvent; // Paper\n+ import com.destroystokyo.paper.event.player.PlayerJumpEvent; // Paper\n+@@ -728,9 +732,20 @@ public class PlayerConnection implements PacketListenerPlayIn {\n+     public void a(PacketPlayInBeacon packetplayinbeacon) {\n+         PlayerConnectionUtils.ensureMainThread(packetplayinbeacon, this, this.player.getWorldServer());\n+         if (this.player.activeContainer instanceof ContainerBeacon) {\n+-            ((ContainerBeacon) this.player.activeContainer).c(packetplayinbeacon.b(), packetplayinbeacon.c());\n+-        }\n++            ContainerBeacon containerBeacon = (ContainerBeacon) this.player.activeContainer;\n++\n++            PotionEffectType primary = PotionEffectType.getById(packetplayinbeacon.b());\n++            PotionEffectType secondary = PotionEffectType.getById(packetplayinbeacon.c());\n+ \n++            PlayerChangeBeaconEffectEvent event = new PlayerChangeBeaconEffectEvent(this.getPlayer(), primary, secondary);\n++\n++            if (event.callEvent()) {\n++                int primaryID = event.getPrimary() == null ? 0 : event.getPrimary().getId();\n++                int secondaryID = event.getSecondary() == null ? 0 : event.getSecondary().getId();\n++                containerBeacon.c(primaryID, secondaryID);", "originalCommit": "7464e6327a1d0d1b841d83972831e93a70971b97", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fd81a106cdfd5a320c8e5fe08e1fdcf3c16174aa", "url": "https://github.com/PaperMC/Paper/commit/fd81a106cdfd5a320c8e5fe08e1fdcf3c16174aa", "message": "moved into ContainerBeacon", "committedDate": "2020-11-02T20:57:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjI1NjExNw==", "url": "https://github.com/PaperMC/Paper/pull/3615#discussion_r516256117", "bodyText": "Get rid of the patch for PlayerConnection class.", "author": "JOO200", "createdAt": "2020-11-02T21:11:19Z", "path": "Spigot-Server-Patches/0596-Added-firing-of-PlayerChangeBeaconEffectEvent.patch", "diffHunk": "@@ -0,0 +1,52 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Jake Potrebic <jake.m.potrebic@gmail.com>\n+Date: Wed, 24 Jun 2020 15:14:51 -0600\n+Subject: [PATCH] Added firing of PlayerChangeBeaconEffectEvent\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/ContainerBeacon.java b/src/main/java/net/minecraft/server/ContainerBeacon.java\n+index 288390bf9210f0fcc7c85e3093a4924614dc1573..b4df9e9e4df6b7ca657d812fada1ddb2e654c668 100644\n+--- a/src/main/java/net/minecraft/server/ContainerBeacon.java\n++++ b/src/main/java/net/minecraft/server/ContainerBeacon.java\n+@@ -1,6 +1,11 @@\n+ package net.minecraft.server;\n+ \n+ import org.bukkit.craftbukkit.inventory.CraftInventoryView; // CraftBukkit\n++// Paper start\n++import io.papermc.paper.event.player.PlayerChangeBeaconEffectEvent;\n++import org.bukkit.entity.Player;\n++import org.bukkit.potion.PotionEffectType;\n++// Paper end\n+ \n+ public class ContainerBeacon extends Container {\n+ \n+@@ -128,9 +133,14 @@ public class ContainerBeacon extends Container {\n+ \n+     public void c(int i, int j) {\n+         if (this.d.hasItem()) {\n+-            this.containerProperties.setProperty(1, i);\n+-            this.containerProperties.setProperty(2, j);\n+-            this.d.a(1);\n++            // Paper start\n++            PlayerChangeBeaconEffectEvent event = new PlayerChangeBeaconEffectEvent((Player) this.player.player.getBukkitEntity(), PotionEffectType.getById(i), PotionEffectType.getById(j), this.containerAccess.getLocation().getBlock());\n++            if (event.callEvent()) {\n++                this.containerProperties.setProperty(1, event.getPrimary() == null ? 0 : event.getPrimary().getId());\n++                this.containerProperties.setProperty(2, event.getSecondary() == null ? 0 : event.getSecondary().getId());\n++                this.d.a(1);\n++            }\n++            // Paper end\n+         }\n+ \n+     }\n+diff --git a/src/main/java/net/minecraft/server/PlayerConnection.java b/src/main/java/net/minecraft/server/PlayerConnection.java", "originalCommit": "19eac97749b2970ccc08b5fa4d7f591f813b8feb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjI1NzgwNA==", "url": "https://github.com/PaperMC/Paper/pull/3615#discussion_r516257804", "bodyText": "ugh lol. I thought I got it, missed a newline I guess", "author": "Machine-Maker", "createdAt": "2020-11-02T21:15:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjI1NjExNw=="}], "type": "inlineReview"}, {"oid": "57d613528cebed0d8d6f9fa7c3b4fd1748ce85ec", "url": "https://github.com/PaperMC/Paper/commit/57d613528cebed0d8d6f9fa7c3b4fd1748ce85ec", "message": "moved to end", "committedDate": "2020-11-18T18:34:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI0OTQ5OQ==", "url": "https://github.com/PaperMC/Paper/pull/3615#discussion_r546249499", "bodyText": "Have you looked into whether it'd be possible to alleviate/remove this requirement?", "author": "Proximyst", "createdAt": "2020-12-19T15:19:17Z", "path": "Spigot-API-Patches/0236-Added-PlayerChangeBeaconEffectEvent.patch", "diffHunk": "@@ -0,0 +1,122 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Jake Potrebic <jake.m.potrebic@gmail.com>\n+Date: Wed, 24 Jun 2020 15:12:18 -0600\n+Subject: [PATCH] Added PlayerChangeBeaconEffectEvent\n+\n+\n+diff --git a/src/main/java/io/papermc/paper/event/player/PlayerChangeBeaconEffectEvent.java b/src/main/java/io/papermc/paper/event/player/PlayerChangeBeaconEffectEvent.java\n+new file mode 100644\n+index 0000000000000000000000000000000000000000..d662b99cebb5aa0b2e21c6ba0a076517fa2f48b1\n+--- /dev/null\n++++ b/src/main/java/io/papermc/paper/event/player/PlayerChangeBeaconEffectEvent.java\n+@@ -0,0 +1,110 @@\n++package io.papermc.paper.event.player;\n++\n++import org.bukkit.block.Block;\n++import org.bukkit.entity.Player;\n++import org.bukkit.event.Cancellable;\n++import org.bukkit.event.HandlerList;\n++import org.bukkit.event.player.PlayerEvent;\n++import org.bukkit.potion.PotionEffectType;\n++import org.jetbrains.annotations.NotNull;\n++import org.jetbrains.annotations.Nullable;\n++\n++/**\n++ * Called when a player sets the effect for a beacon\n++ */\n++public class PlayerChangeBeaconEffectEvent extends PlayerEvent implements Cancellable {\n++    private static final HandlerList handlers = new HandlerList();\n++\n++    private PotionEffectType primary;\n++    private PotionEffectType secondary;\n++    private final Block beacon;\n++\n++    private boolean isCancelled;\n++\n++    public PlayerChangeBeaconEffectEvent(@NotNull Player player, @Nullable PotionEffectType primary, @Nullable PotionEffectType secondary, @Nullable Block beacon) {\n++        super(player); this.primary = primary; this.secondary = secondary; this.isCancelled = false; this.beacon = beacon;\n++    }\n++\n++    /**\n++     * @return the primary effect\n++     */\n++    @Nullable public PotionEffectType getPrimary() {\n++        return primary;\n++    }\n++\n++    /**\n++     * Sets the primary effect\n++     * <p>\n++     * NOTE: The primary effect still has to be one of the valid effects for a beacon.", "originalCommit": "57d613528cebed0d8d6f9fa7c3b4fd1748ce85ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI3NTMyNA==", "url": "https://github.com/PaperMC/Paper/pull/3615#discussion_r546275324", "bodyText": "Yeah, it might be possible. Right now, TileEntityBeacon.a just has a final 2d array of possible effects for beacons, and if its not one of those, it just sets the effect to null or no effect. So maybe that's something that can be looked at in the future, but I don't think its in the scope of this PR.", "author": "Machine-Maker", "createdAt": "2020-12-19T19:44:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI0OTQ5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI0OTU0Mg==", "url": "https://github.com/PaperMC/Paper/pull/3615#discussion_r546249542", "bodyText": "\"not take effect\" - will they still be saved, or just never apply? If latter, does this persist cross-reboot?", "author": "Proximyst", "createdAt": "2020-12-19T15:19:47Z", "path": "Spigot-API-Patches/0236-Added-PlayerChangeBeaconEffectEvent.patch", "diffHunk": "@@ -0,0 +1,122 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Jake Potrebic <jake.m.potrebic@gmail.com>\n+Date: Wed, 24 Jun 2020 15:12:18 -0600\n+Subject: [PATCH] Added PlayerChangeBeaconEffectEvent\n+\n+\n+diff --git a/src/main/java/io/papermc/paper/event/player/PlayerChangeBeaconEffectEvent.java b/src/main/java/io/papermc/paper/event/player/PlayerChangeBeaconEffectEvent.java\n+new file mode 100644\n+index 0000000000000000000000000000000000000000..d662b99cebb5aa0b2e21c6ba0a076517fa2f48b1\n+--- /dev/null\n++++ b/src/main/java/io/papermc/paper/event/player/PlayerChangeBeaconEffectEvent.java\n+@@ -0,0 +1,110 @@\n++package io.papermc.paper.event.player;\n++\n++import org.bukkit.block.Block;\n++import org.bukkit.entity.Player;\n++import org.bukkit.event.Cancellable;\n++import org.bukkit.event.HandlerList;\n++import org.bukkit.event.player.PlayerEvent;\n++import org.bukkit.potion.PotionEffectType;\n++import org.jetbrains.annotations.NotNull;\n++import org.jetbrains.annotations.Nullable;\n++\n++/**\n++ * Called when a player sets the effect for a beacon\n++ */\n++public class PlayerChangeBeaconEffectEvent extends PlayerEvent implements Cancellable {\n++    private static final HandlerList handlers = new HandlerList();\n++\n++    private PotionEffectType primary;\n++    private PotionEffectType secondary;\n++    private final Block beacon;\n++\n++    private boolean isCancelled;\n++\n++    public PlayerChangeBeaconEffectEvent(@NotNull Player player, @Nullable PotionEffectType primary, @Nullable PotionEffectType secondary, @Nullable Block beacon) {\n++        super(player); this.primary = primary; this.secondary = secondary; this.isCancelled = false; this.beacon = beacon;\n++    }\n++\n++    /**\n++     * @return the primary effect\n++     */\n++    @Nullable public PotionEffectType getPrimary() {\n++        return primary;\n++    }\n++\n++    /**\n++     * Sets the primary effect\n++     * <p>\n++     * NOTE: The primary effect still has to be one of the valid effects for a beacon.\n++     *\n++     * @param primary the primary effect\n++     */\n++    public void setPrimary(@Nullable PotionEffectType primary) {\n++        this.primary = primary;\n++    }\n++\n++    /**\n++     * @return the secondary effect\n++     */\n++    @Nullable public PotionEffectType getSecondary() {\n++        return secondary;\n++    }\n++\n++    /**\n++     * Sets the secondary effect\n++     * <p>\n++     * This only has an effect when the beacon is able to accept a secondary effect.\n++     * NOTE: The secondary effect still has to be a valid effect for a beacon.\n++     *\n++     * @param secondary the secondary effect\n++     */\n++    public void setSecondary(@Nullable PotionEffectType secondary) {\n++        this.secondary = secondary;\n++    }\n++\n++    /**\n++     * @return the beacon block associated with this event, or null if not found\n++     */\n++    @Nullable\n++    public Block getBeacon() {\n++        return beacon;\n++    }\n++\n++    /**\n++     * Gets the cancellation state of this event. A cancelled event will not\n++     * be executed in the server, but will still pass to other plugins\n++     * <p>\n++     * If a {@link PlayerChangeBeaconEffectEvent} is cancelled, the changes will\n++     * not take effect\n++     *\n++     * @return true if this event is cancelled\n++     */\n++    @Override\n++    public boolean isCancelled() {\n++        return this.isCancelled;\n++    }\n++\n++    /**\n++     * Sets the cancellation state of this event. A cancelled event will not\n++     * be executed in the server, but will still pass to other plugins\n++     * <p>\n++     * If a {@link PlayerChangeBeaconEffectEvent} is cancelled, the changes will\n++     * not take effect", "originalCommit": "57d613528cebed0d8d6f9fa7c3b4fd1748ce85ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI0OTYxMw==", "url": "https://github.com/PaperMC/Paper/pull/3615#discussion_r546249613", "bodyText": "Don't touch this line.", "author": "Proximyst", "createdAt": "2020-12-19T15:20:42Z", "path": "Spigot-Server-Patches/0601-Added-firing-of-PlayerChangeBeaconEffectEvent.patch", "diffHunk": "@@ -0,0 +1,40 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Jake Potrebic <jake.m.potrebic@gmail.com>\n+Date: Wed, 24 Jun 2020 15:14:51 -0600\n+Subject: [PATCH] Added firing of PlayerChangeBeaconEffectEvent\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/ContainerBeacon.java b/src/main/java/net/minecraft/server/ContainerBeacon.java\n+index 288390bf9210f0fcc7c85e3093a4924614dc1573..b4df9e9e4df6b7ca657d812fada1ddb2e654c668 100644\n+--- a/src/main/java/net/minecraft/server/ContainerBeacon.java\n++++ b/src/main/java/net/minecraft/server/ContainerBeacon.java\n+@@ -1,6 +1,11 @@\n+ package net.minecraft.server;\n+ \n+ import org.bukkit.craftbukkit.inventory.CraftInventoryView; // CraftBukkit\n++// Paper start\n++import io.papermc.paper.event.player.PlayerChangeBeaconEffectEvent;\n++import org.bukkit.entity.Player;\n++import org.bukkit.potion.PotionEffectType;\n++// Paper end\n+ \n+ public class ContainerBeacon extends Container {\n+ \n+@@ -128,9 +133,14 @@ public class ContainerBeacon extends Container {\n+ \n+     public void c(int i, int j) {\n+         if (this.d.hasItem()) {\n+-            this.containerProperties.setProperty(1, i);\n+-            this.containerProperties.setProperty(2, j);\n+-            this.d.a(1);\n++            // Paper start\n++            PlayerChangeBeaconEffectEvent event = new PlayerChangeBeaconEffectEvent((Player) this.player.player.getBukkitEntity(), PotionEffectType.getById(i), PotionEffectType.getById(j), this.containerAccess.getLocation().getBlock());\n++            if (event.callEvent()) {\n++                this.containerProperties.setProperty(1, event.getPrimary() == null ? 0 : event.getPrimary().getId());\n++                this.containerProperties.setProperty(2, event.getSecondary() == null ? 0 : event.getSecondary().getId());\n++                this.d.a(1);", "originalCommit": "57d613528cebed0d8d6f9fa7c3b4fd1748ce85ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d895f9893589f4fb8b770fa587f6395a4c41f531", "url": "https://github.com/PaperMC/Paper/commit/d895f9893589f4fb8b770fa587f6395a4c41f531", "message": "proxi suggestions", "committedDate": "2020-12-19T19:44:23Z", "type": "forcePushed"}, {"oid": "dccb044c8afefbb774a8057215b91b156793c4b5", "url": "https://github.com/PaperMC/Paper/commit/dccb044c8afefbb774a8057215b91b156793c4b5", "message": "added Wither API", "committedDate": "2021-01-17T20:11:03Z", "type": "forcePushed"}, {"oid": "24b2248286083f946a4fc470361afb2e95546baf", "url": "https://github.com/PaperMC/Paper/commit/24b2248286083f946a4fc470361afb2e95546baf", "message": "added Wither API", "committedDate": "2021-01-17T20:14:49Z", "type": "forcePushed"}, {"oid": "94ce011e54d15d956399a1c6dc9f3ed3205a02cc", "url": "https://github.com/PaperMC/Paper/commit/94ce011e54d15d956399a1c6dc9f3ed3205a02cc", "message": "Add PlayerChangeBeaconEffectEvent\n\nSigned-off-by: MiniDigger <admin@minidigger.me>", "committedDate": "2021-01-17T20:21:31Z", "type": "commit"}, {"oid": "94ce011e54d15d956399a1c6dc9f3ed3205a02cc", "url": "https://github.com/PaperMC/Paper/commit/94ce011e54d15d956399a1c6dc9f3ed3205a02cc", "message": "Add PlayerChangeBeaconEffectEvent\n\nSigned-off-by: MiniDigger <admin@minidigger.me>", "committedDate": "2021-01-17T20:21:31Z", "type": "forcePushed"}]}