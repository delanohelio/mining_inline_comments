{"pr_number": 4740, "pr_title": "Item no age & no player pickup", "pr_createdAt": "2020-11-07T01:24:36Z", "pr_url": "https://github.com/PaperMC/Paper/pull/4740", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE1MDAxOA==", "url": "https://github.com/PaperMC/Paper/pull/4740#discussion_r519150018", "bodyText": "Why not use constants here?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            +    private final static int noAgeTime = -32768;\n          \n          \n            \n            +    private final static int noAgeTime = (int) Short.MIN_VALUE;", "author": "Proximyst", "createdAt": "2020-11-07T07:57:32Z", "path": "Spigot-Server-Patches/0594-Item-no-age-no-player-pickup.patch", "diffHunk": "@@ -0,0 +1,50 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Alfie Smith <alfie@alfiesmith.net>\n+Date: Sat, 7 Nov 2020 01:20:33 +0000\n+Subject: [PATCH] Item no age & no player pickup\n+\n+\n+diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftItem.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftItem.java\n+index d6a64e4ecf9225f9a93523c50b2f1375296b406e..f34cfc5695c88754d7b78f49be282fb125a1cf94 100644\n+--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftItem.java\n++++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftItem.java\n+@@ -10,6 +10,12 @@ import org.bukkit.entity.Item;\n+ import org.bukkit.inventory.ItemStack;\n+ \n+ public class CraftItem extends CraftEntity implements Item {\n++\n++    // Paper start\n++    private final static int noAgeTime = -32768;", "originalCommit": "30df9ea8abcd7921bdb9d5119523c1a3f57aa505", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE1MDAzOA==", "url": "https://github.com/PaperMC/Paper/pull/4740#discussion_r519150038", "bodyText": "Why not use constants here?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            +    private final static int noPickupTime = 32767;\n          \n          \n            \n            +    private final static int noPickupTime = (int) Short.MAX_VALUE;", "author": "Proximyst", "createdAt": "2020-11-07T07:57:53Z", "path": "Spigot-Server-Patches/0594-Item-no-age-no-player-pickup.patch", "diffHunk": "@@ -0,0 +1,50 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Alfie Smith <alfie@alfiesmith.net>\n+Date: Sat, 7 Nov 2020 01:20:33 +0000\n+Subject: [PATCH] Item no age & no player pickup\n+\n+\n+diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftItem.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftItem.java\n+index d6a64e4ecf9225f9a93523c50b2f1375296b406e..f34cfc5695c88754d7b78f49be282fb125a1cf94 100644\n+--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftItem.java\n++++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftItem.java\n+@@ -10,6 +10,12 @@ import org.bukkit.entity.Item;\n+ import org.bukkit.inventory.ItemStack;\n+ \n+ public class CraftItem extends CraftEntity implements Item {\n++\n++    // Paper start\n++    private final static int noAgeTime = -32768;\n++    private final static int noPickupTime = 32767;", "originalCommit": "30df9ea8abcd7921bdb9d5119523c1a3f57aa505", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE1MDA4Mw==", "url": "https://github.com/PaperMC/Paper/pull/4740#discussion_r519150083", "bodyText": "Isn't this modified every tick to account for specifically ageing?", "author": "Proximyst", "createdAt": "2020-11-07T07:58:41Z", "path": "Spigot-Server-Patches/0594-Item-no-age-no-player-pickup.patch", "diffHunk": "@@ -0,0 +1,50 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Alfie Smith <alfie@alfiesmith.net>\n+Date: Sat, 7 Nov 2020 01:20:33 +0000\n+Subject: [PATCH] Item no age & no player pickup\n+\n+\n+diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftItem.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftItem.java\n+index d6a64e4ecf9225f9a93523c50b2f1375296b406e..f34cfc5695c88754d7b78f49be282fb125a1cf94 100644\n+--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftItem.java\n++++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftItem.java\n+@@ -10,6 +10,12 @@ import org.bukkit.entity.Item;\n+ import org.bukkit.inventory.ItemStack;\n+ \n+ public class CraftItem extends CraftEntity implements Item {\n++\n++    // Paper start\n++    private final static int noAgeTime = -32768;\n++    private final static int noPickupTime = 32767;\n++    // Paper end\n++\n+     private final EntityItem item;\n+ \n+     public CraftItem(CraftServer server, Entity entity, EntityItem item) {\n+@@ -57,6 +63,26 @@ public class CraftItem extends CraftEntity implements Item {\n+     public void setCanMobPickup(boolean canMobPickup) {\n+         item.canMobPickup = canMobPickup;\n+     }\n++\n++     @Override\n++     public boolean canPlayerPickup() {\n++        return item.pickupDelay == noPickupTime;\n++     }\n++\n++     @Override\n++     public void setCanPlayerPickup(boolean noPickup) {\n++        item.pickupDelay = noPickup ? noPickupTime : 0;\n++     }\n++\n++     @Override\n++     public boolean isAgeing() {\n++        return item.age == noAgeTime;\n++     }\n++\n++     @Override\n++     public void setAgeing(boolean ageing) {\n++        item.age = ageing ? 0 : noAgeTime;", "originalCommit": "30df9ea8abcd7921bdb9d5119523c1a3f57aa505", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE4NDA2NQ==", "url": "https://github.com/PaperMC/Paper/pull/4740#discussion_r519184065", "bodyText": "I'm unsure what you mean by this. The age isn't changed if the value age is noAgeTime. It does increment every tick otherwise", "author": "alfiejfs", "createdAt": "2020-11-07T14:41:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE1MDA4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE1MDExOA==", "url": "https://github.com/PaperMC/Paper/pull/4740#discussion_r519150118", "bodyText": "See comment on setAgeing", "author": "Proximyst", "createdAt": "2020-11-07T07:59:04Z", "path": "Spigot-Server-Patches/0594-Item-no-age-no-player-pickup.patch", "diffHunk": "@@ -0,0 +1,50 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Alfie Smith <alfie@alfiesmith.net>\n+Date: Sat, 7 Nov 2020 01:20:33 +0000\n+Subject: [PATCH] Item no age & no player pickup\n+\n+\n+diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftItem.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftItem.java\n+index d6a64e4ecf9225f9a93523c50b2f1375296b406e..f34cfc5695c88754d7b78f49be282fb125a1cf94 100644\n+--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftItem.java\n++++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftItem.java\n+@@ -10,6 +10,12 @@ import org.bukkit.entity.Item;\n+ import org.bukkit.inventory.ItemStack;\n+ \n+ public class CraftItem extends CraftEntity implements Item {\n++\n++    // Paper start\n++    private final static int noAgeTime = -32768;\n++    private final static int noPickupTime = 32767;\n++    // Paper end\n++\n+     private final EntityItem item;\n+ \n+     public CraftItem(CraftServer server, Entity entity, EntityItem item) {\n+@@ -57,6 +63,26 @@ public class CraftItem extends CraftEntity implements Item {\n+     public void setCanMobPickup(boolean canMobPickup) {\n+         item.canMobPickup = canMobPickup;\n+     }\n++\n++     @Override\n++     public boolean canPlayerPickup() {\n++        return item.pickupDelay == noPickupTime;\n++     }\n++\n++     @Override\n++     public void setCanPlayerPickup(boolean noPickup) {\n++        item.pickupDelay = noPickup ? noPickupTime : 0;\n++     }\n++\n++     @Override\n++     public boolean isAgeing() {\n++        return item.age == noAgeTime;", "originalCommit": "30df9ea8abcd7921bdb9d5119523c1a3f57aa505", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDM2NTUxNg==", "url": "https://github.com/PaperMC/Paper/pull/4740#discussion_r520365516", "bodyText": "why is the var name negated here? this is rather confusing, if I want canPlayerPickup to return false, do I have to set noPickup to true? (would be inverted logic)\nlooking at the impl, there seems to be smth wrong, \"return item.pickupDelay == noPickupTime;\" would return true if a player can't pickup the item?\nidk, maybe its just early morning mini logic, but something seems off, maybe others can take a look", "author": "MiniDigger", "createdAt": "2020-11-10T08:12:51Z", "path": "Spigot-API-Patches/0232-Item-no-age-no-player-pickup.patch", "diffHunk": "@@ -0,0 +1,45 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Alfie Smith <alfie@alfiesmith.net>\n+Date: Sat, 7 Nov 2020 01:20:27 +0000\n+Subject: [PATCH] Item no age & no player pickup\n+\n+\n+diff --git a/src/main/java/org/bukkit/entity/Item.java b/src/main/java/org/bukkit/entity/Item.java\n+index c404a5b8efea7c780db5ddae19456753808abb3d..5acbe1504fcdb93540acde0dcb00a9a6362dfc1e 100644\n+--- a/src/main/java/org/bukkit/entity/Item.java\n++++ b/src/main/java/org/bukkit/entity/Item.java\n+@@ -90,5 +90,34 @@ public interface Item extends Entity {\n+      * @param canMobPickup True to allow non-player entity pickup\n+      */\n+     public void setCanMobPickup(boolean canMobPickup);\n++\n++    /**\n++     * Gets whether the player can pickup the item or not\n++     *\n++     * @return whether a player can pickup the item\n++     */\n++    public boolean canPlayerPickup();\n++\n++    /**\n++     * Sets whether the item can be picked up or not. Modifies the pickup delay value to do so.\n++     *\n++     * @param noPickup Whether the item should be able to be picked up\n++     */\n++    public void setCanPlayerPickup(boolean noPickup);", "originalCommit": "2480a0080356a54591635dcb3ace7c92f1abdb65", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUwNzAwMg==", "url": "https://github.com/PaperMC/Paper/pull/4740#discussion_r520507002", "bodyText": "I agree with you on the naming - I will change that to canPlayerPickup. Will probably also change the ageing field as @PaulBGD suggested. You're also correct about the implementation, it is also backwards. Will fix later and update the PR.", "author": "alfiejfs", "createdAt": "2020-11-10T11:56:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDM2NTUxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc2ODYxNQ==", "url": "https://github.com/PaperMC/Paper/pull/4740#discussion_r520768615", "bodyText": "@MiniDigger @Proximyst should be fixed now, though the patch number for server file may be needed to be bumped by one \ud83d\udc4d", "author": "alfiejfs", "createdAt": "2020-11-10T18:11:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDM2NTUxNg=="}], "type": "inlineReview"}, {"oid": "322d50ed40f3bd840699a06aaa7849f67d41f9f5", "url": "https://github.com/PaperMC/Paper/commit/322d50ed40f3bd840699a06aaa7849f67d41f9f5", "message": "Item no age & no player pickup", "committedDate": "2020-11-11T17:31:35Z", "type": "commit"}]}