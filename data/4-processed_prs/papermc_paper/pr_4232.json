{"pr_number": 4232, "pr_title": "Expose the Entity Counter to allow plugins to use valid and non-conflicting Entity Ids", "pr_createdAt": "2020-08-27T23:59:29Z", "pr_url": "https://github.com/PaperMC/Paper/pull/4232", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc4NjU3NA==", "url": "https://github.com/PaperMC/Paper/pull/4232#discussion_r479786574", "bodyText": "Perhaps allocateEntityId?", "author": "kashike", "createdAt": "2020-08-30T16:01:46Z", "path": "Spigot-API-Patches/0222-Expose-the-Entity-Counter-to-allow-plugins-to-use-va.patch", "diffHunk": "@@ -0,0 +1,24 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: MeFisto94 <MeFisto94@users.noreply.github.com>\n+Date: Fri, 28 Aug 2020 01:41:31 +0200\n+Subject: [PATCH] Expose the Entity Counter to allow plugins to use valid and\n+ non-conflicting Entity Ids\n+\n+\n+diff --git a/src/main/java/org/bukkit/UnsafeValues.java b/src/main/java/org/bukkit/UnsafeValues.java\n+index d3ec5084e33dff038d54cdd2aeb703a3eb25f7a7..20cb67b7f2fcc590d4530d225d2a43898fd10117 100644\n+--- a/src/main/java/org/bukkit/UnsafeValues.java\n++++ b/src/main/java/org/bukkit/UnsafeValues.java\n+@@ -94,5 +94,12 @@ public interface UnsafeValues {\n+     byte[] serializeItem(ItemStack item);\n+ \n+     ItemStack deserializeItem(byte[] data);\n++\n++    /**\n++     * Creates and returns the next EntityId available.\n++     * <p>\n++     * Use this when sending custom packets, so that there are no collisions on the client or server.\n++     */\n++    public int createEntityId();", "originalCommit": "f0535f644476d8a406e032ef5009a2368308b380", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTgwNzM0NQ==", "url": "https://github.com/PaperMC/Paper/pull/4232#discussion_r479807345", "bodyText": "The problem might be that it has the feeling of being able to \"free\" the entityId again (but create is no exception there).\nBut I guess any formulation will suffer from that", "author": "MeFisto94", "createdAt": "2020-08-30T19:35:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc4NjU3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDExNDM1Ng==", "url": "https://github.com/PaperMC/Paper/pull/4232#discussion_r480114356", "bodyText": "What is with nextEntityId() ?", "author": "yannicklamprecht", "createdAt": "2020-08-31T13:02:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc4NjU3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI2MzA4OQ==", "url": "https://github.com/PaperMC/Paper/pull/4232#discussion_r480263089", "bodyText": "nextEntityId sounds good to me, especially as it indicates that it's somehow fetching id and doesn't have the alloc/free notion :)", "author": "MeFisto94", "createdAt": "2020-08-31T16:59:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc4NjU3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTUyNDI5OQ==", "url": "https://github.com/PaperMC/Paper/pull/4232#discussion_r481524299", "bodyText": "nextEntityId works for me.", "author": "kashike", "createdAt": "2020-09-02T01:23:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc4NjU3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjk4ODEzNA==", "url": "https://github.com/PaperMC/Paper/pull/4232#discussion_r482988134", "bodyText": "I just thought of getAndIncrementEntityId to match AtomicInteger but this is such a trivial thing that's it not worth editing for", "author": "Mystiflow", "createdAt": "2020-09-03T13:44:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc4NjU3NA=="}], "type": "inlineReview"}, {"oid": "dc366a5f9f6e609b8c948432f53f536ee8c8ac01", "url": "https://github.com/PaperMC/Paper/commit/dc366a5f9f6e609b8c948432f53f536ee8c8ac01", "message": "Expose the Entity Counter to allow plugins to use valid and non-conflicting Entity Ids", "committedDate": "2020-09-03T09:17:33Z", "type": "forcePushed"}, {"oid": "8bb6abda50913cca6f56758730cbe25489bce550", "url": "https://github.com/PaperMC/Paper/commit/8bb6abda50913cca6f56758730cbe25489bce550", "message": "Expose the Entity Counter to allow plugins to use valid and non-conflicting Entity Ids", "committedDate": "2020-09-03T10:06:11Z", "type": "forcePushed"}, {"oid": "84e3c2ec73c4841a4896339c6ae036b7344bfab6", "url": "https://github.com/PaperMC/Paper/commit/84e3c2ec73c4841a4896339c6ae036b7344bfab6", "message": "Expose the Entity Counter to allow plugins to use valid and non-conflicting Entity Ids", "committedDate": "2020-09-29T17:07:05Z", "type": "commit"}, {"oid": "84e3c2ec73c4841a4896339c6ae036b7344bfab6", "url": "https://github.com/PaperMC/Paper/commit/84e3c2ec73c4841a4896339c6ae036b7344bfab6", "message": "Expose the Entity Counter to allow plugins to use valid and non-conflicting Entity Ids", "committedDate": "2020-09-29T17:07:05Z", "type": "forcePushed"}]}