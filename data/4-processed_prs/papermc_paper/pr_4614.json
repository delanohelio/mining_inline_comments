{"pr_number": 4614, "pr_title": "EntityMoveEvent", "pr_createdAt": "2020-10-04T03:45:05Z", "pr_url": "https://github.com/PaperMC/Paper/pull/4614", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTIwMzM5NQ==", "url": "https://github.com/PaperMC/Paper/pull/4614#discussion_r499203395", "bodyText": "this should be cached so JIT can optimize this out. These method calls aren't simple getters.", "author": "aikar", "createdAt": "2020-10-04T04:01:34Z", "path": "Spigot-Server-Patches/0582-EntityMoveEvent.patch", "diffHunk": "@@ -0,0 +1,31 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: William Blake Galbreath <Blake.Galbreath@GMail.com>\n+Date: Tue, 11 Feb 2020 21:56:48 -0600\n+Subject: [PATCH] EntityMoveEvent\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/EntityLiving.java b/src/main/java/net/minecraft/server/EntityLiving.java\n+index 76185f042dd773f267dc7574116cec7bd8a28ca8..399e4a67ca2433b4120dbfb5739730d1486ebb94 100644\n+--- a/src/main/java/net/minecraft/server/EntityLiving.java\n++++ b/src/main/java/net/minecraft/server/EntityLiving.java\n+@@ -2801,6 +2801,20 @@ public abstract class EntityLiving extends Entity {\n+ \n+         this.collideNearby();\n+         this.world.getMethodProfiler().exit();\n++        // Paper start\n++        if (com.destroystokyo.paper.event.entity.EntityMoveEvent.getHandlerList().getRegisteredListeners().length > 0) {", "originalCommit": "35a67019d79b477e2c9cea3f62e72f36c6191bf4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTIxNjk2NA==", "url": "https://github.com/PaperMC/Paper/pull/4614#discussion_r499216964", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            +package com.destroystokyo.paper.event.entity;\n          \n          \n            \n            +package io.papermc.paper.event.entity;", "author": "Proximyst", "createdAt": "2020-10-04T07:51:32Z", "path": "Spigot-API-Patches/0228-EntityMoveEvent.patch", "diffHunk": "@@ -0,0 +1,107 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: William Blake Galbreath <Blake.Galbreath@GMail.com>\n+Date: Tue, 11 Feb 2020 21:56:38 -0600\n+Subject: [PATCH] EntityMoveEvent\n+\n+\n+diff --git a/src/main/java/com/destroystokyo/paper/event/entity/EntityMoveEvent.java b/src/main/java/com/destroystokyo/paper/event/entity/EntityMoveEvent.java\n+new file mode 100644\n+index 0000000000000000000000000000000000000000..87fb271141a9604d879455f029d5cc009637afe3\n+--- /dev/null\n++++ b/src/main/java/com/destroystokyo/paper/event/entity/EntityMoveEvent.java\n+@@ -0,0 +1,95 @@\n++package com.destroystokyo.paper.event.entity;", "originalCommit": "5e113f62d5e6edd91e0cbf5642ed4491d7b096e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI1Njc2MQ==", "url": "https://github.com/PaperMC/Paper/pull/4614#discussion_r499256761", "bodyText": "I thought the plan was to move everything to the new package all at once so we don't split it up and create confusion", "author": "BillyGalbreath", "createdAt": "2020-10-04T15:10:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTIxNjk2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI1NzAzNw==", "url": "https://github.com/PaperMC/Paper/pull/4614#discussion_r499257037", "bodyText": "That'll only be more work later on. We've already got some on the new package, and they're not moving in that case; little to lose by just using the new one at this point.", "author": "Proximyst", "createdAt": "2020-10-04T15:13:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTIxNjk2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTIyMDQ0MA==", "url": "https://github.com/PaperMC/Paper/pull/4614#discussion_r499220440", "bodyText": "shouldn't you use event.getTo() here?", "author": "MrIvanPlays", "createdAt": "2020-10-04T08:35:34Z", "path": "Spigot-Server-Patches/0582-EntityMoveEvent.patch", "diffHunk": "@@ -0,0 +1,55 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: William Blake Galbreath <Blake.Galbreath@GMail.com>\n+Date: Tue, 11 Feb 2020 21:56:48 -0600\n+Subject: [PATCH] EntityMoveEvent\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/EntityLiving.java b/src/main/java/net/minecraft/server/EntityLiving.java\n+index 76185f042dd773f267dc7574116cec7bd8a28ca8..5cc3ea591689e02a38546ef29fe2496590ca8155 100644\n+--- a/src/main/java/net/minecraft/server/EntityLiving.java\n++++ b/src/main/java/net/minecraft/server/EntityLiving.java\n+@@ -2801,6 +2801,20 @@ public abstract class EntityLiving extends Entity {\n+ \n+         this.collideNearby();\n+         this.world.getMethodProfiler().exit();\n++        // Paper start\n++        if (((WorldServer) world).hasEntityMoveEvent) {\n++            if (lastX != locX() || lastY != locY() || lastZ != locZ() || lastYaw != yaw || lastPitch != pitch) {\n++                Location from = new Location(world.getWorld(), lastX, lastY, lastZ, lastYaw, lastPitch);\n++                Location to = new Location (world.getWorld(), locX(), locY(), locZ(), yaw, pitch);\n++                com.destroystokyo.paper.event.entity.EntityMoveEvent event = new com.destroystokyo.paper.event.entity.EntityMoveEvent(getBukkitLivingEntity(), from, to.clone());\n++                if (!event.callEvent()) {\n++                    setLocation(from.getX(), from.getY(), from.getZ(), from.getYaw(), from.getPitch());\n++                } else if (!to.equals(event.getTo())) {\n++                    setLocation(to.getX(), to.getY(), to.getZ(), to.getYaw(), to.getPitch());", "originalCommit": "5e113f62d5e6edd91e0cbf5642ed4491d7b096e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f31a13e9f9023de3031d36d10fe3ca4cac1d6b87", "url": "https://github.com/PaperMC/Paper/commit/f31a13e9f9023de3031d36d10fe3ca4cac1d6b87", "message": "EntityMoveEvent", "committedDate": "2021-01-27T21:36:11Z", "type": "commit"}]}