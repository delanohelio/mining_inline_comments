{"pr_number": 3873, "pr_title": "Fix SPIGOT-5824 Bukkit world-container is not used", "pr_createdAt": "2020-07-10T18:25:20Z", "pr_url": "https://github.com/PaperMC/Paper/pull/3873", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA2OTc4MA==", "url": "https://github.com/PaperMC/Paper/pull/3873#discussion_r453069780", "bodyText": "Use load() from YamlConfiguration object.\npublic static YamlConfiguration loadConfiguration(@NotNull Reader reader) {\n    Validate.notNull(reader, \"Stream cannot be null\");\n\n    YamlConfiguration config = new YamlConfiguration();\n\n    try {\n        config.load(reader);\n    } catch (IOException ex) {\n        Bukkit.getLogger().log(Level.SEVERE, \"Cannot load configuration from stream\", ex);\n    } catch (InvalidConfigurationException ex) {\n        Bukkit.getLogger().log(Level.SEVERE, \"Cannot load configuration from stream\", ex);\n    }\n\n    return config;\n}\nWhen IOException or InvalidConfigurationException occurs it will result in NPE since Bukkit.getServer() returns null until CraftServer sets Bukkit.setServer(...) in its constructor.", "author": "TheMolkaPL", "createdAt": "2020-07-10T20:47:23Z", "path": "Spigot-Server-Patches/0543-Fix-SPIGOT-5824-Bukkit-world-container-is-not-used.patch", "diffHunk": "@@ -0,0 +1,32 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: William Blake Galbreath <Blake.Galbreath@GMail.com>\n+Date: Fri, 10 Jul 2020 13:12:33 -0500\n+Subject: [PATCH] Fix SPIGOT-5824 Bukkit world-container is not used\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/Main.java b/src/main/java/net/minecraft/server/Main.java\n+index 2f29d7040d37e8be2ba5f8f634011e069a07db2f..d5ae5c9da76134cfa0df125fb96db67071ed77d2 100644\n+--- a/src/main/java/net/minecraft/server/Main.java\n++++ b/src/main/java/net/minecraft/server/Main.java\n+@@ -86,7 +86,20 @@ public class Main {\n+                 return;\n+             }\n+ \n+-            File file = (File) optionset.valueOf(\"universe\"); // CraftBukkit\n++            // Paper start - fix SPIGOT-5824\n++            File file;\n++            if (optionset.has(\"universe\")) {\n++                file = (File) optionset.valueOf(\"universe\"); // CraftBukkit\n++            } else {\n++                try {\n++                    file = new File(org.bukkit.configuration.file.YamlConfiguration\n++                            .loadConfiguration((File) optionset.valueOf(\"bukkit-settings\"))", "originalCommit": "443fc81677efaf57edc03951f127e5665fcd2fcd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA3NDY5OA==", "url": "https://github.com/PaperMC/Paper/pull/3873#discussion_r453074698", "bodyText": "Good call ^_^", "author": "BillyGalbreath", "createdAt": "2020-07-10T20:59:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA2OTc4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA3MjYzNw==", "url": "https://github.com/PaperMC/Paper/pull/3873#discussion_r453072637", "bodyText": "Are you sure this isn't always true? universe is set to return a File by default.", "author": "TheMolkaPL", "createdAt": "2020-07-10T20:54:55Z", "path": "Spigot-Server-Patches/0543-Fix-SPIGOT-5824-Bukkit-world-container-is-not-used.patch", "diffHunk": "@@ -0,0 +1,32 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: William Blake Galbreath <Blake.Galbreath@GMail.com>\n+Date: Fri, 10 Jul 2020 13:12:33 -0500\n+Subject: [PATCH] Fix SPIGOT-5824 Bukkit world-container is not used\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/Main.java b/src/main/java/net/minecraft/server/Main.java\n+index 2f29d7040d37e8be2ba5f8f634011e069a07db2f..d5ae5c9da76134cfa0df125fb96db67071ed77d2 100644\n+--- a/src/main/java/net/minecraft/server/Main.java\n++++ b/src/main/java/net/minecraft/server/Main.java\n+@@ -86,7 +86,20 @@ public class Main {\n+                 return;\n+             }\n+ \n+-            File file = (File) optionset.valueOf(\"universe\"); // CraftBukkit\n++            // Paper start - fix SPIGOT-5824\n++            File file;\n++            if (optionset.has(\"universe\")) {", "originalCommit": "443fc81677efaf57edc03951f127e5665fcd2fcd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA3NTE3NQ==", "url": "https://github.com/PaperMC/Paper/pull/3873#discussion_r453075175", "bodyText": "Yes, has doesn't check the defaults, just what's detected to actually be set.", "author": "BillyGalbreath", "createdAt": "2020-07-10T21:00:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA3MjYzNw=="}], "type": "inlineReview"}, {"oid": "bede4d304d67f61e81975192883672239fa20ac9", "url": "https://github.com/PaperMC/Paper/commit/bede4d304d67f61e81975192883672239fa20ac9", "message": "Load config files early on\n\nalso fixes the ide commodore rewrite patch version\n\nPrep for other PR's to be updated to use these as some options need to use some values earlier", "committedDate": "2020-07-22T05:01:01Z", "type": "commit"}, {"oid": "9b93d122ecdfc797de63a37152cffde8d55687cb", "url": "https://github.com/PaperMC/Paper/commit/9b93d122ecdfc797de63a37152cffde8d55687cb", "message": "Fix SPIGOT-5824 Bukkit world-container is not used", "committedDate": "2020-07-22T05:29:20Z", "type": "commit"}]}