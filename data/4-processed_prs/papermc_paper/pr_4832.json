{"pr_number": 4832, "pr_title": "Add cause to Weather/ThunderChangeEvents", "pr_createdAt": "2020-12-03T02:39:53Z", "pr_url": "https://github.com/PaperMC/Paper/pull/4832", "timeline": [{"oid": "3adb25d900d81e53b87c03da30abe4f78eb7fa82", "url": "https://github.com/PaperMC/Paper/commit/3adb25d900d81e53b87c03da30abe4f78eb7fa82", "message": "Add cause to Weather/ThunderChangeEvents", "committedDate": "2021-03-21T23:21:57Z", "type": "forcePushed"}, {"oid": "c416405261323f1019f991657c352431432905c9", "url": "https://github.com/PaperMC/Paper/commit/c416405261323f1019f991657c352431432905c9", "message": "Add cause to Weather/ThunderChangeEvents", "committedDate": "2021-05-24T05:42:43Z", "type": "forcePushed"}, {"oid": "f9bc80b048ef1110bf6cd6d7b6f3ca6c7660d750", "url": "https://github.com/PaperMC/Paper/commit/f9bc80b048ef1110bf6cd6d7b6f3ca6c7660d750", "message": "Add cause to Weather/ThunderChangeEvents", "committedDate": "2021-05-24T05:44:06Z", "type": "forcePushed"}, {"oid": "d3999fd6183dfd35822872c5aebc27277a328ced", "url": "https://github.com/PaperMC/Paper/commit/d3999fd6183dfd35822872c5aebc27277a328ced", "message": "Add cause to Weather/ThunderChangeEvents", "committedDate": "2021-05-24T05:45:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNzc2Mzc5MA==", "url": "https://github.com/PaperMC/Paper/pull/4832#discussion_r637763790", "bodyText": "No, this happens when players go to sleep to skip the night.", "author": "kennytv", "createdAt": "2021-05-24T08:02:59Z", "path": "Spigot-Server-Patches/0741-Add-cause-to-Weather-ThunderChangeEvents.patch", "diffHunk": "@@ -0,0 +1,118 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Jake Potrebic <jake.m.potrebic@gmail.com>\n+Date: Wed, 2 Dec 2020 18:23:26 -0800\n+Subject: [PATCH] Add cause to Weather/ThunderChangeEvents\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/level/WorldServer.java b/src/main/java/net/minecraft/server/level/WorldServer.java\n+index 6aace2155258d8257d53ebfcb20c37ea7497c02c..fe0afd4959fd0f5d99a20a42f01d9700a472bcec 100644\n+--- a/src/main/java/net/minecraft/server/level/WorldServer.java\n++++ b/src/main/java/net/minecraft/server/level/WorldServer.java\n+@@ -419,8 +419,8 @@ public class WorldServer extends World implements GeneratorAccessSeed {\n+         this.worldDataServer.setClearWeatherTime(i);\n+         this.worldDataServer.setWeatherDuration(j);\n+         this.worldDataServer.setThunderDuration(j);\n+-        this.worldDataServer.setStorm(flag);\n+-        this.worldDataServer.setThundering(flag1);\n++        this.worldDataServer.setStorm(flag, org.bukkit.event.weather.WeatherChangeEvent.Cause.COMMAND); // Paper\n++        this.worldDataServer.setThundering(flag1, org.bukkit.event.weather.ThunderChangeEvent.Cause.COMMAND); // Paper\n+     }\n+ \n+     public BiomeBase getBiomeBySeed(int i, int j, int k) { return a(i, j, k); } // Paper - OBFHELPER\n+@@ -482,8 +482,8 @@ public class WorldServer extends World implements GeneratorAccessSeed {\n+                 this.worldDataServer.setThunderDuration(j);\n+                 this.worldDataServer.setWeatherDuration(k);\n+                 this.worldDataServer.setClearWeatherTime(i);\n+-                this.worldDataServer.setThundering(flag1);\n+-                this.worldDataServer.setStorm(flag2);\n++                this.worldDataServer.setThundering(flag1, org.bukkit.event.weather.ThunderChangeEvent.Cause.NATURAL); // Paper\n++                this.worldDataServer.setStorm(flag2, org.bukkit.event.weather.WeatherChangeEvent.Cause.COMMAND); // Paper\n+             }\n+ \n+             this.lastThunderLevel = this.thunderLevel;\n+@@ -885,14 +885,14 @@ public class WorldServer extends World implements GeneratorAccessSeed {\n+ \n+     private void clearWeather() {\n+         // CraftBukkit start\n+-        this.worldDataServer.setStorm(false);\n++        this.worldDataServer.setStorm(false, org.bukkit.event.weather.WeatherChangeEvent.Cause.COMMAND); // Paper - happens when weather cycle gamerule is set to false\n+         // If we stop due to everyone sleeping we should reset the weather duration to some other random value.\n+         // Not that everyone ever manages to get the whole server to sleep at the same time....\n+         if (!this.worldDataServer.hasStorm()) {\n+             this.worldDataServer.setWeatherDuration(0);\n+         }\n+         // CraftBukkit end\n+-        this.worldDataServer.setThundering(false);\n++        this.worldDataServer.setThundering(false, org.bukkit.event.weather.ThunderChangeEvent.Cause.COMMAND); // Paper - happens when weather cycle gamerule is set to false", "originalCommit": "d3999fd6183dfd35822872c5aebc27277a328ced", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNzc2NDMwNw==", "url": "https://github.com/PaperMC/Paper/pull/4832#discussion_r637764307", "bodyText": "No, this happens when players go to sleep to skip the night.", "author": "kennytv", "createdAt": "2021-05-24T08:03:56Z", "path": "Spigot-Server-Patches/0741-Add-cause-to-Weather-ThunderChangeEvents.patch", "diffHunk": "@@ -0,0 +1,118 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Jake Potrebic <jake.m.potrebic@gmail.com>\n+Date: Wed, 2 Dec 2020 18:23:26 -0800\n+Subject: [PATCH] Add cause to Weather/ThunderChangeEvents\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/level/WorldServer.java b/src/main/java/net/minecraft/server/level/WorldServer.java\n+index 6aace2155258d8257d53ebfcb20c37ea7497c02c..fe0afd4959fd0f5d99a20a42f01d9700a472bcec 100644\n+--- a/src/main/java/net/minecraft/server/level/WorldServer.java\n++++ b/src/main/java/net/minecraft/server/level/WorldServer.java\n+@@ -419,8 +419,8 @@ public class WorldServer extends World implements GeneratorAccessSeed {\n+         this.worldDataServer.setClearWeatherTime(i);\n+         this.worldDataServer.setWeatherDuration(j);\n+         this.worldDataServer.setThunderDuration(j);\n+-        this.worldDataServer.setStorm(flag);\n+-        this.worldDataServer.setThundering(flag1);\n++        this.worldDataServer.setStorm(flag, org.bukkit.event.weather.WeatherChangeEvent.Cause.COMMAND); // Paper\n++        this.worldDataServer.setThundering(flag1, org.bukkit.event.weather.ThunderChangeEvent.Cause.COMMAND); // Paper\n+     }\n+ \n+     public BiomeBase getBiomeBySeed(int i, int j, int k) { return a(i, j, k); } // Paper - OBFHELPER\n+@@ -482,8 +482,8 @@ public class WorldServer extends World implements GeneratorAccessSeed {\n+                 this.worldDataServer.setThunderDuration(j);\n+                 this.worldDataServer.setWeatherDuration(k);\n+                 this.worldDataServer.setClearWeatherTime(i);\n+-                this.worldDataServer.setThundering(flag1);\n+-                this.worldDataServer.setStorm(flag2);\n++                this.worldDataServer.setThundering(flag1, org.bukkit.event.weather.ThunderChangeEvent.Cause.NATURAL); // Paper\n++                this.worldDataServer.setStorm(flag2, org.bukkit.event.weather.WeatherChangeEvent.Cause.COMMAND); // Paper\n+             }\n+ \n+             this.lastThunderLevel = this.thunderLevel;\n+@@ -885,14 +885,14 @@ public class WorldServer extends World implements GeneratorAccessSeed {\n+ \n+     private void clearWeather() {\n+         // CraftBukkit start\n+-        this.worldDataServer.setStorm(false);\n++        this.worldDataServer.setStorm(false, org.bukkit.event.weather.WeatherChangeEvent.Cause.COMMAND); // Paper - happens when weather cycle gamerule is set to false", "originalCommit": "d3999fd6183dfd35822872c5aebc27277a328ced", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNzc2NDcwNQ==", "url": "https://github.com/PaperMC/Paper/pull/4832#discussion_r637764705", "bodyText": "Why is the reason here COMMAND?", "author": "kennytv", "createdAt": "2021-05-24T08:04:43Z", "path": "Spigot-Server-Patches/0741-Add-cause-to-Weather-ThunderChangeEvents.patch", "diffHunk": "@@ -0,0 +1,118 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Jake Potrebic <jake.m.potrebic@gmail.com>\n+Date: Wed, 2 Dec 2020 18:23:26 -0800\n+Subject: [PATCH] Add cause to Weather/ThunderChangeEvents\n+\n+\n+diff --git a/src/main/java/net/minecraft/server/level/WorldServer.java b/src/main/java/net/minecraft/server/level/WorldServer.java\n+index 6aace2155258d8257d53ebfcb20c37ea7497c02c..fe0afd4959fd0f5d99a20a42f01d9700a472bcec 100644\n+--- a/src/main/java/net/minecraft/server/level/WorldServer.java\n++++ b/src/main/java/net/minecraft/server/level/WorldServer.java\n+@@ -419,8 +419,8 @@ public class WorldServer extends World implements GeneratorAccessSeed {\n+         this.worldDataServer.setClearWeatherTime(i);\n+         this.worldDataServer.setWeatherDuration(j);\n+         this.worldDataServer.setThunderDuration(j);\n+-        this.worldDataServer.setStorm(flag);\n+-        this.worldDataServer.setThundering(flag1);\n++        this.worldDataServer.setStorm(flag, org.bukkit.event.weather.WeatherChangeEvent.Cause.COMMAND); // Paper\n++        this.worldDataServer.setThundering(flag1, org.bukkit.event.weather.ThunderChangeEvent.Cause.COMMAND); // Paper\n+     }\n+ \n+     public BiomeBase getBiomeBySeed(int i, int j, int k) { return a(i, j, k); } // Paper - OBFHELPER\n+@@ -482,8 +482,8 @@ public class WorldServer extends World implements GeneratorAccessSeed {\n+                 this.worldDataServer.setThunderDuration(j);\n+                 this.worldDataServer.setWeatherDuration(k);\n+                 this.worldDataServer.setClearWeatherTime(i);\n+-                this.worldDataServer.setThundering(flag1);\n+-                this.worldDataServer.setStorm(flag2);\n++                this.worldDataServer.setThundering(flag1, org.bukkit.event.weather.ThunderChangeEvent.Cause.NATURAL); // Paper\n++                this.worldDataServer.setStorm(flag2, org.bukkit.event.weather.WeatherChangeEvent.Cause.COMMAND); // Paper", "originalCommit": "d3999fd6183dfd35822872c5aebc27277a328ced", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "38aaf366dd89eb0b52b6a9c160426b8532b9ce28", "url": "https://github.com/PaperMC/Paper/commit/38aaf366dd89eb0b52b6a9c160426b8532b9ce28", "message": "Add cause to Weather/ThunderChangeEvents", "committedDate": "2021-05-24T16:39:09Z", "type": "commit"}, {"oid": "38aaf366dd89eb0b52b6a9c160426b8532b9ce28", "url": "https://github.com/PaperMC/Paper/commit/38aaf366dd89eb0b52b6a9c160426b8532b9ce28", "message": "Add cause to Weather/ThunderChangeEvents", "committedDate": "2021-05-24T16:39:09Z", "type": "forcePushed"}]}