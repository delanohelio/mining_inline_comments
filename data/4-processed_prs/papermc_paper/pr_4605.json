{"pr_number": 4605, "pr_title": "Fix distance in checkHighPriorityChunks (Fixes #4582)", "pr_createdAt": "2020-10-03T12:57:54Z", "pr_url": "https://github.com/PaperMC/Paper/pull/4605", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE0NjExNA==", "url": "https://github.com/PaperMC/Paper/pull/4605#discussion_r499146114", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            +                double dist = MCUtil.distanceSq(playerChunkX, 0, playerChunkZ, coord.x, 0, coord.z);\n          \n          \n            \n            +                updateChunkPriorityMap(priorities, coord.pair(), (int) (25 - Math.sqrt(dist) * twoThirdModifier));\n          \n          \n            \n            +                double dist = MCUtil.distance(playerChunkX, 0, playerChunkZ, coord.x, 0, coord.z);\n          \n          \n            \n            +                updateChunkPriorityMap(priorities, coord.pair(), (int) (25 - dist * twoThirdModifier));", "author": "kennytv", "createdAt": "2020-10-03T13:01:51Z", "path": "Spigot-Server-Patches/0488-Implement-Chunk-Priority-Urgency-System-for-Chunks.patch", "diffHunk": "@@ -1050,7 +1050,7 @@ index fba7c9b5724114eab35a3d24febdee3cd3e30aa0..753d67c8a711d293bd70eb913c47ec81\n +            MCUtil.getSpiralOutChunks(pos, 4).forEach(coord -> {\n +                if (shouldSkipPrioritization(coord)) return;\n +\n-+                double dist = MCUtil.distance(playerChunkX, 0, playerChunkZ, coord.x, 0, coord.z);\n++                double dist = MCUtil.distanceSq(playerChunkX, 0, playerChunkZ, coord.x, 0, coord.z);\n +                updateChunkPriorityMap(priorities, coord.pair(), (int) (25 - Math.sqrt(dist) * twoThirdModifier));", "originalCommit": "3fd7fd5c1662e63426fb2544ee13b2fcd911b730", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE0NjE3Nw==", "url": "https://github.com/PaperMC/Paper/pull/4605#discussion_r499146177", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            +                double dist = MCUtil.distanceSq(playerChunkX, 0, playerChunkZ, coord.x, 0, coord.z);\n          \n          \n            \n            +                updateChunkPriorityMap(priorities, coord.pair(), (int) (25 - Math.sqrt(dist) * twoThirdModifier));\n          \n          \n            \n            +                double dist = MCUtil.distance(playerChunkX, 0, playerChunkZ, coord.x, 0, coord.z);\n          \n          \n            \n            +                updateChunkPriorityMap(priorities, coord.pair(), (int) (25 - dist * twoThirdModifier));", "author": "kennytv", "createdAt": "2020-10-03T13:02:29Z", "path": "Spigot-Server-Patches/0488-Implement-Chunk-Priority-Urgency-System-for-Chunks.patch", "diffHunk": "@@ -1063,7 +1063,7 @@ index fba7c9b5724114eab35a3d24febdee3cd3e30aa0..753d67c8a711d293bd70eb913c47ec81\n +                if (shouldSkipPrioritization(coord)) {\n +                    return;\n +                }\n-+                double dist = MCUtil.distance(playerChunkX, 0, playerChunkZ, coord.x, 0, coord.z);\n++                double dist = MCUtil.distanceSq(playerChunkX, 0, playerChunkZ, coord.x, 0, coord.z);\n +                updateChunkPriorityMap(priorities, coord.pair(), (int) (25 - Math.sqrt(dist) * twoThirdModifier));", "originalCommit": "3fd7fd5c1662e63426fb2544ee13b2fcd911b730", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE0NjE5Nw==", "url": "https://github.com/PaperMC/Paper/pull/4605#discussion_r499146197", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            +            double dist = MCUtil.distanceSq(playerChunkX, 0, playerChunkZ, coord.x, 0, coord.z);\n          \n          \n            \n            +            updateChunkPriorityMap(priorities, coord.pair(), (int) (25 - Math.sqrt(dist) * twoThirdModifier));\n          \n          \n            \n            +            double dist = MCUtil.distance(playerChunkX, 0, playerChunkZ, coord.x, 0, coord.z);\n          \n          \n            \n            +            updateChunkPriorityMap(priorities, coord.pair(), (int) (25 - dist * twoThirdModifier));", "author": "kennytv", "createdAt": "2020-10-03T13:02:47Z", "path": "Spigot-Server-Patches/0488-Implement-Chunk-Priority-Urgency-System-for-Chunks.patch", "diffHunk": "@@ -1039,7 +1039,7 @@ index fba7c9b5724114eab35a3d24febdee3cd3e30aa0..753d67c8a711d293bd70eb913c47ec81\n +        MCUtil.getSpiralOutChunks(pos, Math.min(5, viewDistance)).forEach(coord -> {\n +            if (shouldSkipPrioritization(coord)) return;\n +\n-+            double dist = MCUtil.distance(playerChunkX, 0, playerChunkZ, coord.x, 0, coord.z);\n++            double dist = MCUtil.distanceSq(playerChunkX, 0, playerChunkZ, coord.x, 0, coord.z);\n +            updateChunkPriorityMap(priorities, coord.pair(), (int) (25 - Math.sqrt(dist) * twoThirdModifier));", "originalCommit": "3fd7fd5c1662e63426fb2544ee13b2fcd911b730", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fcc0df67cdb3914c71cb8f686adf0159ab8d2a77", "url": "https://github.com/PaperMC/Paper/commit/fcc0df67cdb3914c71cb8f686adf0159ab8d2a77", "message": "Fix distance in checkHighPriorityChunks (#4582)", "committedDate": "2020-10-11T20:57:02Z", "type": "commit"}, {"oid": "d55ef5961c7b15c32335c9904d7b6a7c8d4c2e31", "url": "https://github.com/PaperMC/Paper/commit/d55ef5961c7b15c32335c9904d7b6a7c8d4c2e31", "message": "Used distance instead of distanceSq", "committedDate": "2020-10-11T20:57:02Z", "type": "forcePushed"}, {"oid": "4e3ac380a1a86a787dfe6cfd003163f24a55ad6a", "url": "https://github.com/PaperMC/Paper/commit/4e3ac380a1a86a787dfe6cfd003163f24a55ad6a", "message": "Fix incorrect usage of distance in calculating chunk priorities", "committedDate": "2020-10-11T22:15:58Z", "type": "commit"}, {"oid": "4e3ac380a1a86a787dfe6cfd003163f24a55ad6a", "url": "https://github.com/PaperMC/Paper/commit/4e3ac380a1a86a787dfe6cfd003163f24a55ad6a", "message": "Fix incorrect usage of distance in calculating chunk priorities", "committedDate": "2020-10-11T22:15:58Z", "type": "forcePushed"}]}