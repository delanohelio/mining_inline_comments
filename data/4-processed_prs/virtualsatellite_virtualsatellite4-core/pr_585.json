{"pr_number": 585, "pr_title": "Refactor SEI delete functionality for server", "pr_createdAt": "2020-04-22T13:58:31Z", "pr_url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/585", "timeline": [{"oid": "7d95d50769f5f0fa736d223c144e1d86d93c9ccd", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/7d95d50769f5f0fa736d223c144e1d86d93c9ccd", "message": "Refactored Remove Command to be invoked through ed - (Task #584)\n\n- Changed code for deleting SEIs to be invoked through the\nVirSatTransactionalEditingDomain, to keep correct order of first\ngrapping the WorkspaceLock, than grapping the transaction.\n\n---\nTask #584: Implement non UI Command for deleting Structural Element\nInstances", "committedDate": "2020-04-22T12:30:55Z", "type": "commit"}, {"oid": "4201748dcaa37f7334a761ac2689b595a86c8053", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/4201748dcaa37f7334a761ac2689b595a86c8053", "message": "Prepared creation of non UI delete resource command - (Task #584)\n\n- Moved code for deleting SEIs and their folders on the file system from\nui to core plugin.\n- Implemented call back function to create refactoring and UI based\noperation for existing UI based calls\n- Adjusted all other relevant code.\n\n---\nTask #584: Implement non UI Command for deleting Structural Element\nInstances", "committedDate": "2020-04-22T13:32:34Z", "type": "commit"}, {"oid": "48e886b60889abcbcf10692fe349e38dc646e9df", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/48e886b60889abcbcf10692fe349e38dc646e9df", "message": "Moved files to correct plugin - (Task #584)\n\n- Accidentally moved files to test fragment instead of core plugin.\n\n---\nTask #584: Implement non UI Command for deleting Structural Element\nInstances", "committedDate": "2020-04-22T13:34:20Z", "type": "commit"}, {"oid": "cf8605e34fa0f5428c6e26765120815b53ab04e5", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/cf8605e34fa0f5428c6e26765120815b53ab04e5", "message": "Added test case skeleton - (Task #584)\n\n---\nTask #584: Implement non UI Command for deleting Structural Element\nInstances", "committedDate": "2020-04-22T13:59:18Z", "type": "commit"}, {"oid": "1fad76c50d31846a39d557dbbd674714bfd6bfb1", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/1fad76c50d31846a39d557dbbd674714bfd6bfb1", "message": "Implemented NoUndoDelete Operation - (Task #584)\n\n- Implemented DeleteOperation for workspace resources.\n- Implemented test cases as well.\n\n---\nTask #584: Implement non UI Command for deleting Structural Element\nInstances", "committedDate": "2020-04-23T08:06:12Z", "type": "commit"}, {"oid": "5a3a4e60f995860a0504fd5d4a57468d8f70fbe3", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/5a3a4e60f995860a0504fd5d4a57468d8f70fbe3", "message": "Implemented test cases for the RemoveFileStructure Command - (Task #584)\n\n---\nTask #584: Implement non UI Command for deleting Structural Element\nInstances", "committedDate": "2020-04-23T09:17:32Z", "type": "commit"}, {"oid": "ff9eca4a548c822c74db41a6f1ad301a3a2c8c8a", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/ff9eca4a548c822c74db41a6f1ad301a3a2c8c8a", "message": "Moved and tested method to filter SEI selection - (Task #584)\n\n- Moved method to filter SEIs for their parent from delete code to\nSEIHelper.\n- Added a test case for it as well.\n\n---\nTask #584: Implement non UI Command for deleting Structural Element\nInstances", "committedDate": "2020-04-23T11:52:24Z", "type": "commit"}, {"oid": "ef0d1f202824284820f1958eace3441c41e0cb07", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/ef0d1f202824284820f1958eace3441c41e0cb07", "message": "Added Test Code for Delete Command Creation - (Task #584)\n\n- Added TestCases for CreateRemoveSeiWithFileStructure command factory\n\n---\nTask #584: Implement non UI Command for deleting Structural Element\nInstances", "committedDate": "2020-04-23T13:30:29Z", "type": "commit"}, {"oid": "cc08bac0444ad62313eed0bed20ce4932ab22c0d", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/cc08bac0444ad62313eed0bed20ce4932ab22c0d", "message": "Improving Command Code - (Task #584)\n\n---\nTask #584: Implement non UI Command for deleting Structural Element\nInstances", "committedDate": "2020-04-24T08:21:49Z", "type": "commit"}, {"oid": "c4360be36b68528f8de5107232599f8cbf12addf", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/c4360be36b68528f8de5107232599f8cbf12addf", "message": "Added handling for non contained resources - (Task #584)\n\n\n---\nTask #584: Implement non UI Command for deleting Structural Element\nInstances", "committedDate": "2020-04-24T10:28:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ3MDAzNg==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/585#discussion_r416470036", "bodyText": "Are we really interested in checking the type here or is it just a question of null/non-null?\nwhile (parent != null && selectedToBeDeleted.contains(parent) { ... } and if (parent != null) { ... } would be easier to read.", "author": "SaMuellerDLR", "createdAt": "2020-04-28T09:32:14Z", "path": "de.dlr.sc.virsat.model/src/de/dlr/sc/virsat/model/dvlm/structural/util/StructuralElementInstanceHelper.java", "diffHunk": "@@ -108,4 +111,25 @@ public ICategoryAssignmentContainer getRoot() {\n \t\t}\r\n \t\treturn superSeis;\r\n \t}\r\n+\t\r\n+\t/**\r\n+\t * Creates a new list which does not contain SEIs that are marked for deletion whose parents are also marked for deletion\r\n+\t * for example, A contains B, and both are selected for deletion. In this case we need to remove B as it will be deleted anyway with A\r\n+\t * @param seisToDelete Collection of SEIs that are selected for deletion\r\n+\t * @return list of SEIs without children that will be deleted anyway\r\n+\t */\r\n+\tpublic static ArrayList<StructuralElementInstance> cleanFromIndirectSelectedChildren(Collection<StructuralElementInstance> seisToDelete) {\r\n+\t\tSet<EObject> selectedToBeDeleted = new HashSet<>(seisToDelete);\r\n+\t\tArrayList<StructuralElementInstance> seisToDeleteWithoutDuplicateChildren = new ArrayList<>();\r\n+\t\tfor (StructuralElementInstance sei : seisToDelete) {\r\n+\t\t\tEObject parent = sei.eContainer();\r\n+\t\t\twhile (parent instanceof StructuralElementInstance && !selectedToBeDeleted.contains(parent)) {\r", "originalCommit": "c4360be36b68528f8de5107232599f8cbf12addf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzA5OTA5MQ==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/585#discussion_r417099091", "bodyText": "No idea, I just moved and tested the already existing code. We have to investigate this.", "author": "PhilMFischer", "createdAt": "2020-04-29T06:47:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ3MDAzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEwMzAyNw==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/585#discussion_r417103027", "bodyText": "I think the way it is implemented is fine:\nEObject parent = sei.eContainer(); while (parent instanceof StructuralElementInstance && !selectedToBeDeleted.contains(parent)) { parent = parent.eContainer(); }\nparent is of type EObject. Even though our data model won't return anything else than a SEI or null, it is not practically checked when just using null checks. I think spotbugs may complain and we would have to introduce the type checking somewhere else. I can maybe add a comment to explain what is meant here.", "author": "PhilMFischer", "createdAt": "2020-04-29T06:57:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ3MDAzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEwNzI1Nw==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/585#discussion_r417107257", "bodyText": "Looking deeper into the method, it looks like the algorithm is not correct. Therefore back to WIP.", "author": "PhilMFischer", "createdAt": "2020-04-29T07:06:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ3MDAzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ3MTA2Nw==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/585#discussion_r416471067", "bodyText": "Can we use the executeAsCommand(...) here?", "author": "SaMuellerDLR", "createdAt": "2020-04-28T09:33:54Z", "path": "de.dlr.sc.virsat.project.test/src/de/dlr/sc/virsat/project/structure/command/CreateRemoveSeiWithFileStructureCommandTest.java", "diffHunk": "@@ -0,0 +1,178 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package de.dlr.sc.virsat.project.structure.command;\n+\n+import static org.hamcrest.Matchers.empty;\n+import static org.hamcrest.Matchers.hasItem;\n+import static org.hamcrest.Matchers.hasItems;\n+import static org.hamcrest.Matchers.not;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.junit.Assert.assertTrue;\n+\n+import java.util.LinkedList;\n+import java.util.List;\n+\n+import org.eclipse.core.resources.IFolder;\n+import org.eclipse.core.runtime.CoreException;\n+import org.eclipse.emf.common.command.Command;\n+import org.eclipse.emf.ecore.resource.Resource;\n+import org.eclipse.emf.transaction.RecordingCommand;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import de.dlr.sc.virsat.model.dvlm.Repository;\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElement;\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralFactory;\n+import de.dlr.sc.virsat.project.test.AProjectTestCase;\n+\n+public class CreateRemoveSeiWithFileStructureCommandTest extends AProjectTestCase {\n+\t\n+\tStructuralElement se;\n+\t\n+\tStructuralElementInstance sei1;\n+\tStructuralElementInstance sei2;\n+\tStructuralElementInstance sei3;\n+\t\n+\tIFolder seiFolder1;\n+\tIFolder seiFolder2;\n+\tIFolder seiFolder3;\n+\t\n+\tResource resourceSei1;\n+\tResource resourceSei2;\n+\tResource resourceSei3;\n+\t\n+\t@Before\n+\tpublic void setUp() throws CoreException {\n+\t\tsuper.setUp();\n+\t\taddEditingDomainAndRepository();\n+\n+\t\teditingDomain.getCommandStack().execute(new RecordingCommand(editingDomain) {", "originalCommit": "c4360be36b68528f8de5107232599f8cbf12addf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzA5MDc2OA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/585#discussion_r417090768", "bodyText": "Absolutely! Forgot that we provided this back in the days...", "author": "PhilMFischer", "createdAt": "2020-04-29T06:24:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ3MTA2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ3MTI5MA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/585#discussion_r416471290", "bodyText": "Can be removed.", "author": "SaMuellerDLR", "createdAt": "2020-04-28T09:34:13Z", "path": "de.dlr.sc.virsat.project.test/src/de/dlr/sc/virsat/project/structure/command/CreateRemoveSeiWithFileStructureCommandTest.java", "diffHunk": "@@ -0,0 +1,178 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package de.dlr.sc.virsat.project.structure.command;\n+\n+import static org.hamcrest.Matchers.empty;\n+import static org.hamcrest.Matchers.hasItem;\n+import static org.hamcrest.Matchers.hasItems;\n+import static org.hamcrest.Matchers.not;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.junit.Assert.assertTrue;\n+\n+import java.util.LinkedList;\n+import java.util.List;\n+\n+import org.eclipse.core.resources.IFolder;\n+import org.eclipse.core.runtime.CoreException;\n+import org.eclipse.emf.common.command.Command;\n+import org.eclipse.emf.ecore.resource.Resource;\n+import org.eclipse.emf.transaction.RecordingCommand;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import de.dlr.sc.virsat.model.dvlm.Repository;\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElement;\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralFactory;\n+import de.dlr.sc.virsat.project.test.AProjectTestCase;\n+\n+public class CreateRemoveSeiWithFileStructureCommandTest extends AProjectTestCase {\n+\t\n+\tStructuralElement se;\n+\t\n+\tStructuralElementInstance sei1;\n+\tStructuralElementInstance sei2;\n+\tStructuralElementInstance sei3;\n+\t\n+\tIFolder seiFolder1;\n+\tIFolder seiFolder2;\n+\tIFolder seiFolder3;\n+\t\n+\tResource resourceSei1;\n+\tResource resourceSei2;\n+\tResource resourceSei3;\n+\t\n+\t@Before\n+\tpublic void setUp() throws CoreException {\n+\t\tsuper.setUp();\n+\t\taddEditingDomainAndRepository();\n+\n+\t\teditingDomain.getCommandStack().execute(new RecordingCommand(editingDomain) {\n+\t\t\t@Override\n+\t\t\tprotected void doExecute() {\n+\t\t\t\tse = StructuralFactory.eINSTANCE.createStructuralElement();\n+\t\t\t\tse.setIsApplicableForAll(true);\n+\t\t\t\tse.setIsRootStructuralElement(true);\n+\t\t\t\t\n+\t\t\t\t// Now create a SEI for testing and embed it into the TransactionalEditingDomain \n+\t\t\t\tsei1 = StructuralFactory.eINSTANCE.createStructuralElementInstance();\n+\t\t\t\tsei2 = StructuralFactory.eINSTANCE.createStructuralElementInstance();\n+\t\t\t\tsei3 = StructuralFactory.eINSTANCE.createStructuralElementInstance();\n+\t\t\t\t\n+\t\t\t\tsei1.setType(se);\n+\t\t\t\tsei2.setType(se);\n+\t\t\t\tsei3.setType(se);\n+\t\t\t\t\n+\t\t\t\trepository.getRootEntities().add(sei1);\n+\t\t\t\tsei1.getChildren().add(sei2);\n+\t\t\t\tsei2.getChildren().add(sei3);\n+\t\t\t\t\n+\t\t\t\tprojectCommons.createFolderStructure(sei1, null);\n+\t\t\t\tprojectCommons.createFolderStructure(sei2, null);\n+\t\t\t\tprojectCommons.createFolderStructure(sei3, null);\n+\t\t\t\t\n+\t\t\t\tseiFolder1 = projectCommons.getStructuralElemntInstanceFolder(sei1);\n+\t\t\t\tseiFolder2 = projectCommons.getStructuralElemntInstanceFolder(sei2);\n+\t\t\t\tseiFolder3 = projectCommons.getStructuralElemntInstanceFolder(sei3);\n+\t\t\t\t\n+\t\t\t\tresourceSei1 = rs.getStructuralElementInstanceResource(sei1);\n+\t\t\t\tresourceSei2 = rs.getStructuralElementInstanceResource(sei2);\n+\t\t\t\tresourceSei3 = rs.getStructuralElementInstanceResource(sei3);\n+\t\t\t\t\n+\t\t\t\tresourceSei1.getContents().add(sei1);\n+\t\t\t\tresourceSei1.getContents().add(sei2);\n+\t\t\t\tresourceSei1.getContents().add(sei3);\n+\t\t\t}\n+\t\t});\n+\t}\n+\n+\t@After\n+\tpublic void tearDown() throws CoreException {\n+\t\tsuper.tearDown();", "originalCommit": "c4360be36b68528f8de5107232599f8cbf12addf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ3MTY5NA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/585#discussion_r416471694", "bodyText": "Can we use the executeAsCommand(...) here?", "author": "SaMuellerDLR", "createdAt": "2020-04-28T09:34:50Z", "path": "de.dlr.sc.virsat.project.test/src/de/dlr/sc/virsat/project/structure/command/RemoveFileStructureCommandTest.java", "diffHunk": "@@ -0,0 +1,192 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package de.dlr.sc.virsat.project.structure.command;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.concurrent.atomic.AtomicBoolean;\n+\n+import org.eclipse.core.commands.ExecutionException;\n+import org.eclipse.core.commands.operations.AbstractOperation;\n+import org.eclipse.core.resources.IFolder;\n+import org.eclipse.core.runtime.CoreException;\n+import org.eclipse.core.runtime.IAdaptable;\n+import org.eclipse.core.runtime.IProgressMonitor;\n+import org.eclipse.core.runtime.IStatus;\n+import org.eclipse.core.runtime.Status;\n+import org.eclipse.emf.common.command.Command;\n+import org.eclipse.emf.ecore.resource.Resource;\n+import org.eclipse.emf.transaction.RecordingCommand;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralFactory;\n+import de.dlr.sc.virsat.project.test.AProjectTestCase;\n+\n+public class RemoveFileStructureCommandTest extends AProjectTestCase {\n+\n+\tStructuralElementInstance testSei;\n+\tIFolder testSeiFolder;\n+\t\n+\tpublic static class TestDeleteOperation extends AbstractOperation {\n+\n+\t\tpublic TestDeleteOperation() {\n+\t\t\tsuper(\"Delete Operation\");\n+\t\t}\n+\n+\t\t@Override\n+\t\tpublic IStatus execute(IProgressMonitor monitor, IAdaptable info) throws ExecutionException {\n+\t\t\tfail(\"Should not have been called\");\n+\t\t\treturn Status.OK_STATUS;\n+\t\t}\n+\n+\t\t@Override\n+\t\tpublic IStatus redo(IProgressMonitor monitor, IAdaptable info) throws ExecutionException {\n+\t\t\tfail(\"Should not have been called\");\n+\t\t\treturn Status.OK_STATUS;\n+\t\t}\n+\n+\t\t@Override\n+\t\tpublic IStatus undo(IProgressMonitor monitor, IAdaptable info) throws ExecutionException {\n+\t\t\tfail(\"Should not have been called\");\n+\t\t\treturn Status.OK_STATUS;\n+\t\t}\n+\t\t\n+\t\t@Override\n+\t\tpublic boolean canExecute() {\n+\t\t\treturn false;\n+\t\t}\n+\t\t\n+\t\t@Override\n+\t\tpublic boolean canRedo() {\n+\t\t\treturn false;\n+\t\t}\n+\t\t\n+\t\t@Override\n+\t\tpublic boolean canUndo() {\n+\t\t\treturn false;\n+\t\t}\n+\t}\n+\t\n+\t@Before\n+\tpublic void setUp() throws CoreException {\n+\t\tsuper.setUp();\n+\t\t\n+\t\taddEditingDomainAndRepository();\n+\n+\t\teditingDomain.getCommandStack().execute(new RecordingCommand(editingDomain) {", "originalCommit": "c4360be36b68528f8de5107232599f8cbf12addf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ3MTc1OA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/585#discussion_r416471758", "bodyText": "Can be removed.", "author": "SaMuellerDLR", "createdAt": "2020-04-28T09:34:57Z", "path": "de.dlr.sc.virsat.project.test/src/de/dlr/sc/virsat/project/structure/command/RemoveFileStructureCommandTest.java", "diffHunk": "@@ -0,0 +1,192 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package de.dlr.sc.virsat.project.structure.command;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.concurrent.atomic.AtomicBoolean;\n+\n+import org.eclipse.core.commands.ExecutionException;\n+import org.eclipse.core.commands.operations.AbstractOperation;\n+import org.eclipse.core.resources.IFolder;\n+import org.eclipse.core.runtime.CoreException;\n+import org.eclipse.core.runtime.IAdaptable;\n+import org.eclipse.core.runtime.IProgressMonitor;\n+import org.eclipse.core.runtime.IStatus;\n+import org.eclipse.core.runtime.Status;\n+import org.eclipse.emf.common.command.Command;\n+import org.eclipse.emf.ecore.resource.Resource;\n+import org.eclipse.emf.transaction.RecordingCommand;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralFactory;\n+import de.dlr.sc.virsat.project.test.AProjectTestCase;\n+\n+public class RemoveFileStructureCommandTest extends AProjectTestCase {\n+\n+\tStructuralElementInstance testSei;\n+\tIFolder testSeiFolder;\n+\t\n+\tpublic static class TestDeleteOperation extends AbstractOperation {\n+\n+\t\tpublic TestDeleteOperation() {\n+\t\t\tsuper(\"Delete Operation\");\n+\t\t}\n+\n+\t\t@Override\n+\t\tpublic IStatus execute(IProgressMonitor monitor, IAdaptable info) throws ExecutionException {\n+\t\t\tfail(\"Should not have been called\");\n+\t\t\treturn Status.OK_STATUS;\n+\t\t}\n+\n+\t\t@Override\n+\t\tpublic IStatus redo(IProgressMonitor monitor, IAdaptable info) throws ExecutionException {\n+\t\t\tfail(\"Should not have been called\");\n+\t\t\treturn Status.OK_STATUS;\n+\t\t}\n+\n+\t\t@Override\n+\t\tpublic IStatus undo(IProgressMonitor monitor, IAdaptable info) throws ExecutionException {\n+\t\t\tfail(\"Should not have been called\");\n+\t\t\treturn Status.OK_STATUS;\n+\t\t}\n+\t\t\n+\t\t@Override\n+\t\tpublic boolean canExecute() {\n+\t\t\treturn false;\n+\t\t}\n+\t\t\n+\t\t@Override\n+\t\tpublic boolean canRedo() {\n+\t\t\treturn false;\n+\t\t}\n+\t\t\n+\t\t@Override\n+\t\tpublic boolean canUndo() {\n+\t\t\treturn false;\n+\t\t}\n+\t}\n+\t\n+\t@Before\n+\tpublic void setUp() throws CoreException {\n+\t\tsuper.setUp();\n+\t\t\n+\t\taddEditingDomainAndRepository();\n+\n+\t\teditingDomain.getCommandStack().execute(new RecordingCommand(editingDomain) {\n+\t\t\t@Override\n+\t\t\tprotected void doExecute() {\n+\t\t\t\t// Now create a SEI for testing and embed it into the TransactionalEditingDomain \n+\t\t\t\ttestSei = StructuralFactory.eINSTANCE.createStructuralElementInstance();\n+\t\t\t\tprojectCommons.createFolderStructure(testSei, null);\n+\t\t\t\ttestSeiFolder = projectCommons.getStructuralElemntInstanceFolder(testSei);\n+\t\t\t\tResource resource = rs.getStructuralElementInstanceResource(testSei);\n+\t\t\t\tresource.getContents().add(testSei);\n+\t\t\t}\n+\t\t});\n+\t}\n+\n+\t@After\n+\tpublic void tearDown() throws CoreException {\n+\t\tsuper.tearDown();", "originalCommit": "c4360be36b68528f8de5107232599f8cbf12addf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ3MjEwMg==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/585#discussion_r416472102", "bodyText": "Can be removed.", "author": "SaMuellerDLR", "createdAt": "2020-04-28T09:35:32Z", "path": "de.dlr.sc.virsat.project.test/src/de/dlr/sc/virsat/project/structure/operation/NoUndoDeleteResourceOperationTest.java", "diffHunk": "@@ -0,0 +1,132 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package de.dlr.sc.virsat.project.structure.operation;\n+\n+import static org.hamcrest.Matchers.containsString;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertThat;\n+import static org.junit.Assert.assertTrue;\n+\n+import java.io.File;\n+import java.io.IOException;\n+\n+import org.eclipse.core.commands.ExecutionException;\n+import org.eclipse.core.commands.operations.AbstractOperation;\n+import org.eclipse.core.resources.IFolder;\n+import org.eclipse.core.runtime.CoreException;\n+import org.eclipse.core.runtime.IProgressMonitor;\n+import org.eclipse.core.runtime.IStatus;\n+import org.eclipse.core.runtime.NullProgressMonitor;\n+import org.eclipse.core.runtime.Status;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import de.dlr.sc.virsat.project.test.AProjectTestCase;\n+\n+public class NoUndoDeleteResourceOperationTest extends AProjectTestCase {\n+\n+\tIFolder testFolder;\n+\tIFolder testSubFolder; \n+\t\n+\t@Before\n+\tpublic void setUp() throws CoreException {\n+\t\tsuper.setUp();\n+\t\ttestFolder = testProject.getFolder(\"testFolder\");\n+\t\ttestSubFolder = testFolder.getFolder(\"testSubFolder\");\n+\t\t\n+\t\ttestFolder.create(true, true, null);\n+\t\ttestSubFolder.create(true, true, null);\n+\t}\n+\n+\t@After\n+\tpublic void tearDown() throws CoreException  {\n+\t\tsuper.tearDown();", "originalCommit": "c4360be36b68528f8de5107232599f8cbf12addf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ3MzE3Mw==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/585#discussion_r416473173", "bodyText": "Could we maybe move the triggerSaveAll() into the executeExclusive(...) method since its logically needed in all cases?", "author": "SaMuellerDLR", "createdAt": "2020-04-28T09:37:07Z", "path": "de.dlr.sc.virsat.project/src/de/dlr/sc/virsat/project/structure/command/RemoveFileStructureCommand.java", "diffHunk": "@@ -0,0 +1,114 @@\n+/*******************************************************************************\r\n+ * Copyright (c) 2008-2019 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0.\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *******************************************************************************/\r\n+package de.dlr.sc.virsat.project.structure.command;\r\n+\r\n+import java.util.function.Function;\r\n+\r\n+import org.eclipse.core.commands.ExecutionException;\r\n+import org.eclipse.core.resources.IFolder;\r\n+import org.eclipse.core.resources.IProject;\r\n+import org.eclipse.core.runtime.Status;\r\n+import org.eclipse.emf.common.command.AbstractCommand;\r\n+import org.eclipse.core.commands.operations.AbstractOperation;\r\n+\r\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.util.command.IVirSatRecordableCommand;\r\n+import de.dlr.sc.virsat.project.Activator;\r\n+import de.dlr.sc.virsat.project.editingDomain.VirSatEditingDomainRegistry;\r\n+import de.dlr.sc.virsat.project.editingDomain.VirSatTransactionalEditingDomain;\r\n+import de.dlr.sc.virsat.project.structure.VirSatProjectCommons;\r\n+import de.dlr.sc.virsat.project.structure.operation.NoUndoDeleteResourceOperation;\r\n+\r\n+/**\r\n+ * This class wraps the IDE Workspace Operation of Deleting the folder of a SEI\r\n+ * By this the deletion is undoable restoring the full content including files\r\n+ * in the SEIs document folder\r\n+ *\r\n+ */\r\n+public class RemoveFileStructureCommand extends AbstractCommand implements IVirSatRecordableCommand {\r\n+\r\n+\tpublic static final Function<IFolder,  ? extends AbstractOperation> DELETE_RESOURCE_OPERATION_FUNCTION\r\n+\t\t= (iFolder) -> new NoUndoDeleteResourceOperation(iFolder, true);\r\n+\t\r\n+\tprivate VirSatProjectCommons projectCommons;\r\n+\tprivate AbstractOperation deleteResourceOperation;\r\n+\tprivate VirSatTransactionalEditingDomain editingDomain;\r\n+\t\r\n+\t/**\r\n+\t * Constructor for creating a command that removes the file structure from a given SEI in the workspace\r\n+\t * @param selectedProject the selected project\r\n+\t * @param iste {@link IStructuralTreeElement}\r\n+\t * @param deleteResourcesOperationFunction the callback function that is used to create the actual delete operation in the workspace\r\n+\t */\r\n+\tpublic RemoveFileStructureCommand(IProject selectedProject, StructuralElementInstance iste, Function<IFolder, ? extends AbstractOperation> deleteResourcesOperationFunction) {\r\n+\t\tprojectCommons = new VirSatProjectCommons(selectedProject);\r\n+\t\tIFolder seiFolder = projectCommons.getStructuralElemntInstanceFolder(iste);\r\n+\t\tthis.deleteResourceOperation = deleteResourcesOperationFunction.apply(seiFolder);\r\n+\t\teditingDomain = VirSatEditingDomainRegistry.INSTANCE.getEd(iste);\r\n+\t}\r\n+\t\r\n+\t/**\r\n+\t * Wrapper method to exclusively execute a runner in the Virtual Satellite Editing Domain\r\n+\t * @param runnable The runnable to be executed\r\n+\t */\r\n+\tprotected void executeExclusive(Runnable runnable) {\r\n+\t\ttry {\r\n+\t\t\teditingDomain.runExclusive(runnable);\r\n+\t\t} catch (InterruptedException e) {\r\n+\t\t\tActivator.getDefault().getLog().log(new Status(Status.ERROR, Activator.getPluginId(), \"Failed to Delete SEI folder structure!\", e));\r\n+\t\t}\r\n+\t}\r\n+\t\r\n+\t@Override\r\n+\tpublic void execute() {\r\n+\t\texecuteExclusive(() -> {\r\n+\t\t\ttry {\r\n+\t\t\t\tdeleteResourceOperation.execute(null, null);\r\n+\t\t\t\teditingDomain.getVirSatCommandStack().triggerSaveAll();\r", "originalCommit": "c4360be36b68528f8de5107232599f8cbf12addf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzA5NTU4Nw==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/585#discussion_r417095587", "bodyText": "Let's give it a try. When i fixed the SWTBot for stability, I realized that these changes easily ended up in deadlocks. Since we solved our deadlock issues, it is worth giving it a try. SWTBot should bail out in case things are bad.", "author": "PhilMFischer", "createdAt": "2020-04-29T06:38:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ3MzE3Mw=="}], "type": "inlineReview"}, {"oid": "9388acb5915dab9d9274d9b556c4cea56c712bf5", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/9388acb5915dab9d9274d9b556c4cea56c712bf5", "message": "Minor fixes due to review - (Task #584)\n\n- Removed some tear down.\n- Shifted the trigger save all in the RemoveCommand.\n- ...\n\n---\nTask #584: Implement non UI Command for deleting Structural Element\nInstances", "committedDate": "2020-04-29T07:08:32Z", "type": "commit"}, {"oid": "7906f5b6034828690dca52342addfa2cc39b1b37", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/7906f5b6034828690dca52342addfa2cc39b1b37", "message": "Improved comments and test for selecting SEIs for delete - (Task #584)\n\n- Improved comments in the code.\n- Improved test cases.\n\n---\nTask #584: Implement non UI Command for deleting Structural Element\nInstances", "committedDate": "2020-04-29T07:23:37Z", "type": "commit"}]}