{"pr_number": 515, "pr_title": "Export to Matlab", "pr_createdAt": "2020-03-04T08:20:50Z", "pr_url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/515", "timeline": [{"oid": "7701bddd1af220bb1f7696703bdae01a405625fb", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/7701bddd1af220bb1f7696703bdae01a405625fb", "message": "created de.dlr.sc.virsat.external.lib.matlabfile - (Task #489)\n\ncreated de.dlr.sc.virsat.external.lib.matlabfile\nincluded in de.dlr.sc.virsat.external.lib.feature\nincluded in pom.xml\n\n---\nTask #489: Include Matlab libary", "committedDate": "2020-02-24T14:49:21Z", "type": "commit"}, {"oid": "0fe64cbb3957d3d3fb34edc83c7598080aa4ccb3", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/0fe64cbb3957d3d3fb34edc83c7598080aa4ccb3", "message": "Added Header in Activator - (Task #489)\n\n\n---\nTask #489: Include Matlab libary", "committedDate": "2020-02-25T07:13:50Z", "type": "commit"}, {"oid": "2bf57f29e4166f56aa6b4c351c55db0ddf81470f", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/2bf57f29e4166f56aa6b4c351c55db0ddf81470f", "message": "First Try - (Task #489)\n\nImplemented first working exporter and test-case\n\n---\nTask #489: Include Matlab libary", "committedDate": "2020-02-25T15:04:57Z", "type": "commit"}, {"oid": "dd15ac42f8994c5455301e53c700347e58ef0b54", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/dd15ac42f8994c5455301e53c700347e58ef0b54", "message": "Structure for one element - (Task #489)\n\n---\nTask #489: Include Matlab libary", "committedDate": "2020-02-26T07:26:44Z", "type": "commit"}, {"oid": "89bde71e1d2dd3ace50c2807896f6cd248513bb8", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/89bde71e1d2dd3ace50c2807896f6cd248513bb8", "message": "Test-cases - (Task #489)\n\n---\nTask #489: Include Matlab libary", "committedDate": "2020-02-26T11:56:04Z", "type": "commit"}, {"oid": "e45e252676ec01946dcdcc743822086f26f4f98a", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/e45e252676ec01946dcdcc743822086f26f4f98a", "message": "Export per PropertyInstances - (Task #489)\n\nExporter export depending on Property-Instance different\n\n---\nTask #489: Include Matlab libary", "committedDate": "2020-02-27T15:25:00Z", "type": "commit"}, {"oid": "50119d2aa70cfb909defe9be9a2c7d6b1d72a41e", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/50119d2aa70cfb909defe9be9a2c7d6b1d72a41e", "message": "Can export Values and Units - (Task #489)\n\n---\nTask #489: Include Matlab libary", "committedDate": "2020-02-28T15:19:21Z", "type": "commit"}, {"oid": "9706adb67488f12df88c6169810750b8b3499d6c", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/9706adb67488f12df88c6169810750b8b3499d6c", "message": "Fixed EReferenc and Array - (Task #489)\n\nPut your Message here.\n\n---\nTask #489: Include Matlab libary", "committedDate": "2020-03-02T07:24:19Z", "type": "commit"}, {"oid": "aca2d7e114579f1e47e5f46db59934fef1cf901d", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/aca2d7e114579f1e47e5f46db59934fef1cf901d", "message": "Added Testcases - (Task #489)\n\nAdded testcase for TestCategoryAllProperty() and\nTestCategoryComposition()\n\n---\nTask #489: Include Matlab libary", "committedDate": "2020-03-02T15:13:01Z", "type": "commit"}, {"oid": "57fa8f3ec8afde2072be3ab3ef2bcc12820a662b", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/57fa8f3ec8afde2072be3ab3ef2bcc12820a662b", "message": "Added all Tests for ContentOfProperty - (Task #489)\n\n---\nTask #489: Include Matlab libary", "committedDate": "2020-03-03T13:26:46Z", "type": "commit"}, {"oid": "7a67c3833eaa9b0e924a94fb05ff3d5d73b8a198", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/7a67c3833eaa9b0e924a94fb05ff3d5d73b8a198", "message": "Export Children of Sei - (Task #489)\n\n\n---\nTask #489: Include Matlab libary", "committedDate": "2020-03-03T16:45:45Z", "type": "commit"}, {"oid": "56eed04f4a4a44ee59b791d9b5da1adbb3142f5d", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/56eed04f4a4a44ee59b791d9b5da1adbb3142f5d", "message": "Added Test for Sei Children - (Task #489)\n\n---\nTask #489: Include Matlab libary", "committedDate": "2020-03-04T08:08:12Z", "type": "commit"}, {"oid": "9a7b97039b4b6ce439994bb868cfe08a423b3c89", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/9a7b97039b4b6ce439994bb868cfe08a423b3c89", "message": "Deleted not needed import - (Task #489)\n\n---\nTask #489: Include Matlab libary", "committedDate": "2020-03-04T08:10:34Z", "type": "commit"}, {"oid": "a3f376d339992639735afb696bb4d5a63b608e3a", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/a3f376d339992639735afb696bb4d5a63b608e3a", "message": "Merge branch 'development' into feature/task_489-Include_Matlab_libary", "committedDate": "2020-03-05T15:00:36Z", "type": "commit"}, {"oid": "913055f810974bd46c04a114149351dc5ee7e626", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/913055f810974bd46c04a114149351dc5ee7e626", "message": "Changed constructor for BeanProperties - (Task #489)\n\nChanged constructor for\nBeanPropertyBoolean\nBeanPropertyString\nBeanPropertyEReference\n\n---\nTask #489: Include Matlab libary", "committedDate": "2020-03-05T15:21:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ1OTMyMA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/515#discussion_r388459320", "bodyText": "Maybe something like MatExporter to further indicate the purpose of the class through the name.", "author": "SaMuellerDLR", "createdAt": "2020-03-05T17:50:12Z", "path": "de.dlr.sc.virsat.model.edit/src/de/dlr/sc/virsat/model/dvlm/mat/Exporter.java", "diffHunk": "@@ -0,0 +1,290 @@\n+/*******************************************************************************\r\n+ * Copyright (c) 2008-2020 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0.\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *******************************************************************************/\r\n+package de.dlr.sc.virsat.model.dvlm.mat;\r\n+\r\n+import org.eclipse.emf.common.util.EList;\r\n+\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyBoolean;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyEReference;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyEnum;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyFloat;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyInt;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyResource;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyString;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.ATypeInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.CategoryAssignment;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.BooleanProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.EReferenceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.EnumProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.FloatProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.IntProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.ReferenceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.ResourceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.StringProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.APropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ArrayInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ComposedPropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.EReferencePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.EnumUnitPropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ReferencePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ResourcePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.UnitValuePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ValuePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.util.PropertyinstancesSwitch;\r\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\r\n+import us.hebi.matlab.mat.format.Mat5;\r\n+import us.hebi.matlab.mat.types.Array;\r\n+import us.hebi.matlab.mat.types.Cell;\r\n+import us.hebi.matlab.mat.types.MatFile;\r\n+import us.hebi.matlab.mat.types.Struct;\r\n+\r\n+/**\r\n+ * Class for exporting data to .mat\r\n+ */\r\n+public class Exporter {\r", "originalCommit": "913055f810974bd46c04a114149351dc5ee7e626", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ1OTk5Ng==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/515#discussion_r388459996", "bodyText": "I think we should consider making a class holding the keys like \"type\" or \"uuid\" as final static strings.\nThis would make sure that is easy to change them (for example if we want to change lower case to upper case or something like that) and it would probably usueful later in the importer since we will need the keys again there.", "author": "SaMuellerDLR", "createdAt": "2020-03-05T17:51:24Z", "path": "de.dlr.sc.virsat.model.edit/src/de/dlr/sc/virsat/model/dvlm/mat/Exporter.java", "diffHunk": "@@ -0,0 +1,290 @@\n+/*******************************************************************************\r\n+ * Copyright (c) 2008-2020 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0.\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *******************************************************************************/\r\n+package de.dlr.sc.virsat.model.dvlm.mat;\r\n+\r\n+import org.eclipse.emf.common.util.EList;\r\n+\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyBoolean;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyEReference;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyEnum;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyFloat;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyInt;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyResource;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyString;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.ATypeInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.CategoryAssignment;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.BooleanProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.EReferenceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.EnumProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.FloatProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.IntProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.ReferenceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.ResourceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.StringProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.APropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ArrayInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ComposedPropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.EReferencePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.EnumUnitPropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ReferencePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ResourcePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.UnitValuePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ValuePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.util.PropertyinstancesSwitch;\r\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\r\n+import us.hebi.matlab.mat.format.Mat5;\r\n+import us.hebi.matlab.mat.types.Array;\r\n+import us.hebi.matlab.mat.types.Cell;\r\n+import us.hebi.matlab.mat.types.MatFile;\r\n+import us.hebi.matlab.mat.types.Struct;\r\n+\r\n+/**\r\n+ * Class for exporting data to .mat\r\n+ */\r\n+public class Exporter {\r\n+\r\n+\t/**\r\n+\t * creates a new .mat with everything inside the given sei\r\n+\t * @param seiRoot sei to export\r\n+\t */\r\n+\tpublic MatFile exportSei(StructuralElementInstance seiRoot) {\r\n+\t\tMatFile matfile = Mat5.newMatFile();\t\t\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tstruct.set(\"type\", Mat5.newString(seiRoot.getType().getName()))\r", "originalCommit": "913055f810974bd46c04a114149351dc5ee7e626", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc0ODk0MQ==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/515#discussion_r388748941", "bodyText": "@SaMuellerDLR\nI changed it, but I am not sure if it is the way you wanted.", "author": "ALEhmerDLR", "createdAt": "2020-03-06T07:30:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ1OTk5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ2MDQwNA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/515#discussion_r388460404", "bodyText": "Out of place comment.", "author": "SaMuellerDLR", "createdAt": "2020-03-05T17:52:09Z", "path": "de.dlr.sc.virsat.model.edit/src/de/dlr/sc/virsat/model/dvlm/mat/Exporter.java", "diffHunk": "@@ -0,0 +1,290 @@\n+/*******************************************************************************\r\n+ * Copyright (c) 2008-2020 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0.\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *******************************************************************************/\r\n+package de.dlr.sc.virsat.model.dvlm.mat;\r\n+\r\n+import org.eclipse.emf.common.util.EList;\r\n+\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyBoolean;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyEReference;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyEnum;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyFloat;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyInt;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyResource;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyString;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.ATypeInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.CategoryAssignment;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.BooleanProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.EReferenceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.EnumProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.FloatProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.IntProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.ReferenceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.ResourceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.StringProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.APropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ArrayInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ComposedPropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.EReferencePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.EnumUnitPropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ReferencePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ResourcePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.UnitValuePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ValuePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.util.PropertyinstancesSwitch;\r\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\r\n+import us.hebi.matlab.mat.format.Mat5;\r\n+import us.hebi.matlab.mat.types.Array;\r\n+import us.hebi.matlab.mat.types.Cell;\r\n+import us.hebi.matlab.mat.types.MatFile;\r\n+import us.hebi.matlab.mat.types.Struct;\r\n+\r\n+/**\r\n+ * Class for exporting data to .mat\r\n+ */\r\n+public class Exporter {\r\n+\r\n+\t/**\r\n+\t * creates a new .mat with everything inside the given sei\r\n+\t * @param seiRoot sei to export\r\n+\t */\r\n+\tpublic MatFile exportSei(StructuralElementInstance seiRoot) {\r\n+\t\tMatFile matfile = Mat5.newMatFile();\t\t\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tstruct.set(\"type\", Mat5.newString(seiRoot.getType().getName()))\r\n+\t\t\t.set(\"uuid\", Mat5.newString(seiRoot.getUuid().toString()));\r\n+\t\tif (seiRoot.getChildren().size() > 0) {\r\n+\t\t\tStruct children = Mat5.newStruct();\r\n+\t\t\tfor (StructuralElementInstance sei : seiRoot.getChildren()) {\r\n+\t\t\t\tMatFile child = exportSei(sei);\r\n+\t\t\t\tchildren.set(sei.getName(), child.getArray(sei.getName()));\r\n+\t\t\t}\r\n+\t\t\tstruct.set(\"children\", children);\r\n+\t\t}\r\n+\t\t\r\n+\t\tfor (CategoryAssignment ca : seiRoot.getCategoryAssignments()) {\r\n+\t\t\tstruct.set(ca.getName(), exportCatAs(ca));\r\n+\t\t}\r\n+\r\n+\t\tmatfile.addArray(seiRoot.getName(), struct);\r\n+\t\treturn matfile;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat with everything inside the selected CategoryAssinments\r\n+\t * @param cas list of CategoryAssinments\r\n+\t */\r\n+\tpublic MatFile exportCas(EList<CategoryAssignment> cas) {\r\n+\t\tMatFile matfile = Mat5.newMatFile();\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tfor (CategoryAssignment ca : cas) {\r\n+\t\t\tstruct.set(ca.getName(), exportCatAs(ca));\r\n+\t\t}\r\n+\t\tmatfile.addArray(\"inputs\", struct);\r\n+\t\treturn matfile;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all properties of an CategoryAssinment\r\n+\t * @param ca CategoryAssignment\r\n+\t */\r\n+\tprivate Struct exportCatAs(CategoryAssignment ca) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tEList<APropertyInstance> propertyInstances = ca.getPropertyInstances();\r\n+\r\n+\t\tfor (APropertyInstance pi : propertyInstances) {\r\n+\t\t\tArray propertyArray = getRightProperty(pi);\r\n+\t\t\tstruct.set(pi.getType().getName(), propertyArray);\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * hands back right property with all values\r\n+\t * @param element APropertyInstance\r\n+\t */\r\n+\tprivate Array getRightProperty(APropertyInstance element) {\r\n+\t\tArray propertyArray = new PropertyinstancesSwitch<Array>() {\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseUnitValuePropertyInstance(UnitValuePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseResourcePropertyInstance(ResourcePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseEnumUnitPropertyInstance(EnumUnitPropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseValuePropertyInstance(ValuePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseReferencePropertyInstance(ReferencePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseEReferencePropertyInstance(EReferencePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseComposedPropertyInstance(ComposedPropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseArrayInstance(ArrayInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t}.doSwitch(element);\r\n+\t\treturn propertyArray;\r\n+\t}\r\n+\r\n+\t//create a struct for the fitting PropertyInstance\r", "originalCommit": "913055f810974bd46c04a114149351dc5ee7e626", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ2MDY0Nw==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/515#discussion_r388460647", "bodyText": "Unneeded whitespacing.", "author": "SaMuellerDLR", "createdAt": "2020-03-05T17:52:37Z", "path": "de.dlr.sc.virsat.model.edit/src/de/dlr/sc/virsat/model/dvlm/mat/Exporter.java", "diffHunk": "@@ -0,0 +1,290 @@\n+/*******************************************************************************\r\n+ * Copyright (c) 2008-2020 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0.\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *******************************************************************************/\r\n+package de.dlr.sc.virsat.model.dvlm.mat;\r\n+\r\n+import org.eclipse.emf.common.util.EList;\r\n+\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyBoolean;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyEReference;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyEnum;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyFloat;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyInt;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyResource;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyString;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.ATypeInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.CategoryAssignment;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.BooleanProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.EReferenceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.EnumProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.FloatProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.IntProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.ReferenceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.ResourceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.StringProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.APropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ArrayInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ComposedPropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.EReferencePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.EnumUnitPropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ReferencePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ResourcePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.UnitValuePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ValuePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.util.PropertyinstancesSwitch;\r\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\r\n+import us.hebi.matlab.mat.format.Mat5;\r\n+import us.hebi.matlab.mat.types.Array;\r\n+import us.hebi.matlab.mat.types.Cell;\r\n+import us.hebi.matlab.mat.types.MatFile;\r\n+import us.hebi.matlab.mat.types.Struct;\r\n+\r\n+/**\r\n+ * Class for exporting data to .mat\r\n+ */\r\n+public class Exporter {\r\n+\r\n+\t/**\r\n+\t * creates a new .mat with everything inside the given sei\r\n+\t * @param seiRoot sei to export\r\n+\t */\r\n+\tpublic MatFile exportSei(StructuralElementInstance seiRoot) {\r\n+\t\tMatFile matfile = Mat5.newMatFile();\t\t\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tstruct.set(\"type\", Mat5.newString(seiRoot.getType().getName()))\r\n+\t\t\t.set(\"uuid\", Mat5.newString(seiRoot.getUuid().toString()));\r\n+\t\tif (seiRoot.getChildren().size() > 0) {\r\n+\t\t\tStruct children = Mat5.newStruct();\r\n+\t\t\tfor (StructuralElementInstance sei : seiRoot.getChildren()) {\r\n+\t\t\t\tMatFile child = exportSei(sei);\r\n+\t\t\t\tchildren.set(sei.getName(), child.getArray(sei.getName()));\r\n+\t\t\t}\r\n+\t\t\tstruct.set(\"children\", children);\r\n+\t\t}\r\n+\t\t\r\n+\t\tfor (CategoryAssignment ca : seiRoot.getCategoryAssignments()) {\r\n+\t\t\tstruct.set(ca.getName(), exportCatAs(ca));\r\n+\t\t}\r\n+\r\n+\t\tmatfile.addArray(seiRoot.getName(), struct);\r\n+\t\treturn matfile;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat with everything inside the selected CategoryAssinments\r\n+\t * @param cas list of CategoryAssinments\r\n+\t */\r\n+\tpublic MatFile exportCas(EList<CategoryAssignment> cas) {\r\n+\t\tMatFile matfile = Mat5.newMatFile();\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tfor (CategoryAssignment ca : cas) {\r\n+\t\t\tstruct.set(ca.getName(), exportCatAs(ca));\r\n+\t\t}\r\n+\t\tmatfile.addArray(\"inputs\", struct);\r\n+\t\treturn matfile;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all properties of an CategoryAssinment\r\n+\t * @param ca CategoryAssignment\r\n+\t */\r\n+\tprivate Struct exportCatAs(CategoryAssignment ca) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tEList<APropertyInstance> propertyInstances = ca.getPropertyInstances();\r\n+\r\n+\t\tfor (APropertyInstance pi : propertyInstances) {\r\n+\t\t\tArray propertyArray = getRightProperty(pi);\r\n+\t\t\tstruct.set(pi.getType().getName(), propertyArray);\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * hands back right property with all values\r\n+\t * @param element APropertyInstance\r\n+\t */\r\n+\tprivate Array getRightProperty(APropertyInstance element) {\r\n+\t\tArray propertyArray = new PropertyinstancesSwitch<Array>() {\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseUnitValuePropertyInstance(UnitValuePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseResourcePropertyInstance(ResourcePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseEnumUnitPropertyInstance(EnumUnitPropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseValuePropertyInstance(ValuePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseReferencePropertyInstance(ReferencePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseEReferencePropertyInstance(EReferencePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseComposedPropertyInstance(ComposedPropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseArrayInstance(ArrayInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t}.doSwitch(element);\r\n+\t\treturn propertyArray;\r\n+\t}\r\n+\r\n+\t//create a struct for the fitting PropertyInstance\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about UnitValuePropertyInstance\r\n+\t * only unit and value are saved\r\n+\t * @param element UnitValuePropertyInstance\r\n+\t */\r\n+\tprivate Array contentOfProperty(UnitValuePropertyInstance element) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\r\n+\t\tif (element.getType() instanceof FloatProperty) {\r\n+\t\t\tBeanPropertyFloat bpf = new BeanPropertyFloat(element);\r\n+\t\t\tstruct.set(\"unit\", Mat5.newString(bpf.getUnit()));\r\n+\t\t\tstruct.set(\"value\", (bpf.getValue() == Double.NaN) ? Mat5.newString(\"\") : Mat5.newScalar(bpf.getValue()));\r\n+\t\t} else if (element.getType() instanceof IntProperty) {\r\n+\t\t\tBeanPropertyInt bpi = new BeanPropertyInt(element);\r\n+\t\t\tstruct.set(\"unit\", Mat5.newString(bpi.getUnit()));\r\n+\t\t\tstruct.set(\"value\", (!bpi.isSet()) ? Mat5.newString(\"\") : Mat5.newScalar(bpi.getValue()));\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about ValuePropertyInstance\r\n+\t * only Value is saved\r\n+\t * @param element ValuePropertyInstance\r\n+\t */\r\n+\tprivate Struct contentOfProperty(ValuePropertyInstance element) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tif (element.getType() instanceof BooleanProperty) {\r\n+\t\t\tBeanPropertyBoolean bpb = new BeanPropertyBoolean(element);\r\n+\t\t\tstruct.set(\"value\", (!bpb.isSet()) ? Mat5.newString(\"\") : Mat5.newLogicalScalar(bpb.getValue()));\r\n+\t\t} else if (element.getType() instanceof StringProperty) {\r\n+\t\t\tBeanPropertyString bps = new BeanPropertyString(element);\r\n+\t\t\tstruct.set(\"value\", (!bps.isSet()) ? Mat5.newString(\"\") : Mat5.newString(bps.getValue()));\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about EReferencePropertyInstance\r\n+\t * only uuid, reference and reference-class are saved\r\n+\t * @param element EReferencePropertyInstance\r\n+\t */\r\n+\tprivate Array contentOfProperty(EReferencePropertyInstance element) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tif (element.getType() instanceof EReferenceProperty) {\r\n+\t\t\t\r", "originalCommit": "913055f810974bd46c04a114149351dc5ee7e626", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ2MDkxMA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/515#discussion_r388460910", "bodyText": "We can move this before the if check and then check if (referencedTypeInstance != null)", "author": "SaMuellerDLR", "createdAt": "2020-03-05T17:53:09Z", "path": "de.dlr.sc.virsat.model.edit/src/de/dlr/sc/virsat/model/dvlm/mat/Exporter.java", "diffHunk": "@@ -0,0 +1,290 @@\n+/*******************************************************************************\r\n+ * Copyright (c) 2008-2020 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0.\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *******************************************************************************/\r\n+package de.dlr.sc.virsat.model.dvlm.mat;\r\n+\r\n+import org.eclipse.emf.common.util.EList;\r\n+\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyBoolean;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyEReference;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyEnum;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyFloat;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyInt;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyResource;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyString;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.ATypeInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.CategoryAssignment;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.BooleanProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.EReferenceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.EnumProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.FloatProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.IntProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.ReferenceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.ResourceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.StringProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.APropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ArrayInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ComposedPropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.EReferencePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.EnumUnitPropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ReferencePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ResourcePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.UnitValuePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ValuePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.util.PropertyinstancesSwitch;\r\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\r\n+import us.hebi.matlab.mat.format.Mat5;\r\n+import us.hebi.matlab.mat.types.Array;\r\n+import us.hebi.matlab.mat.types.Cell;\r\n+import us.hebi.matlab.mat.types.MatFile;\r\n+import us.hebi.matlab.mat.types.Struct;\r\n+\r\n+/**\r\n+ * Class for exporting data to .mat\r\n+ */\r\n+public class Exporter {\r\n+\r\n+\t/**\r\n+\t * creates a new .mat with everything inside the given sei\r\n+\t * @param seiRoot sei to export\r\n+\t */\r\n+\tpublic MatFile exportSei(StructuralElementInstance seiRoot) {\r\n+\t\tMatFile matfile = Mat5.newMatFile();\t\t\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tstruct.set(\"type\", Mat5.newString(seiRoot.getType().getName()))\r\n+\t\t\t.set(\"uuid\", Mat5.newString(seiRoot.getUuid().toString()));\r\n+\t\tif (seiRoot.getChildren().size() > 0) {\r\n+\t\t\tStruct children = Mat5.newStruct();\r\n+\t\t\tfor (StructuralElementInstance sei : seiRoot.getChildren()) {\r\n+\t\t\t\tMatFile child = exportSei(sei);\r\n+\t\t\t\tchildren.set(sei.getName(), child.getArray(sei.getName()));\r\n+\t\t\t}\r\n+\t\t\tstruct.set(\"children\", children);\r\n+\t\t}\r\n+\t\t\r\n+\t\tfor (CategoryAssignment ca : seiRoot.getCategoryAssignments()) {\r\n+\t\t\tstruct.set(ca.getName(), exportCatAs(ca));\r\n+\t\t}\r\n+\r\n+\t\tmatfile.addArray(seiRoot.getName(), struct);\r\n+\t\treturn matfile;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat with everything inside the selected CategoryAssinments\r\n+\t * @param cas list of CategoryAssinments\r\n+\t */\r\n+\tpublic MatFile exportCas(EList<CategoryAssignment> cas) {\r\n+\t\tMatFile matfile = Mat5.newMatFile();\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tfor (CategoryAssignment ca : cas) {\r\n+\t\t\tstruct.set(ca.getName(), exportCatAs(ca));\r\n+\t\t}\r\n+\t\tmatfile.addArray(\"inputs\", struct);\r\n+\t\treturn matfile;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all properties of an CategoryAssinment\r\n+\t * @param ca CategoryAssignment\r\n+\t */\r\n+\tprivate Struct exportCatAs(CategoryAssignment ca) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tEList<APropertyInstance> propertyInstances = ca.getPropertyInstances();\r\n+\r\n+\t\tfor (APropertyInstance pi : propertyInstances) {\r\n+\t\t\tArray propertyArray = getRightProperty(pi);\r\n+\t\t\tstruct.set(pi.getType().getName(), propertyArray);\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * hands back right property with all values\r\n+\t * @param element APropertyInstance\r\n+\t */\r\n+\tprivate Array getRightProperty(APropertyInstance element) {\r\n+\t\tArray propertyArray = new PropertyinstancesSwitch<Array>() {\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseUnitValuePropertyInstance(UnitValuePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseResourcePropertyInstance(ResourcePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseEnumUnitPropertyInstance(EnumUnitPropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseValuePropertyInstance(ValuePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseReferencePropertyInstance(ReferencePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseEReferencePropertyInstance(EReferencePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseComposedPropertyInstance(ComposedPropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseArrayInstance(ArrayInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t}.doSwitch(element);\r\n+\t\treturn propertyArray;\r\n+\t}\r\n+\r\n+\t//create a struct for the fitting PropertyInstance\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about UnitValuePropertyInstance\r\n+\t * only unit and value are saved\r\n+\t * @param element UnitValuePropertyInstance\r\n+\t */\r\n+\tprivate Array contentOfProperty(UnitValuePropertyInstance element) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\r\n+\t\tif (element.getType() instanceof FloatProperty) {\r\n+\t\t\tBeanPropertyFloat bpf = new BeanPropertyFloat(element);\r\n+\t\t\tstruct.set(\"unit\", Mat5.newString(bpf.getUnit()));\r\n+\t\t\tstruct.set(\"value\", (bpf.getValue() == Double.NaN) ? Mat5.newString(\"\") : Mat5.newScalar(bpf.getValue()));\r\n+\t\t} else if (element.getType() instanceof IntProperty) {\r\n+\t\t\tBeanPropertyInt bpi = new BeanPropertyInt(element);\r\n+\t\t\tstruct.set(\"unit\", Mat5.newString(bpi.getUnit()));\r\n+\t\t\tstruct.set(\"value\", (!bpi.isSet()) ? Mat5.newString(\"\") : Mat5.newScalar(bpi.getValue()));\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about ValuePropertyInstance\r\n+\t * only Value is saved\r\n+\t * @param element ValuePropertyInstance\r\n+\t */\r\n+\tprivate Struct contentOfProperty(ValuePropertyInstance element) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tif (element.getType() instanceof BooleanProperty) {\r\n+\t\t\tBeanPropertyBoolean bpb = new BeanPropertyBoolean(element);\r\n+\t\t\tstruct.set(\"value\", (!bpb.isSet()) ? Mat5.newString(\"\") : Mat5.newLogicalScalar(bpb.getValue()));\r\n+\t\t} else if (element.getType() instanceof StringProperty) {\r\n+\t\t\tBeanPropertyString bps = new BeanPropertyString(element);\r\n+\t\t\tstruct.set(\"value\", (!bps.isSet()) ? Mat5.newString(\"\") : Mat5.newString(bps.getValue()));\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about EReferencePropertyInstance\r\n+\t * only uuid, reference and reference-class are saved\r\n+\t * @param element EReferencePropertyInstance\r\n+\t */\r\n+\tprivate Array contentOfProperty(EReferencePropertyInstance element) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tif (element.getType() instanceof EReferenceProperty) {\r\n+\t\t\t\r\n+\t\t\tBeanPropertyEReference<EReferenceProperty> bpe = new BeanPropertyEReference<EReferenceProperty>(element);\r\n+\t\t\t\r\n+\t\t\tstruct.set(\"reference\", (!bpe.isSet()) ? Mat5.newString(\"\") : Mat5.newString(bpe.getValue().toString()));\r\n+\t\t\tstruct.set(\"reference-class\", (!bpe.isSet()) ? Mat5.newString(\"\") : Mat5.newString(bpe.getValue().getClass().getName()));\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about ReferencePropertyInstance\r\n+\t * only uuid and fullQualifiedInstanceName are saved\r\n+\t * @param element ReferencePropertyInstance\r\n+\t */\r\n+\tprivate Array contentOfProperty(ReferencePropertyInstance element) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tif (element.getType() instanceof ReferenceProperty) {\r\n+\t\t\tif (element.getReference() != null) {\r\n+\t\t\t\tATypeInstance referencedTypeInstance = element.getReference();\r", "originalCommit": "913055f810974bd46c04a114149351dc5ee7e626", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ2MTQzNw==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/515#discussion_r388461437", "bodyText": "Should describe the purpose of this function a bit more. I think it was because matlab always generates a \"\" around the values right?", "author": "SaMuellerDLR", "createdAt": "2020-03-05T17:54:06Z", "path": "de.dlr.sc.virsat.model.edit/src/de/dlr/sc/virsat/model/dvlm/mat/Exporter.java", "diffHunk": "@@ -0,0 +1,290 @@\n+/*******************************************************************************\r\n+ * Copyright (c) 2008-2020 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0.\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *******************************************************************************/\r\n+package de.dlr.sc.virsat.model.dvlm.mat;\r\n+\r\n+import org.eclipse.emf.common.util.EList;\r\n+\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyBoolean;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyEReference;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyEnum;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyFloat;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyInt;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyResource;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyString;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.ATypeInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.CategoryAssignment;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.BooleanProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.EReferenceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.EnumProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.FloatProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.IntProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.ReferenceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.ResourceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.StringProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.APropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ArrayInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ComposedPropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.EReferencePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.EnumUnitPropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ReferencePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ResourcePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.UnitValuePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ValuePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.util.PropertyinstancesSwitch;\r\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\r\n+import us.hebi.matlab.mat.format.Mat5;\r\n+import us.hebi.matlab.mat.types.Array;\r\n+import us.hebi.matlab.mat.types.Cell;\r\n+import us.hebi.matlab.mat.types.MatFile;\r\n+import us.hebi.matlab.mat.types.Struct;\r\n+\r\n+/**\r\n+ * Class for exporting data to .mat\r\n+ */\r\n+public class Exporter {\r\n+\r\n+\t/**\r\n+\t * creates a new .mat with everything inside the given sei\r\n+\t * @param seiRoot sei to export\r\n+\t */\r\n+\tpublic MatFile exportSei(StructuralElementInstance seiRoot) {\r\n+\t\tMatFile matfile = Mat5.newMatFile();\t\t\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tstruct.set(\"type\", Mat5.newString(seiRoot.getType().getName()))\r\n+\t\t\t.set(\"uuid\", Mat5.newString(seiRoot.getUuid().toString()));\r\n+\t\tif (seiRoot.getChildren().size() > 0) {\r\n+\t\t\tStruct children = Mat5.newStruct();\r\n+\t\t\tfor (StructuralElementInstance sei : seiRoot.getChildren()) {\r\n+\t\t\t\tMatFile child = exportSei(sei);\r\n+\t\t\t\tchildren.set(sei.getName(), child.getArray(sei.getName()));\r\n+\t\t\t}\r\n+\t\t\tstruct.set(\"children\", children);\r\n+\t\t}\r\n+\t\t\r\n+\t\tfor (CategoryAssignment ca : seiRoot.getCategoryAssignments()) {\r\n+\t\t\tstruct.set(ca.getName(), exportCatAs(ca));\r\n+\t\t}\r\n+\r\n+\t\tmatfile.addArray(seiRoot.getName(), struct);\r\n+\t\treturn matfile;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat with everything inside the selected CategoryAssinments\r\n+\t * @param cas list of CategoryAssinments\r\n+\t */\r\n+\tpublic MatFile exportCas(EList<CategoryAssignment> cas) {\r\n+\t\tMatFile matfile = Mat5.newMatFile();\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tfor (CategoryAssignment ca : cas) {\r\n+\t\t\tstruct.set(ca.getName(), exportCatAs(ca));\r\n+\t\t}\r\n+\t\tmatfile.addArray(\"inputs\", struct);\r\n+\t\treturn matfile;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all properties of an CategoryAssinment\r\n+\t * @param ca CategoryAssignment\r\n+\t */\r\n+\tprivate Struct exportCatAs(CategoryAssignment ca) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tEList<APropertyInstance> propertyInstances = ca.getPropertyInstances();\r\n+\r\n+\t\tfor (APropertyInstance pi : propertyInstances) {\r\n+\t\t\tArray propertyArray = getRightProperty(pi);\r\n+\t\t\tstruct.set(pi.getType().getName(), propertyArray);\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * hands back right property with all values\r\n+\t * @param element APropertyInstance\r\n+\t */\r\n+\tprivate Array getRightProperty(APropertyInstance element) {\r\n+\t\tArray propertyArray = new PropertyinstancesSwitch<Array>() {\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseUnitValuePropertyInstance(UnitValuePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseResourcePropertyInstance(ResourcePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseEnumUnitPropertyInstance(EnumUnitPropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseValuePropertyInstance(ValuePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseReferencePropertyInstance(ReferencePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseEReferencePropertyInstance(EReferencePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseComposedPropertyInstance(ComposedPropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseArrayInstance(ArrayInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t}.doSwitch(element);\r\n+\t\treturn propertyArray;\r\n+\t}\r\n+\r\n+\t//create a struct for the fitting PropertyInstance\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about UnitValuePropertyInstance\r\n+\t * only unit and value are saved\r\n+\t * @param element UnitValuePropertyInstance\r\n+\t */\r\n+\tprivate Array contentOfProperty(UnitValuePropertyInstance element) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\r\n+\t\tif (element.getType() instanceof FloatProperty) {\r\n+\t\t\tBeanPropertyFloat bpf = new BeanPropertyFloat(element);\r\n+\t\t\tstruct.set(\"unit\", Mat5.newString(bpf.getUnit()));\r\n+\t\t\tstruct.set(\"value\", (bpf.getValue() == Double.NaN) ? Mat5.newString(\"\") : Mat5.newScalar(bpf.getValue()));\r\n+\t\t} else if (element.getType() instanceof IntProperty) {\r\n+\t\t\tBeanPropertyInt bpi = new BeanPropertyInt(element);\r\n+\t\t\tstruct.set(\"unit\", Mat5.newString(bpi.getUnit()));\r\n+\t\t\tstruct.set(\"value\", (!bpi.isSet()) ? Mat5.newString(\"\") : Mat5.newScalar(bpi.getValue()));\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about ValuePropertyInstance\r\n+\t * only Value is saved\r\n+\t * @param element ValuePropertyInstance\r\n+\t */\r\n+\tprivate Struct contentOfProperty(ValuePropertyInstance element) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tif (element.getType() instanceof BooleanProperty) {\r\n+\t\t\tBeanPropertyBoolean bpb = new BeanPropertyBoolean(element);\r\n+\t\t\tstruct.set(\"value\", (!bpb.isSet()) ? Mat5.newString(\"\") : Mat5.newLogicalScalar(bpb.getValue()));\r\n+\t\t} else if (element.getType() instanceof StringProperty) {\r\n+\t\t\tBeanPropertyString bps = new BeanPropertyString(element);\r\n+\t\t\tstruct.set(\"value\", (!bps.isSet()) ? Mat5.newString(\"\") : Mat5.newString(bps.getValue()));\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about EReferencePropertyInstance\r\n+\t * only uuid, reference and reference-class are saved\r\n+\t * @param element EReferencePropertyInstance\r\n+\t */\r\n+\tprivate Array contentOfProperty(EReferencePropertyInstance element) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tif (element.getType() instanceof EReferenceProperty) {\r\n+\t\t\t\r\n+\t\t\tBeanPropertyEReference<EReferenceProperty> bpe = new BeanPropertyEReference<EReferenceProperty>(element);\r\n+\t\t\t\r\n+\t\t\tstruct.set(\"reference\", (!bpe.isSet()) ? Mat5.newString(\"\") : Mat5.newString(bpe.getValue().toString()));\r\n+\t\t\tstruct.set(\"reference-class\", (!bpe.isSet()) ? Mat5.newString(\"\") : Mat5.newString(bpe.getValue().getClass().getName()));\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about ReferencePropertyInstance\r\n+\t * only uuid and fullQualifiedInstanceName are saved\r\n+\t * @param element ReferencePropertyInstance\r\n+\t */\r\n+\tprivate Array contentOfProperty(ReferencePropertyInstance element) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tif (element.getType() instanceof ReferenceProperty) {\r\n+\t\t\tif (element.getReference() != null) {\r\n+\t\t\t\tATypeInstance referencedTypeInstance = element.getReference();\r\n+\t\t\t\tstruct.set(\"uuid\", Mat5.newString(referencedTypeInstance.getUuid().toString()));\r\n+\t\t\t\tstruct.set(\"fullQualifiedInstanceName\", Mat5.newString(referencedTypeInstance.getFullQualifiedInstanceName()));\r\n+\t\t\t} else {\r\n+\t\t\t\tstruct.set(\"uuid\", Mat5.newString(\"\"));\r\n+\t\t\t\tstruct.set(\"fullQualifiedInstanceName\", Mat5.newString(\"\"));\r\n+\t\t\t}\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about ResourcePropertyInstance\r\n+\t * only uri is saved\r\n+\t * @param element ResourcePropertyInstance\r\n+\t */\r\n+\tprivate Array contentOfProperty(ResourcePropertyInstance element) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tif (element.getType() instanceof ResourceProperty) {\r\n+\t\t\tBeanPropertyResource bpr = new BeanPropertyResource(element);\r\n+\t\t\tstruct.set(\"uri\", (!bpr.isSet()) ? Mat5.newString(\"\") : Mat5.newString(bpr.getValue().toString()));\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about EnumUnitPropertyInstance\r\n+\t * only unit,value and name are saved\r\n+\t * @param element EnumUnitPropertyInstance\r\n+\t */\r\n+\tprivate Array contentOfProperty(EnumUnitPropertyInstance element) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tif (element.getType() instanceof EnumProperty) {\r\n+\t\t\tBeanPropertyEnum bpe = new BeanPropertyEnum(element);\r\n+\t\t\tstruct.set(\"unit\", Mat5.newString(bpe.getUnit()));\r\n+\t\t\tstruct.set(\"value\", (!bpe.isSet()) ? Mat5.newString(\"\") : Mat5.newScalar(bpe.getEnumValue()));\r\n+\t\t\tstruct.set(\"name\", (!bpe.isSet()) ? Mat5.newString(\"\") : Mat5.newString(bpe.getValue()));\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about ArrayInstance\r\n+\t * @param element ArrayInstance\r\n+\t */\r\n+\tprivate Array contentOfProperty(ArrayInstance element) {\r\n+\t\tEList<APropertyInstance> propertyInstances = element.getArrayInstances();\r\n+\t\tCell cell = Mat5.newCell(propertyInstances.size(), 1);\r\n+\t\tfor (int i = 0; i < propertyInstances.size(); i++) {\r\n+\t\t\tAPropertyInstance instanceElement = propertyInstances.get(i);\r\n+\t\t\tArray propertyArray = getRightProperty(instanceElement);\r\n+\t\t\tcell.set(i, propertyArray);\r\n+\t\t}\r\n+\t\treturn cell;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about ComposedPropertyInstance\r\n+\t * @param element ComposedPropertyInstance\r\n+\t */\r\n+\tprivate Array contentOfProperty(ComposedPropertyInstance element) {\r\n+\t\treturn exportCatAs(element.getTypeInstance());\r\n+\t}\r\n+\r\n+\t//Delete First and Last Character\r", "originalCommit": "913055f810974bd46c04a114149351dc5ee7e626", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "776e6620f6ac106f423bf08091059241d209d717", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/776e6620f6ac106f423bf08091059241d209d717", "message": "Requested Changes - (Task #489)\n\nAdded description to shorter()\nDeleted whitespace\nDeleted comment\nChanged name to MatExporter and MatExporterTest\n---\nTask #489: Include Matlab libary", "committedDate": "2020-03-06T06:58:04Z", "type": "commit"}, {"oid": "b02cd22b50ec297933c1bd59e34e857f047eab68", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/b02cd22b50ec297933c1bd59e34e857f047eab68", "message": "Missed Changed File- (Task #489)\n\n---\nTask #489: Include Matlab libary", "committedDate": "2020-03-06T06:58:57Z", "type": "commit"}, {"oid": "aef6d2801c60be1147c54867d1c1c3d5d5c94369", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/aef6d2801c60be1147c54867d1c1c3d5d5c94369", "message": "Requested Changes - (Task #489)\n\n---\nTask #489: Include Matlab libary", "committedDate": "2020-03-06T07:17:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc1ODAzMA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/515#discussion_r388758030", "bodyText": "Method comments are usually done with /** **/\nAlso could use a @param str in the comment.", "author": "SaMuellerDLR", "createdAt": "2020-03-06T07:58:30Z", "path": "de.dlr.sc.virsat.model.edit/src/de/dlr/sc/virsat/model/dvlm/mat/MatExporter.java", "diffHunk": "@@ -0,0 +1,288 @@\n+/*******************************************************************************\r\n+ * Copyright (c) 2008-2020 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0.\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *******************************************************************************/\r\n+package de.dlr.sc.virsat.model.dvlm.mat;\r\n+\r\n+import org.eclipse.emf.common.util.EList;\r\n+\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyBoolean;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyEReference;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyEnum;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyFloat;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyInt;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyResource;\r\n+import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyString;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.ATypeInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.CategoryAssignment;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.BooleanProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.EReferenceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.EnumProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.FloatProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.IntProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.ReferenceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.ResourceProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.StringProperty;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.APropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ArrayInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ComposedPropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.EReferencePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.EnumUnitPropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ReferencePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ResourcePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.UnitValuePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ValuePropertyInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.util.PropertyinstancesSwitch;\r\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\r\n+import us.hebi.matlab.mat.format.Mat5;\r\n+import us.hebi.matlab.mat.types.Array;\r\n+import us.hebi.matlab.mat.types.Cell;\r\n+import us.hebi.matlab.mat.types.MatFile;\r\n+import us.hebi.matlab.mat.types.Struct;\r\n+\r\n+/**\r\n+ * Class for exporting data to .mat\r\n+ */\r\n+public class MatExporter {\r\n+\r\n+\t/**\r\n+\t * creates a new .mat with everything inside the given sei\r\n+\t * @param seiRoot sei to export\r\n+\t */\r\n+\tpublic MatFile exportSei(StructuralElementInstance seiRoot) {\r\n+\t\tMatFile matfile = Mat5.newMatFile();\t\t\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tstruct.set(MatHelper.TYPE, Mat5.newString(seiRoot.getType().getName()))\r\n+\t\t\t.set(MatHelper.UUID, Mat5.newString(seiRoot.getUuid().toString()));\r\n+\t\tif (seiRoot.getChildren().size() > 0) {\r\n+\t\t\tStruct children = Mat5.newStruct();\r\n+\t\t\tfor (StructuralElementInstance sei : seiRoot.getChildren()) {\r\n+\t\t\t\tMatFile child = exportSei(sei);\r\n+\t\t\t\tchildren.set(sei.getName(), child.getArray(sei.getName()));\r\n+\t\t\t}\r\n+\t\t\tstruct.set(MatHelper.CHILDREN, children);\r\n+\t\t}\r\n+\t\t\r\n+\t\tfor (CategoryAssignment ca : seiRoot.getCategoryAssignments()) {\r\n+\t\t\tstruct.set(ca.getName(), exportCatAs(ca));\r\n+\t\t}\r\n+\r\n+\t\tmatfile.addArray(seiRoot.getName(), struct);\r\n+\t\treturn matfile;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat with everything inside the selected CategoryAssinments\r\n+\t * @param cas list of CategoryAssinments\r\n+\t */\r\n+\tpublic MatFile exportCas(EList<CategoryAssignment> cas) {\r\n+\t\tMatFile matfile = Mat5.newMatFile();\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tfor (CategoryAssignment ca : cas) {\r\n+\t\t\tstruct.set(ca.getName(), exportCatAs(ca));\r\n+\t\t}\r\n+\t\tmatfile.addArray(MatHelper.INPUTS, struct);\r\n+\t\treturn matfile;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all properties of an CategoryAssinment\r\n+\t * @param ca CategoryAssignment\r\n+\t */\r\n+\tprivate Struct exportCatAs(CategoryAssignment ca) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tEList<APropertyInstance> propertyInstances = ca.getPropertyInstances();\r\n+\r\n+\t\tfor (APropertyInstance pi : propertyInstances) {\r\n+\t\t\tArray propertyArray = getRightProperty(pi);\r\n+\t\t\tstruct.set(pi.getType().getName(), propertyArray);\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * hands back right property with all values\r\n+\t * @param element APropertyInstance\r\n+\t */\r\n+\tprivate Array getRightProperty(APropertyInstance element) {\r\n+\t\tArray propertyArray = new PropertyinstancesSwitch<Array>() {\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseUnitValuePropertyInstance(UnitValuePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseResourcePropertyInstance(ResourcePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseEnumUnitPropertyInstance(EnumUnitPropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseValuePropertyInstance(ValuePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseReferencePropertyInstance(ReferencePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseEReferencePropertyInstance(EReferencePropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseComposedPropertyInstance(ComposedPropertyInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t\t@Override\r\n+\t\t\tpublic Array caseArrayInstance(ArrayInstance object) {\r\n+\t\t\t\treturn contentOfProperty(object);\r\n+\t\t\t}\r\n+\r\n+\t\t}.doSwitch(element);\r\n+\t\treturn propertyArray;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about UnitValuePropertyInstance\r\n+\t * only unit and value are saved\r\n+\t * @param element UnitValuePropertyInstance\r\n+\t */\r\n+\tprivate Array contentOfProperty(UnitValuePropertyInstance element) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\r\n+\t\tif (element.getType() instanceof FloatProperty) {\r\n+\t\t\tBeanPropertyFloat bpf = new BeanPropertyFloat(element);\r\n+\t\t\tstruct.set(MatHelper.UNIT, Mat5.newString(bpf.getUnit()));\r\n+\t\t\tstruct.set(MatHelper.VALUE, (bpf.getValue() == Double.NaN) ? Mat5.newString(\"\") : Mat5.newScalar(bpf.getValue()));\r\n+\t\t} else if (element.getType() instanceof IntProperty) {\r\n+\t\t\tBeanPropertyInt bpi = new BeanPropertyInt(element);\r\n+\t\t\tstruct.set(MatHelper.UNIT, Mat5.newString(bpi.getUnit()));\r\n+\t\t\tstruct.set(MatHelper.VALUE, (!bpi.isSet()) ? Mat5.newString(\"\") : Mat5.newScalar(bpi.getValue()));\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about ValuePropertyInstance\r\n+\t * only Value is saved\r\n+\t * @param element ValuePropertyInstance\r\n+\t */\r\n+\tprivate Struct contentOfProperty(ValuePropertyInstance element) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tif (element.getType() instanceof BooleanProperty) {\r\n+\t\t\tBeanPropertyBoolean bpb = new BeanPropertyBoolean(element);\r\n+\t\t\tstruct.set(MatHelper.VALUE, (!bpb.isSet()) ? Mat5.newString(\"\") : Mat5.newLogicalScalar(bpb.getValue()));\r\n+\t\t} else if (element.getType() instanceof StringProperty) {\r\n+\t\t\tBeanPropertyString bps = new BeanPropertyString(element);\r\n+\t\t\tstruct.set(MatHelper.VALUE, (!bps.isSet()) ? Mat5.newString(\"\") : Mat5.newString(bps.getValue()));\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about EReferencePropertyInstance\r\n+\t * only uuid, reference and reference-class are saved\r\n+\t * @param element EReferencePropertyInstance\r\n+\t */\r\n+\tprivate Array contentOfProperty(EReferencePropertyInstance element) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tif (element.getType() instanceof EReferenceProperty) {\r\n+\t\t\tBeanPropertyEReference<EReferenceProperty> bpe = new BeanPropertyEReference<EReferenceProperty>(element);\r\n+\t\t\tstruct.set(MatHelper.REF, (!bpe.isSet()) ? Mat5.newString(\"\") : Mat5.newString(bpe.getValue().toString()));\r\n+\t\t\tstruct.set(MatHelper.REFCLASS, (!bpe.isSet()) ? Mat5.newString(\"\") : Mat5.newString(bpe.getValue().getClass().getName()));\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about ReferencePropertyInstance\r\n+\t * only uuid and fullQualifiedInstanceName are saved\r\n+\t * @param element ReferencePropertyInstance\r\n+\t */\r\n+\tprivate Array contentOfProperty(ReferencePropertyInstance element) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tif (element.getType() instanceof ReferenceProperty) {\r\n+\t\t\tATypeInstance referencedTypeInstance = element.getReference();\r\n+\t\t\tif (element.getReference() != null) {\r\n+\t\t\t\tstruct.set(MatHelper.UUID, Mat5.newString(referencedTypeInstance.getUuid().toString()));\r\n+\t\t\t\tstruct.set(MatHelper.FULLNAME, Mat5.newString(referencedTypeInstance.getFullQualifiedInstanceName()));\r\n+\t\t\t} else {\r\n+\t\t\t\tstruct.set(MatHelper.UUID, Mat5.newString(\"\"));\r\n+\t\t\t\tstruct.set(MatHelper.FULLNAME, Mat5.newString(\"\"));\r\n+\t\t\t}\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about ResourcePropertyInstance\r\n+\t * only uri is saved\r\n+\t * @param element ResourcePropertyInstance\r\n+\t */\r\n+\tprivate Array contentOfProperty(ResourcePropertyInstance element) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tif (element.getType() instanceof ResourceProperty) {\r\n+\t\t\tBeanPropertyResource bpr = new BeanPropertyResource(element);\r\n+\t\t\tstruct.set(MatHelper.URI, (!bpr.isSet()) ? Mat5.newString(\"\") : Mat5.newString(bpr.getValue().toString()));\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about EnumUnitPropertyInstance\r\n+\t * only unit,value and name are saved\r\n+\t * @param element EnumUnitPropertyInstance\r\n+\t */\r\n+\tprivate Array contentOfProperty(EnumUnitPropertyInstance element) {\r\n+\t\tStruct struct = Mat5.newStruct();\r\n+\t\tif (element.getType() instanceof EnumProperty) {\r\n+\t\t\tBeanPropertyEnum bpe = new BeanPropertyEnum(element);\r\n+\t\t\tstruct.set(MatHelper.UNIT, Mat5.newString(bpe.getUnit()));\r\n+\t\t\tstruct.set(MatHelper.VALUE, (!bpe.isSet()) ? Mat5.newString(\"\") : Mat5.newScalar(bpe.getEnumValue()));\r\n+\t\t\tstruct.set(MatHelper.NAME, (!bpe.isSet()) ? Mat5.newString(\"\") : Mat5.newString(bpe.getValue()));\r\n+\t\t}\r\n+\t\treturn struct;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about ArrayInstance\r\n+\t * @param element ArrayInstance\r\n+\t */\r\n+\tprivate Array contentOfProperty(ArrayInstance element) {\r\n+\t\tEList<APropertyInstance> propertyInstances = element.getArrayInstances();\r\n+\t\tCell cell = Mat5.newCell(propertyInstances.size(), 1);\r\n+\t\tfor (int i = 0; i < propertyInstances.size(); i++) {\r\n+\t\t\tAPropertyInstance instanceElement = propertyInstances.get(i);\r\n+\t\t\tArray propertyArray = getRightProperty(instanceElement);\r\n+\t\t\tcell.set(i, propertyArray);\r\n+\t\t}\r\n+\t\treturn cell;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * creates a new .mat-struct with all information about ComposedPropertyInstance\r\n+\t * @param element ComposedPropertyInstance\r\n+\t */\r\n+\tprivate Array contentOfProperty(ComposedPropertyInstance element) {\r\n+\t\treturn exportCatAs(element.getTypeInstance());\r\n+\t}\r\n+\r\n+\t//Delete First and Last Character of a string.\r", "originalCommit": "aef6d2801c60be1147c54867d1c1c3d5d5c94369", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7d7561d3315a26d8b869e52ff59aae9459a3d824", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/7d7561d3315a26d8b869e52ff59aae9459a3d824", "message": "Changed commentstyle - (Task #489)\n\n---\nTask #489: Include Matlab libary", "committedDate": "2020-03-06T08:03:27Z", "type": "commit"}]}