{"pr_number": 748, "pr_title": "PR #2 Low Level API - Add SEIs", "pr_createdAt": "2020-10-05T10:42:11Z", "pr_url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/748", "timeline": [{"oid": "e70ba8de1b3e3704ea772fd37282604d37e1a03c", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/e70ba8de1b3e3704ea772fd37282604d37e1a03c", "message": "Merge branch 'feature/task_725-Transform_SEIs,_Conce' into feature/task_555-Add_Seis_to_API", "committedDate": "2020-10-01T10:10:35Z", "type": "commit"}, {"oid": "ffcfe38f11ea69476706aed315acca52019c270e", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/ffcfe38f11ea69476706aed315acca52019c270e", "message": "Add Seis to ModelAccessResource - (Task #555)\n\n- Add the following methods to ModelAccessResource:\n  - Get RootSeis\n  - Get and Put Sei\n- Add test cases to ModelAccessResourceTest\n- Update CustomJsonProvider:\n  - Also register Sei classes manually\n  - When unmarshalling the RootSeis only register needed adapter classes\nmanually\n\n---\nTask #555: Add Low Level Data API to access SEIs and CAs to REST server", "committedDate": "2020-10-02T10:50:04Z", "type": "commit"}, {"oid": "a13d615e63fac5ce57f5b5dc075cb134ad63f679", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/a13d615e63fac5ce57f5b5dc075cb134ad63f679", "message": "Call syncRepository in CustomJsonProvider - (Task #555)\n\nNow the whole repository has to be handed over to the provider.\n\n---\nTask #555: Add Low Level Data API to access SEIs and CAs to REST server", "committedDate": "2020-10-05T08:52:35Z", "type": "commit"}, {"oid": "62a06b620f973f6cc8c9ca61a7f364513f2498a8", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/62a06b620f973f6cc8c9ca61a7f364513f2498a8", "message": "Fix CustomJsonProviderTest - (Task #555)\n\nAdd missing supper user rights.\n\n---\nTask #555: Add Low Level Data API to access SEIs and CAs to REST server", "committedDate": "2020-10-05T10:17:38Z", "type": "commit"}, {"oid": "5091b06ec0f3d9a20a9adee08b5b9f35718b1d90", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/5091b06ec0f3d9a20a9adee08b5b9f35718b1d90", "message": "Merge branch 'feature/task_725-Transform_SEIs,_Conce' into feature/task_555-Add_Seis_to_API", "committedDate": "2020-10-20T09:42:55Z", "type": "commit"}, {"oid": "0daff01e1f5440d94bd993da01dda54a82fbbd87", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/0daff01e1f5440d94bd993da01dda54a82fbbd87", "message": "Merge branch 'feature/task_725-Transform_SEIs,_Conce' into feature/task_555-Add_Seis_to_API", "committedDate": "2020-10-22T11:17:33Z", "type": "commit"}, {"oid": "4ac63e3513bc09273ad730a7f83f1aa76d29653c", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/4ac63e3513bc09273ad730a7f83f1aa76d29653c", "message": "Merge branch 'development' into feature/task_555-Add_Seis_to_API\n\nConflicts:\n\tde.dlr.sc.virsat.server.test/src/de/dlr/sc/virsat/server/dataaccess/CustomJsonProviderTest.java\n\tde.dlr.sc.virsat.server.test/src/de/dlr/sc/virsat/server/test/AServerRepositoryTest.java\n\tde.dlr.sc.virsat.server/META-INF/MANIFEST.MF\n\tde.dlr.sc.virsat.server/src/de/dlr/sc/virsat/server/dataaccess/CustomJsonProvider.java", "committedDate": "2020-10-26T09:08:01Z", "type": "commit"}, {"oid": "e44a027e530d23939506805d916ffe311b6f70bb", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/e44a027e530d23939506805d916ffe311b6f70bb", "message": "Add ModelAccessResourceTest tear down - (Task #555)\n\nResolves an issue with doubled elements in the resource set that caused\ntest errors.\n\n---\nTask #555: Add Low Level Data API to access SEIs and CAs to REST server", "committedDate": "2020-10-26T11:21:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ4MzIzOQ==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/748#discussion_r512483239", "bodyText": "Do we want to print out the messages here?", "author": "SaMuellerDLR", "createdAt": "2020-10-27T08:05:07Z", "path": "de.dlr.sc.virsat.server.test/src/de/dlr/sc/virsat/server/dataaccess/TransactionalJsonProviderTest.java", "diffHunk": "@@ -118,16 +123,52 @@ public void testWriteTo() throws WebApplicationException, IOException {\n \t\twriteToAndAssert();\n \t}\n \t\n+\t/**\n+\t * Open the remote repository and count the commits\n+\t * @return number of commits in remote\n+\t * @throws IOException\n+\t * @throws NoHeadException\n+\t * @throws GitAPIException\n+\t * @throws InterruptedException\n+\t */\n+\tprivate int countCommits() throws IOException, NoHeadException, GitAPIException, InterruptedException {\n+\t\tGit git = Git.open(pathRepoRemote.toFile());\n+\t\tIterator<RevCommit> iterator = git.log().call().iterator();\n+\t\tint commits = 0;\n+\t\twhile (iterator.hasNext()) {\n+\t\t\tSystem.out.println(iterator.next().getFullMessage());", "originalCommit": "e44a027e530d23939506805d916ffe311b6f70bb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ5NjE2OA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/748#discussion_r512496168", "bodyText": "Nope, I will delete the print statement", "author": "JAmmermann-DLR", "createdAt": "2020-10-27T08:27:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ4MzIzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ4NzA5MQ==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/748#discussion_r512487091", "bodyText": "Do we still need this if it was just for debugging?", "author": "SaMuellerDLR", "createdAt": "2020-10-27T08:12:08Z", "path": "de.dlr.sc.virsat.server/src/de/dlr/sc/virsat/server/dataaccess/TransactionalJsonProvider.java", "diffHunk": "@@ -92,14 +118,30 @@ public void setEd(VirSatTransactionalEditingDomain ed) {\n \tprotected void preWriteTo(Object object, Class<?> type, Type genericType,\n \t\t\tAnnotation[] annotations, MediaType mediaType,\n \t\t\tMultivaluedMap<String, Object> httpHeaders, Marshaller marshaller) throws JAXBException {\n+\t\tsuper.preWriteTo(object, type, genericType, annotations, mediaType, httpHeaders, marshaller);\n \t\tmarshaller.setEventHandler(eventHandler);\n \t}\n-\n+\t\n+\t@Override\n+\tpublic void writeTo(Object object, Class<?> type, Type genericType, Annotation[] annotations, MediaType mediaType,\n+\t\t\tMultivaluedMap<String, Object> httpHeaders, OutputStream entityStream)\n+\t\t\tthrows IOException, WebApplicationException {\n+\t\t// Useful for debugging\n+\t\tsuper.writeTo(object, type, genericType, annotations, mediaType, httpHeaders, entityStream);", "originalCommit": "e44a027e530d23939506805d916ffe311b6f70bb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ5Njc2MA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/748#discussion_r512496760", "bodyText": "I think it would be easier to maintain if we leave it there. But I don't have a strong opinion on it, so we could delete them.\nIn general I think it is not easy to debug beacuse of the huge Moxy/Jaxb stack in the background and we don't have the sources atm. So having this functions where you can easily put a breakpoint makes it a lot easier in my opinion.", "author": "JAmmermann-DLR", "createdAt": "2020-10-27T08:28:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ4NzA5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY2MTYyMg==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/748#discussion_r512661622", "bodyText": "Okay.", "author": "SaMuellerDLR", "createdAt": "2020-10-27T12:46:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ4NzA5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ4ODQ0Mg==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/748#discussion_r512488442", "bodyText": "Can we just use \"List\" on the left hand side?", "author": "SaMuellerDLR", "createdAt": "2020-10-27T08:14:35Z", "path": "de.dlr.sc.virsat.server/src/de/dlr/sc/virsat/server/resources/ModelAccessResource.java", "diffHunk": "@@ -226,6 +234,57 @@ public Response getCa(@PathParam(\"caUuid\") String caUuid) {\n \t\tpublic Response putCa(ABeanCategoryAssignment bean) {\r\n \t\t\treturn Response.status(Response.Status.OK).build();\r\n \t\t}\r\n+\t\t\r\n+\t\t/**\r\n+\t\t * Returns a response with a list of the root seis\r\n+\t\t * @return a server response\r\n+\t\t */\r\n+\t\t@GET\r\n+\t\t@Path(ROOT_SEIS)\r\n+\t\t@Produces(MediaType.APPLICATION_JSON)\r\n+\t\tpublic Response getRootSeis() {\r\n+\t\t\ttry {\r\n+\t\t\t\tEList<StructuralElementInstance> rootSeis = repository.getRootEntities();\r", "originalCommit": "e44a027e530d23939506805d916ffe311b6f70bb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ5Nzk2MA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/748#discussion_r512497960", "bodyText": "Sure", "author": "JAmmermann-DLR", "createdAt": "2020-10-27T08:30:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ4ODQ0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ4OTM4Nw==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/748#discussion_r512489387", "bodyText": "Lets break this up a bit so we dont have such a complicated parameter call.", "author": "SaMuellerDLR", "createdAt": "2020-10-27T08:16:16Z", "path": "de.dlr.sc.virsat.server/src/de/dlr/sc/virsat/server/resources/ModelAccessResource.java", "diffHunk": "@@ -226,6 +234,57 @@ public Response getCa(@PathParam(\"caUuid\") String caUuid) {\n \t\tpublic Response putCa(ABeanCategoryAssignment bean) {\r\n \t\t\treturn Response.status(Response.Status.OK).build();\r\n \t\t}\r\n+\t\t\r\n+\t\t/**\r\n+\t\t * Returns a response with a list of the root seis\r\n+\t\t * @return a server response\r\n+\t\t */\r\n+\t\t@GET\r\n+\t\t@Path(ROOT_SEIS)\r\n+\t\t@Produces(MediaType.APPLICATION_JSON)\r\n+\t\tpublic Response getRootSeis() {\r\n+\t\t\ttry {\r\n+\t\t\t\tEList<StructuralElementInstance> rootSeis = repository.getRootEntities();\r\n+\t\t\t\tList<ABeanStructuralElementInstance> beans = new ArrayList<ABeanStructuralElementInstance>();\r\n+\t\t\t\t\r\n+\t\t\t\tfor (StructuralElementInstance sei : rootSeis) {\r\n+\t\t\t\t\tbeans.add((ABeanStructuralElementInstance) new BeanStructuralElementInstanceFactory().getInstanceFor(sei));\r\n+\t\t\t\t}\r\n+\t\t\t\t\r\n+\t\t\t\tGenericEntity<List<ABeanStructuralElementInstance>> genericEntityList =\r\n+\t\t\t\t\t\tnew GenericEntity<List<ABeanStructuralElementInstance>>(beans) { };\r\n+\r\n+\t\t\t\treturn Response.ok(genericEntityList).build();\r\n+\t\t\t} catch (CoreException e) {\r\n+\t\t\t\treturn createBadRequestResponse(e.getMessage());\r\n+\t\t\t}\r\n+\t\t}\r\n+\t\t\r\n+\t\t/**\r\n+\t\t * Returns a response with the sei with the seiUuid\r\n+\t\t * @param seiUuid uuid of the sei\r\n+\t\t * @return a server response\r\n+\t\t */\r\n+\t\t@GET\r\n+\t\t@Path(SEI + \"/{seiUuid}\")\r\n+\t\t@Produces(MediaType.APPLICATION_JSON)\r\n+\t\tpublic Response getSei(@PathParam(\"seiUuid\") String seiUuid) {\r\n+\t\t\ttry {\r\n+\t\t\t\treturn Response.ok(\r\n+\t\t\t\t\t\tnew BeanStructuralElementInstanceFactory().getInstanceFor(\r", "originalCommit": "e44a027e530d23939506805d916ffe311b6f70bb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ5MzU5NA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/748#discussion_r512493594", "bodyText": "Super important: We also have to set this to false after the test case is done because the super user flag is some static object so it gets carried into the next test case.", "author": "SaMuellerDLR", "createdAt": "2020-10-27T08:23:39Z", "path": "de.dlr.sc.virsat.server.test/src/de/dlr/sc/virsat/server/dataaccess/TransactionalJsonProviderTest.java", "diffHunk": "@@ -29,71 +30,75 @@\n import javax.xml.bind.JAXBContext;\n import javax.xml.bind.JAXBException;\n \n-import org.eclipse.core.runtime.CoreException;\n+import org.eclipse.core.runtime.NullProgressMonitor;\n+import org.eclipse.emf.common.command.Command;\n+import org.eclipse.emf.edit.command.AddCommand;\n+import org.eclipse.jgit.api.Git;\n+import org.eclipse.jgit.api.errors.GitAPIException;\n+import org.eclipse.jgit.api.errors.NoHeadException;\n+import org.eclipse.jgit.revwalk.RevCommit;\n import org.junit.Before;\n import org.junit.Test;\n \n import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyInt;\n-import de.dlr.sc.virsat.model.concept.types.property.BeanPropertyString;\n-import de.dlr.sc.virsat.model.dvlm.categories.CategoriesFactory;\n-import de.dlr.sc.virsat.model.dvlm.categories.Category;\n-import de.dlr.sc.virsat.model.dvlm.categories.CategoryAssignment;\n-import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.PropertydefinitionsFactory;\n-import de.dlr.sc.virsat.model.dvlm.categories.propertydefinitions.StringProperty;\n-import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.PropertyinstancesFactory;\n-import de.dlr.sc.virsat.model.dvlm.categories.propertyinstances.ValuePropertyInstance;\n+import de.dlr.sc.virsat.model.concept.types.structural.BeanStructuralElementInstance;\n+import de.dlr.sc.virsat.model.dvlm.DVLMPackage;\n+import de.dlr.sc.virsat.model.dvlm.roles.UserRegistry;\n import de.dlr.sc.virsat.model.dvlm.structural.StructuralElement;\n import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\n import de.dlr.sc.virsat.model.dvlm.structural.StructuralFactory;\n-import de.dlr.sc.virsat.project.test.AProjectTestCase;\n+import de.dlr.sc.virsat.project.editingDomain.VirSatTransactionalEditingDomain;\n+import de.dlr.sc.virsat.project.resources.command.CreateSeiResourceAndFileCommand;\n+import de.dlr.sc.virsat.server.test.AServerRepositoryTest;\n \n-public class TransactionalJsonProviderTest extends AProjectTestCase {\n+public class TransactionalJsonProviderTest extends AServerRepositoryTest {\n \n \tprivate TransactionalJsonProvider provider;\n-\tprivate BeanPropertyString testBean;\n+\tprivate BeanStructuralElementInstance testBean;\n \tprivate Class<?> type;\n \tprivate Set<Class<?>> beanClass = new HashSet<>();\n \tprivate MediaType mediaType;\n \tprivate String testString = \"test\";\n \n \t@Before\n-\tpublic void setUp() throws CoreException {\n+\tpublic void setUp() throws Exception {\n \t\tsuper.setUp();\n-\t\taddEditingDomainAndRepository();\n+\t\t\n+\t\tUserRegistry.getInstance().setSuperUser(true);", "originalCommit": "e44a027e530d23939506805d916ffe311b6f70bb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ5OTU4NA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/748#discussion_r512499584", "bodyText": "Yes, sorry I forgot that", "author": "JAmmermann-DLR", "createdAt": "2020-10-27T08:33:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ5MzU5NA=="}], "type": "inlineReview"}, {"oid": "84e91ed23193baa1d02e0066a9e2e7b34c57016f", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/84e91ed23193baa1d02e0066a9e2e7b34c57016f", "message": "Changes due to review - (Task #555)\n\n- Use List instead of EList\n- Break up code\n- Delete print\n- setSuperUser to false in tearDown\n\n---\nTask #555: Add Low Level Data API to access SEIs and CAs to REST server", "committedDate": "2020-10-27T08:58:07Z", "type": "commit"}]}