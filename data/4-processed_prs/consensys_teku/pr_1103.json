{"pr_number": 1103, "pr_title": "Add runAfterDelay and runAsync to SafeFuture", "pr_createdAt": "2020-01-21T22:30:25Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1103", "timeline": [{"oid": "9796fee25240ec3bd33e0639ffe0d4b76956aa26", "url": "https://github.com/ConsenSys/teku/commit/9796fee25240ec3bd33e0639ffe0d4b76956aa26", "message": "Add runAfterDelay and runAsync to SafeFuture.", "committedDate": "2020-01-21T22:28:58Z", "type": "commit"}, {"oid": "8d5930800d8d4002cacfd022a4ab026a7090c83e", "url": "https://github.com/ConsenSys/teku/commit/8d5930800d8d4002cacfd022a4ab026a7090c83e", "message": "Merge branch 'master' into runAfterDelay", "committedDate": "2020-01-21T22:30:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI4NTg0Mw==", "url": "https://github.com/ConsenSys/teku/pull/1103#discussion_r369285843", "bodyText": "I don' t understand why you included this line.", "author": "cemozerr", "createdAt": "2020-01-21T22:49:03Z", "path": "util/src/test/java/tech/pegasys/artemis/util/async/SafeFutureTest.java", "diffHunk": "@@ -309,6 +318,65 @@ public void exceptionallyCompose_shouldNotDoAnythingWhenCompletedSuccessfully()\n     assertThat(result).isCompletedWithValue(\"Success\");\n   }\n \n+  @SuppressWarnings(\"unchecked\")\n+  @Test\n+  public void runAsync_shouldExecuteActionWithExecutorAndReturnResult() {\n+    final SafeFuture<String> actionResult = new SafeFuture<>();\n+    final Executor executor = mock(Executor.class);\n+    final Supplier<SafeFuture<String>> action = mock(Supplier.class);\n+    when(action.get()).thenReturn(actionResult);\n+\n+    final SafeFuture<String> result = SafeFuture.runAsync(action, executor);\n+\n+    final ArgumentCaptor<Runnable> captor = ArgumentCaptor.forClass(Runnable.class);\n+    verify(executor).execute(captor.capture());\n+    final Runnable executedRunnable = captor.getValue();\n+\n+    executedRunnable.run();", "originalCommit": "8d5930800d8d4002cacfd022a4ab026a7090c83e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI4NTk3Mw==", "url": "https://github.com/ConsenSys/teku/pull/1103#discussion_r369285973", "bodyText": "Do you mind explaining it?", "author": "cemozerr", "createdAt": "2020-01-21T22:49:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI4NTg0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI4Njk1NQ==", "url": "https://github.com/ConsenSys/teku/pull/1103#discussion_r369286955", "bodyText": "Because executor is a mock, it won't actually run the runnable that was passed in.  So we use an ArgumentCaptor to capture it so we can call it ourselves when we're ready to in the test.", "author": "ajsutton", "createdAt": "2020-01-21T22:52:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI4NTg0Mw=="}], "type": "inlineReview"}, {"oid": "1ce6c73650dc6f1f8e6993b156fd469f2cd43005", "url": "https://github.com/ConsenSys/teku/commit/1ce6c73650dc6f1f8e6993b156fd469f2cd43005", "message": "Merge branch 'master' of github.com:PegaSysEng/artemis into runAfterDelay", "committedDate": "2020-01-21T22:51:13Z", "type": "commit"}]}