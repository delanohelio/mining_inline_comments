{"pr_number": 3090, "pr_title": "AbstractByteBufDecoder: don't close twice", "pr_createdAt": "2020-10-27T16:56:47Z", "pr_url": "https://github.com/ConsenSys/teku/pull/3090", "timeline": [{"oid": "291db00c1da1fdb0b2c84b0f7dd256e3309ef40b", "url": "https://github.com/ConsenSys/teku/commit/291db00c1da1fdb0b2c84b0f7dd256e3309ef40b", "message": "AbstractByteBufDecoder: don't close twice", "committedDate": "2020-10-27T14:27:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk1ODUwNQ==", "url": "https://github.com/ConsenSys/teku/pull/3090#discussion_r512958505", "bodyText": "(nit / optional) We could move this to a helper method assertOpen()", "author": "mbaxter", "createdAt": "2020-10-27T19:11:58Z", "path": "networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/rpc/core/encodings/AbstractByteBufDecoder.java", "diffHunk": "@@ -30,12 +30,16 @@\n     implements ByteBufDecoder<TMessage, TException> {\n \n   private CompositeByteBuf compositeByteBuf = Unpooled.compositeBuffer();\n+  private boolean closed = false;\n \n   @Override\n   public Optional<TMessage> decodeOneMessage(ByteBuf in) throws TException {\n     if (!in.isReadable()) {\n       return Optional.empty();\n     }\n+    if (closed) {\n+      throw new IllegalStateException(\"Trying to reuse disposed decoder instance\");\n+    }", "originalCommit": "291db00c1da1fdb0b2c84b0f7dd256e3309ef40b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMwMDUxNQ==", "url": "https://github.com/ConsenSys/teku/pull/3090#discussion_r513300515", "bodyText": "Yep good idea  \ud83d\udc4d  Just named it assertNotClosed since Opened sounds a bit weird with respect to Decoder IMO :)", "author": "Nashatyrev", "createdAt": "2020-10-28T09:37:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk1ODUwNQ=="}], "type": "inlineReview"}, {"oid": "054872ce63c88cdce936de977bfbd8345fe04795", "url": "https://github.com/ConsenSys/teku/commit/054872ce63c88cdce936de977bfbd8345fe04795", "message": "Deduplicate code: add assertNotClosed() method", "committedDate": "2020-10-28T09:35:55Z", "type": "commit"}, {"oid": "4724d9ec83460dd77e886925ad56e9ad459df50b", "url": "https://github.com/ConsenSys/teku/commit/4724d9ec83460dd77e886925ad56e9ad459df50b", "message": "Merge branch 'master' into fix/decode-close-exception", "committedDate": "2020-10-28T10:43:14Z", "type": "commit"}]}