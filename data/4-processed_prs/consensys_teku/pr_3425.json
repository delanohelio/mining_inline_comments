{"pr_number": 3425, "pr_title": "Moving all SSZ containers to backing structures (part 1)", "pr_createdAt": "2020-12-29T10:17:08Z", "pr_url": "https://github.com/ConsenSys/teku/pull/3425", "timeline": [{"oid": "4f5f8193416b7d8a976e6d7a0968dfceb4f378c6", "url": "https://github.com/ConsenSys/teku/commit/4f5f8193416b7d8a976e6d7a0968dfceb4f378c6", "message": "Generify ViewType, draft", "committedDate": "2020-12-28T16:36:38Z", "type": "commit"}, {"oid": "01cae46a6d1b2599b2481bb32454a531c71cf108", "url": "https://github.com/ConsenSys/teku/commit/01cae46a6d1b2599b2481bb32454a531c71cf108", "message": "Avoid generify element ViewType in CollectionViewType", "committedDate": "2020-12-28T16:59:51Z", "type": "commit"}, {"oid": "3e765d620de7191e0c6ca08c9da1cf4c8b86a280", "url": "https://github.com/ConsenSys/teku/commit/3e765d620de7191e0c6ca08c9da1cf4c8b86a280", "message": "Fix ViewType raw usages (assembles)", "committedDate": "2020-12-29T10:14:50Z", "type": "commit"}, {"oid": "adcc503a13cc221792bf269ccdf4e7b97aa9007d", "url": "https://github.com/ConsenSys/teku/commit/adcc503a13cc221792bf269ccdf4e7b97aa9007d", "message": "Replace ContainerViewType constructor with factory method", "committedDate": "2020-12-29T10:26:33Z", "type": "commit"}, {"oid": "d1b4ad688ce1786972b8bd35d50a04e837469823", "url": "https://github.com/ConsenSys/teku/commit/d1b4ad688ce1786972b8bd35d50a04e837469823", "message": "Add type-safe container generated classes. Add generator", "committedDate": "2020-12-29T14:27:57Z", "type": "commit"}, {"oid": "0577ab5a657f9849f275a1e8d34aa95e88d6b74c", "url": "https://github.com/ConsenSys/teku/commit/0577ab5a657f9849f275a1e8d34aa95e88d6b74c", "message": "Migrate Checkpoint and AttestationData classes to type-safe containers", "committedDate": "2020-12-29T14:29:18Z", "type": "commit"}, {"oid": "a1522731cae9d9673623509fff59f39bc6875932", "url": "https://github.com/ConsenSys/teku/commit/a1522731cae9d9673623509fff59f39bc6875932", "message": "Return back the SSZContainer marker interface for now", "committedDate": "2020-12-29T15:00:31Z", "type": "commit"}, {"oid": "a1522731cae9d9673623509fff59f39bc6875932", "url": "https://github.com/ConsenSys/teku/commit/a1522731cae9d9673623509fff59f39bc6875932", "message": "Return back the SSZContainer marker interface for now", "committedDate": "2020-12-29T15:00:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTYwODU0NQ==", "url": "https://github.com/ConsenSys/teku/pull/3425#discussion_r551608545", "bodyText": "nit: I don't know what's going on with the spacing around those * characters.  Personally I don't feel we need to explicit tell people these are getters and setters, I think they can probably work that out easily enough... :)", "author": "ajsutton", "createdAt": "2021-01-04T22:32:30Z", "path": "ethereum/datastructures/src/main/java/tech/pegasys/teku/datastructures/operations/AttestationData.java", "diffHunk": "@@ -120,25 +131,25 @@ public UInt64 getEarliestSlotForForkChoice() {\n     return getSlot().plus(UInt64.ONE).max(getTarget().getEpochStartSlot());\n   }\n \n-  /** ******************* * GETTERS & SETTERS * * ******************* */\n+  /** ****************** * GETTERS & SETTERS * * ******************* */", "originalCommit": "a1522731cae9d9673623509fff59f39bc6875932", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTYwODY3NQ==", "url": "https://github.com/ConsenSys/teku/pull/3425#discussion_r551608675", "bodyText": "It looks like these fields are still required at the moment, but is the ultimate plan to be able to remove them and just use the ssh type descriptor?", "author": "ajsutton", "createdAt": "2021-01-04T22:32:52Z", "path": "ethereum/datastructures/src/main/java/tech/pegasys/teku/datastructures/operations/AttestationData.java", "diffHunk": "@@ -66,7 +77,7 @@\n   @SuppressWarnings(\"unused\")\n   private final Checkpoint target = null;", "originalCommit": "a1522731cae9d9673623509fff59f39bc6875932", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjExODM0OA==", "url": "https://github.com/ConsenSys/teku/pull/3425#discussion_r552118348", "bodyText": "Right. It appeared a bit tricky to completely isolate the classes from the legacy ssz, so they are subject to be removed all at once at the final stage", "author": "Nashatyrev", "createdAt": "2021-01-05T18:35:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTYwODY3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTYyMzgxMw==", "url": "https://github.com/ConsenSys/teku/pull/3425#discussion_r551623813", "bodyText": "I think I'd move this to a new module just for this generator. Then it can live in the main source tree for that module and we should be able to easily create a Gradle task that regenerates the classes.\nI like having the generated classes checked in given they won't change much - it may be worth having a task in Gradle that tests the generated source hasn't been changed.  It would run the generator, outputting the result to a temp directory and then compare what was generated with what's in the actual source.  That way we'll avoid issues of people modifying the generated source and then those changes being lost on the next regeneration.  Just need to ensure the generated code complies with spotless or it will wind up with different formatting - hopefully that's not too hard (if it is we could potentially do the comparison completely ignoring whitespace and it would still be effective).\nIn terms of template placing, I like that they can be treated as actual java source code so I'd keep them in the same source tree as the generator (so that would wind up being the main tree in the new module).", "author": "ajsutton", "createdAt": "2021-01-04T23:13:59Z", "path": "ssz/src/test/java/tech/pegasys/teku/ssz/backing/ContainersGenerator.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.teku.ssz.backing;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+import java.util.stream.IntStream;\n+\n+public class ContainersGenerator {", "originalCommit": "a1522731cae9d9673623509fff59f39bc6875932", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6711d4d57806ec191c82d8bacb6675f9f194179d", "url": "https://github.com/ConsenSys/teku/commit/6711d4d57806ec191c82d8bacb6675f9f194179d", "message": "Move ContainersGenerator to a separate module. Add a gradle task to generate containers", "committedDate": "2021-01-11T19:33:11Z", "type": "commit"}, {"oid": "f722775a00027f13160e1ee5233c59e2bec0b09b", "url": "https://github.com/ConsenSys/teku/commit/f722775a00027f13160e1ee5233c59e2bec0b09b", "message": "Remove obsolete comment", "committedDate": "2021-01-11T20:00:33Z", "type": "commit"}, {"oid": "257cd7754cad6b28a8a55169a156c21d2347c475", "url": "https://github.com/ConsenSys/teku/commit/257cd7754cad6b28a8a55169a156c21d2347c475", "message": "Add the test checking that generated source files were not manually modified", "committedDate": "2021-01-12T16:43:15Z", "type": "commit"}, {"oid": "9158cf3ebbbe28bc8c33dd26dac4a88768ccb155", "url": "https://github.com/ConsenSys/teku/commit/9158cf3ebbbe28bc8c33dd26dac4a88768ccb155", "message": "Merge remote-tracking branch 'ConsenSys/master' into feature/generify-viewtype-simpler-2", "committedDate": "2021-01-12T16:58:11Z", "type": "commit"}]}