{"pr_number": 2922, "pr_title": "[QS] Adhere to best practices for Teku", "pr_createdAt": "2020-10-08T20:07:00Z", "pr_url": "https://github.com/ConsenSys/teku/pull/2922", "timeline": [{"oid": "b0a413a67bf831a2fb76479b267c6194e8cd90e4", "url": "https://github.com/ConsenSys/teku/commit/b0a413a67bf831a2fb76479b267c6194e8cd90e4", "message": "2) Fix redundantly declared exception", "committedDate": "2020-10-08T18:45:22Z", "type": "commit"}, {"oid": "e9bdf83688ace3d9ba36426d8fade3ce5e2cbd69", "url": "https://github.com/ConsenSys/teku/commit/e9bdf83688ace3d9ba36426d8fade3ce5e2cbd69", "message": "4) Simplify to return the condition", "committedDate": "2020-10-08T18:48:13Z", "type": "commit"}, {"oid": "bf8e6dfb0a08656bec9a95ea0cd63246065f26df", "url": "https://github.com/ConsenSys/teku/commit/bf8e6dfb0a08656bec9a95ea0cd63246065f26df", "message": "5) Remove redundant final keyword", "committedDate": "2020-10-08T18:57:43Z", "type": "commit"}, {"oid": "74c12083df136f0b8a38b8f131a0ed62dc918853", "url": "https://github.com/ConsenSys/teku/commit/74c12083df136f0b8a38b8f131a0ed62dc918853", "message": "6) Check that the api server is not null before setting options", "committedDate": "2020-10-08T18:58:11Z", "type": "commit"}, {"oid": "27fd32b22aa464f3d2bff6cf45b8196348b167c2", "url": "https://github.com/ConsenSys/teku/commit/27fd32b22aa464f3d2bff6cf45b8196348b167c2", "message": "8) Delete redundant public key serializer", "committedDate": "2020-10-08T18:58:17Z", "type": "commit"}, {"oid": "701d694d16b52f90d1e2291c82f1052e69cc9096", "url": "https://github.com/ConsenSys/teku/commit/701d694d16b52f90d1e2291c82f1052e69cc9096", "message": "26) Remove unnecessary return statement", "committedDate": "2020-10-08T19:10:48Z", "type": "commit"}, {"oid": "ab37079c850887a515e660116893c4be026f4cd0", "url": "https://github.com/ConsenSys/teku/commit/ab37079c850887a515e660116893c4be026f4cd0", "message": "37) Use class level constants for HTTP codes", "committedDate": "2020-10-08T19:23:20Z", "type": "commit"}, {"oid": "d7172171ac86a7affff40b9c8e1c1310d2af1482", "url": "https://github.com/ConsenSys/teku/commit/d7172171ac86a7affff40b9c8e1c1310d2af1482", "message": "Make combinedChainDataClient final", "committedDate": "2020-10-08T19:24:46Z", "type": "commit"}, {"oid": "b345d26e613383b9b6fb88728d30308d4d4b5cf6", "url": "https://github.com/ConsenSys/teku/commit/b345d26e613383b9b6fb88728d30308d4d4b5cf6", "message": "38) 1) Make gas limit a class level constant", "committedDate": "2020-10-08T19:33:54Z", "type": "commit"}, {"oid": "9c1f5e4141924d469b3c716a699414f1983eb2c8", "url": "https://github.com/ConsenSys/teku/commit/9c1f5e4141924d469b3c716a699414f1983eb2c8", "message": "39) Order class members by scope", "committedDate": "2020-10-08T20:05:35Z", "type": "commit"}, {"oid": "f822521b1ece384b794a3fad9f2d836921626eca", "url": "https://github.com/ConsenSys/teku/commit/f822521b1ece384b794a3fad9f2d836921626eca", "message": "Run spotless", "committedDate": "2020-10-08T20:06:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk5NDExOQ==", "url": "https://github.com/ConsenSys/teku/pull/2922#discussion_r501994119", "bodyText": "This is redundant - it will throw a NullPointerException with or without requireNonNull because that's what requireNonNull does when the param is null.  We shouldn't make any change here - the server is known to not be null at this point, just the analyser doesn't know that.", "author": "ajsutton", "createdAt": "2020-10-08T20:30:33Z", "path": "data/beaconrestapi/src/main/java/tech/pegasys/teku/beaconrestapi/BeaconRestApi.java", "diffHunk": "@@ -105,8 +107,8 @@ private void initialize(\n             return jettyServer;\n           });\n     }\n-    app.server().setServerHost(configuration.getRestApiInterface());\n-    app.server().setServerPort(configuration.getRestApiPort());\n+    Objects.requireNonNull(app.server()).setServerHost(configuration.getRestApiInterface());\n+    Objects.requireNonNull(app.server()).setServerPort(configuration.getRestApiPort());", "originalCommit": "74c12083df136f0b8a38b8f131a0ed62dc918853", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAxODMyMg==", "url": "https://github.com/ConsenSys/teku/pull/2922#discussion_r502018322", "bodyText": "Makes sense. Done.", "author": "cemozerr", "createdAt": "2020-10-08T21:18:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk5NDExOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk5NDg0Mg==", "url": "https://github.com/ConsenSys/teku/pull/2922#discussion_r501994842", "bodyText": "I'd restore this.  While it is redundant today, it's not a good idea to catch and ignore an error then continue on. If code was later added after the catch block, the missing return here would likely go unnoticed and cause bugs.", "author": "ajsutton", "createdAt": "2020-10-08T20:32:00Z", "path": "networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/gossip/topics/validation/BlockValidator.java", "diffHunk": "@@ -87,7 +88,6 @@ public BlockValidator(RecentChainData recentChainData, StateTransition stateTran\n                 }\n               } catch (EpochProcessingException | SlotProcessingException e) {\n                 LOG.error(\"BlockValidator: Unable to process block state.\", e);\n-                return InternalValidationResult.REJECT;", "originalCommit": "701d694d16b52f90d1e2291c82f1052e69cc9096", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAxODcyNQ==", "url": "https://github.com/ConsenSys/teku/pull/2922#discussion_r502018725", "bodyText": "Makes sense. Done.", "author": "cemozerr", "createdAt": "2020-10-08T21:19:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk5NDg0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk5Njk2Nw==", "url": "https://github.com/ConsenSys/teku/pull/2922#discussion_r501996967", "bodyText": "Do these need to be public?  And can we use a predefined constant like from HttpServletResponse or one of the various HttpStatus classes?", "author": "ajsutton", "createdAt": "2020-10-08T20:36:06Z", "path": "data/provider/src/main/java/tech/pegasys/teku/api/ValidatorDataProvider.java", "diffHunk": "@@ -62,6 +63,10 @@\n   private CombinedChainDataClient combinedChainDataClient;\n   private final BlockImporter blockImporter;\n \n+  public static final int INTERNAL_ERROR_HTTP_CODE = 500;\n+  public static final int ACCEPTED_HTTP_CODE = 202;\n+  public static final int OK_HTTP_CODE = 200;", "originalCommit": "ab37079c850887a515e660116893c4be026f4cd0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjU4NTM5Ng==", "url": "https://github.com/ConsenSys/teku/pull/2922#discussion_r502585396", "bodyText": "Done.", "author": "cemozerr", "createdAt": "2020-10-09T17:50:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk5Njk2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk5NzU1OQ==", "url": "https://github.com/ConsenSys/teku/pull/2922#discussion_r501997559", "bodyText": "This constant is redundant and just makes the code harder to read.  We're literally in a method called getGasLimit so I think it's clear what the 200_000 means and REASONABLE_GAS_LIMIT doesn't provide any additional information, but does make the actual value one step further removed so harder to find.", "author": "ajsutton", "createdAt": "2020-10-08T20:37:18Z", "path": "teku/src/main/java/tech/pegasys/teku/cli/deposit/DepositTransactionSender.java", "diffHunk": "@@ -128,7 +130,7 @@ public BigInteger getGasLimit(final String contractFunc) {\n \n     @Override\n     public BigInteger getGasLimit() {\n-      return BigInteger.valueOf(200_000L);\n+      return BigInteger.valueOf(REASONABLE_GAS_LIMIT);", "originalCommit": "b345d26e613383b9b6fb88728d30308d4d4b5cf6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU4MDQ1Mg==", "url": "https://github.com/ConsenSys/teku/pull/2922#discussion_r503580452", "bodyText": "agree, if we were going to do that you'd be better off just having a constant declared and referencing the constant rather than calling another function to access it...", "author": "rolfyone", "createdAt": "2020-10-12T23:17:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk5NzU1OQ=="}], "type": "inlineReview"}, {"oid": "a6ce02ad2aaf31866ec3c3a40bdd122327843830", "url": "https://github.com/ConsenSys/teku/commit/a6ce02ad2aaf31866ec3c3a40bdd122327843830", "message": "Revert \"Run spotless\"\n\nThis reverts commit f822521b1ece384b794a3fad9f2d836921626eca.", "committedDate": "2020-10-08T21:17:40Z", "type": "commit"}, {"oid": "17cad6a8a4a996f5fd4b89037ee63dbc8598a3a7", "url": "https://github.com/ConsenSys/teku/commit/17cad6a8a4a996f5fd4b89037ee63dbc8598a3a7", "message": "Revert \"39) Order class members by scope\"\n\nThis reverts commit 9c1f5e4141924d469b3c716a699414f1983eb2c8.", "committedDate": "2020-10-08T21:17:50Z", "type": "commit"}, {"oid": "f18c087b2856677d4f759b5595fab6e23a3321e0", "url": "https://github.com/ConsenSys/teku/commit/f18c087b2856677d4f759b5595fab6e23a3321e0", "message": "Revert \"6) Check that the api server is not null before setting options\"\n\nThis reverts commit 74c12083df136f0b8a38b8f131a0ed62dc918853.", "committedDate": "2020-10-08T21:18:18Z", "type": "commit"}, {"oid": "f0efb2b9d8d23309772905d846f7d920f3c36428", "url": "https://github.com/ConsenSys/teku/commit/f0efb2b9d8d23309772905d846f7d920f3c36428", "message": "Revert \"26) Remove unnecessary return statement\"\n\nThis reverts commit 701d694d16b52f90d1e2291c82f1052e69cc9096.", "committedDate": "2020-10-08T21:19:02Z", "type": "commit"}, {"oid": "152eedead21c071aae4474b095ce3117a38c0a95", "url": "https://github.com/ConsenSys/teku/commit/152eedead21c071aae4474b095ce3117a38c0a95", "message": "Rename status codes and make them private", "committedDate": "2020-10-09T17:49:53Z", "type": "commit"}, {"oid": "b05604b9d5d8b49f68ac2134a75ce0f5c47ac14c", "url": "https://github.com/ConsenSys/teku/commit/b05604b9d5d8b49f68ac2134a75ce0f5c47ac14c", "message": "Revert \"38) 1) Make gas limit a class level constant\"\n\nThis reverts commit b345d26e613383b9b6fb88728d30308d4d4b5cf6.", "committedDate": "2020-10-09T17:51:32Z", "type": "commit"}, {"oid": "55382aed71c9b31ecddf8144de94fd633398852b", "url": "https://github.com/ConsenSys/teku/commit/55382aed71c9b31ecddf8144de94fd633398852b", "message": "Run spotless", "committedDate": "2020-10-09T17:52:27Z", "type": "commit"}, {"oid": "ebcfa3c3fd01a18a0b7f0a63f64daf2bef04268f", "url": "https://github.com/ConsenSys/teku/commit/ebcfa3c3fd01a18a0b7f0a63f64daf2bef04268f", "message": "Merge branch 'master' into qs/adhere-to-best-practices", "committedDate": "2020-10-09T17:55:26Z", "type": "commit"}, {"oid": "a19cd3072c3d27fbec023e8b08519455427c39b2", "url": "https://github.com/ConsenSys/teku/commit/a19cd3072c3d27fbec023e8b08519455427c39b2", "message": "Merge branch 'master' into qs/adhere-to-best-practices", "committedDate": "2020-10-13T14:19:50Z", "type": "commit"}]}