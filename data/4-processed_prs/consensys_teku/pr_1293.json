{"pr_number": 1293, "pr_title": "separate rest API from the internal object layer", "pr_createdAt": "2020-03-05T05:37:52Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1293", "timeline": [{"oid": "8a18ee6aac44919088b606695d2059205476227c", "url": "https://github.com/ConsenSys/teku/commit/8a18ee6aac44919088b606695d2059205476227c", "message": "begin refactoring the use of internal apis and data structures at the rest api level.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-03-05T05:36:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTE0Mg==", "url": "https://github.com/ConsenSys/teku/pull/1293#discussion_r388591142", "bodyText": "is this how we set caching headers?", "author": "macfarla", "createdAt": "2020-03-05T21:57:47Z", "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/networkhandlers/PeersHandlerTest.java", "diffHunk": "@@ -48,23 +52,26 @@ public void shouldReturnArrayOfPeersIfPresent() throws Exception {\n \n     when(peer1.getId()).thenReturn(nodeId1);\n     when(peer2.getId()).thenReturn(nodeId2);\n-    when(p2PNetwork.streamPeers()).thenReturn(Stream.of(peer1, peer2));\n+    when(p2pNetwork.streamPeers()).thenReturn(Stream.of(peer1, peer2));\n \n     final String response =\n         jsonProvider.objectToJSON(new String[] {peerId1.toBase58(), peerId2.toBase58()});\n \n     peersHandler.handle(context);\n+    verify(context).header(Header.CACHE_CONTROL, CACHE_ONE_MINUTE);\n     verify(context).result(response);\n   }\n \n   @Test\n   public void shouldReturnEmptyPeersArrayIfNoneConnected() throws Exception {\n-    final PeersHandler peersHandler = new PeersHandler(p2PNetwork, jsonProvider);\n+    final NetworkDataProvider network = new NetworkDataProvider(p2pNetwork);\n+    final PeersHandler peersHandler = new PeersHandler(network, jsonProvider);\n     final String response = jsonProvider.objectToJSON(new String[] {});\n \n-    when(p2PNetwork.streamPeers()).thenReturn(Stream.empty());\n+    when(p2pNetwork.streamPeers()).thenReturn(Stream.empty());\n \n     peersHandler.handle(context);\n+    verify(context).header(Header.CACHE_CONTROL, CACHE_ONE_MINUTE);", "originalCommit": "8a18ee6aac44919088b606695d2059205476227c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTI0OA==", "url": "https://github.com/ConsenSys/teku/pull/1293#discussion_r388591248", "bodyText": "is neat", "author": "macfarla", "createdAt": "2020-03-05T21:58:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTE0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY0MDkzMw==", "url": "https://github.com/ConsenSys/teku/pull/1293#discussion_r388640933", "bodyText": "yep! simpler than i thought", "author": "rolfyone", "createdAt": "2020-03-06T00:21:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTE0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTU2MQ==", "url": "https://github.com/ConsenSys/teku/pull/1293#discussion_r388591561", "bodyText": "ooo controversial", "author": "macfarla", "createdAt": "2020-03-05T21:58:40Z", "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/networkhandlers/PeersHandlerTest.java", "diffHunk": "@@ -34,11 +37,12 @@\n public class PeersHandlerTest {\n   private final JsonProvider jsonProvider = new JsonProvider();\n   @Mock Context context;\n-  @Mock P2PNetwork<Peer> p2PNetwork;\n+  @Mock P2PNetwork<Peer> p2pNetwork;", "originalCommit": "8a18ee6aac44919088b606695d2059205476227c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTcyOA==", "url": "https://github.com/ConsenSys/teku/pull/1293#discussion_r388591728", "bodyText": "are you willing to die on this hill", "author": "macfarla", "createdAt": "2020-03-05T21:59:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTU2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODYzMDUwNQ==", "url": "https://github.com/ConsenSys/teku/pull/1293#discussion_r388630505", "bodyText": "I like p2pNetwork too. :) And this looks exactly like the kind of hill I would be far more tempted to die on that I should be. :P", "author": "ajsutton", "createdAt": "2020-03-05T23:46:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTU2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY0MTExMw==", "url": "https://github.com/ConsenSys/teku/pull/1293#discussion_r388641113", "bodyText": "p2PNetwork is just ugly....", "author": "rolfyone", "createdAt": "2020-03-06T00:22:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTU2MQ=="}], "type": "inlineReview"}, {"oid": "a59109879048f5dcd9d12c5457c9fa5f58df4bc2", "url": "https://github.com/ConsenSys/teku/commit/a59109879048f5dcd9d12c5457c9fa5f58df4bc2", "message": "refactor BeaconCommitteesHandler\n\ncreate a DataProvider abstraction\n\nStart writing tests at the new layer\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-03-06T00:32:48Z", "type": "commit"}, {"oid": "b3962745f0d27950f5d550803c5d2288200ecf22", "url": "https://github.com/ConsenSys/teku/commit/b3962745f0d27950f5d550803c5d2288200ecf22", "message": "simplify caching header to just none, or 'finalized' (which i've started at 1 year)\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-03-06T01:23:26Z", "type": "commit"}, {"oid": "ef3b4a3473a5daac7ef899a7010a0d3666f218d1", "url": "https://github.com/ConsenSys/teku/commit/ef3b4a3473a5daac7ef899a7010a0d3666f218d1", "message": "spotless\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-03-06T01:29:09Z", "type": "commit"}, {"oid": "b90393fee8db0e0a717a809e8e5fb70da48be6e9", "url": "https://github.com/ConsenSys/teku/commit/b90393fee8db0e0a717a809e8e5fb70da48be6e9", "message": "Merge remote-tracking branch 'upstream/master' into refactor-api-layer\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-03-06T02:00:49Z", "type": "commit"}, {"oid": "81fd3460ba8795babe72f66f55c614af234f4484", "url": "https://github.com/ConsenSys/teku/commit/81fd3460ba8795babe72f66f55c614af234f4484", "message": "Merge remote-tracking branch 'upstream/master' into refactor-api-layer", "committedDate": "2020-03-06T02:06:05Z", "type": "commit"}]}