{"pr_number": 1268, "pr_title": "[BC-299] Clean up service initialization", "pr_createdAt": "2020-03-03T18:10:25Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1268", "timeline": [{"oid": "76d00fb30653207d58917a717a93f20ca0c59982", "url": "https://github.com/ConsenSys/teku/commit/76d00fb30653207d58917a717a93f20ca0c59982", "message": "Simplify service startup, remove unnecessary executors", "committedDate": "2020-03-03T17:43:27Z", "type": "commit"}, {"oid": "839bb70b11afe45b97d5a3ee36ba30094cfd28df", "url": "https://github.com/ConsenSys/teku/commit/839bb70b11afe45b97d5a3ee36ba30094cfd28df", "message": "Cut unnecessary null check, add log back in for consistency", "committedDate": "2020-03-03T18:03:54Z", "type": "commit"}, {"oid": "8f073d5a8cb0412bab34e5b448e494bfe13c8fac", "url": "https://github.com/ConsenSys/teku/commit/8f073d5a8cb0412bab34e5b448e494bfe13c8fac", "message": "Cut unused classes", "committedDate": "2020-03-03T18:08:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzM1MzA3NQ==", "url": "https://github.com/ConsenSys/teku/pull/1268#discussion_r387353075", "bodyText": "Should we be doing a join here? Then if any component fails to start we throw an exception back up to BeaconNodeCommand (we should remove the try/catch in this class).  That in turn lets PicoCLI be notified of the failure properly.", "author": "ajsutton", "createdAt": "2020-03-03T23:17:51Z", "path": "artemis/src/main/java/tech/pegasys/artemis/BeaconNode.java", "diffHunk": "@@ -88,18 +88,8 @@\n   public void start() {\n \n     try {\n-      this.serviceConfig.getConfig().validateConfig();\n       metricsEndpoint.start();\n-      // Initialize services\n-      serviceController.initAll(\n-          serviceConfig,\n-          BeaconChainService.class,\n-          PowchainService.class,\n-          ChainStorageService.class);\n-\n-      // Start services\n-      serviceController.startAll();\n-\n+      serviceController.start().reportExceptions();", "originalCommit": "8f073d5a8cb0412bab34e5b448e494bfe13c8fac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgxMDUyMQ==", "url": "https://github.com/ConsenSys/teku/pull/1268#discussion_r391810521", "bodyText": "Good call \ud83d\udc4d", "author": "mbaxter", "createdAt": "2020-03-12T18:23:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzM1MzA3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzM1NDI3OA==", "url": "https://github.com/ConsenSys/teku/pull/1268#discussion_r387354278", "bodyText": "Yay! Love seeing these move out of constructors.  Could easily be the source of your failing AT though as it will now miss events from the storage service at startup.", "author": "ajsutton", "createdAt": "2020-03-03T23:21:49Z", "path": "services/beaconchain/src/main/java/tech/pegasys/artemis/services/beaconchain/BeaconChainController.java", "diffHunk": "@@ -107,10 +101,10 @@ public BeaconChainController(\n     this.config = config;\n     this.metricsSystem = metricsSystem;\n     this.testMode = config.getDepositMode().equals(DEPOSIT_TEST);\n-    this.eventBus.register(this);\n   }\n \n   public void initAll() {\n+    this.eventBus.register(this);", "originalCommit": "8f073d5a8cb0412bab34e5b448e494bfe13c8fac", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "415325fed0b653e97f407b7e49c381057d6c212d", "url": "https://github.com/ConsenSys/teku/commit/415325fed0b653e97f407b7e49c381057d6c212d", "message": "Merge branch 'master' into bc-277/clean-up-service-initialization", "committedDate": "2020-03-12T17:57:52Z", "type": "commit"}, {"oid": "8d7dc71d9db7da57923896ef2cc6f2fbbd9c09ca", "url": "https://github.com/ConsenSys/teku/commit/8d7dc71d9db7da57923896ef2cc6f2fbbd9c09ca", "message": "Merge branch 'master' into bc-277/clean-up-service-initialization", "committedDate": "2020-03-12T17:59:59Z", "type": "commit"}, {"oid": "f261faa40bb227a108e74697ce14f7b5c999a908", "url": "https://github.com/ConsenSys/teku/commit/f261faa40bb227a108e74697ce14f7b5c999a908", "message": "Start up BeaconChainController asynchronously", "committedDate": "2020-03-12T18:16:05Z", "type": "commit"}, {"oid": "5cceeb558e66f3b89d3d0b5a5349b34d440ac837", "url": "https://github.com/ConsenSys/teku/commit/5cceeb558e66f3b89d3d0b5a5349b34d440ac837", "message": "Use final or volatile instance variables", "committedDate": "2020-03-12T18:20:00Z", "type": "commit"}, {"oid": "76218536a895d1dcceb6d03b0215fdb97ca72c5a", "url": "https://github.com/ConsenSys/teku/commit/76218536a895d1dcceb6d03b0215fdb97ca72c5a", "message": "Propagate startup exceptions", "committedDate": "2020-03-12T18:24:18Z", "type": "commit"}, {"oid": "dd4dbac24bbca78e92863479fbaf9f8605e2c8f2", "url": "https://github.com/ConsenSys/teku/commit/dd4dbac24bbca78e92863479fbaf9f8605e2c8f2", "message": "Make sure startup failures propagate up, all services are stopped", "committedDate": "2020-03-13T15:42:56Z", "type": "commit"}, {"oid": "5f40463d4c804afb245c9da81a9edcfc826ebb70", "url": "https://github.com/ConsenSys/teku/commit/5f40463d4c804afb245c9da81a9edcfc826ebb70", "message": "Merge branch 'master' into bc-277/clean-up-service-initialization", "committedDate": "2020-03-13T15:44:59Z", "type": "commit"}, {"oid": "a4bac61ace9838b3e9ad41f653502a326ba838e8", "url": "https://github.com/ConsenSys/teku/commit/a4bac61ace9838b3e9ad41f653502a326ba838e8", "message": "Propagate more startup / shutdown failures to returned futures", "committedDate": "2020-03-13T16:15:38Z", "type": "commit"}, {"oid": "c89124948d39d20ff724072d17f2159aa0719593", "url": "https://github.com/ConsenSys/teku/commit/c89124948d39d20ff724072d17f2159aa0719593", "message": "Cut unused logger", "committedDate": "2020-03-13T16:29:24Z", "type": "commit"}, {"oid": "f5e02e65fba825c514fb5835fdb7d96849c189ea", "url": "https://github.com/ConsenSys/teku/commit/f5e02e65fba825c514fb5835fdb7d96849c189ea", "message": "Propagate exceptions from network.connect()", "committedDate": "2020-03-13T17:01:26Z", "type": "commit"}]}