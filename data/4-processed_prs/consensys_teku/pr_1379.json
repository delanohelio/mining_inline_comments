{"pr_number": 1379, "pr_title": "Programmatic logging", "pr_createdAt": "2020-03-16T06:59:16Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1379", "timeline": [{"oid": "246ac922392cfc72078b6c50782c725ef329b3f2", "url": "https://github.com/ConsenSys/teku/commit/246ac922392cfc72078b6c50782c725ef329b3f2", "message": "Files", "committedDate": "2020-03-11T05:20:24Z", "type": "commit"}, {"oid": "99dbffd55d6f32c23da73efb0dc4c130fab4b529", "url": "https://github.com/ConsenSys/teku/commit/99dbffd55d6f32c23da73efb0dc4c130fab4b529", "message": "TODOs", "committedDate": "2020-03-11T05:23:07Z", "type": "commit"}, {"oid": "4e16b1ba3b81086205db604baaf319db1836c786", "url": "https://github.com/ConsenSys/teku/commit/4e16b1ba3b81086205db604baaf319db1836c786", "message": "Config changes", "committedDate": "2020-03-11T06:37:16Z", "type": "commit"}, {"oid": "b22154431e50f6d8f4f24d0b3060591074858eb2", "url": "https://github.com/ConsenSys/teku/commit/b22154431e50f6d8f4f24d0b3060591074858eb2", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into logging-config", "committedDate": "2020-03-11T06:37:32Z", "type": "commit"}, {"oid": "b7b840c31e07419199c8285fd61bd450f63c766d", "url": "https://github.com/ConsenSys/teku/commit/b7b840c31e07419199c8285fd61bd450f63c766d", "message": "Moving setAllLevels", "committedDate": "2020-03-11T07:01:37Z", "type": "commit"}, {"oid": "4dfe7b74f93d3eaa69119f37573525ff626226b2", "url": "https://github.com/ConsenSys/teku/commit/4dfe7b74f93d3eaa69119f37573525ff626226b2", "message": "wiring up config", "committedDate": "2020-03-11T07:09:42Z", "type": "commit"}, {"oid": "3afcbaab3de5b5d2bf68c003972802a4e27ddf0b", "url": "https://github.com/ConsenSys/teku/commit/3afcbaab3de5b5d2bf68c003972802a4e27ddf0b", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into logging-config", "committedDate": "2020-03-11T23:45:12Z", "type": "commit"}, {"oid": "23635cf5298eb9004de07d13e7c8c1880a7359be", "url": "https://github.com/ConsenSys/teku/commit/23635cf5298eb9004de07d13e7c8c1880a7359be", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into logging-config", "committedDate": "2020-03-12T04:09:41Z", "type": "commit"}, {"oid": "d3bcb970ad1d138eb70a51c31ca4c28956117e85", "url": "https://github.com/ConsenSys/teku/commit/d3bcb970ad1d138eb70a51c31ca4c28956117e85", "message": "Color configuration", "committedDate": "2020-03-12T06:44:44Z", "type": "commit"}, {"oid": "413cf66e6050b880ed5f0f8e6b02d3163a5fb570", "url": "https://github.com/ConsenSys/teku/commit/413cf66e6050b880ed5f0f8e6b02d3163a5fb570", "message": "Logging to both", "committedDate": "2020-03-12T07:09:16Z", "type": "commit"}, {"oid": "c3a6ce5c64de42f10795bbb250a99aea6356e502", "url": "https://github.com/ConsenSys/teku/commit/c3a6ce5c64de42f10795bbb250a99aea6356e502", "message": "Clean code", "committedDate": "2020-03-12T07:15:55Z", "type": "commit"}, {"oid": "4d561bab3604f3570247e06d0fe5117de71e1210", "url": "https://github.com/ConsenSys/teku/commit/4d561bab3604f3570247e06d0fe5117de71e1210", "message": "Excluding events", "committedDate": "2020-03-12T07:23:17Z", "type": "commit"}, {"oid": "fa2bc95da0c2d90c8a332771b6559896af4b0f99", "url": "https://github.com/ConsenSys/teku/commit/fa2bc95da0c2d90c8a332771b6559896af4b0f99", "message": "Programmatically create on reload", "committedDate": "2020-03-12T07:31:46Z", "type": "commit"}, {"oid": "2d2ae26e055782a161c18254895f2d55e69a9094", "url": "https://github.com/ConsenSys/teku/commit/2d2ae26e055782a161c18254895f2d55e69a9094", "message": "Console only, but still a logfile", "committedDate": "2020-03-12T08:28:39Z", "type": "commit"}, {"oid": "a13c36b6c71a580d1d30d753977b669b52b8de48", "url": "https://github.com/ConsenSys/teku/commit/a13c36b6c71a580d1d30d753977b669b52b8de48", "message": "Programmatically creating a file logger", "committedDate": "2020-03-13T06:56:31Z", "type": "commit"}, {"oid": "b70a575674b333460a75eb924248540801c57743", "url": "https://github.com/ConsenSys/teku/commit/b70a575674b333460a75eb924248540801c57743", "message": "Streamlining", "committedDate": "2020-03-13T07:11:45Z", "type": "commit"}, {"oid": "13981eb400ab681f8c1139fea1001061a7ff2243", "url": "https://github.com/ConsenSys/teku/commit/13981eb400ab681f8c1139fea1001061a7ff2243", "message": "Streamlining", "committedDate": "2020-03-13T07:13:58Z", "type": "commit"}, {"oid": "89b9ff8d5ea4870fa5ef8b00ebd4e1e0d3b3d75e", "url": "https://github.com/ConsenSys/teku/commit/89b9ff8d5ea4870fa5ef8b00ebd4e1e0d3b3d75e", "message": "Attempting to adapt to Log4j2 hot replace", "committedDate": "2020-03-13T08:06:54Z", "type": "commit"}, {"oid": "cc402e81284ed4b3caa2aa365d1d205eee916de4", "url": "https://github.com/ConsenSys/teku/commit/cc402e81284ed4b3caa2aa365d1d205eee916de4", "message": "Log4j2 config hot replace no longer breaks logging", "committedDate": "2020-03-13T08:36:31Z", "type": "commit"}, {"oid": "10c6801981d321f6a40174d4793e0b16bf462b7e", "url": "https://github.com/ConsenSys/teku/commit/10c6801981d321f6a40174d4793e0b16bf462b7e", "message": "Config back to default", "committedDate": "2020-03-13T08:37:05Z", "type": "commit"}, {"oid": "47785a947cb4a0d4e0a60d5840c360f41d109a05", "url": "https://github.com/ConsenSys/teku/commit/47785a947cb4a0d4e0a60d5840c360f41d109a05", "message": "Config back to default", "committedDate": "2020-03-13T08:37:25Z", "type": "commit"}, {"oid": "f3b0fb1efa2ac2c357f125cd3f1a3aa7f230c8f0", "url": "https://github.com/ConsenSys/teku/commit/f3b0fb1efa2ac2c357f125cd3f1a3aa7f230c8f0", "message": "Done Todo", "committedDate": "2020-03-13T08:38:00Z", "type": "commit"}, {"oid": "df907d9840bb831eddf078c8176ae32b16ad0550", "url": "https://github.com/ConsenSys/teku/commit/df907d9840bb831eddf078c8176ae32b16ad0550", "message": "Merging upstream", "committedDate": "2020-03-15T22:48:41Z", "type": "commit"}, {"oid": "4c19e19ceb9311404f2491be23285ea2ddbe9714", "url": "https://github.com/ConsenSys/teku/commit/4c19e19ceb9311404f2491be23285ea2ddbe9714", "message": "Config for file and file pattern", "committedDate": "2020-03-16T04:23:11Z", "type": "commit"}, {"oid": "e50383f98628fd1d8c8c347f7bc4e3c6b8db083c", "url": "https://github.com/ConsenSys/teku/commit/e50383f98628fd1d8c8c347f7bc4e3c6b8db083c", "message": "Correcting", "committedDate": "2020-03-16T05:05:55Z", "type": "commit"}, {"oid": "7c244b2f0780dde1ce12b3ffec74ddb2077006b9", "url": "https://github.com/ConsenSys/teku/commit/7c244b2f0780dde1ce12b3ffec74ddb2077006b9", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into logging-config", "committedDate": "2020-03-16T05:10:14Z", "type": "commit"}, {"oid": "db0ea074ce91a9446e5db1d447f7d8ec92b0d377", "url": "https://github.com/ConsenSys/teku/commit/db0ea074ce91a9446e5db1d447f7d8ec92b0d377", "message": "Removing ToDos", "committedDate": "2020-03-16T05:31:07Z", "type": "commit"}, {"oid": "8470a90849188854c6f744aad686b66042c1971a", "url": "https://github.com/ConsenSys/teku/commit/8470a90849188854c6f744aad686b66042c1971a", "message": "Removing unused method", "committedDate": "2020-03-16T05:31:30Z", "type": "commit"}, {"oid": "9f7aaf96de89b7bc932deb2782b53c3793a609dd", "url": "https://github.com/ConsenSys/teku/commit/9f7aaf96de89b7bc932deb2782b53c3793a609dd", "message": "UT", "committedDate": "2020-03-16T05:49:08Z", "type": "commit"}, {"oid": "aab2a73b0093f21f8ecd2da3b4fede6f183d54ff", "url": "https://github.com/ConsenSys/teku/commit/aab2a73b0093f21f8ecd2da3b4fede6f183d54ff", "message": "Logging config object", "committedDate": "2020-03-16T06:33:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM4OTE5Mw==", "url": "https://github.com/ConsenSys/teku/pull/1379#discussion_r393389193", "bodyText": "At minimum COLOR would be accessed from multiple threads so needs to be either volatile or an AtomicBoolean. I suspect they all need to be thread safe since Log4J could be reconfigured from any thread which would lead these to be accessed.\nMight be best to just make the public methods all synchronized.", "author": "ajsutton", "createdAt": "2020-03-17T00:57:21Z", "path": "logging/src/main/java/tech/pegasys/teku/logging/LoggingConfigurator.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.teku.logging;\n+\n+import org.apache.logging.log4j.Level;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.core.Appender;\n+import org.apache.logging.log4j.core.Layout;\n+import org.apache.logging.log4j.core.LoggerContext;\n+import org.apache.logging.log4j.core.appender.ConsoleAppender;\n+import org.apache.logging.log4j.core.appender.RollingFileAppender;\n+import org.apache.logging.log4j.core.appender.rolling.CompositeTriggeringPolicy;\n+import org.apache.logging.log4j.core.appender.rolling.OnStartupTriggeringPolicy;\n+import org.apache.logging.log4j.core.appender.rolling.TimeBasedTriggeringPolicy;\n+import org.apache.logging.log4j.core.config.AbstractConfiguration;\n+import org.apache.logging.log4j.core.config.Configurator;\n+import org.apache.logging.log4j.core.config.LoggerConfig;\n+import org.apache.logging.log4j.core.layout.PatternLayout;\n+import org.apache.logging.log4j.status.StatusLogger;\n+\n+public class LoggingConfigurator {\n+\n+  static final String EVENT_LOGGER_NAME = \"teku-event-log\";\n+  static final String STATUS_LOGGER_NAME = \"teku-status-log\";\n+\n+  private static final String CONSOLE_APPENDER_NAME = \"teku-console-appender\";\n+  private static final String CONSOLE_FORMAT = \"%d{HH:mm:ss.SSS} [%-5level] - %msg%n\";\n+  private static final String FILE_APPENDER_NAME = \"teku-log-appender\";\n+  private static final String FILE_MESSAGE_FORMAT =\n+      \"%d{yyyy-MM-dd HH:mm:ss.SSSZZZ} | %t | %-5level | %c{1} | %msg%n\";\n+\n+  private static LoggingDestination DESTINATION;\n+  private static boolean COLOR;\n+  private static boolean INCLUDE_EVENTS;\n+  private static String FILE;\n+  private static String FILE_PATTERN;\n+  private static Level LOG_LEVEL = Level.INFO;", "originalCommit": "aab2a73b0093f21f8ecd2da3b4fede6f183d54ff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQxNTUwMQ==", "url": "https://github.com/ConsenSys/teku/pull/1379#discussion_r393415501", "bodyText": "Yes, you are correct.\nThese were all volatile a while ago ...but I neglected to bring that keyword across from the discard branch \ud83d\ude44\nSynchronizing the methods is an interesting idea \ud83e\udd14", "author": "CjHare", "createdAt": "2020-03-17T02:47:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM4OTE5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyMjY0MQ==", "url": "https://github.com/ConsenSys/teku/pull/1379#discussion_r393422641", "bodyText": "Okay, I went with both.\nCOLOR being exposed as a simple getter is an AtomicBoolean with a non-synchronized getter and the other public methods are now all synchronized.\nThis should avoid any locking/performance problems with the getter (which is used in the two new logger classes) which will be more frequently under normal usage then the set/update.", "author": "CjHare", "createdAt": "2020-03-17T03:14:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM4OTE5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyNTIyMw==", "url": "https://github.com/ConsenSys/teku/pull/1379#discussion_r393425223", "bodyText": "Suspect they need to be synchronized actually, otherwise you risk applying a half-updated config.", "author": "ajsutton", "createdAt": "2020-03-17T03:26:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM4OTE5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM4OTM2Nw==", "url": "https://github.com/ConsenSys/teku/pull/1379#discussion_r393389367", "bodyText": "Not sure Programmatic logging setup is meaningful to a user.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                StatusLogger.getLogger().info(\"Programmatic logging setup: {}\", DESTINATION);\n          \n          \n            \n                StatusLogger.getLogger().info(\"Configuring logging for destination: {}\", DESTINATION);", "author": "ajsutton", "createdAt": "2020-03-17T00:58:06Z", "path": "logging/src/main/java/tech/pegasys/teku/logging/LoggingConfigurator.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.teku.logging;\n+\n+import org.apache.logging.log4j.Level;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.core.Appender;\n+import org.apache.logging.log4j.core.Layout;\n+import org.apache.logging.log4j.core.LoggerContext;\n+import org.apache.logging.log4j.core.appender.ConsoleAppender;\n+import org.apache.logging.log4j.core.appender.RollingFileAppender;\n+import org.apache.logging.log4j.core.appender.rolling.CompositeTriggeringPolicy;\n+import org.apache.logging.log4j.core.appender.rolling.OnStartupTriggeringPolicy;\n+import org.apache.logging.log4j.core.appender.rolling.TimeBasedTriggeringPolicy;\n+import org.apache.logging.log4j.core.config.AbstractConfiguration;\n+import org.apache.logging.log4j.core.config.Configurator;\n+import org.apache.logging.log4j.core.config.LoggerConfig;\n+import org.apache.logging.log4j.core.layout.PatternLayout;\n+import org.apache.logging.log4j.status.StatusLogger;\n+\n+public class LoggingConfigurator {\n+\n+  static final String EVENT_LOGGER_NAME = \"teku-event-log\";\n+  static final String STATUS_LOGGER_NAME = \"teku-status-log\";\n+\n+  private static final String CONSOLE_APPENDER_NAME = \"teku-console-appender\";\n+  private static final String CONSOLE_FORMAT = \"%d{HH:mm:ss.SSS} [%-5level] - %msg%n\";\n+  private static final String FILE_APPENDER_NAME = \"teku-log-appender\";\n+  private static final String FILE_MESSAGE_FORMAT =\n+      \"%d{yyyy-MM-dd HH:mm:ss.SSSZZZ} | %t | %-5level | %c{1} | %msg%n\";\n+\n+  private static LoggingDestination DESTINATION;\n+  private static boolean COLOR;\n+  private static boolean INCLUDE_EVENTS;\n+  private static String FILE;\n+  private static String FILE_PATTERN;\n+  private static Level LOG_LEVEL = Level.INFO;\n+\n+  public static boolean isColorEnabled() {\n+    return COLOR;\n+  }\n+\n+  public static void setAllLevels(final Level level) {\n+    StatusLogger.getLogger().info(\"Setting logging level to {}\", level.name());\n+    Configurator.setAllLevels(\"\", level);\n+    LOG_LEVEL = level;\n+  }\n+\n+  public static void update(final LoggingConfiguration configuration) {\n+    COLOR = configuration.isColorEnabled();\n+    DESTINATION = configuration.getDestination();\n+    INCLUDE_EVENTS = configuration.isIncludeEventsEnabled();\n+    FILE = configuration.getFile();\n+    FILE_PATTERN = configuration.getFileNamePattern();\n+\n+    final LoggerContext ctx = (LoggerContext) LogManager.getContext(false);\n+    addLoggersProgrammatically((AbstractConfiguration) ctx.getConfiguration());\n+    ctx.updateLoggers();\n+  }\n+\n+  public static void addLoggersProgrammatically(final AbstractConfiguration configuration) {\n+\n+    if (DESTINATION == null) {\n+      return;\n+    }\n+\n+    StatusLogger.getLogger().info(\"Programmatic logging setup: {}\", DESTINATION);", "originalCommit": "aab2a73b0093f21f8ecd2da3b4fede6f183d54ff", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5MjcwMw==", "url": "https://github.com/ConsenSys/teku/pull/1379#discussion_r393392703", "bodyText": "This is a very unfortunate dependency to add.", "author": "ajsutton", "createdAt": "2020-03-17T01:12:01Z", "path": "util/build.gradle", "diffHunk": "@@ -5,6 +5,8 @@ plugins {\n dependencies {\n   api 'org.bouncycastle:bcprov-jdk15on'\n \n+  implementation project(':logging')", "originalCommit": "aab2a73b0093f21f8ecd2da3b4fede6f183d54ff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQxNzU1OA==", "url": "https://github.com/ConsenSys/teku/pull/1379#discussion_r393417558", "bodyText": "How so? ...currently logging is pretty much a leaf dependency (only depending on tuweni-bytes),  or is it more that things are being done in utils shouldn't be needing the new logging?", "author": "CjHare", "createdAt": "2020-03-17T02:56:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5MjcwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyNDM1Mg==", "url": "https://github.com/ConsenSys/teku/pull/1379#discussion_r393424352", "bodyText": "I was living in my happy little world where util was a relatively small module - keep forgetting that it's a giant monolith of random stuff...", "author": "ajsutton", "createdAt": "2020-03-17T03:22:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5MjcwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQzNjAzOA==", "url": "https://github.com/ConsenSys/teku/pull/1379#discussion_r393436038", "bodyText": "True, util does quite a bit, but as I've made in the inversion now \ud83e\udd37\u200d\u2642", "author": "CjHare", "createdAt": "2020-03-17T04:14:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5MjcwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5MzA1Nw==", "url": "https://github.com/ConsenSys/teku/pull/1379#discussion_r393393057", "bodyText": "Typically ArtemisConfiguration sticks to just the raw data types so I think we probably should invert this dependency.  So ArtemisConfiguration.getLoggingDestination just returns a string and LoggingDestination has a fromConfig that has this mapping.", "author": "ajsutton", "createdAt": "2020-03-17T01:13:28Z", "path": "util/src/main/java/tech/pegasys/artemis/util/config/ArtemisConfiguration.java", "diffHunk": "@@ -399,4 +431,25 @@ public int getBeaconRestAPIPortNumber() {\n   public boolean getBeaconRestAPIEnableSwagger() {\n     return config.getBoolean(\"beaconrestapi.enableSwagger\");\n   }\n+\n+  private LoggingDestination getLoggingDestination() {", "originalCommit": "aab2a73b0093f21f8ecd2da3b4fede6f183d54ff", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5MzA4Mw==", "url": "https://github.com/ConsenSys/teku/pull/1379#discussion_r393393083", "bodyText": "Probably should warn on unknown values.", "author": "ajsutton", "createdAt": "2020-03-17T01:13:38Z", "path": "util/src/main/java/tech/pegasys/artemis/util/config/ArtemisConfiguration.java", "diffHunk": "@@ -399,4 +431,25 @@ public int getBeaconRestAPIPortNumber() {\n   public boolean getBeaconRestAPIEnableSwagger() {\n     return config.getBoolean(\"beaconrestapi.enableSwagger\");\n   }\n+\n+  private LoggingDestination getLoggingDestination() {\n+    switch (config.getString(\"logging.destination\")) {\n+      case \"consoleOnly\":\n+        return LoggingDestination.CONSOLE_ONLY;\n+      case \"fileOnly\":\n+        return LoggingDestination.FILE_ONLY;\n+      case \"both\":\n+      default:\n+        return LoggingDestination.BOTH;", "originalCommit": "aab2a73b0093f21f8ecd2da3b4fede6f183d54ff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQxNzY1MQ==", "url": "https://github.com/ConsenSys/teku/pull/1379#discussion_r393417651", "bodyText": "Sound sensible, can do \ud83d\udc4d", "author": "CjHare", "createdAt": "2020-03-17T02:56:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5MzA4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5MzQxOA==", "url": "https://github.com/ConsenSys/teku/pull/1379#discussion_r393393418", "bodyText": "Probably should invert this dependency too so have LoggingConfiguration.fromConfig(ArtemisConfiguration).", "author": "ajsutton", "createdAt": "2020-03-17T01:15:01Z", "path": "util/src/main/java/tech/pegasys/artemis/util/config/ArtemisConfiguration.java", "diffHunk": "@@ -399,4 +431,25 @@ public int getBeaconRestAPIPortNumber() {\n   public boolean getBeaconRestAPIEnableSwagger() {\n     return config.getBoolean(\"beaconrestapi.enableSwagger\");\n   }\n+\n+  private LoggingDestination getLoggingDestination() {\n+    switch (config.getString(\"logging.destination\")) {\n+      case \"consoleOnly\":\n+        return LoggingDestination.CONSOLE_ONLY;\n+      case \"fileOnly\":\n+        return LoggingDestination.FILE_ONLY;\n+      case \"both\":\n+      default:\n+        return LoggingDestination.BOTH;\n+    }\n+  }\n+\n+  public LoggingConfiguration getLoggingConfiguration() {", "originalCommit": "aab2a73b0093f21f8ecd2da3b4fede6f183d54ff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQxNjc5Mw==", "url": "https://github.com/ConsenSys/teku/pull/1379#discussion_r393416793", "bodyText": "Yeah, I would have done but ...circular dependency issues.\nArtemisConfiguration resides in the artemis module that has a dependency on the logging module. Referencing ArtemisConfiguration in logging would now require logging be dependant on artemis.\nUnless I were to move ArtemisConfiguration into that conveniently named config module \ud83e\udd14", "author": "CjHare", "createdAt": "2020-03-17T02:53:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5MzQxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyMzY2OQ==", "url": "https://github.com/ConsenSys/teku/pull/1379#discussion_r393423669", "bodyText": "Turns out (after checking) ArtemisConfiguration is in util and not artemis, the inverting idea works \ud83d\udc4d", "author": "CjHare", "createdAt": "2020-03-17T03:19:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5MzQxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyNTA0NA==", "url": "https://github.com/ConsenSys/teku/pull/1379#discussion_r393425044", "bodyText": "ArtemisConfiguration is in util currently.  So this would have logging depend on util rather than the other way around.  config is not actually a module, it's a directory that holds the config file. :) But I definitely wouldn't object to splitting ArtemisConfiguration out of util on the basis that util has way too much stuff in it.  Not entirely sure it's worth it.\nThe other possibility is to do what NetworkConfig currently does and just leave someone else to do the mapping ie https://github.com/PegaSysEng/teku/blob/9cd23ae4a876ca08b416349164d1c07b4412022f/services/beaconchain/src/main/java/tech/pegasys/artemis/services/beaconchain/BeaconChainController.java#L247\nI do think there is value in keep ArtemisConfiguration working with primitives because it's going to get a major rewrite soon so the simpler it is the simpler that will be.", "author": "ajsutton", "createdAt": "2020-03-17T03:25:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5MzQxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQzNjQxMw==", "url": "https://github.com/ConsenSys/teku/pull/1379#discussion_r393436413", "bodyText": "it's going to get a major rewrite soon\n\nExcellent \ud83d\udc4d", "author": "CjHare", "createdAt": "2020-03-17T04:16:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5MzQxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQzNjcyMA==", "url": "https://github.com/ConsenSys/teku/pull/1379#discussion_r393436720", "bodyText": "The other possibility is to do what NetworkConfig\n\nAs the conversion is done only once, I'll follow the NetworkConfig  pattern", "author": "CjHare", "createdAt": "2020-03-17T04:17:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5MzQxOA=="}], "type": "inlineReview"}, {"oid": "3860c5730029328baf6c90e614483ef29f5ad23e", "url": "https://github.com/ConsenSys/teku/commit/3860c5730029328baf6c90e614483ef29f5ad23e", "message": "Update logging/src/main/java/tech/pegasys/teku/logging/LoggingConfigurator.java\n\nCo-Authored-By: Adrian Sutton <adrian@symphonious.net>", "committedDate": "2020-03-17T02:48:06Z", "type": "commit"}, {"oid": "634a521daf4f6a479e9f771a1e2dd41e83a2beb7", "url": "https://github.com/ConsenSys/teku/commit/634a521daf4f6a479e9f771a1e2dd41e83a2beb7", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into logging-config", "committedDate": "2020-03-17T02:53:52Z", "type": "commit"}, {"oid": "73bd4d04834daaa27836ab89dc8653c0463c3113", "url": "https://github.com/ConsenSys/teku/commit/73bd4d04834daaa27836ab89dc8653c0463c3113", "message": "Merge branch 'logging-config' of github.com:CjHare/teku into logging-config", "committedDate": "2020-03-17T02:54:05Z", "type": "commit"}, {"oid": "854ad1533e9e76285992b0bd62df3408b1e321d5", "url": "https://github.com/ConsenSys/teku/commit/854ad1533e9e76285992b0bd62df3408b1e321d5", "message": "Warning on unknown logging destination", "committedDate": "2020-03-17T03:00:59Z", "type": "commit"}, {"oid": "ff4e9ec9b51a93055209c8e0f181c5fdcda324c0", "url": "https://github.com/ConsenSys/teku/commit/ff4e9ec9b51a93055209c8e0f181c5fdcda324c0", "message": "Thread saftey", "committedDate": "2020-03-17T03:11:26Z", "type": "commit"}, {"oid": "167025daaf9c164f486ffc76358164ec68a85e6f", "url": "https://github.com/ConsenSys/teku/commit/167025daaf9c164f486ffc76358164ec68a85e6f", "message": "Fall through comment", "committedDate": "2020-03-17T03:23:43Z", "type": "commit"}, {"oid": "a5f5abe8317a2f134952f31c636661a1af861fbc", "url": "https://github.com/ConsenSys/teku/commit/a5f5abe8317a2f134952f31c636661a1af861fbc", "message": "Inverting config", "committedDate": "2020-03-17T04:01:13Z", "type": "commit"}, {"oid": "da192ddf150e10174e1c700e7089043d7c84c66c", "url": "https://github.com/ConsenSys/teku/commit/da192ddf150e10174e1c700e7089043d7c84c66c", "message": "Converting into LoggingDesintation", "committedDate": "2020-03-17T04:10:45Z", "type": "commit"}, {"oid": "75e0503f87cd0e839c7539ab665cda7c1d2d3cf5", "url": "https://github.com/ConsenSys/teku/commit/75e0503f87cd0e839c7539ab665cda7c1d2d3cf5", "message": "Conversion in BeaconNode", "committedDate": "2020-03-17T04:17:59Z", "type": "commit"}, {"oid": "2ae74922c19a590ddad781c9d42f28ede756dfe1", "url": "https://github.com/ConsenSys/teku/commit/2ae74922c19a590ddad781c9d42f28ede756dfe1", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into logging-config", "committedDate": "2020-03-17T04:26:55Z", "type": "commit"}, {"oid": "b4507e4e03538cd360e316fac5c5bfcba4e3b081", "url": "https://github.com/ConsenSys/teku/commit/b4507e4e03538cd360e316fac5c5bfcba4e3b081", "message": "Raising the JDK requirement to resolve dependency correctly", "committedDate": "2020-03-17T06:50:01Z", "type": "commit"}, {"oid": "2a16c9596b40a68555350b00f726ac984afbf08e", "url": "https://github.com/ConsenSys/teku/commit/2a16c9596b40a68555350b00f726ac984afbf08e", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into logging-config", "committedDate": "2020-03-17T06:50:17Z", "type": "commit"}, {"oid": "5759bc3686a48d05c3bf794b1741deec5c10fd1f", "url": "https://github.com/ConsenSys/teku/commit/5759bc3686a48d05c3bf794b1741deec5c10fd1f", "message": "Merging upstream", "committedDate": "2020-03-18T23:53:35Z", "type": "commit"}]}