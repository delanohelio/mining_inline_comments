{"pr_number": 1605, "pr_title": "Add SyncStatusTracker to consider multiple variables when deciding if the node is in sync", "pr_createdAt": "2020-04-16T04:20:14Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1605", "timeline": [{"oid": "e7bdb25a7df1f7c2233265fb6bd7890d86da65a0", "url": "https://github.com/ConsenSys/teku/commit/e7bdb25a7df1f7c2233265fb6bd7890d86da65a0", "message": "Add SyncStatusTracker that considers time since startup, sync status and number of peers when deciding if the node is up to date.", "committedDate": "2020-04-16T04:11:41Z", "type": "commit"}, {"oid": "3e9e3a06ae4b68596bf39745925d52c93395be8a", "url": "https://github.com/ConsenSys/teku/commit/3e9e3a06ae4b68596bf39745925d52c93395be8a", "message": "Add missing dependency.", "committedDate": "2020-04-16T04:27:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYyOTE1MA==", "url": "https://github.com/ConsenSys/teku/pull/1605#discussion_r409629150", "bodyText": "As you mentioned in the description making the last two arguments constants with clear names would be nice.", "author": "cemozerr", "createdAt": "2020-04-16T15:02:50Z", "path": "services/beaconchain/src/main/java/tech/pegasys/artemis/services/beaconchain/BeaconChainController.java", "diffHunk": "@@ -268,6 +275,13 @@ private void initEth1DataCache() {\n         });\n   }\n \n+  private void initSyncStateTracker() {\n+    LOG.debug(\"BeaconChainController.initSyncStateTracker\");\n+    // TODO: Make startup conditions configurable and set reasonable defaults based on the network\n+    syncStateTracker =\n+        new SyncStateTracker(asyncRunner, syncService, p2pNetwork, 5, Duration.ofSeconds(10));", "originalCommit": "3e9e3a06ae4b68596bf39745925d52c93395be8a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTk3MDc0Mw==", "url": "https://github.com/ConsenSys/teku/pull/1605#discussion_r409970743", "bodyText": "Yep they're command line options with defaults provided by the --network choice now.", "author": "ajsutton", "createdAt": "2020-04-17T03:24:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYyOTE1MA=="}], "type": "inlineReview"}, {"oid": "76b99557503fcabcc29921d41cffe91bc8d7c9af", "url": "https://github.com/ConsenSys/teku/commit/76b99557503fcabcc29921d41cffe91bc8d7c9af", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into startup-sync-status", "committedDate": "2020-04-16T23:52:53Z", "type": "commit"}, {"oid": "8485f7b7e71931825534cb48173ecea0da8d68c9", "url": "https://github.com/ConsenSys/teku/commit/8485f7b7e71931825534cb48173ecea0da8d68c9", "message": "Set startup target peer count and timeout as config options with defaults based on the selected network.", "committedDate": "2020-04-17T02:25:59Z", "type": "commit"}, {"oid": "4aa2906cd4cc79d22e7fa1dd0b92034a48e0d237", "url": "https://github.com/ConsenSys/teku/commit/4aa2906cd4cc79d22e7fa1dd0b92034a48e0d237", "message": "Spotless.", "committedDate": "2020-04-17T03:16:28Z", "type": "commit"}, {"oid": "2163f71adfe307ca51c36a7e9ead1102acbd516e", "url": "https://github.com/ConsenSys/teku/commit/2163f71adfe307ca51c36a7e9ead1102acbd516e", "message": "Fix test.", "committedDate": "2020-04-17T03:28:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMwMDUxOQ==", "url": "https://github.com/ConsenSys/teku/pull/1605#discussion_r410300519", "bodyText": "nit: the naming of these two methods is a bit confusing since the getEffectiveValueOptional is currently the one that possibly returns null whereas getEffectiveValue wraps it in an optional", "author": "cemozerr", "createdAt": "2020-04-17T15:31:31Z", "path": "util/src/main/java/tech/pegasys/artemis/util/config/ArtemisConfigurationBuilder.java", "diffHunk": "@@ -343,7 +363,12 @@ public ArtemisConfiguration build() {\n         restApiInterface);\n   }\n \n-  private <T> T getEffectiveValue(\n+  private <T> T getEffectiveValue(final T explicitValue, final Supplier<T> predefinedNetworkValue) {", "originalCommit": "2163f71adfe307ca51c36a7e9ead1102acbd516e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwMDAzNA==", "url": "https://github.com/ConsenSys/teku/pull/1605#discussion_r410500034", "bodyText": "The different is actually about whether the default value is Optional or not. I can't think of a particularly clear name but have changed to getOrDefault and getOrOptionalDefault to match the Map.getOrDefault method since that's essentially what it does. Ideally they'd have the same name but you can't have method signatures where only the generics vary.", "author": "ajsutton", "createdAt": "2020-04-17T22:31:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMwMDUxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMxMTM1MQ==", "url": "https://github.com/ConsenSys/teku/pull/1605#discussion_r410311351", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    () -> {\n          \n          \n            \n                    () -> SafeFuture.fromRunnable(action)", "author": "mbaxter", "createdAt": "2020-04-17T15:49:20Z", "path": "util/src/main/java/tech/pegasys/artemis/util/async/AsyncRunner.java", "diffHunk": "@@ -27,6 +27,17 @@\n   <U> SafeFuture<U> runAfterDelay(\n       Supplier<SafeFuture<U>> action, long delayAmount, TimeUnit delayUnit);\n \n+  default SafeFuture<Void> runAfterDelay(\n+      final Runnable action, long delayAmount, TimeUnit delayUnit) {\n+    return runAfterDelay(\n+        () -> {", "originalCommit": "2163f71adfe307ca51c36a7e9ead1102acbd516e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ5OTA4Mg==", "url": "https://github.com/ConsenSys/teku/pull/1605#discussion_r410499082", "bodyText": "Ooo good spot.", "author": "ajsutton", "createdAt": "2020-04-17T22:27:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMxMTM1MQ=="}], "type": "inlineReview"}, {"oid": "930fafecd37886a6439bb2902e63518036f479d6", "url": "https://github.com/ConsenSys/teku/commit/930fafecd37886a6439bb2902e63518036f479d6", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into startup-sync-status", "committedDate": "2020-04-17T22:26:22Z", "type": "commit"}, {"oid": "27e7236a13419eff0bbfa78b3bebea26b7d8b464", "url": "https://github.com/ConsenSys/teku/commit/27e7236a13419eff0bbfa78b3bebea26b7d8b464", "message": "Use SafeFuture.fromRunnable.", "committedDate": "2020-04-17T22:27:33Z", "type": "commit"}, {"oid": "43dda5a48600f8e1c0c99f8f8a717b064744c7d9", "url": "https://github.com/ConsenSys/teku/commit/43dda5a48600f8e1c0c99f8f8a717b064744c7d9", "message": "Rename method for clarity.", "committedDate": "2020-04-17T22:29:50Z", "type": "commit"}, {"oid": "4441e9a74792c3a13b2fda3d859d156a87e6b796", "url": "https://github.com/ConsenSys/teku/commit/4441e9a74792c3a13b2fda3d859d156a87e6b796", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into startup-sync-status", "committedDate": "2020-04-17T22:36:30Z", "type": "commit"}]}