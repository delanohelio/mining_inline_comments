{"pr_number": 1503, "pr_title": "Convert storage query events to EventChannels", "pr_createdAt": "2020-03-30T19:45:17Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1503", "timeline": [{"oid": "ef3bb166d5f65aca27f66360a80a020d2f078dfb", "url": "https://github.com/ConsenSys/teku/commit/ef3bb166d5f65aca27f66360a80a020d2f078dfb", "message": "Convert storage query events to EventChannels", "committedDate": "2020-03-30T19:44:06Z", "type": "commit"}, {"oid": "748457c8cd0788eda916eacfd7c99559948df3ac", "url": "https://github.com/ConsenSys/teku/commit/748457c8cd0788eda916eacfd7c99559948df3ac", "message": "Subscribe to query calls", "committedDate": "2020-03-30T19:51:27Z", "type": "commit"}, {"oid": "1b64e99723b6ac59010a64b5469cfc4e0f99b191", "url": "https://github.com/ConsenSys/teku/commit/1b64e99723b6ac59010a64b5469cfc4e0f99b191", "message": "Remove redundant AsyncEventTracker", "committedDate": "2020-03-30T20:13:29Z", "type": "commit"}, {"oid": "40f346572a3f8fb5fc50c46e43c9390c01ec554c", "url": "https://github.com/ConsenSys/teku/commit/40f346572a3f8fb5fc50c46e43c9390c01ec554c", "message": "Merge branch 'master' into storageQueryEventsToEventChannels", "committedDate": "2020-03-30T22:21:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU0ODczNA==", "url": "https://github.com/ConsenSys/teku/pull/1503#discussion_r400548734", "bodyText": "We talked about using HistoricalChainData as a wrapper around StorageQueryChannel but I hadn't realised we were able to completely remove HistoricalChainData.  So actually I think using the channel directly is better than the wrapper class in this case.\nI am however tempted to move as much stuff to use CombinedChainData as possible rather than directly requesting data from storage.  Then it can load content from memory when possible and that would be the place we could add caching if needed.  I'd probably only do that in this PR where CombinedChainData is already reasonably easily available - otherwise it's just something we'll get to in the future.", "author": "ajsutton", "createdAt": "2020-03-30T23:10:53Z", "path": "networking/eth2/src/main/java/tech/pegasys/artemis/networking/eth2/Eth2NetworkBuilder.java", "diffHunk": "@@ -101,7 +101,13 @@ public Eth2NetworkBuilder eventBus(final EventBus eventBus) {\n     return this;\n   }\n \n-  public Eth2NetworkBuilder chainStorageClient(final RecentChainData recentChainData) {\n+  public Eth2NetworkBuilder historicalChainData(final StorageQueryChannel historicalChainData) {\n+    checkNotNull(historicalChainData);\n+    this.historicalChainData = historicalChainData;\n+    return this;\n+  }", "originalCommit": "40f346572a3f8fb5fc50c46e43c9390c01ec554c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU2MTk1Mg==", "url": "https://github.com/ConsenSys/teku/pull/1503#discussion_r400561952", "bodyText": "Discussed offline to move as much stuff to use CombinedChainDataClient as possible, but decided to do this after the move to EventChannels is done. Here are the jira tickets for planned work:\n\nhttps://pegasys1.atlassian.net/secure/RapidBoard.jspa?rapidView=67&modal=detail&selectedIssue=BC-320\nhttps://pegasys1.atlassian.net/secure/RapidBoard.jspa?rapidView=67&modal=detail&selectedIssue=BC-321", "author": "cemozerr", "createdAt": "2020-03-30T23:51:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU0ODczNA=="}], "type": "inlineReview"}]}