{"pr_number": 2695, "pr_title": "Print warning when the Eth1 chain is shorter than follow distance", "pr_createdAt": "2020-08-31T11:50:41Z", "pr_url": "https://github.com/ConsenSys/teku/pull/2695", "timeline": [{"oid": "4f849f4981266320ab45496ed3407ea312b0e4af", "url": "https://github.com/ConsenSys/teku/commit/4f849f4981266320ab45496ed3407ea312b0e4af", "message": "Print warning when the Eth1 chain is shorter than follow distance", "committedDate": "2020-08-31T08:44:48Z", "type": "commit"}, {"oid": "8e0cddd1bd404e4827a4d2d07fe948e83cd3b398", "url": "https://github.com/ConsenSys/teku/commit/8e0cddd1bd404e4827a4d2d07fe948e83cd3b398", "message": "Remove stale comment", "committedDate": "2020-08-31T08:49:07Z", "type": "commit"}, {"oid": "ab1f23168390324e799d413feec2109ff5564582", "url": "https://github.com/ConsenSys/teku/commit/ab1f23168390324e799d413feec2109ff5564582", "message": "Merge branch 'master' into warningWhenEth1ChainIsShorter", "committedDate": "2020-08-31T11:51:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5Mzk5NA==", "url": "https://github.com/ConsenSys/teku/pull/2695#discussion_r480193994", "bodyText": "Should we retry less frequently and log a warning in this case?", "author": "mbaxter", "createdAt": "2020-08-31T15:07:52Z", "path": "pow/src/main/java/tech/pegasys/teku/pow/Eth1DepositManager.java", "diffHunk": "@@ -146,8 +146,16 @@ private void preGenesisSubscription(final BigInteger lastProcessedBlockNumber) {\n     return eth1Provider\n         .getLatestEth1Block()\n         .thenApply(EthBlock.Block::getNumber)\n-        .thenApply(number -> number.subtract(Constants.ETH1_FOLLOW_DISTANCE.bigIntegerValue()))\n         .thenApply(UInt64::valueOf)\n+        .thenApply(\n+            number -> {\n+              if (number.isLessThan(Constants.ETH1_FOLLOW_DISTANCE)) {", "originalCommit": "ab1f23168390324e799d413feec2109ff5564582", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI0ODExOQ==", "url": "https://github.com/ConsenSys/teku/pull/2695#discussion_r480248119", "bodyText": "Makes sense, will do that.", "author": "cemozerr", "createdAt": "2020-08-31T16:33:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5Mzk5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwNTA0NA==", "url": "https://github.com/ConsenSys/teku/pull/2695#discussion_r480405044", "bodyText": "Not sure we even need a warning - it's a pretty expected condition when using a local test chain.  And we could just start following from 0 now I think about it.  The genesis block of ETH1 is finalized so there's no risk of it being re-orged.  We should then just sit at block 0 until the chain reaches 1024 blocks long where we can carry on as normal.", "author": "ajsutton", "createdAt": "2020-08-31T21:19:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5Mzk5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTAzODUyNQ==", "url": "https://github.com/ConsenSys/teku/pull/2695#discussion_r481038525", "bodyText": "We should then just sit at block 0 until the chain reaches 1024 blocks long where we can carry on as normal.\n\nThat made sense to me, so I made the changes to reflect that.", "author": "cemozerr", "createdAt": "2020-09-01T10:30:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5Mzk5NA=="}], "type": "inlineReview"}, {"oid": "d894f43ebe0cbf2cf0c06e7763e3a8c20a7786f2", "url": "https://github.com/ConsenSys/teku/commit/d894f43ebe0cbf2cf0c06e7763e3a8c20a7786f2", "message": "Wait until local chain reaches follow distance instead of logging a warning", "committedDate": "2020-09-01T10:30:52Z", "type": "commit"}, {"oid": "30efdb8fa0fd65317bf8c39e983c0d53e6543430", "url": "https://github.com/ConsenSys/teku/commit/30efdb8fa0fd65317bf8c39e983c0d53e6543430", "message": "Run spotless", "committedDate": "2020-09-01T11:28:23Z", "type": "commit"}, {"oid": "3084f5464db48d30dc41a24120ed2f7acf552b5d", "url": "https://github.com/ConsenSys/teku/commit/3084f5464db48d30dc41a24120ed2f7acf552b5d", "message": "Merge branch 'master' into warningWhenEth1ChainIsShorter", "committedDate": "2020-09-01T15:43:42Z", "type": "commit"}, {"oid": "ae78436a8750d8bd302068e91c9890c1ddcd8e2a", "url": "https://github.com/ConsenSys/teku/commit/ae78436a8750d8bd302068e91c9890c1ddcd8e2a", "message": "Merge branch 'master' into warningWhenEth1ChainIsShorter", "committedDate": "2020-09-02T08:17:50Z", "type": "commit"}]}