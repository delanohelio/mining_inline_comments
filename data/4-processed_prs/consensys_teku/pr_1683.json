{"pr_number": 1683, "pr_title": "Set correct best block before network starts", "pr_createdAt": "2020-04-27T23:08:06Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1683", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIyMzUwMA==", "url": "https://github.com/ConsenSys/teku/pull/1683#discussion_r416223500", "bodyText": "I don't think this is right.  It works for genesis because there are no unknown blocks, but starting up after genesis we need to run fork choice to select the best block.", "author": "ajsutton", "createdAt": "2020-04-27T23:42:38Z", "path": "storage/src/main/java/tech/pegasys/artemis/storage/client/RecentChainData.java", "diffHunk": "@@ -128,6 +122,12 @@ public Store getStore() {\n \n   // NETWORKING RELATED INFORMATION METHODS:\n \n+  public void updateBestBlock(ReadOnlyStore store) {\n+    Bytes32 headBlockRoot = store.getFinalizedCheckpoint().getRoot();\n+    BeaconBlock headBlock = store.getBlock(headBlockRoot);\n+    updateBestBlock(headBlockRoot, headBlock.getSlot());\n+  }", "originalCommit": "d3bac59c82cd8d84599a7ee22ba335dfe6a23ef7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c700788241c4a5886c1dbd01bab952c48f30e0ab", "url": "https://github.com/ConsenSys/teku/commit/c700788241c4a5886c1dbd01bab952c48f30e0ab", "message": "Run fork choice after store then start network", "committedDate": "2020-04-28T16:33:25Z", "type": "commit"}, {"oid": "c700788241c4a5886c1dbd01bab952c48f30e0ab", "url": "https://github.com/ConsenSys/teku/commit/c700788241c4a5886c1dbd01bab952c48f30e0ab", "message": "Run fork choice after store then start network", "committedDate": "2020-04-28T16:33:25Z", "type": "forcePushed"}, {"oid": "f378f7f60f2c6f6b8a654e0e4a0cc724e2fb3206", "url": "https://github.com/ConsenSys/teku/commit/f378f7f60f2c6f6b8a654e0e4a0cc724e2fb3206", "message": "Merge branch 'master' into storeInitializationGuaranteesBestBlock", "committedDate": "2020-04-28T16:56:37Z", "type": "commit"}, {"oid": "4c1c5a813da196cb4ac20e4e72ec4c5907683bca", "url": "https://github.com/ConsenSys/teku/commit/4c1c5a813da196cb4ac20e4e72ec4c5907683bca", "message": "Tiny clean up", "committedDate": "2020-04-28T17:20:55Z", "type": "commit"}]}