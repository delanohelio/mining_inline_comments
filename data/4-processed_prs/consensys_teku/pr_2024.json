{"pr_number": 2024, "pr_title": "Improve validator logging", "pr_createdAt": "2020-06-02T01:29:45Z", "pr_url": "https://github.com/ConsenSys/teku/pull/2024", "timeline": [{"oid": "1afd540dc19f317ab794b998a0701bcd8cc36122", "url": "https://github.com/ConsenSys/teku/commit/1afd540dc19f317ab794b998a0701bcd8cc36122", "message": "Introduce validator event logging to log when validators perform duties.\nImprove the logging when validators fail to perform duties.", "committedDate": "2020-06-02T01:27:06Z", "type": "commit"}, {"oid": "ecd183ddeb32e70787af25e1efebae0ee5b71ba6", "url": "https://github.com/ConsenSys/teku/commit/ecd183ddeb32e70787af25e1efebae0ee5b71ba6", "message": "Line things up.", "committedDate": "2020-06-02T02:00:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE5NjYyOA==", "url": "https://github.com/ConsenSys/teku/pull/2024#discussion_r434196628", "bodyText": "Looks like deliverToWithResponse no longer sends errors to the exceptionHandler - is that okay?", "author": "mbaxter", "createdAt": "2020-06-02T21:53:30Z", "path": "events/src/main/java/tech/pegasys/teku/events/DirectEventDeliverer.java", "diffHunk": "@@ -67,12 +70,10 @@ protected void deliverTo(final T subscriber, final Method method, final Object[]\n       return (SafeFuture<X>) method.invoke(subscriber, args);\n     } catch (IllegalAccessException e) {\n       incrementCounter(failedEventCounter, subscriber, method);\n-      exceptionHandler.handleException(e, subscriber, method, args);", "originalCommit": "ecd183ddeb32e70787af25e1efebae0ee5b71ba6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxMTI4MA==", "url": "https://github.com/ConsenSys/teku/pull/2024#discussion_r434211280", "bodyText": "Yeah that was deliberate - the exception is reported back to the SafeFuture. Previously we were double handling the problem resulting in noisy logs for things that we actually handled cleanly.", "author": "ajsutton", "createdAt": "2020-06-02T22:32:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE5NjYyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIwODgzOA==", "url": "https://github.com/ConsenSys/teku/pull/2024#discussion_r434208838", "bodyText": "Do we not want the attestation root here?", "author": "mbaxter", "createdAt": "2020-06-02T22:25:54Z", "path": "validator/client/src/main/java/tech/pegasys/teku/validator/client/duties/AttestationProductionDuty.java", "diffHunk": "@@ -111,21 +112,23 @@ public String describe() {\n                     }));\n   }\n \n-  private SafeFuture<Void> signAttestationsForCommittee(\n+  private SafeFuture<DutyResult> signAttestationsForCommittee(\n       final ForkInfo forkInfo, final Committee validators, final Attestation attestation) {\n-    return validators.forEach(\n-        validator -> signAttestationForValidator(forkInfo, attestation, validator));\n+    return DutyResult.combine(\n+        validators.forEach(\n+            validator -> signAttestationForValidator(forkInfo, attestation, validator)));\n   }\n \n-  private SafeFuture<Void> signAttestationForValidator(\n+  private SafeFuture<DutyResult> signAttestationForValidator(\n       final ForkInfo forkInfo,\n       final Attestation attestation,\n       final ValidatorWithCommitteePosition validator) {\n     return validator\n         .getSigner()\n         .signAttestationData(attestation.getData(), forkInfo)\n         .thenApply(signature -> createSignedAttestation(attestation, validator, signature))\n-        .thenAccept(validatorApiChannel::sendSignedAttestation);\n+        .thenAccept(validatorApiChannel::sendSignedAttestation)\n+        .thenApply(__ -> DutyResult.success(attestation.getData().getBeacon_block_root()));", "originalCommit": "ecd183ddeb32e70787af25e1efebae0ee5b71ba6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxMTA4MQ==", "url": "https://github.com/ConsenSys/teku/pull/2024#discussion_r434211081", "bodyText": "The logs (when they used to work) have always shown the block the attestation is attesting to.  That' actually a lot more useful because what you're most interested in is whether the attestation will wind up being on the correct chain and thus get rewarded.", "author": "ajsutton", "createdAt": "2020-06-02T22:32:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIwODgzOA=="}], "type": "inlineReview"}, {"oid": "237f70fb3668de8edf1226cdff765f14b61acce8", "url": "https://github.com/ConsenSys/teku/commit/237f70fb3668de8edf1226cdff765f14b61acce8", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into validator-logging", "committedDate": "2020-06-02T22:33:03Z", "type": "commit"}, {"oid": "75a67ab4a7418afd519647a4a1f42299bd3637a7", "url": "https://github.com/ConsenSys/teku/commit/75a67ab4a7418afd519647a4a1f42299bd3637a7", "message": "Add changelog entry.", "committedDate": "2020-06-02T22:39:09Z", "type": "commit"}]}