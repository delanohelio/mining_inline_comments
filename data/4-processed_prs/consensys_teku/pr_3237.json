{"pr_number": 3237, "pr_title": "Add `correct` validator metrics", "pr_createdAt": "2020-11-16T21:15:37Z", "pr_url": "https://github.com/ConsenSys/teku/pull/3237", "timeline": [{"oid": "ff2c2b5486f53a55990fc53d9840a933bbab1a0e", "url": "https://github.com/ConsenSys/teku/commit/ff2c2b5486f53a55990fc53d9840a933bbab1a0e", "message": "Add 'correct' validator metrics", "committedDate": "2020-11-16T21:11:41Z", "type": "commit"}, {"oid": "97a59406618a2e4435af011ac0490a1fed567fb1", "url": "https://github.com/ConsenSys/teku/commit/97a59406618a2e4435af011ac0490a1fed567fb1", "message": "Remove redundant line", "committedDate": "2020-11-16T21:39:33Z", "type": "commit"}, {"oid": "3908927657f0ea1965dbe0998036c91c554facee", "url": "https://github.com/ConsenSys/teku/commit/3908927657f0ea1965dbe0998036c91c554facee", "message": "Merge branch 'master' into addCorrectValidatorsMetrics", "committedDate": "2020-11-16T21:45:29Z", "type": "commit"}, {"oid": "611b9cd8f3553a8218c682699cb1d2e8607401c7", "url": "https://github.com/ConsenSys/teku/commit/611b9cd8f3553a8218c682699cb1d2e8607401c7", "message": "Fix old test breaking change", "committedDate": "2020-11-16T22:33:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDczMTk2OQ==", "url": "https://github.com/ConsenSys/teku/pull/3237#discussion_r524731969", "bodyText": "I think we should avoid iterating through all the attestations twice. We just need to iterate through once, counting both total validators and correct validators.  Likely that will be easiest if you just an old fashioned for loop rather than streams.", "author": "ajsutton", "createdAt": "2020-11-16T23:16:28Z", "path": "services/beaconchain/src/main/java/tech/pegasys/teku/services/beaconchain/BeaconChainMetrics.java", "diffHunk": "@@ -173,15 +194,35 @@ private void updateMetrics(final BeaconState state) {\n   }\n \n   private int getLiveValidators(final SSZList<PendingAttestation> attestations) {\n-    final Map<UInt64, Map<UInt64, Bitlist>> aggregationBitsBySlotAndCommittee = new HashMap<>();\n-    attestations.forEach(\n+    return getNumberOfValidators(attestations, (__) -> true);", "originalCommit": "611b9cd8f3553a8218c682699cb1d2e8607401c7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1f44cf4ed87b44f203d4598d95850e7bea62a266", "url": "https://github.com/ConsenSys/teku/commit/1f44cf4ed87b44f203d4598d95850e7bea62a266", "message": "Pass through attesation lists once", "committedDate": "2020-11-17T17:48:43Z", "type": "commit"}, {"oid": "2027940ead7f1606d83c30b244a91aa83848c55d", "url": "https://github.com/ConsenSys/teku/commit/2027940ead7f1606d83c30b244a91aa83848c55d", "message": "Remove extra parantheses", "committedDate": "2020-11-17T18:15:47Z", "type": "commit"}, {"oid": "4f5e1864c63dc36592d133a0f761bcd52100cde6", "url": "https://github.com/ConsenSys/teku/commit/4f5e1864c63dc36592d133a0f761bcd52100cde6", "message": "Merge branch 'master' into addCorrectValidatorsMetrics", "committedDate": "2020-11-18T12:58:16Z", "type": "commit"}]}