{"pr_number": 1493, "pr_title": "Fix getDuties to use a state from the previous epoch", "pr_createdAt": "2020-03-27T05:09:26Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1493", "timeline": [{"oid": "b5bad378926b0adf768f85fbf9fde19957dc83a9", "url": "https://github.com/ConsenSys/teku/commit/b5bad378926b0adf768f85fbf9fde19957dc83a9", "message": "Fix getDuties to use a state from the epoch prior to the one requested so that we can actually lookup an epoch ahead.\nCombinedChainDataClient should load data for the genesis slot from recent storage during the first epoch.", "committedDate": "2020-03-27T05:07:00Z", "type": "commit"}, {"oid": "be96df8a1a69eac271c23353bfe8acd956ebefa8", "url": "https://github.com/ConsenSys/teku/commit/be96df8a1a69eac271c23353bfe8acd956ebefa8", "message": "Make errorprone happy.", "committedDate": "2020-03-27T05:12:49Z", "type": "commit"}, {"oid": "3a1c080c95f62d3510f36fc6af571aa6d7450ad6", "url": "https://github.com/ConsenSys/teku/commit/3a1c080c95f62d3510f36fc6af571aa6d7450ad6", "message": "Fix unit test.", "committedDate": "2020-03-27T05:28:37Z", "type": "commit"}, {"oid": "0981a5d387713ca288c590338ec999327d6b55a9", "url": "https://github.com/ConsenSys/teku/commit/0981a5d387713ca288c590338ec999327d6b55a9", "message": "Fix test again.", "committedDate": "2020-03-27T05:41:16Z", "type": "commit"}, {"oid": "11ee8feb0c8c91d470e92888d49a10e7187d3d46", "url": "https://github.com/ConsenSys/teku/commit/11ee8feb0c8c91d470e92888d49a10e7187d3d46", "message": "Reduce log level.", "committedDate": "2020-03-27T07:12:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ0MTE0NQ==", "url": "https://github.com/ConsenSys/teku/pull/1493#discussion_r399441145", "bodyText": "We always hold the latest finalized state in the in-memory store.  What if we just check the chainStorageClient first before pulling historical data?", "author": "mbaxter", "createdAt": "2020-03-27T17:51:24Z", "path": "storage/src/main/java/tech/pegasys/artemis/storage/CombinedChainDataClient.java", "diffHunk": "@@ -146,6 +146,11 @@ public CombinedChainDataClient(\n     return getBlockByBlockRoot(get_block_root_at_slot(state, slot));\n   }\n \n+  private boolean isHistoricalData(final UnsignedLong slot) {\n+    final boolean finalizedPastFirstEpoch = !recentChainData.getFinalizedEpoch().equals(ZERO);", "originalCommit": "11ee8feb0c8c91d470e92888d49a10e7187d3d46", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4MDUzNg==", "url": "https://github.com/ConsenSys/teku/pull/1493#discussion_r399580536", "bodyText": "To find state we wind up having to walk backwards through the historical roots so it's a significant advantage to know that something is finalised and go straight to the historical store where we can just lookup by slot.", "author": "ajsutton", "createdAt": "2020-03-27T23:23:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ0MTE0NQ=="}], "type": "inlineReview"}, {"oid": "6df4c0b057eb870e2ecc650f7b6c30d5f77cf0ed", "url": "https://github.com/ConsenSys/teku/commit/6df4c0b057eb870e2ecc650f7b6c30d5f77cf0ed", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into use-previous-epoch-to-generate-duties", "committedDate": "2020-03-27T23:21:55Z", "type": "commit"}, {"oid": "3105a59a8bbdc1e4f86307cb3d6cb4c038e40c72", "url": "https://github.com/ConsenSys/teku/commit/3105a59a8bbdc1e4f86307cb3d6cb4c038e40c72", "message": "Fix unit test.", "committedDate": "2020-03-28T01:34:19Z", "type": "commit"}]}