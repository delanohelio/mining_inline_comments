{"pr_number": 1706, "pr_title": "New news page", "pr_createdAt": "2020-05-18T12:49:15Z", "pr_url": "https://github.com/FAForever/downlords-faf-client/pull/1706", "timeline": [{"oid": "2c240eb6dc066ff3ba2abdb6b176385fad0580d7", "url": "https://github.com/FAForever/downlords-faf-client/commit/2c240eb6dc066ff3ba2abdb6b176385fad0580d7", "message": "load new news page", "committedDate": "2020-05-18T12:31:50Z", "type": "commit"}, {"oid": "c33ecdc1b72c4409af87553d4967a81363811d82", "url": "https://github.com/FAForever/downlords-faf-client/commit/c33ecdc1b72c4409af87553d4967a81363811d82", "message": "delete news_detail.html", "committedDate": "2020-05-18T12:48:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjYzMjEwNQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1706#discussion_r426632105", "bodyText": "Never ever do hardcoded urls.\nWe either load it from the FafApiProperties class and declare it in the application.yml\nOr we add it to the remote preferences which would give us a bit more flexibility until things have settled.", "author": "Brutus5000", "createdAt": "2020-05-18T13:38:11Z", "path": "src/main/java/com/faforever/client/news/NewsController.java", "diffHunk": "@@ -108,38 +87,14 @@ public void onUnreadNewsEvent(UnreadNewsEvent unreadNewsEvent) {\n \n \n   private void loadNews() {\n-    newsService.fetchNews().thenAccept(newsItems -> {\n-      Platform.runLater(() -> {\n-        newsListView.getItems().setAll(newsItems);\n-        onLoadingStop();\n-        if (!newsItems.isEmpty()) {\n-          NewsItem mostRecentItem = newsItems.get(0);\n-          preferencesService.getPreferences().getNews().setLastReadNewsUrl(mostRecentItem.getLink());\n-          preferencesService.storeInBackground();\n-        }\n-        newsListView.getSelectionModel().selectFirst();\n-      });\n+    Platform.runLater(() -> {\n+      newsWebView.getEngine().load(\"https://www.faforever.com/news\");", "originalCommit": "c33ecdc1b72c4409af87553d4967a81363811d82", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY0NTU0NQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1706#discussion_r426645545", "bodyText": "I can do it like the Unitdb, that uses the application.yml and Clientproperties.java\nIs that a good way?", "author": "BlackYps", "createdAt": "2020-05-18T13:57:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjYzMjEwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjYzNDQwOQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1706#discussion_r426634409", "bodyText": "I am missing changes to remove this service and related tests.", "author": "Brutus5000", "createdAt": "2020-05-18T13:41:28Z", "path": "src/main/java/com/faforever/client/news/NewsController.java", "diffHunk": "@@ -31,25 +31,14 @@\n @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n public class NewsController extends AbstractViewController<Node> {\n \n-  private static final ClassPathResource NEWS_DETAIL_HTML_RESOURCE = new ClassPathResource(\"/theme/news_detail.html\");\n-  private final PreferencesService preferencesService;\n-  private final I18n i18n;\n-  private final NewsService newsService;", "originalCommit": "c33ecdc1b72c4409af87553d4967a81363811d82", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f0d3013555f4e676d306702e52f84bc52873c930", "url": "https://github.com/FAForever/downlords-faf-client/commit/f0d3013555f4e676d306702e52f84bc52873c930", "message": "load url from properties", "committedDate": "2020-05-21T17:23:06Z", "type": "commit"}, {"oid": "11da7700d3f3d00399ac90e2672892f9006e3d62", "url": "https://github.com/FAForever/downlords-faf-client/commit/11da7700d3f3d00399ac90e2672892f9006e3d62", "message": "set user agent", "committedDate": "2020-05-21T17:23:14Z", "type": "commit"}, {"oid": "11da7700d3f3d00399ac90e2672892f9006e3d62", "url": "https://github.com/FAForever/downlords-faf-client/commit/11da7700d3f3d00399ac90e2672892f9006e3d62", "message": "set user agent", "committedDate": "2020-05-21T17:23:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYyNTE2MQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1706#discussion_r429625161", "bodyText": "Check for related tests to remove", "author": "1-alex98", "createdAt": "2020-05-24T11:10:56Z", "path": "src/main/java/com/faforever/client/news/NewsController.java", "diffHunk": "@@ -1,57 +1,37 @@\n package com.faforever.client.news;\n \n+import com.faforever.client.config.ClientProperties;\n+import com.faforever.client.config.ClientProperties.Website;\n import com.faforever.client.fx.AbstractViewController;\n import com.faforever.client.fx.WebViewConfigurer;\n-import com.faforever.client.i18n.I18n;\n import com.faforever.client.main.event.NavigateEvent;\n-import com.faforever.client.main.event.ShowLadderMapsEvent;\n-import com.faforever.client.preferences.PreferencesService;\n-import com.faforever.client.theme.UiService;\n import com.google.common.eventbus.EventBus;\n import com.google.common.eventbus.Subscribe;\n-import com.google.common.io.CharStreams;\n import javafx.application.Platform;\n import javafx.beans.value.ChangeListener;\n import javafx.scene.Node;\n-import javafx.scene.control.Button;\n import javafx.scene.control.Control;\n-import javafx.scene.control.ListView;\n import javafx.scene.layout.Pane;\n import javafx.scene.web.WebView;\n-import lombok.SneakyThrows;\n import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n import org.springframework.context.annotation.Scope;\n-import org.springframework.core.io.ClassPathResource;\n import org.springframework.stereotype.Component;\n \n-import java.io.InputStreamReader;\n-import java.io.Reader;\n-\n @Component\n @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n public class NewsController extends AbstractViewController<Node> {", "originalCommit": "11da7700d3f3d00399ac90e2672892f9006e3d62", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d3c635c87a74cfecc490ae8733e12901b6c8c79c", "url": "https://github.com/FAForever/downlords-faf-client/commit/d3c635c87a74cfecc490ae8733e12901b6c8c79c", "message": "configure webView only once\n\nalso delete leftover NewsService", "committedDate": "2020-05-26T15:22:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDYwNzUxNg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1706#discussion_r430607516", "bodyText": "The loading should be removed the way it is now it is technical impossible to see the loading spinner", "author": "1-alex98", "createdAt": "2020-05-26T18:05:49Z", "path": "src/main/java/com/faforever/client/news/NewsController.java", "diffHunk": "@@ -108,38 +78,15 @@ public void onUnreadNewsEvent(UnreadNewsEvent unreadNewsEvent) {\n \n \n   private void loadNews() {\n-    newsService.fetchNews().thenAccept(newsItems -> {\n-      Platform.runLater(() -> {\n-        newsListView.getItems().setAll(newsItems);\n-        onLoadingStop();\n-        if (!newsItems.isEmpty()) {\n-          NewsItem mostRecentItem = newsItems.get(0);\n-          preferencesService.getPreferences().getNews().setLastReadNewsUrl(mostRecentItem.getLink());\n-          preferencesService.storeInBackground();\n-        }\n-        newsListView.getSelectionModel().selectFirst();\n-      });\n+    Platform.runLater(() -> {\n+      Website website = clientProperties.getWebsite();\n+      newsWebView.getEngine().load(website.getNewsHubUrl());\n+      onLoadingStop();", "originalCommit": "d3c635c87a74cfecc490ae8733e12901b6c8c79c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDYwNzkxMQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1706#discussion_r430607911", "bodyText": "Well or listen on the engine finishing the loading", "author": "1-alex98", "createdAt": "2020-05-26T18:06:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDYwNzUxNg=="}], "type": "inlineReview"}, {"oid": "d7a5a504ece347c71a9f3f6c2f5f0765cfe87bc2", "url": "https://github.com/FAForever/downlords-faf-client/commit/d7a5a504ece347c71a9f3f6c2f5f0765cfe87bc2", "message": "make loading spinner possible to see", "committedDate": "2020-05-27T15:36:57Z", "type": "commit"}]}