{"pr_number": 2032, "pr_title": "Show team matchmaker map pools", "pr_createdAt": "2020-11-10T18:43:18Z", "pr_url": "https://github.com/FAForever/downlords-faf-client/pull/2032", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzMDk1MA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2032#discussion_r520930950", "bodyText": "@DaTa maybe", "author": "1-alex98", "createdAt": "2020-11-10T23:05:58Z", "path": "src/main/java/com/faforever/client/api/dto/Leaderboard.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.faforever.client.api.dto;\n+\n+import com.github.jasminb.jsonapi.annotations.Id;\n+import com.github.jasminb.jsonapi.annotations.Type;\n+import lombok.EqualsAndHashCode;\n+import lombok.Getter;\n+import lombok.Setter;\n+\n+import java.time.OffsetDateTime;\n+\n+@Getter\n+@Setter", "originalCommit": "d789a50506023792a6173bd2240ce5168f823766", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e7299ba95ddfcc3b8caeafcab87f8829bf851257", "url": "https://github.com/FAForever/downlords-faf-client/commit/e7299ba95ddfcc3b8caeafcab87f8829bf851257", "message": "Filter out duplicate maps", "committedDate": "2020-11-11T19:06:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE0ODc1Mg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2032#discussion_r522148752", "bodyText": "If you want to keep this structure and implement the pagination you would need to do it here with some .skip and .limit functions", "author": "Sheikah45", "createdAt": "2020-11-12T14:31:14Z", "path": "src/main/java/com/faforever/client/remote/FafService.java", "diffHunk": "@@ -466,11 +466,15 @@ public void restoreGameSession(int id) {\n   }\n \n   @Async\n-  public CompletableFuture<Tuple<List<MapBean>, Integer>> getLadder1v1MapsWithPageCount(int count, int page) {\n-    Tuple<List<Ladder1v1Map>, java.util.Map<String, ?>> tuple = fafApiAccessor.getLadder1v1MapsWithMeta(count, page);\n+  public CompletableFuture<Tuple<List<MapBean>, Integer>> getMatchmakerMapsWithPageCount(int matchmakerQueueId, int count, int page) {\n+    // fixme This uses the count for the number of map pools instead of the number of maps\n+    Tuple<List<MatchmakerQueueMapPool>, java.util.Map<String, ?>> tuple = fafApiAccessor.getMatchMakerPoolsWithMeta(matchmakerQueueId, count, page);\n     return CompletableFuture.completedFuture(new Tuple<>(tuple.getFirst()\n         .parallelStream()\n-        .map(ladder1v1Map -> MapBean.fromMapVersionDto(ladder1v1Map.getMapVersion()))\n+        .map(MatchmakerQueueMapPool::getMapPool)\n+        .flatMap(mapPool -> mapPool.getMapVersions().stream())\n+        .distinct()\n+        .map(MapBean::fromMapVersionDto)\n         .collect(toList()),", "originalCommit": "1b407cc4be4f87ed22cc21313c37e237be1f28fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM0OTU3Nw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2032#discussion_r522349577", "bodyText": "I made it work! Is there a more elegant way to find out the size of the stream than what I did? It feels a bit clunky.", "author": "BlackYps", "createdAt": "2020-11-12T19:09:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE0ODc1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQwMTc2OQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2032#discussion_r522401769", "bodyText": "Unfortunately not that I am aware of as .count() is a terminal operation on a stream. Also your total pages might be off by 1 it might be good to get the ceiling of that value.", "author": "Sheikah45", "createdAt": "2020-11-12T20:24:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE0ODc1Mg=="}], "type": "inlineReview"}, {"oid": "e1d0b070f6a407c4915f33345f6f84a8af181898", "url": "https://github.com/FAForever/downlords-faf-client/commit/e1d0b070f6a407c4915f33345f6f84a8af181898", "message": "Show team matchmaker map pools", "committedDate": "2020-11-15T18:06:50Z", "type": "commit"}, {"oid": "28087c6d902290025b8293d16555dad0695a9b59", "url": "https://github.com/FAForever/downlords-faf-client/commit/28087c6d902290025b8293d16555dad0695a9b59", "message": "Fix MapVaultControllerTest", "committedDate": "2020-11-15T18:06:50Z", "type": "commit"}, {"oid": "046097dc91e862db6410ae16df65a46d1314ca4f", "url": "https://github.com/FAForever/downlords-faf-client/commit/046097dc91e862db6410ae16df65a46d1314ca4f", "message": "Filter out duplicate maps", "committedDate": "2020-11-15T18:06:50Z", "type": "commit"}, {"oid": "ba0f2f85be394267b61999e6bd26def57d100567", "url": "https://github.com/FAForever/downlords-faf-client/commit/ba0f2f85be394267b61999e6bd26def57d100567", "message": "Fix NullPointerException in searchType", "committedDate": "2020-11-15T18:06:50Z", "type": "commit"}, {"oid": "382da6f13d33e3ee8abc463f2a99767f412fad5d", "url": "https://github.com/FAForever/downlords-faf-client/commit/382da6f13d33e3ee8abc463f2a99767f412fad5d", "message": "Allow pagination of map pool maps", "committedDate": "2020-11-15T18:06:50Z", "type": "commit"}, {"oid": "e554604720663b7d3ead37ab849cb70818e13ae4", "url": "https://github.com/FAForever/downlords-faf-client/commit/e554604720663b7d3ead37ab849cb70818e13ae4", "message": "Always return correct page count", "committedDate": "2020-11-15T18:06:50Z", "type": "commit"}, {"oid": "671ae6cce68e1527559ef3814f1898f4fa5cdd91", "url": "https://github.com/FAForever/downlords-faf-client/commit/671ae6cce68e1527559ef3814f1898f4fa5cdd91", "message": "Use i18n", "committedDate": "2020-11-15T18:06:50Z", "type": "commit"}, {"oid": "a52ecec100c53a506a540edea267ed86e291fb6f", "url": "https://github.com/FAForever/downlords-faf-client/commit/a52ecec100c53a506a540edea267ed86e291fb6f", "message": "Retrieve queueId from the api", "committedDate": "2020-11-15T18:06:50Z", "type": "commit"}, {"oid": "a52ecec100c53a506a540edea267ed86e291fb6f", "url": "https://github.com/FAForever/downlords-faf-client/commit/a52ecec100c53a506a540edea267ed86e291fb6f", "message": "Retrieve queueId from the api", "committedDate": "2020-11-15T18:06:50Z", "type": "forcePushed"}, {"oid": "53e7b567906d8af40ce18c4f2718fd6a5153b840", "url": "https://github.com/FAForever/downlords-faf-client/commit/53e7b567906d8af40ce18c4f2718fd6a5153b840", "message": "Poor attempt of a fix", "committedDate": "2020-11-15T21:11:52Z", "type": "commit"}, {"oid": "22a85a4c57cf78965f37bd3dba67ae65c3f1705a", "url": "https://github.com/FAForever/downlords-faf-client/commit/22a85a4c57cf78965f37bd3dba67ae65c3f1705a", "message": "Finish fix", "committedDate": "2020-11-16T11:15:02Z", "type": "commit"}]}