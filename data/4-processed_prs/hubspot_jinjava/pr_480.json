{"pr_number": 480, "pr_title": "Revert \"Revert \"Divide by zero\"\" (New PR)", "pr_createdAt": "2020-08-17T18:00:23Z", "pr_url": "https://github.com/HubSpot/jinjava/pull/480", "timeline": [{"oid": "887168f7e23451dc9ca6590a0f1a141b4446c5d6", "url": "https://github.com/HubSpot/jinjava/commit/887168f7e23451dc9ca6590a0f1a141b4446c5d6", "message": "Revert \"Revert \"Divide by zero\"\"", "committedDate": "2020-08-17T17:59:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY4NjgxNg==", "url": "https://github.com/HubSpot/jinjava/pull/480#discussion_r471686816", "bodyText": "@bszabo, we should be throwing an InvalidArgumentException here instead of IllegalArgumentException. Sorry for not catching that earlier.", "author": "boulter", "createdAt": "2020-08-17T18:30:32Z", "path": "src/main/java/com/hubspot/jinjava/el/ext/DivOperator.java", "diffHunk": "@@ -0,0 +1,43 @@\n+package com.hubspot.jinjava.el.ext;\n+\n+import de.odysseus.el.misc.TypeConverter;\n+import de.odysseus.el.tree.impl.Parser.ExtensionHandler;\n+import de.odysseus.el.tree.impl.Parser.ExtensionPoint;\n+import de.odysseus.el.tree.impl.Scanner;\n+import de.odysseus.el.tree.impl.ast.AstBinary;\n+import de.odysseus.el.tree.impl.ast.AstBinary.SimpleOperator;\n+import de.odysseus.el.tree.impl.ast.AstNode;\n+\n+/**\n+ * Created to allow for the detection and handling of divide-by-zero requests in EL expressions\n+ * (see PR 473 @ https://github.com/HubSpot/jinjava/pull/473)\n+ */\n+public class DivOperator extends SimpleOperator {\n+  public static final Scanner.ExtensionToken TOKEN = new Scanner.ExtensionToken(\"/\");\n+  public static final DivOperator OP = new DivOperator();\n+\n+  @Override\n+  protected Object apply(TypeConverter converter, Object a, Object b) {\n+    if (a == null || b == null) {\n+      throw new IllegalArgumentException(\"Division argument may not be null\");", "originalCommit": "887168f7e23451dc9ca6590a0f1a141b4446c5d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQwMDM0MA==", "url": "https://github.com/HubSpot/jinjava/pull/480#discussion_r472400340", "bodyText": "I've made the change both here and lower down in the file, where detection of a zero divisor occurs", "author": "bszabo", "createdAt": "2020-08-18T18:32:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY4NjgxNg=="}], "type": "inlineReview"}, {"oid": "a683d8a5686974bcac7076ae600d0fc0182b20e5", "url": "https://github.com/HubSpot/jinjava/commit/a683d8a5686974bcac7076ae600d0fc0182b20e5", "message": "DivOperator fails with InvalidArgumentException", "committedDate": "2020-08-18T18:25:37Z", "type": "commit"}, {"oid": "db9116079e44efcf3e5731828eef4d139a55df82", "url": "https://github.com/HubSpot/jinjava/commit/db9116079e44efcf3e5731828eef4d139a55df82", "message": "Co-opt ExpressionResolver for a better TemplateError diagnosis on divide-by-zero", "committedDate": "2020-08-19T14:54:32Z", "type": "commit"}, {"oid": "c28d074cb6a0cbd7c2a92772a44e3b1ec05b3395", "url": "https://github.com/HubSpot/jinjava/commit/c28d074cb6a0cbd7c2a92772a44e3b1ec05b3395", "message": "Throw custom exception to indicate divide by zero", "committedDate": "2020-08-19T16:44:57Z", "type": "commit"}, {"oid": "3119db0f7a6906ba1372f22c5ca47a3927a26e85", "url": "https://github.com/HubSpot/jinjava/commit/3119db0f7a6906ba1372f22c5ca47a3927a26e85", "message": "Remove superfluous String.format() call", "committedDate": "2020-08-19T17:20:07Z", "type": "commit"}]}