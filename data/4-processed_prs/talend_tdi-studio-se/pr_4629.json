{"pr_number": 4629, "pr_title": "Fix(TDI-30505): Do not log if no autocommit.", "pr_createdAt": "2020-04-20T14:03:49Z", "pr_url": "https://github.com/Talend/tdi-studio-se/pull/4629", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA2MTMwNQ==", "url": "https://github.com/Talend/tdi-studio-se/pull/4629#discussion_r412061305", "bodyText": "IMO it is good idea to put break here", "author": "dmytro-sylaiev", "createdAt": "2020-04-21T10:21:19Z", "path": "main/plugins/org.talend.designer.components.localprovider/components/tDB2Output/tDB2Output_end.javajet", "diffHunk": "@@ -30,6 +34,16 @@ imports=\"\n         IConnection rejectConn = rejectConns.get(0);\n         rejectConnName = rejectConn.getName();\n     }\n+\t\n+    String connection = ElementParameterParser.getValue(node,\"__CONNECTION__\");\n+    if(useExistingConn) {\n+        List<? extends INode> nodes = process.getNodesOfType(\"tDB2Connection\");\n+        for (INode ne:nodes) {\n+            if (connection.equals(ne.getUniqueName())) {\n+                setAutoCommit = \"true\".equals(ElementParameterParser.getValue(ne, \"__AUTO_COMMIT__\"));", "originalCommit": "42ae467c51c2e049b79de8b8c580d6e5613239d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE0NjQ5Ng==", "url": "https://github.com/Talend/tdi-studio-se/pull/4629#discussion_r412146496", "bodyText": "Added \"break\" line in all similar cycles.", "author": "dmytrogrygorenko", "createdAt": "2020-04-21T12:37:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA2MTMwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA2MTU1OA==", "url": "https://github.com/Talend/tdi-studio-se/pull/4629#discussion_r412061558", "bodyText": "indentation is broken", "author": "dmytro-sylaiev", "createdAt": "2020-04-21T10:21:44Z", "path": "main/plugins/org.talend.designer.components.localprovider/components/tEXAOutput/tEXAOutput_end.javajet", "diffHunk": "@@ -5,6 +5,7 @@ imports=\"\n     org.talend.core.model.process.INode\n     org.talend.core.model.process.ElementParameterParser\n     org.talend.core.model.process.IConnection\n+\torg.talend.core.model.process.IProcess", "originalCommit": "42ae467c51c2e049b79de8b8c580d6e5613239d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE0NzEwMQ==", "url": "https://github.com/Talend/tdi-studio-se/pull/4629#discussion_r412147101", "bodyText": "Fixed", "author": "dmytrogrygorenko", "createdAt": "2020-04-21T12:38:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA2MTU1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA2MjYzMA==", "url": "https://github.com/Talend/tdi-studio-se/pull/4629#discussion_r412062630", "bodyText": "Maybe need to remove extra %><% here", "author": "dmytro-sylaiev", "createdAt": "2020-04-21T10:23:18Z", "path": "main/plugins/org.talend.designer.components.localprovider/components/templates/DB/Output/DBOutputEndGlobalVars.javajet", "diffHunk": "@@ -47,21 +47,30 @@ imports=\"\n         globalMap.put(\"<%=cid %>_NB_LINE_DELETED\",nb_line_deleted_<%=cid%>);\n         globalMap.put(\"<%=cid %>_NB_LINE_REJECTED\", nb_line_rejected_<%=cid%>);\n     \n+    <%\n+    }\n+    %>\n+\n+\t<%\n+\tif(!useExistingConnection || (useExistingConnection && setAutoCommit)){\n+\t\t%>\n+\t\t<%", "originalCommit": "42ae467c51c2e049b79de8b8c580d6e5613239d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE0NzMzNg==", "url": "https://github.com/Talend/tdi-studio-se/pull/4629#discussion_r412147336", "bodyText": "Removed extra %><%", "author": "dmytrogrygorenko", "createdAt": "2020-04-21T12:38:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA2MjYzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA2Mjc3MQ==", "url": "https://github.com/Talend/tdi-studio-se/pull/4629#discussion_r412062771", "bodyText": "and here also", "author": "dmytro-sylaiev", "createdAt": "2020-04-21T10:23:31Z", "path": "main/plugins/org.talend.designer.components.localprovider/components/templates/DB/Output/DBOutputEndGlobalVars.javajet", "diffHunk": "@@ -47,21 +47,30 @@ imports=\"\n         globalMap.put(\"<%=cid %>_NB_LINE_DELETED\",nb_line_deleted_<%=cid%>);\n         globalMap.put(\"<%=cid %>_NB_LINE_REJECTED\", nb_line_rejected_<%=cid%>);\n     \n+    <%\n+    }\n+    %>\n+\n+\t<%\n+\tif(!useExistingConnection || (useExistingConnection && setAutoCommit)){\n+\t\t%>\n+\t\t<%\n+\t\tif ((\"INSERT\").equals(dataAction)) {\n+\t\t\tdbLog.state().logInsertedLines(dbLog.var(\"nb_line_inserted\"));\n+\t\t}else if ((\"UPDATE\").equals(dataAction)) {\n+\t\t\tdbLog.state().logUpdatedLines(dbLog.var(\"nb_line_update\"));\n+\t\t}else if ((\"DELETE\").equals(dataAction)) {\n+\t\t\tdbLog.state().logDeletedLines(dbLog.var(\"nb_line_deleted\"));\n+\t\t}else if(\"UPDATE_OR_INSERT\".equals(dataAction)){\n+\t\t\tdbLog.state().logUpdatedLines(dbLog.var(\"nb_line_update\"));\n+\t\t\tdbLog.state().logInsertedLines(dbLog.var(\"nb_line_inserted\"));\n+\t\t}else if(\"INSERT_OR_UPDATE\".equals(dataAction)){\n+\t\t\tdbLog.state().logInsertedLines(dbLog.var(\"nb_line_inserted\"));\n+\t\t\tdbLog.state().logUpdatedLines(dbLog.var(\"nb_line_update\"));\n+\t\t}%>\n+\t<%", "originalCommit": "42ae467c51c2e049b79de8b8c580d6e5613239d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE0NzQ5OQ==", "url": "https://github.com/Talend/tdi-studio-se/pull/4629#discussion_r412147499", "bodyText": "Removed extra %><%", "author": "dmytrogrygorenko", "createdAt": "2020-04-21T12:38:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA2Mjc3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA2Mjg1OA==", "url": "https://github.com/Talend/tdi-studio-se/pull/4629#discussion_r412062858", "bodyText": "and here", "author": "dmytro-sylaiev", "createdAt": "2020-04-21T10:23:41Z", "path": "main/plugins/org.talend.designer.components.localprovider/components/templates/DB/Output/DBOutputEndGlobalVars.javajet", "diffHunk": "@@ -47,21 +47,30 @@ imports=\"\n         globalMap.put(\"<%=cid %>_NB_LINE_DELETED\",nb_line_deleted_<%=cid%>);\n         globalMap.put(\"<%=cid %>_NB_LINE_REJECTED\", nb_line_rejected_<%=cid%>);\n     \n+    <%\n+    }\n+    %>\n+\n+\t<%\n+\tif(!useExistingConnection || (useExistingConnection && setAutoCommit)){\n+\t\t%>\n+\t\t<%\n+\t\tif ((\"INSERT\").equals(dataAction)) {\n+\t\t\tdbLog.state().logInsertedLines(dbLog.var(\"nb_line_inserted\"));\n+\t\t}else if ((\"UPDATE\").equals(dataAction)) {\n+\t\t\tdbLog.state().logUpdatedLines(dbLog.var(\"nb_line_update\"));\n+\t\t}else if ((\"DELETE\").equals(dataAction)) {\n+\t\t\tdbLog.state().logDeletedLines(dbLog.var(\"nb_line_deleted\"));\n+\t\t}else if(\"UPDATE_OR_INSERT\".equals(dataAction)){\n+\t\t\tdbLog.state().logUpdatedLines(dbLog.var(\"nb_line_update\"));\n+\t\t\tdbLog.state().logInsertedLines(dbLog.var(\"nb_line_inserted\"));\n+\t\t}else if(\"INSERT_OR_UPDATE\".equals(dataAction)){\n+\t\t\tdbLog.state().logInsertedLines(dbLog.var(\"nb_line_inserted\"));\n+\t\t\tdbLog.state().logUpdatedLines(dbLog.var(\"nb_line_update\"));\n+\t\t}%>\n+\t<%\n+\t}%>\n \t<%", "originalCommit": "42ae467c51c2e049b79de8b8c580d6e5613239d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE0NzYyMQ==", "url": "https://github.com/Talend/tdi-studio-se/pull/4629#discussion_r412147621", "bodyText": "Removed extra %><%", "author": "dmytrogrygorenko", "createdAt": "2020-04-21T12:39:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA2Mjg1OA=="}], "type": "inlineReview"}, {"oid": "3314cbb73fa2dd3818416a0a0e829534ce96abcb", "url": "https://github.com/Talend/tdi-studio-se/commit/3314cbb73fa2dd3818416a0a0e829534ce96abcb", "message": "Fix(TDI-30505): Typo fixed.", "committedDate": "2020-04-27T08:49:23Z", "type": "forcePushed"}, {"oid": "e6c62ea082cecf78a9cb7869242d819f0609e425", "url": "https://github.com/Talend/tdi-studio-se/commit/e6c62ea082cecf78a9cb7869242d819f0609e425", "message": "Fix(TDI-30505): Some more corrections", "committedDate": "2020-05-05T05:02:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQzNjE1MA==", "url": "https://github.com/Talend/tdi-studio-se/pull/4629#discussion_r428436150", "bodyText": "LGTM, some other about the jira:\nif we remove the log for commit, it will never appear if not auto commit, yes, is expected, but some customer may don't like it.", "author": "wwang-talend", "createdAt": "2020-05-21T04:17:29Z", "path": "main/plugins/org.talend.designer.components.localprovider/components/templates/DB/Output/DBOutputEndGlobalVars.javajet", "diffHunk": "@@ -47,20 +47,25 @@ imports=\"\n         globalMap.put(\"<%=cid %>_NB_LINE_DELETED\",nb_line_deleted_<%=cid%>);\n         globalMap.put(\"<%=cid %>_NB_LINE_REJECTED\", nb_line_rejected_<%=cid%>);\n     \n+    <%\n+    }\n+    %>\n+\n \t<%\n-\t}", "originalCommit": "e6c62ea082cecf78a9cb7869242d819f0609e425", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "137ef2b282d21e509a9de6a229cd87266acf01a8", "url": "https://github.com/Talend/tdi-studio-se/commit/137ef2b282d21e509a9de6a229cd87266acf01a8", "message": "Fix(TDI-30505): Do not log if no autocommit.", "committedDate": "2020-05-21T15:43:52Z", "type": "commit"}, {"oid": "f7f43419c3cf079dc9732b14579d385a1f634917", "url": "https://github.com/Talend/tdi-studio-se/commit/f7f43419c3cf079dc9732b14579d385a1f634917", "message": "Fix(TDI-30505): Change by request of code reviewer", "committedDate": "2020-05-21T15:43:53Z", "type": "commit"}, {"oid": "369955dd008c0333b9d379b4f9092bb1c5737528", "url": "https://github.com/Talend/tdi-studio-se/commit/369955dd008c0333b9d379b4f9092bb1c5737528", "message": "Fix(TDI-30505): Missed comps added, var name fixed", "committedDate": "2020-05-21T15:43:53Z", "type": "commit"}, {"oid": "03efa9c79d1a7f4eef3aebafc9f1518159ab5446", "url": "https://github.com/Talend/tdi-studio-se/commit/03efa9c79d1a7f4eef3aebafc9f1518159ab5446", "message": "Fix(TDI-30505): Typo fixed.", "committedDate": "2020-05-21T15:43:54Z", "type": "commit"}, {"oid": "c71e7a7f49a3ca21e4104a7c4d17a587a9c98749", "url": "https://github.com/Talend/tdi-studio-se/commit/c71e7a7f49a3ca21e4104a7c4d17a587a9c98749", "message": "Fix(TDI-30505): Some more corrections", "committedDate": "2020-05-21T15:43:54Z", "type": "commit"}, {"oid": "c71e7a7f49a3ca21e4104a7c4d17a587a9c98749", "url": "https://github.com/Talend/tdi-studio-se/commit/c71e7a7f49a3ca21e4104a7c4d17a587a9c98749", "message": "Fix(TDI-30505): Some more corrections", "committedDate": "2020-05-21T15:43:54Z", "type": "forcePushed"}]}