{"pr_number": 4611, "pr_title": "fix(TDI-43995): Support listing any path and file", "pr_createdAt": "2020-04-10T07:50:18Z", "pr_url": "https://github.com/Talend/tdi-studio-se/pull/4611", "timeline": [{"oid": "568684118ae37c0f452fe00276beab7136211da7", "url": "https://github.com/Talend/tdi-studio-se/commit/568684118ae37c0f452fe00276beab7136211da7", "message": "fix(TDI-43995): Support listing any path and file", "committedDate": "2020-04-10T06:54:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjcyMjYzNw==", "url": "https://github.com/Talend/tdi-studio-se/pull/4611#discussion_r406722637", "bodyText": "is there a chance to use lang3 package.\nsimple lang is outdated please refer to https://mvnrepository.com/artifact/commons-lang/commons-lang", "author": "mbasiuk-talend", "createdAt": "2020-04-10T11:46:25Z", "path": "main/plugins/org.talend.designer.components.localprovider/components/tBoxList/tBoxList_begin.javajet", "diffHunk": "@@ -105,115 +105,79 @@ if(!\"true\".equals(useExistingConn)){\n     <%=cid%>_client.authenticate(new com.box.boxjavalibv2.dao.BoxOAuthToken(<%=cid%>_map));\n }\n <%\n-\t} else {\n+} else {\n %>\n \tcom.box.boxjavalibv2.BoxClient <%=cid%>_client = (com.box.boxjavalibv2.BoxClient)globalMap.get(<%=connectionKey%>);\n <%\n }\n %>\n \tString <%=cid%>_path = normalizePath(<%=path%>);\n-\tboolean <%=cid%>_hasError = false;\n-\tString <%=cid%>_name = getFolderFromPath(<%=cid%>_path);\n-\tcom.box.boxjavalibv2.dao.BoxFile <%=cid%>_boxFile = null;\n-\tcom.box.boxjavalibv2.dao.BoxFolder <%=cid%>_boxFolder = null;\n-\tif ((<%=cid%>_name.equals(\"All Files\") && (<%=cid%>_path.isEmpty() || <%=cid%>_path == null)))\n-\t{\n-\t\t<%=cid%>_boxFolder = <%=cid%>_client.getFoldersManager().getFolder(\"0\",null);\t\n-\t}\n-\telse\n-\t{\n-\t\tcom.box.restclientv2.requestsbase.BoxDefaultRequestObject <%=cid%>_requestObject = new com.box.restclientv2.requestsbase.BoxDefaultRequestObject();\n-\t\t\tif (<%=cid%>_name.equals(\"All Files\") || <%=cid%>_path.equals(\"All Files\"))\n-\t\t\t{\n-\t\t\t\t<%=cid%>_boxFolder = <%=cid%>_client.getFoldersManager().getFolder(\"0\", null);\n-\t\t\t}\n-\t\t\telse\n-\t\t\t{\n-                String parentPath = normalizePath(<%=cid%>_path.replace(<%=cid%>_name, \"\"));\n-                \n-                <%=cid%>_boxFolder = <%=cid%>_client.getFoldersManager().getFolder(\"0\", <%=cid%>_requestObject);\n-                \n-                if (\"All Files\".equals(parentPath)) {\n-                    \n-                    for (com.box.boxjavalibv2.dao.BoxTypedObject <%=cid%>_boxTypedObject : <%=cid%>_boxFolder.getItemCollection().getEntries()) {\n-                        if (<%=cid%>_boxTypedObject.getValue(\"name\").equals(<%=cid%>_name)) {\n-                            if (\"folder\".equals(<%=cid%>_boxTypedObject.getType())) {\n-                                <%=cid%>_boxFolder = <%=cid%>_client.getFoldersManager().getFolder(<%=cid%>_boxTypedObject.getId(), <%=cid%>_requestObject);\n-                            } else {\n-                                <%=cid%>_boxFile = <%=cid%>_client.getFilesManager().getFile(<%=cid%>_boxTypedObject.getId(),<%=cid%>_requestObject);\n-                            }\n-                        }\n-                    }\n-\n-                } else {\n-\n-                    List<String> <%=cid%>_paths = new java.util.ArrayList<String>(java.util.Arrays.asList(parentPath.split(\"/\")));\n+\tcom.box.boxjavalibv2.dao.BoxFolder <%=cid%>_rootFolder = <%=cid%>_client.getFoldersManager().getFolder(\"0\", null);\n+\tcom.box.boxjavalibv2.dao.BoxItem <%=cid%>_boxItem;\n \n-                    <%=cid%>_boxFolder = getBoxFolderRecursively(<%=cid%>_paths, <%=cid%>_boxFolder, <%=cid%>_client);\n-                }\n-\t\t\t}\n+\tif (org.apache.commons.lang.StringUtils.substringBefore(<%=cid%>_path, \"/\").equals(\"All Files\")) {", "originalCommit": "568684118ae37c0f452fe00276beab7136211da7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjcyNDEyMQ==", "url": "https://github.com/Talend/tdi-studio-se/pull/4611#discussion_r406724121", "bodyText": "you can omit value in second diamond (<>), just to simplify the code.", "author": "mbasiuk-talend", "createdAt": "2020-04-10T11:51:35Z", "path": "main/plugins/org.talend.designer.components.localprovider/components/tBoxList/tBoxList_begin.javajet", "diffHunk": "@@ -105,115 +105,79 @@ if(!\"true\".equals(useExistingConn)){\n     <%=cid%>_client.authenticate(new com.box.boxjavalibv2.dao.BoxOAuthToken(<%=cid%>_map));\n }\n <%\n-\t} else {\n+} else {\n %>\n \tcom.box.boxjavalibv2.BoxClient <%=cid%>_client = (com.box.boxjavalibv2.BoxClient)globalMap.get(<%=connectionKey%>);\n <%\n }\n %>\n \tString <%=cid%>_path = normalizePath(<%=path%>);\n-\tboolean <%=cid%>_hasError = false;\n-\tString <%=cid%>_name = getFolderFromPath(<%=cid%>_path);\n-\tcom.box.boxjavalibv2.dao.BoxFile <%=cid%>_boxFile = null;\n-\tcom.box.boxjavalibv2.dao.BoxFolder <%=cid%>_boxFolder = null;\n-\tif ((<%=cid%>_name.equals(\"All Files\") && (<%=cid%>_path.isEmpty() || <%=cid%>_path == null)))\n-\t{\n-\t\t<%=cid%>_boxFolder = <%=cid%>_client.getFoldersManager().getFolder(\"0\",null);\t\n-\t}\n-\telse\n-\t{\n-\t\tcom.box.restclientv2.requestsbase.BoxDefaultRequestObject <%=cid%>_requestObject = new com.box.restclientv2.requestsbase.BoxDefaultRequestObject();\n-\t\t\tif (<%=cid%>_name.equals(\"All Files\") || <%=cid%>_path.equals(\"All Files\"))\n-\t\t\t{\n-\t\t\t\t<%=cid%>_boxFolder = <%=cid%>_client.getFoldersManager().getFolder(\"0\", null);\n-\t\t\t}\n-\t\t\telse\n-\t\t\t{\n-                String parentPath = normalizePath(<%=cid%>_path.replace(<%=cid%>_name, \"\"));\n-                \n-                <%=cid%>_boxFolder = <%=cid%>_client.getFoldersManager().getFolder(\"0\", <%=cid%>_requestObject);\n-                \n-                if (\"All Files\".equals(parentPath)) {\n-                    \n-                    for (com.box.boxjavalibv2.dao.BoxTypedObject <%=cid%>_boxTypedObject : <%=cid%>_boxFolder.getItemCollection().getEntries()) {\n-                        if (<%=cid%>_boxTypedObject.getValue(\"name\").equals(<%=cid%>_name)) {\n-                            if (\"folder\".equals(<%=cid%>_boxTypedObject.getType())) {\n-                                <%=cid%>_boxFolder = <%=cid%>_client.getFoldersManager().getFolder(<%=cid%>_boxTypedObject.getId(), <%=cid%>_requestObject);\n-                            } else {\n-                                <%=cid%>_boxFile = <%=cid%>_client.getFilesManager().getFile(<%=cid%>_boxTypedObject.getId(),<%=cid%>_requestObject);\n-                            }\n-                        }\n-                    }\n-\n-                } else {\n-\n-                    List<String> <%=cid%>_paths = new java.util.ArrayList<String>(java.util.Arrays.asList(parentPath.split(\"/\")));\n+\tcom.box.boxjavalibv2.dao.BoxFolder <%=cid%>_rootFolder = <%=cid%>_client.getFoldersManager().getFolder(\"0\", null);\n+\tcom.box.boxjavalibv2.dao.BoxItem <%=cid%>_boxItem;\n \n-                    <%=cid%>_boxFolder = getBoxFolderRecursively(<%=cid%>_paths, <%=cid%>_boxFolder, <%=cid%>_client);\n-                }\n-\t\t\t}\n+\tif (org.apache.commons.lang.StringUtils.substringBefore(<%=cid%>_path, \"/\").equals(\"All Files\")) {\n+\t\tList<String> <%=cid%>_pathItems = new java.util.ArrayList<String>(java.util.Arrays.asList(<%=cid%>_path.split(\"/\")));\n+\t\t<%=cid%>_pathItems.remove(0);\n+\t\ttry {\n+\t\t\t<%=cid%>_boxItem = getBoxItemRecursively(<%=cid%>_pathItems, <%=cid%>_rootFolder, <%=cid%>_client);\n+\t\t} catch (Exception e) {\n+\t\t\tthrow new Exception(\"<%=cid%> - \" + \"The path to file or directory was not found in \" + <%=cid%>_path, e);\n+\t\t}\n+\t} else {\n+\t\tthrow new Exception(\"<%=cid%> - \" + \"The path to file or directory was not found in \" + <%=cid%>_path);\n \t}\n \n-\tif (<%=cid%>_boxFile == null && <%=cid%>_boxFolder == null)\n-\t{\n-\t\tthrow new Exception(\"<%=cid%> - \" + \"No file or directory found in \" + <%=path%>);\n-\t}\n-\telse if (<%=cid%>_boxFolder != null)\n-\t{\n-\t\tjava.util.List<com.box.boxjavalibv2.dao.BoxItem>  <%=cid%>_children = new java.util.ArrayList<com.box.boxjavalibv2.dao.BoxItem>();\n-<%if(includeSubDirectories){%>\n-\t<%if(filelistType.equalsIgnoreCase(\"Directories\")){%>\n-\t\t<%=cid%>_children = getChildrenRecursively(<%=cid%>_client, <%=cid%>_boxFolder, <%=cid%>_children, true, false);\n-\t<%} else if (filelistType.equalsIgnoreCase(\"Files\")){%>\t\t\n-\t\t<%=cid%>_children = getChildrenRecursively(<%=cid%>_client, <%=cid%>_boxFolder, <%=cid%>_children, false, true);\n-\t<%} else {%>\n-\t\t<%=cid%>_children = getChildrenRecursively(<%=cid%>_client, <%=cid%>_boxFolder, <%=cid%>_children, true, true);\n-\t<%}%>\n-<%}%>\n-<%else{%>\n-\t\tfor (com.box.boxjavalibv2.dao.BoxTypedObject obj : <%=cid%>_boxFolder.getItemCollection().getEntries())\n-\t\t{\n-\t<%if(filelistType.equalsIgnoreCase(\"Directories\")){%>\n-\t\t\tif(obj.getType().equals(\"folder\"))\n+\tjava.util.List<com.box.boxjavalibv2.dao.BoxItem>  <%=cid%>_items = new java.util.ArrayList<com.box.boxjavalibv2.dao.BoxItem>();", "originalCommit": "568684118ae37c0f452fe00276beab7136211da7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjczMTAzNA==", "url": "https://github.com/Talend/tdi-studio-se/pull/4611#discussion_r406731034", "bodyText": "What if root folder was specified incorrectly?", "author": "mbasiuk-talend", "createdAt": "2020-04-10T12:13:24Z", "path": "main/plugins/org.talend.designer.components.localprovider/components/tBoxList/tBoxList_begin.javajet", "diffHunk": "@@ -105,115 +105,79 @@ if(!\"true\".equals(useExistingConn)){\n     <%=cid%>_client.authenticate(new com.box.boxjavalibv2.dao.BoxOAuthToken(<%=cid%>_map));\n }\n <%\n-\t} else {\n+} else {\n %>\n \tcom.box.boxjavalibv2.BoxClient <%=cid%>_client = (com.box.boxjavalibv2.BoxClient)globalMap.get(<%=connectionKey%>);\n <%\n }\n %>\n \tString <%=cid%>_path = normalizePath(<%=path%>);\n-\tboolean <%=cid%>_hasError = false;\n-\tString <%=cid%>_name = getFolderFromPath(<%=cid%>_path);\n-\tcom.box.boxjavalibv2.dao.BoxFile <%=cid%>_boxFile = null;\n-\tcom.box.boxjavalibv2.dao.BoxFolder <%=cid%>_boxFolder = null;\n-\tif ((<%=cid%>_name.equals(\"All Files\") && (<%=cid%>_path.isEmpty() || <%=cid%>_path == null)))\n-\t{\n-\t\t<%=cid%>_boxFolder = <%=cid%>_client.getFoldersManager().getFolder(\"0\",null);\t\n-\t}\n-\telse\n-\t{\n-\t\tcom.box.restclientv2.requestsbase.BoxDefaultRequestObject <%=cid%>_requestObject = new com.box.restclientv2.requestsbase.BoxDefaultRequestObject();\n-\t\t\tif (<%=cid%>_name.equals(\"All Files\") || <%=cid%>_path.equals(\"All Files\"))\n-\t\t\t{\n-\t\t\t\t<%=cid%>_boxFolder = <%=cid%>_client.getFoldersManager().getFolder(\"0\", null);\n-\t\t\t}\n-\t\t\telse\n-\t\t\t{\n-                String parentPath = normalizePath(<%=cid%>_path.replace(<%=cid%>_name, \"\"));\n-                \n-                <%=cid%>_boxFolder = <%=cid%>_client.getFoldersManager().getFolder(\"0\", <%=cid%>_requestObject);\n-                \n-                if (\"All Files\".equals(parentPath)) {\n-                    \n-                    for (com.box.boxjavalibv2.dao.BoxTypedObject <%=cid%>_boxTypedObject : <%=cid%>_boxFolder.getItemCollection().getEntries()) {\n-                        if (<%=cid%>_boxTypedObject.getValue(\"name\").equals(<%=cid%>_name)) {\n-                            if (\"folder\".equals(<%=cid%>_boxTypedObject.getType())) {\n-                                <%=cid%>_boxFolder = <%=cid%>_client.getFoldersManager().getFolder(<%=cid%>_boxTypedObject.getId(), <%=cid%>_requestObject);\n-                            } else {\n-                                <%=cid%>_boxFile = <%=cid%>_client.getFilesManager().getFile(<%=cid%>_boxTypedObject.getId(),<%=cid%>_requestObject);\n-                            }\n-                        }\n-                    }\n-\n-                } else {\n-\n-                    List<String> <%=cid%>_paths = new java.util.ArrayList<String>(java.util.Arrays.asList(parentPath.split(\"/\")));\n+\tcom.box.boxjavalibv2.dao.BoxFolder <%=cid%>_rootFolder = <%=cid%>_client.getFoldersManager().getFolder(\"0\", null);\n+\tcom.box.boxjavalibv2.dao.BoxItem <%=cid%>_boxItem;\n \n-                    <%=cid%>_boxFolder = getBoxFolderRecursively(<%=cid%>_paths, <%=cid%>_boxFolder, <%=cid%>_client);\n-                }\n-\t\t\t}\n+\tif (org.apache.commons.lang.StringUtils.substringBefore(<%=cid%>_path, \"/\").equals(\"All Files\")) {\n+\t\tList<String> <%=cid%>_pathItems = new java.util.ArrayList<String>(java.util.Arrays.asList(<%=cid%>_path.split(\"/\")));\n+\t\t<%=cid%>_pathItems.remove(0);", "originalCommit": "568684118ae37c0f452fe00276beab7136211da7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjczMTM3Mg==", "url": "https://github.com/Talend/tdi-studio-se/pull/4611#discussion_r406731372", "bodyText": "/root/someFolder   vs /usr/someFolder ?\nFirst element is removed from list, and someFolder == someFolder ?", "author": "mbasiuk-talend", "createdAt": "2020-04-10T12:14:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjczMTAzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc0NDk3MQ==", "url": "https://github.com/Talend/tdi-studio-se/pull/4611#discussion_r406744971", "bodyText": "As i understand the root folder at remote Box storage is \"All Files\". Root folder creates by default and I didn't found way to change it name. So root folder always \"All Files\". I check name of root folder at 118 row and if user specify another name for root folder an exception will be thrown.", "author": "OleksiiNimych", "createdAt": "2020-04-10T12:55:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjczMTAzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjczMjQ1NA==", "url": "https://github.com/Talend/tdi-studio-se/pull/4611#discussion_r406732454", "bodyText": "it's hard to catch were it's missing. Be very careful.", "author": "mbasiuk-talend", "createdAt": "2020-04-10T12:18:03Z", "path": "main/plugins/org.talend.designer.components.localprovider/components/tBoxList/tBoxList_end.javajet", "diffHunk": "@@ -16,7 +16,6 @@\n %>\n     }\n \t\t\n-}", "originalCommit": "568684118ae37c0f452fe00276beab7136211da7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc0NjYzNg==", "url": "https://github.com/Talend/tdi-studio-se/pull/4611#discussion_r406746636", "bodyText": "This is a closing bracket of else if condition at https://github.com/Talend/tdi-studio-se/blob/master/main/plugins/org.talend.designer.components.localprovider/components/tBoxList/tBoxList_begin.javajet#L161-L162", "author": "OleksiiNimych", "createdAt": "2020-04-10T13:00:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjczMjQ1NA=="}], "type": "inlineReview"}, {"oid": "d5a5625c0c5f0ce20c6a936fe164eda73b418c46", "url": "https://github.com/Talend/tdi-studio-se/commit/d5a5625c0c5f0ce20c6a936fe164eda73b418c46", "message": "fix(TDI-43995): Updated Apache Commons Lang library and added diamond operator", "committedDate": "2020-04-10T13:20:47Z", "type": "commit"}, {"oid": "195eca0bed5a170ab45e5be9299c16c1aee733a9", "url": "https://github.com/Talend/tdi-studio-se/commit/195eca0bed5a170ab45e5be9299c16c1aee733a9", "message": "fix(TDI-43995): Remove Apache Commons Lang library", "committedDate": "2020-04-10T15:07:38Z", "type": "commit"}]}