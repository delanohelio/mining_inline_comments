{"pr_number": 4714, "pr_title": "fix(TDI-44174): Component manager is not thread safe", "pr_createdAt": "2020-05-20T12:52:08Z", "pr_url": "https://github.com/Talend/tdi-studio-se/pull/4714", "timeline": [{"oid": "563347a7055c06d99a9d8750ac0e6f684594d177", "url": "https://github.com/Talend/tdi-studio-se/commit/563347a7055c06d99a9d8750ac0e6f684594d177", "message": "fix(TDI-44174): Component manager is not thread safe\n\n- this fixes the case when run as independent job is checked and the\n  m2.repository automatically defaults to user's m2 in exported job.\n- issue on singleton will be fix by component-runtime upgrade.", "committedDate": "2020-05-20T12:51:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0NjQ3MQ==", "url": "https://github.com/Talend/tdi-studio-se/pull/4714#discussion_r430246471", "bodyText": "Should ensure this system property exists before use it\nString m2Repo = System.getProperty(\"...\"); if (m2Repo != null) ...", "author": "clesaec", "createdAt": "2020-05-26T08:35:46Z", "path": "main/plugins/org.talend.designer.components.localprovider/components/tRunJob/tRunJob_main.javajet", "diffHunk": "@@ -246,6 +246,7 @@ String inputConnName = null;\n \t    \t\t\t}\n \t\t  \t\t}\n \t\t  \t\t%>\n+\t\t  \t\tparaList_<%=cid %>.add(\"-Dtalend.component.manager.m2.repository=\" + System.getProperty(\"talend.component.manager.m2.repository\"));", "originalCommit": "563347a7055c06d99a9d8750ac0e6f684594d177", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDMxNDUxMw==", "url": "https://github.com/Talend/tdi-studio-se/pull/4714#discussion_r430314513", "bodyText": "Not in that case because during generation the property will always be null.\nRemember, that's javajet for code generation.", "author": "undx", "createdAt": "2020-05-26T10:32:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0NjQ3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDMzODU1Nw==", "url": "https://github.com/Talend/tdi-studio-se/pull/4714#discussion_r430338557", "bodyText": "Yes, javajet should generate the code that control existence of variable before getting it :\nso generated code become :\nString m2Repo = System.getProperty(\"...\"); \nif (m2Repo != null) {\n    paraList_xyz.add(\"-Dtalen...\", m2Repo);\n}", "author": "clesaec", "createdAt": "2020-05-26T11:20:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0NjQ3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM1NjkxMQ==", "url": "https://github.com/Talend/tdi-studio-se/pull/4714#discussion_r430356911", "bodyText": "It won't work as said previously...\n\nthe property will always be null.", "author": "undx", "createdAt": "2020-05-26T11:57:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0NjQ3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM1OTIyMA==", "url": "https://github.com/Talend/tdi-studio-se/pull/4714#discussion_r430359220", "bodyText": "hum, you mean where?  in javajet or template?\nSorry, maybe misunderstood your arguments..", "author": "undx", "createdAt": "2020-05-26T12:01:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0NjQ3MQ=="}], "type": "inlineReview"}, {"oid": "c4cfb3b33efa36ec2a5c9e3fc20503e22bc9745a", "url": "https://github.com/Talend/tdi-studio-se/commit/c4cfb3b33efa36ec2a5c9e3fc20503e22bc9745a", "message": "fix(TDI-44174): relocate correctly the property", "committedDate": "2020-05-26T10:31:09Z", "type": "commit"}, {"oid": "8295ccb685cb7d8f09bd34fb972f33f2963c2859", "url": "https://github.com/Talend/tdi-studio-se/commit/8295ccb685cb7d8f09bd34fb972f33f2963c2859", "message": "fix(TDI-44174): pr comment fix", "committedDate": "2020-05-26T12:06:01Z", "type": "commit"}, {"oid": "29e59829012a892a5d3692d9aa3475ab449cfdf1", "url": "https://github.com/Talend/tdi-studio-se/commit/29e59829012a892a5d3692d9aa3475ab449cfdf1", "message": "fix(TDI-44174): formatting", "committedDate": "2020-05-26T12:08:27Z", "type": "commit"}]}