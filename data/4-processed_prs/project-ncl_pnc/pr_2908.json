{"pr_number": 2908, "pr_title": "[NCL-5558] Respond with 403 status when Brew Push is forbidden becaus\u2026", "pr_createdAt": "2020-03-11T09:46:40Z", "pr_url": "https://github.com/project-ncl/pnc/pull/2908", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg4OTQ1OA==", "url": "https://github.com/project-ncl/pnc/pull/2908#discussion_r390889458", "bodyText": "Why is this needed?", "author": "janinko", "createdAt": "2020-03-11T10:54:17Z", "path": "facade/pom.xml", "diffHunk": "@@ -139,6 +139,11 @@\n             <artifactId>hibernate-core</artifactId>\n             <scope>provided</scope>\n         </dependency>\n+        <dependency>\n+            <groupId>org.jboss.resteasy</groupId>\n+            <artifactId>resteasy-jaxrs</artifactId>\n+            <scope>provided</scope>\n+        </dependency>", "originalCommit": "bf0c576c1120adb1b0fd991bd67c1cfe33c4f49c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg5MjgxMw==", "url": "https://github.com/project-ncl/pnc/pull/2908#discussion_r390892813", "bodyText": "ClientErrorException", "author": "jomrazek", "createdAt": "2020-03-11T11:00:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg4OTQ1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDk1MzY3MQ==", "url": "https://github.com/project-ncl/pnc/pull/2908#discussion_r390953671", "bodyText": "Maybe throw different exception. Wrap it in the rest-new module or write exception mapper?", "author": "michalovjan", "createdAt": "2020-03-11T13:03:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg4OTQ1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU4ODMwMA==", "url": "https://github.com/project-ncl/pnc/pull/2908#discussion_r391588300", "bodyText": "ClientErrorException should be in some javax.ws module (rs-api?)", "author": "janinko", "createdAt": "2020-03-12T12:31:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg4OTQ1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU5MTEyNA==", "url": "https://github.com/project-ncl/pnc/pull/2908#discussion_r391591124", "bodyText": "any new dependency is completely removed in most recent version of PR", "author": "jomrazek", "createdAt": "2020-03-12T12:36:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg4OTQ1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA5NTAxMw==", "url": "https://github.com/project-ncl/pnc/pull/2908#discussion_r392095013", "bodyText": "@janinko WDYT? I am fine, with the changes.", "author": "michalovjan", "createdAt": "2020-03-13T08:45:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg4OTQ1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg5MDI5MA==", "url": "https://github.com/project-ncl/pnc/pull/2908#discussion_r390890290", "bodyText": "use the pushedResponse.get(0) before this if and everything will be much simpler.", "author": "janinko", "createdAt": "2020-03-11T10:55:54Z", "path": "facade/src/main/java/org/jboss/pnc/facade/impl/BrewPusherImpl.java", "diffHunk": "@@ -121,6 +119,10 @@ public BuildPushResult brewPush(String id, BuildPushRequest buildPushRequest) th\n                                 .build())\n                 .collect(Collectors.toList());\n \n+        if (pushed.stream().anyMatch(r -> r.getMessage().contains(\"BLACKLISTED/DELETED\"))) {", "originalCommit": "bf0c576c1120adb1b0fd991bd67c1cfe33c4f49c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg5MDkzNA==", "url": "https://github.com/project-ncl/pnc/pull/2908#discussion_r390890934", "bodyText": "the schema is actually BuildPushResultPage", "author": "janinko", "createdAt": "2020-03-11T10:57:07Z", "path": "rest-api/src/main/java/org/jboss/pnc/rest/api/endpoints/BuildEndpoint.java", "diffHunk": "@@ -328,6 +330,10 @@ void removeAttribute(\n                             responseCode = INVALID_CODE,\n                             description = INVALID_DESCRIPTION,\n                             content = @Content(schema = @Schema(implementation = ErrorResponse.class))),\n+                    @ApiResponse(\n+                            responseCode = FORBIDDEN_CODE,\n+                            description = FORBIDDEN_PUSH_DESCRIPTION,\n+                            content = @Content(schema = @Schema(implementation = ErrorResponse.class))),", "originalCommit": "bf0c576c1120adb1b0fd991bd67c1cfe33c4f49c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "08a06a606691c92e42086c76abf09d6b499232cb", "url": "https://github.com/project-ncl/pnc/commit/08a06a606691c92e42086c76abf09d6b499232cb", "message": "[NCL-5558] Respond with 403 status when Brew Push is forbidden because of bad artifact quality", "committedDate": "2020-03-11T12:23:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDk0NzY4MA==", "url": "https://github.com/project-ncl/pnc/pull/2908#discussion_r390947680", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static final String FORBIDDEN_PUSH_DESCRIPTION = \"Build contains artifacts of of insufficient quality\";\n          \n          \n            \n                public static final String FORBIDDEN_PUSH_DESCRIPTION = \"Build contains artifacts of insufficient quality\";", "author": "michalovjan", "createdAt": "2020-03-11T12:51:42Z", "path": "rest-api/src/main/java/org/jboss/pnc/rest/configuration/SwaggerConstants.java", "diffHunk": "@@ -42,6 +42,7 @@\n     public static final String INVALID_CODE = \"400\";\n     public static final String FORBIDDEN_DESCRIPTION = \"User must be logged in.\";\n     public static final String FORBIDDEN_CODE = \"403\";\n+    public static final String FORBIDDEN_PUSH_DESCRIPTION = \"Build contains artifacts of of insufficient quality\";", "originalCommit": "08a06a606691c92e42086c76abf09d6b499232cb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDk3MjY5OQ==", "url": "https://github.com/project-ncl/pnc/pull/2908#discussion_r390972699", "bodyText": "eagle eye!", "author": "jomrazek", "createdAt": "2020-03-11T13:34:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDk0NzY4MA=="}], "type": "inlineReview"}, {"oid": "f5ce2a8f7a35ca026124968e2412d8bf7da54970", "url": "https://github.com/project-ncl/pnc/commit/f5ce2a8f7a35ca026124968e2412d8bf7da54970", "message": "[NCL-5558] Respond with 403 status when Brew Push is forbidden because of bad artifact quality", "committedDate": "2020-03-11T16:16:28Z", "type": "commit"}, {"oid": "f5ce2a8f7a35ca026124968e2412d8bf7da54970", "url": "https://github.com/project-ncl/pnc/commit/f5ce2a8f7a35ca026124968e2412d8bf7da54970", "message": "[NCL-5558] Respond with 403 status when Brew Push is forbidden because of bad artifact quality", "committedDate": "2020-03-11T16:16:28Z", "type": "forcePushed"}]}