{"pr_number": 3297, "pr_title": "[DOC] Improvements to Prometheus Operator deployment procedure", "pr_createdAt": "2020-07-09T10:48:56Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3297", "timeline": [{"oid": "0efad7431b56b991bd0a939207e75aea1e9c0dea", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/0efad7431b56b991bd0a939207e75aea1e9c0dea", "message": "Edit Prometheus Operator deployment, new condition\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-07-09T10:44:38Z", "type": "commit"}, {"oid": "e9be74d1fa1ec9ee0761807a444ad4945e0c8309", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e9be74d1fa1ec9ee0761807a444ad4945e0c8309", "message": "Use a better attribute name\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-07-09T10:53:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjE0MDAwNw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3297#discussion_r452140007", "bodyText": "Not so simple :-( The Prometheus operator team provided me this link in the past for choosing a release https://github.com/coreos/kube-prometheus#kubernetes-compatibility-matrix but then if you are using OpenShift 3.11 for example the above URL is not valid anymore and the right bundle comes from https://github.com/openshift/prometheus-operator/tree/release-3.11. Anyway because we want to stay on vanilla Kubernetes here, I would add the link to the versions matrix. It's mentioned more or less here https://github.com/coreos/prometheus-operator#quickstart", "author": "ppatierno", "createdAt": "2020-07-09T11:08:22Z", "path": "documentation/modules/metrics/proc_metrics-deploying-prometheus-operator.adoc", "diffHunk": "@@ -10,17 +10,19 @@ To deploy the Prometheus Operator to your Kafka cluster, apply the YAML bundle r\n \n .Procedure\n \n-. Download the resource file from the repository and replace the example `namespace` with your own:\n+. Download the `bundle.yaml` resources file from the repository and replace the example `namespace` with your own:\n +\n On Linux, use:\n +\n-[source,shell,subs=+quotes]\n-curl -s https://raw.githubusercontent.com/coreos/prometheus-operator/master/bundle.yaml | sed -e 's/namespace: .*/namespace: _my-namespace_/' > prometheus-operator-deployment.yaml\n+[source,shell,subs=\"+quotes,attributes+\"]\n+curl -s https://raw.githubusercontent.com/coreos/prometheus-operator/{PrometheusSupport}/bundle.yaml | sed -e 's/namespace: .*/namespace: _my-namespace_/' > prometheus-operator-deployment.yaml\n +\n On MacOS, use:\n +\n-[source,shell,subs=+quotes]\n-curl -s https://raw.githubusercontent.com/coreos/prometheus-operator/master/bundle.yaml | sed -e '' 's/namespace: .*/namespace: _my-namespace_/' > prometheus-operator-deployment.yaml\n+[source,shell,subs=\"+quotes,attributes+\"]\n+curl -s https://raw.githubusercontent.com/coreos/prometheus-operator/{PrometheusSupport}/bundle.yaml | sed -e '' 's/namespace: .*/namespace: _my-namespace_/' > prometheus-operator-deployment.yaml\n++\n+Choose a release that is compatible with your version of Kubernetes.", "originalCommit": "0efad7431b56b991bd0a939207e75aea1e9c0dea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIzMzYwNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3297#discussion_r452233605", "bodyText": "Of course not ;)\nI'll add links to the Kubernetes compatibility matrix and the separate openshift/prometheus-operator repository. We mention OpenShift elsewhere in the docs, so I think it's OK to mention it here.", "author": "laidan6000", "createdAt": "2020-07-09T13:52:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjE0MDAwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI0NjQ3NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3297#discussion_r452246474", "bodyText": "I reworded as follows:\nUse the  Kubernetes compatibility matrix to help you choose a release that is compatible with your version of Kubernetes. If using OpenShift, specify a release of the OpenShift fork of the Prometheus Operator repository.", "author": "laidan6000", "createdAt": "2020-07-09T14:10:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjE0MDAwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI2MjEyNw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3297#discussion_r452262127", "bodyText": "I don't know about mentioning OpenShift or maybe we could have it as a note but not in the main text?", "author": "ppatierno", "createdAt": "2020-07-09T14:31:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjE0MDAwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI4NDc5NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3297#discussion_r452284795", "bodyText": "I'll try it as a note. I think it's OK to mention it here; we mention oc and OpenShift as deployment options elsewhere in the documentation.", "author": "laidan6000", "createdAt": "2020-07-09T15:01:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjE0MDAwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMwNjE0Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3297#discussion_r452306143", "bodyText": "I've rearranged the information again! The OpenShift option is now in a note. Please take another look.", "author": "laidan6000", "createdAt": "2020-07-09T15:32:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjE0MDAwNw=="}], "type": "inlineReview"}, {"oid": "42951c290d49b10195a423052c2f05df75e550c9", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/42951c290d49b10195a423052c2f05df75e550c9", "message": "Added info on OpenShift repo\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-07-09T14:08:10Z", "type": "commit"}, {"oid": "147de3ff8ebce96078c27ce96c0cc2774c249b17", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/147de3ff8ebce96078c27ce96c0cc2774c249b17", "message": "Review comments\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-07-09T15:31:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUyMDU0Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3297#discussion_r452520547", "bodyText": "Do we really need the variable if it is used only in two places next to each other? I think it might be better to keep the version in the example directly where it is more likely to be seen and noticed that it is wrong since we only rarely fo through the variable values and they seem to be often outdated.", "author": "scholzj", "createdAt": "2020-07-09T22:17:11Z", "path": "documentation/shared/attributes.adoc", "diffHunk": "@@ -33,6 +33,7 @@\n :JMXExporter: link:https://github.com/prometheus/jmx_exporter[JMX Exporter documentation^]\n :PrometheusHome: link:https://github.com/prometheus[Prometheus^]\n :PrometheusConfig: link:https://prometheus.io/docs/prometheus/latest/configuration/configuration[Configuration^]\n+:SupportedPrometheusVersion: master", "originalCommit": "147de3ff8ebce96078c27ce96c0cc2774c249b17", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc2MTQzOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3297#discussion_r452761438", "bodyText": "Yes, I was thinking that. As long as we keep the note for non-Kubernetes users, I'm happy to remove this variable and use master in the commands.", "author": "laidan6000", "createdAt": "2020-07-10T10:28:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUyMDU0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUyMDkwMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3297#discussion_r452520900", "bodyText": "Is this the latest master release? Or which version? I expect the matrix lists more versions than just 1.18.", "author": "scholzj", "createdAt": "2020-07-09T22:18:06Z", "path": "documentation/modules/metrics/proc_metrics-deploying-prometheus-operator.adoc", "diffHunk": "@@ -10,23 +10,30 @@ To deploy the Prometheus Operator to your Kafka cluster, apply the YAML bundle r\n \n .Procedure\n \n-. Download the resource file from the repository and replace the example `namespace` with your own:\n+. Download the `bundle.yaml` resources file from the repository.\n +\n On Linux, use:\n +\n-[source,shell,subs=+quotes]\n-curl -s https://raw.githubusercontent.com/coreos/prometheus-operator/master/bundle.yaml | sed -e 's/namespace: .*/namespace: _my-namespace_/' > prometheus-operator-deployment.yaml\n+[source,shell,subs=\"+quotes,attributes+\"]\n+curl -s https://raw.githubusercontent.com/coreos/prometheus-operator/{SupportedPrometheusVersion}/bundle.yaml | sed -e 's/namespace: .*/namespace: _my-namespace_/' > prometheus-operator-deployment.yaml\n +\n On MacOS, use:\n +\n-[source,shell,subs=+quotes]\n-curl -s https://raw.githubusercontent.com/coreos/prometheus-operator/master/bundle.yaml | sed -e '' 's/namespace: .*/namespace: _my-namespace_/' > prometheus-operator-deployment.yaml\n+[source,shell,subs=\"+quotes,attributes+\"]\n+curl -s https://raw.githubusercontent.com/coreos/prometheus-operator/{SupportedPrometheusVersion}/bundle.yaml | sed -e '' 's/namespace: .*/namespace: _my-namespace_/' > prometheus-operator-deployment.yaml\n++\n+** Replace the example `namespace` with your own.\n++\n+ifdef::Downloading[]\n+** Use the latest `master` release as shown, or choose a release that is compatible with your version of Kubernetes (see the https://github.com/coreos/kube-prometheus#kubernetes-compatibility-matrix[Kubernetes compatibility matrix]). \n+The Prometheus Operator installation works with Kubernetes 1.18+.", "originalCommit": "147de3ff8ebce96078c27ce96c0cc2774c249b17", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc2MDkxMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3297#discussion_r452760910", "bodyText": "I'll double check. This text is already there.", "author": "laidan6000", "createdAt": "2020-07-10T10:27:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUyMDkwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc3MjAxOQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3297#discussion_r452772019", "bodyText": "Yes, the master release works with Kubernetes 1.18.z. That is my understanding from reading the compatibility matrix and the Quickstart - https://github.com/coreos/kube-prometheus#quickstart . I'll make this clearer in the text.\nThe matrix only lists Kubernetes versions up to 1.18.", "author": "laidan6000", "createdAt": "2020-07-10T10:52:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUyMDkwMA=="}], "type": "inlineReview"}, {"oid": "2d99b01fa028833b49fd64ca65ca9f2e7477d991", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2d99b01fa028833b49fd64ca65ca9f2e7477d991", "message": "Review comments JS\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-07-10T10:55:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk0OTkzMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3297#discussion_r452949930", "bodyText": "Do we want to wrap this in ifndef::Downloading[]?", "author": "PaulRMellor", "createdAt": "2020-07-10T16:32:44Z", "path": "documentation/modules/metrics/proc_metrics-deploying-prometheus-operator.adoc", "diffHunk": "@@ -10,23 +10,30 @@ To deploy the Prometheus Operator to your Kafka cluster, apply the YAML bundle r\n \n .Procedure\n \n-. Download the resource file from the repository and replace the example `namespace` with your own:\n+. Download the `bundle.yaml` resources file from the repository.\n +\n On Linux, use:\n +\n-[source,shell,subs=+quotes]\n+[source,shell,subs=\"+quotes,attributes+\"]\n curl -s https://raw.githubusercontent.com/coreos/prometheus-operator/master/bundle.yaml | sed -e 's/namespace: .*/namespace: _my-namespace_/' > prometheus-operator-deployment.yaml\n +\n On MacOS, use:\n +\n-[source,shell,subs=+quotes]\n+[source,shell,subs=\"+quotes,attributes+\"]\n curl -s https://raw.githubusercontent.com/coreos/prometheus-operator/master/bundle.yaml | sed -e '' 's/namespace: .*/namespace: _my-namespace_/' > prometheus-operator-deployment.yaml\n++\n+** Replace the example `namespace` with your own.\n++\n+ifdef::Downloading[]\n+** Use the latest `master` release as shown, or choose a release that is compatible with your version of Kubernetes (see the https://github.com/coreos/kube-prometheus#kubernetes-compatibility-matrix[Kubernetes compatibility matrix]). \n+The `master` release of the Prometheus Operator works with Kubernetes 1.18+.\n+endif::Downloading[]\n++\n+NOTE: If using OpenShift, specify a release of the link:https://github.com/openshift/prometheus-operator[OpenShift fork^] of the Prometheus Operator repository.", "originalCommit": "2d99b01fa028833b49fd64ca65ca9f2e7477d991", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQ4MjMyNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3297#discussion_r453482324", "bodyText": "No, I'd rather not. This will be helpful to our OpenShift users.", "author": "laidan6000", "createdAt": "2020-07-13T08:32:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk0OTkzMA=="}], "type": "inlineReview"}]}