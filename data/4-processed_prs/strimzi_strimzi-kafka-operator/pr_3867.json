{"pr_number": 3867, "pr_title": "Fix various metrics examples issues", "pr_createdAt": "2020-10-23T15:49:32Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3867", "timeline": [{"oid": "f8fd3333bc522c66c2c0d08d21a1b8107723261d", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f8fd3333bc522c66c2c0d08d21a1b8107723261d", "message": "Fix various metrics issues\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-10-23T15:47:44Z", "type": "commit"}, {"oid": "76b7407fe2d3f6631db8ac5600d7b32a1fc712b0", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/76b7407fe2d3f6631db8ac5600d7b32a1fc712b0", "message": "rename podmonitor\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-10-23T16:00:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4NTY2OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3867#discussion_r510985668", "bodyText": "Why not Mirror Maker 1?", "author": "scholzj", "createdAt": "2020-10-23T16:01:09Z", "path": "examples/metrics/prometheus-install/strimzi-pod-monitor.yaml", "diffHunk": "@@ -60,7 +60,7 @@ spec:\n     matchExpressions:\n       - key: \"strimzi.io/kind\"\n         operator: In\n-        values: [\"Kafka\", \"KafkaConnect\"]\n+        values: [\"Kafka\", \"KafkaConnect\", \"KafkaConnectS2I\", \"KafkaMirrorMaker2\"]", "originalCommit": "f8fd3333bc522c66c2c0d08d21a1b8107723261d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4Njg2Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3867#discussion_r510986862", "bodyText": "@Frawless ^", "author": "sknot-rh", "createdAt": "2020-10-23T16:03:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4NTY2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4OTE2Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3867#discussion_r510989162", "bodyText": "I thought mm1 doesn't have metrics.", "author": "Frawless", "createdAt": "2020-10-23T16:07:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4NTY2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4OTQxNw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3867#discussion_r510989417", "bodyText": "Documentation says the same", "author": "Frawless", "createdAt": "2020-10-23T16:07:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4NTY2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk5NDMxNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3867#discussion_r510994315", "bodyText": "I do not see any example resource deploying MM1 with metrics, neither I can see any MM1 dashboard. So maybe we are just excluding it from the examples?", "author": "sknot-rh", "createdAt": "2020-10-23T16:16:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4NTY2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk5NDUzMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3867#discussion_r510994530", "bodyText": "It has the metrics field in the CRD. And I'm sure there will be at least producer and consumer metrics. It just doesn't have dashboard.", "author": "scholzj", "createdAt": "2020-10-23T16:16:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4NTY2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA3NDExNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3867#discussion_r511074115", "bodyText": "In that case, we should add it and mention in docs (if I am not blind)", "author": "Frawless", "createdAt": "2020-10-23T18:39:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4NTY2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA4NDc3MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3867#discussion_r511084770", "bodyText": "Well, it is in the docs: https://strimzi.io/docs/operators/latest/full/using.html#type-KafkaMirrorMakerSpec-reference ... if we do not have dedicated examples and dashabord it might not need to be mentioned somewhere else but can be maybe still scraped if users enable the metrics with their configuration?", "author": "scholzj", "createdAt": "2020-10-23T18:57:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4NTY2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM5MjAzMw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3867#discussion_r515392033", "bodyText": "So what about this one? Can you add the MM1 there?", "author": "scholzj", "createdAt": "2020-10-30T21:31:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4NTY2OA=="}], "type": "inlineReview"}, {"oid": "bc7f04e0619b2adebc2cce0262059d75457bb917", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/bc7f04e0619b2adebc2cce0262059d75457bb917", "message": "maybe maybe maybe\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-10-23T16:13:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAxMzc1MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3867#discussion_r511013751", "bodyText": "It is already on the beginning ... does it make sense to have it twice?", "author": "scholzj", "createdAt": "2020-10-23T16:51:28Z", "path": "examples/metrics/grafana-dashboards/strimzi-kafka-connect.json", "diffHunk": "@@ -124,7 +124,7 @@\n       \"tableColumn\": \"\",\n       \"targets\": [\n         {\n-          \"expr\": \"sum(kafka_connect_worker_connector_count{strimzi_io_kind=~\\\"KafkaConnect.*\\\",strimzi_io_cluster=\\\"$strimzi_connect_cluster_name\\\"})\",\n+          \"expr\": \"sum(kafka_connect_worker_connector_count{strimzi_io_kind=~\\\"KafkaConnect.*\\\",strimzi_io_cluster=\\\"$strimzi_connect_cluster_name\\\", strimzi_io_kind=~\\\"KafkaConnect.*\\\"})\",", "originalCommit": "bc7f04e0619b2adebc2cce0262059d75457bb917", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE1NTg0NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3867#discussion_r511155845", "bodyText": "Ah, no. I am just blind.", "author": "sknot-rh", "createdAt": "2020-10-23T21:07:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAxMzc1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAxNDAyOQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3867#discussion_r511014029", "bodyText": "Same as above", "author": "scholzj", "createdAt": "2020-10-23T16:52:01Z", "path": "examples/metrics/grafana-dashboards/strimzi-kafka-connect.json", "diffHunk": "@@ -206,7 +206,7 @@\n       \"tableColumn\": \"\",\n       \"targets\": [\n         {\n-          \"expr\": \"sum(kafka_connect_worker_task_count{strimzi_io_kind=~\\\"KafkaConnect.*\\\",strimzi_io_cluster=\\\"$strimzi_connect_cluster_name\\\"})\",\n+          \"expr\": \"sum(kafka_connect_worker_task_count{strimzi_io_kind=~\\\"KafkaConnect.*\\\",strimzi_io_cluster=\\\"$strimzi_connect_cluster_name\\\", strimzi_io_kind=~\\\"KafkaConnect.*\\\"})\",", "originalCommit": "bc7f04e0619b2adebc2cce0262059d75457bb917", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5429b941899342357e32ad61e0836cc14de4a33c", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5429b941899342357e32ad61e0836cc14de4a33c", "message": "reduce blindness\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-10-23T21:07:53Z", "type": "commit"}, {"oid": "a27171ec3120e8fd0bb80060fe60d828f0603cdc", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/a27171ec3120e8fd0bb80060fe60d828f0603cdc", "message": "aha\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-10-26T11:21:26Z", "type": "commit"}, {"oid": "76afe468bc12116c26dd7530eff6e19953eea0fd", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/76afe468bc12116c26dd7530eff6e19953eea0fd", "message": "addressing comments\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-11-02T09:59:49Z", "type": "commit"}]}