{"pr_number": 3656, "pr_title": "ST: Add test which do downgrade to older log message format", "pr_createdAt": "2020-09-16T07:16:01Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3656", "timeline": [{"oid": "43bf88ed9d33bac0a2e6fd72d6057abf323f2620", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/43bf88ed9d33bac0a2e6fd72d6057abf323f2620", "message": "add test which do downgrade to older log message format\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-09-16T07:13:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4ODk3MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3656#discussion_r489288970", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (initialVersion.compareTo(newVersion) < 0) {\n          \n          \n            \n                            // If it is an upgrade test we keep the message format as the lower version number\n          \n          \n            \n                            logMsgFormat = initialVersion.messageVersion();\n          \n          \n            \n                        } else {\n          \n          \n            \n                            // If it is a downgrade then we make sure to use the lower version number for the message format\n          \n          \n            \n                            logMsgFormat = newVersion.messageVersion();\n          \n          \n            \n                       String logMsgFormat = initialVersion.compareTo(newVersion) < 0 ? \n          \n          \n            \n                       // If it is an upgrade test we keep the message format as the lower version number\n          \n          \n            \n                       initialVersion.messageVersion() : \n          \n          \n            \n                       // If it is a downgrade then we make sure to use the lower version number for the message format\n          \n          \n            \n                       newVersion.messageVersion()", "author": "see-quick", "createdAt": "2020-09-16T09:16:10Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/upgrade/ZookeeperUpgradeST.java", "diffHunk": "@@ -52,7 +52,16 @@ void testKafkaClusterUpgrade(ExtensionContext testContext) {\n             TestKafkaVersion initialVersion = sortedVersions.get(x);\n             TestKafkaVersion newVersion = sortedVersions.get(x + 1);\n \n-            runVersionChange(initialVersion, newVersion, 3, 3, testContext);\n+            String logMsgFormat;\n+            if (initialVersion.compareTo(newVersion) < 0) {\n+                // If it is an upgrade test we keep the message format as the lower version number\n+                logMsgFormat = initialVersion.messageVersion();\n+            } else {\n+                // If it is a downgrade then we make sure to use the lower version number for the message format\n+                logMsgFormat = newVersion.messageVersion();", "originalCommit": "43bf88ed9d33bac0a2e6fd72d6057abf323f2620", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4OTk2Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3656#discussion_r489289967", "bodyText": "same with that", "author": "see-quick", "createdAt": "2020-09-16T09:17:30Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/upgrade/ZookeeperUpgradeST.java", "diffHunk": "@@ -70,7 +79,16 @@ void testKafkaClusterDowngrade(ExtensionContext testContext) {\n             TestKafkaVersion initialVersion = sortedVersions.get(x);\n             TestKafkaVersion newVersion = sortedVersions.get(x - 1);\n \n-            runVersionChange(initialVersion, newVersion, 3, 3, testContext);\n+            String logMsgFormat;\n+            if (initialVersion.compareTo(newVersion) < 0) {\n+                // If it is an upgrade test we keep the message format as the lower version number\n+                logMsgFormat = initialVersion.messageVersion();\n+            } else {\n+                // If it is a downgrade then we make sure to use the lower version number for the message format\n+                logMsgFormat = newVersion.messageVersion();\n+            }", "originalCommit": "43bf88ed9d33bac0a2e6fd72d6057abf323f2620", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "32d6c58644eeaeddf39c6ec709579f91c705ab22", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/32d6c58644eeaeddf39c6ec709579f91c705ab22", "message": "fixup! add test which do downgrade to older log message format\n\nSigned-off-by: Jakub Stejskal <xstejs24@gmail.com>", "committedDate": "2020-09-16T10:24:26Z", "type": "commit"}]}