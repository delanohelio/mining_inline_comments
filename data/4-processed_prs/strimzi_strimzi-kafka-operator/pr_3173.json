{"pr_number": 3173, "pr_title": "Upgraded CC to 2.0.108 ", "pr_createdAt": "2020-06-08T17:41:53Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173", "timeline": [{"oid": "29eba83febc84f3dbba924ac0ebd1e444fa780c4", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/29eba83febc84f3dbba924ac0ebd1e444fa780c4", "message": "Upgraded CC to 2.0.108 and refactored CC client for new endpoint behaviour\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-08T17:42:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg5MTUxNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r436891514", "bodyText": "I'm not sure this is worth mentioning. If something, I would probably rather mention what makes this upgrade interesting for users.", "author": "scholzj", "createdAt": "2020-06-08T17:57:50Z", "path": "CHANGELOG.md", "diffHunk": "@@ -5,6 +5,7 @@\n \n * Remove deprecated `Kafka.spec.topicOperator` classes and deployment logic\n * Use Java 11 as the Java runtime\n+* Upgrade to Cruise Control version 2.0.108", "originalCommit": "29eba83febc84f3dbba924ac0ebd1e444fa780c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQxMDI0Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437410246", "bodyText": "Worth mentioning that they no longer need to create the strimzi.cruisecontrol.metrics topic before deployment if auto.create.topics.enable: false is configured.", "author": "laidan6000", "createdAt": "2020-06-09T13:19:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg5MTUxNA=="}], "type": "inlineReview"}, {"oid": "01c08d0d31047b3ec3be89bce09b5c76515aed40", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/01c08d0d31047b3ec3be89bce09b5c76515aed40", "message": "Upgraded CC to 2.0.108 and refactored CC client for new endpoint behaviour\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-09T09:21:19Z", "type": "forcePushed"}, {"oid": "7f6d74e6885a428bb076258a06be1149a52b177f", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7f6d74e6885a428bb076258a06be1149a52b177f", "message": "Upgraded CC to 2.0.108 and refactored CC client for new endpoint behaviour\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-09T09:29:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI4MzE5NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437283195", "bodyText": "typo \"the status\"", "author": "ppatierno", "createdAt": "2020-06-09T09:47:01Z", "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlApiImpl.java", "diffHunk": "@@ -204,36 +204,36 @@ public CruiseControlApiImpl(Vertx vertx, int idleTimeout) {\n                             JsonObject statusJson = new JsonObject();\n                             String taskStatus = jsonUserTask.getString(\"Status\");\n                             statusJson.put(\"Status\", taskStatus);\n-                            // The status could be ACTIVE in which case there will not be a \"summary\" so we check that we are\n-                            // in a state that actually has that key.\n-                            if (taskStatus.equals(CruiseControlUserTaskStatus.IN_EXECUTION.toString()) ||\n-                                    taskStatus.equals(CruiseControlUserTaskStatus.COMPLETED.toString())) {\n-                                // We now need to extract the original response which is in a raw string (not nicely formatted JSON)\n+\n+                            CruiseControlUserTaskResponse ccResponse;\n+                            if (taskStatus.equals(CruiseControlUserTaskStatus.IN_EXECUTION.toString()) || taskStatus.equals(CruiseControlUserTaskStatus.COMPLETED.toString())) {\n+                                // Tasks in execution will be rebalance tasks, so their original response will contain the summary of the rebalance they are executing\n+                                // Completed tasks likewise will have the original rebalance summary in their original response\n                                 statusJson.put(\"summary\", ((JsonObject) Json.decodeValue(jsonUserTask.getString(\"originalResponse\"))).getJsonObject(\"summary\"));\n+                                ccResponse = new CruiseControlUserTaskResponse(userTaskID, statusJson);\n+                            } else if (taskStatus.equals(CruiseControlUserTaskStatus.ACTIVE.toString())) {\n+                                // If he status is ACTIVE there will not be a \"summary\" so we skip pulling the summary key", "originalCommit": "01c08d0d31047b3ec3be89bce09b5c76515aed40", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI4NDY2OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437284669", "bodyText": "I would not remove everything. The summary and description about what topics are in place are useful I think. I would remove the parts where creating the metrics topic is mentioned.", "author": "ppatierno", "createdAt": "2020-06-09T09:49:31Z", "path": "documentation/modules/cruise-control/ref-cruise-control-configuration.adoc", "diffHunk": "@@ -97,49 +97,6 @@ spec:\n .Additional resources\n For more information, refer to the xref:type-BrokerCapacity-reference[].\n \n-[#auto-created-topics-logs]\n-[discrete]\n-== Auto-created topics and log compaction\n-\n-Cruise Control requires the following three topics in order to work:\n-\n-* `strimzi.cruisecontrol.partitionmetricsamples`\n-* `strimzi.cruisecontrol.modeltrainingsamples`\n-* `strimzi.cruisecontrol.metrics`\n-\n-These three topics are usually auto-created by Strimzi and Cruise Control. First, the metric reporters create the `strimzi.cruisecontrol.metrics` topic. \n-Then, Cruise Control creates the `strimzi.cruisecontrol.partitionmetricsamples` and `strimzi.cruisecontrol.modeltrainingsamples` topics.\n-\n-However, if automatic topic creation is _disabled_ in Kafka (`auto.create.topics.enable: false` is configured in `spec.kafka.config` when starting a new Kafka cluster) the Cruise Control metric reporters are unable to create the `strimzi.cruisecontrol.metrics` topic.\n-In this situation, you need to manually create the `strimzi.cruisecontrol.metrics` topic before deploying Cruise Control. \n-You can do this using the following command:\n-\n-[source,shell,subs=\"attributes+\"]\n-----\n-kubectl apply -f examples/cruise-control/cruise-control-topic.yaml\n-----\n-\n-Log compaction might remove records that are needed by Cruise Control; therefore, all auto-created topics must be configured with `cleanup.policy=delete` to disable log compaction. \n-Cruise Control will automatically disable log compaction for the `strimzi.cruisecontrol.partitionmetricsamples` and `strimzi.cruisecontrol.modeltrainingsamples` topics.\n-The Cruise Control metric reporters attempt to disable log compaction for the `strimzi.cruisecontrol.metrics` topic, but fail if they are started with a new Kafka cluster.\n-This is only a problem if log compaction is enabled in Kafka with the setting `log.cleanup.policy=compact` in `spec.kafka.config`. \n-In this situation, log compaction will be enabled for the `strimzi.cruisecontrol.metrics` topic and will need to be overridden with `cleanup.policy=delete` in the `strimzi.cruisecontrol.metrics` topic.\n-\n-Here is an example where log compaction is disabled in a topic that was auto-created by Cruise Control:\n-\n-[source,yaml,subs=\"+quotes,attributes\"]\n-----\n-apiVersion: kafka.strimzi.io/v1beta1\n-kind: KafkaTopic\n-metadata:\n-  name: strimzi.cruisecontrol.metrics\n-spec:\n-  partitions: 1\n-  replicas: 1\n-  config:\n-    cleanup.policy: delete\n-----\n-", "originalCommit": "01c08d0d31047b3ec3be89bce09b5c76515aed40", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI5MTU3Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437291576", "bodyText": "Agree that the topic description might be useful but not sure where would be the best place for it? Topic names aren't configurable AFAIK?", "author": "tomncooper", "createdAt": "2020-06-09T10:01:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI4NDY2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzMwMTg5MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437301890", "bodyText": "Yes, the names cannot be changed but still describing what they are sounds useful to me. I would say that the current place is fine but we should make it a concept more than a reference (even if experts are @laidan6000 and @PaulRMellor here) and we should change the title. It's more about explaining why the user will see some new topics, who created them and what's their purpose.", "author": "ppatierno", "createdAt": "2020-06-09T10:19:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI4NDY2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzMwMzQzNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437303435", "bodyText": "Agreed, @laidan6000 would it make sense to leave this removal from the configuration in this PR and for you to do a PR adding this description of the metrics topics into an appropriate section (installation/deployment)?", "author": "tomncooper", "createdAt": "2020-06-09T10:22:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI4NDY2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQxNTczNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437415736", "bodyText": "Yes, good idea to keep the explanations of the CC topics as a concept. I'm happy to do this in a separate PR.", "author": "laidan6000", "createdAt": "2020-06-09T13:27:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI4NDY2OQ=="}], "type": "inlineReview"}, {"oid": "3ccfe2d3e4243e0b53b4e0c93b8c9205bcc97be3", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3ccfe2d3e4243e0b53b4e0c93b8c9205bcc97be3", "message": "Refactored CC client to remove need to use user tasks response subclass\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-09T13:41:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ1NTc2NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437455764", "bodyText": "How is it reflected in the resource status? The user will see the \"summary\" with the original proposal and the final state will be Ready but no evidence that it's completed with error?", "author": "ppatierno", "createdAt": "2020-06-09T14:13:56Z", "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlApiImpl.java", "diffHunk": "@@ -202,38 +202,40 @@ public CruiseControlApiImpl(Vertx vertx, int idleTimeout) {\n                                                 json.getString(CC_REST_API_ERROR_KEY)));\n                             }\n                             JsonObject statusJson = new JsonObject();\n-                            String taskStatus = jsonUserTask.getString(\"Status\");\n-                            statusJson.put(\"Status\", taskStatus);\n-                            // The status could be ACTIVE in which case there will not be a \"summary\" so we check that we are\n-                            // in a state that actually has that key.\n-                            if (taskStatus.equals(CruiseControlUserTaskStatus.IN_EXECUTION.toString()) ||\n-                                    taskStatus.equals(CruiseControlUserTaskStatus.COMPLETED.toString())) {\n-                                // We now need to extract the original response which is in a raw string (not nicely formatted JSON)\n-                                statusJson.put(\"summary\", ((JsonObject) Json.decodeValue(jsonUserTask.getString(\"originalResponse\"))).getJsonObject(\"summary\"));\n+                            String taskStatusStr = jsonUserTask.getString(\"Status\");\n+                            statusJson.put(\"Status\", taskStatusStr);\n+                            CruiseControlUserTaskStatus taskStatus = CruiseControlUserTaskStatus.lookup(taskStatusStr);\n+                            switch (taskStatus) {\n+                                case ACTIVE:\n+                                    // If the status is ACTIVE there will not be a \"summary\" so we skip pulling the summary key\n+                                    break;\n+                                case IN_EXECUTION:\n+                                    // Tasks in execution will be rebalance tasks, so their original response will contain the summary of the rebalance they are executing\n+                                    // We handle these in the same way as COMPLETED tasks so we drop down to that case.\n+                                case COMPLETED:\n+                                    // Completed tasks will have the original rebalance proposal summary in their original response\n+                                    statusJson.put(\"summary\", ((JsonObject) Json.decodeValue(jsonUserTask.getString(\"originalResponse\"))).getJsonObject(\"summary\"));\n+                                    break;\n+                                case COMPLETED_WITH_ERROR:\n+                                    // Completed with error tasks will have \"CompletedWithError\" as their original response, which is not Json.\n+                                    statusJson.put(\"summary\", jsonUserTask.getString(\"originalResponse\"));", "originalCommit": "3ccfe2d3e4243e0b53b4e0c93b8c9205bcc97be3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ1OTc2OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437459769", "bodyText": "No the status of the field is still CompletedWithError and this will be picked up in the KRAO onRebalancing method  where the status will be set to NotReady.  We could just have a blank summary but in future this will hopefully contain details of the actual error (I have a rough idea for upstream CC PR to retain that info for the user task).", "author": "tomncooper", "createdAt": "2020-06-09T14:19:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ1NTc2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ2MjQ5OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437462499", "bodyText": "No the status of the field is still CompletedWithError\n\nwhich status field? in the next sentence you said it's NotReady.\n\nand this will be picked up in the KRAO onRebalancing method where the status will be set to NotReady\n\nso you are saying that the KafkaRebalance will be in NotReady status but with a valid summary? I think it's really confusing for the user.", "author": "ppatierno", "createdAt": "2020-06-09T14:22:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ1NTc2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ2ODIwNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437468204", "bodyText": "This is the CC client? It doesn't touch the KafkaReabalance status field. The KRAO does that in the onRebalancing method. The status field of the CruiseControlReponse's json is CompletedWithError which will trigger the appropriate branch in the KRAO which will not set a summary (which matches what it does currently).", "author": "tomncooper", "createdAt": "2020-06-09T14:29:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ1NTc2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ4MzQwMw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437483403", "bodyText": "You are right! I did too many reviews today! ;-)", "author": "ppatierno", "createdAt": "2020-06-09T14:49:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ1NTc2NA=="}], "type": "inlineReview"}, {"oid": "8ebe79d88835979d975eb71b7488f371e0fa96ef", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8ebe79d88835979d975eb71b7488f371e0fa96ef", "message": "Refactored CC client to remove need to use user tasks response subclass\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-09T14:54:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5MDExOQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437490119", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * Upgraded to Cruise Control version 2.0.108 - This removes the need to manually create metrics topics if topic auto creation is disabled.\n          \n          \n            \n            * Remove the need to manually create Cruise Control topics if topic auto creation is disabled.", "author": "scholzj", "createdAt": "2020-06-09T14:57:51Z", "path": "CHANGELOG.md", "diffHunk": "@@ -5,6 +5,7 @@\n \n * Remove deprecated `Kafka.spec.topicOperator` classes and deployment logic\n * Use Java 11 as the Java runtime\n+* Upgraded to Cruise Control version 2.0.108 - This removes the need to manually create metrics topics if topic auto creation is disabled.", "originalCommit": "8ebe79d88835979d975eb71b7488f371e0fa96ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5MTYwNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437491604", "bodyText": "Why is the version of the upstream system not relevant?", "author": "tomncooper", "createdAt": "2020-06-09T14:59:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5MDExOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5NTYwNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437495605", "bodyText": "And why is it relevant? Especially with the weird CC versioning and the version change being patch only, for most people it is meaning less.", "author": "scholzj", "createdAt": "2020-06-09T15:05:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5MDExOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5OTkwMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437499901", "bodyText": "Well it is a log of changes and this is a change? Maybe the users can decide for themselves if the version number is important info or not?\nIf you feel that strongly about it I will take it out. But I don't think we have the CC version documented anywhere (other than the upstream poms) so we should probably add it to the docs somewhere?", "author": "tomncooper", "createdAt": "2020-06-09T15:09:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5MDExOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUyMDEwNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437520105", "bodyText": "I feel strongly about it. We do not document there patch versions of Zookeeper, minor versions of Fabric8 or Vert.x updates etc.", "author": "scholzj", "createdAt": "2020-06-09T15:26:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5MDExOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5Mjc3Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437492773", "bodyText": "Following the new and less strict documentation rules ... maybe you can remove the proceudure structure (The prerequisites heading, the procedure heading etc.) which seem to have lot more noise than value.", "author": "scholzj", "createdAt": "2020-06-09T15:01:14Z", "path": "documentation/modules/cruise-control/proc-deploying-cruise-control.adoc", "diffHunk": "@@ -9,23 +9,13 @@ To deploy Cruise Control to your Strimzi cluster, define the configuration using\n \n Deploy one instance of Cruise Control per Kafka cluster.\n \n-NOTE: Step one is only required if automatic topic creation is disabled in the Kafka cluster.\n-\n .Prerequisites\n \n * A Kubernetes cluster\n * A running Cluster Operator\n-* You are aware of the guidance on xref:#auto-created-topics-logs[Auto-created topics and log compaction].\n \n .Procedure\n \n-. If automatic topic creation is disabled (`auto.create.topics.enable: false` is configured in `spec.kafka.config`), first create the `strimzi.cruisecontrol.metrics` topic:\n-+\n-[source,shell,subs=\"attributes+\"]\n-----\n-kubectl apply -f examples/cruise-control/cruise-control-topic.yaml\n-----\n-\n . Edit the `cruiseControl` property of the `Kafka` resource.\n +\n The properties you can configure are shown in this example configuration:", "originalCommit": "8ebe79d88835979d975eb71b7488f371e0fa96ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUxMjYzMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437512631", "bodyText": "I think @laidan6000 has said he will do a follow up PR which will add the CC metric topic info etc to the intro so maybe these edits could be made in that PR?", "author": "tomncooper", "createdAt": "2020-06-09T15:19:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5Mjc3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5MzM2NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437493365", "bodyText": "Should this say something like _Edit the Kafka resource and add cruideControl property?", "author": "scholzj", "createdAt": "2020-06-09T15:02:03Z", "path": "documentation/modules/cruise-control/proc-deploying-cruise-control.adoc", "diffHunk": "@@ -9,23 +9,13 @@ To deploy Cruise Control to your Strimzi cluster, define the configuration using\n \n Deploy one instance of Cruise Control per Kafka cluster.\n \n-NOTE: Step one is only required if automatic topic creation is disabled in the Kafka cluster.\n-\n .Prerequisites\n \n * A Kubernetes cluster\n * A running Cluster Operator\n-* You are aware of the guidance on xref:#auto-created-topics-logs[Auto-created topics and log compaction].\n \n .Procedure\n \n-. If automatic topic creation is disabled (`auto.create.topics.enable: false` is configured in `spec.kafka.config`), first create the `strimzi.cruisecontrol.metrics` topic:\n-+\n-[source,shell,subs=\"attributes+\"]\n-----\n-kubectl apply -f examples/cruise-control/cruise-control-topic.yaml\n-----\n-\n . Edit the `cruiseControl` property of the `Kafka` resource.", "originalCommit": "8ebe79d88835979d975eb71b7488f371e0fa96ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU1NzQwNw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437557407", "bodyText": "Yes, it should. Good spot.", "author": "laidan6000", "createdAt": "2020-06-09T16:19:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5MzM2NQ=="}], "type": "inlineReview"}, {"oid": "a611e63d213610b305718f0d0bf8d7540ac408a0", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/a611e63d213610b305718f0d0bf8d7540ac408a0", "message": "Refactored CC client to remove need to use user tasks response subclass\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-09T15:14:23Z", "type": "forcePushed"}, {"oid": "ef472fd364eb2b8440eaa67661fdbe87e6aa2293", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/ef472fd364eb2b8440eaa67661fdbe87e6aa2293", "message": "Refactored CC client to remove need to use user tasks response subclass\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-09T16:56:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4NzM4NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437587385", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * Removed the need to manually create Cruise Control  metrics topics if topic auto creation is disabled.\n          \n          \n            \n            * Removed the need to manually create Cruise Control metrics topics if topic auto creation is disabled.", "author": "scholzj", "createdAt": "2020-06-09T17:08:33Z", "path": "CHANGELOG.md", "diffHunk": "@@ -5,6 +5,7 @@\n \n * Remove deprecated `Kafka.spec.topicOperator` classes and deployment logic\n * Use Java 11 as the Java runtime\n+* Removed the need to manually create Cruise Control  metrics topics if topic auto creation is disabled.", "originalCommit": "ef472fd364eb2b8440eaa67661fdbe87e6aa2293", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "727259319118d3aacbc24917dd1ec8b33d27e602", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/727259319118d3aacbc24917dd1ec8b33d27e602", "message": "Refactored CC client to remove need to use user tasks response subclass\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-09T17:25:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk0ODQ2Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437948466", "bodyText": "We use this Status string a few times, maybe worth making it a constant somewhere?", "author": "samuel-hawker", "createdAt": "2020-06-10T08:23:40Z", "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/operator/resource/cruisecontrol/CruiseControlApiImpl.java", "diffHunk": "@@ -202,38 +202,40 @@ public CruiseControlApiImpl(Vertx vertx, int idleTimeout) {\n                                                 json.getString(CC_REST_API_ERROR_KEY)));\n                             }\n                             JsonObject statusJson = new JsonObject();\n-                            String taskStatus = jsonUserTask.getString(\"Status\");\n-                            statusJson.put(\"Status\", taskStatus);\n-                            // The status could be ACTIVE in which case there will not be a \"summary\" so we check that we are\n-                            // in a state that actually has that key.\n-                            if (taskStatus.equals(CruiseControlUserTaskStatus.IN_EXECUTION.toString()) ||\n-                                    taskStatus.equals(CruiseControlUserTaskStatus.COMPLETED.toString())) {\n-                                // We now need to extract the original response which is in a raw string (not nicely formatted JSON)\n-                                statusJson.put(\"summary\", ((JsonObject) Json.decodeValue(jsonUserTask.getString(\"originalResponse\"))).getJsonObject(\"summary\"));\n+                            String taskStatusStr = jsonUserTask.getString(\"Status\");", "originalCommit": "727259319118d3aacbc24917dd1ec8b33d27e602", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk1MTEzNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3173#discussion_r437951135", "bodyText": "Missing a context.succeeding", "author": "samuel-hawker", "createdAt": "2020-06-10T08:27:55Z", "path": "cluster-operator/src/test/java/io/strimzi/operator/cluster/operator/assembly/KafkaRebalanceStateMachineTest.java", "diffHunk": "@@ -190,8 +192,8 @@ public String cruiseControlHost(String clusterName, String clusterNamespace) {\n         when(mockRebalanceOps.get(CLUSTER_NAMESPACE, RESOURCE_NAME)).thenReturn(kcRebalance);\n         when(mockRebalanceOps.getAsync(CLUSTER_NAMESPACE, RESOURCE_NAME)).thenReturn(Future.succeededFuture(kcRebalance));\n \n-        return kcrao.computeNextStatus(\n-                recon, HOST, client, kcRebalance, currentState, initialAnnotation, rbOptions).compose(result -> {\n+        return kcrao.computeNextStatus(recon, HOST, client, kcRebalance, currentState, initialAnnotation, rbOptions)\n+                .compose(result -> {", "originalCommit": "727259319118d3aacbc24917dd1ec8b33d27e602", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fe9dd08c3146eaa811f52ac97785b1d71812b325", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fe9dd08c3146eaa811f52ac97785b1d71812b325", "message": "Refactored CC client to remove need to use user tasks response subclass\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-10T10:22:04Z", "type": "commit"}, {"oid": "fe9dd08c3146eaa811f52ac97785b1d71812b325", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fe9dd08c3146eaa811f52ac97785b1d71812b325", "message": "Refactored CC client to remove need to use user tasks response subclass\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-10T10:22:04Z", "type": "forcePushed"}]}