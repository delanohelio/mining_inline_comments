{"pr_number": 2563, "pr_title": "Print a warning when single ZK replica with ephemeral storage is used", "pr_createdAt": "2020-02-17T11:08:43Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2563", "timeline": [{"oid": "fc78a0040ce3064e3faf65c09c2b6f64ba97c7e1", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fc78a0040ce3064e3faf65c09c2b6f64ba97c7e1", "message": "Print a warning when single ZK replica with ephemeral storage is used\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-02-17T11:04:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE4Nzg3MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2563#discussion_r380187871", "bodyText": "Isn't \"ephemeral\".equals(...) better? Smaller chance for NPE.", "author": "scholzj", "createdAt": "2020-02-17T13:41:50Z", "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/ZookeeperCluster.java", "diffHunk": "@@ -181,6 +181,11 @@ public static ZookeeperCluster fromCrd(Kafka kafkaAssembly, KafkaVersion.Lookup\n         if (replicas <= 0) {\n             replicas = ZookeeperClusterSpec.DEFAULT_REPLICAS;\n         }\n+\n+        if (replicas == 1 && zookeeperClusterSpec.getStorage() != null && zookeeperClusterSpec.getStorage().getType().equals(\"ephemeral\")) {", "originalCommit": "ffc00759b7df44f2f5b040e1d4282061de5b4aa5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE4OTIxMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2563#discussion_r380189211", "bodyText": "@laidan6000 @PaulRMellor Could one of you review the message please?", "author": "scholzj", "createdAt": "2020-02-17T13:44:32Z", "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/ZookeeperCluster.java", "diffHunk": "@@ -181,6 +181,11 @@ public static ZookeeperCluster fromCrd(Kafka kafkaAssembly, KafkaVersion.Lookup\n         if (replicas <= 0) {\n             replicas = ZookeeperClusterSpec.DEFAULT_REPLICAS;\n         }\n+\n+        if (replicas == 1 && zookeeperClusterSpec.getStorage() != null && zookeeperClusterSpec.getStorage().getType().equals(\"ephemeral\")) {\n+            log.warn(\"Zookeeper cluster with single replica and ephemeral storage will be in defective state after any restart or rolling update. It is recommended to use at least three replicas.\");", "originalCommit": "ffc00759b7df44f2f5b040e1d4282061de5b4aa5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fcb198aa7f4824510c574c8493fc598f29890d1d", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fcb198aa7f4824510c574c8493fc598f29890d1d", "message": "jbod\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-02-17T14:29:26Z", "type": "commit"}, {"oid": "fcb198aa7f4824510c574c8493fc598f29890d1d", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fcb198aa7f4824510c574c8493fc598f29890d1d", "message": "jbod\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-02-17T14:29:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIzNzY5Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2563#discussion_r380237697", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        log.warn(\"Zookeeper cluster with single replica and ephemeral storage will be in defective state after any restart or rolling update. It is recommended to use at least three replicas.\");\n          \n          \n            \n                        log.warn(\"A ZooKeeper cluster with a single replica and ephemeral storage will be in a defective state after any restart or rolling update. It is recommended that a minimum of three replicas are used.\");", "author": "PaulRMellor", "createdAt": "2020-02-17T15:14:27Z", "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/ZookeeperCluster.java", "diffHunk": "@@ -181,6 +181,11 @@ public static ZookeeperCluster fromCrd(Kafka kafkaAssembly, KafkaVersion.Lookup\n         if (replicas <= 0) {\n             replicas = ZookeeperClusterSpec.DEFAULT_REPLICAS;\n         }\n+\n+        if (replicas == 1 && zookeeperClusterSpec.getStorage() != null && \"ephemeral\".equals(zookeeperClusterSpec.getStorage().getType())) {\n+            log.warn(\"Zookeeper cluster with single replica and ephemeral storage will be in defective state after any restart or rolling update. It is recommended to use at least three replicas.\");", "originalCommit": "fcb198aa7f4824510c574c8493fc598f29890d1d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6acbdc64e72645954a9adf495f2e6823c4aef549", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6acbdc64e72645954a9adf495f2e6823c4aef549", "message": "message suggestion\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-02-17T15:18:58Z", "type": "commit"}]}