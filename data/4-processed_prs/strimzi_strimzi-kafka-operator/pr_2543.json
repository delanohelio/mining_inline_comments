{"pr_number": 2543, "pr_title": "Fix KafkaST", "pr_createdAt": "2020-02-12T12:34:10Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2543", "timeline": [{"oid": "7b21b15b5bfc51f4ec1f57c63e37ab37391f514b", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7b21b15b5bfc51f4ec1f57c63e37ab37391f514b", "message": "Fix KafkaST\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-02-12T12:32:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODIyMzc5Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2543#discussion_r378223792", "bodyText": "I think this might be a problem in all other tests so it should be part of Kafka deletion prodecure (systemtest only).", "author": "Frawless", "createdAt": "2020-02-12T12:36:00Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java", "diffHunk": "@@ -1888,6 +1893,9 @@ void setup() {\n     @Override\n     protected void tearDownEnvironmentAfterEach() throws Exception {\n         super.tearDownEnvironmentAfterEach();\n+        kubeClient().getClient().configMaps().inNamespace(NAMESPACE).withName(KafkaResources.kafkaMetricsAndLogConfigMapName(CLUSTER_NAME)).delete();", "originalCommit": "7b21b15b5bfc51f4ec1f57c63e37ab37391f514b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODIyNDQyOQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2543#discussion_r378224429", "bodyText": "And probably was fixed by cascading(true) as well, but we can add this check to deletion phase of course.", "author": "Frawless", "createdAt": "2020-02-12T12:37:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODIyMzc5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODIyNTU1Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2543#discussion_r378225557", "bodyText": "@scholzj Does this CM set OwnerRef to the kafka resource or should we remember about deleting CM when the Kafka CR is removed?\nI am not sure whether this is an issue because the CM should be replaced at the moment the Kafka resource is created. But specifically in the test testConsumerOffsetFiles, it caused the kafka pods were rolled immediately after they were created (and in ready status).", "author": "sknot-rh", "createdAt": "2020-02-12T12:40:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODIyMzc5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI2MDEzMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2543#discussion_r378260130", "bodyText": "@stanlyDoge IIRC the metrics and log CM is supplied by the user, so it's not considered a child resource of the CR (i.e. ownerRef not set).", "author": "tombentley", "createdAt": "2020-02-12T13:48:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODIyMzc5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODIyNDEzNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2543#discussion_r378224135", "bodyText": "This might be fixed by cascading(true) for CR deletion which was merged this morning", "author": "Frawless", "createdAt": "2020-02-12T12:36:46Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/KafkaST.java", "diffHunk": "@@ -1888,6 +1893,9 @@ void setup() {\n     @Override\n     protected void tearDownEnvironmentAfterEach() throws Exception {\n         super.tearDownEnvironmentAfterEach();\n+        kubeClient().getClient().configMaps().inNamespace(NAMESPACE).withName(KafkaResources.kafkaMetricsAndLogConfigMapName(CLUSTER_NAME)).delete();\n+        kubeClient().getClient().configMaps().inNamespace(NAMESPACE).withName(KafkaResources.zookeeperMetricsAndLogConfigMapName(CLUSTER_NAME)).delete();\n+        kubeClient().getClient().customResources(Crds.topic(), KafkaTopic.class, KafkaTopicList.class, DoneableKafkaTopic.class).inNamespace(NAMESPACE).delete();", "originalCommit": "7b21b15b5bfc51f4ec1f57c63e37ab37391f514b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "64e1639c4c4d18b9b608e3936d9002e59ae48b79", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/64e1639c4c4d18b9b608e3936d9002e59ae48b79", "message": "suggestion\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-02-18T13:22:41Z", "type": "commit"}, {"oid": "f545d0d9650e477a5e5adf1a4badbcdc948b2fe8", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f545d0d9650e477a5e5adf1a4badbcdc948b2fe8", "message": "checkstyle\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-02-18T14:20:27Z", "type": "commit"}]}