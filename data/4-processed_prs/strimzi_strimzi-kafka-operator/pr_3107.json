{"pr_number": 3107, "pr_title": "[DOC] Cruise Control documentation updates", "pr_createdAt": "2020-05-27T13:57:35Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107", "timeline": [{"oid": "b0ed9df04f815f91c0f342d46eb2ae7e9eb6fd4d", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b0ed9df04f815f91c0f342d46eb2ae7e9eb6fd4d", "message": "Daniel's proofread plus terminology\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-05-27T09:59:41Z", "type": "commit"}, {"oid": "b82d01e017064d0f9fdd0d6f6255ad868d242c91", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b82d01e017064d0f9fdd0d6f6255ad868d242c91", "message": "Changed apiVersion to v1alpha1 in KafkaRebalance\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-05-27T10:49:55Z", "type": "commit"}, {"oid": "97c5bc84e931e4b6780533cb3c0d8ad90d016af1", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/97c5bc84e931e4b6780533cb3c0d8ad90d016af1", "message": "Add skip_hard_goal_check=true note (QE)\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-05-27T11:18:55Z", "type": "commit"}, {"oid": "d7ca0df5173714e7716b40f4354c1b11237c0610", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d7ca0df5173714e7716b40f4354c1b11237c0610", "message": "Fixed broken cross-refs\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-05-27T13:15:13Z", "type": "commit"}, {"oid": "a74d295fe8c8e9267dcc32bcef69ed0b863e9cab", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/a74d295fe8c8e9267dcc32bcef69ed0b863e9cab", "message": "Changed anchor links to cross-refs\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-05-27T13:22:43Z", "type": "commit"}, {"oid": "9f189b4cea2af241575d8c40d3beedaabf0721d4", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/9f189b4cea2af241575d8c40d3beedaabf0721d4", "message": "Removed goals: {} empty config\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-05-27T14:43:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIxNDE3NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431214175", "bodyText": "do we need to use a specific number here (six)? If something changes in the future with less or more hard goals I think we will totally forget to update this number. I am pretty sure :-) Maybe just using \"some\" ... or your call ;-)", "author": "ppatierno", "createdAt": "2020-05-27T15:06:44Z", "path": "documentation/modules/cruise-control/con-optimization-goals.adoc", "diffHunk": "@@ -30,66 +30,91 @@ For more information on each optimization goal, see link:https://github.com/link\n \n NOTE: CPU goals, intra-broker disk goals, \"Write your own\" goals, and Kafka assigner goals are not yet supported.\n \n-As described in the following sections, you can customize the supported optimization goals by reordering them in terms of priority, and disabling goals to exclude from optimization proposal calculations.\n-\n [discrete]\n-== Goals configuration in {ProductName}\n+== Goals configuration in {ProductName} custom resources\n \n-You configure optimization goals in the `Kafka` and `KafkaRebalance` custom resources. Cruise Control has configurations for link:#hard-soft-goals[hard] optimization goals that must be satisfied, as well as link:#master-goals[master], link:#default-goals[default], and link:#user-provided-goals[user-provided] optimization goals.\n+You configure optimization goals in `Kafka` and `KafkaRebalance` custom resources. Cruise Control has configurations for xref:#hard-soft-goals[_hard_] optimization goals that must be satisfied, as well as xref:#master-goals[_master_], xref:#default-goals[_default_], and xref:#user-provided-goals[_user-provided_] optimization goals. \n+Optimization goals are subject to any xref:#capacity-configuration[_capacity limits_] on broker resources.\n \n The following sections describe each goal configuration in more detail.\n \n [#hard-soft-goals]\n [discrete]\n === Hard goals and soft goals\n \n-_Hard goals_ are goals that _must_ be satisfied in optimization proposals. \n-Goals that are not hard goals are known as _soft goals_, and might not be satisfied by optimization proposals. \n+Hard goals are goals that _must_ be satisfied in optimization proposals. \n+Goals that are not configured as hard goals are known as _soft goals_. \n You can think of soft goals as _best effort_ goals: they do _not_ need to be satisfied in optimization proposals, but are included in optimization calculations.\n An optimization proposal that violates one or more soft goals, but satisfies all hard goals, is valid.\n \n-Cruise control will calculate optimization proposals that satisfy all the hard goals and as many soft goals as possible (in their priority order). \n+Cruise Control will calculate optimization proposals that satisfy all the hard goals and as many soft goals as possible (in their priority order). \n An optimization proposal that does _not_ satisfy all the hard goals is rejected by Cruise Control and not sent to the user for approval.\n \n NOTE: For example, you might have a soft goal to distribute a topic's replicas evenly across the cluster (the topic replica distribution goal). \n Cruise Control will ignore this goal if doing so enables all the configured hard goals to be met.\n \n-In Cruise Control, six of the link:#master-goals[master optimization goals] are preset as hard goals:\n+In Cruise Control, six of the xref:#master-goals[master optimization goals] are preset as hard goals:", "originalCommit": "9f189b4cea2af241575d8c40d3beedaabf0721d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg3ODIxMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431878212", "bodyText": "Will change to say \"the following master optimization goals\".\nAlso, there are five not six (I removed the CPU goal). D'oh!", "author": "laidan6000", "createdAt": "2020-05-28T14:28:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIxNDE3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIxNTkxMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431215911", "bodyText": "Again a number here (Six) I would avoid that as I mentioned before", "author": "ppatierno", "createdAt": "2020-05-27T15:09:03Z", "path": "documentation/modules/cruise-control/con-optimization-goals.adoc", "diffHunk": "@@ -30,66 +30,91 @@ For more information on each optimization goal, see link:https://github.com/link\n \n NOTE: CPU goals, intra-broker disk goals, \"Write your own\" goals, and Kafka assigner goals are not yet supported.\n \n-As described in the following sections, you can customize the supported optimization goals by reordering them in terms of priority, and disabling goals to exclude from optimization proposal calculations.\n-\n [discrete]\n-== Goals configuration in {ProductName}\n+== Goals configuration in {ProductName} custom resources\n \n-You configure optimization goals in the `Kafka` and `KafkaRebalance` custom resources. Cruise Control has configurations for link:#hard-soft-goals[hard] optimization goals that must be satisfied, as well as link:#master-goals[master], link:#default-goals[default], and link:#user-provided-goals[user-provided] optimization goals.\n+You configure optimization goals in `Kafka` and `KafkaRebalance` custom resources. Cruise Control has configurations for xref:#hard-soft-goals[_hard_] optimization goals that must be satisfied, as well as xref:#master-goals[_master_], xref:#default-goals[_default_], and xref:#user-provided-goals[_user-provided_] optimization goals. \n+Optimization goals are subject to any xref:#capacity-configuration[_capacity limits_] on broker resources.\n \n The following sections describe each goal configuration in more detail.\n \n [#hard-soft-goals]\n [discrete]\n === Hard goals and soft goals\n \n-_Hard goals_ are goals that _must_ be satisfied in optimization proposals. \n-Goals that are not hard goals are known as _soft goals_, and might not be satisfied by optimization proposals. \n+Hard goals are goals that _must_ be satisfied in optimization proposals. \n+Goals that are not configured as hard goals are known as _soft goals_. \n You can think of soft goals as _best effort_ goals: they do _not_ need to be satisfied in optimization proposals, but are included in optimization calculations.\n An optimization proposal that violates one or more soft goals, but satisfies all hard goals, is valid.\n \n-Cruise control will calculate optimization proposals that satisfy all the hard goals and as many soft goals as possible (in their priority order). \n+Cruise Control will calculate optimization proposals that satisfy all the hard goals and as many soft goals as possible (in their priority order). \n An optimization proposal that does _not_ satisfy all the hard goals is rejected by Cruise Control and not sent to the user for approval.\n \n NOTE: For example, you might have a soft goal to distribute a topic's replicas evenly across the cluster (the topic replica distribution goal). \n Cruise Control will ignore this goal if doing so enables all the configured hard goals to be met.\n \n-In Cruise Control, six of the link:#master-goals[master optimization goals] are preset as hard goals:\n+In Cruise Control, six of the xref:#master-goals[master optimization goals] are preset as hard goals:\n \n [source]\n-RackAwareGoal; ReplicaCapacityGoal; DiskCapacityGoal; NetworkInboundCapacityGoal; NetworkOutboundCapacityGoal; CpuCapacityGoal\n+RackAwareGoal; ReplicaCapacityGoal; DiskCapacityGoal; NetworkInboundCapacityGoal; NetworkOutboundCapacityGoal\n \n-Hard goals are controlled in the Cruise Control deployment configuration, by editing the `hard.goals` property in `Kafka.spec.cruiseControl.config`.\n+You configure hard goals in the Cruise Control deployment configuration, by editing the `hard.goals` property in `Kafka.spec.cruiseControl.config`.\n \n * To inherit the six preset hard goals from Cruise Control, do not specify the `hard.goals` property in `Kafka.spec.cruiseControl.config`\n \n-* To change the preset hard goals, specify the desired goals in the `hard.goals` configuration option.\n+* To change the preset hard goals, specify the desired goals in the `hard.goals` property, using their fully-qualified domain names.\n \n-Increasing the number of hard goals will reduce the likelihood of Cruise Control generating valid optimization proposals.\n+.Example `Kafka` configuration for hard optimization goals\n+[source,yaml,subs=\"attributes+\"]\n+----\n+apiVersion: {KafkaApiVersion}\n+kind: Kafka\n+metadata:\n+  name: my-cluster\n+spec:\n+  kafka:\n+    # ...\n+  zookeeper:\n+    # ...\n+  entityOperator:\n+    topicOperator: {}\n+    userOperator: {}\n+  cruiseControl:\n+    capacity:\n+      networkIn: 10000KB/s\n+      networkOut: 10000KB/s\n+    config:\n+      hard.goals: >\n+        com.linkedin.kafka.cruisecontrol.analyzer.goals.NetworkInboundCapacityGoal,\n+        com.linkedin.kafka.cruisecontrol.analyzer.goals.NetworkOutboundCapacityGoal\n+      # ...\n+----\n+\n+Increasing the number of configured hard goals will reduce the likelihood of Cruise Control generating valid optimization proposals.\n \n-NOTE: If `skipHardGoalCheck: true` is specified in the `KafkaRebalance` custom resource, Cruise Control does not check that the list of user-provided optimization goals (`goals`) contains _all_ the configured hard goals (`hard.goals`). Therefore, if some, but not all, of the user-provided optimization goals are in the `hard.goals` list, Cruise Control will still treat them as hard goals even if `skipHardGoalCheck: true` is specified.\n+If `skipHardGoalCheck: true` is specified in the `KafkaRebalance` custom resource, Cruise Control does not check that the list of user-provided optimization goals (`goals`) contains _all_ the configured hard goals (`hard.goals`). Therefore, if some, but not all, of the user-provided optimization goals are in the `hard.goals` list, Cruise Control will still treat them as hard goals even if `skipHardGoalCheck: true` is specified.\n \n [#master-goals]\n [discrete]\n === Master optimization goals\n \n The _master optimization goals_ are available to all users.\n-Goals that are not listed in the master optimization goals are not available to use for Cruise Control operations.\n+Goals that are not listed in the master optimization goals are not available for use in Cruise Control operations.\n \n Unless you change the Cruise Control xref:proc-deploying-cruise-control-{context}[deployment configuration], {ProductName} will inherit the following master optimization goals from Cruise Control, in descending priority order:\n \n [source]\n-RackAwareGoal; ReplicaCapacityGoal; DiskCapacityGoal; NetworkInboundCapacityGoal; NetworkOutboundCapacityGoal; CpuCapacityGoal; ReplicaDistributionGoal; PotentialNwOutGoal; DiskUsageDistributionGoal; NetworkInboundUsageDistributionGoal; NetworkOutboundUsageDistributionGoal; CpuUsageDistributionGoal; TopicReplicaDistributionGoal; LeaderReplicaDistributionGoal; LeaderBytesInDistributionGoal; PreferredLeaderElectionGoal\n+RackAwareGoal; ReplicaCapacityGoal; DiskCapacityGoal; NetworkInboundCapacityGoal; NetworkOutboundCapacityGoal; ReplicaDistributionGoal; PotentialNwOutGoal; DiskUsageDistributionGoal; NetworkInboundUsageDistributionGoal; NetworkOutboundUsageDistributionGoal; TopicReplicaDistributionGoal; LeaderReplicaDistributionGoal; LeaderBytesInDistributionGoal; PreferredLeaderElectionGoal\n \n-Six of these goals are preset as link:#hard-soft-goals[hard goals].\n+Six of these goals are preset as xref:#hard-soft-goals[hard goals].", "originalCommit": "9f189b4cea2af241575d8c40d3beedaabf0721d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY4MDM4OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431680388", "bodyText": "Could we change this to \"not currently supported\"? We will most likely be add topic replication in the future, not sure about slack notifications though? Maybe change slack notifications to something ore general like \"anomaly notifications\"", "author": "tomncooper", "createdAt": "2020-05-28T08:49:34Z", "path": "documentation/assemblies/cruise-control/assembly-cruise-control-concepts.adoc", "diffHunk": "@@ -3,11 +3,16 @@\n // master.adoc\n \n [id='cruise-control-concepts-{context}']\n-= Cruise Control\n+= Cruise Control for cluster rebalancing\n \n-You can deploy {CruiseControlProject} and access a subset of its features through {ProductName} custom resources.\n+You can deploy {CruiseControlProject} to your {ProductName} cluster and access its _cluster rebalancing_ feature through custom resources.\n \n-Example YAML files for deploying Cruise Control and setting optimization goals are provided in `examples/cruise-control/`.\n+Cruise Control is an open source system for automating Kafka operations, including monitoring cluster workload, rebalancing a cluster based on predefined constraints, and detecting and fixing anomalies, among others. \n+It consists of four main components--the Load Monitor, the Analyzer, the Anomaly Detector, and the Executor--and a REST API for all interactions.\n+{ProductName} utilizes the REST API to support the cluster rebalancing features of Cruise Control.\n+Other features, such as anomaly detection, Slack notifications, and changing the topic replication factor, are not supported.", "originalCommit": "9f189b4cea2af241575d8c40d3beedaabf0721d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY4OTMzMw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431689333", "bodyText": "So I don't really understand this point. The issue would come if the configured hard.goals had more than those two goals in? If master goals had these two in and so did hard.goals then you would be fine.\nThis highlights another issue that we should highlight that if a user changes master goals they should also make sure that they make sure hard.goals is still a subset of the new master goals or strange errors will occur (in the CC release we are using, the latest release adds more checks that would fail to start if the user messed this up).", "author": "tomncooper", "createdAt": "2020-05-28T09:04:34Z", "path": "documentation/modules/cruise-control/proc-generating-optimization-proposals.adoc", "diffHunk": "@@ -49,6 +49,8 @@ spec:\n     - RackAwareGoal\n     - ReplicaCapacityGoal\n ----\n++\n+In the above example, if `RackAwareGoal` and `ReplicaCapacityGoal` are configured as the only master optimization goals (in `Kafka.spec.cruiseControl.config.goals`), you must add `skip_hard_goal_check=true` to the Cruise Control deployment configuration. Otherwise an error will occur. ", "originalCommit": "9f189b4cea2af241575d8c40d3beedaabf0721d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDk2Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431744962", "bodyText": "This was issue that I mentioned, 'cause I was curious about it -> if you set for example these two hard.goals and then apply the KafkaRebalance, again with these two hard.goals the error will occur -> it shows something like tried to find [all hard goals] in [rackAwareGoal, replicaCapacityGoal] or something like that.", "author": "im-konge", "createdAt": "2020-05-28T10:45:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY4OTMzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NTMwMw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431745303", "bodyText": "And it's because of me that @laidan6000 add this point, because I found it when I was testing the documentation.", "author": "im-konge", "createdAt": "2020-05-28T10:46:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY4OTMzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc1MzE3OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431753179", "bodyText": "The issue is that the default hard.goals list has 5 (I think) goals in it. So if you set master goals to a list that does not include all those hard.goals then you will fail every rebalance (unless you set skip hard goals) and every periodic cached proposal calculation will fail as well.\nThis will be fixed in the next strimzi release because I filed an issue for it and it has been fixed in the latest upstream CC release. We can add some additional sanity checks as well if we need to.\nFor the current release we need to document that the user must make sure that if they change the master goals that they also make sure that hard.goals is a subset of the master goals they set.", "author": "tomncooper", "createdAt": "2020-05-28T11:01:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY4OTMzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg3MzU0NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431873545", "bodyText": "Okay, thanks for the explanation and the issue you created for CC team. I tested it like (because I was) a customer and it wasn't clear for me for the first look.\nSo from my POV it would be nice to have some note about what you mentioned.", "author": "im-konge", "createdAt": "2020-05-28T14:22:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY4OTMzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM3MjMxOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r432372318", "bodyText": "I removed the sentence referred to above in line 53.\nI added the following note to the master optimization goals section:\nNOTE: If you change the inherited master optimization goals, you must ensure that the hard goals, if configured in the hard.goals property in Kafka.spec.cruiseControl.config, are a subset of the master optimization goals that you configured. Otherwise, errors will occur when generating optimization proposals.", "author": "laidan6000", "createdAt": "2020-05-29T09:40:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY4OTMzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQwMzUwOQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r432403509", "bodyText": "Good that you have added the note, but there is not enough context in this sentence for it to be meaningful. For the sentence to be true, a user would have had to break the rule we just outlined in the note in the master goals section? I think it would be better to remove this sentence all together.", "author": "tomncooper", "createdAt": "2020-05-29T10:44:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY4OTMzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQyMDk0Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r432420947", "bodyText": "OK. I have actually removed the sentence from the generating... procedure. Glad you're happy with the new NOTE.", "author": "laidan6000", "createdAt": "2020-05-29T11:24:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY4OTMzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY5MTM5NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431691395", "bodyText": "\"If a hard goal is broken\"", "author": "tomncooper", "createdAt": "2020-05-28T09:08:07Z", "path": "documentation/modules/cruise-control/ref-cruise-control-configuration.adoc", "diffHunk": "@@ -57,11 +57,13 @@ spec:\n       send.buffer.bytes: 131072\n     # ...\n ----\n+\n+[#capacity-configuration]\n+[discrete]\n == Capacity configuration\n \n Cruise Control uses _capacity limits_ to determine if optimization goals for broker resources are being broken.\n-An optimization will fail if a goal is broken, preventing the optimization from being used to generate an optimization proposal for balanced partition assignments.\n-For example, an optimization that would cause a broker to exceed its CPU capacity would not be used if the `CpuCapacityGoal` is set as a hard goal.\n+An optimization will fail if a goal is broken, preventing the optimization from being used to generate an optimization proposal.", "originalCommit": "9f189b4cea2af241575d8c40d3beedaabf0721d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTczNTE0Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431735143", "bodyText": "Not sure we need among others if we say including", "author": "PaulRMellor", "createdAt": "2020-05-28T10:26:10Z", "path": "documentation/assemblies/cruise-control/assembly-cruise-control-concepts.adoc", "diffHunk": "@@ -3,11 +3,16 @@\n // master.adoc\n \n [id='cruise-control-concepts-{context}']\n-= Cruise Control\n+= Cruise Control for cluster rebalancing\n \n-You can deploy {CruiseControlProject} and access a subset of its features through {ProductName} custom resources.\n+You can deploy {CruiseControlProject} to your {ProductName} cluster and access its _cluster rebalancing_ feature through custom resources.\n \n-Example YAML files for deploying Cruise Control and setting optimization goals are provided in `examples/cruise-control/`.\n+Cruise Control is an open source system for automating Kafka operations, including monitoring cluster workload, rebalancing a cluster based on predefined constraints, and detecting and fixing anomalies, among others. ", "originalCommit": "9f189b4cea2af241575d8c40d3beedaabf0721d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg4Mzk5NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431883995", "bodyText": "Good point. Changed to \"such as\" and removed \"among other\".", "author": "laidan6000", "createdAt": "2020-05-28T14:34:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTczNTE0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTczODk4MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431738980", "bodyText": "Do we want to list things we don't support here like anomaly detection? Maybe we could  be clear in this intro what is supported. Strimzi currently supports the <> features of Cruise Control", "author": "PaulRMellor", "createdAt": "2020-05-28T10:33:36Z", "path": "documentation/assemblies/cruise-control/assembly-cruise-control-concepts.adoc", "diffHunk": "@@ -3,11 +3,16 @@\n // master.adoc\n \n [id='cruise-control-concepts-{context}']\n-= Cruise Control\n+= Cruise Control for cluster rebalancing\n \n-You can deploy {CruiseControlProject} and access a subset of its features through {ProductName} custom resources.\n+You can deploy {CruiseControlProject} to your {ProductName} cluster and access its _cluster rebalancing_ feature through custom resources.\n \n-Example YAML files for deploying Cruise Control and setting optimization goals are provided in `examples/cruise-control/`.\n+Cruise Control is an open source system for automating Kafka operations, including monitoring cluster workload, rebalancing a cluster based on predefined constraints, and detecting and fixing anomalies, among others. ", "originalCommit": "9f189b4cea2af241575d8c40d3beedaabf0721d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg4Njg0OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431886848", "bodyText": "Right. It's not that helpful to start with an explanation what we don't support.\nI'll add a list of supported features as you suggest, and relegate the not supported features to a note.", "author": "laidan6000", "createdAt": "2020-05-28T14:37:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTczODk4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0MDg2OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431740868", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            These are as follows, in the default descending priority order:\n          \n          \n            \n            The supported goals, in the default descending order of priority, are as follows:", "author": "PaulRMellor", "createdAt": "2020-05-28T10:37:20Z", "path": "documentation/modules/cruise-control/con-optimization-goals.adoc", "diffHunk": "@@ -9,7 +9,7 @@ To rebalance a Kafka cluster, Cruise Control uses optimization goals to generate\n \n Optimization goals are constraints on workload redistribution and resource utilization across a Kafka cluster.\n With a few exceptions, {ProductName} supports all the optimization goals developed in the Cruise Control project.\n-These are as follows, in descending priority order:\n+These are as follows, in the default descending priority order:", "originalCommit": "9f189b4cea2af241575d8c40d3beedaabf0721d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDkwMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431744900", "bodyText": "link#capacity-configuration. xref?", "author": "PaulRMellor", "createdAt": "2020-05-28T10:45:20Z", "path": "documentation/modules/cruise-control/con-optimization-proposals.adoc", "diffHunk": "@@ -7,15 +7,17 @@\n = Optimization proposals overview\n \n An _optimization proposal_ is a summary of proposed changes that would produce a more balanced Kafka cluster, with partition workloads distributed more evenly among the brokers. \n-Each optimization proposal is based on the set of xref:con-optimization-goals-{context}[optimization goals] that were used to generate it.\n+Each optimization proposal is based on the set of xref:con-optimization-goals-{context}[optimization goals] that was used to generate it, subject to any configured link#capacity-configuration[capacity limits on broker resources].", "originalCommit": "9f189b4cea2af241575d8c40d3beedaabf0721d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NTYzNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431745634", "bodyText": "Maybe the content in brackets doesn't need to be", "author": "PaulRMellor", "createdAt": "2020-05-28T10:46:49Z", "path": "documentation/modules/cruise-control/con-optimization-proposals.adoc", "diffHunk": "@@ -56,7 +58,7 @@ m\u00a6numReplicaMovements\n m\u00a6onDemandBalancednessScoreBefore, onDemandBalancednessScoreAfter\n \u00a6A measurement of the overall _balancedness_ of a Kafka Cluster, before and after the optimization proposal was generated.\n \n-The calculation is 100 minus the sum of the `BalancednessScore` of each violated soft goal. Cruise Control assigns a `BalancednessScore` to every optimization goal based on several factors, including priority (the goal's position in the list of `default.goals` or user-provided goals).\n+The score is calculated by subtracting the sum of the `BalancednessScore` of each violated soft goal from 100. Cruise Control assigns a `BalancednessScore` to every optimization goal based on several factors, including priority (the goal's position in the list of `default.goals` or user-provided goals).", "originalCommit": "9f189b4cea2af241575d8c40d3beedaabf0721d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NzQyNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431747425", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            You can provide any xref:ref-cruise-control-configuration-{context}[standard configuration option] apart from those managed directly by {ProductName}. \n          \n          \n            \n            You can provide any xref:ref-cruise-control-configuration-{context}[standard Cruise Control configuration option] apart from those managed directly by {ProductName}.", "author": "PaulRMellor", "createdAt": "2020-05-28T10:50:14Z", "path": "documentation/modules/cruise-control/proc-deploying-cruise-control.adoc", "diffHunk": "@@ -89,10 +80,12 @@ spec:\n       timeoutSeconds: 5\n # ...\n ----\n-<1> Specifies capacity limits for broker resources. For more information, see xref:capacity_configuration[Capacity configuration].\n-<2> Defines the Cruise Control configuration, including default and enabled optimization goals. You can provide any xref:ref-cruise-control-configuration-{context}[standard configuration option] apart from those managed directly by {ProductName}.\n+<1> Specifies capacity limits for broker resources. For more information, see xref:#capacity-configuration[Capacity configuration].\n+<2> Defines the Cruise Control configuration, including the default optimization goals (in `default.goals`) and any customizations to the master optimization goals (in `goals`) or the hard goals (in `hard.goals`). \n+You can provide any xref:ref-cruise-control-configuration-{context}[standard configuration option] apart from those managed directly by {ProductName}. ", "originalCommit": "9f189b4cea2af241575d8c40d3beedaabf0721d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0Nzk0Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431747942", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <4> Defined loggers and log levels added directly (inline) or indirectly (external) through a ConfigMap. A custom ConfigMap must be placed under the log4j.properties key. Cruise Control has a single logger called cruisecontrol.root.logger. You can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF. For more information, see xref:#logging-configuration[Logging configuration].\n          \n          \n            \n            <4> Defined loggers and log levels added directly (inline) or indirectly (external) through a ConfigMap. A custom ConfigMap must be placed under the log4j.properties key. Cruise Control has a single logger called `cruisecontrol.root.logger`. You can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF. For more information, see xref:#logging-configuration[Logging configuration].", "author": "PaulRMellor", "createdAt": "2020-05-28T10:51:15Z", "path": "documentation/modules/cruise-control/proc-deploying-cruise-control.adoc", "diffHunk": "@@ -89,10 +80,12 @@ spec:\n       timeoutSeconds: 5\n # ...\n ----\n-<1> Specifies capacity limits for broker resources. For more information, see xref:capacity_configuration[Capacity configuration].\n-<2> Defines the Cruise Control configuration, including default and enabled optimization goals. You can provide any xref:ref-cruise-control-configuration-{context}[standard configuration option] apart from those managed directly by {ProductName}.\n+<1> Specifies capacity limits for broker resources. For more information, see xref:#capacity-configuration[Capacity configuration].\n+<2> Defines the Cruise Control configuration, including the default optimization goals (in `default.goals`) and any customizations to the master optimization goals (in `goals`) or the hard goals (in `hard.goals`). \n+You can provide any xref:ref-cruise-control-configuration-{context}[standard configuration option] apart from those managed directly by {ProductName}. \n+For more information on configuring optimization goals, see xref:con-optimization-goals-{context}[]. \n <3> CPU and memory resources reserved for Cruise Control. For more information, see xref:assembly-resource-limits-and-requests-deployment-configuration-kafka[].\n-<4> Defined loggers and log levels added directly (inline) or indirectly (external) through a ConfigMap. A custom ConfigMap must be placed under the log4j.properties key. Cruise Control has a single logger called cruisecontrol.root.logger. You can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF. For more information, see xref:logging_configuration[Logging configuration].\n+<4> Defined loggers and log levels added directly (inline) or indirectly (external) through a ConfigMap. A custom ConfigMap must be placed under the log4j.properties key. Cruise Control has a single logger called cruisecontrol.root.logger. You can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF. For more information, see xref:#logging-configuration[Logging configuration].", "originalCommit": "9f189b4cea2af241575d8c40d3beedaabf0721d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0ODU4OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431748588", "bodyText": "Should we have an attribute for this to future-proof?", "author": "PaulRMellor", "createdAt": "2020-05-28T10:52:35Z", "path": "documentation/modules/cruise-control/proc-generating-optimization-proposals.adoc", "diffHunk": "@@ -23,7 +23,7 @@ You can then analyze the summary information in the optimization proposal and de\n +\n [source,yaml,subs=\"attributes+\"]\n ----\n-apiVersion: {KafkaApiVersion}\n+apiVersion: kafka.strimzi.io/v1alpha1", "originalCommit": "9f189b4cea2af241575d8c40d3beedaabf0721d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkyODcyOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431928728", "bodyText": "I added a new :KafkaApiVersionAlpha: attribute.", "author": "laidan6000", "createdAt": "2020-05-28T15:31:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0ODU4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkzMjc3Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431932777", "bodyText": "What is the value of having all these as variables? I can understand the value as long as we had all resources using the same API version and upgrading them was as easy as changing the variable. But we have now many CRD and they have their own version lifecycle. So having the variable has no value. You would still need to go through the docs and replace the variables manually.  So I think we should actually drop this from everywhere and have the API version directly in the examples (this is also where #3084 leads)", "author": "scholzj", "createdAt": "2020-05-28T15:37:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0ODU4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjMxNDc2OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r432314769", "bodyText": "Alright, I see your point. I've removed the new variable from this PR.", "author": "laidan6000", "createdAt": "2020-05-29T07:51:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0ODU4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc1MDI1Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431750253", "bodyText": "Can we make this clearer: the different properties", "author": "PaulRMellor", "createdAt": "2020-05-28T10:55:49Z", "path": "documentation/modules/cruise-control/proc-generating-optimization-proposals.adoc", "diffHunk": "@@ -107,7 +109,7 @@ Status:\n   Session Id:                             05539377-ca7b-45ef-b359-e13564f1458c\n ----\n +\n-For information about the different properties, see link:#contents-optimization-proposals[Contents of optimization proposals]. \n+For information about the different properties, see xref:#contents-optimization-proposals[Contents of optimization proposals]. ", "originalCommit": "9f189b4cea2af241575d8c40d3beedaabf0721d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc1MjQ4OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r431752489", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The Cruise Control metric reporters will attempt to disable log compaction for the `strimzi.cruisecontrol.metrics` topic but will fail if they are started with a new Kafka cluster.\n          \n          \n            \n            The Cruise Control metric reporters will attempt to disable log compaction for the `strimzi.cruisecontrol.metrics` topic, but will fail if they are started with a new Kafka cluster.", "author": "PaulRMellor", "createdAt": "2020-05-28T11:00:13Z", "path": "documentation/modules/cruise-control/ref-cruise-control-configuration.adoc", "diffHunk": "@@ -92,35 +94,38 @@ spec:\n     # ...\n ----\n \n-\n .Additional resources\n For more information, refer to the xref:type-BrokerCapacity-reference[].\n \n-== Topic creation and configuration\n+[#auto-created-topics-logs]\n+[discrete]\n+== Auto-created topics and log compaction\n \n-Cruise Control requires the following three topics to be created in order to function properly:\n+Cruise Control requires the following three topics in order to work:\n \n * `strimzi.cruisecontrol.partitionmetricsamples`\n * `strimzi.cruisecontrol.modeltrainingsamples`\n * `strimzi.cruisecontrol.metrics`\n \n-Cruise Control will create the `strimzi.cruisecontrol.partitionmetricsamples` and `strimzi.cruisecontrol.modeltrainingsamples` topics after the Cruise Control metric reporters create the `strimzi.cruisecontrol.metrics` topic.\n-However, if automatic topic creation is disabled in Kafka with a configuration of `auto.create.topics.enable: false` in `spec.kafka.config` when starting a new Kafka cluster, the Cruise Control metric reporters will be unable to create the `strimzi.cruisecontrol.metrics` topic.\n-In this situation, the `strimzi.cruisecontrol.metrics` topic will need to be created manually.\n+These three topics are usually auto-created by {ProductName} and Cruise Control. First, the metric reporters create the `strimzi.cruisecontrol.metrics` topic. \n+Then, Cruise Control creates the `strimzi.cruisecontrol.partitionmetricsamples` and `strimzi.cruisecontrol.modeltrainingsamples` topics.\n+\n+However, if automatic topic creation is _disabled_ in Kafka (`auto.create.topics.enable: false` is configured in `spec.kafka.config` when starting a new Kafka cluster) the Cruise Control metric reporters are unable to create the `strimzi.cruisecontrol.metrics` topic.\n+In this situation, you need to manually create the `strimzi.cruisecontrol.metrics` topic before deploying Cruise Control. \n+You can do this using the following command:\n \n-To manually create the `strimzi.cruisecontrol.metrics` Cruise Control topic in your Kubernetes cluster:\n [source,shell,subs=\"attributes+\"]\n ----\n kubectl apply -f examples/cruise-control/cruise-control-topic.yaml\n ----\n \n Since log compaction may remove records needed by Cruise Control, all topics created by Cruise Control must be configured with `cleanup.policy=delete` to disable log compaction.\n Cruise Control will automatically disable log compaction for the `strimzi.cruisecontrol.partitionmetricsamples` and `strimzi.cruisecontrol.modeltrainingsamples` topics.\n-The Cruise Control metric reporters will attempt to disable log compaction for the `strimzi.cruisecontrol.metrics` topic but will fail when being started with a new Kafka cluster.\n+The Cruise Control metric reporters will attempt to disable log compaction for the `strimzi.cruisecontrol.metrics` topic but will fail if they are started with a new Kafka cluster.", "originalCommit": "9f189b4cea2af241575d8c40d3beedaabf0721d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "48dc9c1dca28cecb8616b527654e26a1bad0b4f9", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/48dc9c1dca28cecb8616b527654e26a1bad0b4f9", "message": "Review comments PP\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-05-28T14:30:11Z", "type": "commit"}, {"oid": "bbe4254ba6dc0254496ee34e7c9cc58158d2bb44", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/bbe4254ba6dc0254496ee34e7c9cc58158d2bb44", "message": "List supported CC features\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-05-28T15:08:50Z", "type": "commit"}, {"oid": "3f8612584a43fe05645038fda1a46f4d4361dbee", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3f8612584a43fe05645038fda1a46f4d4361dbee", "message": "Review comments PM\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-05-28T15:30:43Z", "type": "commit"}, {"oid": "e59573cb2e56a9f248b9247a680e44b2f2062451", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e59573cb2e56a9f248b9247a680e44b2f2062451", "message": "Edited paragraph on log compaction\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-05-28T16:09:22Z", "type": "commit"}, {"oid": "17837da73f2b6e74551fce251b3331fbdf4f880e", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/17837da73f2b6e74551fce251b3331fbdf4f880e", "message": "Removed v1alpha1 variable\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-05-29T07:51:31Z", "type": "commit"}, {"oid": "31c650bfc57f517fb446958d724499aaa30c60c4", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/31c650bfc57f517fb446958d724499aaa30c60c4", "message": "Added note on master goals, plus consistency edits\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-05-29T09:36:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM5OTkzNw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r432399937", "bodyText": "I thought we has switched to using describe? We should be consistent with whichever command was used elsewhere?", "author": "tomncooper", "createdAt": "2020-05-29T10:36:19Z", "path": "documentation/modules/cruise-control/proc-fixing-problems-with-kafkarebalance.adoc", "diffHunk": "@@ -26,13 +26,20 @@ During a \u201crefresh\u201d, a new optimization proposal is requested from the Cruise\n \n .Procedure\n \n-. Get information about the error from the `KafkaRebalance` status and resolve the issue if possible.\n+. Get information about the error from the `KafkaRebalance` status:\n++\n+[source,shell,subs=\"+quotes\"]\n+----\n+kubectl get kafka kafkarebalance -o jsonpath='{.status}'", "originalCommit": "31c650bfc57f517fb446958d724499aaa30c60c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQyMzk0Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3107#discussion_r432423946", "bodyText": "Well spotted. I changed two more \"check status\" commands to use kubectl describe.", "author": "laidan6000", "createdAt": "2020-05-29T11:31:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM5OTkzNw=="}], "type": "inlineReview"}, {"oid": "229ec14c46d0da284203cce42b0878394d92eb9f", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/229ec14c46d0da284203cce42b0878394d92eb9f", "message": "Changed check status cmd to kubectl describe\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-05-29T11:30:55Z", "type": "commit"}]}