{"pr_number": 2394, "pr_title": "Fix kafka user quotas deleting", "pr_createdAt": "2020-01-14T09:16:37Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2394", "timeline": [{"oid": "5d0bf7eab872f2ae95a565060779eda3ac4565fa", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5d0bf7eab872f2ae95a565060779eda3ac4565fa", "message": "Fix kafka user quotas deleting\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-01-14T09:15:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIyNjgxNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2394#discussion_r366226814", "bodyText": "I did the test with a TLS user but in case for scram-sha why here it's not KafkaUserModel.getScramUserName(user)?", "author": "ppatierno", "createdAt": "2020-01-14T09:22:13Z", "path": "user-operator/src/main/java/io/strimzi/operator/user/operator/KafkaUserOperator.java", "diffHunk": "@@ -290,6 +290,8 @@ public KafkaUserOperator(Vertx vertx,\n         return CompositeFuture.join(secretOperations.reconcile(namespace, KafkaUserModel.getSecretName(user), null),\n                 aclOperations.reconcile(KafkaUserModel.getTlsUserName(user), null),\n                 aclOperations.reconcile(KafkaUserModel.getScramUserName(user), null),\n+                kafkaUserQuotasOperator.reconcile(KafkaUserModel.getTlsUserName(user), null),\n+                kafkaUserQuotasOperator.reconcile(user, null),", "originalCommit": "5d0bf7eab872f2ae95a565060779eda3ac4565fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIzNDI2MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2394#discussion_r366234260", "bodyText": "According to \n  \n    \n      strimzi-kafka-operator/user-operator/src/main/java/io/strimzi/operator/user/model/KafkaUserModel.java\n    \n    \n         Line 343\n      in\n      a11e4b3\n    \n    \n    \n    \n\n        \n          \n           public static String getScramUserName(String username)    { \n        \n    \n  \n\n\nit should be ok, or?", "author": "sknot-rh", "createdAt": "2020-01-14T09:37:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIyNjgxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIzNTU1Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2394#discussion_r366235553", "bodyText": "that's true but not using the method makes the code less clear, as it's used above for deleting the ACLs", "author": "ppatierno", "createdAt": "2020-01-14T09:40:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIyNjgxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIyNzUwNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2394#discussion_r366227505", "bodyText": "Is deleting both just about being extra sure that there's nothing left? Because surely you know the type of user name in use, so you ought to be able to delete it using a single delete.", "author": "tombentley", "createdAt": "2020-01-14T09:23:43Z", "path": "user-operator/src/main/java/io/strimzi/operator/user/operator/KafkaUserOperator.java", "diffHunk": "@@ -290,6 +290,8 @@ public KafkaUserOperator(Vertx vertx,\n         return CompositeFuture.join(secretOperations.reconcile(namespace, KafkaUserModel.getSecretName(user), null),\n                 aclOperations.reconcile(KafkaUserModel.getTlsUserName(user), null),\n                 aclOperations.reconcile(KafkaUserModel.getScramUserName(user), null),\n+                kafkaUserQuotasOperator.reconcile(KafkaUserModel.getTlsUserName(user), null),\n+                kafkaUserQuotasOperator.reconcile(user, null),", "originalCommit": "5d0bf7eab872f2ae95a565060779eda3ac4565fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIzNjUwMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2394#discussion_r366236501", "bodyText": "Yeah, it is just about being sure. Should I leave there just the second option (kafkaUserQuotasOperator.reconcile(user, null))?", "author": "sknot-rh", "createdAt": "2020-01-14T09:41:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIyNzUwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI0MjQxOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2394#discussion_r366242418", "bodyText": "but in case of TLS user we have \"CN=\" as prefix, it's not just user, or?", "author": "ppatierno", "createdAt": "2020-01-14T09:53:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIyNzUwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI4NDMyNw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2394#discussion_r366284327", "bodyText": "Mm, yes you are right.", "author": "sknot-rh", "createdAt": "2020-01-14T11:22:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIyNzUwNQ=="}], "type": "inlineReview"}, {"oid": "8fbb4a6d41145d2405afd68259142516ef9d5b7f", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8fbb4a6d41145d2405afd68259142516ef9d5b7f", "message": "use scram name\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-01-14T09:42:53Z", "type": "commit"}, {"oid": "be5501a4a81ce211d4bc73bc61fd6d31e3ca3f1e", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/be5501a4a81ce211d4bc73bc61fd6d31e3ca3f1e", "message": "mocking\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-01-14T10:24:32Z", "type": "commit"}]}