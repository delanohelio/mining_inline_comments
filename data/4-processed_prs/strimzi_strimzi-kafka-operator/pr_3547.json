{"pr_number": 3547, "pr_title": "[DOC] enhancement for certificate renewal sections to clarify how validity periods are checked and managed", "pr_createdAt": "2020-08-25T17:13:55Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3547", "timeline": [{"oid": "e6463f92beb9b4a317d2160a2e26286c415dcc28", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e6463f92beb9b4a317d2160a2e26286c415dcc28", "message": "[DOC] enhancement for certificate renewal sections to clarify how validity periods are checked and managed\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-08-25T17:11:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY4MzU0Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3547#discussion_r476683546", "bodyText": "I think you should clarify that if you don't trigger manual renewal it will be used next time the certificate is renewed. Even that might be useful for some users.", "author": "scholzj", "createdAt": "2020-08-25T19:22:51Z", "path": "documentation/modules/security/con-certificate-renewal.adoc", "diffHunk": "@@ -26,7 +39,30 @@ Not Before                                     Not After\n                               <--- renewalDays --->|\n ----\n \n-The behavior of the Cluster Operator during the renewal period depends on whether the relevant setting is enabled, in either `Kafka.spec.clusterCa.generateCertificateAuthority` or `Kafka.spec.clientsCa.generateCertificateAuthority`.\n+To make a change to the validity and renewal periods after creating the Kafka cluster, you configure and apply the `Kafka` custom resource,\n+and xref:proc-renewing-ca-certs-manually-{context}[renew the CA certificates].", "originalCommit": "e6463f92beb9b4a317d2160a2e26286c415dcc28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzEwMjAxMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3547#discussion_r477102012", "bodyText": "If you do not manually renew the certificates, the periods will be used the next time the certificate is renewed automatically.", "author": "PaulRMellor", "createdAt": "2020-08-26T07:48:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY4MzU0Ng=="}], "type": "inlineReview"}, {"oid": "8771559dea2489ac8fc5f1a90d0ab4801dd8c13c", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8771559dea2489ac8fc5f1a90d0ab4801dd8c13c", "message": "review edits JS\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-08-26T07:50:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE3NTIzNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3547#discussion_r477175236", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Manually-installed CA certificates should have their own validity period defined.\n          \n          \n            \n            Manually-installed CA certificates should have their own validity periods defined.", "author": "laidan6000", "createdAt": "2020-08-26T09:44:57Z", "path": "documentation/modules/security/con-certificate-renewal.adoc", "diffHunk": "@@ -3,21 +3,34 @@\n // assembly-security.adoc\n \n [id='con-certificate-renewal-{context}']\n-= Certificate renewal\n+= Certificate renewal and validity periods\n \n-The cluster CA and clients CA certificates are only valid for a limited time period, known as the validity period.\n+Cluster CA and clients CA certificates are only valid for a limited time period, known as the validity period.\n This is usually defined as a number of days since the certificate was generated.\n-For auto-generated CA certificates, you can configure the validity period in `Kafka.spec.clusterCa.validityDays` and `Kafka.spec.clientsCa.validityDays`.\n+\n+For auto-generated CA certificates, you can configure the validity period of:\n+\n+* Cluster CA certificates in `Kafka.spec.clusterCa.validityDays`\n+* Client CA certificates in `Kafka.spec.clientsCa.validityDays`\n+\n The default validity period for both certificates is 365 days.\n Manually-installed CA certificates should have their own validity period defined.", "originalCommit": "8771559dea2489ac8fc5f1a90d0ab4801dd8c13c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE3NTczMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3547#discussion_r477175732", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            When a CA certificate expires, components and clients which still trust that certificate will not accept TLS connections from peers whose certificate were signed by the CA private key.\n          \n          \n            \n            When a CA certificate expires, components and clients that still trust that certificate will not accept TLS connections from peers whose certificates were signed by the CA private key.", "author": "laidan6000", "createdAt": "2020-08-26T09:45:45Z", "path": "documentation/modules/security/con-certificate-renewal.adoc", "diffHunk": "@@ -3,21 +3,34 @@\n // assembly-security.adoc\n \n [id='con-certificate-renewal-{context}']\n-= Certificate renewal\n+= Certificate renewal and validity periods\n \n-The cluster CA and clients CA certificates are only valid for a limited time period, known as the validity period.\n+Cluster CA and clients CA certificates are only valid for a limited time period, known as the validity period.\n This is usually defined as a number of days since the certificate was generated.\n-For auto-generated CA certificates, you can configure the validity period in `Kafka.spec.clusterCa.validityDays` and `Kafka.spec.clientsCa.validityDays`.\n+\n+For auto-generated CA certificates, you can configure the validity period of:\n+\n+* Cluster CA certificates in `Kafka.spec.clusterCa.validityDays`\n+* Client CA certificates in `Kafka.spec.clientsCa.validityDays`\n+\n The default validity period for both certificates is 365 days.\n Manually-installed CA certificates should have their own validity period defined.\n \n When a CA certificate expires, components and clients which still trust that certificate will not accept TLS connections from peers whose certificate were signed by the CA private key.", "originalCommit": "8771559dea2489ac8fc5f1a90d0ab4801dd8c13c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE3NjkwMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3547#discussion_r477176900", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If you do not manually renew the certificates, the periods will be used the next time the certificate is renewed automatically.\n          \n          \n            \n            If you do not manually renew the certificates, the new periods will be used the next time the certificate is renewed automatically.", "author": "laidan6000", "createdAt": "2020-08-26T09:47:44Z", "path": "documentation/modules/security/con-certificate-renewal.adoc", "diffHunk": "@@ -26,7 +39,31 @@ Not Before                                     Not After\n                               <--- renewalDays --->|\n ----\n \n-The behavior of the Cluster Operator during the renewal period depends on whether the relevant setting is enabled, in either `Kafka.spec.clusterCa.generateCertificateAuthority` or `Kafka.spec.clientsCa.generateCertificateAuthority`.\n+To make a change to the validity and renewal periods after creating the Kafka cluster, you configure and apply the `Kafka` custom resource,\n+and xref:proc-renewing-ca-certs-manually-{context}[manually renew the CA certificates].\n+If you do not manually renew the certificates, the periods will be used the next time the certificate is renewed automatically.", "originalCommit": "8771559dea2489ac8fc5f1a90d0ab4801dd8c13c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE3NzA3Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3547#discussion_r477177073", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            .Example Kafka configuration for validity and renewal periods\n          \n          \n            \n            .Example Kafka configuration for certificate validity and renewal periods", "author": "laidan6000", "createdAt": "2020-08-26T09:48:01Z", "path": "documentation/modules/security/con-certificate-renewal.adoc", "diffHunk": "@@ -26,7 +39,31 @@ Not Before                                     Not After\n                               <--- renewalDays --->|\n ----\n \n-The behavior of the Cluster Operator during the renewal period depends on whether the relevant setting is enabled, in either `Kafka.spec.clusterCa.generateCertificateAuthority` or `Kafka.spec.clientsCa.generateCertificateAuthority`.\n+To make a change to the validity and renewal periods after creating the Kafka cluster, you configure and apply the `Kafka` custom resource,\n+and xref:proc-renewing-ca-certs-manually-{context}[manually renew the CA certificates].\n+If you do not manually renew the certificates, the periods will be used the next time the certificate is renewed automatically.\n+\n+.Example Kafka configuration for validity and renewal periods", "originalCommit": "8771559dea2489ac8fc5f1a90d0ab4801dd8c13c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE4MjczNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3547#discussion_r477182735", "bodyText": "Sorry, I'm reviewing my previous efforts now! This is a cumbersome opening sentence.\nSuggested change:\nCluster and clients CA certificates auto-renew at the start of their respective certificate renewal periods. If Kafka.spec.clusterCa.generateCertificateAuthority and Kafka.spec.clientsCa.generateCertificateAuthority are set to false, the CA certificates do not auto-renew.", "author": "laidan6000", "createdAt": "2020-08-26T09:57:51Z", "path": "documentation/modules/security/proc-renewing-ca-certs-manually.adoc", "diffHunk": "@@ -9,7 +9,9 @@\n Unless the `Kafka.spec.clusterCa.generateCertificateAuthority` and `Kafka.spec.clientsCa.generateCertificateAuthority` objects are set to `false`,", "originalCommit": "8771559dea2489ac8fc5f1a90d0ab4801dd8c13c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQwNzI3Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3547#discussion_r477407272", "bodyText": "Better. \ud83d\udc4d", "author": "PaulRMellor", "createdAt": "2020-08-26T15:51:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE4MjczNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE4NTIwMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3547#discussion_r477185200", "bodyText": "So, the CA certificate in this example is named ca\\.crt?", "author": "laidan6000", "createdAt": "2020-08-26T10:02:07Z", "path": "documentation/modules/security/proc-renewing-ca-certs-manually.adoc", "diffHunk": "@@ -44,6 +46,29 @@ If maintenance time windows are configured, the Cluster Operator will generate t\n +\n Client applications must reload the cluster and clients CA certificates that were renewed by the Cluster Operator.\n \n+. Check the period the CA certificate is valid:\n++\n+For example, using an `openssl` command:\n++\n+[source,shell,subs=\"+quotes\"]\n+kubectl get secret _CA-CERTIFICATE-SECRET_ -o 'jsonpath={.data._CA-CERTIFICATE_}' | base64 -d | openssl x509 -subject -issuer -startdate -enddate -noout\n++\n+_CA-CERTIFICATE-SECRET_ is the name of the `Secret`, which is `_KAFKA-CLUSTER-NAME_-cluster-ca-cert` for the cluster CA certificate and `_KAFKA-CLUSTER-NAME_-clients-ca-cert` for the clients CA certificate.\n++\n+_CA-CERTIFICATE_ is the name of the CA certificate, such as `jsonpath={.data.ca\\.crt}`.", "originalCommit": "8771559dea2489ac8fc5f1a90d0ab4801dd8c13c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQyMDE3MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3547#discussion_r477420170", "bodyText": "I believe we need escape slash here. But I'll check.", "author": "PaulRMellor", "createdAt": "2020-08-26T16:10:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE4NTIwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODMwNTM1Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3547#discussion_r478305356", "bodyText": "Great, thank you.", "author": "laidan6000", "createdAt": "2020-08-27T10:06:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE4NTIwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTIxMzU5MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3547#discussion_r479213591", "bodyText": "@laidan6000 escape is needed. \ud83d\udc4d", "author": "PaulRMellor", "createdAt": "2020-08-28T12:12:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE4NTIwMA=="}], "type": "inlineReview"}, {"oid": "a8ef7b110615428fc5819c16a51c28f98b1e41a3", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/a8ef7b110615428fc5819c16a51c28f98b1e41a3", "message": "review edits DL\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-08-26T16:16:24Z", "type": "commit"}, {"oid": "3519ad23011645802292b499feeb7e90abc7d679", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3519ad23011645802292b499feeb7e90abc7d679", "message": "Merge branch 'master' into doc-certificate-dates-check", "committedDate": "2020-08-27T10:18:16Z", "type": "commit"}]}