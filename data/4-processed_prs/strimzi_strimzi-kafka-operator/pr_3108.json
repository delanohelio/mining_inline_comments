{"pr_number": 3108, "pr_title": "Improve shell scripts in our Docker images", "pr_createdAt": "2020-05-27T19:00:09Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3108", "timeline": [{"oid": "17d8c73d96e768ee62a91990471a49b8d5b94a2c", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/17d8c73d96e768ee62a91990471a49b8d5b94a2c", "message": "Improve shell scripts in our Docker images\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>", "committedDate": "2020-05-27T18:53:59Z", "type": "commit"}, {"oid": "13552ac368daba07f2b5cc22d1e78329363f6025", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/13552ac368daba07f2b5cc22d1e78329363f6025", "message": "Validate operator shell scripts in the originl location\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>", "committedDate": "2020-05-27T19:15:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM5MzA2Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3108#discussion_r431393063", "bodyText": "Normally you would quote the whole string I.e. exec \"${STRIMZI_HOME}/bin/launch_java.sh\"\nI think in practice is has little difference but it makes it a little clearer to read", "author": "samuel-hawker", "createdAt": "2020-05-27T19:30:00Z", "path": "user-operator/scripts/user_operator_run.sh", "diffHunk": "@@ -14,4 +16,4 @@ fi\n \n export JAVA_CLASSPATH=lib/io.strimzi.@project.build.finalName@.@project.packaging@:@project.dist.classpath@\n export JAVA_MAIN=io.strimzi.operator.user.Main\n-exec ${STRIMZI_HOME}/bin/launch_java.sh\n+exec \"${STRIMZI_HOME}\"/bin/launch_java.sh", "originalCommit": "13552ac368daba07f2b5cc22d1e78329363f6025", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ea2b13f472acfe5c81039da88dcce3fa0e9c5cc5", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/ea2b13f472acfe5c81039da88dcce3fa0e9c5cc5", "message": "Setup shellcheck on Azure + review comments\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>", "committedDate": "2020-05-27T20:04:42Z", "type": "commit"}, {"oid": "e5a3a25f2424112939fc45e17004e012782841e0", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e5a3a25f2424112939fc45e17004e012782841e0", "message": "Fix shellcheck install script\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>", "committedDate": "2020-05-27T20:39:59Z", "type": "commit"}, {"oid": "dcc2f3a3450c42ad1b4390c0465ff00dcd1b18de", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/dcc2f3a3450c42ad1b4390c0465ff00dcd1b18de", "message": "Install newer version of shellcheck\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>", "committedDate": "2020-05-27T21:24:24Z", "type": "commit"}, {"oid": "917a20fde4cddb839fe8c2ad03ae143f87606b08", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/917a20fde4cddb839fe8c2ad03ae143f87606b08", "message": "Install xz-utils\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>", "committedDate": "2020-05-27T21:40:55Z", "type": "commit"}, {"oid": "e02cf5529589c52c0619fd7de712fd47e61ea977", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e02cf5529589c52c0619fd7de712fd47e61ea977", "message": "Remove -z option\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>", "committedDate": "2020-05-27T22:34:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3NTMyMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3108#discussion_r431675321", "bodyText": "I think you can remove the sc disable line if you write:\nset /usr/bin/tini -w -e 143 -- \"java -server ${JAVA_OPTS} ${JMXTRANS_OPTS} ${GC_OPTS} ${EXEC}\"\n\nMight be wrong on this.", "author": "samuel-hawker", "createdAt": "2020-05-28T08:41:08Z", "path": "docker-images/jmxtrans/docker-entrypoint.sh", "diffHunk": "@@ -17,8 +16,10 @@ MONITOR_OPTS=\"-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.ssl=\n               -Djava.rmi.server.hostname=${PROXY_HOST}\"\n \n if [ \"$1\" = 'start-without-jmx' ]; then\n+    # shellcheck disable=SC2086\n     set /usr/bin/tini -w -e 143 -- java -server $JAVA_OPTS $JMXTRANS_OPTS $GC_OPTS $EXEC", "originalCommit": "e02cf5529589c52c0619fd7de712fd47e61ea977", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc4MjYxMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3108#discussion_r432782610", "bodyText": "I gave this a try and it doesn't work. Tini takes it and tries to execute it as single executable - and says that such file/directory does not exist.", "author": "scholzj", "createdAt": "2020-05-29T23:35:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3NTMyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3NjUzMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3108#discussion_r431676531", "bodyText": "groupregex=\"--group.filter=\\\"${KAFKA_EXPORTER_GROUP_REGEX}\\\"\"\n\nShould mean we can remove the disable", "author": "samuel-hawker", "createdAt": "2020-05-28T08:43:13Z", "path": "docker-images/kafka/exporter-scripts/kafka_exporter_run.sh", "diffHunk": "@@ -1,15 +1,18 @@\n #!/usr/bin/env bash\n+set -e\n set +x\n \n # We don't need LOG_DIR because we write no log files, but setting it to a\n # directory avoids trying to create it (and logging a permission denied error)\n export LOG_DIR=\"$KAFKA_EXPORTER_HOME\"\n \n if [ -n \"$KAFKA_EXPORTER_GROUP_REGEX\" ]; then\n+    # shellcheck disable=SC2027\n     groupregex=\"--group.filter=\\\"\"${KAFKA_EXPORTER_GROUP_REGEX}\"\\\"\"", "originalCommit": "e02cf5529589c52c0619fd7de712fd47e61ea977", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3NzkxNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3108#discussion_r431677916", "bodyText": "I'm not completely sure about it - I think removing it breaks the functionality with some settings.", "author": "scholzj", "createdAt": "2020-05-28T08:45:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3NjUzMQ=="}], "type": "inlineReview"}, {"oid": "be60fb055b5bf65badb779cc5d6176ad06585669", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/be60fb055b5bf65badb779cc5d6176ad06585669", "message": "Fix Mirror Maker and Mirror Maker 2 with OAuth\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>", "committedDate": "2020-05-29T22:55:16Z", "type": "commit"}]}