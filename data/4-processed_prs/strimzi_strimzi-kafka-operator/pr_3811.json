{"pr_number": 3811, "pr_title": "Check ns and kafka cluster for existense", "pr_createdAt": "2020-10-15T07:21:26Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3811", "timeline": [{"oid": "59fe56688c760da29e2c0be30bd1bebe5977c76f", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/59fe56688c760da29e2c0be30bd1bebe5977c76f", "message": "Check ns and kafka cluster for existense\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-10-15T07:22:41Z", "type": "commit"}, {"oid": "59fe56688c760da29e2c0be30bd1bebe5977c76f", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/59fe56688c760da29e2c0be30bd1bebe5977c76f", "message": "Check ns and kafka cluster for existense\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-10-15T07:22:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTI4OTAyMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3811#discussion_r505289020", "bodyText": "I think that we discussed this with @scholzj to keep the logs from the tls-sidecars for the previous versions of Strimzi. So I think you can keep it there, do you agree @scholzj ?", "author": "im-konge", "createdAt": "2020-10-15T07:49:57Z", "path": "tools/report.sh", "diffHunk": "@@ -191,18 +210,12 @@ for pod in $pods; do\n \t  $platform logs $pod -p -c topic-operator -n $namespace 2>/dev/null > $direct/reports/podLogs/previous-\"$pod\"-topic-operator.log\n \t  $platform logs $pod -p -c user-operator -n $namespace 2>/dev/null > $direct/reports/podLogs/previous-\"$pod\"-user-operator.log\n \telif [[ $pod =~ .*-kafka-[0-9]+ ]]; then\n-\t  $platform logs $pod -c tls-sidecar -n $namespace > $direct/reports/podLogs/\"$pod\"-tls-sidecar.log\n \t  $platform logs $pod -c kafka -n $namespace > $direct/reports/podLogs/\"$pod\"-kafka.log\n-\t  $platform logs $pod -p -c tls-sidecar -n $namespace 2>/dev/null > $direct/reports/podLogs/previous-\"$pod\"-tls-sidecar.log\n \t  $platform logs $pod -p -c kafka -n $namespace 2>/dev/null > $direct/reports/podLogs/previous-\"$pod\"-kafka.log\n-\n \t  $platform exec -i $pod -n $namespace -c kafka -- cat /tmp/strimzi.properties > $direct/reports/configs/\"$pod\".cfg\n \telif [[ $pod =~ .*-zookeeper-[0-9]+ ]]; then\n-\t  $platform logs $pod -c tls-sidecar -n $namespace > $direct/reports/podLogs/\"$pod\"-tls-sidecar.log\n \t  $platform logs $pod -c zookeeper -n $namespace > $direct/reports/podLogs/\"$pod\"-zookeeper.log\n-\t  $platform logs $pod -p -c tls-sidecar -n $namespace 2>/dev/null > $direct/reports/podLogs/previous-\"$pod\"-tls-sidecar.log\n \t  $platform logs $pod -p -c zookeeper -n $namespace 2>/dev/null > $direct/reports/podLogs/previous-\"$pod\"-zookeeper.log\n-", "originalCommit": "59fe56688c760da29e2c0be30bd1bebe5977c76f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTI5MTgyNw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3811#discussion_r505291827", "bodyText": "It's just a nit, but i think that ` ` is \"deprecated\" and now we should use the $()... but maybe I'm wrong and it's only suggestion...", "author": "im-konge", "createdAt": "2020-10-15T07:52:28Z", "path": "tools/report.sh", "diffHunk": "@@ -81,6 +81,25 @@ if [ -z $namespace ]; then\n    usage\n fi\n \n+available_namespaces=`$platform get ns -o name`", "originalCommit": "59fe56688c760da29e2c0be30bd1bebe5977c76f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTM4NDEzMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3811#discussion_r505384131", "bodyText": "I think you can just do kubectl get namespace <namespace> and check the return code.", "author": "scholzj", "createdAt": "2020-10-15T09:14:03Z", "path": "tools/report.sh", "diffHunk": "@@ -81,6 +81,25 @@ if [ -z $namespace ]; then\n    usage\n fi\n \n+available_namespaces=`$platform get ns -o name`\n+prefixed_ns=\"namespace/${namespace}\"\n+ns_avalailable=`printf '%s\\n' \"${available_namespaces[@]}\"  | grep -P \"^$prefixed_ns$\"`\n+\n+if [ -z \"${ns_avalailable}\" ]; then\n+\techo \"Namespace $namespace not found! Exiting\"\n+\texit 1\n+fi", "originalCommit": "59fe56688c760da29e2c0be30bd1bebe5977c76f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQwNjQyNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3811#discussion_r505406425", "bodyText": "Yeah. I am sure that is way as well. Using it as it does the code cleaner.", "author": "sknot-rh", "createdAt": "2020-10-15T09:44:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTM4NDEzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTM4NDYzNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3811#discussion_r505384636", "bodyText": "Same as above ... why not try to get it and check the return code?", "author": "scholzj", "createdAt": "2020-10-15T09:14:38Z", "path": "tools/report.sh", "diffHunk": "@@ -81,6 +81,25 @@ if [ -z $namespace ]; then\n    usage\n fi\n \n+available_namespaces=`$platform get ns -o name`\n+prefixed_ns=\"namespace/${namespace}\"\n+ns_avalailable=`printf '%s\\n' \"${available_namespaces[@]}\"  | grep -P \"^$prefixed_ns$\"`\n+\n+if [ -z \"${ns_avalailable}\" ]; then\n+\techo \"Namespace $namespace not found! Exiting\"\n+\texit 1\n+fi\n+\n+\n+available_clusters=`$platform get kafka -o name -n $namespace`\n+prefixed_cluster=\"kafka.kafka.strimzi.io/${cluster}\"\n+cluster_avalailable=`printf '%s\\n' \"${available_clusters[@]}\"  | grep -P \"^$prefixed_cluster$\"`\n+\n+if [ -z \"${cluster_avalailable}\" ]; then\n+\techo \"Kafka cluster $cluster in $namespace not found! Exiting\"\n+\texit 1\n+fi", "originalCommit": "59fe56688c760da29e2c0be30bd1bebe5977c76f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTM4NTE1OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3811#discussion_r505385159", "bodyText": "Please keep these for the time being since this is not versioned and might be used even with older versions of Strimzi which have the sidecars.", "author": "scholzj", "createdAt": "2020-10-15T09:15:19Z", "path": "tools/report.sh", "diffHunk": "@@ -191,18 +210,12 @@ for pod in $pods; do\n \t  $platform logs $pod -p -c topic-operator -n $namespace 2>/dev/null > $direct/reports/podLogs/previous-\"$pod\"-topic-operator.log\n \t  $platform logs $pod -p -c user-operator -n $namespace 2>/dev/null > $direct/reports/podLogs/previous-\"$pod\"-user-operator.log\n \telif [[ $pod =~ .*-kafka-[0-9]+ ]]; then\n-\t  $platform logs $pod -c tls-sidecar -n $namespace > $direct/reports/podLogs/\"$pod\"-tls-sidecar.log", "originalCommit": "59fe56688c760da29e2c0be30bd1bebe5977c76f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0c716263dd03662f8ebd15826864b4ee0d7cad68", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/0c716263dd03662f8ebd15826864b4ee0d7cad68", "message": "cleaner conditions\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-10-15T09:42:22Z", "type": "commit"}]}