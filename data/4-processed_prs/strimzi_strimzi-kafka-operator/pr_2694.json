{"pr_number": 2694, "pr_title": "feat: yq check enforce bash usage", "pr_createdAt": "2020-03-12T15:29:43Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2694", "timeline": [{"oid": "ed3f62d37c0f5ea74492942f066b2449093bbb08", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/ed3f62d37c0f5ea74492942f066b2449093bbb08", "message": "feat: yq check enforce bash usage\n\nSome build machines or distributions of linux do not have bash as the\ndefault shell, when the if check is ran on regular shell it always\nfails. We enforce the usage of bash when running this command so\nthat the check does not fail on these environments\n\nSigned-off-by: Samuel Hawker <samuel.hawker@ibm.com>", "committedDate": "2020-03-12T15:19:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcxMTg5Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2694#discussion_r391711896", "bodyText": "How does it work when your bash in /bin/bash is ages old ... typically on MacOS?", "author": "scholzj", "createdAt": "2020-03-12T15:44:33Z", "path": "Makefile", "diffHunk": "@@ -161,7 +161,7 @@ RED=\\033[0;31m\n NO_COLOUR=\\033[0m\n YQ_VERSION = $(shell yq --version | $(SED) 's/^.* //g')\n \n-yq_check:\n+yq_check: $(eval SHELL:=/bin/bash)", "originalCommit": "ed3f62d37c0f5ea74492942f066b2449093bbb08", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTczOTI0OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2694#discussion_r391739248", "bodyText": "In the DEV_QUICK_START_MAC_OS.md it specifically says:\n#### Install latest Bash\n`brew install bash`\n\nSo having version 4+ is already a per-requisite for building the project I believe.\nIn the case where bash is not stored in /bin\nI could change it to something like:\nSHELL=$(eval which bash)", "author": "samuel-hawker", "createdAt": "2020-03-12T16:25:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcxMTg5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTczOTk4OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2694#discussion_r391739988", "bodyText": "So to answer, if your bash is ages old you can't even build Strimzi, hence why the instructions say to update it.", "author": "samuel-hawker", "createdAt": "2020-03-12T16:26:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcxMTg5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTc1MTcxNw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2694#discussion_r391751717", "bodyText": "That is and isn't true. Yes, you need to have bash4. But there is no requirement to have bash4 in /bin/bash. On MacOs it is common that the system wide bash2 is /bin/bash but you actually use some other bash installed for example in /usr/local/bin/bash. But while it is common on MAcOS, it can be on other platforms as well. That is why scripts always should use /usr/bin/env bash in the shebang and not /bin/bash. So I think it is ok to expect bash4+, but we need smarter way to find it.\nIf $(eval which bash) works it would be an option (which bash in my case certainly points to the right bash). I guess other option might be to create some bash script prerequisites-check.sh for example in tools and put all the checks which might be needed there and just call it from the Makefile?", "author": "scholzj", "createdAt": "2020-03-12T16:44:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcxMTg5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTc1ODI2Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2694#discussion_r391758267", "bodyText": "I think that is a wholly reasonable suggestion. I will re-work this and create a script. I think having such a script would be useful for first time developers to the repo to ensure all their pre-reqs are installed.", "author": "samuel-hawker", "createdAt": "2020-03-12T16:54:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcxMTg5Ng=="}], "type": "inlineReview"}, {"oid": "2d7db123d715203f28f767cf4a1cfae4a720405a", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2d7db123d715203f28f767cf4a1cfae4a720405a", "message": "feat: Convert yq_check to dependency script\n\nAfter discussions it was agreed a yq check might\nbetter belong in a bash script to ensure the\ncheck is always made in the correct shell (bash)\nHere I have added additional dependency checks that\na builder would need.\n\nSigned-off-by: Samuel Hawker <samuel.hawker@ibm.com>", "committedDate": "2020-03-12T19:48:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTk2MDgzMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2694#discussion_r391960832", "bodyText": "commend => command? Is it typo?", "author": "scholzj", "createdAt": "2020-03-12T23:42:00Z", "path": "prerequisites-check.sh", "diffHunk": "@@ -0,0 +1,19 @@\n+#!/usr/bin/env bash\n+\n+RED=\"\\033[0;31m\"\n+NO_COLOUR=\"\\033[0m\"\n+\n+function check_commend_present() {", "originalCommit": "2d7db123d715203f28f767cf4a1cfae4a720405a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4296a5e1cfc1e77105680474e68609aa7f78f6b8", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/4296a5e1cfc1e77105680474e68609aa7f78f6b8", "message": "fix: typo commend to command\n\nSigned-off-by: Samuel Hawker <samuel.hawker@ibm.com>", "committedDate": "2020-03-12T23:59:06Z", "type": "commit"}]}