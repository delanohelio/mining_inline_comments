{"pr_number": 3948, "pr_title": "[Docs] Metrics configured in CM", "pr_createdAt": "2020-11-12T14:16:36Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIyNTA5OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r522225098", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            You can enable the Cruise Control metrics in the `Kafka` resource using the `cruiseControl.metricsConfig` property that contains a reference to the ConfigMap containing the JMX exporter configuration about the metrics to expose.\n          \n          \n            \n            Enable Cruise Control metrics using the `cruiseControl.metricsConfig` property in the `Kafka` resource to provide a reference to a ConfigMap that contains JMX exporter configuration for the metrics to expose.", "author": "PaulRMellor", "createdAt": "2020-11-12T16:08:50Z", "path": "documentation/assemblies/metrics/assembly_metrics-cruise-control.adoc", "diffHunk": "@@ -15,7 +15,7 @@ The example Grafana dashboard for Cruise Control provides:\n \n == Configuring Cruise Control\n \n-You can enable the Cruise Control metrics in the `Kafka` resource using the `cruiseControl.metrics` property that contains the JMX exporter configuration about the metrics to expose.\n+You can enable the Cruise Control metrics in the `Kafka` resource using the `cruiseControl.metricsConfig` property that contains a reference to the ConfigMap containing the JMX exporter configuration about the metrics to expose.", "originalCommit": "32e20e8a8d2dbef391b7c0615487f3fc8b4d1b00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIyOTEzNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r522229136", "bodyText": "Would an example fragment from a ConfigMap help here?", "author": "PaulRMellor", "createdAt": "2020-11-12T16:14:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIyNTA5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjgxNTE2OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r522815168", "bodyText": "I guess this comment applies to all resources, not just cruise control. Is that correct?", "author": "sknot-rh", "createdAt": "2020-11-13T09:03:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIyNTA5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIyODI2MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r522228261", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To enable Prometheus metrics export without any further configuration, you can set reference to a ConfigMap containing empty data under specified key.\n          \n          \n            \n            To enable Prometheus metrics export without further configuration, you can reference a ConfigMap containing empty data under a specified key.", "author": "PaulRMellor", "createdAt": "2020-11-12T16:12:55Z", "path": "documentation/modules/con-common-configuration-properties.adoc", "diffHunk": "@@ -294,18 +294,18 @@ livenessProbe:\n For more information about the `livenessProbe` and `readinessProbe` options, see xref:type-Probe-reference[Probe schema reference].\n \n [id='con-common-configuration-prometheus-{context}']\n-=== `metrics`\n+=== `metricsConfig`\n \n-Use the `metrics` property to enable and configure Prometheus metrics.\n+Use the `metricsConfig` property to enable and configure Prometheus metrics.\n \n-The `metrics` property can also contain additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n+The `metricsConfig` property contains a reference to the ConfigMap containing additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n Strimzi supports Prometheus metrics using Prometheus JMX exporter to convert the JMX metrics supported by Apache Kafka and ZooKeeper to Prometheus metrics.\n \n-To enable Prometheus metrics export without any further configuration, you can set it to an empty object (`{}`).\n+To enable Prometheus metrics export without any further configuration, you can set reference to a ConfigMap containing empty data under specified key.", "originalCommit": "32e20e8a8d2dbef391b7c0615487f3fc8b4d1b00", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIzMDQzOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r522230438", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <12> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled with ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing empty data under specified key.\n          \n          \n            \n            <12> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled by referencing a ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing empty data under a specified key.", "author": "PaulRMellor", "createdAt": "2020-11-12T16:15:47Z", "path": "documentation/modules/configuring/proc-config-kafka-connect.adoc", "diffHunk": "@@ -156,7 +150,7 @@ Standard Apache Kafka configuration may be provided, restricted to those propert\n <9> Requests for reservation of xref:con-common-configuration-resources-reference[supported resources], currently `cpu` and `memory`, and limits to specify the maximum resources that can be consumed.\n <10> Specified xref:property-kafka-connect-logging-reference[Kafka Connect loggers and log levels] added directly (`inline`) or indirectly (`external`) through a ConfigMap. A custom ConfigMap must be placed under the `log4j.properties` or `log4j2.properties` key. For the Kafka Connect `log4j.rootLogger` logger, you can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.\n <11> xref:con-common-configuration-healthchecks-reference[Healthchecks] to know when to restart a container (liveness) and when a container can accept traffic (readiness).\n-<12> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled with configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using `metrics: {}`.\n+<12> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled with ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing empty data under specified key.", "originalCommit": "32e20e8a8d2dbef391b7c0615487f3fc8b4d1b00", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIzMzU3Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r522233576", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <18> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled with ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing empty data under specified key.\n          \n          \n            \n            <18> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled by referencing a ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing empty data under a specified key.", "author": "PaulRMellor", "createdAt": "2020-11-12T16:19:36Z", "path": "documentation/modules/configuring/proc-config-mirrormaker.adoc", "diffHunk": "@@ -146,7 +142,7 @@ spec:\n <15> Requests for reservation of xref:con-common-configuration-resources-reference[supported resources], currently `cpu` and `memory`, and limits to specify the maximum resources that can be consumed.\n <16> Specified xref:property-mm-loggers-reference[loggers and log levels] added directly (`inline`) or indirectly (`external`) through a ConfigMap. A custom ConfigMap must be placed under the `log4j.properties` or `log4j2.properties` key. MirrorMaker has a single logger called `mirrormaker.root.logger`. You can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.\n <17> xref:con-common-configuration-healthchecks-reference[Healthchecks] to know when to restart a container (liveness) and when a container can accept traffic (readiness).\n-<18> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled with configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using `metrics: {}`.\n+<18> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled with ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing empty data under specified key.", "originalCommit": "32e20e8a8d2dbef391b7c0615487f3fc8b4d1b00", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIzNDM4OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r522234389", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            When the `metricsConfig` property is not defined in the resource, the Prometheus metrics will be disabled.\n          \n          \n            \n            When the `metricsConfig` property is not defined in the resource, the Prometheus metrics are disabled.", "author": "PaulRMellor", "createdAt": "2020-11-12T16:20:36Z", "path": "documentation/modules/ref-prometheus-metrics.adoc", "diffHunk": "@@ -5,15 +5,15 @@\n [id='ref-metrics-{context}']\n = Metrics configuration\n \n-Prometheus metrics are enabled by configuring the `metrics` property in following resources:\n+Prometheus metrics are enabled by configuring the `metricsConfig` property in following resources:\n \n * `Kafka.spec.kafka`\n * `Kafka.spec.zookeeper`\n * `KafkaConnect.spec`\n * `KafkaConnectS2I.spec`\n \n-When the `metrics` property is not defined in the resource, the Prometheus metrics will be disabled.\n-To enable Prometheus metrics export without any further configuration, you can set it to an empty object (`{}`).\n+When the `metricsConfig` property is not defined in the resource, the Prometheus metrics will be disabled.", "originalCommit": "32e20e8a8d2dbef391b7c0615487f3fc8b4d1b00", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIzNjQ2NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r522236465", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To enable Prometheus metrics export without any further configuration, you can set reference to a ConfigMap containing empty data under specified key.\n          \n          \n            \n            To enable Prometheus metrics export without further configuration, you can reference a ConfigMap containing empty data under a specified key.", "author": "PaulRMellor", "createdAt": "2020-11-12T16:23:24Z", "path": "documentation/modules/ref-prometheus-metrics.adoc", "diffHunk": "@@ -5,15 +5,15 @@\n [id='ref-metrics-{context}']\n = Metrics configuration\n \n-Prometheus metrics are enabled by configuring the `metrics` property in following resources:\n+Prometheus metrics are enabled by configuring the `metricsConfig` property in following resources:\n \n * `Kafka.spec.kafka`\n * `Kafka.spec.zookeeper`\n * `KafkaConnect.spec`\n * `KafkaConnectS2I.spec`\n \n-When the `metrics` property is not defined in the resource, the Prometheus metrics will be disabled.\n-To enable Prometheus metrics export without any further configuration, you can set it to an empty object (`{}`).\n+When the `metricsConfig` property is not defined in the resource, the Prometheus metrics will be disabled.\n+To enable Prometheus metrics export without any further configuration, you can set reference to a ConfigMap containing empty data under specified key.", "originalCommit": "32e20e8a8d2dbef391b7c0615487f3fc8b4d1b00", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIzNjkzMw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r522236933", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            .Example of enabling metrics without any further configuration\n          \n          \n            \n            .Enabling metrics without further configuration", "author": "PaulRMellor", "createdAt": "2020-11-12T16:24:01Z", "path": "documentation/modules/ref-prometheus-metrics.adoc", "diffHunk": "@@ -5,15 +5,15 @@\n [id='ref-metrics-{context}']\n = Metrics configuration\n \n-Prometheus metrics are enabled by configuring the `metrics` property in following resources:\n+Prometheus metrics are enabled by configuring the `metricsConfig` property in following resources:\n \n * `Kafka.spec.kafka`\n * `Kafka.spec.zookeeper`\n * `KafkaConnect.spec`\n * `KafkaConnectS2I.spec`\n \n-When the `metrics` property is not defined in the resource, the Prometheus metrics will be disabled.\n-To enable Prometheus metrics export without any further configuration, you can set it to an empty object (`{}`).\n+When the `metricsConfig` property is not defined in the resource, the Prometheus metrics will be disabled.\n+To enable Prometheus metrics export without any further configuration, you can set reference to a ConfigMap containing empty data under specified key.\n \n .Example of enabling metrics without any further configuration", "originalCommit": "32e20e8a8d2dbef391b7c0615487f3fc8b4d1b00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIzNzY5MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r522237691", "bodyText": "We change the name of the configmap to my-empty-config-map? Not sure we need both examples now?", "author": "PaulRMellor", "createdAt": "2020-11-12T16:24:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIzNjkzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIzOTYzNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r522239634", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The `metricsConfig` property might contain a reference to the ConfigMap containing additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n          \n          \n            \n            Alternatively, the `metricsConfig` property can reference a ConfigMap that contains additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].", "author": "PaulRMellor", "createdAt": "2020-11-12T16:27:24Z", "path": "documentation/modules/ref-prometheus-metrics.adoc", "diffHunk": "@@ -25,13 +25,18 @@ metadata:\n spec:\n   kafka:\n     # ...\n-    metrics: {}\n+    metricsConfig:\n+     type: jmxPrometheusExporter\n+     valueFrom:\n+       configMapKeyRef:\n+         name: my-config-map\n+         key: my-key\n     # ...\n   zookeeper:\n     # ...\n ----\n \n-The `metrics` property might contain additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n+The `metricsConfig` property might contain a reference to the ConfigMap containing additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].", "originalCommit": "32e20e8a8d2dbef391b7c0615487f3fc8b4d1b00", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI0MTY5MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r522241690", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            .Example of enabling metrics with additional Prometheus JMX Exporter configuration\n          \n          \n            \n            .Enabling metrics with additional Prometheus JMX Exporter configuration", "author": "PaulRMellor", "createdAt": "2020-11-12T16:30:04Z", "path": "documentation/modules/ref-prometheus-metrics.adoc", "diffHunk": "@@ -25,13 +25,18 @@ metadata:\n spec:\n   kafka:\n     # ...\n-    metrics: {}\n+    metricsConfig:\n+     type: jmxPrometheusExporter\n+     valueFrom:\n+       configMapKeyRef:\n+         name: my-config-map\n+         key: my-key\n     # ...\n   zookeeper:\n     # ...\n ----\n \n-The `metrics` property might contain additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n+The `metricsConfig` property might contain a reference to the ConfigMap containing additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n \n .Example of enabling metrics with additional Prometheus JMX Exporter configuration", "originalCommit": "32e20e8a8d2dbef391b7c0615487f3fc8b4d1b00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI0NDEyMw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r522244123", "bodyText": "Maybe we have one example called Enabling metrics using metricsConfig And then we add a sentence after saying something like: If no further configuration is needed, the ConfigMap reference is empty. If further configuration is needed, the ConfigMap contains additional JMX exporter configuration.", "author": "PaulRMellor", "createdAt": "2020-11-12T16:33:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI0MTY5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI1MjIzMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r522252232", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <22> Kafka link:{BookURLDeploying}#assembly-metrics-setup-str[metrics configuration for use with Prometheus].\n          \n          \n            \n            <22> Kafka xref:con-common-configuration-prometheus-reference[metrics configuration for use with Prometheus].", "author": "PaulRMellor", "createdAt": "2020-11-12T16:44:31Z", "path": "documentation/modules/ref-sample-kafka-resource-config.adoc", "diffHunk": "@@ -148,7 +142,7 @@ spec:\n <20> Persistent storage has xref:ref-persistent-storage-{context}[additional configuration options], such as a storage `id` and `class` for dynamic volume provisioning.\n <21> Rack awareness is configured to xref:assembly-kafka-rack-{context}[spread replicas across different racks]. A `topology` key must match the label of a cluster node.\n <22> Kafka link:{BookURLDeploying}#assembly-metrics-setup-str[metrics configuration for use with Prometheus].", "originalCommit": "32e20e8a8d2dbef391b7c0615487f3fc8b4d1b00", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI1MjczNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r522252736", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <23> Kafka rules for exporting metrics to a Grafana dashboard through the JMX Exporter. A reference to ConfigMap containing set of configured rules provided with Strimzi may be copied to your Kafka resource configuration.\n          \n          \n            \n            <23> Kafka rules for exporting metrics to a Grafana dashboard through the JMX Exporter, which are enabled by referencing a ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing empty data under a specified key.", "author": "PaulRMellor", "createdAt": "2020-11-12T16:45:00Z", "path": "documentation/modules/ref-sample-kafka-resource-config.adoc", "diffHunk": "@@ -148,7 +142,7 @@ spec:\n <20> Persistent storage has xref:ref-persistent-storage-{context}[additional configuration options], such as a storage `id` and `class` for dynamic volume provisioning.\n <21> Rack awareness is configured to xref:assembly-kafka-rack-{context}[spread replicas across different racks]. A `topology` key must match the label of a cluster node.\n <22> Kafka link:{BookURLDeploying}#assembly-metrics-setup-str[metrics configuration for use with Prometheus].\n-<23> Kafka rules for exporting metrics to a Grafana dashboard through the JMX Exporter. A set of rules provided with Strimzi may be copied to your Kafka resource configuration.\n+<23> Kafka rules for exporting metrics to a Grafana dashboard through the JMX Exporter. A reference to ConfigMap containing set of configured rules provided with Strimzi may be copied to your Kafka resource configuration.", "originalCommit": "32e20e8a8d2dbef391b7c0615487f3fc8b4d1b00", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f34dd8b294e7d78d02dd88def85e9a0ac02e1091", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f34dd8b294e7d78d02dd88def85e9a0ac02e1091", "message": "example cm\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-11-13T09:35:31Z", "type": "forcePushed"}, {"oid": "bec75f1ad9c49da160e961fb5f1c314f17362ef7", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/bec75f1ad9c49da160e961fb5f1c314f17362ef7", "message": "example cm\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-11-13T09:37:37Z", "type": "forcePushed"}, {"oid": "531ce2279f0cd6a08b70e69981a6b46f756fdece", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/531ce2279f0cd6a08b70e69981a6b46f756fdece", "message": "example cm\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-11-13T09:38:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjg0MDgxOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r522840818", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            .Example ConfigMap\n          \n          \n            \n            .Example ConfigMap with metrics configuration for Kafka", "author": "PaulRMellor", "createdAt": "2020-11-13T09:50:18Z", "path": "documentation/modules/metrics/ref_metrics-config-files.adoc", "diffHunk": "@@ -112,6 +112,40 @@ When deploying Prometheus metrics configuration, you can can deploy the example\n |`kafka-cruise-control-metrics.yaml`\n |===\n \n+.Example ConfigMap", "originalCommit": "531ce2279f0cd6a08b70e69981a6b46f756fdece", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjg0MDkxOQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r522840919", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ConfigMap example with metrics configuration for Kafka:", "author": "PaulRMellor", "createdAt": "2020-11-13T09:50:29Z", "path": "documentation/modules/metrics/ref_metrics-config-files.adoc", "diffHunk": "@@ -112,6 +112,40 @@ When deploying Prometheus metrics configuration, you can can deploy the example\n |`kafka-cruise-control-metrics.yaml`\n |===\n \n+.Example ConfigMap\n+ConfigMap example with metrics configuration for Kafka:", "originalCommit": "531ce2279f0cd6a08b70e69981a6b46f756fdece", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjg2MTQ0Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r522861447", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ConfigMap example with metrics configuration for Kafka:\n          \n          \n            \n            .Example ConfigMap with metrics configuration for Kafka", "author": "PaulRMellor", "createdAt": "2020-11-13T10:27:51Z", "path": "documentation/modules/con-common-configuration-properties.adoc", "diffHunk": "@@ -294,18 +294,51 @@ livenessProbe:\n For more information about the `livenessProbe` and `readinessProbe` options, see xref:type-Probe-reference[Probe schema reference].\n \n [id='con-common-configuration-prometheus-{context}']\n-=== `metrics`\n+=== `metricsConfig`\n \n-Use the `metrics` property to enable and configure Prometheus metrics.\n+Use the `metricsConfig` property to enable and configure Prometheus metrics.\n \n-The `metrics` property can also contain additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n+The `metricsConfig` property contains a reference to the ConfigMap containing additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n Strimzi supports Prometheus metrics using Prometheus JMX exporter to convert the JMX metrics supported by Apache Kafka and ZooKeeper to Prometheus metrics.\n \n-To enable Prometheus metrics export without any further configuration, you can set it to an empty object (`{}`).\n+To enable Prometheus metrics export without further configuration, you can reference a ConfigMap containing empty data under a specified key.\n+\n+ConfigMap example with metrics configuration for Kafka:", "originalCommit": "4d44705ee0c083c0bf00aaadf887ee2568c1b8e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE1OTc1Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r523159752", "bodyText": "Similar comment as in the other PR ... this should be pretty printed. You should also try to create some shorter example (e.g. put some // ... in the middle etc.).", "author": "scholzj", "createdAt": "2020-11-13T18:53:23Z", "path": "documentation/modules/con-common-configuration-properties.adoc", "diffHunk": "@@ -294,18 +294,51 @@ livenessProbe:\n For more information about the `livenessProbe` and `readinessProbe` options, see xref:type-Probe-reference[Probe schema reference].\n \n [id='con-common-configuration-prometheus-{context}']\n-=== `metrics`\n+=== `metricsConfig`\n \n-Use the `metrics` property to enable and configure Prometheus metrics.\n+Use the `metricsConfig` property to enable and configure Prometheus metrics.\n \n-The `metrics` property can also contain additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n+The `metricsConfig` property contains a reference to the ConfigMap containing additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n Strimzi supports Prometheus metrics using Prometheus JMX exporter to convert the JMX metrics supported by Apache Kafka and ZooKeeper to Prometheus metrics.\n \n-To enable Prometheus metrics export without any further configuration, you can set it to an empty object (`{}`).\n+To enable Prometheus metrics export without further configuration, you can reference a ConfigMap containing empty data under a specified key.\n+\n+.Example ConfigMap with metrics configuration for Kafka\n+\n+[source,yaml,subs=\"+attributes\"]\n+----\n+kind: ConfigMap\n+apiVersion: {KafkaApiVersion}\n+metadata:\n+  name: my-configmap\n+data:\n+  my-key: '{\"lowercaseOutputName\":true,\"rules\":[{\"labels\":{\"clientId\":\"$3\",\"partition\":\"$5\",\"topic\":\"$4\"},\"name\":\"kafka_server_$1_$2\",\"pattern\":\"kafka.server<type=(.+),", "originalCommit": "c839f1b2c2a19277bba1627680b51444527a4a63", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE2MDE5MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r523160190", "bodyText": "I think this makes it a bit more clear.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <12> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled by referencing a ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing empty data under a specified key.\n          \n          \n            \n            <12> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled by referencing a ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing empty file under a specified key.", "author": "scholzj", "createdAt": "2020-11-13T18:54:14Z", "path": "documentation/modules/configuring/proc-config-kafka-connect.adoc", "diffHunk": "@@ -158,7 +152,7 @@ Standard Apache Kafka configuration may be provided, restricted to those propert\n <9> Requests for reservation of xref:con-common-configuration-resources-reference[supported resources], currently `cpu` and `memory`, and limits to specify the maximum resources that can be consumed.\n <10> Specified xref:property-kafka-connect-logging-reference[Kafka Connect loggers and log levels] added directly (`inline`) or indirectly (`external`) through a ConfigMap. A custom ConfigMap must be placed under the `log4j.properties` or `log4j2.properties` key. For the Kafka Connect `log4j.rootLogger` logger, you can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.\n <11> xref:con-common-configuration-healthchecks-reference[Healthchecks] to know when to restart a container (liveness) and when a container can accept traffic (readiness).\n-<12> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled with configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using `metrics: {}`.\n+<12> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled by referencing a ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing empty data under a specified key.", "originalCommit": "c839f1b2c2a19277bba1627680b51444527a4a63", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE2MDM0NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r523160345", "bodyText": "Same as above (and all the following places as well).", "author": "scholzj", "createdAt": "2020-11-13T18:54:30Z", "path": "documentation/modules/configuring/proc-config-mirrormaker.adoc", "diffHunk": "@@ -146,7 +142,7 @@ spec:\n <15> Requests for reservation of xref:con-common-configuration-resources-reference[supported resources], currently `cpu` and `memory`, and limits to specify the maximum resources that can be consumed.\n <16> Specified xref:property-mm-loggers-reference[loggers and log levels] added directly (`inline`) or indirectly (`external`) through a ConfigMap. A custom ConfigMap must be placed under the `log4j.properties` or `log4j2.properties` key. MirrorMaker has a single logger called `mirrormaker.root.logger`. You can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.\n <17> xref:con-common-configuration-healthchecks-reference[Healthchecks] to know when to restart a container (liveness) and when a container can accept traffic (readiness).\n-<18> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled with configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using `metrics: {}`.\n+<18> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled by referencing a ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing empty data under a specified key.", "originalCommit": "c839f1b2c2a19277bba1627680b51444527a4a63", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY4NTY3MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r526685670", "bodyText": "We should be clear that without any further configuration, ALL metrics will be exported with no renaming as at the source.", "author": "ppatierno", "createdAt": "2020-11-19T08:45:57Z", "path": "documentation/modules/con-common-configuration-properties.adoc", "diffHunk": "@@ -294,18 +294,46 @@ livenessProbe:\n For more information about the `livenessProbe` and `readinessProbe` options, see xref:type-Probe-reference[Probe schema reference].\n \n [id='con-common-configuration-prometheus-{context}']\n-=== `metrics`\n+=== `metricsConfig`\n \n-Use the `metrics` property to enable and configure Prometheus metrics.\n+Use the `metricsConfig` property to enable and configure Prometheus metrics.\n \n-The `metrics` property can also contain additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n+The `metricsConfig` property contains a reference to the ConfigMap containing additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n Strimzi supports Prometheus metrics using Prometheus JMX exporter to convert the JMX metrics supported by Apache Kafka and ZooKeeper to Prometheus metrics.\n \n-To enable Prometheus metrics export without any further configuration, you can set it to an empty object (`{}`).\n+To enable Prometheus metrics export without further configuration, you can reference a ConfigMap containing empty file under a specified key.", "originalCommit": "67079442f35c068eacfb9f181fae77e73ec439df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY4NTkwMw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r526685903", "bodyText": "ditto as above.", "author": "ppatierno", "createdAt": "2020-11-19T08:46:19Z", "path": "documentation/modules/ref-prometheus-metrics.adoc", "diffHunk": "@@ -5,17 +5,17 @@\n [id='ref-metrics-{context}']\n = Metrics configuration\n \n-Prometheus metrics are enabled by configuring the `metrics` property in following resources:\n+Prometheus metrics are enabled by configuring the `metricsConfig` property in following resources:\n \n * `Kafka.spec.kafka`\n * `Kafka.spec.zookeeper`\n * `KafkaConnect.spec`\n * `KafkaConnectS2I.spec`\n \n-When the `metrics` property is not defined in the resource, the Prometheus metrics will be disabled.\n-To enable Prometheus metrics export without any further configuration, you can set it to an empty object (`{}`).\n+When the `metricsConfig` property is not defined in the resource, the Prometheus metrics are disabled.\n+To enable Prometheus metrics export without further configuration, you can reference a ConfigMap containing empty file under a specified key.", "originalCommit": "67079442f35c068eacfb9f181fae77e73ec439df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzI5MDA5NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r533290094", "bodyText": "Not sure this example still makes sense as the example here is the same as the example right below it. So I guess you should either remove one of the examples. Or you should add also a YAML example of the config map => here one with config mp having just empty file under the key and below an example of a config map with some configuration.", "author": "scholzj", "createdAt": "2020-12-01T10:26:50Z", "path": "documentation/modules/ref-prometheus-metrics.adoc", "diffHunk": "@@ -5,17 +5,18 @@\n [id='ref-metrics-{context}']\n = Metrics configuration\n \n-Prometheus metrics are enabled by configuring the `metrics` property in following resources:\n+Prometheus metrics are enabled by configuring the `metricsConfig` property in following resources:\n \n * `Kafka.spec.kafka`\n * `Kafka.spec.zookeeper`\n * `KafkaConnect.spec`\n * `KafkaConnectS2I.spec`\n \n-When the `metrics` property is not defined in the resource, the Prometheus metrics will be disabled.\n-To enable Prometheus metrics export without any further configuration, you can set it to an empty object (`{}`).\n+When the `metricsConfig` property is not defined in the resource, the Prometheus metrics are disabled.\n+To enable Prometheus metrics export without further configuration, you can reference a ConfigMap containing empty file under a specified key.\n+All metrics without any renaming will be exposed in such a case.\n \n-.Example of enabling metrics without any further configuration\n+.Enabling metrics without further configuration", "originalCommit": "b95f77a9a6c97b44d9b2c0eef42bf9d743c9c22d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "78a01cba087cfef86511d33f6956ddc8cf439fcf", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/78a01cba087cfef86511d33f6956ddc8cf439fcf", "message": "[Docs] Metrics configured in CM\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-12-03T08:01:52Z", "type": "commit"}, {"oid": "343cd61c5f72f94cbe576c47e934fa9123e9748e", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/343cd61c5f72f94cbe576c47e934fa9123e9748e", "message": "Apply suggestions from code review\n\nCo-authored-by: PaulRMellor <47596553+PaulRMellor@users.noreply.github.com>\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-12-03T08:01:56Z", "type": "commit"}, {"oid": "511f06cf50f225367527815c810ad5914eb59d73", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/511f06cf50f225367527815c810ad5914eb59d73", "message": "example cm\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-12-03T08:01:56Z", "type": "commit"}, {"oid": "8df33a612cdc157b589cc6dd3324078fbddf9421", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8df33a612cdc157b589cc6dd3324078fbddf9421", "message": "Paul\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-12-03T08:01:56Z", "type": "commit"}, {"oid": "119f1ba9dc498a3e80e7855bb7676f3e5b75dd2e", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/119f1ba9dc498a3e80e7855bb7676f3e5b75dd2e", "message": "Paul\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-12-03T08:01:56Z", "type": "commit"}, {"oid": "a3b230ca427f179d82faa1026c90e895a2ed804a", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/a3b230ca427f179d82faa1026c90e895a2ed804a", "message": "better example+comments\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-12-03T08:01:56Z", "type": "commit"}, {"oid": "1146e03138e2e3d2e5644044b3f75611baca25c7", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1146e03138e2e3d2e5644044b3f75611baca25c7", "message": "comments + json->yaml\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-12-03T08:01:56Z", "type": "commit"}, {"oid": "1146e03138e2e3d2e5644044b3f75611baca25c7", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1146e03138e2e3d2e5644044b3f75611baca25c7", "message": "comments + json->yaml\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-12-03T08:01:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg5ODM4NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r534898384", "bodyText": "it's not \"a specified key\" ... we should make clear that it's the key specified under the metricsConfig section.", "author": "ppatierno", "createdAt": "2020-12-03T08:21:43Z", "path": "documentation/modules/con-common-configuration-properties.adoc", "diffHunk": "@@ -294,18 +294,42 @@ livenessProbe:\n For more information about the `livenessProbe` and `readinessProbe` options, see xref:type-Probe-reference[Probe schema reference].\n \n [id='con-common-configuration-prometheus-{context}']\n-=== `metrics`\n+=== `metricsConfig`\n \n-Use the `metrics` property to enable and configure Prometheus metrics.\n+Use the `metricsConfig` property to enable and configure Prometheus metrics.\n \n-The `metrics` property can also contain additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n+The `metricsConfig` property contains a reference to the ConfigMap containing additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n Strimzi supports Prometheus metrics using Prometheus JMX exporter to convert the JMX metrics supported by Apache Kafka and ZooKeeper to Prometheus metrics.\n \n-To enable Prometheus metrics export without any further configuration, you can set it to an empty object (`{}`).\n+To enable Prometheus metrics export without further configuration, you can reference a ConfigMap containing empty file under a specified key.", "originalCommit": "1146e03138e2e3d2e5644044b3f75611baca25c7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg5OTA2Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r534899067", "bodyText": "ditto as above.", "author": "ppatierno", "createdAt": "2020-12-03T08:22:06Z", "path": "documentation/modules/ref-prometheus-metrics.adoc", "diffHunk": "@@ -5,17 +5,18 @@\n [id='ref-metrics-{context}']\n = Metrics configuration\n \n-Prometheus metrics are enabled by configuring the `metrics` property in following resources:\n+Prometheus metrics are enabled by configuring the `metricsConfig` property in following resources:\n \n * `Kafka.spec.kafka`\n * `Kafka.spec.zookeeper`\n * `KafkaConnect.spec`\n * `KafkaConnectS2I.spec`\n \n-When the `metrics` property is not defined in the resource, the Prometheus metrics will be disabled.\n-To enable Prometheus metrics export without any further configuration, you can set it to an empty object (`{}`).\n+When the `metricsConfig` property is not defined in the resource, the Prometheus metrics are disabled.\n+To enable Prometheus metrics export without further configuration, you can reference a ConfigMap containing empty file under a specified key.", "originalCommit": "1146e03138e2e3d2e5644044b3f75611baca25c7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "31ff039451496431f7868bb785f518b448b24b4b", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/31ff039451496431f7868bb785f518b448b24b4b", "message": "comments\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-12-03T09:41:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTE5NTU5NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r535195595", "bodyText": "Strictly speaking this is not true. It will still be enabled if metrics: ... is defined. I think that needs to be covered here.", "author": "scholzj", "createdAt": "2020-12-03T12:41:43Z", "path": "documentation/modules/con-common-configuration-properties.adoc", "diffHunk": "@@ -294,18 +294,42 @@ livenessProbe:\n For more information about the `livenessProbe` and `readinessProbe` options, see xref:type-Probe-reference[Probe schema reference].\n \n [id='con-common-configuration-prometheus-{context}']\n-=== `metrics`\n+=== `metricsConfig`\n \n-Use the `metrics` property to enable and configure Prometheus metrics.\n+Use the `metricsConfig` property to enable and configure Prometheus metrics.\n \n-The `metrics` property can also contain additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n+The `metricsConfig` property contains a reference to the ConfigMap containing additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n Strimzi supports Prometheus metrics using Prometheus JMX exporter to convert the JMX metrics supported by Apache Kafka and ZooKeeper to Prometheus metrics.\n \n-To enable Prometheus metrics export without any further configuration, you can set it to an empty object (`{}`).\n+To enable Prometheus metrics export without further configuration, you can reference a ConfigMap containing empty file under `metricsConfig.valueFrom.configMapKeyRef.key`.\n+All metrics without any renaming will be exposed in such a case.\n+\n+.Example ConfigMap with metrics configuration for Kafka\n+\n+[source,yaml,subs=\"+attributes\"]\n+----\n+kind: ConfigMap\n+apiVersion: {KafkaApiVersion}\n+metadata:\n+  name: my-configmap\n+data:\n+  my-key: |\n+    lowercaseOutputName: true\n+    rules:\n+    # Special cases and very specific rules\n+    - pattern: kafka.server<type=(.+), name=(.+), clientId=(.+), topic=(.+), partition=(.*)><>Value\n+      name: kafka_server_$1_$2\n+      type: GAUGE\n+      labels:\n+       clientId: \"$3\"\n+       topic: \"$4\"\n+       partition: \"$5\"\n+    # further configuration\n+----\n \n When metrics are enabled, they are exposed on port 9404.\n \n-When the `metrics` property is not defined in the resource, the Prometheus metrics are disabled.\n+When the `metricsConfig` property is not defined in the resource, the Prometheus metrics are disabled.", "originalCommit": "31ff039451496431f7868bb785f518b448b24b4b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9e09bb1c8351fe38c359fb7e8d61434694c9dbad", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/9e09bb1c8351fe38c359fb7e8d61434694c9dbad", "message": "Jakub's point\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-12-03T12:52:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQwOTk3MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r535409970", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The `metricsConfig` property contains a reference to the ConfigMap containing additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n          \n          \n            \n            The `metricsConfig` property contains a reference to a ConfigMap containing additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].", "author": "PaulRMellor", "createdAt": "2020-12-03T16:56:04Z", "path": "documentation/modules/con-common-configuration-properties.adoc", "diffHunk": "@@ -294,18 +294,42 @@ livenessProbe:\n For more information about the `livenessProbe` and `readinessProbe` options, see xref:type-Probe-reference[Probe schema reference].\n \n [id='con-common-configuration-prometheus-{context}']\n-=== `metrics`\n+=== `metricsConfig`\n \n-Use the `metrics` property to enable and configure Prometheus metrics.\n+Use the `metricsConfig` property to enable and configure Prometheus metrics.\n \n-The `metrics` property can also contain additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n+The `metricsConfig` property contains a reference to the ConfigMap containing additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].", "originalCommit": "9e09bb1c8351fe38c359fb7e8d61434694c9dbad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQyMzc0MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r535423741", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            All metrics without any renaming will be exposed in such a case.\n          \n          \n            \n            When referencing an empty file, all metrics are exposed as long as they have not been renamed.", "author": "PaulRMellor", "createdAt": "2020-12-03T17:10:11Z", "path": "documentation/modules/con-common-configuration-properties.adoc", "diffHunk": "@@ -294,18 +294,42 @@ livenessProbe:\n For more information about the `livenessProbe` and `readinessProbe` options, see xref:type-Probe-reference[Probe schema reference].\n \n [id='con-common-configuration-prometheus-{context}']\n-=== `metrics`\n+=== `metricsConfig`\n \n-Use the `metrics` property to enable and configure Prometheus metrics.\n+Use the `metricsConfig` property to enable and configure Prometheus metrics.\n \n-The `metrics` property can also contain additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n+The `metricsConfig` property contains a reference to the ConfigMap containing additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n Strimzi supports Prometheus metrics using Prometheus JMX exporter to convert the JMX metrics supported by Apache Kafka and ZooKeeper to Prometheus metrics.\n \n-To enable Prometheus metrics export without any further configuration, you can set it to an empty object (`{}`).\n+To enable Prometheus metrics export without further configuration, you can reference a ConfigMap containing empty file under `metricsConfig.valueFrom.configMapKeyRef.key`.\n+All metrics without any renaming will be exposed in such a case.", "originalCommit": "9e09bb1c8351fe38c359fb7e8d61434694c9dbad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQyNzA3Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r535427077", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To enable Prometheus metrics export without further configuration, you can reference a ConfigMap containing empty file under `metricsConfig.valueFrom.configMapKeyRef.key`.\n          \n          \n            \n            To enable Prometheus metrics export without further configuration, you can reference a ConfigMap containing an empty file under `metricsConfig.valueFrom.configMapKeyRef.key`.", "author": "PaulRMellor", "createdAt": "2020-12-03T17:14:37Z", "path": "documentation/modules/con-common-configuration-properties.adoc", "diffHunk": "@@ -294,18 +294,42 @@ livenessProbe:\n For more information about the `livenessProbe` and `readinessProbe` options, see xref:type-Probe-reference[Probe schema reference].\n \n [id='con-common-configuration-prometheus-{context}']\n-=== `metrics`\n+=== `metricsConfig`\n \n-Use the `metrics` property to enable and configure Prometheus metrics.\n+Use the `metricsConfig` property to enable and configure Prometheus metrics.\n \n-The `metrics` property can also contain additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n+The `metricsConfig` property contains a reference to the ConfigMap containing additional configuration for the link:https://github.com/prometheus/jmx_exporter[Prometheus JMX exporter^].\n Strimzi supports Prometheus metrics using Prometheus JMX exporter to convert the JMX metrics supported by Apache Kafka and ZooKeeper to Prometheus metrics.\n \n-To enable Prometheus metrics export without any further configuration, you can set it to an empty object (`{}`).\n+To enable Prometheus metrics export without further configuration, you can reference a ConfigMap containing empty file under `metricsConfig.valueFrom.configMapKeyRef.key`.", "originalCommit": "9e09bb1c8351fe38c359fb7e8d61434694c9dbad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQyNzUzMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r535427532", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <12> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled by referencing a ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing empty file under `metricsConfig.valueFrom.configMapKeyRef.key`.\n          \n          \n            \n            <12> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled by referencing a ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing an empty file under `metricsConfig.valueFrom.configMapKeyRef.key`.", "author": "PaulRMellor", "createdAt": "2020-12-03T17:15:17Z", "path": "documentation/modules/configuring/proc-config-kafka-connect.adoc", "diffHunk": "@@ -158,7 +152,7 @@ Standard Apache Kafka configuration may be provided, restricted to those propert\n <9> Requests for reservation of xref:con-common-configuration-resources-reference[supported resources], currently `cpu` and `memory`, and limits to specify the maximum resources that can be consumed.\n <10> Specified xref:property-kafka-connect-logging-reference[Kafka Connect loggers and log levels] added directly (`inline`) or indirectly (`external`) through a ConfigMap. A custom ConfigMap must be placed under the `log4j.properties` or `log4j2.properties` key. For the Kafka Connect `log4j.rootLogger` logger, you can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.\n <11> xref:con-common-configuration-healthchecks-reference[Healthchecks] to know when to restart a container (liveness) and when a container can accept traffic (readiness).\n-<12> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled with configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using `metrics: {}`.\n+<12> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled by referencing a ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing empty file under `metricsConfig.valueFrom.configMapKeyRef.key`.", "originalCommit": "9e09bb1c8351fe38c359fb7e8d61434694c9dbad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQyNzc4Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r535427786", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <18> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled by referencing a ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing empty file under `metricsConfig.valueFrom.configMapKeyRef.key`.\n          \n          \n            \n            <18> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled by referencing a ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing an empty file under `metricsConfig.valueFrom.configMapKeyRef.key`.", "author": "PaulRMellor", "createdAt": "2020-12-03T17:15:37Z", "path": "documentation/modules/configuring/proc-config-mirrormaker.adoc", "diffHunk": "@@ -146,7 +142,7 @@ spec:\n <15> Requests for reservation of xref:con-common-configuration-resources-reference[supported resources], currently `cpu` and `memory`, and limits to specify the maximum resources that can be consumed.\n <16> Specified xref:property-mm-loggers-reference[loggers and log levels] added directly (`inline`) or indirectly (`external`) through a ConfigMap. A custom ConfigMap must be placed under the `log4j.properties` or `log4j2.properties` key. MirrorMaker has a single logger called `mirrormaker.root.logger`. You can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.\n <17> xref:con-common-configuration-healthchecks-reference[Healthchecks] to know when to restart a container (liveness) and when a container can accept traffic (readiness).\n-<18> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled with configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using `metrics: {}`.\n+<18> xref:con-common-configuration-prometheus-reference[Prometheus metrics], which are enabled by referencing a ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing empty file under `metricsConfig.valueFrom.configMapKeyRef.key`.", "originalCommit": "9e09bb1c8351fe38c359fb7e8d61434694c9dbad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQyODA0Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r535428043", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To enable Prometheus metrics export without further configuration, you can reference a ConfigMap containing empty file under `metricsConfig.valueFrom.configMapKeyRef.key`.\n          \n          \n            \n            To enable Prometheus metrics export without further configuration, you can reference a ConfigMap containing an empty file under `metricsConfig.valueFrom.configMapKeyRef.key`.", "author": "PaulRMellor", "createdAt": "2020-12-03T17:16:00Z", "path": "documentation/modules/ref-prometheus-metrics.adoc", "diffHunk": "@@ -5,17 +5,18 @@\n [id='ref-metrics-{context}']\n = Metrics configuration\n \n-Prometheus metrics are enabled by configuring the `metrics` property in following resources:\n+Prometheus metrics are enabled by configuring the `metricsConfig` property in following resources:\n \n * `Kafka.spec.kafka`\n * `Kafka.spec.zookeeper`\n * `KafkaConnect.spec`\n * `KafkaConnectS2I.spec`\n \n-When the `metrics` property is not defined in the resource, the Prometheus metrics will be disabled.\n-To enable Prometheus metrics export without any further configuration, you can set it to an empty object (`{}`).\n+When the `metricsConfig` (or deprecated `metrics`) property is not defined in the resource, the Prometheus metrics are disabled.\n+To enable Prometheus metrics export without further configuration, you can reference a ConfigMap containing empty file under `metricsConfig.valueFrom.configMapKeyRef.key`.", "originalCommit": "9e09bb1c8351fe38c359fb7e8d61434694c9dbad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQyODUzMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r535428531", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            All metrics without any renaming will be exposed in such a case.\n          \n          \n            \n            When referencing an empty file, all metrics are exposed as long as they have not been renamed.", "author": "PaulRMellor", "createdAt": "2020-12-03T17:16:39Z", "path": "documentation/modules/ref-prometheus-metrics.adoc", "diffHunk": "@@ -5,17 +5,18 @@\n [id='ref-metrics-{context}']\n = Metrics configuration\n \n-Prometheus metrics are enabled by configuring the `metrics` property in following resources:\n+Prometheus metrics are enabled by configuring the `metricsConfig` property in following resources:\n \n * `Kafka.spec.kafka`\n * `Kafka.spec.zookeeper`\n * `KafkaConnect.spec`\n * `KafkaConnectS2I.spec`\n \n-When the `metrics` property is not defined in the resource, the Prometheus metrics will be disabled.\n-To enable Prometheus metrics export without any further configuration, you can set it to an empty object (`{}`).\n+When the `metricsConfig` (or deprecated `metrics`) property is not defined in the resource, the Prometheus metrics are disabled.\n+To enable Prometheus metrics export without further configuration, you can reference a ConfigMap containing empty file under `metricsConfig.valueFrom.configMapKeyRef.key`.\n+All metrics without any renaming will be exposed in such a case.", "originalCommit": "9e09bb1c8351fe38c359fb7e8d61434694c9dbad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQyOTI5Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3948#discussion_r535429296", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <23> Kafka rules for exporting metrics to a Grafana dashboard through the JMX Exporter, which are enabled by referencing a ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing empty file under `metricsConfig.valueFrom.configMapKeyRef.key`.\n          \n          \n            \n            <23> Kafka rules for exporting metrics to a Grafana dashboard through the JMX Exporter, which are enabled by referencing a ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing an empty file under `metricsConfig.valueFrom.configMapKeyRef.key`.", "author": "PaulRMellor", "createdAt": "2020-12-03T17:17:47Z", "path": "documentation/modules/ref-sample-kafka-resource-config.adoc", "diffHunk": "@@ -147,8 +141,8 @@ spec:\n <19> Storage size for xref:proc-resizing-persistent-volumes-{context}[persistent volumes may be increased] and additional xref:proc-adding-volumes-to-jbod-storage-{context}[volumes may be added to JBOD storage].\n <20> Persistent storage has xref:ref-persistent-storage-{context}[additional configuration options], such as a storage `id` and `class` for dynamic volume provisioning.\n <21> xref:type-Rack-reference[Rack awareness] is configured to spread replicas across different racks. A `topologykey` must match the label of a cluster node.\n-<22> Kafka link:{BookURLDeploying}#assembly-metrics-setup-str[metrics configuration for use with Prometheus].\n-<23> Kafka rules for exporting metrics to a Grafana dashboard through the JMX Exporter. A set of rules provided with Strimzi may be copied to your Kafka resource configuration.\n+<22> Kafka xref:con-common-configuration-prometheus-reference[metrics configuration for use with Prometheus].\n+<23> Kafka rules for exporting metrics to a Grafana dashboard through the JMX Exporter, which are enabled by referencing a ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing empty file under `metricsConfig.valueFrom.configMapKeyRef.key`.", "originalCommit": "9e09bb1c8351fe38c359fb7e8d61434694c9dbad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "63e6dae0d8c3d7ee49ab36f66bff4b24e1a3ef78", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/63e6dae0d8c3d7ee49ab36f66bff4b24e1a3ef78", "message": "addressing comments\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-12-04T07:44:59Z", "type": "commit"}]}