{"pr_number": 3224, "pr_title": "Switch to using yq version 3.3.1+", "pr_createdAt": "2020-06-22T10:30:12Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3224", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ2NjIwMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3224#discussion_r443466202", "bodyText": "Thsi should probably use the GREP from the multi-platform-support.", "author": "scholzj", "createdAt": "2020-06-22T10:32:36Z", "path": "prerequisites-check.sh", "diffHunk": "@@ -13,7 +16,12 @@ check_command_present git\n check_command_present docker\n \n YQ_VERSION=\"$(yq --version | ${SED} 's/^.* //g')\"\n+# After version 3.3.1, yq --version sends the string to STDERR instead of STDOUT\n+if [ -z \"$YQ_VERSION\" ]; then\n+    YQ_VERSION=\"$(yq --version 2> >(grep -Po '\\d.\\d.\\d'))\"", "originalCommit": "e7aac11617bddc9fa28b88a4307a3e66747defc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ2NzE1Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3224#discussion_r443467156", "bodyText": "Good point.", "author": "tomncooper", "createdAt": "2020-06-22T10:34:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ2NjIwMg=="}], "type": "inlineReview"}, {"oid": "50fe782d2a3fb6d383d355cca522078788c027df", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/50fe782d2a3fb6d383d355cca522078788c027df", "message": "Fix yq version check in prerequisties-check\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-22T14:16:49Z", "type": "forcePushed"}, {"oid": "b53f49c5844db12aebc9d28cfb81a05222bd6577", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b53f49c5844db12aebc9d28cfb81a05222bd6577", "message": "Recreated helm charts with yq 3.3.1\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-23T10:22:53Z", "type": "forcePushed"}, {"oid": "4ec31209e56f71c91a8fe637b1e833c4c636e494", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/4ec31209e56f71c91a8fe637b1e833c4c636e494", "message": "Updated travis/azure yq version\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-23T10:30:29Z", "type": "forcePushed"}, {"oid": "59e5c4bc708a6487c3620a0c70df3551854d7f27", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/59e5c4bc708a6487c3620a0c70df3551854d7f27", "message": "Updated travis/azure yq version\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-23T10:41:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDg1MDA4NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3224#discussion_r444850085", "bodyText": "Do we still need to be able to handle both 3.3.1 as well as the previous versions on line 18? Or could we just remove it?", "author": "scholzj", "createdAt": "2020-06-24T12:15:02Z", "path": "prerequisites-check.sh", "diffHunk": "@@ -13,7 +16,22 @@ check_command_present git\n check_command_present docker\n \n YQ_VERSION=\"$(yq --version | ${SED} 's/^.* //g')\"\n-if [[ ${YQ_VERSION} != \"3.\"* ]]; then\n-  echo -e \"${RED}yq vesion is ${YQ_VERSION}, version must be 3.*${NO_COLOUR}\"\n+# After version 3.3.1, yq --version sends the string to STDERR instead of STDOUT\n+if [ -z \"$YQ_VERSION\" ]; then\n+    YQ_VERSION=\"$(yq --version 2> >($GREP -Po '\\d.\\d.\\d'))\"\n+fi\n+\n+yq_array=($(echo \"$YQ_VERSION\" | tr '.' '\\n'))", "originalCommit": "d90d6bd73f136d576388ee84dfa5be9bd75ebc35", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDg1MTIyOQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3224#discussion_r444851229", "bodyText": "The old version sends the version string to STDOUT so we need that line to capture that and tell the user to upgrade. The new version (3.3.1+) sends it to STDERR so we need to cover both to reliably check the version of yq.", "author": "tomncooper", "createdAt": "2020-06-24T12:17:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDg1MDA4NQ=="}], "type": "inlineReview"}, {"oid": "2489235b58f094f739a573d14f4353b866935ae0", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2489235b58f094f739a573d14f4353b866935ae0", "message": "Switch to using yq version 3.3.1 and mandate in prerequisties check\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-24T15:14:14Z", "type": "commit"}, {"oid": "853151a18b082a9fac7b6a20b902797d10017e0d", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/853151a18b082a9fac7b6a20b902797d10017e0d", "message": "Recreated helm charts with yq 3.3.1\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-24T15:14:20Z", "type": "commit"}, {"oid": "dcb5965eae59105114a933c3795083e20da68049", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/dcb5965eae59105114a933c3795083e20da68049", "message": "Updated travis/azure yq version\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-24T15:14:20Z", "type": "commit"}, {"oid": "a851dd0c4dca5d33f246cfacd91fc8bf24aeee3c", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/a851dd0c4dca5d33f246cfacd91fc8bf24aeee3c", "message": "Updated cluster roles\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-24T15:14:20Z", "type": "commit"}, {"oid": "3bae12b326c02decbde09d6f0cccb19eed21985a", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3bae12b326c02decbde09d6f0cccb19eed21985a", "message": "Update Jenkins pipeline\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-24T15:14:20Z", "type": "commit"}, {"oid": "3bae12b326c02decbde09d6f0cccb19eed21985a", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3bae12b326c02decbde09d6f0cccb19eed21985a", "message": "Update Jenkins pipeline\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-06-24T15:14:20Z", "type": "forcePushed"}]}