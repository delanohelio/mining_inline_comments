{"pr_number": 3353, "pr_title": "[DOC] Updates to external listener config procedures", "pr_createdAt": "2020-07-21T16:42:24Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353", "timeline": [{"oid": "e2e36b1d3638e23c6a465d709630d9c982d1ff87", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e2e36b1d3638e23c6a465d709630d9c982d1ff87", "message": "[DOC] Updates to external listener config procedures\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-07-21T16:34:07Z", "type": "commit"}, {"oid": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fae46685413e3a060595f1a1dda81c0c2dab4ebb", "message": "edit step 1\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-07-21T16:43:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI0NDYwMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458244600", "bodyText": "@scholzj - Not sure what this step is meant to do. So added some placeholder commands!", "author": "PaulRMellor", "createdAt": "2020-07-21T16:51:06Z", "path": "documentation/modules/proc-accessing-kafka-using-ingress.adoc", "diffHunk": "@@ -45,22 +52,33 @@ spec:\n   zookeeper:\n     # ...\n ----\n+<1> Ingress hosts for the bootstrap service and kafka brokers.\n \n-. Make sure the hosts in the `configuration` section properly resolve to the Ingress endpoints.\n+. Make sure the hosts in the `configuration` resolve to the Ingress endpoints.\n++\n+[source,shell,subs=+quotes]\n+kubectl get services\n+kubectl describe service _INGRESS-NAME_", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5NDEwNw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458294107", "bodyText": "This whole segment should be removed - I do not think there is any easy way to check the routing of the DNS names to the Ingress.", "author": "scholzj", "createdAt": "2020-07-21T18:11:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI0NDYwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYwMTc0NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458601745", "bodyText": "Removed the step", "author": "PaulRMellor", "createdAt": "2020-07-22T07:49:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI0NDYwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4Mjk2NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458282964", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This procedure shows how to access a Strimzi Kafka cluster from an external client outside of Kubernetes using Ingress.\n          \n          \n            \n            This procedure shows how to access a Strimzi Kafka cluster from an external client outside of Kubernetes using Nginx Ingress.", "author": "scholzj", "createdAt": "2020-07-21T17:53:30Z", "path": "documentation/modules/proc-accessing-kafka-using-ingress.adoc", "diffHunk": "@@ -5,19 +5,26 @@\n [id='proc-accessing-kafka-using-ingress-{context}']\n = Accessing Kafka using ingress\n \n-This procedure shows how to access Strimzi Kafka clusters from outside of Kubernetes using Ingress.\n+This procedure shows how to access a Strimzi Kafka cluster from an external client outside of Kubernetes using Ingress.", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU1MTUxNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458551514", "bodyText": "Out of curiosity, isn't it right to say just \"Kubernetes Ingress\" and the fact that you are using the Nginx Ingress controller is only an implementation detail but maybe you could use another controller?", "author": "ppatierno", "createdAt": "2020-07-22T05:55:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4Mjk2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU1NTUyOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458555528", "bodyText": "The Ingress approach IMHO didn't went well for Kubernetes. The controllers are not fully compatible - they work fine for simple HTTP use-cases but not for some edge stuff such as TLS passthrough etc. In Strimzi, we quite specifically say that we support only Nginx Ingress which is the only one we work with and test with right now. This is from my understanding also why the Ingress class exists etc.", "author": "scholzj", "createdAt": "2020-07-22T06:07:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4Mjk2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4MzYyMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458283622", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Ingress is used for HTTP access, so the port used to connect is always 443.\n          \n          \n            \n            For access using Ingress, the port is always 443.\n          \n      \n    \n    \n  \n\nI think the HTTP reference here is rather confusing since Kafka is not HTTP. So I would leave it out.", "author": "scholzj", "createdAt": "2020-07-21T17:54:37Z", "path": "documentation/modules/proc-accessing-kafka-using-ingress.adoc", "diffHunk": "@@ -5,19 +5,26 @@\n [id='proc-accessing-kafka-using-ingress-{context}']\n = Accessing Kafka using ingress\n \n-This procedure shows how to access Strimzi Kafka clusters from outside of Kubernetes using Ingress.\n+This procedure shows how to access a Strimzi Kafka cluster from an external client outside of Kubernetes using Ingress.\n+\n+To connect to a broker, you need a hostname (advertised address) for the Ingress _bootstrap address_,\n+as well as the certificate used for authentication.\n+\n+Ingress is used for HTTP access, so the port used to connect is always 443.", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU1MTgwMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458551800", "bodyText": "And should be it HTTPS because of 443 (or it's a non-encrypted 443?)", "author": "ppatierno", "createdAt": "2020-07-22T05:56:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4MzYyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYwMzM5Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458603396", "bodyText": "Updated. Updated the other procedures to be the same.", "author": "PaulRMellor", "createdAt": "2020-07-22T07:52:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4MzYyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4MzkxMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458283910", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Specify the Ingress hosts for the bootstrap service and kafka brokers.\n          \n          \n            \n            Specify the Ingress hosts for the bootstrap service and Kafka brokers.", "author": "scholzj", "createdAt": "2020-07-21T17:55:04Z", "path": "documentation/modules/proc-accessing-kafka-using-ingress.adoc", "diffHunk": "@@ -5,19 +5,26 @@\n [id='proc-accessing-kafka-using-ingress-{context}']\n = Accessing Kafka using ingress\n \n-This procedure shows how to access Strimzi Kafka clusters from outside of Kubernetes using Ingress.\n+This procedure shows how to access a Strimzi Kafka cluster from an external client outside of Kubernetes using Ingress.\n+\n+To connect to a broker, you need a hostname (advertised address) for the Ingress _bootstrap address_,\n+as well as the certificate used for authentication.\n+\n+Ingress is used for HTTP access, so the port used to connect is always 443.\n \n .Prerequisites\n \n-* An Kubernetes cluster\n+* Kubernetes cluster\n * Deployed {NginxIngressController} with TLS passthrough enabled\n * A running Cluster Operator\n \n .Procedure\n \n-. Deploy Kafka cluster with an external listener enabled and configured to the type `ingress`.\n+. Configure a `Kafka` resource with an external listener set to the `ingress` type.\n +\n-An example configuration with an external listener configured to use `Ingress`:\n+Specify the Ingress hosts for the bootstrap service and kafka brokers.", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4NDYyNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458284626", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <1> Ingress hosts for the bootstrap service and kafka brokers.\n          \n          \n            \n            <1> Ingress hosts for the bootstrap service and Kafka brokers.", "author": "scholzj", "createdAt": "2020-07-21T17:56:15Z", "path": "documentation/modules/proc-accessing-kafka-using-ingress.adoc", "diffHunk": "@@ -45,22 +52,33 @@ spec:\n   zookeeper:\n     # ...\n ----\n+<1> Ingress hosts for the bootstrap service and kafka brokers.", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4NjA1Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458286056", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `ingress` type services are created for each Kafka broker, as well as an external _bootstrap service_.\n          \n          \n            \n            `ClusterIP` type services are created for each Kafka broker, as well as an additional _bootstrap service_.", "author": "scholzj", "createdAt": "2020-07-21T17:58:33Z", "path": "documentation/modules/proc-accessing-kafka-using-ingress.adoc", "diffHunk": "@@ -45,22 +52,33 @@ spec:\n   zookeeper:\n     # ...\n ----\n+<1> Ingress hosts for the bootstrap service and kafka brokers.\n \n-. Make sure the hosts in the `configuration` section properly resolve to the Ingress endpoints.\n+. Make sure the hosts in the `configuration` resolve to the Ingress endpoints.\n++\n+[source,shell,subs=+quotes]\n+kubectl get services\n+kubectl describe service _INGRESS-NAME_\n \n . Create or update the resource.\n +\n [source,shell,subs=+quotes]\n kubectl apply -f _KAFKA-CONFIG-FILE_\n++\n+`ingress` type services are created for each Kafka broker, as well as an external _bootstrap service_.", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4NjM0Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458286346", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The bootstrap service routes external traffic to the Kafka brokers.\n          \n          \n            \n            These services are used by the Ingress controller to route traffic to the Kafka brokers.", "author": "scholzj", "createdAt": "2020-07-21T17:58:58Z", "path": "documentation/modules/proc-accessing-kafka-using-ingress.adoc", "diffHunk": "@@ -45,22 +52,33 @@ spec:\n   zookeeper:\n     # ...\n ----\n+<1> Ingress hosts for the bootstrap service and kafka brokers.\n \n-. Make sure the hosts in the `configuration` section properly resolve to the Ingress endpoints.\n+. Make sure the hosts in the `configuration` resolve to the Ingress endpoints.\n++\n+[source,shell,subs=+quotes]\n+kubectl get services\n+kubectl describe service _INGRESS-NAME_\n \n . Create or update the resource.\n +\n [source,shell,subs=+quotes]\n kubectl apply -f _KAFKA-CONFIG-FILE_\n++\n+`ingress` type services are created for each Kafka broker, as well as an external _bootstrap service_.\n+The bootstrap service routes external traffic to the Kafka brokers.", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4NzYyNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458287625", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To connect to a broker, you need a hostname (advertised address) for the loadbalancer _bootstrap address_,\n          \n          \n            \n            To connect to a broker, you need the address of the _bootstrap loadbalancer_,", "author": "scholzj", "createdAt": "2020-07-21T18:00:57Z", "path": "documentation/modules/proc-accessing-kafka-using-loadbalancers.adoc", "diffHunk": "@@ -5,16 +5,23 @@\n [id='proc-accessing-kafka-using-loadbalancers-{context}']\n = Accessing Kafka using loadbalancers\n \n+This procedure describes how to access a Strimzi Kafka cluster from an external client using loadbalancers.\n+\n+To connect to a broker, you need a hostname (advertised address) for the loadbalancer _bootstrap address_,", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4NzgxMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458287810", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            as well as the certificate used for authentication.\n          \n          \n            \n            as well as the certificate used for TLS encryption.", "author": "scholzj", "createdAt": "2020-07-21T18:01:15Z", "path": "documentation/modules/proc-accessing-kafka-using-loadbalancers.adoc", "diffHunk": "@@ -5,16 +5,23 @@\n [id='proc-accessing-kafka-using-loadbalancers-{context}']\n = Accessing Kafka using loadbalancers\n \n+This procedure describes how to access a Strimzi Kafka cluster from an external client using loadbalancers.\n+\n+To connect to a broker, you need a hostname (advertised address) for the loadbalancer _bootstrap address_,\n+as well as the certificate used for authentication.", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4ODA0Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458288047", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The bootstrap service routes external traffic to the Kafka brokers.\n          \n          \n            \n            The bootstrap service routes external traffic to all Kafka brokers.", "author": "scholzj", "createdAt": "2020-07-21T18:01:40Z", "path": "documentation/modules/proc-accessing-kafka-using-loadbalancers.adoc", "diffHunk": "@@ -36,27 +43,28 @@ spec:\n \n . Create or update the resource.\n +\n-This can be done using `kubectl apply`:\n [source,shell,subs=+quotes]\n kubectl apply -f _KAFKA-CONFIG-FILE_\n++\n+`loadbalancer` type services and loadbalancers are created for each Kafka broker, as well as an external _bootstrap service_.\n+The bootstrap service routes external traffic to the Kafka brokers.", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MDA0OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458290049", "bodyText": "This whole section / bullet point should be replaced with something like this\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            . Retrieve the address of the bootstrap service to access the Kafka cluster.\n          \n          \n            \n            . Retrieve the address of the bootstrap service to access the Kafka cluster.\n          \n          \n            \n            \n          \n          \n            \n            [source,shell,subs=+quotes]\n          \n          \n            \n            kubectl get kafka _KAFKA-CLUSTER-NAME_ -o=jsonpath='{.status.listeners[?(@.type==\"external\")].bootstrapServers}{\"\\n\"}'", "author": "scholzj", "createdAt": "2020-07-21T18:05:11Z", "path": "documentation/modules/proc-accessing-kafka-using-loadbalancers.adoc", "diffHunk": "@@ -36,27 +43,28 @@ spec:\n \n . Create or update the resource.\n +\n-This can be done using `kubectl apply`:\n [source,shell,subs=+quotes]\n kubectl apply -f _KAFKA-CONFIG-FILE_\n++\n+`loadbalancer` type services and loadbalancers are created for each Kafka broker, as well as an external _bootstrap service_.\n+The bootstrap service routes external traffic to the Kafka brokers.\n+DNS names and IP addresses used for connection are propagated to the `status` of each service.\n \n-. Find the hostname of the bootstrap loadbalancer.\n+. Retrieve the address of the bootstrap service to access the Kafka cluster.", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYwOTM4MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458609381", "bodyText": "@scholzj I originally changed this and then changed back, thinking the status was the key. I've replaced now, but we don't want both? We don't want the IP fetch either?", "author": "PaulRMellor", "createdAt": "2020-07-22T08:02:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MDA0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODgwOTc2NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458809764", "bodyText": "What we now basically do is we do the original steps in the operator and put it always into a single place. So instead of taking it from the status of the operator, the user can take it from the Kafka status with all the methods. So the user does not have to search for the services etc. This is the same for both the IP and hostname.", "author": "scholzj", "createdAt": "2020-07-22T13:54:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MDA0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMxMDc5OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r459310799", "bodyText": "Thanks. I get it now.", "author": "PaulRMellor", "createdAt": "2020-07-23T09:03:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MDA0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MDU1Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458290557", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To connect to a broker, you need a hostname (advertised address) and port number for the Kafka _bootstrap address_,\n          \n          \n            \n            To connect to a broker, you need a hostname and port number for the Kafka _bootstrap address_,", "author": "scholzj", "createdAt": "2020-07-21T18:06:02Z", "path": "documentation/modules/proc-accessing-kafka-using-nodeports.adoc", "diffHunk": "@@ -7,7 +7,7 @@\n \n This procedure describes how to access a Strimzi Kafka cluster from an external client using node ports.\n \n-To connect to a broker, you need the hostname (advertised address) and port number for the Kafka _bootstrap_ address,\n+To connect to a broker, you need a hostname (advertised address) and port number for the Kafka _bootstrap address_,", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MDkwNw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458290907", "bodyText": "This is unrelated to the nodeports. MAybe we should remove it from this procedure?", "author": "scholzj", "createdAt": "2020-07-21T18:06:41Z", "path": "documentation/modules/proc-accessing-kafka-using-nodeports.adoc", "diffHunk": "@@ -35,36 +35,38 @@ spec:\n         authentication:\n           type: tls\n         configuration:\n-          brokerCertChainAndKey: <1>\n+          brokerCertChainAndKey: <2>\n             secretName: my-secret\n             certificate: my-certificate.crt\n             key: my-key.key", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYxMzIwMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458613201", "bodyText": "We can remove it, but isn't it used with nodeport? https://strimzi.io/docs/operators/master/using.html#type-NodePortListenerConfiguration-reference", "author": "PaulRMellor", "createdAt": "2020-07-22T08:09:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MDkwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODgxMDQ4Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458810482", "bodyText": "It can be used with any external listener. So it is not wrong per se. But it is not required, just optional. So I think having it in this example just here might be confusing.", "author": "scholzj", "createdAt": "2020-07-22T13:55:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MDkwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMxMjU5MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r459312591", "bodyText": "Removed. We talk about it in the concepts and Providing your own Kafka listener certificates. I guess that's enough.", "author": "PaulRMellor", "createdAt": "2020-07-23T09:06:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MDkwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MTQxOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458291418", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Node addresses used for connection are propagated to the `status` of each service.\n          \n          \n            \n            Node addresses used for connection are propagated to the `status` of the Kafka custom resource.", "author": "scholzj", "createdAt": "2020-07-21T18:07:31Z", "path": "documentation/modules/proc-accessing-kafka-using-nodeports.adoc", "diffHunk": "@@ -35,36 +35,38 @@ spec:\n         authentication:\n           type: tls\n         configuration:\n-          brokerCertChainAndKey: <1>\n+          brokerCertChainAndKey: <2>\n             secretName: my-secret\n             certificate: my-certificate.crt\n             key: my-key.key\n-          preferredAddressType: InternalDNS <2>\n+          preferredAddressType: InternalDNS <3>\n     # ...\n   zookeeper:\n     # ...\n ----\n-<1> Optional configuration for a xref:kafka-listener-certificates-str[Kafka listener certificate] managed by an external Certificate Authority. The `brokerCertChainAndKey` property specifies a `Secret` that holds a server certificate and a private key. Kafka listener certificates can also be configured for TLS listeners.\n-<2> Optional configuration to xref:con-kafka-broker-external-listeners-nodeports-{context}[specify a preference for the first address type used by Strimzi as the node address].\n+<2> Optional configuration for a xref:kafka-listener-certificates-str[Kafka listener certificate] managed by an external Certificate Authority. The `brokerCertChainAndKey` property specifies a `Secret` that holds a server certificate and a private key. Kafka listener certificates can also be configured for TLS listeners.\n+<3> Optional configuration to xref:con-kafka-broker-external-listeners-nodeports-{context}[specify a preference for the first address type used by Strimzi as the node address].\n \n . Create or update the resource.\n +\n [source,shell,subs=+quotes]\n kubectl apply -f _KAFKA-CONFIG-FILE_\n++\n+`NodePort` type services are created for each Kafka broker, as well as an external _bootstrap service_.\n+The bootstrap service routes external traffic to the Kafka brokers.\n+Node addresses used for connection are propagated to the `status` of each service.", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MTk0NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458291944", "bodyText": "From this point on the rest of the Retrieve the connection details to access the Kafka cluster. section should be removed.", "author": "scholzj", "createdAt": "2020-07-21T18:08:20Z", "path": "documentation/modules/proc-accessing-kafka-using-nodeports.adoc", "diffHunk": "@@ -35,36 +35,38 @@ spec:\n         authentication:\n           type: tls\n         configuration:\n-          brokerCertChainAndKey: <1>\n+          brokerCertChainAndKey: <2>\n             secretName: my-secret\n             certificate: my-certificate.crt\n             key: my-key.key\n-          preferredAddressType: InternalDNS <2>\n+          preferredAddressType: InternalDNS <3>\n     # ...\n   zookeeper:\n     # ...\n ----\n-<1> Optional configuration for a xref:kafka-listener-certificates-str[Kafka listener certificate] managed by an external Certificate Authority. The `brokerCertChainAndKey` property specifies a `Secret` that holds a server certificate and a private key. Kafka listener certificates can also be configured for TLS listeners.\n-<2> Optional configuration to xref:con-kafka-broker-external-listeners-nodeports-{context}[specify a preference for the first address type used by Strimzi as the node address].\n+<2> Optional configuration for a xref:kafka-listener-certificates-str[Kafka listener certificate] managed by an external Certificate Authority. The `brokerCertChainAndKey` property specifies a `Secret` that holds a server certificate and a private key. Kafka listener certificates can also be configured for TLS listeners.\n+<3> Optional configuration to xref:con-kafka-broker-external-listeners-nodeports-{context}[specify a preference for the first address type used by Strimzi as the node address].\n \n . Create or update the resource.\n +\n [source,shell,subs=+quotes]\n kubectl apply -f _KAFKA-CONFIG-FILE_\n++\n+`NodePort` type services are created for each Kafka broker, as well as an external _bootstrap service_.\n+The bootstrap service routes external traffic to the Kafka brokers.\n+Node addresses used for connection are propagated to the `status` of each service.\n \n-. Find the port number of the bootstrap service.\n+. Retrieve the connection details to access the Kafka cluster.\n +\n [source,shell,subs=+quotes]\n-kubectl get service _KAFKA-CLUSTER-NAME_-kafka-external-bootstrap -o=jsonpath='{.spec.ports[0].nodePort}{\"\\n\"}'\n+kubectl get kafka _KAFKA-CLUSTER-NAME_ -o=jsonpath='{.status.listeners[?(@.type==\"external\")].bootstrapServers}{\"\\n\"}'\n +\n-The port is used in the Kafka _bootstrap_ address.\n-\n-. Find the address of the Kubernetes node.\n+You need:", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYxNjU3Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458616577", "bodyText": "Can we confirm/verify what the reader needs to pick up from the fetch?\n\nUse the address and port number of one of the kafka broker nodes (NODE-ADDRESS:NODE-PORT) in your Kafka client as the bootstrap address to connect to the Kafka cluster.", "author": "PaulRMellor", "createdAt": "2020-07-22T08:15:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MTk0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODgxMTcyNw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458811727", "bodyText": "When the user runs this command: kubectl get kafka _KAFKA-CLUSTER-NAME_ -o=jsonpath='{.status.listeners[?(@.type==\"external\")].bootstrapServers}{\"\\n\"}' ... it will give back the bootstrap address ... so the _NODE-ADDRESS:NODE-PORT_. That is why the user doesn't need anything more.", "author": "scholzj", "createdAt": "2020-07-22T13:56:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MTk0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMxNTU5MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r459315590", "bodyText": "Removed", "author": "PaulRMellor", "createdAt": "2020-07-23T09:12:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MTk0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MjEwNw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458292107", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To connect to a broker, you need a hostname (advertised address) for the route _bootstrap address_,\n          \n          \n            \n            To connect to a broker, you need a hostname for the route _bootstrap address_,", "author": "scholzj", "createdAt": "2020-07-21T18:08:39Z", "path": "documentation/modules/proc-accessing-kafka-using-routes.adoc", "diffHunk": "@@ -5,16 +5,23 @@\n [id='proc-accessing-kafka-using-routes-{context}']\n = Accessing Kafka using OpenShift routes\n \n+This procedure describes how to access a Strimzi Kafka cluster from an external client outside of OpenShift using routes.\n+\n+To connect to a broker, you need a hostname (advertised address) for the route _bootstrap address_,", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MjI3NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458292275", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            as well as the certificate used for authentication.\n          \n          \n            \n            as well as the certificate used for TLS encryption.", "author": "scholzj", "createdAt": "2020-07-21T18:08:57Z", "path": "documentation/modules/proc-accessing-kafka-using-routes.adoc", "diffHunk": "@@ -5,16 +5,23 @@\n [id='proc-accessing-kafka-using-routes-{context}']\n = Accessing Kafka using OpenShift routes\n \n+This procedure describes how to access a Strimzi Kafka cluster from an external client outside of OpenShift using routes.\n+\n+To connect to a broker, you need a hostname (advertised address) for the route _bootstrap address_,\n+as well as the certificate used for authentication.", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MjYwMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458292601", "bodyText": "Again, we should either remove the HTTP reference or explain the details about TLS passthrough masking the Kafka traffic as HTTPS.", "author": "scholzj", "createdAt": "2020-07-21T18:09:30Z", "path": "documentation/modules/proc-accessing-kafka-using-routes.adoc", "diffHunk": "@@ -5,16 +5,23 @@\n [id='proc-accessing-kafka-using-routes-{context}']\n = Accessing Kafka using OpenShift routes\n \n+This procedure describes how to access a Strimzi Kafka cluster from an external client outside of OpenShift using routes.\n+\n+To connect to a broker, you need a hostname (advertised address) for the route _bootstrap address_,\n+as well as the certificate used for authentication.\n+\n+Routes are used for HTTP access, so the port used to connect is always 443.", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYyNzMzMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458627330", "bodyText": "For access using routes, the port is always 443.", "author": "PaulRMellor", "createdAt": "2020-07-22T08:33:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MjYwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MzAzMw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458293033", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The bootstrap service routes external traffic to the Kafka brokers.\n          \n          \n            \n            The services route the traffic from the OpenShift Routes to the Kafka brokers.", "author": "scholzj", "createdAt": "2020-07-21T18:10:06Z", "path": "documentation/modules/proc-accessing-kafka-using-routes.adoc", "diffHunk": "@@ -36,13 +43,20 @@ spec:\n +\n [source,shell,subs=+quotes]\n oc apply -f _KAFKA-CONFIG-FILE_\n++\n+`ClusterIP` type services are created for each Kafka broker, as well as an external _bootstrap service_.\n+The bootstrap service routes external traffic to the Kafka brokers.", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MzMyMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458293320", "bodyText": "Again, you can just use the command kubectl get kafka my-cluster -o=jsonpath='{.status.listeners[?(@.type==\"external\")].bootstrapServers}{\"\\n\"}'", "author": "scholzj", "createdAt": "2020-07-21T18:10:36Z", "path": "documentation/modules/proc-accessing-kafka-using-routes.adoc", "diffHunk": "@@ -36,13 +43,20 @@ spec:\n +\n [source,shell,subs=+quotes]\n oc apply -f _KAFKA-CONFIG-FILE_\n++\n+`ClusterIP` type services are created for each Kafka broker, as well as an external _bootstrap service_.\n+The bootstrap service routes external traffic to the Kafka brokers.\n+An OpenShift `Route` resource is also created for each service to expose them using the HAProxy load balancer.\n+DNS addresses used for connection are propagated to the `status` of each service.\n \n-. Find the address of the bootstrap `Route`.\n+. Retrieve the address of the bootstrap service to access the Kafka cluster.\n +\n [source,shell,subs=+quotes]\n oc get routes _KAFKA-CLUSTER-NAME_-kafka-bootstrap -o=jsonpath='{.status.ingress[0].host}{\"\\n\"}'", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MzQ1MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3353#discussion_r458293450", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            You need the address of the `Route` bootstrap service (`_KAFKA-CLUSTER-NAME_-kafka-bootstrap`).\n          \n          \n            \n            +\n          \n          \n            \n            Use the route service address and port 443 (_ROUTE-ADDRESS:443_) in your Kafka client as the _bootstrap address_ to connect to the Kafka cluster.", "author": "scholzj", "createdAt": "2020-07-21T18:10:51Z", "path": "documentation/modules/proc-accessing-kafka-using-routes.adoc", "diffHunk": "@@ -36,13 +43,20 @@ spec:\n +\n [source,shell,subs=+quotes]\n oc apply -f _KAFKA-CONFIG-FILE_\n++\n+`ClusterIP` type services are created for each Kafka broker, as well as an external _bootstrap service_.\n+The bootstrap service routes external traffic to the Kafka brokers.\n+An OpenShift `Route` resource is also created for each service to expose them using the HAProxy load balancer.\n+DNS addresses used for connection are propagated to the `status` of each service.\n \n-. Find the address of the bootstrap `Route`.\n+. Retrieve the address of the bootstrap service to access the Kafka cluster.\n +\n [source,shell,subs=+quotes]\n oc get routes _KAFKA-CLUSTER-NAME_-kafka-bootstrap -o=jsonpath='{.status.ingress[0].host}{\"\\n\"}'\n +\n-Use the address together with port 443 in your Kafka client as the _bootstrap_ address.\n+You need the address of the `Route` bootstrap service (`_KAFKA-CLUSTER-NAME_-kafka-bootstrap`).\n++\n+Use the route service address and port 443 (_ROUTE-ADDRESS:443_) in your Kafka client as the _bootstrap address_ to connect to the Kafka cluster.", "originalCommit": "fae46685413e3a060595f1a1dda81c0c2dab4ebb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "de84bd0bf274ef8750d687aa10ff6b83c4d00570", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/de84bd0bf274ef8750d687aa10ff6b83c4d00570", "message": "review edits\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-07-24T16:44:08Z", "type": "commit"}, {"oid": "7e724880e13d41d6e5c7a6168a21f857b24f7e8e", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/7e724880e13d41d6e5c7a6168a21f857b24f7e8e", "message": "review edits JS\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-07-24T16:44:29Z", "type": "commit"}, {"oid": "0dc7fde38fc360221bdd72abd47038b88ec15eb1", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/0dc7fde38fc360221bdd72abd47038b88ec15eb1", "message": "add note used in deploying guide for CA cert", "committedDate": "2020-07-24T16:44:29Z", "type": "forcePushed"}, {"oid": "15c27877ea3ad8e451c5fef1e253e21ade1e39b9", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/15c27877ea3ad8e451c5fef1e253e21ade1e39b9", "message": "review edit PM\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-07-24T16:47:27Z", "type": "commit"}, {"oid": "15c27877ea3ad8e451c5fef1e253e21ade1e39b9", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/15c27877ea3ad8e451c5fef1e253e21ade1e39b9", "message": "review edit PM\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-07-24T16:47:27Z", "type": "forcePushed"}]}