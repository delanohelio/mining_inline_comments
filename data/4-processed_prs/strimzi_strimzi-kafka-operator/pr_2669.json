{"pr_number": 2669, "pr_title": "feat: Convert to context succeeding Part 3", "pr_createdAt": "2020-03-09T21:04:02Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2669", "timeline": [{"oid": "42cfe0853bff6d57e8b8620280dc5dcaa1472600", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/42cfe0853bff6d57e8b8620280dc5dcaa1472600", "message": "feat: Operator-common test context\n\nSigned-off-by: Samuel Hawker <samuel.hawker@ibm.com>", "committedDate": "2020-03-09T23:13:20Z", "type": "commit"}, {"oid": "eae745d46bfc37a63bf976be272263eb1fc97548", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/eae745d46bfc37a63bf976be272263eb1fc97548", "message": "feat: More operator common tests\n\nSigned-off-by: Samuel Hawker <samuel.hawker@ibm.com>", "committedDate": "2020-03-09T23:28:46Z", "type": "commit"}, {"oid": "eae745d46bfc37a63bf976be272263eb1fc97548", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/eae745d46bfc37a63bf976be272263eb1fc97548", "message": "feat: More operator common tests\n\nSigned-off-by: Samuel Hawker <samuel.hawker@ibm.com>", "committedDate": "2020-03-09T23:28:46Z", "type": "forcePushed"}, {"oid": "b8f3058e3b9b96102d2ee8656005b305f93ef887", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b8f3058e3b9b96102d2ee8656005b305f93ef887", "message": "fix: StatefulsetOperatorTest fix abstract method call\n\nSigned-off-by: Samuel Hawker <samuel.hawker@ibm.com>", "committedDate": "2020-03-10T23:45:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc5NDIwOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2669#discussion_r390794208", "bodyText": "I wonder if these timeouts had any special meanings and how / when the test timeouts without them. They seem to be in several of these tests. Have you done any tests around this?", "author": "scholzj", "createdAt": "2020-03-11T07:54:26Z", "path": "operator-common/src/test/java/io/strimzi/operator/common/operator/resource/KafkaConnectCrdOperatorIT.java", "diffHunk": "@@ -119,86 +120,51 @@ protected KafkaConnect getResource() {\n     }\n \n     @Test\n-    public void testUpdateStatus(VertxTestContext context) throws InterruptedException, ExecutionException, TimeoutException {\n-        log.info(\"Getting Kubernetes version\");\n-        CountDownLatch versionAsync = new CountDownLatch(1);\n-        AtomicReference<PlatformFeaturesAvailability> pfa = new AtomicReference<>();\n-        PlatformFeaturesAvailability.create(vertx, client).setHandler(pfaRes -> {\n-            if (pfaRes.succeeded())    {\n-                pfa.set(pfaRes.result());\n-                versionAsync.countDown();\n-            } else {\n-                context.failNow(pfaRes.cause());\n-            }\n-        });\n-        if (!versionAsync.await(60, TimeUnit.SECONDS)) {\n-            context.failNow(new Throwable(\"Test timeout\"));", "originalCommit": "b8f3058e3b9b96102d2ee8656005b305f93ef887", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTA2OTkwMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2669#discussion_r391069901", "bodyText": "I am glad you brought this up, I should have documented this better as I raised the PR.\nI have switched to using the Checkpoint object, this comes with the default vertx test timeout (though can be overridden as you have for several tests in other classes using e.g. (    @Timeout(value = 2, timeUnit = TimeUnit.MINUTES))\nI can see for some tests we might need to have to override the default timeout like above, but for the tests i refactored this was not needed.\nFor each of the steps i wrapped them in a context.succeeding, failing, or verify all of these will immediately call context.failNow with all relevant information if their assertions aren't met.\nBy using a single checkpoint at the end of a test we can gate its completion on reaching the end without throwing an exception (unless the exception is expected ofcourse).\nIn the event that none of the assertions fail, the checkpoint will still timeout and cause a failNow reporting that it had timed out. In cases like these the log lines are most useful for inferring where we didn't reach up to, but we can easily mitigate this, if it is not good enough, by adding in more checkpoints that are incremental throughout the test.", "author": "samuel-hawker", "createdAt": "2020-03-11T15:46:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc5NDIwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE3MDcwOQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2669#discussion_r391170709", "bodyText": "Great, thanks for the explanation. \ud83d\udc4d", "author": "scholzj", "createdAt": "2020-03-11T18:15:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc5NDIwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTIwMjg2MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2669#discussion_r391202861", "bodyText": "Anytime!", "author": "samuel-hawker", "createdAt": "2020-03-11T19:13:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc5NDIwOA=="}], "type": "inlineReview"}]}