{"pr_number": 3560, "pr_title": "[DOC] Docs improvements for configuring SCRAM-SHA-512 authentication in Kafka Connect", "pr_createdAt": "2020-08-27T15:03:25Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3560", "timeline": [{"oid": "d399e6917208e9015cef8f6ba3f43eeca858685b", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d399e6917208e9015cef8f6ba3f43eeca858685b", "message": "edit content\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-08-27T11:13:35Z", "type": "commit"}, {"oid": "b96b0fcbb88b3d1cb6863a2a0f849d18c50145a4", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b96b0fcbb88b3d1cb6863a2a0f849d18c50145a4", "message": "content edit\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-08-27T14:41:04Z", "type": "commit"}, {"oid": "dcd189f1d181238caed43daafea3a69de69503ae", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/dcd189f1d181238caed43daafea3a69de69503ae", "message": "tw edits\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-08-27T15:22:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYyNDQxMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3560#discussion_r478624412", "bodyText": "It is only the password what is in secret. The username is directly in the CR (see the example below.).", "author": "scholzj", "createdAt": "2020-08-27T18:46:57Z", "path": "documentation/modules/con-kafka-connect-authentication.adoc", "diffHunk": "@@ -42,17 +45,16 @@ spec:\n   # ...\n ----\n \n-== SASL based SCRAM-SHA-512 authentication\n+To use this method, see xref:proc-configuring-kafka-connect-authentication-tls-{context}[].\n \n-To configure Kafka Connect to use SASL-based SCRAM-SHA-512 authentication, set the `type` property to `scram-sha-512`.\n-This authentication mechanism requires a username and password.\n+== SASL-based SCRAM-SHA-512 authentication\n \n-* Specify the username in the `username` property.\n-* In the `passwordSecret` property, specify a link to a `Secret` containing the password. The `secretName` property contains the name of the `Secret` and the `password` property contains the name of the key under which the password is stored inside the `Secret`.\n+To configure Kafka Connect to use SASL-based SCRAM-SHA-512 authentication, set the `authentication.type` property to `scram-sha-512`.\n+This authentication mechanism requires a client username and password, which are contained in a Secret.", "originalCommit": "dcd189f1d181238caed43daafea3a69de69503ae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYyNDg0OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3560#discussion_r478624849", "bodyText": "Should we maybe add also an example of secret YAML with the password to make a better connection what should be set there?", "author": "scholzj", "createdAt": "2020-08-27T18:47:54Z", "path": "documentation/modules/con-kafka-connect-authentication.adoc", "diffHunk": "@@ -63,27 +65,41 @@ spec:\n   # ...\n   authentication:\n     type: scram-sha-512\n-    username: my-connect-user\n+    username: my-connect-username <1>\n     passwordSecret:\n-      secretName: my-connect-user\n-      password: my-connect-password-key\n+      secretName: my-connect-secret-name <2>\n+      password: my-connect-password-field <3>\n   # ...\n ----\n \n-== SASL based PLAIN authentication\n+<1> `username`: The username.\n+<2> `secretName`: The name of the Secret that contains the username and password.\n+<3> `password`: The name of the field in the Secret under which the password is stored.", "originalCommit": "dcd189f1d181238caed43daafea3a69de69503ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTM3MTA1Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3560#discussion_r479371056", "bodyText": "I added the following example. Please can you check it.\nExample Secret YAML for SCRAM-SHA-512 client authentication for Kafka Connect\napiVersion: v1\nkind: Secret\nmetadata:\n  name: my-connect-secret-name\ntype: Opaque\ndata:\n  my-connect-password-field: LFTIyFRFlMmU2N2Tm", "author": "laidan6000", "createdAt": "2020-08-28T15:15:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYyNDg0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYyNTA5NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3560#discussion_r478625095", "bodyText": "Same as above. Adding a Secret YAML with the placeholder as the key might help.", "author": "scholzj", "createdAt": "2020-08-27T18:48:26Z", "path": "documentation/modules/proc-configuring-kafka-connect-authentication-scram-sha-512.adoc", "diffHunk": "@@ -36,15 +44,21 @@ spec:\n   # ...\n   authentication:\n     type: scram-sha-512\n-    username: _MY-USERNAME_\n+    username: _MY-CONNECT-USERNAME_\n     passwordSecret:\n-      secretName: _MY-SECRET_\n-      password: _MY-PASSWORD.txt_\n+      secretName: _MY-CONNECT-SECRET-NAME_\n+      password: _PASSWORD-FIELD-NAME_", "originalCommit": "dcd189f1d181238caed43daafea3a69de69503ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTM3MjMyNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3560#discussion_r479372325", "bodyText": "That might be confusing here because the user creates the Secret from a text file. Having example YAML might suggest that they need to create a Secret from YAML.", "author": "laidan6000", "createdAt": "2020-08-28T15:17:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYyNTA5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODg3NzExOQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3560#discussion_r478877119", "bodyText": "I'm not sure we need this section. I think we could just cross-ref to https://strimzi.io/docs/operators/master/using.html#type-KafkaClientAuthenticationTls-reference as we're moving descriptions of properties into the appendix.", "author": "PaulRMellor", "createdAt": "2020-08-28T07:17:24Z", "path": "documentation/modules/con-kafka-connect-authentication.adoc", "diffHunk": "@@ -5,26 +5,29 @@\n [id='con-kafka-connect-authentication{context}']\n = Authentication support in Kafka Connect\n \n-Authentication is configured through the `authentication` property in `KafkaConnect.spec` and `KafkaConnectS2I.spec`.\n-The `authentication` property specifies the type of the authentication mechanisms which should be used and additional configuration details depending on the mechanism.\n-The supported authentication types are:\n+You can configure authentication for Kafka Connect in the `authentication` property in `KafkaConnect.spec` and `KafkaConnectS2I.spec`. \n+The `authentication` property specifies which of the supported authentication mechanisms to use, and additional configuration depending on the mechanism.\n+\n+The following types of authentication are supported for Kafka Connect:\n \n * TLS client authentication\n * SASL-based authentication using the SCRAM-SHA-512 mechanism\n * SASL-based authentication using the PLAIN mechanism\n * xref:assembly-oauth-authentication_str[OAuth 2.0 token based authentication]\n \n-== TLS Client Authentication\n+The following sections explain how each authentication mechanism works. \n+\n+== TLS Client authentication", "originalCommit": "dcd189f1d181238caed43daafea3a69de69503ae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODg3ODU4Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3560#discussion_r478878586", "bodyText": "Same as TLS. We could just refer to https://strimzi.io/docs/operators/master/using.html#type-KafkaClientAuthenticationScramSha512-reference. If so, I think that section would need a bit more detail from here", "author": "PaulRMellor", "createdAt": "2020-08-28T07:20:41Z", "path": "documentation/modules/con-kafka-connect-authentication.adoc", "diffHunk": "@@ -42,17 +45,16 @@ spec:\n   # ...\n ----\n \n-== SASL based SCRAM-SHA-512 authentication\n+To use this method, see xref:proc-configuring-kafka-connect-authentication-tls-{context}[].\n \n-To configure Kafka Connect to use SASL-based SCRAM-SHA-512 authentication, set the `type` property to `scram-sha-512`.\n-This authentication mechanism requires a username and password.\n+== SASL-based SCRAM-SHA-512 authentication", "originalCommit": "dcd189f1d181238caed43daafea3a69de69503ae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODg3OTQ1OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3560#discussion_r478879458", "bodyText": "Same here. I think we can just link to the appendix description https://strimzi.io/docs/operators/master/using.html#type-KafkaClientAuthenticationPlain-reference. Modify with any changes from this update", "author": "PaulRMellor", "createdAt": "2020-08-28T07:22:39Z", "path": "documentation/modules/con-kafka-connect-authentication.adoc", "diffHunk": "@@ -63,27 +65,41 @@ spec:\n   # ...\n   authentication:\n     type: scram-sha-512\n-    username: my-connect-user\n+    username: my-connect-username <1>\n     passwordSecret:\n-      secretName: my-connect-user\n-      password: my-connect-password-key\n+      secretName: my-connect-secret-name <2>\n+      password: my-connect-password-field <3>\n   # ...\n ----\n \n-== SASL based PLAIN authentication\n+<1> `username`: The username.\n+<2> `secretName`: The name of the Secret that contains the username and password.\n+<3> `password`: The name of the field in the Secret under which the password is stored.\n+\n+[WARNING]\n+====\n+Do NOT specify the actual password in the `passwordSecret.password` property.\n+====\n+\n+To use this method, see xref:proc-configuring-kafka-connect-authentication-scram-sha-512-{context}[].\n+\n+== SASL-based PLAIN authentication", "originalCommit": "dcd189f1d181238caed43daafea3a69de69503ae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b53e66a35ad3a0d2f9bd6f28fc13f0cb1e3674ec", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b53e66a35ad3a0d2f9bd6f28fc13f0cb1e3674ec", "message": "add secrets yaml to concept JS\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-08-28T15:14:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQyNjk4MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3560#discussion_r483426980", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To use TLS client authentication, set the `authentication.type` property to `tls`.\n          \n          \n            \n            To use TLS client authentication, set the `spec.authentication.type` property to `tls`.", "author": "tombentley", "createdAt": "2020-09-04T07:01:56Z", "path": "documentation/modules/con-kafka-connect-authentication.adoc", "diffHunk": "@@ -5,26 +5,29 @@\n [id='con-kafka-connect-authentication{context}']\n = Authentication support in Kafka Connect\n \n-Authentication is configured through the `authentication` property in `KafkaConnect.spec` and `KafkaConnectS2I.spec`.\n-The `authentication` property specifies the type of the authentication mechanisms which should be used and additional configuration details depending on the mechanism.\n-The supported authentication types are:\n+You can configure authentication for Kafka Connect in the `authentication` property in `KafkaConnect.spec` and `KafkaConnectS2I.spec`. \n+The `authentication` property specifies which of the supported authentication mechanisms to use, and additional configuration depending on the mechanism.\n+\n+The following types of authentication are supported for Kafka Connect:\n \n * TLS client authentication\n * SASL-based authentication using the SCRAM-SHA-512 mechanism\n * SASL-based authentication using the PLAIN mechanism\n * xref:assembly-oauth-authentication_str[OAuth 2.0 token based authentication]\n \n-== TLS Client Authentication\n+The following sections explain how each authentication mechanism works. \n+\n+== TLS Client authentication\n \n-To use TLS client authentication, set the `type` property to the value `tls`.\n+To use TLS client authentication, set the `authentication.type` property to `tls`.", "originalCommit": "b53e66a35ad3a0d2f9bd6f28fc13f0cb1e3674ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQzMDEwOQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3560#discussion_r483430109", "bodyText": "Use of \"keys\" here is ambiguous. And TBH I'm not sure I follow what this even means. A certificate is a data structure which includes a public key and some other information. A certificate does not include a private key. So the sentence doesn't make sense because it says the certificate needs to be stored under a private \"key\" (aka field or property), but there's nothing private about the cert.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            In the Secret, the certificate must be stored in X509 format under two different keys: public and private.\n          \n          \n            \n            In the Secret, the certificate must be stored in X509 format under the field named by the `certificate` and the private key must be stored under the field named by the `key` property, as shown below.", "author": "tombentley", "createdAt": "2020-09-04T07:09:19Z", "path": "documentation/modules/con-kafka-connect-authentication.adoc", "diffHunk": "@@ -5,26 +5,29 @@\n [id='con-kafka-connect-authentication{context}']\n = Authentication support in Kafka Connect\n \n-Authentication is configured through the `authentication` property in `KafkaConnect.spec` and `KafkaConnectS2I.spec`.\n-The `authentication` property specifies the type of the authentication mechanisms which should be used and additional configuration details depending on the mechanism.\n-The supported authentication types are:\n+You can configure authentication for Kafka Connect in the `authentication` property in `KafkaConnect.spec` and `KafkaConnectS2I.spec`. \n+The `authentication` property specifies which of the supported authentication mechanisms to use, and additional configuration depending on the mechanism.\n+\n+The following types of authentication are supported for Kafka Connect:\n \n * TLS client authentication\n * SASL-based authentication using the SCRAM-SHA-512 mechanism\n * SASL-based authentication using the PLAIN mechanism\n * xref:assembly-oauth-authentication_str[OAuth 2.0 token based authentication]\n \n-== TLS Client Authentication\n+The following sections explain how each authentication mechanism works. \n+\n+== TLS Client authentication\n \n-To use TLS client authentication, set the `type` property to the value `tls`.\n+To use TLS client authentication, set the `authentication.type` property to `tls`.\n TLS client authentication uses a TLS certificate to authenticate.\n-The certificate is specified in the `certificateAndKey` property and is always loaded from a Kubernetes secret.\n-In the secret, the certificate must be stored in X509 format under two different keys: public and private.\n+The certificate is specified in the `certificateAndKey` property and is always loaded from a Kubernetes Secret.\n+In the Secret, the certificate must be stored in X509 format under two different keys: public and private.", "originalCommit": "b53e66a35ad3a0d2f9bd6f28fc13f0cb1e3674ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQzMDM3MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3560#discussion_r483430371", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To configure Kafka Connect to use SASL-based SCRAM-SHA-512 authentication, set the `authentication.type` property to `scram-sha-512`.\n          \n          \n            \n            To configure Kafka Connect to use SASL-based SCRAM-SHA-512 authentication, set the `spec.authentication.type` property to `scram-sha-512`.", "author": "tombentley", "createdAt": "2020-09-04T07:09:53Z", "path": "documentation/modules/con-kafka-connect-authentication.adoc", "diffHunk": "@@ -42,17 +45,16 @@ spec:\n   # ...\n ----\n \n-== SASL based SCRAM-SHA-512 authentication\n+To use this method, see xref:proc-configuring-kafka-connect-authentication-tls-{context}[].\n \n-To configure Kafka Connect to use SASL-based SCRAM-SHA-512 authentication, set the `type` property to `scram-sha-512`.\n-This authentication mechanism requires a username and password.\n+== SASL-based SCRAM-SHA-512 authentication\n \n-* Specify the username in the `username` property.\n-* In the `passwordSecret` property, specify a link to a `Secret` containing the password. The `secretName` property contains the name of the `Secret` and the `password` property contains the name of the key under which the password is stored inside the `Secret`.\n+To configure Kafka Connect to use SASL-based SCRAM-SHA-512 authentication, set the `authentication.type` property to `scram-sha-512`.", "originalCommit": "b53e66a35ad3a0d2f9bd6f28fc13f0cb1e3674ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQzMTYwMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3560#discussion_r483431601", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This authentication mechanism requires a client username and password. The password is contained in a Secret.\n          \n          \n            \n            This authentication mechanism requires a client username and password. \n          \n          \n            \n            The password is contained in a Secret. The name of the Secret is given as the value of the `secretName` property and the field within the Secret is given by the `password` property.", "author": "tombentley", "createdAt": "2020-09-04T07:12:53Z", "path": "documentation/modules/con-kafka-connect-authentication.adoc", "diffHunk": "@@ -42,17 +45,16 @@ spec:\n   # ...\n ----\n \n-== SASL based SCRAM-SHA-512 authentication\n+To use this method, see xref:proc-configuring-kafka-connect-authentication-tls-{context}[].\n \n-To configure Kafka Connect to use SASL-based SCRAM-SHA-512 authentication, set the `type` property to `scram-sha-512`.\n-This authentication mechanism requires a username and password.\n+== SASL-based SCRAM-SHA-512 authentication\n \n-* Specify the username in the `username` property.\n-* In the `passwordSecret` property, specify a link to a `Secret` containing the password. The `secretName` property contains the name of the `Secret` and the `password` property contains the name of the key under which the password is stored inside the `Secret`.\n+To configure Kafka Connect to use SASL-based SCRAM-SHA-512 authentication, set the `authentication.type` property to `scram-sha-512`.\n+This authentication mechanism requires a client username and password. The password is contained in a Secret.", "originalCommit": "b53e66a35ad3a0d2f9bd6f28fc13f0cb1e3674ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "12106addec96842432947f5b26b43bdabb7f18f8", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/12106addec96842432947f5b26b43bdabb7f18f8", "message": "review comments Tom B\n\nSigned-off-by: Daniel Laing <dlaing@redhat.com>", "committedDate": "2020-09-04T14:14:23Z", "type": "commit"}]}