{"pr_number": 2613, "pr_title": "[systemtest] Add configuration of network policies", "pr_createdAt": "2020-02-27T19:56:23Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613", "timeline": [{"oid": "09c626370eea61f6175061d63a0b5b37d6a74758", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/09c626370eea61f6175061d63a0b5b37d6a74758", "message": "change creation of connect and connects2i in tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-02-27T20:04:38Z", "type": "forcePushed"}, {"oid": "a17fb8ad51131b4c402e225a56a30fbb83e25809", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/a17fb8ad51131b4c402e225a56a30fbb83e25809", "message": "fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-02-28T11:44:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5OTI0OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r385699249", "bodyText": "Namespace should be generic here. I think it can occurred in all namespaces which we use.", "author": "Frawless", "createdAt": "2020-02-28T13:38:48Z", "path": "systemtest/src/main/java/io/strimzi/systemtest/matchers/LogHasNoUnexpectedErrors.java", "diffHunk": "@@ -73,7 +73,8 @@ public void describeTo(Description description) {\n         OPERATION_TIMEOUT(\"Util:[0-9]+ - Exceeded timeout of.*while waiting for.*\"),\n         // This is whitelisted cause it's no real problem when this error appears, components are being created even after timeout\n         RECONCILIATION_TIMEOUT(\"ERROR Abstract.*Operator:[0-9]+ - Reconciliation.*\"),\n-        ASSEMBLY_OPERATOR_RECONCILIATION_TIMEOUT(\"ERROR .*AssemblyOperator:[0-9]+ - Reconciliation.*[fF]ailed.*\");\n+        ASSEMBLY_OPERATOR_RECONCILIATION_TIMEOUT(\"ERROR .*AssemblyOperator:[0-9]+ - Reconciliation.*[fF]ailed.*\"),\n+        WATCHER_CLOSED_EXCEPTION(\"ERROR AbstractOperator:* - Watcher closed with exception in namespace connect-cluster-test\");", "originalCommit": "a17fb8ad51131b4c402e225a56a30fbb83e25809", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcwNjYzOQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r385706639", "bodyText": "Yeah my bad, sorry", "author": "im-konge", "createdAt": "2020-02-28T13:53:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5OTI0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcwMDE2OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r385700169", "bodyText": "This should be in KubernetesResources.java", "author": "Frawless", "createdAt": "2020-02-28T13:40:42Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/BaseST.java", "diffHunk": "@@ -643,6 +647,64 @@ void verifyLabelsForRoleBindings(String clusterName, String appName) {\n         );\n     }\n \n+    protected NetworkPolicy applyNetworkPolicySettings(String clientNamespace, List<String> namespaces) {\n+        NetworkPolicy networkPolicy = null;\n+\n+        for (String namespace : namespaces) {\n+            if (Environment.ALLOW_NETWORK_POLICIES.equals(\"true\")) {\n+                networkPolicy = allowNetworkPolicies(namespace);\n+            } else {\n+                networkPolicy = denyNetworkPolicies(namespace);\n+            }\n+        }\n+\n+        LOGGER.info(\"NetworkPolicy successfully set to: {} for namespace: {}\", Environment.ALLOW_NETWORK_POLICIES, clientNamespace);\n+\n+        return networkPolicy;\n+    }\n+\n+    protected NetworkPolicy allowNetworkPolicies(String namespace) {", "originalCommit": "a17fb8ad51131b4c402e225a56a30fbb83e25809", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcwMDIyNw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r385700227", "bodyText": "same as above", "author": "Frawless", "createdAt": "2020-02-28T13:40:49Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/BaseST.java", "diffHunk": "@@ -643,6 +647,64 @@ void verifyLabelsForRoleBindings(String clusterName, String appName) {\n         );\n     }\n \n+    protected NetworkPolicy applyNetworkPolicySettings(String clientNamespace, List<String> namespaces) {\n+        NetworkPolicy networkPolicy = null;\n+\n+        for (String namespace : namespaces) {\n+            if (Environment.ALLOW_NETWORK_POLICIES.equals(\"true\")) {\n+                networkPolicy = allowNetworkPolicies(namespace);\n+            } else {\n+                networkPolicy = denyNetworkPolicies(namespace);\n+            }\n+        }\n+\n+        LOGGER.info(\"NetworkPolicy successfully set to: {} for namespace: {}\", Environment.ALLOW_NETWORK_POLICIES, clientNamespace);\n+\n+        return networkPolicy;\n+    }\n+\n+    protected NetworkPolicy allowNetworkPolicies(String namespace) {\n+        NetworkPolicy networkPolicy = new NetworkPolicyBuilder()\n+                .withNewApiVersion(\"networking.k8s.io/v1\")\n+                .withNewKind(\"NetworkPolicy\")\n+                .withNewMetadata()\n+                    .withName(\"global-network-policy\")\n+                .endMetadata()\n+                .withNewSpec()\n+                    .withNewPodSelector()\n+                    .endPodSelector()\n+                    .addNewIngress()\n+                    .endIngress()\n+                    .withPolicyTypes(\"Ingress\")\n+                .endSpec()\n+                .build();\n+\n+        kubeClient().getClient().network().networkPolicies().inNamespace(namespace).createOrReplace(networkPolicy);\n+        LOGGER.info(\"Network policy successfully set to allow-all\");\n+\n+        return networkPolicy;\n+    }\n+\n+    protected NetworkPolicy denyNetworkPolicies(String namespace) {", "originalCommit": "a17fb8ad51131b4c402e225a56a30fbb83e25809", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcwMDYzNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r385700634", "bodyText": "also it would be nice to assure automatic deletion with deleteLater()", "author": "Frawless", "createdAt": "2020-02-28T13:41:43Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/BaseST.java", "diffHunk": "@@ -643,6 +647,64 @@ void verifyLabelsForRoleBindings(String clusterName, String appName) {\n         );\n     }\n \n+    protected NetworkPolicy applyNetworkPolicySettings(String clientNamespace, List<String> namespaces) {\n+        NetworkPolicy networkPolicy = null;\n+\n+        for (String namespace : namespaces) {\n+            if (Environment.ALLOW_NETWORK_POLICIES.equals(\"true\")) {\n+                networkPolicy = allowNetworkPolicies(namespace);\n+            } else {\n+                networkPolicy = denyNetworkPolicies(namespace);\n+            }\n+        }\n+\n+        LOGGER.info(\"NetworkPolicy successfully set to: {} for namespace: {}\", Environment.ALLOW_NETWORK_POLICIES, clientNamespace);\n+\n+        return networkPolicy;\n+    }\n+\n+    protected NetworkPolicy allowNetworkPolicies(String namespace) {\n+        NetworkPolicy networkPolicy = new NetworkPolicyBuilder()\n+                .withNewApiVersion(\"networking.k8s.io/v1\")\n+                .withNewKind(\"NetworkPolicy\")\n+                .withNewMetadata()\n+                    .withName(\"global-network-policy\")\n+                .endMetadata()\n+                .withNewSpec()\n+                    .withNewPodSelector()\n+                    .endPodSelector()\n+                    .addNewIngress()\n+                    .endIngress()\n+                    .withPolicyTypes(\"Ingress\")\n+                .endSpec()\n+                .build();\n+\n+        kubeClient().getClient().network().networkPolicies().inNamespace(namespace).createOrReplace(networkPolicy);", "originalCommit": "a17fb8ad51131b4c402e225a56a30fbb83e25809", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcwMDY5Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r385700692", "bodyText": "same as above", "author": "Frawless", "createdAt": "2020-02-28T13:41:50Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/BaseST.java", "diffHunk": "@@ -643,6 +647,64 @@ void verifyLabelsForRoleBindings(String clusterName, String appName) {\n         );\n     }\n \n+    protected NetworkPolicy applyNetworkPolicySettings(String clientNamespace, List<String> namespaces) {\n+        NetworkPolicy networkPolicy = null;\n+\n+        for (String namespace : namespaces) {\n+            if (Environment.ALLOW_NETWORK_POLICIES.equals(\"true\")) {\n+                networkPolicy = allowNetworkPolicies(namespace);\n+            } else {\n+                networkPolicy = denyNetworkPolicies(namespace);\n+            }\n+        }\n+\n+        LOGGER.info(\"NetworkPolicy successfully set to: {} for namespace: {}\", Environment.ALLOW_NETWORK_POLICIES, clientNamespace);\n+\n+        return networkPolicy;\n+    }\n+\n+    protected NetworkPolicy allowNetworkPolicies(String namespace) {\n+        NetworkPolicy networkPolicy = new NetworkPolicyBuilder()\n+                .withNewApiVersion(\"networking.k8s.io/v1\")\n+                .withNewKind(\"NetworkPolicy\")\n+                .withNewMetadata()\n+                    .withName(\"global-network-policy\")\n+                .endMetadata()\n+                .withNewSpec()\n+                    .withNewPodSelector()\n+                    .endPodSelector()\n+                    .addNewIngress()\n+                    .endIngress()\n+                    .withPolicyTypes(\"Ingress\")\n+                .endSpec()\n+                .build();\n+\n+        kubeClient().getClient().network().networkPolicies().inNamespace(namespace).createOrReplace(networkPolicy);\n+        LOGGER.info(\"Network policy successfully set to allow-all\");\n+\n+        return networkPolicy;\n+    }\n+\n+    protected NetworkPolicy denyNetworkPolicies(String namespace) {\n+        NetworkPolicy networkPolicy = new NetworkPolicyBuilder()\n+                .withNewApiVersion(\"networking.k8s.io/v1\")\n+                .withNewKind(\"NetworkPolicy\")\n+                .withNewMetadata()\n+                    .withName(\"global-network-policy\")\n+                .endMetadata()\n+                .withNewSpec()\n+                    .withNewPodSelector()\n+                    .endPodSelector()\n+                    .withPolicyTypes(\"Ingress\")\n+                .endSpec()\n+                .build();\n+\n+        kubeClient().getClient().network().networkPolicies().inNamespace(namespace).createOrReplace(networkPolicy);", "originalCommit": "a17fb8ad51131b4c402e225a56a30fbb83e25809", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ee8ec7583c8e7d2b1f0a0b195596979820c88fc2", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/ee8ec7583c8e7d2b1f0a0b195596979820c88fc2", "message": "fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-02-28T13:59:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc4NjMxMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r385786311", "bodyText": "You don't need the generics, just declare the parameter as HasMetadata resource. It would also be good to add javadoc. It wasn't immediately clear to me that the resource is something like KafkaConnector. And name probably isn't the best name for the 2nd parameter (the name of what?)\nFinally I think the method name would be clearer with 'allow' it in, since this policy is allowing access", "author": "tombentley", "createdAt": "2020-02-28T16:15:47Z", "path": "systemtest/src/main/java/io/strimzi/systemtest/resources/KubernetesResource.java", "diffHunk": "@@ -307,6 +312,84 @@ public static Service deployBridgeNodePortService(String bridgeExternalService,\n             .endSpec().build();\n     }\n \n+    public static <T extends HasMetadata> NetworkPolicy applyNetworkPolicySettingsForResource(T resource, String name) {", "originalCommit": "ee8ec7583c8e7d2b1f0a0b195596979820c88fc2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5Mjg2MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r385792861", "bodyText": "This is configuring the default policy, so I would put 'default' in the method name somewhere. Also, since it's so similar to the deny case I wonder if it would be better as a single method:\npublic static NetworkPolicy applyDefaultNetworkPolicy(String namespace, DefaultPolicy policy)\n\nwith enum DefaultPolicy { ALLOW, DENY }\nThat would make the call site really clear:\napplyDefaultNetworkPolicy(namespace, DefaultPolicy.ALLOW)", "author": "tombentley", "createdAt": "2020-02-28T16:27:37Z", "path": "systemtest/src/main/java/io/strimzi/systemtest/resources/KubernetesResource.java", "diffHunk": "@@ -307,6 +312,84 @@ public static Service deployBridgeNodePortService(String bridgeExternalService,\n             .endSpec().build();\n     }\n \n+    public static <T extends HasMetadata> NetworkPolicy applyNetworkPolicySettingsForResource(T resource, String name) {\n+        NetworkPolicy networkPolicy = new NetworkPolicyBuilder()\n+                .withNewApiVersion(\"networking.k8s.io/v1\")\n+                .withNewKind(\"NetworkPolicy\")\n+                .withNewMetadata()\n+                    .withName(resource.getMetadata().getName() + \"-allow\")\n+                .endMetadata()\n+                .withNewSpec()\n+                    .addNewIngress()\n+                        .addNewPort()\n+                            .withNewPort(8083)\n+                            .withNewProtocol(\"TCP\")\n+                        .endPort()\n+                        .addNewPort()\n+                            .withNewPort(9404)\n+                            .withNewProtocol(\"TCP\")\n+                        .endPort()\n+                        .addNewPort()\n+                            .withNewPort(8080)\n+                            .withNewProtocol(\"TCP\")\n+                        .endPort()\n+                      .endIngress()\n+                    .withNewPodSelector()\n+                        .addToMatchLabels(\"strimzi.io/cluster\", resource.getMetadata().getName())\n+                        .addToMatchLabels(\"strimzi.io/kind\", resource.getKind())\n+                        .addToMatchLabels(\"strimzi.io/name\", name)\n+                    .endPodSelector()\n+                    .withPolicyTypes(\"Ingress\")\n+                .endSpec()\n+                .build();\n+\n+        deleteLater(kubeClient().getClient().network().networkPolicies().inNamespace(ResourceManager.kubeClient().getNamespace()).createOrReplace(networkPolicy));\n+        return networkPolicy;\n+    }\n+\n+    public static NetworkPolicy allowNetworkPolicies(String namespace) {", "originalCommit": "ee8ec7583c8e7d2b1f0a0b195596979820c88fc2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5MzU0Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r385793543", "bodyText": "One blank line is enough.", "author": "tombentley", "createdAt": "2020-02-28T16:28:40Z", "path": "systemtest/src/main/java/io/strimzi/systemtest/resources/KubernetesResource.java", "diffHunk": "@@ -307,6 +312,84 @@ public static Service deployBridgeNodePortService(String bridgeExternalService,\n             .endSpec().build();\n     }\n \n+    public static <T extends HasMetadata> NetworkPolicy applyNetworkPolicySettingsForResource(T resource, String name) {\n+        NetworkPolicy networkPolicy = new NetworkPolicyBuilder()\n+                .withNewApiVersion(\"networking.k8s.io/v1\")\n+                .withNewKind(\"NetworkPolicy\")\n+                .withNewMetadata()\n+                    .withName(resource.getMetadata().getName() + \"-allow\")\n+                .endMetadata()\n+                .withNewSpec()\n+                    .addNewIngress()\n+                        .addNewPort()\n+                            .withNewPort(8083)\n+                            .withNewProtocol(\"TCP\")\n+                        .endPort()\n+                        .addNewPort()\n+                            .withNewPort(9404)\n+                            .withNewProtocol(\"TCP\")\n+                        .endPort()\n+                        .addNewPort()\n+                            .withNewPort(8080)\n+                            .withNewProtocol(\"TCP\")\n+                        .endPort()\n+                      .endIngress()\n+                    .withNewPodSelector()\n+                        .addToMatchLabels(\"strimzi.io/cluster\", resource.getMetadata().getName())\n+                        .addToMatchLabels(\"strimzi.io/kind\", resource.getKind())\n+                        .addToMatchLabels(\"strimzi.io/name\", name)\n+                    .endPodSelector()\n+                    .withPolicyTypes(\"Ingress\")\n+                .endSpec()\n+                .build();\n+\n+        deleteLater(kubeClient().getClient().network().networkPolicies().inNamespace(ResourceManager.kubeClient().getNamespace()).createOrReplace(networkPolicy));\n+        return networkPolicy;\n+    }\n+\n+    public static NetworkPolicy allowNetworkPolicies(String namespace) {\n+        NetworkPolicy networkPolicy = new NetworkPolicyBuilder()\n+                .withNewApiVersion(\"networking.k8s.io/v1\")\n+                .withNewKind(\"NetworkPolicy\")\n+                .withNewMetadata()\n+                    .withName(\"global-network-policy\")\n+                .endMetadata()\n+                .withNewSpec()\n+                    .withNewPodSelector()\n+                    .endPodSelector()\n+                    .addNewIngress()\n+                    .endIngress()\n+                    .withPolicyTypes(\"Ingress\")\n+                .endSpec()\n+                .build();\n+\n+        deleteLater(kubeClient().getClient().network().networkPolicies().inNamespace(namespace).createOrReplace(networkPolicy));\n+        LOGGER.info(\"Network policy successfully set to allow-all\");\n+\n+        return networkPolicy;\n+    }\n+\n+    public static NetworkPolicy denyNetworkPolicies(String namespace) {\n+        NetworkPolicy networkPolicy = new NetworkPolicyBuilder()\n+                .withNewApiVersion(\"networking.k8s.io/v1\")\n+                .withNewKind(\"NetworkPolicy\")\n+                .withNewMetadata()\n+                    .withName(\"global-network-policy\")\n+                .endMetadata()\n+                .withNewSpec()\n+                    .withNewPodSelector()\n+                    .endPodSelector()\n+                    .withPolicyTypes(\"Ingress\")\n+                .endSpec()\n+                .build();\n+\n+", "originalCommit": "ee8ec7583c8e7d2b1f0a0b195596979820c88fc2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5ODU5OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r385798598", "bodyText": "So as i can see basically you change all our Kafka CR methods is a way that every time when we deploy for instance KafkaConnect, it must be with the additional parameter allowNetworkPolicyAccess. Would it be better to overload  method and encapsulate default value of allowNetworkPolicyAccess?\nCurrently -> You have only these master methods with lot of parameters.\n\n`public static DoneableKafkaConnect kafkaConnect(String name, int kafkaConnectReplicas, boolean allowNetworkPolicyAccess)`\n\nGoal -> Master method with auxiliary methods like \n\n1) public static DoneableKafkaConnect kafkaConnect(String name, int kafkaConnectReplicas, boolean allowNetworkPolicyAccess)\n2) public static DoneableKafkaConnect kafkaConnect(String name, int kafkaConnectReplicas)\n\nwhere is second example you will need to decide has default value for the third argument of method in a 1).\nDoes it make sense?", "author": "see-quick", "createdAt": "2020-02-28T16:38:00Z", "path": "systemtest/src/main/java/io/strimzi/systemtest/resources/crd/KafkaConnectResource.java", "diffHunk": "@@ -35,22 +36,22 @@\n         return Crds.kafkaConnectOperation(ResourceManager.kubeClient().getClient());\n     }\n \n-    public static DoneableKafkaConnect kafkaConnect(String name, int kafkaConnectReplicas) {\n-        return kafkaConnect(name, name, kafkaConnectReplicas);\n+    public static DoneableKafkaConnect kafkaConnect(String name, int kafkaConnectReplicas, boolean allowNetworkPolicyAccess) {\n+        return kafkaConnect(name, name, kafkaConnectReplicas, allowNetworkPolicyAccess);\n     }\n \n-    public static DoneableKafkaConnect kafkaConnect(String name, String clusterName, int kafkaConnectReplicas) {\n+    public static DoneableKafkaConnect kafkaConnect(String name, String clusterName, int kafkaConnectReplicas, boolean allowNetworkPolicyAccess) {\n         KafkaConnect kafkaConnect = getKafkaConnectFromYaml(PATH_TO_KAFKA_CONNECT_CONFIG);\n-        return deployKafkaConnect(defaultKafkaConnect(kafkaConnect, name, clusterName, kafkaConnectReplicas).build());\n+        return deployKafkaConnect(defaultKafkaConnect(kafkaConnect, name, clusterName, kafkaConnectReplicas).build(), allowNetworkPolicyAccess);\n     }\n \n-    public static DoneableKafkaConnect kafkaConnectWithMetrics(String name, int kafkaConnectReplicas) {\n-        return kafkaConnectWithMetrics(name, name, kafkaConnectReplicas);\n+    public static DoneableKafkaConnect kafkaConnectWithMetrics(String name, int kafkaConnectReplicas, boolean allowNetworkPolicyAccess) {\n+        return kafkaConnectWithMetrics(name, name, kafkaConnectReplicas, allowNetworkPolicyAccess);\n     }\n \n-    public static DoneableKafkaConnect kafkaConnectWithMetrics(String name, String clusterName, int kafkaConnectReplicas) {\n+    public static DoneableKafkaConnect kafkaConnectWithMetrics(String name, String clusterName, int kafkaConnectReplicas, boolean allowNetworkPolicyAccess) {\n         KafkaConnect kafkaConnect = getKafkaConnectFromYaml(PATH_TO_KAFKA_CONNECT_METRICS_CONFIG);", "originalCommit": "ee8ec7583c8e7d2b1f0a0b195596979820c88fc2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgwMTcwMw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r385801703", "bodyText": "This one i would move to KubeClusterResource class what do you think @Frawless ?", "author": "see-quick", "createdAt": "2020-02-28T16:43:25Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/BaseST.java", "diffHunk": "@@ -643,6 +646,22 @@ void verifyLabelsForRoleBindings(String clusterName, String appName) {\n         );\n     }\n \n+    protected NetworkPolicy applyNetworkPolicySettings(String clientNamespace, List<String> namespaces) {\n+        NetworkPolicy networkPolicy = null;\n+\n+        for (String namespace : namespaces) {\n+            if (Environment.ALLOW_NETWORK_POLICIES.equals(\"true\")) {\n+                networkPolicy = KubernetesResource.allowNetworkPolicies(namespace);\n+            } else {\n+                networkPolicy = KubernetesResource.denyNetworkPolicies(namespace);\n+            }\n+        }\n+\n+        LOGGER.info(\"NetworkPolicy successfully set to: {} for namespace: {}\", Environment.ALLOW_NETWORK_POLICIES, clientNamespace);\n+\n+        return networkPolicy;\n+    }\n+", "originalCommit": "ee8ec7583c8e7d2b1f0a0b195596979820c88fc2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkxMjc0OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r385912748", "bodyText": "Yes, I already suggested it I think (or at least I wanted:D )", "author": "Frawless", "createdAt": "2020-02-28T20:42:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgwMTcwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5MDMwNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r385790304", "bodyText": "I think this is too wide. This will open the network even for the CO and therefore the tests will not really test that the CO is able to deal with this on its own. I think you need to make this more specific to allow only connections for the tests.", "author": "scholzj", "createdAt": "2020-02-28T16:22:58Z", "path": "systemtest/src/main/java/io/strimzi/systemtest/resources/KubernetesResource.java", "diffHunk": "@@ -307,6 +312,84 @@ public static Service deployBridgeNodePortService(String bridgeExternalService,\n             .endSpec().build();\n     }\n \n+    public static <T extends HasMetadata> NetworkPolicy applyNetworkPolicySettingsForResource(T resource, String name) {", "originalCommit": "ee8ec7583c8e7d2b1f0a0b195596979820c88fc2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkxMTQyMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r385911421", "bodyText": "AFAIU CO deal with NP by it's own in case that Kafka Connector is used. In that case we don't apply any NP changes and we communicate with Connect only via operator. I am not sure about mm2 and bridge atm. Is that what you mean we should do?", "author": "Frawless", "createdAt": "2020-02-28T20:38:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5MDMwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk3MjM3Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r385972372", "bodyText": "But that is not right, or? That means that this test will test the known issues, but never found any new issues in other areas. AFAIK we have this problem repeatedly and we found about these issues only form user issues. So we need to make sure this test not only covers the known cases but has a chance to find new cases as well.", "author": "scholzj", "createdAt": "2020-02-28T23:48:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5MDMwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5ODQyMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r385798420", "bodyText": "If I read the code right, this does not allow or disable the network policies. Thsi is rather a swicth between default-to-allow and default-to-deny network policies. So I think we should change the name to make it more clear.", "author": "scholzj", "createdAt": "2020-02-28T16:37:41Z", "path": "systemtest/src/main/java/io/strimzi/systemtest/Environment.java", "diffHunk": "@@ -93,6 +98,7 @@\n     // Image pull policy variables\n     public static final String COMPONENTS_IMAGE_PULL_POLICY = System.getenv().getOrDefault(COMPONENTS_IMAGE_PULL_POLICY_ENV, COMPONENTS_IMAGE_PULL_POLICY_ENV_DEFAULT);\n     public static final String OPERATOR_IMAGE_PULL_POLICY = System.getenv().getOrDefault(OPERATOR_IMAGE_PULL_POLICY_ENV, OPERATOR_IMAGE_PULL_POLICY_ENV_DEFAULT);\n+    public static final String ALLOW_NETWORK_POLICIES = System.getenv().getOrDefault(ALLOW_NETWORK_POLICIES_ENV, ALLOW_NETWORK_POLICIES_DEFAULT);", "originalCommit": "ee8ec7583c8e7d2b1f0a0b195596979820c88fc2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgwMjI0Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r385802246", "bodyText": "Again, the naming here might be confusing since it doesn't deny or allow network policies. It basically just defines their default behaviour if they are already enabled. If they are disabled, this will do nothing.", "author": "scholzj", "createdAt": "2020-02-28T16:44:21Z", "path": "systemtest/src/main/java/io/strimzi/systemtest/resources/KubernetesResource.java", "diffHunk": "@@ -307,6 +312,84 @@ public static Service deployBridgeNodePortService(String bridgeExternalService,\n             .endSpec().build();\n     }\n \n+    public static <T extends HasMetadata> NetworkPolicy applyNetworkPolicySettingsForResource(T resource, String name) {\n+        NetworkPolicy networkPolicy = new NetworkPolicyBuilder()\n+                .withNewApiVersion(\"networking.k8s.io/v1\")\n+                .withNewKind(\"NetworkPolicy\")\n+                .withNewMetadata()\n+                    .withName(resource.getMetadata().getName() + \"-allow\")\n+                .endMetadata()\n+                .withNewSpec()\n+                    .addNewIngress()\n+                        .addNewPort()\n+                            .withNewPort(8083)\n+                            .withNewProtocol(\"TCP\")\n+                        .endPort()\n+                        .addNewPort()\n+                            .withNewPort(9404)\n+                            .withNewProtocol(\"TCP\")\n+                        .endPort()\n+                        .addNewPort()\n+                            .withNewPort(8080)\n+                            .withNewProtocol(\"TCP\")\n+                        .endPort()\n+                      .endIngress()\n+                    .withNewPodSelector()\n+                        .addToMatchLabels(\"strimzi.io/cluster\", resource.getMetadata().getName())\n+                        .addToMatchLabels(\"strimzi.io/kind\", resource.getKind())\n+                        .addToMatchLabels(\"strimzi.io/name\", name)\n+                    .endPodSelector()\n+                    .withPolicyTypes(\"Ingress\")\n+                .endSpec()\n+                .build();\n+\n+        deleteLater(kubeClient().getClient().network().networkPolicies().inNamespace(ResourceManager.kubeClient().getNamespace()).createOrReplace(networkPolicy));\n+        return networkPolicy;\n+    }\n+\n+    public static NetworkPolicy allowNetworkPolicies(String namespace) {", "originalCommit": "ee8ec7583c8e7d2b1f0a0b195596979820c88fc2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgwMjM0Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r385802342", "bodyText": "Again, the naming here might be confusing since it doesn't deny or allow network policies. It basically just defines their default behaviour if they are already enabled. If they are disabled, this will do nothing.", "author": "scholzj", "createdAt": "2020-02-28T16:44:31Z", "path": "systemtest/src/main/java/io/strimzi/systemtest/resources/KubernetesResource.java", "diffHunk": "@@ -307,6 +312,84 @@ public static Service deployBridgeNodePortService(String bridgeExternalService,\n             .endSpec().build();\n     }\n \n+    public static <T extends HasMetadata> NetworkPolicy applyNetworkPolicySettingsForResource(T resource, String name) {\n+        NetworkPolicy networkPolicy = new NetworkPolicyBuilder()\n+                .withNewApiVersion(\"networking.k8s.io/v1\")\n+                .withNewKind(\"NetworkPolicy\")\n+                .withNewMetadata()\n+                    .withName(resource.getMetadata().getName() + \"-allow\")\n+                .endMetadata()\n+                .withNewSpec()\n+                    .addNewIngress()\n+                        .addNewPort()\n+                            .withNewPort(8083)\n+                            .withNewProtocol(\"TCP\")\n+                        .endPort()\n+                        .addNewPort()\n+                            .withNewPort(9404)\n+                            .withNewProtocol(\"TCP\")\n+                        .endPort()\n+                        .addNewPort()\n+                            .withNewPort(8080)\n+                            .withNewProtocol(\"TCP\")\n+                        .endPort()\n+                      .endIngress()\n+                    .withNewPodSelector()\n+                        .addToMatchLabels(\"strimzi.io/cluster\", resource.getMetadata().getName())\n+                        .addToMatchLabels(\"strimzi.io/kind\", resource.getKind())\n+                        .addToMatchLabels(\"strimzi.io/name\", name)\n+                    .endPodSelector()\n+                    .withPolicyTypes(\"Ingress\")\n+                .endSpec()\n+                .build();\n+\n+        deleteLater(kubeClient().getClient().network().networkPolicies().inNamespace(ResourceManager.kubeClient().getNamespace()).createOrReplace(networkPolicy));\n+        return networkPolicy;\n+    }\n+\n+    public static NetworkPolicy allowNetworkPolicies(String namespace) {\n+        NetworkPolicy networkPolicy = new NetworkPolicyBuilder()\n+                .withNewApiVersion(\"networking.k8s.io/v1\")\n+                .withNewKind(\"NetworkPolicy\")\n+                .withNewMetadata()\n+                    .withName(\"global-network-policy\")\n+                .endMetadata()\n+                .withNewSpec()\n+                    .withNewPodSelector()\n+                    .endPodSelector()\n+                    .addNewIngress()\n+                    .endIngress()\n+                    .withPolicyTypes(\"Ingress\")\n+                .endSpec()\n+                .build();\n+\n+        deleteLater(kubeClient().getClient().network().networkPolicies().inNamespace(namespace).createOrReplace(networkPolicy));\n+        LOGGER.info(\"Network policy successfully set to allow-all\");\n+\n+        return networkPolicy;\n+    }\n+\n+    public static NetworkPolicy denyNetworkPolicies(String namespace) {", "originalCommit": "ee8ec7583c8e7d2b1f0a0b195596979820c88fc2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgwMzI4Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r385803283", "bodyText": "In all this deployments of Kafka connect will be really great to have encapsulation of this third parameter for the default value...", "author": "see-quick", "createdAt": "2020-02-28T16:46:07Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/ConnectST.java", "diffHunk": "@@ -478,7 +478,7 @@ void testSecretsWithKafkaConnectWithTlsAndScramShaAuthentication() throws Except\n \n         SecretUtils.waitForSecretReady(userName);\n \n-        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1)\n+        KafkaConnectResource.kafkaConnect(CLUSTER_NAME, 1, false)", "originalCommit": "ee8ec7583c8e7d2b1f0a0b195596979820c88fc2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "280194934f958f841d61c4babd3b9c5796196848", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/280194934f958f841d61c4babd3b9c5796196848", "message": "fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-02T11:25:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg5NDc3OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r386894779", "bodyText": "DefaultPolicy -> DefaultNetworkPolicy", "author": "Frawless", "createdAt": "2020-03-03T09:31:43Z", "path": "systemtest/src/main/java/io/strimzi/systemtest/Enums.java", "diffHunk": "@@ -0,0 +1,12 @@\n+/*\n+ * Copyright Strimzi authors.\n+ * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n+ */\n+package io.strimzi.systemtest;\n+\n+public class Enums {\n+    public enum DefaultPolicy {", "originalCommit": "ed1c4ca57a8849f35002f8768226137146afe611", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg5NTMyMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r386895320", "bodyText": "ALLOW_NETWORK_POLICIES_DEFAULT -> ALLOW_DEFAULT_NETWORK_POLICIES_DEFAULT", "author": "Frawless", "createdAt": "2020-03-03T09:32:40Z", "path": "systemtest/src/main/java/io/strimzi/systemtest/Environment.java", "diffHunk": "@@ -75,6 +79,7 @@\n     public static final String COMPONENTS_IMAGE_PULL_POLICY_ENV_DEFAULT = Constants.IF_NOT_PRESENT_IMAGE_PULL_POLICY;\n     public static final String OPERATOR_IMAGE_PULL_POLICY_ENV_DEFAULT = Constants.ALWAYS_IMAGE_PULL_POLICY;\n     public static final int KAFKA_CLIENTS_DEFAULT_PORT = 4242;\n+    private static final String ALLOW_NETWORK_POLICIES_DEFAULT = \"false\";", "originalCommit": "ed1c4ca57a8849f35002f8768226137146afe611", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5095b26b581839572b9fc502d2b093b20afa7660", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5095b26b581839572b9fc502d2b093b20afa7660", "message": "add new env variable to documentation\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-03T11:48:48Z", "type": "forcePushed"}, {"oid": "affb3d44ac6d8d096ded6accec1b348cc4c82633", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/affb3d44ac6d8d096ded6accec1b348cc4c82633", "message": "add client pod for executing commands\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-03T14:20:06Z", "type": "forcePushed"}, {"oid": "e6d633aa9e6933bbbda82128408116dcd5b3d212", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e6d633aa9e6933bbbda82128408116dcd5b3d212", "message": "fix failed tests and change execution pods\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-04T08:57:32Z", "type": "forcePushed"}, {"oid": "20a2adddae8d0cdd4b55b5e20e3741d06afeab4d", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/20a2adddae8d0cdd4b55b5e20e3741d06afeab4d", "message": "change method for setting network policies\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T07:17:30Z", "type": "forcePushed"}, {"oid": "d901c7c13e39dccbc23ca8adf305cb6e80a5af89", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d901c7c13e39dccbc23ca8adf305cb6e80a5af89", "message": "fixup! change method for setting network policies\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T12:00:13Z", "type": "forcePushed"}, {"oid": "637ab1a8f3b243c2bab8cd955b4ae558efcaf782", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/637ab1a8f3b243c2bab8cd955b4ae558efcaf782", "message": "fixup! change method for setting network policies\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T14:08:13Z", "type": "forcePushed"}, {"oid": "912b57d514a461884555f87ef544658077b8c011", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/912b57d514a461884555f87ef544658077b8c011", "message": "Add env variable for allowing network policies for namespace\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T17:58:55Z", "type": "commit"}, {"oid": "534f744f4e56675ae9f8cdd77de647e67abe7734", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/534f744f4e56675ae9f8cdd77de647e67abe7734", "message": "add network policy to allow or deny all\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T17:58:55Z", "type": "commit"}, {"oid": "253f586c49b57e83c4f24a8eae174a8a320dfd1e", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/253f586c49b57e83c4f24a8eae174a8a320dfd1e", "message": "change methods for creating connect and connects2i\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T17:58:55Z", "type": "commit"}, {"oid": "f8d3bfb8413055e07ff061f63a8359db251a6c9e", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f8d3bfb8413055e07ff061f63a8359db251a6c9e", "message": "change creation of connect and connects2i in tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T18:00:32Z", "type": "commit"}, {"oid": "120c8c75d5a3e0f95aaeee9b33dd26e22c196217", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/120c8c75d5a3e0f95aaeee9b33dd26e22c196217", "message": "Separate methods for allowing or denying network policies\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T18:00:39Z", "type": "commit"}, {"oid": "c404085d36a228cb147b29b195f0161612f73060", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c404085d36a228cb147b29b195f0161612f73060", "message": "Add whitelist error message\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T18:00:39Z", "type": "commit"}, {"oid": "9bade58f02e134e64db9241785dfea91ad0cf283", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/9bade58f02e134e64db9241785dfea91ad0cf283", "message": "change setup of oauth\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T18:00:39Z", "type": "commit"}, {"oid": "2243ee086546512f5abbbf5392af6a89439e0ff5", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2243ee086546512f5abbbf5392af6a89439e0ff5", "message": "fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T18:00:39Z", "type": "commit"}, {"oid": "1d5078c0460f8c41cf610d79a69703020ca75f81", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1d5078c0460f8c41cf610d79a69703020ca75f81", "message": "fixup! fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T18:00:39Z", "type": "commit"}, {"oid": "aa0d8c312c11eaaa8443a6b8d2ab307ba250db47", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/aa0d8c312c11eaaa8443a6b8d2ab307ba250db47", "message": "fixup! fixup! fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T18:00:39Z", "type": "commit"}, {"oid": "2c470e2295d15d32666516cfd85c46037dd34b6c", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2c470e2295d15d32666516cfd85c46037dd34b6c", "message": "fixup! fixup! fixup! fix failed tests\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T18:00:39Z", "type": "commit"}, {"oid": "b2eceeb9f7e8999eceb1f1f2f9b9e0f072af48cb", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b2eceeb9f7e8999eceb1f1f2f9b9e0f072af48cb", "message": "add new env variable to documentation\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T18:00:39Z", "type": "commit"}, {"oid": "e3c95b816f59b1f1f6ab1d45aae378ae8b931045", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e3c95b816f59b1f1f6ab1d45aae378ae8b931045", "message": "add client pod for executing commands\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T18:00:39Z", "type": "commit"}, {"oid": "3dd28e880e31b70c2985b38f9091750045781917", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3dd28e880e31b70c2985b38f9091750045781917", "message": "fix failed tests and change execution pods\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T18:00:39Z", "type": "commit"}, {"oid": "daa19cf7f562a78fb8c3531891c78efbbf3f7b90", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/daa19cf7f562a78fb8c3531891c78efbbf3f7b90", "message": "change method for setting network policies\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T18:00:39Z", "type": "commit"}, {"oid": "eee25f43c58c6ce9c8c4c44c5d34dfb26e558459", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/eee25f43c58c6ce9c8c4c44c5d34dfb26e558459", "message": "fixup! change method for setting network policies\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T18:00:39Z", "type": "forcePushed"}, {"oid": "74b1358910b0d89d7b72de3c344300c71051757c", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/74b1358910b0d89d7b72de3c344300c71051757c", "message": "fixup! change method for setting network policies\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T18:12:53Z", "type": "commit"}, {"oid": "74b1358910b0d89d7b72de3c344300c71051757c", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/74b1358910b0d89d7b72de3c344300c71051757c", "message": "fixup! change method for setting network policies\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T18:12:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ3MjY0Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r388472643", "bodyText": "Is it ALLOW_NETWORK_POLICIES or ALLOW_DEFAULT_NETWORK_POLICIES? In Environment.java it ays:\nprivate static final String ALLOW_DEFAULT_NETWORK_POLICIES_ENV = \"ALLOW_NETWORK_POLICIES\";\nOne way or another, I wonder if more clear name would be helpfull. the docs laos doens't make it clear what the setting is ... is true -> default-to-allow?", "author": "scholzj", "createdAt": "2020-03-05T18:14:43Z", "path": "TESTING.md", "diffHunk": "@@ -208,6 +208,7 @@ All environment variables can be seen in [Environment](systemtest/src/main/java/\n | OLM_OPERATOR_NAME         | Operator name in manifests CSV                                                       | strimzi                                             |\n | OLM_APP_BUNDLE_PREFIX     | CSV bundle name                                                                      | strimzi                                             |\n | OLM_OPERATOR_VERSION      | Version of the operator which will be installed                                      | v0.16.2                                             |\n+| ALLOW_DEFAULT_NETWORK_POLICIES | Determines how will be network policies set - to allow-all or deny-all          | false                                            |", "originalCommit": "74b1358910b0d89d7b72de3c344300c71051757c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODUzNjUzNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2613#discussion_r388536534", "bodyText": "@scholzj thanks, good point, everything changed :) thank you for your comments", "author": "im-konge", "createdAt": "2020-03-05T20:11:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ3MjY0Mw=="}], "type": "inlineReview"}, {"oid": "b2969feceea463fd960e6c6db782ec5b6730feec", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b2969feceea463fd960e6c6db782ec5b6730feec", "message": "Fix bad naming (again)\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T20:27:05Z", "type": "forcePushed"}, {"oid": "d84a66877fe4f06f7a977463e1efbdb4282a2284", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d84a66877fe4f06f7a977463e1efbdb4282a2284", "message": "Fix bad naming (again)\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T20:46:25Z", "type": "commit"}, {"oid": "d84a66877fe4f06f7a977463e1efbdb4282a2284", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d84a66877fe4f06f7a977463e1efbdb4282a2284", "message": "Fix bad naming (again)\n\nSigned-off-by: Lukas Kral <lkral@redhat.com>", "committedDate": "2020-03-05T20:46:25Z", "type": "forcePushed"}]}