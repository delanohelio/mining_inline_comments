{"pr_number": 4162, "pr_title": "Make it possible to run Strimzi with read-only root filesystem", "pr_createdAt": "2020-12-29T23:57:29Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4162", "timeline": [{"oid": "2a65b4e3af1f864279357a137625314542b4621d", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2a65b4e3af1f864279357a137625314542b4621d", "message": "Make it possible to run Strimzi with read-only root filesystem - Closes #4011\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>", "committedDate": "2020-12-29T23:49:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTE3ODE5OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4162#discussion_r551178198", "bodyText": "out of curiosity, why this remove?", "author": "ppatierno", "createdAt": "2021-01-04T08:39:23Z", "path": "docker-images/kafka/cruise-control-scripts/cruise_control_tls_prepare_certificates.sh", "diffHunk": "@@ -24,13 +24,16 @@ function create_keystore {\n \n echo \"Preparing certificates for internal communication\"\n STORE=/tmp/cruise-control/replication.truststore.p12\n+rm -f \"$STORE\"", "originalCommit": "2a65b4e3af1f864279357a137625314542b4621d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIwMzIzMw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4162#discussion_r551203233", "bodyText": "When the container restarts (not when the Pod is deleted but just when the container restarts), the volume stays. But because the password is generated at the startup scripts it will not match anymore and the process will fail. I think that was to some extent issue even before this PR. Making sure the store does not exist avoids these issues, since you can always use the new password from scratch.", "author": "scholzj", "createdAt": "2021-01-04T09:33:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTE3ODE5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIwNjIwNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4162#discussion_r551206205", "bodyText": "Makes sense. Yeah my question was mostly related to this PR as you said because the problem could have been even before.", "author": "ppatierno", "createdAt": "2021-01-04T09:38:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTE3ODE5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIxMDM4Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4162#discussion_r551210386", "bodyText": "TBH, I know I saw the problem before on occasions. But it is not clear how it could have happened. With this PR the issue is clear -> the volume where these are now created is bound to the pod lifecycle so they should keep the files normally. But before this PR it IMHO we were creating them in the container context so I'm not sure why they sometimes seemed to survive. \ud83e\udd37\u200d\u2642\ufe0f", "author": "scholzj", "createdAt": "2021-01-04T09:46:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTE3ODE5OA=="}], "type": "inlineReview"}]}