{"pr_number": 3447, "pr_title": "[Doc] New chapter for Using Guide: Managing secure access to Kafka", "pr_createdAt": "2020-08-04T11:11:00Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447", "timeline": [{"oid": "3be5fbfeb2baf3865f3708b2de9cfe9d8302e278", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3be5fbfeb2baf3865f3708b2de9cfe9d8302e278", "message": "deleted files\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-08-04T10:46:38Z", "type": "commit"}, {"oid": "908a8ff1cee7b1b5ffd244ade79b95659d699058", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/908a8ff1cee7b1b5ffd244ade79b95659d699058", "message": "java file updates for descriptions\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-08-04T10:47:49Z", "type": "commit"}, {"oid": "d6626f25505766aed42984c6dbc09b3691ca1217", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d6626f25505766aed42984c6dbc09b3691ca1217", "message": "schema appendix updates\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-08-04T10:49:11Z", "type": "commit"}, {"oid": "b42d1a0cb7e3ee6a8d905fe94461b134d70ec6e8", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b42d1a0cb7e3ee6a8d905fe94461b134d70ec6e8", "message": "new securing kafka chapter\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-08-04T10:50:20Z", "type": "commit"}, {"oid": "e981c5bbc9be7f5a30d466027803b547aaf69f6f", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e981c5bbc9be7f5a30d466027803b547aaf69f6f", "message": "schema appendix updates\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-08-04T11:04:58Z", "type": "commit"}, {"oid": "3d164d393f07104bea74a7ff219e2e7a0f36ae07", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3d164d393f07104bea74a7ff219e2e7a0f36ae07", "message": "schema appendix updates\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-08-04T11:09:48Z", "type": "commit"}, {"oid": "f4e10c91d20772f8f0af7784fe2cff282eb082c9", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f4e10c91d20772f8f0af7784fe2cff282eb082c9", "message": "remove unrelated changes from request\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-08-04T16:27:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAxOTM1Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r466019352", "bodyText": "Can we make it more clear that this is an mandatory option?", "author": "scholzj", "createdAt": "2020-08-05T21:38:53Z", "path": "documentation/api/io.strimzi.api.kafka.model.listener.IngressListenerConfiguration.adoc", "diffHunk": "@@ -0,0 +1,71 @@\n+Use `IngressListenerConfiguration` properties to add configuration to external ingress listeners.\n+\n+[id='property-ingress-listener-host-{context}']\n+.`host`", "originalCommit": "f4e10c91d20772f8f0af7784fe2cff282eb082c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAyMDIwNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r466020206", "bodyText": "The configuration section should be mentioned here as well. It is covered in the IngressListenerConfiguration file. But we should mention here that the configuration and the host fields inside are required. Right now, this is not clear the after reading just this here, user might think this is all what is needed and not click into the configuration details.", "author": "scholzj", "createdAt": "2020-08-05T21:40:41Z", "path": "documentation/api/io.strimzi.api.kafka.model.listener.KafkaListenerExternalIngress.adoc", "diffHunk": "@@ -0,0 +1,36 @@\n+Use `KafkaListenerExternalIngress` properties to configure an external listener to expose expose Kafka using Kubernetes `Ingress` and the {NginxIngressController}.", "originalCommit": "f4e10c91d20772f8f0af7784fe2cff282eb082c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQ4ODMzOQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468488339", "bodyText": "I've added a section/link to the IngressListenerConfiguration schema reference:\n\n.configuration\nYou must specify the hostnames used by the bootstrap and per-broker services using the xref:type-IngressListenerConfiguration-reference[IngressListenerConfiguration properties].", "author": "PaulRMellor", "createdAt": "2020-08-11T10:43:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAyMDIwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAyMDYwNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r466020604", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            listeners:\n          \n          \n            \n              external:\n          \n          \n            \n                type: ingress\n          \n          \n            \n                authentication:\n          \n          \n            \n                  type: tls\n          \n          \n            \n            listeners:\n          \n          \n            \n              external:\n          \n          \n            \n                type: ingress\n          \n          \n            \n                authentication:\n          \n          \n            \n                  type: tls\n          \n          \n            \n                configuration:\n          \n          \n            \n                  bootstrap:\n          \n          \n            \n                    host: bootstrap.myingress.com\n          \n          \n            \n                  brokers:\n          \n          \n            \n                  - broker: 0\n          \n          \n            \n                    host: broker-0.myingress.com\n          \n          \n            \n                  - broker: 1\n          \n          \n            \n                    host: broker-1.myingress.com\n          \n          \n            \n                  - broker: 2\n          \n          \n            \n                    host: broker-2.myingress.com\n          \n      \n    \n    \n  \n\nSince it is mandatory, we should have the configuration section in this example.", "author": "scholzj", "createdAt": "2020-08-05T21:41:39Z", "path": "documentation/api/io.strimzi.api.kafka.model.listener.KafkaListenerExternalIngress.adoc", "diffHunk": "@@ -0,0 +1,36 @@\n+Use `KafkaListenerExternalIngress` properties to configure an external listener to expose expose Kafka using Kubernetes `Ingress` and the {NginxIngressController}.\n+A dedicated `Ingress` resource is created for every Kafka broker pod.\n+An additional `Ingress` resource is created to serve as a Kafka bootstrap address.\n+Kafka clients can use these `Ingress` resources to connect to Kafka on port 443.\n+\n+.Example of an external listener of type `ingress`\n+[source,yaml,subs=\"attributes+\"]\n+----\n+# ...\n+listeners:\n+  external:\n+    type: ingress\n+    authentication:\n+      type: tls", "originalCommit": "f4e10c91d20772f8f0af7784fe2cff282eb082c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAyMTA1NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r466021054", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            You must enable access to the ports on the Kubernetes nodes for each client (for example, in firewalls or security groups).\n          \n          \n            \n            You must enable access to the ports on the Kubernetes nodes for each node port (for example, in firewalls or security groups).", "author": "scholzj", "createdAt": "2020-08-05T21:42:38Z", "path": "documentation/api/io.strimzi.api.kafka.model.listener.KafkaListenerExternalNodePort.adoc", "diffHunk": "@@ -0,0 +1,38 @@\n+Use `KafkaListenerExternalNodePort` properties to configure an external listener to expose expose Kafka using `NodePort` type `Services`.\n+Kafka clients connect directly to the nodes of Kubernetes.\n+\n+An additional `NodePort` type of service is created to serve as a Kafka bootstrap address.\n+\n+.Example of an external listener of type `nodeport`\n+[source,yaml,subs=\"attributes+\"]\n+----\n+# ...\n+listeners:\n+  external:\n+    type: nodeport\n+    authentication:\n+      type: tls\n+# ...\n+----\n+\n+When configuring the advertised addresses for the Kafka broker pods, Strimzi uses the address of the node on which the given pod is running.\n+Nodes often have multiple addresses.\n+\n+The address type used is based on the first type found in the following order of priority:\n+\n+. ExternalDNS\n+. ExternalIP\n+. Hostname\n+. InternalDNS\n+. InternalIP\n+\n+You must enable access to the ports on the Kubernetes nodes for each client (for example, in firewalls or security groups).", "originalCommit": "f4e10c91d20772f8f0af7784fe2cff282eb082c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAyMTQyMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r466021422", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To disable it, set the `tls` property to `false`.\n          \n          \n            \n            To disable it, set the `tls` property to `false`.\n          \n          \n            \n            \n          \n          \n            \n            .Example of an external listener of type `nodeport` and disabled TLS encryption\n          \n          \n            \n            [source,yaml,subs=\"attributes+\"]\n          \n          \n            \n            ----\n          \n          \n            \n            # ...\n          \n          \n            \n            listeners:\n          \n          \n            \n              external:\n          \n          \n            \n                type: nodeport\n          \n          \n            \n                tls: false\n          \n          \n            \n            # ...\n          \n          \n            \n            ----", "author": "scholzj", "createdAt": "2020-08-05T21:43:33Z", "path": "documentation/api/io.strimzi.api.kafka.model.listener.KafkaListenerExternalNodePort.adoc", "diffHunk": "@@ -0,0 +1,38 @@\n+Use `KafkaListenerExternalNodePort` properties to configure an external listener to expose expose Kafka using `NodePort` type `Services`.\n+Kafka clients connect directly to the nodes of Kubernetes.\n+\n+An additional `NodePort` type of service is created to serve as a Kafka bootstrap address.\n+\n+.Example of an external listener of type `nodeport`\n+[source,yaml,subs=\"attributes+\"]\n+----\n+# ...\n+listeners:\n+  external:\n+    type: nodeport\n+    authentication:\n+      type: tls\n+# ...\n+----\n+\n+When configuring the advertised addresses for the Kafka broker pods, Strimzi uses the address of the node on which the given pod is running.\n+Nodes often have multiple addresses.\n+\n+The address type used is based on the first type found in the following order of priority:\n+\n+. ExternalDNS\n+. ExternalIP\n+. Hostname\n+. InternalDNS\n+. InternalIP\n+\n+You must enable access to the ports on the Kubernetes nodes for each client (for example, in firewalls or security groups).\n+Each Kafka broker pod is then accessible on a separate port.\n+\n+[id='property-nodeport-listener-tls-{context}']\n+.`tls`\n+\n+By default, TLS encryption is enabled.\n+To disable it, set the `tls` property to `false`.", "originalCommit": "f4e10c91d20772f8f0af7784fe2cff282eb082c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAyMzEwMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r466023101", "bodyText": "This seems a bit out of place. Why do we mention here only the OAuth 2.0 and not other authentication types?", "author": "scholzj", "createdAt": "2020-08-05T21:47:16Z", "path": "documentation/assemblies/assembly-configuring-kafka-listeners.adoc", "diffHunk": "@@ -16,20 +16,16 @@ The following types of listeners are supported:\n * TLS listener on port 9093 (with TLS encryption)\n * External listener on port 9094 for access from outside of Kubernetes\n \n+For more information on listener configuration, see xref:type-KafkaListeners-reference[`KafkaListeners` schema reference].\n+\n+.Configuring listeners to secure access to Kafka brokers\n+You can configure listeners for secure connection using authentication.\n+For more information on securing access to Kafka brokers, see xref:assembly-securing-kafka-str[Managing access to Kafka].\n+\n .OAuth 2.0\n If you are using OAuth 2.0 token-based authentication, you can configure the listeners to connect to your authorization server.\n For more information, see xref:assembly-oauth-authentication_str[Using OAuth 2.0 token-based authentication].", "originalCommit": "f4e10c91d20772f8f0af7784fe2cff282eb082c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQ5NzAxMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468497010", "bodyText": "Yes. We don't need it. I've removed.", "author": "PaulRMellor", "createdAt": "2020-08-11T11:00:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAyMzEwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAyNjA5NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r466026095", "bodyText": "Similarly to one of my previous comments. I'm not sure why OAuth 2 needs to be listed here ... it might confuse user into thinking it is more than just one of the options.", "author": "scholzj", "createdAt": "2020-08-05T21:54:20Z", "path": "documentation/assemblies/assembly-securing-access.adoc", "diffHunk": "@@ -0,0 +1,37 @@\n+// This assembly is included in the following assemblies:\n+//\n+// using/master.adoc\n+\n+[id='assembly-securing-access-{context}']\n+= Managing secure access to Kafka\n+\n+You can secure Kafka by managing the access each client has to the Kafka brokers.\n+\n+A secure connection between Kafka brokers and clients can encompass:\n+\n+* Encryption for data exchange\n+* Authentication to prove identity\n+* Authorization to allow or decline actions executed by users\n+\n+This chapter explains how to set up secure connections, with sections describing:\n+\n+* Security options for Kafka clusters and clients\n+* How to secure Kafka brokers\n+* How to configure external listeners\n+* OAuth 2.0 token-based authentication and authorization", "originalCommit": "f4e10c91d20772f8f0af7784fe2cff282eb082c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODUzMTg0NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468531845", "bodyText": "It's listed here as we have oauth sub-sections in their own right. Maybe we can change to:\n\nSecurity options for Kafka clusters and clients\nHow to secure Kafka brokers\nHow to configure external listeners\nHow to use an authorization server for OAuth 2.0 token-based authentication and authorization\n\nI can remove if it still seems confusing", "author": "PaulRMellor", "createdAt": "2020-08-11T12:09:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAyNjA5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAyODM4NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r466028385", "bodyText": "So is this about configuring external listeners? Or securing them? The content looks more like configuring, so maybe we should name that way?", "author": "scholzj", "createdAt": "2020-08-05T21:59:35Z", "path": "documentation/assemblies/assembly-securing-external-listeners.adoc", "diffHunk": "@@ -0,0 +1,24 @@\n+// This assembly is included in the following assemblies:\n+//\n+// assembly-securing-access.adoc\n+\n+[id='assembly-securing-external-listeners-{context}']\n+= Configuring external listeners", "originalCommit": "f4e10c91d20772f8f0af7784fe2cff282eb082c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODUzNDQ5Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468534493", "bodyText": "Changed the id", "author": "PaulRMellor", "createdAt": "2020-08-11T12:14:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAyODM4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzNDMyOQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r466034329", "bodyText": "Can we make it clear that the KafkaUser configures the authentication and authorization which the specific user will be allowed to use versus the enabled mechanisms in the Kafka CR? Otherwise I think this will be confusing.\nMaybe we could also mention quotas? It is also slightly related to security.", "author": "scholzj", "createdAt": "2020-08-05T22:15:06Z", "path": "documentation/assemblies/assembly-securing-kafka.adoc", "diffHunk": "@@ -0,0 +1,46 @@\n+// This assembly is included in the following assemblies:\n+//\n+// // assembly-securing-access.adoc\n+\n+[id='assembly-securing-kafka-{context}']\n+= Securing access to Kafka brokers\n+\n+To establish secure access to Kafka brokers, you configure and apply:\n+\n+* A `Kafka` resource to create listeners with a specified authentication type\n+* A `KafkaUser` resource to access the Kafka brokers securely through the listeners\n+\n+Configure the `Kafka` resource to set up:\n+\n+* Listener authentication\n+* Network policies that restrict access to Kafka listeners\n+* Kafka authorization\n+* Super users for unconstrained access to brokers\n+\n+Authentication is configured independently for each listener.\n+Authorization is always configured for the whole Kafka cluster.\n+\n+The Cluster Operator creates the listeners and sets up the cluster and client certificate authority (CA) certificates to enable authentication within the Kafka cluster.\n+\n+You can replace the certificates generated by the Cluster Operator by link:{BookURLUsing}#installing-your-own-ca-certificates-str[installing your own certificates^].\n+You can also link:{BookURLUsing}#kafka-listener-certificates-str[configure your listener to use a Kafka listener certificate managed by an external Certificate Authority^].\n+Certificates are available in PKCS #12 format (.p12) and PEM (.crt) formats.\n+\n+Configure the `KafkaUser` resource to set up:\n+\n+* Client authentication to match the listener authentication\n+* Client authorization to match the Kafka authorization", "originalCommit": "f4e10c91d20772f8f0af7784fe2cff282eb082c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODU2NzQ3Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468567473", "bodyText": "Changed to:\n\nUse KafkaUser to enable the authentication and authorization mechanisms that a specific client uses to access Kafka.\nConfigure a KafkaUser resource to set up:\n\nAuthentication to match the enabled listener authentication\nAuthorization to match the enabled Kafka authorization\nQuotas to control the use of resources by clients", "author": "PaulRMellor", "createdAt": "2020-08-11T13:11:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzNDMyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzNDg1NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r466034854", "bodyText": "Can we make it clear this this is authentication and authorization mechanisms enabled for this particular user?", "author": "scholzj", "createdAt": "2020-08-05T22:16:34Z", "path": "documentation/assemblies/assembly-using-the-user-operator.adoc", "diffHunk": "@@ -13,6 +13,10 @@ The _Deploying Strimzi_ guide provides instructions to deploy the User Operator:\n * link:{BookURLDeploying}#deploying-the-user-operator-using-the-cluster-operator-{context}[Using the Cluster Operator (recommended)^]\n * link:{BookURLDeploying}#deploying-the-user-operator-standalone-{context}[Standalone to operate with Kafka clusters not managed by Strimzi^]\n \n-include::../modules/ref-operator-user.adoc[leveloffset=+1]\n-include::../modules/proc-configuring-kafka-user.adoc[leveloffset=+1]\n+For more information about the schema, see xref:type-KafkaUser-reference[`KafkaUser` schema reference].\n+\n+.Authenticating and authorizing access to Kafka\n+You configure `KafkaUser` properties to set up authentication and authorization mechanisms to manage client access to Kafka.", "originalCommit": "f4e10c91d20772f8f0af7784fe2cff282eb082c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODU3OTYxMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468579612", "bodyText": "Use KafkaUser to enable the authentication and authorization mechanisms that a specific client uses to access Kafka.", "author": "PaulRMellor", "createdAt": "2020-08-11T13:29:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzNDg1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzNTMyMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r466035321", "bodyText": "I think this should link to some chapter about configuring authorization in Kafka CR.\nOpen Policy Agent can be used with OAuth 2 authentication as well. So we should mention it here as well.", "author": "scholzj", "createdAt": "2020-08-05T22:17:55Z", "path": "documentation/assemblies/oauth/assembly-oauth-authentication.adoc", "diffHunk": "@@ -10,7 +10,7 @@ Strimzi supports the use of OAuth 2.0 authentication using the _SASL OAUTHBEARER\n OAuth 2.0 enables standardized token-based authentication and authorization between applications, using a central authorization server to issue tokens that grant limited access to resources.\n \n You can configure OAuth 2.0 authentication, then xref:assembly-oauth-authorization_{context}[OAuth 2.0 authorization].\n-OAuth 2.0 authentication can also be used in conjunction with xref:simple-acl-{context}[ACL-based Kafka authorization].\n+OAuth 2.0 authentication can also be used in conjunction with xref:type-AclRule-reference[ACL-based Kafka authorization].", "originalCommit": "f4e10c91d20772f8f0af7784fe2cff282eb082c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODU4OTAwNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468589004", "bodyText": "OAuth 2.0 authentication can also be used in conjunction with ACL or OPA-based xref:on-securing-kafka-authorization-str[Kafka authorization].", "author": "PaulRMellor", "createdAt": "2020-08-11T13:43:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzNTMyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzNzE2MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r466037161", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If the label does not match the Kafka cluster, the User Operator cannot identify the `kafkaUser` and the user is not created.\n          \n          \n            \n            If the label does not match the Kafka cluster, the User Operator cannot identify the `KafkaUser` and the user is not created.", "author": "scholzj", "createdAt": "2020-08-05T22:22:54Z", "path": "documentation/modules/con-securing-client-labels.adoc", "diffHunk": "@@ -0,0 +1,22 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-clients.adoc\n+\n+[id='con-securing-client-labels-{context}']\n+= Identifying a Kafka cluster for user handling\n+\n+A `KafkaUser` resource includes a label that defines the appropriate name of the Kafka cluster (derived from the name of the `Kafka` resource) to which it belongs.\n+\n+[source,yaml,subs=\"attributes+\"]\n+----\n+apiVersion: {KafkaApiVersion}\n+kind: KafkaUser\n+metadata:\n+  name: my-user\n+  labels:\n+    strimzi.io/cluster: my-cluster\n+----\n+\n+The label is used by the User Operator to identify the `KafkaUser` resource and create a new user, and also in subsequent handling of the user.\n+\n+If the label does not match the Kafka cluster, the User Operator cannot identify the `kafkaUser` and the user is not created.", "originalCommit": "f4e10c91d20772f8f0af7784fe2cff282eb082c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzOTM0Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r466039346", "bodyText": "It is a bit weird that we have here the docs for the simple authorization but link elsewhere for OAuth and OPA. Can we move the simple authorization to the @DescriptionFile as well or something?", "author": "scholzj", "createdAt": "2020-08-05T22:29:01Z", "path": "documentation/modules/con-securing-kafka-authorization.adoc", "diffHunk": "@@ -1,25 +1,28 @@\n // Module included in the following assemblies:\n //\n-// assembly-kafka-authentication-and-authorization.adoc\n+// assembly-securing-access.adoc\n \n-[id='ref-kafka-authorization-{context}']\n-= Authorization\n+[id='con-securing-kafka-authorization-{context}']\n+= Kafka authorization\n \n You can configure authorization for Kafka brokers using the `authorization` property in the `Kafka.spec.kafka` resource.\n If the `authorization` property is missing, no authorization is enabled.\n-When enabled, authorization is applied to all enabled xref:assembly-configuring-kafka-broker-listeners-{context}[listeners].\n+When enabled, authorization is applied to all enabled listeners.\n The authorization method is defined in the `type` field.\n \n-You can configure:\n+Supported authorization options:\n \n * Simple authorization\n * xref:assembly-oauth-authorization_str[OAuth 2.0 authorization] (if you are using OAuth 2.0 token based authentication)\n-* xref:type-KafkaAuthorizationOpa-reference[Open Policy Agent authorization]\n+* xref:type-KafkaAuthorizationOpa-reference[Open Policy Agent (OPA) authorization]\n+\n+.Kafka cluster authorization options\n+image::kafka-authorization-config-options.png[options for kafks authorization configuration]\n \n == Simple authorization", "originalCommit": "f4e10c91d20772f8f0af7784fe2cff282eb082c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODY0NDA2Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468644062", "bodyText": "simple user config now moved to api/io.strimzi.api.kafka.model.KafkaAuthorizationSimple.adoc", "author": "PaulRMellor", "createdAt": "2020-08-11T14:53:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzOTM0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzOTc2MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r466039761", "bodyText": "Should we make it clear that this is supported with all 3 authorization mechanisms?", "author": "scholzj", "createdAt": "2020-08-05T22:30:07Z", "path": "documentation/modules/con-securing-kafka-authorization.adoc", "diffHunk": "@@ -30,12 +33,13 @@ authorization:\n # ...\n ----\n \n-Access rules for users are xref:simple-acl-str[defined using Access Control Lists (ACLs)].\n-You can optionally designate a list of super users in the `superUsers` field.\n+Access rules for users are xref:type-AclRule-reference[defined using Access Control Lists (ACLs)].\n \n [id='ref-kafka-authorization-super-user-{context}']\n == Super users", "originalCommit": "f4e10c91d20772f8f0af7784fe2cff282eb082c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODY3NDM2NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468674364", "bodyText": "Yes. I've updated.", "author": "PaulRMellor", "createdAt": "2020-08-11T15:35:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzOTc2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODY3NDc2OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468674769", "bodyText": "I've also updated the links from the appendix from simple and opa schema refs", "author": "PaulRMellor", "createdAt": "2020-08-11T15:35:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzOTc2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA0MTc0NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r466041744", "bodyText": "I guess this should mention also SCRAM-SHA-512 authentication as alternative.", "author": "scholzj", "createdAt": "2020-08-05T22:35:44Z", "path": "documentation/modules/proc-securing-kafka.adoc", "diffHunk": "@@ -0,0 +1,91 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka.adoc\n+\n+[id='proc-securing-kafka-{context}']\n+= Securing Kafka brokers\n+\n+This procedure shows the steps involved in securing Kafka brokers when running Strimzi.\n+\n+The security implemented for Kafka brokers must be compatible with the security implemented for the clients requiring access.\n+\n+* `Kafka.spec.kafka.listeners.*.authentication` matches `KafkaUser.spec.authentication matches`\n+* `Kafka.spec.kafka.authorization` matches `KafkaUser.spec.authorization matches`\n+\n+The steps show the configuration for simple authorization and a listener using TLS authentication.\n+For more information about listener configuration, see the xref:type-KafkaListeners-reference[`KafkaListeners` schema reference].\n+\n+Alternatively, you can use OAuth 2.0 for token-based xref:assembly-oauth-authentication_str[authentication] and xref:assembly-oauth-authorization_str[authorization],", "originalCommit": "f4e10c91d20772f8f0af7784fe2cff282eb082c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODY4MjcxNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468682714", "bodyText": "Yes. I've updated to make the links go back to concepts instead of separate procedures.\n\nAlternatively, you can use SCRAM-SHA or OAuth 2.0 for xref:con-securing-kafka-authentication-{context}[listener authentication], and OAuth 2.0 or OPA for xref:con-securing-kafka-authorization-{context}[Kafka authorization].", "author": "PaulRMellor", "createdAt": "2020-08-11T15:46:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA0MTc0NA=="}], "type": "inlineReview"}, {"oid": "5a581c333649026bf288060f45a4c6c1735cd9a7", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5a581c333649026bf288060f45a4c6c1735cd9a7", "message": "review edits JS\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-08-11T15:49:15Z", "type": "commit"}, {"oid": "26c9cb1ef9461517101fe3ef27b02bd990929db7", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/26c9cb1ef9461517101fe3ef27b02bd990929db7", "message": "appendix build\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-08-11T15:54:02Z", "type": "commit"}, {"oid": "cec43fbfb16aee8706871b1879fedc2c40059689", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/cec43fbfb16aee8706871b1879fedc2c40059689", "message": "Update Helm Charts\n\nSigned-off-by: Jakub Scholz <www@scholzj.com>", "committedDate": "2020-08-11T19:58:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzMTAwMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468831001", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            You can create `plain` (without encryption) or `tls` listener types.\n          \n          \n            \n            For clients inside the Kubernetes cluster, you can create `plain` (without encryption) or `tls` listener types.", "author": "scholzj", "createdAt": "2020-08-11T20:00:16Z", "path": "documentation/modules/con-securing-kafka-authentication.adoc", "diffHunk": "@@ -0,0 +1,115 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-brokers.adoc\n+\n+[id='con-securing-kafka-authentication-{context}']\n+= Listener authentication\n+\n+You can create `plain` (without encryption) or `tls` listener types.", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzMTIyMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468831221", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            . Mutual TLS authentication (only on the listeners with TLS encryption)\n          \n          \n            \n            . Mutual TLS authentication (only on the listeners with TLS enabled encryption)", "author": "scholzj", "createdAt": "2020-08-11T20:00:43Z", "path": "documentation/modules/con-securing-kafka-authentication.adoc", "diffHunk": "@@ -0,0 +1,115 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-brokers.adoc\n+\n+[id='con-securing-kafka-authentication-{context}']\n+= Listener authentication\n+\n+You can create `plain` (without encryption) or `tls` listener types.\n+For clients outside the Kubernetes cluster, you create `external` listeners and specify a connection mechanism, which can be `nodeport`, `loadbalancer`, `ingress` or `route` (on OpenShift).\n+\n+Supported authentication options:\n+\n+. Mutual TLS authentication (only on the listeners with TLS encryption)", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzMTMwNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468831306", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            . SCRAM-SHA authentication\n          \n          \n            \n            . SCRAM-SHA-512 authentication", "author": "scholzj", "createdAt": "2020-08-11T20:00:54Z", "path": "documentation/modules/con-securing-kafka-authentication.adoc", "diffHunk": "@@ -0,0 +1,115 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-brokers.adoc\n+\n+[id='con-securing-kafka-authentication-{context}']\n+= Listener authentication\n+\n+You can create `plain` (without encryption) or `tls` listener types.\n+For clients outside the Kubernetes cluster, you create `external` listeners and specify a connection mechanism, which can be `nodeport`, `loadbalancer`, `ingress` or `route` (on OpenShift).\n+\n+Supported authentication options:\n+\n+. Mutual TLS authentication (only on the listeners with TLS encryption)\n+. SCRAM-SHA authentication", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzMTgxOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468831818", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * A `plain` listener configured for SCRAM-SHA authentication\n          \n          \n            \n            * A `plain` listener configured for SCRAM-SHA-512 authentication", "author": "scholzj", "createdAt": "2020-08-11T20:02:00Z", "path": "documentation/modules/con-securing-kafka-authentication.adoc", "diffHunk": "@@ -0,0 +1,115 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-brokers.adoc\n+\n+[id='con-securing-kafka-authentication-{context}']\n+= Listener authentication\n+\n+You can create `plain` (without encryption) or `tls` listener types.\n+For clients outside the Kubernetes cluster, you create `external` listeners and specify a connection mechanism, which can be `nodeport`, `loadbalancer`, `ingress` or `route` (on OpenShift).\n+\n+Supported authentication options:\n+\n+. Mutual TLS authentication (only on the listeners with TLS encryption)\n+. SCRAM-SHA authentication\n+. xref:assembly-oauth-authentication_str[OAuth 2.0 token based authentication]\n+\n+.Kafka listener authentication options\n+image::listener-config-options.png[options for listener authentication configuration]\n+\n+The listener `authentication` property is used to specify an authentication mechanism specific to that listener.\n+\n+The listener authentication mechanism is defined by the `type` field.\n+If no `authentication` property is specified then the listener does not authenticate clients which connect through that listener.\n+The listener will accept all connections without authentication.\n+\n+Authentication must be configured when using the User Operator to manage `KafkaUsers`.\n+\n+The following example shows:\n+\n+* A `plain` listener configured for SCRAM-SHA authentication", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzMjQzMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468832432", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            NOTE: TLS authentication is more commonly one-way, with one party authenticating the identity of another. For example, when HTTPS is used between a web browser and a web server, the server obtains proof of the identity of the browser.\n          \n          \n            \n            NOTE: TLS authentication is more commonly one-way, with one party authenticating the identity of another. For example, when HTTPS is used between a web browser and a web server, the browser obtains proof of the identity of the web server.", "author": "scholzj", "createdAt": "2020-08-11T20:03:19Z", "path": "documentation/modules/con-securing-kafka-authentication.adoc", "diffHunk": "@@ -0,0 +1,115 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-brokers.adoc\n+\n+[id='con-securing-kafka-authentication-{context}']\n+= Listener authentication\n+\n+You can create `plain` (without encryption) or `tls` listener types.\n+For clients outside the Kubernetes cluster, you create `external` listeners and specify a connection mechanism, which can be `nodeport`, `loadbalancer`, `ingress` or `route` (on OpenShift).\n+\n+Supported authentication options:\n+\n+. Mutual TLS authentication (only on the listeners with TLS encryption)\n+. SCRAM-SHA authentication\n+. xref:assembly-oauth-authentication_str[OAuth 2.0 token based authentication]\n+\n+.Kafka listener authentication options\n+image::listener-config-options.png[options for listener authentication configuration]\n+\n+The listener `authentication` property is used to specify an authentication mechanism specific to that listener.\n+\n+The listener authentication mechanism is defined by the `type` field.\n+If no `authentication` property is specified then the listener does not authenticate clients which connect through that listener.\n+The listener will accept all connections without authentication.\n+\n+Authentication must be configured when using the User Operator to manage `KafkaUsers`.\n+\n+The following example shows:\n+\n+* A `plain` listener configured for SCRAM-SHA authentication\n+* A `tls` listener with mutual TLS authentication\n+* An `external` listener with mutual TLS authentication\n+\n+.An example showing listener authentication configuration\n+[source,yaml,subs=\"attributes+\"]\n+----\n+# ...\n+listeners:\n+  plain:\n+    authentication:\n+      type: scram-sha-512\n+  tls:\n+    authentication:\n+      type: tls\n+  external:\n+    type: loadbalancer\n+    tls: true\n+    authentication:\n+      type: tls\n+# ...\n+----\n+\n+[id='con-mutual-tls-authentication-{context}']\n+== Mutual TLS authentication\n+\n+Mutual TLS authentication is always used for the communication between Kafka brokers and ZooKeeper pods.\n+\n+For mutual authentication or two-way authentication, both the server and the client present certificates.\n+Strimzi can configure Kafka to use TLS (Transport Layer Security) to provide encrypted communication between Kafka brokers and clients either with or without mutual authentication. When you configure mutual authentication, the broker authenticates the client and the client authenticates the broker.\n+\n+NOTE: TLS authentication is more commonly one-way, with one party authenticating the identity of another. For example, when HTTPS is used between a web browser and a web server, the server obtains proof of the identity of the browser.", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzMjU0Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468832547", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Strimzi can configure Kafka to use TLS (Transport Layer Security) to provide encrypted communication between Kafka brokers and clients either with or without mutual authentication. When you configure mutual authentication, the broker authenticates the client and the client authenticates the broker.\n          \n          \n            \n            Strimzi can configure Kafka to use TLS (Transport Layer Security) to provide encrypted communication between Kafka brokers and clients either with or without mutual authentication. When you configure mutual authentication, the broker authenticates the client (client authentication) and the client authenticates the broker (server authentication).", "author": "scholzj", "createdAt": "2020-08-11T20:03:37Z", "path": "documentation/modules/con-securing-kafka-authentication.adoc", "diffHunk": "@@ -0,0 +1,115 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-brokers.adoc\n+\n+[id='con-securing-kafka-authentication-{context}']\n+= Listener authentication\n+\n+You can create `plain` (without encryption) or `tls` listener types.\n+For clients outside the Kubernetes cluster, you create `external` listeners and specify a connection mechanism, which can be `nodeport`, `loadbalancer`, `ingress` or `route` (on OpenShift).\n+\n+Supported authentication options:\n+\n+. Mutual TLS authentication (only on the listeners with TLS encryption)\n+. SCRAM-SHA authentication\n+. xref:assembly-oauth-authentication_str[OAuth 2.0 token based authentication]\n+\n+.Kafka listener authentication options\n+image::listener-config-options.png[options for listener authentication configuration]\n+\n+The listener `authentication` property is used to specify an authentication mechanism specific to that listener.\n+\n+The listener authentication mechanism is defined by the `type` field.\n+If no `authentication` property is specified then the listener does not authenticate clients which connect through that listener.\n+The listener will accept all connections without authentication.\n+\n+Authentication must be configured when using the User Operator to manage `KafkaUsers`.\n+\n+The following example shows:\n+\n+* A `plain` listener configured for SCRAM-SHA authentication\n+* A `tls` listener with mutual TLS authentication\n+* An `external` listener with mutual TLS authentication\n+\n+.An example showing listener authentication configuration\n+[source,yaml,subs=\"attributes+\"]\n+----\n+# ...\n+listeners:\n+  plain:\n+    authentication:\n+      type: scram-sha-512\n+  tls:\n+    authentication:\n+      type: tls\n+  external:\n+    type: loadbalancer\n+    tls: true\n+    authentication:\n+      type: tls\n+# ...\n+----\n+\n+[id='con-mutual-tls-authentication-{context}']\n+== Mutual TLS authentication\n+\n+Mutual TLS authentication is always used for the communication between Kafka brokers and ZooKeeper pods.\n+\n+For mutual authentication or two-way authentication, both the server and the client present certificates.\n+Strimzi can configure Kafka to use TLS (Transport Layer Security) to provide encrypted communication between Kafka brokers and clients either with or without mutual authentication. When you configure mutual authentication, the broker authenticates the client and the client authenticates the broker.", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzMzYzOQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468833639", "bodyText": "I think we should either make it a heading or remove it completely. In the current state, it is not clickable and cannot be linked but it also doesn't add any value because the text is saying basically the same as the sentence below.", "author": "scholzj", "createdAt": "2020-08-11T20:05:50Z", "path": "documentation/modules/con-securing-kafka-authentication.adoc", "diffHunk": "@@ -0,0 +1,115 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-brokers.adoc\n+\n+[id='con-securing-kafka-authentication-{context}']\n+= Listener authentication\n+\n+You can create `plain` (without encryption) or `tls` listener types.\n+For clients outside the Kubernetes cluster, you create `external` listeners and specify a connection mechanism, which can be `nodeport`, `loadbalancer`, `ingress` or `route` (on OpenShift).\n+\n+Supported authentication options:\n+\n+. Mutual TLS authentication (only on the listeners with TLS encryption)\n+. SCRAM-SHA authentication\n+. xref:assembly-oauth-authentication_str[OAuth 2.0 token based authentication]\n+\n+.Kafka listener authentication options\n+image::listener-config-options.png[options for listener authentication configuration]\n+\n+The listener `authentication` property is used to specify an authentication mechanism specific to that listener.\n+\n+The listener authentication mechanism is defined by the `type` field.\n+If no `authentication` property is specified then the listener does not authenticate clients which connect through that listener.\n+The listener will accept all connections without authentication.\n+\n+Authentication must be configured when using the User Operator to manage `KafkaUsers`.\n+\n+The following example shows:\n+\n+* A `plain` listener configured for SCRAM-SHA authentication\n+* A `tls` listener with mutual TLS authentication\n+* An `external` listener with mutual TLS authentication\n+\n+.An example showing listener authentication configuration\n+[source,yaml,subs=\"attributes+\"]\n+----\n+# ...\n+listeners:\n+  plain:\n+    authentication:\n+      type: scram-sha-512\n+  tls:\n+    authentication:\n+      type: tls\n+  external:\n+    type: loadbalancer\n+    tls: true\n+    authentication:\n+      type: tls\n+# ...\n+----\n+\n+[id='con-mutual-tls-authentication-{context}']\n+== Mutual TLS authentication\n+\n+Mutual TLS authentication is always used for the communication between Kafka brokers and ZooKeeper pods.\n+\n+For mutual authentication or two-way authentication, both the server and the client present certificates.\n+Strimzi can configure Kafka to use TLS (Transport Layer Security) to provide encrypted communication between Kafka brokers and clients either with or without mutual authentication. When you configure mutual authentication, the broker authenticates the client and the client authenticates the broker.\n+\n+NOTE: TLS authentication is more commonly one-way, with one party authenticating the identity of another. For example, when HTTPS is used between a web browser and a web server, the server obtains proof of the identity of the browser.\n+\n+.When to use mutual TLS authentication for clients", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE0MzMwOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r469143308", "bodyText": "removed", "author": "PaulRMellor", "createdAt": "2020-08-12T09:52:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzMzYzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzMzc4Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468833782", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            == SCRAM-SHA authentication\n          \n          \n            \n            == SCRAM-SHA-512 authentication", "author": "scholzj", "createdAt": "2020-08-11T20:06:04Z", "path": "documentation/modules/con-securing-kafka-authentication.adoc", "diffHunk": "@@ -0,0 +1,115 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-brokers.adoc\n+\n+[id='con-securing-kafka-authentication-{context}']\n+= Listener authentication\n+\n+You can create `plain` (without encryption) or `tls` listener types.\n+For clients outside the Kubernetes cluster, you create `external` listeners and specify a connection mechanism, which can be `nodeport`, `loadbalancer`, `ingress` or `route` (on OpenShift).\n+\n+Supported authentication options:\n+\n+. Mutual TLS authentication (only on the listeners with TLS encryption)\n+. SCRAM-SHA authentication\n+. xref:assembly-oauth-authentication_str[OAuth 2.0 token based authentication]\n+\n+.Kafka listener authentication options\n+image::listener-config-options.png[options for listener authentication configuration]\n+\n+The listener `authentication` property is used to specify an authentication mechanism specific to that listener.\n+\n+The listener authentication mechanism is defined by the `type` field.\n+If no `authentication` property is specified then the listener does not authenticate clients which connect through that listener.\n+The listener will accept all connections without authentication.\n+\n+Authentication must be configured when using the User Operator to manage `KafkaUsers`.\n+\n+The following example shows:\n+\n+* A `plain` listener configured for SCRAM-SHA authentication\n+* A `tls` listener with mutual TLS authentication\n+* An `external` listener with mutual TLS authentication\n+\n+.An example showing listener authentication configuration\n+[source,yaml,subs=\"attributes+\"]\n+----\n+# ...\n+listeners:\n+  plain:\n+    authentication:\n+      type: scram-sha-512\n+  tls:\n+    authentication:\n+      type: tls\n+  external:\n+    type: loadbalancer\n+    tls: true\n+    authentication:\n+      type: tls\n+# ...\n+----\n+\n+[id='con-mutual-tls-authentication-{context}']\n+== Mutual TLS authentication\n+\n+Mutual TLS authentication is always used for the communication between Kafka brokers and ZooKeeper pods.\n+\n+For mutual authentication or two-way authentication, both the server and the client present certificates.\n+Strimzi can configure Kafka to use TLS (Transport Layer Security) to provide encrypted communication between Kafka brokers and clients either with or without mutual authentication. When you configure mutual authentication, the broker authenticates the client and the client authenticates the broker.\n+\n+NOTE: TLS authentication is more commonly one-way, with one party authenticating the identity of another. For example, when HTTPS is used between a web browser and a web server, the server obtains proof of the identity of the browser.\n+\n+.When to use mutual TLS authentication for clients\n+\n+Mutual TLS authentication is recommended for authenticating Kafka clients when:\n+\n+* The client supports authentication using mutual TLS authentication\n+* It is necessary to use the TLS certificates rather than passwords\n+* You can reconfigure and restart client applications periodically so that they do not use expired certificates.\n+\n+[id='con-scram-sha-authentication-{context}']\n+== SCRAM-SHA authentication", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzNTQ5Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468835496", "bodyText": "To be honest, I have some doubts about these:\n\nThis The client supports authentication using mutual TLS authentication is a prerequisite but we do not recommend to use TLS client authentication just because the client supports it.\nThe second point It is necessary to use the TLS certificates rather than passwords is very unspecific. It would be good to explain why would it be necessary.\nThe third point You can reconfigure and restart client applications periodically so that they do not use expired certificates. is imho confusing / misleading since the periodically could be for example every 5 years.\n\nMaybe we should just remove it if we do not have anything better? (I don't right now)", "author": "scholzj", "createdAt": "2020-08-11T20:09:34Z", "path": "documentation/modules/con-securing-kafka-authentication.adoc", "diffHunk": "@@ -0,0 +1,115 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-brokers.adoc\n+\n+[id='con-securing-kafka-authentication-{context}']\n+= Listener authentication\n+\n+You can create `plain` (without encryption) or `tls` listener types.\n+For clients outside the Kubernetes cluster, you create `external` listeners and specify a connection mechanism, which can be `nodeport`, `loadbalancer`, `ingress` or `route` (on OpenShift).\n+\n+Supported authentication options:\n+\n+. Mutual TLS authentication (only on the listeners with TLS encryption)\n+. SCRAM-SHA authentication\n+. xref:assembly-oauth-authentication_str[OAuth 2.0 token based authentication]\n+\n+.Kafka listener authentication options\n+image::listener-config-options.png[options for listener authentication configuration]\n+\n+The listener `authentication` property is used to specify an authentication mechanism specific to that listener.\n+\n+The listener authentication mechanism is defined by the `type` field.\n+If no `authentication` property is specified then the listener does not authenticate clients which connect through that listener.\n+The listener will accept all connections without authentication.\n+\n+Authentication must be configured when using the User Operator to manage `KafkaUsers`.\n+\n+The following example shows:\n+\n+* A `plain` listener configured for SCRAM-SHA authentication\n+* A `tls` listener with mutual TLS authentication\n+* An `external` listener with mutual TLS authentication\n+\n+.An example showing listener authentication configuration\n+[source,yaml,subs=\"attributes+\"]\n+----\n+# ...\n+listeners:\n+  plain:\n+    authentication:\n+      type: scram-sha-512\n+  tls:\n+    authentication:\n+      type: tls\n+  external:\n+    type: loadbalancer\n+    tls: true\n+    authentication:\n+      type: tls\n+# ...\n+----\n+\n+[id='con-mutual-tls-authentication-{context}']\n+== Mutual TLS authentication\n+\n+Mutual TLS authentication is always used for the communication between Kafka brokers and ZooKeeper pods.\n+\n+For mutual authentication or two-way authentication, both the server and the client present certificates.\n+Strimzi can configure Kafka to use TLS (Transport Layer Security) to provide encrypted communication between Kafka brokers and clients either with or without mutual authentication. When you configure mutual authentication, the broker authenticates the client and the client authenticates the broker.\n+\n+NOTE: TLS authentication is more commonly one-way, with one party authenticating the identity of another. For example, when HTTPS is used between a web browser and a web server, the server obtains proof of the identity of the browser.\n+\n+.When to use mutual TLS authentication for clients\n+\n+Mutual TLS authentication is recommended for authenticating Kafka clients when:\n+\n+* The client supports authentication using mutual TLS authentication\n+* It is necessary to use the TLS certificates rather than passwords\n+* You can reconfigure and restart client applications periodically so that they do not use expired certificates.", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE1MTU1MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r469151550", "bodyText": "Okay. Let's remove these 'when to use...' sections. I've added a sentence to the top of the section:\n\nThe authentication option you choose depends on how you wish to authenticate client access to Kafka brokers.", "author": "PaulRMellor", "createdAt": "2020-08-12T10:08:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzNTQ5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzNTgyNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468835826", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            SCRAM (Salted Challenge Response Authentication Mechanism) is an authentication protocol that can establish mutual authentication using passwords. Strimzi can configure Kafka to use SASL (Simple Authentication and Security Layer) SCRAM-SHA-512 to provide authentication on both unencrypted and TLS-encrypted client connections. TLS authentication is always used internally between Kafka brokers and ZooKeeper nodes. When used with a TLS client connection, the TLS protocol provides encryption, but is not used for authentication.\n          \n          \n            \n            SCRAM (Salted Challenge Response Authentication Mechanism) is an authentication protocol that can establish mutual authentication using passwords. Strimzi can configure Kafka to use SASL (Simple Authentication and Security Layer) SCRAM-SHA-512 to provide authentication on both unencrypted and encrypted client connections. TLS authentication is always used internally between Kafka brokers and ZooKeeper nodes. When used with a TLS client connection, the TLS protocol provides encryption, but is not used for authentication.", "author": "scholzj", "createdAt": "2020-08-11T20:10:15Z", "path": "documentation/modules/con-securing-kafka-authentication.adoc", "diffHunk": "@@ -0,0 +1,115 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-brokers.adoc\n+\n+[id='con-securing-kafka-authentication-{context}']\n+= Listener authentication\n+\n+You can create `plain` (without encryption) or `tls` listener types.\n+For clients outside the Kubernetes cluster, you create `external` listeners and specify a connection mechanism, which can be `nodeport`, `loadbalancer`, `ingress` or `route` (on OpenShift).\n+\n+Supported authentication options:\n+\n+. Mutual TLS authentication (only on the listeners with TLS encryption)\n+. SCRAM-SHA authentication\n+. xref:assembly-oauth-authentication_str[OAuth 2.0 token based authentication]\n+\n+.Kafka listener authentication options\n+image::listener-config-options.png[options for listener authentication configuration]\n+\n+The listener `authentication` property is used to specify an authentication mechanism specific to that listener.\n+\n+The listener authentication mechanism is defined by the `type` field.\n+If no `authentication` property is specified then the listener does not authenticate clients which connect through that listener.\n+The listener will accept all connections without authentication.\n+\n+Authentication must be configured when using the User Operator to manage `KafkaUsers`.\n+\n+The following example shows:\n+\n+* A `plain` listener configured for SCRAM-SHA authentication\n+* A `tls` listener with mutual TLS authentication\n+* An `external` listener with mutual TLS authentication\n+\n+.An example showing listener authentication configuration\n+[source,yaml,subs=\"attributes+\"]\n+----\n+# ...\n+listeners:\n+  plain:\n+    authentication:\n+      type: scram-sha-512\n+  tls:\n+    authentication:\n+      type: tls\n+  external:\n+    type: loadbalancer\n+    tls: true\n+    authentication:\n+      type: tls\n+# ...\n+----\n+\n+[id='con-mutual-tls-authentication-{context}']\n+== Mutual TLS authentication\n+\n+Mutual TLS authentication is always used for the communication between Kafka brokers and ZooKeeper pods.\n+\n+For mutual authentication or two-way authentication, both the server and the client present certificates.\n+Strimzi can configure Kafka to use TLS (Transport Layer Security) to provide encrypted communication between Kafka brokers and clients either with or without mutual authentication. When you configure mutual authentication, the broker authenticates the client and the client authenticates the broker.\n+\n+NOTE: TLS authentication is more commonly one-way, with one party authenticating the identity of another. For example, when HTTPS is used between a web browser and a web server, the server obtains proof of the identity of the browser.\n+\n+.When to use mutual TLS authentication for clients\n+\n+Mutual TLS authentication is recommended for authenticating Kafka clients when:\n+\n+* The client supports authentication using mutual TLS authentication\n+* It is necessary to use the TLS certificates rather than passwords\n+* You can reconfigure and restart client applications periodically so that they do not use expired certificates.\n+\n+[id='con-scram-sha-authentication-{context}']\n+== SCRAM-SHA authentication\n+\n+SCRAM (Salted Challenge Response Authentication Mechanism) is an authentication protocol that can establish mutual authentication using passwords. Strimzi can configure Kafka to use SASL (Simple Authentication and Security Layer) SCRAM-SHA-512 to provide authentication on both unencrypted and TLS-encrypted client connections. TLS authentication is always used internally between Kafka brokers and ZooKeeper nodes. When used with a TLS client connection, the TLS protocol provides encryption, but is not used for authentication.", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzNTk5Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468835993", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The following properties of SCRAM make it safe to use SCRAM-SHA even on unencrypted connections:\n          \n          \n            \n            The following properties of SCRAM make it safe to use SCRAM-SHA-512 even on unencrypted connections:", "author": "scholzj", "createdAt": "2020-08-11T20:10:38Z", "path": "documentation/modules/con-securing-kafka-authentication.adoc", "diffHunk": "@@ -0,0 +1,115 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-brokers.adoc\n+\n+[id='con-securing-kafka-authentication-{context}']\n+= Listener authentication\n+\n+You can create `plain` (without encryption) or `tls` listener types.\n+For clients outside the Kubernetes cluster, you create `external` listeners and specify a connection mechanism, which can be `nodeport`, `loadbalancer`, `ingress` or `route` (on OpenShift).\n+\n+Supported authentication options:\n+\n+. Mutual TLS authentication (only on the listeners with TLS encryption)\n+. SCRAM-SHA authentication\n+. xref:assembly-oauth-authentication_str[OAuth 2.0 token based authentication]\n+\n+.Kafka listener authentication options\n+image::listener-config-options.png[options for listener authentication configuration]\n+\n+The listener `authentication` property is used to specify an authentication mechanism specific to that listener.\n+\n+The listener authentication mechanism is defined by the `type` field.\n+If no `authentication` property is specified then the listener does not authenticate clients which connect through that listener.\n+The listener will accept all connections without authentication.\n+\n+Authentication must be configured when using the User Operator to manage `KafkaUsers`.\n+\n+The following example shows:\n+\n+* A `plain` listener configured for SCRAM-SHA authentication\n+* A `tls` listener with mutual TLS authentication\n+* An `external` listener with mutual TLS authentication\n+\n+.An example showing listener authentication configuration\n+[source,yaml,subs=\"attributes+\"]\n+----\n+# ...\n+listeners:\n+  plain:\n+    authentication:\n+      type: scram-sha-512\n+  tls:\n+    authentication:\n+      type: tls\n+  external:\n+    type: loadbalancer\n+    tls: true\n+    authentication:\n+      type: tls\n+# ...\n+----\n+\n+[id='con-mutual-tls-authentication-{context}']\n+== Mutual TLS authentication\n+\n+Mutual TLS authentication is always used for the communication between Kafka brokers and ZooKeeper pods.\n+\n+For mutual authentication or two-way authentication, both the server and the client present certificates.\n+Strimzi can configure Kafka to use TLS (Transport Layer Security) to provide encrypted communication between Kafka brokers and clients either with or without mutual authentication. When you configure mutual authentication, the broker authenticates the client and the client authenticates the broker.\n+\n+NOTE: TLS authentication is more commonly one-way, with one party authenticating the identity of another. For example, when HTTPS is used between a web browser and a web server, the server obtains proof of the identity of the browser.\n+\n+.When to use mutual TLS authentication for clients\n+\n+Mutual TLS authentication is recommended for authenticating Kafka clients when:\n+\n+* The client supports authentication using mutual TLS authentication\n+* It is necessary to use the TLS certificates rather than passwords\n+* You can reconfigure and restart client applications periodically so that they do not use expired certificates.\n+\n+[id='con-scram-sha-authentication-{context}']\n+== SCRAM-SHA authentication\n+\n+SCRAM (Salted Challenge Response Authentication Mechanism) is an authentication protocol that can establish mutual authentication using passwords. Strimzi can configure Kafka to use SASL (Simple Authentication and Security Layer) SCRAM-SHA-512 to provide authentication on both unencrypted and TLS-encrypted client connections. TLS authentication is always used internally between Kafka brokers and ZooKeeper nodes. When used with a TLS client connection, the TLS protocol provides encryption, but is not used for authentication.\n+\n+The following properties of SCRAM make it safe to use SCRAM-SHA even on unencrypted connections:", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzNjY0Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468836646", "bodyText": "Again, I have some doubts whether this is really needed. It is not clickable heading but adds no new information.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            .When to use SCRAM-SHA authentication for clients\n          \n          \n            \n            .When to use SCRAM-SHA-512 authentication for clients", "author": "scholzj", "createdAt": "2020-08-11T20:11:52Z", "path": "documentation/modules/con-securing-kafka-authentication.adoc", "diffHunk": "@@ -0,0 +1,115 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-brokers.adoc\n+\n+[id='con-securing-kafka-authentication-{context}']\n+= Listener authentication\n+\n+You can create `plain` (without encryption) or `tls` listener types.\n+For clients outside the Kubernetes cluster, you create `external` listeners and specify a connection mechanism, which can be `nodeport`, `loadbalancer`, `ingress` or `route` (on OpenShift).\n+\n+Supported authentication options:\n+\n+. Mutual TLS authentication (only on the listeners with TLS encryption)\n+. SCRAM-SHA authentication\n+. xref:assembly-oauth-authentication_str[OAuth 2.0 token based authentication]\n+\n+.Kafka listener authentication options\n+image::listener-config-options.png[options for listener authentication configuration]\n+\n+The listener `authentication` property is used to specify an authentication mechanism specific to that listener.\n+\n+The listener authentication mechanism is defined by the `type` field.\n+If no `authentication` property is specified then the listener does not authenticate clients which connect through that listener.\n+The listener will accept all connections without authentication.\n+\n+Authentication must be configured when using the User Operator to manage `KafkaUsers`.\n+\n+The following example shows:\n+\n+* A `plain` listener configured for SCRAM-SHA authentication\n+* A `tls` listener with mutual TLS authentication\n+* An `external` listener with mutual TLS authentication\n+\n+.An example showing listener authentication configuration\n+[source,yaml,subs=\"attributes+\"]\n+----\n+# ...\n+listeners:\n+  plain:\n+    authentication:\n+      type: scram-sha-512\n+  tls:\n+    authentication:\n+      type: tls\n+  external:\n+    type: loadbalancer\n+    tls: true\n+    authentication:\n+      type: tls\n+# ...\n+----\n+\n+[id='con-mutual-tls-authentication-{context}']\n+== Mutual TLS authentication\n+\n+Mutual TLS authentication is always used for the communication between Kafka brokers and ZooKeeper pods.\n+\n+For mutual authentication or two-way authentication, both the server and the client present certificates.\n+Strimzi can configure Kafka to use TLS (Transport Layer Security) to provide encrypted communication between Kafka brokers and clients either with or without mutual authentication. When you configure mutual authentication, the broker authenticates the client and the client authenticates the broker.\n+\n+NOTE: TLS authentication is more commonly one-way, with one party authenticating the identity of another. For example, when HTTPS is used between a web browser and a web server, the server obtains proof of the identity of the browser.\n+\n+.When to use mutual TLS authentication for clients\n+\n+Mutual TLS authentication is recommended for authenticating Kafka clients when:\n+\n+* The client supports authentication using mutual TLS authentication\n+* It is necessary to use the TLS certificates rather than passwords\n+* You can reconfigure and restart client applications periodically so that they do not use expired certificates.\n+\n+[id='con-scram-sha-authentication-{context}']\n+== SCRAM-SHA authentication\n+\n+SCRAM (Salted Challenge Response Authentication Mechanism) is an authentication protocol that can establish mutual authentication using passwords. Strimzi can configure Kafka to use SASL (Simple Authentication and Security Layer) SCRAM-SHA-512 to provide authentication on both unencrypted and TLS-encrypted client connections. TLS authentication is always used internally between Kafka brokers and ZooKeeper nodes. When used with a TLS client connection, the TLS protocol provides encryption, but is not used for authentication.\n+\n+The following properties of SCRAM make it safe to use SCRAM-SHA even on unencrypted connections:\n+\n+* The passwords are not sent in the clear over the communication channel.\n+Instead the client and the server are each challenged by the other to offer proof that they know the password of the authenticating user.\n+\n+* The server and client each generate a new challenge for each authentication exchange.\n+This means that the exchange is resilient against replay attacks.\n+\n+.Supported SCRAM credentials\n+\n+Strimzi supports SCRAM-SHA-512 only.\n+When a `KafkaUser.spec.authentication.type` is configured with `scram-sha-512` the User Operator will generate a random 12 character password consisting of upper and lowercase ASCII letters and numbers.\n+\n+.When to use SCRAM-SHA authentication for clients", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE1NDU0Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r469154547", "bodyText": "Section removed", "author": "PaulRMellor", "createdAt": "2020-08-12T10:14:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzNjY0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzNjgzMw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468836833", "bodyText": "Again, I have some doubts whether this is really needed. It is not clickable heading but adds no new information. Even visually it seems to be rather useless.", "author": "scholzj", "createdAt": "2020-08-11T20:12:14Z", "path": "documentation/modules/con-securing-kafka-authentication.adoc", "diffHunk": "@@ -0,0 +1,115 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-brokers.adoc\n+\n+[id='con-securing-kafka-authentication-{context}']\n+= Listener authentication\n+\n+You can create `plain` (without encryption) or `tls` listener types.\n+For clients outside the Kubernetes cluster, you create `external` listeners and specify a connection mechanism, which can be `nodeport`, `loadbalancer`, `ingress` or `route` (on OpenShift).\n+\n+Supported authentication options:\n+\n+. Mutual TLS authentication (only on the listeners with TLS encryption)\n+. SCRAM-SHA authentication\n+. xref:assembly-oauth-authentication_str[OAuth 2.0 token based authentication]\n+\n+.Kafka listener authentication options\n+image::listener-config-options.png[options for listener authentication configuration]\n+\n+The listener `authentication` property is used to specify an authentication mechanism specific to that listener.\n+\n+The listener authentication mechanism is defined by the `type` field.\n+If no `authentication` property is specified then the listener does not authenticate clients which connect through that listener.\n+The listener will accept all connections without authentication.\n+\n+Authentication must be configured when using the User Operator to manage `KafkaUsers`.\n+\n+The following example shows:\n+\n+* A `plain` listener configured for SCRAM-SHA authentication\n+* A `tls` listener with mutual TLS authentication\n+* An `external` listener with mutual TLS authentication\n+\n+.An example showing listener authentication configuration\n+[source,yaml,subs=\"attributes+\"]\n+----\n+# ...\n+listeners:\n+  plain:\n+    authentication:\n+      type: scram-sha-512\n+  tls:\n+    authentication:\n+      type: tls\n+  external:\n+    type: loadbalancer\n+    tls: true\n+    authentication:\n+      type: tls\n+# ...\n+----\n+\n+[id='con-mutual-tls-authentication-{context}']\n+== Mutual TLS authentication\n+\n+Mutual TLS authentication is always used for the communication between Kafka brokers and ZooKeeper pods.\n+\n+For mutual authentication or two-way authentication, both the server and the client present certificates.\n+Strimzi can configure Kafka to use TLS (Transport Layer Security) to provide encrypted communication between Kafka brokers and clients either with or without mutual authentication. When you configure mutual authentication, the broker authenticates the client and the client authenticates the broker.\n+\n+NOTE: TLS authentication is more commonly one-way, with one party authenticating the identity of another. For example, when HTTPS is used between a web browser and a web server, the server obtains proof of the identity of the browser.\n+\n+.When to use mutual TLS authentication for clients\n+\n+Mutual TLS authentication is recommended for authenticating Kafka clients when:\n+\n+* The client supports authentication using mutual TLS authentication\n+* It is necessary to use the TLS certificates rather than passwords\n+* You can reconfigure and restart client applications periodically so that they do not use expired certificates.\n+\n+[id='con-scram-sha-authentication-{context}']\n+== SCRAM-SHA authentication\n+\n+SCRAM (Salted Challenge Response Authentication Mechanism) is an authentication protocol that can establish mutual authentication using passwords. Strimzi can configure Kafka to use SASL (Simple Authentication and Security Layer) SCRAM-SHA-512 to provide authentication on both unencrypted and TLS-encrypted client connections. TLS authentication is always used internally between Kafka brokers and ZooKeeper nodes. When used with a TLS client connection, the TLS protocol provides encryption, but is not used for authentication.\n+\n+The following properties of SCRAM make it safe to use SCRAM-SHA even on unencrypted connections:\n+\n+* The passwords are not sent in the clear over the communication channel.\n+Instead the client and the server are each challenged by the other to offer proof that they know the password of the authenticating user.\n+\n+* The server and client each generate a new challenge for each authentication exchange.\n+This means that the exchange is resilient against replay attacks.\n+\n+.Supported SCRAM credentials", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE1NTU3OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r469155578", "bodyText": "I've changed this:\n\n.Supported SCRAM credentials\nStrimzi supports SCRAM-SHA-512 only.\nWhen a KafkaUser.spec.authentication.type is configured with scram-sha-512 the User Operator will generate a random 12 character password consisting of upper and lowercase ASCII letters and numbers.\n\nTo this:\n\nWhen a KafkaUser.spec.authentication.type is configured with scram-sha-512 the User Operator will generate a random 12 character password consisting of upper and lowercase ASCII letters and numbers.", "author": "PaulRMellor", "createdAt": "2020-08-12T10:16:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzNjgzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzODEwMw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468838103", "bodyText": "Again, I think these two are bad arguments. The first makes it sound that whenever your clients supports SCRAM-SHA-512 we recommend you to use it. The second does not offer any actual reasons. It basically says If you know that you need to use passwords and not TLS certificates, we recommend you to use passwords which does nto make much sense.", "author": "scholzj", "createdAt": "2020-08-11T20:14:51Z", "path": "documentation/modules/con-securing-kafka-authentication.adoc", "diffHunk": "@@ -0,0 +1,115 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-brokers.adoc\n+\n+[id='con-securing-kafka-authentication-{context}']\n+= Listener authentication\n+\n+You can create `plain` (without encryption) or `tls` listener types.\n+For clients outside the Kubernetes cluster, you create `external` listeners and specify a connection mechanism, which can be `nodeport`, `loadbalancer`, `ingress` or `route` (on OpenShift).\n+\n+Supported authentication options:\n+\n+. Mutual TLS authentication (only on the listeners with TLS encryption)\n+. SCRAM-SHA authentication\n+. xref:assembly-oauth-authentication_str[OAuth 2.0 token based authentication]\n+\n+.Kafka listener authentication options\n+image::listener-config-options.png[options for listener authentication configuration]\n+\n+The listener `authentication` property is used to specify an authentication mechanism specific to that listener.\n+\n+The listener authentication mechanism is defined by the `type` field.\n+If no `authentication` property is specified then the listener does not authenticate clients which connect through that listener.\n+The listener will accept all connections without authentication.\n+\n+Authentication must be configured when using the User Operator to manage `KafkaUsers`.\n+\n+The following example shows:\n+\n+* A `plain` listener configured for SCRAM-SHA authentication\n+* A `tls` listener with mutual TLS authentication\n+* An `external` listener with mutual TLS authentication\n+\n+.An example showing listener authentication configuration\n+[source,yaml,subs=\"attributes+\"]\n+----\n+# ...\n+listeners:\n+  plain:\n+    authentication:\n+      type: scram-sha-512\n+  tls:\n+    authentication:\n+      type: tls\n+  external:\n+    type: loadbalancer\n+    tls: true\n+    authentication:\n+      type: tls\n+# ...\n+----\n+\n+[id='con-mutual-tls-authentication-{context}']\n+== Mutual TLS authentication\n+\n+Mutual TLS authentication is always used for the communication between Kafka brokers and ZooKeeper pods.\n+\n+For mutual authentication or two-way authentication, both the server and the client present certificates.\n+Strimzi can configure Kafka to use TLS (Transport Layer Security) to provide encrypted communication between Kafka brokers and clients either with or without mutual authentication. When you configure mutual authentication, the broker authenticates the client and the client authenticates the broker.\n+\n+NOTE: TLS authentication is more commonly one-way, with one party authenticating the identity of another. For example, when HTTPS is used between a web browser and a web server, the server obtains proof of the identity of the browser.\n+\n+.When to use mutual TLS authentication for clients\n+\n+Mutual TLS authentication is recommended for authenticating Kafka clients when:\n+\n+* The client supports authentication using mutual TLS authentication\n+* It is necessary to use the TLS certificates rather than passwords\n+* You can reconfigure and restart client applications periodically so that they do not use expired certificates.\n+\n+[id='con-scram-sha-authentication-{context}']\n+== SCRAM-SHA authentication\n+\n+SCRAM (Salted Challenge Response Authentication Mechanism) is an authentication protocol that can establish mutual authentication using passwords. Strimzi can configure Kafka to use SASL (Simple Authentication and Security Layer) SCRAM-SHA-512 to provide authentication on both unencrypted and TLS-encrypted client connections. TLS authentication is always used internally between Kafka brokers and ZooKeeper nodes. When used with a TLS client connection, the TLS protocol provides encryption, but is not used for authentication.\n+\n+The following properties of SCRAM make it safe to use SCRAM-SHA even on unencrypted connections:\n+\n+* The passwords are not sent in the clear over the communication channel.\n+Instead the client and the server are each challenged by the other to offer proof that they know the password of the authenticating user.\n+\n+* The server and client each generate a new challenge for each authentication exchange.\n+This means that the exchange is resilient against replay attacks.\n+\n+.Supported SCRAM credentials\n+\n+Strimzi supports SCRAM-SHA-512 only.\n+When a `KafkaUser.spec.authentication.type` is configured with `scram-sha-512` the User Operator will generate a random 12 character password consisting of upper and lowercase ASCII letters and numbers.\n+\n+.When to use SCRAM-SHA authentication for clients\n+\n+SCRAM-SHA is recommended for authenticating Kafka clients when:\n+\n+* The client supports authentication using SCRAM-SHA-512\n+* It is necessary to use passwords rather than the TLS certificates", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE1NTk3Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r469155973", "bodyText": "removed", "author": "PaulRMellor", "createdAt": "2020-08-12T10:16:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzODEwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzOTE3Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468839173", "bodyText": "Let's make this more clear by explaining the consequences of using no authhorization.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If the `authorization` property is missing, no authorization is enabled.\n          \n          \n            \n            If the `authorization` property is missing, no authorization is enabled and all clients are allowed to do anything.", "author": "scholzj", "createdAt": "2020-08-11T20:16:57Z", "path": "documentation/modules/con-securing-kafka-authorization.adoc", "diffHunk": "@@ -0,0 +1,39 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-access.adoc\n+\n+[id='con-securing-kafka-authorization-{context}']\n+= Kafka authorization\n+\n+You can configure authorization for Kafka brokers using the `authorization` property in the `Kafka.spec.kafka` resource.\n+If the `authorization` property is missing, no authorization is enabled.", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE1NjkzNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r469156936", "bodyText": "..no authorization is enabled and clients have no restrictions.", "author": "PaulRMellor", "createdAt": "2020-08-12T10:18:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgzOTE3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg0MDAwMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468840000", "bodyText": "I'm afraid this changed since this Pr was created.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Simple authorization in Strimzi uses the `SimpleAclAuthorizer` plugin, the default Access Control Lists (ACLs) authorization plugin provided with Apache Kafka.\n          \n          \n            \n            Simple authorization in Strimzi uses the `AclAuthorizer` plugin, the default Access Control Lists (ACLs) authorization plugin provided with Apache Kafka.", "author": "scholzj", "createdAt": "2020-08-11T20:18:39Z", "path": "documentation/api/io.strimzi.api.kafka.model.KafkaAuthorizationSimple.adoc", "diffHunk": "@@ -0,0 +1,27 @@\n+Simple authorization in Strimzi uses the `SimpleAclAuthorizer` plugin, the default Access Control Lists (ACLs) authorization plugin provided with Apache Kafka.", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE1ODY5MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r469158690", "bodyText": "Changed all references in the doc files", "author": "PaulRMellor", "createdAt": "2020-08-12T10:22:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg0MDAwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg0NDI0OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468844249", "bodyText": "Maybe we can add that if the .status section of the KafkaUser resource is empty after several minutes, users should double check the label?", "author": "scholzj", "createdAt": "2020-08-11T20:26:56Z", "path": "documentation/modules/con-securing-client-labels.adoc", "diffHunk": "@@ -0,0 +1,22 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-clients.adoc\n+\n+[id='con-securing-client-labels-{context}']\n+= Identifying a Kafka cluster for user handling\n+\n+A `KafkaUser` resource includes a label that defines the appropriate name of the Kafka cluster (derived from the name of the `Kafka` resource) to which it belongs.\n+\n+[source,yaml,subs=\"attributes+\"]\n+----\n+apiVersion: {KafkaApiVersion}\n+kind: KafkaUser\n+metadata:\n+  name: my-user\n+  labels:\n+    strimzi.io/cluster: my-cluster\n+----\n+\n+The label is used by the User Operator to identify the `KafkaUser` resource and create a new user, and also in subsequent handling of the user.\n+\n+If the label does not match the Kafka cluster, the User Operator cannot identify the `KafkaUser` and the user is not created.", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE2NzA2NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r469167065", "bodyText": "Shall we add a check too:\nkubectl get kafkauser my-user -o jsonpath='{.status}'", "author": "PaulRMellor", "createdAt": "2020-08-12T10:39:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg0NDI0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg0NjY1MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468846650", "bodyText": "You might need to edit it for better english, but I think we should have something like this:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Alternatively, if you are using OAuth 2.0 token based authentication, you can also xref:assembly-oauth-authorization_str[configure OAuth 2.0 authorization].\n          \n          \n            \n            Alternatively, you can use the Open Policy Agent authorization, or if you are using OAuth 2.0 token based authentication, you can also xref:assembly-oauth-authorization_str[configure OAuth 2.0 authorization].\n          \n          \n            \n            Open Policy Agent and OAuth 2.0 authorization is not managed through `KafkaUser` resources", "author": "scholzj", "createdAt": "2020-08-11T20:30:06Z", "path": "documentation/modules/con-securing-client-authorization.adoc", "diffHunk": "@@ -0,0 +1,56 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-clients.adoc\n+\n+[id='con-securing-client-authorization-{context}']\n+= User authorization\n+\n+User authorization is configured using the `authorization` property in `KafkaUser.spec`.\n+The authorization type enabled for a user is specified using the `type` field.\n+\n+If no authorization is specified, the User Operator does not provision any access rights for the user.\n+\n+To use simple authorization, you set the `type` property to `simple` in `KafkaUser.spec`.\n+Simple authorization uses the default Kafka authorization plugin, `SimpleAclAuthorizer`.\n+\n+Alternatively, if you are using OAuth 2.0 token based authentication, you can also xref:assembly-oauth-authorization_str[configure OAuth 2.0 authorization].", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg0NzA0NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468847044", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If a user is added to a list of super users in a Kafka broker configuration, the user is allowed unlimited access to the cluster regardless of any authorization constraints defined in ACLs.\n          \n          \n            \n            If a user is added to a list of super users in a Kafka broker configuration, the user is allowed unlimited access to the cluster regardless of any authorization constraints defined in ACLs in `KafkaUser`.", "author": "scholzj", "createdAt": "2020-08-11T20:30:51Z", "path": "documentation/modules/con-securing-client-authorization.adoc", "diffHunk": "@@ -0,0 +1,56 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-clients.adoc\n+\n+[id='con-securing-client-authorization-{context}']\n+= User authorization\n+\n+User authorization is configured using the `authorization` property in `KafkaUser.spec`.\n+The authorization type enabled for a user is specified using the `type` field.\n+\n+If no authorization is specified, the User Operator does not provision any access rights for the user.\n+\n+To use simple authorization, you set the `type` property to `simple` in `KafkaUser.spec`.\n+Simple authorization uses the default Kafka authorization plugin, `SimpleAclAuthorizer`.\n+\n+Alternatively, if you are using OAuth 2.0 token based authentication, you can also xref:assembly-oauth-authorization_str[configure OAuth 2.0 authorization].\n+\n+== ACL rules\n+\n+`SimpleAclAuthorizer` uses ACL rules to manage access to Kafka brokers.\n+\n+ACL rules grant access rights to the user, which you specify in the `acls` property.\n+\n+For more information about the `AclRule` object, see the xref:type-AclRule-reference[`AclRule` schema reference].\n+\n+== Super user access to Kafka brokers\n+\n+If a user is added to a list of super users in a Kafka broker configuration, the user is allowed unlimited access to the cluster regardless of any authorization constraints defined in ACLs.", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg0NzY3OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468847678", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * A `Kafka` resource to create listeners with a specified authentication type\n          \n          \n            \n            * A `Kafka` resource to create listeners with a specified authentication type and to configure authorization for the whole Kafka cluster.", "author": "scholzj", "createdAt": "2020-08-11T20:32:07Z", "path": "documentation/assemblies/assembly-securing-kafka.adoc", "diffHunk": "@@ -0,0 +1,49 @@\n+// This assembly is included in the following assemblies:\n+//\n+// // assembly-securing-access.adoc\n+\n+[id='assembly-securing-kafka-{context}']\n+= Securing access to Kafka brokers\n+\n+To establish secure access to Kafka brokers, you configure and apply:\n+\n+* A `Kafka` resource to create listeners with a specified authentication type", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg0ODQwMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468848402", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * `Kafka.spec.kafka.listeners.*.authentication` matches `KafkaUser.spec.authentication matches`\n          \n          \n            \n            * `Kafka.spec.kafka.listeners.*.authentication` matches `KafkaUser.spec.authentication`", "author": "scholzj", "createdAt": "2020-08-11T20:33:38Z", "path": "documentation/modules/proc-securing-kafka.adoc", "diffHunk": "@@ -0,0 +1,91 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka.adoc\n+\n+[id='proc-securing-kafka-{context}']\n+= Securing Kafka brokers\n+\n+This procedure shows the steps involved in securing Kafka brokers when running Strimzi.\n+\n+The security implemented for Kafka brokers must be compatible with the security implemented for the clients requiring access.\n+\n+* `Kafka.spec.kafka.listeners.*.authentication` matches `KafkaUser.spec.authentication matches`", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE3NTc2Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r469175763", "bodyText": "\ud83d\ude2e", "author": "PaulRMellor", "createdAt": "2020-08-12T10:57:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg0ODQwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg0ODQ5OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468848499", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * `Kafka.spec.kafka.authorization` matches `KafkaUser.spec.authorization matches`\n          \n          \n            \n            * `Kafka.spec.kafka.authorization` matches `KafkaUser.spec.authorization`", "author": "scholzj", "createdAt": "2020-08-11T20:33:48Z", "path": "documentation/modules/proc-securing-kafka.adoc", "diffHunk": "@@ -0,0 +1,91 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka.adoc\n+\n+[id='proc-securing-kafka-{context}']\n+= Securing Kafka brokers\n+\n+This procedure shows the steps involved in securing Kafka brokers when running Strimzi.\n+\n+The security implemented for Kafka brokers must be compatible with the security implemented for the clients requiring access.\n+\n+* `Kafka.spec.kafka.listeners.*.authentication` matches `KafkaUser.spec.authentication matches`\n+* `Kafka.spec.kafka.authorization` matches `KafkaUser.spec.authorization matches`", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg0OTcwMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468849702", "bodyText": "I think this part is a bit confusing since it talks about external listener now which is not even mentioned in the previous example. It is also not part of the procedure, so I'm not sure why this subchapter really is here.", "author": "scholzj", "createdAt": "2020-08-11T20:36:29Z", "path": "documentation/modules/proc-securing-kafka.adoc", "diffHunk": "@@ -0,0 +1,91 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka.adoc\n+\n+[id='proc-securing-kafka-{context}']\n+= Securing Kafka brokers\n+\n+This procedure shows the steps involved in securing Kafka brokers when running Strimzi.\n+\n+The security implemented for Kafka brokers must be compatible with the security implemented for the clients requiring access.\n+\n+* `Kafka.spec.kafka.listeners.*.authentication` matches `KafkaUser.spec.authentication matches`\n+* `Kafka.spec.kafka.authorization` matches `KafkaUser.spec.authorization matches`\n+\n+The steps show the configuration for simple authorization and a listener using TLS authentication.\n+For more information about listener configuration, see the xref:type-KafkaListeners-reference[`KafkaListeners` schema reference].\n+\n+Alternatively, you can use SCRAM-SHA or OAuth 2.0 for xref:con-securing-kafka-authentication-{context}[listener authentication],\n+and OAuth 2.0 or OPA for xref:con-securing-kafka-authorization-{context}[Kafka authorization].\n+\n+.Procedure\n+\n+. Configure the `Kafka` resource.\n+.. Configure the `authorization` property for authorization.\n+.. Configure the `listeners` property to create a listener with authentication.\n++\n+For example:\n++\n+[source,yaml,subs=attributes+]\n+----\n+apiVersion: {KafkaApiVersion}\n+kind: Kafka\n+spec:\n+  kafka:\n+    # ...\n+    authorization: <1>\n+      type: simple\n+      superUsers: <2>\n+        - CN=client_1\n+        - user_2\n+        - CN=client_3\n+    listeners:\n+      tls:\n+        authentication:\n+          type: tls <3>\n+    # ...\n+  zookeeper:\n+    # ...\n+----\n+<1> Authorization xref:con-securing-kafka-authorization-str[enables `simple` authorization on the Kafka broker using the `SimpleAclAuthorizer` Kafka plugin].\n+<2> List of user principals with unlimited access to Kafka. _CN_ is the common name from the client certificate when TLS authentication is used.\n+<3> Listener authentication mechanisms may be configured for each listener, and xref:assembly-securing-kafka-brokers-{context}[specified as mutual TLS or SCRAM-SHA].\n++\n+If you are configuring an external listener, the configuration is dependent on the chosen connection mechanism.\n+\n+. Create or update the `Kafka` resource.\n++\n+[source,shell,subs=+quotes]\n+kubectl apply -f _KAFKA-CONFIG-FILE_\n++\n+The Kafka cluster is configured with a Kafka broker listener using TLS authentication.\n++\n+A service is created for each Kafka broker pod.\n++\n+A service is created to serve as the _bootstrap address_ for connection to the Kafka cluster.\n++\n+The cluster CA certificate to verify the identity of the kafka brokers is also created with the same name as the `Kafka` resource.\n+\n+== Retrieving Kafka connection details\n+\n+You can retrieve Kafka connection details and add them as connection properties to a Kafka client.\n+\n+. Find the bootstrap address and port from the status of the `Kafka` resource.\n++\n+[source,shell, subs=+quotes]\n+kubectl get kafka _KAFKA-CLUSTER-NAME_ -o jsonpath='{.status.listeners[?(@.type==\"external\")].bootstrapServers}'\n++\n+Use the bootstrap address in your Kafka client to connect to the Kafka cluster.\n+\n+. Extract the public cluster CA certificate and password from the generated `_KAFKA-CLUSTER-NAME_-cluster-ca-cert` Secret.\n++\n+[source,shell,subs=\"+quotes\"]\n+kubectl get secret _KAFKA-CLUSTER-NAME_-cluster-ca-cert -o jsonpath='{.data.ca\\.p12}' | base64 -d > ca.p12\n++\n+[source,shell,subs=\"+quotes\"]\n+kubectl get secret _KAFKA-CLUSTER-NAME_-cluster-ca-cert -o jsonpath='{.data.ca\\.password}' | base64 -d > ca.password\n++\n+Use the certificate and password in your Kafka client to connect to the Kafka cluster with TLS encryption.\n++\n+NOTE: Cluster CA certificates renew automatically by default. If your are using your own Kafka listener certificates,", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE3NjQ2MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r469176461", "bodyText": "Removed.", "author": "PaulRMellor", "createdAt": "2020-08-12T10:58:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg0OTcwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg1MDcxMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r468850711", "bodyText": "This seems a bit out of place. I think we should replace it with something generic such as:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If you are using SCRAM-SHA authentication, you need a running Kafka cluster xref:con-scram-sha-authentication-{context}[configured with a Kafka broker listener using SCRAM-SHA authentication].\n          \n          \n            \n            The authentication type in `KafkaUser` should match the authentication configured in `Kafka` brokers.", "author": "scholzj", "createdAt": "2020-08-11T20:38:32Z", "path": "documentation/modules/proc-configuring-kafka-user.adoc", "diffHunk": "@@ -22,23 +22,24 @@ When you configure the `KafkaUser` authentication and authorization mechanisms,\n This procedure shows how a user is created with TLS authentication.\n You can also create a user with SCRAM-SHA authentication.\n \n-The authentication required depends on the xref:assembly-kafka-broker-listener-authentication-deployment-configuration-kafka[type of authentication configured for the Kafka broker listener].\n+The authentication required depends on the xref:con-securing-kafka-authentication-{context}[type of authentication configured for the Kafka broker listener].\n \n NOTE: Authentication between Kafka users and Kafka brokers depends on the authentication settings for each.\n For example, it is not possible to authenticate a user with TLS if it is not also enabled in the Kafka configuration.\n \n .Prerequisites\n \n-* A running Kafka cluster xref:con-mutual-tls-authentication-deployment-configuration-kafka[configured with a Kafka broker listener using TLS authentication and encryption].\n+* A running Kafka cluster xref:con-mutual-tls-authentication-{context}[configured with a Kafka broker listener using TLS authentication and encryption].\n * A running User Operator (typically xref:assembly-kafka-entity-operator-deployment-configuration-kafka[deployed with the Entity Operator]).\n \n-If you are using SCRAM-SHA authentication, you need a running Kafka cluster xref:con-scram-sha-authentication-deployment-configuration-kafka[configured with a Kafka broker listener using SCRAM-SHA authentication].\n+If you are using SCRAM-SHA authentication, you need a running Kafka cluster xref:con-scram-sha-authentication-{context}[configured with a Kafka broker listener using SCRAM-SHA authentication].", "originalCommit": "cec43fbfb16aee8706871b1879fedc2c40059689", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "00d63cee35e96f5e576fd4212fd9aefb9ad5a071", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/00d63cee35e96f5e576fd4212fd9aefb9ad5a071", "message": "review edits JS\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-08-12T14:54:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTUzNzI2Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r469537266", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            OAuth 2.0 authentication can also be used in conjunction with ACL or OPA-based xref:con-securing-kafka-authorization-str[Kafka authorization].\n          \n          \n            \n            OAuth 2.0 authentication can also be used in conjunction with `simple` or OPA-based xref:con-securing-kafka-authorization-str[Kafka authorization].", "author": "scholzj", "createdAt": "2020-08-12T20:47:37Z", "path": "documentation/assemblies/oauth/assembly-oauth-authentication.adoc", "diffHunk": "@@ -10,7 +10,8 @@ Strimzi supports the use of OAuth 2.0 authentication using the _SASL OAUTHBEARER\n OAuth 2.0 enables standardized token-based authentication and authorization between applications, using a central authorization server to issue tokens that grant limited access to resources.\n \n You can configure OAuth 2.0 authentication, then xref:assembly-oauth-authorization_{context}[OAuth 2.0 authorization].\n-OAuth 2.0 authentication can also be used in conjunction with xref:simple-acl-{context}[ACL-based Kafka authorization].\n+\n+OAuth 2.0 authentication can also be used in conjunction with ACL or OPA-based xref:con-securing-kafka-authorization-str[Kafka authorization].", "originalCommit": "00d63cee35e96f5e576fd4212fd9aefb9ad5a071", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "411dffe5c7e35bd6efaf954be4778e86daa5b6d9", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/411dffe5c7e35bd6efaf954be4778e86daa5b6d9", "message": "Review edit JS\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-08-13T13:59:11Z", "type": "commit"}, {"oid": "1c5d1f826fbc30beca18dbd1d8c675b3d4ce29ea", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1c5d1f826fbc30beca18dbd1d8c675b3d4ce29ea", "message": "review edits DL\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-08-13T15:34:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA4Nzk2Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r477087967", "bodyText": "Should we clarify that it's in the Kafka custom resource?", "author": "ppatierno", "createdAt": "2020-08-26T07:23:02Z", "path": "documentation/api/io.strimzi.api.kafka.model.KafkaAuthorizationSimple.adoc", "diffHunk": "@@ -0,0 +1,27 @@\n+Simple authorization in Strimzi uses the `AclAuthorizer` plugin, the default Access Control Lists (ACLs) authorization plugin provided with Apache Kafka.\n+ACLs allow you to define which users have access to which resources at a granular level.\n+\n+To use simple authorization, set the `type` property in the `authorization` section to the value `simple`,\n+and configure super users.", "originalCommit": "1c5d1f826fbc30beca18dbd1d8c675b3d4ce29ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzEzOTQwOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r477139408", "bodyText": "\ud83d\udc4d\n\nConfigure the Kafka custom resource to use simple authorization.\nSet the type property in the authorization section to the value simple,\nand configure a list of super users.", "author": "PaulRMellor", "createdAt": "2020-08-26T08:48:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA4Nzk2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA4NTg5MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r477085891", "bodyText": "The type name is AclRule. But it would be better to avoid using the type name at all because from the point of view of someone wanting the write valid YAML the type name is irrelevant, it's the structure that counts. This point seems to apply to all the description files in this PR.\nFor this specific example:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Use `ACLRule` properties to configure simple authorization for a `KafkaUser`.\n          \n          \n            \n            Configures a access control rule for a `KafkaUser` when brokers are using the `AclAuthorizer`.", "author": "tombentley", "createdAt": "2020-08-26T07:19:03Z", "path": "documentation/api/io.strimzi.api.kafka.model.AclRule.adoc", "diffHunk": "@@ -0,0 +1,93 @@\n+Use `ACLRule` properties to configure simple authorization for a `KafkaUser`.", "originalCommit": "1c5d1f826fbc30beca18dbd1d8c675b3d4ce29ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE1NjUxNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r477156515", "bodyText": "Configures access control rules for a KafkaUser when brokers are using the AclAuthorizer.", "author": "PaulRMellor", "createdAt": "2020-08-26T09:15:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA4NTg5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA4NzQ1NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r477087454", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Use `KafkaClusterSpec` properties to configure Kafka clusters.\n          \n          \n            \n            Configures a Kafka cluster.\n          \n      \n    \n    \n  \n\nor\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Use `KafkaClusterSpec` properties to configure Kafka clusters.\n          \n          \n            \n            The configuration of a Kafka cluster.", "author": "tombentley", "createdAt": "2020-08-26T07:22:04Z", "path": "documentation/api/io.strimzi.api.kafka.model.KafkaClusterSpec.adoc", "diffHunk": "@@ -1,11 +1,30 @@\n-// Module included in the following assemblies:\n-//\n-// assembly-kafka-broker-configuration.adoc\n+Use `KafkaClusterSpec` properties to configure Kafka clusters.", "originalCommit": "1c5d1f826fbc30beca18dbd1d8c675b3d4ce29ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5MTIyMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r477091222", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            .An example of `listeners` property with all listeners enabled\n          \n          \n            \n            .An example of `listeners` property with all listeners enabled, each using their default configuration", "author": "tombentley", "createdAt": "2020-08-26T07:29:00Z", "path": "documentation/api/io.strimzi.api.kafka.model.listener.KafkaListeners.adoc", "diffHunk": "@@ -0,0 +1,40 @@\n+Use `KafkaListeners` properties to configure types of Kafka listener.\n+\n+[id='property-listeners-{context}']\n+.`listeners`\n+You configure Kafka broker listeners using the `listeners` property in the `Kafka.spec.kafka` resource.\n+The `listeners` property contains three sub-properties:\n+\n+* `plain`\n+* `tls`\n+* `external`\n+\n+Each listener will only be defined when the `listeners` object has the given property.\n+\n+.An example of `listeners` property with all listeners enabled", "originalCommit": "1c5d1f826fbc30beca18dbd1d8c675b3d4ce29ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5MTQ4NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r477091484", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            .An example of `listeners` property with only the plain listener enabled\n          \n          \n            \n            .An example of `listeners` property with only the plain listener enabled and using its default configuration", "author": "tombentley", "createdAt": "2020-08-26T07:29:28Z", "path": "documentation/api/io.strimzi.api.kafka.model.listener.KafkaListeners.adoc", "diffHunk": "@@ -0,0 +1,40 @@\n+Use `KafkaListeners` properties to configure types of Kafka listener.\n+\n+[id='property-listeners-{context}']\n+.`listeners`\n+You configure Kafka broker listeners using the `listeners` property in the `Kafka.spec.kafka` resource.\n+The `listeners` property contains three sub-properties:\n+\n+* `plain`\n+* `tls`\n+* `external`\n+\n+Each listener will only be defined when the `listeners` object has the given property.\n+\n+.An example of `listeners` property with all listeners enabled\n+[source,yaml,subs=\"attributes+\"]\n+----\n+# ...\n+listeners:\n+  plain: {}\n+  tls: {}\n+  external:\n+    type: loadbalancer\n+# ...\n+----\n+\n+.An example of `listeners` property with only the plain listener enabled", "originalCommit": "1c5d1f826fbc30beca18dbd1d8c675b3d4ce29ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE2MjQyNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r477162424", "bodyText": "Added a line above both examples:\n\nAn empty object ({}) means the default configuration is used.", "author": "PaulRMellor", "createdAt": "2020-08-26T09:23:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5MTQ4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5MjM1NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r477092355", "bodyText": "Can we link to where that standard order is defined?", "author": "tombentley", "createdAt": "2020-08-26T07:31:04Z", "path": "documentation/api/io.strimzi.api.kafka.model.listener.NodePortListenerConfiguration.adoc", "diffHunk": "@@ -0,0 +1,30 @@\n+Use `NodePortListenerConfiguration` properties to add configuration to external node port listeners.\n+\n+[id='property-nodeport-listener-preferredAddressType-{context}']\n+.`preferredAddressType`\n+\n+Use the `preferredAddressType` property in your listener configuration to specify the first address type checked as the node address.\n+This property is useful, for example, if your deployment does not have DNS support, or you only want to expose a broker internally through an internal DNS or IP address.\n+If an address of this type is found, it is used.\n+If the preferred address type is not found, Strimzi proceeds through the types in the standard order of priority.", "originalCommit": "1c5d1f826fbc30beca18dbd1d8c675b3d4ce29ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE5Nzk5NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r477197994", "bodyText": "Strimzi proceeds through the types in the xref:nodeport-listener-{context}[standard order of priority].", "author": "PaulRMellor", "createdAt": "2020-08-26T10:26:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5MjM1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5NDkwMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r477094900", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              password: Z2VuZXJhdGVkcGFzc3dvcmQ= # Generated password\n          \n          \n            \n              password: Z2VuZXJhdGVkcGFzc3dvcmQ= # The generated password, base64 encoded", "author": "tombentley", "createdAt": "2020-08-26T07:36:04Z", "path": "documentation/modules/con-securing-client-authentication.adoc", "diffHunk": "@@ -0,0 +1,111 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-clients.adoc\n+\n+[id='con-securing-client-authentication-{context}']\n+= User authentication\n+\n+User authentication is configured using the `authentication` property in `KafkaUser.spec`.\n+The authentication mechanism enabled for the user is specified using the `type` field.\n+\n+Supported authentication mechanisms:\n+\n+* TLS client authentication\n+* SCRAM-SHA-512 authentication\n+\n+When no authentication mechanism is specified, the User Operator does not create the user or its credentials.\n+\n+.Additional resources\n+\n+* xref:con-securing-kafka-authentication-{context}[When to use mutual TLS authentication or SCRAM-SHA Authentication authentication for clients]\n+\n+== TLS Client Authentication\n+\n+To use TLS client authentication, you set the `type` field to `tls`.\n+\n+.An example `KafkaUser` with TLS client authentication enabled\n+[source,yaml,subs=\"attributes+\"]\n+----\n+apiVersion: {KafkaUserApiVersion}\n+kind: KafkaUser\n+metadata:\n+  name: my-user\n+  labels:\n+    strimzi.io/cluster: my-cluster\n+spec:\n+  authentication:\n+    type: tls\n+  # ...\n+----\n+\n+When the user is created by the User Operator, it creates a new Secret with the same name as the `KafkaUser` resource.\n+The Secret contains a private and public key for TLS client authentication.\n+The public key is contained in a user certificate, which is signed by the client Certificate Authority (CA).\n+\n+All keys are in X.509 format.\n+\n+Secrets provide private keys and certificates in PEM and PKCS #12 formats.\n+\n+For more information on securing Kafka communication with Secrets, see xref:security-{context}[].\n+\n+.An example `Secret` with user credentials\n+[source,yaml,subs=\"attributes+\"]\n+----\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  name: my-user\n+  labels:\n+    strimzi.io/kind: KafkaUser\n+    strimzi.io/cluster: my-cluster\n+type: Opaque\n+data:\n+  ca.crt: # Public key of the client CA\n+  user.crt: # User certificate that contains the public key of the user\n+  user.key: # Private key of the user\n+  user.p12: # PKCS #12 archive file for storing certificates and keys\n+  user.password: # Password for protecting the PKCS #12 archive file\n+----\n+\n+== SCRAM-SHA-512 Authentication\n+\n+To use the SCRAM-SHA-512 authentication mechanism, you set the `type` field to `scram-sha-512`.\n+\n+.An example `KafkaUser` with SCRAM-SHA-512 authentication enabled\n+[source,yaml,subs=\"attributes+\"]\n+----\n+apiVersion: {KafkaUserApiVersion}\n+kind: KafkaUser\n+metadata:\n+  name: my-user\n+  labels:\n+    strimzi.io/cluster: my-cluster\n+spec:\n+  authentication:\n+    type: scram-sha-512\n+  # ...\n+----\n+\n+When the user is created by the User Operator, it creates a new secret with the same name as the `KafkaUser` resource.\n+The secret contains the generated password in the `password` key, which is encoded with base64.\n+In order to use the password, it must be decoded.\n+\n+.An example `Secret` with user credentials\n+[source,yaml,subs=\"attributes+\"]\n+----\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  name: my-user\n+  labels:\n+    strimzi.io/kind: KafkaUser\n+    strimzi.io/cluster: my-cluster\n+type: Opaque\n+data:\n+  password: Z2VuZXJhdGVkcGFzc3dvcmQ= # Generated password", "originalCommit": "1c5d1f826fbc30beca18dbd1d8c675b3d4ce29ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIwMDU0Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r477200542", "bodyText": "Made into a callout\ndata:\npassword: Z2VuZXJhdGVkcGFzc3dvcmQ= <1>\n ----\n\n\n<1> The generated password, base64 encoded.", "author": "PaulRMellor", "createdAt": "2020-08-26T10:31:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5NDkwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5NjA5Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r477096092", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To use simple authorization, you set the `type` property to `simple` in `KafkaUser.spec`.\n          \n          \n            \n            To use simple authorization, you set the `type` property to `simple` in `KafkaUser.spec.authroization`.", "author": "tombentley", "createdAt": "2020-08-26T07:38:14Z", "path": "documentation/modules/con-securing-client-authorization.adoc", "diffHunk": "@@ -0,0 +1,59 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-clients.adoc\n+\n+[id='con-securing-client-authorization-{context}']\n+= User authorization\n+\n+User authorization is configured using the `authorization` property in `KafkaUser.spec`.\n+The authorization type enabled for a user is specified using the `type` field.\n+\n+If no authorization is specified, the User Operator does not provision any access rights for the user.\n+\n+To use simple authorization, you set the `type` property to `simple` in `KafkaUser.spec`.", "originalCommit": "1c5d1f826fbc30beca18dbd1d8c675b3d4ce29ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5Nzk4Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r477097983", "bodyText": "I feel we need to be explicit about whether  such users get access or not. And that depends on the authoriser. Not completely sure about this suggestion because it brings in the AclAuthoriser before it's really been discussed:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If no authorization is specified, the User Operator does not provision any access rights for the user.\n          \n          \n            \n            If no authorization is specified, the User Operator does not provision any access rights for the user.\n          \n          \n            \n            Whether such a `KafkaUser` can access resources depends on the authorizer being used. For example, for the `AclAuthorizer` this is determined by its `allow.everyone.if.no.acl.found` configuration.", "author": "tombentley", "createdAt": "2020-08-26T07:41:35Z", "path": "documentation/modules/con-securing-client-authorization.adoc", "diffHunk": "@@ -0,0 +1,59 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-securing-kafka-clients.adoc\n+\n+[id='con-securing-client-authorization-{context}']\n+= User authorization\n+\n+User authorization is configured using the `authorization` property in `KafkaUser.spec`.\n+The authorization type enabled for a user is specified using the `type` field.\n+\n+If no authorization is specified, the User Operator does not provision any access rights for the user.", "originalCommit": "1c5d1f826fbc30beca18dbd1d8c675b3d4ce29ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIwMjQ3Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3447#discussion_r477202472", "bodyText": "I've moved it to the bottom of the section, so we've already introduced the options for specifying authorization.", "author": "PaulRMellor", "createdAt": "2020-08-26T10:35:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5Nzk4Mw=="}], "type": "inlineReview"}, {"oid": "965ffef9169d7dbadce2bb5ad9e435d816b35095", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/965ffef9169d7dbadce2bb5ad9e435d816b35095", "message": "Merge branch 'master' into doc-secure-kafka-brokers", "committedDate": "2020-08-26T08:13:13Z", "type": "commit"}, {"oid": "09f1a007af1a9c2c80b2e6827dba69b23209b8d9", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/09f1a007af1a9c2c80b2e6827dba69b23209b8d9", "message": "review edits PP\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-08-26T08:49:44Z", "type": "commit"}, {"oid": "1cbd1ba3464f9bfc7261ff2cda9c7651b8052636", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1cbd1ba3464f9bfc7261ff2cda9c7651b8052636", "message": "review edits TB\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-08-26T10:39:07Z", "type": "commit"}, {"oid": "6be22e36bf6ac7dce53e402a451f93bc38207311", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6be22e36bf6ac7dce53e402a451f93bc38207311", "message": "review edits TB - change schema intros\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-08-26T15:21:26Z", "type": "commit"}]}