{"pr_number": 3897, "pr_title": "Only extra strimzi relevant pod labels", "pr_createdAt": "2020-10-30T00:42:05Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3897", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDk0ODg5NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3897#discussion_r514948895", "bodyText": "I'm not sure if this change was intended or not - but all the other example files use myproject. So I think we should try to keep it.", "author": "scholzj", "createdAt": "2020-10-30T08:51:10Z", "path": "examples/metrics/prometheus-install/strimzi-pod-monitor.yaml", "diffHunk": "@@ -10,7 +10,7 @@ spec:\n       strimzi.io/kind: cluster-operator\n   namespaceSelector:\n     matchNames:\n-      - myproject\n+      - my-project", "originalCommit": "8045546b5a4f5937968ec958070e13685c67b152", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE3NDM5NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3897#discussion_r516174395", "bodyText": "gah this was my mistake. I'll correct it. and update the regex matching as requested below.", "author": "brokenjacobs", "createdAt": "2020-11-02T18:28:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDk0ODg5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDk1NzQyMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3897#discussion_r514957422", "bodyText": "why adding the strimzi_ prefix? the strimzi label matched by the regex should already have it. Doesn't it add the prefix twice? I haven't an installation with Prometheus handy, can you verify?", "author": "ppatierno", "createdAt": "2020-10-30T09:07:56Z", "path": "examples/metrics/prometheus-install/strimzi-pod-monitor.yaml", "diffHunk": "@@ -63,14 +63,14 @@ spec:\n         values: [\"Kafka\", \"KafkaConnect\"]\n   namespaceSelector:\n     matchNames:\n-      - myproject\n+      - my-project\n   podMetricsEndpoints:\n   - path: /metrics\n     port: tcp-prometheus\n     relabelings:\n     - separator: ;\n-      regex: __meta_kubernetes_pod_label_(.+)\n-      replacement: $1\n+      regex: __meta_kubernetes_pod_label_strimzi_(.+)\n+      replacement: strimzi_$1", "originalCommit": "8045546b5a4f5937968ec958070e13685c67b152", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE3MzkxNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3897#discussion_r516173916", "bodyText": "without that the regex matches everything after strimzi_ and your metrics labels all begin with io_ instead of strimzi_io_... $1 references the capture group in the regex between the (). This could be cleaned up by just moving the matching group left parenthesis. I can do that if you think it is necessary.\nEDIT: Did that.", "author": "brokenjacobs", "createdAt": "2020-11-02T18:27:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDk1NzQyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE5MTA3MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3897#discussion_r519191071", "bodyText": "@brokenjacobs any update on this?", "author": "ppatierno", "createdAt": "2020-11-07T15:58:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDk1NzQyMg=="}], "type": "inlineReview"}, {"oid": "8692568a90e4862677cd5c84d2500f4bdce3690e", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/8692568a90e4862677cd5c84d2500f4bdce3690e", "message": "Only extra strimzi relevant pod labels\n\nMany environments have labels on pods with potentially high cardinality that you don't want in your prometheus environment. This changes the podmonitor to only include the strimzi.io labels.\n\nSigned-off-by: sjacobs <sjacobs@battelleecology.org>", "committedDate": "2020-11-02T18:35:04Z", "type": "commit"}, {"oid": "e1cda1e4532016ee2d824342baf8e8e12f5495da", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e1cda1e4532016ee2d824342baf8e8e12f5495da", "message": "Put namespace settings back to the example settings\n\nSigned-off-by: sjacobs <sjacobs@battelleecology.org>", "committedDate": "2020-11-02T18:35:04Z", "type": "commit"}, {"oid": "35d0d92e1ab81c6b27c71406dca06613b6198831", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/35d0d92e1ab81c6b27c71406dca06613b6198831", "message": "changed namespace to myproject. Updated regex to be clearer\n\nSigned-off-by: sjacobs <sjacobs@battelleecology.org>", "committedDate": "2020-11-02T18:35:04Z", "type": "commit"}, {"oid": "35d0d92e1ab81c6b27c71406dca06613b6198831", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/35d0d92e1ab81c6b27c71406dca06613b6198831", "message": "changed namespace to myproject. Updated regex to be clearer\n\nSigned-off-by: sjacobs <sjacobs@battelleecology.org>", "committedDate": "2020-11-02T18:35:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjI1MjM2Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3897#discussion_r516252367", "bodyText": "at this point I would match strimzi_io_.+", "author": "ppatierno", "createdAt": "2020-11-02T21:03:17Z", "path": "examples/metrics/prometheus-install/strimzi-pod-monitor.yaml", "diffHunk": "@@ -69,7 +69,7 @@ spec:\n     port: tcp-prometheus\n     relabelings:\n     - separator: ;\n-      regex: __meta_kubernetes_pod_label_(.+)\n+      regex: __meta_kubernetes_pod_label_(strimzi_.+)", "originalCommit": "35d0d92e1ab81c6b27c71406dca06613b6198831", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d9ee365a64d615af68c2aba600ac8ab7a4f64027", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d9ee365a64d615af68c2aba600ac8ab7a4f64027", "message": "Changed strimzi regex to match strimzi_io_+\n\nSigned-off-by: sjacobs <sjacobs@battelleecology.org>", "committedDate": "2020-11-09T16:27:48Z", "type": "commit"}, {"oid": "d9ee365a64d615af68c2aba600ac8ab7a4f64027", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d9ee365a64d615af68c2aba600ac8ab7a4f64027", "message": "Changed strimzi regex to match strimzi_io_+\n\nSigned-off-by: sjacobs <sjacobs@battelleecology.org>", "committedDate": "2020-11-09T16:27:48Z", "type": "forcePushed"}]}