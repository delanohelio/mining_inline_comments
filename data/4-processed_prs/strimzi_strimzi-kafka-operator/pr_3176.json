{"pr_number": 3176, "pr_title": "[DOC] Create single Using Operators section", "pr_createdAt": "2020-06-09T10:26:12Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3176", "timeline": [{"oid": "ce31907bb42f6bfeed6f13c6d303ba4ab6891a83", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/ce31907bb42f6bfeed6f13c6d303ba4ab6891a83", "message": "[DOC] Create single Using Operators section\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-06-09T10:22:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYzMzEwOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3176#discussion_r437633108", "bodyText": "Should this be ==?", "author": "scholzj", "createdAt": "2020-06-09T18:26:39Z", "path": "documentation/modules/ref-operator-topic.adoc", "diffHunk": "@@ -0,0 +1,107 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-using-the-topic-operator.adoc\n+\n+[id='ref-operator-topic-{context}']\n+= Kafka topic resource\n+\n+The `KafkaTopic` resource is used to configure topics, including the number of partitions and replicas.\n+\n+The full schema for `KafkaTopic` is described in xref:type-KafkaTopic-reference[`KafkaTopic` schema reference].\n+\n+= Identifying a Kafka cluster for topic handling", "originalCommit": "ce31907bb42f6bfeed6f13c6d303ba4ab6891a83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM0MDk4MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3176#discussion_r441340981", "bodyText": "I was looking at it from a TOC point of view. Maybe we can drop some of these sections to a lower level. I'll have another look.", "author": "PaulRMellor", "createdAt": "2020-06-17T07:34:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYzMzEwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYzMzIwNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3176#discussion_r437633206", "bodyText": "Same as above, should this be == ... this seems to be on a lot of places ... not sure if this is right or wrong.", "author": "scholzj", "createdAt": "2020-06-09T18:26:51Z", "path": "documentation/modules/ref-operator-topic.adoc", "diffHunk": "@@ -0,0 +1,107 @@\n+// Module included in the following assemblies:\n+//\n+// assembly-using-the-topic-operator.adoc\n+\n+[id='ref-operator-topic-{context}']\n+= Kafka topic resource\n+\n+The `KafkaTopic` resource is used to configure topics, including the number of partitions and replicas.\n+\n+The full schema for `KafkaTopic` is described in xref:type-KafkaTopic-reference[`KafkaTopic` schema reference].\n+\n+= Identifying a Kafka cluster for topic handling\n+\n+A `KafkaTopic` resource includes a label that defines the appropriate name of the Kafka cluster (derived from the name of the `Kafka` resource) to which it belongs.\n+\n+For example:\n+\n+[source,yaml,subs=\"attributes+\"]\n+----\n+apiVersion: {KafkaApiVersion}\n+kind: KafkaTopic\n+metadata:\n+  name: topic-name-1\n+  labels:\n+    strimzi.io/cluster: my-cluster\n+----\n+\n+The label is used by the Topic Operator to identify the `KafkaTopic` resource and create a new topic, and also in subsequent handling of the topic.\n+\n+If the label does not match the Kafka cluster, the Topic Operator cannot identify the `KafkaTopic` and the topic is not created.\n+\n+= Handling changes to topics", "originalCommit": "ce31907bb42f6bfeed6f13c6d303ba4ab6891a83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM0ODQ2MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3176#discussion_r441348461", "bodyText": "Yeah. I've moved this down a level. I originally left it like that to present these sections in the TOC, but I don't think its necessary.", "author": "PaulRMellor", "createdAt": "2020-06-17T07:47:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYzMzIwNg=="}], "type": "inlineReview"}, {"oid": "2524576ce21ab536d02a2dbd3ef1aab2c0145d71", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2524576ce21ab536d02a2dbd3ef1aab2c0145d71", "message": "review edits JS\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-06-17T07:48:01Z", "type": "commit"}, {"oid": "595981961077f839d9a614307750fa3f609de11d", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/595981961077f839d9a614307750fa3f609de11d", "message": "Merge branch 'master' into doc-consolidate-operator-sections", "committedDate": "2020-06-17T07:51:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzUxNDAxNw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3176#discussion_r447514017", "bodyText": "There is also a service account for KafkaMirrorMaker2 which is called _cluster-name_-mirrormaker2", "author": "ppatierno", "createdAt": "2020-06-30T08:40:30Z", "path": "documentation/modules/ref-operator-cluster.adoc", "diffHunk": "@@ -120,3 +120,134 @@ _<cluster-name>_-kafka-0._<cluster-name>_-kafka-brokers._<namespace>_.svc._clust\n The DNS domain name is added to the Kafka broker certificates used for hostname verification.\n +\n If you are using a different DNS domain name suffix in your cluster, change the `KUBERNETES_SERVICE_DNS_DOMAIN` environment variable from the default to the one you are using in order to establish a connection with the Kafka brokers.\n+\n+== Periodic reconciliation\n+\n+Although the Cluster Operator reacts to all notifications about the desired cluster resources received from the Kubernetes cluster,\n+if the operator is not running, or if a notification is not received for any reason, the desired resources will get out of sync with the state of the running Kubernetes cluster.\n+\n+In order to handle failovers properly, a periodic reconciliation process is executed by the Cluster Operator so that it can compare the state of the desired resources with the current cluster deployments in order to have a consistent state across all of them.\n+You can set the time interval for the periodic reconciliations using the xref:STRIMZI_FULL_RECONCILIATION_INTERVAL_MS[] variable.\n+\n+= Provisioning Role-Based Access Control (RBAC)\n+\n+For the Cluster Operator to function it needs permission within the Kubernetes cluster to interact with resources such as `Kafka`, `KafkaConnect`, and so on, as well as the managed resources, such as `ConfigMaps`, `Pods`, `Deployments`, `StatefulSets` and `Services`.\n+Such permission is described in terms of Kubernetes role-based access control (RBAC) resources:\n+\n+* `ServiceAccount`,\n+* `Role` and `ClusterRole`,\n+* `RoleBinding` and `ClusterRoleBinding`.\n+\n+In addition to running under its own `ServiceAccount` with a `ClusterRoleBinding`, the Cluster Operator manages some RBAC resources for the components that need access to Kubernetes resources.\n+\n+Kubernetes also includes privilege escalation protections that prevent components operating under one `ServiceAccount` from granting other `ServiceAccounts` privileges that the granting `ServiceAccount` does not have.\n+Because the Cluster Operator must be able to create the `ClusterRoleBindings`, and `RoleBindings` needed by resources it manages, the Cluster Operator must also have those same privileges.\n+\n+[id='delegated-privileges-{context}']\n+== Delegated privileges\n+\n+When the Cluster Operator deploys resources for a desired `Kafka` resource it also creates `ServiceAccounts`, `RoleBindings`, and `ClusterRoleBindings`, as follows:\n+\n+* The Kafka broker pods use a `ServiceAccount` called `_cluster-name_-kafka`\n+  - When the rack feature is used, the `strimzi-_cluster-name_-kafka-init` `ClusterRoleBinding` is used to grant this `ServiceAccount` access to the nodes within the cluster via a `ClusterRole` called `strimzi-kafka-broker`\n+  - When the rack feature is not used no binding is created\n+* The ZooKeeper pods use a `ServiceAccount` called `_cluster-name_-zookeeper`\n+* The Entity Operator pod uses a `ServiceAccount` called `_cluster-name_-entity-operator`\n+    - The Topic Operator produces Kubernetes events with status information, so the `ServiceAccount` is bound to a `ClusterRole` called `strimzi-entity-operator` which grants this access via the `strimzi-entity-operator` `RoleBinding`\n+* The pods for `KafkaConnect` and `KafkaConnectS2I` resources use a `ServiceAccount` called `_cluster-name_-cluster-connect`\n+* The pods for `KafkaMirrorMaker` use a `ServiceAccount` called `_cluster-name_-mirror-maker`\n+* The pods for `KafkaBridge` use a `ServiceAccount` called `_cluster-name_-bridge`", "originalCommit": "595981961077f839d9a614307750fa3f609de11d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU3NzMwNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3176#discussion_r447577305", "bodyText": "Added The pods for KafkaMirrorMaker2 use a ServiceAccount called _cluster-name_-mirrormaker2", "author": "PaulRMellor", "createdAt": "2020-06-30T10:22:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzUxNDAxNw=="}], "type": "inlineReview"}, {"oid": "6014332af58fc3b6985831621979f24bd225a991", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6014332af58fc3b6985831621979f24bd225a991", "message": "review edits PP\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-06-30T10:27:42Z", "type": "commit"}]}