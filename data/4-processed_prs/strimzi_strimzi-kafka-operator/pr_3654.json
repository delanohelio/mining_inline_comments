{"pr_number": 3654, "pr_title": "[DOC] upgrade update to describe switch to generic listener config", "pr_createdAt": "2020-09-15T16:41:32Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654", "timeline": [{"oid": "816158ca79a095474cee39c8314872aae5aa0481", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/816158ca79a095474cee39c8314872aae5aa0481", "message": "[DOC] upgrade update to describe switch to generic listener config\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-09-15T16:39:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwNTkzMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654#discussion_r488905932", "bodyText": "After the upgrade would be better I guess since it gives the reader a clear time window.", "author": "scholzj", "createdAt": "2020-09-15T19:13:28Z", "path": "documentation/modules/upgrading/con-upgrade-listeners.adoc", "diffHunk": "@@ -0,0 +1,63 @@\n+// This module is included in the following assemblies:\n+//\n+// upgrading/assembly_upgrade-kafka-versions.adoc\n+\n+[id='con-upgrade-listeners-{context}']\n+= Updating listener configuration\n+\n+Strimzi provides a `GenericKafkaListener` schema for the configuration of Kafka listeners in a `Kafka` resource.\n+\n+`GenericKafkaListener` replaces the `KafkaListeners` schema, which is deprecated.\n+\n+The `GenericKafkaListener` schema is backwards compatible.\n+\n+With the `GenericKafkaListener` schema, you can configure as many listeners as required,\n+as long as their names and ports are unique.\n+The listener configuration is defined as an array.\n+\n+For clients inside the Kubernetes cluster, you can create `plain` (without encryption) or `tls` _internal_ listeners.\n+\n+For clients outside the Kubernetes cluster, you create _external_ listeners and specify a connection mechanism,\n+which can be `nodeport`, `loadbalancer`, `ingress` or `route`.\n+\n+The `KafkaListeners` schema uses sub-properties for `plain`, `tls` and `external` listeners, with fixed ports for each.\n+As part of your upgrade, you can convert listeners configured using the `KafkaListeners` schema into the format of the `GenericKafkaListener` schema.", "originalCommit": "816158ca79a095474cee39c8314872aae5aa0481", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI1NjM4NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654#discussion_r490256384", "bodyText": "Changed to: After the Kafka upgrade", "author": "PaulRMellor", "createdAt": "2020-09-17T13:42:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwNTkzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwODQ2MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654#discussion_r488908461", "bodyText": "Can we please stress out two points:\n\nThe name and port numbers here are really important for the backwards compatibility. Using other names will possibly result in differently named listeners in Kafka or services in Kubernetes which will cause problems.\nThe options in configuration or overrides of the old listeners need to be adjusted into the new configuration format", "author": "scholzj", "createdAt": "2020-09-15T19:18:23Z", "path": "documentation/modules/upgrading/con-upgrade-listeners.adoc", "diffHunk": "@@ -0,0 +1,63 @@\n+// This module is included in the following assemblies:\n+//\n+// upgrading/assembly_upgrade-kafka-versions.adoc\n+\n+[id='con-upgrade-listeners-{context}']\n+= Updating listener configuration\n+\n+Strimzi provides a `GenericKafkaListener` schema for the configuration of Kafka listeners in a `Kafka` resource.\n+\n+`GenericKafkaListener` replaces the `KafkaListeners` schema, which is deprecated.\n+\n+The `GenericKafkaListener` schema is backwards compatible.\n+\n+With the `GenericKafkaListener` schema, you can configure as many listeners as required,\n+as long as their names and ports are unique.\n+The listener configuration is defined as an array.\n+\n+For clients inside the Kubernetes cluster, you can create `plain` (without encryption) or `tls` _internal_ listeners.\n+\n+For clients outside the Kubernetes cluster, you create _external_ listeners and specify a connection mechanism,\n+which can be `nodeport`, `loadbalancer`, `ingress` or `route`.\n+\n+The `KafkaListeners` schema uses sub-properties for `plain`, `tls` and `external` listeners, with fixed ports for each.\n+As part of your upgrade, you can convert listeners configured using the `KafkaListeners` schema into the format of the `GenericKafkaListener` schema.\n+\n+For example, if you are currently using the following configuration in your `Kafka` configuration:\n+\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+listeners:\n+  plain:\n+    # ...\n+  tls:\n+    # ...\n+  external:\n+    type: loadbalancer\n+    # ...\n+----\n+\n+Convert the listeners into the new format using:", "originalCommit": "816158ca79a095474cee39c8314872aae5aa0481", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMwNDQ2OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654#discussion_r490304468", "bodyText": "Updated. I thought it might be useful to add some more details of the change too.\nSo:\n\nMake sure to use the the exact names and port numbers shown.\nFor any additional configuration or overrides properties used with the old format, you need to update them to the new format.\nChanges introduced to the listener configuration:\n\noverrides is merged with the configuration section\ndnsAnnotations has been renamed annotations\npreferredAddressType has been renamed preferredNodePortAddressType\naddress has been renamed alternativenames\nloadBalancerSourceRanges and externalTrafficPolicy move to the listener configuration from the now deprecated template\n\nFor example, this configuration:\n.Old additional listener configuration\n----\nlisteners:\n  external:\n    type: loadbalancer\n    authentication:\n      type: tls\n    overrides:\n      bootstrap:\n        dnsAnnotations:\n          #...\n\nChanges to:\n.New additional listener configuration\n----\nlisteners:\n    #...\n  - name: external\n    port: 9094\n    type:loadbalancer\n    tls: true\n    configuration:\n      bootstrap:\n        annotations:\n          #...\n\nIMPORTANT: The name and port numbers shown in the new configuration must be used for backwards compatibility.\nUsing any other values will cause problems with the naming of Kafka listeners and Kubernetes services.", "author": "PaulRMellor", "createdAt": "2020-09-17T14:42:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwODQ2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwODYxMw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654#discussion_r488908613", "bodyText": "I don't think this is really true. The listeners field supports both the old deprecated form and the new array form. would be a better way to put it.", "author": "scholzj", "createdAt": "2020-09-15T19:18:40Z", "path": "documentation/modules/upgrading/con-upgrade-listeners.adoc", "diffHunk": "@@ -0,0 +1,63 @@\n+// This module is included in the following assemblies:\n+//\n+// upgrading/assembly_upgrade-kafka-versions.adoc\n+\n+[id='con-upgrade-listeners-{context}']\n+= Updating listener configuration\n+\n+Strimzi provides a `GenericKafkaListener` schema for the configuration of Kafka listeners in a `Kafka` resource.\n+\n+`GenericKafkaListener` replaces the `KafkaListeners` schema, which is deprecated.\n+\n+The `GenericKafkaListener` schema is backwards compatible.", "originalCommit": "816158ca79a095474cee39c8314872aae5aa0481", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMyMDU3Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654#discussion_r490320572", "bodyText": "Changed and moved into the next paragraph:\n\nWith the GenericKafkaListener schema, you can configure as many listeners as required,\nas long as their names and ports are unique. The listeners configuration is defined as an array, but the deprecated format is also supported.", "author": "PaulRMellor", "createdAt": "2020-09-17T14:57:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwODYxMw=="}], "type": "inlineReview"}, {"oid": "1cde793188e7a77e5ce756f403ff0a53e02e0b84", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/1cde793188e7a77e5ce756f403ff0a53e02e0b84", "message": "review edits JS\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-09-17T15:21:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDUwMDA1OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654#discussion_r490500058", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Using any other values will cause problems with the naming of Kafka listeners and Kubernetes services.\n          \n          \n            \n            Using any other values will cause renaming of Kafka listeners and Kubernetes services.", "author": "scholzj", "createdAt": "2020-09-17T19:23:13Z", "path": "documentation/modules/upgrading/con-upgrade-listeners.adoc", "diffHunk": "@@ -0,0 +1,111 @@\n+// This module is included in the following assemblies:\n+//\n+// upgrading/assembly_upgrade-kafka-versions.adoc\n+\n+[id='con-upgrade-listeners-{context}']\n+= Updating listener configuration\n+\n+Strimzi provides a `GenericKafkaListener` schema for the configuration of Kafka listeners in a `Kafka` resource.\n+\n+`GenericKafkaListener` replaces the `KafkaListeners` schema, which is deprecated.\n+\n+With the `GenericKafkaListener` schema, you can configure as many listeners as required,\n+as long as their names and ports are unique.\n+The `listeners` configuration is defined as an array, but the deprecated format is also supported.\n+\n+For clients inside the Kubernetes cluster, you can create `plain` (without encryption) or `tls` _internal_ listeners.\n+\n+For clients outside the Kubernetes cluster, you create _external_ listeners and specify a connection mechanism,\n+which can be `nodeport`, `loadbalancer`, `ingress` or `route`.\n+\n+The `KafkaListeners` schema uses sub-properties for `plain`, `tls` and `external` listeners, with fixed ports for each.\n+After the Kafka upgrade, you can convert listeners configured using the `KafkaListeners` schema into the format of the `GenericKafkaListener` schema.\n+\n+For example, if you are currently using the following configuration in your `Kafka` configuration:\n+\n+.Old listener configuration\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+listeners:\n+  plain:\n+    # ...\n+  tls:\n+    # ...\n+  external:\n+    type: loadbalancer\n+    # ...\n+----\n+\n+Convert the listeners into the new format using:\n+\n+.New listener configuration\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+listeners:\n+  #...\n+  - name: plain\n+    port: 9092\n+    type: internal\n+    tls: false <1>\n+  - name: tls\n+    port: 9093\n+    type: internal\n+    tls: true\n+  - name: external\n+    port: 9094\n+    type: _EXTERNAL-LISTENER-TYPE_ <2>\n+    tls: true\n+----\n+<1> The TLS property is now required for all listeners.\n+<2> Options: `ingress`, `loadbalancer`, `nodeport`, `route`.\n+\n+Make sure to use the the *exact* names and port numbers shown.\n+\n+For any additional `configuration` or `overrides` properties used with the old format, you need to update them to the new format.\n+\n+Changes introduced to the listener `configuration`:\n+\n+* `overrides` is merged with the `configuration` section\n+* `dnsAnnotations` has been renamed `annotations`\n+* `preferredAddressType` has been renamed `preferredNodePortAddressType`\n+* `address` has been renamed `alternativenames`\n+* `loadBalancerSourceRanges` and `externalTrafficPolicy` move to the listener configuration from the now deprecated `template`\n+\n+For example, this configuration:\n+\n+.Old additional listener configuration\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+listeners:\n+  external:\n+    type: loadbalancer\n+    authentication:\n+      type: tls\n+    overrides:\n+      bootstrap:\n+        dnsAnnotations:\n+          #...\n+----\n+\n+Changes to:\n+\n+.New additional listener configuration\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+listeners:\n+    #...\n+  - name: external\n+    port: 9094\n+    type:loadbalancer\n+    tls: true\n+    configuration:\n+      bootstrap:\n+        annotations:\n+          #...\n+----\n+\n+IMPORTANT: The name and port numbers shown in the new listener configuration *must* be used for backwards compatibility.\n+Using any other values will cause problems with the naming of Kafka listeners and Kubernetes services.", "originalCommit": "1cde793188e7a77e5ce756f403ff0a53e02e0b84", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDUwMDYyOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654#discussion_r490500628", "bodyText": "Just to make it more clear and identical with the old example above.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            listeners:\n          \n          \n            \n                #...\n          \n          \n            \n              - name: external\n          \n          \n            \n                port: 9094\n          \n          \n            \n                type:loadbalancer\n          \n          \n            \n                tls: true\n          \n          \n            \n                configuration:\n          \n          \n            \n                  bootstrap:\n          \n          \n            \n                    annotations:\n          \n          \n            \n                      #...\n          \n          \n            \n            listeners:\n          \n          \n            \n                #...\n          \n          \n            \n              - name: external\n          \n          \n            \n                port: 9094\n          \n          \n            \n                type:loadbalancer\n          \n          \n            \n                tls: true\n          \n          \n            \n                authentication:\n          \n          \n            \n                  type: tls\n          \n          \n            \n                configuration:\n          \n          \n            \n                  bootstrap:\n          \n          \n            \n                    annotations:\n          \n          \n            \n                      #...", "author": "scholzj", "createdAt": "2020-09-17T19:23:53Z", "path": "documentation/modules/upgrading/con-upgrade-listeners.adoc", "diffHunk": "@@ -0,0 +1,111 @@\n+// This module is included in the following assemblies:\n+//\n+// upgrading/assembly_upgrade-kafka-versions.adoc\n+\n+[id='con-upgrade-listeners-{context}']\n+= Updating listener configuration\n+\n+Strimzi provides a `GenericKafkaListener` schema for the configuration of Kafka listeners in a `Kafka` resource.\n+\n+`GenericKafkaListener` replaces the `KafkaListeners` schema, which is deprecated.\n+\n+With the `GenericKafkaListener` schema, you can configure as many listeners as required,\n+as long as their names and ports are unique.\n+The `listeners` configuration is defined as an array, but the deprecated format is also supported.\n+\n+For clients inside the Kubernetes cluster, you can create `plain` (without encryption) or `tls` _internal_ listeners.\n+\n+For clients outside the Kubernetes cluster, you create _external_ listeners and specify a connection mechanism,\n+which can be `nodeport`, `loadbalancer`, `ingress` or `route`.\n+\n+The `KafkaListeners` schema uses sub-properties for `plain`, `tls` and `external` listeners, with fixed ports for each.\n+After the Kafka upgrade, you can convert listeners configured using the `KafkaListeners` schema into the format of the `GenericKafkaListener` schema.\n+\n+For example, if you are currently using the following configuration in your `Kafka` configuration:\n+\n+.Old listener configuration\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+listeners:\n+  plain:\n+    # ...\n+  tls:\n+    # ...\n+  external:\n+    type: loadbalancer\n+    # ...\n+----\n+\n+Convert the listeners into the new format using:\n+\n+.New listener configuration\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+listeners:\n+  #...\n+  - name: plain\n+    port: 9092\n+    type: internal\n+    tls: false <1>\n+  - name: tls\n+    port: 9093\n+    type: internal\n+    tls: true\n+  - name: external\n+    port: 9094\n+    type: _EXTERNAL-LISTENER-TYPE_ <2>\n+    tls: true\n+----\n+<1> The TLS property is now required for all listeners.\n+<2> Options: `ingress`, `loadbalancer`, `nodeport`, `route`.\n+\n+Make sure to use the the *exact* names and port numbers shown.\n+\n+For any additional `configuration` or `overrides` properties used with the old format, you need to update them to the new format.\n+\n+Changes introduced to the listener `configuration`:\n+\n+* `overrides` is merged with the `configuration` section\n+* `dnsAnnotations` has been renamed `annotations`\n+* `preferredAddressType` has been renamed `preferredNodePortAddressType`\n+* `address` has been renamed `alternativenames`\n+* `loadBalancerSourceRanges` and `externalTrafficPolicy` move to the listener configuration from the now deprecated `template`\n+\n+For example, this configuration:\n+\n+.Old additional listener configuration\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+listeners:\n+  external:\n+    type: loadbalancer\n+    authentication:\n+      type: tls\n+    overrides:\n+      bootstrap:\n+        dnsAnnotations:\n+          #...\n+----\n+\n+Changes to:\n+\n+.New additional listener configuration\n+[source,shell,subs=\"+quotes,attributes\"]\n+----\n+listeners:\n+    #...\n+  - name: external\n+    port: 9094\n+    type:loadbalancer\n+    tls: true\n+    configuration:\n+      bootstrap:\n+        annotations:\n+          #...", "originalCommit": "1cde793188e7a77e5ce756f403ff0a53e02e0b84", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk2NjYyNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3654#discussion_r490966626", "bodyText": "Thanks. Missed that.", "author": "PaulRMellor", "createdAt": "2020-09-18T13:55:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDUwMDYyOA=="}], "type": "inlineReview"}, {"oid": "0836b57e286e1e0c22c0db4d55140ff95ddc8e81", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/0836b57e286e1e0c22c0db4d55140ff95ddc8e81", "message": "review edits JS + overview update\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-09-18T14:13:15Z", "type": "commit"}]}