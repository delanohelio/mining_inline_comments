{"pr_number": 3275, "pr_title": "Add option to exclude topics from a rebalance", "pr_createdAt": "2020-07-02T09:53:55Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3275", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwNDg5MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3275#discussion_r448904891", "bodyText": "it's \"excludedTopics\" here but then it's declared as \"excludedTopicRegex\" in the CRD.", "author": "ppatierno", "createdAt": "2020-07-02T10:27:30Z", "path": "api/src/main/java/io/strimzi/api/kafka/model/KafkaRebalanceSpec.java", "diffHunk": "@@ -22,7 +22,7 @@\n         builderPackage = Constants.FABRIC8_KUBERNETES_API\n )\n @JsonInclude(JsonInclude.Include.NON_NULL)\n-@JsonPropertyOrder({ \"goals\", \"skipHardGoalCheck\", \"concurrentPartitionMovementsPerBroker\",\n+@JsonPropertyOrder({ \"goals\", \"skipHardGoalCheck\", \"excludedTopics\", \"concurrentPartitionMovementsPerBroker\",", "originalCommit": "0510d6faa9e4e930e1bdc240b8cd3eb371ae9ddb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwNjI1Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3275#discussion_r448906256", "bodyText": "I would use just \"excludedTopics\". We have documentation for explaining that it's a regex. The same applies to some other places where whitelist/blacklist is used (see Mirror Maker)", "author": "ppatierno", "createdAt": "2020-07-02T10:30:10Z", "path": "api/src/main/java/io/strimzi/api/kafka/model/KafkaRebalanceSpec.java", "diffHunk": "@@ -33,6 +33,9 @@\n     private List<String> goals;\n     private boolean skipHardGoalCheck;\n \n+    // Topic configuration\n+    private String excludedTopicsRegex;", "originalCommit": "0510d6faa9e4e930e1bdc240b8cd3eb371ae9ddb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAwMDEyMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3275#discussion_r449000120", "bodyText": "Ok I will refactor it to excludedTopics", "author": "tomncooper", "createdAt": "2020-07-02T13:26:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwNjI1Ng=="}], "type": "inlineReview"}, {"oid": "875a67b8b81e9c4663fcfec87806e5a2aaf91fcd", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/875a67b8b81e9c4663fcfec87806e5a2aaf91fcd", "message": "Added option to exclude topics from a rebalance\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-07-02T13:36:20Z", "type": "forcePushed"}, {"oid": "0c52637e513a5a5e272ac426334193826d9f0abe", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/0c52637e513a5a5e272ac426334193826d9f0abe", "message": "Added option to exclude topics from a rebalance\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-07-02T15:39:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI1NDMyOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3275#discussion_r449254328", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            - Added performance tuning options to the `KafkaRebalance` CR and the ability to define a regular expression that will exclude matching topics from a rebalance optimization proposal.\n          \n          \n            \n            * Added performance tuning options to the `KafkaRebalance` CR and the ability to define a regular expression that will exclude matching topics from a rebalance optimization proposal.", "author": "scholzj", "createdAt": "2020-07-02T20:37:09Z", "path": "CHANGELOG.md", "diffHunk": "@@ -16,6 +16,7 @@\n * Removed the need to manually create Cruise Control metrics topics if topic auto creation is disabled.\n * Migration to Helm 3\n * Refactored the format of the `KafkaRebalance` resource's status. The state of the rebalance is now displayed in the associated `Condition`'s `type` field rather than the `status` field. This was done so that the information would display correctly in various Kubernetes tools.\n+- Added performance tuning options to the `KafkaRebalance` CR and the ability to define a regular expression that will exclude matching topics from a rebalance optimization proposal.", "originalCommit": "0c52637e513a5a5e272ac426334193826d9f0abe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4b868de87095f54c24f4fc84020bc2a83382ddda", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/4b868de87095f54c24f4fc84020bc2a83382ddda", "message": "Added option to exclude topics from a rebalance\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-07-03T09:25:52Z", "type": "forcePushed"}, {"oid": "2269d5fbf573eeade80a6cdaf0605cb0cd806950", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2269d5fbf573eeade80a6cdaf0605cb0cd806950", "message": "Added option to exclude topics from a rebalance\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-07-03T13:18:09Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU4NzgwNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3275#discussion_r449587806", "bodyText": "Suggested rewording:\nA regular expression that specifies topics to exclude from replica movements in optimization proposals calculated by Cruise Control. excludedTopics is parsed by the java.util.regex.Pattern class; for more information on the supported regex format, see the documentation for that class.", "author": "laidan6000", "createdAt": "2020-07-03T13:36:55Z", "path": "documentation/modules/appendix_crds.adoc", "diffHunk": "@@ -2931,6 +2931,8 @@ Used in: xref:type-KafkaRebalance-{context}[`KafkaRebalance`]\n |string array\n |skipHardGoalCheck                        1.2+<.<|Whether to allow the hard goals specified in the Kafka CR to be skipped in rebalance proposal generation. This can be useful when some of those hard goals are preventing a balance solution being found. Default is false.\n |boolean\n+|excludedTopics                           1.2+<.<|A regular expression to specify topics that should not be considered for replica movement. This will be parsed by the java.util.regex.Pattern class, so consult the documentation for that class for more details on the supported regex format.", "originalCommit": "2269d5fbf573eeade80a6cdaf0605cb0cd806950", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU4ODkzMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3275#discussion_r449588931", "bodyText": "Perhaps you could update \"rebalance proposal\" to \"optimization proposal\" throughout the Cruise Control API documentation?", "author": "laidan6000", "createdAt": "2020-07-03T13:39:31Z", "path": "documentation/modules/appendix_crds.adoc", "diffHunk": "@@ -2931,6 +2931,8 @@ Used in: xref:type-KafkaRebalance-{context}[`KafkaRebalance`]\n |string array\n |skipHardGoalCheck                        1.2+<.<|Whether to allow the hard goals specified in the Kafka CR to be skipped in rebalance proposal generation. This can be useful when some of those hard goals are preventing a balance solution being found. Default is false.", "originalCommit": "2269d5fbf573eeade80a6cdaf0605cb0cd806950", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU5NDk2Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3275#discussion_r449594967", "bodyText": "I think we should avoid the lengthy resource strings. Suggested rewording:\nexcludedTopics | If you specified a regular expression in the spec.excludedTopicsRegex property in the KafkaRebalance resource, all topic names matching the regex are listed. These topics are excluded from the calculation of partition replica movements in the optimization proposal.", "author": "laidan6000", "createdAt": "2020-07-03T13:53:26Z", "path": "documentation/modules/cruise-control/con-optimization-proposals.adoc", "diffHunk": "@@ -80,7 +80,7 @@ m\u00a6monitoredPartitionsPercentage\n \u00a6The percentage of partitions in the Kafka cluster covered by the optimization proposal. Affected by the number of `excludedTopics`.\n \n m\u00a6excludedTopics\n-\u00a6Not yet supported. An empty list is returned.\n+\u00a6If you have specified a regular expression in `KafkaRebalance.spec.excludedTopicsRegex` then those topics matching that regular expression will be listed here.", "originalCommit": "2269d5fbf573eeade80a6cdaf0605cb0cd806950", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a0b814bb311dbee55af93821439e1080e1a70256", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/a0b814bb311dbee55af93821439e1080e1a70256", "message": "Added option to exclude topics from a rebalance\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-07-03T15:38:16Z", "type": "forcePushed"}, {"oid": "3d1f7be6a0ac63fa9f0c89cdb98b19ba31d0e106", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3d1f7be6a0ac63fa9f0c89cdb98b19ba31d0e106", "message": "Added option to exclude topics from a rebalance\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-07-21T10:15:35Z", "type": "commit"}, {"oid": "3d1f7be6a0ac63fa9f0c89cdb98b19ba31d0e106", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3d1f7be6a0ac63fa9f0c89cdb98b19ba31d0e106", "message": "Added option to exclude topics from a rebalance\n\nSigned-off-by: Thomas Cooper <tcooper@redhat.com>", "committedDate": "2020-07-21T10:15:35Z", "type": "forcePushed"}]}