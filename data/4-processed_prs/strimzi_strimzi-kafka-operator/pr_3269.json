{"pr_number": 3269, "pr_title": "[DOC] Update of grafana sections", "pr_createdAt": "2020-07-01T13:31:15Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3269", "timeline": [{"oid": "aaa2dc705aba046f3b2b6d258ef4f854be6e2c4f", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/aaa2dc705aba046f3b2b6d258ef4f854be6e2c4f", "message": "update of grafana sections\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-07-01T13:21:26Z", "type": "commit"}, {"oid": "c35b6e2582490d3750c3a1e861f45c48dd1fec10", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c35b6e2582490d3750c3a1e861f45c48dd1fec10", "message": "Make securitycontext option clearer for prometheus\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-07-01T14:51:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ0MjU2Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3269#discussion_r448442562", "bodyText": "Use bold to refer to a UI element.", "author": "laidan6000", "createdAt": "2020-07-01T15:26:42Z", "path": "documentation/modules/metrics/kafka-exporter/proc_kafka-exporter-enabling-grafana.adoc", "diffHunk": "@@ -23,20 +24,29 @@ If you are accessing the user interface for the first time, see xref:assembly-me\n \n .Procedure\n \n-. Access the Grafana user interface.\n+. xref:proc-metrics-grafana-dashboard-{context}[Access the Grafana user interface].\n \n-. Click *Dashboards*, then *Import* to open the _Import Dashboard_ window and import the example Kafka Exporter dashboard (or paste the JSON).\n+. Select the _Strimzi Kafka Exporter_ dashboard.", "originalCommit": "c35b6e2582490d3750c3a1e861f45c48dd1fec10", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ0MzA1Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3269#discussion_r448443053", "bodyText": "Is the repeated colon meant to be here?", "author": "laidan6000", "createdAt": "2020-07-01T15:27:23Z", "path": "documentation/modules/metrics/kafka-exporter/proc_kafka-exporter-enabling-grafana.adoc", "diffHunk": "@@ -23,20 +24,29 @@ If you are accessing the user interface for the first time, see xref:assembly-me\n \n .Procedure\n \n-. Access the Grafana user interface.\n+. xref:proc-metrics-grafana-dashboard-{context}[Access the Grafana user interface].\n \n-. Click *Dashboards*, then *Import* to open the _Import Dashboard_ window and import the example Kafka Exporter dashboard (or paste the JSON).\n+. Select the _Strimzi Kafka Exporter_ dashboard.\n +\n When metrics data has been collected for some time, the Kafka Exporter charts are populated.\n \n-.Kafka Exporter Grafana charts\n-\n-From the metrics, you can create charts to display:\n-\n-* Message in per second (from topics)\n-* Message in per minute (from topics)\n+Strimzi Kafka Exporter:: Shows metrics for:", "originalCommit": "c35b6e2582490d3750c3a1e861f45c48dd1fec10", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAxNzE0OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3269#discussion_r449017149", "bodyText": "Yes.", "author": "PaulRMellor", "createdAt": "2020-07-02T13:51:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ0MzA1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ0NzUwNw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3269#discussion_r448447507", "bodyText": "may > might", "author": "laidan6000", "createdAt": "2020-07-01T15:34:06Z", "path": "documentation/modules/metrics/proc_metrics-grafana-dashboard.adoc", "diffHunk": "@@ -6,53 +6,159 @@\n \n = Enabling the example Grafana dashboards\n \n-Set up a Prometheus data source and example dashboards to enable Grafana for monitoring.\n+Strimzi provides xref:ref-metrics-config-files-{context}[example dashboard configuration files for Grafana].\n+Example dashboards are provided in the `examples/metrics` directory as JSON files:\n \n-NOTE: No alert notification rules are defined.\n+* `strimzi-kafka.json`\n+* `strimzi-zookeeper.json`\n+* `strimzi-kafka-connect.json`\n+* `strimzi-kafka-mirror-maker-2.json`\n+* `strimzi-operators.json`\n \n-When accessing a dashboard, you can use the `port-forward` command to forward traffic from the Grafana pod to the host.\n+The example dashboards are a good starting point for monitoring key metrics, but they do not represent all available metrics.\n+You may need to modify the example dashboards or add other metrics, depending on your infrastructure.", "originalCommit": "c35b6e2582490d3750c3a1e861f45c48dd1fec10", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ0OTk3MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3269#discussion_r448449971", "bodyText": "Are the menu and btn tags definitely rendered in the Strimzi docs?", "author": "laidan6000", "createdAt": "2020-07-01T15:37:56Z", "path": "documentation/modules/metrics/proc_metrics-grafana-dashboard.adoc", "diffHunk": "@@ -6,53 +6,159 @@\n \n = Enabling the example Grafana dashboards\n \n-Set up a Prometheus data source and example dashboards to enable Grafana for monitoring.\n+Strimzi provides xref:ref-metrics-config-files-{context}[example dashboard configuration files for Grafana].\n+Example dashboards are provided in the `examples/metrics` directory as JSON files:\n \n-NOTE: No alert notification rules are defined.\n+* `strimzi-kafka.json`\n+* `strimzi-zookeeper.json`\n+* `strimzi-kafka-connect.json`\n+* `strimzi-kafka-mirror-maker-2.json`\n+* `strimzi-operators.json`\n \n-When accessing a dashboard, you can use the `port-forward` command to forward traffic from the Grafana pod to the host.\n+The example dashboards are a good starting point for monitoring key metrics, but they do not represent all available metrics.\n+You may need to modify the example dashboards or add other metrics, depending on your infrastructure.\n \n-For example, you can access the Grafana user interface by:\n+After setting up Prometheus and Grafana, you can visualize the Strimzi data on the Grafana dashboards.\n \n-. Running `kubectl port-forward svc/grafana 3000:3000`\n-. Pointing a browser to `http://localhost:3000`\n+NOTE: No alert notification rules are defined.\n+\n+When accessing a dashboard, you can use the `port-forward` command to forward traffic from the Grafana pod to the host.\n \n NOTE: The name of the Grafana pod is different for each user.\n \n .Procedure\n \n-. Access the Grafana user interface using `admin/admin` credentials.\n+. Get the details of the Grafana service:\n++\n+[source,shell]\n+----\n+kubectl get service grafana\n+----\n+\n++\n+For example:\n++\n+[table,stripes=none]\n+|===\n+|NAME     |TYPE      |CLUSTER-IP    |PORT(S)\n+\n+|grafana  |ClusterIP |172.30.123.40 |80/TCP\n+|===\n++\n+Note the port number for port forwarding.\n+\n+. Use `port-forward` to redirect the Grafana user interface to `localhost:3000`:\n++\n+[source,shell]\n+----\n+kubectl port-forward svc/grafana 3000:80\n+----\n +\n-On the initial view choose to reset the password.\n+NOTE: If using the OpenShift web console, you can switch to menu:Networking[Routes], and click the URL for the `grafana` Route.\n+\n+. Point a web browser to `http://localhost:3000`.\n +\n-image::grafana_login.png[Grafana login]\n+The Grafana Log In page appears.\n \n-. Click the *Add data source* button.\n+. Enter your user name and password, and then click btn:[Log In].\n +\n-image::grafana_home.png[Grafana home]\n+The default Grafana user name and password are both `admin`. After logging in for the first time, you can change the password.\n \n-. Add Prometheus as a data source.\n+. Add Prometheus as a _data source_.\n +\n * Specify a name\n * Add _Prometheus_ as the type\n-* Specify the connection string to the Prometheus server (http://prometheus-operated:9090) in the URL field\n-\n-. Click *Add* to test the connection to the data source.\n+* Specify a Prometheus server URL (http://prometheus-operated:9090)\n++\n+Save and test the connection when you have added the details.\n +\n image::grafana_prometheus_data_source.png[Add Prometheus data source]\n \n-. Click *Dashboards*, then *Import* to open the _Import Dashboard_ window and import the example dashboards (or paste the JSON).\n+. From menu:Dashboards[Import], upload the example dashboards or paste the JSON directly.", "originalCommit": "c35b6e2582490d3750c3a1e861f45c48dd1fec10", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAyNjUzMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3269#discussion_r449026530", "bodyText": "Good point. I built with asciidoctor and ccutil and seems okay. If they don't come out okay, I'll adjust", "author": "PaulRMellor", "createdAt": "2020-07-02T14:05:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ0OTk3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU1Mzg2Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3269#discussion_r448553862", "bodyText": "Maybe we should make it more clear that this is just one of the options and users should feel free to use their own Grafana installations?", "author": "scholzj", "createdAt": "2020-07-01T18:49:32Z", "path": "documentation/modules/metrics/proc_metrics-deploying-grafana.adoc", "diffHunk": "@@ -6,7 +6,7 @@\n \n = Deploying Grafana\n \n-To deploy Grafana to provide visualizations of Prometheus metrics, apply the xref:ref-metrics-config-files-{context}[example configuration file].\n+To deploy Grafana to provide visualizations of Prometheus metrics, apply the `grafana.yaml` file provided in the `examples/metrics` directory.", "originalCommit": "c35b6e2582490d3750c3a1e861f45c48dd1fec10", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg4NDAxOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3269#discussion_r448884018", "bodyText": "Which should be the same for the Prometheus installation as well.", "author": "ppatierno", "createdAt": "2020-07-02T09:49:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU1Mzg2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA1Mjc2MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3269#discussion_r449052761", "bodyText": "To provide visualizations of Prometheus metrics,\nyou can use your own Grafana installation or deploy Grafana by applying the grafana.yaml file provided in the examples/metrics directory.\nTo obtain monitoring data from your Kafka cluster, you can use your own Prometheus deployment or deploy Prometheus by applying the xref:ref-metrics-config-files-{context}[example resource file for the Prometheus docker image and the YAML files for Prometheus-related resources].", "author": "PaulRMellor", "createdAt": "2020-07-02T14:42:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU1Mzg2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU1NDUyNw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3269#discussion_r448554527", "bodyText": "I would probably remove this. There are several other options how to do this on different platforms. Not sure it is worth to pick only one of them. Exposing it using routes is also questionable from security perspective.", "author": "scholzj", "createdAt": "2020-07-01T18:50:57Z", "path": "documentation/modules/metrics/proc_metrics-grafana-dashboard.adoc", "diffHunk": "@@ -6,53 +6,159 @@\n \n = Enabling the example Grafana dashboards\n \n-Set up a Prometheus data source and example dashboards to enable Grafana for monitoring.\n+Strimzi provides xref:ref-metrics-config-files-{context}[example dashboard configuration files for Grafana].\n+Example dashboards are provided in the `examples/metrics` directory as JSON files:\n \n-NOTE: No alert notification rules are defined.\n+* `strimzi-kafka.json`\n+* `strimzi-zookeeper.json`\n+* `strimzi-kafka-connect.json`\n+* `strimzi-kafka-mirror-maker-2.json`\n+* `strimzi-operators.json`\n \n-When accessing a dashboard, you can use the `port-forward` command to forward traffic from the Grafana pod to the host.\n+The example dashboards are a good starting point for monitoring key metrics, but they do not represent all available metrics.\n+You may need to modify the example dashboards or add other metrics, depending on your infrastructure.\n \n-For example, you can access the Grafana user interface by:\n+After setting up Prometheus and Grafana, you can visualize the Strimzi data on the Grafana dashboards.\n \n-. Running `kubectl port-forward svc/grafana 3000:3000`\n-. Pointing a browser to `http://localhost:3000`\n+NOTE: No alert notification rules are defined.\n+\n+When accessing a dashboard, you can use the `port-forward` command to forward traffic from the Grafana pod to the host.\n \n NOTE: The name of the Grafana pod is different for each user.\n \n .Procedure\n \n-. Access the Grafana user interface using `admin/admin` credentials.\n+. Get the details of the Grafana service:\n++\n+[source,shell]\n+----\n+kubectl get service grafana\n+----\n+\n++\n+For example:\n++\n+[table,stripes=none]\n+|===\n+|NAME     |TYPE      |CLUSTER-IP    |PORT(S)\n+\n+|grafana  |ClusterIP |172.30.123.40 |80/TCP\n+|===\n++\n+Note the port number for port forwarding.\n+\n+. Use `port-forward` to redirect the Grafana user interface to `localhost:3000`:\n++\n+[source,shell]\n+----\n+kubectl port-forward svc/grafana 3000:80\n+----\n +\n-On the initial view choose to reset the password.\n+NOTE: If using the OpenShift web console, you can switch to menu:Networking[Routes], and click the URL for the `grafana` Route.", "originalCommit": "c35b6e2582490d3750c3a1e861f45c48dd1fec10", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA1MzE4MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3269#discussion_r449053181", "bodyText": "Okay", "author": "PaulRMellor", "createdAt": "2020-07-02T14:42:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU1NDUyNw=="}], "type": "inlineReview"}, {"oid": "c1c775bb32e5af43292e67d4b820c51eab041615", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/c1c775bb32e5af43292e67d4b820c51eab041615", "message": "review edit PM\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-07-02T10:35:56Z", "type": "commit"}, {"oid": "f9e1fbb4a159fd4bff13526d1a6afec4ed8a031b", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f9e1fbb4a159fd4bff13526d1a6afec4ed8a031b", "message": "review edit DL\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-07-02T12:07:50Z", "type": "commit"}, {"oid": "765ec7fa1bbaf4f96d4e344e8866feb0430e6bde", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/765ec7fa1bbaf4f96d4e344e8866feb0430e6bde", "message": "Review edits PP, JS, DL\n\nSigned-off-by: prmellor <pmellor@redhat.com>", "committedDate": "2020-07-02T14:44:58Z", "type": "commit"}]}