{"pr_number": 3919, "pr_title": "Fix issue preventing the jmxtrans container from becoming ready", "pr_createdAt": "2020-11-04T17:31:10Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3919", "timeline": [{"oid": "d1d44395577853c704945ee62cf37501e5d1f56a", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d1d44395577853c704945ee62cf37501e5d1f56a", "message": "Fix the readiness check. The 'nc -z' does not return a value\nin either success or fail cases so you have to examine the\nreponse code in $?. As it stands, the test assumes that not\nhaving a value on the response indicates a connection failure.\nThis fix switches back to testing the value in $? as it was\nin the previous version.\n\nSigned-off-by: John Beaven <beavenj@uk.ibm.com>", "committedDate": "2020-11-04T17:15:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzYxNjc5OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3919#discussion_r517616798", "bodyText": "The code looks good, but there seem to be some ShellCheck comments:\nif [ \"$?\" -ne 0 ]; then\n     ^--^ SC2181: Check exit code directly with e.g. 'if mycmd;', not indirectly with $?.\n\nCould you have a look at it?", "author": "scholzj", "createdAt": "2020-11-04T20:37:10Z", "path": "docker-images/jmxtrans/jmxtrans_readiness_check.sh", "diffHunk": "@@ -14,7 +14,8 @@ else\n     export KAFKA_METRICS_PORT=\"$2\"\n fi\n \n-if nc -z \"$KAFKA_HEADLESS_SERVICE\" \"$KAFKA_METRICS_PORT\"; then\n+nc -z \"$KAFKA_HEADLESS_SERVICE\" \"$KAFKA_METRICS_PORT\"\n+if [ \"$?\" -ne 0 ]; then", "originalCommit": "d1d44395577853c704945ee62cf37501e5d1f56a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA0NjE4MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3919#discussion_r518046181", "bodyText": "Hi there, ok no problem, we have changed it to a ShellCheck compliant form", "author": "beavenj", "createdAt": "2020-11-05T13:23:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzYxNjc5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODExODY2Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3919#discussion_r518118666", "bodyText": "Thanks", "author": "scholzj", "createdAt": "2020-11-05T15:02:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzYxNjc5OA=="}], "type": "inlineReview"}, {"oid": "6c84536006882544c079e6a0691f3a45e39b5ff3", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6c84536006882544c079e6a0691f3a45e39b5ff3", "message": "Adjusting to comply with the approach ShellCheck recommends\n\nSigned-off-by: John Beaven <beavenj@uk.ibm.com>", "committedDate": "2020-11-05T13:17:24Z", "type": "commit"}]}