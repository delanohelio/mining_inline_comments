{"pr_number": 2711, "pr_title": "[MO] -> 1st part of removing dependency of logs", "pr_createdAt": "2020-03-18T09:35:13Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2711", "timeline": [{"oid": "5d0eac395361ab5655eda4164a3ee16eba82fd10", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5d0eac395361ab5655eda4164a3ee16eba82fd10", "message": "[MO] -> 1st part of removing dependency of logs\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>", "committedDate": "2020-03-18T09:30:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI2NjEwNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2711#discussion_r394266104", "bodyText": "Surely waitForConnectorStability() is a better name?", "author": "tombentley", "createdAt": "2020-03-18T11:06:14Z", "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/kafkaUtils/KafkaConnectorUtils.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * Copyright Strimzi authors.\n+ * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n+ */\n+package io.strimzi.systemtest.utils.kafkaUtils;\n+\n+import io.strimzi.systemtest.Constants;\n+import io.strimzi.test.TestUtils;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+public class KafkaConnectorUtils {\n+\n+    private static final Logger LOGGER = LogManager.getLogger(KafkaConnectorUtils.class);\n+\n+    private KafkaConnectorUtils() {}\n+\n+    /**\n+     * WaitForStabilityConnector method, verifying stability of connector\n+     * @param connectorName connector name\n+     * @param connectPodName connects2i or connect pod name\n+     */\n+    public static void waitForStabilityConnector(String connectorName, String connectPodName) {", "originalCommit": "5d0eac395361ab5655eda4164a3ee16eba82fd10", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI4MTQxMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2711#discussion_r394281411", "bodyText": "Might be good to have some comments explaining what these are.", "author": "scholzj", "createdAt": "2020-03-18T11:35:43Z", "path": "systemtest/src/main/java/io/strimzi/systemtest/Constants.java", "diffHunk": "@@ -59,6 +59,9 @@\n     long CO_OPERATION_TIMEOUT_POLL = Duration.ofSeconds(2).toMillis();\n     long RECONCILIATION_INTERVAL = Duration.ofSeconds(30).toMillis();\n \n+    int GLOBAL_STABILITY_COUNT = 20;", "originalCommit": "5d0eac395361ab5655eda4164a3ee16eba82fd10", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDkwNzA5Mw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2711#discussion_r394907093", "bodyText": "I would go for GLOBAL_RECONCILIATION_COUNT = Duration.ofSeconds(30).toMillis() / GLOBAL_POLL_INTERVAL.\nI had also idea to overload method public static long waitFor(String description, long pollIntervalMs, long timeoutMs, BooleanSupplier ready)\n--> to just to waitFor(String description, BooleanSupplier ready) and these two parameters set to some fix value inside parameter long pollIntervalMs, long timeoutMs", "author": "see-quick", "createdAt": "2020-03-19T09:54:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI4MTQxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDkwODQ1Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2711#discussion_r394908457", "bodyText": "updated )", "author": "see-quick", "createdAt": "2020-03-19T09:56:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI4MTQxMQ=="}], "type": "inlineReview"}, {"oid": "5d0b7208da1ad26f9436555a7cd2ad2da6a32c9f", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5d0b7208da1ad26f9436555a7cd2ad2da6a32c9f", "message": "[MO] - [refactor] -> update comments\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>", "committedDate": "2020-03-19T09:56:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA4MTQyMw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2711#discussion_r395081423", "bodyText": "\"Connector with name {} is present. Remaining seconds for stability {}\"  ?", "author": "Frawless", "createdAt": "2020-03-19T14:46:11Z", "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/kafkaUtils/KafkaConnectorUtils.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * Copyright Strimzi authors.\n+ * License: Apache License 2.0 (see the file LICENSE or http://apache.org/licenses/LICENSE-2.0.html).\n+ */\n+package io.strimzi.systemtest.utils.kafkaUtils;\n+\n+import io.strimzi.systemtest.Constants;\n+import io.strimzi.test.TestUtils;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+public class KafkaConnectorUtils {\n+\n+    private static final Logger LOGGER = LogManager.getLogger(KafkaConnectorUtils.class);\n+\n+    private KafkaConnectorUtils() {}\n+\n+    /**\n+     * WaitForStabilityConnector method, verifying stability of connector\n+     * @param connectorName connector name\n+     * @param connectPodName connects2i or connect pod name\n+     */\n+    public static void waitForConnectorStability(String connectorName, String connectPodName) {\n+        // alternative to sync hassling AtomicInteger one could use an integer array instead\n+        // not need to be final because reference to the array does not get another array assigned\n+        int[] i = {0};\n+\n+        TestUtils.waitFor(\"Waiting for stability of connector \" + connectorName, Constants.GLOBAL_POLL_INTERVAL, Constants.GLOBAL_TIMEOUT,\n+            () -> {\n+                String availableConnectors = KafkaConnectUtils.getCreatedConnectors(connectPodName);\n+                if (availableConnectors.contains(connectorName)) {\n+                    LOGGER.info(\"Connector with name {} is present remaining seconds for stability {}\", connectorName,", "originalCommit": "5d0b7208da1ad26f9436555a7cd2ad2da6a32c9f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA4MjQ0NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2711#discussion_r395082445", "bodyText": "Maybe we should use better log text like :{} pods didn't roll. Remaining seconds for stability: {}  wdyt?", "author": "Frawless", "createdAt": "2020-03-19T14:47:34Z", "path": "systemtest/src/main/java/io/strimzi/systemtest/utils/kubeUtils/controllers/StatefulSetUtils.java", "diffHunk": "@@ -193,4 +193,22 @@ public static void waitForKafkaStatefulSetLabelsDeletion(String statefulSet, Str\n             LOGGER.info(\"Kafka statefulSet label {} change to {}\", labelKey, null);\n         }\n     }\n+\n+    public static void waitForNoRollingUpdate(String statefulSetName, Map<String, String> pods) {\n+        // alternative to sync hassling AtomicInteger one could use an integer array instead\n+        // not need to be final because reference to the array does not get another array assigned\n+        int[] i = {0};\n+\n+        TestUtils.waitFor(\"Waiting for stability of rolling update will be not triggered\", Constants.GLOBAL_POLL_INTERVAL, Constants.GLOBAL_TIMEOUT,\n+            () -> {\n+                if (!StatefulSetUtils.ssHasRolled(statefulSetName, pods)) {\n+                    LOGGER.info(\"{} pods not rolling waiting, remaining seconds for stability {}\", pods.toString(),", "originalCommit": "5d0b7208da1ad26f9436555a7cd2ad2da6a32c9f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "83b40e5ed22b14f49adfa08662a2415eecff4b7d", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/83b40e5ed22b14f49adfa08662a2415eecff4b7d", "message": "[MO] - [refactor] -> commends\n\nSigned-off-by: morsak <xorsak02@stud.fit.vutbr.cz>", "committedDate": "2020-03-19T15:36:51Z", "type": "commit"}]}