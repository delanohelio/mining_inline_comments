{"pr_number": 1425, "pr_title": "Mask debug message in \"evaluated config\"", "pr_createdAt": "2020-06-25T09:54:44Z", "pr_url": "https://github.com/treasure-data/digdag/pull/1425", "timeline": [{"oid": "4002d318f118f0f931784e029d667f436117e8b3", "url": "https://github.com/treasure-data/digdag/commit/4002d318f118f0f931784e029d667f436117e8b3", "message": "Mask \"evaluated config\" debug message.", "committedDate": "2020-06-26T01:28:31Z", "type": "forcePushed"}, {"oid": "4223b1078b3e45a0251ac79e31c7979e6b2d753d", "url": "https://github.com/treasure-data/digdag/commit/4223b1078b3e45a0251ac79e31c7979e6b2d753d", "message": "Mask \"evaluated config\" debug message.", "committedDate": "2020-06-29T01:43:23Z", "type": "forcePushed"}, {"oid": "40109ad4e43159567c1e24046809e34c961b0474", "url": "https://github.com/treasure-data/digdag/commit/40109ad4e43159567c1e24046809e34c961b0474", "message": "Mask \"evaluated config\" debug message.", "committedDate": "2020-06-29T03:16:19Z", "type": "commit"}, {"oid": "40109ad4e43159567c1e24046809e34c961b0474", "url": "https://github.com/treasure-data/digdag/commit/40109ad4e43159567c1e24046809e34c961b0474", "message": "Mask \"evaluated config\" debug message.", "committedDate": "2020-06-29T03:16:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA3OTExOA==", "url": "https://github.com/treasure-data/digdag/pull/1425#discussion_r448079118", "bodyText": "Config.set() just shares the reference to the values without copying data and won't consume memory a lot. Looks good.", "author": "komamitsu", "createdAt": "2020-07-01T02:21:06Z", "path": "digdag-core/src/main/java/io/digdag/core/agent/OperatorManager.java", "diffHunk": "@@ -388,4 +387,30 @@ public static void collectExceptionMessage(StringBuilder sb, Throwable ex, Strin\n             collectExceptionMessage(sb, t, used);\n         }\n     }\n+\n+    private static final String[] CONFIG_KEYS_FOR_LOGGING = {\n+            \"project_id\",\n+            \"session_id\",\n+            \"session_time\",\n+            \"attempt_id\",\n+            \"task_name\",\n+            \"last_session_time\",\n+            \"last_executed_session_time\",\n+            \"next_session_time\",\n+            \"session_uuid\",\n+            \"timezone\"\n+    };\n+\n+    @VisibleForTesting\n+    public Config filterConfigForLogging(Config src)\n+    {\n+        Config dst = cf.create();\n+        for (String key : CONFIG_KEYS_FOR_LOGGING) {\n+            Optional<Object> v = src.getOptional(key, Object.class);\n+            if (v.isPresent()) {\n+                dst.set(key, v.get());", "originalCommit": "40109ad4e43159567c1e24046809e34c961b0474", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA4MjU3OQ==", "url": "https://github.com/treasure-data/digdag/pull/1425#discussion_r448082579", "bodyText": "How about adding session_unixtime  as well? I think it's good to have it.", "author": "szyn", "createdAt": "2020-07-01T02:35:22Z", "path": "digdag-core/src/main/java/io/digdag/core/agent/OperatorManager.java", "diffHunk": "@@ -388,4 +387,30 @@ public static void collectExceptionMessage(StringBuilder sb, Throwable ex, Strin\n             collectExceptionMessage(sb, t, used);\n         }\n     }\n+\n+    private static final String[] CONFIG_KEYS_FOR_LOGGING = {\n+            \"project_id\",\n+            \"session_id\",\n+            \"session_time\",", "originalCommit": "40109ad4e43159567c1e24046809e34c961b0474", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}