{"pr_number": 1447, "pr_title": "Add task details as comments automatically to the query run by td operator", "pr_createdAt": "2020-08-24T06:19:03Z", "pr_url": "https://github.com/treasure-data/digdag/pull/1447", "timeline": [{"oid": "7450013ce4586499b01ee67178de4edd5288486a", "url": "https://github.com/treasure-data/digdag/commit/7450013ce4586499b01ee67178de4edd5288486a", "message": "Add task details as comments automatically to the query run by td operator", "committedDate": "2020-08-24T05:45:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM2ODgxNw==", "url": "https://github.com/treasure-data/digdag/pull/1447#discussion_r475368817", "bodyText": "Why not return StringBuilder from the method to avoid this String concatenation?", "author": "komamitsu", "createdAt": "2020-08-24T06:29:11Z", "path": "digdag-standards/src/main/java/io/digdag/standards/operator/td/TdOperatorFactory.java", "diffHunk": "@@ -219,11 +219,13 @@ else if (createTable.isPresent()) {\n                     throw new ConfigException(\"Unknown 'engine:' option (available options are: hive and presto): \"+engine);\n             }\n \n+            final String sql = createStmtComment(request) + stmt;", "originalCommit": "7450013ce4586499b01ee67178de4edd5288486a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM3ODgyOA==", "url": "https://github.com/treasure-data/digdag/pull/1447#discussion_r475378828", "bodyText": "Good point, thank you. Updated: 9db104e", "author": "szyn", "createdAt": "2020-08-24T06:55:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM2ODgxNw=="}], "type": "inlineReview"}, {"oid": "9db104eb77b0680e932fbc655cb1f51f4a704cfe", "url": "https://github.com/treasure-data/digdag/commit/9db104eb77b0680e932fbc655cb1f51f4a704cfe", "message": "Update to return StringBuilder to avoid String concatenation", "committedDate": "2020-08-24T06:42:19Z", "type": "commit"}, {"oid": "9854db2ccbfac05780558e4689ea3e4888c58310", "url": "https://github.com/treasure-data/digdag/commit/9854db2ccbfac05780558e4689ea3e4888c58310", "message": "Fix tests", "committedDate": "2020-08-24T06:51:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjA0Mzc0MA==", "url": "https://github.com/treasure-data/digdag/pull/1447#discussion_r476043740", "bodyText": "FYI: Another option may be a method String wrapStmtWithComment(TaskRequest request, String sql)", "author": "komamitsu", "createdAt": "2020-08-25T01:36:03Z", "path": "digdag-standards/src/main/java/io/digdag/standards/operator/td/TdOperatorFactory.java", "diffHunk": "@@ -533,4 +535,15 @@ else if (c == DELIMITER_CHAR) {\n             return escapedValue.toString();\n         }\n     }\n+\n+    @VisibleForTesting\n+    static StringBuilder createStmtComment(TaskRequest request)", "originalCommit": "9854db2ccbfac05780558e4689ea3e4888c58310", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE2Mzc0OA==", "url": "https://github.com/treasure-data/digdag/pull/1447#discussion_r476163748", "bodyText": "That's better \ud83d\udc4d  Updated: 83f00c1", "author": "szyn", "createdAt": "2020-08-25T04:38:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjA0Mzc0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjA0NDk4NA==", "url": "https://github.com/treasure-data/digdag/pull/1447#discussion_r476044984", "bodyText": "There is no test to check createStmtComment() works expectedly?", "author": "komamitsu", "createdAt": "2020-08-25T01:37:55Z", "path": "digdag-standards/src/test/java/io/digdag/standards/operator/td/TdOperatorFactoryTest.java", "diffHunk": "@@ -93,9 +110,10 @@ public void testTDJobRequestParamsWithEngineVersion()\n         when(op.getDatabase()).thenReturn(\"testdb\");\n \n         TDJobRequest jobRequest = testTDJobRequestParams(projectPath, config);\n+        String sql = createStmtComment(taskRequest).append(\"select 1\").toString();", "originalCommit": "9854db2ccbfac05780558e4689ea3e4888c58310", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE2NDYwMg==", "url": "https://github.com/treasure-data/digdag/pull/1447#discussion_r476164602", "bodyText": "Added a test case to check wrapStmtWithComment()  e55103b", "author": "szyn", "createdAt": "2020-08-25T04:39:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjA0NDk4NA=="}], "type": "inlineReview"}, {"oid": "83f00c1c0e6973d7d4baeaf4b49b601b834bb9cc", "url": "https://github.com/treasure-data/digdag/commit/83f00c1c0e6973d7d4baeaf4b49b601b834bb9cc", "message": "Use wrapStmtWithComment method to simplify", "committedDate": "2020-08-25T02:40:54Z", "type": "commit"}, {"oid": "e55103be6eb8680da8b4de0b2983fc46aac59498", "url": "https://github.com/treasure-data/digdag/commit/e55103be6eb8680da8b4de0b2983fc46aac59498", "message": "Add unit tests for wrapStmtWithComment method", "committedDate": "2020-08-25T02:57:13Z", "type": "commit"}, {"oid": "d617e150ea2e81127e1d6b64aef70961bd5dd3fd", "url": "https://github.com/treasure-data/digdag/commit/d617e150ea2e81127e1d6b64aef70961bd5dd3fd", "message": "Fix tests", "committedDate": "2020-08-25T02:57:31Z", "type": "commit"}, {"oid": "89ad87b1fed59b8bb3f8e7fbd5ffe195472947f5", "url": "https://github.com/treasure-data/digdag/commit/89ad87b1fed59b8bb3f8e7fbd5ffe195472947f5", "message": "Add workflow_name in comments", "committedDate": "2020-08-25T11:08:51Z", "type": "commit"}, {"oid": "7bce85d5bc6a4e558c48da7a25cfd2b0e7852aab", "url": "https://github.com/treasure-data/digdag/commit/7bce85d5bc6a4e558c48da7a25cfd2b0e7852aab", "message": "Fix tests", "committedDate": "2020-08-25T12:27:40Z", "type": "commit"}]}