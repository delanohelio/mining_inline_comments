{"pr_number": 1345, "pr_title": "Continue [Fix #1131 group retry degradation.]", "pr_createdAt": "2020-01-28T14:25:32Z", "pr_url": "https://github.com/treasure-data/digdag/pull/1345", "timeline": [{"oid": "3d9a8c676f5d4305842eeb430163107ba69d3558", "url": "https://github.com/treasure-data/digdag/commit/3d9a8c676f5d4305842eeb430163107ba69d3558", "message": "Fix #1131 group retry degradation.\n\nThis PR will replace #1153.", "committedDate": "2020-01-28T14:23:47Z", "type": "commit"}, {"oid": "6ebb6230fb9be08f362e9eaad72349d9be79e0d5", "url": "https://github.com/treasure-data/digdag/commit/6ebb6230fb9be08f362e9eaad72349d9be79e0d5", "message": "Add integration tests for if fail retry", "committedDate": "2020-01-29T08:49:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI1ODY0Mg==", "url": "https://github.com/treasure-data/digdag/pull/1345#discussion_r372258642", "bodyText": "These code may be better to remove.", "author": "yoyama", "createdAt": "2020-01-29T09:00:41Z", "path": "digdag-core/src/main/java/io/digdag/core/database/DatabaseSessionStoreManager.java", "diffHunk": "@@ -905,16 +906,50 @@ public void addResumingTasks(long attemptId, List<ResumingTask> tasks)\n         }\n \n         @DigdagTimed(value = \"dtcst_\", category = \"db\", appendMethodName = true)\n+        /**\n+         * Filter the child task if it is generated sub task.\n+         * Check the child task full name has '^sub' position later the parent full name.\n+         * @param parentFullName\n+         * @return\n+         */\n+        @VisibleForTesting\n+        public Predicate<StoredTask> funcFilterGeneratedSubtasks(Optional<String>parentFullName)\n+        {\n+            Predicate<StoredTask> filterGeneratedSubtasks = (s) -> {\n+                if (!parentFullName.isPresent()) {\n+                    return true;\n+                }\n+                String pfname = parentFullName.get();\n+                String chfname = s.getFullName();\n+                int pfnameLen = pfname.length();\n+                int chfnameLen = chfname.length();\n+\n+                if (chfname.startsWith(pfname)\n+                        && chfname.substring(pfnameLen).contains(\"^sub\")) {\n+                    // && chfnameLen > pfnameLen + \"^sub\".length()) {\n+                    logger.debug(\"Exclude generated task:{} from retry target\", chfname);", "originalCommit": "6ebb6230fb9be08f362e9eaad72349d9be79e0d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQ5MzAyOA==", "url": "https://github.com/treasure-data/digdag/pull/1345#discussion_r372493028", "bodyText": "I deleted here. 1071cbf", "author": "naritta", "createdAt": "2020-01-29T16:33:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI1ODY0Mg=="}], "type": "inlineReview"}, {"oid": "1071cbf07425d0ddd1049138d0e696fcac9705c9", "url": "https://github.com/treasure-data/digdag/commit/1071cbf07425d0ddd1049138d0e696fcac9705c9", "message": "Delete needless lines", "committedDate": "2020-01-29T12:14:43Z", "type": "commit"}, {"oid": "fb9e868aa1d642050fc938f43aa092b217cdf9fe", "url": "https://github.com/treasure-data/digdag/commit/fb9e868aa1d642050fc938f43aa092b217cdf9fe", "message": "Add tests for for_each", "committedDate": "2020-01-29T12:56:52Z", "type": "commit"}, {"oid": "5c50592b18c00eabd4ac8835dffbe13697add21c", "url": "https://github.com/treasure-data/digdag/commit/5c50592b18c00eabd4ac8835dffbe13697add21c", "message": "Add tests for call", "committedDate": "2020-01-29T16:31:41Z", "type": "commit"}, {"oid": "7d936ed414d8a22b634d72027b6722f2910dd5eb", "url": "https://github.com/treasure-data/digdag/commit/7d936ed414d8a22b634d72027b6722f2910dd5eb", "message": "Add new line end", "committedDate": "2020-01-30T09:12:09Z", "type": "commit"}, {"oid": "244c327cc486e4991e642f2bf41551a48875f70c", "url": "https://github.com/treasure-data/digdag/commit/244c327cc486e4991e642f2bf41551a48875f70c", "message": "Fix to output echo for failed", "committedDate": "2020-01-30T09:54:37Z", "type": "commit"}, {"oid": "9051d8d54241b02c34d4e88c17f01859f478993d", "url": "https://github.com/treasure-data/digdag/commit/9051d8d54241b02c34d4e88c17f01859f478993d", "message": "Add tests for nested call", "committedDate": "2020-01-30T11:53:33Z", "type": "commit"}, {"oid": "9051d8d54241b02c34d4e88c17f01859f478993d", "url": "https://github.com/treasure-data/digdag/commit/9051d8d54241b02c34d4e88c17f01859f478993d", "message": "Add tests for nested call", "committedDate": "2020-01-30T11:53:33Z", "type": "forcePushed"}]}