{"pr_number": 1438, "pr_title": "Add last_attempt_id idx to sessions", "pr_createdAt": "2020-07-16T06:12:39Z", "pr_url": "https://github.com/treasure-data/digdag/pull/1438", "timeline": [{"oid": "d7c399fa5b158b70df58c4c16b58f500b5603981", "url": "https://github.com/treasure-data/digdag/commit/d7c399fa5b158b70df58c4c16b58f500b5603981", "message": "Add last_attempt_id idx to sessions", "committedDate": "2020-07-16T05:59:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg2OTUwNg==", "url": "https://github.com/treasure-data/digdag/pull/1438#discussion_r457869506", "bodyText": "This is needed because create index concurrently fails in a transaction?", "author": "komamitsu", "createdAt": "2020-07-21T06:38:31Z", "path": "digdag-core/src/main/java/io/digdag/core/database/migrate/Migration_20200716114008_AddLastAttemptIdIndexToSessions.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package io.digdag.core.database.migrate;\n+\n+import org.skife.jdbi.v2.Handle;\n+\n+public class Migration_20200716114008_AddLastAttemptIdIndexToSessions\n+    implements Migration\n+{\n+    @Override\n+    public void migrate(Handle handle, MigrationContext context)\n+    {\n+        if (context.isPostgres()) {\n+            handle.update(\"create index concurrently sessions_on_last_attempt_id on sessions (last_attempt_id)\");\n+        } else {\n+            handle.update(\"create index sessions_on_last_attempt_id on sessions (last_attempt_id)\");\n+        }\n+    }\n+\n+    @Override\n+    public boolean noTransaction(MigrationContext context)\n+    {\n+        return context.isPostgres();", "originalCommit": "d7c399fa5b158b70df58c4c16b58f500b5603981", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDIwMjEzOQ==", "url": "https://github.com/treasure-data/digdag/pull/1438#discussion_r464202139", "bodyText": "Yes, it's exactly so.", "author": "szyn", "createdAt": "2020-08-03T05:33:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg2OTUwNg=="}], "type": "inlineReview"}]}