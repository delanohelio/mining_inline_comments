{"pr_number": 174, "pr_title": "FM2-174: Improve search for DiagnosticReport resource", "pr_createdAt": "2020-05-17T12:46:24Z", "pr_url": "https://github.com/openmrs/openmrs-module-fhir2/pull/174", "timeline": [{"oid": "020e6bb23e337d2e4e122081c231dd97c3e8c2d7", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/020e6bb23e337d2e4e122081c231dd97c3e8c2d7", "message": "FM2-174: Improve search for DiagnosticReport resource", "committedDate": "2020-05-18T18:16:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgzMDg0Mg==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/174#discussion_r426830842", "bodyText": "Let's not try to map an effectiveDate. We don't really have anything for which that's semantically meaningful.", "author": "ibacher", "createdAt": "2020-05-18T18:56:05Z", "path": "omod/src/main/java/org/openmrs/module/fhir2/providers/DiagnosticReportFhirResourceProvider.java", "diffHunk": "@@ -69,4 +79,18 @@ public MethodOutcome updateDiagnosticReport(@IdParam IdType id, @ResourceParam D\n \t\t\n \t\treturn FhirServerUtils.buildUpdate(service.update(idPart, diagnosticReport));\n \t}\n+\t\n+\t@Search\n+\tpublic Bundle searchForDiagnosticReports(\n+\t        @OptionalParam(name = DiagnosticReport.SP_ENCOUNTER, chainWhitelist = {\n+\t                \"\" }, targetTypes = Encounter.class) ReferenceAndListParam encounterReference,\n+\t        @OptionalParam(name = DiagnosticReport.SP_PATIENT, chainWhitelist = { \"\", Patient.SP_IDENTIFIER,\n+\t                Patient.SP_GIVEN, Patient.SP_FAMILY,\n+\t                Patient.SP_NAME }, targetTypes = Patient.class) ReferenceAndListParam patientReference,\n+\t        @OptionalParam(name = DiagnosticReport.SP_ISSUED) DateRangeParam issueDate,\n+\t        @OptionalParam(name = DiagnosticReport.SP_DATE) DateRangeParam effectiveDate,", "originalCommit": "8db29509ab613302d958ef803317d1d21246c578", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgzMjI5MA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/174#discussion_r426832290", "bodyText": "But we are doing that for observation as well.", "author": "varung-31", "createdAt": "2020-05-18T18:58:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgzMDg0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgzMzM1NQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/174#discussion_r426833355", "bodyText": "The meaning is a bit different for a DiagnosticReport versus a standard observation. One of the reasons I want to get them off of this weird obs group formatting.", "author": "ibacher", "createdAt": "2020-05-18T19:00:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgzMDg0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgzNDgzMQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/174#discussion_r426834831", "bodyText": "Okay, i'll do that.", "author": "varung-31", "createdAt": "2020-05-18T19:03:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgzMDg0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgzMTEwMA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/174#discussion_r426831100", "bodyText": "Why did you change the person associated with this obs?", "author": "ibacher", "createdAt": "2020-05-18T18:56:35Z", "path": "api/src/test/resources/org/openmrs/module/fhir2/api/dao/impl/FhirDiagnosticReportDaoImplTest_initial_data.xml", "diffHunk": "@@ -18,5 +18,5 @@\n \t<concept_name concept_id=\"5085\" name=\"FHIR Diagnostic Service Section Codes\" locale=\"en_GB\" creator=\"1\" date_created=\"2004-08-12 00:00:00.0\" concept_name_id=\"1439\" concept_name_type=\"FULLY_SPECIFIED\" locale_preferred=\"1\" voided=\"false\" uuid=\"67340528-feea-4232-b98c-b443c6affb39\"/>\n \t<obs obs_id=\"17\" person_id=\"7\" concept_id=\"5085\" encounter_id=\"3\" obs_datetime=\"2008-07-01 00:00:00.0\" location_id=\"1\" value_numeric=\"[NULL]\" comments=\"\" creator=\"1\" date_created=\"2008-08-18 14:09:35.0\" voided=\"false\" value_coded=\"[NULL]\" value_coded_name_id=\"[NULL]\" value_complex=\"[NULL]\" value_text=\"LAB\" value_datetime=\"[NULL]\" value_drug=\"[NULL]\" uuid=\"d899333c-5bd4-45cc-b1e7-2f9542dbcbf6\"/>\n \t<obs obs_id=\"18\" person_id=\"7\" concept_id=\"5085\" encounter_id=\"3\" obs_datetime=\"2008-07-01 00:00:00.0\" obs_group_id=\"17\" location_id=\"1\" value_numeric=\"66\" comments=\"\" creator=\"1\" date_created=\"2008-08-18 14:09:35.0\" voided=\"false\" value_coded=\"[NULL]\" value_coded_name_id=\"[NULL]\" value_complex=\"[NULL]\" value_text=\"LAB\" value_datetime=\"[NULL]\" value_drug=\"[NULL]\" uuid=\"1e589127-f391-4d0c-8e98-e0a158b2be22\"/>\n-\t<obs obs_id=\"19\" person_id=\"7\" concept_id=\"5085\" encounter_id=\"3\" obs_datetime=\"2008-07-01 00:00:00.0\" location_id=\"1\" value_numeric=\"[NULL]\" comments=\"\" creator=\"1\" date_created=\"2008-08-18 14:09:35.0\" voided=\"false\" value_coded=\"[NULL]\" value_coded_name_id=\"[NULL]\" value_complex=\"[NULL]\" value_text=\"LAB\" value_datetime=\"[NULL]\" value_drug=\"[NULL]\" uuid=\"dc386962-1c42-49ea-bed2-97650c66f742\"/>\n+\t<obs obs_id=\"19\" person_id=\"8\" concept_id=\"5085\" encounter_id=\"3\" obs_datetime=\"2008-07-01 00:00:00.0\" location_id=\"1\" value_numeric=\"[NULL]\" comments=\"\" creator=\"1\" date_created=\"2008-08-18 14:09:35.0\" voided=\"false\" value_coded=\"[NULL]\" value_coded_name_id=\"[NULL]\" value_complex=\"[NULL]\" value_text=\"LAB\" value_datetime=\"[NULL]\" value_drug=\"[NULL]\" uuid=\"dc386962-1c42-49ea-bed2-97650c66f742\"/>", "originalCommit": "8db29509ab613302d958ef803317d1d21246c578", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgzMzA5Mg==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/174#discussion_r426833092", "bodyText": "It becomes difficult to test if all the data is similar. But I could revert if you want.", "author": "varung-31", "createdAt": "2020-05-18T19:00:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgzMTEwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgzMzU2MQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/174#discussion_r426833561", "bodyText": "That's reasonable. Leave it as is.", "author": "ibacher", "createdAt": "2020-05-18T19:01:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgzMTEwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5MzMyMw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/174#discussion_r426893323", "bodyText": "@varung-31 another option would be to add more test data if the existing data doesn't suite your test cases", "author": "jecihjoy", "createdAt": "2020-05-18T21:06:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgzMTEwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI5NjMzOA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/174#discussion_r427296338", "bodyText": "@varung-31 I agree with @jecihjoy's suggestion here, that it would be better to add some new data rather than deleting existing data.", "author": "ibacher", "createdAt": "2020-05-19T13:21:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgzMTEwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQxNzM2OQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/174#discussion_r427417369", "bodyText": "Done", "author": "varung-31", "createdAt": "2020-05-19T16:01:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgzMTEwMA=="}], "type": "inlineReview"}, {"oid": "9272399b3ec921176b41d9c99af306eec5fa6f7a", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/9272399b3ec921176b41d9c99af306eec5fa6f7a", "message": "FM2-174: Improve search for DiagnosticReport resource", "committedDate": "2020-05-18T19:24:50Z", "type": "forcePushed"}, {"oid": "d12b34bd14c2953318df84287591e2bf24c3e81a", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/d12b34bd14c2953318df84287591e2bf24c3e81a", "message": "FM2-174: Improve search for DiagnosticReport resource", "committedDate": "2020-05-19T15:59:11Z", "type": "commit"}, {"oid": "d12b34bd14c2953318df84287591e2bf24c3e81a", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/d12b34bd14c2953318df84287591e2bf24c3e81a", "message": "FM2-174: Improve search for DiagnosticReport resource", "committedDate": "2020-05-19T15:59:11Z", "type": "forcePushed"}]}