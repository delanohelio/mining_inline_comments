{"pr_number": 220, "pr_title": "FM2-217: Add create, update, and delete methods for Location", "pr_createdAt": "2020-06-18T19:23:42Z", "pr_url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220", "timeline": [{"oid": "168b52aa24c45c01e20568aa78f913fa4c34a309", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/168b52aa24c45c01e20568aa78f913fa4c34a309", "message": "FM2-217:Add create, update, and delete methods for Location", "committedDate": "2020-06-18T20:19:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjY1NjIyMw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r442656223", "bodyText": "@gitcliff  thanks for working on this, did you try importing org.hl7.fhir.r4 package and see the reaction?", "author": "sherrif10", "createdAt": "2020-06-19T06:32:21Z", "path": "api/src/main/java/org/openmrs/module/fhir2/providers/r3/LocationFhirResourceProvider.java", "diffHunk": "@@ -57,6 +61,38 @@ public Location getLocationById(@IdParam @NotNull IdType id) {\n \t\treturn Location30_40.convertLocation(location);\n \t}\n \t\n+\t\n+\t@Create\n+\tpublic MethodOutcome createLocation(@ResourceParam Location location) {\n+\t\treturn FhirProviderUtils.buildCreate(locationService.create(Location30_40.convertLocation(location)));\n+\t} \n+\n+\t@Update\n+\t@SuppressWarnings(\"unused\")\n+\tpublic MethodOutcome updateLocation(@IdParam IdType id, @ResourceParam Location location) {\n+\t\tif (id == null || id.getIdPart() == null) {\n+\t\t\tthrow new InvalidRequestException(\"id must be specified to update\");\n+\t\t}\n+\n+\t\tlocation.setId(id.getIdPart());\n+\n+\t\treturn FhirProviderUtils.buildUpdate(locationService.update(id.getIdPart(),\n+\t\t    Location30_40.convertLocation(location)));\n+\t}\n+\n+\t@Delete\n+\t@SuppressWarnings(\"unused\")\n+\tpublic OperationOutcome deleteLocation(@IdParam @NotNull IdType id) {\n+\t\torg.hl7.fhir.r4.model.Location location = locationService.delete(id.getIdPart());", "originalCommit": "168b52aa24c45c01e20568aa78f913fa4c34a309", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjY4NDkyMg==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r442684922", "bodyText": "no i dint want to import it while working in r3", "author": "gitcliff", "createdAt": "2020-06-19T07:43:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjY1NjIyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxNTkzOA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r445815938", "bodyText": "Could you update this to use the FhirProviderUtils.buildDelete() method for this?", "author": "ibacher", "createdAt": "2020-06-25T20:21:58Z", "path": "api/src/main/java/org/openmrs/module/fhir2/providers/r3/LocationFhirResourceProvider.java", "diffHunk": "@@ -57,6 +61,38 @@ public Location getLocationById(@IdParam @NotNull IdType id) {\n \t\treturn Location30_40.convertLocation(location);\n \t}\n \t\n+\t\n+\t@Create\n+\tpublic MethodOutcome createLocation(@ResourceParam Location location) {\n+\t\treturn FhirProviderUtils.buildCreate(locationService.create(Location30_40.convertLocation(location)));\n+\t} \n+\n+\t@Update\n+\t@SuppressWarnings(\"unused\")\n+\tpublic MethodOutcome updateLocation(@IdParam IdType id, @ResourceParam Location location) {\n+\t\tif (id == null || id.getIdPart() == null) {\n+\t\t\tthrow new InvalidRequestException(\"id must be specified to update\");\n+\t\t}\n+\n+\t\tlocation.setId(id.getIdPart());\n+\n+\t\treturn FhirProviderUtils.buildUpdate(locationService.update(id.getIdPart(),\n+\t\t    Location30_40.convertLocation(location)));\n+\t}\n+\n+\t@Delete\n+\t@SuppressWarnings(\"unused\")\n+\tpublic OperationOutcome deleteLocation(@IdParam @NotNull IdType id) {\n+\t\torg.hl7.fhir.r4.model.Location location = locationService.delete(id.getIdPart());\n+\t\tif (location == null) {\n+\t\t\tthrow new ResourceNotFoundException(\"Could not find location to delete with id \" + id.getIdPart());\n+\t\t}\n+\t\tOperationOutcome retVal = new OperationOutcome();\n+\t\tretVal.setId(id.getIdPart());\n+\t\tretVal.getText().setDivAsString(\"Deleted successfully\");\n+\t\treturn retVal;", "originalCommit": "168b52aa24c45c01e20568aa78f913fa4c34a309", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0NjAyNQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r446146025", "bodyText": "@ibacher  i have added FhirProviderUtils.buildDelete()\nAbout the the create, delete, and update to the tests for the R3 version of the provider, the Location instance used in the R3 LocationFhirResourceProviderTest class is from org.hl7.fhir.r4.model.Location which brings about incompatibility mis-match in the arguments ie \"**The method updateLocation(org.hl7.fhir.dstu3.model.IdType, org.hl7.fhir.dstu3.model.Location) in the type LocationFhirResourceProvider is not applicable for the arguments (org.hl7.fhir.dstu3.model.IdType, org.hl7.fhir.r4.model.Location)**\"..\nI have tried changing the Location instance in R3 LocationFhirResourceProviderTest to org.hl7.fhir.dstu3.model.Location in order to match the method arguments but it break the existing tests because they use methods defined in org.hl7.fhir.r4.model.Location which are not defined in org.hl7.fhir.dstu3.model.Location", "author": "gitcliff", "createdAt": "2020-06-26T12:13:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxNTkzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0Njk4MA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r446146980", "bodyText": "the reason as to why the tests work in R4 is because it uses org.hl7.fhir.r4.model.Location location instance", "author": "gitcliff", "createdAt": "2020-06-26T12:15:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxNTkzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIwNDU5Mw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r446204593", "bodyText": "@gitcliff So I would use something like this to test the create method for instance:\n@Test\npublic void createLocation_shouldCreateNewLocation() {\n\twhen(locationService.create(any())).thenReturn(location);\n\torg.hl7.fhir.dstu3.model.Location r3Location = Location30_40.convertLocation(location);\n\n\tMethodOutcome result = resourceProvider.createLocation(r3Location);\n\n\tassertThat(result, notNullValue());\n\tassertThat(result.getCreated(), is(true));\n\tassertThat(result.getResource().getIdElement().getIdPart(), equalTo(r3Location.getId()));\n}\nNote that using this did require some surgery. In particular, I needed to change the types in FhirProviderUtils to accept IAnyResource instead of DomainResource, but this should be a fairly harmless change.\nAlso, my create method ended up like this:\n@Create\npublic MethodOutcome createLocation(@ResourceParam Location location) {\n\treturn FhirProviderUtils.buildCreate(Location30_40.convertLocation(locationService.create(Location30_40.convertLocation(location))));\n}", "author": "ibacher", "createdAt": "2020-06-26T14:04:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxNTkzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjYzNjA2MQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r446636061", "bodyText": "hello @ibacher thanks for the response above...\ni came up with a test case for the update method like this one\n@Test\n\tpublic void updateLocation_shouldUpdateLocation() {\n\t\t\n\t\twhen(locationService.update(LOCATION_UUID, location)).thenReturn(location);\n\t\t\n\t\torg.hl7.fhir.dstu3.model.Location r3Location = new org.hl7.fhir.dstu3.model.Location();\n\t\tr3Location = Location30_40.convertLocation(location);\n\t\t\n\t\tMethodOutcome result = resourceProvider.updateLocation(new IdType().setValue(LOCATION_UUID), r3Location);\n\t\tassertThat(result, CoreMatchers.notNullValue());\n\t\tassertThat(result.getResource(), equalTo(r3Location));\n\t}\n\t\n\nhowever it fails with this error , i did use IAnyResource instead of DomainResource in FhirProviderUtils not sure what i could be missing here\ncc @corneliouzbett", "author": "gitcliff", "createdAt": "2020-06-28T11:03:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxNTkzOA=="}], "type": "inlineReview"}, {"oid": "6d62e161abbea83ce89b27064f1c0836d2b3b15d", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/6d62e161abbea83ce89b27064f1c0836d2b3b15d", "message": "FM2-217:Add create, update, and delete methods for Location", "committedDate": "2020-06-26T14:05:21Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkyMjI4MQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r446922281", "bodyText": "use util method", "author": "Akayeshmantha", "createdAt": "2020-06-29T12:12:24Z", "path": "api/src/main/java/org/openmrs/module/fhir2/providers/r3/LocationFhirResourceProvider.java", "diffHunk": "@@ -57,6 +61,39 @@ public Location getLocationById(@IdParam @NotNull IdType id) {\n \t\treturn Location30_40.convertLocation(location);\n \t}\n \t\n+\t\n+\t@Create\n+\tpublic MethodOutcome createLocation(@ResourceParam Location location) {\n+\t\treturn FhirProviderUtils.buildCreate(locationService.create(Location30_40.convertLocation(location)));\n+\t} \n+\n+\t@Update\n+\t@SuppressWarnings(\"unused\")\n+\tpublic MethodOutcome updateLocation(@IdParam IdType id, @ResourceParam Location location) {\n+\t\tif (id == null || id.getIdPart() == null) {\n+\t\t\tthrow new InvalidRequestException(\"id must be specified to update\");\n+\t\t}\n+\n+\t\tlocation.setId(id.getIdPart());\n+\n+\t\treturn FhirProviderUtils.buildUpdate(locationService.update(id.getIdPart(),\n+\t\t    Location30_40.convertLocation(location)));\n+\t}\n+\n+\t@Delete\n+\t@SuppressWarnings(\"unused\")\n+\tpublic org.hl7.fhir.r4.model.OperationOutcome deleteLocation(@IdParam @NotNull IdType id) {\n+\t\torg.hl7.fhir.r4.model.Location location = locationService.delete(id.getIdPart());\n+\t\tif (location == null) {\n+\t\t\tthrow new ResourceNotFoundException(\"Could not find location to delete with id \" + id.getIdPart());\n+\t\t}\n+\t\tOperationOutcome retVal = new OperationOutcome();\n+\t\tretVal.setId(id.getIdPart());\n+\t\tretVal.getText().setDivAsString(\"Deleted successfully\");\n+\t\treturn FhirProviderUtils.buildDelete(location);", "originalCommit": "6d62e161abbea83ce89b27064f1c0836d2b3b15d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkyMjg2NA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r446922864", "bodyText": "ditto", "author": "Akayeshmantha", "createdAt": "2020-06-29T12:13:22Z", "path": "api/src/main/java/org/openmrs/module/fhir2/providers/r4/LocationFhirResourceProvider.java", "diffHunk": "@@ -60,6 +68,36 @@ public Location getLocationById(@IdParam @NotNull IdType id) {\n \t\treturn location;\n \t}\n \t\n+\t@Create\n+\tpublic MethodOutcome createLocation(@ResourceParam Location location) {\n+\t\treturn FhirProviderUtils.buildCreate(fhirLocationService.create(location));\n+\t}\n+\t\n+\t@Update\n+\t@SuppressWarnings(\"unused\")\n+\tpublic MethodOutcome updateLocation(@IdParam IdType id, @ResourceParam Location location) {\n+\t\tif (id == null || id.getIdPart() == null) {\n+\t\t\tthrow new InvalidRequestException(\"id must be specified to update\");\n+\t\t}\n+\t\t\n+\t\tlocation.setId(id.getIdPart());\n+\t\t\n+\t\treturn FhirProviderUtils.buildUpdate(fhirLocationService.update(id.getIdPart(), location));\n+\t}\n+\t\n+\t@Delete\n+\t@SuppressWarnings(\"unused\")\n+\tpublic OperationOutcome deleteLocation(@IdParam @NotNull IdType id) {\n+\t\torg.hl7.fhir.r4.model.Location location = fhirLocationService.delete(id.getIdPart());\n+\t\tif (location == null) {\n+\t\t\tthrow new ResourceNotFoundException(\"Could not find location to delete with id \" + id.getIdPart());\n+\t\t}\n+\t\tOperationOutcome retVal = new OperationOutcome();", "originalCommit": "6d62e161abbea83ce89b27064f1c0836d2b3b15d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkyMzIxOQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r446923219", "bodyText": "look at the name of other methods make it align with them", "author": "Akayeshmantha", "createdAt": "2020-06-29T12:13:56Z", "path": "api/src/test/java/org/openmrs/module/fhir2/providers/r4/LocationFhirResourceProviderTest.java", "diffHunk": "@@ -402,4 +407,64 @@ public void getLocationHistoryByWithWrongId_shouldThrowResourceNotFoundException\n \tprivate List<IBaseResource> get(IBundleProvider results) {\n \t\treturn results.getResources(START_INDEX, END_INDEX);\n \t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldUpdateLocation() {\n+\t\tLocation newLocation = location;\n+\t\t\n+\t\twhen(locationService.update(LOCATION_UUID, location)).thenReturn(newLocation);\n+\t\t\n+\t\tMethodOutcome result = resourceProvider.updateLocation(new IdType().setValue(LOCATION_UUID), location);\n+\t\tassertThat(result, CoreMatchers.notNullValue());\n+\t\tassertThat(result.getResource(), CoreMatchers.equalTo(newLocation));\n+\t}\n+\t\n+\t@Test(expected = InvalidRequestException.class)\n+\tpublic void updateLocation_shouldThrowInvalidRequestExceptionForWrongLocationUuid() {\n+\t\twhen(locationService.update(WRONG_LOCATION_UUID, location)).thenThrow(InvalidRequestException.class);\n+\t\t\n+\t\tresourceProvider.updateLocation(new IdType().setValue(WRONG_LOCATION_UUID), location);\n+\t}\n+\t\n+\t@Test(expected = MethodNotAllowedException.class)\n+\tpublic void updateAllergyShouldThrowMethodNotAllowedIfDoesNotExist() {", "originalCommit": "6d62e161abbea83ce89b27064f1c0836d2b3b15d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkyMzQ1OA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r446923458", "bodyText": "why can't we use the same location we have", "author": "Akayeshmantha", "createdAt": "2020-06-29T12:14:22Z", "path": "api/src/test/java/org/openmrs/module/fhir2/providers/r4/LocationFhirResourceProviderTest.java", "diffHunk": "@@ -402,4 +407,64 @@ public void getLocationHistoryByWithWrongId_shouldThrowResourceNotFoundException\n \tprivate List<IBaseResource> get(IBundleProvider results) {\n \t\treturn results.getResources(START_INDEX, END_INDEX);\n \t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldUpdateLocation() {\n+\t\tLocation newLocation = location;\n+\t\t\n+\t\twhen(locationService.update(LOCATION_UUID, location)).thenReturn(newLocation);\n+\t\t\n+\t\tMethodOutcome result = resourceProvider.updateLocation(new IdType().setValue(LOCATION_UUID), location);\n+\t\tassertThat(result, CoreMatchers.notNullValue());\n+\t\tassertThat(result.getResource(), CoreMatchers.equalTo(newLocation));\n+\t}\n+\t\n+\t@Test(expected = InvalidRequestException.class)\n+\tpublic void updateLocation_shouldThrowInvalidRequestExceptionForWrongLocationUuid() {\n+\t\twhen(locationService.update(WRONG_LOCATION_UUID, location)).thenThrow(InvalidRequestException.class);\n+\t\t\n+\t\tresourceProvider.updateLocation(new IdType().setValue(WRONG_LOCATION_UUID), location);\n+\t}\n+\t\n+\t@Test(expected = MethodNotAllowedException.class)\n+\tpublic void updateAllergyShouldThrowMethodNotAllowedIfDoesNotExist() {\n+\t\tLocation wrongLocation = new Location();\n+\t\t\n+\t\twrongLocation.setId(WRONG_LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.update(WRONG_LOCATION_UUID, wrongLocation)).thenThrow(MethodNotAllowedException.class);\n+\t\t\n+\t\tresourceProvider.updateLocation(new IdType().setValue(WRONG_LOCATION_UUID), wrongLocation);\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteLocation_shouldDeleteLocation() {\n+\t\tLocation newLocation = new Location();\n+\t\t\n+\t\twhen(locationService.delete(LOCATION_UUID)).thenReturn(newLocation);", "originalCommit": "6d62e161abbea83ce89b27064f1c0836d2b3b15d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkyMzU5MQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r446923591", "bodyText": "change according to delete operation changes.", "author": "Akayeshmantha", "createdAt": "2020-06-29T12:14:36Z", "path": "api/src/test/java/org/openmrs/module/fhir2/providers/r4/LocationFhirResourceProviderTest.java", "diffHunk": "@@ -402,4 +407,64 @@ public void getLocationHistoryByWithWrongId_shouldThrowResourceNotFoundException\n \tprivate List<IBaseResource> get(IBundleProvider results) {\n \t\treturn results.getResources(START_INDEX, END_INDEX);\n \t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldUpdateLocation() {\n+\t\tLocation newLocation = location;\n+\t\t\n+\t\twhen(locationService.update(LOCATION_UUID, location)).thenReturn(newLocation);\n+\t\t\n+\t\tMethodOutcome result = resourceProvider.updateLocation(new IdType().setValue(LOCATION_UUID), location);\n+\t\tassertThat(result, CoreMatchers.notNullValue());\n+\t\tassertThat(result.getResource(), CoreMatchers.equalTo(newLocation));\n+\t}\n+\t\n+\t@Test(expected = InvalidRequestException.class)\n+\tpublic void updateLocation_shouldThrowInvalidRequestExceptionForWrongLocationUuid() {\n+\t\twhen(locationService.update(WRONG_LOCATION_UUID, location)).thenThrow(InvalidRequestException.class);\n+\t\t\n+\t\tresourceProvider.updateLocation(new IdType().setValue(WRONG_LOCATION_UUID), location);\n+\t}\n+\t\n+\t@Test(expected = MethodNotAllowedException.class)\n+\tpublic void updateAllergyShouldThrowMethodNotAllowedIfDoesNotExist() {\n+\t\tLocation wrongLocation = new Location();\n+\t\t\n+\t\twrongLocation.setId(WRONG_LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.update(WRONG_LOCATION_UUID, wrongLocation)).thenThrow(MethodNotAllowedException.class);\n+\t\t\n+\t\tresourceProvider.updateLocation(new IdType().setValue(WRONG_LOCATION_UUID), wrongLocation);\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteLocation_shouldDeleteLocation() {\n+\t\tLocation newLocation = new Location();\n+\t\t\n+\t\twhen(locationService.delete(LOCATION_UUID)).thenReturn(newLocation);\n+\t\t\n+\t\torg.hl7.fhir.r4.model.OperationOutcome result = resourceProvider\n+\t\t        .deleteLocation(new IdType().setValue(LOCATION_UUID));\n+\t\tassertThat(result, CoreMatchers.notNullValue());\n+\t\tassertThat(result.getId(), equalTo(LOCATION_UUID));\n+\t}\n+\t\n+\t@Test(expected = ResourceNotFoundException.class)\n+\tpublic void deleteLocation_shouldThrowResourceNotFoundException() {\n+\t\tIdType id = new IdType();\n+\t\tid.setValue(WRONG_LOCATION_UUID);\n+\t\torg.hl7.fhir.r4.model.OperationOutcome location = resourceProvider.deleteLocation(id);", "originalCommit": "6d62e161abbea83ce89b27064f1c0836d2b3b15d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e5b486f18076557dad458e6e29fca236be23ffa5", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/e5b486f18076557dad458e6e29fca236be23ffa5", "message": "FM2-217:Add create, update, and delete methods for Location", "committedDate": "2020-06-30T20:17:02Z", "type": "forcePushed"}, {"oid": "e80b47da66826bd430646c2ab6e3eb117b9cc8a4", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/e80b47da66826bd430646c2ab6e3eb117b9cc8a4", "message": "FM2-217:Add create, update, and delete methods for Location", "committedDate": "2020-07-01T06:23:40Z", "type": "forcePushed"}, {"oid": "0af62620ecfebdbc299965e3c616ee02221d1c0e", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/0af62620ecfebdbc299965e3c616ee02221d1c0e", "message": "FM2-217:Add create, update, and delete methods for Location", "committedDate": "2020-07-01T08:04:42Z", "type": "forcePushed"}, {"oid": "7af6b537e48f5cc8155d2ba86fc9ee33f4603da4", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/7af6b537e48f5cc8155d2ba86fc9ee33f4603da4", "message": "FM2-217:Add create, update, and delete methods for Location", "committedDate": "2020-07-01T17:17:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY0MDA5OQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r453640099", "bodyText": "Please remove extra spaces. Find this useful throughout the PR.", "author": "varung-31", "createdAt": "2020-07-13T13:15:04Z", "path": "omod/src/test/resources/org/openmrs/module/fhir2/providers/LocationWebTest_create.json", "diffHunk": "@@ -0,0 +1,10 @@\n+{\n+  \"resourceType\": \"Location\",\n+  \"city\": \"kampala\",\n+  \"country\": \"uganda\",\n+  \"postalCode\": \"9105 PZ\",\n+  \"state\": \"MI\"\n+\n+", "originalCommit": "4c8c87e624c9f5b5eff47c22afd1095ea17d9238", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY0MTAxMg==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r453641012", "bodyText": "Please rewrite this as FhirProviderUtils.buildDelete(Location30_40.convertLocation(location))", "author": "varung-31", "createdAt": "2020-07-13T13:16:37Z", "path": "api/src/main/java/org/openmrs/module/fhir2/providers/r3/LocationFhirResourceProvider.java", "diffHunk": "@@ -63,6 +72,35 @@ public Location getLocationById(@IdParam @NotNull IdType id) {\n \t\treturn Location30_40.convertLocation(location);\n \t}\n \t\n+\t@Create\n+\tpublic MethodOutcome createLocation(@ResourceParam Location location) {\n+\t\treturn FhirProviderUtils.buildCreate(\n+\t\t\t    locationService.create(Location30_40.convertLocation(location)));\n+\t} \n+\n+\t@Update\n+\t@SuppressWarnings(\"unused\")\n+\tpublic MethodOutcome updateLocation(@IdParam IdType id, @ResourceParam Location location) {\n+\t\tif (id == null || id.getIdPart() == null) {\n+\t\t\tthrow new InvalidRequestException(\"id must be specified to update\");\n+\t\t}\n+\n+\t\tlocation.setId(id.getIdPart());\n+\n+\t\treturn FhirProviderUtils.buildUpdate(locationService.update(id.getIdPart(),\n+\t\t    Location30_40.convertLocation(location)));\n+\t}\n+\n+\t@Delete\n+\t@SuppressWarnings(\"unused\")\n+\tpublic OperationOutcome deleteLocation(@IdParam @NotNull IdType id) {\n+\t\torg.hl7.fhir.r4.model.Location location = locationService.delete(id.getIdPart());\n+\t\tif (location == null) {\n+\t\t\tthrow new ResourceNotFoundException(\"Could not find location to delete with id \" + id.getIdPart());\n+\t\t}\n+\t\treturn OperationOutcome30_40.convertOperationOutcome(FhirProviderUtils.buildDelete(location));", "originalCommit": "4c8c87e624c9f5b5eff47c22afd1095ea17d9238", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "410835bcb3dbd6ffc3481ec5e6901d17a2577a5c", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/410835bcb3dbd6ffc3481ec5e6901d17a2577a5c", "message": "FM2-217:Removing the white spaces", "committedDate": "2020-07-13T19:45:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA2Mzc3NA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r455063774", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\torg.hl7.fhir.r4.model.Location location = fhirLocationService.delete(id.getIdPart());\n          \n          \n            \n            \t\tLocation location = fhirLocationService.delete(id.getIdPart());", "author": "varung-31", "createdAt": "2020-07-15T13:46:16Z", "path": "api/src/main/java/org/openmrs/module/fhir2/providers/r4/LocationFhirResourceProvider.java", "diffHunk": "@@ -61,6 +69,33 @@ public Location getLocationById(@IdParam @NotNull IdType id) {\n \t\treturn location;\n \t}\n \t\n+\t@Create\n+\tpublic MethodOutcome createLocation(@ResourceParam Location location) {\n+\t\treturn FhirProviderUtils.buildCreate(fhirLocationService.create(location));\n+\t}\n+\t\n+\t@Update\n+\t@SuppressWarnings(\"unused\")\n+\tpublic MethodOutcome updateLocation(@IdParam IdType id, @ResourceParam Location location) {\n+\t\tif (id == null || id.getIdPart() == null) {\n+\t\t\tthrow new InvalidRequestException(\"id must be specified to update\");\n+\t\t}\n+\t\t\n+\t\tlocation.setId(id.getIdPart());\n+\t\t\n+\t\treturn FhirProviderUtils.buildUpdate(fhirLocationService.update(id.getIdPart(), location));\n+\t}\n+\t\n+\t@Delete\n+\t@SuppressWarnings(\"unused\")\n+\tpublic OperationOutcome deleteLocation(@IdParam @NotNull IdType id) {\n+\t\torg.hl7.fhir.r4.model.Location location = fhirLocationService.delete(id.getIdPart());", "originalCommit": "af88d57a55dfef528cd775431669997c9b72acc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA2NDAxMQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r455064011", "bodyText": "Please remove this test", "author": "varung-31", "createdAt": "2020-07-15T13:46:35Z", "path": "api/src/test/java/org/openmrs/module/fhir2/providers/r3/LocationFhirResourceProviderTest.java", "diffHunk": "@@ -449,4 +456,69 @@ public void getLocationHistoryByWithWrongId_shouldThrowResourceNotFoundException\n \tprivate List<IBaseResource> get(IBundleProvider results) {\n \t\treturn results.getResources(START_INDEX, END_INDEX);\n \t}\n+\t\n+\t@Test\n+\tpublic void createLocation_shouldCreateNewLocation() {\n+\t\twhen(locationService.create(any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMethodOutcome result = resourceProvider.createLocation(Location30_40.convertLocation(location));\n+\t\tassertThat(result, CoreMatchers.notNullValue());\n+\t\tassertThat(result.getCreated(), is(true));\n+\t\tassertThat(result.getResource(), CoreMatchers.equalTo(location));\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteLocation_shouldDeleteLocation() {\n+\t\t\n+\t\twhen(locationService.delete(LOCATION_UUID)).thenReturn(location);\n+\t\t\n+\t\tOperationOutcome result = resourceProvider.deleteLocation(new IdType().setValue(LOCATION_UUID));\n+\t\tassertThat(result, notNullValue());\n+\t\tassertThat(result.getIssue(), notNullValue());\n+\t\tassertThat(result.getIssueFirstRep().getSeverity(), equalTo(OperationOutcome.IssueSeverity.INFORMATION));\n+\t\tassertThat(result.getIssueFirstRep().getDetails().getCodingFirstRep().getCode(), equalTo(\"MSG_DELETED\"));\n+\t\tassertThat(result.getIssueFirstRep().getDetails().getCodingFirstRep().getDisplay(),\n+\t\t    equalTo(\"This resource has been deleted\"));\n+\t}\n+\t\n+\t@Test(expected = ResourceNotFoundException.class)\n+\tpublic void deleteLocation_shouldThrowResourceNotFoundException() {\n+\t\tIdType id = new IdType();\n+\t\tid.setValue(WRONG_LOCATION_UUID);\n+\t\tOperationOutcome location = resourceProvider.deleteLocation(id);\n+\t\tassertThat(location, nullValue());\n+\t}", "originalCommit": "af88d57a55dfef528cd775431669997c9b72acc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA2NDkwNQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r455064905", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tpublic void updateLocation_shouldErrorForNoId() throws Exception {\n          \n          \n            \n            \tpublic void updateLocation_shouldThrowErrorForNoId() throws Exception {", "author": "varung-31", "createdAt": "2020-07-15T13:47:48Z", "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r3/LocationFhirResourceProviderWebTest.java", "diffHunk": "@@ -421,4 +437,87 @@ private void verifyURI(String uri) throws Exception {\n \t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n \t\tassertThat(readBundleResponse(response).getEntry().size(), greaterThanOrEqualTo(1));\n \t}\n+\t\n+\t@Ignore\n+\t@Test\n+\tpublic void createLocation_shouldCreateLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.create(any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/Location\").jsonContent(jsonLocation).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isCreated());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldUpdateExistingLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.update(anyString(), any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldErrorForNoId() throws Exception {", "originalCommit": "af88d57a55dfef528cd775431669997c9b72acc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA2NTA1NA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r455065054", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tpublic void updateLocation_shouldErrorForIdMissMatch() throws Exception {\n          \n          \n            \n            \tpublic void updateLocation_shouldThrowErrorForIdMisMatch() throws Exception {", "author": "varung-31", "createdAt": "2020-07-15T13:48:01Z", "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r3/LocationFhirResourceProviderWebTest.java", "diffHunk": "@@ -421,4 +437,87 @@ private void verifyURI(String uri) throws Exception {\n \t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n \t\tassertThat(readBundleResponse(response).getEntry().size(), greaterThanOrEqualTo(1));\n \t}\n+\t\n+\t@Ignore\n+\t@Test\n+\tpublic void createLocation_shouldCreateLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.create(any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/Location\").jsonContent(jsonLocation).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isCreated());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldUpdateExistingLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.update(anyString(), any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldErrorForNoId() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_NO_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(), containsStringIgnoringCase(\"body must contain an ID element for update\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldErrorForIdMissMatch() throws Exception {", "originalCommit": "af88d57a55dfef528cd775431669997c9b72acc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA2NTMyNA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r455065324", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n          \n          \n            \n            \t\tLocation location = new Location();", "author": "varung-31", "createdAt": "2020-07-15T13:48:20Z", "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r4/LocationFhirResourceProviderWebTest.java", "diffHunk": "@@ -441,4 +456,90 @@ private void verifyURI(String uri) throws Exception {\n \t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n \t\tassertThat(readBundleResponse(response).getEntry().size(), greaterThanOrEqualTo(1));\n \t}\n+\t\n+\t@Test\n+\tpublic void createLocation_shouldCreateLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();", "originalCommit": "af88d57a55dfef528cd775431669997c9b72acc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA2NTQzNw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r455065437", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\twhen(locationService.create(any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n          \n          \n            \n            \t\twhen(locationService.create(any(Location.class))).thenReturn(location);", "author": "varung-31", "createdAt": "2020-07-15T13:48:27Z", "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r4/LocationFhirResourceProviderWebTest.java", "diffHunk": "@@ -441,4 +456,90 @@ private void verifyURI(String uri) throws Exception {\n \t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n \t\tassertThat(readBundleResponse(response).getEntry().size(), greaterThanOrEqualTo(1));\n \t}\n+\t\n+\t@Test\n+\tpublic void createLocation_shouldCreateLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.create(any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);", "originalCommit": "af88d57a55dfef528cd775431669997c9b72acc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA2NTU2NA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r455065564", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n          \n          \n            \n            \t\tLocation location = new Location();", "author": "varung-31", "createdAt": "2020-07-15T13:48:38Z", "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r4/LocationFhirResourceProviderWebTest.java", "diffHunk": "@@ -441,4 +456,90 @@ private void verifyURI(String uri) throws Exception {\n \t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n \t\tassertThat(readBundleResponse(response).getEntry().size(), greaterThanOrEqualTo(1));\n \t}\n+\t\n+\t@Test\n+\tpublic void createLocation_shouldCreateLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.create(any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/Location\").jsonContent(jsonLocation).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isCreated());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldUpdateExistingLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();", "originalCommit": "af88d57a55dfef528cd775431669997c9b72acc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA2NTY3OA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r455065678", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\twhen(locationService.update(anyString(), any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n          \n          \n            \n            \t\twhen(locationService.update(anyString(), any(Location.class))).thenReturn(location);", "author": "varung-31", "createdAt": "2020-07-15T13:48:46Z", "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r4/LocationFhirResourceProviderWebTest.java", "diffHunk": "@@ -441,4 +456,90 @@ private void verifyURI(String uri) throws Exception {\n \t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n \t\tassertThat(readBundleResponse(response).getEntry().size(), greaterThanOrEqualTo(1));\n \t}\n+\t\n+\t@Test\n+\tpublic void createLocation_shouldCreateLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.create(any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/Location\").jsonContent(jsonLocation).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isCreated());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldUpdateExistingLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.update(anyString(), any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);", "originalCommit": "af88d57a55dfef528cd775431669997c9b72acc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA2NTgzMQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r455065831", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tpublic void updateLocation_shouldErrorForNoId() throws Exception {\n          \n          \n            \n            \tpublic void updateLocation_shouldThrowErrorForNoId() throws Exception {", "author": "varung-31", "createdAt": "2020-07-15T13:48:57Z", "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r4/LocationFhirResourceProviderWebTest.java", "diffHunk": "@@ -441,4 +456,90 @@ private void verifyURI(String uri) throws Exception {\n \t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n \t\tassertThat(readBundleResponse(response).getEntry().size(), greaterThanOrEqualTo(1));\n \t}\n+\t\n+\t@Test\n+\tpublic void createLocation_shouldCreateLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.create(any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/Location\").jsonContent(jsonLocation).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isCreated());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldUpdateExistingLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.update(anyString(), any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldErrorForNoId() throws Exception {", "originalCommit": "af88d57a55dfef528cd775431669997c9b72acc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA2NTkyMw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r455065923", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tpublic void updateLocation_shouldErrorForIdMissMatch() throws Exception {\n          \n          \n            \n            \tpublic void updateLocation_shouldThrowErrorForIdMisMatch() throws Exception {", "author": "varung-31", "createdAt": "2020-07-15T13:49:06Z", "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r4/LocationFhirResourceProviderWebTest.java", "diffHunk": "@@ -441,4 +456,90 @@ private void verifyURI(String uri) throws Exception {\n \t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n \t\tassertThat(readBundleResponse(response).getEntry().size(), greaterThanOrEqualTo(1));\n \t}\n+\t\n+\t@Test\n+\tpublic void createLocation_shouldCreateLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.create(any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/Location\").jsonContent(jsonLocation).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isCreated());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldUpdateExistingLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.update(anyString(), any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldErrorForNoId() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_NO_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(), containsStringIgnoringCase(\"body must contain an ID element for update\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldErrorForIdMissMatch() throws Exception {", "originalCommit": "af88d57a55dfef528cd775431669997c9b72acc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA2NjA4Mw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r455066083", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n          \n          \n            \n            \t\tLocation location = new Location();", "author": "varung-31", "createdAt": "2020-07-15T13:49:18Z", "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r4/LocationFhirResourceProviderWebTest.java", "diffHunk": "@@ -441,4 +456,90 @@ private void verifyURI(String uri) throws Exception {\n \t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n \t\tassertThat(readBundleResponse(response).getEntry().size(), greaterThanOrEqualTo(1));\n \t}\n+\t\n+\t@Test\n+\tpublic void createLocation_shouldCreateLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.create(any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/Location\").jsonContent(jsonLocation).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isCreated());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldUpdateExistingLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.update(anyString(), any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldErrorForNoId() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_NO_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(), containsStringIgnoringCase(\"body must contain an ID element for update\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldErrorForIdMissMatch() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_WRONG_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + WRONG_LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(),\n+\t\t    containsStringIgnoringCase(\"body must contain an ID element which matches the request URL\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteLocation_shouldDeleteLocation() throws Exception {\n+\t\tOperationOutcome retVal = new OperationOutcome();\n+\t\tretVal.setId(LOCATION_UUID);\n+\t\tretVal.getText().setDivAsString(\"Deleted successfully\");\n+\t\t\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();", "originalCommit": "af88d57a55dfef528cd775431669997c9b72acc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA2NjcxMw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r455066713", "bodyText": "Please remove these lines", "author": "varung-31", "createdAt": "2020-07-15T13:50:03Z", "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r4/LocationFhirResourceProviderWebTest.java", "diffHunk": "@@ -441,4 +456,90 @@ private void verifyURI(String uri) throws Exception {\n \t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n \t\tassertThat(readBundleResponse(response).getEntry().size(), greaterThanOrEqualTo(1));\n \t}\n+\t\n+\t@Test\n+\tpublic void createLocation_shouldCreateLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.create(any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/Location\").jsonContent(jsonLocation).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isCreated());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldUpdateExistingLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.update(anyString(), any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldErrorForNoId() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_NO_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(), containsStringIgnoringCase(\"body must contain an ID element for update\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldErrorForIdMissMatch() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_WRONG_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + WRONG_LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(),\n+\t\t    containsStringIgnoringCase(\"body must contain an ID element which matches the request URL\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteLocation_shouldDeleteLocation() throws Exception {\n+\t\tOperationOutcome retVal = new OperationOutcome();\n+\t\tretVal.setId(LOCATION_UUID);\n+\t\tretVal.getText().setDivAsString(\"Deleted successfully\");\n+\t\t", "originalCommit": "af88d57a55dfef528cd775431669997c9b72acc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA2NzEyNw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r455067127", "bodyText": "Please remove these lines", "author": "varung-31", "createdAt": "2020-07-15T13:50:34Z", "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r3/LocationFhirResourceProviderWebTest.java", "diffHunk": "@@ -421,4 +437,87 @@ private void verifyURI(String uri) throws Exception {\n \t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n \t\tassertThat(readBundleResponse(response).getEntry().size(), greaterThanOrEqualTo(1));\n \t}\n+\t\n+\t@Ignore\n+\t@Test\n+\tpublic void createLocation_shouldCreateLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.create(any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/Location\").jsonContent(jsonLocation).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isCreated());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldUpdateExistingLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.update(anyString(), any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldErrorForNoId() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_NO_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(), containsStringIgnoringCase(\"body must contain an ID element for update\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldErrorForIdMissMatch() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_WRONG_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + WRONG_LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(),\n+\t\t    containsStringIgnoringCase(\"body must contain an ID element which matches the request URL\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteLocation_shouldDeleteLocation() throws Exception {\n+\t\tOperationOutcome retVal = new OperationOutcome();\n+\t\tretVal.setId(LOCATION_UUID);\n+\t\tretVal.getText().setDivAsString(\"Deleted successfully\");\n+\t\t", "originalCommit": "af88d57a55dfef528cd775431669997c9b72acc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA2NzQyNg==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r455067426", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            }\n          \n          \n            \n            \n          \n          \n            \n             \n          \n          \n            \n            }", "author": "varung-31", "createdAt": "2020-07-15T13:50:58Z", "path": "omod/src/test/resources/org/openmrs/module/fhir2/providers/LocationWebTest_UpdateWithWrongId.json", "diffHunk": "@@ -0,0 +1,10 @@\n+{\n+  \"resourceType\": \"Location\",\n+  \"id\": \"a0938123-1691-11df-97a5-7038c432aabc\",\n+  \"city\": \"kampalaa\",\n+  \"country\": \"uganda\",\n+  \"postalCode\": \"9105 PZ\",\n+  \"state\": \"MI\"\n+}\n+\n+ ", "originalCommit": "af88d57a55dfef528cd775431669997c9b72acc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "90d467395cd76e601515ae4f3916031e234c6943", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/90d467395cd76e601515ae4f3916031e234c6943", "message": "FM2-217:Add create, update, and delete methods for Location", "committedDate": "2020-07-15T17:42:04Z", "type": "commit"}, {"oid": "f6de8e5e137b62ccae877773eee82abb943242d3", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/f6de8e5e137b62ccae877773eee82abb943242d3", "message": "FM2-217:Removing the white spaces", "committedDate": "2020-07-15T17:42:06Z", "type": "commit"}, {"oid": "503a8e80ff293aa53b50f9809b6b391685c84404", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/503a8e80ff293aa53b50f9809b6b391685c84404", "message": "FM2-217:Fixing formattings", "committedDate": "2020-07-15T17:42:07Z", "type": "commit"}, {"oid": "3c1b085006c2384c9e905262b0e2800c44883ba3", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/3c1b085006c2384c9e905262b0e2800c44883ba3", "message": "FM2-217:Fix formattings", "committedDate": "2020-07-15T18:08:26Z", "type": "commit"}, {"oid": "3c1b085006c2384c9e905262b0e2800c44883ba3", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/3c1b085006c2384c9e905262b0e2800c44883ba3", "message": "FM2-217:Fix formattings", "committedDate": "2020-07-15T18:08:26Z", "type": "forcePushed"}, {"oid": "673ee1cedf30a2ac423a060682e24bf884f208f3", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/673ee1cedf30a2ac423a060682e24bf884f208f3", "message": "FM2-217:Fix formattings", "committedDate": "2020-07-15T18:28:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTI3MjgyNw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r455272827", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tOperationOutcome retVal = new OperationOutcome();\n          \n          \n            \n            \t\tretVal.setId(LOCATION_UUID);\n          \n          \n            \n            \t\tretVal.getText().setDivAsString(\"Deleted successfully\");", "author": "varung-31", "createdAt": "2020-07-15T18:56:36Z", "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r3/LocationFhirResourceProviderWebTest.java", "diffHunk": "@@ -421,4 +437,87 @@ private void verifyURI(String uri) throws Exception {\n \t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n \t\tassertThat(readBundleResponse(response).getEntry().size(), greaterThanOrEqualTo(1));\n \t}\n+\t\n+\t@Ignore\n+\t@Test\n+\tpublic void createLocation_shouldCreateLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.create(any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/Location\").jsonContent(jsonLocation).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isCreated());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldUpdateExistingLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.update(anyString(), any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldThrowErrorForNoId() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_NO_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(), containsStringIgnoringCase(\"body must contain an ID element for update\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldThrowErrorForIdMissMatch() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_WRONG_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + WRONG_LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(),\n+\t\t    containsStringIgnoringCase(\"body must contain an ID element which matches the request URL\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteLocation_shouldDeleteLocation() throws Exception {\n+\t\tOperationOutcome retVal = new OperationOutcome();\n+\t\tretVal.setId(LOCATION_UUID);\n+\t\tretVal.getText().setDivAsString(\"Deleted successfully\");\n+\t\t", "originalCommit": "673ee1cedf30a2ac423a060682e24bf884f208f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTI3MzEyNg==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r455273126", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tOperationOutcome retVal = new OperationOutcome();\n          \n          \n            \n            \t\tretVal.setId(LOCATION_UUID);\n          \n          \n            \n            \t\tretVal.getText().setDivAsString(\"Deleted successfully\");", "author": "varung-31", "createdAt": "2020-07-15T18:57:09Z", "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r4/LocationFhirResourceProviderWebTest.java", "diffHunk": "@@ -441,4 +456,89 @@ private void verifyURI(String uri) throws Exception {\n \t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n \t\tassertThat(readBundleResponse(response).getEntry().size(), greaterThanOrEqualTo(1));\n \t}\n+\t\n+\t@Test\n+\tpublic void createLocation_shouldCreateLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tLocation location = new Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.create(any(Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/Location\").jsonContent(jsonLocation).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isCreated());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldUpdateExistingLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tLocation location = new Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.update(anyString(), any(Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldThrowErrorForNoId() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_NO_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(), containsStringIgnoringCase(\"body must contain an ID element for update\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldThrowErrorForIdMissMatch() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_WRONG_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + WRONG_LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(),\n+\t\t    containsStringIgnoringCase(\"body must contain an ID element which matches the request URL\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteLocation_shouldDeleteLocation() throws Exception {\n+\t\tOperationOutcome retVal = new OperationOutcome();\n+\t\tretVal.setId(LOCATION_UUID);\n+\t\tretVal.getText().setDivAsString(\"Deleted successfully\");", "originalCommit": "673ee1cedf30a2ac423a060682e24bf884f208f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5da46ff51cce3c8288728798e15add828c88a4c2", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/5da46ff51cce3c8288728798e15add828c88a4c2", "message": "Apply suggestions from code review\n\nCo-authored-by: Varun Gupta <59061747+varung-31@users.noreply.github.com>", "committedDate": "2020-07-20T19:10:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYzMjUzNQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/220#discussion_r457632535", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tpublic void deleteLocation_shouldDeleteLocation() throws Exception {\n          \n          \n            \n            \t\t\n          \n          \n            \n            \t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n          \n          \n            \n            \tpublic void deleteLocation_shouldDeleteLocation() throws Exception {\n          \n          \n            \n            \t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();", "author": "ibacher", "createdAt": "2020-07-20T19:11:34Z", "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r3/LocationFhirResourceProviderWebTest.java", "diffHunk": "@@ -421,4 +437,84 @@ private void verifyURI(String uri) throws Exception {\n \t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n \t\tassertThat(readBundleResponse(response).getEntry().size(), greaterThanOrEqualTo(1));\n \t}\n+\t\n+\t@Ignore\n+\t@Test\n+\tpublic void createLocation_shouldCreateLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.create(any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/Location\").jsonContent(jsonLocation).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isCreated());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldUpdateExistingLocation() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();\n+\t\tlocation.setId(LOCATION_UUID);\n+\t\t\n+\t\twhen(locationService.update(anyString(), any(org.hl7.fhir.r4.model.Location.class))).thenReturn(location);\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldThrowErrorForNoId() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_NO_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(), containsStringIgnoringCase(\"body must contain an ID element for update\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateLocation_shouldThrowErrorForIdMissMatch() throws Exception {\n+\t\tString jsonLocation;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LOCATION_WRONG_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tjsonLocation = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\tMockHttpServletResponse response = put(\"/Location/\" + WRONG_LOCATION_UUID).jsonContent(jsonLocation)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(),\n+\t\t    containsStringIgnoringCase(\"body must contain an ID element which matches the request URL\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteLocation_shouldDeleteLocation() throws Exception {\n+\t\t\n+\t\torg.hl7.fhir.r4.model.Location location = new org.hl7.fhir.r4.model.Location();", "originalCommit": "5da46ff51cce3c8288728798e15add828c88a4c2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7db00b0f9b604e0512891562f4599fa789529703", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/7db00b0f9b604e0512891562f4599fa789529703", "message": "Update omod/src/test/java/org/openmrs/module/fhir2/providers/r3/LocationFhirResourceProviderWebTest.java", "committedDate": "2020-07-20T19:11:39Z", "type": "commit"}]}