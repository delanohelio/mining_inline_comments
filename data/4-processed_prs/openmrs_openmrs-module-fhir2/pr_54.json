{"pr_number": 54, "pr_title": "FM2-32 : Created translations for location tags", "pr_createdAt": "2020-02-04T13:20:51Z", "pr_url": "https://github.com/openmrs/openmrs-module-fhir2/pull/54", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDcwMTY4Mg==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/54#discussion_r374701682", "bodyText": "Extract constants", "author": "corneliouzbett", "createdAt": "2020-02-04T14:28:38Z", "path": "api/src/test/java/org/openmrs/module/fhir2/api/translators/impl/LocationTranslatorImplTest.java", "diffHunk": "@@ -271,4 +275,29 @@ public void getLocationContactDetails_shouldWorkAsExpected() {\n \t\tassertThat(omrsLocation.getActiveAttributes().size(), equalTo(1));\n \t\t\n \t}\n+\t\n+\t@Test\n+\tpublic void toFhirResource_shoudTranslateOpenmrsTagsToFhirLocationTags() {\n+\t\tLocationTag tag = new LocationTag(\"Login location\", \"Used to identify login locations\");\n+\t\tomrsLocation.addTag(tag);", "originalCommit": "321bc171c54478305ffabab689f9b09ad178cfdc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDcwNTM2Nw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/54#discussion_r374705367", "bodyText": "I think the size here should be greaterThanOrEqualTo(1):\nassertThat(omrsLocation.getTags().size(), greaterThanOrEqualTo(1));", "author": "corneliouzbett", "createdAt": "2020-02-04T14:34:50Z", "path": "api/src/test/java/org/openmrs/module/fhir2/api/translators/impl/LocationTranslatorImplTest.java", "diffHunk": "@@ -271,4 +275,29 @@ public void getLocationContactDetails_shouldWorkAsExpected() {\n \t\tassertThat(omrsLocation.getActiveAttributes().size(), equalTo(1));\n \t\t\n \t}\n+\t\n+\t@Test\n+\tpublic void toFhirResource_shoudTranslateOpenmrsTagsToFhirLocationTags() {\n+\t\tLocationTag tag = new LocationTag(\"Login location\", \"Used to identify login locations\");\n+\t\tomrsLocation.addTag(tag);\n+\t\torg.hl7.fhir.r4.model.Location fhirLocation = locationTranslator.toFhirResource(omrsLocation);\n+\t\tassertThat(fhirLocation.getMeta().getTag(), notNullValue());\n+\t\tassertThat(fhirLocation.getMeta().getTag().size(), greaterThanOrEqualTo(0));\n+\t\tassertThat(fhirLocation.getMeta().getTag().get(0).getCode(), is(\"Login location\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void toOpenmrsType_shouldTranslateFhirTagsToOpenmrsLocationTags() {\n+\t\tList<Coding> tags = new ArrayList<>();\n+\t\tCoding tag = new Coding();\n+\t\ttag.setCode(\"Lab location\");\n+\t\ttag.setDisplay(\"Used to identify lab resources\");\n+\t\ttags.add(tag);\n+\t\torg.hl7.fhir.r4.model.Location fhirLocation = new org.hl7.fhir.r4.model.Location();\n+\t\tfhirLocation.getMeta().setTag(tags);\n+\t\tomrsLocation = locationTranslator.toOpenmrsType(fhirLocation);\n+\t\tassertThat(omrsLocation.getTags(), notNullValue());\n+\t\tassertThat(omrsLocation.getTags().size(), greaterThanOrEqualTo(0));", "originalCommit": "321bc171c54478305ffabab689f9b09ad178cfdc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc3NjM1OA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/54#discussion_r374776358", "bodyText": "You could even use assertThat(omrsLocation.getTags(), hasSize(greaterThanOrEqualTo(1));, but that might be getting too fancy.", "author": "ibacher", "createdAt": "2020-02-04T16:23:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDcwNTM2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDcwNjc3Mw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/54#discussion_r374706773", "bodyText": "Extract this constant.\nSince you are using in more than one location", "author": "corneliouzbett", "createdAt": "2020-02-04T14:37:11Z", "path": "api/src/test/java/org/openmrs/module/fhir2/api/translators/impl/LocationTranslatorImplTest.java", "diffHunk": "@@ -271,4 +275,29 @@ public void getLocationContactDetails_shouldWorkAsExpected() {\n \t\tassertThat(omrsLocation.getActiveAttributes().size(), equalTo(1));\n \t\t\n \t}\n+\t\n+\t@Test\n+\tpublic void toFhirResource_shoudTranslateOpenmrsTagsToFhirLocationTags() {\n+\t\tLocationTag tag = new LocationTag(\"Login location\", \"Used to identify login locations\");\n+\t\tomrsLocation.addTag(tag);\n+\t\torg.hl7.fhir.r4.model.Location fhirLocation = locationTranslator.toFhirResource(omrsLocation);\n+\t\tassertThat(fhirLocation.getMeta().getTag(), notNullValue());\n+\t\tassertThat(fhirLocation.getMeta().getTag().size(), greaterThanOrEqualTo(0));\n+\t\tassertThat(fhirLocation.getMeta().getTag().get(0).getCode(), is(\"Login location\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void toOpenmrsType_shouldTranslateFhirTagsToOpenmrsLocationTags() {\n+\t\tList<Coding> tags = new ArrayList<>();\n+\t\tCoding tag = new Coding();\n+\t\ttag.setCode(\"Lab location\");\n+\t\ttag.setDisplay(\"Used to identify lab resources\");", "originalCommit": "321bc171c54478305ffabab689f9b09ad178cfdc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc3NTUzOQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/54#discussion_r374775539", "bodyText": "We should probably add this to FhirConstants. Something like:\nOPENMRS_FHIR_EXT_LOCATION_TAG = OPENMRS_FHIR_EXT_PREFIX + \"/location-tag\";", "author": "ibacher", "createdAt": "2020-02-04T16:22:14Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/LocationTranslatorImpl.java", "diffHunk": "@@ -78,6 +80,12 @@ public Location toFhirResource(org.openmrs.Location openmrsLocation) {\n \t\t\t}\n \t\t\t\n \t\t\tfhirLocation.setTelecom(getLocationContactDetails(openmrsLocation));\n+\t\t\t\n+\t\t\tif (openmrsLocation.getTags() != null) {\n+\t\t\t\tfor (LocationTag tag : openmrsLocation.getTags()) {\n+\t\t\t\t\tfhirLocation.getMeta().addTag(FhirConstants.OPENMRS_FHIR_EXT_PREFIX + \"/location-tag\", tag.getName(), tag.getDescription());", "originalCommit": "321bc171c54478305ffabab689f9b09ad178cfdc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8610e649ae22a41b3525cfa17d9fdf28d45f2164", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/8610e649ae22a41b3525cfa17d9fdf28d45f2164", "message": "FM2-32 : Created translations for location tags", "committedDate": "2020-02-04T17:13:33Z", "type": "forcePushed"}, {"oid": "52a8815c7085441f5757f9224b8231b1a2432bd5", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/52a8815c7085441f5757f9224b8231b1a2432bd5", "message": "FM2-32 : Created translations for location tags", "committedDate": "2020-02-04T17:14:23Z", "type": "commit"}, {"oid": "52a8815c7085441f5757f9224b8231b1a2432bd5", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/52a8815c7085441f5757f9224b8231b1a2432bd5", "message": "FM2-32 : Created translations for location tags", "committedDate": "2020-02-04T17:14:23Z", "type": "forcePushed"}]}