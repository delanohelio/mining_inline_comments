{"pr_number": 3293, "pr_title": "Implement flow read in v2 over nbworker", "pr_createdAt": "2020-03-16T11:28:18Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3293", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk3NTY4Nw==", "url": "https://github.com/telstra/open-kilda/pull/3293#discussion_r392975687", "bodyText": "I think error message is wrong.\nconnected devices", "author": "niksv", "createdAt": "2020-03-16T12:18:46Z", "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/bolts/FlowOperationsBolt.java", "diffHunk": "@@ -237,6 +243,25 @@ public void init() {\n         return Collections.singletonList(response);\n     }\n \n+    private List<FlowResponse> processFlowReadRequest(FlowReadRequest readRequest) {\n+        try {\n+            Flow f = flowOperationsService.getFlow(readRequest.getFlowId());\n+            FlowDto dto = FlowMapper.INSTANCE.map(f);\n+            FlowResponse response = new FlowResponse(dto);\n+            return Collections.singletonList(response);\n+        } catch (FlowNotFoundException e) {\n+            throw new MessageException(ErrorType.NOT_FOUND, e.getMessage(),\n+                    \"Could not get connected devices for non existent flow\");", "originalCommit": "0c218f069a3ad42fe25f13a02f31addcdca74fa3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk3NjM3Mw==", "url": "https://github.com/telstra/open-kilda/pull/3293#discussion_r392976373", "bodyText": "flow-id please use flow_id like in other V2 API", "author": "niksv", "createdAt": "2020-03-16T12:20:10Z", "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/controller/v2/FlowControllerV2.java", "diffHunk": "@@ -78,6 +81,31 @@\n         return flowService.deleteFlowV2(flowId);\n     }\n \n+    /**\n+     * Gets flow.\n+     *\n+     * @param flowId        flow id\n+     * @return flow\n+     */\n+    @ApiOperation(value = \"Gets flow\", response = FlowResponsePayload.class)\n+    @GetMapping(value = \"/{flow-id:.+}\")\n+    @ResponseStatus(HttpStatus.OK)\n+    public CompletableFuture<FlowResponseV2> getFlow(@PathVariable(name = \"flow-id\") String flowId) {", "originalCommit": "0c218f069a3ad42fe25f13a02f31addcdca74fa3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8a94089e3c36bc44acb5b63e2e36d04fbecf0eb7", "url": "https://github.com/telstra/open-kilda/commit/8a94089e3c36bc44acb5b63e2e36d04fbecf0eb7", "message": "Implement flow read in v2 over nbworker\n\nAdded:\n- /v2/flows\n- /v2/flows/{flow-id}\n\nlogic is moved to nb-worker topology\n\nRelated-With: #3291", "committedDate": "2020-03-17T07:28:19Z", "type": "forcePushed"}, {"oid": "353d85b30207599e1b6d8c03f1834aa61438c980", "url": "https://github.com/telstra/open-kilda/commit/353d85b30207599e1b6d8c03f1834aa61438c980", "message": "Implement flow read in v2 over nbworker\n\nAdded:\n- /v2/flows\n- /v2/flows/{flow_id}\nChanged:\n- /v1/flows\n- /v1/flows/{flow-id}\n- /v1/flows/{flow-id}\n\nv1 api started using nbworker topology for read requests as well\n\nlogic is moved to nb-worker topology\n\nRelated-With: #3291", "committedDate": "2020-03-17T07:43:55Z", "type": "forcePushed"}, {"oid": "0eb8fb68110734b9b1cbd3bf03477de594e5ecb0", "url": "https://github.com/telstra/open-kilda/commit/0eb8fb68110734b9b1cbd3bf03477de594e5ecb0", "message": "Implement flow read in v2 over nbworker\n\nAdded:\n- /v2/flows\n- /v2/flows/{flow_id}\n- /v2/flows{flow_id}/status\nChanged:\n- /v1/flows\n- /v1/flows/{flow-id}\n- /v1/flows/{flow-id}/status\n\nv1 api started using nbworker topology for read requests as well\n\nlogic is moved to nb-worker topology\n\nRelated-With: #3291", "committedDate": "2020-03-17T08:00:18Z", "type": "forcePushed"}, {"oid": "9b5fc642ad7412da2c55330ff86fdc2392bb032a", "url": "https://github.com/telstra/open-kilda/commit/9b5fc642ad7412da2c55330ff86fdc2392bb032a", "message": "Implement flow read in v2 over nbworker\n\nAdded:\n- /v2/flows\n- /v2/flows/{flow_id}\n- /v2/flows{flow_id}/status\nChanged:\n- /v1/flows\n- /v1/flows/{flow-id}\n- /v1/flows/{flow-id}/status\n\nv1 api started using nbworker topology for read requests as well\n\nlogic is moved to nb-worker topology\n\nRelated-With: #3291", "committedDate": "2020-03-17T11:03:13Z", "type": "forcePushed"}, {"oid": "8d839f8563ef8b8fac55238a5dd7965bfff6c308", "url": "https://github.com/telstra/open-kilda/commit/8d839f8563ef8b8fac55238a5dd7965bfff6c308", "message": "Implement flow read in v2 over nbworker\n\nAdded:\n- /v2/flows\n- /v2/flows/{flow_id}\n- /v2/flows{flow_id}/status\nChanged:\n- /v1/flows\n- /v1/flows/{flow-id}\n- /v1/flows/{flow-id}/status\n\nv1 api started using nbworker topology for read requests as well\n\nlogic is moved to nb-worker topology\n\nRelated-With: #3291", "committedDate": "2020-03-18T09:19:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIzNjY4MQ==", "url": "https://github.com/telstra/open-kilda/pull/3293#discussion_r394236681", "bodyText": "FlowResponseV2", "author": "rtretyak", "createdAt": "2020-03-18T10:14:57Z", "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/controller/v2/FlowControllerV2.java", "diffHunk": "@@ -78,6 +82,43 @@\n         return flowService.deleteFlowV2(flowId);\n     }\n \n+    /**\n+     * Gets flow.\n+     *\n+     * @param flowId        flow id\n+     * @return flow\n+     */\n+    @ApiOperation(value = \"Gets flow\", response = FlowResponsePayload.class)", "originalCommit": "8d839f8563ef8b8fac55238a5dd7965bfff6c308", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIzNjgyOA==", "url": "https://github.com/telstra/open-kilda/pull/3293#discussion_r394236828", "bodyText": "FlowResponseV2", "author": "rtretyak", "createdAt": "2020-03-18T10:15:13Z", "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/controller/v2/FlowControllerV2.java", "diffHunk": "@@ -78,6 +82,43 @@\n         return flowService.deleteFlowV2(flowId);\n     }\n \n+    /**\n+     * Gets flow.\n+     *\n+     * @param flowId        flow id\n+     * @return flow\n+     */\n+    @ApiOperation(value = \"Gets flow\", response = FlowResponsePayload.class)\n+    @GetMapping(value = \"/{flow_id:.+}\")\n+    @ResponseStatus(HttpStatus.OK)\n+    public CompletableFuture<FlowResponseV2> getFlow(@PathVariable(name = \"flow_id\") String flowId) {\n+        return flowService.getFlowV2(flowId);\n+    }\n+\n+    /**\n+     * Dumps all flows. Dumps all flows with specific status if specified.\n+     *\n+     * @return list of flow\n+     */\n+    @ApiOperation(value = \"Dumps all flows\", response = FlowResponsePayload.class, responseContainer = \"List\")", "originalCommit": "8d839f8563ef8b8fac55238a5dd7965bfff6c308", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bede76b5b73934ac5baf7e8e2260eedf913852bf", "url": "https://github.com/telstra/open-kilda/commit/bede76b5b73934ac5baf7e8e2260eedf913852bf", "message": "Implement flow read in v2 over nbworker\n\nAdded:\n- /v2/flows\n- /v2/flows/{flow_id}\n- /v2/flows{flow_id}/status\nChanged:\n- /v1/flows\n- /v1/flows/{flow-id}\n- /v1/flows/{flow-id}/status\n\nv1 api started using nbworker topology for read requests as well\n\nlogic is moved to nb-worker topology\n\nRelated-With: #3291", "committedDate": "2020-03-18T13:49:14Z", "type": "forcePushed"}, {"oid": "ccec0145a3feaf47052ded3abc843accd0ff92ab", "url": "https://github.com/telstra/open-kilda/commit/ccec0145a3feaf47052ded3abc843accd0ff92ab", "message": "Implement flow read in v2 over nbworker\n\nAdded:\n- /v2/flows\n- /v2/flows/{flow_id}\n- /v2/flows{flow_id}/status\nChanged:\n- /v1/flows\n- /v1/flows/{flow-id}\n- /v1/flows/{flow-id}/status\n\nv1 api started using nbworker topology for read requests as well\n\nlogic is moved to nb-worker topology\n\nRelated-With: #3291", "committedDate": "2020-03-19T06:34:05Z", "type": "forcePushed"}, {"oid": "976bd08d8769edb7300d042c3b48970c94171123", "url": "https://github.com/telstra/open-kilda/commit/976bd08d8769edb7300d042c3b48970c94171123", "message": "Implement flow read in v2 over nbworker\n\nAdded:\n- /v2/flows\n- /v2/flows/{flow_id}\n- /v2/flows{flow_id}/status\nChanged:\n- /v1/flows\n- /v1/flows/{flow-id}\n- /v1/flows/{flow-id}/status\n\nv1 api started using nbworker topology for read requests as well\n\nlogic is moved to nb-worker topology\n\nRelated-With: #3291", "committedDate": "2020-03-19T07:27:59Z", "type": "forcePushed"}, {"oid": "ed385911dedea0be67fc204c381847d25311db30", "url": "https://github.com/telstra/open-kilda/commit/ed385911dedea0be67fc204c381847d25311db30", "message": "Implement flow read in v2 over nbworker\n\nAdded:\n- /v2/flows\n- /v2/flows/{flow_id}\n- /v2/flows{flow_id}/status\nChanged:\n- /v1/flows\n- /v1/flows/{flow-id}\n- /v1/flows/{flow-id}/status\n\nv1 api started using nbworker topology for read requests as well\n\nlogic is moved to nb-worker topology\n\nRelated-With: #3291", "committedDate": "2020-03-20T07:27:08Z", "type": "forcePushed"}, {"oid": "5b5aa3a022cead5bf2e9c0f1168757544957b2da", "url": "https://github.com/telstra/open-kilda/commit/5b5aa3a022cead5bf2e9c0f1168757544957b2da", "message": "Implement flow read in v2 over nbworker\n\nAdded:\n- /v2/flows\n- /v2/flows/{flow_id}\n- /v2/flows{flow_id}/status\nChanged:\n- /v1/flows\n- /v1/flows/{flow-id}\n- /v1/flows/{flow-id}/status\n\nv1 api started using nbworker topology for read requests as well\n\nlogic is moved to nb-worker topology\n\nRelated-With: #3291", "committedDate": "2020-03-20T08:00:51Z", "type": "forcePushed"}, {"oid": "28c5069e1da3b16fed083a70664b8937a4cab524", "url": "https://github.com/telstra/open-kilda/commit/28c5069e1da3b16fed083a70664b8937a4cab524", "message": "Implement flow read in v2 over nbworker\n\nAdded:\n- /v2/flows\n- /v2/flows/{flow_id}\n- /v2/flows{flow_id}/status\nChanged:\n- /v1/flows\n- /v1/flows/{flow-id}\n- /v1/flows/{flow-id}/status\n\nv1 api started using nbworker topology for read requests as well\n\nlogic is moved to nb-worker topology\n\nRelated-With: #3291", "committedDate": "2020-03-20T16:00:04Z", "type": "forcePushed"}, {"oid": "fd2d1c095fb949b6ab3fe710ba56af82bace6585", "url": "https://github.com/telstra/open-kilda/commit/fd2d1c095fb949b6ab3fe710ba56af82bace6585", "message": "Implement flow read in v2 over nbworker\n\nAdded:\n- /v2/flows\n- /v2/flows/{flow_id}\n- /v2/flows{flow_id}/status\nChanged:\n- /v1/flows\n- /v1/flows/{flow-id}\n- /v1/flows/{flow-id}/status\n\nv1 api started using nbworker topology for read requests as well\n\nlogic is moved to nb-worker topology\n\nRelated-With: #3291", "committedDate": "2020-03-23T12:47:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk5NDM5Mg==", "url": "https://github.com/telstra/open-kilda/pull/3293#discussion_r396994392", "bodyText": "nit: as per the convention, it should be \"flow_id\"", "author": "sergii-iakovenko", "createdAt": "2020-03-24T09:02:23Z", "path": "src-java/nbworker-topology/nbworker-messaging/src/main/java/org/openkilda/messaging/nbtopology/request/FlowReadRequest.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/* Copyright 2020 Telstra Open Source\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ */\n+\n+package org.openkilda.messaging.nbtopology.request;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import lombok.EqualsAndHashCode;\n+import lombok.Value;\n+\n+/**\n+ * Represents flow read northbound request.\n+ */\n+@Value\n+@EqualsAndHashCode(callSuper = false)\n+public class FlowReadRequest extends FlowsBaseRequest {\n+\n+    private static final long serialVersionUID = 1L;\n+\n+    @JsonProperty(\"flowid\")", "originalCommit": "fd2d1c095fb949b6ab3fe710ba56af82bace6585", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzAwMDIxMg==", "url": "https://github.com/telstra/open-kilda/pull/3293#discussion_r397000212", "bodyText": "nit: does it make sense to have a dedicated mapper for PathStatus?", "author": "sergii-iakovenko", "createdAt": "2020-03-24T09:12:23Z", "path": "src-java/northbound-service/northbound/src/main/java/org/openkilda/northbound/converter/FlowMapper.java", "diffHunk": "@@ -215,9 +219,13 @@ default String encodeFlowState(FlowState state) {\n         return state.getState();\n     }\n \n+    @Mapping(target = \"mainPath\", source = \"mainFlowPathStatus\")\n+    @Mapping(target = \"protectedPath\", source = \"protectedFlowPathStatus\")\n+    PathStatus map(FlowStatusDetails flowStatusDetails);", "originalCommit": "fd2d1c095fb949b6ab3fe710ba56af82bace6585", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "63915809a503cf8a2eae797f95fc87967215e7fc", "url": "https://github.com/telstra/open-kilda/commit/63915809a503cf8a2eae797f95fc87967215e7fc", "message": "Implement flow read in v2 over nbworker\n\nAdded:\n- /v2/flows\n- /v2/flows/{flow_id}\n- /v2/flows{flow_id}/status\nChanged:\n- /v1/flows\n- /v1/flows/{flow-id}\n- /v1/flows/{flow-id}/status\n\nv1 api started using nbworker topology for read requests as well\n\nlogic is moved to nb-worker topology\n\nRelated-With: #3291", "committedDate": "2020-03-25T10:31:39Z", "type": "commit"}, {"oid": "63915809a503cf8a2eae797f95fc87967215e7fc", "url": "https://github.com/telstra/open-kilda/commit/63915809a503cf8a2eae797f95fc87967215e7fc", "message": "Implement flow read in v2 over nbworker\n\nAdded:\n- /v2/flows\n- /v2/flows/{flow_id}\n- /v2/flows{flow_id}/status\nChanged:\n- /v1/flows\n- /v1/flows/{flow-id}\n- /v1/flows/{flow-id}/status\n\nv1 api started using nbworker topology for read requests as well\n\nlogic is moved to nb-worker topology\n\nRelated-With: #3291", "committedDate": "2020-03-25T10:31:39Z", "type": "forcePushed"}, {"oid": "0c17f09efbdef072ca3ebf93b5bd5d93a792b2d9", "url": "https://github.com/telstra/open-kilda/commit/0c17f09efbdef072ca3ebf93b5bd5d93a792b2d9", "message": "Change existing v2 tests to use v2 flow read APIs", "committedDate": "2020-03-25T10:44:16Z", "type": "commit"}, {"oid": "a3132daa8ca835b9c37542698ac99e682efe7f85", "url": "https://github.com/telstra/open-kilda/commit/a3132daa8ca835b9c37542698ac99e682efe7f85", "message": "Implement flow read in v2 over nbworker\n\nAdded:\n- /v2/flows\n- /v2/flows/{flow_id}\n- /v2/flows{flow_id}/status\nChanged:\n- /v1/flows\n- /v1/flows/{flow-id}\n- /v1/flows/{flow-id}/status\n\nv1 api started using nbworker topology for read requests as well\n\nlogic is moved to nb-worker topology\n\nRelated-With: #3291", "committedDate": "2020-03-26T09:54:11Z", "type": "forcePushed"}, {"oid": "6df7821633d4b4c83c70dc55801edf12f80a1cec", "url": "https://github.com/telstra/open-kilda/commit/6df7821633d4b4c83c70dc55801edf12f80a1cec", "message": "Implement flow read in v2 over nbworker\n\nAdded:\n- /v2/flows\n- /v2/flows/{flow_id}\n- /v2/flows{flow_id}/status\nChanged:\n- /v1/flows\n- /v1/flows/{flow-id}\n- /v1/flows/{flow-id}/status\n\nv1 api started using nbworker topology for read requests as well\n\nlogic is moved to nb-worker topology\n\nRelated-With: #3291", "committedDate": "2020-03-27T16:05:04Z", "type": "forcePushed"}, {"oid": "010b3f18aaf5b2228ca6cc84d2c893631d2c8552", "url": "https://github.com/telstra/open-kilda/commit/010b3f18aaf5b2228ca6cc84d2c893631d2c8552", "message": "Change existing v2 tests to use v2 flow read APIs", "committedDate": "2020-04-06T10:29:25Z", "type": "forcePushed"}, {"oid": "a5b988f859ead212d104156e7b51b55ba186ec69", "url": "https://github.com/telstra/open-kilda/commit/a5b988f859ead212d104156e7b51b55ba186ec69", "message": "Implement flow read in v2 over nbworker\n\nAdded:\n- /v2/flows\n- /v2/flows/{flow_id}\n- /v2/flows{flow_id}/status\nChanged:\n- /v1/flows\n- /v1/flows/{flow-id}\n- /v1/flows/{flow-id}/status\n\nv1 api started using nbworker topology for read requests as well\n\nlogic is moved to nb-worker topology\n\nRelated-With: #3291", "committedDate": "2020-04-06T15:00:47Z", "type": "commit"}, {"oid": "a5b988f859ead212d104156e7b51b55ba186ec69", "url": "https://github.com/telstra/open-kilda/commit/a5b988f859ead212d104156e7b51b55ba186ec69", "message": "Implement flow read in v2 over nbworker\n\nAdded:\n- /v2/flows\n- /v2/flows/{flow_id}\n- /v2/flows{flow_id}/status\nChanged:\n- /v1/flows\n- /v1/flows/{flow-id}\n- /v1/flows/{flow-id}/status\n\nv1 api started using nbworker topology for read requests as well\n\nlogic is moved to nb-worker topology\n\nRelated-With: #3291", "committedDate": "2020-04-06T15:00:47Z", "type": "forcePushed"}, {"oid": "c6e28011fd0a401180d25877246854a48a9db95c", "url": "https://github.com/telstra/open-kilda/commit/c6e28011fd0a401180d25877246854a48a9db95c", "message": "Merge branch 'functional/read_flows_v2' into flow_v2_read", "committedDate": "2020-04-06T19:05:59Z", "type": "commit"}, {"oid": "c6e28011fd0a401180d25877246854a48a9db95c", "url": "https://github.com/telstra/open-kilda/commit/c6e28011fd0a401180d25877246854a48a9db95c", "message": "Merge branch 'functional/read_flows_v2' into flow_v2_read", "committedDate": "2020-04-06T19:05:59Z", "type": "forcePushed"}, {"oid": "bea9c86619d49a4a3db02e1273ad2d86bee8d520", "url": "https://github.com/telstra/open-kilda/commit/bea9c86619d49a4a3db02e1273ad2d86bee8d520", "message": "Fix for Unable to load NODE issue during flow read", "committedDate": "2020-04-07T07:22:51Z", "type": "commit"}]}