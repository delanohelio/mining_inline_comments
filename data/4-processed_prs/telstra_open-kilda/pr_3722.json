{"pr_number": 3722, "pr_title": "Add functional tests for bfd v2 api", "pr_createdAt": "2020-09-14T13:08:09Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3722", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk0NDE2Nw==", "url": "https://github.com/telstra/open-kilda/pull/3722#discussion_r487944167", "bodyText": "@Tidy?", "author": "andriidovhan", "createdAt": "2020-09-14T13:59:22Z", "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/links/BfdSpec.groovy", "diffHunk": "@@ -245,4 +296,142 @@ class BfdSpec extends HealthCheckSpecification {\n             }\n         }\n     }\n+\n+    def \"Able to create/update BFD session with custom properties\"() {", "originalCommit": "636f3d40aeb9e5ec645ffa83a801ecb3c9ef4055", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk0NDU2Ng==", "url": "https://github.com/telstra/open-kilda/pull/3722#discussion_r487944566", "bodyText": "@Tidy?", "author": "andriidovhan", "createdAt": "2020-09-14T13:59:46Z", "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/links/BfdSpec.groovy", "diffHunk": "@@ -245,4 +296,142 @@ class BfdSpec extends HealthCheckSpecification {\n             }\n         }\n     }\n+\n+    def \"Able to create/update BFD session with custom properties\"() {\n+        given: \"An ISL between two Noviflow switches\"\n+        def isl = topology.islsForActiveSwitches.find { it.srcSwitch.noviflow && it.dstSwitch.noviflow }\n+        assumeTrue(\"The test requires at least one BFD ISL\", isl as boolean)\n+\n+        when: \"Create bfd session with custom properties\"\n+        def bfdProps = new BfdProperties(100, (short)1)\n+        northboundV2.setLinkBfd(isl, bfdProps)\n+\n+        then: \"'get ISL' and 'get BFD' api reflect the changes\"\n+        Wrappers.wait(WAIT_OFFSET / 2) {\n+            [isl, isl.reversed].each {\n+                verifyAll(northbound.getLink(it)) {\n+                    enableBfd\n+                    bfdSessionStatus == \"up\"\n+                }\n+                verifyAll(northboundV2.getLinkBfd(it)) {\n+                    properties == bfdProps\n+                    effectiveSource.properties == bfdProps\n+                    effectiveDestination.properties == bfdProps\n+                }\n+            }\n+        }\n+\n+        when: \"Update bfd session with custom properties\"\n+        def updatedBfdProps = new BfdProperties(500, (short)5)\n+        northboundV2.setLinkBfd(isl, updatedBfdProps)\n+\n+        then: \"'get ISL' and 'get BFD' api reflect the changes\"\n+        Wrappers.wait(WAIT_OFFSET / 2) {\n+            [isl, isl.reversed].each {\n+                verifyAll(northbound.getLink(it)) {\n+                    enableBfd\n+                    bfdSessionStatus == \"up\"\n+                }\n+                verifyAll(northboundV2.getLinkBfd(it)) {\n+                    properties == updatedBfdProps\n+                    effectiveSource.properties == updatedBfdProps\n+                    effectiveDestination.properties == updatedBfdProps\n+                }\n+            }\n+        }\n+\n+        cleanup: \"Disable bfd\"\n+        bfdProps && northboundV2.deleteLinkBfd(isl)\n+    }\n+\n+    @Unroll\n+    def \"Unable to create bfd with #data.descr\"() {\n+        given: \"An ISL between two Noviflow switches\"\n+        def isl = topology.islsForActiveSwitches.find { it.srcSwitch.noviflow && it.dstSwitch.noviflow }\n+        assumeTrue(\"The test requires at least one BFD ISL\", isl as boolean)\n+\n+        when: \"Try enabling bfd with forbidden properties\"\n+        northboundV2.setLinkBfd(isl, data.props)\n+\n+        then: \"Error is returned\"\n+        def e = thrown(HttpClientErrorException)\n+        e.statusCode == HttpStatus.BAD_REQUEST\n+\n+        where:\n+        data << [\n+                [\n+                        descr: \"too small interval\",\n+                        props: new BfdProperties(99, (short)1)\n+                ],\n+                [\n+                        descr: \"too small multiplier\",\n+                        props: new BfdProperties(100, (short)0)\n+                ]\n+        ]\n+    }\n+\n+    def \"Able to CRUD BFD sessions using v1 API\"() {", "originalCommit": "636f3d40aeb9e5ec645ffa83a801ecb3c9ef4055", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "262a42f5ad0c9ea9253cf01f159d9a25008b466c", "url": "https://github.com/telstra/open-kilda/commit/262a42f5ad0c9ea9253cf01f159d9a25008b466c", "message": "Add functional tests for bfd v2 api", "committedDate": "2020-09-23T06:39:09Z", "type": "forcePushed"}, {"oid": "707f638d1ecd889949e0921520e20aecdd7c35d1", "url": "https://github.com/telstra/open-kilda/commit/707f638d1ecd889949e0921520e20aecdd7c35d1", "message": "Add functional tests for bfd v2 api", "committedDate": "2020-09-23T06:43:40Z", "type": "forcePushed"}, {"oid": "3b906351fe14bb366702d4753ecdaedc1ec6bf3d", "url": "https://github.com/telstra/open-kilda/commit/3b906351fe14bb366702d4753ecdaedc1ec6bf3d", "message": "Add functional tests for bfd v2 api", "committedDate": "2020-10-15T10:57:59Z", "type": "forcePushed"}, {"oid": "4482b1f52085194ac9af3ab6cbe60893b6bd50c2", "url": "https://github.com/telstra/open-kilda/commit/4482b1f52085194ac9af3ab6cbe60893b6bd50c2", "message": "Add functional tests for v2 bfd api", "committedDate": "2020-10-19T09:08:56Z", "type": "forcePushed"}, {"oid": "78ffdddce140372cc26191685f8694a2a62fc94b", "url": "https://github.com/telstra/open-kilda/commit/78ffdddce140372cc26191685f8694a2a62fc94b", "message": "Add functional tests for v2 bfd api", "committedDate": "2020-10-19T12:27:15Z", "type": "forcePushed"}, {"oid": "975d7f0db653d6e9061affade0da74c4bb102e19", "url": "https://github.com/telstra/open-kilda/commit/975d7f0db653d6e9061affade0da74c4bb102e19", "message": "Add functional tests for v2 bfd api", "committedDate": "2020-10-23T11:42:12Z", "type": "forcePushed"}, {"oid": "9eb2c18d2a64fc49cba44505ce6589389c5f2cad", "url": "https://github.com/telstra/open-kilda/commit/9eb2c18d2a64fc49cba44505ce6589389c5f2cad", "message": "Add functional tests for v2 bfd api", "committedDate": "2020-10-23T13:06:00Z", "type": "forcePushed"}, {"oid": "860f69b8061f4b831981117653065c7f8427bc60", "url": "https://github.com/telstra/open-kilda/commit/860f69b8061f4b831981117653065c7f8427bc60", "message": "Add functional tests for bfd v2 api", "committedDate": "2020-10-27T11:37:25Z", "type": "commit"}, {"oid": "860f69b8061f4b831981117653065c7f8427bc60", "url": "https://github.com/telstra/open-kilda/commit/860f69b8061f4b831981117653065c7f8427bc60", "message": "Add functional tests for bfd v2 api", "committedDate": "2020-10-27T11:37:25Z", "type": "forcePushed"}]}