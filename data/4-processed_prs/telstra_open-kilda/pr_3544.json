{"pr_number": 3544, "pr_title": "Minor stability adjustments in tests", "pr_createdAt": "2020-06-16T09:05:50Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3544", "timeline": [{"oid": "05eef7190cbeed9d6a41ca62a25cc4778475b5bd", "url": "https://github.com/telstra/open-kilda/commit/05eef7190cbeed9d6a41ca62a25cc4778475b5bd", "message": "Minor stability adjustments in tests", "committedDate": "2020-06-16T09:19:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyMzY5OA==", "url": "https://github.com/telstra/open-kilda/pull/3544#discussion_r440823698", "bodyText": "You can use spaceship(v1 <=> v2) operator", "author": "andriidovhan", "createdAt": "2020-06-16T12:50:23Z", "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/grpc/GrpcBaseSpecification.groovy", "diffHunk": "@@ -36,9 +36,33 @@ class GrpcBaseSpecification extends HealthCheckSpecification {\n                     false, \"of_version\", \"manufacturer\", \"hardware\", \"software\", \"serial_number\") as List\n         } else {\n             northbound.activeSwitches.findAll {\n-                def matcher = it.description =~ /NW[0-9]+.([0-9].[0-9])/\n-                return matcher && matcher[0][1] >= \"2.7\"\n+                it.manufacturer.toLowerCase().contains(\"noviflow\") &&\n+                        compareNoviVersions(it.software, \"500.2.7\") >= 0\n             }.unique { [it.hardware, it.software] }\n         }\n     }\n+\n+    /**\n+     * Compare 2 version strings. Must have equal amount of number groups, e.g. 500.0.0.1 and 49.555.45.0\n+     * @return '1' if v1 > v2, '-1' if v1 < v2, '0' if equal\n+     */\n+    int compareNoviVersions(String v1, String v2) {\n+        def pattern = /\\d+/\n+        def v1Matcher = v1 =~ pattern\n+        def v2Matcher = v2 =~ pattern\n+        if (!v1Matcher || !v2Matcher || v1Matcher.size() != v2Matcher.size()) {\n+            throw new RuntimeException(\"Unable to compare given version strings: $v1 and $v2\")\n+        }\n+        def v1Numbers = v1Matcher.collect { it[0] }\n+        def v2Numbers = v2Matcher.collect { it[0] }\n+        for (int i = 0; i < v1Numbers.size(); i++) {\n+            if (v1Numbers[i] > v2Numbers[i]) {\n+                return 1\n+            } else if (v1Numbers[i] < v2Numbers[i]) {\n+                return -1\n+            }\n+        }\n+        return 0\n+    }", "originalCommit": "05eef7190cbeed9d6a41ca62a25cc4778475b5bd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk1MjEwMQ==", "url": "https://github.com/telstra/open-kilda/pull/3544#discussion_r440952101", "bodyText": "to achieve what result? v1 and v2 are strings, I don't need to compare strings, I need to compare versions.\n\"500.2.12\" <=> \"500.2.7\" == -1\nbut compareNoviVersions(\"500.2.12\", \"500.2.7\") == 1", "author": "rtretyak", "createdAt": "2020-06-16T15:41:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyMzY5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEwNTg2Mw==", "url": "https://github.com/telstra/open-kilda/pull/3544#discussion_r441105863", "bodyText": "agree, this operator doesn't work well with string", "author": "andriidovhan", "createdAt": "2020-06-16T19:56:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgyMzY5OA=="}], "type": "inlineReview"}, {"oid": "60de6a108590877fed3fe607ed3423c4b97eb3ee", "url": "https://github.com/telstra/open-kilda/commit/60de6a108590877fed3fe607ed3423c4b97eb3ee", "message": "Minor stability adjustments in tests", "committedDate": "2020-06-16T15:48:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEwNDA3OA==", "url": "https://github.com/telstra/open-kilda/pull/3544#discussion_r441104078", "bodyText": "what's wrong with that?", "author": "andriidovhan", "createdAt": "2020-06-16T19:52:44Z", "path": "src-java/projectfloodlight/openflowj/build.gradle", "diffHunk": "@@ -46,9 +46,9 @@ task generateSources(type: Exec, dependsOn: cloneLoxigenRepo) {\n         commandLine 'make', 'java'\n     }\n     else {\n-        def uid = new UnixSystem().getUid()\n-        def gid = new UnixSystem().getGid()\n-        commandLine 'docker', 'run', '--rm', '-v', \"$workingDir:$workingDir\", '-w', \"$workingDir\", '-u', \"$uid:$gid\", 'kilda/base-ubuntu', 'make', 'java'\n+//        def uid = new UnixSystem().getUid()", "originalCommit": "60de6a108590877fed3fe607ed3423c4b97eb3ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM0MzE3Ng==", "url": "https://github.com/telstra/open-kilda/pull/3544#discussion_r441343176", "bodyText": "ops, accidentally committed from my windows machine -_-\nreverted changes in this file", "author": "rtretyak", "createdAt": "2020-06-17T07:38:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEwNDA3OA=="}], "type": "inlineReview"}, {"oid": "3bab8eec31c6bd81ebf75479529a71df15472592", "url": "https://github.com/telstra/open-kilda/commit/3bab8eec31c6bd81ebf75479529a71df15472592", "message": "Minor stability adjustments in tests", "committedDate": "2020-06-17T07:40:30Z", "type": "forcePushed"}, {"oid": "028c8de06d345fefcfcd17b22590a539bd510037", "url": "https://github.com/telstra/open-kilda/commit/028c8de06d345fefcfcd17b22590a539bd510037", "message": "Minor stability adjustments in tests", "committedDate": "2020-06-18T08:40:46Z", "type": "forcePushed"}, {"oid": "a15dedd31b47dd56bf3f91f494d471116fb8b638", "url": "https://github.com/telstra/open-kilda/commit/a15dedd31b47dd56bf3f91f494d471116fb8b638", "message": "Minor stability adjustments in tests", "committedDate": "2020-06-19T09:01:14Z", "type": "commit"}, {"oid": "a15dedd31b47dd56bf3f91f494d471116fb8b638", "url": "https://github.com/telstra/open-kilda/commit/a15dedd31b47dd56bf3f91f494d471116fb8b638", "message": "Minor stability adjustments in tests", "committedDate": "2020-06-19T09:01:14Z", "type": "forcePushed"}]}