{"pr_number": 3197, "pr_title": "improve test according to #3194", "pr_createdAt": "2020-02-12T12:42:06Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3197", "timeline": [{"oid": "ae0c0f2ed241535c06019ff87994bdcbc629c17b", "url": "https://github.com/telstra/open-kilda/commit/ae0c0f2ed241535c06019ff87994bdcbc629c17b", "message": "improve test according to #3194", "committedDate": "2020-02-12T12:42:38Z", "type": "forcePushed"}, {"oid": "11739be2bb6c136ba9d4c7f5820a617dd122ac85", "url": "https://github.com/telstra/open-kilda/commit/11739be2bb6c136ba9d4c7f5820a617dd122ac85", "message": "improve test according to #3194", "committedDate": "2020-02-19T11:35:08Z", "type": "forcePushed"}, {"oid": "ecbd80fe93e93d3d49e61efe9197be22a46d4965", "url": "https://github.com/telstra/open-kilda/commit/ecbd80fe93e93d3d49e61efe9197be22a46d4965", "message": "improve test according to #3194", "committedDate": "2020-02-21T09:31:59Z", "type": "commit"}, {"oid": "ecbd80fe93e93d3d49e61efe9197be22a46d4965", "url": "https://github.com/telstra/open-kilda/commit/ecbd80fe93e93d3d49e61efe9197be22a46d4965", "message": "improve test according to #3194", "committedDate": "2020-02-21T09:31:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ5Mjg2OQ==", "url": "https://github.com/telstra/open-kilda/pull/3197#discussion_r382492869", "bodyText": "I'd appreciate a brief comment about why we expect '5' here. This is not obvious", "author": "rtretyak", "createdAt": "2020-02-21T09:58:16Z", "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/AutoRerouteV2Spec.groovy", "diffHunk": "@@ -475,11 +478,17 @@ class AutoRerouteV2Spec extends HealthCheckSpecification {\n         }\n \n         and: \"Flow is rerouted due to switchUp event\"\n-        //TODO(andriidovhan) specify flow history verification(it is not implemented yet) Reroute reason: switchUp event\n         Wrappers.wait(WAIT_OFFSET / 2) {\n-            assert northbound.getFlowHistory(firstFlow.flowId).findAll { it.action == \"Flow rerouting\" }.size() == 2\n-\n-            assert northbound.getFlowHistory(secondFlow.flowId).findAll { it.action == \"Flow rerouting\" }.size() == 5\n+            def firstFlowHistory = northbound.getFlowHistory(firstFlow.flowId).findAll { it.action == \"Flow rerouting\" }\n+            assert firstFlowHistory.size() == 2\n+            assert firstFlowHistory.find {\n+                it.details == \"Reason: initiated by Reroute topology: Switch '$switchPair1.src.dpId' online\"\n+            }\n+            def secondFlowHistory = northbound.getFlowHistory(secondFlow.flowId).findAll { it.action == \"Flow rerouting\" }\n+            assert secondFlowHistory.findAll { it.action == \"Flow rerouting\" }.size() == 5", "originalCommit": "ecbd80fe93e93d3d49e61efe9197be22a46d4965", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}