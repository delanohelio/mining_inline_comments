{"pr_number": 3148, "pr_title": "Periodic pings perf", "pr_createdAt": "2020-01-27T16:19:01Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3148", "timeline": [{"oid": "fe7f20f0f2740a20e47701524fd1bbae4855f8fa", "url": "https://github.com/telstra/open-kilda/commit/fe7f20f0f2740a20e47701524fd1bbae4855f8fa", "message": "Add periodic pings to flow patch api", "committedDate": "2020-01-27T19:17:34Z", "type": "forcePushed"}, {"oid": "a29e42e56cfbc6bec244d9f7e8ac6d3bdeeb4bca", "url": "https://github.com/telstra/open-kilda/commit/a29e42e56cfbc6bec244d9f7e8ac6d3bdeeb4bca", "message": "Add periodic pings to flow patch api", "committedDate": "2020-01-27T19:55:08Z", "type": "forcePushed"}, {"oid": "71468d88ecf93480409e5c48115d1484fd81a409", "url": "https://github.com/telstra/open-kilda/commit/71468d88ecf93480409e5c48115d1484fd81a409", "message": "Add periodic pings to flow patch api", "committedDate": "2020-01-28T05:58:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYyMjU2MQ==", "url": "https://github.com/telstra/open-kilda/pull/3148#discussion_r371622561", "bodyText": "(nit)  Boolean.TRUE.equals(forward.getPeriodicPings())", "author": "niksv", "createdAt": "2020-01-28T06:04:56Z", "path": "services/src/messaging/src/main/java/org/openkilda/messaging/model/BidirectionalFlowDto.java", "diffHunk": "@@ -70,7 +70,7 @@ public BidirectionalFlowDto(FlowDto forward, FlowDto reverse) {\n         this(forward.getFlowId(),\n                 forward.getBandwidth(),\n                 forward.isIgnoreBandwidth(),\n-                forward.isPeriodicPings(),\n+                forward.getPeriodicPings() != null ? forward.getPeriodicPings() : false,", "originalCommit": "71468d88ecf93480409e5c48115d1484fd81a409", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYyMjY2MA==", "url": "https://github.com/telstra/open-kilda/pull/3148#discussion_r371622660", "bodyText": "same", "author": "niksv", "createdAt": "2020-01-28T06:05:29Z", "path": "services/wfm/src/main/java/org/openkilda/wfm/share/mappers/FlowMapper.java", "diffHunk": "@@ -282,7 +282,7 @@ private Flow buildFlow(FlowDto flow, Supplier<KildaConfiguration> kildaConfigura\n                 .description(flow.getDescription())\n                 .bandwidth(flow.getBandwidth())\n                 .ignoreBandwidth(flow.isIgnoreBandwidth())\n-                .periodicPings(flow.isPeriodicPings())\n+                .periodicPings(flow.getPeriodicPings() != null ? flow.getPeriodicPings() : false)", "originalCommit": "71468d88ecf93480409e5c48115d1484fd81a409", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYyNDY0Nw==", "url": "https://github.com/telstra/open-kilda/pull/3148#discussion_r371624647", "bodyText": "should it be StreamType.PING.toString() instead of stream.toString() ?", "author": "niksv", "createdAt": "2020-01-28T06:15:19Z", "path": "services/wfm/src/main/java/org/openkilda/wfm/topology/flow/bolts/CrudBolt.java", "diffHunk": "@@ -795,5 +802,14 @@ public void sendFlowCommands(@NonNull String flowId, @NonNull List<CommandGroup>\n                     System.currentTimeMillis(), correlationId);\n             outputCollector.emit(stream.toString(), tuple, new Values(message, flowId));\n         }\n+\n+        @Override\n+        public void sendPeriodicPingNotification(@NonNull String flowId, boolean enabled) {\n+            CommandMessage message = new CommandMessage(\n+                    new PeriodicPingCommand(flowId, enabled),\n+                    System.currentTimeMillis(), correlationId);\n+\n+            outputCollector.emit(stream.toString(), tuple, new Values(correlationId, message));", "originalCommit": "71468d88ecf93480409e5c48115d1484fd81a409", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYyOTA5MA==", "url": "https://github.com/telstra/open-kilda/pull/3148#discussion_r371629090", "bodyText": "No, it should be fine, p.s. this aligned with sendFlowCommands", "author": "timofei-durakov", "createdAt": "2020-01-28T06:37:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYyNDY0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYyNTI3Nw==", "url": "https://github.com/telstra/open-kilda/pull/3148#discussion_r371625277", "bodyText": "what if there is no such flow?", "author": "niksv", "createdAt": "2020-01-28T06:18:29Z", "path": "services/wfm/src/main/java/org/openkilda/wfm/topology/flow/service/FlowService.java", "diffHunk": "@@ -1539,6 +1539,17 @@ private void unwrapBaseFaisafeException(FailsafeException e) throws UnroutableFl\n         return swapFlows(currentFirstFlow, existingFirstFlow, currentSecondFlow, existingSecondFlow, sender);\n     }\n \n+    /**\n+     * Fetch flow and provide update on it's periodic pings.\n+     * @param flowId flow id\n+     * @param sender interface\n+     */\n+    public void notifyOnPeriodicPingChanges(String flowId,\n+                                            FlowCommandSender sender) {\n+        Flow flow = flowRepository.findById(flowId).get();", "originalCommit": "71468d88ecf93480409e5c48115d1484fd81a409", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYyOTUwMA==", "url": "https://github.com/telstra/open-kilda/pull/3148#discussion_r371629500", "bodyText": "it will be cleaned up by periodic pings cache flush in ping topo with a one minute delay", "author": "timofei-durakov", "createdAt": "2020-01-28T06:38:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYyNTI3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYyNTUyOQ==", "url": "https://github.com/telstra/open-kilda/pull/3148#discussion_r371625529", "bodyText": "(nit) two spaces :)", "author": "niksv", "createdAt": "2020-01-28T06:19:49Z", "path": "services/wfm/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/update/actions/OnFinishedAction.java", "diffHunk": "@@ -38,8 +39,12 @@ public OnFinishedAction(FlowOperationsDashboardLogger dashboardLogger) {\n     @Override\n     public void perform(State from, State to, Event event, FlowUpdateContext context, FlowUpdateFsm stateMachine) {\n         if (stateMachine.getNewFlowStatus() == FlowStatus.UP) {\n+            RequestedFlow requestedFlow =  stateMachine.getTargetFlow();", "originalCommit": "71468d88ecf93480409e5c48115d1484fd81a409", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4ddb55b726f2a84372950c94e611d572305e6a7c", "url": "https://github.com/telstra/open-kilda/commit/4ddb55b726f2a84372950c94e611d572305e6a7c", "message": "Add periodic pings to flow patch api", "committedDate": "2020-01-28T06:43:56Z", "type": "forcePushed"}, {"oid": "1405caac25e3afd7bc09738a19e5cdd5ce086b08", "url": "https://github.com/telstra/open-kilda/commit/1405caac25e3afd7bc09738a19e5cdd5ce086b08", "message": "Add periodic pings to flow patch api", "committedDate": "2020-01-28T11:00:04Z", "type": "forcePushed"}, {"oid": "4462f173469dc63015bc6e213176b81553720dbb", "url": "https://github.com/telstra/open-kilda/commit/4462f173469dc63015bc6e213176b81553720dbb", "message": "Add external events for periodic ping", "committedDate": "2020-01-28T14:45:00Z", "type": "commit"}, {"oid": "96f400270272f8b8aa3f60331cdfbf26e6f81372", "url": "https://github.com/telstra/open-kilda/commit/96f400270272f8b8aa3f60331cdfbf26e6f81372", "message": "Add periodic pings to flow patch api", "committedDate": "2020-01-28T14:45:00Z", "type": "commit"}, {"oid": "96f400270272f8b8aa3f60331cdfbf26e6f81372", "url": "https://github.com/telstra/open-kilda/commit/96f400270272f8b8aa3f60331cdfbf26e6f81372", "message": "Add periodic pings to flow patch api", "committedDate": "2020-01-28T14:45:00Z", "type": "forcePushed"}]}