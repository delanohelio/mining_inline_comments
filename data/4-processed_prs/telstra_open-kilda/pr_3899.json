{"pr_number": 3899, "pr_title": "refactor vxlan related tests", "pr_createdAt": "2020-12-02T13:07:00Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3899", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk3NTU2NQ==", "url": "https://github.com/telstra/open-kilda/pull/3899#discussion_r539975565", "bodyText": "not sure why it's required here. I don't see any vxlan context in this test", "author": "rtretyak", "createdAt": "2020-12-10T08:39:05Z", "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/QinQFlowSpec.groovy", "diffHunk": "@@ -842,7 +842,9 @@ class QinQFlowSpec extends HealthCheckSpecification {\n         assumeTrue(\"Unable to find required switches in topology\", (allTraffGenSwitches.size() > 1))\n         def swP = topologyHelper.getAllNeighboringSwitchPairs().find {\n             [it.src, it.dst].every { sw ->\n-                sw.dpId in allTraffGenSwitches*.dpId && northbound.getSwitchProperties(sw.dpId).multiTable\n+                sw.dpId in allTraffGenSwitches*.dpId && northbound.getSwitchProperties(sw.dpId).multiTable &&\n+                        northbound.getSwitchProperties(sw.dpId).supportedTransitEncapsulation\n+                                .contains(FlowEncapsulationType.VXLAN.toString().toLowerCase())", "originalCommit": "51a5bbc628a609d28885ec6f2acab005aab11425", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA0MTE4Nw==", "url": "https://github.com/telstra/open-kilda/pull/3899#discussion_r540041187", "bodyText": "looks like my mistake. fixed", "author": "andriidovhan", "createdAt": "2020-12-10T10:11:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk3NTU2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk3NzY3MQ==", "url": "https://github.com/telstra/open-kilda/pull/3899#discussion_r539977671", "bodyText": "isVxlanEnabled ?", "author": "rtretyak", "createdAt": "2020-12-10T08:42:23Z", "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/VxlanFlowV2Spec.groovy", "diffHunk": "@@ -241,14 +242,18 @@ class VxlanFlowV2Spec extends HealthCheckSpecification {\n     @Tidy\n     @Tags(HARDWARE)\n     def \"Able to CRUD a vxlan flow with protected path\"() {\n-        given: \"Two active Noviflow switches with two available path at least\"\n-        def switchPair = topologyHelper.getAllNeighboringSwitchPairs().find {\n-            it.src.noviflow && !it.src.wb5164 && it.dst.noviflow && !it.dst.wb5164 &&\n-                    it.paths.unique(false) { a, b -> a.intersect(b) == [] ? 1 : 0 }.size() >= 2\n+        given: \"Two active VXLAN supported switches with two available path at least\"\n+        def switchPair = topologyHelper.getAllNeighboringSwitchPairs().find { swP ->\n+            [swP.src, swP.dst].every { sw -> isVxlanEnabled(sw.dpId) } && swP.paths.unique(false) {\n+                a, b -> a.intersect(b) == [] ? 1 : 0\n+            }.size() >= 2\n         } ?: assumeTrue(\"No suiting switches found\", false)\n \n         def availablePaths = switchPair.paths.findAll { path ->\n-            pathHelper.getInvolvedSwitches(path).every { it.noviflow && !it.wb5164 }\n+            pathHelper.getInvolvedSwitches(path).every {\n+                northbound.getSwitchProperties(it.dpId).supportedTransitEncapsulation", "originalCommit": "51a5bbc628a609d28885ec6f2acab005aab11425", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA0NDIwMQ==", "url": "https://github.com/telstra/open-kilda/pull/3899#discussion_r540044201", "bodyText": "fixed", "author": "andriidovhan", "createdAt": "2020-12-10T10:15:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk3NzY3MQ=="}], "type": "inlineReview"}, {"oid": "6254aa4c5dcac8bda602c1b57fd06a90e8d18f03", "url": "https://github.com/telstra/open-kilda/commit/6254aa4c5dcac8bda602c1b57fd06a90e8d18f03", "message": "refactor vxlan related tests", "committedDate": "2020-12-10T10:14:46Z", "type": "forcePushed"}, {"oid": "8c72b58a35eb8c6e764e6109100b47cfb7fa7f07", "url": "https://github.com/telstra/open-kilda/commit/8c72b58a35eb8c6e764e6109100b47cfb7fa7f07", "message": "refactor vxlan related tests", "committedDate": "2020-12-10T17:10:36Z", "type": "commit"}, {"oid": "8c72b58a35eb8c6e764e6109100b47cfb7fa7f07", "url": "https://github.com/telstra/open-kilda/commit/8c72b58a35eb8c6e764e6109100b47cfb7fa7f07", "message": "refactor vxlan related tests", "committedDate": "2020-12-10T17:10:36Z", "type": "forcePushed"}]}