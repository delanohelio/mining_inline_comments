{"pr_number": 3830, "pr_title": "Fight port down and discovery events race condition", "pr_createdAt": "2020-11-05T20:21:27Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3830", "timeline": [{"oid": "9efbc176583eb6a245a259b55d4798b1516cdfa0", "url": "https://github.com/telstra/open-kilda/commit/9efbc176583eb6a245a259b55d4798b1516cdfa0", "message": "Fight port down and discovery events race condition", "committedDate": "2020-11-06T07:16:49Z", "type": "forcePushed"}, {"oid": "c6e58f19624eb51fd917eaf42ee0447d6bbc351c", "url": "https://github.com/telstra/open-kilda/commit/c6e58f19624eb51fd917eaf42ee0447d6bbc351c", "message": "Fight port down and discovery events race condition", "committedDate": "2020-11-06T16:15:18Z", "type": "forcePushed"}, {"oid": "f352a1c69c5313984f9680ec99470db93aede905", "url": "https://github.com/telstra/open-kilda/commit/f352a1c69c5313984f9680ec99470db93aede905", "message": "Fight port down and discovery events race condition", "committedDate": "2020-11-16T08:27:14Z", "type": "commit"}, {"oid": "f352a1c69c5313984f9680ec99470db93aede905", "url": "https://github.com/telstra/open-kilda/commit/f352a1c69c5313984f9680ec99470db93aede905", "message": "Fight port down and discovery events race condition", "committedDate": "2020-11-16T08:27:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk2NzA2OA==", "url": "https://github.com/telstra/open-kilda/pull/3830#discussion_r523967068", "bodyText": "resetting reset :)", "author": "niksv", "createdAt": "2020-11-16T08:28:30Z", "path": "src-java/network-topology/network-storm-topology/src/main/java/org/openkilda/wfm/topology/network/controller/isl/DiscoveryPortStatusMonitor.java", "diffHunk": "@@ -22,25 +22,31 @@\n import org.openkilda.wfm.share.model.IslReference;\n import org.openkilda.wfm.topology.network.controller.isl.IslFsm.IslFsmContext;\n import org.openkilda.wfm.topology.network.controller.isl.IslFsm.IslFsmEvent;\n-import org.openkilda.wfm.topology.network.model.LinkStatus;\n+import org.openkilda.wfm.topology.network.model.IslEndpointPortStatus;\n+import org.openkilda.wfm.topology.network.model.RoundTripStatus;\n \n import lombok.extern.slf4j.Slf4j;\n \n import java.util.Optional;\n \n @Slf4j\n-public class DiscoveryPortStatusMonitor extends DiscoveryMonitor<LinkStatus> {\n+public class DiscoveryPortStatusMonitor extends DiscoveryMonitor<IslEndpointPortStatus> {\n+    // To avoid a race condition between port-down and round-trip updates we enforce to wait for at least\n+    // MIN_UPDATE_COUNT updates before resetting reset DOWN state on both endpoints.", "originalCommit": "f352a1c69c5313984f9680ec99470db93aede905", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}