{"pr_number": 3366, "pr_title": "Added GRPC service stub", "pr_createdAt": "2020-04-06T14:34:22Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3366", "timeline": [{"oid": "476f531b71b579d35f23b28f3c8f37bcb588f730", "url": "https://github.com/telstra/open-kilda/commit/476f531b71b579d35f23b28f3c8f37bcb588f730", "message": "Added GRPC service stub", "committedDate": "2020-04-07T05:47:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTUwMzE3NA==", "url": "https://github.com/telstra/open-kilda/pull/3366#discussion_r405503174", "bodyText": "tbh this doesn't look like a mandatory part of the system, thus should be wrapped with {{if not (exists \"/no_grpc_stub\")}} thing", "author": "rtretyak", "createdAt": "2020-04-08T12:57:25Z", "path": "confd/templates/docker-compose/docker-compose.tmpl", "diffHunk": "@@ -4,6 +4,21 @@\n version: '2.1'\n services:\n \n+  grpc-stub:", "originalCommit": "476f531b71b579d35f23b28f3c8f37bcb588f730", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYyMzg4Nw==", "url": "https://github.com/telstra/open-kilda/pull/3366#discussion_r405623887", "bodyText": "fixed", "author": "niksv", "createdAt": "2020-04-08T15:43:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTUwMzE3NA=="}], "type": "inlineReview"}, {"oid": "a213d3cff35c75549b0c30a3c5002b6d08fc1588", "url": "https://github.com/telstra/open-kilda/commit/a213d3cff35c75549b0c30a3c5002b6d08fc1588", "message": "Added GRPC service stub", "committedDate": "2020-04-08T15:42:31Z", "type": "forcePushed"}, {"oid": "0bd7ebcba9b33651efcf8ad3c2e3526c9627816c", "url": "https://github.com/telstra/open-kilda/commit/0bd7ebcba9b33651efcf8ad3c2e3526c9627816c", "message": "Added GRPC service stub", "committedDate": "2020-04-16T15:27:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDEwOTA4Mw==", "url": "https://github.com/telstra/open-kilda/pull/3366#discussion_r410109083", "bodyText": "this could lead to wrong network finding", "author": "timofei-durakov", "createdAt": "2020-04-17T09:36:12Z", "path": "src-java/testing/functional-tests/src/main/groovy/org/openkilda/functionaltests/helpers/DockerHelper.groovy", "diffHunk": "@@ -0,0 +1,44 @@\n+package org.openkilda.functionaltests.helpers\n+\n+import com.spotify.docker.client.DefaultDockerClient\n+import com.spotify.docker.client.DockerClient\n+import com.spotify.docker.client.DockerClient.ListContainersParam\n+import groovy.util.logging.Slf4j\n+\n+@Slf4j\n+class DockerHelper {\n+\n+    DockerClient dockerClient\n+    String networkName\n+\n+    DockerHelper(String host) {\n+        log.debug(\"Configuring docker client\");\n+        if (host == 'localhost') {\n+            dockerClient = DefaultDockerClient.fromEnv().build()\n+        } else {\n+            dockerClient = DefaultDockerClient.fromEnv().uri(host).build()\n+        }\n+        log.debug(\"Connected to Docker Host: $host\")\n+\n+        networkName = getNetworkName()\n+        log.debug(\"Network name: $networkName\")\n+    }\n+\n+    String getContainerIp(String containerName) {\n+        dockerClient.listContainers(ListContainersParam.allContainers()).find {\n+            it.names().contains(\"/\" + containerName)\n+        }.networkSettings().networks()[networkName].ipAddress()\n+    }\n+\n+    void restartContainer(String containerId) {\n+        dockerClient.restartContainer(containerId)\n+    }\n+\n+    void waitContainer(String containerId) {\n+        dockerClient.waitContainer(containerId)\n+    }\n+\n+    private String getNetworkName() {\n+        dockerClient.listNetworks()*.name().find { it.contains('_default')}", "originalCommit": "5c64c8cc39e156bf0fd2db3b9676a26a8066ffdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE4Njk0Mg==", "url": "https://github.com/telstra/open-kilda/pull/3366#discussion_r410186942", "bodyText": "fixed", "author": "niksv", "createdAt": "2020-04-17T12:24:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDEwOTA4Mw=="}], "type": "inlineReview"}, {"oid": "1de92b826c892254a757872d92119b170b54591e", "url": "https://github.com/telstra/open-kilda/commit/1de92b826c892254a757872d92119b170b54591e", "message": "Added GRPC service stub", "committedDate": "2020-04-17T10:31:58Z", "type": "commit"}, {"oid": "5affbebb4d80407d69689aec239e71bb39b8ebfe", "url": "https://github.com/telstra/open-kilda/commit/5affbebb4d80407d69689aec239e71bb39b8ebfe", "message": "adjust grpc tests to work with grpc-stub (#3381)\n\n* add possibility to get ip of container via lockkeper\n\n* adjust grpc tests to work with stub\n\n* fix wfmManipulator\n\n* fix \"Simultaneous reroute of multiple flows should not oversubscribe any ISLs\"", "committedDate": "2020-04-17T10:35:15Z", "type": "commit"}, {"oid": "5affbebb4d80407d69689aec239e71bb39b8ebfe", "url": "https://github.com/telstra/open-kilda/commit/5affbebb4d80407d69689aec239e71bb39b8ebfe", "message": "adjust grpc tests to work with grpc-stub (#3381)\n\n* add possibility to get ip of container via lockkeper\n\n* adjust grpc tests to work with stub\n\n* fix wfmManipulator\n\n* fix \"Simultaneous reroute of multiple flows should not oversubscribe any ISLs\"", "committedDate": "2020-04-17T10:35:15Z", "type": "forcePushed"}]}