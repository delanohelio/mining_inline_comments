{"pr_number": 3269, "pr_title": "Fix the appearance of excess rules when flow update V2.", "pr_createdAt": "2020-03-06T12:04:01Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3269", "timeline": [{"oid": "cecb086af25d936eee235cc20c915b9234b0b5f6", "url": "https://github.com/telstra/open-kilda/commit/cecb086af25d936eee235cc20c915b9234b0b5f6", "message": "Fix the appearance of excess rules when flow update V2.\n\nWhen updating flow, we save the old flow in the RequestedFlow object. And when deleting old rules, we take information from this object. We need these two flags to build rules for removing rules.", "committedDate": "2020-03-06T12:10:56Z", "type": "forcePushed"}, {"oid": "00f9341ca6bca4e2f30cbcffe3c834cf09f86025", "url": "https://github.com/telstra/open-kilda/commit/00f9341ca6bca4e2f30cbcffe3c834cf09f86025", "message": "Fix the appearance of excess rules when flow update V2.\n\nWhen updating flow, we save the old flow in the RequestedFlow object using the mapper. And when deleting old rules, we take information from this object. We need these two flags to build rules for removing rules.", "committedDate": "2020-03-06T12:13:57Z", "type": "forcePushed"}, {"oid": "a25d19cea2314618c96eb7fb2211c9f7fef543a0", "url": "https://github.com/telstra/open-kilda/commit/a25d19cea2314618c96eb7fb2211c9f7fef543a0", "message": "Fix the appearance of excess rules when flow update V2.\n\nWhen updating flow, we save the old flow in the RequestedFlow object using the mapper. And when deleting old rules, we take information from this object. We need these two flags to build commands for removing rules. Also the conditions for removing customer port shared rules have been added.", "committedDate": "2020-03-10T13:20:33Z", "type": "forcePushed"}, {"oid": "5dcb4ef3b578185e35da17406c8a571d6763d31d", "url": "https://github.com/telstra/open-kilda/commit/5dcb4ef3b578185e35da17406c8a571d6763d31d", "message": "Fix the appearance of excess rules when flow update V2.\n\nWhen updating flow, we save the old flow in the RequestedFlow object using the mapper. And when deleting old rules, we take information from this object. We need these two flags to build commands for removing rules. Also the conditions for removing customer port shared rules have been added.", "committedDate": "2020-03-10T13:23:50Z", "type": "commit"}, {"oid": "5dcb4ef3b578185e35da17406c8a571d6763d31d", "url": "https://github.com/telstra/open-kilda/commit/5dcb4ef3b578185e35da17406c8a571d6763d31d", "message": "Fix the appearance of excess rules when flow update V2.\n\nWhen updating flow, we save the old flow in the RequestedFlow object using the mapper. And when deleting old rules, we take information from this object. We need these two flags to build commands for removing rules. Also the conditions for removing customer port shared rules have been added.", "committedDate": "2020-03-10T13:23:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ0MzgxNg==", "url": "https://github.com/telstra/open-kilda/pull/3269#discussion_r391443816", "bodyText": "nit: flowIds.size() == 1 && flowIds.contains(flowId)", "author": "timofei-durakov", "createdAt": "2020-03-12T07:38:15Z", "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/actions/BaseFlowRuleRemovalAction.java", "diffHunk": "@@ -49,6 +50,11 @@ public BaseFlowRuleRemovalAction(PersistenceManager persistenceManager, FlowReso\n         switchPropertiesRepository = persistenceManager.getRepositoryFactory().createSwitchPropertiesRepository();\n     }\n \n+    protected boolean isRemoveCustomerPortSharedCatchRule(String flowId, SwitchId ingressSwitchId, int ingressPort) {\n+        Set<String> flowIds = findFlowsIdsByEndpointWithMultiTable(ingressSwitchId, ingressPort);\n+        return flowIds.size() == 1 && flowIds.iterator().next().equals(flowId);", "originalCommit": "5dcb4ef3b578185e35da17406c8a571d6763d31d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}