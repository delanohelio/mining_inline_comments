{"pr_number": 3689, "pr_title": "Filter out one switch flows from affected flows", "pr_createdAt": "2020-08-18T09:10:54Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3689", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjAzOTc2Ng==", "url": "https://github.com/telstra/open-kilda/pull/3689#discussion_r472039766", "bodyText": "we should check that ISL is discovered\nif (otherIslFailed) {\n       antiflap.portUp(otherIsl.srcSwitch.dpId, otherIsl.srcPort)\n        Wrappers.wait(discoveryInterval + WAIT_OFFSET) {\n            assert northbound.getLink(otherIsl).actualState == IslChangeType.DISCOVERED\n        }\n}", "author": "andriidovhan", "createdAt": "2020-08-18T09:21:16Z", "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/AutoRerouteV2Spec.groovy", "diffHunk": "@@ -166,6 +190,7 @@ class AutoRerouteV2Spec extends HealthCheckSpecification {\n         cleanup: \"Remove the flow\"\n         flowHelperV2.deleteFlow(flow.flowId)\n         isSwitchDisconnected && switchHelper.reviveSwitch(sw, blockData, true)\n+        otherIslFailed && antiflap.portUp(otherIsl.srcSwitch.dpId, otherIsl.srcPort)", "originalCommit": "ee7688afb3eb0d048108a395d143ccca5657811c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA0MzIxNA==", "url": "https://github.com/telstra/open-kilda/pull/3689#discussion_r472043214", "bodyText": "as for me otherIsl is not clear\ndo you mind renaming it (for example to islToFail) ?", "author": "andriidovhan", "createdAt": "2020-08-18T09:27:06Z", "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/AutoRerouteV2Spec.groovy", "diffHunk": "@@ -151,6 +152,29 @@ class AutoRerouteV2Spec extends HealthCheckSpecification {\n             assert flowInfo.statusInfo == \"Switch $sw.dpId is inactive\"\n         }\n \n+        when: \"Other isl fails\"\n+        def otherIslFailed = false\n+        def otherIsl = topology.isls.find() {isl-> isl.srcSwitch != sw && isl.dstSwitch != sw}", "originalCommit": "ee7688afb3eb0d048108a395d143ccca5657811c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA0NjMzNA==", "url": "https://github.com/telstra/open-kilda/pull/3689#discussion_r472046334", "bodyText": "Why do you check the actualState field?\nprobably would be better to check the state field", "author": "andriidovhan", "createdAt": "2020-08-18T09:32:20Z", "path": "src-java/testing/functional-tests/src/test/groovy/org/openkilda/functionaltests/spec/flows/AutoRerouteV2Spec.groovy", "diffHunk": "@@ -151,6 +152,29 @@ class AutoRerouteV2Spec extends HealthCheckSpecification {\n             assert flowInfo.statusInfo == \"Switch $sw.dpId is inactive\"\n         }\n \n+        when: \"Other isl fails\"\n+        def otherIslFailed = false\n+        def otherIsl = topology.isls.find() {isl-> isl.srcSwitch != sw && isl.dstSwitch != sw}\n+        antiflap.portDown(otherIsl.srcSwitch.dpId, otherIsl.srcPort)\n+        otherIslFailed = true\n+        Wrappers.wait(WAIT_OFFSET) {\n+            assert northbound.getLink(otherIsl).actualState == IslChangeType.FAILED", "originalCommit": "ee7688afb3eb0d048108a395d143ccca5657811c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8a86910962e05861ecd26c1a4f9b50a987f4451e", "url": "https://github.com/telstra/open-kilda/commit/8a86910962e05861ecd26c1a4f9b50a987f4451e", "message": "Filter out one switch flows from affected flows\n\nOne switch flows should not be in a list of affected flows", "committedDate": "2020-08-18T10:52:30Z", "type": "forcePushed"}, {"oid": "c7da96fabf9a6dd6c80599a193f9e64dd4d17607", "url": "https://github.com/telstra/open-kilda/commit/c7da96fabf9a6dd6c80599a193f9e64dd4d17607", "message": "Filter out one switch flows from affected flows\n\nOne switch flows should not be in a list of affected flows", "committedDate": "2020-08-18T10:57:20Z", "type": "forcePushed"}, {"oid": "6e641093e1503920d516125555ed4c867927604a", "url": "https://github.com/telstra/open-kilda/commit/6e641093e1503920d516125555ed4c867927604a", "message": "Filter out one switch flows from affected flows\n\nOne switch flows should not be in a list of affected flows", "committedDate": "2020-08-19T07:37:06Z", "type": "forcePushed"}, {"oid": "c8f1898e9191542aea5a22dc00af6e7e679e5643", "url": "https://github.com/telstra/open-kilda/commit/c8f1898e9191542aea5a22dc00af6e7e679e5643", "message": "Filter out one switch flows from affected flows\n\nOne switch flows should not be in a list of affected flows", "committedDate": "2020-08-24T09:36:49Z", "type": "commit"}, {"oid": "c8f1898e9191542aea5a22dc00af6e7e679e5643", "url": "https://github.com/telstra/open-kilda/commit/c8f1898e9191542aea5a22dc00af6e7e679e5643", "message": "Filter out one switch flows from affected flows\n\nOne switch flows should not be in a list of affected flows", "committedDate": "2020-08-24T09:36:49Z", "type": "forcePushed"}]}