{"pr_number": 38, "pr_title": "Attach protobuf generated classes to TF Core API", "pr_createdAt": "2020-04-07T03:35:41Z", "pr_url": "https://github.com/tensorflow/java/pull/38", "timeline": [{"oid": "51680cc7b0d2bfd605c5102d27b5dc1bd3355215", "url": "https://github.com/tensorflow/java/commit/51680cc7b0d2bfd605c5102d27b5dc1bd3355215", "message": "Add protos w/upgrade to TF2.2rc2", "committedDate": "2020-04-07T02:57:32Z", "type": "commit"}, {"oid": "594cbd5c5a1b4b89adcb8b5a00fcdac2e672b6a6", "url": "https://github.com/tensorflow/java/commit/594cbd5c5a1b4b89adcb8b5a00fcdac2e672b6a6", "message": "Adapt API to protobuf classes", "committedDate": "2020-04-07T03:16:49Z", "type": "commit"}, {"oid": "128df37db7ae98a6c45f244073b9fbe76bdddc86", "url": "https://github.com/tensorflow/java/commit/128df37db7ae98a6c45f244073b9fbe76bdddc86", "message": "Update bazel version for TF2.2rc2", "committedDate": "2020-04-07T03:16:53Z", "type": "commit"}, {"oid": "f145b53bbab3db43aa584492f7e4b4bb85142f40", "url": "https://github.com/tensorflow/java/commit/f145b53bbab3db43aa584492f7e4b4bb85142f40", "message": "Cleanup ops moved to different location", "committedDate": "2020-04-07T03:34:06Z", "type": "commit"}, {"oid": "d7618c2b9be4b5f0d4942ef8adbd571e8aa6bc43", "url": "https://github.com/tensorflow/java/commit/d7618c2b9be4b5f0d4942ef8adbd571e8aa6bc43", "message": "Check ByteBuffer 32-bits limitations", "committedDate": "2020-04-07T03:51:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDUzOTkxNg==", "url": "https://github.com/tensorflow/java/pull/38#discussion_r404539916", "bodyText": "Using the original protobuf artifact as is will cause issues with other libraries that need a different version of protobuf, so this should all be shaded. If the plan is to wait until users having this problem show up, is it going to be OK to break backward compatibility at that time?", "author": "saudet", "createdAt": "2020-04-07T05:15:48Z", "path": "tensorflow-core/tensorflow-core-api/pom.xml", "diffHunk": "@@ -14,12 +14,22 @@\n   <name>TensorFlow Core API Library</name>\n   <description>Platform-dependent native code and pure-Java code for the TensorFlow machine intelligence library.</description>\n \n+  <properties>\n+    <!-- Match version used by TensorFlow, in tensorflow/workspace.bzl -->\n+    <protobuf.version>3.8.0</protobuf.version>\n+  </properties>\n+\n   <dependencies>\n     <dependency>\n       <groupId>org.bytedeco</groupId>\n       <artifactId>javacpp</artifactId>\n       <version>${javacpp.version}</version>\n     </dependency>\n+    <dependency>\n+      <groupId>com.google.protobuf</groupId>\n+      <artifactId>protobuf-java</artifactId>\n+      <version>${protobuf.version}</version>", "originalCommit": "d7618c2b9be4b5f0d4942ef8adbd571e8aa6bc43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE2Njc3NA==", "url": "https://github.com/tensorflow/java/pull/38#discussion_r405166774", "bodyText": "So embedding it using Maven shade plugin? I can give it a try.", "author": "karllessard", "createdAt": "2020-04-07T23:12:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDUzOTkxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIxNzk5Ng==", "url": "https://github.com/tensorflow/java/pull/38#discussion_r405217996", "bodyText": "Not exactly, we need to use a patched version of protobuf that can generate code that depends on shaded classes, like this one: https://github.com/os72/protoc-jar-maven-plugin\nBut like I said it's not important to do that right away if we plan on breaking compatibility at some point in the future anyway.", "author": "saudet", "createdAt": "2020-04-08T02:11:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDUzOTkxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIzMzM5Mw==", "url": "https://github.com/tensorflow/java/pull/38#discussion_r405233393", "bodyText": "Oh, that might require more changes then because right now, I let Bazel generating the Java protobuf classes and just match the version used in Maven, as I did not find how to export only the .proto files out of TensorFlow.\nI also found out this, for what it is worth. Looks like there is already some org.tensorflow artifacts that shades protobuf in a different way.", "author": "karllessard", "createdAt": "2020-04-08T03:11:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDUzOTkxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI5NzM5Mg==", "url": "https://github.com/tensorflow/java/pull/38#discussion_r405297392", "bodyText": "Right, we can let users do it themselves when required...", "author": "saudet", "createdAt": "2020-04-08T06:55:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDUzOTkxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU0MTIyMA==", "url": "https://github.com/tensorflow/java/pull/38#discussion_r404541220", "bodyText": "Could this be translated to Java? And if not, why not?", "author": "saudet", "createdAt": "2020-04-07T05:19:57Z", "path": "tensorflow-core/tensorflow-core-api/src/bazel/api_def/import/api_import.cc", "diffHunk": "@@ -0,0 +1,317 @@\n+/* Copyright 2017 The TensorFlow Authors. All Rights Reserved.", "originalCommit": "d7618c2b9be4b5f0d4942ef8adbd571e8aa6bc43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE2MDUyMQ==", "url": "https://github.com/tensorflow/java/pull/38#discussion_r405160521", "bodyText": "Like I mentioned in the description of this PR, this is just an old utility I've written awhile ago when classifying the 900+ initial operation wrappers and I just put it there so it is not lost, as I still find it quite useful.\nNow could it be rewritten in Java... I guess so, but with a lot of work as it depends on TF internal classes. I'm not planning to spend time on this anytime soon so if we think it does not fit in our repo, then I'll simply remove it from this PR and continue to keep it in my fork.", "author": "karllessard", "createdAt": "2020-04-07T22:54:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU0MTIyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIxODIyNA==", "url": "https://github.com/tensorflow/java/pull/38#discussion_r405218224", "bodyText": "Does this code actually gets used during the build? If so, I suppose we can leave it here...", "author": "saudet", "createdAt": "2020-04-08T02:12:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU0MTIyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIzNDg3Mg==", "url": "https://github.com/tensorflow/java/pull/38#discussion_r405234872", "bodyText": "No, I only use it when I discover that new operations have been added after a TF upgrade, so I can classify them properly by configuring the API definitions properly before rebuilding. It just gives me some hints in which package they should be located based on Python endpoints that has a similar name.", "author": "karllessard", "createdAt": "2020-04-08T03:17:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU0MTIyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTMwOTMxOQ==", "url": "https://github.com/tensorflow/java/pull/38#discussion_r405309319", "bodyText": "Ah, ok, so let's add the step to compile it to the build.sh script or something while we're at it?", "author": "saudet", "createdAt": "2020-04-08T07:20:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU0MTIyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg1NDIwOQ==", "url": "https://github.com/tensorflow/java/pull/38#discussion_r405854209", "bodyText": "It's already there, see here and here", "author": "karllessard", "createdAt": "2020-04-08T22:36:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU0MTIyMA=="}], "type": "inlineReview"}, {"oid": "f4511eacec268581846f2e89b062eef695be4e36", "url": "https://github.com/tensorflow/java/commit/f4511eacec268581846f2e89b062eef695be4e36", "message": "Group all proto classes under the same package", "committedDate": "2020-04-09T16:06:54Z", "type": "commit"}]}