{"pr_number": 83, "pr_title": "Add a simple DeviceSpec class.", "pr_createdAt": "2020-07-12T23:53:02Z", "pr_url": "https://github.com/tensorflow/java/pull/83", "timeline": [{"oid": "74d238f0937f32658c406a1eaabb664c2cdf970d", "url": "https://github.com/tensorflow/java/commit/74d238f0937f32658c406a1eaabb664c2cdf970d", "message": "Add a simple DeviceSpec class.\n\nThis is a straightforward port from device_spec.py.\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/framework/device_spec.py", "committedDate": "2020-07-12T23:47:55Z", "type": "commit"}, {"oid": "4df69034420d5153b21be785341f5ca272e65dd7", "url": "https://github.com/tensorflow/java/commit/4df69034420d5153b21be785341f5ca272e65dd7", "message": "Remove auto-value and use a plain builder for DeviceSpec.", "committedDate": "2020-08-02T23:49:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYxOTE0MA==", "url": "https://github.com/tensorflow/java/pull/83#discussion_r464619140", "bodyText": "Sorry @hthu , you should not use Guava neither :)\nGuava is present in the classpath at compile time only as a result of depending on tensorflow-core-generator for running the annotation processor. As you can see in the pom, this dependency is optional, meaning that it will not be automatically present at runtime nor its transitive dependencies. I'm even surprised they were included when running your unit tests.\nAgain, sorry for the trouble but I think we should try to avoid adding a new runtime dependency in the core module if there is an easy way to accomplish the same task without it.", "author": "karllessard", "createdAt": "2020-08-03T19:32:13Z", "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/device/DeviceSpec.java", "diffHunk": "@@ -0,0 +1,166 @@\n+package org.tensorflow.device;\n+\n+import com.google.common.base.Joiner;", "originalCommit": "4df69034420d5153b21be785341f5ca272e65dd7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ4MTIyNw==", "url": "https://github.com/tensorflow/java/pull/83#discussion_r465481227", "bodyText": "NP!\nRemoved as well.", "author": "hthu", "createdAt": "2020-08-05T05:27:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYxOTE0MA=="}], "type": "inlineReview"}, {"oid": "fbecd234e8ae0ffecd111b4ecf6a84e302f0f306", "url": "https://github.com/tensorflow/java/commit/fbecd234e8ae0ffecd111b4ecf6a84e302f0f306", "message": "Remove Joiner from Guava.", "committedDate": "2020-08-05T05:26:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEyNDYyNQ==", "url": "https://github.com/tensorflow/java/pull/83#discussion_r466124625", "bodyText": "Where do we get the Nullable annotation from? It's not in the JDK.", "author": "Craigacp", "createdAt": "2020-08-06T03:31:59Z", "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/device/DeviceSpec.java", "diffHunk": "@@ -0,0 +1,162 @@\n+package org.tensorflow.device;\n+\n+import javax.annotation.Nullable;", "originalCommit": "fbecd234e8ae0ffecd111b4ecf6a84e302f0f306", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEyNTE2Nw==", "url": "https://github.com/tensorflow/java/pull/83#discussion_r466125167", "bodyText": "I was wondering as well, I assumed (maybe a bit too fast) that it was part of the JDK... ok, I'll remove them manually and merge back the file without it", "author": "karllessard", "createdAt": "2020-08-06T03:34:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEyNDYyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEyNTYzNg==", "url": "https://github.com/tensorflow/java/pull/83#discussion_r466125636", "bodyText": "Yeah, it was coming again from our dependency to the tensorflow-core-generator, which got it from com.google.code.findbugs, thanks for raising this @Craigacp", "author": "karllessard", "createdAt": "2020-08-06T03:36:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEyNDYyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEyNzIyMQ==", "url": "https://github.com/tensorflow/java/pull/83#discussion_r466127221", "bodyText": "Woah I always thought @nullable was part of the JDK somewhere...\nMy bad for taking that for granted.\nAre you folks already removing that?", "author": "hthu", "createdAt": "2020-08-06T03:42:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEyNDYyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEyOTQ1OA==", "url": "https://github.com/tensorflow/java/pull/83#discussion_r466129458", "bodyText": "No worries. Can we remove the generator dependency somehow? It pulls in a lot of things.", "author": "Craigacp", "createdAt": "2020-08-06T03:51:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEyNDYyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEzMDE1OQ==", "url": "https://github.com/tensorflow/java/pull/83#discussion_r466130159", "bodyText": "Personally I'm a bit confused as to why jsr305 wasn't integrated into the JDK, but there was a talk about nullness annotations from Google at the last JVMLS discussing all the issues with integrating them into things, and it seemed to be pretty complex. Unfortunately that talk wasn't recorded.", "author": "Craigacp", "createdAt": "2020-08-06T03:53:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEyNDYyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEzMDcxMQ==", "url": "https://github.com/tensorflow/java/pull/83#discussion_r466130711", "bodyText": "Can we remove the generator dependency somehow?\n\nI was thinking of doing that as well but there is probably a good reason why it is there, probably maven was failing somehow to run the annotation processor without it. Will need to double check\nSo @hthu , it's all good now, I forced-pushed a new version without @Nullable. I also took the opportunity to move the DeviceSpec out of the device package. Since there was only one file in that package, I don't think we needed it.", "author": "karllessard", "createdAt": "2020-08-06T03:55:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEyNDYyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEzMTE4OQ==", "url": "https://github.com/tensorflow/java/pull/83#discussion_r466131189", "bodyText": "Sounds good to me!\nThank you both!", "author": "hthu", "createdAt": "2020-08-06T03:57:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEyNDYyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEzMjA5Ng==", "url": "https://github.com/tensorflow/java/pull/83#discussion_r466132096", "bodyText": "Can we remove the generator dependency somehow?\n\nI was thinking of doing that as well but there is probably a good reason why it is there, probably maven was failing somehow to run the annotation processor without it. Will need to double check\n\nI guess without the explicit dependency it's up to maven which one of the generator and the core api it compiles first.  Maybe we could make it a test time dependency? That's even less clear in terms of the semantics, but it should make it run first.", "author": "Craigacp", "createdAt": "2020-08-06T04:01:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEyNDYyNQ=="}], "type": "inlineReview"}]}