{"pr_number": 2027, "pr_title": "Update Cloud Run Samples to use Jib", "pr_createdAt": "2020-01-24T19:14:12Z", "pr_url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2027", "timeline": [{"oid": "00767a5517fe425175874c33fd31b85ecd502dfb", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/00767a5517fe425175874c33fd31b85ecd502dfb", "message": "Change run samples to use Jib", "committedDate": "2020-01-23T23:31:51Z", "type": "commit"}, {"oid": "be2fc173bc68bc9b013f55f8dcd6f3a54b5573e9", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/be2fc173bc68bc9b013f55f8dcd6f3a54b5573e9", "message": "update readme", "committedDate": "2020-01-24T19:07:42Z", "type": "commit"}, {"oid": "9a89285d9ce0a56dcf60c279fa05217126098bd2", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/9a89285d9ce0a56dcf60c279fa05217126098bd2", "message": "fix pom format", "committedDate": "2020-01-24T19:09:40Z", "type": "commit"}, {"oid": "3d44b23f8bb5a588f5f2be05fff5b1960e67d349", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/3d44b23f8bb5a588f5f2be05fff5b1960e67d349", "message": "readme format", "committedDate": "2020-01-24T19:11:42Z", "type": "commit"}, {"oid": "addf68c5bae8d6cb8d0dd9adfaa4bb11d42e8c0e", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/addf68c5bae8d6cb8d0dd9adfaa4bb11d42e8c0e", "message": "fix pom format", "committedDate": "2020-01-24T19:13:38Z", "type": "commit"}, {"oid": "7caa86dd20921f8f89448f13b5b5680bd2d4a68f", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/7caa86dd20921f8f89448f13b5b5680bd2d4a68f", "message": "change kokoro to build jib", "committedDate": "2020-01-24T20:41:42Z", "type": "commit"}, {"oid": "ce7f6041e052efbfdc2c5ef5f78375bf330db335", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/ce7f6041e052efbfdc2c5ef5f78375bf330db335", "message": "change kokoro to build jib", "committedDate": "2020-01-24T21:33:12Z", "type": "commit"}, {"oid": "baa940c2d0203434b378570782eb32db7be519a6", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/baa940c2d0203434b378570782eb32db7be519a6", "message": "Add base image", "committedDate": "2020-01-24T22:51:58Z", "type": "commit"}, {"oid": "e73a3d8eccf83907ddfb42d19d3754513ba77607", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/e73a3d8eccf83907ddfb42d19d3754513ba77607", "message": "merge", "committedDate": "2020-01-24T22:52:46Z", "type": "commit"}, {"oid": "4e94ce7ed6948a0bb8706b993a6162a539448c19", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/4e94ce7ed6948a0bb8706b993a6162a539448c19", "message": "Merge branch 'master' into jib", "committedDate": "2020-01-24T23:10:03Z", "type": "commit"}, {"oid": "b8aa4eb517126b8fb5afd5b25b54f97f472b9b12", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/b8aa4eb517126b8fb5afd5b25b54f97f472b9b12", "message": "Format", "committedDate": "2020-01-24T23:48:46Z", "type": "commit"}, {"oid": "94572fd9ca0c47aeaa60b139ef3a89334e32b396", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/94572fd9ca0c47aeaa60b139ef3a89334e32b396", "message": "Merge branch 'jib' of https://github.com/GoogleCloudPlatform/java-docs-samples into jib", "committedDate": "2020-01-24T23:48:54Z", "type": "commit"}, {"oid": "1e4db99a07cffc4d52c11424f1c94e48ba16ea73", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/1e4db99a07cffc4d52c11424f1c94e48ba16ea73", "message": "Merge branch 'master' into jib", "committedDate": "2020-01-25T00:00:34Z", "type": "commit"}, {"oid": "bb86567033341f9b3e90430460f784be5cc2dae2", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/bb86567033341f9b3e90430460f784be5cc2dae2", "message": "Add clean up step", "committedDate": "2020-01-27T16:56:49Z", "type": "commit"}, {"oid": "7fdbbc2d5a779532d6b790ae479cd3fe80b2fd41", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/7fdbbc2d5a779532d6b790ae479cd3fe80b2fd41", "message": "Merge branch 'master' into jib", "committedDate": "2020-01-27T16:57:05Z", "type": "commit"}, {"oid": "a29ff39d4e9e21cb402b13ade91da24531b19483", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/a29ff39d4e9e21cb402b13ade91da24531b19483", "message": "Merge branch 'jib' of https://github.com/GoogleCloudPlatform/java-docs-samples into jib", "committedDate": "2020-01-27T16:57:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM3MDgzOQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2027#discussion_r371370839", "bodyText": "nit: Is this supposed to be 9090?", "author": "kurtisvg", "createdAt": "2020-01-27T17:14:36Z", "path": "run/README.md", "diffHunk": "@@ -9,71 +9,73 @@ This directory contains samples for [Google Cloud Run](https://cloud.run). [Clou\n \n ## Samples\n \n-|           Sample                |        Description       |     Deploy    |\n-| ------------------------------- | ------------------------ | ------------- |\n-|[Hello World][helloworld] | Quickstart | [<img src=\"https://storage.googleapis.com/cloudrun/button.svg\" alt=\"Run on Google Cloud\" height=\"30\">][run_button_helloworld] |\n-|[Cloud Pub/Sub](pubsub/) | Handling Pub/Sub push messages | [<img src=\"https://storage.googleapis.com/cloudrun/button.svg\" alt=\"Run on Google Cloud\" height=\"30\">][run_button_pubsub] |\n-|[System Packages](system-package/) | Using system packages with containers | [<img src=\"https://storage.googleapis.com/cloudrun/button.svg\" alt=\"Run on Google Cloud\" height=\"30\">][run_button_sys_package] |\n-|[Image Magick](image-processing/) | Event-driven image analysis & transformation | [<img src=\"https://storage.googleapis.com/cloudrun/button.svg\" alt=\"Run on Google Cloud\" height=\"30\">][run_button_image] |\n-|[Manual Logging](logging-manual/) | Structured logging for Stackdriver | [<img src=\"https://storage.googleapis.com/cloudrun/button.svg\" alt=\"Run on Google Cloud\" height=\"30\">][run_button_log] |\n-|[Local Troubleshooting](hello-broken/) | Broken services for local troubleshooting tutorial | [<img src=\"https://storage.googleapis.com/cloudrun/button.svg\" alt=\"Run on Google Cloud\" height=\"30\">][run_button_broken] |\n-|[Cloud SQL (MySQL)][mysql]        | Use MySQL with Cloud Run | [<img src=\"https://storage.googleapis.com/cloudrun/button.svg\" alt=\"Run on Google Cloud\" height=\"30\">][run_button_sql] |\n+|           Sample                |        Description       |\n+| ------------------------------- | ------------------------ |\n+|[Hello World][helloworld]        | Quickstart |\n+|[Cloud Pub/Sub](pubsub/)         | Handling Pub/Sub push messages |\n+|[System Packages](system-package/)| Using system packages with containers |\n+|[Image Magick](image-processing/) | Event-driven image analysis & transformation |\n+|[Manual Logging](logging-manual/) | Structured logging for Stackdriver |\n+|[Local Troubleshooting](hello-broken/) | Broken services for local troubleshooting tutorial |\n+|[Cloud SQL (MySQL)][mysql]        | Use MySQL with Cloud Run |\n \n For more Cloud Run samples beyond Java, see the main list in the [Cloud Run Samples repository](https://github.com/GoogleCloudPlatform/cloud-run-samples).\n \n ## Setup\n \n 1. [Set up for Cloud Run development](https://cloud.google.com/run/docs/setup)\n \n-2. Clone this repository:\n+1. Clone this repository:\n \n     ```\n     git clone https://github.com/GoogleCloudPlatform/java-docs-samples.git\n     ```\n \n-    Note: Some samples in the list above are hosted in other repositories. They are noted with the symbol \"&#10149;\".\n-\n+1. In the samples's `pom.xml`, update the image field for the `jib-maven-plugin`\n+with your Google Cloud Project Id:\n+\n+    ```XML\n+    <plugin>\n+      <groupId>com.google.cloud.tools</groupId>\n+      <artifactId>jib-maven-plugin</artifactId>\n+      <version>1.8.0</version>\n+      <configuration>\n+        <to>\n+          <image>gcr.io/PROJECT_ID/SAMPLE_NAME</image>\n+        </to>\n+      </configuration>\n+    </plugin>\n+    ```\n \n ## How to run a sample locally\n \n-1. [Install docker locally](https://docs.docker.com/install/)\n-\n-2. [Build the sample container](https://cloud.google.com/run/docs/building/containers#building_locally_and_pushing_using_docker):\n+1. [Build the sample container using Jib](https://github.com/GoogleContainerTools/jib):\n \n-    ```\n-    export SAMPLE=<SAMPLE_NAME>\n-    cd $SAMPLE\n-    docker build --tag $SAMPLE .\n+    ```Bash\n+    mvn jib:build\n     ```\n \n-3. [Run containers locally](https://cloud.google.com/run/docs/testing/local)\n+1. [Run containers locally](https://cloud.google.com/run/docs/testing/local) by\n+replacing `PROJECT_ID` and `SAMPLE_NAME` with your values.\n \n     With the built container:\n \n-    ```\n-    PORT=8080 && docker run --rm -p 8080:${PORT} -e PORT=${PORT} $SAMPLE\n-    ```\n-\n-    Overriding the built container with local code:\n-\n-    ```\n-    PORT=8080 && docker run --rm \\\n-        -p 8080:${PORT} -e PORT=${PORT} \\\n-        -v $PWD:/app $SAMPLE\n+    ```Bash\n+    PORT=8080 && docker run --rm -p 8080:${PORT} -e PORT=${PORT} gcr.io/PROJECT_ID/SAMPLE_NAME\n     ```\n \n     Injecting your service account key for access to GCP services:\n \n-    ```\n-    # Set the name of the service account key within the container\n-    export SA_KEY_NAME=my-key-name-123\n-\n-    PORT=8080 && docker run --rm \\\n-        -p 8080:${PORT} \\\n-        -e PORT=${PORT} \\\n-        -e GOOGLE_APPLICATION_CREDENTIALS=/tmp/keys/${SA_KEY_NAME}.json \\\n-        -v $GOOGLE_APPLICATION_CREDENTIALS:/tmp/keys/${SA_KEY_NAME}.json:ro \\\n-        -v $PWD:/app $SAMPLE\n+    ```Bash\n+    PORT=8080 && docker run \\\n+       -p 9090:${PORT} \\", "originalCommit": "a29ff39d4e9e21cb402b13ade91da24531b19483", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM3OTQ4NA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2027#discussion_r371379484", "bodyText": "Yes, based on https://cloud.google.com/run/docs/testing/local. I've added a note to clarify", "author": "averikitsch", "createdAt": "2020-01-27T17:31:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM3MDgzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM3MTAzNQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2027#discussion_r371371035", "bodyText": "What is this comment for? Can we either add more context, or remove it?", "author": "kurtisvg", "createdAt": "2020-01-27T17:15:00Z", "path": "run/hello-broken/pom.xml", "diffHunk": "@@ -70,24 +70,18 @@ limitations under the License.\n   <build>\r\n     <plugins>\r\n       <plugin>\r\n-        <artifactId>maven-compiler-plugin</artifactId>\r\n-        <version>3.8.0</version>\r\n+        <groupId>com.google.cloud.tools</groupId>\r\n+        <artifactId>jib-maven-plugin</artifactId>\r\n+        <version>1.8.0</version>\r\n         <configuration>\r\n-          <source>11</source>\r\n-          <target>11</target>\r\n-        </configuration>\r\n-      </plugin>\r\n-      <plugin>\r\n-        <artifactId>maven-assembly-plugin</artifactId>\r\n-        <configuration>\r\n-          <archive>\r\n-            <manifest>\r\n-              <mainClass>com.example.cloudrun.App</mainClass>\r\n-            </manifest>\r\n-          </archive>\r\n-          <descriptorRefs>\r\n-            <descriptorRef>jar-with-dependencies</descriptorRef>\r\n-          </descriptorRefs>\r\n+          <to>\r\n+            <image>gcr.io/PROJECT_ID/hello-broken</image>\r\n+          </to>\r\n+    <!-- <container>\r", "originalCommit": "a29ff39d4e9e21cb402b13ade91da24531b19483", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM4MDA3Nw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2027#discussion_r371380077", "bodyText": "comment added.", "author": "averikitsch", "createdAt": "2020-01-27T17:32:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM3MTAzNQ=="}], "type": "inlineReview"}, {"oid": "70bb3d1b530ab10e3d53d02f05c4b2edb2daff16", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/70bb3d1b530ab10e3d53d02f05c4b2edb2daff16", "message": "Add region tags", "committedDate": "2020-01-27T17:31:21Z", "type": "commit"}, {"oid": "197f9251387e7c1b8b1c67d86d162e83025943f1", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/197f9251387e7c1b8b1c67d86d162e83025943f1", "message": "remove beta command", "committedDate": "2020-01-27T17:47:22Z", "type": "commit"}, {"oid": "432784fbb2fde6366fb44604af2ae2e5eff1cc4c", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/432784fbb2fde6366fb44604af2ae2e5eff1cc4c", "message": "Update ReadMes", "committedDate": "2020-01-27T18:54:13Z", "type": "commit"}, {"oid": "2f63ee1f0f9ce4018d98af619237eb3a44bb66c3", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/2f63ee1f0f9ce4018d98af619237eb3a44bb66c3", "message": "Merge branch 'master' into jib", "committedDate": "2020-01-27T18:55:54Z", "type": "commit"}, {"oid": "85ea2f173be36497f9742a5dd3029351b4cdbe47", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/85ea2f173be36497f9742a5dd3029351b4cdbe47", "message": "Add region tag back", "committedDate": "2020-01-27T19:26:46Z", "type": "commit"}, {"oid": "eeb5ec2be96259429626f1ca1cbb211cd0aad8df", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/eeb5ec2be96259429626f1ca1cbb211cd0aad8df", "message": "Merge branch 'jib' of https://github.com/GoogleCloudPlatform/java-docs-samples into jib", "committedDate": "2020-01-27T19:28:44Z", "type": "commit"}, {"oid": "b2088d0f46571a5d05ab69fa22a06352ad9d86a7", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/b2088d0f46571a5d05ab69fa22a06352ad9d86a7", "message": "Update build names", "committedDate": "2020-01-29T22:04:00Z", "type": "commit"}, {"oid": "0436762d21c48d6596f9bb4d1f08a64004445eb8", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/0436762d21c48d6596f9bb4d1f08a64004445eb8", "message": "add back cloud run button", "committedDate": "2020-01-29T22:07:45Z", "type": "commit"}, {"oid": "aa8183079ee1fc4b6c0f69da1f2fb7cf1ac46c43", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/aa8183079ee1fc4b6c0f69da1f2fb7cf1ac46c43", "message": "Merge branch 'master' into jib", "committedDate": "2020-01-29T22:09:32Z", "type": "commit"}, {"oid": "d1608032b36acae9740fdaac58a49a64d54cf673", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/d1608032b36acae9740fdaac58a49a64d54cf673", "message": "Update run instructions", "committedDate": "2020-01-30T20:06:50Z", "type": "commit"}, {"oid": "430a52abe1df226f90401704587a72a0f5f46bd0", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/430a52abe1df226f90401704587a72a0f5f46bd0", "message": "Merge branch 'jib' of https://github.com/GoogleCloudPlatform/java-docs-samples into jib", "committedDate": "2020-01-30T20:07:05Z", "type": "commit"}, {"oid": "3605d1ac087fc4b8a11d528136eea87d4b5eb02c", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/3605d1ac087fc4b8a11d528136eea87d4b5eb02c", "message": "Update version", "committedDate": "2020-01-30T20:17:13Z", "type": "commit"}, {"oid": "ed5435791df36725c554c74d70838710aa721e00", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/ed5435791df36725c554c74d70838710aa721e00", "message": "Update port", "committedDate": "2020-02-04T22:11:21Z", "type": "commit"}, {"oid": "c797a70cd7e5ae935c8cfbe1b83063239b56f79d", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/c797a70cd7e5ae935c8cfbe1b83063239b56f79d", "message": "Merge branch 'master' into jib", "committedDate": "2020-02-04T23:25:43Z", "type": "commit"}, {"oid": "323020cc70f5d868bbf7aaf4e248303b9c9f6266", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/323020cc70f5d868bbf7aaf4e248303b9c9f6266", "message": "Add region tags and fix lint", "committedDate": "2020-02-04T23:49:04Z", "type": "commit"}, {"oid": "7b30c3d4ccf4eb9fef44c20fc87785f299d6abac", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/7b30c3d4ccf4eb9fef44c20fc87785f299d6abac", "message": "Merge branch 'jib' of https://github.com/GoogleCloudPlatform/java-docs-samples into jib", "committedDate": "2020-02-04T23:50:53Z", "type": "commit"}, {"oid": "80a9b23456dd6c7c59b8bd68c6c6e5191d233bdd", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/80a9b23456dd6c7c59b8bd68c6c6e5191d233bdd", "message": "Merge branch 'master' into jib", "committedDate": "2020-02-13T21:46:28Z", "type": "commit"}, {"oid": "4f3b7ceaba4b7bd9970b220ed90cc4b580b195cf", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/4f3b7ceaba4b7bd9970b220ed90cc4b580b195cf", "message": "Merge branch 'master' into jib", "committedDate": "2020-02-13T22:44:10Z", "type": "commit"}, {"oid": "e481127b6537e0a3dbb9486faf00432bab27587f", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/e481127b6537e0a3dbb9486faf00432bab27587f", "message": "Merge branch 'master' into jib", "committedDate": "2020-02-19T17:05:16Z", "type": "commit"}]}