{"pr_number": 4045, "pr_title": "feat: eventarc generic and eventarc other brushup", "pr_createdAt": "2020-10-21T04:59:22Z", "pr_url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045", "timeline": [{"oid": "5b1d1ea1b8b0c15c0179d6c120adc69f1f520384", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/5b1d1ea1b8b0c15c0179d6c120adc69f1f520384", "message": "feat: eventarc generic and eventarc other brushup\n\nSigned-off-by: Grant Timmerman <timmerman+devrel@google.com>", "committedDate": "2020-10-21T04:56:42Z", "type": "commit"}, {"oid": "b955c1bd31c94cd2ae2ec119a7e770ff9d935c98", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/b955c1bd31c94cd2ae2ec119a7e770ff9d935c98", "message": "lint: fix lint issue\n\nSigned-off-by: Grant Timmerman <timmerman+devrel@google.com>", "committedDate": "2020-10-21T14:01:26Z", "type": "commit"}, {"oid": "6a9997b4fb479dc14ce9c644f49867c03b1592fa", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/6a9997b4fb479dc14ce9c644f49867c03b1592fa", "message": "lint: fix lint issue\n\nSigned-off-by: Grant Timmerman <timmerman+devrel@google.com>", "committedDate": "2020-10-21T14:14:39Z", "type": "commit"}, {"oid": "7336d434cc2b50459dff1a60f2bf3bd15e076a3b", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/7336d434cc2b50459dff1a60f2bf3bd15e076a3b", "message": "lint: fix lint issue\n\nSigned-off-by: Grant Timmerman <timmerman+devrel@google.com>", "committedDate": "2020-10-21T14:42:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM5NDU4NQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r509394585", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                String msg = String.format(\"Detected change in GCS bucket: %s.\", ceSubject);\n          \n          \n            \n                String msg = \"Detected change in GCS bucket: \" + ceSubject;\n          \n      \n    \n    \n  \n\nString.format has poor performance", "author": "averikitsch", "createdAt": "2020-10-21T15:39:31Z", "path": "eventarc/audit-storage/src/main/java/com/example/cloudrun/EventController.java", "diffHunk": "@@ -53,7 +52,7 @@\n     }\n \n     String ceSubject = headers.get(\"ce-subject\");\n-    String msg = String.format(\"GCS CloudEvent type: %s.\", ceSubject);\n+    String msg = String.format(\"Detected change in GCS bucket: %s.\", ceSubject);", "originalCommit": "7336d434cc2b50459dff1a60f2bf3bd15e076a3b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTU5NjM0Nw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r509596347", "bodyText": "Fixed, thanks.", "author": "grant", "createdAt": "2020-10-21T19:07:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM5NDU4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM5NTI5Nw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r509395297", "bodyText": "Even though this isn't the point of the sample, removing PubSubBody feels like it makes this sample not useful for continued learning and building.", "author": "averikitsch", "createdAt": "2020-10-21T15:40:26Z", "path": "eventarc/audit-storage/src/main/java/com/example/cloudrun/EventController.java", "diffHunk": "@@ -37,7 +36,7 @@\n \n   @RequestMapping(value = \"/\", method = RequestMethod.POST)\n   public ResponseEntity<String> receiveMessage(\n-      @RequestBody PubSubBody body, @RequestHeader Map<String, String> headers) {\n+      @RequestBody Object body, @RequestHeader Map<String, String> headers) {", "originalCommit": "7336d434cc2b50459dff1a60f2bf3bd15e076a3b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTU5NjExMw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r509596113", "bodyText": "This sample literally does not receive Pub/Sub requests. It receives Cloud Audit Log requests. In this case, the audit log is for a Cloud Storage event.\nThus, it's incorrect to have Pub/Sub in this sample. The sample does not use this body, so the tests have always passed. If we wanted a different POJO, we cannot include a LogEntryData POJO until that library is finished and published.\nWe have a Pub/Sub sample for Pub/Sub events.", "author": "grant", "createdAt": "2020-10-21T19:07:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM5NTI5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQwMDAzNA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r510400034", "bodyText": "You could build your own POJO for the time being like Pub/Sub.  From this code, I have no idea what it accepts so if possible at least add a content type. We shouldn't use \"Object\", Map<String, String> would at least be useable.", "author": "averikitsch", "createdAt": "2020-10-22T19:19:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM5NTI5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY1NDQ4NA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r510654484", "bodyText": "I've changed the type to a Map per suggestion.\n\nThe JSON payload is large for an Audit Log. The POJO would have 14 classes (see link above), unless we construct a custom POJO for this type.\nThe actual contents of an Audit Log is very strange, hard to use, and is not useful for this sample of an audit log for a Cloud Storage event.\nI don't think there's value in adding/maintaining a POJO in Java for this specific event type during public preview and would rather have a generic type until we publish https://github.com/googleapis/google-cloudevents-java/tree/master/google-cloudevent-types/src/main/java/com/google/events/cloud/audit/v1", "author": "grant", "createdAt": "2020-10-23T06:13:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM5NTI5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM5NTgyNw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r509395827", "bodyText": "Is this for a quickstart? I don't want us to keep using Dockerfiles for these samples", "author": "averikitsch", "createdAt": "2020-10-21T15:41:08Z", "path": "eventarc/generic/Dockerfile", "diffHunk": "@@ -0,0 +1,41 @@\n+# Copyright 2020 Google LLC\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#     https://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# [START eventarc_generic_dockerfile]", "originalCommit": "7336d434cc2b50459dff1a60f2bf3bd15e076a3b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTU5ODc4NQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r509598785", "bodyText": "Removed as we're using Jib.", "author": "grant", "createdAt": "2020-10-21T19:10:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM5NTgyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM5NzQzOQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r509397439", "bodyText": "Doesn't look like this is used.", "author": "averikitsch", "createdAt": "2020-10-21T15:43:03Z", "path": "eventarc/generic/pom.xml", "diffHunk": "@@ -0,0 +1,107 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n+<!--\r\n+Copyright 2020 Google LLC\r\n+Licensed under the Apache License, Version 2.0 (the \"License\");\r\n+you may not use this file except in compliance with the License.\r\n+You may obtain a copy of the License at\r\n+http://www.apache.org/licenses/LICENSE-2.0\r\n+Unless required by applicable law or agreed to in writing, software\r\n+distributed under the License is distributed on an \"AS IS\" BASIS,\r\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n+See the License for the specific language governing permissions and\r\n+limitations under the License.\r\n+-->\r\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\r\n+  <modelVersion>4.0.0</modelVersion>\r\n+  <groupId>com.example.cloudrun</groupId>\r\n+  <artifactId>eventarc-generic</artifactId>\r\n+  <version>0.0.1-SNAPSHOT</version>\r\n+  <!--  The parent pom defines common style checks and testing strategies for our samples.\r\n+\tRemoving or replacing it should not affect the execution of the samples in anyway.  -->\r\n+  <parent>\r\n+    <groupId>com.google.cloud.samples</groupId>\r\n+    <artifactId>shared-configuration</artifactId>\r\n+    <version>1.0.21</version>\r\n+  </parent>\r\n+\r\n+  <properties>\r\n+    <maven.compiler.target>11</maven.compiler.target>\r\n+    <maven.compiler.source>11</maven.compiler.source>\r\n+  </properties>\r\n+\r\n+  <dependencyManagement>\r\n+    <dependencies>\r\n+      <dependency>\r\n+        <!-- Import dependency management from Spring Boot -->\r\n+        <groupId>org.springframework.boot</groupId>\r\n+        <artifactId>spring-boot-dependencies</artifactId>\r\n+        <version>2.3.4.RELEASE</version>\r\n+        <type>pom</type>\r\n+        <scope>import</scope>\r\n+      </dependency>\r\n+      <dependency>\r\n+        <groupId>org.springframework.cloud</groupId>\r\n+        <artifactId>spring-cloud-dependencies</artifactId>\r\n+        <version>Hoxton.SR8</version>\r\n+        <type>pom</type>\r\n+        <scope>import</scope>\r\n+      </dependency>\r", "originalCommit": "7336d434cc2b50459dff1a60f2bf3bd15e076a3b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYwMzExOA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r509603118", "bodyText": "Removed.", "author": "grant", "createdAt": "2020-10-21T19:18:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM5NzQzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQwMTM2Ng==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r509401366", "bodyText": "Users may confused what a CloudEvent is here. Maybe add a link or more explanation.", "author": "averikitsch", "createdAt": "2020-10-21T15:48:19Z", "path": "eventarc/generic/README.md", "diffHunk": "@@ -0,0 +1,49 @@\n+# Cloud Eventarc - Generic tutorial\n+\n+This sample shows how to create a service that processes generic CloudEvents.", "originalCommit": "7336d434cc2b50459dff1a60f2bf3bd15e076a3b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTU5OTk0NA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r509599944", "bodyText": "Added a link.\nIn general, we're trying to reduce the amount of duplicate instructions between CloudSite and the docs, so we might remove this README in the future like we do with functions/.", "author": "grant", "createdAt": "2020-10-21T19:12:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQwMTM2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQwMTg5Ng==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r509401896", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            You may observe the Run service receiving an event in Cloud Logging.\n          \n          \n            \n            You may observe the Cloud Run service receiving an event in Cloud Logging.", "author": "averikitsch", "createdAt": "2020-10-21T15:49:02Z", "path": "eventarc/generic/README.md", "diffHunk": "@@ -0,0 +1,49 @@\n+# Cloud Eventarc - Generic tutorial\n+\n+This sample shows how to create a service that processes generic CloudEvents.\n+\n+For more details on how to work with this sample read the [Google Cloud Run Java Samples README](https://github.com/GoogleCloudPlatform/java-docs-samples/tree/master/run).\n+\n+[![Run in Google Cloud][run_img]][run_link]\n+\n+[run_img]: https://storage.googleapis.com/cloudrun/button.svg\n+[run_link]: https://deploy.cloud.run/?git_repo=https://github.com/GoogleCloudPlatform/java-docs-samples&dir=run/events-generic\n+\n+\n+## Dependencies\n+\n+* **Spring Boot**: Web server framework.\n+* **Jib**: Container build tool.\n+* **Junit + SpringBootTest**: [development] Test running framework.\n+* **MockMVC**: [development] Integration testing support framework.\n+\n+## Quickstart\n+\n+Use the [Jib Maven Plugin](https://github.com/GoogleContainerTools/jib/tree/master/jib-maven-plugin) to build and push your container image:\n+\n+```sh\n+mvn jib:build -Dimage gcr.io/$(gcloud config get-value project)/eventarc-generic\n+```\n+\n+Deploy your Cloud Run service:\n+\n+```sh\n+gcloud run deploy eventarc-generic \\\n+--image gcr.io/$(gcloud config get-value project)/eventarc-generic\n+```\n+\n+## Test\n+\n+Test your Cloud Run service by sending CloudEvents: \n+\n+```sh\n+curl -XPOST $CLOUD_RUN_URL \\\n+-H \"Content-Type: application/json\" \\\n+-H \"ce-id: 1413058901901494\" \\\n+-H \"ce-source: //books.googleapis.com/book/MY-BOOK\" \\\n+-H \"ce-specversion: 1.0\" \\\n+-H \"ce-type: my-type\" \\\n+-d '{\"key\": \"value\"}'\n+```\n+\n+You may observe the Run service receiving an event in Cloud Logging.", "originalCommit": "7336d434cc2b50459dff1a60f2bf3bd15e076a3b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYwMjI0Nw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r509602247", "bodyText": "Fix applied.", "author": "grant", "createdAt": "2020-10-21T19:16:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQwMTg5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQwMjE5NA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r509402194", "bodyText": "Need to note what $CLOUD_RUN_URL is.", "author": "averikitsch", "createdAt": "2020-10-21T15:49:21Z", "path": "eventarc/generic/README.md", "diffHunk": "@@ -0,0 +1,49 @@\n+# Cloud Eventarc - Generic tutorial\n+\n+This sample shows how to create a service that processes generic CloudEvents.\n+\n+For more details on how to work with this sample read the [Google Cloud Run Java Samples README](https://github.com/GoogleCloudPlatform/java-docs-samples/tree/master/run).\n+\n+[![Run in Google Cloud][run_img]][run_link]\n+\n+[run_img]: https://storage.googleapis.com/cloudrun/button.svg\n+[run_link]: https://deploy.cloud.run/?git_repo=https://github.com/GoogleCloudPlatform/java-docs-samples&dir=run/events-generic\n+\n+\n+## Dependencies\n+\n+* **Spring Boot**: Web server framework.\n+* **Jib**: Container build tool.\n+* **Junit + SpringBootTest**: [development] Test running framework.\n+* **MockMVC**: [development] Integration testing support framework.\n+\n+## Quickstart\n+\n+Use the [Jib Maven Plugin](https://github.com/GoogleContainerTools/jib/tree/master/jib-maven-plugin) to build and push your container image:\n+\n+```sh\n+mvn jib:build -Dimage gcr.io/$(gcloud config get-value project)/eventarc-generic\n+```\n+\n+Deploy your Cloud Run service:\n+\n+```sh\n+gcloud run deploy eventarc-generic \\\n+--image gcr.io/$(gcloud config get-value project)/eventarc-generic\n+```\n+\n+## Test\n+\n+Test your Cloud Run service by sending CloudEvents: \n+\n+```sh\n+curl -XPOST $CLOUD_RUN_URL \\", "originalCommit": "7336d434cc2b50459dff1a60f2bf3bd15e076a3b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYwMTY3NA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r509601674", "bodyText": "Added.", "author": "grant", "createdAt": "2020-10-21T19:15:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQwMjE5NA=="}], "type": "inlineReview"}, {"oid": "b6b54d5aae55ca3ef497a3d6c0ead4eca3795700", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/b6b54d5aae55ca3ef497a3d6c0ead4eca3795700", "message": "fix: eventarc generic review comments\n\nSigned-off-by: Grant Timmerman <timmerman+devrel@google.com>", "committedDate": "2020-10-21T19:18:42Z", "type": "commit"}, {"oid": "42d20305c29366eda8986286042f3725330a188c", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/42d20305c29366eda8986286042f3725330a188c", "message": "fix: use map for request body type\n\nSigned-off-by: Grant Timmerman <timmerman+devrel@google.com>", "committedDate": "2020-10-23T06:04:45Z", "type": "commit"}, {"oid": "65372044b5db7a247af2954ace3f824118af795d", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/65372044b5db7a247af2954ace3f824118af795d", "message": "fix: use map for request body type\n\nSigned-off-by: Grant Timmerman <timmerman+devrel@google.com>", "committedDate": "2020-10-23T06:05:14Z", "type": "commit"}, {"oid": "65372044b5db7a247af2954ace3f824118af795d", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/65372044b5db7a247af2954ace3f824118af795d", "message": "fix: use map for request body type\n\nSigned-off-by: Grant Timmerman <timmerman+devrel@google.com>", "committedDate": "2020-10-23T06:05:14Z", "type": "forcePushed"}, {"oid": "8ff57f9dacfeb51268d85b361f1b0092b2cac0a5", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/8ff57f9dacfeb51268d85b361f1b0092b2cac0a5", "message": "Merge branch 'master' into grant_eventarc_generic", "committedDate": "2020-10-23T06:16:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAxMzI3OA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r511013278", "bodyText": "I forgot the fields aren't necessary strings, so this should be <String, Object> for the unmarshalling. Will approve for this simple change.", "author": "averikitsch", "createdAt": "2020-10-23T16:50:34Z", "path": "eventarc/audit-storage/src/main/java/com/example/cloudrun/EventController.java", "diffHunk": "@@ -37,7 +36,7 @@\n \n   @RequestMapping(value = \"/\", method = RequestMethod.POST)\n   public ResponseEntity<String> receiveMessage(\n-      @RequestBody PubSubBody body, @RequestHeader Map<String, String> headers) {\n+      @RequestBody Map<String, String> body, @RequestHeader Map<String, String> headers) {", "originalCommit": "8ff57f9dacfeb51268d85b361f1b0092b2cac0a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAxNzc4Mw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r511017783", "bodyText": "Changed to Object.", "author": "grant", "createdAt": "2020-10-23T16:59:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAxMzI3OA=="}], "type": "inlineReview"}, {"oid": "94124e10d318d614df0660d69702ae0a3987628b", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/94124e10d318d614df0660d69702ae0a3987628b", "message": "fix: eventarc audit map from string to object\n\nSigned-off-by: Grant Timmerman <timmerman+devrel@google.com>", "committedDate": "2020-10-23T16:58:37Z", "type": "commit"}]}