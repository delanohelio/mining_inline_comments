{"pr_number": 2852, "pr_title": "Clear current registry between tests.", "pr_createdAt": "2020-05-06T23:14:53Z", "pr_url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2852", "timeline": [{"oid": "768251704027e7ddfec0cf7a27af45b202271f7b", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/768251704027e7ddfec0cf7a27af45b202271f7b", "message": "Clear current registry between tests.", "committedDate": "2020-05-06T22:43:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE2NjQxMw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2852#discussion_r421166413", "bodyText": "What if we run two of these at once?", "author": "lesv", "createdAt": "2020-05-07T00:20:23Z", "path": "iot/api-client/manager/src/test/java/com/example/cloud/iot/examples/ManagerIT.java", "diffHunk": "@@ -115,6 +115,16 @@ public void clearTestRegistries() throws Exception {\n             DeviceRegistryExample.clearRegistry(CLOUD_REGION, PROJECT_ID, registryId);\n           }\n         }\n+        // Also remove the current test registry\n+        try {\n+          DeviceRegistryExample.clearRegistry(CLOUD_REGION, PROJECT_ID, REGISTRY_ID);", "originalCommit": "768251704027e7ddfec0cf7a27af45b202271f7b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE4NjQ5OA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2852#discussion_r421186498", "bodyText": "They should have different registry IDs, this is more to protect against a failure in a previous test having a resource conflict in all subsequent tests.", "author": "gguuss", "createdAt": "2020-05-07T01:29:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE2NjQxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE4NzUxNw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2852#discussion_r421187517", "bodyText": "It may make sense to use part of a UUID4 in the registry name though to help prevent that but for now the name is calculated as:\nprivate static final String REGISTRY_ID = \"java-reg-\" + (System.currentTimeMillis() / 100L);\nSo that stale registries can be pruned in this step without deleting registries currently being tested while preventing stale registries from reaching the 100 registries per project limit.", "author": "gguuss", "createdAt": "2020-05-07T01:32:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE2NjQxMw=="}], "type": "inlineReview"}, {"oid": "79d0111e3692c1875a6a5242ea25c31ba123c548", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/79d0111e3692c1875a6a5242ea25c31ba123c548", "message": "Corrects naming on registry ID", "committedDate": "2020-05-07T01:45:35Z", "type": "commit"}]}