{"pr_number": 3993, "pr_title": "samples: added cleanup option", "pr_createdAt": "2020-10-13T19:15:50Z", "pr_url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3993", "timeline": [{"oid": "fd267d906f4ac22dbcb1fb76092537cae7c56e72", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/fd267d906f4ac22dbcb1fb76092537cae7c56e72", "message": "samples: added cleanup option", "committedDate": "2020-10-13T19:13:23Z", "type": "commit"}, {"oid": "6d2cabaf9e38eceb852055c0fcf1ff7ef3c971f2", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/6d2cabaf9e38eceb852055c0fcf1ff7ef3c971f2", "message": "removed the main", "committedDate": "2020-10-13T20:34:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1MTIwMw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3993#discussion_r504251203", "bodyText": "Do you mean for this to be here?", "author": "lesv", "createdAt": "2020-10-13T20:52:07Z", "path": "iot/api-client/end-to-end-example/src/test/java/com/example/cloud/iot/endtoend/CloudiotPubsubExampleServerTest.java", "diffHunk": "@@ -80,6 +95,37 @@ public void testConfigTurnOn() throws GeneralSecurityException, IOException, JSO\n     CloudiotPubsubExampleServer.deleteRegistry(CLOUD_REGION, PROJECT_ID, REGISTRY_ID);\n   }\n \n+  private void deleteUnusedOldRegistries(String projectId, String region)\n+      throws IOException, GeneralSecurityException {\n+    // Clean 50 oldest registries with testing prefix in the project.\n+    System.out.println(\"The maximum number of registries is about to exceed.\");\n+    System.out.println(\"Deleting the oldest 50 registries with IoT Test prefix\");\n+\n+    // Gather all the registries into temp list\n+    List<DeviceRegistry> registries = CleanUpHelper.getRegisteries(PROJECT_ID, CLOUD_REGION);\n+\n+    // Filter all registries with prefix.\n+    // since the list is already sorted by currentMillis suffix,\n+    // first 50 will be the oldest.\n+    List<DeviceRegistry> filteredRegistries = new ArrayList<>();\n+\n+    for (int i = 0; i < registries.size(); i++) {\n+      DeviceRegistry registry = registries.get(i);\n+      if (registry.getName().contains(\"test-registry-\")\n+          || registry.getName().contains(\"java-reg-\")) {\n+        filteredRegistries.add(registry);\n+      }\n+    }\n+\n+    // Delete the 50 oldest registries\n+    for (DeviceRegistry registry : filteredRegistries) {\n+      CleanUpHelper.clearRegistry(CLOUD_REGION, PROJECT_ID, registry.getId());\n+    }\n+    //      if()\n+    //      CleanUpHelper.clearRegistry();\n+    //    }", "originalCommit": "6d2cabaf9e38eceb852055c0fcf1ff7ef3c971f2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1NzU4MQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3993#discussion_r504257581", "bodyText": "oops\nI will fix that", "author": "munkhuushmgl", "createdAt": "2020-10-13T21:04:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1MTIwMw=="}], "type": "inlineReview"}, {"oid": "140bcb5ea5e56a9830feea12d1a94cff8504a7dc", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/140bcb5ea5e56a9830feea12d1a94cff8504a7dc", "message": "removed commented out code", "committedDate": "2020-10-13T21:05:42Z", "type": "commit"}]}