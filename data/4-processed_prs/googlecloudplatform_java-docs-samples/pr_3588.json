{"pr_number": 3588, "pr_title": "samples(test): refactor automl test", "pr_createdAt": "2020-08-21T18:38:59Z", "pr_url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3588", "timeline": [{"oid": "8f465c6e4c98f9aeafd9b59889728932c03d608e", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/8f465c6e4c98f9aeafd9b59889728932c03d608e", "message": "samples(test): refactor automl test", "committedDate": "2020-08-21T18:34:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDkwMTQ5Mg==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3588#discussion_r474901492", "bodyText": "Should this have a counter of some kind to limit to 3-5m?  It should finish, but just in case?", "author": "lesv", "createdAt": "2020-08-21T19:39:47Z", "path": "automl/cloud-client/src/test/java/com/example/automl/GetOperationStatusTest.java", "diffHunk": "@@ -49,29 +64,50 @@ public static void checkRequirements() {\n   }\n \n   @Before\n-  public void setUp() throws IOException {\n+  public void setUp() throws IOException, ExecutionException, InterruptedException {\n     bout = new ByteArrayOutputStream();\n     out = new PrintStream(bout);\n     System.setOut(out);\n \n-    ListOperationStatus.listOperationStatus(PROJECT_ID);\n-    String got = bout.toString();\n-    operationId = got.split(\"\\n\")[1].split(\":\")[1].trim();\n-    assertThat(got).contains(\"Operation details:\");\n+    // start a export data into dataset and cancel it before it finishes.\n+    try (AutoMlClient client = AutoMlClient.create()) {\n+      // Get the complete path of the dataset.\n+      DatasetName datasetFullId = DatasetName.of(PROJECT_ID, \"us-central1\", DATASET_ID);\n+\n+      GcsDestination gcsSource =\n+          GcsDestination.newBuilder().setOutputUriPrefix(GCS_OUTPUT_PREFIX).build();\n+\n+      OutputConfig outputConfig = OutputConfig.newBuilder().setGcsDestination(gcsSource).build();\n+\n+      // Start the export job\n+      OperationFuture<Empty, OperationMetadata> operation =\n+          client.exportDataAsync(datasetFullId, outputConfig);\n+\n+      operationFullName = operation.getName();\n+    }\n \n     bout = new ByteArrayOutputStream();\n     out = new PrintStream(bout);\n     System.setOut(out);\n   }\n \n   @After\n-  public void tearDown() {\n+  public void tearDown() throws IOException, InterruptedException {\n+    // delete the cancelled operation\n+    try (AutoMlClient client = AutoMlClient.create()) {\n+      // wait for the operation to be cancelled\n+      while (!client.getOperationsClient().getOperation(operationFullName).getDone()) {\n+        Thread.sleep(1000);\n+      }", "originalCommit": "8f465c6e4c98f9aeafd9b59889728932c03d608e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDkxNzAzMw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3588#discussion_r474917033", "bodyText": "I see, that is a good idea, i will add that.", "author": "munkhuushmgl", "createdAt": "2020-08-21T19:58:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDkwMTQ5Mg=="}], "type": "inlineReview"}, {"oid": "0c076d51014c0233f002562c1276ac8a25627d8c", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/0c076d51014c0233f002562c1276ac8a25627d8c", "message": "added 3 min timeout on test", "committedDate": "2020-08-21T21:30:17Z", "type": "commit"}, {"oid": "c939369b4629a46ddc31ce66a55f069318a0c210", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/c939369b4629a46ddc31ce66a55f069318a0c210", "message": "removed unncessary while loop", "committedDate": "2020-08-21T23:13:27Z", "type": "commit"}, {"oid": "20c086d83c8fb8b7032061fb8c75f5b3c2d15e22", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/20c086d83c8fb8b7032061fb8c75f5b3c2d15e22", "message": "added await", "committedDate": "2020-08-21T23:41:52Z", "type": "commit"}, {"oid": "4efea654f4f91d4f69932a94f104717b5baf4cef", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/4efea654f4f91d4f69932a94f104717b5baf4cef", "message": "fixed thel in", "committedDate": "2020-08-21T23:45:54Z", "type": "commit"}]}