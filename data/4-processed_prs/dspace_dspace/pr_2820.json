{"pr_number": 2820, "pr_title": "Curation tasks using the scripts and processes functionality", "pr_createdAt": "2020-07-02T13:13:57Z", "pr_url": "https://github.com/DSpace/DSpace/pull/2820", "timeline": [{"oid": "a2de3c682e5b257da319bdfb67ac31769d5b840c", "url": "https://github.com/DSpace/DSpace/commit/a2de3c682e5b257da319bdfb67ac31769d5b840c", "message": "71513: curation script to DSpaceRunnable", "committedDate": "2020-07-01T14:20:12Z", "type": "commit"}, {"oid": "107a19e909b96621ad25af652b73149b6a5e2310", "url": "https://github.com/DSpace/DSpace/commit/107a19e909b96621ad25af652b73149b6a5e2310", "message": "71513: small fix and script call name change", "committedDate": "2020-07-01T14:20:12Z", "type": "commit"}, {"oid": "351363b79eca7b2b5e819e2efeea1c3f124298dc", "url": "https://github.com/DSpace/DSpace/commit/351363b79eca7b2b5e819e2efeea1c3f124298dc", "message": "71513: spelling", "committedDate": "2020-07-01T14:20:12Z", "type": "commit"}, {"oid": "79c317154ef435613efbd70b24c0a277ce3a35ad", "url": "https://github.com/DSpace/DSpace/commit/79c317154ef435613efbd70b24c0a277ce3a35ad", "message": "71513: ITs for curate script", "committedDate": "2020-07-01T14:20:12Z", "type": "commit"}, {"oid": "85e31825cc6ab6890bf6825c5424a5f332ca000d", "url": "https://github.com/DSpace/DSpace/commit/85e31825cc6ab6890bf6825c5424a5f332ca000d", "message": "71513: test fix from adding curate script to test script definitions", "committedDate": "2020-07-01T14:20:12Z", "type": "commit"}, {"oid": "9ef83bf185a2270661bc25378044ca5d8cdcc239", "url": "https://github.com/DSpace/DSpace/commit/9ef83bf185a2270661bc25378044ca5d8cdcc239", "message": "71513: -i valid dso or all check + test &\nfix so that -t plugin-key instead of entire config &\nAdded test voor noop curate output", "committedDate": "2020-07-01T14:20:12Z", "type": "commit"}, {"oid": "a437cf41c3ec3488d9d7516045c41d484e3f5489", "url": "https://github.com/DSpace/DSpace/commit/a437cf41c3ec3488d9d7516045c41d484e3f5489", "message": "missing license", "committedDate": "2020-07-01T14:20:12Z", "type": "commit"}, {"oid": "e7b33c5fb5bca314384c97088ea43a4dbd93cf6c", "url": "https://github.com/DSpace/DSpace/commit/e7b33c5fb5bca314384c97088ea43a4dbd93cf6c", "message": "71629: fix testCurate_NoOpTask", "committedDate": "2020-07-01T15:53:06Z", "type": "commit"}, {"oid": "fec04568ffcf761777702144ba47007293b39fb0", "url": "https://github.com/DSpace/DSpace/commit/fec04568ffcf761777702144ba47007293b39fb0", "message": "71629: checkstyle & removed unused annotations", "committedDate": "2020-07-02T13:49:18Z", "type": "commit"}, {"oid": "fec04568ffcf761777702144ba47007293b39fb0", "url": "https://github.com/DSpace/DSpace/commit/fec04568ffcf761777702144ba47007293b39fb0", "message": "71629: checkstyle & removed unused annotations", "committedDate": "2020-07-02T13:49:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyMDA3MQ==", "url": "https://github.com/DSpace/DSpace/pull/2820#discussion_r457720071", "bodyText": "This should have a comment to explain it.  Something like:\n# Ensure list of Curation Tasks (defined above) is available via the REST API /api/config/properties endpoint\nUPDATE:  I'm also realizing that this curate.cfg file needs more updates.  It looks like we no longer need the curate.ui.* settings in this file (they likely can be removed entirely as they are not needed in DSpace/dspace-angular#799).   Additionally, we should update the list of plugin.named.org.dspace.curate.CurationTask to comment out those tasks which are normally NOT enabled by default.  As in DSpace v6.x, there should only be 3 default tasks enabled... profileformats, requiredmetadata, and checklinks.  You could leave noop uncommented, but both vscan and translate should be commented out as they require additional configuration to work correctly.\nUPDATE 2:  I'm also now wondering where this plugin.named.org.dspace.curate.CurationTask setting is being used from the REST API.  After reviewing DSpace/dspace-angular#799, it looks like it is NOT used there.  So, we may be able to simply remove this new rest.properties.exposed line altogether. But, I still think we should comment out the vscan and translate tasks by default, so they are not runnable from REST API until configured.", "author": "tdonohue", "createdAt": "2020-07-20T22:10:07Z", "path": "dspace/config/modules/curate.cfg", "diffHunk": "@@ -52,3 +52,6 @@ curate.ui.statusmessages = \\\n      2 = Skip, \\\n      other = Invalid Status\n \n+\n+rest.properties.exposed = plugin.named.org.dspace.curate.CurationTask", "originalCommit": "fec04568ffcf761777702144ba47007293b39fb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI3Njk2Nw==", "url": "https://github.com/DSpace/DSpace/pull/2820#discussion_r459276967", "bodyText": "@tdonohue\n\nEmail parameter in UI\n\nI checked this with Kevin, and he provided me with the information regarding the work about this being fixed for the  metadata-import. I'll schedule to have this updated for this piece of code as well.\nLong story short is that there is a difference between the actual CLI and REST. This will not be handled in general in the scripts and processes framework since this needs to be handled on a par script basis (Since there are scripts that won't have a difference in CLI/REST options)\n\n\nWith regard to your comment about the REST API not returning the Curation task output\n\nWe are looking into this under the general 'Scripts and Processes' work so this can be handled over the entire codebase and not simply on a per script implementation basis.\nThat would add in the option to keep the output separately for the scripts and processes.\nThis would also allow us to have more fine-grained tests for these types of functionality. For example checking that the output of the noop curation task contains the correct information)\n\n\ncurate.cfg configuration updates\n\nI've commented out vscan and translate and removed the curate.ui.* properties  the configuration as per your request (As your rightfully mentioned curate.ui.* isn't used anymore, and no actual tests are related to these properties)\nThe configuration for rest.properties.exposed is related to  #2762. To shield the configuration of the properties, the information that can be retrieved through rest need to be configured as such. I'd advise to keep it, so at least there is an option to retrieve the curation tasks that are enabled. (Not having this config exposed shields this config)\n\nCalling /api/config/properties/plugin.named.org.dspace.curate.CurationTask would then return the actual tasks that ARE configured. (So the 4 remaining 'enabled' tasks configured in the config )", "author": "jonas-atmire", "createdAt": "2020-07-23T08:01:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyMDA3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTc0ODI1NQ==", "url": "https://github.com/DSpace/DSpace/pull/2820#discussion_r459748255", "bodyText": "@jonas-atmire : Thanks for the summary/response.  A few things to be aware of:\n\nEmail Parameter in UI / REST:  Please don't start any work on this yet.  We (the DSpace 7 team) will be discussing this security flaw in next week's meeting to provide a route forward. https://wiki.lyrasis.org/display/DSPACE/2020-07-30+DSpace+7+Working+Group+Meeting\nREST API not returning the Curation task output: Your plan sounds good overall.\ncurate.cfg configuration updates:  These changes sound good overall...After reviewing the corresponding Angular PR: DSpace/dspace-angular#799 I found there definitely is a need for the /api/config/properties/plugin.named.org.dspace.curate.CurationTask to be exposed.  (Currently, both PRs are configuring a list of \"enabled\" curation tasks.   Rather than hardcoding this list both on the frontend and backend, ideally the frontend should check the configuration of the backend.)    So, you are correct, this is needed & the changes look good.", "author": "tdonohue", "createdAt": "2020-07-23T21:51:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyMDA3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM5OTQxMg==", "url": "https://github.com/DSpace/DSpace/pull/2820#discussion_r461399412", "bodyText": "@tdonohue, just a bit of cross referencing\nREST API not returning the Curation task output:\nThis is currently being fixed in the following PR:\n#2905", "author": "jonas-atmire", "createdAt": "2020-07-28T08:12:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyMDA3MQ=="}], "type": "inlineReview"}, {"oid": "7a269f3460525eb6395af4b1a71fa3a91aafbb0b", "url": "https://github.com/DSpace/DSpace/commit/7a269f3460525eb6395af4b1a71fa3a91aafbb0b", "message": "Curate.cfg properties cleanup based on PR feedback - https://github.com/DSpace/DSpace/pull/2820", "committedDate": "2020-07-23T08:00:51Z", "type": "commit"}]}