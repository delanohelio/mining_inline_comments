{"pr_number": 2657, "pr_title": "[DS-4257] dspace.url and dspace.baseUrl config cleanup", "pr_createdAt": "2020-01-29T16:28:51Z", "pr_url": "https://github.com/DSpace/DSpace/pull/2657", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzMTM5Mg==", "url": "https://github.com/DSpace/DSpace/pull/2657#discussion_r373031392", "bodyText": "If this should match dspace.ui.url then shouldn't we refer to it in dspace.ui.url (and dspace.server.url)?  That is:\ndspace.ui.hostname = localhost\ndspace.ui.url = http://${dspace.ui.hostname}:3000\ndspace.server.url = http://${dspace.ui.hostname}:8080/server\n\n(That does make the name dspace.ui.hostname confusing, though.)", "author": "mwoodiupui", "createdAt": "2020-01-30T15:50:50Z", "path": "dspace/config/local.cfg.EXAMPLE", "diffHunk": "@@ -30,14 +30,18 @@\n # Windows note: Please remember to use forward slashes for all paths (e.g. C:/dspace)\n dspace.dir=/dspace\n \n-# DSpace host name - should match base URL.  Do not include port number\n-dspace.hostname = localhost\n+# URL of DSpace backend ('server' webapp). Include port number etc.\n+# This is where REST API and all enabled server modules (OAI-PMH, SWORD, SWORDv2, RDF, etc) will respond\n+dspace.server.url = http://localhost:8080/server\n \n-# DSpace server backend webapp URL.  Include port number etc.\n-dspace.baseUrl = http://localhost:8080/server\n+# DSpace UI hostname. Should match dspace.ui.url.  Do not include port number.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzNzAzMA==", "url": "https://github.com/DSpace/DSpace/pull/2657#discussion_r373037030", "bodyText": "@mwoodiupui : Unfortunately, there's no guarantee that the \"hostname\" is the same for both the frontend (UI) and the backend (REST API).  It might be in many scenarios, but some sites may choose to install these on separate servers, with separate URLs.\nThat's why I chose to rename dspace.hostname to dspace.ui.hostname to clarify that the expected hostname here is the hostname of the frontend (UI), and not necessarily the backend.\nI completely agree that this \"hostname\" is confusing, but I couldn't find a way to easily refactor it out of the codebase altogether.  Perhaps we should build a utility to simply pull the hostname out of the URL rather than configuring it separately.\nUPDATE: I guess we could just consider removing this confusing \"hostname\" configuration and replacing it with a bit of code like this: https://stackoverflow.com/a/23079402", "author": "tdonohue", "createdAt": "2020-01-30T15:59:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzMTM5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA1NTk1MQ==", "url": "https://github.com/DSpace/DSpace/pull/2657#discussion_r373055951", "bodyText": "Plucking the hostname out of the URL (which must be configured) is better than having a property that has to be coordinated with others, in code.  We should do that.\nI was thinking of simplifying the coordination of multiple configuration properties.  Backend and frontend (and Solr) can be on different hosts, but I expect they typically won't be.  In the example we have the same hostname in four places and have to change all four the same way.  However, on reflection I see that there are too many choices, so I suppose my best approach is to give up trying to link it all together.", "author": "mwoodiupui", "createdAt": "2020-01-30T16:30:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzMTM5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA3NjA2MA==", "url": "https://github.com/DSpace/DSpace/pull/2657#discussion_r373076060", "bodyText": "@mwoodiupui : Yes, I think I agree. I'll update this PR to pluck the hostname out of the URL.  Thanks for this feedback!\nAs for simplifying configuration, I think this will be as simple as we can get.  However, keep in mind, the DSpace configuration system is perfectly OK with you creating new custom configs.  So, locally, anyone could (re)create a hostname config and use it to populate both URLs.", "author": "tdonohue", "createdAt": "2020-01-30T17:05:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzMTM5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzcxODk3MQ==", "url": "https://github.com/DSpace/DSpace/pull/2657#discussion_r373718971", "bodyText": "@mwoodiupui : I've now refactored the code to remove the need for a hostname configuration. See the updated PR description above.\nI'd appreciate your review here, as I did have to do some code refactoring (especially in OAI-PMH) to ensure the \"hostname\" could always be extracted from the URL.  However, I've added tests for all new utility methods & I've done local tests myself and everything seems to be working.", "author": "tdonohue", "createdAt": "2020-01-31T22:47:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzMTM5Mg=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDEwNDQ3Ng==", "url": "https://github.com/DSpace/DSpace/pull/2657#discussion_r374104476", "bodyText": "Why do we do this?", "author": "mwoodiupui", "createdAt": "2020-02-03T13:36:24Z", "path": "dspace-api/src/main/java/org/dspace/core/Utils.java", "diffHunk": "@@ -408,4 +413,38 @@ public static String standardize(String schema, String element, String qualifier\n             return schema + separator + element + separator + qualifier;\n         }\n     }\n+\n+\n+    /**\n+     * Retrieve the hostname from a given URI string\n+     * @param uriString URI string\n+     * @return hostname (without any www.) or null (if URI was invalid)\n+     */\n+    public static String getHostName(String uriString) {\n+        try {\n+            URI uri = new URI(uriString);\n+            String hostname = uri.getHost();\n+            // remove the \"www.\" from hostname, if it exists", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE1MDQ4Mg==", "url": "https://github.com/DSpace/DSpace/pull/2657#discussion_r374150482", "bodyText": "@mwoodiupui : Honestly, I guess it was me thinking this looked \"cleaner\" (as www. seem very rarely spelled out these days in URLs).  That said, if we'd rather leave this in the hostname, we could very easily update this method and the corresponding unit test.", "author": "tdonohue", "createdAt": "2020-02-03T15:00:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDEwNDQ3Ng=="}], "type": "inlineReview"}, {"oid": "f64553e31cca5a1c7a19339bc84ecf37a61617f2", "url": "https://github.com/DSpace/DSpace/commit/f64553e31cca5a1c7a19339bc84ecf37a61617f2", "message": "Remove final references to old dspace.restUrl config", "committedDate": "2020-02-13T19:36:00Z", "type": "commit"}, {"oid": "5e3e9b8f9d3d3560f1b77e3ce6e471d109dfdb8a", "url": "https://github.com/DSpace/DSpace/commit/5e3e9b8f9d3d3560f1b77e3ce6e471d109dfdb8a", "message": "Replace all usages of dspace.baseUrl with either dspace.server.url or dspace.ui.url (depending on use case)", "committedDate": "2020-02-13T19:40:23Z", "type": "commit"}, {"oid": "e8180f11cb06539f2faada43cf420df4f2453d5e", "url": "https://github.com/DSpace/DSpace/commit/e8180f11cb06539f2faada43cf420df4f2453d5e", "message": "Replace all usages of dspace.url with either dspace.ui.url or dspace.server.url (depending on use case)", "committedDate": "2020-02-13T19:40:33Z", "type": "commit"}, {"oid": "c55f29de6ad01b2856c9daddf796cbaf01572376", "url": "https://github.com/DSpace/DSpace/commit/c55f29de6ad01b2856c9daddf796cbaf01572376", "message": "Replace dspace.hostname with dspace.ui.hostname. Enhance descriptions of how/where configs are used", "committedDate": "2020-02-13T19:40:34Z", "type": "commit"}, {"oid": "d455d7df87cfbc606f4f3ae93fd5b2511b18b862", "url": "https://github.com/DSpace/DSpace/commit/d455d7df87cfbc606f4f3ae93fd5b2511b18b862", "message": "Fix minor test & checkstyle failures", "committedDate": "2020-02-13T19:40:34Z", "type": "commit"}, {"oid": "b116c55714f34866c75b2e4733bab021e7f735ed", "url": "https://github.com/DSpace/DSpace/commit/b116c55714f34866c75b2e4733bab021e7f735ed", "message": "Refactor code to remove the need for a \"hostname\" configuration.", "committedDate": "2020-02-13T19:40:35Z", "type": "commit"}, {"oid": "3c43dbdcddf39b2ba638e65bf29e700e1c59c3fa", "url": "https://github.com/DSpace/DSpace/commit/3c43dbdcddf39b2ba638e65bf29e700e1c59c3fa", "message": "Replace dspace.url with dspace.server.url in recent code comments", "committedDate": "2020-02-13T19:42:36Z", "type": "commit"}, {"oid": "3c43dbdcddf39b2ba638e65bf29e700e1c59c3fa", "url": "https://github.com/DSpace/DSpace/commit/3c43dbdcddf39b2ba638e65bf29e700e1c59c3fa", "message": "Replace dspace.url with dspace.server.url in recent code comments", "committedDate": "2020-02-13T19:42:36Z", "type": "forcePushed"}]}