{"pr_number": 2771, "pr_title": "DS-4504 Performance issues with finding Collections a user can submit to", "pr_createdAt": "2020-05-25T15:04:56Z", "pr_url": "https://github.com/DSpace/DSpace/pull/2771", "timeline": [{"oid": "66992cfe19ff04237ded54ade65f7cb405aa258b", "url": "https://github.com/DSpace/DSpace/commit/66992cfe19ff04237ded54ade65f7cb405aa258b", "message": "added solr plugin to index collection submitters", "committedDate": "2020-05-22T20:29:54Z", "type": "commit"}, {"oid": "5139bb881d466cb989f6bebd163d3ef5df202f4e", "url": "https://github.com/DSpace/DSpace/commit/5139bb881d466cb989f6bebd163d3ef5df202f4e", "message": "updated findAuthorizedByCommunity and findAuthorized with Solr query", "committedDate": "2020-05-22T20:41:56Z", "type": "commit"}, {"oid": "22a34ff3683460704dfc1512247fd37f2afe975a", "url": "https://github.com/DSpace/DSpace/commit/22a34ff3683460704dfc1512247fd37f2afe975a", "message": "added ITs for methods findAuthorizedByCommunity and findAuthorized", "committedDate": "2020-05-25T12:36:04Z", "type": "commit"}, {"oid": "41b91ea5b1857657704d2943957e47b6e96a513e", "url": "https://github.com/DSpace/DSpace/commit/41b91ea5b1857657704d2943957e47b6e96a513e", "message": "Merge branch 'master' into DS-4504_UpdatePerformanceFindingCollections", "committedDate": "2020-05-25T14:21:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjYyNjcyMA==", "url": "https://github.com/DSpace/DSpace/pull/2771#discussion_r432626720", "bodyText": "This entire method seems like we may want to consider moving it into the dspace-api.  It's a bit odd to me to have a RestRepository class building detailed Solr queries, which makes me wonder if we need to consider moving this into the CollectionIndexFactoryImpl or somewhere similar (and then just calling that new method from this RestRepository class)?", "author": "tdonohue", "createdAt": "2020-05-29T17:16:39Z", "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/repository/CollectionRestRepository.java", "diffHunk": "@@ -174,19 +178,70 @@ public CollectionRest findOne(Context context, UUID id) {\n                     CommunityRest.CATEGORY + \".\" + CommunityRest.NAME + \" with id: \" + communityUuid\n                         + \" not found\");\n             }\n-            List<Collection> collections = cs.findAuthorized(context, com, Constants.ADD);\n-            return converter.toRestPage(collections, pageable, utils.obtainProjection());\n-        } catch (SQLException e) {\n+            List<Collection> collections = new LinkedList<Collection>();\n+            DiscoverResult resp = discoverAuthorizedCollections(pageable, q, context, com);\n+            long tot = resp.getTotalSearchResults();\n+            for (IndexableObject solrCollections : resp.getIndexableObjects()) {\n+                Collection c = ((IndexableCollection) solrCollections).getIndexedObject();\n+                collections.add(c);\n+            }\n+            return converter.toRestPage(collections, pageable, tot , utils.obtainProjection());\n+        } catch (SQLException | SearchServiceException e) {\n             throw new RuntimeException(e.getMessage(), e);\n         }\n     }\n \n+    private DiscoverResult discoverAuthorizedCollections(Pageable pageable, String q, Context context, Community com)", "originalCommit": "41b91ea5b1857657704d2943957e47b6e96a513e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcwNTk0MA==", "url": "https://github.com/DSpace/DSpace/pull/2771#discussion_r434705940", "bodyText": "you are right. Should we move it to the CollectionService? should we name it findAuthorizedCollectionsInSOLR", "author": "abollini", "createdAt": "2020-06-03T16:38:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjYyNjcyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc4MzY1Nw==", "url": "https://github.com/DSpace/DSpace/pull/2771#discussion_r435783657", "bodyText": "@Micheleboychuk please refactor the code adding the method in the CollectionService as by comment above. We have discussed that briefly in yesterday meeting and @tdonohue was just fine to move it in the dspace-api layer", "author": "abollini", "createdAt": "2020-06-05T08:55:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjYyNjcyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjYyOTk0OQ==", "url": "https://github.com/DSpace/DSpace/pull/2771#discussion_r432629949", "bodyText": "We may want to add a comment here to explain the difference between \"submit\" and the existing \"submitter\" index (as it may be confusing in the future).  Obviously this index is to track which group(s) have submit permissions, while \"submitter\" seems to be who submitted an item.  They are similarly named, so we should add a comment here to describe them.", "author": "tdonohue", "createdAt": "2020-05-29T17:22:54Z", "path": "dspace/solr/search/conf/schema.xml", "diffHunk": "@@ -259,6 +259,8 @@\n     <field name=\"taskfor\" type=\"string\" indexed=\"true\" stored=\"true\" omitNorms=\"true\" multiValued=\"true\" docValues=\"true\" />\n    \n     <field name=\"has_content_in_original_bundle\" type=\"string\" indexed=\"true\" stored=\"true\" omitNorms=\"true\" multiValued=\"true\" docValues=\"true\" />\n+\n+    <field name=\"submit\" type=\"string\" indexed=\"true\" stored=\"true\" omitNorms=\"true\" multiValued=\"true\" docValues=\"true\" />", "originalCommit": "41b91ea5b1857657704d2943957e47b6e96a513e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDU5MzAzNw==", "url": "https://github.com/DSpace/DSpace/pull/2771#discussion_r434593037", "bodyText": "What is the use case for this new \"query\" parameter ? Because it isn't in the rest contract: https://github.com/DSpace/Rest7Contract/blob/733d81061f1dbcd3049ed0d80130746418a4b3a1/collections.md#findauthorizedbycommunity", "author": "KevinVdV", "createdAt": "2020-06-03T14:05:12Z", "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/repository/CollectionRestRepository.java", "diffHunk": "@@ -165,7 +168,8 @@ public CollectionRest findOne(Context context, UUID id) {\n \n     @SearchRestMethod(name = \"findAuthorizedByCommunity\")\n     public Page<CollectionRest> findAuthorizedByCommunity(\n-        @Parameter(value = \"uuid\", required = true) UUID communityUuid, Pageable pageable) {\n+        @Parameter(value = \"uuid\", required = true) UUID communityUuid, Pageable pageable,\n+        @Parameter(value = \"query\") String q) {", "originalCommit": "41b91ea5b1857657704d2943957e47b6e96a513e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDY5OTk2OQ==", "url": "https://github.com/DSpace/DSpace/pull/2771#discussion_r434699969", "bodyText": "thanks to point to the rest contract. Indeed we need to create a PR to document this change. The need for a query parameter was noted and agreed in the discussion about how to address the performance issue https://wiki.lyrasis.org/display/DSPACE/Collection+dropdown+in+submission", "author": "abollini", "createdAt": "2020-06-03T16:29:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDU5MzAzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQwNzIyOQ==", "url": "https://github.com/DSpace/DSpace/pull/2771#discussion_r440407229", "bodyText": "Yes, I agree we need an updated REST Contract here to document the query param.  Additionally, the JavaDocs should be updated for this method to describe the param.", "author": "tdonohue", "createdAt": "2020-06-15T19:46:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDU5MzAzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg3NTY4MA==", "url": "https://github.com/DSpace/DSpace/pull/2771#discussion_r440875680", "bodyText": "DSpace/RestContract#127", "author": "abollini", "createdAt": "2020-06-16T14:02:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDU5MzAzNw=="}], "type": "inlineReview"}, {"oid": "26f6a7d0d879221845b5bac7f79f8c5bf5f107f4", "url": "https://github.com/DSpace/DSpace/commit/26f6a7d0d879221845b5bac7f79f8c5bf5f107f4", "message": "Implement community feedbacks", "committedDate": "2020-06-05T15:13:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzMzOTM0NA==", "url": "https://github.com/DSpace/DSpace/pull/2771#discussion_r437339344", "bodyText": "This StringBuilder object is created here, but isn't used until the resultSolrQuery() method. Can you move the creation of the variable to the resultSolrQuery() method.", "author": "KevinVdV", "createdAt": "2020-06-09T11:34:12Z", "path": "dspace-api/src/main/java/org/dspace/content/CollectionServiceImpl.java", "diffHunk": "@@ -907,4 +919,66 @@ public Group createDefaultReadGroup(Context context, Collection collection, Stri\n         return role;\n     }\n \n+    @Override\n+    public List<Collection> findAuthorizedCollectionsInSOLR(String q, Context context, Community community,\n+        int offset, int limit) throws SQLException, SearchServiceException {\n+\n+        List<Collection> collections = new ArrayList<Collection>();\n+        StringBuilder query = new StringBuilder();", "originalCommit": "26f6a7d0d879221845b5bac7f79f8c5bf5f107f4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzMzOTQ2MA==", "url": "https://github.com/DSpace/DSpace/pull/2771#discussion_r437339460", "bodyText": "Same as above, move the variable to the resultSolrQuery() method.", "author": "KevinVdV", "createdAt": "2020-06-09T11:34:28Z", "path": "dspace-api/src/main/java/org/dspace/content/CollectionServiceImpl.java", "diffHunk": "@@ -907,4 +919,66 @@ public Group createDefaultReadGroup(Context context, Collection collection, Stri\n         return role;\n     }\n \n+    @Override\n+    public List<Collection> findAuthorizedCollectionsInSOLR(String q, Context context, Community community,\n+        int offset, int limit) throws SQLException, SearchServiceException {\n+\n+        List<Collection> collections = new ArrayList<Collection>();\n+        StringBuilder query = new StringBuilder();\n+        DiscoverQuery discoverQuery = new DiscoverQuery();\n+        discoverQuery.setDSpaceObjectFilter(IndexableCollection.TYPE);\n+        discoverQuery.setStart(offset);\n+        discoverQuery.setMaxResults(limit);\n+        DiscoverResult resp = resultSolrQuery(context, query, discoverQuery,community, q);\n+        for (IndexableObject solrCollections : resp.getIndexableObjects()) {\n+            Collection c = ((IndexableCollection) solrCollections).getIndexedObject();\n+            collections.add(c);\n+        }\n+        return collections;\n+    }\n+\n+    @Override\n+    public int countAuthorizedCollectionsInSOLR(String q, Context context, Community community)\n+        throws SQLException, SearchServiceException {\n+\n+        StringBuilder query = new StringBuilder();", "originalCommit": "26f6a7d0d879221845b5bac7f79f8c5bf5f107f4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM0MDI4Mg==", "url": "https://github.com/DSpace/DSpace/pull/2771#discussion_r437340282", "bodyText": "As we only need the total results for this one can you call on:\ndiscoverQuery.setMaxResults(0);\nBecause the default here is 10 & we don't need to retrieve these objects from the database if we need the total count.", "author": "KevinVdV", "createdAt": "2020-06-09T11:36:00Z", "path": "dspace-api/src/main/java/org/dspace/content/CollectionServiceImpl.java", "diffHunk": "@@ -907,4 +919,66 @@ public Group createDefaultReadGroup(Context context, Collection collection, Stri\n         return role;\n     }\n \n+    @Override\n+    public List<Collection> findAuthorizedCollectionsInSOLR(String q, Context context, Community community,\n+        int offset, int limit) throws SQLException, SearchServiceException {\n+\n+        List<Collection> collections = new ArrayList<Collection>();\n+        StringBuilder query = new StringBuilder();\n+        DiscoverQuery discoverQuery = new DiscoverQuery();\n+        discoverQuery.setDSpaceObjectFilter(IndexableCollection.TYPE);\n+        discoverQuery.setStart(offset);\n+        discoverQuery.setMaxResults(limit);\n+        DiscoverResult resp = resultSolrQuery(context, query, discoverQuery,community, q);\n+        for (IndexableObject solrCollections : resp.getIndexableObjects()) {\n+            Collection c = ((IndexableCollection) solrCollections).getIndexedObject();\n+            collections.add(c);\n+        }\n+        return collections;\n+    }\n+\n+    @Override\n+    public int countAuthorizedCollectionsInSOLR(String q, Context context, Community community)\n+        throws SQLException, SearchServiceException {\n+\n+        StringBuilder query = new StringBuilder();\n+        DiscoverQuery discoverQuery = new DiscoverQuery();", "originalCommit": "26f6a7d0d879221845b5bac7f79f8c5bf5f107f4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM0MTIwOQ==", "url": "https://github.com/DSpace/DSpace/pull/2771#discussion_r437341209", "bodyText": "Can we rename the method name here ? This method is used specifically to retrieve authorized collections a user can submit in.", "author": "KevinVdV", "createdAt": "2020-06-09T11:37:42Z", "path": "dspace-api/src/main/java/org/dspace/content/CollectionServiceImpl.java", "diffHunk": "@@ -907,4 +919,66 @@ public Group createDefaultReadGroup(Context context, Collection collection, Stri\n         return role;\n     }\n \n+    @Override\n+    public List<Collection> findAuthorizedCollectionsInSOLR(String q, Context context, Community community,\n+        int offset, int limit) throws SQLException, SearchServiceException {\n+\n+        List<Collection> collections = new ArrayList<Collection>();\n+        StringBuilder query = new StringBuilder();\n+        DiscoverQuery discoverQuery = new DiscoverQuery();\n+        discoverQuery.setDSpaceObjectFilter(IndexableCollection.TYPE);\n+        discoverQuery.setStart(offset);\n+        discoverQuery.setMaxResults(limit);\n+        DiscoverResult resp = resultSolrQuery(context, query, discoverQuery,community, q);\n+        for (IndexableObject solrCollections : resp.getIndexableObjects()) {\n+            Collection c = ((IndexableCollection) solrCollections).getIndexedObject();\n+            collections.add(c);\n+        }\n+        return collections;\n+    }\n+\n+    @Override\n+    public int countAuthorizedCollectionsInSOLR(String q, Context context, Community community)\n+        throws SQLException, SearchServiceException {\n+\n+        StringBuilder query = new StringBuilder();\n+        DiscoverQuery discoverQuery = new DiscoverQuery();\n+        discoverQuery.setDSpaceObjectFilter(IndexableCollection.TYPE);\n+        DiscoverResult resp = resultSolrQuery(context, query, discoverQuery,community,q);\n+        return (int)resp.getTotalSearchResults();\n+    }\n+\n+    private DiscoverResult resultSolrQuery(Context context, StringBuilder query, DiscoverQuery discoverQuery,", "originalCommit": "26f6a7d0d879221845b5bac7f79f8c5bf5f107f4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM0MjA0NQ==", "url": "https://github.com/DSpace/DSpace/pull/2771#discussion_r437342045", "bodyText": "Can we leave out the call to the anonymousGroup group here ? Anonymous will never be granted submit rights (as you always need a logged in user), so this database call is not needed.", "author": "KevinVdV", "createdAt": "2020-06-09T11:39:17Z", "path": "dspace-api/src/main/java/org/dspace/content/CollectionServiceImpl.java", "diffHunk": "@@ -907,4 +919,66 @@ public Group createDefaultReadGroup(Context context, Collection collection, Stri\n         return role;\n     }\n \n+    @Override\n+    public List<Collection> findAuthorizedCollectionsInSOLR(String q, Context context, Community community,\n+        int offset, int limit) throws SQLException, SearchServiceException {\n+\n+        List<Collection> collections = new ArrayList<Collection>();\n+        StringBuilder query = new StringBuilder();\n+        DiscoverQuery discoverQuery = new DiscoverQuery();\n+        discoverQuery.setDSpaceObjectFilter(IndexableCollection.TYPE);\n+        discoverQuery.setStart(offset);\n+        discoverQuery.setMaxResults(limit);\n+        DiscoverResult resp = resultSolrQuery(context, query, discoverQuery,community, q);\n+        for (IndexableObject solrCollections : resp.getIndexableObjects()) {\n+            Collection c = ((IndexableCollection) solrCollections).getIndexedObject();\n+            collections.add(c);\n+        }\n+        return collections;\n+    }\n+\n+    @Override\n+    public int countAuthorizedCollectionsInSOLR(String q, Context context, Community community)\n+        throws SQLException, SearchServiceException {\n+\n+        StringBuilder query = new StringBuilder();\n+        DiscoverQuery discoverQuery = new DiscoverQuery();\n+        discoverQuery.setDSpaceObjectFilter(IndexableCollection.TYPE);\n+        DiscoverResult resp = resultSolrQuery(context, query, discoverQuery,community,q);\n+        return (int)resp.getTotalSearchResults();\n+    }\n+\n+    private DiscoverResult resultSolrQuery(Context context, StringBuilder query, DiscoverQuery discoverQuery,\n+                                   Community community, String q) throws SQLException, SearchServiceException {\n+\n+        EPerson currentUser = context.getCurrentUser();\n+        if (!authorizeService.isAdmin(context)) {\n+            Group anonymousGroup = groupService.findByName(context, Group.ANONYMOUS);", "originalCommit": "26f6a7d0d879221845b5bac7f79f8c5bf5f107f4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d9d698dcd1d11503742ef4f91e85eee71c73bc87", "url": "https://github.com/DSpace/DSpace/commit/d9d698dcd1d11503742ef4f91e85eee71c73bc87", "message": "Implement community feedbacks", "committedDate": "2020-06-11T17:19:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQwMjc0MQ==", "url": "https://github.com/DSpace/DSpace/pull/2771#discussion_r440402741", "bodyText": "This method needs renaming.  It doesn't work for any authorization type (e.g. it cannot check for READ permissions).  It's specific to Submit permissions only.   I also don't like adding \"InSOLR\" on the end as it's unnecessary.\nI'd recommend naming this something like findCollectionsWithSubmit() as that better states we are returning collection the current user has submit privileges within.  Also, this needs better JavaDocs to describe the method.  It should say something like \"Returns Collections for which the current user has 'submit' privileges.  NOTE: for better performance, this method retrieves its results from an index (cache) and does not query the database directly.  This means that results may be stale or outdated until DS-4524 is resolved\"\nUPDATE: Also, could we add a basic test for this new method to CollectionTest?  That'd also provide some proof that the Solr Plugin is working as expected.", "author": "tdonohue", "createdAt": "2020-06-15T19:38:08Z", "path": "dspace-api/src/main/java/org/dspace/content/service/CollectionService.java", "diffHunk": "@@ -354,4 +356,34 @@ public void canEdit(Context context, Collection collection, boolean useInheritan\n      */\n     Group createDefaultReadGroup(Context context, Collection collection, String typeOfGroupString, int defaultRead)\n         throws SQLException, AuthorizeException;\n+\n+    /**\n+     * \n+     * @param q                limit the returned collection to those with metadata values matching the query terms.\n+     *                         The terms are used to make also a prefix query on SOLR so it can be used to implement\n+     *                         an autosuggest feature over the collection name\n+     * @param context          DSpace Context\n+     * @param community        parent community\n+     * @param offset           the position of the first result to return\n+     * @param limit            paging limit\n+     * @return                 discovery search result objects\n+     * @throws SQLException              if something goes wrong\n+     * @throws SearchServiceException    if search error\n+     */\n+    public List<Collection> findAuthorizedCollectionsInSOLR(String q, Context context, Community community,", "originalCommit": "d9d698dcd1d11503742ef4f91e85eee71c73bc87", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg3NjQxOQ==", "url": "https://github.com/DSpace/DSpace/pull/2771#discussion_r440876419", "bodyText": "these renaming have been applied also to the rest contract, see DSpace/RestContract#127", "author": "abollini", "createdAt": "2020-06-16T14:03:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQwMjc0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg4MjQ3NQ==", "url": "https://github.com/DSpace/DSpace/pull/2771#discussion_r440882475", "bodyText": "As there are already IT that proof that the whole stack and so the SolrPlugin works as expected we would like to have that merged as is. We have tried to add some unit test in CollectionTest but it is more complicated than expected as the dspace-api doesn't support yet test in SOLR. This was also noted in this PR #2744  so we suggest to merge this PR as is, solve the issue with the solr testing in and later (https://jira.lyrasis.org/browse/DS-4526 ) add these extra test in the CollectionTest class", "author": "abollini", "createdAt": "2020-06-16T14:12:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQwMjc0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQwMzYzMg==", "url": "https://github.com/DSpace/DSpace/pull/2771#discussion_r440403632", "bodyText": "Again, should be renamed to something like countCollectionsWithSubmit(). JavaDocs should also be added to describe the method. Something like: \"Counts the number of Collection for which the current user has 'submit' privileges. NOTE: for better performance, this method retrieves its results from an index (cache) and does not query the database directly. This means that results may be stale or outdated until DS-4524 is resolved.\"", "author": "tdonohue", "createdAt": "2020-06-15T19:39:53Z", "path": "dspace-api/src/main/java/org/dspace/content/service/CollectionService.java", "diffHunk": "@@ -354,4 +356,34 @@ public void canEdit(Context context, Collection collection, boolean useInheritan\n      */\n     Group createDefaultReadGroup(Context context, Collection collection, String typeOfGroupString, int defaultRead)\n         throws SQLException, AuthorizeException;\n+\n+    /**\n+     * \n+     * @param q                limit the returned collection to those with metadata values matching the query terms.\n+     *                         The terms are used to make also a prefix query on SOLR so it can be used to implement\n+     *                         an autosuggest feature over the collection name\n+     * @param context          DSpace Context\n+     * @param community        parent community\n+     * @param offset           the position of the first result to return\n+     * @param limit            paging limit\n+     * @return                 discovery search result objects\n+     * @throws SQLException              if something goes wrong\n+     * @throws SearchServiceException    if search error\n+     */\n+    public List<Collection> findAuthorizedCollectionsInSOLR(String q, Context context, Community community,\n+        int offset, int limit) throws SQLException, SearchServiceException;\n+\n+    /**\n+     * \n+     * @param q                limit the returned collection to those with metadata values matching the query terms.\n+     *                         The terms are used to make also a prefix query on SOLR so it can be used to implement\n+     *                         an autosuggest feature over the collection name\n+     * @param context          DSpace Context\n+     * @param community        parent community\n+     * @return                 total collections found\n+     * @throws SQLException              if something goes wrong\n+     * @throws SearchServiceException    if search error\n+     */\n+    public int countAuthorizedCollectionsInSOLR(String q, Context context, Community community)", "originalCommit": "d9d698dcd1d11503742ef4f91e85eee71c73bc87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQwNTAyNg==", "url": "https://github.com/DSpace/DSpace/pull/2771#discussion_r440405026", "bodyText": "For consistency, this method should be renamed to retrieveCollectionsWithSubmit().  Can we add JavaDocs here as well, as this is a complex method.   Should say something like \"Finds all Indexed Collections where the current user has submit rights. If the user is an Admin, this is all Indexed Collections.  Otherwise, it includes those collections where an indexed \"submit\" policy lists either the eperson or one of the eperson's groups\"", "author": "tdonohue", "createdAt": "2020-06-15T19:42:28Z", "path": "dspace-api/src/main/java/org/dspace/content/CollectionServiceImpl.java", "diffHunk": "@@ -907,4 +919,62 @@ public Group createDefaultReadGroup(Context context, Collection collection, Stri\n         return role;\n     }\n \n+    @Override\n+    public List<Collection> findAuthorizedCollectionsInSOLR(String q, Context context, Community community,\n+        int offset, int limit) throws SQLException, SearchServiceException {\n+\n+        List<Collection> collections = new ArrayList<Collection>();\n+        DiscoverQuery discoverQuery = new DiscoverQuery();\n+        discoverQuery.setDSpaceObjectFilter(IndexableCollection.TYPE);\n+        discoverQuery.setStart(offset);\n+        discoverQuery.setMaxResults(limit);\n+        DiscoverResult resp = retrieveAuthorizedCollections(context, discoverQuery,community, q);\n+        for (IndexableObject solrCollections : resp.getIndexableObjects()) {\n+            Collection c = ((IndexableCollection) solrCollections).getIndexedObject();\n+            collections.add(c);\n+        }\n+        return collections;\n+    }\n+\n+    @Override\n+    public int countAuthorizedCollectionsInSOLR(String q, Context context, Community community)\n+        throws SQLException, SearchServiceException {\n+\n+        DiscoverQuery discoverQuery = new DiscoverQuery();\n+        discoverQuery.setMaxResults(0);\n+        discoverQuery.setDSpaceObjectFilter(IndexableCollection.TYPE);\n+        DiscoverResult resp = retrieveAuthorizedCollections(context, discoverQuery,community,q);\n+        return (int)resp.getTotalSearchResults();\n+    }\n+\n+    private DiscoverResult retrieveAuthorizedCollections(Context context, DiscoverQuery discoverQuery,", "originalCommit": "d9d698dcd1d11503742ef4f91e85eee71c73bc87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQxMzg1Nw==", "url": "https://github.com/DSpace/DSpace/pull/2771#discussion_r440413857", "bodyText": "I'm just now realizing this @SearchRestMethod seems mis-named as well.  We are not finding all Collections you are authorized to Read or edit or similar.  This is very specific to collections you can submit to.  Shouldn't this be called findSubmitAuthorized  or findAuthorizedForSubmit?", "author": "tdonohue", "createdAt": "2020-06-15T20:00:03Z", "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/repository/CollectionRestRepository.java", "diffHunk": "@@ -174,19 +175,26 @@ public CollectionRest findOne(Context context, UUID id) {\n                     CommunityRest.CATEGORY + \".\" + CommunityRest.NAME + \" with id: \" + communityUuid\n                         + \" not found\");\n             }\n-            List<Collection> collections = cs.findAuthorized(context, com, Constants.ADD);\n-            return converter.toRestPage(collections, pageable, utils.obtainProjection());\n-        } catch (SQLException e) {\n+            List<Collection> collections = cs.findAuthorizedCollectionsInSOLR(q, context, com,\n+                                              Math.toIntExact(pageable.getOffset()),\n+                                              Math.toIntExact(pageable.getOffset() + pageable.getPageSize()));\n+            int tot = cs.countAuthorizedCollectionsInSOLR(q, context, com);\n+            return converter.toRestPage(collections, pageable, tot , utils.obtainProjection());\n+        } catch (SQLException | SearchServiceException e) {\n             throw new RuntimeException(e.getMessage(), e);\n         }\n     }\n \n     @SearchRestMethod(name = \"findAuthorized\")", "originalCommit": "d9d698dcd1d11503742ef4f91e85eee71c73bc87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "eef6868a2f158ec927c49234dc22892b9b7fb9c8", "url": "https://github.com/DSpace/DSpace/commit/eef6868a2f158ec927c49234dc22892b9b7fb9c8", "message": "renamed methods", "committedDate": "2020-06-16T09:09:32Z", "type": "commit"}]}