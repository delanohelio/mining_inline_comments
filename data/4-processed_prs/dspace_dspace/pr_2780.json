{"pr_number": 2780, "pr_title": "Upgrade to the ORCID v3 API", "pr_createdAt": "2020-06-16T09:43:00Z", "pr_url": "https://github.com/DSpace/DSpace/pull/2780", "timeline": [{"oid": "ec348a63f156d213035a95ee3e662e925309e5c0", "url": "https://github.com/DSpace/DSpace/commit/ec348a63f156d213035a95ee3e662e925309e5c0", "message": "Update ORCID to V3", "committedDate": "2020-06-16T09:35:48Z", "type": "commit"}, {"oid": "2ffde8ec2cc2cc4780f51d0b6d342a0babab59aa", "url": "https://github.com/DSpace/DSpace/commit/2ffde8ec2cc2cc4780f51d0b6d342a0babab59aa", "message": "Minor cleanup", "committedDate": "2020-06-16T09:35:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDcyMzc1Mg==", "url": "https://github.com/DSpace/DSpace/pull/2780#discussion_r440723752", "bodyText": "This will be removed once the DSpace/orcid-jaxb-api#3 is merged and the new artifact is pushed to maven central", "author": "abollini", "createdAt": "2020-06-16T09:44:04Z", "path": "pom.xml", "diffHunk": "@@ -1853,6 +1853,17 @@\n             <url>https://maven.restlet.com</url>\n         </repository>\n         -->\n+        <repository>\n+            <id>4science-nexus</id>\n+            <url>https://nexus.4science.it/repository/maven-public</url>\n+            <layout>default</layout>\n+            <releases>\n+                <enabled>true</enabled>\n+            </releases>\n+            <snapshots>\n+                <enabled>true</enabled>\n+            </snapshots>\n+        </repository>", "originalCommit": "2ffde8ec2cc2cc4780f51d0b6d342a0babab59aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzE0MDIxMQ==", "url": "https://github.com/DSpace/DSpace/pull/2780#discussion_r447140211", "bodyText": "@abollini : As of today, DSpace/orcid-jaxb-api#3 has been merged, and v3.0.0 was tagged & released to Maven Central.  It should appear in Maven Central in the next hour or so.", "author": "tdonohue", "createdAt": "2020-06-29T17:37:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDcyMzc1Mg=="}], "type": "inlineReview"}, {"oid": "d77c505a668f0997d6f2c334058cd87be15761f3", "url": "https://github.com/DSpace/DSpace/commit/d77c505a668f0997d6f2c334058cd87be15761f3", "message": "added ITs for ORCID", "committedDate": "2020-06-16T14:27:27Z", "type": "commit"}, {"oid": "e2f79861e3e4e1a64464fa54db5fab7918843636", "url": "https://github.com/DSpace/DSpace/commit/e2f79861e3e4e1a64464fa54db5fab7918843636", "message": "Fix wrong name", "committedDate": "2020-06-16T15:14:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY0NjU1Ng==", "url": "https://github.com/DSpace/DSpace/pull/2780#discussion_r443646556", "bodyText": "The spacing here is messed up. It looks like you are using tabs instead of spaces. Could you correct the alignment here?", "author": "tdonohue", "createdAt": "2020-06-22T15:32:45Z", "path": "dspace-api/pom.xml", "diffHunk": "@@ -628,13 +628,13 @@\n             <artifactId>aws-java-sdk-s3</artifactId>\n             <version>1.10.50</version>\n         </dependency>\n-\n-        <!-- For ORCID v2 integration -->\n+        \n         <dependency>\n-            <groupId>org.dspace</groupId>\n-            <artifactId>orcid-jaxb-api</artifactId>\n-            <version>2.1.0</version>\n-        </dependency>\n+\t\t\t<groupId>org.dspace</groupId>\n+\t\t\t<artifactId>orcid-jaxb-api</artifactId>\n+\t\t\t<version>3.0.0-SNAPSHOT</version>\n+\t\t</dependency>", "originalCommit": "e2f79861e3e4e1a64464fa54db5fab7918843636", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY0ODQ4MQ==", "url": "https://github.com/DSpace/DSpace/pull/2780#discussion_r443648481", "bodyText": "Should we provide a link or more information on where to obtain these ORCID credentials for your repository?  I'm assuming that this Id/secret can be obtained via either the \"Member API\" or \"Public API\" signup available here: https://orcid.org/content/register-client-application-0  Is that correct?", "author": "tdonohue", "createdAt": "2020-06-22T15:35:36Z", "path": "dspace/config/dspace.cfg", "diffHunk": "@@ -1459,10 +1459,18 @@ sherpa.romeo.apikey =\n #    org.dspace.content.authority.SolrAuthority = SolrAuthorAuthority\n \n # URL of ORCID API\n-# Defaults to using the Public API (pub.orcid.org)\n-orcid.api.url = https://pub.orcid.org/v2.1\n+# Defaults to using the Public API V3 (pub.orcid.org)\n+orcid.api.url = https://pub.orcid.org/v3.0\n orcid.url = https://orcid.org/\n \n+# ORCID Credentials", "originalCommit": "e2f79861e3e4e1a64464fa54db5fab7918843636", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY1MjA3MQ==", "url": "https://github.com/DSpace/DSpace/pull/2780#discussion_r443652071", "bodyText": "I'd like to see a second Integration Test that runs against a sample (static) response from ORCID (which we can enable to run always in Travis CI).  Otherwise, we only have this disabled end-to-end test, which wouldn't allow us to continually validate that our code works with the ORCID API.", "author": "tdonohue", "createdAt": "2020-06-22T15:40:52Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/OrcidExternalSourcesIT.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest;\n+\n+import static com.jayway.jsonpath.matchers.JsonPathMatchers.hasJsonPath;\n+import static org.hamcrest.Matchers.is;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.dspace.app.rest.test.AbstractControllerIntegrationTest;\n+import org.dspace.services.ConfigurationService;\n+import org.hamcrest.Matchers;\n+import org.junit.Assume;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+\n+/**\n+ * This test suite includes end to end test to verify the integration with ORCID as an External Source.\n+ * The test run only if the orcid.clientid property is configured.\n+ * \n+ * @author Mykhaylo Boychuk (4Science.it)\n+ *\n+ */\n+public class OrcidExternalSourcesIT extends AbstractControllerIntegrationTest {", "originalCommit": "e2f79861e3e4e1a64464fa54db5fab7918843636", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg1NjQ1Ng==", "url": "https://github.com/DSpace/DSpace/pull/2780#discussion_r518856456", "bodyText": "It looks like previous feedback was resolved by adding some static XML test output and adding a few *MockitoTest() methods to this same class.\n@abollini : Could you update the JavaDocs at the top of this class to note that it does static testing by default (using the *MockitoTest() methods below), but will do full end-to-end testing (of the real API) when you set orcid.clientid", "author": "tdonohue", "createdAt": "2020-11-06T16:18:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY1MjA3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY1NTA4Nw==", "url": "https://github.com/DSpace/DSpace/pull/2780#discussion_r443655087", "bodyText": "You shouldn't need to do any of this at all.  The DSpace configuration system will also read values set as environment variables automatically.  See https://github.com/DSpace/DSpace/blob/master/dspace/config/config-definition.xml#L29-L37\nSo, instead of all this logic, you can simply set environment variables named orcid.clientid and orcid.clientsecret, and those should override any defaults in local.cfg.", "author": "tdonohue", "createdAt": "2020-06-22T15:45:23Z", "path": ".travis.yml", "diffHunk": "@@ -21,6 +21,8 @@ jdk:\n \n before_install:\n   # Remove outdated settings.xml from Travis builds. Workaround for https://github.com/travis-ci/travis-ci/issues/4629\n+  - sed -i 's/^orcid\\.clientid.*/orcid.clientid='$ORCID_CLIENTID'/g' dspace-api/src/test/data/dspaceFolder/config/local.cfg\n+  - sed -i 's/^orcid\\.clientsecret.*/orcid.clientsecret='$ORCID_CLIENTSECRET'/g' dspace-api/src/test/data/dspaceFolder/config/local.cfg", "originalCommit": "e2f79861e3e4e1a64464fa54db5fab7918843636", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY1NTYxNw==", "url": "https://github.com/DSpace/DSpace/pull/2780#discussion_r443655617", "bodyText": "These should not be needed.  Again, these can be set directly as environment variables, so you don't need to insert them here so that they can be replaced later.", "author": "tdonohue", "createdAt": "2020-06-22T15:46:11Z", "path": "dspace-api/src/test/data/dspaceFolder/config/local.cfg", "diffHunk": "@@ -120,3 +120,6 @@ rest.properties.exposed = configuration.not.existing\n configuration.not.exposed = secret_value\n configuration.exposed.single.value = public_value\n configuration.exposed.array.value = public_value_1, public_value_2\n+\n+orcid.clientid = \n+orcid.clientsecret = ", "originalCommit": "e2f79861e3e4e1a64464fa54db5fab7918843636", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fe41f58c512a09ee28912128029a6f0887834c4b", "url": "https://github.com/DSpace/DSpace/commit/fe41f58c512a09ee28912128029a6f0887834c4b", "message": "Merge branch 'main' into D4CRIS-952-orcidV3-merge", "committedDate": "2020-09-23T14:57:14Z", "type": "commit"}, {"oid": "50efbd29bb0c33f3d937aa8be1e4c74e122f5811", "url": "https://github.com/DSpace/DSpace/commit/50efbd29bb0c33f3d937aa8be1e4c74e122f5811", "message": "added dependensy to use official artifact of orcid", "committedDate": "2020-09-23T15:52:59Z", "type": "commit"}, {"oid": "2ae8f0e9fafc1a9a56a69cc03de2d9c0c5c16b16", "url": "https://github.com/DSpace/DSpace/commit/2ae8f0e9fafc1a9a56a69cc03de2d9c0c5c16b16", "message": "added mockito test to prove functionality of OrcidExternalSources", "committedDate": "2020-09-24T16:55:37Z", "type": "commit"}, {"oid": "007c8f035d179dc5eecb0040d9bbc867dc10b676", "url": "https://github.com/DSpace/DSpace/commit/007c8f035d179dc5eecb0040d9bbc867dc10b676", "message": "added missing bean", "committedDate": "2020-09-25T08:45:31Z", "type": "commit"}, {"oid": "ba4d1c20f1dc4ccd2aa1bcce8cf640eea0cfce0c", "url": "https://github.com/DSpace/DSpace/commit/ba4d1c20f1dc4ccd2aa1bcce8cf640eea0cfce0c", "message": "fix test", "committedDate": "2020-09-25T08:47:25Z", "type": "commit"}, {"oid": "3a47781193881956e263de8b9032605955b30deb", "url": "https://github.com/DSpace/DSpace/commit/3a47781193881956e263de8b9032605955b30deb", "message": "added pooling http cliente connection manager to send to ORCID", "committedDate": "2020-09-28T08:30:32Z", "type": "commit"}, {"oid": "850d93546ab625fbba5b54ce269dae3d4dd927c7", "url": "https://github.com/DSpace/DSpace/commit/850d93546ab625fbba5b54ce269dae3d4dd927c7", "message": "update test and OrcidRestConnector", "committedDate": "2020-09-28T16:33:58Z", "type": "commit"}, {"oid": "e6000f6e5e913540235a0756e424d1c84319e78e", "url": "https://github.com/DSpace/DSpace/commit/e6000f6e5e913540235a0756e424d1c84319e78e", "message": "Merge branch 'main' of https://github.com/DSpace/DSpace into D4CRIS-952-orcidV3", "committedDate": "2020-11-05T14:49:41Z", "type": "commit"}, {"oid": "a8aab9d88b23449c690e3f89e14f5362e5c7b5e4", "url": "https://github.com/DSpace/DSpace/commit/a8aab9d88b23449c690e3f89e14f5362e5c7b5e4", "message": "Improve ORCID testing via mock response", "committedDate": "2020-11-05T21:10:29Z", "type": "commit"}, {"oid": "9d938a62829b8fff89348d6d3d117d316a9b0fc7", "url": "https://github.com/DSpace/DSpace/commit/9d938a62829b8fff89348d6d3d117d316a9b0fc7", "message": "Switch to the official orcid model maven artifact", "committedDate": "2020-11-05T21:13:02Z", "type": "commit"}, {"oid": "9d52f012706a7ae4bc22eb6e64bc668f64a64bc0", "url": "https://github.com/DSpace/DSpace/commit/9d52f012706a7ae4bc22eb6e64bc668f64a64bc0", "message": "Solve dependencies convergence issues", "committedDate": "2020-11-05T21:49:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg1MDcwNQ==", "url": "https://github.com/DSpace/DSpace/pull/2780#discussion_r518850705", "bodyText": "This looks to be an accidental change?  It was removed a while back from our Travis settings as it's no longer needed.", "author": "tdonohue", "createdAt": "2020-11-06T16:08:34Z", "path": ".travis.yml", "diffHunk": "@@ -27,6 +27,9 @@ env:\n     # (Useful for builds which don't need to repeat code checks)\n     - SKIP_CODE_CHECKS=\"-Denforcer.skip=true -Dcheckstyle.skip=true -Dlicense.skip=true -Dxml.skip=true\"\n \n+before_install:\n+  # Remove outdated settings.xml from Travis builds. Workaround for https://github.com/travis-ci/travis-ci/issues/4629\n+  - rm ~/.m2/settings.xml", "originalCommit": "9d52f012706a7ae4bc22eb6e64bc668f64a64bc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg1Mzg0NA==", "url": "https://github.com/DSpace/DSpace/pull/2780#discussion_r518853844", "bodyText": "This should be removed now.  You should not need this now that you've switched to using org.orcid:orcid-model as the dependency.", "author": "tdonohue", "createdAt": "2020-11-06T16:13:42Z", "path": "pom.xml", "diffHunk": "@@ -1895,6 +1895,17 @@\n             <url>https://maven.restlet.com</url>\n         </repository>\n         -->\n+        <repository>\n+            <id>4science-nexus</id>\n+            <url>https://nexus.4science.it/repository/maven-public</url>", "originalCommit": "9d52f012706a7ae4bc22eb6e64bc668f64a64bc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e2e13ebd069d24b09975bdf9d6f1966858524c00", "url": "https://github.com/DSpace/DSpace/commit/e2e13ebd069d24b09975bdf9d6f1966858524c00", "message": "Remove unnecessary changes and add more javadoc", "committedDate": "2020-11-11T11:27:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ3NjIwMg==", "url": "https://github.com/DSpace/DSpace/pull/2780#discussion_r526476202", "bodyText": "It looks like this change from orcidV2 to orcid for the sourceIdentifier will require minor updates to Angular UI's en.json5 language pack... In the UI, I'm seeing missing labels in the External Services features when it comes to ORCID.\nSo, for example, this line needs to be updated to be:\n\"submission.import-external.source.orcid\": \"ORCID\",\n\nThe same seems to be true for all other i18n keys which include orcidV2 in them.  The key names all need to be updated to just use orcid.\nThis is a minor change overall, but we should clean this up in a small PR to the Angular UI.", "author": "tdonohue", "createdAt": "2020-11-18T22:50:39Z", "path": "dspace/config/spring/api/external-services.xml", "diffHunk": "@@ -20,10 +20,17 @@\n         <property name=\"apiKey\" value=\"${sherpa.romeo.apikey}\"/>\n \n     </bean>\n-    <bean class=\"org.dspace.external.provider.impl.OrcidV2AuthorDataProvider\" init-method=\"init\">\n-        <constructor-arg value=\"${orcid.api.url}\"/>\n-        <property name=\"sourceIdentifier\" value=\"orcidV2\"/>\n+    <bean class=\"org.dspace.external.provider.impl.OrcidV3AuthorDataProvider\" init-method=\"init\">\n+        <property name=\"sourceIdentifier\" value=\"orcid\"/>", "originalCommit": "e2e13ebd069d24b09975bdf9d6f1966858524c00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzcwNjM5MA==", "url": "https://github.com/DSpace/DSpace/pull/2780#discussion_r527706390", "bodyText": "Hi @tdonohue I am taking charge of this small PR on the Angular UI. Let you know soon.", "author": "corrad82-4s", "createdAt": "2020-11-20T13:56:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ3NjIwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU0NjQwNg==", "url": "https://github.com/DSpace/DSpace/pull/2780#discussion_r528546406", "bodyText": "Hi @tdonohue , angular PR opened\nDSpace/dspace-angular#954", "author": "corrad82-4s", "createdAt": "2020-11-23T08:53:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ3NjIwMg=="}], "type": "inlineReview"}]}