{"pr_number": 2723, "pr_title": "Group/EPerson management: Delete, retrieve parent object & patch support", "pr_createdAt": "2020-03-25T12:11:34Z", "pr_url": "https://github.com/DSpace/DSpace/pull/2723", "timeline": [{"oid": "de79405b743f7029a3ea06e22cabdb05475daa27", "url": "https://github.com/DSpace/DSpace/commit/de79405b743f7029a3ea06e22cabdb05475daa27", "message": "DELETE /api/eperson/groups/<:uuid>", "committedDate": "2020-03-13T14:38:49Z", "type": "commit"}, {"oid": "65a1a2d15e7c72f9aaa22bbd1b09199ba339a50f", "url": "https://github.com/DSpace/DSpace/commit/65a1a2d15e7c72f9aaa22bbd1b09199ba339a50f", "message": "GET /api/eperson/groups/<:uuid>/object", "committedDate": "2020-03-16T09:55:27Z", "type": "commit"}, {"oid": "c2ea8a0eeb7b298db0273ceaafaaf7ced87ed807", "url": "https://github.com/DSpace/DSpace/commit/c2ea8a0eeb7b298db0273ceaafaaf7ced87ed807", "message": "Test for Unprocessable status and adjust code style", "committedDate": "2020-03-20T09:04:13Z", "type": "commit"}, {"oid": "227317bbe0f2431b651d11ac41cbb27c55e21b8b", "url": "https://github.com/DSpace/DSpace/commit/227317bbe0f2431b651d11ac41cbb27c55e21b8b", "message": "Test for Unprocessable status for permanent group names", "committedDate": "2020-03-20T10:37:36Z", "type": "commit"}, {"oid": "e47ad74e35549715c2fc6965affd160857001f0c", "url": "https://github.com/DSpace/DSpace/commit/e47ad74e35549715c2fc6965affd160857001f0c", "message": "Implement the GroupNameReplaceOperation", "committedDate": "2020-03-23T09:23:54Z", "type": "commit"}, {"oid": "7e5a2f3698afccbab4c174146ec27a3f0d69bf6c", "url": "https://github.com/DSpace/DSpace/commit/7e5a2f3698afccbab4c174146ec27a3f0d69bf6c", "message": "Make delete unprocessable for specific groups", "committedDate": "2020-03-23T10:29:35Z", "type": "commit"}, {"oid": "516c7b39a91069120d13d7a457b2d9009b74239d", "url": "https://github.com/DSpace/DSpace/commit/516c7b39a91069120d13d7a457b2d9009b74239d", "message": "Make patch completely unprocessable for specific groups", "committedDate": "2020-03-24T12:51:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ0NzI0OQ==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r400447249", "bodyText": "Since this seems like a simple GET, shouldn't it be implemented as a LinkRestRepository?  In other words, I wonder if this should be implemented as GroupObjectLinkRepository, similar to how we have a GroupGroupLinkRepository for subgroups, and a GroupEPersonLinkRepository for EPeople members.", "author": "tdonohue", "createdAt": "2020-03-30T19:40:47Z", "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/GroupRestController.java", "diffHunk": "@@ -308,4 +315,15 @@ private void checkAuthorization(Context context, Group group) throws SQLExceptio\n \n         throw new AuthorizeException(\"not authorized to manage this group\");\n     }\n+\n+    /**\n+     * This returns the DSpace Object (Community, Collection) belonging to this Group.\n+     * This is only applicable for roles in that DSpace Object\n+     * e.g. the Community Administrator or Collection Submitter Group\n+     * @param uuid The uuid of the group\n+     */\n+    @RequestMapping(method = RequestMethod.GET, value = REGEX_REQUESTMAPPING_IDENTIFIER_AS_UUID + \"/object\")", "originalCommit": "516c7b39a91069120d13d7a457b2d9009b74239d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ1NDQ4Ng==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r400454486", "bodyText": "I'd rather see more specific error messages here, as there's a few different scenarios here we should be aware of:\n\nA permanent group's name can never be patched.  But, its description can be updated.\nSame with a Community/Collection group's name (not editable) & description (editable), unless it's detached. In which case it can be patched.\n\nSo, at a minimum, it seems like we need different errors & checks here.  Permanent groups can never have name updates, but can have description updates.  Community/Collection groups can be updated if the Community/Collection is deleted, but are otherwise considered \"permanent\".", "author": "tdonohue", "createdAt": "2020-03-30T19:53:54Z", "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/repository/GroupRestRepository.java", "diffHunk": "@@ -117,6 +136,10 @@ public GroupRest findOne(Context context, UUID id) {\n     @PreAuthorize(\"hasPermission(#id, 'GROUP', 'WRITE')\")\n     protected void patch(Context context, HttpServletRequest request, String apiCategory, String model, UUID id,\n                          Patch patch) throws AuthorizeException, SQLException {\n+        final Group group = dsoService.find(context, id);\n+        if (group != null && isPatchUnprocessable(context, group)) {\n+            throw new UnprocessableEntityException(\"This group cannot be patched.\");", "originalCommit": "516c7b39a91069120d13d7a457b2d9009b74239d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ1NTEyNQ==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r400455125", "bodyText": "I'm not sure this is true. We need to be able to delete a Community or Collection's \"SUBMIT\" or \"ADMIN\" group in order to remove those roles. So they can be deleted, even if the parent object exists.\nHowever, a permanent group can never be deleted.", "author": "tdonohue", "createdAt": "2020-03-30T19:55:08Z", "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/repository/GroupRestRepository.java", "diffHunk": "@@ -149,4 +172,77 @@ protected void patch(Context context, HttpServletRequest request, String apiCate\n     public Class<GroupRest> getDomainClass() {\n         return GroupRest.class;\n     }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('ADMIN')\")\n+    protected void delete(Context context, UUID uuid) throws AuthorizeException {\n+        Group group = null;\n+        try {\n+            group = gs.find(context, uuid);\n+            if (group == null) {\n+                throw new ResourceNotFoundException(\n+                        GroupRest.CATEGORY + \".\" + GroupRest.NAME\n+                                + \" with id: \" + uuid + \" not found\"\n+                );\n+            }\n+            if (isDeleteUnprocessable(context, group)) {\n+                throw new UnprocessableEntityException(\"This group cannot be deleted\");\n+            }\n+            gs.delete(context, group);\n+        } catch (SQLException | IOException e) {\n+            throw new RuntimeException(e.getMessage(), e);\n+        }\n+    }\n+\n+    private boolean isDeleteUnprocessable(Context context, Group group) {\n+        try {\n+            return group.isPermanent() || gs.getParentObject(context, group) != null;", "originalCommit": "516c7b39a91069120d13d7a457b2d9009b74239d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTQyMjI1Nw==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r401422257", "bodyText": "There are separate endpoints for that purpose: DSpace/RestContract#105\nIt would be best that groups are deleted using those endpoints, if we delete from the general group endpoint you could be deleting a group that is attached a community/collection & this would inadvertently delete the link.", "author": "KevinVdV", "createdAt": "2020-04-01T07:54:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ1NTEyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTczODA4NA==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r401738084", "bodyText": "@KevinVdV : good point. My mistake, as I didn't recall this was being managed as a separate endpoint. In that case, I agree with you that we should only allow deletion of Community/Collection Groups via the communities and collections endpoints.  Thanks for clarifying this!", "author": "tdonohue", "createdAt": "2020-04-01T16:14:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ1NTEyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ1NTM1Mw==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r400455353", "bodyText": "Again, I'd prefer more descriptive errors here as to why the group cannot be deleted.", "author": "tdonohue", "createdAt": "2020-03-30T19:55:33Z", "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/repository/GroupRestRepository.java", "diffHunk": "@@ -149,4 +172,77 @@ protected void patch(Context context, HttpServletRequest request, String apiCate\n     public Class<GroupRest> getDomainClass() {\n         return GroupRest.class;\n     }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('ADMIN')\")\n+    protected void delete(Context context, UUID uuid) throws AuthorizeException {\n+        Group group = null;\n+        try {\n+            group = gs.find(context, uuid);\n+            if (group == null) {\n+                throw new ResourceNotFoundException(\n+                        GroupRest.CATEGORY + \".\" + GroupRest.NAME\n+                                + \" with id: \" + uuid + \" not found\"\n+                );\n+            }\n+            if (isDeleteUnprocessable(context, group)) {\n+                throw new UnprocessableEntityException(\"This group cannot be deleted\");", "originalCommit": "516c7b39a91069120d13d7a457b2d9009b74239d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d33732ce28a02f6c8727fff8084afdb73c63cb15", "url": "https://github.com/DSpace/DSpace/commit/d33732ce28a02f6c8727fff8084afdb73c63cb15", "message": "Merge remote-tracking branch 'upstream/master' into Manage-groups-2", "committedDate": "2020-04-01T10:58:11Z", "type": "commit"}, {"oid": "c9b9c7adf3e1502d0092defd727fa86e031eadcd", "url": "https://github.com/DSpace/DSpace/commit/c9b9c7adf3e1502d0092defd727fa86e031eadcd", "message": "Let metadata patches for permanent groups work & adjust tests", "committedDate": "2020-04-01T13:31:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTczOTI4NQ==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r401739285", "bodyText": "You should be able to remove all the changes to GroupRestController now that you've refactored this into GroupParentObjectLinkRepository", "author": "tdonohue", "createdAt": "2020-04-01T16:16:12Z", "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/GroupRestController.java", "diffHunk": "@@ -76,6 +80,9 @@\n     @Autowired\n     GroupUtil groupUtil;\n \n+    @Autowired\n+    GroupRestRepository repository;", "originalCommit": "c9b9c7adf3e1502d0092defd727fa86e031eadcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0MTE4Ng==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r401741186", "bodyText": "I think this should say \"Group name replacement patches\" (or similar) :)", "author": "tdonohue", "createdAt": "2020-04-01T16:18:56Z", "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/repository/patch/operation/GroupNameReplaceOperation.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest.repository.patch.operation;\n+\n+import java.sql.SQLException;\n+\n+import org.dspace.app.rest.exception.DSpaceBadRequestException;\n+import org.dspace.app.rest.exception.UnprocessableEntityException;\n+import org.dspace.app.rest.model.patch.Operation;\n+import org.dspace.content.DSpaceObject;\n+import org.dspace.core.Context;\n+import org.dspace.eperson.Group;\n+import org.dspace.eperson.factory.EPersonServiceFactory;\n+import org.dspace.eperson.service.GroupService;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+\n+/**\n+ * Implementation for Group password patches.", "originalCommit": "c9b9c7adf3e1502d0092defd727fa86e031eadcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0MzY0MQ==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r401743641", "bodyText": "You should not need to manually hardcode the JSON request.  We have a getPatchContent() method that will generate this for you.  Here's another replace example from another IT: https://github.com/DSpace/DSpace/blob/master/dspace-server-webapp/src/test/java/org/dspace/app/rest/ItemRestRepositoryIT.java#L411-L414", "author": "tdonohue", "createdAt": "2020-04-01T16:22:33Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -450,6 +459,109 @@ private void runPatchMetadataTests(EPerson asUser, int expectedStatus) throws Ex\n         new MetadataPatchSuite().runWith(getClient(token), \"/api/eperson/groups/\" + group.getID(), expectedStatus);\n     }\n \n+    @Test\n+    public void patchGroupName() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+        Group group = GroupBuilder.createGroup(context).withName(\"Group\").build();\n+        context.restoreAuthSystemState();\n+        String token = getAuthToken(admin.getEmail(), password);\n+\n+        String requestBody\n+                = \"      [\\n\"\n+                + \"        {\\n\"\n+                + \"          \\\"op\\\": \\\"replace\\\",\\n\"\n+                + \"          \\\"path\\\": \\\"/name\\\",\\n\"\n+                + \"          \\\"value\\\": \\\"new name\\\"\\n\"\n+                + \"        }\\n\"\n+                + \"      ]\";", "originalCommit": "c9b9c7adf3e1502d0092defd727fa86e031eadcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0MzkxMQ==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r401743911", "bodyText": "Again, no need to create JSON by hand here (see above comment)", "author": "tdonohue", "createdAt": "2020-04-01T16:22:57Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -450,6 +459,109 @@ private void runPatchMetadataTests(EPerson asUser, int expectedStatus) throws Ex\n         new MetadataPatchSuite().runWith(getClient(token), \"/api/eperson/groups/\" + group.getID(), expectedStatus);\n     }\n \n+    @Test\n+    public void patchGroupName() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+        Group group = GroupBuilder.createGroup(context).withName(\"Group\").build();\n+        context.restoreAuthSystemState();\n+        String token = getAuthToken(admin.getEmail(), password);\n+\n+        String requestBody\n+                = \"      [\\n\"\n+                + \"        {\\n\"\n+                + \"          \\\"op\\\": \\\"replace\\\",\\n\"\n+                + \"          \\\"path\\\": \\\"/name\\\",\\n\"\n+                + \"          \\\"value\\\": \\\"new name\\\"\\n\"\n+                + \"        }\\n\"\n+                + \"      ]\";\n+        getClient(token)\n+                .perform(patch(\"/api/eperson/groups/\" + group.getID()).content(requestBody)\n+                                 .contentType(MediaType.APPLICATION_JSON_PATCH_JSON))\n+                .andExpect(status().isOk());\n+        getClient(token)\n+                .perform(get(\"/api/eperson/groups/\" + group.getID()))\n+                .andExpect(status().isOk())\n+                .andExpect(jsonPath(\"$\", Matchers.is(\n+                        GroupMatcher.matchGroupEntry(group.getID(), \"new name\"))\n+                ));\n+    }\n+\n+    @Test\n+    public void patchGroupWithParentUnprocessable() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        EPerson reviewer1 = EPersonBuilder.createEPerson(context)\n+                .withEmail(\"reviewer1@example.com\")\n+                .withPassword(password)\n+                .build();\n+\n+        parentCommunity = CommunityBuilder.createCommunity(context)\n+                .withName(\"Parent Community\")\n+                .build();\n+        Community child1 = CommunityBuilder.createSubCommunity(context, parentCommunity)\n+                .withName(\"Sub Community\")\n+                .build();\n+        Collection col1 = CollectionBuilder.createCollection(context, child1)\n+                .withName(\"Collection 1\")\n+                .withWorkflowGroup(1, admin, reviewer1)\n+                .build();\n+\n+        final Group workflowGroup = col1.getWorkflowStep1(context);\n+        final String name = workflowGroup.getName();\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+\n+        String requestBody\n+                = \"      [\\n\"\n+                + \"        {\\n\"\n+                + \"          \\\"op\\\": \\\"replace\\\",\\n\"\n+                + \"          \\\"path\\\": \\\"/name\\\",\\n\"\n+                + \"          \\\"value\\\": \\\"new name\\\"\\n\"\n+                + \"        }\\n\"\n+                + \"      ]\";", "originalCommit": "c9b9c7adf3e1502d0092defd727fa86e031eadcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0NDA1Ng==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r401744056", "bodyText": "Same here, shouldn't need to be created by hand.", "author": "tdonohue", "createdAt": "2020-04-01T16:23:11Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -450,6 +459,109 @@ private void runPatchMetadataTests(EPerson asUser, int expectedStatus) throws Ex\n         new MetadataPatchSuite().runWith(getClient(token), \"/api/eperson/groups/\" + group.getID(), expectedStatus);\n     }\n \n+    @Test\n+    public void patchGroupName() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+        Group group = GroupBuilder.createGroup(context).withName(\"Group\").build();\n+        context.restoreAuthSystemState();\n+        String token = getAuthToken(admin.getEmail(), password);\n+\n+        String requestBody\n+                = \"      [\\n\"\n+                + \"        {\\n\"\n+                + \"          \\\"op\\\": \\\"replace\\\",\\n\"\n+                + \"          \\\"path\\\": \\\"/name\\\",\\n\"\n+                + \"          \\\"value\\\": \\\"new name\\\"\\n\"\n+                + \"        }\\n\"\n+                + \"      ]\";\n+        getClient(token)\n+                .perform(patch(\"/api/eperson/groups/\" + group.getID()).content(requestBody)\n+                                 .contentType(MediaType.APPLICATION_JSON_PATCH_JSON))\n+                .andExpect(status().isOk());\n+        getClient(token)\n+                .perform(get(\"/api/eperson/groups/\" + group.getID()))\n+                .andExpect(status().isOk())\n+                .andExpect(jsonPath(\"$\", Matchers.is(\n+                        GroupMatcher.matchGroupEntry(group.getID(), \"new name\"))\n+                ));\n+    }\n+\n+    @Test\n+    public void patchGroupWithParentUnprocessable() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        EPerson reviewer1 = EPersonBuilder.createEPerson(context)\n+                .withEmail(\"reviewer1@example.com\")\n+                .withPassword(password)\n+                .build();\n+\n+        parentCommunity = CommunityBuilder.createCommunity(context)\n+                .withName(\"Parent Community\")\n+                .build();\n+        Community child1 = CommunityBuilder.createSubCommunity(context, parentCommunity)\n+                .withName(\"Sub Community\")\n+                .build();\n+        Collection col1 = CollectionBuilder.createCollection(context, child1)\n+                .withName(\"Collection 1\")\n+                .withWorkflowGroup(1, admin, reviewer1)\n+                .build();\n+\n+        final Group workflowGroup = col1.getWorkflowStep1(context);\n+        final String name = workflowGroup.getName();\n+\n+        String token = getAuthToken(admin.getEmail(), password);\n+\n+        String requestBody\n+                = \"      [\\n\"\n+                + \"        {\\n\"\n+                + \"          \\\"op\\\": \\\"replace\\\",\\n\"\n+                + \"          \\\"path\\\": \\\"/name\\\",\\n\"\n+                + \"          \\\"value\\\": \\\"new name\\\"\\n\"\n+                + \"        }\\n\"\n+                + \"      ]\";\n+        getClient(token)\n+                .perform(patch(\"/api/eperson/groups/\" + workflowGroup.getID()).content(requestBody)\n+                                 .contentType(MediaType.APPLICATION_JSON_PATCH_JSON))\n+                .andExpect(status().isUnprocessableEntity());\n+\n+        getClient(token)\n+                .perform(get(\"/api/eperson/groups/\" + workflowGroup.getID()))\n+                .andExpect(status().isOk())\n+                .andExpect(jsonPath(\"$\", Matchers.is(\n+                        GroupMatcher.matchGroupEntry(workflowGroup.getID(), name))\n+                ));\n+    }\n+\n+    @Test\n+    public void patchPermanentGroupUnprocessable() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+        final Group group = groupService.findByName(context, Group.ANONYMOUS);\n+        final String name = group.getName();\n+        context.restoreAuthSystemState();\n+        String token = getAuthToken(admin.getEmail(), password);\n+\n+        String requestBody\n+                = \"      [\\n\"\n+                + \"        {\\n\"\n+                + \"          \\\"op\\\": \\\"replace\\\",\\n\"\n+                + \"          \\\"path\\\": \\\"/name\\\",\\n\"\n+                + \"          \\\"value\\\": \\\"new name\\\"\\n\"\n+                + \"        }\\n\"\n+                + \"      ]\";", "originalCommit": "c9b9c7adf3e1502d0092defd727fa86e031eadcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0NDUwOA==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r401744508", "bodyText": "This method is missing a context.restoreAuthSystemState();", "author": "tdonohue", "createdAt": "2020-04-01T16:23:50Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -450,6 +459,109 @@ private void runPatchMetadataTests(EPerson asUser, int expectedStatus) throws Ex\n         new MetadataPatchSuite().runWith(getClient(token), \"/api/eperson/groups/\" + group.getID(), expectedStatus);\n     }\n \n+    @Test\n+    public void patchGroupName() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+        Group group = GroupBuilder.createGroup(context).withName(\"Group\").build();\n+        context.restoreAuthSystemState();\n+        String token = getAuthToken(admin.getEmail(), password);\n+\n+        String requestBody\n+                = \"      [\\n\"\n+                + \"        {\\n\"\n+                + \"          \\\"op\\\": \\\"replace\\\",\\n\"\n+                + \"          \\\"path\\\": \\\"/name\\\",\\n\"\n+                + \"          \\\"value\\\": \\\"new name\\\"\\n\"\n+                + \"        }\\n\"\n+                + \"      ]\";\n+        getClient(token)\n+                .perform(patch(\"/api/eperson/groups/\" + group.getID()).content(requestBody)\n+                                 .contentType(MediaType.APPLICATION_JSON_PATCH_JSON))\n+                .andExpect(status().isOk());\n+        getClient(token)\n+                .perform(get(\"/api/eperson/groups/\" + group.getID()))\n+                .andExpect(status().isOk())\n+                .andExpect(jsonPath(\"$\", Matchers.is(\n+                        GroupMatcher.matchGroupEntry(group.getID(), \"new name\"))\n+                ));\n+    }\n+\n+    @Test\n+    public void patchGroupWithParentUnprocessable() throws Exception {\n+        context.turnOffAuthorisationSystem();", "originalCommit": "c9b9c7adf3e1502d0092defd727fa86e031eadcd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEwMjc1MQ==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r405102751", "bodyText": "This method is still missing a context.restoreAuthSystemState(); after it finishes creating the necessary test content.", "author": "tdonohue", "createdAt": "2020-04-07T20:47:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0NDUwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0NTIyNw==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r401745227", "bodyText": "This method is missing a context.restoreAuthSystemState();   Also, could we add a comment as to why the context.commit() and reloadEntity are required in this test?  Most tests don't actually need those.  Are they needed here because you are doing a delete? Or could they be removed?\n(You might want to reverify the commit & reloadEntity are required after switching to using the GroupBuilder. I don't think they should be required, but I could be wrong here.)", "author": "tdonohue", "createdAt": "2020-04-01T16:24:55Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -1538,4 +1650,342 @@ public void removeMemberUnprocessableTest() throws Exception {\n             }\n         }\n     }\n+\n+    @Test\n+    public void deleteGroupTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);", "originalCommit": "c9b9c7adf3e1502d0092defd727fa86e031eadcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0NTYyMQ==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r401745621", "bodyText": "Same as above. should use GroupBuilder, missing a context.restoreAuthSystemState(); and same question about commit() and reloadEntity() as above.", "author": "tdonohue", "createdAt": "2020-04-01T16:25:29Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -1538,4 +1650,342 @@ public void removeMemberUnprocessableTest() throws Exception {\n             }\n         }\n     }\n+\n+    @Test\n+    public void deleteGroupTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isNoContent());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isNotFound());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupUnauthorizedTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);", "originalCommit": "c9b9c7adf3e1502d0092defd727fa86e031eadcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0NTkxMw==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r401745913", "bodyText": "Same as above. should use GroupBuilder, missing a context.restoreAuthSystemState(); and same question about commit() and reloadEntity() as above.", "author": "tdonohue", "createdAt": "2020-04-01T16:25:54Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -1538,4 +1650,342 @@ public void removeMemberUnprocessableTest() throws Exception {\n             }\n         }\n     }\n+\n+    @Test\n+    public void deleteGroupTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isNoContent());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isNotFound());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupUnauthorizedTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient().perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isUnauthorized());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupUnprocessableTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        EPerson reviewer1 = EPersonBuilder.createEPerson(context)\n+                .withEmail(\"reviewer1@example.com\")\n+                .withPassword(password)\n+                .build();\n+\n+        parentCommunity = CommunityBuilder.createCommunity(context)\n+                .withName(\"Parent Community\")\n+                .build();\n+        Community child1 = CommunityBuilder.createSubCommunity(context, parentCommunity)\n+                .withName(\"Sub Community\")\n+                .build();\n+        Collection col1 = CollectionBuilder.createCollection(context, child1)\n+                .withName(\"Collection 1\")\n+                .withWorkflowGroup(1, admin, reviewer1)\n+                .build();\n+\n+        final Group workflowGroup = col1.getWorkflowStep1(context);\n+        context.commit();\n+        context.reloadEntity(workflowGroup);", "originalCommit": "c9b9c7adf3e1502d0092defd727fa86e031eadcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0NjIwNw==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r401746207", "bodyText": "Same as above. should use GroupBuilder, missing a context.restoreAuthSystemState(); and same question about commit() and reloadEntity() as above.", "author": "tdonohue", "createdAt": "2020-04-01T16:26:20Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -1538,4 +1650,342 @@ public void removeMemberUnprocessableTest() throws Exception {\n             }\n         }\n     }\n+\n+    @Test\n+    public void deleteGroupTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isNoContent());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isNotFound());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupUnauthorizedTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient().perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isUnauthorized());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupUnprocessableTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        EPerson reviewer1 = EPersonBuilder.createEPerson(context)\n+                .withEmail(\"reviewer1@example.com\")\n+                .withPassword(password)\n+                .build();\n+\n+        parentCommunity = CommunityBuilder.createCommunity(context)\n+                .withName(\"Parent Community\")\n+                .build();\n+        Community child1 = CommunityBuilder.createSubCommunity(context, parentCommunity)\n+                .withName(\"Sub Community\")\n+                .build();\n+        Collection col1 = CollectionBuilder.createCollection(context, child1)\n+                .withName(\"Collection 1\")\n+                .withWorkflowGroup(1, admin, reviewer1)\n+                .build();\n+\n+        final Group workflowGroup = col1.getWorkflowStep1(context);\n+        context.commit();\n+        context.reloadEntity(workflowGroup);\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + workflowGroup.getID())\n+        ).andExpect(status().isUnprocessableEntity());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+    }\n+\n+    @Test\n+    public void deletePermanentGroupUnprocessableTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+        final Group group = groupService.findByName(context, Group.ANONYMOUS);\n+        context.restoreAuthSystemState();\n+        String token = getAuthToken(admin.getEmail(), password);\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isUnprocessableEntity());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+    }\n+\n+    @Test\n+    public void deleteGroupForbiddenTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);", "originalCommit": "c9b9c7adf3e1502d0092defd727fa86e031eadcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0ODExOQ==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r401748119", "bodyText": "Same as above. should use GroupBuilder, missing a context.restoreAuthSystemState(); and same question about commit() and reloadEntity() as above.", "author": "tdonohue", "createdAt": "2020-04-01T16:29:08Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -1538,4 +1650,342 @@ public void removeMemberUnprocessableTest() throws Exception {\n             }\n         }\n     }\n+\n+    @Test\n+    public void deleteGroupTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isNoContent());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isNotFound());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupUnauthorizedTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient().perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isUnauthorized());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupUnprocessableTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        EPerson reviewer1 = EPersonBuilder.createEPerson(context)\n+                .withEmail(\"reviewer1@example.com\")\n+                .withPassword(password)\n+                .build();\n+\n+        parentCommunity = CommunityBuilder.createCommunity(context)\n+                .withName(\"Parent Community\")\n+                .build();\n+        Community child1 = CommunityBuilder.createSubCommunity(context, parentCommunity)\n+                .withName(\"Sub Community\")\n+                .build();\n+        Collection col1 = CollectionBuilder.createCollection(context, child1)\n+                .withName(\"Collection 1\")\n+                .withWorkflowGroup(1, admin, reviewer1)\n+                .build();\n+\n+        final Group workflowGroup = col1.getWorkflowStep1(context);\n+        context.commit();\n+        context.reloadEntity(workflowGroup);\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + workflowGroup.getID())\n+        ).andExpect(status().isUnprocessableEntity());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+    }\n+\n+    @Test\n+    public void deletePermanentGroupUnprocessableTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+        final Group group = groupService.findByName(context, Group.ANONYMOUS);\n+        context.restoreAuthSystemState();\n+        String token = getAuthToken(admin.getEmail(), password);\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isUnprocessableEntity());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+    }\n+\n+    @Test\n+    public void deleteGroupForbiddenTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String adminToken = getAuthToken(admin.getEmail(), password);\n+            String authToken = getAuthToken(eperson.getEmail(), password);\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isForbidden());\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupNotFoundTest() throws Exception {\n+\n+        context.turnOffAuthorisationSystem();\n+        context.commit();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + UUID.randomUUID())\n+        ).andExpect(status().isNotFound());\n+    }\n+\n+    @Test\n+    public void getGroupObjectCommunityTest() throws Exception {\n+        CommunityService communityService\n+                = ContentServiceFactory.getInstance().getCommunityService();\n+        Community community = null;\n+        Group adminGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            community = communityService.create(null, context);\n+            adminGroup = communityService.createAdministrators(context, community);\n+            context.commit();\n+            adminGroup = context.reloadEntity(adminGroup);", "originalCommit": "c9b9c7adf3e1502d0092defd727fa86e031eadcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0ODIwNQ==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r401748205", "bodyText": "Same as above. should use GroupBuilder, missing a context.restoreAuthSystemState(); and same question about commit() and reloadEntity() as above.", "author": "tdonohue", "createdAt": "2020-04-01T16:29:15Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -1538,4 +1650,342 @@ public void removeMemberUnprocessableTest() throws Exception {\n             }\n         }\n     }\n+\n+    @Test\n+    public void deleteGroupTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isNoContent());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isNotFound());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupUnauthorizedTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient().perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isUnauthorized());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupUnprocessableTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        EPerson reviewer1 = EPersonBuilder.createEPerson(context)\n+                .withEmail(\"reviewer1@example.com\")\n+                .withPassword(password)\n+                .build();\n+\n+        parentCommunity = CommunityBuilder.createCommunity(context)\n+                .withName(\"Parent Community\")\n+                .build();\n+        Community child1 = CommunityBuilder.createSubCommunity(context, parentCommunity)\n+                .withName(\"Sub Community\")\n+                .build();\n+        Collection col1 = CollectionBuilder.createCollection(context, child1)\n+                .withName(\"Collection 1\")\n+                .withWorkflowGroup(1, admin, reviewer1)\n+                .build();\n+\n+        final Group workflowGroup = col1.getWorkflowStep1(context);\n+        context.commit();\n+        context.reloadEntity(workflowGroup);\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + workflowGroup.getID())\n+        ).andExpect(status().isUnprocessableEntity());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+    }\n+\n+    @Test\n+    public void deletePermanentGroupUnprocessableTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+        final Group group = groupService.findByName(context, Group.ANONYMOUS);\n+        context.restoreAuthSystemState();\n+        String token = getAuthToken(admin.getEmail(), password);\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isUnprocessableEntity());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+    }\n+\n+    @Test\n+    public void deleteGroupForbiddenTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String adminToken = getAuthToken(admin.getEmail(), password);\n+            String authToken = getAuthToken(eperson.getEmail(), password);\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isForbidden());\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupNotFoundTest() throws Exception {\n+\n+        context.turnOffAuthorisationSystem();\n+        context.commit();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + UUID.randomUUID())\n+        ).andExpect(status().isNotFound());\n+    }\n+\n+    @Test\n+    public void getGroupObjectCommunityTest() throws Exception {\n+        CommunityService communityService\n+                = ContentServiceFactory.getInstance().getCommunityService();\n+        Community community = null;\n+        Group adminGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            community = communityService.create(null, context);\n+            adminGroup = communityService.createAdministrators(context, community);\n+            context.commit();\n+            adminGroup = context.reloadEntity(adminGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (community != null) {\n+                CommunityBuilder.deleteCommunity(community.getID());\n+            }\n+            if (adminGroup != null) {\n+                GroupBuilder.deleteGroup(adminGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void getGroupObjectCollectionTest() throws Exception {\n+        CommunityService communityService\n+                = ContentServiceFactory.getInstance().getCommunityService();\n+        CollectionService collectionService\n+                = ContentServiceFactory.getInstance().getCollectionService();\n+        Community community = null;\n+        Collection collection = null;\n+        Group adminGroup = null;\n+        Group worfklowGroup = null;\n+        Group submitterGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            community = communityService.create(null, context);\n+            collection = collectionService.create(context, community);\n+            adminGroup = collectionService.createAdministrators(context, collection);\n+            worfklowGroup = collectionService.createWorkflowGroup(context, collection, 1);\n+            submitterGroup = collectionService.createSubmitters(context, collection);\n+            context.commit();\n+            adminGroup = context.reloadEntity(adminGroup);", "originalCommit": "c9b9c7adf3e1502d0092defd727fa86e031eadcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0OTc2NA==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r401749764", "bodyText": "You should be using the GroupBuilder.createGroup() method to create all the Groups in these tests.  That way they will be automatically cleaned up after the test completes. In other words, you no longer need any of the finally clauses in any of the tests you created, as long as you use the GroupBuilder test utility.", "author": "tdonohue", "createdAt": "2020-04-01T16:31:37Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -1538,4 +1650,342 @@ public void removeMemberUnprocessableTest() throws Exception {\n             }\n         }\n     }\n+\n+    @Test\n+    public void deleteGroupTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);", "originalCommit": "c9b9c7adf3e1502d0092defd727fa86e031eadcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc1MTE5NA==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r401751194", "bodyText": "Same as above. should use GroupBuilder, missing a context.restoreAuthSystemState(); and same question about commit() and reloadEntity() as above.", "author": "tdonohue", "createdAt": "2020-04-01T16:33:41Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -1538,4 +1650,342 @@ public void removeMemberUnprocessableTest() throws Exception {\n             }\n         }\n     }\n+\n+    @Test\n+    public void deleteGroupTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isNoContent());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isNotFound());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupUnauthorizedTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient().perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isUnauthorized());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupUnprocessableTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        EPerson reviewer1 = EPersonBuilder.createEPerson(context)\n+                .withEmail(\"reviewer1@example.com\")\n+                .withPassword(password)\n+                .build();\n+\n+        parentCommunity = CommunityBuilder.createCommunity(context)\n+                .withName(\"Parent Community\")\n+                .build();\n+        Community child1 = CommunityBuilder.createSubCommunity(context, parentCommunity)\n+                .withName(\"Sub Community\")\n+                .build();\n+        Collection col1 = CollectionBuilder.createCollection(context, child1)\n+                .withName(\"Collection 1\")\n+                .withWorkflowGroup(1, admin, reviewer1)\n+                .build();\n+\n+        final Group workflowGroup = col1.getWorkflowStep1(context);\n+        context.commit();\n+        context.reloadEntity(workflowGroup);\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + workflowGroup.getID())\n+        ).andExpect(status().isUnprocessableEntity());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+    }\n+\n+    @Test\n+    public void deletePermanentGroupUnprocessableTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+        final Group group = groupService.findByName(context, Group.ANONYMOUS);\n+        context.restoreAuthSystemState();\n+        String token = getAuthToken(admin.getEmail(), password);\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isUnprocessableEntity());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+    }\n+\n+    @Test\n+    public void deleteGroupForbiddenTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String adminToken = getAuthToken(admin.getEmail(), password);\n+            String authToken = getAuthToken(eperson.getEmail(), password);\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isForbidden());\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupNotFoundTest() throws Exception {\n+\n+        context.turnOffAuthorisationSystem();\n+        context.commit();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + UUID.randomUUID())\n+        ).andExpect(status().isNotFound());\n+    }\n+\n+    @Test\n+    public void getGroupObjectCommunityTest() throws Exception {\n+        CommunityService communityService\n+                = ContentServiceFactory.getInstance().getCommunityService();\n+        Community community = null;\n+        Group adminGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            community = communityService.create(null, context);\n+            adminGroup = communityService.createAdministrators(context, community);\n+            context.commit();\n+            adminGroup = context.reloadEntity(adminGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (community != null) {\n+                CommunityBuilder.deleteCommunity(community.getID());\n+            }\n+            if (adminGroup != null) {\n+                GroupBuilder.deleteGroup(adminGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void getGroupObjectCollectionTest() throws Exception {\n+        CommunityService communityService\n+                = ContentServiceFactory.getInstance().getCommunityService();\n+        CollectionService collectionService\n+                = ContentServiceFactory.getInstance().getCollectionService();\n+        Community community = null;\n+        Collection collection = null;\n+        Group adminGroup = null;\n+        Group worfklowGroup = null;\n+        Group submitterGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            community = communityService.create(null, context);\n+            collection = collectionService.create(context, community);\n+            adminGroup = collectionService.createAdministrators(context, collection);\n+            worfklowGroup = collectionService.createWorkflowGroup(context, collection, 1);\n+            submitterGroup = collectionService.createSubmitters(context, collection);\n+            context.commit();\n+            adminGroup = context.reloadEntity(adminGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + worfklowGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + submitterGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (collection != null) {\n+                CollectionBuilder.deleteCollection(collection.getID());\n+            }\n+            if (community != null) {\n+                CommunityBuilder.deleteCommunity(community.getID());\n+            }\n+            if (adminGroup != null) {\n+                GroupBuilder.deleteGroup(adminGroup.getID());\n+            }\n+            if (worfklowGroup != null) {\n+                GroupBuilder.deleteGroup(worfklowGroup.getID());\n+            }\n+            if (submitterGroup != null) {\n+                GroupBuilder.deleteGroup(submitterGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void getGroupObjectNotFoundTest() throws Exception {\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+        Group adminGroup = null;\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            adminGroup = groupService.create(context);\n+            context.commit();\n+            adminGroup = context.reloadEntity(adminGroup);", "originalCommit": "c9b9c7adf3e1502d0092defd727fa86e031eadcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc1MTI3NQ==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r401751275", "bodyText": "Same as above. should use GroupBuilder, missing a context.restoreAuthSystemState(); and same question about commit() and reloadEntity() as above.", "author": "tdonohue", "createdAt": "2020-04-01T16:33:49Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -1538,4 +1650,342 @@ public void removeMemberUnprocessableTest() throws Exception {\n             }\n         }\n     }\n+\n+    @Test\n+    public void deleteGroupTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isNoContent());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isNotFound());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupUnauthorizedTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient().perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isUnauthorized());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupUnprocessableTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        EPerson reviewer1 = EPersonBuilder.createEPerson(context)\n+                .withEmail(\"reviewer1@example.com\")\n+                .withPassword(password)\n+                .build();\n+\n+        parentCommunity = CommunityBuilder.createCommunity(context)\n+                .withName(\"Parent Community\")\n+                .build();\n+        Community child1 = CommunityBuilder.createSubCommunity(context, parentCommunity)\n+                .withName(\"Sub Community\")\n+                .build();\n+        Collection col1 = CollectionBuilder.createCollection(context, child1)\n+                .withName(\"Collection 1\")\n+                .withWorkflowGroup(1, admin, reviewer1)\n+                .build();\n+\n+        final Group workflowGroup = col1.getWorkflowStep1(context);\n+        context.commit();\n+        context.reloadEntity(workflowGroup);\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + workflowGroup.getID())\n+        ).andExpect(status().isUnprocessableEntity());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+    }\n+\n+    @Test\n+    public void deletePermanentGroupUnprocessableTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+        final Group group = groupService.findByName(context, Group.ANONYMOUS);\n+        context.restoreAuthSystemState();\n+        String token = getAuthToken(admin.getEmail(), password);\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isUnprocessableEntity());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+    }\n+\n+    @Test\n+    public void deleteGroupForbiddenTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String adminToken = getAuthToken(admin.getEmail(), password);\n+            String authToken = getAuthToken(eperson.getEmail(), password);\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isForbidden());\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupNotFoundTest() throws Exception {\n+\n+        context.turnOffAuthorisationSystem();\n+        context.commit();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + UUID.randomUUID())\n+        ).andExpect(status().isNotFound());\n+    }\n+\n+    @Test\n+    public void getGroupObjectCommunityTest() throws Exception {\n+        CommunityService communityService\n+                = ContentServiceFactory.getInstance().getCommunityService();\n+        Community community = null;\n+        Group adminGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            community = communityService.create(null, context);\n+            adminGroup = communityService.createAdministrators(context, community);\n+            context.commit();\n+            adminGroup = context.reloadEntity(adminGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (community != null) {\n+                CommunityBuilder.deleteCommunity(community.getID());\n+            }\n+            if (adminGroup != null) {\n+                GroupBuilder.deleteGroup(adminGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void getGroupObjectCollectionTest() throws Exception {\n+        CommunityService communityService\n+                = ContentServiceFactory.getInstance().getCommunityService();\n+        CollectionService collectionService\n+                = ContentServiceFactory.getInstance().getCollectionService();\n+        Community community = null;\n+        Collection collection = null;\n+        Group adminGroup = null;\n+        Group worfklowGroup = null;\n+        Group submitterGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            community = communityService.create(null, context);\n+            collection = collectionService.create(context, community);\n+            adminGroup = collectionService.createAdministrators(context, collection);\n+            worfklowGroup = collectionService.createWorkflowGroup(context, collection, 1);\n+            submitterGroup = collectionService.createSubmitters(context, collection);\n+            context.commit();\n+            adminGroup = context.reloadEntity(adminGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + worfklowGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + submitterGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (collection != null) {\n+                CollectionBuilder.deleteCollection(collection.getID());\n+            }\n+            if (community != null) {\n+                CommunityBuilder.deleteCommunity(community.getID());\n+            }\n+            if (adminGroup != null) {\n+                GroupBuilder.deleteGroup(adminGroup.getID());\n+            }\n+            if (worfklowGroup != null) {\n+                GroupBuilder.deleteGroup(worfklowGroup.getID());\n+            }\n+            if (submitterGroup != null) {\n+                GroupBuilder.deleteGroup(submitterGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void getGroupObjectNotFoundTest() throws Exception {\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+        Group adminGroup = null;\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            adminGroup = groupService.create(context);\n+            context.commit();\n+            adminGroup = context.reloadEntity(adminGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isNotFound());\n+        } finally {\n+            if (adminGroup != null) {\n+                GroupBuilder.deleteGroup(adminGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void getGroupObjectUnauthorizedTest() throws Exception {\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+        Group adminGroup = null;\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            adminGroup = groupService.create(context);\n+            context.commit();\n+            adminGroup = context.reloadEntity(adminGroup);", "originalCommit": "c9b9c7adf3e1502d0092defd727fa86e031eadcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc1MjI5NQ==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r401752295", "bodyText": "This test looks great. It's not hardcoding JSON & it's using the GroupBuilder to create a test Group.  The other tests above should use this same pattern to make them easier to read/review.\nHowever, the only thing missing here is a context.restoreAuthSystemState();", "author": "tdonohue", "createdAt": "2020-04-01T16:35:26Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -1538,4 +1650,342 @@ public void removeMemberUnprocessableTest() throws Exception {\n             }\n         }\n     }\n+\n+    @Test\n+    public void deleteGroupTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isNoContent());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isNotFound());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupUnauthorizedTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient().perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isUnauthorized());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupUnprocessableTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        EPerson reviewer1 = EPersonBuilder.createEPerson(context)\n+                .withEmail(\"reviewer1@example.com\")\n+                .withPassword(password)\n+                .build();\n+\n+        parentCommunity = CommunityBuilder.createCommunity(context)\n+                .withName(\"Parent Community\")\n+                .build();\n+        Community child1 = CommunityBuilder.createSubCommunity(context, parentCommunity)\n+                .withName(\"Sub Community\")\n+                .build();\n+        Collection col1 = CollectionBuilder.createCollection(context, child1)\n+                .withName(\"Collection 1\")\n+                .withWorkflowGroup(1, admin, reviewer1)\n+                .build();\n+\n+        final Group workflowGroup = col1.getWorkflowStep1(context);\n+        context.commit();\n+        context.reloadEntity(workflowGroup);\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + workflowGroup.getID())\n+        ).andExpect(status().isUnprocessableEntity());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+    }\n+\n+    @Test\n+    public void deletePermanentGroupUnprocessableTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+        final Group group = groupService.findByName(context, Group.ANONYMOUS);\n+        context.restoreAuthSystemState();\n+        String token = getAuthToken(admin.getEmail(), password);\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isUnprocessableEntity());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+    }\n+\n+    @Test\n+    public void deleteGroupForbiddenTest() throws Exception {\n+\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = groupService.create(context);\n+\n+            context.commit();\n+\n+            parentGroup = context.reloadEntity(parentGroup);\n+\n+            String adminToken = getAuthToken(admin.getEmail(), password);\n+            String authToken = getAuthToken(eperson.getEmail(), password);\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isForbidden());\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupNotFoundTest() throws Exception {\n+\n+        context.turnOffAuthorisationSystem();\n+        context.commit();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + UUID.randomUUID())\n+        ).andExpect(status().isNotFound());\n+    }\n+\n+    @Test\n+    public void getGroupObjectCommunityTest() throws Exception {\n+        CommunityService communityService\n+                = ContentServiceFactory.getInstance().getCommunityService();\n+        Community community = null;\n+        Group adminGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            community = communityService.create(null, context);\n+            adminGroup = communityService.createAdministrators(context, community);\n+            context.commit();\n+            adminGroup = context.reloadEntity(adminGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (community != null) {\n+                CommunityBuilder.deleteCommunity(community.getID());\n+            }\n+            if (adminGroup != null) {\n+                GroupBuilder.deleteGroup(adminGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void getGroupObjectCollectionTest() throws Exception {\n+        CommunityService communityService\n+                = ContentServiceFactory.getInstance().getCommunityService();\n+        CollectionService collectionService\n+                = ContentServiceFactory.getInstance().getCollectionService();\n+        Community community = null;\n+        Collection collection = null;\n+        Group adminGroup = null;\n+        Group worfklowGroup = null;\n+        Group submitterGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            community = communityService.create(null, context);\n+            collection = collectionService.create(context, community);\n+            adminGroup = collectionService.createAdministrators(context, collection);\n+            worfklowGroup = collectionService.createWorkflowGroup(context, collection, 1);\n+            submitterGroup = collectionService.createSubmitters(context, collection);\n+            context.commit();\n+            adminGroup = context.reloadEntity(adminGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + worfklowGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + submitterGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (collection != null) {\n+                CollectionBuilder.deleteCollection(collection.getID());\n+            }\n+            if (community != null) {\n+                CommunityBuilder.deleteCommunity(community.getID());\n+            }\n+            if (adminGroup != null) {\n+                GroupBuilder.deleteGroup(adminGroup.getID());\n+            }\n+            if (worfklowGroup != null) {\n+                GroupBuilder.deleteGroup(worfklowGroup.getID());\n+            }\n+            if (submitterGroup != null) {\n+                GroupBuilder.deleteGroup(submitterGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void getGroupObjectNotFoundTest() throws Exception {\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+        Group adminGroup = null;\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            adminGroup = groupService.create(context);\n+            context.commit();\n+            adminGroup = context.reloadEntity(adminGroup);\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isNotFound());\n+        } finally {\n+            if (adminGroup != null) {\n+                GroupBuilder.deleteGroup(adminGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void getGroupObjectUnauthorizedTest() throws Exception {\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+        Group adminGroup = null;\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            adminGroup = groupService.create(context);\n+            context.commit();\n+            adminGroup = context.reloadEntity(adminGroup);\n+\n+            getClient().perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isUnauthorized());\n+        } finally {\n+            if (adminGroup != null) {\n+                GroupBuilder.deleteGroup(adminGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void patchNameTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        String testGroupName = \"Test group\";\n+        Group group = GroupBuilder.createGroup(context)\n+                .withName(testGroupName)\n+                .build();\n+\n+\n+        String newName = \"New test name\";\n+        List<Operation> ops = new ArrayList<Operation>();\n+        ReplaceOperation replaceOperation = new ReplaceOperation(\"/name\", newName);\n+        ops.add(replaceOperation);\n+        String patchBody = getPatchContent(ops);", "originalCommit": "c9b9c7adf3e1502d0092defd727fa86e031eadcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "17daf34c47e3e9fa1c4a0d3493dfe0baf5603ebf", "url": "https://github.com/DSpace/DSpace/commit/17daf34c47e3e9fa1c4a0d3493dfe0baf5603ebf", "message": "Update tests, imports, fields and javadoc", "committedDate": "2020-04-03T11:59:40Z", "type": "commit"}, {"oid": "d411ef0b400bd3e47455f6fa46c13edce48896b1", "url": "https://github.com/DSpace/DSpace/commit/d411ef0b400bd3e47455f6fa46c13edce48896b1", "message": "Merge remote-tracking branch 'upstream/master' into Manage-groups-2", "committedDate": "2020-04-03T12:06:04Z", "type": "commit"}, {"oid": "5d37956b7ab057f27e98300f56a348163b772bfa", "url": "https://github.com/DSpace/DSpace/commit/5d37956b7ab057f27e98300f56a348163b772bfa", "message": "Remove ResourceNotFoundException from GroupParentObjectLinkRepository\n\nThis caused 404 responses in endpoints that used this link.", "committedDate": "2020-04-03T12:47:52Z", "type": "commit"}, {"oid": "37abae898ae9a2113372b154746be1b726f15308", "url": "https://github.com/DSpace/DSpace/commit/37abae898ae9a2113372b154746be1b726f15308", "message": "Add license", "committedDate": "2020-04-03T14:14:17Z", "type": "commit"}, {"oid": "fd573bc094110286dcc22c4eebc5bcac5b46c429", "url": "https://github.com/DSpace/DSpace/commit/fd573bc094110286dcc22c4eebc5bcac5b46c429", "message": "Checkstyle fix", "committedDate": "2020-04-03T14:57:20Z", "type": "commit"}, {"oid": "1f3e7f732ba9867ba141c92f421daa869a26c3c9", "url": "https://github.com/DSpace/DSpace/commit/1f3e7f732ba9867ba141c92f421daa869a26c3c9", "message": "Allow the parent object link for members of the group", "committedDate": "2020-04-06T08:12:02Z", "type": "commit"}, {"oid": "b49c86ac49cc09bd21b065d9833eddfeb3583a17", "url": "https://github.com/DSpace/DSpace/commit/b49c86ac49cc09bd21b065d9833eddfeb3583a17", "message": "Whitespace fix", "committedDate": "2020-04-06T09:14:58Z", "type": "commit"}, {"oid": "e62d912b11c33ce31fd30bb69493f63399871dfc", "url": "https://github.com/DSpace/DSpace/commit/e62d912b11c33ce31fd30bb69493f63399871dfc", "message": "Replace GroupService by GroupBuilder in a couple tests", "committedDate": "2020-04-06T13:51:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA5Nzc5NA==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r405097794", "bodyText": "You shouldn't need to check these permissions manually in Java Code.  You can still use a @PreAuthorize annotation on this method by doing:\n@PreAuthorize(\"hasPermission(#groupId, 'GROUP', 'READ') or hasAuthority('ADMIN')\")\nIf you look at how hasPermission is defined for GROUP Read privileges, you'll see it's actually just returning true whenever you are a member of the group: https://github.com/DSpace/DSpace/blob/master/dspace-server-webapp/src/main/java/org/dspace/app/rest/security/GroupRestPermissionEvaluatorPlugin.java#L67-L69", "author": "tdonohue", "createdAt": "2020-04-07T20:39:05Z", "path": "dspace-server-webapp/src/main/java/org/dspace/app/rest/repository/GroupParentObjectLinkRepository.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/**\n+ * The contents of this file are subject to the license and copyright\n+ * detailed in the LICENSE and NOTICE files at the root of the source\n+ * tree and available online at\n+ *\n+ * http://www.dspace.org/license/\n+ */\n+package org.dspace.app.rest.repository;\n+\n+import java.sql.SQLException;\n+import java.util.UUID;\n+import javax.annotation.Nullable;\n+import javax.servlet.http.HttpServletRequest;\n+\n+import org.dspace.app.rest.model.DSpaceObjectRest;\n+import org.dspace.app.rest.model.GroupRest;\n+import org.dspace.app.rest.projection.Projection;\n+import org.dspace.authorize.service.AuthorizeService;\n+import org.dspace.content.DSpaceObject;\n+import org.dspace.core.Constants;\n+import org.dspace.core.Context;\n+import org.dspace.eperson.Group;\n+import org.dspace.eperson.service.GroupService;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.data.domain.Pageable;\n+import org.springframework.data.rest.webmvc.ResourceNotFoundException;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.stereotype.Component;\n+\n+/**\n+ * Link repository for the parent object of a group.\n+ */\n+@Component(GroupRest.CATEGORY + \".\" + GroupRest.NAME + \".\" + GroupRest.OBJECT)\n+public class GroupParentObjectLinkRepository extends AbstractDSpaceRestRepository\n+        implements LinkRestRepository {\n+\n+    @Autowired\n+    GroupService groupService;\n+\n+    @Autowired\n+    private AuthorizeService authorizeService;\n+\n+    /**\n+     * This returns the DSpace Object (Community, Collection) belonging to this Group.\n+     * This is only applicable for roles in that DSpace Object\n+     * e.g. the Community Administrator or Collection Submitter Group\n+     */\n+    public DSpaceObjectRest getParentObject(\n+            @Nullable HttpServletRequest request,\n+            UUID groupId,\n+            @Nullable Pageable optionalPageable,\n+            Projection projection\n+    ) {\n+        Context context = obtainContext();\n+        try {\n+            Group group = groupService.find(context, groupId);\n+            if (group == null) {\n+                throw new ResourceNotFoundException(\n+                        GroupRest.CATEGORY + \".\" + GroupRest.NAME\n+                                + \" with id: \" + groupId + \" not found\"\n+                );\n+            } else {\n+                DSpaceObject parent = groupService.getParentObject(context, group);\n+                if (parent != null) {\n+                    if (groupService.isMember(context, context.getCurrentUser(), group)\n+                            || authorizeService.authorizeActionBoolean(context, parent, Constants.ADMIN)) {", "originalCommit": "e62d912b11c33ce31fd30bb69493f63399871dfc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEwMzg3OA==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r405103878", "bodyText": "You don't need the context.turnOffAuthorisationSystem() and context.restoreAuthSystemState() lines here. You aren't creating test content, you are just searching for the ANONYMOUS group.", "author": "tdonohue", "createdAt": "2020-04-07T20:49:49Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -1538,4 +1637,337 @@ public void removeMemberUnprocessableTest() throws Exception {\n             }\n         }\n     }\n+\n+    @Test\n+    public void deleteGroupTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        Group parentGroup = GroupBuilder.createGroup(context)\n+                .withName(\"test group\")\n+                .build();\n+\n+        context.restoreAuthSystemState();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isNoContent());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isNotFound());\n+    }\n+\n+    @Test\n+    public void deleteGroupUnauthorizedTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        Group parentGroup = GroupBuilder.createGroup(context)\n+                .withName(\"test group\")\n+                .build();\n+\n+        context.restoreAuthSystemState();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient().perform(\n+                delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isUnauthorized());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+    }\n+\n+    @Test\n+    public void deleteGroupUnprocessableTest() throws Exception {\n+        Collection col1 = null;\n+        Community child1 = null;\n+        Group workflowGroup = null;\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            EPerson reviewer1 = EPersonBuilder.createEPerson(context)\n+                    .withEmail(\"reviewer1@example.com\")\n+                    .withPassword(password)\n+                    .build();\n+\n+            parentCommunity = CommunityBuilder.createCommunity(context)\n+                    .withName(\"Parent Community\")\n+                    .build();\n+            child1 = CommunityBuilder.createSubCommunity(context, parentCommunity)\n+                    .withName(\"Sub Community\")\n+                    .build();\n+            col1 = CollectionBuilder.createCollection(context, child1)\n+                    .withName(\"Collection 1\")\n+                    .withWorkflowGroup(1, admin, reviewer1)\n+                    .build();\n+\n+            workflowGroup = col1.getWorkflowStep1(context);\n+            context.restoreAuthSystemState();\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isUnprocessableEntity());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (col1 != null) {\n+                CollectionBuilder.deleteCollection(col1.getID());\n+            }\n+            if (child1 != null) {\n+                CommunityBuilder.deleteCommunity(child1.getID());\n+            }\n+            if (parentCommunity != null) {\n+                CommunityBuilder.deleteCommunity(parentCommunity.getID());\n+            }\n+            if (workflowGroup != null) {\n+                GroupBuilder.deleteGroup(workflowGroup.getID());\n+            }\n+        }\n+\n+    }\n+\n+    @Test\n+    public void deletePermanentGroupUnprocessableTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+        final Group group = groupService.findByName(context, Group.ANONYMOUS);\n+        context.restoreAuthSystemState();", "originalCommit": "e62d912b11c33ce31fd30bb69493f63399871dfc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEwNjIzOA==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r405106238", "bodyText": "You've misunderstood how these *Builder classes work. Any content created using the Builder class will be automatically cleaned up when AbstractBuilder.cleanupObjects() is called here: https://github.com/DSpace/DSpace/blob/master/dspace-server-webapp/src/test/java/org/dspace/app/rest/test/AbstractIntegrationTestWithDatabase.java#L177\nThis means that you can remove this entire finally clause (and the try as well).  These various delete*() methods don't need to be called here...they will be called automatically during cleanup.", "author": "tdonohue", "createdAt": "2020-04-07T20:53:59Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -1538,4 +1637,337 @@ public void removeMemberUnprocessableTest() throws Exception {\n             }\n         }\n     }\n+\n+    @Test\n+    public void deleteGroupTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        Group parentGroup = GroupBuilder.createGroup(context)\n+                .withName(\"test group\")\n+                .build();\n+\n+        context.restoreAuthSystemState();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isNoContent());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isNotFound());\n+    }\n+\n+    @Test\n+    public void deleteGroupUnauthorizedTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        Group parentGroup = GroupBuilder.createGroup(context)\n+                .withName(\"test group\")\n+                .build();\n+\n+        context.restoreAuthSystemState();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient().perform(\n+                delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isUnauthorized());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+    }\n+\n+    @Test\n+    public void deleteGroupUnprocessableTest() throws Exception {\n+        Collection col1 = null;\n+        Community child1 = null;\n+        Group workflowGroup = null;\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            EPerson reviewer1 = EPersonBuilder.createEPerson(context)\n+                    .withEmail(\"reviewer1@example.com\")\n+                    .withPassword(password)\n+                    .build();\n+\n+            parentCommunity = CommunityBuilder.createCommunity(context)\n+                    .withName(\"Parent Community\")\n+                    .build();\n+            child1 = CommunityBuilder.createSubCommunity(context, parentCommunity)\n+                    .withName(\"Sub Community\")\n+                    .build();\n+            col1 = CollectionBuilder.createCollection(context, child1)\n+                    .withName(\"Collection 1\")\n+                    .withWorkflowGroup(1, admin, reviewer1)\n+                    .build();\n+\n+            workflowGroup = col1.getWorkflowStep1(context);\n+            context.restoreAuthSystemState();\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isUnprocessableEntity());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (col1 != null) {\n+                CollectionBuilder.deleteCollection(col1.getID());\n+            }\n+            if (child1 != null) {\n+                CommunityBuilder.deleteCommunity(child1.getID());\n+            }\n+            if (parentCommunity != null) {\n+                CommunityBuilder.deleteCommunity(parentCommunity.getID());\n+            }\n+            if (workflowGroup != null) {\n+                GroupBuilder.deleteGroup(workflowGroup.getID());\n+            }\n+        }", "originalCommit": "e62d912b11c33ce31fd30bb69493f63399871dfc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEwNjY4OQ==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r405106689", "bodyText": "Again, this finally and try can be completely removed. Cleanup happens automatically when using Builders.", "author": "tdonohue", "createdAt": "2020-04-07T20:54:45Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -1538,4 +1637,337 @@ public void removeMemberUnprocessableTest() throws Exception {\n             }\n         }\n     }\n+\n+    @Test\n+    public void deleteGroupTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        Group parentGroup = GroupBuilder.createGroup(context)\n+                .withName(\"test group\")\n+                .build();\n+\n+        context.restoreAuthSystemState();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isNoContent());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isNotFound());\n+    }\n+\n+    @Test\n+    public void deleteGroupUnauthorizedTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        Group parentGroup = GroupBuilder.createGroup(context)\n+                .withName(\"test group\")\n+                .build();\n+\n+        context.restoreAuthSystemState();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient().perform(\n+                delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isUnauthorized());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+    }\n+\n+    @Test\n+    public void deleteGroupUnprocessableTest() throws Exception {\n+        Collection col1 = null;\n+        Community child1 = null;\n+        Group workflowGroup = null;\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            EPerson reviewer1 = EPersonBuilder.createEPerson(context)\n+                    .withEmail(\"reviewer1@example.com\")\n+                    .withPassword(password)\n+                    .build();\n+\n+            parentCommunity = CommunityBuilder.createCommunity(context)\n+                    .withName(\"Parent Community\")\n+                    .build();\n+            child1 = CommunityBuilder.createSubCommunity(context, parentCommunity)\n+                    .withName(\"Sub Community\")\n+                    .build();\n+            col1 = CollectionBuilder.createCollection(context, child1)\n+                    .withName(\"Collection 1\")\n+                    .withWorkflowGroup(1, admin, reviewer1)\n+                    .build();\n+\n+            workflowGroup = col1.getWorkflowStep1(context);\n+            context.restoreAuthSystemState();\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isUnprocessableEntity());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (col1 != null) {\n+                CollectionBuilder.deleteCollection(col1.getID());\n+            }\n+            if (child1 != null) {\n+                CommunityBuilder.deleteCommunity(child1.getID());\n+            }\n+            if (parentCommunity != null) {\n+                CommunityBuilder.deleteCommunity(parentCommunity.getID());\n+            }\n+            if (workflowGroup != null) {\n+                GroupBuilder.deleteGroup(workflowGroup.getID());\n+            }\n+        }\n+\n+    }\n+\n+    @Test\n+    public void deletePermanentGroupUnprocessableTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+        final Group group = groupService.findByName(context, Group.ANONYMOUS);\n+        context.restoreAuthSystemState();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isUnprocessableEntity());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+    }\n+\n+    @Test\n+    public void deleteGroupForbiddenTest() throws Exception {\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = GroupBuilder.createGroup(context)\n+                    .withName(\"test group\")\n+                    .build();\n+\n+            context.restoreAuthSystemState();\n+\n+            String adminToken = getAuthToken(admin.getEmail(), password);\n+            String authToken = getAuthToken(eperson.getEmail(), password);\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isForbidden());\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());", "originalCommit": "e62d912b11c33ce31fd30bb69493f63399871dfc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEwNjgwOQ==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r405106809", "bodyText": "Again, this finally and try can be completely removed. Cleanup happens automatically when using Builders.", "author": "tdonohue", "createdAt": "2020-04-07T20:55:00Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -1538,4 +1637,337 @@ public void removeMemberUnprocessableTest() throws Exception {\n             }\n         }\n     }\n+\n+    @Test\n+    public void deleteGroupTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        Group parentGroup = GroupBuilder.createGroup(context)\n+                .withName(\"test group\")\n+                .build();\n+\n+        context.restoreAuthSystemState();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isNoContent());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isNotFound());\n+    }\n+\n+    @Test\n+    public void deleteGroupUnauthorizedTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        Group parentGroup = GroupBuilder.createGroup(context)\n+                .withName(\"test group\")\n+                .build();\n+\n+        context.restoreAuthSystemState();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient().perform(\n+                delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isUnauthorized());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+    }\n+\n+    @Test\n+    public void deleteGroupUnprocessableTest() throws Exception {\n+        Collection col1 = null;\n+        Community child1 = null;\n+        Group workflowGroup = null;\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            EPerson reviewer1 = EPersonBuilder.createEPerson(context)\n+                    .withEmail(\"reviewer1@example.com\")\n+                    .withPassword(password)\n+                    .build();\n+\n+            parentCommunity = CommunityBuilder.createCommunity(context)\n+                    .withName(\"Parent Community\")\n+                    .build();\n+            child1 = CommunityBuilder.createSubCommunity(context, parentCommunity)\n+                    .withName(\"Sub Community\")\n+                    .build();\n+            col1 = CollectionBuilder.createCollection(context, child1)\n+                    .withName(\"Collection 1\")\n+                    .withWorkflowGroup(1, admin, reviewer1)\n+                    .build();\n+\n+            workflowGroup = col1.getWorkflowStep1(context);\n+            context.restoreAuthSystemState();\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isUnprocessableEntity());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (col1 != null) {\n+                CollectionBuilder.deleteCollection(col1.getID());\n+            }\n+            if (child1 != null) {\n+                CommunityBuilder.deleteCommunity(child1.getID());\n+            }\n+            if (parentCommunity != null) {\n+                CommunityBuilder.deleteCommunity(parentCommunity.getID());\n+            }\n+            if (workflowGroup != null) {\n+                GroupBuilder.deleteGroup(workflowGroup.getID());\n+            }\n+        }\n+\n+    }\n+\n+    @Test\n+    public void deletePermanentGroupUnprocessableTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+        final Group group = groupService.findByName(context, Group.ANONYMOUS);\n+        context.restoreAuthSystemState();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isUnprocessableEntity());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+    }\n+\n+    @Test\n+    public void deleteGroupForbiddenTest() throws Exception {\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = GroupBuilder.createGroup(context)\n+                    .withName(\"test group\")\n+                    .build();\n+\n+            context.restoreAuthSystemState();\n+\n+            String adminToken = getAuthToken(admin.getEmail(), password);\n+            String authToken = getAuthToken(eperson.getEmail(), password);\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isForbidden());\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupNotFoundTest() throws Exception {\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + UUID.randomUUID())\n+        ).andExpect(status().isNotFound());\n+    }\n+\n+    @Test\n+    public void getGroupObjectCommunityTest() throws Exception {\n+        Community community = null;\n+        Group adminGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            community =  CommunityBuilder.createCommunity(context)\n+                    .withName(\"Parent Community\")\n+                    .withAdminGroup(admin)\n+                    .build();\n+            adminGroup = community.getAdministrators();\n+            context.restoreAuthSystemState();\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (community != null) {\n+                CommunityBuilder.deleteCommunity(community.getID());\n+            }\n+            if (adminGroup != null) {\n+                GroupBuilder.deleteGroup(adminGroup.getID());\n+            }\n+        }", "originalCommit": "e62d912b11c33ce31fd30bb69493f63399871dfc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEwNjkxOA==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r405106918", "bodyText": "Again, this finally and try can be completely removed. Cleanup happens automatically when using Builders.", "author": "tdonohue", "createdAt": "2020-04-07T20:55:12Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -1538,4 +1637,337 @@ public void removeMemberUnprocessableTest() throws Exception {\n             }\n         }\n     }\n+\n+    @Test\n+    public void deleteGroupTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        Group parentGroup = GroupBuilder.createGroup(context)\n+                .withName(\"test group\")\n+                .build();\n+\n+        context.restoreAuthSystemState();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isNoContent());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isNotFound());\n+    }\n+\n+    @Test\n+    public void deleteGroupUnauthorizedTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        Group parentGroup = GroupBuilder.createGroup(context)\n+                .withName(\"test group\")\n+                .build();\n+\n+        context.restoreAuthSystemState();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient().perform(\n+                delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isUnauthorized());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+    }\n+\n+    @Test\n+    public void deleteGroupUnprocessableTest() throws Exception {\n+        Collection col1 = null;\n+        Community child1 = null;\n+        Group workflowGroup = null;\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            EPerson reviewer1 = EPersonBuilder.createEPerson(context)\n+                    .withEmail(\"reviewer1@example.com\")\n+                    .withPassword(password)\n+                    .build();\n+\n+            parentCommunity = CommunityBuilder.createCommunity(context)\n+                    .withName(\"Parent Community\")\n+                    .build();\n+            child1 = CommunityBuilder.createSubCommunity(context, parentCommunity)\n+                    .withName(\"Sub Community\")\n+                    .build();\n+            col1 = CollectionBuilder.createCollection(context, child1)\n+                    .withName(\"Collection 1\")\n+                    .withWorkflowGroup(1, admin, reviewer1)\n+                    .build();\n+\n+            workflowGroup = col1.getWorkflowStep1(context);\n+            context.restoreAuthSystemState();\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isUnprocessableEntity());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (col1 != null) {\n+                CollectionBuilder.deleteCollection(col1.getID());\n+            }\n+            if (child1 != null) {\n+                CommunityBuilder.deleteCommunity(child1.getID());\n+            }\n+            if (parentCommunity != null) {\n+                CommunityBuilder.deleteCommunity(parentCommunity.getID());\n+            }\n+            if (workflowGroup != null) {\n+                GroupBuilder.deleteGroup(workflowGroup.getID());\n+            }\n+        }\n+\n+    }\n+\n+    @Test\n+    public void deletePermanentGroupUnprocessableTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+        final Group group = groupService.findByName(context, Group.ANONYMOUS);\n+        context.restoreAuthSystemState();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isUnprocessableEntity());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+    }\n+\n+    @Test\n+    public void deleteGroupForbiddenTest() throws Exception {\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = GroupBuilder.createGroup(context)\n+                    .withName(\"test group\")\n+                    .build();\n+\n+            context.restoreAuthSystemState();\n+\n+            String adminToken = getAuthToken(admin.getEmail(), password);\n+            String authToken = getAuthToken(eperson.getEmail(), password);\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isForbidden());\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupNotFoundTest() throws Exception {\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + UUID.randomUUID())\n+        ).andExpect(status().isNotFound());\n+    }\n+\n+    @Test\n+    public void getGroupObjectCommunityTest() throws Exception {\n+        Community community = null;\n+        Group adminGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            community =  CommunityBuilder.createCommunity(context)\n+                    .withName(\"Parent Community\")\n+                    .withAdminGroup(admin)\n+                    .build();\n+            adminGroup = community.getAdministrators();\n+            context.restoreAuthSystemState();\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (community != null) {\n+                CommunityBuilder.deleteCommunity(community.getID());\n+            }\n+            if (adminGroup != null) {\n+                GroupBuilder.deleteGroup(adminGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void getGroupObjectCollectionTest() throws Exception {\n+        Community community = null;\n+        Collection collection = null;\n+        Group adminGroup = null;\n+        Group worfklowGroup = null;\n+        Group submitterGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            community = CommunityBuilder.createCommunity(context)\n+                    .withName(\"Parent Community\")\n+                    .withAdminGroup(admin)\n+                    .build();\n+            collection = CollectionBuilder.createCollection(context, community)\n+                    .withName(\"Collection\")\n+                    .withAdminGroup(admin)\n+                    .withWorkflowGroup(1, admin)\n+                    .withSubmitterGroup(admin)\n+                    .build();\n+            adminGroup = collection.getAdministrators();\n+            worfklowGroup = collection.getWorkflowStep1(context);\n+            submitterGroup = collection.getSubmitters();\n+            context.restoreAuthSystemState();\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + worfklowGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + submitterGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+        } finally {", "originalCommit": "e62d912b11c33ce31fd30bb69493f63399871dfc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEwNjk4MQ==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r405106981", "bodyText": "Again, this finally and try can be completely removed. Cleanup happens automatically when using Builders.", "author": "tdonohue", "createdAt": "2020-04-07T20:55:19Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -1538,4 +1637,337 @@ public void removeMemberUnprocessableTest() throws Exception {\n             }\n         }\n     }\n+\n+    @Test\n+    public void deleteGroupTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        Group parentGroup = GroupBuilder.createGroup(context)\n+                .withName(\"test group\")\n+                .build();\n+\n+        context.restoreAuthSystemState();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isNoContent());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isNotFound());\n+    }\n+\n+    @Test\n+    public void deleteGroupUnauthorizedTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        Group parentGroup = GroupBuilder.createGroup(context)\n+                .withName(\"test group\")\n+                .build();\n+\n+        context.restoreAuthSystemState();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient().perform(\n+                delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isUnauthorized());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+    }\n+\n+    @Test\n+    public void deleteGroupUnprocessableTest() throws Exception {\n+        Collection col1 = null;\n+        Community child1 = null;\n+        Group workflowGroup = null;\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            EPerson reviewer1 = EPersonBuilder.createEPerson(context)\n+                    .withEmail(\"reviewer1@example.com\")\n+                    .withPassword(password)\n+                    .build();\n+\n+            parentCommunity = CommunityBuilder.createCommunity(context)\n+                    .withName(\"Parent Community\")\n+                    .build();\n+            child1 = CommunityBuilder.createSubCommunity(context, parentCommunity)\n+                    .withName(\"Sub Community\")\n+                    .build();\n+            col1 = CollectionBuilder.createCollection(context, child1)\n+                    .withName(\"Collection 1\")\n+                    .withWorkflowGroup(1, admin, reviewer1)\n+                    .build();\n+\n+            workflowGroup = col1.getWorkflowStep1(context);\n+            context.restoreAuthSystemState();\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isUnprocessableEntity());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (col1 != null) {\n+                CollectionBuilder.deleteCollection(col1.getID());\n+            }\n+            if (child1 != null) {\n+                CommunityBuilder.deleteCommunity(child1.getID());\n+            }\n+            if (parentCommunity != null) {\n+                CommunityBuilder.deleteCommunity(parentCommunity.getID());\n+            }\n+            if (workflowGroup != null) {\n+                GroupBuilder.deleteGroup(workflowGroup.getID());\n+            }\n+        }\n+\n+    }\n+\n+    @Test\n+    public void deletePermanentGroupUnprocessableTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+        final Group group = groupService.findByName(context, Group.ANONYMOUS);\n+        context.restoreAuthSystemState();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isUnprocessableEntity());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+    }\n+\n+    @Test\n+    public void deleteGroupForbiddenTest() throws Exception {\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = GroupBuilder.createGroup(context)\n+                    .withName(\"test group\")\n+                    .build();\n+\n+            context.restoreAuthSystemState();\n+\n+            String adminToken = getAuthToken(admin.getEmail(), password);\n+            String authToken = getAuthToken(eperson.getEmail(), password);\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isForbidden());\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupNotFoundTest() throws Exception {\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + UUID.randomUUID())\n+        ).andExpect(status().isNotFound());\n+    }\n+\n+    @Test\n+    public void getGroupObjectCommunityTest() throws Exception {\n+        Community community = null;\n+        Group adminGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            community =  CommunityBuilder.createCommunity(context)\n+                    .withName(\"Parent Community\")\n+                    .withAdminGroup(admin)\n+                    .build();\n+            adminGroup = community.getAdministrators();\n+            context.restoreAuthSystemState();\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (community != null) {\n+                CommunityBuilder.deleteCommunity(community.getID());\n+            }\n+            if (adminGroup != null) {\n+                GroupBuilder.deleteGroup(adminGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void getGroupObjectCollectionTest() throws Exception {\n+        Community community = null;\n+        Collection collection = null;\n+        Group adminGroup = null;\n+        Group worfklowGroup = null;\n+        Group submitterGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            community = CommunityBuilder.createCommunity(context)\n+                    .withName(\"Parent Community\")\n+                    .withAdminGroup(admin)\n+                    .build();\n+            collection = CollectionBuilder.createCollection(context, community)\n+                    .withName(\"Collection\")\n+                    .withAdminGroup(admin)\n+                    .withWorkflowGroup(1, admin)\n+                    .withSubmitterGroup(admin)\n+                    .build();\n+            adminGroup = collection.getAdministrators();\n+            worfklowGroup = collection.getWorkflowStep1(context);\n+            submitterGroup = collection.getSubmitters();\n+            context.restoreAuthSystemState();\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + worfklowGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + submitterGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (collection != null) {\n+                CollectionBuilder.deleteCollection(collection.getID());\n+            }\n+            if (community != null) {\n+                CommunityBuilder.deleteCommunity(community.getID());\n+            }\n+            if (adminGroup != null) {\n+                GroupBuilder.deleteGroup(adminGroup.getID());\n+            }\n+            if (worfklowGroup != null) {\n+                GroupBuilder.deleteGroup(worfklowGroup.getID());\n+            }\n+            if (submitterGroup != null) {\n+                GroupBuilder.deleteGroup(submitterGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void getGroupObjectNotFoundTest() throws Exception {\n+        Group adminGroup = null;\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            adminGroup = GroupBuilder.createGroup(context)\n+                    .withName(\"test group\")\n+                    .build();\n+            context.restoreAuthSystemState();\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isNoContent());\n+        } finally {", "originalCommit": "e62d912b11c33ce31fd30bb69493f63399871dfc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEwNzExNA==", "url": "https://github.com/DSpace/DSpace/pull/2723#discussion_r405107114", "bodyText": "Again, this finally and try can be completely removed. Cleanup happens automatically when using Builders.", "author": "tdonohue", "createdAt": "2020-04-07T20:55:33Z", "path": "dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java", "diffHunk": "@@ -1538,4 +1637,337 @@ public void removeMemberUnprocessableTest() throws Exception {\n             }\n         }\n     }\n+\n+    @Test\n+    public void deleteGroupTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        Group parentGroup = GroupBuilder.createGroup(context)\n+                .withName(\"test group\")\n+                .build();\n+\n+        context.restoreAuthSystemState();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isNoContent());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isNotFound());\n+    }\n+\n+    @Test\n+    public void deleteGroupUnauthorizedTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+\n+        Group parentGroup = GroupBuilder.createGroup(context)\n+                .withName(\"test group\")\n+                .build();\n+\n+        context.restoreAuthSystemState();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient().perform(\n+                delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isUnauthorized());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + parentGroup.getID())\n+        ).andExpect(status().isOk());\n+    }\n+\n+    @Test\n+    public void deleteGroupUnprocessableTest() throws Exception {\n+        Collection col1 = null;\n+        Community child1 = null;\n+        Group workflowGroup = null;\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            EPerson reviewer1 = EPersonBuilder.createEPerson(context)\n+                    .withEmail(\"reviewer1@example.com\")\n+                    .withPassword(password)\n+                    .build();\n+\n+            parentCommunity = CommunityBuilder.createCommunity(context)\n+                    .withName(\"Parent Community\")\n+                    .build();\n+            child1 = CommunityBuilder.createSubCommunity(context, parentCommunity)\n+                    .withName(\"Sub Community\")\n+                    .build();\n+            col1 = CollectionBuilder.createCollection(context, child1)\n+                    .withName(\"Collection 1\")\n+                    .withWorkflowGroup(1, admin, reviewer1)\n+                    .build();\n+\n+            workflowGroup = col1.getWorkflowStep1(context);\n+            context.restoreAuthSystemState();\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isUnprocessableEntity());\n+\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + workflowGroup.getID())\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (col1 != null) {\n+                CollectionBuilder.deleteCollection(col1.getID());\n+            }\n+            if (child1 != null) {\n+                CommunityBuilder.deleteCommunity(child1.getID());\n+            }\n+            if (parentCommunity != null) {\n+                CommunityBuilder.deleteCommunity(parentCommunity.getID());\n+            }\n+            if (workflowGroup != null) {\n+                GroupBuilder.deleteGroup(workflowGroup.getID());\n+            }\n+        }\n+\n+    }\n+\n+    @Test\n+    public void deletePermanentGroupUnprocessableTest() throws Exception {\n+        context.turnOffAuthorisationSystem();\n+        GroupService groupService = EPersonServiceFactory.getInstance().getGroupService();\n+        final Group group = groupService.findByName(context, Group.ANONYMOUS);\n+        context.restoreAuthSystemState();\n+\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isUnprocessableEntity());\n+\n+        getClient(authToken).perform(\n+                get(\"/api/eperson/groups/\" + group.getID())\n+        ).andExpect(status().isOk());\n+\n+    }\n+\n+    @Test\n+    public void deleteGroupForbiddenTest() throws Exception {\n+\n+        Group parentGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+\n+            parentGroup = GroupBuilder.createGroup(context)\n+                    .withName(\"test group\")\n+                    .build();\n+\n+            context.restoreAuthSystemState();\n+\n+            String adminToken = getAuthToken(admin.getEmail(), password);\n+            String authToken = getAuthToken(eperson.getEmail(), password);\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+            getClient(authToken).perform(\n+                    delete(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isForbidden());\n+\n+            getClient(adminToken).perform(\n+                    get(\"/api/eperson/groups/\" + parentGroup.getID())\n+            ).andExpect(status().isOk());\n+\n+        } finally {\n+            if (parentGroup != null) {\n+                GroupBuilder.deleteGroup(parentGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void deleteGroupNotFoundTest() throws Exception {\n+        String authToken = getAuthToken(admin.getEmail(), password);\n+\n+        getClient(authToken).perform(\n+                delete(\"/api/eperson/groups/\" + UUID.randomUUID())\n+        ).andExpect(status().isNotFound());\n+    }\n+\n+    @Test\n+    public void getGroupObjectCommunityTest() throws Exception {\n+        Community community = null;\n+        Group adminGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            community =  CommunityBuilder.createCommunity(context)\n+                    .withName(\"Parent Community\")\n+                    .withAdminGroup(admin)\n+                    .build();\n+            adminGroup = community.getAdministrators();\n+            context.restoreAuthSystemState();\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (community != null) {\n+                CommunityBuilder.deleteCommunity(community.getID());\n+            }\n+            if (adminGroup != null) {\n+                GroupBuilder.deleteGroup(adminGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void getGroupObjectCollectionTest() throws Exception {\n+        Community community = null;\n+        Collection collection = null;\n+        Group adminGroup = null;\n+        Group worfklowGroup = null;\n+        Group submitterGroup = null;\n+\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            community = CommunityBuilder.createCommunity(context)\n+                    .withName(\"Parent Community\")\n+                    .withAdminGroup(admin)\n+                    .build();\n+            collection = CollectionBuilder.createCollection(context, community)\n+                    .withName(\"Collection\")\n+                    .withAdminGroup(admin)\n+                    .withWorkflowGroup(1, admin)\n+                    .withSubmitterGroup(admin)\n+                    .build();\n+            adminGroup = collection.getAdministrators();\n+            worfklowGroup = collection.getWorkflowStep1(context);\n+            submitterGroup = collection.getSubmitters();\n+            context.restoreAuthSystemState();\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + worfklowGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + submitterGroup.getID() + \"/object\")\n+            ).andExpect(status().isOk());\n+        } finally {\n+            if (collection != null) {\n+                CollectionBuilder.deleteCollection(collection.getID());\n+            }\n+            if (community != null) {\n+                CommunityBuilder.deleteCommunity(community.getID());\n+            }\n+            if (adminGroup != null) {\n+                GroupBuilder.deleteGroup(adminGroup.getID());\n+            }\n+            if (worfklowGroup != null) {\n+                GroupBuilder.deleteGroup(worfklowGroup.getID());\n+            }\n+            if (submitterGroup != null) {\n+                GroupBuilder.deleteGroup(submitterGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void getGroupObjectNotFoundTest() throws Exception {\n+        Group adminGroup = null;\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            adminGroup = GroupBuilder.createGroup(context)\n+                    .withName(\"test group\")\n+                    .build();\n+            context.restoreAuthSystemState();\n+\n+            String authToken = getAuthToken(admin.getEmail(), password);\n+            getClient(authToken).perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isNoContent());\n+        } finally {\n+            if (adminGroup != null) {\n+                GroupBuilder.deleteGroup(adminGroup.getID());\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void getGroupObjectUnauthorizedTest() throws Exception {\n+        Group adminGroup = null;\n+        Community community = null;\n+        try {\n+            context.turnOffAuthorisationSystem();\n+            community = CommunityBuilder.createCommunity(context)\n+                    .withName(\"Parent Community\")\n+                    .withAdminGroup(admin)\n+                    .build();\n+            adminGroup = community.getAdministrators();\n+            context.restoreAuthSystemState();\n+\n+            getClient().perform(\n+                    get(\"/api/eperson/groups/\" + adminGroup.getID() + \"/object\")\n+            ).andExpect(status().isUnauthorized());\n+        } finally {", "originalCommit": "e62d912b11c33ce31fd30bb69493f63399871dfc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d2313043557c480c48652c428e91579f52cfaaf8", "url": "https://github.com/DSpace/DSpace/commit/d2313043557c480c48652c428e91579f52cfaaf8", "message": "Rewrite authorization and remove try-finally blocks", "committedDate": "2020-04-08T12:02:55Z", "type": "commit"}]}