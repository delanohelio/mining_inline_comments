{"pr_number": 391, "pr_title": "Certify Oracle Enterprise Linux 7", "pr_createdAt": "2020-06-22T22:06:55Z", "pr_url": "https://github.com/greenplum-db/pxf/pull/391", "timeline": [{"oid": "414d65a505af9b0f69922ba9436bd82b1060d810", "url": "https://github.com/greenplum-db/pxf/commit/414d65a505af9b0f69922ba9436bd82b1060d810", "message": "Docker: Add docker image to support OEL7\n\nBuild a docker image using cloud build to certify support Oracle\nEnterprise Linux 7.", "committedDate": "2020-06-22T21:17:38Z", "type": "commit"}, {"oid": "932a364319d12865ef50bd4e43d9f17814609a1d", "url": "https://github.com/greenplum-db/pxf/commit/932a364319d12865ef50bd4e43d9f17814609a1d", "message": "Add a job to test PXF-GP6-HDP2 on OEL7\n\nThis commit adds a job to test PXF running on Oracle Enterprise Linux 7\nwith Greenplum 6.", "committedDate": "2020-06-22T21:56:34Z", "type": "commit"}, {"oid": "df2ab7c97deb3f179e05bbd827380a4c4509210c", "url": "https://github.com/greenplum-db/pxf/commit/df2ab7c97deb3f179e05bbd827380a4c4509210c", "message": "Update README with OEL7 image", "committedDate": "2020-06-22T22:11:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMwOTAyNA==", "url": "https://github.com/greenplum-db/pxf/pull/391#discussion_r444309024", "bodyText": "Don't forget to add this to the list of passed items in the testing gate.", "author": "oliverralbertini", "createdAt": "2020-06-23T15:22:41Z", "path": "concourse/pipelines/templates/build_pipeline-tpl.yml", "diffHunk": "@@ -556,6 +565,34 @@ jobs:\n       TARGET_OS_VERSION: 7\n {% endfor %} {# gp_ver 5 and 6 #}\n \n+- name: Test PXF-GP6-HDP2 on OEL7\n+  plan:\n+  - in_parallel:\n+    - get: pxf_src\n+      passed: [Build PXF-GP6 on RHEL7]\n+      trigger: true\n+    - get: pxf_tarball\n+      resource: pxf_gp6_tarball_rhel7\n+      passed: [Build PXF-GP6 on RHEL7]\n+    - get: gpdb_package\n+      resource: gpdb6_rhel7_rpm_latest-0\n+      passed: [Build PXF-GP6 on RHEL7]\n+    - get: gpdb6-pxf-dev-oel7-image\n+      passed: [Build PXF-GP6 on RHEL7]\n+    - get: pxf-automation-dependencies\n+    - get: singlecluster\n+      resource: singlecluster-hdp2\n+  - task: Test PXF-GP6-HDP2 on OEL7\n+    file: pxf_src/concourse/tasks/test.yml\n+    image: gpdb6-pxf-dev-oel7-image\n+    params:\n+      ACCESS_KEY_ID: ((tf-machine-access-key-id))\n+      GP_VER: 6\n+      GROUP: gpdb,proxy,profile\n+      SECRET_ACCESS_KEY: ((tf-machine-secret-access-key))\n+      TARGET_OS: centos\n+      TARGET_OS_VERSION: 7\n+", "originalCommit": "932a364319d12865ef50bd4e43d9f17814609a1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM5MDkwMg==", "url": "https://github.com/greenplum-db/pxf/pull/391#discussion_r444390902", "bodyText": "done!", "author": "frankgh", "createdAt": "2020-06-23T17:30:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMwOTAyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMxMTM1NA==", "url": "https://github.com/greenplum-db/pxf/pull/391#discussion_r444311354", "bodyText": "I guess the JVM wasn't an issue?", "author": "oliverralbertini", "createdAt": "2020-06-23T15:25:53Z", "path": "concourse/docker/pxf-dev-base/gpdb6/oel7/Dockerfile", "diffHunk": "@@ -0,0 +1,64 @@\n+ARG BASE_IMAGE=pivotaldata/gpdb-dev:latest\n+\n+FROM ${BASE_IMAGE}\n+\n+# install Go utilities\n+RUN mkdir -p /tmp/pxf_src/ && cd /tmp \\\n+    && wget -O go.tgz -q https://dl.google.com/go/go1.14.2.linux-amd64.tar.gz \\\n+    && tar -C /usr/local -xzf go.tgz && rm go.tgz \\\n+    && GOPATH=/opt/go /usr/local/go/bin/go get github.com/golang/dep/cmd/dep \\\n+    && GOPATH=/opt/go /usr/local/go/bin/go get github.com/onsi/ginkgo/ginkgo\n+\n+ARG MAVEN_VERSION=3.6.3\n+ARG USER_HOME_DIR=\"/root\"\n+ARG BASE_URL=https://apache.osuosl.org/maven/maven-3/${MAVEN_VERSION}/binaries\n+\n+# install dependencies that are missing on the base images\n+RUN curl -fsSL -o /tmp/apache-maven.tar.gz ${BASE_URL}/apache-maven-${MAVEN_VERSION}-bin.tar.gz \\\n+    && mkdir -p /usr/share/maven \\\n+    && tar -xzf /tmp/apache-maven.tar.gz -C /usr/share/maven --strip-components=1 \\\n+    && rm -f /tmp/apache-maven.tar.gz \\\n+    && ln -s /usr/share/maven/bin/mvn /usr/bin/mvn \\\n+    && yum install -y rpm-build python-devel sudo && yum clean all \\\n+    && cd /tmp && /usr/bin/pip install psi paramiko --no-cache-dir\n+\n+# create user gpadmin since GPDB cannot run under root\n+RUN ssh-keygen -t rsa -N \"\" -f /root/.ssh/id_rsa \\\n+    && cat /root/.ssh/id_rsa.pub >> /root/.ssh/authorized_keys \\\n+    && chmod 0600 /root/.ssh/authorized_keys \\\n+    && echo -e \"password\\npassword\" | passwd 2> /dev/null \\\n+    && { ssh-keyscan localhost; ssh-keyscan 0.0.0.0; } >> /root/.ssh/known_hosts \\\n+    && ssh-keygen -f /etc/ssh/ssh_host_key -N '' -t rsa1 \\\n+    && ssh-keygen -f /etc/ssh/ssh_host_rsa_key -N '' -t rsa \\\n+    && ssh-keygen -f /etc/ssh/ssh_host_dsa_key -N '' -t dsa \\\n+    && sed -i -e 's|Defaults    requiretty|#Defaults    requiretty|' /etc/sudoers \\\n+    && sed -ri 's/UsePAM yes/UsePAM no/g;s/PasswordAuthentication yes/PasswordAuthentication no/g' /etc/ssh/sshd_config \\\n+    && sed -ri 's@^HostKey /etc/ssh/ssh_host_ecdsa_key$@#&@;s@^HostKey /etc/ssh/ssh_host_ed25519_key$@#&@' /etc/ssh/sshd_config \\\n+    && groupadd -g 6000 gpadmin && useradd -u 6000 -g 6000 gpadmin \\\n+    && echo \"gpadmin  ALL=(ALL)       NOPASSWD: ALL\" > /etc/sudoers.d/gpadmin \\\n+    && groupadd supergroup && usermod -a -G supergroup gpadmin \\\n+    && mkdir /home/gpadmin/.ssh \\\n+    && ssh-keygen -t rsa -N \"\" -f /home/gpadmin/.ssh/id_rsa \\\n+    && cat /home/gpadmin/.ssh/id_rsa.pub >> /home/gpadmin/.ssh/authorized_keys \\\n+    && chmod 0600 /home/gpadmin/.ssh/authorized_keys \\\n+    && echo -e \"password\\npassword\" | passwd gpadmin 2> /dev/null \\\n+    && { ssh-keyscan localhost; ssh-keyscan 0.0.0.0; } >> /home/gpadmin/.ssh/known_hosts \\\n+    && chown -R gpadmin:gpadmin /home/gpadmin/.ssh \\\n+    # configure gpadmin limits\n+    && echo >> /etc/security/limits.d/gpadmin-limits.conf 'gpadmin soft core unlimited' \\\n+    && echo >> /etc/security/limits.d/gpadmin-limits.conf 'gpadmin soft nproc 131072' \\\n+    && echo >> /etc/security/limits.d/gpadmin-limits.conf 'gpadmin soft nofile 65536' \\\n+    # create .pxfrc\n+    && echo >> ~gpadmin/.pxfrc 'export LANG=en_US.UTF-8' \\\n+    && echo >> ~gpadmin/.pxfrc 'export PGPORT=5432' \\\n+    && echo >> ~gpadmin/.pxfrc 'export GOPATH=/opt/go' \\\n+    && echo >> ~gpadmin/.pxfrc 'export GPHOME=$(find /usr/local/ -name greenplum-db* -type d | head -n1)' \\\n+    && echo >> ~gpadmin/.pxfrc 'export LD_LIBRARY_PATH=${GPHOME}/lib:${LD_LIBRARY_PATH-}' \\\n+    && echo >> ~gpadmin/.pxfrc 'export GPHD_ROOT=/singlecluster' \\\n+    && echo >> ~gpadmin/.pxfrc 'export PXF_HOME=/usr/local/pxf-gp6' \\\n+    && echo >> ~gpadmin/.pxfrc 'export PXF_CONF=/home/gpadmin/pxf' \\\n+    && echo >> ~gpadmin/.pxfrc 'export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk' \\", "originalCommit": "df2ab7c97deb3f179e05bbd827380a4c4509210c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM5MTAyNw==", "url": "https://github.com/greenplum-db/pxf/pull/391#discussion_r444391027", "bodyText": "a Java 8 is installed in the base image, so it was not an issue", "author": "frankgh", "createdAt": "2020-06-23T17:30:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMxMTM1NA=="}], "type": "inlineReview"}, {"oid": "7a4ed5b6e4cd285b8c574da84bf6d485cfaaec34", "url": "https://github.com/greenplum-db/pxf/commit/7a4ed5b6e4cd285b8c574da84bf6d485cfaaec34", "message": "Address feedback", "committedDate": "2020-06-23T17:29:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIxNTczOA==", "url": "https://github.com/greenplum-db/pxf/pull/391#discussion_r445215738", "bodyText": "why is the base image gpdb-dev:latest ?", "author": "denalex", "createdAt": "2020-06-24T22:56:04Z", "path": "concourse/docker/pxf-dev-base/README.md", "diffHunk": "@@ -55,3 +55,16 @@ command to build the image:\n       -f ~/workspace/pxf/concourse/docker/pxf-dev-base/gpdb6/ubuntu18.04/Dockerfile \\\n       .\n     popd\n+\n+### Docker gpdb6-oel7-test-pxf-image image\n+\n+Build this image for Greenplum 6 running Oracle Enterprise Linux 7. Run the\n+following command to build the image:\n+\n+    pushd ~/workspace/pxf/concourse/docker/pxf-dev-base/\n+    docker build \\\n+      --build-arg=BASE_IMAGE=pivotaldata/gpdb-dev:latest \\", "originalCommit": "7a4ed5b6e4cd285b8c574da84bf6d485cfaaec34", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI3MzIyOA==", "url": "https://github.com/greenplum-db/pxf/pull/391#discussion_r445273228", "bodyText": "I need to fix it :)", "author": "frankgh", "createdAt": "2020-06-25T02:28:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIxNTczOA=="}], "type": "inlineReview"}, {"oid": "7b5126ba657bb5a24f4e9e89d41ad8db8311cc4e", "url": "https://github.com/greenplum-db/pxf/commit/7b5126ba657bb5a24f4e9e89d41ad8db8311cc4e", "message": "Address PR feedback", "committedDate": "2020-06-25T02:31:22Z", "type": "commit"}]}