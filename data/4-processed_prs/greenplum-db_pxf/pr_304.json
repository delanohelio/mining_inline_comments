{"pr_number": 304, "pr_title": "Harden PXF's Tomcat configuration", "pr_createdAt": "2020-02-21T19:27:58Z", "pr_url": "https://github.com/greenplum-db/pxf/pull/304", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3MTcwNw==", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r382771707", "bodyText": "this is good, but I think we should do it during Tomcat packaging into the build, it's a bit silly trying to remove something after we install it, and might be tricky for RPM install as well.", "author": "denalex", "createdAt": "2020-02-21T19:44:25Z", "path": "server/pxf-service/src/scripts/pxf-service", "diffHunk": "@@ -118,6 +118,20 @@ function fail()\n     exit 1\n }\n \n+#\n+# tomcatHardening removes tomcat example JSP and servlets,\n+# server banner, default index page\n+#\n+function tomcatHardening()\n+{\n+    # Remove default/unwanted Applications\n+    rm -rf \"$tomcat_root\"/webapps/ROOT\n+    rm -rf \"$tomcat_root\"/webapps/docs\n+    rm -rf \"$tomcat_root\"/webapps/examples\n+    rm -rf \"$tomcat_root\"/webapps/host-manager\n+    rm -rf \"$tomcat_root\"/webapps/manager\n+}\n+", "originalCommit": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3MzQzMw==", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r382773433", "bodyText": "why so restrictive ? even owner will not be able to list files in this directory", "author": "denalex", "createdAt": "2020-02-21T19:48:07Z", "path": "server/pxf-service/src/scripts/pxf-service", "diffHunk": "@@ -214,7 +228,8 @@ function createLogsDir()\n     if [[ ! -d $PXF_LOGDIR ]]; then\n         echo \"Creating PXF logs directory $PXF_LOGDIR ...\"\n         mkdir -p \"$PXF_LOGDIR\"\n-        chmod 700 \"$PXF_LOGDIR\"\n+        # only write/execute access\n+        chmod 300 \"$PXF_LOGDIR\"", "originalCommit": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc4MjAyNg==", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r382782026", "bodyText": "this is the recommended for log files, only write/execute access for the catalina user", "author": "frankgh", "createdAt": "2020-02-21T20:07:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3MzQzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzI1NzY5Mg==", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r383257692", "bodyText": "In my local environment, it has become annoying to tail the pxf logs. Even though 300 is recommended, maybe it's not practical?", "author": "frankgh", "createdAt": "2020-02-24T13:15:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3MzQzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzU1NjEyOA==", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r383556128", "bodyText": "How is it annoying, what's the workaround?", "author": "oliverralbertini", "createdAt": "2020-02-24T22:36:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3MzQzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg2ODU0Nw==", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r383868547", "bodyText": "sudo tail, but it's not practical, I agree. Maybe we should leave it at 700, but recommend 300 in the documentation?", "author": "frankgh", "createdAt": "2020-02-25T13:11:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3MzQzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg2OTUxNw==", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r383869517", "bodyText": "after the directory exists, pxf init will not do anything, so maybe it's okay to ship with 300 and let the users decide to change it to 700?", "author": "frankgh", "createdAt": "2020-02-25T13:13:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3MzQzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1NjM0NA==", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r384056344", "bodyText": "let's not over-restrict things -- they should be usable out-of-the-box and users still can harden it further if required.", "author": "denalex", "createdAt": "2020-02-25T18:49:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3MzQzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3NTQwNQ==", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r382775405", "bodyText": "web.xml also needs to be updated, it contains JSP servlet, welcome pages, etc", "author": "denalex", "createdAt": "2020-02-21T19:52:20Z", "path": "server/pxf-service/src/templates/tomcat/conf/server.xml", "diffHunk": "@@ -52,9 +52,13 @@ under the License.\n                        pattern=\"%h %l %u %t &quot;%r&quot; %s %b\"\n                        prefix=\"localhost_access_log.\"\n                        suffix=\".txt\"/>\n+                <Valve className=\"org.apache.catalina.valves.ErrorReportValve\"\n+                       showReport=\"true\"\n+                       showServerInfo=\"false\"/>\n             </Host>\n         </Engine>\n-        <Connector acceptCount=\"100\"\n+        <Connector server=\"PXF Server\"\n+                   acceptCount=\"100\"\n                    connectionTimeout=\"20000\"\n                    executor=\"tomcatThreadPool\"\n                    maxKeepAliveRequests=\"15\"", "originalCommit": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3NjA1MQ==", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r382776051", "bodyText": "we also do not use \"in-memory user database\" in lines 26-31", "author": "denalex", "createdAt": "2020-02-21T19:53:41Z", "path": "server/pxf-service/src/templates/tomcat/conf/server.xml", "diffHunk": "@@ -52,9 +52,13 @@ under the License.\n                        pattern=\"%h %l %u %t &quot;%r&quot; %s %b\"", "originalCommit": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3a70e2f13559d7d609eb4b5e7d7eba72da9cd395", "url": "https://github.com/greenplum-db/pxf/commit/3a70e2f13559d7d609eb4b5e7d7eba72da9cd395", "message": "Harden PXF's Tomcat configuration\n\n- Remove default applications during packaging\n- Remove Tomcat version information\n- Set logs folder to 300\n- Remove JSP servlet", "committedDate": "2020-02-24T13:17:57Z", "type": "forcePushed"}, {"oid": "c2f3c6bf56cf05332c2c6e98a41471401e483a6f", "url": "https://github.com/greenplum-db/pxf/commit/c2f3c6bf56cf05332c2c6e98a41471401e483a6f", "message": "Harden PXF's Tomcat configuration\n\n- Remove default applications during packaging\n- Remove Tomcat version information\n- Set logs folder to 300\n- Remove JSP servlet\n- Remove in-memory user database", "committedDate": "2020-02-24T13:20:10Z", "type": "forcePushed"}, {"oid": "1d76985218ad756aa001829cb0a64de86e721e03", "url": "https://github.com/greenplum-db/pxf/commit/1d76985218ad756aa001829cb0a64de86e721e03", "message": "Harden PXF's Tomcat configuration\n\n- Remove default applications during packaging\n- Remove Tomcat version information\n- Set logs folder to 300\n- Remove JSP servlet\n- Remove in-memory user database", "committedDate": "2020-02-24T15:30:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzU1NzA3MA==", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r383557070", "bodyText": "what does adding server field do for security?", "author": "oliverralbertini", "createdAt": "2020-02-24T22:39:05Z", "path": "server/pxf-service/src/templates/tomcat/conf/server.xml", "diffHunk": "@@ -52,9 +40,13 @@ under the License.\n                        pattern=\"%h %l %u %t &quot;%r&quot; %s %b\"\n                        prefix=\"localhost_access_log.\"\n                        suffix=\".txt\"/>\n+                <Valve className=\"org.apache.catalina.valves.ErrorReportValve\"\n+                       showReport=\"true\"\n+                       showServerInfo=\"false\"/>\n             </Host>\n         </Engine>\n-        <Connector acceptCount=\"100\"\n+        <Connector server=\"PXF Server\"", "originalCommit": "1d76985218ad756aa001829cb0a64de86e721e03", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg3MDc2MA==", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r383870760", "bodyText": "It displays PXF Server for the server value in the response headers\n\u00b1  |harden-tomcat \u2192 origin {34} U:1 ?:20 \u2717| \u2192 curl -i http://localhost:5888/pxf/v0\nHTTP/1.1 500 Internal Server Error\nContent-Type: text/plain\nTransfer-Encoding: chunked\nDate: Tue, 25 Feb 2020 13:15:23 GMT\nConnection: close\nServer: PXF Server", "author": "frankgh", "createdAt": "2020-02-25T13:16:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzU1NzA3MA=="}], "type": "inlineReview"}, {"oid": "612bcad0f9e90af1867ae422c05729621e6d2cc1", "url": "https://github.com/greenplum-db/pxf/commit/612bcad0f9e90af1867ae422c05729621e6d2cc1", "message": "Harden PXF's Tomcat configuration\n\n- Remove default applications during packaging\n- Remove Tomcat version information\n- Remove JSP servlet\n- Remove in-memory user database", "committedDate": "2020-02-25T18:57:17Z", "type": "commit"}, {"oid": "612bcad0f9e90af1867ae422c05729621e6d2cc1", "url": "https://github.com/greenplum-db/pxf/commit/612bcad0f9e90af1867ae422c05729621e6d2cc1", "message": "Harden PXF's Tomcat configuration\n\n- Remove default applications during packaging\n- Remove Tomcat version information\n- Remove JSP servlet\n- Remove in-memory user database", "committedDate": "2020-02-25T18:57:17Z", "type": "forcePushed"}]}