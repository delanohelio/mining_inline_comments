{"pr_number": 431, "pr_title": "Add Make target for setting a dev version of the full build pipeline", "pr_createdAt": "2020-08-27T21:23:19Z", "pr_url": "https://github.com/greenplum-db/pxf/pull/431", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcyNjc3NQ==", "url": "https://github.com/greenplum-db/pxf/pull/431#discussion_r478726775", "bodyText": "I guess we have a concourse/settings that is kind of equivalent to vars. Should we consolidate?", "author": "frankgh", "createdAt": "2020-08-27T22:18:37Z", "path": "concourse/vars/build.dev.yml", "diffHunk": "@@ -0,0 +1,5 @@\n+pxf-git-remote-ssh-url: git@github.com:pivotal/gp-pxf-dev.git", "originalCommit": "0da70606d0189653fc023955d57504eaea4070a8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc1MDE5MA==", "url": "https://github.com/greenplum-db/pxf/pull/431#discussion_r478750190", "bodyText": "probably. We have things scattered around pxf-secrets and settings. I'd like to understand what belongs where -- anything non-credential goes to settings ? In that case we might need to do some migration.", "author": "denalex", "createdAt": "2020-08-27T23:29:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcyNjc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc1MDI5Ng==", "url": "https://github.com/greenplum-db/pxf/pull/431#discussion_r478750296", "bodyText": "I think consolidation is a great idea. I'll move this file to concourse/settings/build.dev.yml", "author": "bradfordb-vmware", "createdAt": "2020-08-27T23:30:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcyNjc3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcyNzExNQ==", "url": "https://github.com/greenplum-db/pxf/pull/431#discussion_r478727115", "bodyText": "what's the difference between [ and (?", "author": "frankgh", "createdAt": "2020-08-27T22:19:32Z", "path": "concourse/pipelines/templates/build_pipeline-tpl.yml", "diffHunk": "@@ -1565,10 +1568,10 @@ jobs:\n     image: google-cloud-sdk-slim-image\n     file: pxf_src/concourse/tasks/get_pxf_release_artifacts.yml\n     params:\n-      GCS_ODP_PATH: prod/ODP\n-      GCS_OSL_PATH: prod/OSL\n+      GCS_ODP_PATH: [[pxf_releases_bucket_prefix]]/ODP", "originalCommit": "0da70606d0189653fc023955d57504eaea4070a8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc0ODc5NA==", "url": "https://github.com/greenplum-db/pxf/pull/431#discussion_r478748794", "bodyText": "[ are template generation variables, it will generate yams files with resolved variables. We usually use that for control (send slack or not) and gp_ver. Should these buckets be driven by values of the secrets rather than template substitutions ?", "author": "denalex", "createdAt": "2020-08-27T23:24:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcyNzExNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc1MDg5Mw==", "url": "https://github.com/greenplum-db/pxf/pull/431#discussion_r478750893", "bodyText": "We can change this to ((pxf-release-bucket-prefix)) and add them to concourse/settings/build.{dev,prod}.yml. Since these aren't credentials, I like to keep the settings close to the pipeline.", "author": "bradfordb-vmware", "createdAt": "2020-08-27T23:31:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcyNzExNQ=="}], "type": "inlineReview"}, {"oid": "10f2f82a65a70695f9d844529c05f12060bdf855", "url": "https://github.com/greenplum-db/pxf/commit/10f2f82a65a70695f9d844529c05f12060bdf855", "message": "Add target for dev version of build and release pipeline\n\nCo-authored-by: Ashuka Xue <axue@vmware.com>\nCo-authored-by: Bradford D. Boyle <bradfordb@vmware.com>", "committedDate": "2020-08-28T22:58:10Z", "type": "forcePushed"}, {"oid": "a55d02f97a5a9950b0372772c901e9c5cdca304f", "url": "https://github.com/greenplum-db/pxf/commit/a55d02f97a5a9950b0372772c901e9c5cdca304f", "message": "Add target for dev version of build and release pipeline\n\nCo-authored-by: Ashuka Xue <axue@vmware.com>\nCo-authored-by: Bradford D. Boyle <bradfordb@vmware.com>", "committedDate": "2020-08-31T18:40:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQ0MDg2Ng==", "url": "https://github.com/greenplum-db/pxf/pull/431#discussion_r481440866", "bodyText": "I thought at some point we talked about copying all secrets, even common GP CI ones into PXF secrets file. Not sure if this is still desired", "author": "denalex", "createdAt": "2020-09-01T21:25:30Z", "path": "concourse/Makefile", "diffHunk": "@@ -46,28 +48,61 @@ set-build-pipeline:\n \t@PIPELINE_FILE=$$(mktemp) && \\\n \t$(TEMPLATE_CMD) --template build_pipeline-tpl.yml --vars \\\n \t\tbuild_deb=$(BUILD_DEB) \\\n+\t\temail_notification=$(EMAIL) \\\n \t\tslack_notification=$(SLACK) \\\n \t\tgit_branch=$(BRANCH) \\\n \t\tnum_gpdb5_versions=$(NUM_GPDB5_VERSIONS) \\\n-\t\tnum_gpdb6_versions=$(NUM_GPDB6_VERSIONS) >\"$${PIPELINE_FILE}\" && \\\n+\t\tnum_gpdb6_versions=$(NUM_GPDB6_VERSIONS) \\\n+\t\tpxf_build_bucket_prefix=prod \\\n+\t\tpxf_releases_bucket_prefix=prod >\"$${PIPELINE_FILE}\" && \\\n \t$(FLY_CMD) --target=$(CONCOURSE) \\\n \t\tset-pipeline \\\n \t\t--check-creds \\\n \t\t--pipeline=$(BUILD_PIPELINE_NAME) \\\n \t\t--config \"$${PIPELINE_FILE}\" \\\n-\t\t--load-vars-from=$(SECRETS_FILE) \\\n-\t\t--load-vars-from=$(HOME)/workspace/gp-continuous-integration/secrets/gpdb_common-ci-secrets.yml \\\n+\t\t--load-vars-from=$(SECRETS_HOME)/pxf-secrets.yml \\\n+\t\t--load-vars-from=$(SECRETS_HOME)/gpdb_common-ci-secrets.yml \\\n \t\t--load-vars-from=$(HOME)/workspace/pxf/concourse/settings/pxf-multinode-params.yml \\\n-\t\t--load-vars-from=$(HOME)/workspace/gp-continuous-integration/secrets/ccp_ci_secrets_ud.yml \\\n-\t\t--load-vars-from=$(HOME)/workspace/gp-continuous-integration/secrets/ccp_ci_secrets_ud_kerberos.yml \\\n+\t\t--load-vars-from=$(SECRETS_HOME)/ccp_ci_secrets_ud.yml \\\n+\t\t--load-vars-from=$(SECRETS_HOME)/ccp_ci_secrets_ud_kerberos.yml \\", "originalCommit": "a55d02f97a5a9950b0372772c901e9c5cdca304f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQ2MDA5OQ==", "url": "https://github.com/greenplum-db/pxf/pull/431#discussion_r481460099", "bodyText": "w/ @ashuka24: We've consolidated the separate CCP credential files into the single pxf-secrets.yml and have updated the make commands.", "author": "bradfordb-vmware", "createdAt": "2020-09-01T22:10:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQ0MDg2Ng=="}], "type": "inlineReview"}, {"oid": "80cdf41411a19bc8bd6c4b37c3acc74b9ff4c1ee", "url": "https://github.com/greenplum-db/pxf/commit/80cdf41411a19bc8bd6c4b37c3acc74b9ff4c1ee", "message": "Remove separate CCP vars files from set-pipeline commands\n\nCo-authored-by: Ashuka Xue <axue@vmware.com>\nCo-authored-by: Bradford D. Boyle <bradfordb@vmware.com>", "committedDate": "2020-09-01T22:20:39Z", "type": "forcePushed"}, {"oid": "0956f054e370b7d17932d6e24b905705cd7ac9db", "url": "https://github.com/greenplum-db/pxf/commit/0956f054e370b7d17932d6e24b905705cd7ac9db", "message": "Add target for dev version of build and release pipeline\n\nCo-authored-by: Ashuka Xue <axue@vmware.com>\nCo-authored-by: Bradford D. Boyle <bradfordb@vmware.com>", "committedDate": "2020-09-01T23:56:16Z", "type": "forcePushed"}, {"oid": "92f49c0d1b23cfbdade87561265088976256f354", "url": "https://github.com/greenplum-db/pxf/commit/92f49c0d1b23cfbdade87561265088976256f354", "message": "Add target for dev version of build and release pipeline\n\nThe `send-an-email` step and its associated resources are wrapped in a\ntemplate guard `email_notification`. The default when setting the build\npipeline is to include the email notification. It can be omitted by\nsetting `EMAIL=false` when running make.\n\nCo-authored-by: Ashuka Xue <axue@vmware.com>\nCo-authored-by: Bradford D. Boyle <bradfordb@vmware.com>", "committedDate": "2020-09-02T00:04:59Z", "type": "forcePushed"}, {"oid": "85fe56fc4bb441d3af3d969de9d2728976168f09", "url": "https://github.com/greenplum-db/pxf/commit/85fe56fc4bb441d3af3d969de9d2728976168f09", "message": "Add target for dev version of build and release pipeline\n\nThe `send-an-email` step and its associated resources are wrapped in a\ntemplate guard `email_notification`. The default when setting the build\npipeline is to include the email notification. It can be omitted by\nsetting `EMAIL=false` when running make.\n\nCo-authored-by: Ashuka Xue <axue@vmware.com>\nCo-authored-by: Bradford D. Boyle <bradfordb@vmware.com>", "committedDate": "2020-09-02T00:10:48Z", "type": "forcePushed"}, {"oid": "988fce9fd440dc90f79b44b565fe6068ee63d96c", "url": "https://github.com/greenplum-db/pxf/commit/988fce9fd440dc90f79b44b565fe6068ee63d96c", "message": "Templatize bucket locations in pxf-build pipeline\n\nThis commit also removes separate CCP vars files from set-pipeline\ncommands and unused variable from set-pipeline for build and dev-build\n\nCo-authored-by: Ashuka Xue <axue@vmware.com>\nCo-authored-by: Bradford D. Boyle <bradfordb@vmware.com>", "committedDate": "2020-09-02T00:25:09Z", "type": "commit"}, {"oid": "a840709a616328e6e602c0c0a43c1113374565b8", "url": "https://github.com/greenplum-db/pxf/commit/a840709a616328e6e602c0c0a43c1113374565b8", "message": "Add target for dev version of build and release pipeline\n\nThe `send-an-email` step and its associated resources are wrapped in a\ntemplate guard `email_notification`. The default when setting the build\npipeline is to include the email notification. It can be omitted by\nsetting `EMAIL=false` when running make.\n\nCo-authored-by: Ashuka Xue <axue@vmware.com>\nCo-authored-by: Bradford D. Boyle <bradfordb@vmware.com>", "committedDate": "2020-09-02T00:25:09Z", "type": "commit"}, {"oid": "a840709a616328e6e602c0c0a43c1113374565b8", "url": "https://github.com/greenplum-db/pxf/commit/a840709a616328e6e602c0c0a43c1113374565b8", "message": "Add target for dev version of build and release pipeline\n\nThe `send-an-email` step and its associated resources are wrapped in a\ntemplate guard `email_notification`. The default when setting the build\npipeline is to include the email notification. It can be omitted by\nsetting `EMAIL=false` when running make.\n\nCo-authored-by: Ashuka Xue <axue@vmware.com>\nCo-authored-by: Bradford D. Boyle <bradfordb@vmware.com>", "committedDate": "2020-09-02T00:25:09Z", "type": "forcePushed"}]}