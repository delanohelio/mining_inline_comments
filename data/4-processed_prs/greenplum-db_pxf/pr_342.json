{"pr_number": 342, "pr_title": "changed Makefiles to build tarball with all components", "pr_createdAt": "2020-04-21T08:06:13Z", "pr_url": "https://github.com/greenplum-db/pxf/pull/342", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA4NDYyMg==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r412084622", "bodyText": "should we just fail here instead? or maybe fail if the path does   not exist?", "author": "frankgh", "createdAt": "2020-04-21T10:58:56Z", "path": "Makefile", "diffHunk": "@@ -1,18 +1,27 @@\n+ifeq \"$(GPHOME)\" \"\"\n+    GPHOME = \"/usr/local/greenplum-db\"", "originalCommit": "702cb878e3c394f2fb512d836ca6cac679d4e8be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA5NzE4OQ==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r412097189", "bodyText": "Should we take this opportunity to bump the version of our PXF server to 5.12.0-SNAPSHOT here https://github.com/greenplum-db/pxf/blob/master/server/gradle.properties? Maybe it's an opportunity to start using snapshots moving forward. This might break CI code that assumes the version number is major, minor, rev", "author": "frankgh", "createdAt": "2020-04-21T11:20:03Z", "path": "Makefile", "diffHunk": "@@ -1,18 +1,27 @@\n+ifeq \"$(GPHOME)\" \"\"\n+    GPHOME = \"/usr/local/greenplum-db\"\n+endif\n+\n ifeq \"$(PXF_HOME)\" \"\"\n-    ifneq \"$(GPHOME)\" \"\"\n-        PXF_HOME = \"$(GPHOME)/pxf\"\n-    endif\n+    PXF_HOME = \"$(GPHOME)/pxf\"\n endif\n \n SHELL := /bin/bash\n \n+export GPHOME\n export PXF_HOME\n \n+PXF_VERSION := $(shell grep version= server/gradle.properties | cut -d= -f2)", "originalCommit": "702cb878e3c394f2fb512d836ca6cac679d4e8be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM2MDc1MQ==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r412360751", "bodyText": "I agree, this might be the right time to start versioning all our tarballs on commit, and reserve the non SHA versions for releases.", "author": "oliverralbertini", "createdAt": "2020-04-21T17:42:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA5NzE4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM2MTEzMA==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r412361130", "bodyText": "perhaps we can have some logic to check if we are on a git tag, otherwise we tack on a SHA", "author": "oliverralbertini", "createdAt": "2020-04-21T17:43:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA5NzE4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA5ODY5MQ==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r412098691", "bodyText": "minor: this does not necessarily have to be an old version of PXF\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                echo \"Removing old PXF ...\"\n          \n          \n            \n                echo \"Removing existing PXF ...\"", "author": "frankgh", "createdAt": "2020-04-21T11:22:27Z", "path": "package/install_component", "diffHunk": "@@ -0,0 +1,43 @@\n+#!/usr/bin/env bash\n+\n+CWDIR=$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" && pwd )\n+PXF_VERSION=$(<\"${CWDIR}/pxf/version\")\n+\n+function check_gphome() {\n+    if [[ -z \"${GPHOME}\" ]]; then\n+        echo \"Error: environment variable GPHOME is not set\"\n+        exit 1\n+    fi\n+\n+    if [[ ! -f ${GPHOME}/greenplum_path.sh ]]; then\n+        echo \"Error: environment variable GPHOME must be set to a valid Greenplum installation\"\n+        exit 1\n+    fi\n+}\n+\n+function remove_old_component() {\n+    echo \"Removing old PXF ...\"", "originalCommit": "702cb878e3c394f2fb512d836ca6cac679d4e8be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM3NTI1Mg==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r412375252", "bodyText": "thanks, will update, but this generally would require way more logic to check for existing PXF install, make sure it is stopped / killed, and removing bits, which will be a separate story.", "author": "denalex", "createdAt": "2020-04-21T18:02:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA5ODY5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA5ODkxOA==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r412098918", "bodyText": "minor:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                echo \"Installing new PXF version ${PXF_VERSION} ...\"\n          \n          \n            \n                echo \"Installing PXF version ${PXF_VERSION} ...\"", "author": "frankgh", "createdAt": "2020-04-21T11:22:53Z", "path": "package/install_component", "diffHunk": "@@ -0,0 +1,43 @@\n+#!/usr/bin/env bash\n+\n+CWDIR=$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" && pwd )\n+PXF_VERSION=$(<\"${CWDIR}/pxf/version\")\n+\n+function check_gphome() {\n+    if [[ -z \"${GPHOME}\" ]]; then\n+        echo \"Error: environment variable GPHOME is not set\"\n+        exit 1\n+    fi\n+\n+    if [[ ! -f ${GPHOME}/greenplum_path.sh ]]; then\n+        echo \"Error: environment variable GPHOME must be set to a valid Greenplum installation\"\n+        exit 1\n+    fi\n+}\n+\n+function remove_old_component() {\n+    echo \"Removing old PXF ...\"\n+\n+}\n+\n+function install_new_component() {\n+    echo \"Installing new PXF version ${PXF_VERSION} ...\"", "originalCommit": "702cb878e3c394f2fb512d836ca6cac679d4e8be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjEwMzA0Nw==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r412103047", "bodyText": "I think we should allow a $PXF_HOME environment variable to be defined, and if not. defined then PXF_HOME=GPHOME/pxf. We install the PXF Server + CLI components in PXF_HOME, and the extension inside GPHOME", "author": "frankgh", "createdAt": "2020-04-21T11:29:35Z", "path": "package/install_component", "diffHunk": "@@ -0,0 +1,43 @@\n+#!/usr/bin/env bash\n+\n+CWDIR=$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" && pwd )\n+PXF_VERSION=$(<\"${CWDIR}/pxf/version\")\n+\n+function check_gphome() {\n+    if [[ -z \"${GPHOME}\" ]]; then", "originalCommit": "702cb878e3c394f2fb512d836ca6cac679d4e8be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fdabc603c0f4d8a25246f6b5234f3268b7b85f99", "url": "https://github.com/greenplum-db/pxf/commit/fdabc603c0f4d8a25246f6b5234f3268b7b85f99", "message": "manage version at the top level", "committedDate": "2020-04-22T02:23:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg3MzA5OQ==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r412873099", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    echo \"Removing existing PXF ${OLD_PXF_VERSION}from ${PXF_HOME} ...\"\n          \n          \n            \n                    echo \"Removing existing PXF ${OLD_PXF_VERSION} from ${PXF_HOME} ...\"", "author": "frankgh", "createdAt": "2020-04-22T10:43:42Z", "path": "package/install_component", "diffHunk": "@@ -0,0 +1,84 @@\n+#!/usr/bin/env bash\n+\n+CWDIR=$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" && pwd )\n+PXF_VERSION=$(<\"${CWDIR}/pxf/version\")\n+\n+function show_help() {\n+    echo \"This script installs PXF Greenplum Extension and PXF Server\"\n+    echo \"to install the PXF Extension :\"\n+    echo \"  set GPHOME environment variable to the installation directory of Greenplum Database\"\n+    echo \"to install the PXF Server :\"\n+    echo \"  either set PXF_HOME environment variable to the target PXF Server installation directory\"\n+    echo \"  or     set GPHOME   environment variable to have PXF Server installed into \\${GPHOME}/pxf\"\n+    echo \"current values:\"\n+    echo \"  GPHOME   = ${GPHOME:-<unset>}\"\n+    echo \"  PXF_HOME = ${PXF_HOME:-<unset>}\"\n+}\n+\n+function check_status() {\n+    if [ $1 -ne 0 ]; then\n+        echo \"Error: Installation failed\"\n+        exit $1\n+    fi\n+}\n+\n+function check_gphome() {\n+    if [[ -z \"${GPHOME}\" ]]; then\n+        if [[ -z \"${PXF_HOME}\" ]]; then\n+            echo \"Error: environment variables GPHOME and PXF_HOME are not set\"\n+            exit 1\n+        fi\n+    else\n+        if [[ ! -f ${GPHOME}/greenplum_path.sh ]]; then\n+            echo \"Error: environment variable GPHOME must be set to a valid Greenplum installation\"\n+            exit 1\n+        fi\n+        if [[ -z \"${PXF_HOME}\" ]]; then\n+            PXF_HOME=\"${GPHOME}/pxf\"\n+        fi\n+    fi\n+}\n+\n+function remove_old_component() {\n+    if [[ ! -z \"${PXF_HOME}\" && -d ${PXF_HOME} ]]; then\n+        if [[ -f ${PXF_HOME}/version ]]; then\n+            OLD_PXF_VERSION=\"version $(<\"${PXF_HOME}/version\") \"\n+        fi\n+\n+        echo \"Removing existing PXF ${OLD_PXF_VERSION}from ${PXF_HOME} ...\"", "originalCommit": "3bca5d269e5bdd37d8af26ce13e84f06394bd75c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fa1c05e36dd253a73dca2c7dba25bd9f0817d430", "url": "https://github.com/greenplum-db/pxf/commit/fa1c05e36dd253a73dca2c7dba25bd9f0817d430", "message": "changed Makefiles to build tarball with all components", "committedDate": "2020-04-29T17:25:32Z", "type": "commit"}, {"oid": "8da0ec5078ba46a780880674ea0b8861e4a833b9", "url": "https://github.com/greenplum-db/pxf/commit/8da0ec5078ba46a780880674ea0b8861e4a833b9", "message": "manage version at the top level", "committedDate": "2020-04-29T17:25:32Z", "type": "commit"}, {"oid": "3884ed78bcd2f3fdda790d69d34032db6ca57945", "url": "https://github.com/greenplum-db/pxf/commit/3884ed78bcd2f3fdda790d69d34032db6ca57945", "message": "update build pipeline", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "2b29a6f5fea0b383a88cba10676096b713fe6c25", "url": "https://github.com/greenplum-db/pxf/commit/2b29a6f5fea0b383a88cba10676096b713fe6c25", "message": "debug echo dep binary", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "e28463bd04c13007bf7ee0130be89101d58e7997", "url": "https://github.com/greenplum-db/pxf/commit/e28463bd04c13007bf7ee0130be89101d58e7997", "message": "use login shell to run build", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "faf576c79f380cd688007a8f081f05689ccbc7db", "url": "https://github.com/greenplum-db/pxf/commit/faf576c79f380cd688007a8f081f05689ccbc7db", "message": "remove login shell, source /etc/bashrc directly", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "10cc385c051b517c671869731504fe4cdb8b69d5", "url": "https://github.com/greenplum-db/pxf/commit/10cc385c051b517c671869731504fe4cdb8b69d5", "message": "fixed quotes", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "7edd6777860284fb256d52a8d2893458e3808545", "url": "https://github.com/greenplum-db/pxf/commit/7edd6777860284fb256d52a8d2893458e3808545", "message": "introduced test job", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "95b893e00772760f13b85ea35d12393eb5043dc2", "url": "https://github.com/greenplum-db/pxf/commit/95b893e00772760f13b85ea35d12393eb5043dc2", "message": "update pipeline", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "2c519069db47b6b01d832c8422b4ed190a819866", "url": "https://github.com/greenplum-db/pxf/commit/2c519069db47b6b01d832c8422b4ed190a819866", "message": "using versioned_file resource", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "92d0701be8eb4329ae64eafd19f2071d46e6d356", "url": "https://github.com/greenplum-db/pxf/commit/92d0701be8eb4329ae64eafd19f2071d46e6d356", "message": "temporarily bump version", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "02c8bbca8d32be1775f33839ba9d95b81e47520b", "url": "https://github.com/greenplum-db/pxf/commit/02c8bbca8d32be1775f33839ba9d95b81e47520b", "message": "reverted version, removed version from file name in CI", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "a5ffbb3810e0b5299b8b4a6914e72e7bb97fdc3a", "url": "https://github.com/greenplum-db/pxf/commit/a5ffbb3810e0b5299b8b4a6914e72e7bb97fdc3a", "message": "call initialize_gpdb.bash", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "d2dfedbc523dab58cdbb6fd91142ac290db2dbca", "url": "https://github.com/greenplum-db/pxf/commit/d2dfedbc523dab58cdbb6fd91142ac290db2dbca", "message": "added test jobs, updated script variable name", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "71aad7b4103b13693ac462f4074e3df827d669be", "url": "https://github.com/greenplum-db/pxf/commit/71aad7b4103b13693ac462f4074e3df827d669be", "message": "fixed port, added sleep on gpdb startup", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "bc56a5f91808851993cd2f49b340944d4f689e16", "url": "https://github.com/greenplum-db/pxf/commit/bc56a5f91808851993cd2f49b340944d4f689e16", "message": "conditional use of gpdemo-env.sh", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "10c8d57a11573511f220118ba31dc697b7001318", "url": "https://github.com/greenplum-db/pxf/commit/10c8d57a11573511f220118ba31dc697b7001318", "message": "export MASTER_DATA_DIRECTORY", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "ff6e542b7a95717c81ae65e18ea032eebc205e8a", "url": "https://github.com/greenplum-db/pxf/commit/ff6e542b7a95717c81ae65e18ea032eebc205e8a", "message": "update MASTER_DATA_DIRECTORY", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "23d9fbd8129915d6cee23e334c9c3225104bfc73", "url": "https://github.com/greenplum-db/pxf/commit/23d9fbd8129915d6cee23e334c9c3225104bfc73", "message": "relax version requirement", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "82ba39f05caf955306b5848245657c6bd52e11bc", "url": "https://github.com/greenplum-db/pxf/commit/82ba39f05caf955306b5848245657c6bd52e11bc", "message": "relax version requirement in pxf init script", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "49f5706cb31f44f1b1daddc0dc0230b87b26f3cb", "url": "https://github.com/greenplum-db/pxf/commit/49f5706cb31f44f1b1daddc0dc0230b87b26f3cb", "message": "specify explicit goal when calling make", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "72e25781860b6b89656c43578fd38d37a52ac3bf", "url": "https://github.com/greenplum-db/pxf/commit/72e25781860b6b89656c43578fd38d37a52ac3bf", "message": "update regex", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "620c5609a6f9c2b48786e2e3a715d91ccf1ec50b", "url": "https://github.com/greenplum-db/pxf/commit/620c5609a6f9c2b48786e2e3a715d91ccf1ec50b", "message": "update Ubuntu install command", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "1185294ef6c2bd5e0f91ac3df84eca3d0c49748f", "url": "https://github.com/greenplum-db/pxf/commit/1185294ef6c2bd5e0f91ac3df84eca3d0c49748f", "message": "remove extra GPHOME manipulation for Ubuntu", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "1434c5847faf10f7f4a180c9fe40b14feb531606", "url": "https://github.com/greenplum-db/pxf/commit/1434c5847faf10f7f4a180c9fe40b14feb531606", "message": "added more jobs to the pipeline", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "bacdcac8a99f4cf6c491ac73af571c2dd2d4feb4", "url": "https://github.com/greenplum-db/pxf/commit/bacdcac8a99f4cf6c491ac73af571c2dd2d4feb4", "message": "added multi-node job", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "c3563960dd2fff71fe6b2a53d38e3a1e45c83ed6", "url": "https://github.com/greenplum-db/pxf/commit/c3563960dd2fff71fe6b2a53d38e3a1e45c83ed6", "message": "make install_hadoop handle component-based install", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "98f32dff38fb45d39c2df93ae4e65e3739b1d880", "url": "https://github.com/greenplum-db/pxf/commit/98f32dff38fb45d39c2df93ae4e65e3739b1d880", "message": "remove typo", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "2231ab5a1687eb31c5a85ab3c3236eee1a53870e", "url": "https://github.com/greenplum-db/pxf/commit/2231ab5a1687eb31c5a85ab3c3236eee1a53870e", "message": "removed .bash extension", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "343a88bdbe42f43bffefa898ea60e8ccf9443858", "url": "https://github.com/greenplum-db/pxf/commit/343a88bdbe42f43bffefa898ea60e8ccf9443858", "message": "install PXF as a superuser", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "66b4ab0ac1400664437abc457af3ac62fdfb1f08", "url": "https://github.com/greenplum-db/pxf/commit/66b4ab0ac1400664437abc457af3ac62fdfb1f08", "message": "break command into 3 lines", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "0fdc1a3fcfed2a080412a10b1ca27292530d261d", "url": "https://github.com/greenplum-db/pxf/commit/0fdc1a3fcfed2a080412a10b1ca27292530d261d", "message": "removed sourcing the script", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "981fcd767fc291df57903f26b2afc69fca3acef1", "url": "https://github.com/greenplum-db/pxf/commit/981fcd767fc291df57903f26b2afc69fca3acef1", "message": "export GPHOME from multinode test script", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "6e14e8afc3b4f834c6eef7c03b27f4c5d355e4c0", "url": "https://github.com/greenplum-db/pxf/commit/6e14e8afc3b4f834c6eef7c03b27f4c5d355e4c0", "message": "adjust GPHOME in SUT files", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "1241f298cae629f3fdd0d014e294a4d4eef33542", "url": "https://github.com/greenplum-db/pxf/commit/1241f298cae629f3fdd0d014e294a4d4eef33542", "message": "added jobs, HDFS verify delay 3 secs", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "250430d77f6b667fae07cf451cb1a2999b333fbc", "url": "https://github.com/greenplum-db/pxf/commit/250430d77f6b667fae07cf451cb1a2999b333fbc", "message": "check file during test verification, added jobs", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "ea8273d0022045413e2294095116d4d32b3e4deb", "url": "https://github.com/greenplum-db/pxf/commit/ea8273d0022045413e2294095116d4d32b3e4deb", "message": "changed handling of impersonation in multi-node script", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "9847fb0da1237d83cb9d8c4abfddee06e344bc7c", "url": "https://github.com/greenplum-db/pxf/commit/9847fb0da1237d83cb9d8c4abfddee06e344bc7c", "message": "bump wait time, harden writable tests", "committedDate": "2020-04-29T17:30:28Z", "type": "commit"}, {"oid": "9847fb0da1237d83cb9d8c4abfddee06e344bc7c", "url": "https://github.com/greenplum-db/pxf/commit/9847fb0da1237d83cb9d8c4abfddee06e344bc7c", "message": "bump wait time, harden writable tests", "committedDate": "2020-04-29T17:30:28Z", "type": "forcePushed"}, {"oid": "f87aedc213114317905f6f1ec9396d8da37377ef", "url": "https://github.com/greenplum-db/pxf/commit/f87aedc213114317905f6f1ec9396d8da37377ef", "message": "hardened Parquet test", "committedDate": "2020-04-29T17:49:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ5NTExMA==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r417495110", "bodyText": "We should take the opportunity to switch to $() notation rather than ``.", "author": "oliverralbertini", "createdAt": "2020-04-29T17:41:16Z", "path": "automation/Makefile", "diffHunk": "@@ -91,7 +91,7 @@ symlink_pxf_jars:\n \t\tmkdir -p $(PXF_HOME)/tmp && \\\n \t\tcd $(PXF_HOME)/tmp && \\\n \t\tfor X in $(PXF_HOME)/lib/pxf-*-[0-9]*.jar; do \\\n-\t\t\tln -sf $$X `echo \\`basename $$X\\` | sed -e 's/-[a-zA-Z0-9.]*.jar/.jar/'`; \\\n+\t\t\tln -sf $$X `echo \\`basename $$X\\` | sed -E -e 's/-[0-9]+[a-zA-Z0-9\\.-]*.jar/.jar/'`; \\", "originalCommit": "9847fb0da1237d83cb9d8c4abfddee06e344bc7c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ5NzMyMQ==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r417497321", "bodyText": "is $PXF_ROOT_DIR/version a script? I think you are missing a cat or <:\nPXF_VERSION ?= $(shell < $(PXF_ROOT_DIR)/version)", "author": "oliverralbertini", "createdAt": "2020-04-29T17:44:48Z", "path": "cli/go/src/pxf-cli/Makefile", "diffHunk": "@@ -1,28 +1,30 @@\n-.PHONY: all depend build tar install test clean help\n+include ../../../../common.mk\n+\n+.PHONY: all depend build stage install test clean help\n .DEFAULT_GOAL := build\n \n TARGET := $(shell echo $${PWD\\#\\#*/})\n PXF_ROOT_DIR := $(shell cd ../../../.. && pwd)\n-GO_DEP_CACHE := ${PXF_ROOT_DIR}/cli/go/pkg/dep\n PXF_SERVER_DIR := ${PXF_ROOT_DIR}/server\n-PXF_STAGING_DIR := ${PXF_SERVER_DIR}/build/stage/bin\n-PXF_SERVICE_SCRIPTS := ${PXF_SERVER_DIR}/pxf-service/src/scripts\n-PXF_VERSION := $(shell grep version= ${PXF_SERVER_DIR}/gradle.properties | cut -d= -f2)\n+PXF_CLI_DIR := ${PXF_ROOT_DIR}/cli\n+PXF_VERSION ?= $(shell $(PXF_ROOT_DIR)/version)", "originalCommit": "9847fb0da1237d83cb9d8c4abfddee06e344bc7c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ5NzgyMA==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r417497820", "bodyText": "maybe the PXF_VERSION should also be set in common.mk", "author": "oliverralbertini", "createdAt": "2020-04-29T17:45:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ5NzMyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUyMzI1Mg==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r417523252", "bodyText": "good point on missing cat, wonder how it works now then ? Including in common.mk will be a problem, though, as the path to version file is different from different Makefiles (go Makefile is buried too deep from the top)", "author": "denalex", "createdAt": "2020-04-29T18:27:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ5NzMyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYxNTY2NQ==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r417615665", "bodyText": "I think it's grabbing the version from somewhere else (I notice the ?= assignment which allows previous values to live on).", "author": "oliverralbertini", "createdAt": "2020-04-29T21:13:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ5NzMyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ5OTg2MQ==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r417499861", "bodyText": "can't this be done with make now?", "author": "oliverralbertini", "createdAt": "2020-04-29T17:48:49Z", "path": "concourse/scripts/build.bash", "diffHunk": "@@ -26,39 +23,17 @@ function install_gpdb() {\n function compile_pxf_protocol_extension() {\n     source \"${GPHOME}/greenplum_path.sh\"\n     if [[ ${TARGET_OS} == \"rhel6\" ]]; then\n-\t    source /opt/gcc_env.sh\n+        source /opt/gcc_env.sh\n     fi\n-\n-    USE_PGXS=1 make -C \"pxf-protocol-extension_src\"\n+    source /etc/bashrc\n+    make -C \"${PWD}/pxf_src\" tar\n }\n \n function package_pxf_protocol_extension() {\n-\n-    # store latest commit SHA\n-    pushd pxf-protocol-extension_src > /dev/null\n-    echo $(git rev-parse --verify HEAD) > commit.sha\n-    echo ${PPE_VERSION} > version\n-    popd > /dev/null\n-\n-    # establish OS-specific package name\n-    local package_name=ppe-gpdb${GPDB_MAJOR_VERSION}-${PPE_VERSION}-${TARGET_OS}-${TARGET_AR}\n-\n-    # prepare directory layout for artifacts\n-    mkdir -p dist/${package_name}/{lib/postgresql,share/postgresql/extension}\n-\n-    # place artifacts into appropriate locations\n-    cp pxf-protocol-extension_src/pxf.so dist/${package_name}/lib/postgresql/\n-    cp pxf-protocol-extension_src/pxf*.{sql,control} dist/${package_name}/share/postgresql/extension/\n-    cp pxf-protocol-extension_src/{commit.sha,version,concourse/scripts/install_component.bash} dist/${package_name}\n-\n-    # package artifacts into a tarball\n-    pushd dist > /dev/null\n-    tar cvzf ${package_name}.tar.gz ${package_name}\n-    popd > /dev/null\n-\n     # verify contents\n-    ls -al dist\n-    tar -tvzf dist/${package_name}.tar.gz\n+    ls -al pxf_src/build/dist\n+    tar -tvzf pxf_src/build/dist/pxf-*.tar.gz\n+    cp pxf_src/build/dist/pxf-*.tar.gz dist", "originalCommit": "9847fb0da1237d83cb9d8c4abfddee06e344bc7c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUzNTIyMw==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r417535223", "bodyText": "I don't think it belongs in Makefile, this just list the content of the tarball and copies it into CI job's output location.", "author": "denalex", "createdAt": "2020-04-29T18:48:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ5OTg2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUwMDgzOQ==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r417500839", "bodyText": "typo", "author": "oliverralbertini", "createdAt": "2020-04-29T17:50:19Z", "path": "concourse/scripts/install_hadoop.bash", "diffHunk": "@@ -12,8 +12,14 @@ REMOTE_GPHD_ROOT=~centos/singlecluster\n function install_hadoop_single_cluster() {\n \tlocal hadoop_ip=${1}\n \n-\ttar -xzf pxf_tarball/pxf.tar.gz -C /tmp\n-\tcp /tmp/pxf/lib/pxf-hbase-*.jar \"${LOCAL_GPHD_ROOT}/hbase/lib\"\n+\ttar -xzf pxf_tarball/pxf*.tar.gz -C /tmp\n+\tif [[ -d /tmp/pxf/lib ]]; then\n+\t    # regular tarball based install (old)\n+\t    cp /tmp/pxf/lib/pxf-hbase-*.jar \"${LOCAL_GPHD_ROOT}/hbase/lib\"\n+\telse\n+\t    # componet tarball based install (new)", "originalCommit": "f87aedc213114317905f6f1ec9396d8da37377ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUwMTcxMg==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r417501712", "bodyText": "Do you want to do PXF_COMPONENT flag like in install_pxf.bash?", "author": "oliverralbertini", "createdAt": "2020-04-29T17:51:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUwMDgzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUzODAxNg==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r417538016", "bodyText": "thanks for noticing the typo. As for PXF_COMPONENT, maybe , this was done before it and here we can actually look at what we got, in other cases the code was expanding the tarball right into GPHOME/pxf, here we're expanding into /tmp. Maybe we will revisit once we change tarball into RPM, will leave this as is for now.", "author": "denalex", "createdAt": "2020-04-29T18:52:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUwMDgzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUwMzU4OA==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r417503588", "bodyText": "Should we delete the old pxf test script?", "author": "oliverralbertini", "createdAt": "2020-04-29T17:54:31Z", "path": "concourse/scripts/test.bash", "diffHunk": "@@ -0,0 +1,250 @@\n+#!/bin/bash", "originalCommit": "f87aedc213114317905f6f1ec9396d8da37377ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUyMTA2OA==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r417521068", "bodyText": "yes, we will at some later point when the old pipeline is obsolete", "author": "denalex", "createdAt": "2020-04-29T18:23:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUwMzU4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUwNTc0MQ==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r417505741", "bodyText": "I like this idea, but does it belong on the docker image level?", "author": "oliverralbertini", "createdAt": "2020-04-29T17:57:45Z", "path": "dev/install_gpdb_package.bash", "diffHunk": "@@ -0,0 +1,60 @@\n+#!/usr/bin/env bash\n+\n+CWDIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" && pwd )\"\n+\n+# TODO: check if gpadmin-limits.conf already exists and bail out if it does\n+>/etc/security/limits.d/gpadmin-limits.conf cat <<-EOF\n+gpadmin soft core unlimited\n+gpadmin soft nproc 131072\n+gpadmin soft nofile 65536\n+EOF\n+\n+>>/home/gpadmin/.bash_profile cat <<EOF", "originalCommit": "f87aedc213114317905f6f1ec9396d8da37377ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUzOTk5OQ==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r417539999", "bodyText": "will take a look, dev docker image story is not yet complete", "author": "denalex", "createdAt": "2020-04-29T18:56:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUwNTc0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUwODgwNA==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r417508804", "bodyText": "same comment as for pxf-cli/Makefile", "author": "oliverralbertini", "createdAt": "2020-04-29T18:02:38Z", "path": "server/Makefile", "diffHunk": "@@ -17,30 +17,34 @@\n #\n # protect the default target for this file from the targets in Makefile.global\n \n-default: all\n+include ../common.mk\n+\n+default: stage-notest\n \n-BUILD_PARAMS+= -DdeployPath=\"$(PXF_HOME)\"\n TOMCAT_VERSION=\"7.0.100\"\n TOMCAT_DIR=\"tomcat/build\"\n TOMCAT_TAR=\"apache-tomcat-${TOMCAT_VERSION}.tar.gz\"\n TOMCAT_URL=\"http://archive.apache.org/dist/tomcat/tomcat-7/v${TOMCAT_VERSION}/bin/${TOMCAT_TAR}\"\n \n+PXF_ROOT_DIR := $(shell cd .. && pwd)\n+PXF_VERSION ?= $(shell $(PXF_ROOT_DIR)/version)", "originalCommit": "f87aedc213114317905f6f1ec9396d8da37377ef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUxMDAyOQ==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r417510029", "bodyText": "We going to keep this?", "author": "oliverralbertini", "createdAt": "2020-04-29T18:04:42Z", "path": "server/pxf-jdbc/src/test/java/org/greenplum/pxf/plugins/jdbc/utils/ConnectionManagerTest.java", "diffHunk": "@@ -76,6 +77,7 @@ public void testGetConnectionPoolDisabled() throws SQLException {\n     }\n \n     @Test\n+    @Ignore", "originalCommit": "f87aedc213114317905f6f1ec9396d8da37377ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUyMDU2OA==", "url": "https://github.com/greenplum-db/pxf/pull/342#discussion_r417520568", "bodyText": "I'll try uncommenting this, will still be failing on local Docker I guess.", "author": "denalex", "createdAt": "2020-04-29T18:22:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUxMDAyOQ=="}], "type": "inlineReview"}, {"oid": "9eb472a908740bef0fdddda9d3c5e8b115b5c568", "url": "https://github.com/greenplum-db/pxf/commit/9eb472a908740bef0fdddda9d3c5e8b115b5c568", "message": "address PR feedback", "committedDate": "2020-04-29T18:57:47Z", "type": "commit"}, {"oid": "7697e6dd336ed58edd64e25b0e70fc4b4853bc29", "url": "https://github.com/greenplum-db/pxf/commit/7697e6dd336ed58edd64e25b0e70fc4b4853bc29", "message": "harden Parquet test", "committedDate": "2020-04-29T19:30:35Z", "type": "commit"}, {"oid": "c103129e7fbb58a3364c032dbf0f79925ee2952f", "url": "https://github.com/greenplum-db/pxf/commit/c103129e7fbb58a3364c032dbf0f79925ee2952f", "message": "added missing ccp7-image", "committedDate": "2020-04-29T21:22:54Z", "type": "commit"}]}