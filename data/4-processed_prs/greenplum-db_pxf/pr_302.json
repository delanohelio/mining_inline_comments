{"pr_number": 302, "pr_title": "Make pxf cluster sync delete files", "pr_createdAt": "2020-02-12T01:10:37Z", "pr_url": "https://github.com/greenplum-db/pxf/pull/302", "timeline": [{"oid": "aebaa1c6c3ba4e77fc7b0f551603130a65f8b44f", "url": "https://github.com/greenplum-db/pxf/commit/aebaa1c6c3ba4e77fc7b0f551603130a65f8b44f", "message": "pxf cluster sync: add flag to avoid file deletion\n\nWas easier to do by moving the pxf package into cmd.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>", "committedDate": "2020-02-13T17:45:38Z", "type": "forcePushed"}, {"oid": "9c7e5ac06ea2e580f7d2dbcd479b6d7b5b7e713d", "url": "https://github.com/greenplum-db/pxf/commit/9c7e5ac06ea2e580f7d2dbcd479b6d7b5b7e713d", "message": "pxf cluster sync: add flag to avoid file deletion\n\nWas easier to do by moving the pxf package into cmd.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>", "committedDate": "2020-02-13T17:54:05Z", "type": "forcePushed"}, {"oid": "752447ea037211718d2c55c41ee84932a89ff941", "url": "https://github.com/greenplum-db/pxf/commit/752447ea037211718d2c55c41ee84932a89ff941", "message": "Refactor code\n\nThe code had a lot of exported vars from when pxf was in a separate\npackage. Now that we unified the cmd/pxf pkgs, we don't need to make\nthings externally visible, except for testing. The ones that are\nexternal are now marked with a comment explaining that.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>", "committedDate": "2020-02-14T07:26:29Z", "type": "forcePushed"}, {"oid": "abfab1f8b73f03e9c62b4ea83d24b0f5d387b64f", "url": "https://github.com/greenplum-db/pxf/commit/abfab1f8b73f03e9c62b4ea83d24b0f5d387b64f", "message": "Refactor code\n\nThe code had a lot of exported vars from when pxf was in a separate\npackage. Now that we unified the cmd/pxf pkgs, we don't need to make\nthings externally visible, except for testing. The ones that are\nexternal are now marked with a comment explaining that.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>", "committedDate": "2020-02-14T17:05:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM0Mzk4MA==", "url": "https://github.com/greenplum-db/pxf/pull/302#discussion_r381343980", "bodyText": "maybe be more explicit here:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tsyncCmd.Flags().BoolVarP(&NonDestructiveSync, \"non-destructive\", \"n\", false, \"Don't delete files on remote host\")\n          \n          \n            \n            \tsyncCmd.Flags().BoolVarP(&NonDestructiveSync, \"non-destructive\", \"n\", false, \"Do not delete files on segment hosts that have been deleted on master host\")", "author": "frankgh", "createdAt": "2020-02-19T14:55:59Z", "path": "cli/go/src/pxf-cli/cmd/cluster.go", "diffHunk": "@@ -54,6 +56,7 @@ func init() {\n \tclusterCmd.AddCommand(startCmd)\n \tclusterCmd.AddCommand(stopCmd)\n \tclusterCmd.AddCommand(statusCmd)\n+\tsyncCmd.Flags().BoolVarP(&NonDestructiveSync, \"non-destructive\", \"n\", false, \"Don't delete files on remote host\")", "originalCommit": "abfab1f8b73f03e9c62b4ea83d24b0f5d387b64f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM0NjA1Nw==", "url": "https://github.com/greenplum-db/pxf/pull/302#discussion_r381346057", "bodyText": "I assume this is the file that was moved from .../pxf/ to cmd correct?", "author": "frankgh", "createdAt": "2020-02-19T14:58:46Z", "path": "cli/go/src/pxf-cli/cmd/pxf.go", "diffHunk": "@@ -0,0 +1,205 @@\n+package cmd", "originalCommit": "abfab1f8b73f03e9c62b4ea83d24b0f5d387b64f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQzNjUyNg==", "url": "https://github.com/greenplum-db/pxf/pull/302#discussion_r381436526", "bodyText": "yes", "author": "oliverralbertini", "createdAt": "2020-02-19T17:42:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM0NjA1Nw=="}], "type": "inlineReview"}, {"oid": "7136a48276ca59c4bc89a8c440e5d9124061b9b3", "url": "https://github.com/greenplum-db/pxf/commit/7136a48276ca59c4bc89a8c440e5d9124061b9b3", "message": "Incorporate Lisa's feedback about flag\n\nNow the default is to not delete extraneous files, user provides -d or\n--delete flag to get that behavior, mirrors rsync more closely.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>", "committedDate": "2020-02-21T04:15:55Z", "type": "forcePushed"}, {"oid": "a655dbba12d5fd58d1f041a531985b2b18409a1b", "url": "https://github.com/greenplum-db/pxf/commit/a655dbba12d5fd58d1f041a531985b2b18409a1b", "message": "Incorporate Lisa's feedback about flag\n\nNow the default is to not delete extraneous files, user provides -d or\n--delete flag to get that behavior, mirrors rsync more closely.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>", "committedDate": "2020-02-21T04:32:43Z", "type": "forcePushed"}, {"oid": "a1dd31814205a870263a8ede7121524c589023d7", "url": "https://github.com/greenplum-db/pxf/commit/a1dd31814205a870263a8ede7121524c589023d7", "message": "Add --delete functionality to pxf-service\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>", "committedDate": "2020-02-21T16:01:49Z", "type": "forcePushed"}, {"oid": "2648c8cc7be14bc7b83d0824d1d6caf5c401d3e0", "url": "https://github.com/greenplum-db/pxf/commit/2648c8cc7be14bc7b83d0824d1d6caf5c401d3e0", "message": "Add --delete functionality to pxf-service\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>", "committedDate": "2020-02-21T16:03:34Z", "type": "forcePushed"}, {"oid": "7af037b9d9a3e6f53aaa6d3568fcbd7a88db5343", "url": "https://github.com/greenplum-db/pxf/commit/7af037b9d9a3e6f53aaa6d3568fcbd7a88db5343", "message": "Add --delete functionality to pxf-service\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>", "committedDate": "2020-02-21T20:21:16Z", "type": "forcePushed"}, {"oid": "b74d2dd7213e4e730b4a1eb1d1ce8a71c0199990", "url": "https://github.com/greenplum-db/pxf/commit/b74d2dd7213e4e730b4a1eb1d1ce8a71c0199990", "message": "Add --delete functionality to pxf-service\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>", "committedDate": "2020-02-24T23:19:02Z", "type": "forcePushed"}, {"oid": "b74d2dd7213e4e730b4a1eb1d1ce8a71c0199990", "url": "https://github.com/greenplum-db/pxf/commit/b74d2dd7213e4e730b4a1eb1d1ce8a71c0199990", "message": "Add --delete functionality to pxf-service\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>", "committedDate": "2020-02-24T23:19:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1OTA1OQ==", "url": "https://github.com/greenplum-db/pxf/pull/302#discussion_r384059059", "bodyText": "should ERROR be logged at ERROR level rather than INFO ?", "author": "denalex", "createdAt": "2020-02-25T18:54:45Z", "path": "cli/go/src/pxf-cli/cmd/cluster.go", "diffHunk": "@@ -111,12 +117,12 @@ func GenerateOutput(command *pxf.Command, clusterData *ClusterData) error {\n \t\t}\n \t\tresponse += fmt.Sprintf(\"%s ==> %s\\n\", host, errorMessage)\n \t}\n-\tgplog.Info(\"ERROR: \"+command.Messages(pxf.Error), numErrors, numHosts)\n+\tgplog.Info(\"ERROR: \"+cmd.messages[err], numErrors, numHosts)", "originalCommit": "b74d2dd7213e4e730b4a1eb1d1ce8a71c0199990", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3NzI2Mw==", "url": "https://github.com/greenplum-db/pxf/pull/302#discussion_r384077263", "bodyText": "thanks for the feedback, I will address these in an upcoming PR.", "author": "oliverralbertini", "createdAt": "2020-02-25T19:28:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1OTA1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1OTczMg==", "url": "https://github.com/greenplum-db/pxf/pull/302#discussion_r384059732", "bodyText": "should this be Warn level ?", "author": "denalex", "createdAt": "2020-02-25T18:55:58Z", "path": "cli/go/src/pxf-cli/cmd/cluster.go", "diffHunk": "@@ -146,28 +152,28 @@ func adaptContentIDToHostname(cluster *cluster.Cluster, f func(string) string) f\n \t}\n }\n \n-func clusterRun(command *pxf.Command, clusterData *ClusterData) error {\n+func clusterRun(cmd *command, clusterData *ClusterData) error {\n \tdefer clusterData.connection.Close()\n \n-\terr := command.Warn(os.Stdin)\n+\terr := cmd.Warn(os.Stdin)\n \tif err != nil {\n \t\tgplog.Info(fmt.Sprintf(\"%s\", err))", "originalCommit": "b74d2dd7213e4e730b4a1eb1d1ce8a71c0199990", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3NzQxMA==", "url": "https://github.com/greenplum-db/pxf/pull/302#discussion_r384077410", "bodyText": "see the upcoming PR to adjust these log levels.", "author": "oliverralbertini", "createdAt": "2020-02-25T19:28:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1OTczMg=="}], "type": "inlineReview"}, {"oid": "741ab88967216c950616d2cfb224553c2d973cbe", "url": "https://github.com/greenplum-db/pxf/commit/741ab88967216c950616d2cfb224553c2d973cbe", "message": "pxf cluster sync: support deletion of extraneous files\n\nPreviously pxf [cluster] sync did not delete files from PXF_CONF that\nhad been deleted on master. By adding the `--delete` flag to the rsync\ncommands, we delete files from remote hosts. The user can use this\nfunctionality by doing:\n\npxf cluster sync -d\npxf cluster sync --delete.\npxf sync -d <host>\npxf sync --delete <host>\n\nThis change also consolidates the pxf/cmd go packages into cmd only.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>", "committedDate": "2020-02-25T19:26:05Z", "type": "commit"}, {"oid": "741ab88967216c950616d2cfb224553c2d973cbe", "url": "https://github.com/greenplum-db/pxf/commit/741ab88967216c950616d2cfb224553c2d973cbe", "message": "pxf cluster sync: support deletion of extraneous files\n\nPreviously pxf [cluster] sync did not delete files from PXF_CONF that\nhad been deleted on master. By adding the `--delete` flag to the rsync\ncommands, we delete files from remote hosts. The user can use this\nfunctionality by doing:\n\npxf cluster sync -d\npxf cluster sync --delete.\npxf sync -d <host>\npxf sync --delete <host>\n\nThis change also consolidates the pxf/cmd go packages into cmd only.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>", "committedDate": "2020-02-25T19:26:05Z", "type": "forcePushed"}]}