{"pr_number": 506, "pr_title": "Restore FDW Build", "pr_createdAt": "2020-11-23T00:18:27Z", "pr_url": "https://github.com/greenplum-db/pxf/pull/506", "timeline": [{"oid": "c7e64bbba7a697311258b342ae7a27517e90a20c", "url": "https://github.com/greenplum-db/pxf/commit/c7e64bbba7a697311258b342ae7a27517e90a20c", "message": "Restore FDW Build\n\n- Modify the top-level Makefile to support building the FDW extension\n  and external table extension depending on the PG_CONFIG version\n- Add new fdw make target in the top-level Makefile\n- Add GP7 RHEL7 build job to the pxf-build pipeline\n- Add GP7 RHEL7 build job to the dev pipelines\n- Fix Java 11 compilation issues\n- Add GP7 RHEL7 build job to the PR pipeline\n- Fix FDW compilation issues against GP7\n- Fix FDW write, do not execute write for FDW when the exec_location is\n  all segments and the role is master.\n- Add RPM spec file for GP7\n- Add support for `pxf [cluster] register` for GP7. `pxf [cluster]\n  register` will now register the pxf_fdw extension for the GP7 RPM.", "committedDate": "2020-11-23T00:24:01Z", "type": "commit"}, {"oid": "c7e64bbba7a697311258b342ae7a27517e90a20c", "url": "https://github.com/greenplum-db/pxf/commit/c7e64bbba7a697311258b342ae7a27517e90a20c", "message": "Restore FDW Build\n\n- Modify the top-level Makefile to support building the FDW extension\n  and external table extension depending on the PG_CONFIG version\n- Add new fdw make target in the top-level Makefile\n- Add GP7 RHEL7 build job to the pxf-build pipeline\n- Add GP7 RHEL7 build job to the dev pipelines\n- Fix Java 11 compilation issues\n- Add GP7 RHEL7 build job to the PR pipeline\n- Fix FDW compilation issues against GP7\n- Fix FDW write, do not execute write for FDW when the exec_location is\n  all segments and the role is master.\n- Add RPM spec file for GP7\n- Add support for `pxf [cluster] register` for GP7. `pxf [cluster]\n  register` will now register the pxf_fdw extension for the GP7 RPM.", "committedDate": "2020-11-23T00:24:01Z", "type": "forcePushed"}, {"oid": "c07dbdf9062c12e78fc7038d2aef0c07192f12a6", "url": "https://github.com/greenplum-db/pxf/commit/c07dbdf9062c12e78fc7038d2aef0c07192f12a6", "message": "Update README to include Java 11 build support", "committedDate": "2020-11-23T00:26:09Z", "type": "commit"}, {"oid": "c03cedb5706bc333f8590f8991178d7ce8adfc1c", "url": "https://github.com/greenplum-db/pxf/commit/c03cedb5706bc333f8590f8991178d7ce8adfc1c", "message": "Master build is now moved to the pxf-build pipeline", "committedDate": "2020-11-23T15:20:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODgyOTMzMw==", "url": "https://github.com/greenplum-db/pxf/pull/506#discussion_r528829333", "bodyText": "Could you move $FDW_SUPPORT to before line 10? And then use it in the if-statement?", "author": "bradfordb-vmware", "createdAt": "2020-11-23T16:20:41Z", "path": "Makefile", "diffHunk": "@@ -1,20 +1,34 @@\n include common.mk\n \n+PG_CONFIG = pg_config\n+\n PXF_VERSION ?= $(shell cat version)\n export PXF_VERSION\n \n+SOURCE_EXTENSION_DIR = external-table\n+TARGET_EXTENSION_DIR = gpextable\n+ifneq ($(shell $(PG_CONFIG) --version | egrep \"PostgreSQL 12\"),)\n+\tSOURCE_EXTENSION_DIR = fdw\n+\tTARGET_EXTENSION_DIR = fdw\n+endif\n+\n+FDW_SUPPORT = $(shell $(PG_CONFIG) --version | egrep \"PostgreSQL 12\")", "originalCommit": "c03cedb5706bc333f8590f8991178d7ce8adfc1c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODg5MDkxOA==", "url": "https://github.com/greenplum-db/pxf/pull/506#discussion_r528890918", "bodyText": "Do we also need to delete this pipeline config?", "author": "bradfordb-vmware", "createdAt": "2020-11-23T17:52:30Z", "path": "concourse/README.md", "diffHunk": "@@ -103,27 +103,3 @@ fly -t ud set-pipeline \\\n     -v gpdb-branch=6X_STABLE -v pgport=6000 \\\n     -v pxf-tag=<YOUR-TAG> -p dev:longevity_<YOUR-TAG>_6X_STABLE\n ```\n-\n-# Deploy `pg_regress` pipeline\n-\n-This pipeline currently runs the smoke test group against the different clouds using `pg_regress` instead of automation.\n-It uses both external and foreign tables.\n-You can adjust the `folder-prefix`, `gpdb-git-branch`, `gpdb-git-remote`, `pxf-git-branch`, and `pxf-git-remote`.\n-For example, you may want to work off of a development branch for PXF or Greenplum.\n-\n-```shell\n-fly -t ud set-pipeline -p pg_regress \\\n-    -c ~/workspace/pxf/concourse/pipelines/pg_regress_pipeline.yml \\", "originalCommit": "c03cedb5706bc333f8590f8991178d7ce8adfc1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkyNTA4Mg==", "url": "https://github.com/greenplum-db/pxf/pull/506#discussion_r528925082", "bodyText": "not yet, not all the tests have been migrated", "author": "frankgh", "createdAt": "2020-11-23T18:53:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODg5MDkxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkwMzk3NQ==", "url": "https://github.com/greenplum-db/pxf/pull/506#discussion_r528903975", "bodyText": "Super pedantic nit: It is possible to have rpm installed on Ubuntu. If we are trying to detect the platform, we could use /etc/os-release:\nplatform=\"$(. /etc/os-release; echo \"${ID}\")\"\ncase $platform in\ncentos)\n  ...\n  ;;\nubuntu)\n  ...\n  ;;\n*)\n  echo \"Unsupported operating system ${TARGET_OS}. Exiting...\"\n  exit 1\n  ;;\nesac", "author": "bradfordb-vmware", "createdAt": "2020-11-23T18:15:05Z", "path": "concourse/scripts/build.bash", "diffHunk": "@@ -14,17 +14,17 @@ GPHOME=/usr/local/greenplum-db-${GPDB_VERSION}\n function install_gpdb() {\n     local pkg_file\n     if command -v rpm; then\n-\t    pkg_file=$(find \"${GPDB_PKG_DIR}\" -name \"greenplum-db-${GPDB_VERSION}-rhel*-x86_64.rpm\")\n-\t    echo \"Installing RPM ${pkg_file}...\"\n-\t    rpm --quiet -ivh \"${pkg_file}\" >/dev/null\n+        pkg_file=$(find \"${GPDB_PKG_DIR}\" -name \"greenplum-db-${GPDB_VERSION}-rhel*-x86_64.rpm\")", "originalCommit": "c03cedb5706bc333f8590f8991178d7ce8adfc1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkyNjQ1NQ==", "url": "https://github.com/greenplum-db/pxf/pull/506#discussion_r528926455", "bodyText": "I guess I just fixed indentation here, not sure if I want to mess with this code :) Maybe I'll just revert it", "author": "frankgh", "createdAt": "2020-11-23T18:55:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkwMzk3NQ=="}], "type": "inlineReview"}, {"oid": "0d1ae3f8ae7c66fa475d52204caec9f690379d33", "url": "https://github.com/greenplum-db/pxf/commit/0d1ae3f8ae7c66fa475d52204caec9f690379d33", "message": "Address PR feedback", "committedDate": "2020-11-23T20:01:50Z", "type": "commit"}]}