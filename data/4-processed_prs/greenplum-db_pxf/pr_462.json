{"pr_number": 462, "pr_title": "docs - pxf.service.user.name is commented out by default", "pr_createdAt": "2020-10-15T15:26:32Z", "pr_url": "https://github.com/greenplum-db/pxf/pull/462", "timeline": [{"oid": "46acad616a91e036b44c846a47b452173be8dcf4", "url": "https://github.com/greenplum-db/pxf/commit/46acad616a91e036b44c846a47b452173be8dcf4", "message": "docs - pxf.service.user.name is commented out by default", "committedDate": "2020-10-08T22:57:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk1Mzg3Nw==", "url": "https://github.com/greenplum-db/pxf/pull/462#discussion_r505953877", "bodyText": "this is kinda tricky, there's no default value by default, only if people uncomment the property and do not make the change, then default value will take the effect. Not sure how to express this in a user-friendly way.", "author": "denalex", "createdAt": "2020-10-16T01:08:23Z", "path": "docs/content/cfg_server.html.md.erb", "diffHunk": "@@ -102,7 +102,7 @@ You configure properties in the `pxf-site.xml` file for a PXF server when one or\n |----------------|--------------------------------------------|---------------|\n | pxf.service.kerberos.principal | The Kerberos principal name. | gpadmin/\\_HOST@EXAMPLE.COM |\n | pxf.service.kerberos.keytab | The file system path to the Kerberos keytab file. | $PXF_CONF/keytabs/pxf.service.keytab |\n-| pxf.service.user.name | The log in user for the remote system. | The operating system user that starts the pxf process, typically `gpadmin`. |\n+| pxf.service.user.name | The log in user for the remote system. | The operating system user that starts the pxf process, typically `gpadmin`. (This property is commented out by default; uncomment and set the property to override the default value.) |", "originalCommit": "46acad616a91e036b44c846a47b452173be8dcf4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQ2MDUxNg==", "url": "https://github.com/greenplum-db/pxf/pull/462#discussion_r506460516", "bodyText": "I think this PR does not address that documentation:\n\nnot in this PR: general doc improvements to the impersonation topic.\n\nApplies to the comment below", "author": "frankgh", "createdAt": "2020-10-16T14:04:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk1Mzg3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA5NDI0OQ==", "url": "https://github.com/greenplum-db/pxf/pull/462#discussion_r512094249", "bodyText": "@denalex - do you mean the following when you say \"no default value by default\":\n\npxf will use the user who started pxf when this property doesn't exist (i.e. is commented out).\nwhen the property is uncommented with no change to the default value, it will use the greenplum user.\nand when the property is uncommented and the value is changed, it will use that user name to access hadoop.", "author": "lisakowen", "createdAt": "2020-10-26T16:25:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk1Mzg3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE0OTY1Ng==", "url": "https://github.com/greenplum-db/pxf/pull/462#discussion_r512149656", "bodyText": "This is a very tricky property, it cannot be described simply as it has some side-effects. We had determined 6 or so scenarios with recommendations on whether / how to set this property based on impersonation / security and customer use case. You would think that if the default (in code) is the same as default in the config file, then uncommenting it would be perfectly ok, but we found this is not the case, that's why we commented it, right @frankgh ?\nBut purely on the surface:\n\npxf will use the user who started pxf when this property doesn't exist (i.e. is commented out).\nyes, it will if it needs to get the value, so I guess you CAN say this is the default\nwhen the property is uncommented with no change to the default value, it will use the greenplum user.\nyes, same use as in the case above\nand when the property is uncommented and the value is changed, it will use that user name to access hadoop.\nkinda, but use that user name to access hadoop is oversimplification, there are more nuances:\n\n\nwhich identity will be presented as authenticated user (usually Kerberos principal)\nwhich identity will be proxied to make Hadoop believe that is the user accessing data\nI wish we stop describing it here and focus on those specific use cases we identified", "author": "denalex", "createdAt": "2020-10-26T17:40:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk1Mzg3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk1NTkxNA==", "url": "https://github.com/greenplum-db/pxf/pull/462#discussion_r505955914", "bodyText": "we had about 6 use cases on combination of these parameters to make it easier for users to make sense out of them. I'd like to have it documented in a special section, if not done already. @frankgh -- do you have the spreadsheet we compiled ?", "author": "denalex", "createdAt": "2020-10-16T01:12:02Z", "path": "docs/content/pxfuserimpers.html.md.erb", "diffHunk": "@@ -45,7 +45,7 @@ Perform the following procedure to configure the Hadoop user:\n     gpadmin@gpmaster$ cp $PXF_CONF/templates/pxf-site.xml .\n     ```\n \n-5. Open the `pxf-site.xml` file in the editor of your choice, and configure the Hadoop user name. When impersonation is disabled, this name identifies the Hadoop user identity that PXF will use to access the Hadoop system. When user impersonation is enabled, this name identifies the PXF proxy Hadoop user. For example, if you want to access Hadoop as the user `hdfsuser1`:\n+5. Open the `pxf-site.xml` file in the editor of your choice, and configure the Hadoop user name. When impersonation is disabled, this name identifies the Hadoop user identity that PXF will use to access the Hadoop system. When user impersonation is enabled, this name identifies the PXF proxy Hadoop user. For example, if you want to access Hadoop as the user `hdfsuser1`, uncomment the property and set it as follows:", "originalCommit": "46acad616a91e036b44c846a47b452173be8dcf4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6b0c3d137f0d91a1d2c0eebdb9d31eba26d733d8", "url": "https://github.com/greenplum-db/pxf/commit/6b0c3d137f0d91a1d2c0eebdb9d31eba26d733d8", "message": "new sections for expanded config scenarios", "committedDate": "2020-10-27T17:27:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk5NzA4Mw==", "url": "https://github.com/greenplum-db/pxf/pull/462#discussion_r512997083", "bodyText": "You probably already tried it, but does using the full \"Impersonation\" instead of \"Impers\" break the table?", "author": "dyozie", "createdAt": "2020-10-27T20:06:59Z", "path": "docs/content/pxf_kerbhdfs.html.md.erb", "diffHunk": "@@ -50,6 +42,19 @@ Before you configure PXF for access to a secure HDFS filesystem, ensure that you\n     root@gphost$ yum install krb5-libs krb5-workstation\n     ```\n \n+## <a id=\"scenarios\"></a>Use Cases and Configuration Scenarios\n+\n+The following table describes the use cases and configuration required when you use PXF to access a Kerberos-secured Hadoop cluster.\n+\n+**Note**: These scenarios assume that `gpadmin` is the PXF process owner.\n+\n+| Use Case | Impers  | Service User |  PXF Config | Hadoop&nbsp;Config&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |", "originalCommit": "6b0c3d137f0d91a1d2c0eebdb9d31eba26d733d8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU3NDc5MQ==", "url": "https://github.com/greenplum-db/pxf/pull/462#discussion_r513574791", "bodyText": "It seems like it would be cleaner and more user-focused to remove \"PXF accesses\" and instead write it in terms of \"Access as a Greenplum user\", \"Access as the Kerberos principle\", \"Access as a custom user\"\n(Removing Kerberos-secured Hadoop cluster\" also makes sense since that's what the entire table is about.", "author": "dyozie", "createdAt": "2020-10-28T16:12:42Z", "path": "docs/content/pxf_kerbhdfs.html.md.erb", "diffHunk": "@@ -50,6 +42,19 @@ Before you configure PXF for access to a secure HDFS filesystem, ensure that you\n     root@gphost$ yum install krb5-libs krb5-workstation\n     ```\n \n+## <a id=\"scenarios\"></a>Use Cases and Configuration Scenarios\n+\n+The following table describes the use cases and configuration required when you use PXF to access a Kerberos-secured Hadoop cluster.\n+\n+**Note**: These scenarios assume that `gpadmin` is the PXF process owner.\n+\n+| Use Case | Impers  | Service User |  PXF Config | Hadoop&nbsp;Config&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |\n+|----------|---------|-------------|---------------|-----------|\n+| PXF accesses a Kerberos-secured Hadoop cluster as the Greenplum user proxied by the Kerberos principal (the Kerberos principal is the Hadoop proxy user and accesses Hadoop as the Greenplum user) | true | Kerberos principal | Perform the [Configuration Procedure](#procedure) in this topic. | Set the Kerberos principal as the Hadoop proxy user as described in [Configure Hadoop Proxying](pxfuserimpers.html#hadoop). |", "originalCommit": "6b0c3d137f0d91a1d2c0eebdb9d31eba26d733d8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU3NTMyNw==", "url": "https://github.com/greenplum-db/pxf/pull/462#discussion_r513575327", "bodyText": "Similar feedback on the wording for these use cases.", "author": "dyozie", "createdAt": "2020-10-28T16:13:27Z", "path": "docs/content/pxfuserimpers.html.md.erb", "diffHunk": "@@ -10,13 +10,22 @@ When user impersonation is disabled, PXF executes all Hadoop service requests as\n \n You configure the Hadoop user and PXF user impersonation setting for a server via the `pxf-site.xml` server configuration file. Refer to [About Kerberos and User Impersonation Configuration (pxf-site.xml)](cfg_server.html#pxf-site) for more information about the configuration properties in this file.\n \n-The following table describes some of the PXF configuration scenarios for Hadoop access:\n+## <a id=\"pxf_cfg_scenarios\"></a>Use Cases and Configuration Scenarios\n \n-| Scenario | pxf-site.xml Required  | Impersonation Setting |  Required Configuration |\n-|----------------|--------------|---------|---------------|\n-| PXF accesses Hadoop using the identity of the Greenplum Database user. | yes | true  | Enable user impersonation, identify the Hadoop proxy user in the `pxf.service.user.name`, and configure Hadoop proxying for this Hadoop user identity. |\n-| PXF accesses Hadoop using the identity of the operating system user that started the PXF process. | yes | false | Disable user impersonation. |\n-| PXF accesses Hadoop using a user identity that you specify. | yes | false | Disable user impersonation and identify the Hadoop user identity in the `pxf.service.user.name` property setting.  |\n+User, user impersonation, and proxy configuration for Hadoop depends on how you use PXF to access Hadoop, and whether or not the Hadoop cluster is secured with Kerberos.\n+\n+The following table describes the use cases and configuration required when you use PXF to access *non-secured Hadoop*.\n+\n+**Note**: These scenarios assume that `gpadmin` is the PXF process owner.\n+\n+| Use Case | Impers  | Service&nbsp;User |  PXF Config | Hadoop&nbsp;Config&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |\n+|----------|---------|-------------|---------------|-----------|\n+| (default) PXF accesses Hadoop as the Greenplum user proxied by `gpadmin` user (`gpadmin` is the Hadoop proxy user and accesses Hadoop as the Greenplum user) | true | `gpadmin` | None; this is the default configuration. | Set the `gpadmin` user as the Hadoop proxy user as described in [Configure Hadoop Proxying](#hadoop). |", "originalCommit": "6b0c3d137f0d91a1d2c0eebdb9d31eba26d733d8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0c9f00c2c1a56b6c726ebe9a82a04b156074b17b", "url": "https://github.com/greenplum-db/pxf/commit/0c9f00c2c1a56b6c726ebe9a82a04b156074b17b", "message": "address comments from david; use full impersonation", "committedDate": "2020-10-28T17:54:41Z", "type": "commit"}, {"oid": "cb26c7cb9ba5924e2605025f52b219d295a9c43b", "url": "https://github.com/greenplum-db/pxf/commit/cb26c7cb9ba5924e2605025f52b219d295a9c43b", "message": "Another way to display this information to the users (#1)\n\nIn this presentation mode, you explicitly show the list of use cases we\r\nhave. In the right pane navigation, users can click on the use case they\r\nhave.", "committedDate": "2020-10-29T17:28:54Z", "type": "commit"}, {"oid": "725404680fa4d483693d8be90f4bbbd366f7c99e", "url": "https://github.com/greenplum-db/pxf/commit/725404680fa4d483693d8be90f4bbbd366f7c99e", "message": "some edits to the new section-oriented use case format", "committedDate": "2020-10-29T20:20:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDM0NDEyOQ==", "url": "https://github.com/greenplum-db/pxf/pull/462#discussion_r514344129", "bodyText": "Accesses -> Access for consistency.", "author": "dyozie", "createdAt": "2020-10-29T15:21:13Z", "path": "docs/content/pxfuserimpers.html.md.erb", "diffHunk": "@@ -10,13 +10,22 @@ When user impersonation is disabled, PXF executes all Hadoop service requests as\n \n You configure the Hadoop user and PXF user impersonation setting for a server via the `pxf-site.xml` server configuration file. Refer to [About Kerberos and User Impersonation Configuration (pxf-site.xml)](cfg_server.html#pxf-site) for more information about the configuration properties in this file.\n \n-The following table describes some of the PXF configuration scenarios for Hadoop access:\n+## <a id=\"pxf_cfg_scenarios\"></a>Use Cases and Configuration Scenarios\n \n-| Scenario | pxf-site.xml Required  | Impersonation Setting |  Required Configuration |\n-|----------------|--------------|---------|---------------|\n-| PXF accesses Hadoop using the identity of the Greenplum Database user. | yes | true  | Enable user impersonation, identify the Hadoop proxy user in the `pxf.service.user.name`, and configure Hadoop proxying for this Hadoop user identity. |\n-| PXF accesses Hadoop using the identity of the operating system user that started the PXF process. | yes | false | Disable user impersonation. |\n-| PXF accesses Hadoop using a user identity that you specify. | yes | false | Disable user impersonation and identify the Hadoop user identity in the `pxf.service.user.name` property setting.  |\n+User, user impersonation, and proxy configuration for Hadoop depends on how you use PXF to access Hadoop, and whether or not the Hadoop cluster is secured with Kerberos.\n+\n+The following table describes the use cases and configuration required when you use PXF to access *non-secured Hadoop*.\n+\n+**Note**: These scenarios assume that `gpadmin` is the PXF process owner.\n+\n+| Use Case | Impersonation  | Service&nbsp;User |  PXF Config | Hadoop&nbsp;Config&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |\n+|----------|---------|-------------|---------------|-----------|\n+| (default) Accesses Hadoop as a Greenplum user proxied by `gpadmin` user (`gpadmin` is the Hadoop proxy user and accesses Hadoop as the Greenplum user) | true | `gpadmin` | None; this is the default configuration. | Set the `gpadmin` user as the Hadoop proxy user as described in [Configure Hadoop Proxying](#hadoop). |", "originalCommit": "0c9f00c2c1a56b6c726ebe9a82a04b156074b17b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU4NTM3MQ==", "url": "https://github.com/greenplum-db/pxf/pull/462#discussion_r514585371", "bodyText": "i think this comment is outdated, @dyozie .  instead of a single table, each use case is its own section.", "author": "lisakowen", "createdAt": "2020-10-29T21:43:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDM0NDEyOQ=="}], "type": "inlineReview"}, {"oid": "e6587dbab9cb9009272880eec4b0bc6a4a595bf2", "url": "https://github.com/greenplum-db/pxf/commit/e6587dbab9cb9009272880eec4b0bc6a4a595bf2", "message": "Merge branch 'master' into docs/commented-out-prop", "committedDate": "2020-11-03T22:32:58Z", "type": "commit"}, {"oid": "bb2ef142ac628e2b7ef9e65dbfad7b7c33d246ef", "url": "https://github.com/greenplum-db/pxf/commit/bb2ef142ac628e2b7ef9e65dbfad7b7c33d246ef", "message": "Add images for visual explanation (#2)\n\n* Add images for visual explanation\r\n\r\n* Use different icons for the images", "committedDate": "2020-11-05T21:19:58Z", "type": "commit"}, {"oid": "b4280a5198b819ceb9feeb2477e0fa8a1999576d", "url": "https://github.com/greenplum-db/pxf/commit/b4280a5198b819ceb9feeb2477e0fa8a1999576d", "message": "add some text before the scenario config tables", "committedDate": "2020-11-05T21:30:45Z", "type": "commit"}]}