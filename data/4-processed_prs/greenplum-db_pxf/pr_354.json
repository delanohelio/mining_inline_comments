{"pr_number": 354, "pr_title": "Fix license-finder in the norsk pipeline", "pr_createdAt": "2020-05-07T00:45:31Z", "pr_url": "https://github.com/greenplum-db/pxf/pull/354", "timeline": [{"oid": "19825beb5bb1e638eb49211d0b6ec9ded1740ce9", "url": "https://github.com/greenplum-db/pxf/commit/19825beb5bb1e638eb49211d0b6ec9ded1740ce9", "message": "Fix license-finder in the norsk pipeline\n\nRecently we experienced issues with the norsk pipeline for PXF. The\nissue is a failure when scanning the `pxf/automation` Maven project.\n\nWithin the license finder code, this command is run:\n\nmvn help:evaluate -Dexpression=project.parent -q -D forceStdout\n\nwhich aims to find the project parent. The correct response is:\n\nnull object or invalid expression\n\nbecause there is no parent to automation/pom.xml.\n\nHowever, the mvn command fails because mvn expects an environment\nvariable, PXF_TMP_LIB, to be set. mvn is normally only run from our\nautomation/Makefile, which sets PXF_TMP_LIB.  For automation it points\nto a directory with symlinks to jars from $PXF_HOME/lib. Historically,\nPXF_TMP_LIB=$PXF_HOME/tmp.\n\nThis commit changes that in favor of a hardcoded value in the user's\nhome directory: $HOME/pxf_tmp_lib. Symlinks will be created there\nlinking to jar files in $PXF_HOME/lib. This way mvn will not fail when\nthe above command is run, because HOME will be defined, and pointing to\nan absolute path.\n\nAuthored-by: Oliver Albertini <oalbertini@vmware.com>", "committedDate": "2020-05-07T00:52:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE5NDQxMQ==", "url": "https://github.com/greenplum-db/pxf/pull/354#discussion_r421194411", "bodyText": "is this correct?", "author": "frankgh", "createdAt": "2020-05-07T01:57:32Z", "path": "automation/Makefile", "diffHunk": "@@ -87,13 +89,15 @@ all: test\n \n symlink_pxf_jars:\n \t@if [ -d \"$(PXF_HOME)/lib\" ]; then \\\n-\t\trm -rf $(PXF_HOME)/tmp && \\\n-\t\tmkdir -p $(PXF_HOME)/tmp && \\\n-\t\tcd $(PXF_HOME)/tmp && \\\n-\t\tfor X in $(PXF_HOME)/lib/pxf-*-[0-9]*.jar; do \\\n-\t\t\tln -sf $$X `echo \\`basename $$X\\` | sed -e 's/-[a-zA-Z0-9.]*.jar/.jar/'`; \\\n+\t\trm -rf $(PXF_TMP_LIB) && \\\n+\t\tmkdir -p $(PXF_TMP_LIB) && \\\n+\t\tfor jar in $(PXF_HOME)/lib/*; do \\\n+\t\t\t: \"$${jar##*/}\"; \\", "originalCommit": "19825beb5bb1e638eb49211d0b6ec9ded1740ce9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY2MjM0Ng==", "url": "https://github.com/greenplum-db/pxf/pull/354#discussion_r421662346", "bodyText": "I'd use an explicit variable instead of anonymous one ${_} for clarity : file_name=\"$${jar##*/}\"", "author": "denalex", "createdAt": "2020-05-07T17:12:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE5NDQxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE5NDQ5OA==", "url": "https://github.com/greenplum-db/pxf/pull/354#discussion_r421194498", "bodyText": "what is this if for?", "author": "frankgh", "createdAt": "2020-05-07T01:57:49Z", "path": "automation/Makefile", "diffHunk": "@@ -87,13 +89,15 @@ all: test\n \n symlink_pxf_jars:\n \t@if [ -d \"$(PXF_HOME)/lib\" ]; then \\\n-\t\trm -rf $(PXF_HOME)/tmp && \\\n-\t\tmkdir -p $(PXF_HOME)/tmp && \\\n-\t\tcd $(PXF_HOME)/tmp && \\\n-\t\tfor X in $(PXF_HOME)/lib/pxf-*-[0-9]*.jar; do \\\n-\t\t\tln -sf $$X `echo \\`basename $$X\\` | sed -e 's/-[a-zA-Z0-9.]*.jar/.jar/'`; \\\n+\t\trm -rf $(PXF_TMP_LIB) && \\\n+\t\tmkdir -p $(PXF_TMP_LIB) && \\\n+\t\tfor jar in $(PXF_HOME)/lib/*; do \\\n+\t\t\t: \"$${jar##*/}\"; \\\n+\t\t\tif [[ $${_} =~ ^pxf-[A-Za-z0-9]+(-[0-9.]+).jar$$ ]]; then \\", "originalCommit": "19825beb5bb1e638eb49211d0b6ec9ded1740ce9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY2NzM2MQ==", "url": "https://github.com/greenplum-db/pxf/pull/354#discussion_r421667361", "bodyText": "so this would match a pattern and capture the version (expression in () ) in BASH_REMATCH[1] ?", "author": "denalex", "createdAt": "2020-05-07T17:20:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE5NDQ5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE5NDcwNg==", "url": "https://github.com/greenplum-db/pxf/pull/354#discussion_r421194706", "bodyText": "is this needed now?", "author": "frankgh", "createdAt": "2020-05-07T01:58:39Z", "path": "automation/Makefile", "diffHunk": "@@ -5,8 +5,10 @@\n # make TEST=<class>#<method> ===> run specific <method> from <class>.class\n # make OFFLINE=true ===> run using only cache\n \n+SHELL := bash", "originalCommit": "19825beb5bb1e638eb49211d0b6ec9ded1740ce9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY2MTAyMw==", "url": "https://github.com/greenplum-db/pxf/pull/354#discussion_r421661023", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tfor jar in $(PXF_HOME)/lib/*; do \\\n          \n          \n            \n            \t\tfor jar in $(PXF_HOME)/lib/pxf-*.jar; do \\", "author": "denalex", "createdAt": "2020-05-07T17:09:48Z", "path": "automation/Makefile", "diffHunk": "@@ -87,13 +89,15 @@ all: test\n \n symlink_pxf_jars:\n \t@if [ -d \"$(PXF_HOME)/lib\" ]; then \\\n-\t\trm -rf $(PXF_HOME)/tmp && \\\n-\t\tmkdir -p $(PXF_HOME)/tmp && \\\n-\t\tcd $(PXF_HOME)/tmp && \\\n-\t\tfor X in $(PXF_HOME)/lib/pxf-*-[0-9]*.jar; do \\\n-\t\t\tln -sf $$X `echo \\`basename $$X\\` | sed -e 's/-[a-zA-Z0-9.]*.jar/.jar/'`; \\\n+\t\trm -rf $(PXF_TMP_LIB) && \\\n+\t\tmkdir -p $(PXF_TMP_LIB) && \\\n+\t\tfor jar in $(PXF_HOME)/lib/*; do \\", "originalCommit": "19825beb5bb1e638eb49211d0b6ec9ded1740ce9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY2Nzk1MQ==", "url": "https://github.com/greenplum-db/pxf/pull/354#discussion_r421667951", "bodyText": "if BASH_REMATCH[1] is version, then it needs to be cut out of the string. According to this logic, BASH_REMATCH[1] is actually the string without a version ??", "author": "denalex", "createdAt": "2020-05-07T17:21:47Z", "path": "automation/Makefile", "diffHunk": "@@ -87,13 +89,15 @@ all: test\n \n symlink_pxf_jars:\n \t@if [ -d \"$(PXF_HOME)/lib\" ]; then \\\n-\t\trm -rf $(PXF_HOME)/tmp && \\\n-\t\tmkdir -p $(PXF_HOME)/tmp && \\\n-\t\tcd $(PXF_HOME)/tmp && \\\n-\t\tfor X in $(PXF_HOME)/lib/pxf-*-[0-9]*.jar; do \\\n-\t\t\tln -sf $$X `echo \\`basename $$X\\` | sed -e 's/-[a-zA-Z0-9.]*.jar/.jar/'`; \\\n+\t\trm -rf $(PXF_TMP_LIB) && \\\n+\t\tmkdir -p $(PXF_TMP_LIB) && \\\n+\t\tfor jar in $(PXF_HOME)/lib/*; do \\\n+\t\t\t: \"$${jar##*/}\"; \\\n+\t\t\tif [[ $${_} =~ ^pxf-[A-Za-z0-9]+(-[0-9.]+).jar$$ ]]; then \\\n+\t\t\t\tln -sf \"$${jar}\" \"$(PXF_TMP_LIB)/$${_/$${BASH_REMATCH[1]}/}\"; \\", "originalCommit": "19825beb5bb1e638eb49211d0b6ec9ded1740ce9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4f2217749b41977ca51675243baedafeb68e031a", "url": "https://github.com/greenplum-db/pxf/commit/4f2217749b41977ca51675243baedafeb68e031a", "message": "Fix license-finder in the norsk pipeline\n\nRecently we experienced issues with the norsk pipeline for PXF. The\nissue is a failure when scanning the `pxf/automation` Maven project.\n\nWithin the license finder code, this command is run:\n\nmvn help:evaluate -Dexpression=project.parent -q -D forceStdout\n\nwhich aims to find the project parent. The correct response is:\n\nnull object or invalid expression\n\nbecause there is no parent to automation/pom.xml.\n\nHowever, the mvn command fails because mvn expects an environment\nvariable, PXF_TMP_LIB, to be set. mvn is normally only run from our\nautomation/Makefile, which sets PXF_TMP_LIB.  For automation it points\nto a directory with symlinks to jars from $PXF_HOME/lib. Historically,\nPXF_TMP_LIB=$PXF_HOME/tmp.\n\nThis commit changes that in favor of a hardcoded value in the user's\nhome directory: $HOME/pxf_tmp_lib. Symlinks will be created there\nlinking to jar files in $PXF_HOME/lib. This way mvn will not fail when\nthe above command is run, because HOME will be defined, and pointing to\nan absolute path.\n\nAuthored-by: Oliver Albertini <oalbertini@vmware.com>", "committedDate": "2020-05-07T20:44:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc5MTcyNg==", "url": "https://github.com/greenplum-db/pxf/pull/354#discussion_r421791726", "bodyText": "line 110 needs a change as well !", "author": "denalex", "createdAt": "2020-05-07T21:01:35Z", "path": "automation/Makefile", "diffHunk": "@@ -87,13 +89,17 @@ all: test\n \n symlink_pxf_jars:\n \t@if [ -d \"$(PXF_HOME)/lib\" ]; then \\\n-\t\trm -rf $(PXF_HOME)/tmp && \\\n-\t\tmkdir -p $(PXF_HOME)/tmp && \\\n-\t\tcd $(PXF_HOME)/tmp && \\\n-\t\tfor X in $(PXF_HOME)/lib/pxf-*-[0-9]*.jar; do \\\n-\t\t\tln -sf $$X `echo \\`basename $$X\\` | sed -e 's/-[a-zA-Z0-9.]*.jar/.jar/'`; \\\n+\t\trm -rf $(PXF_TMP_LIB) && \\\n+\t\tmkdir -p $(PXF_TMP_LIB) && \\\n+\t\tfor jar in $(PXF_HOME)/lib/pxf-*.jar; do \\\n+\t\t\tjar_name=\"$${jar##*/}\"; \\\n+\t\t\tif [[ $${jar_name} =~ ^pxf-[A-Za-z0-9]+(-[0-9.]+).jar$$ ]]; then \\\n+\t\t\t\tlink=$(PXF_TMP_LIB)/$${jar_name/$${BASH_REMATCH[1]}/}; \\\n+\t\t\t\techo \"creating link $${link} -> $${jar}\"; \\\n+\t\t\t\tln -sf \"$${jar}\" \"$${link}\"; \\\n+\t\t\tfi; \\\n \t\tdone; \\\n-\t\ttouch $(PXF_HOME)/tmp/pxf-extras.jar; \\\n+\t\ttouch $(PXF_TMP_LIB)/pxf-extras.jar; \\", "originalCommit": "4f2217749b41977ca51675243baedafeb68e031a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0a2b6a6f1490d8964706a2191153812edd59460c", "url": "https://github.com/greenplum-db/pxf/commit/0a2b6a6f1490d8964706a2191153812edd59460c", "message": "Fix license-finder in the norsk pipeline\n\nRecently we experienced issues with the norsk pipeline for PXF. The\nissue is a failure when scanning the `pxf/automation` Maven project.\n\nWithin the license finder code, this command is run:\n\nmvn help:evaluate -Dexpression=project.parent -q -D forceStdout\n\nwhich aims to find the project parent. The correct response is:\n\nnull object or invalid expression\n\nbecause there is no parent to automation/pom.xml.\n\nHowever, the mvn command fails because mvn expects an environment\nvariable, PXF_TMP_LIB, to be set. mvn is normally only run from our\nautomation/Makefile, which sets PXF_TMP_LIB.  For automation it points\nto a directory with symlinks to jars from $PXF_HOME/lib. Historically,\nPXF_TMP_LIB=$PXF_HOME/tmp.\n\nThis commit changes that in favor of a hardcoded value in the user's\nhome directory: $HOME/pxf_tmp_lib. Symlinks will be created there\nlinking to jar files in $PXF_HOME/lib. This way mvn will not fail when\nthe above command is run, because HOME will be defined, and pointing to\nan absolute path.\n\nAuthored-by: Oliver Albertini <oalbertini@vmware.com>", "committedDate": "2020-05-07T21:22:53Z", "type": "forcePushed"}, {"oid": "b9cbd5e7c345db7ff20b1dd7ea4a9dbfa5c0a29f", "url": "https://github.com/greenplum-db/pxf/commit/b9cbd5e7c345db7ff20b1dd7ea4a9dbfa5c0a29f", "message": "Fix license-finder in the norsk pipeline\n\nRecently we experienced issues with the norsk pipeline for PXF. The\nissue is a failure when scanning the `pxf/automation` Maven project.\n\nWithin the license finder code, this command is run:\n\nmvn help:evaluate -Dexpression=project.parent -q -D forceStdout\n\nwhich aims to find the project parent. The correct response is:\n\nnull object or invalid expression\n\nbecause there is no parent to automation/pom.xml.\n\nHowever, the mvn command fails because mvn expects an environment\nvariable, PXF_TMP_LIB, to be set. mvn is normally only run from our\nautomation/Makefile, which sets PXF_TMP_LIB.  For automation it points\nto a directory with symlinks to jars from $PXF_HOME/lib. Historically,\nPXF_TMP_LIB=$PXF_HOME/tmp.\n\nThis commit changes that in favor of a hardcoded value in the user's\nhome directory: $HOME/pxf_tmp_lib. Symlinks will be created there\nlinking to jar files in $PXF_HOME/lib. This way mvn will not fail when\nthe above command is run, because HOME will be defined, and pointing to\nan absolute path.\n\nAuthored-by: Oliver Albertini <oalbertini@vmware.com>", "committedDate": "2020-05-07T21:31:50Z", "type": "forcePushed"}, {"oid": "8ec6309647110464b1b9a934417659660f95a457", "url": "https://github.com/greenplum-db/pxf/commit/8ec6309647110464b1b9a934417659660f95a457", "message": "Fix license-finder in the norsk pipeline\n\nRecently we experienced issues with the norsk pipeline for PXF. The\nissue is a failure when scanning the `pxf/automation` Maven project.\n\nWithin the license finder code, this command is run:\n\nmvn help:evaluate -Dexpression=project.parent -q -D forceStdout\n\nwhich aims to find the project parent. The correct response is:\n\nnull object or invalid expression\n\nbecause there is no parent to automation/pom.xml.\n\nHowever, the mvn command fails because mvn expects an environment\nvariable, PXF_TMP_LIB, to be set. mvn is normally only run from our\nautomation/Makefile, which sets PXF_TMP_LIB.  For automation it points\nto a directory with symlinks to jars from $PXF_HOME/lib. Historically,\nPXF_TMP_LIB=$PXF_HOME/tmp.\n\nThis commit changes that in favor of a hardcoded value in the user's\nhome directory: $HOME/pxf_tmp_lib. Symlinks will be created there\nlinking to jar files in $PXF_HOME/lib. This way mvn will not fail when\nthe above command is run, because HOME will be defined, and pointing to\nan absolute path.\n\nAuthored-by: Oliver Albertini <oalbertini@vmware.com>", "committedDate": "2020-05-07T21:49:54Z", "type": "forcePushed"}, {"oid": "389bd053a2d91041c9fd1f4d2f344e4c04084bc1", "url": "https://github.com/greenplum-db/pxf/commit/389bd053a2d91041c9fd1f4d2f344e4c04084bc1", "message": "Fix license-finder in the norsk pipeline\n\nRecently we experienced issues with the norsk pipeline for PXF. The\nissue is a failure when scanning the `pxf/automation` Maven project.\n\nWithin the license finder code, this command is run:\n\nmvn help:evaluate -Dexpression=project.parent -q -D forceStdout\n\nwhich aims to find the project parent. The correct response is:\n\nnull object or invalid expression\n\nbecause there is no parent to automation/pom.xml.\n\nHowever, the mvn command fails because mvn expects an environment\nvariable, PXF_TMP_LIB, to be set. mvn is normally only run from our\nautomation/Makefile, which sets PXF_TMP_LIB.  For automation it points\nto a directory with symlinks to jars from $PXF_HOME/lib. Historically,\nPXF_TMP_LIB=$PXF_HOME/tmp.\n\nThis commit changes that in favor of a hardcoded value in the user's\nhome directory: $HOME/pxf_tmp_lib. Symlinks will be created there\nlinking to jar files in $PXF_HOME/lib. This way mvn will not fail when\nthe above command is run, because HOME will be defined, and pointing to\nan absolute path.\n\nAuthored-by: Oliver Albertini <oalbertini@vmware.com>", "committedDate": "2020-05-07T21:55:27Z", "type": "commit"}, {"oid": "389bd053a2d91041c9fd1f4d2f344e4c04084bc1", "url": "https://github.com/greenplum-db/pxf/commit/389bd053a2d91041c9fd1f4d2f344e4c04084bc1", "message": "Fix license-finder in the norsk pipeline\n\nRecently we experienced issues with the norsk pipeline for PXF. The\nissue is a failure when scanning the `pxf/automation` Maven project.\n\nWithin the license finder code, this command is run:\n\nmvn help:evaluate -Dexpression=project.parent -q -D forceStdout\n\nwhich aims to find the project parent. The correct response is:\n\nnull object or invalid expression\n\nbecause there is no parent to automation/pom.xml.\n\nHowever, the mvn command fails because mvn expects an environment\nvariable, PXF_TMP_LIB, to be set. mvn is normally only run from our\nautomation/Makefile, which sets PXF_TMP_LIB.  For automation it points\nto a directory with symlinks to jars from $PXF_HOME/lib. Historically,\nPXF_TMP_LIB=$PXF_HOME/tmp.\n\nThis commit changes that in favor of a hardcoded value in the user's\nhome directory: $HOME/pxf_tmp_lib. Symlinks will be created there\nlinking to jar files in $PXF_HOME/lib. This way mvn will not fail when\nthe above command is run, because HOME will be defined, and pointing to\nan absolute path.\n\nAuthored-by: Oliver Albertini <oalbertini@vmware.com>", "committedDate": "2020-05-07T21:55:27Z", "type": "forcePushed"}]}