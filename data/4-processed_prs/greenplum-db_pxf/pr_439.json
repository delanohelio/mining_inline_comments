{"pr_number": 439, "pr_title": "Add lib/native directory in PXF_CONF", "pr_createdAt": "2020-09-05T13:18:58Z", "pr_url": "https://github.com/greenplum-db/pxf/pull/439", "timeline": [{"oid": "c3528b7324730df8f9e1822c1d32e41ce6f59700", "url": "https://github.com/greenplum-db/pxf/commit/c3528b7324730df8f9e1822c1d32e41ce6f59700", "message": "Add lib/native directory in PXF_CONF\n\nAdd a new configuration directory, `$PXF_CONF/lib/native`, where users\ncan install native libraries for PXF (i.e. Hadoop native libraries).\nAlso, add an option to export the LD_LIBRARY_PATH to that location if\nusers configure their native dependencies in that location.", "committedDate": "2020-09-05T13:18:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc2OTA4OA==", "url": "https://github.com/greenplum-db/pxf/pull/439#discussion_r485769088", "bodyText": "Are we sure that $LD_LIBRARY_PATH is non-empty at this point? If not, we need to use a different pattern: https://stackoverflow.com/questions/9631228/how-to-smart-append-ld-library-path-in-shell-when-nounset/9631350#9631350. Here's a anecdote of this bug in the wild.", "author": "bradfordb-vmware", "createdAt": "2020-09-09T16:49:32Z", "path": "server/pxf-service/src/templates/user/conf/pxf-env.sh", "diffHunk": "@@ -58,3 +58,6 @@ PXF_CONF=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )/..\" && pwd )\"\n \n # Dump heap on OutOfMemoryError, set to dump path to enable\n # export PXF_OOM_DUMP_PATH=/tmp/pxf_heap_dump\n+\n+# Uncomment below if you installed native libraries to be loaded by PXF\n+# export LD_LIBRARY_PATH=${PXF_CONF}/lib/native:${LD_LIBRARY_PATH}", "originalCommit": "c3528b7324730df8f9e1822c1d32e41ce6f59700", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc3Njk3Nw==", "url": "https://github.com/greenplum-db/pxf/pull/439#discussion_r485776977", "bodyText": "Thanks for the feedback, I updated the PR", "author": "frankgh", "createdAt": "2020-09-09T16:58:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc2OTA4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc5NDM5NA==", "url": "https://github.com/greenplum-db/pxf/pull/439#discussion_r485794394", "bodyText": "do we want the examples in the docs to use the new pattern as well?", "author": "lisakowen", "createdAt": "2020-09-09T17:28:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc2OTA4OA=="}], "type": "inlineReview"}, {"oid": "5fab84049abf9d6c02882247b5cf201ee36950fd", "url": "https://github.com/greenplum-db/pxf/commit/5fab84049abf9d6c02882247b5cf201ee36950fd", "message": "Address PR feedback", "committedDate": "2020-09-09T16:56:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc5ODAwOA==", "url": "https://github.com/greenplum-db/pxf/pull/439#discussion_r485798008", "bodyText": "if they uncomment it, it will cause ${PXF_CONF}/lib/native be listed after /usr/lib/hadoop/lib/native since that's how it is defined in pxf-env-default.sh, should it be in a different order ?", "author": "denalex", "createdAt": "2020-09-09T17:34:33Z", "path": "server/pxf-service/src/templates/user/conf/pxf-env.sh", "diffHunk": "@@ -58,3 +58,6 @@ PXF_CONF=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )/..\" && pwd )\"\n \n # Dump heap on OutOfMemoryError, set to dump path to enable\n # export PXF_OOM_DUMP_PATH=/tmp/pxf_heap_dump\n+\n+# Uncomment below if you installed native libraries to be loaded by PXF\n+# export LD_LIBRARY_PATH=${PXF_CONF}/lib/native${LD_LIBRARY_PATH:+:$LD_LIBRARY_PATH}", "originalCommit": "5fab84049abf9d6c02882247b5cf201ee36950fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTgwMTY4Mw==", "url": "https://github.com/greenplum-db/pxf/pull/439#discussion_r485801683", "bodyText": "@denalex good point, ${PXF_CONF}/lib/native should be the first in the search path.\nWe should document that by default we pick native libraries from this path : /usr/lib/hadoop/lib/native. But if uncommented, the priority is\n\n${PXF_CONF}/lib/native\n/usr/lib/hadoop/lib/native\nLD_LIBRARY_PATH\n\n@bradfordb-vmware  are there any side effects of having LD_LIBRARY_PATH point to a non-existent directory?", "author": "frankgh", "createdAt": "2020-09-09T17:41:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc5ODAwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTgyMDQ2MQ==", "url": "https://github.com/greenplum-db/pxf/pull/439#discussion_r485820461", "bodyText": "The way it is currently implemented (which is correct), if users uncomment, the order will be:\n${PXF_CONF}/lib/native\nLD_LIBRARY_PATH\n/usr/lib/hadoop/lib/native", "author": "denalex", "createdAt": "2020-09-09T18:15:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc5ODAwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTgyMTYzNA==", "url": "https://github.com/greenplum-db/pxf/pull/439#discussion_r485821634", "bodyText": "Will tests on single cluster now use this automatically ? What about dataproc ? We should have at least some environments to use it so we know it is working fine. And some environments should not have native so we know it is working as well.", "author": "denalex", "createdAt": "2020-09-09T18:17:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc5ODAwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTgzMzA4NA==", "url": "https://github.com/greenplum-db/pxf/pull/439#discussion_r485833084", "bodyText": "do we still want to allow users to specify their own path for native libraries?  and if so, how do we want them to modify the LD_LIBRARY_PATH setting in pxf-env.sh - add their library directory as the first element?", "author": "lisakowen", "createdAt": "2020-09-09T18:38:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc5ODAwOA=="}], "type": "inlineReview"}, {"oid": "3733580df738f2bdbbc290d35d4bd12a8587d61b", "url": "https://github.com/greenplum-db/pxf/commit/3733580df738f2bdbbc290d35d4bd12a8587d61b", "message": "Address PR feedback", "committedDate": "2020-09-09T17:53:17Z", "type": "commit"}, {"oid": "abc54019dcf4dec4380921bd93cbd5155b073c33", "url": "https://github.com/greenplum-db/pxf/commit/abc54019dcf4dec4380921bd93cbd5155b073c33", "message": "Address PR feedback", "committedDate": "2020-09-09T19:29:03Z", "type": "commit"}]}