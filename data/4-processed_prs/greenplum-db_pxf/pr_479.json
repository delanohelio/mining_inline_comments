{"pr_number": 479, "pr_title": "Add PXF CLI test to multinode test", "pr_createdAt": "2020-11-03T20:25:30Z", "pr_url": "https://github.com/greenplum-db/pxf/pull/479", "timeline": [{"oid": "b6ca5763d1cbe97ad9e9e3564736b2ad7f85b7fc", "url": "https://github.com/greenplum-db/pxf/commit/b6ca5763d1cbe97ad9e9e3564736b2ad7f85b7fc", "message": "Add PXF CLI test to multinode test\n\nAfter the RPM work was merged, the CLI test pipeline stopped working.\nThis PR restores the CLI tests, but it adds the test as a task in the\nmultinode impersonation job. This way, it reuses the setup, which is\nexpensive, and then the automation tests run after the CLI tests are\nsuccessful.", "committedDate": "2020-11-03T20:22:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzAwNTcyOQ==", "url": "https://github.com/greenplum-db/pxf/pull/479#discussion_r517005729", "bodyText": "I don't think we need to use find here, wouldn't export PXF_HOME=\"/usr/local/pxf-gp*\" work? If you wanted to be really defensive, you could use glob like /usr/local/pxf-gp?or/usr/local/pxf-gp[56]`.", "author": "bradfordb-vmware", "createdAt": "2020-11-03T23:01:05Z", "path": "concourse/scripts/cli/common.sh", "diffHunk": "@@ -1,8 +1,13 @@\n #!/usr/bin/env bash\n \n export PXF_CONF=~gpadmin/pxf\n-GPHOME=/usr/local/greenplum-db-devel\n-export PATH=$PATH:${GPHOME}/pxf/bin\n+export GPHOME=/usr/local/greenplum-db\n+export PXF_HOME=$(find /usr/local/ -name \"pxf-gp*\" -type d)", "originalCommit": "b6ca5763d1cbe97ad9e9e3564736b2ad7f85b7fc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzQxMTIyNA==", "url": "https://github.com/greenplum-db/pxf/pull/479#discussion_r517411224", "bodyText": "I couldn't get globs working here. Reverted back to find", "author": "frankgh", "createdAt": "2020-11-04T15:06:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzAwNTcyOQ=="}], "type": "inlineReview"}, {"oid": "8316a631f6ee4507ca703b143053a2cf87dbd8eb", "url": "https://github.com/greenplum-db/pxf/commit/8316a631f6ee4507ca703b143053a2cf87dbd8eb", "message": "Address PR feedback", "committedDate": "2020-11-03T23:04:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzAxMDU3MQ==", "url": "https://github.com/greenplum-db/pxf/pull/479#discussion_r517010571", "bodyText": "why do we need the standby master?", "author": "ashuka24", "createdAt": "2020-11-03T23:14:50Z", "path": "concourse/pipelines/templates/build_pipeline-tpl.yml", "diffHunk": "@@ -1189,6 +1189,7 @@ jobs:\n             segments_per_host: 4\n             instance_type: n1-standard-4\n             ccp_reap_minutes: 120\n+            standby_master: true", "originalCommit": "8316a631f6ee4507ca703b143053a2cf87dbd8eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzAxMjUzNw==", "url": "https://github.com/greenplum-db/pxf/pull/479#discussion_r517012537", "bodyText": "The PXF CLI tests make sure that standby master is also being tested", "author": "frankgh", "createdAt": "2020-11-03T23:21:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzAxMDU3MQ=="}], "type": "inlineReview"}, {"oid": "9374aeff957f66ccd36f9ac6888d47e530de0fd1", "url": "https://github.com/greenplum-db/pxf/commit/9374aeff957f66ccd36f9ac6888d47e530de0fd1", "message": "remove quotes for PXF_HOME", "committedDate": "2020-11-03T23:39:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzAyMDY5Mg==", "url": "https://github.com/greenplum-db/pxf/pull/479#discussion_r517020692", "bodyText": "is ? supposed to be there ?", "author": "denalex", "createdAt": "2020-11-03T23:46:52Z", "path": "concourse/scripts/cli/common.sh", "diffHunk": "@@ -1,8 +1,13 @@\n #!/usr/bin/env bash\n \n export PXF_CONF=~gpadmin/pxf\n-GPHOME=/usr/local/greenplum-db-devel\n-export PATH=$PATH:${GPHOME}/pxf/bin\n+export GPHOME=/usr/local/greenplum-db\n+export PXF_HOME=/usr/local/pxf-gp?", "originalCommit": "9374aeff957f66ccd36f9ac6888d47e530de0fd1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzQxMDA5OA==", "url": "https://github.com/greenplum-db/pxf/pull/479#discussion_r517410098", "bodyText": "it turns out glob expansion doesn't work when defining env variables", "author": "frankgh", "createdAt": "2020-11-04T15:04:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzAyMDY5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzAyMjQ4NA==", "url": "https://github.com/greenplum-db/pxf/pull/479#discussion_r517022484", "bodyText": "does this assume CLI tests leave PXF installation / configuration in a correct state for the downstream feature suite to work ? If yes, that would be a burden for future CLI test developers not aware of this coupling. If not, should the feature suite cleanup everything before starting ?", "author": "denalex", "createdAt": "2020-11-03T23:53:00Z", "path": "concourse/pipelines/templates/dev_build_pipeline-tpl.yml", "diffHunk": "@@ -1074,6 +1075,12 @@ jobs:\n       GP_VER: [[gp_ver]]\n       KERBEROS: ((kerberos-enabled))\n       PXF_JVM_OPTS: ((pxf-jvm-opts))\n+  - task: Test PXF CLI\n+    image: gpdb[[gp_ver]]-pxf-dev-centos7-image\n+    file: pxf_src/concourse/tasks/test_pxf_cli.yml\n+    params:\n+      TARGET_OS: centos\n+      TARGET_OS_VERSION: 7", "originalCommit": "9374aeff957f66ccd36f9ac6888d47e530de0fd1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzA0NTM2NA==", "url": "https://github.com/greenplum-db/pxf/pull/479#discussion_r517045364", "bodyText": "that's a concern I have in the back of my mind. I was considering moving this task to run after the automation test task. That way we don't need to worry about the state of PXF before running the automation tests", "author": "frankgh", "createdAt": "2020-11-04T01:18:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzAyMjQ4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzQxMDU2Mg==", "url": "https://github.com/greenplum-db/pxf/pull/479#discussion_r517410562", "bodyText": "ok, moved the test to run as the last task.", "author": "frankgh", "createdAt": "2020-11-04T15:05:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzAyMjQ4NA=="}], "type": "inlineReview"}, {"oid": "b7851b127d1efb4c40e2f254c62a13a2927150e5", "url": "https://github.com/greenplum-db/pxf/commit/b7851b127d1efb4c40e2f254c62a13a2927150e5", "message": "Use single quote for globbing", "committedDate": "2020-11-04T01:19:03Z", "type": "commit"}, {"oid": "aaded7d35549c057cc72bd787933b5764da4b564", "url": "https://github.com/greenplum-db/pxf/commit/aaded7d35549c057cc72bd787933b5764da4b564", "message": "Revert \"Use single quote for globbing\"\n\nThis reverts commit b7851b127d1efb4c40e2f254c62a13a2927150e5.", "committedDate": "2020-11-04T03:53:46Z", "type": "commit"}, {"oid": "53064fe16c22cf4b419cff653710a78481d2c28d", "url": "https://github.com/greenplum-db/pxf/commit/53064fe16c22cf4b419cff653710a78481d2c28d", "message": "Revert \"remove quotes for PXF_HOME\"\n\nThis reverts commit 9374aeff957f66ccd36f9ac6888d47e530de0fd1.", "committedDate": "2020-11-04T03:54:06Z", "type": "commit"}, {"oid": "cb2eabfea637b73a70ea6ed6a04e9f75edb96d88", "url": "https://github.com/greenplum-db/pxf/commit/cb2eabfea637b73a70ea6ed6a04e9f75edb96d88", "message": "Revert \"Address PR feedback\"\n\nThis reverts commit 8316a631f6ee4507ca703b143053a2cf87dbd8eb.", "committedDate": "2020-11-04T03:54:26Z", "type": "commit"}, {"oid": "f388fae1fedd1ea0ac7afc67a9f289c3d0a13dbd", "url": "https://github.com/greenplum-db/pxf/commit/f388fae1fedd1ea0ac7afc67a9f289c3d0a13dbd", "message": "Move CLI test after automation test", "committedDate": "2020-11-04T04:51:56Z", "type": "commit"}]}