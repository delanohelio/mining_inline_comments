{"pr_number": 1707, "pr_title": "[JBTM-3381] Enhance LRA Client for Quarkus", "pr_createdAt": "2020-10-29T11:47:56Z", "pr_url": "https://github.com/jbosstm/narayana/pull/1707", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUxNjg5OQ==", "url": "https://github.com/jbosstm/narayana/pull/1707#discussion_r514516899", "bodyText": "This is a nice spot. I think the clientID would be better encoded (URLEncoder.encode).", "author": "ochaloup", "createdAt": "2020-10-29T19:37:30Z", "path": "rts/lra/client/src/main/java/io/narayana/lra/client/NarayanaLRAClient.java", "diffHunk": "@@ -305,7 +306,7 @@ public URI startLRA(URI parentLRA, String clientID, Long timeout, ChronoUnit uni\n \n             response = client.target(base)\n                 .path(START_PATH)\n-                .queryParam(CLIENT_ID_PARAM_NAME, client)\n+                .queryParam(CLIENT_ID_PARAM_NAME, clientID)", "originalCommit": "a793aa61351ca6f73538b4c83a9e85832afef62e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTAwNTkxNw==", "url": "https://github.com/jbosstm/narayana/pull/1707#discussion_r515005917", "bodyText": "If you're going to encode it then use UTF-8:\n\nURLEncoder.encode(clientID, \"UTF-8\");", "author": "mmusgrov", "createdAt": "2020-10-30T10:38:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUxNjg5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA1MzAzMw==", "url": "https://github.com/jbosstm/narayana/pull/1707#discussion_r515053033", "bodyText": "it's done", "author": "ruromero", "createdAt": "2020-10-30T12:09:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUxNjg5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUxNzY4Ng==", "url": "https://github.com/jbosstm/narayana/pull/1707#discussion_r514517686", "bodyText": "Please with this remove the method error_nullLraOnCreation from the i18NLogger as well.", "author": "ochaloup", "createdAt": "2020-10-29T19:39:05Z", "path": "rts/lra/client/src/main/java/io/narayana/lra/client/NarayanaLRAClient.java", "diffHunk": "@@ -320,13 +321,6 @@ public URI startLRA(URI parentLRA, String clientID, Long timeout, ChronoUnit uni\n             }\n \n             lra = URI.create(response.getHeaderString(HttpHeaders.LOCATION));\n-\n-            if (lra == null) {\n-                LRALogger.i18NLogger.error_nullLraOnCreation(response.toString());", "originalCommit": "a793aa61351ca6f73538b4c83a9e85832afef62e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUxODgwOA==", "url": "https://github.com/jbosstm/narayana/pull/1707#discussion_r514518808", "bodyText": "An idea: what about rather change the joinLRA method to be using long instead of Long?\n(as we are not in 1.0 we can dare to change the public api if agreed it's desirable)", "author": "ochaloup", "createdAt": "2020-10-29T19:41:05Z", "path": "rts/lra/client/src/main/java/io/narayana/lra/client/NarayanaLRAClient.java", "diffHunk": "@@ -641,7 +635,7 @@ private static StringBuilder makeLink(StringBuilder b, String uriPrefix, String\n         return b.append(link);\n     }\n \n-    private URI enlistCompensator(URI lraUri, long timelimit, String uriPrefix,\n+    private URI enlistCompensator(URI lraUri, Long timelimit, String uriPrefix,", "originalCommit": "a793aa61351ca6f73538b4c83a9e85832afef62e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU1OTIxMg==", "url": "https://github.com/jbosstm/narayana/pull/1707#discussion_r514559212", "bodyText": "Well, I tend to prefer the Long as it allows the user to send null which is usually the I don't care equivalent other than having to know beforehand that 0L means wait indefinitely.", "author": "ruromero", "createdAt": "2020-10-29T20:51:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUxODgwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTAwNzk4Nw==", "url": "https://github.com/jbosstm/narayana/pull/1707#discussion_r515007987", "bodyText": "I don't care could be interpreted to mean use a random timeout ;-)\nBTW this is a private method so do we really care, the public API is already using the Long datatype:\n\npublic URI joinLRA(URI lraId, Long timelimit, ...", "author": "mmusgrov", "createdAt": "2020-10-30T10:42:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUxODgwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUyMDMyMA==", "url": "https://github.com/jbosstm/narayana/pull/1707#discussion_r514520320", "bodyText": "With this change we should be consistent in whole LRA impl. The same change should be done in https://github.com/jbosstm/narayana/blob/master/rts/lra/jaxrs/src/main/resources/META-INF/services/javax.ws.rs.client.ClientBuilder.\nI think especially this particular change would be nice to be tracked as a jira.\nFYI @xstefank", "author": "ochaloup", "createdAt": "2020-10-29T19:44:09Z", "path": "rts/lra/client/src/main/resources/META-INF/services/javax.ws.rs.client.ClientBuilder", "diffHunk": "@@ -1 +1 @@\n-org.jboss.resteasy.client.jaxrs.ResteasyClientBuilder\n+org.jboss.resteasy.microprofile.client.impl.MpClientBuilderImpl", "originalCommit": "a793aa61351ca6f73538b4c83a9e85832afef62e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU1OTU3MQ==", "url": "https://github.com/jbosstm/narayana/pull/1707#discussion_r514559571", "bodyText": "If you agree on the change I will create the JIRA for this and move it to a specific PR.", "author": "ruromero", "createdAt": "2020-10-29T20:52:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUyMDMyMA=="}], "type": "inlineReview"}, {"oid": "8ae1a6ac13b03b5cad7a45a94322f0b35a808b95", "url": "https://github.com/jbosstm/narayana/commit/8ae1a6ac13b03b5cad7a45a94322f0b35a808b95", "message": "[JBTM-3381] Enhance Quarkus compatibility\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-10-30T10:09:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3MjQyOA==", "url": "https://github.com/jbosstm/narayana/pull/1707#discussion_r515072428", "bodyText": "Is it wise to encode the clientID? A few of points:\n\nit is not necessarily a URL since client ids are arbitrary strings and it may be confusing to the client to receive back something other that what he set on the start call;\nthe json data returned by the API call for returning LRAs and the format of the returned data doesn't say anything about us encoding the client id\nencoded urls are usually for use in html pages but the client id is not for this purpose.", "author": "mmusgrov", "createdAt": "2020-10-30T12:47:06Z", "path": "rts/lra/client/src/main/java/io/narayana/lra/client/NarayanaLRAClient.java", "diffHunk": "@@ -305,7 +305,7 @@ public URI startLRA(URI parentLRA, String clientID, Long timeout, ChronoUnit uni\n \n             response = client.target(base)\n                 .path(START_PATH)\n-                .queryParam(CLIENT_ID_PARAM_NAME, client)\n+                .queryParam(CLIENT_ID_PARAM_NAME, URLEncoder.encode(clientID, \"UTF-8\"))", "originalCommit": "8ae1a6ac13b03b5cad7a45a94322f0b35a808b95", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE1OTg2MQ==", "url": "https://github.com/jbosstm/narayana/pull/1707#discussion_r515159861", "bodyText": "Encoding of the clientID was my idea. I was afraid that the URL escaped characters won't be correctly transfered and interpreted. I was wrong as I can see from testing the functionality.\nAgree that encoding is not necessary, sorry for misguidance @ruromero", "author": "ochaloup", "createdAt": "2020-10-30T14:56:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3MjQyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIzOTIwNg==", "url": "https://github.com/jbosstm/narayana/pull/1707#discussion_r515239206", "bodyText": "No worries, I have reverted the change.", "author": "ruromero", "createdAt": "2020-10-30T16:54:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3MjQyOA=="}], "type": "inlineReview"}, {"oid": "50f97bb5b339c31473b0b8b06116e3487791cb75", "url": "https://github.com/jbosstm/narayana/commit/50f97bb5b339c31473b0b8b06116e3487791cb75", "message": "[JBTM-3381] Enhance Quarkus compatibility\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-10-30T16:54:29Z", "type": "commit"}, {"oid": "50f97bb5b339c31473b0b8b06116e3487791cb75", "url": "https://github.com/jbosstm/narayana/commit/50f97bb5b339c31473b0b8b06116e3487791cb75", "message": "[JBTM-3381] Enhance Quarkus compatibility\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-10-30T16:54:29Z", "type": "forcePushed"}]}