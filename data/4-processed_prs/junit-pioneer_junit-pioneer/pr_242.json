{"pr_number": 242, "pr_title": "Environmentvariableextension securitymanager tests", "pr_createdAt": "2020-04-25T14:23:10Z", "pr_url": "https://github.com/junit-pioneer/junit-pioneer/pull/242", "timeline": [{"oid": "3861384164c9686ea410b6354cc79a73acdbb733", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/3861384164c9686ea410b6354cc79a73acdbb733", "message": "Add tests for EnvironmentVariableUtilsTests with SecurityManager", "committedDate": "2020-04-25T13:59:41Z", "type": "commit"}, {"oid": "e5db87216277786121796bc0e64cef8866914a82", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/e5db87216277786121796bc0e64cef8866914a82", "message": "adjust comment in policy files", "committedDate": "2020-04-25T14:19:23Z", "type": "commit"}, {"oid": "61099a74f850e8c8d36876b7a3b953f1d9d1eeab", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/61099a74f850e8c8d36876b7a3b953f1d9d1eeab", "message": "add permission for gradle", "committedDate": "2020-04-25T14:50:10Z", "type": "commit"}, {"oid": "fd69896782ff9e1a3ed69c41271b63af4e64e8af", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/fd69896782ff9e1a3ed69c41271b63af4e64e8af", "message": "fix gradle problesm and some refactroing", "committedDate": "2020-04-25T20:49:40Z", "type": "commit"}, {"oid": "2334364fed090f1c6e0b09b1e1496b5404cecf00", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/2334364fed090f1c6e0b09b1e1496b5404cecf00", "message": "fix java 14 problem with assertj logger permission", "committedDate": "2020-04-25T20:55:58Z", "type": "commit"}, {"oid": "acca96ac66824aad9b821f8f1bb839afd3357bc0", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/acca96ac66824aad9b821f8f1bb839afd3357bc0", "message": "fix not enough permissions problem during test execution", "committedDate": "2020-04-25T21:01:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE0NDMzOA==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/242#discussion_r415144338", "bodyText": "Does something like that needs to be called after the SystemProperty java.security.policy is reverted after the test?", "author": "Hancho2009", "createdAt": "2020-04-25T21:06:55Z", "path": "src/test/java/org/junitpioneer/jupiter/EnvironmentVariableUtilsTests.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.jupiter;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatCode;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+\n+import java.security.AccessControlException;\n+import java.security.Policy;\n+\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.Test;\n+\n+@DisplayName(\"EnvironmentVariableUtils\")\n+@ClearEnvironmentVariable(key = \"TEST\")\n+class EnvironmentVariableUtilsTests {\n+\n+\t@Test\n+\t@SetSystemProperty(key = \"java.security.policy\", value = \"file:src/test/resources/default-testing.policy\")\n+\tvoid shouldThrowAccessControlExceptionWithDefaultSecurityManager() {\n+\t\texecuteWithSecurityManager(() -> assertThatThrownBy(() -> EnvironmentVariableUtils.set(\"TEST\", \"TEST\"))\n+\t\t\t\t.isInstanceOf(AccessControlException.class));\n+\t}\n+\n+\t@Test\n+\t@SetSystemProperty(key = \"java.security.policy\", value = \"file:src/test/resources/reflect-permission-testing.policy\")\n+\tvoid shouldModifyEnvironmentVariableIfPermissionIsGiven() {\n+\t\texecuteWithSecurityManager(() -> {\n+\t\t\tassertThatCode(() -> EnvironmentVariableUtils.set(\"TEST\", \"TEST\")).doesNotThrowAnyException();\n+\t\t\tassertThat(System.getenv(\"TEST\")).isEqualTo(\"TEST\");\n+\t\t});\n+\t}\n+\n+\t/*\n+\t * This needs to be done during the execution of the test method and cannot be moved to setup/tear down\n+\t * because junit uses reflection and the default SecurityManager prevents that.\n+\t */\n+\tprivate void executeWithSecurityManager(Runnable runnable) {\n+\t\tPolicy.getPolicy().refresh();", "originalCommit": "acca96ac66824aad9b821f8f1bb839afd3357bc0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNzg1NA==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/242#discussion_r453207854", "bodyText": "According to the official Oracle Java SE documentation\n\nThe refresh method causes the policy object to refresh/reload its data. This operation is implementation-dependent. For example, if the policy object stores its data in configuration files, calling refresh will cause it to re-read the configuration policy files. If a refresh operation is not supported, this method does nothing. Note that refreshed policy may not have an effect on classes in a particular ProtectionDomain. This is dependent on the Policy provider's implementation of the implies method and its PermissionCollection caching strategy.\n\nTo me, this reads like you should call it to properly reset the policy?", "author": "Michael1993", "createdAt": "2020-07-11T15:53:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE0NDMzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwODE1Nw==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/242#discussion_r453208157", "bodyText": "If you want to test if resetting the policy works as expected, you should probably add a new test for that and add @Order to your suite. Here is a blog post from Baeldung on that topic.", "author": "Michael1993", "createdAt": "2020-07-11T15:57:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE0NDMzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE4OTc0OQ==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/242#discussion_r453189749", "bodyText": "I'd have named this variable original. Everywhere it is used it is clear that it's a SecurityManager, so naming it securityManager is redundant - however System.setSecurityManager(original) clearly communicates that we reset (and not modify) the SecurityManager.\nThis is just a sidenote, don't feel the need to modify the PR just for this.", "author": "Michael1993", "createdAt": "2020-07-11T12:21:31Z", "path": "src/test/java/org/junitpioneer/jupiter/EnvironmentVariableUtilsTests.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.jupiter;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatCode;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+\n+import java.security.AccessControlException;\n+import java.security.Policy;\n+\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.Test;\n+\n+@DisplayName(\"EnvironmentVariableUtils\")\n+@ClearEnvironmentVariable(key = \"TEST\")\n+class EnvironmentVariableUtilsTests {\n+\n+\t@Test\n+\t@SetSystemProperty(key = \"java.security.policy\", value = \"file:src/test/resources/default-testing.policy\")\n+\tvoid shouldThrowAccessControlExceptionWithDefaultSecurityManager() {\n+\t\texecuteWithSecurityManager(() -> assertThatThrownBy(() -> EnvironmentVariableUtils.set(\"TEST\", \"TEST\"))\n+\t\t\t\t.isInstanceOf(AccessControlException.class));\n+\t}\n+\n+\t@Test\n+\t@SetSystemProperty(key = \"java.security.policy\", value = \"file:src/test/resources/reflect-permission-testing.policy\")\n+\tvoid shouldModifyEnvironmentVariableIfPermissionIsGiven() {\n+\t\texecuteWithSecurityManager(() -> {\n+\t\t\tassertThatCode(() -> EnvironmentVariableUtils.set(\"TEST\", \"TEST\")).doesNotThrowAnyException();\n+\t\t\tassertThat(System.getenv(\"TEST\")).isEqualTo(\"TEST\");\n+\t\t});\n+\t}\n+\n+\t/*\n+\t * This needs to be done during the execution of the test method and cannot be moved to setup/tear down\n+\t * because junit uses reflection and the default SecurityManager prevents that.\n+\t */\n+\tprivate void executeWithSecurityManager(Runnable runnable) {\n+\t\tPolicy.getPolicy().refresh();\n+\t\tSecurityManager securityManager = System.getSecurityManager();", "originalCommit": "acca96ac66824aad9b821f8f1bb839afd3357bc0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE5Njc4NQ==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/242#discussion_r453196785", "bodyText": "I'd have named this variable original. Everywhere it is used it is clear that it's a SecurityManager, so naming it securityManager is redundant - however System.setSecurityManager(original) clearly communicates that we reset (and not modify) the SecurityManager.\nThis is just a sidenote, don't feel the need to modify the PR just for this.\n\nI would not rename the variable! It only seems redundant because of Java 8. With 10+, using var at this section it would not be clear what a variable with the name original holds.", "author": "Bukama", "createdAt": "2020-07-11T13:47:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE4OTc0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE5OTMyMA==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/242#discussion_r453199320", "bodyText": "I mean, even with var it would look like this:\nvar original = System.getSecurityManager();\n// ... other code ...\nSystem.setSecurityManager(original);\n\nSeems clear to me?", "author": "Michael1993", "createdAt": "2020-07-11T14:15:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE4OTc0OQ=="}], "type": "inlineReview"}, {"oid": "6c46b8763a7e2da974123d2982b31fce2e637357", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/6c46b8763a7e2da974123d2982b31fce2e637357", "message": "renamed local variable CR", "committedDate": "2020-07-11T19:31:41Z", "type": "commit"}, {"oid": "d668163932083808b29f8c03bb752c58bf877e5f", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/d668163932083808b29f8c03bb752c58bf877e5f", "message": "Merge pull request #2 from junit-pioneer/master\n\nUpdate", "committedDate": "2020-07-11T19:42:21Z", "type": "commit"}, {"oid": "41edd0d91a045021c6b28e6c7019af7e1d29308b", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/41edd0d91a045021c6b28e6c7019af7e1d29308b", "message": "Merge remote-tracking branch 'origin/master' into environmentvariableextension-securitymanager-tests\n\n# Conflicts:\n#\tsrc/test/java/org/junitpioneer/jupiter/EnvironmentVariableUtilsTests.java", "committedDate": "2020-07-11T19:45:23Z", "type": "commit"}, {"oid": "e726aca439e2cd1b0931afa96110417c30535733", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/e726aca439e2cd1b0931afa96110417c30535733", "message": "- class should not be public api\n- changed exception handling so no exception is hidden if could not modify environment variables\n- adjust comment setInSystemEnvClass because it also works on osx", "committedDate": "2020-07-11T19:56:26Z", "type": "commit"}, {"oid": "50ea8ee55a81ae3fbc2e661f091f09639c5b5621", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/50ea8ee55a81ae3fbc2e661f091f09639c5b5621", "message": "format block comment", "committedDate": "2020-07-11T20:01:12Z", "type": "commit"}, {"oid": "c391d1f82b7211f84236f8028d243af13ba14cf6", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/c391d1f82b7211f84236f8028d243af13ba14cf6", "message": "format block comment", "committedDate": "2020-07-11T20:02:29Z", "type": "commit"}, {"oid": "fdd498db1cc03819b8855127ac815cf238b8ba76", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/fdd498db1cc03819b8855127ac815cf238b8ba76", "message": "Reorder code and add comment", "committedDate": "2020-07-14T20:05:03Z", "type": "commit"}, {"oid": "c4599f4e9fd8576703ca6c2dc611e87949778aeb", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/c4599f4e9fd8576703ca6c2dc611e87949778aeb", "message": "Add contribution to README", "committedDate": "2020-07-14T20:07:32Z", "type": "commit"}]}