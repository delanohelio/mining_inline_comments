{"pr_number": 214, "pr_title": "Improve GitHub Actions workflow", "pr_createdAt": "2020-04-01T07:13:17Z", "pr_url": "https://github.com/junit-pioneer/junit-pioneer/pull/214", "timeline": [{"oid": "44091d5dd92f9fc90b579afebc0b07c1f82a9cd2", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/44091d5dd92f9fc90b579afebc0b07c1f82a9cd2", "message": "Cache Sonar files", "committedDate": "2020-04-01T06:49:59Z", "type": "commit"}, {"oid": "d9883bae8aae518e260d433ca03b5ba819f85609", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/d9883bae8aae518e260d433ca03b5ba819f85609", "message": "Fetch unshallow to enable blame for Sonar", "committedDate": "2020-04-01T06:52:53Z", "type": "commit"}, {"oid": "fb20a768e235c766ae14f1e3551dea2b39a8df11", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/fb20a768e235c766ae14f1e3551dea2b39a8df11", "message": "Use name consistently for all steps", "committedDate": "2020-04-01T06:54:23Z", "type": "commit"}, {"oid": "7939d4576e8daef617c16c36ae414b601c2289cb", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/7939d4576e8daef617c16c36ae414b601c2289cb", "message": "Cache Gradle files", "committedDate": "2020-04-01T07:16:42Z", "type": "commit"}, {"oid": "8c3d94591eba9d08fa43c30a4e7983a0c041f028", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/8c3d94591eba9d08fa43c30a4e7983a0c041f028", "message": "Always build on push\n\nAccording to the docs:\n\n* https://help.github.com/en/actions/reference/events-that-trigger-workflows#pull-request-event-pull_request\n* https://help.github.com/en/actions/reference/events-that-trigger-workflows#push-event-push\n\n`pull_request` is for PRs from forked repos. `push` is for pushes to any branch, which I think is helpful for contributors to check there own builds.", "committedDate": "2020-04-01T09:08:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTUzMTY3Ng==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/214#discussion_r401531676", "bodyText": "i do not think that we really need a build on each push to all branches. master alone is fine. Based on shipkit we also do not want build on tags i think.", "author": "aepfli", "createdAt": "2020-04-01T11:02:03Z", "path": ".github/workflows/actions.yml", "diffHunk": "@@ -3,11 +3,7 @@\n \n name: JUnit Pioneer Flow\n \n-on:\n-  push:\n-    branches: [ master ]\n-  pull_request:\n-    branches: '*'\n+on: [push, pull_request]", "originalCommit": "8c3d94591eba9d08fa43c30a4e7983a0c041f028", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTU1Mzg1OQ==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/214#discussion_r401553859", "bodyText": "What is the downside of building on each push? If we don't touch the parallelization limit such that jobs are queued/blocked, I would personally find this helpful as I cannot locally verify the build matrix. As a contributor, I wish to get that feedback before opening a PR.\nRegarding Shipkit: unfortunately, I haven't really worked with it so far. This might be an issue because I don't know how these CI skips work (neither in general nor in combination with GHA).\nI would suggest to revert this commit and discuss that separately, maybe also in the course of #193.", "author": "beatngu13", "createdAt": "2020-04-01T11:46:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTUzMTY3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTU2NTc0OA==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/214#discussion_r401565748", "bodyText": "I have to admit, i did not take the contributor part into consideration, but, i am also thinking about resource usage etc. and i am not sure, if we really need a build on 3 jdks with 3 OS for a branch in development.\nThe thing we really should take care of, is to not build on a tag push. Shipkit will create a tag and push it, hence that the build on master will trigger a another build, which is imho not needed at all. Hence that i would exclude tags.\n[ci skip] is not working on GHA as it is a travis default\n[ci skip-release] is something offered by skipkit \nwe could although configure our own \"commit postfix\" to prevent a release - to make it easier for @nicolaiparlog to not trigger a build :)", "author": "aepfli", "createdAt": "2020-04-01T12:09:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTUzMTY3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTUzNTI3Nw==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/214#discussion_r401535277", "bodyText": "not sure if we need an extra step we could also inline this into the checkout step - https://github.com/actions/checkout#fetch-all-history-for-all-tags-and-branches", "author": "aepfli", "createdAt": "2020-04-01T11:09:36Z", "path": ".github/workflows/actions.yml", "diffHunk": "@@ -19,11 +15,26 @@ jobs:\n         os: [ubuntu-latest, windows-latest, macos-latest]\n     name: ${{ matrix.os }} - Java ${{ matrix.java }}\n     steps:\n-      - uses: actions/checkout@v2\n+      - name: Check out repo\n+        uses: actions/checkout@v2\n+        # fetch unshallow to enable blame for Sonar\n+      - name: Fetch unshallow", "originalCommit": "8c3d94591eba9d08fa43c30a4e7983a0c041f028", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTU0NzAwMg==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/214#discussion_r401547002", "bodyText": "AFAIK the first step does the actual checkout with a bunch of optimizations:\nhttps://github.com/beatngu13/junit-pioneer/runs/551399103?check_suite_focus=true#step:2:1\nWhereas the second step only fetches the history:\nhttps://github.com/beatngu13/junit-pioneer/runs/551399103?check_suite_focus=true#step:3:1\nI don't think we can use one without the other? Unless we do the checkout manually and avoid setting depth to 1 (like here).\nProbably related to this feature request:\nactions/checkout#204", "author": "beatngu13", "createdAt": "2020-04-01T11:32:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTUzNTI3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTU1MjM5Mg==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/214#discussion_r401552392", "bodyText": "maybe i miss understood the logic in the readme of the action\n- uses: actions/checkout@v2\n- run: |\n    git fetch shallow--prune --un\n\ni thought based on this we can just do\n  - name: Check out repo\n        uses: actions/checkout@v2\n        run: |\n             git fetch shallow--prune --un\n\nBut it also seams like i miss read yaml once again, and ignored the - which i just realized by writing this comment :)", "author": "aepfli", "createdAt": "2020-04-01T11:43:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTUzNTI3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTUzNjg3MA==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/214#discussion_r401536870", "bodyText": "sonar only runs on ubuntu and only on one JDK - maybe we should take this into consideration.", "author": "aepfli", "createdAt": "2020-04-01T11:12:41Z", "path": ".github/workflows/actions.yml", "diffHunk": "@@ -19,11 +15,26 @@ jobs:\n         os: [ubuntu-latest, windows-latest, macos-latest]\n     name: ${{ matrix.os }} - Java ${{ matrix.java }}\n     steps:\n-      - uses: actions/checkout@v2\n+      - name: Check out repo\n+        uses: actions/checkout@v2\n+        # fetch unshallow to enable blame for Sonar\n+      - name: Fetch unshallow\n+        run: git fetch --prune --unshallow\n       - name: Setup java\n         uses: actions/setup-java@v1\n         with:\n           java-version: ${{ matrix.java }}\n+      - name: Cache Gradle\n+        uses: actions/cache@v1\n+        with:\n+          path: ~/.gradle/caches/\n+          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*') }}\n+          restore-keys: ${{ runner.os }}-gradle-\n+      - name: Cache Sonar", "originalCommit": "8c3d94591eba9d08fa43c30a4e7983a0c041f028", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTU0NzI2Ng==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/214#discussion_r401547266", "bodyText": "Good catch, thx! Will fix that.", "author": "beatngu13", "createdAt": "2020-04-01T11:32:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTUzNjg3MA=="}], "type": "inlineReview"}, {"oid": "ba0cd52fec84eae7f8b2aad8628c254ee7793187", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/ba0cd52fec84eae7f8b2aad8628c254ee7793187", "message": "Revert \"Always build on push\"\n\nThis reverts commit 8c3d94591eba9d08fa43c30a4e7983a0c041f028.", "committedDate": "2020-04-01T13:30:52Z", "type": "commit"}, {"oid": "73604de1a3fef4e2b73961d5fdcf6f676653367a", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/73604de1a3fef4e2b73961d5fdcf6f676653367a", "message": "Cache conditionally\n\nAnd move `if` from \"Sonarqube\" step upwards, similar to \"Upload Release to GitHub\".", "committedDate": "2020-04-01T13:34:50Z", "type": "commit"}]}