{"pr_number": 576, "pr_title": "DEVX - Automatically promote PRs to staging", "pr_createdAt": "2020-10-07T16:58:07Z", "pr_url": "https://github.com/confluentinc/kafka-tutorials/pull/576", "timeline": [{"oid": "1adf749eeff268f814b275baa766535958ca53bb", "url": "https://github.com/confluentinc/kafka-tutorials/commit/1adf749eeff268f814b275baa766535958ca53bb", "message": "Testing auto-deploy for PRs", "committedDate": "2020-10-07T16:53:53Z", "type": "commit"}, {"oid": "27bf29b68eb89f59515c4a37a5261808662970af", "url": "https://github.com/confluentinc/kafka-tutorials/commit/27bf29b68eb89f59515c4a37a5261808662970af", "message": "trying to fix semaphore file syntax", "committedDate": "2020-10-07T17:05:05Z", "type": "commit"}, {"oid": "ff7d91093eceec6e2c5b386f536299eb886dd0b9", "url": "https://github.com/confluentinc/kafka-tutorials/commit/ff7d91093eceec6e2c5b386f536299eb886dd0b9", "message": "Trying to add 'result' condition", "committedDate": "2020-10-07T17:09:09Z", "type": "commit"}, {"oid": "2fc79a8cd150d6f0e2399cc683d3e5ef909c2d91", "url": "https://github.com/confluentinc/kafka-tutorials/commit/2fc79a8cd150d6f0e2399cc683d3e5ef909c2d91", "message": "fix name of promotion file, try newer syntax", "committedDate": "2020-10-07T17:24:48Z", "type": "commit"}, {"oid": "6b0c592c6445ee7f7a87e359a2e00f7a6d921e75", "url": "https://github.com/confluentinc/kafka-tutorials/commit/6b0c592c6445ee7f7a87e359a2e00f7a6d921e75", "message": "fix expression language", "committedDate": "2020-10-07T17:26:40Z", "type": "commit"}, {"oid": "b547064975a2848e56eb234e8164ae5affd6550a", "url": "https://github.com/confluentinc/kafka-tutorials/commit/b547064975a2848e56eb234e8164ae5affd6550a", "message": "add missing end quote", "committedDate": "2020-10-07T17:49:45Z", "type": "commit"}, {"oid": "06cd49ec675f5fc7b54b28d5d45ec79514cb2dc2", "url": "https://github.com/confluentinc/kafka-tutorials/commit/06cd49ec675f5fc7b54b28d5d45ec79514cb2dc2", "message": "try removing retrieving from cache", "committedDate": "2020-10-07T18:07:19Z", "type": "commit"}, {"oid": "867915f7fbd2919fb2e6d1a912243b7fc1350e57", "url": "https://github.com/confluentinc/kafka-tutorials/commit/867915f7fbd2919fb2e6d1a912243b7fc1350e57", "message": "removing semaphore hash to see if that works", "committedDate": "2020-10-07T18:28:59Z", "type": "commit"}, {"oid": "3ceb0e1d9b507807f4c31a58723a21a8af524ba3", "url": "https://github.com/confluentinc/kafka-tutorials/commit/3ceb0e1d9b507807f4c31a58723a21a8af524ba3", "message": "Stage PRs automatically when not master, release or dependabot", "committedDate": "2020-10-07T20:03:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI4Nzk3Mg==", "url": "https://github.com/confluentinc/kafka-tutorials/pull/576#discussion_r501287972", "bodyText": "This rule is needed so any PR automatically promoted except for dependabot PRs.", "author": "bbejeck", "createdAt": "2020-10-07T20:25:15Z", "path": ".semaphore/semaphore.yml", "diffHunk": "@@ -20,6 +20,11 @@ promotions:\n         branch:\n           - ^master$\n \n+  - name: Stage PRs for review \n+    pipeline_file: pr-staging-deploy.yml\n+    auto_promote:\n+      when: \"branch != 'master' or branch != 'release' or branch !~ '^dependabot\\.'\"", "originalCommit": "3ceb0e1d9b507807f4c31a58723a21a8af524ba3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI4ODQxOA==", "url": "https://github.com/confluentinc/kafka-tutorials/pull/576#discussion_r501288418", "bodyText": "needed to change this since I removed the $SEMAPHORE_GIT_SHA", "author": "bbejeck", "createdAt": "2020-10-07T20:26:09Z", "path": ".semaphore/semaphore.yml", "diffHunk": "@@ -34,8 +39,8 @@ blocks:\n       jobs:\n         - name: Compile with Jekyll\n           commands:\n-            - bundle exec jekyll build --baseurl \"/$SEMAPHORE_GIT_BRANCH/$SEMAPHORE_GIT_SHA\"\n-            - cache store site-$SEMAPHORE_GIT_SHA _site\n+            - bundle exec jekyll build --baseurl \"/$SEMAPHORE_GIT_BRANCH\"\n+            - cache store site-$SEMAPHORE_GIT_BRANCH _site", "originalCommit": "3ceb0e1d9b507807f4c31a58723a21a8af524ba3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI5MzEzMg==", "url": "https://github.com/confluentinc/kafka-tutorials/pull/576#discussion_r501293132", "bodyText": "The SHA was removed from the deployment path, but you might want to use it for the cache key as before. Consider a scenario where you went back to an older job for a branch and hit the deploy to staging button. With the current change, it would not deploy the site from the SHA that this older job built; semaphore would redeploy the latest build", "author": "colinhicks", "createdAt": "2020-10-07T20:34:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI4ODQxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI4ODUyNA==", "url": "https://github.com/confluentinc/kafka-tutorials/pull/576#discussion_r501288524", "bodyText": "same here", "author": "bbejeck", "createdAt": "2020-10-07T20:26:19Z", "path": ".semaphore/staging-site-deploy.yml", "diffHunk": "@@ -13,6 +13,6 @@ blocks:\n         - name: Compile and deploy site\n           commands:\n             - checkout\n-            - cache restore site-$SEMAPHORE_GIT_SHA\n-            - aws s3 cp --recursive ./_site \"s3://kafka-tutorials-staging/$SEMAPHORE_GIT_BRANCH/$SEMAPHORE_GIT_SHA/\"\n-            - echo \"Deployed to http://kafka-tutorials-staging.s3-website-us-west-2.amazonaws.com/$SEMAPHORE_GIT_BRANCH/$SEMAPHORE_GIT_SHA/\"\n+            - cache restore site-$SEMAPHORE_GIT_BRANCH", "originalCommit": "3ceb0e1d9b507807f4c31a58723a21a8af524ba3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI5MTU0OA==", "url": "https://github.com/confluentinc/kafka-tutorials/pull/576#discussion_r501291548", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  when: \"branch != 'master' or branch != 'release' or branch !~ '^dependabot\\.'\"\n          \n          \n            \n                  when: \"branch != 'master' and branch != 'release' and branch !~ '^dependabot\\.'\"", "author": "colinhicks", "createdAt": "2020-10-07T20:31:54Z", "path": ".semaphore/semaphore.yml", "diffHunk": "@@ -20,6 +20,11 @@ promotions:\n         branch:\n           - ^master$\n \n+  - name: Stage PRs for review \n+    pipeline_file: pr-staging-deploy.yml\n+    auto_promote:\n+      when: \"branch != 'master' or branch != 'release' or branch !~ '^dependabot\\.'\"", "originalCommit": "3ceb0e1d9b507807f4c31a58723a21a8af524ba3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI5MjgzNA==", "url": "https://github.com/confluentinc/kafka-tutorials/pull/576#discussion_r501292834", "bodyText": "Thanks,  @colinhicks, that is a better condition", "author": "bbejeck", "createdAt": "2020-10-07T20:34:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI5MTU0OA=="}], "type": "inlineReview"}, {"oid": "abc1620510f31971d2b3af328e6948dd59e72089", "url": "https://github.com/confluentinc/kafka-tutorials/commit/abc1620510f31971d2b3af328e6948dd59e72089", "message": "Apply suggestions from code review\n\nCo-authored-by: Colin Hicks <colin.hicks@confluent.io>", "committedDate": "2020-10-07T20:33:07Z", "type": "commit"}, {"oid": "127fdacaae116c54c95eb3ce43700421a72314a6", "url": "https://github.com/confluentinc/kafka-tutorials/commit/127fdacaae116c54c95eb3ce43700421a72314a6", "message": "Add back using semaphore git sha for cache key", "committedDate": "2020-10-07T21:49:31Z", "type": "commit"}, {"oid": "1c412fc09ce672cb13f05ac87f0ec4e7dd274340", "url": "https://github.com/confluentinc/kafka-tutorials/commit/1c412fc09ce672cb13f05ac87f0ec4e7dd274340", "message": "Merge branch 'DEVX_test_auto_deploy_of_pr' of github.com:confluentinc/kafka-tutorials into DEVX_test_auto_deploy_of_pr", "committedDate": "2020-10-07T21:50:27Z", "type": "commit"}]}