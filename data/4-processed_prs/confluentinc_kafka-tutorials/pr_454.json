{"pr_number": 454, "pr_title": "Addresses GH issue #453: Allow single KT to run and not automatically\u2026", "pr_createdAt": "2020-06-25T18:39:32Z", "pr_url": "https://github.com/confluentinc/kafka-tutorials/pull/454", "timeline": [{"oid": "ebe785a61b0a93e99b81785b5832d50535654e35", "url": "https://github.com/confluentinc/kafka-tutorials/commit/ebe785a61b0a93e99b81785b5832d50535654e35", "message": "Addresses GH issue #453: Allow single KT to run and not automatically destroy resources", "committedDate": "2020-06-25T18:38:59Z", "type": "commit"}, {"oid": "997d91279913011d6adb77943507fa64f17d8c81", "url": "https://github.com/confluentinc/kafka-tutorials/commit/997d91279913011d6adb77943507fa64f17d8c81", "message": "Tweak README", "committedDate": "2020-06-25T18:42:54Z", "type": "commit"}, {"oid": "d75cb91f22f27eda9308f573d87da588b0d55d95", "url": "https://github.com/confluentinc/kafka-tutorials/commit/d75cb91f22f27eda9308f573d87da588b0d55d95", "message": "Move text", "committedDate": "2020-06-25T18:48:18Z", "type": "commit"}, {"oid": "fe2fd33c05f36f50bf1bf6590f3ecfd78cb43207", "url": "https://github.com/confluentinc/kafka-tutorials/commit/fe2fd33c05f36f50bf1bf6590f3ecfd78cb43207", "message": "Add removed file", "committedDate": "2020-06-25T18:51:59Z", "type": "commit"}, {"oid": "7424893ec6fcb8e1d985474baeca8c46970aaddf", "url": "https://github.com/confluentinc/kafka-tutorials/commit/7424893ec6fcb8e1d985474baeca8c46970aaddf", "message": "Tweak spaces", "committedDate": "2020-06-25T18:52:36Z", "type": "commit"}, {"oid": "d07e1c57d658625e82fb5aa9ec251cc0bcfd3385", "url": "https://github.com/confluentinc/kafka-tutorials/commit/d07e1c57d658625e82fb5aa9ec251cc0bcfd3385", "message": "Restoring original _includes/tutorials/transforming/kstreams/code/tutorial-steps/dev/outputs/actual-movies.json", "committedDate": "2020-06-25T20:19:30Z", "type": "commit"}, {"oid": "dc82566ab7b12bc58fd147c8c3a3794195d1f03a", "url": "https://github.com/confluentinc/kafka-tutorials/commit/dc82566ab7b12bc58fd147c8c3a3794195d1f03a", "message": "README tweak", "committedDate": "2020-06-25T20:22:04Z", "type": "commit"}, {"oid": "9ae357a256cb4f4052568e535676f0c26b1ac476", "url": "https://github.com/confluentinc/kafka-tutorials/commit/9ae357a256cb4f4052568e535676f0c26b1ac476", "message": "Update templates as well", "committedDate": "2020-06-25T20:30:01Z", "type": "commit"}, {"oid": "29f3ba702dbd04923f09355cc24613bae8cedb13", "url": "https://github.com/confluentinc/kafka-tutorials/commit/29f3ba702dbd04923f09355cc24613bae8cedb13", "message": "Add gradle as a dependency", "committedDate": "2020-06-26T12:08:59Z", "type": "commit"}, {"oid": "9bcdff48ec12b19dc7814d19770d33c4e825bcce", "url": "https://github.com/confluentinc/kafka-tutorials/commit/9bcdff48ec12b19dc7814d19770d33c4e825bcce", "message": "Spelling errors", "committedDate": "2020-06-26T12:36:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI4NTgwNw==", "url": "https://github.com/confluentinc/kafka-tutorials/pull/454#discussion_r446285807", "bodyText": "Now you can play with the environment, some sample commands shown below.\ndocker exec broker kafka-topics --list --bootstrap-server localhost:9092\ndocker exec -it ksqldb-cli ksql http://ksqldb-server:8088   \n\nDon't forget to shutdown Docker containers when you are done\ndocker-compose down --volumes", "author": "bbejeck", "createdAt": "2020-06-26T16:27:39Z", "path": "README.md", "diffHunk": "@@ -253,30 +252,68 @@ Lastly, create a Makefile in the `code` directory to invoke the harness runner a\n \n ## Testing Locally\n \n-Given the test harness is the `heart` of a tutorial, it will be helpful to describe in detail how to work with a `kafka|ksql|kstreams.yml` file.  You should note the harness file is in the [YAML file format](https://en.wikipedia.org/wiki/YAML), so formatting properly is essential.  The harness files generate the rendered tutorial structure and validate any output of tutorial steps against expected values.\n+The [Kafka Tutorials microsite](https://kafka-tutorials.confluent.io/) shows how to manually execute each tutorial step-by-step.\n+However, there are some scenarios when a user may want to run and test a tutorial in a more automated fashion:\n \n-New tutorial authors should not need to create a harness file from scratch, using either the `tools/gen_project.sh` or  `tools/clone.sh` script will provide a usable harness file.  This section should provide enough guidance to add, update, or remove parts as needed.\n+1. End-to-end: user makes a small change to the code and wants to validate that the tutorial still works end-to-end\n+2. Run-and-play: user runs a tutorial and wants to leave it running to play with the environment\n \n-#### TL;DR\n+This section describes how you can do this using the `harness-runner` to programmatically run a single tutorial.\n \n-To run a tutorial programmatically, do the following steps. Note to follow these instructions you'll need to check out the kafka-tutorials repo:\n+### TL;DR\n \n-1. git clone https://github.com/confluentinc/kafka-tutorials.git\n-2. cd kafka-tutorials\n+To run a tutorial programmatically, do the following steps.\n \n-Once you have the kafka-tutorials repo checked out do the following:\n+1. Check out the kafka-tutorials GitHub repo:\n \n-1. Create a `Dockerfile` with the following content:\n-    ```text\n-     FROM python:3.7-slim\n-     RUN pip3 install pyyaml\n-    ```\n-2. Then run the following command to build and execute the docker image:\n-    * `docker build -t runner . ; docker run -v ${PWD}/harness_runner:/harness_runner/ -it --rm runner bash -c 'cd /harness_runner/ && pip3 install -e .'`\n+```bash\n+git clone https://github.com/confluentinc/kafka-tutorials.git\n+cd kafka-tutorials\n+```\n+\n+2. Install the packages for the harness runner.\n+\n+If you have `pip3` installed locally:\n+\n+```bash\n+(cd /harness_runner/ && pip3 install -e .)\n+```\n+\n+If you don't have `pip3` installed locally, create a `Dockerfile` with the following content:\n+\n+```text\n+FROM python:3.7-slim\n+RUN pip3 install pyyaml\n+```\n+\n+and then run the following command to build and execute the Docker image:\n+\n+```\n+docker build -t runner . ; docker run -v ${PWD}/harness_runner:/harness_runner/ -it --rm runner bash -c 'cd /harness_runner/ && pip3 install -e .'\n+```\n+\n+3. Install [gradle](https://gradle.org/install/) for tutorials that compile any code.\n \n-3. run the `make` command\n-   * `(cd _includes/tutorials/<tutorial name>/<type>/code && make)` where type is one of `ksql | kstreams | kafka`.\n-   * For example `(cd _includes/tutorials/transforming/kstreams/code/ && make)`\n+4. End-to-end: run the harness runner for a single tutorial by calling `make`, across all `dev`, `test`, and `prod` stages, to validate it works end-to-end. Identify the tutorial you want and then run `make`. Note that this destroys all the resources and Docker containers it created, so it cleans up after itself.  Format: `(cd _includes/tutorials/<tutorial name>/<type>/code && make)` where type is one of `ksql | kstreams | kafka`. Example:\n+\n+```\n+(cd _includes/tutorials/transforming/kstreams/code/ && make)\n+```\n+\n+5. Run-and-play: run the harness runner for a single tutorial by calling `make SEQUENCE=\"dev, test\"`, just across `dev` and `test` stages, which leaves all resources and Docker containers running so you can then play with it.  Format: `(cd _includes/tutorials/<tutorial name>/<type>/code && make SEQUENCE=\"dev, test\")` where type is one of `ksql | kstreams | kafka`. Example:\n+\n+```\n+(cd _includes/tutorials/transforming/kstreams/code/ && make SEQUENCE=\"dev, test\")\n+```\n+\n+Now you can play with the environment, some sample commands shown below.  Don't forget to shutdown Docker containers when you are done.\n+\n+```\n+docker exec broker kafka-topics --list --bootstrap-server localhost:9092\n+docker exec -it ksqldb-cli ksql http://ksqldb-server:8088               \n+```", "originalCommit": "9bcdff48ec12b19dc7814d19770d33c4e825bcce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMzYzMQ==", "url": "https://github.com/confluentinc/kafka-tutorials/pull/454#discussion_r446323631", "bodyText": "@bbejeck docker-compose  commands work only when in the same directory as the docker-compose.yml file.  Given that we used paranthesis above, docker-compose down won't work.\nEven more so, when I go to the code directory, docker-compose down still doesn't work, even when specifying the file:\n[13:41:49] ~/git/kafka-tutorials/_includes/tutorials/transforming/kstreams/code(GH-453) \u2717: docker-compose -f docker-compose.yml down\nRemoving network code_default\nWARNING: Network code_default not found.\n\nThis is related to the fact that the network name is actually the tutorial name?\n[13:44:42] ~/git/kafka-tutorials(GH-453) \u2717: docker network ls\nNETWORK ID          NAME                             DRIVER              SCOPE\nd4df5164f7b9        aggregate-count_default          bridge              local\n75520b89149e        bridge                           bridge              local\n4c18151eaff9        cp-quickstart_default            bridge              local\nd639ef2917d8        deserialization-errors_default   bridge              local\n37b64e95c60b        filter-events_default            bridge              local\nd6828ef3dd7b        host                             host                local\n8bd7f7b2b6e8        none                             null                local\n3d89dfb0a11b        transform-stream_default         bridge              local\n71c10396a7c3        udf_default                      bridge              local\n77adee89a504        utils_default                    bridge              local\n\nWhat if we just tell users how to get docker container info with:\ndocker container ls\ndocker container rm -f <container id>", "author": "ybyzek", "createdAt": "2020-06-26T17:43:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI4NTgwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyODQyNw==", "url": "https://github.com/confluentinc/kafka-tutorials/pull/454#discussion_r446328427", "bodyText": "This is related to the fact that the network name is actually the tutorial name?\n\nNot sure.\nwhat about\ndocker container ls | grep <tutorial-name> | xargs docker container rm -f\n\nnot sure that even works, it's just a suggestion", "author": "bbejeck", "createdAt": "2020-06-26T17:53:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI4NTgwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMzNTc0OA==", "url": "https://github.com/confluentinc/kafka-tutorials/pull/454#discussion_r446335748", "bodyText": "@bbejeck Unfortunately docker container ls does not provide the tutorial name:\n[14:09:06] ~/git/kafka-tutorials(GH-453) \u2717: docker container ls\nCONTAINER ID        IMAGE                                    COMMAND                  CREATED             STATUS              PORTS                                        NAMES\n7e9fc9ffaf24        confluentinc/ksqldb-server:0.7.1         \"/usr/bin/docker/run\"    12 seconds ago      Up 11 seconds       0.0.0.0:8088->8088/tcp                       ksqldb-server\nf9441e503e6a        confluentinc/cp-schema-registry:5.5.0    \"/etc/confluent/dock\u2026\"   23 minutes ago      Up 23 minutes       0.0.0.0:8081->8081/tcp                       schema-registry\nd0b328c59187        confluentinc/cp-enterprise-kafka:5.5.0   \"/etc/confluent/dock\u2026\"   23 minutes ago      Up 23 minutes       9092/tcp, 0.0.0.0:29092->29092/tcp           broker\n3d321fee7116        confluentinc/cp-zookeeper:5.5.0          \"/etc/confluent/dock\u2026\"   23 minutes ago      Up 23 minutes       2888/tcp, 0.0.0.0:2181->2181/tcp, 3888/tcp   zookeeper", "author": "ybyzek", "createdAt": "2020-06-26T18:09:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI4NTgwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMzNzkyNA==", "url": "https://github.com/confluentinc/kafka-tutorials/pull/454#discussion_r446337924", "bodyText": "I meant docker network ls since it seems the tutorial name is used for the network name.\nAt any rate, what you have is fine", "author": "bbejeck", "createdAt": "2020-06-26T18:14:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI4NTgwNw=="}], "type": "inlineReview"}, {"oid": "305b1526c2ff733794afc7bd26cc3b0c5f649d4c", "url": "https://github.com/confluentinc/kafka-tutorials/commit/305b1526c2ff733794afc7bd26cc3b0c5f649d4c", "message": "Add command examples for removing Docker containers", "committedDate": "2020-06-26T18:12:27Z", "type": "commit"}, {"oid": "018b47f8eb6f746a13c4f545589ccf77a9055661", "url": "https://github.com/confluentinc/kafka-tutorials/commit/018b47f8eb6f746a13c4f545589ccf77a9055661", "message": "Tweak README and add Docker Compose as prereq", "committedDate": "2020-06-26T19:28:12Z", "type": "commit"}, {"oid": "d17456b2a6ca2279fbd818c8d0af408ccce6f0bc", "url": "https://github.com/confluentinc/kafka-tutorials/commit/d17456b2a6ca2279fbd818c8d0af408ccce6f0bc", "message": "Convert absolute links to relative links", "committedDate": "2020-06-26T19:32:52Z", "type": "commit"}, {"oid": "f5b5c95800e42a210af2ca3910a1cd9956054ba8", "url": "https://github.com/confluentinc/kafka-tutorials/commit/f5b5c95800e42a210af2ca3910a1cd9956054ba8", "message": "Merge branch 'master' into GH-453", "committedDate": "2020-06-27T01:05:59Z", "type": "commit"}]}