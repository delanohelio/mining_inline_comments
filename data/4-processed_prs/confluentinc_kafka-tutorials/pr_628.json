{"pr_number": 628, "pr_title": "DEVX-2217: Convert nested JSON recipe to KT", "pr_createdAt": "2020-11-13T01:07:42Z", "pr_url": "https://github.com/confluentinc/kafka-tutorials/pull/628", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjU1Mjc0OQ==", "url": "https://github.com/confluentinc/kafka-tutorials/pull/628#discussion_r522552749", "bodyText": "Not sure if this is overkill or not, but I thought it might be good to be explicit about the JSON structure issue.", "author": "bbejeck", "createdAt": "2020-11-13T01:33:03Z", "path": "_includes/tutorials/ksql-nested-json/ksql/markup/dev/problem-description.adoc", "diffHunk": "@@ -0,0 +1,34 @@\n+Let's say you have a topic `financial_txns`, containing stock purchase at your firm. You want to do some basic reporting that includes the the number of shares, customer-id, and the ticker symbol involved in the transaction. All the information is in the record, but it's in JSON format and the information you need is nested.  Here's an example record:", "originalCommit": "fad1adc1c657705ceede8e5eea63c7a63a9b7a3f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM1NzAwNQ==", "url": "https://github.com/confluentinc/kafka-tutorials/pull/628#discussion_r524357005", "bodyText": "I don't think this is overkill, I like that you are visually calling out what data you need out of the event.", "author": "awalther28", "createdAt": "2020-11-16T15:34:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjU1Mjc0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM2MDk2OQ==", "url": "https://github.com/confluentinc/kafka-tutorials/pull/628#discussion_r524360969", "bodyText": "One thing you should note is the number of nested fields is consistent across multiple events. Robin recently wrote a blog about how you need to use MAP to model nested fields with a variable number of fields.\nI'm not sure if you would want to go into detail in this KT of how to use MAP and when.", "author": "awalther28", "createdAt": "2020-11-16T15:39:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjU1Mjc0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQ3MDkyMA==", "url": "https://github.com/confluentinc/kafka-tutorials/pull/628#discussion_r525470920", "bodyText": "@awalther28 good call.  I think it's best for a KT only to cover one subject at a time.  But I've added a small section discussing this point and link out to Robin's post.  I've also created an issue for a separate KT on this subject.\nEDIT: I've moved the comment and link out to the section where I formally define with the keyword STRUCT is, I think it fits better there.", "author": "bbejeck", "createdAt": "2020-11-17T20:04:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjU1Mjc0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM2MjEzMA==", "url": "https://github.com/confluentinc/kafka-tutorials/pull/628#discussion_r524362130", "bodyText": "Should this be\n\nWithin the CREATE STREAM statement...\n?", "author": "awalther28", "createdAt": "2020-11-16T15:40:39Z", "path": "_includes/tutorials/ksql-nested-json/ksql/markup/dev/create-financial-transaction-stream.adoc", "diffHunk": "@@ -0,0 +1,30 @@\n+The first thing we do is to create a stream `TRANSACTION_STREAM` based off stock purchase transactions topic `financial_txns`. Within the create `STREAM` statement, you'll use a `STRUCT` keyword to define each nested object.  The `STRUCT` keyword provides a mechanism to navigate to the desired fields in your query.", "originalCommit": "fad1adc1c657705ceede8e5eea63c7a63a9b7a3f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM2NDkzMw==", "url": "https://github.com/confluentinc/kafka-tutorials/pull/628#discussion_r524364933", "bodyText": "Feel free to shoot this down but I think it would be helpful to give a definition to what a struct is.\n\nA struct is a ksqlDB data type that represents strongly typed structured, or nested, data. A struct is an ordered collection of named fields that have a specific type. [pulled directly from ksqlDB docs]\nAs mentioned earlier, structs won't work in all scenarios but this reads like \"structs work for any nested object\".", "author": "awalther28", "createdAt": "2020-11-16T15:44:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM2MjEzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM3Mzg2OQ==", "url": "https://github.com/confluentinc/kafka-tutorials/pull/628#discussion_r524373869", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tdiff --strip-trailing-cr $(STEPS_DIR)/dev/expected-transient-reporting.log $(DEV_OUTPUTS_DIR)/transient-reporting/output-0.log\n          \n          \n            \n            \tdiff --strip-trailing-cr $(STEPS_DIR)/dev/expected-transient-reporting.log $(DEV_OUTPUTS_DIR)/transient-reporting/output-0.log\n          \n          \n            \n            \tdiff --strip-trailing-cr $(STEPS_DIR)/test/expected-results.log $(TEST_OUTPUTS_DIR)/test-results.log\n          \n      \n    \n    \n  \n\nCan we add in the suggestion above? That way we verify that the test statement section is working as expected in our pipeline.", "author": "awalther28", "createdAt": "2020-11-16T15:54:49Z", "path": "_includes/tutorials/ksql-nested-json/ksql/code/Makefile", "diffHunk": "@@ -0,0 +1,15 @@\n+STEPS_DIR := tutorial-steps\n+DEV_OUTPUTS_DIR := $(STEPS_DIR)/dev/outputs\n+TEST_OUTPUTS_DIR := $(STEPS_DIR)/test/outputs\n+PROD_OUTPUTS_DIR := $(STEPS_DIR)/prod/outputs\n+TEMP_DIR := $(shell mktemp -d)\n+SEQUENCE := \"dev, test, prod, ccloud\"\n+\n+tutorial:\n+\trm -r $(DEV_OUTPUTS_DIR) || true\n+\trm -r $(TEST_OUTPUTS_DIR) || true\n+\tmkdir $(DEV_OUTPUTS_DIR)\n+\tmkdir -p $(TEST_OUTPUTS_DIR)\n+\tharness-runner ../../../../../_data/harnesses/ksql-nested-json/ksql.yml $(TEMP_DIR) $(SEQUENCE)\n+\tdiff --strip-trailing-cr $(STEPS_DIR)/dev/expected-transient-reporting.log $(DEV_OUTPUTS_DIR)/transient-reporting/output-0.log", "originalCommit": "fad1adc1c657705ceede8e5eea63c7a63a9b7a3f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUyNjgzMw==", "url": "https://github.com/confluentinc/kafka-tutorials/pull/628#discussion_r525526833", "bodyText": "ack updated", "author": "bbejeck", "createdAt": "2020-11-17T21:11:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM3Mzg2OQ=="}], "type": "inlineReview"}, {"oid": "527115182ffdd7f44d9bef5c449d2bcb5bd862a6", "url": "https://github.com/confluentinc/kafka-tutorials/commit/527115182ffdd7f44d9bef5c449d2bcb5bd862a6", "message": "initial commit for nested json work", "committedDate": "2020-11-17T18:24:43Z", "type": "commit"}, {"oid": "075df18c81ac1e79cac2f7731d43384afb0f5358", "url": "https://github.com/confluentinc/kafka-tutorials/commit/075df18c81ac1e79cac2f7731d43384afb0f5358", "message": "more changes for nested data conversion", "committedDate": "2020-11-17T18:24:43Z", "type": "commit"}, {"oid": "48c1b01099b9e79322b26bf9c5f88004cad33cc6", "url": "https://github.com/confluentinc/kafka-tutorials/commit/48c1b01099b9e79322b26bf9c5f88004cad33cc6", "message": "Final changes for nested JSON recipe conversion", "committedDate": "2020-11-17T18:24:43Z", "type": "commit"}, {"oid": "385fb166bce53f1b5355d3e127a0e6e6c906399c", "url": "https://github.com/confluentinc/kafka-tutorials/commit/385fb166bce53f1b5355d3e127a0e6e6c906399c", "message": "updates per comments", "committedDate": "2020-11-17T21:09:40Z", "type": "commit"}, {"oid": "385fb166bce53f1b5355d3e127a0e6e6c906399c", "url": "https://github.com/confluentinc/kafka-tutorials/commit/385fb166bce53f1b5355d3e127a0e6e6c906399c", "message": "updates per comments", "committedDate": "2020-11-17T21:09:40Z", "type": "forcePushed"}]}