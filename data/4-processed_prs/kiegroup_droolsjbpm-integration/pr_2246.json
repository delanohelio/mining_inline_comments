{"pr_number": 2246, "pr_title": "[JBPM-9323] Some form options can't be rendered in API response / MultipleSelector", "pr_createdAt": "2020-09-22T09:39:32Z", "pr_url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2246", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI2MTczMg==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2246#discussion_r493261732", "bodyText": "Please remove unused static imports", "author": "afalhambra", "createdAt": "2020-09-23T07:36:22Z", "path": "kie-server-parent/kie-server-services/kie-server-services-jbpm-ui/src/main/java/org/kie/server/services/jbpm/ui/form/render/AbstractFormRenderer.java", "diffHunk": "@@ -16,7 +16,9 @@\n \n package org.kie.server.services.jbpm.ui.form.render;\n \n+import static java.util.Arrays.asList;\n import static java.util.Collections.singletonList;", "originalCommit": "9d4a68f1423019923b8a84f94c9cb7a9302541f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTczNzAzOA==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2246#discussion_r495737038", "bodyText": "done", "author": "elguardian", "createdAt": "2020-09-28T07:23:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI2MTczMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI2MjA5OQ==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2246#discussion_r493262099", "bodyText": "Same here", "author": "afalhambra", "createdAt": "2020-09-23T07:36:59Z", "path": "kie-server-parent/kie-server-services/kie-server-services-jbpm-ui/src/main/java/org/kie/server/services/jbpm/ui/form/render/AbstractFormRenderer.java", "diffHunk": "@@ -34,6 +35,7 @@\n import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n+import java.util.StringJoiner;", "originalCommit": "9d4a68f1423019923b8a84f94c9cb7a9302541f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTczNzA5MQ==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2246#discussion_r495737091", "bodyText": "done", "author": "elguardian", "createdAt": "2020-09-28T07:23:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI2MjA5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI3MDk0NQ==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2246#discussion_r493270945", "bodyText": "can be replaced with method reference\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                                item.setOptions(field.getListOfValues().stream().map(e -> new ItemOption(e)).collect(toList()));\n          \n          \n            \n                                                item.setOptions(field.getListOfValues().stream().map(ItemOption::new).collect(toList()));", "author": "afalhambra", "createdAt": "2020-09-23T07:50:29Z", "path": "kie-server-parent/kie-server-services/kie-server-services-jbpm-ui/src/main/java/org/kie/server/services/jbpm/ui/form/render/AbstractFormRenderer.java", "diffHunk": "@@ -407,24 +412,40 @@ protected void processFormLayout(FormInstance topLevelForm,\n                                 value = outputs.get(field.getBinding());\n                             }\n                             \n-                            if(!FIELDS_EXCLUSION_TRANSFORMATION.contains(fieldType)) {\n-                                item.setValue(value.toString());\n-                            } else if (value instanceof DocumentCollection){\n-                                DocumentCollection<Document> docCollection = (DocumentCollection<Document>) value;\n-                                docCollection.getDocuments().stream()\n-                                                           .map(e -> (DocumentImpl) e)\n-                                                           .forEach(DocumentImpl::load);\n-\n-                                List<DocumentItem> items = docCollection.getDocuments()\n-                                                               .stream()\n-                                                               .map(e -> new DocumentItem(e.getName(), Base64.getEncoder().encodeToString(e.getContent())))\n-                                                               .collect(Collectors.toList());\n-                                item.setValue(items);\n-                            } else {\n-                                item.setValue(Collections.emptyList());\n-                            }\n                             \n-\n+                            switch(fieldType) {\n+                                case \"documentCollection\":\n+                                    DocumentCollection<Document> docCollection = (DocumentCollection<Document>) value;\n+                                    docCollection.getDocuments().stream()\n+                                                               .map(e -> (DocumentImpl) e)\n+                                                               .forEach(DocumentImpl::load);\n+\n+                                    List<DocumentItem> items = docCollection.getDocuments()\n+                                                                   .stream()\n+                                                                   .map(e -> new DocumentItem(e.getName(), Base64.getEncoder().encodeToString(e.getContent())))\n+                                                                   .collect(toList());\n+                                    item.setValue(items);\n+                                case \"multipleSelector\":\n+                                    item.setOptions(field.getListOfValues().stream().map(e -> new ItemOption(e)).collect(toList()));", "originalCommit": "9d4a68f1423019923b8a84f94c9cb7a9302541f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTczNzE0Mw==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2246#discussion_r495737143", "bodyText": "done", "author": "elguardian", "createdAt": "2020-09-28T07:23:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI3MDk0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI3NDg5Nw==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2246#discussion_r493274897", "bodyText": "last condition type.contains(\"Date\") is already tested in previous else-if statement.\nPlease remove\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } else if (type.contains(\"Document\") || type.contains(\"documentCollection\") || type.contains(\"multipleSelector\") || type.contains(\"multipleInput\") || type.contains(\"Date\")) {\n          \n          \n            \n                    } else if (type.contains(\"Document\") || type.contains(\"documentCollection\") || type.contains(\"multipleSelector\") || type.contains(\"multipleInput\")) {", "author": "afalhambra", "createdAt": "2020-09-23T07:55:18Z", "path": "kie-server-parent/kie-server-services/kie-server-services-jbpm-ui/src/main/java/org/kie/server/services/jbpm/ui/form/render/AbstractFormRenderer.java", "diffHunk": "@@ -655,17 +676,14 @@ protected String getFieldType(String type) {\n             return \"Boolean(\";\n         } else if (type.contains(\"Date\")) {\n             return \"Object(\";\n-        } else if (type.contains(\"Integer\") || type.contains(\"Double\") || type.contains(\"Float\")) {\n-            return \"Number(\";\n-        } else if (type.contains(\"Boolean\")) {\n-            return \"Boolean(\";\n-        } else if (type.contains(\"Document\") || type.contains(\"documentCollection\") || type.contains(\"Date\")) {\n+        } else if (type.contains(\"Document\") || type.contains(\"documentCollection\") || type.contains(\"multipleSelector\") || type.contains(\"multipleInput\") || type.contains(\"Date\")) {", "originalCommit": "9d4a68f1423019923b8a84f94c9cb7a9302541f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTczNzE3Nw==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2246#discussion_r495737177", "bodyText": "done", "author": "elguardian", "createdAt": "2020-09-28T07:23:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI3NDg5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMxMDYwOA==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2246#discussion_r493310608", "bodyText": "quick question, if we're using min js version of this file, I guess we should actually call it like that? or should we use the full version https://github.com/bootstrap-tagsinput/bootstrap-tagsinput/blob/master/dist/bootstrap-tagsinput.js?", "author": "afalhambra", "createdAt": "2020-09-23T08:31:45Z", "path": "kie-server-parent/kie-server-services/kie-server-services-jbpm-ui/src/main/resources/form-templates-providers/bootstrap/js/bootstrap-tagsinput.js", "diffHunk": "@@ -0,0 +1,7 @@\n+/*", "originalCommit": "9d4a68f1423019923b8a84f94c9cb7a9302541f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUyNjQ3MQ==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2246#discussion_r493526471", "bodyText": "This code will never be reached since below condition is met before:\n\n  \n    \n      droolsjbpm-integration/kie-server-parent/kie-server-services/kie-server-services-jbpm-ui/src/main/resources/form-templates-providers/patternfly/input-form-group-template.html\n    \n    \n         Line 64\n      in\n      9d4a68f\n    \n    \n    \n    \n\n        \n          \n           <#elseif item.type == \"multipleInput\">", "author": "afalhambra", "createdAt": "2020-09-23T12:24:57Z", "path": "kie-server-parent/kie-server-services/kie-server-services-jbpm-ui/src/main/resources/form-templates-providers/patternfly/input-form-group-template.html", "diffHunk": "@@ -136,6 +136,29 @@ <h3 data-i18n-key=\"dropFilesHere\">Drop files here</h3>\n \t\t</#if>\n     </div>\n </div>\n+<#elseif item.type == \"multipleSelector\">\n+<div class=\"form-group\">\n+  <label for=\"${item.id}\">${item.label}</label>\n+  <#if item.required>\n+    <strong style=\"color: red\">*</strong>\n+  </#if>\n+    <select multiple class=\"form-control\" id=\"${item.id}\" ${(item.readOnly)?string('disabled', '')}>\n+        <#if item.options?size gt 0>\n+            <#assign itemList=item.options>\n+            <#list itemList as option>\n+                <option value=\"${option.value}\" ${(item.value?seq_contains(option.value))?string('selected','')}>${option.text}</option> \n+            </#list>\n+        </#if>\n+    </select>\n+</div>\n+<#elseif item.type == \"multipleInput\">\n+<div class=\"form-group\">\n+  <label for=\"${item.id}\">${item.label}</label>\n+  <#if item.required>\n+    <strong style=\"color: red\">*</strong>\n+  </#if>\n+  <input type=\"text\" multiple class=\"form-control\" id=\"${item.id}\" ${(item.readOnly)?string('disabled', '')} data-role=\"tagsinput\" value=\"${item.value}\" />\n+</div>", "originalCommit": "9d4a68f1423019923b8a84f94c9cb7a9302541f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTczNzIzMA==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2246#discussion_r495737230", "bodyText": "done", "author": "elguardian", "createdAt": "2020-09-28T07:24:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUyNjQ3MQ=="}], "type": "inlineReview"}, {"oid": "06e0ee6320545b8b88e0d8fba65ab13c961a731a", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/06e0ee6320545b8b88e0d8fba65ab13c961a731a", "message": "[JBPM-9323] Some form options can't be rendered in API response / MultipleSelector", "committedDate": "2020-09-28T06:56:14Z", "type": "commit"}, {"oid": "618260f01b70e07a7f75196c9f1d91bef244ac6f", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/618260f01b70e07a7f75196c9f1d91bef244ac6f", "message": "[JBPM-9322] Some form options can't be rendered in API response / MultipleInput", "committedDate": "2020-09-28T07:09:43Z", "type": "commit"}, {"oid": "618260f01b70e07a7f75196c9f1d91bef244ac6f", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/618260f01b70e07a7f75196c9f1d91bef244ac6f", "message": "[JBPM-9322] Some form options can't be rendered in API response / MultipleInput", "committedDate": "2020-09-28T07:09:43Z", "type": "forcePushed"}]}