{"pr_number": 1542, "pr_title": "Refactors to ThreadedAnvilChunkStorage and ChunkHolder generation logic", "pr_createdAt": "2020-07-03T11:47:21Z", "pr_url": "https://github.com/FabricMC/yarn/pull/1542", "timeline": [{"oid": "1750c2b3aa507b97020432eec4580b76ed644bf8", "url": "https://github.com/FabricMC/yarn/commit/1750c2b3aa507b97020432eec4580b76ed644bf8", "message": "Refactors to ThreadedAnvilChunkStorage and ChunkHolder generation logic", "committedDate": "2020-07-03T11:29:48Z", "type": "commit"}, {"oid": "822b626813c40036eb1266dddd69e2b50961130f", "url": "https://github.com/FabricMC/yarn/commit/822b626813c40036eb1266dddd69e2b50961130f", "message": "revert statusListeners", "committedDate": "2020-07-03T11:33:52Z", "type": "commit"}, {"oid": "b0ff6c78b0f1e0c6b68838336d018f26beec1c04", "url": "https://github.com/FabricMC/yarn/commit/b0ff6c78b0f1e0c6b68838336d018f26beec1c04", "message": "improve consistency of future-returning functions", "committedDate": "2020-07-03T11:39:05Z", "type": "commit"}, {"oid": "e98d0e11b1448f74133fe95d9ffadf87f5a4e440", "url": "https://github.com/FabricMC/yarn/commit/e98d0e11b1448f74133fe95d9ffadf87f5a4e440", "message": "ChunkHolder.ticking -> accessible", "committedDate": "2020-07-03T12:45:13Z", "type": "commit"}, {"oid": "2e613cebf88253b159932488e766668b82c10ebf", "url": "https://github.com/FabricMC/yarn/commit/2e613cebf88253b159932488e766668b82c10ebf", "message": "Merge 20w30a", "committedDate": "2020-07-26T15:46:00Z", "type": "commit"}, {"oid": "2e613cebf88253b159932488e766668b82c10ebf", "url": "https://github.com/FabricMC/yarn/commit/2e613cebf88253b159932488e766668b82c10ebf", "message": "Merge 20w30a", "committedDate": "2020-07-26T15:46:00Z", "type": "forcePushed"}, {"oid": "6e55a24f05ead2c4e39253117949342e818db828", "url": "https://github.com/FabricMC/yarn/commit/6e55a24f05ead2c4e39253117949342e818db828", "message": "Update ChunkStatus \"distance from full\" mappings and name ChunkHolder#future more specific to saving", "committedDate": "2020-07-26T15:55:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE0MTEwMA==", "url": "https://github.com/FabricMC/yarn/pull/1542#discussion_r461141100", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tMETHOD method_17247 awaitEntitiesTickable (Lnet/minecraft/class_1923;)Ljava/util/concurrent/CompletableFuture;\n          \n          \n            \n            \tMETHOD method_17247 awaitTickableEntities (Lnet/minecraft/class_1923;)Ljava/util/concurrent/CompletableFuture;", "author": "liach", "createdAt": "2020-07-27T20:11:30Z", "path": "mappings/net/minecraft/server/world/ThreadedAnvilChunkStorage.mapping", "diffHunk": "@@ -62,7 +68,7 @@ CLASS net/minecraft/class_3898 net/minecraft/server/world/ThreadedAnvilChunkStor\n \tMETHOD method_17242 save (Z)V\n \t\tARG 1 flush\n \tMETHOD method_17244 updateHolderMap ()Z\n-\tMETHOD method_17247 createEntityTickingChunkFuture (Lnet/minecraft/class_1923;)Ljava/util/concurrent/CompletableFuture;\n+\tMETHOD method_17247 awaitEntitiesTickable (Lnet/minecraft/class_1923;)Ljava/util/concurrent/CompletableFuture;", "originalCommit": "6e55a24f05ead2c4e39253117949342e818db828", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM4ODgyNg==", "url": "https://github.com/FabricMC/yarn/pull/1542#discussion_r461388826", "bodyText": "Hmm, this is more waiting for entities to be tickable, rather than waiting for tickable entities to appear", "author": "Gegy", "createdAt": "2020-07-28T07:54:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE0MTEwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE0MTMwMw==", "url": "https://github.com/FabricMC/yarn/pull/1542#discussion_r461141303", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tMETHOD method_17235 makeTickable (Lnet/minecraft/class_3193;)Ljava/util/concurrent/CompletableFuture;\n          \n          \n            \n            \tMETHOD method_17235 awaitTickable (Lnet/minecraft/class_3193;)Ljava/util/concurrent/CompletableFuture;", "author": "liach", "createdAt": "2020-07-27T20:11:51Z", "path": "mappings/net/minecraft/server/world/ThreadedAnvilChunkStorage.mapping", "diffHunk": "@@ -40,19 +42,23 @@ CLASS net/minecraft/class_3898 net/minecraft/server/world/ThreadedAnvilChunkStor\n \t\tARG 1 pos\n \t\tARG 3 level\n \t\tARG 4 holder\n-\tMETHOD method_17220 createChunkRegionFuture (Lnet/minecraft/class_1923;ILjava/util/function/IntFunction;)Ljava/util/concurrent/CompletableFuture;\n+\tMETHOD method_17220 getRegion (Lnet/minecraft/class_1923;ILjava/util/function/IntFunction;)Ljava/util/concurrent/CompletableFuture;\n \t\tARG 1 centerChunk\n \t\tARG 2 margin\n \t\tARG 3 distanceToStatus\n \tMETHOD method_17226 convertToFullChunk (Lnet/minecraft/class_3193;)Ljava/util/concurrent/CompletableFuture;\n \tMETHOD method_17228 save (Lnet/minecraft/class_2791;)Z\n+\t\tARG 1 chunk\n \tMETHOD method_17229 getRequiredStatusForGeneration (Lnet/minecraft/class_2806;I)Lnet/minecraft/class_2806;\n \t\tARG 1 centerChunkTargetStatus\n \t\tARG 2 distance\n \tMETHOD method_17233 tick (Ljava/util/function/BooleanSupplier;)V\n \t\tARG 1 shouldKeepTicking\n-\tMETHOD method_17235 createTickingFuture (Lnet/minecraft/class_3193;)Ljava/util/concurrent/CompletableFuture;\n-\tMETHOD method_17236 createChunkFuture (Lnet/minecraft/class_3193;Lnet/minecraft/class_2806;)Ljava/util/concurrent/CompletableFuture;\n+\tMETHOD method_17235 makeTickable (Lnet/minecraft/class_3193;)Ljava/util/concurrent/CompletableFuture;", "originalCommit": "6e55a24f05ead2c4e39253117949342e818db828", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM4ODI1Mw==", "url": "https://github.com/FabricMC/yarn/pull/1542#discussion_r461388253", "bodyText": "I used make here because this isn't a pure function like awaitEntitiesTickable is. Definitely would like to make these consistent though. Essentially, what this function does is wait for 3x3 area of FULL chunks, then runs the queued post processing and sends the chunk to all clients.", "author": "Gegy", "createdAt": "2020-07-28T07:53:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE0MTMwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQxNDM5Mg==", "url": "https://github.com/FabricMC/yarn/pull/1542#discussion_r461414392", "bodyText": "and what does the completable future do when it's joined?", "author": "liach", "createdAt": "2020-07-28T08:38:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE0MTMwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ0MjgwMQ==", "url": "https://github.com/FabricMC/yarn/pull/1542#discussion_r461442801", "bodyText": "It'll just block until the future is marked complete", "author": "Gegy", "createdAt": "2020-07-28T09:22:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE0MTMwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE0MTM2NQ==", "url": "https://github.com/FabricMC/yarn/pull/1542#discussion_r461141365", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tMETHOD method_17236 getChunk (Lnet/minecraft/class_3193;Lnet/minecraft/class_2806;)Ljava/util/concurrent/CompletableFuture;\n          \n          \n            \n            \tMETHOD method_17236 awaitChunk (Lnet/minecraft/class_3193;Lnet/minecraft/class_2806;)Ljava/util/concurrent/CompletableFuture;", "author": "liach", "createdAt": "2020-07-27T20:11:59Z", "path": "mappings/net/minecraft/server/world/ThreadedAnvilChunkStorage.mapping", "diffHunk": "@@ -40,19 +42,23 @@ CLASS net/minecraft/class_3898 net/minecraft/server/world/ThreadedAnvilChunkStor\n \t\tARG 1 pos\n \t\tARG 3 level\n \t\tARG 4 holder\n-\tMETHOD method_17220 createChunkRegionFuture (Lnet/minecraft/class_1923;ILjava/util/function/IntFunction;)Ljava/util/concurrent/CompletableFuture;\n+\tMETHOD method_17220 getRegion (Lnet/minecraft/class_1923;ILjava/util/function/IntFunction;)Ljava/util/concurrent/CompletableFuture;\n \t\tARG 1 centerChunk\n \t\tARG 2 margin\n \t\tARG 3 distanceToStatus\n \tMETHOD method_17226 convertToFullChunk (Lnet/minecraft/class_3193;)Ljava/util/concurrent/CompletableFuture;\n \tMETHOD method_17228 save (Lnet/minecraft/class_2791;)Z\n+\t\tARG 1 chunk\n \tMETHOD method_17229 getRequiredStatusForGeneration (Lnet/minecraft/class_2806;I)Lnet/minecraft/class_2806;\n \t\tARG 1 centerChunkTargetStatus\n \t\tARG 2 distance\n \tMETHOD method_17233 tick (Ljava/util/function/BooleanSupplier;)V\n \t\tARG 1 shouldKeepTicking\n-\tMETHOD method_17235 createTickingFuture (Lnet/minecraft/class_3193;)Ljava/util/concurrent/CompletableFuture;\n-\tMETHOD method_17236 createChunkFuture (Lnet/minecraft/class_3193;Lnet/minecraft/class_2806;)Ljava/util/concurrent/CompletableFuture;\n+\tMETHOD method_17235 makeTickable (Lnet/minecraft/class_3193;)Ljava/util/concurrent/CompletableFuture;\n+\t\tARG 1 holder\n+\tMETHOD method_17236 getChunk (Lnet/minecraft/class_3193;Lnet/minecraft/class_2806;)Ljava/util/concurrent/CompletableFuture;", "originalCommit": "6e55a24f05ead2c4e39253117949342e818db828", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM4OTUxMg==", "url": "https://github.com/FabricMC/yarn/pull/1542#discussion_r461389512", "bodyText": "This is similar to the last one where it isn't a pure function. Maybe instead of using the await prefix, it'd be better to use a Future suffix for all of these? Like getChunkFuture, getEntitiesTickableFuture? Not sure", "author": "Gegy", "createdAt": "2020-07-28T07:55:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE0MTM2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE0MTQ0NA==", "url": "https://github.com/FabricMC/yarn/pull/1542#discussion_r461141444", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tMETHOD method_17220 getRegion (Lnet/minecraft/class_1923;ILjava/util/function/IntFunction;)Ljava/util/concurrent/CompletableFuture;\n          \n          \n            \n            \tMETHOD method_17220 awaitRegion (Lnet/minecraft/class_1923;ILjava/util/function/IntFunction;)Ljava/util/concurrent/CompletableFuture;", "author": "liach", "createdAt": "2020-07-27T20:12:10Z", "path": "mappings/net/minecraft/server/world/ThreadedAnvilChunkStorage.mapping", "diffHunk": "@@ -40,19 +42,23 @@ CLASS net/minecraft/class_3898 net/minecraft/server/world/ThreadedAnvilChunkStor\n \t\tARG 1 pos\n \t\tARG 3 level\n \t\tARG 4 holder\n-\tMETHOD method_17220 createChunkRegionFuture (Lnet/minecraft/class_1923;ILjava/util/function/IntFunction;)Ljava/util/concurrent/CompletableFuture;\n+\tMETHOD method_17220 getRegion (Lnet/minecraft/class_1923;ILjava/util/function/IntFunction;)Ljava/util/concurrent/CompletableFuture;", "originalCommit": "6e55a24f05ead2c4e39253117949342e818db828", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "eb8ca62d7f44cb0b0744a418b7243753bfc72386", "url": "https://github.com/FabricMC/yarn/commit/eb8ca62d7f44cb0b0744a418b7243753bfc72386", "message": "Remove `await` prefix for consistency", "committedDate": "2020-07-28T09:36:24Z", "type": "commit"}]}