{"pr_number": 4561, "pr_title": "[CAMEL-15804] - DataSonnet Expression Language Support", "pr_createdAt": "2020-11-04T06:23:05Z", "pr_url": "https://github.com/apache/camel/pull/4561", "timeline": [{"oid": "93a978122ee268ddfd5e3790983e1a5dbae89974", "url": "https://github.com/apache/camel/commit/93a978122ee268ddfd5e3790983e1a5dbae89974", "message": "datasonnet: adds language", "committedDate": "2020-11-04T00:09:52Z", "type": "commit"}, {"oid": "909682168f7249c38d5449aec27508eca89fda78", "url": "https://github.com/apache/camel/commit/909682168f7249c38d5449aec27508eca89fda78", "message": "sets up cml library", "committedDate": "2020-11-04T00:11:54Z", "type": "commit"}, {"oid": "2ae4eafc9b4e8a2174312f26e9f709f475f9d42a", "url": "https://github.com/apache/camel/commit/2ae4eafc9b4e8a2174312f26e9f709f475f9d42a", "message": "upgrade datasonnet mapper", "committedDate": "2020-11-04T00:11:55Z", "type": "commit"}, {"oid": "155d9bec01ad6a026ad874f1ff87bec2fa0ce3b3", "url": "https://github.com/apache/camel/commit/155d9bec01ad6a026ad874f1ff87bec2fa0ce3b3", "message": "formatting", "committedDate": "2020-11-04T00:11:55Z", "type": "commit"}, {"oid": "5211dfdef78b17428c43667461e481deb4e285ea", "url": "https://github.com/apache/camel/commit/5211dfdef78b17428c43667461e481deb4e285ea", "message": "refactors valuebuilder optional params", "committedDate": "2020-11-04T00:11:55Z", "type": "commit"}, {"oid": "9bfb2438a8e5fdae9f9a9bc5e844bafa4d5d525d", "url": "https://github.com/apache/camel/commit/9bfb2438a8e5fdae9f9a9bc5e844bafa4d5d525d", "message": "renames mimetype to mediatype\n\nalso moves datasonnet builder to camel-datasonnet", "committedDate": "2020-11-04T00:11:55Z", "type": "commit"}, {"oid": "ed17ed8ad1f2888aa6c4a1659267ce03a8447b41", "url": "https://github.com/apache/camel/commit/ed17ed8ad1f2888aa6c4a1659267ce03a8447b41", "message": "Revert delegating ValueBuilder to camel-datasonnet\n\nThis partially reverts commit d2202f7ee78daccacec2cec3f85925f4e8b8411e.", "committedDate": "2020-11-04T00:11:55Z", "type": "commit"}, {"oid": "7aa2167f6ef1e41c9dc23eb5c1de7a3f93d00317", "url": "https://github.com/apache/camel/commit/7aa2167f6ef1e41c9dc23eb5c1de7a3f93d00317", "message": "refactor headers and exchange properties to functions", "committedDate": "2020-11-04T00:11:55Z", "type": "commit"}, {"oid": "b238092b08bfca6844890fe3b94c275e278ff5c6", "url": "https://github.com/apache/camel/commit/b238092b08bfca6844890fe3b94c275e278ff5c6", "message": "defaults to output Document unless result specified", "committedDate": "2020-11-04T00:11:55Z", "type": "commit"}, {"oid": "4533b75414e625bfd2ca6b8ba1db3922c7d073bf", "url": "https://github.com/apache/camel/commit/4533b75414e625bfd2ca6b8ba1db3922c7d073bf", "message": "bump datasonnet-mapper ver", "committedDate": "2020-11-04T00:11:56Z", "type": "commit"}, {"oid": "b623272c4e6dfb988d7f1b66fc22c887e3390dec", "url": "https://github.com/apache/camel/commit/b623272c4e6dfb988d7f1b66fc22c887e3390dec", "message": "bump ds mapper version", "committedDate": "2020-11-04T00:11:56Z", "type": "commit"}, {"oid": "5beffbc844814a0e7f513b07e3628333f570c9e7", "url": "https://github.com/apache/camel/commit/5beffbc844814a0e7f513b07e3628333f570c9e7", "message": "add dep", "committedDate": "2020-11-04T00:11:56Z", "type": "commit"}, {"oid": "8ef083017b764850af7098b995466aa1d6cf2746", "url": "https://github.com/apache/camel/commit/8ef083017b764850af7098b995466aa1d6cf2746", "message": "fix scala directory", "committedDate": "2020-11-04T00:11:56Z", "type": "commit"}, {"oid": "70a8d6cc187f19e71e72effffed0669da6ff45a3", "url": "https://github.com/apache/camel/commit/70a8d6cc187f19e71e72effffed0669da6ff45a3", "message": "rebase 3.7.0-SNAPSHOT", "committedDate": "2020-11-04T00:11:56Z", "type": "commit"}, {"oid": "4c8c615f86847728aba3863056613b364ef2dcd5", "url": "https://github.com/apache/camel/commit/4c8c615f86847728aba3863056613b364ef2dcd5", "message": "fix cml library", "committedDate": "2020-11-04T00:11:56Z", "type": "commit"}, {"oid": "d1863c60b2ac835bcb6e93d7b391af4415842d72", "url": "https://github.com/apache/camel/commit/d1863c60b2ac835bcb6e93d7b391af4415842d72", "message": "adds docs", "committedDate": "2020-11-04T00:11:57Z", "type": "commit"}, {"oid": "48e36a45da67c4bb0ac19abf76479a145e10105c", "url": "https://github.com/apache/camel/commit/48e36a45da67c4bb0ac19abf76479a145e10105c", "message": "bump last ms3 ds version", "committedDate": "2020-11-04T00:11:57Z", "type": "commit"}, {"oid": "c96b0639c08232ff5e9737ffe66959566815cbe8", "url": "https://github.com/apache/camel/commit/c96b0639c08232ff5e9737ffe66959566815cbe8", "message": "Refactor reifier and language", "committedDate": "2020-11-04T00:11:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1NjAwNQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518056005", "bodyText": "What is this library here?", "author": "oscerd", "createdAt": "2020-11-05T13:38:13Z", "path": "components/camel-datasonnet/pom.xml", "diffHunk": "@@ -0,0 +1,142 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one or more\n+    contributor license agreements.  See the NOTICE file distributed with\n+    this work for additional information regarding copyright ownership.\n+    The ASF licenses this file to You under the Apache License, Version 2.0\n+    (the \"License\"); you may not use this file except in compliance with\n+    the License.  You may obtain a copy of the License at\n+\n+         http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <parent>\n+        <groupId>org.apache.camel</groupId>\n+        <artifactId>components</artifactId>\n+        <version>3.7.0-SNAPSHOT</version>\n+    </parent>\n+\n+    <artifactId>camel-datasonnet</artifactId>\n+    <packaging>jar</packaging>\n+\n+    <name>Camel :: DataSonnet</name>\n+    <description>Camel DataSonnet support</description>\n+\n+    <properties>\n+        <maven.compiler.source>1.8</maven.compiler.source>\n+        <maven.compiler.target>1.8</maven.compiler.target>\n+    </properties>\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>net.alchim31.maven</groupId>\n+                <artifactId>scala-maven-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>scala-compile-first</id>\n+                        <phase>process-resources</phase>\n+                        <goals>\n+                            <goal>add-source</goal>\n+                            <goal>compile</goal>\n+                        </goals>\n+                    </execution>\n+                    <execution>\n+                        <id>scala-test-compile</id>\n+                        <phase>process-test-resources</phase>\n+                        <goals>\n+                            <goal>testCompile</goal>\n+                        </goals>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-surefire-plugin</artifactId>\n+                <configuration>\n+                    <additionalClasspathElements>\n+                        <additionalClasspathElement>${project.basedir}/src/test/resources/dslibs.jar</additionalClasspathElement>", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE3OTM0Mw==", "url": "https://github.com/apache/camel/pull/4561#discussion_r526179343", "bodyText": "It's there to test that we can find supporting library files even within a jar. I'm not sure how much of an use case this is to be honest, if it's not good with you guys we can remove it...", "author": "jam01", "createdAt": "2020-11-18T15:31:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1NjAwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1NjI1Mg==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518056252", "bodyText": "If we need this, we need to move the property version placeholder in parent/pom", "author": "oscerd", "createdAt": "2020-11-05T13:38:35Z", "path": "components/camel-datasonnet/pom.xml", "diffHunk": "@@ -0,0 +1,142 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one or more\n+    contributor license agreements.  See the NOTICE file distributed with\n+    this work for additional information regarding copyright ownership.\n+    The ASF licenses this file to You under the Apache License, Version 2.0\n+    (the \"License\"); you may not use this file except in compliance with\n+    the License.  You may obtain a copy of the License at\n+\n+         http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <parent>\n+        <groupId>org.apache.camel</groupId>\n+        <artifactId>components</artifactId>\n+        <version>3.7.0-SNAPSHOT</version>\n+    </parent>\n+\n+    <artifactId>camel-datasonnet</artifactId>\n+    <packaging>jar</packaging>\n+\n+    <name>Camel :: DataSonnet</name>\n+    <description>Camel DataSonnet support</description>\n+\n+    <properties>\n+        <maven.compiler.source>1.8</maven.compiler.source>\n+        <maven.compiler.target>1.8</maven.compiler.target>\n+    </properties>\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>net.alchim31.maven</groupId>\n+                <artifactId>scala-maven-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>scala-compile-first</id>\n+                        <phase>process-resources</phase>\n+                        <goals>\n+                            <goal>add-source</goal>\n+                            <goal>compile</goal>\n+                        </goals>\n+                    </execution>\n+                    <execution>\n+                        <id>scala-test-compile</id>\n+                        <phase>process-test-resources</phase>\n+                        <goals>\n+                            <goal>testCompile</goal>\n+                        </goals>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-surefire-plugin</artifactId>\n+                <configuration>\n+                    <additionalClasspathElements>\n+                        <additionalClasspathElement>${project.basedir}/src/test/resources/dslibs.jar</additionalClasspathElement>\n+                    </additionalClasspathElements>\n+                </configuration>\n+            </plugin>\n+        </plugins>\n+    </build>\n+\n+    <dependencies>\n+        <!-- todo: confirm the scala incompatbility is with datasonnet -->\n+        <dependency>\n+            <groupId>org.scala-lang</groupId>\n+            <artifactId>scala-library</artifactId>\n+            <version>2.13.3</version>", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODIxNjE0OA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518216148", "bodyText": "Oh I see... I think that might break some things. I ran into this PR some time ago #2060", "author": "jam01", "createdAt": "2020-11-05T17:10:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1NjI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODIzMDU0Ng==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518230546", "bodyText": "You can also specify a single property placeholder in parent/pom only for camel-datasonnet", "author": "oscerd", "createdAt": "2020-11-05T17:32:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1NjI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODMxNzY1MA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518317650", "bodyText": "OK so it seems camel-flink is the only other component using scala-library, unfortunately it depends on an earlier version than what datasonnet-mapper requires. I bumped the parent/pom version to the latest that camel-flink can use (2.12.12) and added a scala-datasonnet-version placeholder in parent/pom that's a few later (2.13.3). If the camel-flink dependency catches up to 2.13 then we could then make a single placeholder. Let me know if this is ok.", "author": "jam01", "createdAt": "2020-11-05T19:38:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1NjI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODMyNTY5OQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518325699", "bodyText": "BTW the commit is 704e851 and I ran mvn clean install -P fastinstall at the root and everything checks out green", "author": "jam01", "createdAt": "2020-11-05T19:53:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1NjI1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1NjM5MQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518056391", "bodyText": "There is a placeholder in parent/pom", "author": "oscerd", "createdAt": "2020-11-05T13:38:49Z", "path": "components/camel-datasonnet/pom.xml", "diffHunk": "@@ -0,0 +1,142 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one or more\n+    contributor license agreements.  See the NOTICE file distributed with\n+    this work for additional information regarding copyright ownership.\n+    The ASF licenses this file to You under the Apache License, Version 2.0\n+    (the \"License\"); you may not use this file except in compliance with\n+    the License.  You may obtain a copy of the License at\n+\n+         http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <parent>\n+        <groupId>org.apache.camel</groupId>\n+        <artifactId>components</artifactId>\n+        <version>3.7.0-SNAPSHOT</version>\n+    </parent>\n+\n+    <artifactId>camel-datasonnet</artifactId>\n+    <packaging>jar</packaging>\n+\n+    <name>Camel :: DataSonnet</name>\n+    <description>Camel DataSonnet support</description>\n+\n+    <properties>\n+        <maven.compiler.source>1.8</maven.compiler.source>\n+        <maven.compiler.target>1.8</maven.compiler.target>\n+    </properties>\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>net.alchim31.maven</groupId>\n+                <artifactId>scala-maven-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>scala-compile-first</id>\n+                        <phase>process-resources</phase>\n+                        <goals>\n+                            <goal>add-source</goal>\n+                            <goal>compile</goal>\n+                        </goals>\n+                    </execution>\n+                    <execution>\n+                        <id>scala-test-compile</id>\n+                        <phase>process-test-resources</phase>\n+                        <goals>\n+                            <goal>testCompile</goal>\n+                        </goals>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-surefire-plugin</artifactId>\n+                <configuration>\n+                    <additionalClasspathElements>\n+                        <additionalClasspathElement>${project.basedir}/src/test/resources/dslibs.jar</additionalClasspathElement>\n+                    </additionalClasspathElements>\n+                </configuration>\n+            </plugin>\n+        </plugins>\n+    </build>\n+\n+    <dependencies>\n+        <!-- todo: confirm the scala incompatbility is with datasonnet -->\n+        <dependency>\n+            <groupId>org.scala-lang</groupId>\n+            <artifactId>scala-library</artifactId>\n+            <version>2.13.3</version>\n+        </dependency>\n+        <!-- apparently scala compiler needs this -->\n+        <dependency>\n+            <groupId>org.hamcrest</groupId>\n+            <artifactId>hamcrest</artifactId>\n+            <version>2.2</version>", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1NjY4NA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518056684", "bodyText": "It should go as a placeholder in parent/pom", "author": "oscerd", "createdAt": "2020-11-05T13:39:14Z", "path": "components/camel-datasonnet/pom.xml", "diffHunk": "@@ -0,0 +1,142 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one or more\n+    contributor license agreements.  See the NOTICE file distributed with\n+    this work for additional information regarding copyright ownership.\n+    The ASF licenses this file to You under the Apache License, Version 2.0\n+    (the \"License\"); you may not use this file except in compliance with\n+    the License.  You may obtain a copy of the License at\n+\n+         http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <parent>\n+        <groupId>org.apache.camel</groupId>\n+        <artifactId>components</artifactId>\n+        <version>3.7.0-SNAPSHOT</version>\n+    </parent>\n+\n+    <artifactId>camel-datasonnet</artifactId>\n+    <packaging>jar</packaging>\n+\n+    <name>Camel :: DataSonnet</name>\n+    <description>Camel DataSonnet support</description>\n+\n+    <properties>\n+        <maven.compiler.source>1.8</maven.compiler.source>\n+        <maven.compiler.target>1.8</maven.compiler.target>\n+    </properties>\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>net.alchim31.maven</groupId>\n+                <artifactId>scala-maven-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>scala-compile-first</id>\n+                        <phase>process-resources</phase>\n+                        <goals>\n+                            <goal>add-source</goal>\n+                            <goal>compile</goal>\n+                        </goals>\n+                    </execution>\n+                    <execution>\n+                        <id>scala-test-compile</id>\n+                        <phase>process-test-resources</phase>\n+                        <goals>\n+                            <goal>testCompile</goal>\n+                        </goals>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-surefire-plugin</artifactId>\n+                <configuration>\n+                    <additionalClasspathElements>\n+                        <additionalClasspathElement>${project.basedir}/src/test/resources/dslibs.jar</additionalClasspathElement>\n+                    </additionalClasspathElements>\n+                </configuration>\n+            </plugin>\n+        </plugins>\n+    </build>\n+\n+    <dependencies>\n+        <!-- todo: confirm the scala incompatbility is with datasonnet -->\n+        <dependency>\n+            <groupId>org.scala-lang</groupId>\n+            <artifactId>scala-library</artifactId>\n+            <version>2.13.3</version>\n+        </dependency>\n+        <!-- apparently scala compiler needs this -->\n+        <dependency>\n+            <groupId>org.hamcrest</groupId>\n+            <artifactId>hamcrest</artifactId>\n+            <version>2.2</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.apache.camel</groupId>\n+            <artifactId>camel-support</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.datasonnet</groupId>\n+            <artifactId>datasonnet-mapper</artifactId>\n+            <version>0.6.0-MS3</version>", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1Njc5NQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518056795", "bodyText": "ditto", "author": "oscerd", "createdAt": "2020-11-05T13:39:22Z", "path": "components/camel-datasonnet/pom.xml", "diffHunk": "@@ -0,0 +1,142 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one or more\n+    contributor license agreements.  See the NOTICE file distributed with\n+    this work for additional information regarding copyright ownership.\n+    The ASF licenses this file to You under the Apache License, Version 2.0\n+    (the \"License\"); you may not use this file except in compliance with\n+    the License.  You may obtain a copy of the License at\n+\n+         http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <parent>\n+        <groupId>org.apache.camel</groupId>\n+        <artifactId>components</artifactId>\n+        <version>3.7.0-SNAPSHOT</version>\n+    </parent>\n+\n+    <artifactId>camel-datasonnet</artifactId>\n+    <packaging>jar</packaging>\n+\n+    <name>Camel :: DataSonnet</name>\n+    <description>Camel DataSonnet support</description>\n+\n+    <properties>\n+        <maven.compiler.source>1.8</maven.compiler.source>\n+        <maven.compiler.target>1.8</maven.compiler.target>\n+    </properties>\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>net.alchim31.maven</groupId>\n+                <artifactId>scala-maven-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>scala-compile-first</id>\n+                        <phase>process-resources</phase>\n+                        <goals>\n+                            <goal>add-source</goal>\n+                            <goal>compile</goal>\n+                        </goals>\n+                    </execution>\n+                    <execution>\n+                        <id>scala-test-compile</id>\n+                        <phase>process-test-resources</phase>\n+                        <goals>\n+                            <goal>testCompile</goal>\n+                        </goals>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-surefire-plugin</artifactId>\n+                <configuration>\n+                    <additionalClasspathElements>\n+                        <additionalClasspathElement>${project.basedir}/src/test/resources/dslibs.jar</additionalClasspathElement>\n+                    </additionalClasspathElements>\n+                </configuration>\n+            </plugin>\n+        </plugins>\n+    </build>\n+\n+    <dependencies>\n+        <!-- todo: confirm the scala incompatbility is with datasonnet -->\n+        <dependency>\n+            <groupId>org.scala-lang</groupId>\n+            <artifactId>scala-library</artifactId>\n+            <version>2.13.3</version>\n+        </dependency>\n+        <!-- apparently scala compiler needs this -->\n+        <dependency>\n+            <groupId>org.hamcrest</groupId>\n+            <artifactId>hamcrest</artifactId>\n+            <version>2.2</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.apache.camel</groupId>\n+            <artifactId>camel-support</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.datasonnet</groupId>\n+            <artifactId>datasonnet-mapper</artifactId>\n+            <version>0.6.0-MS3</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>commons-io</groupId>\n+            <artifactId>commons-io</artifactId>\n+            <version>2.4</version>", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1Njg3MQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518056871", "bodyText": "ditto", "author": "oscerd", "createdAt": "2020-11-05T13:39:30Z", "path": "components/camel-datasonnet/pom.xml", "diffHunk": "@@ -0,0 +1,142 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one or more\n+    contributor license agreements.  See the NOTICE file distributed with\n+    this work for additional information regarding copyright ownership.\n+    The ASF licenses this file to You under the Apache License, Version 2.0\n+    (the \"License\"); you may not use this file except in compliance with\n+    the License.  You may obtain a copy of the License at\n+\n+         http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <parent>\n+        <groupId>org.apache.camel</groupId>\n+        <artifactId>components</artifactId>\n+        <version>3.7.0-SNAPSHOT</version>\n+    </parent>\n+\n+    <artifactId>camel-datasonnet</artifactId>\n+    <packaging>jar</packaging>\n+\n+    <name>Camel :: DataSonnet</name>\n+    <description>Camel DataSonnet support</description>\n+\n+    <properties>\n+        <maven.compiler.source>1.8</maven.compiler.source>\n+        <maven.compiler.target>1.8</maven.compiler.target>\n+    </properties>\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>net.alchim31.maven</groupId>\n+                <artifactId>scala-maven-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>scala-compile-first</id>\n+                        <phase>process-resources</phase>\n+                        <goals>\n+                            <goal>add-source</goal>\n+                            <goal>compile</goal>\n+                        </goals>\n+                    </execution>\n+                    <execution>\n+                        <id>scala-test-compile</id>\n+                        <phase>process-test-resources</phase>\n+                        <goals>\n+                            <goal>testCompile</goal>\n+                        </goals>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-surefire-plugin</artifactId>\n+                <configuration>\n+                    <additionalClasspathElements>\n+                        <additionalClasspathElement>${project.basedir}/src/test/resources/dslibs.jar</additionalClasspathElement>\n+                    </additionalClasspathElements>\n+                </configuration>\n+            </plugin>\n+        </plugins>\n+    </build>\n+\n+    <dependencies>\n+        <!-- todo: confirm the scala incompatbility is with datasonnet -->\n+        <dependency>\n+            <groupId>org.scala-lang</groupId>\n+            <artifactId>scala-library</artifactId>\n+            <version>2.13.3</version>\n+        </dependency>\n+        <!-- apparently scala compiler needs this -->\n+        <dependency>\n+            <groupId>org.hamcrest</groupId>\n+            <artifactId>hamcrest</artifactId>\n+            <version>2.2</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.apache.camel</groupId>\n+            <artifactId>camel-support</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.datasonnet</groupId>\n+            <artifactId>datasonnet-mapper</artifactId>\n+            <version>0.6.0-MS3</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>commons-io</groupId>\n+            <artifactId>commons-io</artifactId>\n+            <version>2.4</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>io.github.classgraph</groupId>\n+            <artifactId>classgraph</artifactId>\n+            <version>4.8.52</version>", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1Njk3MQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518056971", "bodyText": "ditto", "author": "oscerd", "createdAt": "2020-11-05T13:39:40Z", "path": "components/camel-datasonnet/pom.xml", "diffHunk": "@@ -0,0 +1,142 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one or more\n+    contributor license agreements.  See the NOTICE file distributed with\n+    this work for additional information regarding copyright ownership.\n+    The ASF licenses this file to You under the Apache License, Version 2.0\n+    (the \"License\"); you may not use this file except in compliance with\n+    the License.  You may obtain a copy of the License at\n+\n+         http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <parent>\n+        <groupId>org.apache.camel</groupId>\n+        <artifactId>components</artifactId>\n+        <version>3.7.0-SNAPSHOT</version>\n+    </parent>\n+\n+    <artifactId>camel-datasonnet</artifactId>\n+    <packaging>jar</packaging>\n+\n+    <name>Camel :: DataSonnet</name>\n+    <description>Camel DataSonnet support</description>\n+\n+    <properties>\n+        <maven.compiler.source>1.8</maven.compiler.source>\n+        <maven.compiler.target>1.8</maven.compiler.target>\n+    </properties>\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>net.alchim31.maven</groupId>\n+                <artifactId>scala-maven-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>scala-compile-first</id>\n+                        <phase>process-resources</phase>\n+                        <goals>\n+                            <goal>add-source</goal>\n+                            <goal>compile</goal>\n+                        </goals>\n+                    </execution>\n+                    <execution>\n+                        <id>scala-test-compile</id>\n+                        <phase>process-test-resources</phase>\n+                        <goals>\n+                            <goal>testCompile</goal>\n+                        </goals>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-surefire-plugin</artifactId>\n+                <configuration>\n+                    <additionalClasspathElements>\n+                        <additionalClasspathElement>${project.basedir}/src/test/resources/dslibs.jar</additionalClasspathElement>\n+                    </additionalClasspathElements>\n+                </configuration>\n+            </plugin>\n+        </plugins>\n+    </build>\n+\n+    <dependencies>\n+        <!-- todo: confirm the scala incompatbility is with datasonnet -->\n+        <dependency>\n+            <groupId>org.scala-lang</groupId>\n+            <artifactId>scala-library</artifactId>\n+            <version>2.13.3</version>\n+        </dependency>\n+        <!-- apparently scala compiler needs this -->\n+        <dependency>\n+            <groupId>org.hamcrest</groupId>\n+            <artifactId>hamcrest</artifactId>\n+            <version>2.2</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.apache.camel</groupId>\n+            <artifactId>camel-support</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.datasonnet</groupId>\n+            <artifactId>datasonnet-mapper</artifactId>\n+            <version>0.6.0-MS3</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>commons-io</groupId>\n+            <artifactId>commons-io</artifactId>\n+            <version>2.4</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>io.github.classgraph</groupId>\n+            <artifactId>classgraph</artifactId>\n+            <version>4.8.52</version>\n+        </dependency>\n+\n+        <!-- testing -->\n+        <dependency>\n+            <groupId>org.apache.camel</groupId>\n+            <artifactId>camel-test-spring-junit5</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.apache.logging.log4j</groupId>\n+            <artifactId>log4j-slf4j-impl</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.junit.jupiter</groupId>\n+            <artifactId>junit-jupiter</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.skyscreamer</groupId>\n+            <artifactId>jsonassert</artifactId>\n+            <version>1.5.0</version>", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1NzU0MA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518057540", "bodyText": "We essentially avoid external repository for multiple reasons: our experience with 3rd parties repository was really bad, so if possible please release in maven central.", "author": "oscerd", "createdAt": "2020-11-05T13:40:28Z", "path": "components/camel-datasonnet/pom.xml", "diffHunk": "@@ -0,0 +1,142 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one or more\n+    contributor license agreements.  See the NOTICE file distributed with\n+    this work for additional information regarding copyright ownership.\n+    The ASF licenses this file to You under the Apache License, Version 2.0\n+    (the \"License\"); you may not use this file except in compliance with\n+    the License.  You may obtain a copy of the License at\n+\n+         http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <parent>\n+        <groupId>org.apache.camel</groupId>\n+        <artifactId>components</artifactId>\n+        <version>3.7.0-SNAPSHOT</version>\n+    </parent>\n+\n+    <artifactId>camel-datasonnet</artifactId>\n+    <packaging>jar</packaging>\n+\n+    <name>Camel :: DataSonnet</name>\n+    <description>Camel DataSonnet support</description>\n+\n+    <properties>\n+        <maven.compiler.source>1.8</maven.compiler.source>\n+        <maven.compiler.target>1.8</maven.compiler.target>\n+    </properties>\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>net.alchim31.maven</groupId>\n+                <artifactId>scala-maven-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>scala-compile-first</id>\n+                        <phase>process-resources</phase>\n+                        <goals>\n+                            <goal>add-source</goal>\n+                            <goal>compile</goal>\n+                        </goals>\n+                    </execution>\n+                    <execution>\n+                        <id>scala-test-compile</id>\n+                        <phase>process-test-resources</phase>\n+                        <goals>\n+                            <goal>testCompile</goal>\n+                        </goals>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-surefire-plugin</artifactId>\n+                <configuration>\n+                    <additionalClasspathElements>\n+                        <additionalClasspathElement>${project.basedir}/src/test/resources/dslibs.jar</additionalClasspathElement>\n+                    </additionalClasspathElements>\n+                </configuration>\n+            </plugin>\n+        </plugins>\n+    </build>\n+\n+    <dependencies>\n+        <!-- todo: confirm the scala incompatbility is with datasonnet -->\n+        <dependency>\n+            <groupId>org.scala-lang</groupId>\n+            <artifactId>scala-library</artifactId>\n+            <version>2.13.3</version>\n+        </dependency>\n+        <!-- apparently scala compiler needs this -->\n+        <dependency>\n+            <groupId>org.hamcrest</groupId>\n+            <artifactId>hamcrest</artifactId>\n+            <version>2.2</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.apache.camel</groupId>\n+            <artifactId>camel-support</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.datasonnet</groupId>\n+            <artifactId>datasonnet-mapper</artifactId>\n+            <version>0.6.0-MS3</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>commons-io</groupId>\n+            <artifactId>commons-io</artifactId>\n+            <version>2.4</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>io.github.classgraph</groupId>\n+            <artifactId>classgraph</artifactId>\n+            <version>4.8.52</version>\n+        </dependency>\n+\n+        <!-- testing -->\n+        <dependency>\n+            <groupId>org.apache.camel</groupId>\n+            <artifactId>camel-test-spring-junit5</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.apache.logging.log4j</groupId>\n+            <artifactId>log4j-slf4j-impl</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.junit.jupiter</groupId>\n+            <artifactId>junit-jupiter</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.skyscreamer</groupId>\n+            <artifactId>jsonassert</artifactId>\n+            <version>1.5.0</version>\n+            <scope>test</scope>\n+        </dependency>\n+    </dependencies>\n+\n+    <repositories>\n+        <repository>\n+            <id>ms3-nexus</id>", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQyMjg5NA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518422894", "bodyText": "Completely understood. We should be releasing the version we need in the next few days.", "author": "jam01", "createdAt": "2020-11-05T23:02:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1NzU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE3ODIzMQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r526178231", "bodyText": "released :)", "author": "jam01", "createdAt": "2020-11-18T15:29:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1NzU0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1Nzc3Nw==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518057777", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:40:50Z", "path": "components/camel-datasonnet/src/main/java/org/apache/camel/language/datasonnet/Datasonnet.java", "diffHunk": "@@ -0,0 +1,20 @@\n+package org.apache.camel.language.datasonnet;", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1NzkwMg==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518057902", "bodyText": "remove TODO", "author": "oscerd", "createdAt": "2020-11-05T13:41:01Z", "path": "components/camel-datasonnet/src/main/java/org/apache/camel/language/datasonnet/Datasonnet.java", "diffHunk": "@@ -0,0 +1,20 @@\n+package org.apache.camel.language.datasonnet;\n+\n+import java.lang.annotation.Documented;\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+import org.apache.camel.support.language.LanguageAnnotation;\n+\n+/**\n+ * Datasonnet TODO: 7/21/20 docs", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1Nzk5Nw==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518057997", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:41:10Z", "path": "components/camel-datasonnet/src/main/java/org/apache/camel/language/datasonnet/DatasonnetConstants.java", "diffHunk": "@@ -0,0 +1,6 @@\n+package org.apache.camel.language.datasonnet;", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1ODA1OQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518058059", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:41:16Z", "path": "components/camel-datasonnet/src/main/java/org/apache/camel/language/datasonnet/DatasonnetExpression.java", "diffHunk": "@@ -0,0 +1,240 @@\n+package org.apache.camel.language.datasonnet;", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1ODMyMA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518058320", "bodyText": "Remove TODO", "author": "oscerd", "createdAt": "2020-11-05T13:41:37Z", "path": "components/camel-datasonnet/src/main/java/org/apache/camel/language/datasonnet/DatasonnetExpression.java", "diffHunk": "@@ -0,0 +1,240 @@\n+package org.apache.camel.language.datasonnet;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.FileVisitResult;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.SimpleFileVisitor;\n+import java.nio.file.attribute.BasicFileAttributes;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+import com.datasonnet.Mapper;\n+import com.datasonnet.MapperBuilder;\n+import com.datasonnet.document.DefaultDocument;\n+import com.datasonnet.document.Document;\n+import com.datasonnet.document.MediaType;\n+import com.datasonnet.document.MediaTypes;\n+import io.github.classgraph.ClassGraph;\n+import io.github.classgraph.ScanResult;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Expression;\n+import org.apache.camel.RuntimeExpressionException;\n+import org.apache.camel.spi.ExpressionResultTypeAware;\n+import org.apache.camel.support.ExchangeHelper;\n+import org.apache.camel.support.ExpressionAdapter;\n+import org.apache.camel.support.MessageHelper;\n+import org.apache.commons.io.IOUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class DatasonnetExpression extends ExpressionAdapter implements ExpressionResultTypeAware {\n+    private static final Logger LOGGER = LoggerFactory.getLogger(DatasonnetExpression.class);\n+    private static final Map<String, String> CLASSPATH_IMPORTS = new HashMap<>();\n+\n+    static {\n+        LOGGER.debug(\"One time classpath search...\");\n+        try (ScanResult scanResult = new ClassGraph().whitelistPaths(\"/\").scan()) {\n+            scanResult.getResourcesWithExtension(\"libsonnet\")\n+                    .forEachByteArray((resource, bytes) -> {\n+                        LOGGER.debug(\"Loading DataSonnet library: \" + resource.getPath());\n+                        CLASSPATH_IMPORTS.put(resource.getPath(), new String(bytes, StandardCharsets.UTF_8));\n+                    });\n+        }\n+    }\n+\n+    private String expression;\n+    private Expression metaExpression;\n+    private MediaType bodyMediaType;\n+    private MediaType outputMediaType;\n+    private Class<?> resultType;\n+    private Collection<String> libraryPaths;\n+\n+    public DatasonnetExpression(String expression) {\n+        this.expression = expression;\n+    }\n+\n+    public DatasonnetExpression(Expression expression) {\n+        this.metaExpression = expression;\n+    }\n+\n+    @Override\n+    public boolean matches(Exchange exchange) {\n+        this.outputMediaType = MediaTypes.APPLICATION_JAVA;\n+        return evaluate(exchange, Boolean.class);\n+    }\n+\n+    @SuppressWarnings(\"unchecked\")\n+    @Override\n+    public <T> T evaluate(Exchange exchange, Class<T> type) {\n+        try {\n+            if (metaExpression != null) {\n+                expression = metaExpression.evaluate(exchange, String.class);\n+            }\n+\n+            Objects.requireNonNull(expression, \"String expression property must be set!\");\n+\n+            Document<?> result = doEvaluate(exchange);\n+            // TODO: 9/8/20 see if we can offload some of this to a Document specific custom type converter", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1ODU0MA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518058540", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:42:00Z", "path": "components/camel-datasonnet/src/main/java/org/apache/camel/language/datasonnet/DatasonnetLanguage.java", "diffHunk": "@@ -0,0 +1,130 @@\n+package org.apache.camel.language.datasonnet;", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1ODY4Mg==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518058682", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:42:12Z", "path": "components/camel-datasonnet/src/main/scala/org/apache/camel/language/datasonnet/CML.scala", "diffHunk": "@@ -0,0 +1,58 @@\n+package org.apache.camel.language.datasonnet", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1ODc2MQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518058761", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:42:20Z", "path": "components/camel-datasonnet/src/test/java/org/apache/camel/language/datasonnet/CamelDatasonnetTest.java", "diffHunk": "@@ -0,0 +1,141 @@\n+package org.apache.camel.language.datasonnet;", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1ODg2NA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518058864", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:42:29Z", "path": "components/camel-datasonnet/src/test/java/org/apache/camel/language/datasonnet/ExpressionsInJavaTest.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package org.apache.camel.language.datasonnet;", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1ODk4NQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518058985", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:42:39Z", "path": "components/camel-datasonnet/src/test/java/org/apache/camel/language/datasonnet/Gizmo.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package org.apache.camel.language.datasonnet;", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1OTEwNg==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518059106", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:42:48Z", "path": "components/camel-datasonnet/src/test/java/org/apache/camel/language/datasonnet/Manufacturer.java", "diffHunk": "@@ -0,0 +1,48 @@\n+package org.apache.camel.language.datasonnet;", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1OTE5Ng==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518059196", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:42:58Z", "path": "components/camel-datasonnet/src/test/java/org/apache/camel/language/datasonnet/PropertiesTest.java", "diffHunk": "@@ -0,0 +1,36 @@\n+package org.apache.camel.language.datasonnet;", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1OTU0Ng==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518059546", "bodyText": "I guess a license should be good here to", "author": "oscerd", "createdAt": "2020-11-05T13:43:27Z", "path": "components/camel-datasonnet/src/test/resources/javaTest.json", "diffHunk": "@@ -0,0 +1,15 @@\n+{", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1OTg3OA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518059878", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:43:57Z", "path": "components/camel-datasonnet/src/test/resources/namedImports.ds", "diffHunk": "@@ -0,0 +1,11 @@\n+local testlib1 = import 'testlib.libsonnet';", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1OTkzMg==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518059932", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:44:02Z", "path": "components/camel-datasonnet/src/test/resources/namedImportsFS.ds", "diffHunk": "@@ -0,0 +1,7 @@\n+local testlib3 = import 'testlib3.libsonnet';", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MDAxNA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518060014", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:44:09Z", "path": "components/camel-datasonnet/src/test/resources/namedImports_result.json", "diffHunk": "@@ -0,0 +1 @@\n+{\"Lib1JAR\":\"Hello, World\",\"Lib2JAR\":\"Bye, World\",\"Lib3FS\":\"Hello, World : TestLib3\",\"Lib4FS\":\"Bye, World : TestLib4\"}", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MDA3MQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518060071", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:44:13Z", "path": "components/camel-datasonnet/src/test/resources/org/apache/camel/language.datasonnet/camel-context.xml", "diffHunk": "@@ -0,0 +1,155 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MDE5Mg==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518060192", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:44:23Z", "path": "components/camel-datasonnet/src/test/resources/payload.csv", "diffHunk": "@@ -0,0 +1,2 @@\n+account,firstName,lastName", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MDI2OA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518060268", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:44:27Z", "path": "components/camel-datasonnet/src/test/resources/payload.xml", "diffHunk": "@@ -0,0 +1,4 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MDMxNA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518060314", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:44:32Z", "path": "components/camel-datasonnet/src/test/resources/readCSVTest.ds", "diffHunk": "@@ -0,0 +1,3 @@\n+{", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MDM2Ng==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518060366", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:44:38Z", "path": "components/camel-datasonnet/src/test/resources/readJavaTest.ds", "diffHunk": "@@ -0,0 +1,12 @@\n+/** DataSonnet", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MDQzNw==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518060437", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:44:45Z", "path": "components/camel-datasonnet/src/test/resources/readXMLExtTest.ds", "diffHunk": "@@ -0,0 +1,6 @@\n+/** DataSonnet", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MDQ5NQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518060495", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:44:50Z", "path": "components/camel-datasonnet/src/test/resources/readXMLExtTest.json", "diffHunk": "@@ -0,0 +1,11 @@\n+{", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MDU4MQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518060581", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:44:58Z", "path": "components/camel-datasonnet/src/test/resources/simpleMapping.ds", "diffHunk": "@@ -0,0 +1,8 @@\n+{", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MDYyOQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518060629", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:45:02Z", "path": "components/camel-datasonnet/src/test/resources/simpleMapping_payload.json", "diffHunk": "@@ -0,0 +1,4 @@\n+{", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MDcwNg==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518060706", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:45:08Z", "path": "components/camel-datasonnet/src/test/resources/simpleMapping_result.json", "diffHunk": "@@ -0,0 +1 @@\n+{\"count\":1,\"isActive\":true,\"testVar\":\"HelloWorld\",\"uid\":123,\"uname\":\"JavaDuke\",\"fullName\": \"DataSonnet\"}", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODIxNDg4Ng==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518214886", "bodyText": "Oh is there a way to add license to JSON files?", "author": "jam01", "createdAt": "2020-11-05T17:08:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MDcwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODIzMDE2MQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518230161", "bodyText": "Not sure if it is feasible, probably not :-)", "author": "oscerd", "createdAt": "2020-11-05T17:31:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MDcwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MDc3Nw==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518060777", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:45:14Z", "path": "components/camel-datasonnet/src/test/resources/testlib3.libsonnet", "diffHunk": "@@ -0,0 +1,4 @@\n+{", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MDgyNg==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518060826", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:45:19Z", "path": "components/camel-datasonnet/src/test/resources/writeJavaTest.ds", "diffHunk": "@@ -0,0 +1,12 @@\n+/** DataSonnet", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MTA2OA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518061068", "bodyText": "Add ASF license please", "author": "oscerd", "createdAt": "2020-11-05T13:45:41Z", "path": "core/camel-core-model/src/main/java/org/apache/camel/model/language/DatasonnetExpression.java", "diffHunk": "@@ -0,0 +1,95 @@\n+package org.apache.camel.model.language;", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MTU0NQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r518061545", "bodyText": "No need for the dep here, it has already been added on line 1255", "author": "oscerd", "createdAt": "2020-11-05T13:46:26Z", "path": "parent/pom.xml", "diffHunk": "@@ -2642,6 +2647,11 @@\n \t\t\t\t<artifactId>camel-zookeeper</artifactId>\n \t\t\t\t<version>${project.version}</version>\n \t\t\t</dependency>\n+\t\t\t<dependency>\n+        <groupId>org.apache.camel</groupId>\n+        <artifactId>camel-datasonnet</artifactId>\n+        <version>${project.version}</version>", "originalCommit": "c96b0639c08232ff5e9737ffe66959566815cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "aadaa19fca2c2e116d90a1303831f8dcafd3efbd", "url": "https://github.com/apache/camel/commit/aadaa19fca2c2e116d90a1303831f8dcafd3efbd", "message": "adds ASF license where possible", "committedDate": "2020-11-05T16:57:27Z", "type": "commit"}, {"oid": "30a86bd33865a8d3e0a8601c8447ad3186a1db88", "url": "https://github.com/apache/camel/commit/30a86bd33865a8d3e0a8601c8447ad3186a1db88", "message": "uses parent/pom for dep versions", "committedDate": "2020-11-05T17:06:34Z", "type": "commit"}, {"oid": "b7385ff51b85cc6d89dfb99f381a90d3cc0c5124", "url": "https://github.com/apache/camel/commit/b7385ff51b85cc6d89dfb99f381a90d3cc0c5124", "message": "adds licenses in core-model", "committedDate": "2020-11-05T17:30:56Z", "type": "commit"}, {"oid": "704e851cfa7846ce33a5ad6da4d594128c86446f", "url": "https://github.com/apache/camel/commit/704e851cfa7846ce33a5ad6da4d594128c86446f", "message": "addresses checkstyle", "committedDate": "2020-11-05T17:32:38Z", "type": "commit"}, {"oid": "43533afb0e4c725965dac4863df5cb6b124c5390", "url": "https://github.com/apache/camel/commit/43533afb0e4c725965dac4863df5cb6b124c5390", "message": "align scala deps", "committedDate": "2020-11-05T19:34:05Z", "type": "commit"}, {"oid": "c8efb72c7de33835c85dcd0db14d43d719316bd2", "url": "https://github.com/apache/camel/commit/c8efb72c7de33835c85dcd0db14d43d719316bd2", "message": "uses parent/pom for dep versions", "committedDate": "2020-11-05T23:00:29Z", "type": "commit"}, {"oid": "3a7c3b5b19e378230c78fadedd46826f21c83fe3", "url": "https://github.com/apache/camel/commit/3a7c3b5b19e378230c78fadedd46826f21c83fe3", "message": "maven central mapper version", "committedDate": "2020-11-18T15:23:10Z", "type": "commit"}, {"oid": "9ecb6a4a7a3fc1246cc82a2fad01afbfa2c10045", "url": "https://github.com/apache/camel/commit/9ecb6a4a7a3fc1246cc82a2fad01afbfa2c10045", "message": "supportlevel preview", "committedDate": "2020-11-18T15:24:10Z", "type": "commit"}, {"oid": "1497845418aabedb89081403140d4f08fefb32cf", "url": "https://github.com/apache/camel/commit/1497845418aabedb89081403140d4f08fefb32cf", "message": "remvoe todos", "committedDate": "2020-11-18T15:29:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE2ODk1OA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r528168958", "bodyText": "In XML I think > needs to be escaped", "author": "davsclaus", "createdAt": "2020-11-21T08:41:10Z", "path": "components/camel-datasonnet/src/main/docs/datasonnet-language.adoc", "diffHunk": "@@ -0,0 +1,193 @@\n+[[datasonnet-language]]\n+= DataSonnet Language\n+:docTitle: DataSonnet\n+:artifactId: camel-datasonnet\n+:description: To use DataSonnet scripts in Camel expressions or predicates.\n+:since: 3.7\n+:supportLevel: Preview\n+include::{cq-version}@camel-quarkus:ROOT:partial$reference/languages/datasonnet.adoc[opts=optional]\n+\n+*Since Camel {since}*\n+\n+Camel supports https://datasonnet.com/[DataSonnet] transformations to allow an Expression or Predicate to be used in the Java DSL or  xref:manual::xml-configuration.adoc[XML\n+Configuration].\n+\n+To use a DataSonnet expression use the following Java code:\n+[source,java]\n+---------------------------------------\n+... datasonnet(\"someDSExpression\") ...\n+---------------------------------------\n+\n+== Example\n+\n+Here is a simple example using a DataSonnet expression as a predicate in a Message Filter:\n+\n+[source,java]\n+------------------------------------------------------------------------------------------------\n+// lets route if a line item is over $100\n+from(\"queue:foo\")\n+    .filter(datasonnet(\"ds.arrays.firstWith(body.lineItems, function(item) item > 100) != null\"))\n+    .to(\"queue:bar\")\n+------------------------------------------------------------------------------------------------\n+\n+And the Spring DSL:\n+\n+[source,xml]\n+-----------------------------------------------------------------------------\n+<route>\n+    <from uri=\"queue:foo\"/>\n+    <filter>\n+        <datasonnet>ds.arrays.firstWith(body.lineItems, function(item) item > 100) != null</datasonnet>", "originalCommit": "1497845418aabedb89081403140d4f08fefb32cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTYyNjMwMQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r529626301", "bodyText": "I dont think it does ( unless this ones doing something special that im not aware of)\nThe soap component docs has some XML in it which is not escaped\nAnd if you meant the > inside the value then it looks like groovy docs has an example of that", "author": "JakeMHughes", "createdAt": "2020-11-24T15:19:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE2ODk1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDExMjI4OA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r530112288", "bodyText": "Ah yeah there may be some mistakes in other parts of the docs. However you need to escape this in XML, but then they are harder to read, > vs > - but we can leave this as-is.\nHow is it going with all the other review comments?", "author": "davsclaus", "createdAt": "2020-11-25T05:12:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE2ODk1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE2ODk4OA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r528168988", "bodyText": "I assume this 3rd party maven repo can be removed", "author": "davsclaus", "createdAt": "2020-11-21T08:41:27Z", "path": "components/camel-datasonnet/pom.xml", "diffHunk": "@@ -0,0 +1,134 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one or more\n+    contributor license agreements.  See the NOTICE file distributed with\n+    this work for additional information regarding copyright ownership.\n+    The ASF licenses this file to You under the Apache License, Version 2.0\n+    (the \"License\"); you may not use this file except in compliance with\n+    the License.  You may obtain a copy of the License at\n+\n+         http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <parent>\n+        <groupId>org.apache.camel</groupId>\n+        <artifactId>components</artifactId>\n+        <version>3.7.0-SNAPSHOT</version>\n+    </parent>\n+\n+    <artifactId>camel-datasonnet</artifactId>\n+    <packaging>jar</packaging>\n+\n+    <name>Camel :: DataSonnet</name>\n+    <description>Camel DataSonnet support</description>\n+\n+    <properties>\n+        <maven.compiler.source>1.8</maven.compiler.source>\n+        <maven.compiler.target>1.8</maven.compiler.target>\n+    </properties>\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>net.alchim31.maven</groupId>\n+                <artifactId>scala-maven-plugin</artifactId>\n+                <version>4.4.0</version>\n+                <executions>\n+                    <execution>\n+                        <id>scala-compile-first</id>\n+                        <phase>process-resources</phase>\n+                        <goals>\n+                            <goal>add-source</goal>\n+                            <goal>compile</goal>\n+                        </goals>\n+                    </execution>\n+                    <execution>\n+                        <id>scala-test-compile</id>\n+                        <phase>process-test-resources</phase>\n+                        <goals>\n+                            <goal>testCompile</goal>\n+                        </goals>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-surefire-plugin</artifactId>\n+                <configuration>\n+                    <additionalClasspathElements>\n+                        <additionalClasspathElement>${project.basedir}/src/test/resources/dslibs.jar</additionalClasspathElement>\n+                    </additionalClasspathElements>\n+                </configuration>\n+            </plugin>\n+        </plugins>\n+    </build>\n+\n+    <dependencies>\n+        <dependency>\n+            <groupId>org.scala-lang</groupId>\n+            <artifactId>scala-library</artifactId>\n+            <version>${scala-datasonnet-version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.apache.camel</groupId>\n+            <artifactId>camel-support</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.ms3-inc</groupId>\n+            <artifactId>datasonnet-mapper</artifactId>\n+            <version>${datasonnet-mapper-version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>commons-io</groupId>\n+            <artifactId>commons-io</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>io.github.classgraph</groupId>\n+            <artifactId>classgraph</artifactId>\n+            <version>${classgraph-version}</version>\n+        </dependency>\n+\n+        <!-- testing -->\n+        <dependency>\n+            <groupId>org.apache.camel</groupId>\n+            <artifactId>camel-test-spring-junit5</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.apache.logging.log4j</groupId>\n+            <artifactId>log4j-slf4j-impl</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.junit.jupiter</groupId>\n+            <artifactId>junit-jupiter</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.skyscreamer</groupId>\n+            <artifactId>jsonassert</artifactId>\n+            <version>${jsonassert-version}</version>\n+            <scope>test</scope>\n+        </dependency>\n+    </dependencies>\n+\n+    <repositories>\n+        <repository>\n+            <id>ms3-nexus</id>", "originalCommit": "1497845418aabedb89081403140d4f08fefb32cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE2OTAzNQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r528169035", "bodyText": "Can we avoid having scala source code. We want everyone to be able to maintain the code and for that we prefer Java", "author": "davsclaus", "createdAt": "2020-11-21T08:42:01Z", "path": "components/camel-datasonnet/pom.xml", "diffHunk": "@@ -0,0 +1,134 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one or more\n+    contributor license agreements.  See the NOTICE file distributed with\n+    this work for additional information regarding copyright ownership.\n+    The ASF licenses this file to You under the Apache License, Version 2.0\n+    (the \"License\"); you may not use this file except in compliance with\n+    the License.  You may obtain a copy of the License at\n+\n+         http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <parent>\n+        <groupId>org.apache.camel</groupId>\n+        <artifactId>components</artifactId>\n+        <version>3.7.0-SNAPSHOT</version>\n+    </parent>\n+\n+    <artifactId>camel-datasonnet</artifactId>\n+    <packaging>jar</packaging>\n+\n+    <name>Camel :: DataSonnet</name>\n+    <description>Camel DataSonnet support</description>\n+\n+    <properties>\n+        <maven.compiler.source>1.8</maven.compiler.source>\n+        <maven.compiler.target>1.8</maven.compiler.target>\n+    </properties>\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>net.alchim31.maven</groupId>", "originalCommit": "1497845418aabedb89081403140d4f08fefb32cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDUyNzYwNw==", "url": "https://github.com/apache/camel/pull/4561#discussion_r534527607", "bodyText": "addressed :)", "author": "jam01", "createdAt": "2020-12-02T22:34:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE2OTAzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE2OTA5Nw==", "url": "https://github.com/apache/camel/pull/4561#discussion_r528169097", "bodyText": "Remove these as this is configured in some parent/root pom file", "author": "davsclaus", "createdAt": "2020-11-21T08:42:22Z", "path": "components/camel-datasonnet/pom.xml", "diffHunk": "@@ -0,0 +1,134 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one or more\n+    contributor license agreements.  See the NOTICE file distributed with\n+    this work for additional information regarding copyright ownership.\n+    The ASF licenses this file to You under the Apache License, Version 2.0\n+    (the \"License\"); you may not use this file except in compliance with\n+    the License.  You may obtain a copy of the License at\n+\n+         http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <parent>\n+        <groupId>org.apache.camel</groupId>\n+        <artifactId>components</artifactId>\n+        <version>3.7.0-SNAPSHOT</version>\n+    </parent>\n+\n+    <artifactId>camel-datasonnet</artifactId>\n+    <packaging>jar</packaging>\n+\n+    <name>Camel :: DataSonnet</name>\n+    <description>Camel DataSonnet support</description>\n+\n+    <properties>", "originalCommit": "1497845418aabedb89081403140d4f08fefb32cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU0NTA4Ng==", "url": "https://github.com/apache/camel/pull/4561#discussion_r530545086", "bodyText": "Hey Claus, by 'these' you mean the maven compiler properties, correct? The way github shows comments can be confusing sometimes...", "author": "jam01", "createdAt": "2020-11-25T17:39:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE2OTA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU2MDY5MA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r530560690", "bodyText": "Yes its the <properties> that can be removed", "author": "davsclaus", "createdAt": "2020-11-25T18:07:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE2OTA5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE2OTEyNQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r528169125", "bodyText": "Same as before", "author": "davsclaus", "createdAt": "2020-11-21T08:42:51Z", "path": "components/camel-datasonnet/src/main/docs/datasonnet-language.adoc", "diffHunk": "@@ -0,0 +1,193 @@\n+[[datasonnet-language]]\n+= DataSonnet Language\n+:docTitle: DataSonnet\n+:artifactId: camel-datasonnet\n+:description: To use DataSonnet scripts in Camel expressions or predicates.\n+:since: 3.7\n+:supportLevel: Preview\n+include::{cq-version}@camel-quarkus:ROOT:partial$reference/languages/datasonnet.adoc[opts=optional]\n+\n+*Since Camel {since}*\n+\n+Camel supports https://datasonnet.com/[DataSonnet] transformations to allow an Expression or Predicate to be used in the Java DSL or  xref:manual::xml-configuration.adoc[XML\n+Configuration].\n+\n+To use a DataSonnet expression use the following Java code:\n+[source,java]\n+---------------------------------------\n+... datasonnet(\"someDSExpression\") ...\n+---------------------------------------\n+\n+== Example\n+\n+Here is a simple example using a DataSonnet expression as a predicate in a Message Filter:\n+\n+[source,java]\n+------------------------------------------------------------------------------------------------\n+// lets route if a line item is over $100\n+from(\"queue:foo\")\n+    .filter(datasonnet(\"ds.arrays.firstWith(body.lineItems, function(item) item > 100) != null\"))\n+    .to(\"queue:bar\")\n+------------------------------------------------------------------------------------------------\n+\n+And the Spring DSL:\n+\n+[source,xml]\n+-----------------------------------------------------------------------------\n+<route>\n+    <from uri=\"queue:foo\"/>\n+    <filter>\n+        <datasonnet>ds.arrays.firstWith(body.lineItems, function(item) item > 100) != null</datasonnet>\n+        <to uri=\"queue:bar\"/>\n+    </filter>\n+</route>\n+-----------------------------------------------------------------------------\n+\n+Here is an example of a simple DataSonnet expression as a transformation EIP. This example will transform an XML body with\n+`lineItems` into JSON while filtering out lines that are under 100.\n+\n+[source,java]\n+------------------------------------------------------------------------------------------------\n+from(\"queue:foo\")\n+    .transform(datasonnet(\"ds.filter(body.lineItems, function(item) item > 100)\", String.class)\n+        .bodyMediaType(\"application/xml\").outputMediaType(\"application/json\")\n+    )\n+    .to(\"queue:bar\")\n+------------------------------------------------------------------------------------------------\n+\n+And the Spring DSL:\n+\n+[source,xml]\n+-----------------------------------------------------------------------------\n+<route>\n+    <from uri=\"queue:foo\"/>\n+    <filter>\n+        <datasonnet bodyMediaType=\"application/xml\" outputMediaType=\"application/json\" resultTypeName=\"java.lang.String\" >\n+            ds.filter(body.lineItems, function(item) item > 100)", "originalCommit": "1497845418aabedb89081403140d4f08fefb32cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU0NTkzNQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r530545935", "bodyText": "marking as resolved for legibility as stated previously", "author": "jam01", "createdAt": "2020-11-25T17:40:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE2OTEyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE2OTE1Ng==", "url": "https://github.com/apache/camel/pull/4561#discussion_r528169156", "bodyText": "Spring DSL -> XML DSL (that is the term we favour)", "author": "davsclaus", "createdAt": "2020-11-21T08:43:36Z", "path": "components/camel-datasonnet/src/main/docs/datasonnet-language.adoc", "diffHunk": "@@ -0,0 +1,193 @@\n+[[datasonnet-language]]\n+= DataSonnet Language\n+:docTitle: DataSonnet\n+:artifactId: camel-datasonnet\n+:description: To use DataSonnet scripts in Camel expressions or predicates.\n+:since: 3.7\n+:supportLevel: Preview\n+include::{cq-version}@camel-quarkus:ROOT:partial$reference/languages/datasonnet.adoc[opts=optional]\n+\n+*Since Camel {since}*\n+\n+Camel supports https://datasonnet.com/[DataSonnet] transformations to allow an Expression or Predicate to be used in the Java DSL or  xref:manual::xml-configuration.adoc[XML\n+Configuration].\n+\n+To use a DataSonnet expression use the following Java code:\n+[source,java]\n+---------------------------------------\n+... datasonnet(\"someDSExpression\") ...\n+---------------------------------------\n+\n+== Example\n+\n+Here is a simple example using a DataSonnet expression as a predicate in a Message Filter:\n+\n+[source,java]\n+------------------------------------------------------------------------------------------------\n+// lets route if a line item is over $100\n+from(\"queue:foo\")\n+    .filter(datasonnet(\"ds.arrays.firstWith(body.lineItems, function(item) item > 100) != null\"))\n+    .to(\"queue:bar\")\n+------------------------------------------------------------------------------------------------\n+\n+And the Spring DSL:\n+\n+[source,xml]\n+-----------------------------------------------------------------------------\n+<route>\n+    <from uri=\"queue:foo\"/>\n+    <filter>\n+        <datasonnet>ds.arrays.firstWith(body.lineItems, function(item) item > 100) != null</datasonnet>\n+        <to uri=\"queue:bar\"/>\n+    </filter>\n+</route>\n+-----------------------------------------------------------------------------\n+\n+Here is an example of a simple DataSonnet expression as a transformation EIP. This example will transform an XML body with\n+`lineItems` into JSON while filtering out lines that are under 100.\n+\n+[source,java]\n+------------------------------------------------------------------------------------------------\n+from(\"queue:foo\")\n+    .transform(datasonnet(\"ds.filter(body.lineItems, function(item) item > 100)\", String.class)\n+        .bodyMediaType(\"application/xml\").outputMediaType(\"application/json\")\n+    )\n+    .to(\"queue:bar\")\n+------------------------------------------------------------------------------------------------\n+\n+And the Spring DSL:\n+\n+[source,xml]\n+-----------------------------------------------------------------------------\n+<route>\n+    <from uri=\"queue:foo\"/>\n+    <filter>\n+        <datasonnet bodyMediaType=\"application/xml\" outputMediaType=\"application/json\" resultTypeName=\"java.lang.String\" >\n+            ds.filter(body.lineItems, function(item) item > 100)\n+        </datasonnet>\n+        <to uri=\"queue:bar\"/>\n+    </filter>\n+</route>\n+-----------------------------------------------------------------------------\n+\n+== Setting result type\n+\n+The xref:datasonnet-language.adoc[DataSonnet] expression will return a `com.datasonnet.document.Document` by default. The\n+document preserves the content type metadata along with the contents of the result of the transformation. In predicates,\n+however, the Document will be automatically unwrapped and the boolean content will be returned. Similarly any times you\n+want the content in a specific result type like a String. To do this you have to instruct the\n+xref:datasonnet-language.adoc[DataSonnet] which result type to return.\n+\n+In Java DSL:\n+\n+[source,java]\n+----\n+datasonnet(\"body.foo\", String.class)\n+----\n+\n+In Spring DSL you use the *resultType* attribute to provide a fully", "originalCommit": "1497845418aabedb89081403140d4f08fefb32cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE2OTQ2OQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r528169469", "bodyText": "I wonder if we can make a better example as using datasonnet to set the body via a property is not something you would do. I assume you can use these functions in those previous example. For example the value of 100 can be a property", "author": "davsclaus", "createdAt": "2020-11-21T08:45:36Z", "path": "components/camel-datasonnet/src/main/docs/datasonnet-language.adoc", "diffHunk": "@@ -0,0 +1,193 @@\n+[[datasonnet-language]]\n+= DataSonnet Language\n+:docTitle: DataSonnet\n+:artifactId: camel-datasonnet\n+:description: To use DataSonnet scripts in Camel expressions or predicates.\n+:since: 3.7\n+:supportLevel: Preview\n+include::{cq-version}@camel-quarkus:ROOT:partial$reference/languages/datasonnet.adoc[opts=optional]\n+\n+*Since Camel {since}*\n+\n+Camel supports https://datasonnet.com/[DataSonnet] transformations to allow an Expression or Predicate to be used in the Java DSL or  xref:manual::xml-configuration.adoc[XML\n+Configuration].\n+\n+To use a DataSonnet expression use the following Java code:\n+[source,java]\n+---------------------------------------\n+... datasonnet(\"someDSExpression\") ...\n+---------------------------------------\n+\n+== Example\n+\n+Here is a simple example using a DataSonnet expression as a predicate in a Message Filter:\n+\n+[source,java]\n+------------------------------------------------------------------------------------------------\n+// lets route if a line item is over $100\n+from(\"queue:foo\")\n+    .filter(datasonnet(\"ds.arrays.firstWith(body.lineItems, function(item) item > 100) != null\"))\n+    .to(\"queue:bar\")\n+------------------------------------------------------------------------------------------------\n+\n+And the Spring DSL:\n+\n+[source,xml]\n+-----------------------------------------------------------------------------\n+<route>\n+    <from uri=\"queue:foo\"/>\n+    <filter>\n+        <datasonnet>ds.arrays.firstWith(body.lineItems, function(item) item > 100) != null</datasonnet>\n+        <to uri=\"queue:bar\"/>\n+    </filter>\n+</route>\n+-----------------------------------------------------------------------------\n+\n+Here is an example of a simple DataSonnet expression as a transformation EIP. This example will transform an XML body with\n+`lineItems` into JSON while filtering out lines that are under 100.\n+\n+[source,java]\n+------------------------------------------------------------------------------------------------\n+from(\"queue:foo\")\n+    .transform(datasonnet(\"ds.filter(body.lineItems, function(item) item > 100)\", String.class)\n+        .bodyMediaType(\"application/xml\").outputMediaType(\"application/json\")\n+    )\n+    .to(\"queue:bar\")\n+------------------------------------------------------------------------------------------------\n+\n+And the Spring DSL:\n+\n+[source,xml]\n+-----------------------------------------------------------------------------\n+<route>\n+    <from uri=\"queue:foo\"/>\n+    <filter>\n+        <datasonnet bodyMediaType=\"application/xml\" outputMediaType=\"application/json\" resultTypeName=\"java.lang.String\" >\n+            ds.filter(body.lineItems, function(item) item > 100)\n+        </datasonnet>\n+        <to uri=\"queue:bar\"/>\n+    </filter>\n+</route>\n+-----------------------------------------------------------------------------\n+\n+== Setting result type\n+\n+The xref:datasonnet-language.adoc[DataSonnet] expression will return a `com.datasonnet.document.Document` by default. The\n+document preserves the content type metadata along with the contents of the result of the transformation. In predicates,\n+however, the Document will be automatically unwrapped and the boolean content will be returned. Similarly any times you\n+want the content in a specific result type like a String. To do this you have to instruct the\n+xref:datasonnet-language.adoc[DataSonnet] which result type to return.\n+\n+In Java DSL:\n+\n+[source,java]\n+----\n+datasonnet(\"body.foo\", String.class)\n+----\n+\n+In Spring DSL you use the *resultType* attribute to provide a fully\n+qualified classname:\n+\n+[source,xml]\n+----\n+<datasonnet resultType=\"java.lang.String\">body.foo</datasonnet>\n+----\n+\n+If the expression results in an array, or an object, you can instruct the expression to return you `List.class`\n+or `Map.class`, respectively. However, you must also set the output media type to `application/x-java-object`.\n+\n+NOTE: The default `Document` object is useful in situations where there are intermediate transformation steps, and so\n+retaining the content metadata through a route execution is valuable.\n+\n+== Specifying Media Types\n+\n+Traditionally the input and output media types are specified through the\n+https://datasonnet.s3-us-west-2.amazonaws.com/docs-ci/primary/master/datasonnet/1.0-SNAPSHOT/headers.html[DataSonnet Header]\n+The xref:datasonnet-language.adoc[DataSonnet] expression provides convenience options for specifying the body and output\n+media types without the need for a Header, this is useful if the transformation is a one-liner, for example.\n+\n+The DataSonnet expression will look for a body media type in the following order:\n+\n+1. If the body is a `Document` it will use the metadata in the object\n+2. If the convenience bodyMediaType method was used, it will use its value\n+3. A \"CamelDatasonnetBodyMediaType\" exchange property\n+4. A \"Content-Type\" message header\n+5. The DataSonnet Header payload media type directive\n+6. `application/x-java-object`\n+\n+And for output media type:\n+\n+1. If the convenience outputMediaType method was used, it will use its value\n+2. A \"CamelDatasonnetOutputMediaType\" exchange property\n+3. A \"CamelDatasonnetOutputMediaType\" message header\n+4. The DataSonnet Header output media type directive\n+5. `application/x-java-object`\n+\n+== Functions\n+\n+Camel adds the following DataSonnet functions that can be used to access the\n+exchange:\n+\n+[width=\"100%\",cols=\"10%,10%,10%,70%\",options=\"header\",]\n+|===\n+|Function |Argument |Type |Description\n+\n+|cml.properties |key for property |String |To lookup a property using the\n+xref:ROOT:properties-component.adoc[Properties] component (property placeholders).\n+\n+|cml.header |the header name |String |Will return the message header.\n+\n+|cml.exchangeProperty |key for property |String |Will return the exchange property.\n+|===\n+\n+Here's an example showing some of these functions in use:", "originalCommit": "1497845418aabedb89081403140d4f08fefb32cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU0Mzg5Ng==", "url": "https://github.com/apache/camel/pull/4561#discussion_r530543896", "bodyText": "changed to .setBody(datasonnet(\"'hello, ' + cml.properties('toGreet')\", String.class)) let us know if that works", "author": "jam01", "createdAt": "2020-11-25T17:37:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE2OTQ2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE2OTQ5MA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r528169490", "bodyText": "Very good documentation - thank you", "author": "davsclaus", "createdAt": "2020-11-21T08:46:00Z", "path": "components/camel-datasonnet/src/main/docs/datasonnet-language.adoc", "diffHunk": "@@ -0,0 +1,193 @@\n+[[datasonnet-language]]\n+= DataSonnet Language\n+:docTitle: DataSonnet\n+:artifactId: camel-datasonnet\n+:description: To use DataSonnet scripts in Camel expressions or predicates.\n+:since: 3.7\n+:supportLevel: Preview\n+include::{cq-version}@camel-quarkus:ROOT:partial$reference/languages/datasonnet.adoc[opts=optional]\n+\n+*Since Camel {since}*\n+\n+Camel supports https://datasonnet.com/[DataSonnet] transformations to allow an Expression or Predicate to be used in the Java DSL or  xref:manual::xml-configuration.adoc[XML\n+Configuration].\n+\n+To use a DataSonnet expression use the following Java code:\n+[source,java]\n+---------------------------------------\n+... datasonnet(\"someDSExpression\") ...\n+---------------------------------------\n+\n+== Example\n+\n+Here is a simple example using a DataSonnet expression as a predicate in a Message Filter:\n+\n+[source,java]\n+------------------------------------------------------------------------------------------------\n+// lets route if a line item is over $100\n+from(\"queue:foo\")\n+    .filter(datasonnet(\"ds.arrays.firstWith(body.lineItems, function(item) item > 100) != null\"))\n+    .to(\"queue:bar\")\n+------------------------------------------------------------------------------------------------\n+\n+And the Spring DSL:\n+\n+[source,xml]\n+-----------------------------------------------------------------------------\n+<route>\n+    <from uri=\"queue:foo\"/>\n+    <filter>\n+        <datasonnet>ds.arrays.firstWith(body.lineItems, function(item) item > 100) != null</datasonnet>\n+        <to uri=\"queue:bar\"/>\n+    </filter>\n+</route>\n+-----------------------------------------------------------------------------\n+\n+Here is an example of a simple DataSonnet expression as a transformation EIP. This example will transform an XML body with\n+`lineItems` into JSON while filtering out lines that are under 100.\n+\n+[source,java]\n+------------------------------------------------------------------------------------------------\n+from(\"queue:foo\")\n+    .transform(datasonnet(\"ds.filter(body.lineItems, function(item) item > 100)\", String.class)\n+        .bodyMediaType(\"application/xml\").outputMediaType(\"application/json\")\n+    )\n+    .to(\"queue:bar\")\n+------------------------------------------------------------------------------------------------\n+\n+And the Spring DSL:\n+\n+[source,xml]\n+-----------------------------------------------------------------------------\n+<route>\n+    <from uri=\"queue:foo\"/>\n+    <filter>\n+        <datasonnet bodyMediaType=\"application/xml\" outputMediaType=\"application/json\" resultTypeName=\"java.lang.String\" >\n+            ds.filter(body.lineItems, function(item) item > 100)\n+        </datasonnet>\n+        <to uri=\"queue:bar\"/>\n+    </filter>\n+</route>\n+-----------------------------------------------------------------------------\n+\n+== Setting result type\n+\n+The xref:datasonnet-language.adoc[DataSonnet] expression will return a `com.datasonnet.document.Document` by default. The\n+document preserves the content type metadata along with the contents of the result of the transformation. In predicates,\n+however, the Document will be automatically unwrapped and the boolean content will be returned. Similarly any times you\n+want the content in a specific result type like a String. To do this you have to instruct the\n+xref:datasonnet-language.adoc[DataSonnet] which result type to return.\n+\n+In Java DSL:\n+\n+[source,java]\n+----\n+datasonnet(\"body.foo\", String.class)\n+----\n+\n+In Spring DSL you use the *resultType* attribute to provide a fully\n+qualified classname:\n+\n+[source,xml]\n+----\n+<datasonnet resultType=\"java.lang.String\">body.foo</datasonnet>\n+----\n+\n+If the expression results in an array, or an object, you can instruct the expression to return you `List.class`\n+or `Map.class`, respectively. However, you must also set the output media type to `application/x-java-object`.\n+\n+NOTE: The default `Document` object is useful in situations where there are intermediate transformation steps, and so\n+retaining the content metadata through a route execution is valuable.\n+\n+== Specifying Media Types\n+\n+Traditionally the input and output media types are specified through the\n+https://datasonnet.s3-us-west-2.amazonaws.com/docs-ci/primary/master/datasonnet/1.0-SNAPSHOT/headers.html[DataSonnet Header]\n+The xref:datasonnet-language.adoc[DataSonnet] expression provides convenience options for specifying the body and output\n+media types without the need for a Header, this is useful if the transformation is a one-liner, for example.\n+\n+The DataSonnet expression will look for a body media type in the following order:\n+\n+1. If the body is a `Document` it will use the metadata in the object\n+2. If the convenience bodyMediaType method was used, it will use its value\n+3. A \"CamelDatasonnetBodyMediaType\" exchange property\n+4. A \"Content-Type\" message header\n+5. The DataSonnet Header payload media type directive\n+6. `application/x-java-object`\n+\n+And for output media type:\n+\n+1. If the convenience outputMediaType method was used, it will use its value\n+2. A \"CamelDatasonnetOutputMediaType\" exchange property\n+3. A \"CamelDatasonnetOutputMediaType\" message header\n+4. The DataSonnet Header output media type directive\n+5. `application/x-java-object`\n+\n+== Functions\n+\n+Camel adds the following DataSonnet functions that can be used to access the\n+exchange:\n+\n+[width=\"100%\",cols=\"10%,10%,10%,70%\",options=\"header\",]\n+|===\n+|Function |Argument |Type |Description\n+\n+|cml.properties |key for property |String |To lookup a property using the\n+xref:ROOT:properties-component.adoc[Properties] component (property placeholders).\n+\n+|cml.header |the header name |String |Will return the message header.\n+\n+|cml.exchangeProperty |key for property |String |Will return the exchange property.\n+|===\n+\n+Here's an example showing some of these functions in use:\n+\n+[source,java]\n+------------------------------------------------------------------------------------------------\n+from(\"direct:in\")\n+    .setBody(datasonnet(\"cml.properties('foo')\", String.class))\n+    .to(\"mock:camel\");\n+------------------------------------------------------------------------------------------------\n+\n+And the Spring DSL:\n+\n+[source,xml]\n+-----------------------------------------------------------------------------\n+<route>\n+    <from uri=\"direct:in\"/>\n+    <setBody>\n+        <datasonnet resultTypeName=\"java.lang.String\">cml.properties('foo')</datasonnet>\n+    </setBody>\n+    <to uri=\"mock:camel\"/>\n+</route>\n+-----------------------------------------------------------------------------\n+\n+== Loading script from external resource\n+\n+You can externalize the script and have Camel load it from a resource\n+such as `\"classpath:\"`, `\"file:\"`, or `\"http:\"`. +\n+This is done using the following syntax: `\"resource:scheme:location\"`,\n+eg to refer to a file on the classpath you can do:\n+\n+[source,java]\n+-------------------------------------------------------------------\n+.setHeader(\"myHeader\").datasonnet(\"resource:classpath:mydatasonnet.ds\")\n+-------------------------------------------------------------------\n+\n+== Dependencies\n+\n+To use scripting languages in your camel routes you need to add a\n+dependency on *camel-datasonnet*.\n+\n+If you use Maven you could just add the following to your `pom.xml`,\n+substituting the version number for the latest and greatest release (see\n+the download page for the latest versions).\n+", "originalCommit": "1497845418aabedb89081403140d4f08fefb32cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE2OTY0OA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r528169648", "bodyText": "I would like to see this moved to the Language class, and do this in its doInit method.", "author": "davsclaus", "createdAt": "2020-11-21T08:47:31Z", "path": "components/camel-datasonnet/src/main/java/org/apache/camel/language/datasonnet/DatasonnetExpression.java", "diffHunk": "@@ -0,0 +1,255 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.language.datasonnet;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.FileVisitResult;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.SimpleFileVisitor;\n+import java.nio.file.attribute.BasicFileAttributes;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+import com.datasonnet.Mapper;\n+import com.datasonnet.MapperBuilder;\n+import com.datasonnet.document.DefaultDocument;\n+import com.datasonnet.document.Document;\n+import com.datasonnet.document.MediaType;\n+import com.datasonnet.document.MediaTypes;\n+import io.github.classgraph.ClassGraph;\n+import io.github.classgraph.ScanResult;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Expression;\n+import org.apache.camel.RuntimeExpressionException;\n+import org.apache.camel.spi.ExpressionResultTypeAware;\n+import org.apache.camel.support.ExchangeHelper;\n+import org.apache.camel.support.ExpressionAdapter;\n+import org.apache.camel.support.MessageHelper;\n+import org.apache.commons.io.IOUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class DatasonnetExpression extends ExpressionAdapter implements ExpressionResultTypeAware {\n+    private static final Logger LOGGER = LoggerFactory.getLogger(DatasonnetExpression.class);\n+    private static final Map<String, String> CLASSPATH_IMPORTS = new HashMap<>();\n+\n+    static {\n+        LOGGER.debug(\"One time classpath search...\");", "originalCommit": "1497845418aabedb89081403140d4f08fefb32cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU3NzQyNQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r530577425", "bodyText": "moved :)", "author": "jam01", "createdAt": "2020-11-25T18:41:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE2OTY0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE2OTk2OQ==", "url": "https://github.com/apache/camel/pull/4561#discussion_r528169969", "bodyText": "Port this to plain Java code so everyone can maintain it", "author": "davsclaus", "createdAt": "2020-11-21T08:51:15Z", "path": "components/camel-datasonnet/src/main/scala/org/apache/camel/language/datasonnet/CML.scala", "diffHunk": "@@ -0,0 +1,74 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.language.datasonnet\n+\n+import com.datasonnet.document.{DefaultDocument, Document, MediaTypes}\n+import com.datasonnet.spi.{DataFormatService, Library, PluginException}\n+import org.apache.camel.Exchange\n+import sjsonnet.Std.builtin\n+import sjsonnet.{Materializer, Val}\n+\n+object CML extends Library {", "originalCommit": "1497845418aabedb89081403140d4f08fefb32cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE3MDAxNA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r528170014", "bodyText": "Fix this TODO", "author": "davsclaus", "createdAt": "2020-11-21T08:51:42Z", "path": "components/camel-datasonnet/src/test/java/org/apache/camel/language/datasonnet/CamelDatasonnetTest.java", "diffHunk": "@@ -0,0 +1,157 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.language.datasonnet;\n+\n+import java.io.InputStream;\n+import java.text.SimpleDateFormat;\n+import java.util.Arrays;\n+\n+import org.apache.camel.Exchange;\n+import org.apache.camel.component.mock.MockEndpoint;\n+import org.apache.camel.test.spring.junit5.CamelSpringTestSupport;\n+import org.apache.commons.io.IOUtils;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.Test;\n+import org.skyscreamer.jsonassert.JSONAssert;\n+import org.springframework.context.support.AbstractApplicationContext;\n+import org.springframework.context.support.ClassPathXmlApplicationContext;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+public class CamelDatasonnetTest extends CamelSpringTestSupport {\n+    private MockEndpoint mock;// = getMockEndpoint(\"mock:direct:end\");\n+\n+    @Override\n+    protected AbstractApplicationContext createApplicationContext() {\n+        return new ClassPathXmlApplicationContext(\"org/apache/camel/language.datasonnet/camel-context.xml\");\n+    }\n+\n+    @Test\n+    public void testTransform() throws Exception {\n+        runCamelTest(loadResourceAsString(\"simpleMapping_payload.json\"),\n+                loadResourceAsString(\"simpleMapping_result.json\"),\n+                \"direct:basicTransform\");\n+    }\n+\n+    @Test\n+    public void testTransformXML() throws Exception {\n+        runCamelTest(loadResourceAsString(\"payload.xml\"),\n+                loadResourceAsString(\"readXMLExtTest.json\"),\n+                \"direct:transformXML\");\n+    }\n+\n+    @Test\n+    public void testTransformCSV() throws Exception {\n+        runCamelTest(loadResourceAsString(\"payload.csv\"),\n+                \"{\\\"account\\\":\\\"123\\\"}\",\n+                \"direct:transformCSV\");\n+    }\n+\n+    @Test\n+    public void testDatasonnetScript() throws Exception {\n+        runCamelTest(loadResourceAsString(\"simpleMapping_payload.json\"),\n+                loadResourceAsString(\"simpleMapping_result.json\"),\n+                \"direct:datasonnetScript\");\n+    }\n+\n+    @Test\n+    public void testNamedImports() throws Exception {\n+        runCamelTest(\"{}\",\n+                loadResourceAsString(\"namedImports_result.json\"),\n+                \"direct:namedImports\");\n+    }\n+\n+    // TODO: 9/8/20 need to pass result type param to language", "originalCommit": "1497845418aabedb89081403140d4f08fefb32cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE3MDA0Nw==", "url": "https://github.com/apache/camel/pull/4561#discussion_r528170047", "bodyText": "Remove system out or do a LOG", "author": "davsclaus", "createdAt": "2020-11-21T08:51:58Z", "path": "components/camel-datasonnet/src/test/java/org/apache/camel/language/datasonnet/CamelDatasonnetTest.java", "diffHunk": "@@ -0,0 +1,157 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.language.datasonnet;\n+\n+import java.io.InputStream;\n+import java.text.SimpleDateFormat;\n+import java.util.Arrays;\n+\n+import org.apache.camel.Exchange;\n+import org.apache.camel.component.mock.MockEndpoint;\n+import org.apache.camel.test.spring.junit5.CamelSpringTestSupport;\n+import org.apache.commons.io.IOUtils;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.Test;\n+import org.skyscreamer.jsonassert.JSONAssert;\n+import org.springframework.context.support.AbstractApplicationContext;\n+import org.springframework.context.support.ClassPathXmlApplicationContext;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+public class CamelDatasonnetTest extends CamelSpringTestSupport {\n+    private MockEndpoint mock;// = getMockEndpoint(\"mock:direct:end\");\n+\n+    @Override\n+    protected AbstractApplicationContext createApplicationContext() {\n+        return new ClassPathXmlApplicationContext(\"org/apache/camel/language.datasonnet/camel-context.xml\");\n+    }\n+\n+    @Test\n+    public void testTransform() throws Exception {\n+        runCamelTest(loadResourceAsString(\"simpleMapping_payload.json\"),\n+                loadResourceAsString(\"simpleMapping_result.json\"),\n+                \"direct:basicTransform\");\n+    }\n+\n+    @Test\n+    public void testTransformXML() throws Exception {\n+        runCamelTest(loadResourceAsString(\"payload.xml\"),\n+                loadResourceAsString(\"readXMLExtTest.json\"),\n+                \"direct:transformXML\");\n+    }\n+\n+    @Test\n+    public void testTransformCSV() throws Exception {\n+        runCamelTest(loadResourceAsString(\"payload.csv\"),\n+                \"{\\\"account\\\":\\\"123\\\"}\",\n+                \"direct:transformCSV\");\n+    }\n+\n+    @Test\n+    public void testDatasonnetScript() throws Exception {\n+        runCamelTest(loadResourceAsString(\"simpleMapping_payload.json\"),\n+                loadResourceAsString(\"simpleMapping_result.json\"),\n+                \"direct:datasonnetScript\");\n+    }\n+\n+    @Test\n+    public void testNamedImports() throws Exception {\n+        runCamelTest(\"{}\",\n+                loadResourceAsString(\"namedImports_result.json\"),\n+                \"direct:namedImports\");\n+    }\n+\n+    // TODO: 9/8/20 need to pass result type param to language\n+    @Disabled\n+    @Test\n+    public void testExpressionLanguage() throws Exception {\n+        runCamelTest(\"World\",\n+                \"{ \\\"test\\\":\\\"Hello, World\\\"}\",\n+                \"direct:expressionLanguage\");\n+    }\n+\n+    @Test\n+    public void testNullInput() throws Exception {\n+        runCamelTest(\"\",\n+                \"{ \\\"test\\\":\\\"Hello, World\\\"}\",\n+                \"direct:nullInput\");\n+        runCamelTest(null,\n+                \"{ \\\"test\\\":\\\"Hello, World\\\"}\",\n+                \"direct:nullInput\");\n+    }\n+\n+    @Test\n+    public void testReadJava() throws Exception {\n+        Gizmo theGizmo = new Gizmo();\n+        theGizmo.setName(\"gizmo\");\n+        theGizmo.setQuantity(123);\n+        theGizmo.setInStock(true);\n+        theGizmo.setColors(Arrays.asList(\"red\", \"white\", \"blue\"));\n+\n+        Manufacturer manufacturer = new Manufacturer();\n+        manufacturer.setManufacturerName(\"ACME Corp.\");\n+        manufacturer.setManufacturerCode(\"ACME123\");\n+        theGizmo.setManufacturer(manufacturer);\n+\n+        SimpleDateFormat df = new SimpleDateFormat(\"yyyy-MM-dd\");\n+        theGizmo.setDate(df.parse(\"2020-01-06\"));\n+\n+        runCamelTest(theGizmo,\n+                loadResourceAsString(\"javaTest.json\"),\n+                \"direct:readJava\");\n+    }\n+\n+    @Test\n+    public void testWriteJava() throws Exception {\n+        Gizmo theGizmo = new Gizmo();\n+        theGizmo.setName(\"gizmo\");\n+        theGizmo.setQuantity(123);\n+        theGizmo.setInStock(true);\n+        theGizmo.setColors(Arrays.asList(\"red\", \"white\", \"blue\"));\n+\n+        Manufacturer manufacturer = new Manufacturer();\n+        manufacturer.setManufacturerName(\"ACME Corp.\");\n+        manufacturer.setManufacturerCode(\"ACME123\");\n+        theGizmo.setManufacturer(manufacturer);\n+\n+        SimpleDateFormat df = new SimpleDateFormat(\"yyyy-MM-dd\");\n+        theGizmo.setDate(df.parse(\"2020-01-06\"));\n+\n+        String payload = loadResourceAsString(\"javaTest.json\");\n+\n+        template.sendBody(\"direct:writeJava\", payload);\n+        mock = getMockEndpoint(\"mock:direct:end\");\n+        Exchange exchange = mock.assertExchangeReceived(mock.getReceivedCounter() - 1);\n+        Object response = exchange.getIn().getBody();\n+\n+        assertEquals(theGizmo, response);\n+    }\n+\n+    private void runCamelTest(Object payload, String expectedJson, String uri) throws Exception {\n+        template.sendBody(uri, payload);\n+        mock = getMockEndpoint(\"mock:direct:end\");\n+        Exchange exchange = mock.assertExchangeReceived(mock.getReceivedCounter() - 1);\n+        String response = exchange.getIn().getBody().toString();\n+        System.out.println(\"RESPONSE IS \" + response);", "originalCommit": "1497845418aabedb89081403140d4f08fefb32cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3d0feb15a6ac52f5eae04d49850dc8bec0dfd4db", "url": "https://github.com/apache/camel/commit/3d0feb15a6ac52f5eae04d49850dc8bec0dfd4db", "message": "Removed System print line in test", "committedDate": "2020-11-25T17:20:55Z", "type": "commit"}, {"oid": "eddb4d3ac5d130314de0ce510e98db8a90df4d0b", "url": "https://github.com/apache/camel/commit/eddb4d3ac5d130314de0ce510e98db8a90df4d0b", "message": "Replaced Spring DSL with XML DSL", "committedDate": "2020-11-25T17:21:04Z", "type": "commit"}, {"oid": "40701a24e8e642b670a6c8193dffad0efe80788d", "url": "https://github.com/apache/camel/commit/40701a24e8e642b670a6c8193dffad0efe80788d", "message": "Removed ms3inc repository from camel-datasonnet pom", "committedDate": "2020-11-25T17:21:14Z", "type": "commit"}, {"oid": "1fa2576f6d573ff44735a290f389f45cdff89aa4", "url": "https://github.com/apache/camel/commit/1fa2576f6d573ff44735a290f389f45cdff89aa4", "message": "clarify use of cml.properties in docs", "committedDate": "2020-11-25T17:35:39Z", "type": "commit"}, {"oid": "9e47486dd680856ba4af59c0412e3a94d16d61c5", "url": "https://github.com/apache/camel/commit/9e47486dd680856ba4af59c0412e3a94d16d61c5", "message": "fixes issues with mapper version", "committedDate": "2020-11-25T18:19:31Z", "type": "commit"}, {"oid": "b997dc1c66ec074a0b4b58f36e97686e2f6819b0", "url": "https://github.com/apache/camel/commit/b997dc1c66ec074a0b4b58f36e97686e2f6819b0", "message": "remove maven compiler properties", "committedDate": "2020-11-25T18:22:14Z", "type": "commit"}, {"oid": "8ae50f51d6fc04a730898b892b7c927434104c79", "url": "https://github.com/apache/camel/commit/8ae50f51d6fc04a730898b892b7c927434104c79", "message": "fix language test", "committedDate": "2020-11-25T18:33:36Z", "type": "commit"}, {"oid": "bea79a6d14527eb0ac3ccd0e8465775334667249", "url": "https://github.com/apache/camel/commit/bea79a6d14527eb0ac3ccd0e8465775334667249", "message": "moves classpath scanning to language", "committedDate": "2020-11-25T18:40:42Z", "type": "commit"}, {"oid": "58ff22669d023fb8ea9cf2847401aaf60e2e9e23", "url": "https://github.com/apache/camel/commit/58ff22669d023fb8ea9cf2847401aaf60e2e9e23", "message": "converts CML.scala to java", "committedDate": "2020-12-02T22:31:03Z", "type": "commit"}, {"oid": "972f4d14ffb947987854ce0f00b4961084f62787", "url": "https://github.com/apache/camel/commit/972f4d14ffb947987854ce0f00b4961084f62787", "message": "reverts scala deps changes", "committedDate": "2020-12-02T22:48:03Z", "type": "commit"}, {"oid": "60814387fda6af057f677f6ee403914fe31fa129", "url": "https://github.com/apache/camel/commit/60814387fda6af057f677f6ee403914fe31fa129", "message": "Merge branch 'master' into datasonnet-3.7", "committedDate": "2020-12-02T22:55:26Z", "type": "commit"}, {"oid": "e60b159ffdaa6bc0269b045ac0763447ac109cc3", "url": "https://github.com/apache/camel/commit/e60b159ffdaa6bc0269b045ac0763447ac109cc3", "message": "address checkstyle errors", "committedDate": "2020-12-02T23:28:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTAxNzc3Ng==", "url": "https://github.com/apache/camel/pull/4561#discussion_r535017776", "bodyText": "I dont see any extra value of having its own Builder class, we do not really do this for other data formats - only xml and xpath have a special builder etc. Can this be removed", "author": "davsclaus", "createdAt": "2020-12-03T09:43:05Z", "path": "core/camel-core-model/src/main/java/org/apache/camel/builder/DatasonnetBuilder.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.builder;\n+\n+import org.apache.camel.Expression;\n+import org.apache.camel.model.language.DatasonnetExpression;\n+\n+public class DatasonnetBuilder extends ValueBuilder {", "originalCommit": "e60b159ffdaa6bc0269b045ac0763447ac109cc3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTMzMTQyMw==", "url": "https://github.com/apache/camel/pull/4561#discussion_r535331423", "bodyText": "I think we based this on one of those builders. The reason comes from bodyMediaType and outputMediaType being both individually optional, so we could have any of these:\n// here we don't use the body, and the default output is fine\n.transform(datasonnet(\"hello, world\", String.class))\n\n// here we need to be explicit about the input, maybe the content-type header does not apply, for example\n.transform(datasonnet(\"payload\", String.class).bodyMediaType(\"application/json\")) \n\n// here we want the component to look in other locations for the input (eg. content-type header)\n// but we need a different output than default\n.transform(datasonnet(\"payload\", String.class).outputMediaType(\"application/xml\")))\n\n// here both are needed\n.transform(datasonnet(\"some-expression\", String.class)\n    .outputMediaType(\"application/json\")\n    .bodyMediaType(\"application/xml\")))\n\nSo the value is being able to be selectively explicit with the input and output types. Otherwise we'd have to do\n// we could have a 'all defaults' type of constructor\n.transform(datasonnet(\"hello, world\", String.class))\n\n.transform(datasonnet(\"payload\", String.class, \"application/json\", null)) \n\n.transform(datasonnet(\"payload\", String.class, null, \"application/json\")) \n\n.transform(datasonnet(\"some-expression\", String.class, \"application/json\", \"application/xml\"))\n\nSo I guess ultimately it's about readability since both options are functionally the same. I think a predicate is one particular scenario that might be confusing\n// if we needed to be explicit on the body, do we leave the output as null so the default is used?\n// or do we make it Java as it should be, either way the component forces Java for predicates\n// but the extra null could be confusing to devs, or misleading if they wrote something other than null or Java\n.when(datasonnet(\"payload.predicate == 'yes'\", \"application/json\", null))\n   ...\n// the output type would be ignored\n.when(datasonnet(\"payload.predicate == 'yes'\", \"application/json\", \"application/json\"))\n\nI hope that expresses the value we see in the Builder.\nThis wasn't actually a widely discussed decision internally, I just saw those other Builders you mentioned and seemed like the right way to achieve what I described. So we're all ears :)\nIf there's a more \"camel way\" to achieve this we'd be happy to refactor. Or if the Builder class should be moved to the datasonnet component (I think the XML one is) in order to move maintenance there, we can do that. Or if ultimately this doesn't fit with the Builder's design we can remove it.", "author": "jam01", "createdAt": "2020-12-03T15:29:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTAxNzc3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ2Mjk5Mw==", "url": "https://github.com/apache/camel/pull/4561#discussion_r535462993", "bodyText": "Well I am afraid thats how the other data formats do it with optional parameters, is that they have a number of methods for different combinations, and that you would have to pass in null for some of them.\nThere is no room for having specialized builders at this moment. The architecture of dataformats and how its too tightly coupled into the model/core is something we want to address in future Camel - such as Camel 4 or sooner if we can make it possible in 3.x.", "author": "davsclaus", "createdAt": "2020-12-03T18:06:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTAxNzc3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUwMDQyOA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r535500428", "bodyText": "Ah! Copy that. Would it be OK if we alternatively move the extra methods to the camel-datasonnet DatasonnetExpression? I see XPath has support for building expressions from both camel-core-model BuilderSupport and also from camel-xpath's XPathBuilder. The camel-xpath one actually has optional parameter support, just as we were looking for, as showcased in this test. Here's an example of the camel-xpath one being used in a route instead of the RouteBuilder one.\nSo developers could use the BuilderSupport one if they just want default media types, or the camel-datasonnet one if they want to be explicit in either one or both. Additionally this would allow us to user DataSonnet's formal MediaType objects instead of their String representation. I used the String representation in the BuilderSupport as to not have core-model depend on the DataSonnet Mapper. This would translate into some performance gains as the String will not need to be parsed on each expression evaluation.", "author": "jam01", "createdAt": "2020-12-03T18:59:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTAxNzc3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUwMzUxOA==", "url": "https://github.com/apache/camel/pull/4561#discussion_r535503518", "bodyText": "Yes this is a good idea", "author": "davsclaus", "createdAt": "2020-12-03T19:04:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTAxNzc3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTAyMDIwNg==", "url": "https://github.com/apache/camel/pull/4561#discussion_r535020206", "bodyText": "remove the left over code in the comment", "author": "davsclaus", "createdAt": "2020-12-03T09:45:22Z", "path": "components/camel-datasonnet/src/test/java/org/apache/camel/language/datasonnet/CamelDatasonnetTest.java", "diffHunk": "@@ -0,0 +1,164 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.language.datasonnet;\n+\n+import java.io.InputStream;\n+import java.text.SimpleDateFormat;\n+import java.util.Arrays;\n+import java.util.TimeZone;\n+\n+import com.datasonnet.document.Document;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.component.mock.MockEndpoint;\n+import org.apache.camel.support.ExchangeHelper;\n+import org.apache.camel.test.spring.junit5.CamelSpringTestSupport;\n+import org.apache.commons.io.IOUtils;\n+import org.junit.jupiter.api.Test;\n+import org.skyscreamer.jsonassert.JSONAssert;\n+import org.springframework.context.support.AbstractApplicationContext;\n+import org.springframework.context.support.ClassPathXmlApplicationContext;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+public class CamelDatasonnetTest extends CamelSpringTestSupport {\n+    private MockEndpoint mock;// = getMockEndpoint(\"mock:direct:end\");", "originalCommit": "e60b159ffdaa6bc0269b045ac0763447ac109cc3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8e5f3bc54d9bee7f2624fe27542932a3f5c37eab", "url": "https://github.com/apache/camel/commit/8e5f3bc54d9bee7f2624fe27542932a3f5c37eab", "message": "fixed scala dep issue", "committedDate": "2020-12-04T05:09:25Z", "type": "commit"}, {"oid": "cc505df8100530ff5c90a70bfe261fab606595ea", "url": "https://github.com/apache/camel/commit/cc505df8100530ff5c90a70bfe261fab606595ea", "message": "move datasonnet expression builder", "committedDate": "2020-12-04T05:29:06Z", "type": "commit"}, {"oid": "860f98aae60dd03d0aeccb0ed9dddb1a08bc2543", "url": "https://github.com/apache/camel/commit/860f98aae60dd03d0aeccb0ed9dddb1a08bc2543", "message": "remove comment", "committedDate": "2020-12-04T05:29:06Z", "type": "commit"}, {"oid": "02a6a8508319c3c9438a5ea94c5291ea16013401", "url": "https://github.com/apache/camel/commit/02a6a8508319c3c9438a5ea94c5291ea16013401", "message": "bump ds mapper version", "committedDate": "2020-12-04T17:08:14Z", "type": "commit"}]}