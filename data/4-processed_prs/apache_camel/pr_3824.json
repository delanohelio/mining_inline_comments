{"pr_number": 3824, "pr_title": "CAMEL-15057: camel-webhook should start/stop delegate endpoint before\u2026", "pr_createdAt": "2020-05-14T06:03:21Z", "pr_url": "https://github.com/apache/camel/pull/3824", "timeline": [{"oid": "bf322124b2a0001625adb65b69facdfd074d3d9c", "url": "https://github.com/apache/camel/commit/bf322124b2a0001625adb65b69facdfd074d3d9c", "message": "CAMEL-15057: camel-webhook should start/stop delegate endpoint before register webhook.", "committedDate": "2020-05-14T06:02:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkyNTYwMA==", "url": "https://github.com/apache/camel/pull/3824#discussion_r424925600", "bodyText": "This might be not necessary here. And it should be in https://github.com/apache/camel/blob/master/core/camel-base/src/main/java/org/apache/camel/impl/engine/AbstractCamelContext.java#L1457", "author": "zhfeng", "createdAt": "2020-05-14T07:28:52Z", "path": "components/camel-webhook/src/main/java/org/apache/camel/component/webhook/WebhookEndpoint.java", "diffHunk": "@@ -78,10 +79,16 @@ public void afterPropertiesConfigured(CamelContext camelContext) {\n         delegateEndpoint.setWebhookConfiguration(configuration);\n     }\n \n+    @Override\n+    protected void doInit() throws Exception {\n+        super.doInit();\n+        ServiceHelper.initService(delegateEndpoint);", "originalCommit": "bf322124b2a0001625adb65b69facdfd074d3d9c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkyNjM1OA==", "url": "https://github.com/apache/camel/pull/3824#discussion_r424926358", "bodyText": "if the delegateEndpoint has been stared as this router is added after the camel context started, what would happen ? The endpoint can be started twice ?", "author": "zhfeng", "createdAt": "2020-05-14T07:30:22Z", "path": "components/camel-webhook/src/main/java/org/apache/camel/component/webhook/WebhookEndpoint.java", "diffHunk": "@@ -78,10 +79,16 @@ public void afterPropertiesConfigured(CamelContext camelContext) {\n         delegateEndpoint.setWebhookConfiguration(configuration);\n     }\n \n+    @Override\n+    protected void doInit() throws Exception {\n+        super.doInit();\n+        ServiceHelper.initService(delegateEndpoint);\n+    }\n+\n     @Override\n     protected void doStart() throws Exception {\n         super.doStart();\n-\n+        ServiceHelper.startService(delegateEndpoint);", "originalCommit": "bf322124b2a0001625adb65b69facdfd074d3d9c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkzMDcxOA==", "url": "https://github.com/apache/camel/pull/3824#discussion_r424930718", "bodyText": "Thats taken care of internally by Camel to check its state and only start if not already started etc.", "author": "davsclaus", "createdAt": "2020-05-14T07:39:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkyNjM1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkyNjg1NQ==", "url": "https://github.com/apache/camel/pull/3824#discussion_r424926855", "bodyText": "Not sure it is safe to stop the endpoint here.", "author": "zhfeng", "createdAt": "2020-05-14T07:31:18Z", "path": "components/camel-webhook/src/main/java/org/apache/camel/component/webhook/WebhookEndpoint.java", "diffHunk": "@@ -91,11 +98,17 @@ protected void doStart() throws Exception {\n     @Override\n     protected void doStop() throws Exception {\n         super.doStop();\n-\n         if (configuration.isWebhookAutoRegister() && delegateEndpoint != null) {\n             LOG.info(\"Unregistering webhook for endpoint: {}\", delegateEndpoint);\n             delegateEndpoint.unregisterWebhook();\n         }\n+        ServiceHelper.stopService(delegateEndpoint);", "originalCommit": "bf322124b2a0001625adb65b69facdfd074d3d9c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkzMTA5Mg==", "url": "https://github.com/apache/camel/pull/3824#discussion_r424931092", "bodyText": "The webhook is creating the delegate endpoint and should handle its lifecycle. That is how its done in other componens that does something like this", "author": "davsclaus", "createdAt": "2020-05-14T07:39:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkyNjg1NQ=="}], "type": "inlineReview"}]}