{"pr_number": 3737, "pr_title": "CAMEL-14892 Camel-influxdb uses deprecated methods in doInsert action", "pr_createdAt": "2020-04-14T14:03:26Z", "pr_url": "https://github.com/apache/camel/pull/3737", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE3NDQxNw==", "url": "https://github.com/apache/camel/pull/3737#discussion_r408174417", "bodyText": "Typos", "author": "davsclaus", "createdAt": "2020-04-14T14:20:16Z", "path": "components/camel-influxdb/src/main/java/org/apache/camel/component/influxdb/InfluxDbProducer.java", "diffHunk": "@@ -138,4 +137,22 @@ private String calculateQuery(Exchange exchange) {\n         return query;\n     }\n \n+    private void ensureDatabaseExists(String dataBaseName) {\n+        QueryResult result = connection.query(new Query(SHOW_DATABASES));\n+\n+        //databases are in the first Serie called 'databases' and values are te fist value called 'name',", "originalCommit": "5adc8a497c4261897cf376311e19301499a8181b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE3NDY4NA==", "url": "https://github.com/apache/camel/pull/3737#discussion_r408174684", "bodyText": "Isn't there a nicer way than to catch a NPE", "author": "davsclaus", "createdAt": "2020-04-14T14:20:36Z", "path": "components/camel-influxdb/src/main/java/org/apache/camel/component/influxdb/InfluxDbProducer.java", "diffHunk": "@@ -138,4 +137,22 @@ private String calculateQuery(Exchange exchange) {\n         return query;\n     }\n \n+    private void ensureDatabaseExists(String dataBaseName) {\n+        QueryResult result = connection.query(new Query(SHOW_DATABASES));\n+\n+        //databases are in the first Serie called 'databases' and values are te fist value called 'name',\n+        //if any object on the 'path' is null, database does not exist\n+        boolean exists;\n+        try {\n+            exists = result.getResults().get(0).getSeries().get(0).getValues().get(0).contains(dataBaseName);", "originalCommit": "5adc8a497c4261897cf376311e19301499a8181b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE3OTYzMw==", "url": "https://github.com/apache/camel/pull/3737#discussion_r408179633", "bodyText": "@davsclaus  I've tried different approaches. Problem is that it is object with object with list of object with list of object and NPE could happen almost everywhere.\nI'd prefer solution with streams. But it doesn't look much 'selfexplanatory'. What do you think?\n\n\n    dataBaseName == null || result == null ? false : result.getResults().stream()\n                .flatMap(r -> r.getSeries().stream())\n                .flatMap(s -> s.getValues() == null ? null : s.getValues().get(0).stream())\n                .anyMatch(v -> dataBaseName.equals(v));", "author": "JiriOndrusek", "createdAt": "2020-04-14T14:27:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE3NDY4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE4NjYwOQ==", "url": "https://github.com/apache/camel/pull/3737#discussion_r408186609", "bodyText": "this could be better:\n\n    boolean exists = result == null ? false :\n\n\n                        result.getResults() == null ? false :\n                            result.getResults().get(0).getSeries() == null ? false :\n                                result.getResults().get(0).getSeries().get(0).getValues() == null ? false :\n                                    result.getResults().get(0).getSeries().get(0).getValues().get(0).contains(dataBaseName);", "author": "JiriOndrusek", "createdAt": "2020-04-14T14:35:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE3NDY4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE5OTk4MQ==", "url": "https://github.com/apache/camel/pull/3737#discussion_r408199981", "bodyText": "I've used try { } catch approach because it shows on the first glance what is happening. Both suggested approaches are better from my POV. But also it will take more time to understand it and it could contain some issues (like missing NPE).\nBut I don't have a problem using them at all. (or different one)", "author": "JiriOndrusek", "createdAt": "2020-04-14T14:52:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE3NDY4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI3MDgwMQ==", "url": "https://github.com/apache/camel/pull/3737#discussion_r408270801", "bodyText": "@JiriOndrusek I'm not sure, but can we use this approach influxdata/influxdb-java#173", "author": "dmvolod", "createdAt": "2020-04-14T16:26:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE3NDY4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYwNjIxNw==", "url": "https://github.com/apache/camel/pull/3737#discussion_r408606217", "bodyText": "@dmvolod If you are mentioning approach influxDB.describeDatabases().contains(dbName), than it is unfortunatelly also depricated: https://github.com/influxdata/influxdb-java/blob/master/src/main/java/org/influxdb/InfluxDB.java#L577", "author": "JiriOndrusek", "createdAt": "2020-04-15T06:22:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE3NDY4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzMDAzNA==", "url": "https://github.com/apache/camel/pull/3737#discussion_r408630034", "bodyText": "Oh, @JiriOndrusek , sure. In this case we can implement logic like origin. Thanks.", "author": "dmvolod", "createdAt": "2020-04-15T07:18:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE3NDY4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY3ODQ3OA==", "url": "https://github.com/apache/camel/pull/3737#discussion_r408678478", "bodyText": "yep lets do this", "author": "davsclaus", "createdAt": "2020-04-15T08:43:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE3NDY4NA=="}], "type": "inlineReview"}, {"oid": "2c5825a59d4884fcd7d764390adf7a703d58693f", "url": "https://github.com/apache/camel/commit/2c5825a59d4884fcd7d764390adf7a703d58693f", "message": "CAMEL-14892 Camel-influxdb uses deprecated methods in doInsert action", "committedDate": "2020-04-14T14:29:30Z", "type": "forcePushed"}, {"oid": "15663cc9ed7166729c2c62ff12f9fbd1f8ddb6a1", "url": "https://github.com/apache/camel/commit/15663cc9ed7166729c2c62ff12f9fbd1f8ddb6a1", "message": "CAMEL-14892 Camel-influxdb uses deprecated methods in doInsert action", "committedDate": "2020-04-14T15:10:23Z", "type": "commit"}, {"oid": "15663cc9ed7166729c2c62ff12f9fbd1f8ddb6a1", "url": "https://github.com/apache/camel/commit/15663cc9ed7166729c2c62ff12f9fbd1f8ddb6a1", "message": "CAMEL-14892 Camel-influxdb uses deprecated methods in doInsert action", "committedDate": "2020-04-14T15:10:23Z", "type": "forcePushed"}]}