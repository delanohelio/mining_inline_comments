{"pr_number": 3757, "pr_title": "CAMEL-14912: Allow custom service URIs to be used with Azure clients", "pr_createdAt": "2020-04-17T09:08:04Z", "pr_url": "https://github.com/apache/camel/pull/3757", "timeline": [{"oid": "d9393862092bbc944e606b9bdcbe906e3ccaf5f6", "url": "https://github.com/apache/camel/commit/d9393862092bbc944e606b9bdcbe906e3ccaf5f6", "message": "CAMEL-14912: Allow custom service URIs to be used with Azure clients", "committedDate": "2020-04-17T09:06:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDEwOTM2Nw==", "url": "https://github.com/apache/camel/pull/3757#discussion_r410109367", "bodyText": "A question, is the check of !client.getUri().equals(prepareStorageBlobUri(exchange, cfg) even needed? I mean if this is out, you don't need even to have extra configs to disable the URI validation. What others here think? Because the Azure URI segment could change in the future, we never know", "author": "omarsmak", "createdAt": "2020-04-17T09:36:46Z", "path": "components/camel-azure/src/main/java/org/apache/camel/component/azure/blob/BlobServiceUtil.java", "diffHunk": "@@ -178,7 +179,7 @@ public static CloudBlob getConfiguredClient(Exchange exchange, BlobServiceConfig\n             if (client.getClass() != expectedCls) {\n                 throw new IllegalArgumentException(\"Invalid Client Type\");\n             }\n-            if (!client.getUri().equals(prepareStorageBlobUri(exchange, cfg))) {\n+            if (validateURI && !client.getUri().equals(prepareStorageBlobUri(exchange, cfg))) {", "originalCommit": "d9393862092bbc944e606b9bdcbe906e3ccaf5f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDExMjc5Mg==", "url": "https://github.com/apache/camel/pull/3757#discussion_r410112792", "bodyText": "Yeah I did consider that. But, even if you're using a custom client, it may still be desirable to do some validation, hence I added a new URI param to control it.", "author": "jamesnetherton", "createdAt": "2020-04-17T09:43:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDEwOTM2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDExNTQxOA==", "url": "https://github.com/apache/camel/pull/3757#discussion_r410115418", "bodyText": "I see, but for the me the whole point of using a custom client (inherited from the main CloudBlob) clients to bypass these kind of validations, isn't?", "author": "omarsmak", "createdAt": "2020-04-17T09:48:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDEwOTM2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDEyMzk4OA==", "url": "https://github.com/apache/camel/pull/3757#discussion_r410123988", "bodyText": "I'm not the author of the component so I can't be sure what the original intent was.\nIn theory, there are some customizations that you can set on the client without changing the service URL (E.g blob snapshot ID) etc. So in that case the validation logic would still be valid.\nI'm not too bothered which solution we opt for. I don't think we do such validation in the new camel-azure-storage-blob component do we? So maybe it does make sense to remove it from camel-azure for consistency.", "author": "jamesnetherton", "createdAt": "2020-04-17T10:04:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDEwOTM2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDEzMTUxNQ==", "url": "https://github.com/apache/camel/pull/3757#discussion_r410131515", "bodyText": "Nope we don't, when we ported this component to the new v12 APIs, we omitted this part for now as we didn't see the the need to include such checks, IMHO a client if provided, should be agnostic as much as possible from such checks and allows some flexibility. IMHO I am in favour of removing it and simplify the configurations, what others think? e.g @oscerd ?", "author": "omarsmak", "createdAt": "2020-04-17T10:19:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDEwOTM2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIzNzI4NQ==", "url": "https://github.com/apache/camel/pull/3757#discussion_r410237285", "bodyText": "I think, until you don't modify the client, but just doing some validation it is ok. The problem is when you modify the state of the provided client eventually. So to me this is ok.", "author": "oscerd", "createdAt": "2020-04-17T13:52:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDEwOTM2Nw=="}], "type": "inlineReview"}]}