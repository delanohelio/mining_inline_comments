{"pr_number": 15390, "pr_title": "Add session property configuration manager for Presto-on-Spark", "pr_createdAt": "2020-11-03T16:58:31Z", "pr_url": "https://github.com/prestodb/presto/pull/15390", "timeline": [{"oid": "35e5b3371c32a3b0fcd1ed3c2c0a3f06a583d278", "url": "https://github.com/prestodb/presto/commit/35e5b3371c32a3b0fcd1ed3c2c0a3f06a583d278", "message": "Refactor SessionPropertyDefaults to load properties map", "committedDate": "2020-11-02T21:45:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg2MzY5NQ==", "url": "https://github.com/prestodb/presto/pull/15390#discussion_r516863695", "bodyText": "It looks like it should be something like\nif (resourceGroupRegex.isPresent() && (!context.getResourceGroupId().isPresent() || !resourceGroupRegex.get().matcher(context.getResourceGroupId().get().toString()).matches()))", "author": "arhimondr", "createdAt": "2020-11-03T18:12:03Z", "path": "presto-session-property-managers/src/main/java/com/facebook/presto/session/SessionMatchSpec.java", "diffHunk": "@@ -78,7 +78,9 @@ public SessionMatchSpec(\n             }\n         }\n \n-        if (resourceGroupRegex.isPresent() && !resourceGroupRegex.get().matcher(context.getResourceGroupId().toString()).matches()) {\n+        if (resourceGroupRegex.isPresent() &&\n+                context.getResourceGroupId().isPresent() &&", "originalCommit": "bb05e244a0c924e96c65d23c27617d1dc8bb263e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk2MzA4MQ==", "url": "https://github.com/prestodb/presto/pull/15390#discussion_r516963081", "bodyText": "Thank you for pointing out this. Other rules inside this function use empty string when it is an empty optional object. PR is updated with the same logics.", "author": "viczhang861", "createdAt": "2020-11-03T21:22:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg2MzY5NQ=="}], "type": "inlineReview"}, {"oid": "6a033c681260b9c762f6320565dcb17a477987a1", "url": "https://github.com/prestodb/presto/commit/6a033c681260b9c762f6320565dcb17a477987a1", "message": "Add session property configuraiton manager for Presto-on-Spark", "committedDate": "2020-11-03T20:50:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk2OTI3Nw==", "url": "https://github.com/prestodb/presto/pull/15390#discussion_r516969277", "bodyText": "nit: context.getResourceGroupId().orElse(\"\")", "author": "arhimondr", "createdAt": "2020-11-03T21:35:54Z", "path": "presto-session-property-managers/src/main/java/com/facebook/presto/session/SessionMatchSpec.java", "diffHunk": "@@ -78,8 +78,14 @@ public SessionMatchSpec(\n             }\n         }\n \n-        if (resourceGroupRegex.isPresent() && !resourceGroupRegex.get().matcher(context.getResourceGroupId().toString()).matches()) {\n-            return ImmutableMap.of();\n+        if (resourceGroupRegex.isPresent()) {\n+            String resourceGroupId = \"\";", "originalCommit": "6a033c681260b9c762f6320565dcb17a477987a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk3MzU3NA==", "url": "https://github.com/prestodb/presto/pull/15390#discussion_r516973574", "bodyText": "You meant context.getResourceGroupId().orElse(new ResourceGroupId(\"\")) ?  This will fail as we cannot use empty string to construct ResourceGroupId", "author": "viczhang861", "createdAt": "2020-11-03T21:45:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk2OTI3Nw=="}], "type": "inlineReview"}, {"oid": "9f5eaa66140b4a6783978563a0843aef10da3c86", "url": "https://github.com/prestodb/presto/commit/9f5eaa66140b4a6783978563a0843aef10da3c86", "message": "Make ResourceGroupId optional in SessionConfigurationContext\n\nFor Presto-on-Spark, it doesn't need ResourceGroupId.", "committedDate": "2020-11-04T01:41:29Z", "type": "commit"}, {"oid": "b94a92ba43ba73ebe465dac711399ad75c7e77e6", "url": "https://github.com/prestodb/presto/commit/b94a92ba43ba73ebe465dac711399ad75c7e77e6", "message": "Add session property configuraiton manager for Presto-on-Spark", "committedDate": "2020-11-04T01:41:34Z", "type": "commit"}, {"oid": "b94a92ba43ba73ebe465dac711399ad75c7e77e6", "url": "https://github.com/prestodb/presto/commit/b94a92ba43ba73ebe465dac711399ad75c7e77e6", "message": "Add session property configuraiton manager for Presto-on-Spark", "committedDate": "2020-11-04T01:41:34Z", "type": "forcePushed"}]}