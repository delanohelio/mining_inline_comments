{"pr_number": 14723, "pr_title": "Write support for DWRF encryption at rest", "pr_createdAt": "2020-06-25T19:00:55Z", "pr_url": "https://github.com/prestodb/presto/pull/14723", "timeline": [{"oid": "df5c4dfe9a1a1611d931ae1cf05905f7f7c37c8b", "url": "https://github.com/prestodb/presto/commit/df5c4dfe9a1a1611d931ae1cf05905f7f7c37c8b", "message": "Pass table encryption settings to `HiveWritableTableHandle`", "committedDate": "2020-06-29T14:53:42Z", "type": "forcePushed"}, {"oid": "8d818dd6be375c7d33c0c62048cd086dd6f7d082", "url": "https://github.com/prestodb/presto/commit/8d818dd6be375c7d33c0c62048cd086dd6f7d082", "message": "Pass table encryption settings to `HiveWritableTableHandle`", "committedDate": "2020-06-29T19:54:33Z", "type": "forcePushed"}, {"oid": "145806cf94928144a7cfccd4fc2aac7b4c7f0863", "url": "https://github.com/prestodb/presto/commit/145806cf94928144a7cfccd4fc2aac7b4c7f0863", "message": "Pass DwrfWriterEncryption into OrcWriter", "committedDate": "2020-06-29T22:05:36Z", "type": "forcePushed"}, {"oid": "55c0ab4161ab09cbe7f6825b9e339d54ecea3be3", "url": "https://github.com/prestodb/presto/commit/55c0ab4161ab09cbe7f6825b9e339d54ecea3be3", "message": "Pass DwrfWriterEncryption into OrcWriter", "committedDate": "2020-06-30T04:49:43Z", "type": "forcePushed"}, {"oid": "898ead6f50807fe0166b801202944acccdd028d8", "url": "https://github.com/prestodb/presto/commit/898ead6f50807fe0166b801202944acccdd028d8", "message": "Pass DwrfWriterEncryption into OrcWriter", "committedDate": "2020-06-30T22:55:14Z", "type": "forcePushed"}, {"oid": "0219acd4dadde5afd12fa5e6b4e9d44761710821", "url": "https://github.com/prestodb/presto/commit/0219acd4dadde5afd12fa5e6b4e9d44761710821", "message": "Pass table encryption settings to `HiveWritableTableHandle`", "committedDate": "2020-07-01T16:11:45Z", "type": "forcePushed"}, {"oid": "a2c91895b44309c43edcd43ca0bb2ce6b207eba3", "url": "https://github.com/prestodb/presto/commit/a2c91895b44309c43edcd43ca0bb2ce6b207eba3", "message": "Pass table encryption settings to `HiveWritableTableHandle`\n\nAdding support for file format encryption while writing data to Hive.\n\nUsing `HiveWritableTableHandle` as a way to transfer to the worker encryption information.\nThen as we are finishing on the final writes to the Hive metastore at that point, add\nsupport for writing metadata related to encryption to the table or partition parameters.\n\nRefactored table properties into `DwrfTableEncryptionProperties` to help keep the logic\nin a single place and make it easy to pass this information around.", "committedDate": "2020-07-01T16:23:25Z", "type": "forcePushed"}, {"oid": "486c80d28ff5f1c159ad78043a276163b11f5d55", "url": "https://github.com/prestodb/presto/commit/486c80d28ff5f1c159ad78043a276163b11f5d55", "message": "Pass DwrfWriterEncryption into OrcWriter", "committedDate": "2020-07-01T21:49:23Z", "type": "forcePushed"}, {"oid": "a85da0f010ba5146efc3e0a98a12a69d9f0c8fb7", "url": "https://github.com/prestodb/presto/commit/a85da0f010ba5146efc3e0a98a12a69d9f0c8fb7", "message": "Pass DwrfWriterEncryption into OrcWriter", "committedDate": "2020-07-02T17:06:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwMjAyNA==", "url": "https://github.com/prestodb/presto/pull/14723#discussion_r449202024", "bodyText": "Maybe I missed it, but I think none of these tests are using unpartitioned tables. Maybe add a test for that?", "author": "rschlussel", "createdAt": "2020-07-02T18:37:26Z", "path": "presto-hive/src/test/java/com/facebook/presto/hive/TestHiveMetadataFileFormatEncryptionSettings.java", "diffHunk": "@@ -125,13 +143,15 @@ public void tearDown()\n         }\n     }\n \n-    private static ConnectorTableMetadata getConnectorTableMetadata(String tableName, Map<String, Object> tableProperties)\n+    private static ConnectorTableMetadata getConnectorTableMetadata(String tableName, Map<String, Object> tableProperties, boolean isPartitioned)", "originalCommit": "cb1371bfeecfdb6efb993f3e255dd1c2b8041bf5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwNTM0OQ==", "url": "https://github.com/prestodb/presto/pull/14723#discussion_r449205349", "bodyText": "There were already CTAS tests to which I amended the write side of the tests. That said, you are correct that I need to add tests for CREATE and INSERT INTO - let me see if the code supports that or not :)", "author": "mayankgarg1990", "createdAt": "2020-07-02T18:44:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwMjAyNA=="}], "type": "inlineReview"}, {"oid": "434f71b1d43108b0be975bdf67446bee3c29e47a", "url": "https://github.com/prestodb/presto/commit/434f71b1d43108b0be975bdf67446bee3c29e47a", "message": "Pass DwrfWriterEncryption into OrcWriter", "committedDate": "2020-07-02T21:10:04Z", "type": "forcePushed"}, {"oid": "6a09c091c748b11807cefc13fb25559d5cf9bbea", "url": "https://github.com/prestodb/presto/commit/6a09c091c748b11807cefc13fb25559d5cf9bbea", "message": "Pass DwrfWriterEncryption into OrcWriter", "committedDate": "2020-07-03T21:52:41Z", "type": "forcePushed"}, {"oid": "243907860f99cc3e1230cbfe3fc982a0edb0f96c", "url": "https://github.com/prestodb/presto/commit/243907860f99cc3e1230cbfe3fc982a0edb0f96c", "message": "Rebecca's fix", "committedDate": "2020-07-06T16:47:09Z", "type": "forcePushed"}, {"oid": "67d45be8ee33d238a63e3a3b6dd7a0985741195c", "url": "https://github.com/prestodb/presto/commit/67d45be8ee33d238a63e3a3b6dd7a0985741195c", "message": "Pass DwrfWriterEncryption into OrcWriter", "committedDate": "2020-07-06T16:48:37Z", "type": "forcePushed"}, {"oid": "d8b499609889a2a0017207e8370a772fb4e10a57", "url": "https://github.com/prestodb/presto/commit/d8b499609889a2a0017207e8370a772fb4e10a57", "message": "Write support for DWRF encryption at rest\n\nAdding support for file format encryption while writing data to Hive.\n\nUsing `HiveWritableTableHandle` as a way to transfer to the worker encryption information.\nThen as we are finishing on the final writes to the Hive metastore at that point, add\nsupport for writing metadata related to encryption to the table or partition parameters.\n\nRefactored table properties into `DwrfTableEncryptionProperties` to help keep the logic\nin a single place and make it easy to pass this information around.", "committedDate": "2020-07-06T17:19:23Z", "type": "commit"}, {"oid": "8ea1eb0b588be345478e407a2fa54f686a7c6557", "url": "https://github.com/prestodb/presto/commit/8ea1eb0b588be345478e407a2fa54f686a7c6557", "message": "Pass DwrfWriterEncryption into OrcWriter", "committedDate": "2020-07-06T17:19:29Z", "type": "commit"}, {"oid": "8ea1eb0b588be345478e407a2fa54f686a7c6557", "url": "https://github.com/prestodb/presto/commit/8ea1eb0b588be345478e407a2fa54f686a7c6557", "message": "Pass DwrfWriterEncryption into OrcWriter", "committedDate": "2020-07-06T17:19:29Z", "type": "forcePushed"}]}