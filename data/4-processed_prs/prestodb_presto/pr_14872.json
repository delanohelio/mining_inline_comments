{"pr_number": 14872, "pr_title": "Allow export clientInfo, userAgent and spark queue in Presto-on-Spark", "pr_createdAt": "2020-07-22T05:27:11Z", "pr_url": "https://github.com/prestodb/presto/pull/14872", "timeline": [{"oid": "92b0b959a18a42c957a797582692be39936c8241", "url": "https://github.com/prestodb/presto/commit/92b0b959a18a42c957a797582692be39936c8241", "message": "Allow customizing clientInfo and userAgent in Presto-on-Spark\n\nuserAgent can be used to store Spark application id.", "committedDate": "2020-07-22T05:23:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODgzMjgyMw==", "url": "https://github.com/prestodb/presto/pull/14872#discussion_r458832823", "bodyText": "Let's pass it through the PrestoSparkSessionContext / PrestoSparkSession. The SessionContext interface has the\n    @Nullable\n    String getUserAgent();\n\ndeclared. We just need to implement it in the PrestoSparkSessionContext and in the PrestoSparkSession", "author": "arhimondr", "createdAt": "2020-07-22T14:25:33Z", "path": "presto-spark-base/src/main/java/com/facebook/presto/spark/PrestoSparkQueryExecutionFactory.java", "diffHunk": "@@ -215,7 +217,9 @@ public PrestoSparkQueryExecutionFactory(\n     public IPrestoSparkQueryExecution create(\n             SparkContext sparkContext,\n             PrestoSparkSession prestoSparkSession,\n+            Optional<String> userAgent,", "originalCommit": "e5763200b5928f2d30200b26080c790ebd255717", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk3MTk1Mw==", "url": "https://github.com/prestodb/presto/pull/14872#discussion_r458971953", "bodyText": "@arhimondr : it's the other way around, PrestoSparkSessionContext is created in PrestoSparkQueryExecutionFactory#create. Thus the user agent need to passed in here (so PrestoSparkSessionContext will have the user agent we want", "author": "wenleix", "createdAt": "2020-07-22T17:45:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODgzMjgyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODgzNDcxOA==", "url": "https://github.com/prestodb/presto/pull/14872#discussion_r458834718", "bodyText": "Do you think it is necessary to split it on \"\\\\.\"? Shouldn't we just store it as is in a single fragment?", "author": "arhimondr", "createdAt": "2020-07-22T14:28:06Z", "path": "presto-spark-base/src/main/java/com/facebook/presto/spark/PrestoSparkQueryExecutionFactory.java", "diffHunk": "@@ -426,6 +435,8 @@ private static QueryInfo createQueryInfo(\n                 succinctBytes(peakTaskUserMemoryInBytes),\n                 succinctBytes(peakTaskTotalMemoryInBytes));\n \n+        Optional<ResourceGroupId> resourceGroupId = sparkQueueName.map(name -> new ResourceGroupId(Arrays.asList(name.split(\"\\\\.\"))));", "originalCommit": "e5763200b5928f2d30200b26080c790ebd255717", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk4MDA3NA==", "url": "https://github.com/prestodb/presto/pull/14872#discussion_r458980074", "bodyText": "@arhimondr : Long long ago there is a discussion with @raghavsethi  and we agreed \".\" shouldn't be a valid character in resource group name :) ...\nanyhow, assume it doesn't cause trouble, I am happy to just store it in a single fragment.", "author": "wenleix", "createdAt": "2020-07-22T17:58:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODgzNDcxOA=="}], "type": "inlineReview"}, {"oid": "82257237e6bcf5b966ff24a1a49ab8849c2fb438", "url": "https://github.com/prestodb/presto/commit/82257237e6bcf5b966ff24a1a49ab8849c2fb438", "message": "Refactor userAgent handle in Presto-on-Spark\n\nInclude userAgent in PrestoSparkSession", "committedDate": "2020-07-22T18:00:32Z", "type": "forcePushed"}, {"oid": "d0a2f327ec794e73b5062a855e376097046f03ca", "url": "https://github.com/prestodb/presto/commit/d0a2f327ec794e73b5062a855e376097046f03ca", "message": "Allow export Spark queue in Presto-on-Spark query event", "committedDate": "2020-07-22T18:05:46Z", "type": "commit"}, {"oid": "91f319b81d744d9e71db0152be5bd4eb88d42c64", "url": "https://github.com/prestodb/presto/commit/91f319b81d744d9e71db0152be5bd4eb88d42c64", "message": "Refactor userAgent handle in Presto-on-Spark\n\nInclude userAgent in PrestoSparkSession", "committedDate": "2020-07-22T18:05:46Z", "type": "commit"}, {"oid": "91f319b81d744d9e71db0152be5bd4eb88d42c64", "url": "https://github.com/prestodb/presto/commit/91f319b81d744d9e71db0152be5bd4eb88d42c64", "message": "Refactor userAgent handle in Presto-on-Spark\n\nInclude userAgent in PrestoSparkSession", "committedDate": "2020-07-22T18:05:46Z", "type": "forcePushed"}]}