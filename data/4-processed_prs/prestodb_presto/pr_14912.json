{"pr_number": 14912, "pr_title": "Handle CAST in canonicalized LambdaDefinitionExpression", "pr_createdAt": "2020-07-28T20:10:48Z", "pr_url": "https://github.com/prestodb/presto/pull/14912", "timeline": [{"oid": "967d35d5c7ab9e3dca8b49dd08136362c7995dfc", "url": "https://github.com/prestodb/presto/commit/967d35d5c7ab9e3dca8b49dd08136362c7995dfc", "message": "Handle CAST in canonicalized LambdaDefinitionExpression\n\nInclude CallExpression return type in canonicalized LambdaDefinitionExpression\nso CAST with same input type would not be mistakenly canonicalized.", "committedDate": "2020-07-28T20:06:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg1ODMzOQ==", "url": "https://github.com/prestodb/presto/pull/14912#discussion_r461858339", "bodyText": "Probably better to do it only for CAST so we don't accidentally cause other issues?", "author": "kaikalur", "createdAt": "2020-07-28T20:28:17Z", "path": "presto-spi/src/main/java/com/facebook/presto/spi/relation/LambdaDefinitionExpression.java", "diffHunk": "@@ -133,7 +133,7 @@ public CanonicalizeExpression(List<String> arguments, List<Type> argumentTypes)\n         @Override\n         public String visitCall(CallExpression call, Void context)\n         {\n-            return format(\"%s.%s(%s)\", call.getFunctionHandle().getFunctionNamespace(), call.getDisplayName(), String.join(\", \", call.getArguments().stream().map(e -> e.accept(this, null)).collect(Collectors.toList())));\n+            return format(\"%s.%s(%s):%s\", call.getFunctionHandle().getFunctionNamespace(), call.getDisplayName(), String.join(\", \", call.getArguments().stream().map(e -> e.accept(this, null)).collect(Collectors.toList())), call.getType());", "originalCommit": "967d35d5c7ab9e3dca8b49dd08136362c7995dfc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg2MjkxOA==", "url": "https://github.com/prestodb/presto/pull/14912#discussion_r461862918", "bodyText": "For all other functions, return type should be the same if name and input type is the same. So this is just adding a little overhead. However, in any case that return type is different, it would be wrong to canonicalize them. So I think it's safe to keep it for all functions. Also not all cast functions are just called \"cast\". We don't really have an error prone way to identify all cast functions...", "author": "rongrong", "createdAt": "2020-07-28T20:37:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg1ODMzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk0NjYyMw==", "url": "https://github.com/prestodb/presto/pull/14912#discussion_r461946623", "bodyText": "LGTM", "author": "kaikalur", "createdAt": "2020-07-28T23:16:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg1ODMzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk3NTc3Mw==", "url": "https://github.com/prestodb/presto/pull/14912#discussion_r461975773", "bodyText": "probably good to have one parameter per line now? \ud83d\ude04", "author": "wenleix", "createdAt": "2020-07-29T00:54:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg1ODMzOQ=="}], "type": "inlineReview"}]}