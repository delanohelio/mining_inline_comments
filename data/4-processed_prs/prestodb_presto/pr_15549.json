{"pr_number": 15549, "pr_title": "Fix SliceDirectSelectiveStreamReader for dataLength is 0", "pr_createdAt": "2020-12-21T09:56:19Z", "pr_url": "https://github.com/prestodb/presto/pull/15549", "timeline": [{"oid": "df27d2a55ce9dd73344ad0ade9aa57ee7742de6b", "url": "https://github.com/prestodb/presto/commit/df27d2a55ce9dd73344ad0ade9aa57ee7742de6b", "message": "Limit batch read mode to certain conditions for SliceDirectSelectiveStreamReader\n\nuseBatchMode() in SliceDirectSelectiveStreamReader was mistakenly\ncommented out and was set to true all the time. This commit fixes this\nproblem.", "committedDate": "2020-12-21T10:53:36Z", "type": "forcePushed"}, {"oid": "17df06bbc8123c6959df88f6e616e3bad222412c", "url": "https://github.com/prestodb/presto/commit/17df06bbc8123c6959df88f6e616e3bad222412c", "message": "Limit batch read mode to certain conditions for SliceDirectSelectiveStreamReader\n\nuseBatchMode() in SliceDirectSelectiveStreamReader was mistakenly\ncommented out and was set to true all the time. This commit fixes this\nproblem.", "committedDate": "2020-12-22T04:14:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMyNjExMg==", "url": "https://github.com/prestodb/presto/pull/15549#discussion_r547326112", "bodyText": "I noticed that useBatchMode method has a lot of commented out code. Please, remove.", "author": "mbasmanova", "createdAt": "2020-12-22T15:01:23Z", "path": "presto-orc/src/main/java/com/facebook/presto/orc/reader/SliceDirectSelectiveStreamReader.java", "diffHunk": "@@ -688,13 +688,13 @@ else if (isNotNull) {\n             }\n             dataLength = totalLength;\n             data = ensureCapacity(data, totalLength);\n-            offsets = ensureCapacity(offsets, totalPositions + 1);\n+            offsets = ensureCapacity(offsets, totalPositions + 1, SMALL, INITIALIZE);", "originalCommit": "676c3a5891b5cd640b971e22bd70fcfa84ec5319", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzUzNDgwMA==", "url": "https://github.com/prestodb/presto/pull/15549#discussion_r547534800", "bodyText": "I noticed that useBatchMode method has a lot of commented out code. Please, remove.\n\nThis is fixed in the second commit \"Limit batch read mode to certain conditions for SliceDirectSelectiveStreamReader\"", "author": "yingsu00", "createdAt": "2020-12-22T22:20:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMyNjExMg=="}], "type": "inlineReview"}, {"oid": "825779e8f43249670e31ca892f530d7a0a2b090b", "url": "https://github.com/prestodb/presto/commit/825779e8f43249670e31ca892f530d7a0a2b090b", "message": "Limit batch read mode to certain conditions for SliceDirectSelectiveStreamReader\n\nuseBatchMode() in SliceDirectSelectiveStreamReader was mistakenly\ncommented out and was set to true all the time. This commit fixes this\nproblem.", "committedDate": "2020-12-23T06:17:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAxMDUwMA==", "url": "https://github.com/prestodb/presto/pull/15549#discussion_r548010500", "bodyText": "This variable seems unnecessary. Why not just combine the two loops?", "author": "mbasmanova", "createdAt": "2020-12-23T15:23:10Z", "path": "presto-orc/src/test/java/com/facebook/presto/orc/OrcTester.java", "diffHunk": "@@ -935,6 +928,19 @@ public static void assertFileContentsPresto(\n         assertEquals(rowsProcessed, expectedValues.get(0).size());\n     }\n \n+    static void assertBlockEquals(Type type, Block block, List<?> expectedValues, int offset)\n+    {\n+        int positionCount = block.getPositionCount();\n+        List<Object> data = new ArrayList<>(positionCount);", "originalCommit": "098de5bef96a82e26b22d014244982d988b7358e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAxMTM1Mg==", "url": "https://github.com/prestodb/presto/pull/15549#discussion_r548011352", "bodyText": "shouldn't resetDataStream be called on dictionaryReader as well? or on currentReader?", "author": "mbasmanova", "createdAt": "2020-12-23T15:24:53Z", "path": "presto-orc/src/main/java/com/facebook/presto/orc/reader/SliceSelectiveStreamReader.java", "diffHunk": "@@ -151,4 +152,10 @@ public static int computeTruncatedLength(Slice slice, int offset, int length, in\n         }\n         return length;\n     }\n+\n+    @VisibleForTesting\n+    public void resetDataStream()\n+    {\n+        ((SliceDirectSelectiveStreamReader) directReader).resetDataStream();", "originalCommit": "c74367d64d2f609defabe4205b29bfa8e30fa6b2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODMwOTI0Mw==", "url": "https://github.com/prestodb/presto/pull/15549#discussion_r548309243", "bodyText": "@mbasmanova currentReader is only set after the first startStripe() is called. I added dictionaryReader too.", "author": "yingsu00", "createdAt": "2020-12-23T23:00:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAxMTM1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODMxMzQwNA==", "url": "https://github.com/prestodb/presto/pull/15549#discussion_r548313404", "bodyText": "public class SliceSelectiveStreamReader\n        implements SelectiveStreamReader\n{\n   @VisibleForTesting\n    public void resetDataStream()\n    {\n        ((SliceDirectSelectiveStreamReader) directReader).resetDataStream();\n        ((SliceDictionarySelectiveReader) dictionaryReader).resetDataStream();\n    }\n}", "author": "yingsu00", "createdAt": "2020-12-23T23:07:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAxMTM1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAxMjYwNg==", "url": "https://github.com/prestodb/presto/pull/15549#discussion_r548012606", "bodyText": "Is this test specific to DWRF encoding? If not, perhaps, run it on all supported encodings.", "author": "mbasmanova", "createdAt": "2020-12-23T15:27:26Z", "path": "presto-orc/src/test/java/com/facebook/presto/orc/TestOrcSelectiveStreamReaders.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.facebook.presto.orc;\n+\n+import com.facebook.presto.common.block.Block;\n+import com.facebook.presto.common.type.Type;\n+import com.facebook.presto.orc.metadata.CompressionKind;\n+import com.facebook.presto.orc.reader.SelectiveStreamReader;\n+import com.facebook.presto.orc.reader.SliceSelectiveStreamReader;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+import org.testng.annotations.Test;\n+\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.function.Function;\n+import java.util.stream.IntStream;\n+\n+import static com.facebook.presto.common.type.VarcharType.VARCHAR;\n+import static com.facebook.presto.orc.OrcTester.Format.DWRF;\n+import static com.facebook.presto.orc.OrcTester.assertBlockEquals;\n+import static com.facebook.presto.orc.OrcTester.createCustomOrcSelectiveRecordReader;\n+import static com.facebook.presto.orc.OrcTester.writeOrcColumnsPresto;\n+import static com.facebook.presto.orc.TestingOrcPredicate.createOrcPredicate;\n+import static com.google.common.collect.ImmutableList.toImmutableList;\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+import static java.lang.Math.min;\n+import static org.testng.Assert.assertEquals;\n+\n+public class TestOrcSelectiveStreamReaders\n+{\n+    /**\n+     * This test tests SliceDirectSelectiveStreamReader for the case where all elements to read are empty strings. The output Block should be a valid VariableWidthBlock with an\n+     * empty Slice. It is to simulate a problem seen in production. The state of SliceDirectSelectiveStreamReader to reproduce the problem is:\n+     * - dataStream: null\n+     * - presentStream: null\n+     * - lengthStream: not null\n+     * - filter: null\n+     * - outputRequired: true\n+     * - offsets array: non zeros\n+     * The test issues two reads, the first one reads a non-empty string and populates non-zero offsets. The second one reads the empty string with the above conditions met.\n+     */\n+    @Test\n+    public void testEmptySlice()\n+            throws Exception\n+    {\n+        Type type = VARCHAR;\n+        List<Type> types = ImmutableList.of(type);\n+        List<List<?>> values = ImmutableList.of(ImmutableList.of(\"a\", \"\"));\n+\n+        TempFile tempFile = new TempFile();\n+        writeOrcColumnsPresto(tempFile.getFile(), DWRF, CompressionKind.NONE, Optional.empty(), types, values, new OrcWriterStats());", "originalCommit": "c74367d64d2f609defabe4205b29bfa8e30fa6b2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODMxMjUxMA==", "url": "https://github.com/prestodb/presto/pull/15549#discussion_r548312510", "bodyText": "Sure. I added the following settings\n    private Set<OrcTester.Format> formats = ImmutableSet.of(ORC_12, ORC_11, DWRF);\n    private Set<CompressionKind> compressions = ImmutableSet.of(NONE, SNAPPY, ZLIB, LZ4, ZSTD);", "author": "yingsu00", "createdAt": "2020-12-23T23:04:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAxMjYwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAxMjY5Nw==", "url": "https://github.com/prestodb/presto/pull/15549#discussion_r548012697", "bodyText": "nit: perhaps, testAllEmptyStrings", "author": "mbasmanova", "createdAt": "2020-12-23T15:27:40Z", "path": "presto-orc/src/test/java/com/facebook/presto/orc/TestOrcSelectiveStreamReaders.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.facebook.presto.orc;\n+\n+import com.facebook.presto.common.block.Block;\n+import com.facebook.presto.common.type.Type;\n+import com.facebook.presto.orc.metadata.CompressionKind;\n+import com.facebook.presto.orc.reader.SelectiveStreamReader;\n+import com.facebook.presto.orc.reader.SliceSelectiveStreamReader;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+import org.testng.annotations.Test;\n+\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.function.Function;\n+import java.util.stream.IntStream;\n+\n+import static com.facebook.presto.common.type.VarcharType.VARCHAR;\n+import static com.facebook.presto.orc.OrcTester.Format.DWRF;\n+import static com.facebook.presto.orc.OrcTester.assertBlockEquals;\n+import static com.facebook.presto.orc.OrcTester.createCustomOrcSelectiveRecordReader;\n+import static com.facebook.presto.orc.OrcTester.writeOrcColumnsPresto;\n+import static com.facebook.presto.orc.TestingOrcPredicate.createOrcPredicate;\n+import static com.google.common.collect.ImmutableList.toImmutableList;\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+import static java.lang.Math.min;\n+import static org.testng.Assert.assertEquals;\n+\n+public class TestOrcSelectiveStreamReaders\n+{\n+    /**\n+     * This test tests SliceDirectSelectiveStreamReader for the case where all elements to read are empty strings. The output Block should be a valid VariableWidthBlock with an\n+     * empty Slice. It is to simulate a problem seen in production. The state of SliceDirectSelectiveStreamReader to reproduce the problem is:\n+     * - dataStream: null\n+     * - presentStream: null\n+     * - lengthStream: not null\n+     * - filter: null\n+     * - outputRequired: true\n+     * - offsets array: non zeros\n+     * The test issues two reads, the first one reads a non-empty string and populates non-zero offsets. The second one reads the empty string with the above conditions met.\n+     */\n+    @Test\n+    public void testEmptySlice()", "originalCommit": "c74367d64d2f609defabe4205b29bfa8e30fa6b2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAxMzAyMA==", "url": "https://github.com/prestodb/presto/pull/15549#discussion_r548013020", "bodyText": "This name is very generic, but the test itself applies only to SliceDirectSelectiveStreamReader. Perhaps, rename to TestSliceDirectSelectiveStreamReader.", "author": "mbasmanova", "createdAt": "2020-12-23T15:28:22Z", "path": "presto-orc/src/test/java/com/facebook/presto/orc/TestOrcSelectiveStreamReaders.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.facebook.presto.orc;\n+\n+import com.facebook.presto.common.block.Block;\n+import com.facebook.presto.common.type.Type;\n+import com.facebook.presto.orc.metadata.CompressionKind;\n+import com.facebook.presto.orc.reader.SelectiveStreamReader;\n+import com.facebook.presto.orc.reader.SliceSelectiveStreamReader;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+import org.testng.annotations.Test;\n+\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.function.Function;\n+import java.util.stream.IntStream;\n+\n+import static com.facebook.presto.common.type.VarcharType.VARCHAR;\n+import static com.facebook.presto.orc.OrcTester.Format.DWRF;\n+import static com.facebook.presto.orc.OrcTester.assertBlockEquals;\n+import static com.facebook.presto.orc.OrcTester.createCustomOrcSelectiveRecordReader;\n+import static com.facebook.presto.orc.OrcTester.writeOrcColumnsPresto;\n+import static com.facebook.presto.orc.TestingOrcPredicate.createOrcPredicate;\n+import static com.google.common.collect.ImmutableList.toImmutableList;\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+import static java.lang.Math.min;\n+import static org.testng.Assert.assertEquals;\n+\n+public class TestOrcSelectiveStreamReaders", "originalCommit": "c74367d64d2f609defabe4205b29bfa8e30fa6b2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIxMzE1NQ==", "url": "https://github.com/prestodb/presto/pull/15549#discussion_r548213155", "bodyText": "@mbasmanova I'm thinking to add more tests there, including more generic tests that cover all types, and also a test to resolve #15343 Do you think we can keep it as is for now?", "author": "yingsu00", "createdAt": "2020-12-23T20:33:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAxMzAyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIxNDk3NQ==", "url": "https://github.com/prestodb/presto/pull/15549#discussion_r548214975", "bodyText": "Sounds good.", "author": "mbasmanova", "createdAt": "2020-12-23T20:35:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAxMzAyMA=="}], "type": "inlineReview"}, {"oid": "f420e9cd85d8dbeb0147b1ecdfb3ea86b28619da", "url": "https://github.com/prestodb/presto/commit/f420e9cd85d8dbeb0147b1ecdfb3ea86b28619da", "message": "Limit batch read mode to certain conditions for SliceDirectSelectiveStreamReader\n\nuseBatchMode() in SliceDirectSelectiveStreamReader was mistakenly\ncommented out and was set to true all the time. This commit fixes this\nproblem.", "committedDate": "2020-12-23T23:03:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODMzMjczNw==", "url": "https://github.com/prestodb/presto/pull/15549#discussion_r548332737", "bodyText": "this variable is not used; remove", "author": "mbasmanova", "createdAt": "2020-12-24T00:40:48Z", "path": "presto-orc/src/test/java/com/facebook/presto/orc/OrcTester.java", "diffHunk": "@@ -935,6 +928,15 @@ public static void assertFileContentsPresto(\n         assertEquals(rowsProcessed, expectedValues.get(0).size());\n     }\n \n+    static void assertBlockEquals(Type type, Block block, List<?> expectedValues, int offset)\n+    {\n+        int positionCount = block.getPositionCount();\n+        List<Object> data = new ArrayList<>(positionCount);", "originalCommit": "f420e9cd85d8dbeb0147b1ecdfb3ea86b28619da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODM4MTIxOQ==", "url": "https://github.com/prestodb/presto/pull/15549#discussion_r548381219", "bodyText": "@mbasmanova Variable removed and tests passed. Thank you! Merry Christmas!", "author": "yingsu00", "createdAt": "2020-12-24T04:52:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODMzMjczNw=="}], "type": "inlineReview"}, {"oid": "1ef409330cf7001370ac43719c0197b9c9db6798", "url": "https://github.com/prestodb/presto/commit/1ef409330cf7001370ac43719c0197b9c9db6798", "message": "Limit batch read mode to certain conditions for SliceDirectSelectiveStreamReader\n\nuseBatchMode() in SliceDirectSelectiveStreamReader was mistakenly\ncommented out and was set to true all the time. This commit fixes this\nproblem.", "committedDate": "2020-12-24T02:55:35Z", "type": "forcePushed"}, {"oid": "b1acf46992fb7e785d1cd58cd5766a4342096423", "url": "https://github.com/prestodb/presto/commit/b1acf46992fb7e785d1cd58cd5766a4342096423", "message": "Extract assertBlockEquals() in OrcTester", "committedDate": "2021-01-02T05:14:37Z", "type": "commit"}, {"oid": "85b5e316cd3d94b993dad0d3cd4f2322c6a479dc", "url": "https://github.com/prestodb/presto/commit/85b5e316cd3d94b993dad0d3cd4f2322c6a479dc", "message": "Fix SliceDirectSelectiveStreamReader for dataLength is 0\n\nFor batch read mode, when dataLength is 0 and offsets array was not\nreset, the offsets array for previous batch would be used to create\nthe output Block. This causes IndexOutOfBoundsException for downstream\noperators. This fix initializes the offsets array to 0 for the batch\nread mode.", "committedDate": "2021-01-02T05:14:37Z", "type": "commit"}, {"oid": "1e6995a4f9eb6724409a5432ef8cec70512e14ad", "url": "https://github.com/prestodb/presto/commit/1e6995a4f9eb6724409a5432ef8cec70512e14ad", "message": "Limit batch read mode to certain conditions for SliceDirectSelectiveStreamReader\n\nuseBatchMode() in SliceDirectSelectiveStreamReader was mistakenly\ncommented out and was set to true all the time. This commit fixes this\nproblem.", "committedDate": "2021-01-02T05:14:37Z", "type": "commit"}, {"oid": "1e6995a4f9eb6724409a5432ef8cec70512e14ad", "url": "https://github.com/prestodb/presto/commit/1e6995a4f9eb6724409a5432ef8cec70512e14ad", "message": "Limit batch read mode to certain conditions for SliceDirectSelectiveStreamReader\n\nuseBatchMode() in SliceDirectSelectiveStreamReader was mistakenly\ncommented out and was set to true all the time. This commit fixes this\nproblem.", "committedDate": "2021-01-02T05:14:37Z", "type": "forcePushed"}, {"oid": "2f76b7c8a2054d4e1a5e982bfe90450a403038cd", "url": "https://github.com/prestodb/presto/commit/2f76b7c8a2054d4e1a5e982bfe90450a403038cd", "message": "Fix testSubfieldValue in OrcTester\n\nWhen filtering the expected rows for ARRAY type, null rows would be\nmistakenly filtered out when the filter is not null but nullAllowed\nis true. This commit fixes this problem by calling filter.testNull().", "committedDate": "2021-01-03T06:12:11Z", "type": "commit"}, {"oid": "d0a12f734914d7201f2df0ba48bd8daa00d2d279", "url": "https://github.com/prestodb/presto/commit/d0a12f734914d7201f2df0ba48bd8daa00d2d279", "message": "Fix SliceDirectSelectiveStreamReader for ARRAY of VARCHAR\n\nFor the batch read mode, the testNull should be called on all qulifying\nrows instead of just being called once because the filter is\nPositionalFilter and the filter's internal state needs to be updated.\nThis commit fixes this problem.", "committedDate": "2021-01-03T06:12:18Z", "type": "forcePushed"}, {"oid": "c373115eed737e0f7a7a6bc8139600124c7c094c", "url": "https://github.com/prestodb/presto/commit/c373115eed737e0f7a7a6bc8139600124c7c094c", "message": "Fix SliceDirectSelectiveStreamReader for ARRAY of VARCHAR\n\nFor the batch read mode, the testNull should be called on all qulifying\nrows instead of just being called once because the filter is\nPositionalFilter and the filter's internal state needs to be updated.\nThis commit fixes this problem.", "committedDate": "2021-01-04T01:21:24Z", "type": "commit"}, {"oid": "c373115eed737e0f7a7a6bc8139600124c7c094c", "url": "https://github.com/prestodb/presto/commit/c373115eed737e0f7a7a6bc8139600124c7c094c", "message": "Fix SliceDirectSelectiveStreamReader for ARRAY of VARCHAR\n\nFor the batch read mode, the testNull should be called on all qulifying\nrows instead of just being called once because the filter is\nPositionalFilter and the filter's internal state needs to be updated.\nThis commit fixes this problem.", "committedDate": "2021-01-04T01:21:24Z", "type": "forcePushed"}]}