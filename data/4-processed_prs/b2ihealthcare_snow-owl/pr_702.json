{"pr_number": 702, "pr_title": "SO-4345: Map compare improvements", "pr_createdAt": "2020-10-28T13:22:08Z", "pr_url": "https://github.com/b2ihealthcare/snow-owl/pull/702", "timeline": [{"oid": "5205b2cb944b76aee80a297b301a1040e79e146f", "url": "https://github.com/b2ihealthcare/snow-owl/commit/5205b2cb944b76aee80a297b301a1040e79e146f", "message": "SO-4345: add enum for config props", "committedDate": "2020-10-26T10:51:21Z", "type": "commit"}, {"oid": "f8c528b9c050a31b6cc5d60f6a478fafaec63e9d", "url": "https://github.com/b2ihealthcare/snow-owl/commit/f8c528b9c050a31b6cc5d60f6a478fafaec63e9d", "message": "SO-4345: add ability to configure map compare props", "committedDate": "2020-10-26T10:51:44Z", "type": "commit"}, {"oid": "8173e65eef294ae1dd2590e73690659a93c152a0", "url": "https://github.com/b2ihealthcare/snow-owl/commit/8173e65eef294ae1dd2590e73690659a93c152a0", "message": "SO-4345: add map compare equivalence logic", "committedDate": "2020-10-26T16:05:08Z", "type": "commit"}, {"oid": "ebfac4f3a0458fdbb6879814c2c2deb0bbe31234", "url": "https://github.com/b2ihealthcare/snow-owl/commit/ebfac4f3a0458fdbb6879814c2c2deb0bbe31234", "message": "SO-4345: add ability to compare based on compare config", "committedDate": "2020-10-26T16:06:39Z", "type": "commit"}, {"oid": "80a5f542df5dbaf87bf09c0612562715a16c291d", "url": "https://github.com/b2ihealthcare/snow-owl/commit/80a5f542df5dbaf87bf09c0612562715a16c291d", "message": "SO-4345: create constants for easier usage", "committedDate": "2020-10-26T16:07:50Z", "type": "commit"}, {"oid": "b1d7e82db94d15203434acd56173ed094c62a7a4", "url": "https://github.com/b2ihealthcare/snow-owl/commit/b1d7e82db94d15203434acd56173ed094c62a7a4", "message": "Merge remote-tracking branch 'origin/7.x' into improvement/SO-4345-configure-map-compare-props", "committedDate": "2020-10-26T16:10:04Z", "type": "commit"}, {"oid": "19b0af039d09a8598553e6686ff321c7426a02db", "url": "https://github.com/b2ihealthcare/snow-owl/commit/19b0af039d09a8598553e6686ff321c7426a02db", "message": "SO-4345: fix compare logic", "committedDate": "2020-10-26T17:07:06Z", "type": "commit"}, {"oid": "94d4df797bf47f8e8400e26aaa9631a6ee95aeb6", "url": "https://github.com/b2ihealthcare/snow-owl/commit/94d4df797bf47f8e8400e26aaa9631a6ee95aeb6", "message": "SO-4345: remove equal mappings first and then search for changed ones", "committedDate": "2020-10-26T18:29:18Z", "type": "commit"}, {"oid": "e1f04800395a2eef98c2b33ebe7bae37cd5b8c60", "url": "https://github.com/b2ihealthcare/snow-owl/commit/e1f04800395a2eef98c2b33ebe7bae37cd5b8c60", "message": "SO-4345: fix compare logic", "committedDate": "2020-10-27T10:14:31Z", "type": "commit"}, {"oid": "79ae332d1eff26560ea9b0cfe898f6d3fcc1e6a3", "url": "https://github.com/b2ihealthcare/snow-owl/commit/79ae332d1eff26560ea9b0cfe898f6d3fcc1e6a3", "message": "Merge remote-tracking branch 'origin/7.x' into improvement/SO-4345-configure-map-compare-props", "committedDate": "2020-10-27T10:40:23Z", "type": "commit"}, {"oid": "c00f4998ed343d805fe40f7d559df44bedea223c", "url": "https://github.com/b2ihealthcare/snow-owl/commit/c00f4998ed343d805fe40f7d559df44bedea223c", "message": "SO-4345: use source and target for checking equivalence as well", "committedDate": "2020-10-27T11:02:59Z", "type": "commit"}, {"oid": "71ef0151494b5cc1d3bb86a39d2a6731ccaab3b1", "url": "https://github.com/b2ihealthcare/snow-owl/commit/71ef0151494b5cc1d3bb86a39d2a6731ccaab3b1", "message": "SO-4345: add equivalence class for source mapping equivalence", "committedDate": "2020-10-27T11:09:09Z", "type": "commit"}, {"oid": "2ddf800c79743c280e8bc3e1df1b5ebe3c5bf17a", "url": "https://github.com/b2ihealthcare/snow-owl/commit/2ddf800c79743c280e8bc3e1df1b5ebe3c5bf17a", "message": "SO-4345: change compare logic", "committedDate": "2020-10-27T13:27:06Z", "type": "commit"}, {"oid": "3707b08f083e26656a5021db218b6b530c41b71b", "url": "https://github.com/b2ihealthcare/snow-owl/commit/3707b08f083e26656a5021db218b6b530c41b71b", "message": "SO-4345: fix compare logic", "committedDate": "2020-10-27T17:14:37Z", "type": "commit"}, {"oid": "476128a81f84cf9ab9f070ce9802c49971df81ce", "url": "https://github.com/b2ihealthcare/snow-owl/commit/476128a81f84cf9ab9f070ce9802c49971df81ce", "message": "Merge remote-tracking branch 'origin/7.x' into improvement/SO-4345-configure-map-compare-props", "committedDate": "2020-10-27T17:17:30Z", "type": "commit"}, {"oid": "3feaf340a77d20eeb415ed87b740043c44c35c04", "url": "https://github.com/b2ihealthcare/snow-owl/commit/3feaf340a77d20eeb415ed87b740043c44c35c04", "message": "SO-4345: remove unnecessary code", "committedDate": "2020-10-27T17:27:34Z", "type": "commit"}, {"oid": "fc2eec96deaee2b6be95b41051a510a11913907c", "url": "https://github.com/b2ihealthcare/snow-owl/commit/fc2eec96deaee2b6be95b41051a510a11913907c", "message": "SO-4345 Comments added.", "committedDate": "2020-10-27T18:21:22Z", "type": "commit"}, {"oid": "6cd2bb79343b8a4d940c1e0c7935b45e7f977711", "url": "https://github.com/b2ihealthcare/snow-owl/commit/6cd2bb79343b8a4d940c1e0c7935b45e7f977711", "message": "SO-4345 Added alternative solution.", "committedDate": "2020-10-27T21:37:19Z", "type": "commit"}, {"oid": "f0877c751d9eb7ab887e108d5a8410340c3c4bab", "url": "https://github.com/b2ihealthcare/snow-owl/commit/f0877c751d9eb7ab887e108d5a8410340c3c4bab", "message": "SO-4345: change the unchanged label to Same", "committedDate": "2020-10-28T08:34:28Z", "type": "commit"}, {"oid": "1e9eb282776575ef8f1869a8a84174c3a2f2fa4f", "url": "https://github.com/b2ihealthcare/snow-owl/commit/1e9eb282776575ef8f1869a8a84174c3a2f2fa4f", "message": "SO-4345: remove alternative logic and extract common method", "committedDate": "2020-10-28T09:39:43Z", "type": "commit"}, {"oid": "a0a7b26d04930c9b18d36f913a9f5fb9b4ffe912", "url": "https://github.com/b2ihealthcare/snow-owl/commit/a0a7b26d04930c9b18d36f913a9f5fb9b4ffe912", "message": "SO-4345: add priority for changekind", "committedDate": "2020-10-28T12:08:10Z", "type": "commit"}, {"oid": "d6ef4ed94bec0755e66d91594112308e2b03d397", "url": "https://github.com/b2ihealthcare/snow-owl/commit/d6ef4ed94bec0755e66d91594112308e2b03d397", "message": "SO-4345: extract common method", "committedDate": "2020-10-28T12:08:29Z", "type": "commit"}, {"oid": "54ab82037b70c5bcb9460421a993d8cf2f9c5648", "url": "https://github.com/b2ihealthcare/snow-owl/commit/54ab82037b70c5bcb9460421a993d8cf2f9c5648", "message": "SO-4345: count number of total unchanged as well, limit later", "committedDate": "2020-10-28T12:09:33Z", "type": "commit"}, {"oid": "f789fd8b8b9a3d2a5ae3a3ad220c3b754261be56", "url": "https://github.com/b2ihealthcare/snow-owl/commit/f789fd8b8b9a3d2a5ae3a3ad220c3b754261be56", "message": "Merge remote-tracking branch 'origin/7.x' into improvement/SO-4345-configure-map-compare-props", "committedDate": "2020-10-28T12:15:07Z", "type": "commit"}, {"oid": "e812ebec21fe2c985bf8186f7fcdde407897e083", "url": "https://github.com/b2ihealthcare/snow-owl/commit/e812ebec21fe2c985bf8186f7fcdde407897e083", "message": "SO-4345: use sets.difference() to get unique mappings", "committedDate": "2020-10-28T12:36:21Z", "type": "commit"}, {"oid": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00", "url": "https://github.com/b2ihealthcare/snow-owl/commit/2c184d5ce1264ef16ed2168d2feb7348eb45ae00", "message": "SO-4345: set default limit to the size of sets to compare", "committedDate": "2020-10-28T13:11:16Z", "type": "commit"}, {"oid": "92b432465110940cca0177f2fafe14eb71e3e561", "url": "https://github.com/b2ihealthcare/snow-owl/commit/92b432465110940cca0177f2fafe14eb71e3e561", "message": "SO-4345: make class final", "committedDate": "2020-10-28T14:06:29Z", "type": "commit"}, {"oid": "0b400bb87af81e37d8204610c8c2dd17be5d5b4b", "url": "https://github.com/b2ihealthcare/snow-owl/commit/0b400bb87af81e37d8204610c8c2dd17be5d5b4b", "message": "SO-4345: make field private", "committedDate": "2020-10-28T14:06:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ1OTk5NQ==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513459995", "bodyText": "This parameter should be an option, not a mandatory parameter. By default compare by ComponentURI (CodeSystem + Code).", "author": "cmark", "createdAt": "2020-10-28T13:52:27Z", "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/codesystem/CodeSystemRequests.java", "diffHunk": "@@ -105,8 +107,8 @@ public static AllCodeSystemSearchRequestBuilder prepareSearchAllCodeSystems(){\n \t\treturn new AllCodeSystemSearchRequestBuilder();\n \t}\n \t\n-\tpublic static ConceptMapCompareRequestBuilder prepareConceptMapCompare(ComponentURI baseConceptMapURI, ComponentURI compareConceptMapURI){\n-\t\treturn new ConceptMapCompareRequestBuilder(baseConceptMapURI, compareConceptMapURI);\n+\tpublic static ConceptMapCompareRequestBuilder prepareConceptMapCompare(ComponentURI baseConceptMapURI, ComponentURI compareConceptMapURI, Set<ConceptMapCompareConfigurationProperties> selectedConfig){", "originalCommit": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2MDg2NQ==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513460865", "bodyText": "How about using the enum ordinal as priority? If that's not good, then how about using int  for the priority field?", "author": "cmark", "createdAt": "2020-10-28T13:53:38Z", "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/compare/ConceptMapCompareChangeKind.java", "diffHunk": "@@ -21,29 +21,35 @@\n  * @since 7.11\n  */\n public enum ConceptMapCompareChangeKind {\n-\tPRESENT(\"Present\"),\n-\tMISSING(\"Missing\"),\n+\tPRESENT(\"Present\", \"2\"),\n+\tMISSING(\"Missing\", \"1\"),", "originalCommit": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2MTM0NQ==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513461345", "bodyText": "\u26a0\ufe0f Fix the indentation!", "author": "cmark", "createdAt": "2020-10-28T13:54:17Z", "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/compare/ConceptMapCompareConfigurationProperties.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Copyright 2020 B2i Healthcare Pte Ltd, http://b2i.sg\n+ * \n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.b2international.snowowl.core.compare;\n+\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.function.BiFunction;\n+\n+import com.b2international.snowowl.core.domain.ConceptMapMapping;\n+import com.google.common.collect.ImmutableSet;\n+\n+/**\n+ * @since 7.11\n+ */\n+public enum ConceptMapCompareConfigurationProperties {\n+\n+\tCODE_SYSTEM(", "originalCommit": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUzMzIwNw==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513533207", "bodyText": "Ctrl+I does not change anything, I think the indentation is OK.", "author": "molnarlaura", "createdAt": "2020-10-28T15:21:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2MTM0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzczMTYzOA==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513731638", "bodyText": "No, it's not \ud83d\ude22 Fixed it.", "author": "cmark", "createdAt": "2020-10-28T20:14:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2MTM0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2MjYzMA==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513462630", "bodyText": "Use List.copyOf() if possible.", "author": "cmark", "createdAt": "2020-10-28T13:55:53Z", "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/compare/ConceptMapCompareResult.java", "diffHunk": "@@ -36,27 +33,27 @@\n \tprivate final int totalAdded;\n \tprivate final int totalRemoved;\n \tprivate final int totalChanged;\n+\tprivate final int totalUnchanged;\n \tprivate final int limit;\n \t\n \tprivate final List<ConceptMapMapping> addedMembers;\n \tprivate final List<ConceptMapMapping> removedMembers;\n \t\n-\tprivate final Multimap<ConceptMapMapping, ConceptMapMapping> changedMembers;\n+\tprivate final List<ConceptMapMapping> changedMembers;\n \tprivate final List<ConceptMapMapping> unchangedMembers;\n \t\n-\tpublic ConceptMapCompareResult(List<ConceptMapMapping> addedMembers, List<ConceptMapMapping> removedMembers, Multimap<ConceptMapMapping, ConceptMapMapping> changedMembers, Set<ConceptMapMapping> unchangedMembers, int limit) {\n+\tpublic ConceptMapCompareResult(List<ConceptMapMapping> addedMembers, List<ConceptMapMapping> removedMembers, List<ConceptMapMapping> changedMembers, Set<ConceptMapMapping> unchangedMembers, int limit) {\n \t\t\n-\t\tthis.addedMembers = addedMembers.stream().limit(limit).collect(toList());\n-\t\tthis.removedMembers = removedMembers.stream().limit(limit).collect(toList());\n+\t\tthis.addedMembers = addedMembers.stream().collect(toList());", "originalCommit": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUyMTA2MQ==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513521061", "bodyText": "Done", "author": "molnarlaura", "createdAt": "2020-10-28T15:06:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2MjYzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2Mjg3OA==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513462878", "bodyText": "Same here.", "author": "cmark", "createdAt": "2020-10-28T13:56:12Z", "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/compare/ConceptMapCompareResult.java", "diffHunk": "@@ -36,27 +33,27 @@\n \tprivate final int totalAdded;\n \tprivate final int totalRemoved;\n \tprivate final int totalChanged;\n+\tprivate final int totalUnchanged;\n \tprivate final int limit;\n \t\n \tprivate final List<ConceptMapMapping> addedMembers;\n \tprivate final List<ConceptMapMapping> removedMembers;\n \t\n-\tprivate final Multimap<ConceptMapMapping, ConceptMapMapping> changedMembers;\n+\tprivate final List<ConceptMapMapping> changedMembers;\n \tprivate final List<ConceptMapMapping> unchangedMembers;\n \t\n-\tpublic ConceptMapCompareResult(List<ConceptMapMapping> addedMembers, List<ConceptMapMapping> removedMembers, Multimap<ConceptMapMapping, ConceptMapMapping> changedMembers, Set<ConceptMapMapping> unchangedMembers, int limit) {\n+\tpublic ConceptMapCompareResult(List<ConceptMapMapping> addedMembers, List<ConceptMapMapping> removedMembers, List<ConceptMapMapping> changedMembers, Set<ConceptMapMapping> unchangedMembers, int limit) {\n \t\t\n-\t\tthis.addedMembers = addedMembers.stream().limit(limit).collect(toList());\n-\t\tthis.removedMembers = removedMembers.stream().limit(limit).collect(toList());\n+\t\tthis.addedMembers = addedMembers.stream().collect(toList());\n+\t\tthis.removedMembers = removedMembers.stream().collect(toList());", "originalCommit": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUyMTI4Nw==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513521287", "bodyText": "Done", "author": "molnarlaura", "createdAt": "2020-10-28T15:06:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2Mjg3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2Mjk1Ng==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513462956", "bodyText": "Same here.", "author": "cmark", "createdAt": "2020-10-28T13:56:17Z", "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/compare/ConceptMapCompareResult.java", "diffHunk": "@@ -36,27 +33,27 @@\n \tprivate final int totalAdded;\n \tprivate final int totalRemoved;\n \tprivate final int totalChanged;\n+\tprivate final int totalUnchanged;\n \tprivate final int limit;\n \t\n \tprivate final List<ConceptMapMapping> addedMembers;\n \tprivate final List<ConceptMapMapping> removedMembers;\n \t\n-\tprivate final Multimap<ConceptMapMapping, ConceptMapMapping> changedMembers;\n+\tprivate final List<ConceptMapMapping> changedMembers;\n \tprivate final List<ConceptMapMapping> unchangedMembers;\n \t\n-\tpublic ConceptMapCompareResult(List<ConceptMapMapping> addedMembers, List<ConceptMapMapping> removedMembers, Multimap<ConceptMapMapping, ConceptMapMapping> changedMembers, Set<ConceptMapMapping> unchangedMembers, int limit) {\n+\tpublic ConceptMapCompareResult(List<ConceptMapMapping> addedMembers, List<ConceptMapMapping> removedMembers, List<ConceptMapMapping> changedMembers, Set<ConceptMapMapping> unchangedMembers, int limit) {\n \t\t\n-\t\tthis.addedMembers = addedMembers.stream().limit(limit).collect(toList());\n-\t\tthis.removedMembers = removedMembers.stream().limit(limit).collect(toList());\n+\t\tthis.addedMembers = addedMembers.stream().collect(toList());\n+\t\tthis.removedMembers = removedMembers.stream().collect(toList());\n \t\t\n-\t\tBuilder<ConceptMapMapping, ConceptMapMapping> limitedMembers = ImmutableMultimap.builder();\n-\t\tchangedMembers.entries().stream().limit(limit).forEach(limitedMembers::put);\n-\t\tthis.changedMembers = limitedMembers.build();\n+\t\tthis.changedMembers = changedMembers.stream().collect(toList());", "originalCommit": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUyMTQyMA==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513521420", "bodyText": "Done", "author": "molnarlaura", "createdAt": "2020-10-28T15:07:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2Mjk1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2Mzc0Ng==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513463746", "bodyText": "Magic number! Divided by two? Why (because of counting both base and compare side of the change)? Please add a comment.", "author": "cmark", "createdAt": "2020-10-28T13:57:13Z", "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/compare/ConceptMapCompareResult.java", "diffHunk": "@@ -36,27 +33,27 @@\n \tprivate final int totalAdded;\n \tprivate final int totalRemoved;\n \tprivate final int totalChanged;\n+\tprivate final int totalUnchanged;\n \tprivate final int limit;\n \t\n \tprivate final List<ConceptMapMapping> addedMembers;\n \tprivate final List<ConceptMapMapping> removedMembers;\n \t\n-\tprivate final Multimap<ConceptMapMapping, ConceptMapMapping> changedMembers;\n+\tprivate final List<ConceptMapMapping> changedMembers;\n \tprivate final List<ConceptMapMapping> unchangedMembers;\n \t\n-\tpublic ConceptMapCompareResult(List<ConceptMapMapping> addedMembers, List<ConceptMapMapping> removedMembers, Multimap<ConceptMapMapping, ConceptMapMapping> changedMembers, Set<ConceptMapMapping> unchangedMembers, int limit) {\n+\tpublic ConceptMapCompareResult(List<ConceptMapMapping> addedMembers, List<ConceptMapMapping> removedMembers, List<ConceptMapMapping> changedMembers, Set<ConceptMapMapping> unchangedMembers, int limit) {\n \t\t\n-\t\tthis.addedMembers = addedMembers.stream().limit(limit).collect(toList());\n-\t\tthis.removedMembers = removedMembers.stream().limit(limit).collect(toList());\n+\t\tthis.addedMembers = addedMembers.stream().collect(toList());\n+\t\tthis.removedMembers = removedMembers.stream().collect(toList());\n \t\t\n-\t\tBuilder<ConceptMapMapping, ConceptMapMapping> limitedMembers = ImmutableMultimap.builder();\n-\t\tchangedMembers.entries().stream().limit(limit).forEach(limitedMembers::put);\n-\t\tthis.changedMembers = limitedMembers.build();\n+\t\tthis.changedMembers = changedMembers.stream().collect(toList());\n \t\tthis.unchangedMembers = ImmutableList.copyOf(unchangedMembers);\n \t\t\n \t\tthis.totalAdded = addedMembers.size();\n \t\tthis.totalRemoved = removedMembers.size();\n-\t\tthis.totalChanged = changedMembers.values().size();\n+\t\tthis.totalChanged = changedMembers.size()/2;", "originalCommit": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUyMTY0Ng==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513521646", "bodyText": "Fixed", "author": "molnarlaura", "createdAt": "2020-10-28T15:07:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2Mzc0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3MDE3Mw==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513470173", "bodyText": "Add a @NotEmpty validation annotation and also a default value set in the corresponding builder.", "author": "cmark", "createdAt": "2020-10-28T14:05:24Z", "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/ConceptMapCompareRequest.java", "diffHunk": "@@ -16,44 +16,48 @@\n package com.b2international.snowowl.core.request;\n \n import java.util.List;\n-import java.util.Objects;\n import java.util.Set;\n+import java.util.stream.Collectors;\n \n import javax.validation.constraints.Min;\n \n import com.b2international.snowowl.core.codesystem.CodeSystemRequests;\n+import com.b2international.snowowl.core.compare.ConceptMapCompareConfigurationProperties;\n import com.b2international.snowowl.core.compare.ConceptMapCompareResult;\n+import com.b2international.snowowl.core.compare.MapCompareSourceAndTargetEquivalence;\n import com.b2international.snowowl.core.domain.BranchContext;\n import com.b2international.snowowl.core.domain.ConceptMapMapping;\n import com.b2international.snowowl.core.domain.ConceptMapMappings;\n import com.b2international.snowowl.core.uri.ComponentURI;\n+import com.google.common.base.Equivalence.Wrapper;\n import com.google.common.collect.ArrayListMultimap;\n-import com.google.common.collect.HashMultimap;\n import com.google.common.collect.ListMultimap;\n import com.google.common.collect.Lists;\n-import com.google.common.collect.Multimap;\n import com.google.common.collect.Sets;\n import com.google.common.collect.Sets.SetView;\n \n /**\n * @since 7.8\n */\n public final class ConceptMapCompareRequest extends ResourceRequest<BranchContext, ConceptMapCompareResult> {\n+\tpublic static final int DEFAULT_MEMBER_COMPARE_LIMIT = 50_000;\n \t\n \tprivate static final long serialVersionUID = 1L;\n \t\n \tprivate static final int DEFAULT_MEMBER_SCROLL_LIMIT = 10_000;\n \t\n \tprivate final ComponentURI baseConceptMapURI;\n \tprivate final ComponentURI compareConceptMapURI;\n+\tprivate final Set<ConceptMapCompareConfigurationProperties> selectedConfig;", "originalCommit": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUyMTc0Mg==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513521742", "bodyText": "Done", "author": "molnarlaura", "createdAt": "2020-10-28T15:07:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3MDE3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3MjM2MQ==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513472361", "bodyText": "Where do you use this? 5000 is set on the corresponding builder.", "author": "cmark", "createdAt": "2020-10-28T14:08:17Z", "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/ConceptMapCompareRequest.java", "diffHunk": "@@ -16,44 +16,48 @@\n package com.b2international.snowowl.core.request;\n \n import java.util.List;\n-import java.util.Objects;\n import java.util.Set;\n+import java.util.stream.Collectors;\n \n import javax.validation.constraints.Min;\n \n import com.b2international.snowowl.core.codesystem.CodeSystemRequests;\n+import com.b2international.snowowl.core.compare.ConceptMapCompareConfigurationProperties;\n import com.b2international.snowowl.core.compare.ConceptMapCompareResult;\n+import com.b2international.snowowl.core.compare.MapCompareSourceAndTargetEquivalence;\n import com.b2international.snowowl.core.domain.BranchContext;\n import com.b2international.snowowl.core.domain.ConceptMapMapping;\n import com.b2international.snowowl.core.domain.ConceptMapMappings;\n import com.b2international.snowowl.core.uri.ComponentURI;\n+import com.google.common.base.Equivalence.Wrapper;\n import com.google.common.collect.ArrayListMultimap;\n-import com.google.common.collect.HashMultimap;\n import com.google.common.collect.ListMultimap;\n import com.google.common.collect.Lists;\n-import com.google.common.collect.Multimap;\n import com.google.common.collect.Sets;\n import com.google.common.collect.Sets.SetView;\n \n /**\n * @since 7.8\n */\n public final class ConceptMapCompareRequest extends ResourceRequest<BranchContext, ConceptMapCompareResult> {\n+\tpublic static final int DEFAULT_MEMBER_COMPARE_LIMIT = 50_000;", "originalCommit": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUyODgwMQ==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513528801", "bodyText": "It is used in the CompareMappingSetsHandler's and SnomedConceptMapCompareHandler's onFinish validation.", "author": "molnarlaura", "createdAt": "2020-10-28T15:16:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3MjM2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUzNTExNg==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513535116", "bodyText": "Then move it to those classes, since that is UI specific and keep the API still load 5000 changes by default.", "author": "cmark", "createdAt": "2020-10-28T15:24:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3MjM2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3MjgwOQ==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513472809", "bodyText": "Are we using this now? I'm not seeing any statement nor filter that uses this value.", "author": "cmark", "createdAt": "2020-10-28T14:08:50Z", "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/ConceptMapCompareRequest.java", "diffHunk": "@@ -16,44 +16,48 @@\n package com.b2international.snowowl.core.request;\n \n import java.util.List;\n-import java.util.Objects;\n import java.util.Set;\n+import java.util.stream.Collectors;\n \n import javax.validation.constraints.Min;\n \n import com.b2international.snowowl.core.codesystem.CodeSystemRequests;\n+import com.b2international.snowowl.core.compare.ConceptMapCompareConfigurationProperties;\n import com.b2international.snowowl.core.compare.ConceptMapCompareResult;\n+import com.b2international.snowowl.core.compare.MapCompareSourceAndTargetEquivalence;\n import com.b2international.snowowl.core.domain.BranchContext;\n import com.b2international.snowowl.core.domain.ConceptMapMapping;\n import com.b2international.snowowl.core.domain.ConceptMapMappings;\n import com.b2international.snowowl.core.uri.ComponentURI;\n+import com.google.common.base.Equivalence.Wrapper;\n import com.google.common.collect.ArrayListMultimap;\n-import com.google.common.collect.HashMultimap;\n import com.google.common.collect.ListMultimap;\n import com.google.common.collect.Lists;\n-import com.google.common.collect.Multimap;\n import com.google.common.collect.Sets;\n import com.google.common.collect.Sets.SetView;\n \n /**\n * @since 7.8\n */\n public final class ConceptMapCompareRequest extends ResourceRequest<BranchContext, ConceptMapCompareResult> {\n+\tpublic static final int DEFAULT_MEMBER_COMPARE_LIMIT = 50_000;\n \t\n \tprivate static final long serialVersionUID = 1L;\n \t\n \tprivate static final int DEFAULT_MEMBER_SCROLL_LIMIT = 10_000;\n \t\n \tprivate final ComponentURI baseConceptMapURI;\n \tprivate final ComponentURI compareConceptMapURI;\n+\tprivate final Set<ConceptMapCompareConfigurationProperties> selectedConfig;\n \t\n \t@Min(0)\n \tprivate int limit;", "originalCommit": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUyMzYxOA==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513523618", "bodyText": "It is used when creating the MapCompareSourceAndTargetEquivalence instance and in the isSourceEqual() method.", "author": "molnarlaura", "createdAt": "2020-10-28T15:09:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3MjgwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3MzA0Nw==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513473047", "bodyText": "5000 limit is present in this class.", "author": "cmark", "createdAt": "2020-10-28T14:09:06Z", "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/ConceptMapCompareRequestBuilder.java", "diffHunk": "@@ -30,20 +33,23 @@\n \t", "originalCommit": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUyNzE1MA==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513527150", "bodyText": "This only limits the size of the result, the other one is for checking whether a set is larger than the default 50 000 limit.", "author": "molnarlaura", "createdAt": "2020-10-28T15:14:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3MzA0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3MzU4NQ==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/702#discussion_r513473585", "bodyText": "This can be the default value of the config field in the ConceptMap Compare API.", "author": "cmark", "createdAt": "2020-10-28T14:09:45Z", "path": "snomed/com.b2international.snowowl.snomed.core.rest.tests/src/com/b2international/snowowl/snomed/core/rest/compare/SnomedMapTypeReferenceSetCompareTest.java", "diffHunk": "@@ -88,15 +89,15 @@ public void compareEqualSimpleMapTypeReferenceSets() {\n \t\tComponentURI baseURI = createURI(rf1Id);\n \t\tComponentURI compareURI = createURI(rf2Id);\n \t\t\n-\t\tConceptMapCompareResult result = CodeSystemRequests.prepareConceptMapCompare(baseURI, compareURI)\n+\t\tConceptMapCompareResult result = CodeSystemRequests.prepareConceptMapCompare(baseURI, compareURI, ConceptMapCompareConfigurationProperties.DEFAULT_SELECTED_PROPERTIES)", "originalCommit": "2c184d5ce1264ef16ed2168d2feb7348eb45ae00", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "178aac210ccd9d2b53ab5fdae2f391045e758f64", "url": "https://github.com/b2ihealthcare/snow-owl/commit/178aac210ccd9d2b53ab5fdae2f391045e758f64", "message": "SO-4345: change hashCode logic", "committedDate": "2020-10-28T14:16:57Z", "type": "commit"}, {"oid": "9166f7983ebe9d63e96d40f185d1010970d337b1", "url": "https://github.com/b2ihealthcare/snow-owl/commit/9166f7983ebe9d63e96d40f185d1010970d337b1", "message": "SO-4345: add notempty annotation", "committedDate": "2020-10-28T14:18:44Z", "type": "commit"}, {"oid": "2920d67e4b55914eef5255633ed5331ef9c36228", "url": "https://github.com/b2ihealthcare/snow-owl/commit/2920d67e4b55914eef5255633ed5331ef9c36228", "message": "SO-4345: add notempty annotation", "committedDate": "2020-10-28T14:23:09Z", "type": "commit"}, {"oid": "2c53eba8f1950333bdc6dc23ac783a05c965d203", "url": "https://github.com/b2ihealthcare/snow-owl/commit/2c53eba8f1950333bdc6dc23ac783a05c965d203", "message": "SO-4345: add limited members and total numbers to result", "committedDate": "2020-10-28T14:59:01Z", "type": "commit"}, {"oid": "513d1abf18c1c2e86d567246d2b8a3bc143904be", "url": "https://github.com/b2ihealthcare/snow-owl/commit/513d1abf18c1c2e86d567246d2b8a3bc143904be", "message": "SO-4345: use default compare config if there is any set", "committedDate": "2020-10-28T15:44:50Z", "type": "commit"}, {"oid": "36f71c741acd1f858abdc4ca67c0bb326ccac517", "url": "https://github.com/b2ihealthcare/snow-owl/commit/36f71c741acd1f858abdc4ca67c0bb326ccac517", "message": "Merge remote-tracking branch 'origin/7.x' into improvement/SO-4345-configure-map-compare-props", "committedDate": "2020-10-28T15:46:29Z", "type": "commit"}, {"oid": "aea24e0a46dc3dc263fc59982f497f3e96b286ad", "url": "https://github.com/b2ihealthcare/snow-owl/commit/aea24e0a46dc3dc263fc59982f497f3e96b286ad", "message": "SO-4345: handle limit properly on server-side ConceptMap compare\n\nReturn a single list of result items instead of kind specific mapping\nchange lists.", "committedDate": "2020-10-28T16:56:33Z", "type": "commit"}, {"oid": "d54a1baf8c2dc8bb972753018693d0dc015299d5", "url": "https://github.com/b2ihealthcare/snow-owl/commit/d54a1baf8c2dc8bb972753018693d0dc015299d5", "message": "SO-4345: fix compile errors...\n\n...in ConceptMapCompareSnomedMapTypeReferenceSetTest", "committedDate": "2020-10-28T19:48:53Z", "type": "commit"}]}