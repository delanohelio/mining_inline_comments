{"pr_number": 3756, "pr_title": "feat(cli): support TS/JS config files", "pr_createdAt": "2020-11-03T00:12:14Z", "pr_url": "https://github.com/ionic-team/capacitor/pull/3756", "timeline": [{"oid": "afb21adbc6218b2809de9eb14e482ff952c3080b", "url": "https://github.com/ionic-team/capacitor/commit/afb21adbc6218b2809de9eb14e482ff952c3080b", "message": "feat(cli): STUDIO_PATH environment variable", "committedDate": "2020-11-02T19:37:18Z", "type": "commit"}, {"oid": "e1e7f666f3e8ec21a5e4585f5ed345e24d52156c", "url": "https://github.com/ionic-team/capacitor/commit/e1e7f666f3e8ec21a5e4585f5ed345e24d52156c", "message": "check before opening", "committedDate": "2020-11-02T19:58:29Z", "type": "commit"}, {"oid": "cf26a4b246aa841637a10e6983fefc62fa20a61e", "url": "https://github.com/ionic-team/capacitor/commit/cf26a4b246aa841637a10e6983fefc62fa20a61e", "message": "use config for config file name", "committedDate": "2020-11-02T23:01:35Z", "type": "commit"}, {"oid": "c96aa186f666c197ec0bce5cf7612019c709b3b9", "url": "https://github.com/ionic-team/capacitor/commit/c96aa186f666c197ec0bce5cf7612019c709b3b9", "message": "split out extConfig stuff", "committedDate": "2020-11-02T23:21:23Z", "type": "commit"}, {"oid": "d54128741092c616b5eac450231d8ec994e9fd73", "url": "https://github.com/ionic-team/capacitor/commit/d54128741092c616b5eac450231d8ec994e9fd73", "message": "load js", "committedDate": "2020-11-02T23:44:39Z", "type": "commit"}, {"oid": "7d0e5c1bbc5c8d78a043998f96bce317244f5a40", "url": "https://github.com/ionic-team/capacitor/commit/7d0e5c1bbc5c8d78a043998f96bce317244f5a40", "message": "copy = write json from loaded config", "committedDate": "2020-11-02T23:56:19Z", "type": "commit"}, {"oid": "8a47e914b0bfcbaf8923fa6d00fcab260301f0a1", "url": "https://github.com/ionic-team/capacitor/commit/8a47e914b0bfcbaf8923fa6d00fcab260301f0a1", "message": "init for non-json", "committedDate": "2020-11-03T00:02:44Z", "type": "commit"}, {"oid": "5e9860588760cc59e17e5cfac5b958b4e2fa82a1", "url": "https://github.com/ionic-team/capacitor/commit/5e9860588760cc59e17e5cfac5b958b4e2fa82a1", "message": "Merge branch 'main' into dynamic-config", "committedDate": "2020-11-03T16:32:25Z", "type": "commit"}, {"oid": "76264f27f6be0eba8f9886a61c8354d30cace188", "url": "https://github.com/ionic-team/capacitor/commit/76264f27f6be0eba8f9886a61c8354d30cace188", "message": "revert the help output", "committedDate": "2020-11-03T16:35:54Z", "type": "commit"}, {"oid": "9462e6a7ae5b171dae7fa6473fcb36659efb83d8", "url": "https://github.com/ionic-team/capacitor/commit/9462e6a7ae5b171dae7fa6473fcb36659efb83d8", "message": "support TS files", "committedDate": "2020-11-03T20:22:27Z", "type": "commit"}, {"oid": "859c0effe837ee88bfc2c1e30add8f2c85a6e276", "url": "https://github.com/ionic-team/capacitor/commit/859c0effe837ee88bfc2c1e30add8f2c85a6e276", "message": "expose CapacitorConfig type", "committedDate": "2020-11-03T20:48:44Z", "type": "commit"}, {"oid": "c2eb9c376b80eb6949ffd15bc8abad874b8266a2", "url": "https://github.com/ionic-team/capacitor/commit/c2eb9c376b80eb6949ffd15bc8abad874b8266a2", "message": "internalize readonly", "committedDate": "2020-11-03T20:56:41Z", "type": "commit"}, {"oid": "7861b808e034f32068c4df03400f334786e8531f", "url": "https://github.com/ionic-team/capacitor/commit/7861b808e034f32068c4df03400f334786e8531f", "message": "document all the things", "committedDate": "2020-11-03T21:53:51Z", "type": "commit"}, {"oid": "4b3b2bddb1affaff7228d250b69fcb3adb20bdeb", "url": "https://github.com/ionic-team/capacitor/commit/4b3b2bddb1affaff7228d250b69fcb3adb20bdeb", "message": "undo core change", "committedDate": "2020-11-03T21:57:32Z", "type": "commit"}, {"oid": "99d920600bde3654daf80fa97df17cd2f5f0f4ca", "url": "https://github.com/ionic-team/capacitor/commit/99d920600bde3654daf80fa97df17cd2f5f0f4ca", "message": "Merge branch 'main' into dynamic-config", "committedDate": "2020-11-05T18:31:31Z", "type": "commit"}, {"oid": "ed8d1fab06f0f1dfc0f8367e9fb1a22cb8879f91", "url": "https://github.com/ionic-team/capacitor/commit/ed8d1fab06f0f1dfc0f8367e9fb1a22cb8879f91", "message": "Merge branch 'main' into dynamic-config", "committedDate": "2020-11-08T22:56:00Z", "type": "commit"}, {"oid": "859ed8a9b97f126c399f66952a06722fed134d15", "url": "https://github.com/ionic-team/capacitor/commit/859ed8a9b97f126c399f66952a06722fed134d15", "message": "use accurate versions for since tags", "committedDate": "2020-11-09T18:17:05Z", "type": "commit"}, {"oid": "22b9138cd4d634d4a3a1ee79421b1dc97cab4245", "url": "https://github.com/ionic-team/capacitor/commit/22b9138cd4d634d4a3a1ee79421b1dc97cab4245", "message": "small typo", "committedDate": "2020-11-09T18:55:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAyNTM3Mw==", "url": "https://github.com/ionic-team/capacitor/pull/3756#discussion_r520025373", "bodyText": "this is only set if the preference is set, if not set then it uses the webview default value. According to this, on iOS 10 and newer it's true", "author": "jcesarmobile", "createdAt": "2020-11-09T18:26:03Z", "path": "cli/src/declarations.ts", "diffHunk": "@@ -0,0 +1,341 @@\n+export interface CapacitorConfig {\n+  /**\n+   * The Package ID of your app.\n+   *\n+   * Package IDs (aka Bundle ID in iOS and Application ID in Android) are\n+   * unique identifiers for apps. They must be in reverse domain name notation,\n+   * generally representing a domain name that you or your company owns.\n+   *\n+   * @since 1.0.0\n+   */\n+  appId?: string;\n+\n+  /**\n+   * The human-friendly name of your app.\n+   *\n+   * This should be what you'd see in the App Store, but can be changed after\n+   * within each native platform after it is generated.\n+   *\n+   * @since 1.0.0\n+   */\n+  appName?: string;\n+\n+  /**\n+   * The directory of your compiled web assets.\n+   *\n+   * This directory should contain the final `index.html` of your app.\n+   *\n+   * @since 1.0.0\n+   */\n+  webDir?: string;\n+\n+  /**\n+   * Whether to copy the Capacitor runtime bundle or not.\n+   *\n+   * If your app is using a bundler, this should be `false`. If you added\n+   * `capacitor.js` as a script in your `index.html` file, this should be\n+   * `true`.\n+   *\n+   * @since 1.0.0\n+   * @default false\n+   */\n+  bundledWebRuntime?: boolean;\n+\n+  /**\n+   * Hide or show the native logs for iOS and Android.\n+   *\n+   * @since 2.1.0\n+   * @default false\n+   */\n+  hideLogs?: boolean;\n+\n+  /**\n+   * User agent of Capacitor Web View.\n+   *\n+   * @since 1.4.0\n+   */\n+  overrideUserAgent?: string;\n+\n+  /**\n+   * String to append to the original user agent of Capacitor Web View.\n+   *\n+   * This is disregarded if `overrideUserAgent` is used.\n+   *\n+   * @since 1.4.0\n+   */\n+  appendUserAgent?: string;\n+\n+  /**\n+   * Background color of the Capacitor Web View.\n+   *\n+   * @since 1.1.0\n+   */\n+  backgroundColor?: string;\n+\n+  android?: {\n+    /**\n+     * Specify a custom path to the native Android project.\n+     *\n+     * @since 3.0.0\n+     * @default android\n+     */\n+    path?: string;\n+\n+    /**\n+     * User agent of Capacitor Web View on Android.\n+     *\n+     * Overrides global `overrideUserAgent` option.\n+     *\n+     * @since 1.4.0\n+     */\n+    overrideUserAgent?: string;\n+\n+    /**\n+     * String to append to the original user agent of Capacitor Web View for Android.\n+     *\n+     * Overrides global `appendUserAgent` option.\n+     *\n+     * This is disregarded if `overrideUserAgent` is used.\n+     *\n+     * @since 1.4.0\n+     */\n+    appendUserAgent?: string;\n+\n+    /**\n+     * Background color of the Capacitor Web View for Android.\n+     *\n+     * Overrides global `backgroundColor` option.\n+     *\n+     * @since 1.1.0\n+     */\n+    backgroundColor?: string;\n+\n+    /**\n+     * Enable mixed content in the Capacitor Web View for Android.\n+     *\n+     * [Mixed\n+     * content](https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content)\n+     * is disabled by default for security. During development, you may need to\n+     * enable it to allow the Web View to load files from different schemes.\n+     *\n+     * **This is not intended for use in production.**\n+     *\n+     * @since 1.0.0\n+     * @default false\n+     */\n+    allowMixedContent?: boolean;\n+\n+    /**\n+     * This enables a simpler keyboard which may have some limitations.\n+     *\n+     * This will capture JS keys using an alternative\n+     * [`InputConnection`](https://developer.android.com/reference/android/view/inputmethod/InputConnection).\n+     *\n+     * @since 1.0.0\n+     * @default false\n+     */\n+    captureInput?: boolean;\n+\n+    /**\n+     * Always enable debuggable web content.\n+     *\n+     * This is automatically enabled during development.\n+     *\n+     * @since 1.0.0\n+     * @default false\n+     */\n+    webContentsDebuggingEnabled?: boolean;\n+\n+    /**\n+     * Hide or show the native logs for Android.\n+     *\n+     * Overrides global `hideLogs` option.\n+     *\n+     * @since 2.1.0\n+     * @default false\n+     */\n+    hideLogs?: boolean;\n+  };\n+\n+  ios?: {\n+    /**\n+     * Specify a custom path to the native iOS project.\n+     *\n+     * @since 3.0.0\n+     * @default ios\n+     */\n+    path?: string;\n+\n+    /**\n+     * User agent of Capacitor Web View on iOS.\n+     *\n+     * Overrides global `overrideUserAgent` option.\n+     *\n+     * @since 1.4.0\n+     */\n+    overrideUserAgent?: string;\n+\n+    /**\n+     * String to append to the original user agent of Capacitor Web View for iOS.\n+     *\n+     * Overrides global `appendUserAgent` option.\n+     *\n+     * This is disregarded if `overrideUserAgent` is used.\n+     *\n+     * @since 1.4.0\n+     */\n+    appendUserAgent?: string;\n+\n+    /**\n+     * Background color of the Capacitor Web View for iOS.\n+     *\n+     * Overrides global `backgroundColor` option.\n+     *\n+     * @since 1.1.0\n+     */\n+    backgroundColor?: string;\n+\n+    /**\n+     * Configure the scroll view's content inset adjustment behavior.\n+     *\n+     * This will set the\n+     * [`contentInsetAdjustmentBehavior`](https://developer.apple.com/documentation/uikit/uiscrollview/2902261-contentinsetadjustmentbehavior)\n+     * property on the Web View's\n+     * [`UIScrollView`](https://developer.apple.com/documentation/uikit/uiscrollview).\n+     *\n+     * @since 2.0.0\n+     * @default never\n+     */\n+    contentInset?: 'automatic' | 'scrollableAxes' | 'never' | 'always';\n+\n+    /**\n+     * Configure the Swift version to be used in Cordova plugins.\n+     *\n+     * @since 1.0.0\n+     * @default 5.1\n+     */\n+    cordovaSwiftVersion?: string;\n+\n+    /**\n+     * Configure the minimum iOS version supported.\n+     *\n+     * @since 1.0.0\n+     * @default 11.0\n+     */\n+    minVersion?: string;\n+\n+    /**\n+     * Configure custom linker flags for compiling Cordova plugins.\n+     *\n+     * @since 1.0.0\n+     * @default []\n+     */\n+    cordovaLinkerFlags?: string[];\n+\n+    /**\n+     * Allow destination previews when pressing on links.\n+     *\n+     * @since 2.0.0\n+     * @default false\n+     */\n+    allowsLinkPreview?: boolean;", "originalCommit": "859ed8a9b97f126c399f66952a06722fed134d15", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzODcwMA==", "url": "https://github.com/ionic-team/capacitor/pull/3756#discussion_r520038700", "bodyText": "Since there is already a common confusion about the android package name and the application ID, I think we should not use package ID here, better use App ID.", "author": "jcesarmobile", "createdAt": "2020-11-09T18:49:14Z", "path": "cli/src/declarations.ts", "diffHunk": "@@ -0,0 +1,341 @@\n+export interface CapacitorConfig {\n+  /**\n+   * The Package ID of your app.\n+   *\n+   * Package IDs (aka Bundle ID in iOS and Application ID in Android) are", "originalCommit": "859ed8a9b97f126c399f66952a06722fed134d15", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA0MTI3Mg==", "url": "https://github.com/ionic-team/capacitor/pull/3756#discussion_r520041272", "bodyText": "More like the opposite, if you set it to true, then you have to add capacitor.js to the index.html.\nShould be reworded to something like\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * If your app is using a bundler, this should be `false`. If you added\n          \n          \n            \n               * `capacitor.js` as a script in your `index.html` file, this should be\n          \n          \n            \n               * `true`.\n          \n          \n            \n               * If your app is using a bundler, this should be `false`. If not using a bundler\n          \n          \n            \n               * set this to true, then Capacitor will create a `capacitor.js` file that you'll need to add as \n          \n          \n            \n               * a script in your `index.html` file.", "author": "jcesarmobile", "createdAt": "2020-11-09T18:53:26Z", "path": "cli/src/declarations.ts", "diffHunk": "@@ -0,0 +1,341 @@\n+export interface CapacitorConfig {\n+  /**\n+   * The Package ID of your app.\n+   *\n+   * Package IDs (aka Bundle ID in iOS and Application ID in Android) are\n+   * unique identifiers for apps. They must be in reverse domain name notation,\n+   * generally representing a domain name that you or your company owns.\n+   *\n+   * @since 1.0.0\n+   */\n+  appId?: string;\n+\n+  /**\n+   * The human-friendly name of your app.\n+   *\n+   * This should be what you'd see in the App Store, but can be changed after\n+   * within each native platform after it is generated.\n+   *\n+   * @since 1.0.0\n+   */\n+  appName?: string;\n+\n+  /**\n+   * The directory of your compiled web assets.\n+   *\n+   * This directory should contain the final `index.html` of your app.\n+   *\n+   * @since 1.0.0\n+   */\n+  webDir?: string;\n+\n+  /**\n+   * Whether to copy the Capacitor runtime bundle or not.\n+   *\n+   * If your app is using a bundler, this should be `false`. If you added\n+   * `capacitor.js` as a script in your `index.html` file, this should be\n+   * `true`.", "originalCommit": "859ed8a9b97f126c399f66952a06722fed134d15", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA0NDQ3NQ==", "url": "https://github.com/ionic-team/capacitor/pull/3756#discussion_r520044475", "bodyText": "since init doesn't work if a .ts or .js file is present, I don't think this needs to be changed", "author": "jcesarmobile", "createdAt": "2020-11-09T18:58:37Z", "path": "cli/src/tasks/init.ts", "diffHunk": "@@ -38,7 +48,7 @@ export async function initCommand(\n     const cordova = await getCordovaPreferences(config);\n \n     await runTask(\n-      `Creating ${c.strong('capacitor.config.json')} in ${c.input(\n+      `Creating ${c.strong(config.app.extConfigName)} in ${c.input(", "originalCommit": "22b9138cd4d634d4a3a1ee79421b1dc97cab4245", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA0NDczNA==", "url": "https://github.com/ionic-team/capacitor/pull/3756#discussion_r520044734", "bodyText": "same, init only works with the .json file", "author": "jcesarmobile", "createdAt": "2020-11-09T18:59:00Z", "path": "cli/src/tasks/init.ts", "diffHunk": "@@ -62,8 +72,8 @@ export async function initCommand(\n   }\n }\n \n-function printNextSteps() {\n-  logSuccess(`${c.strong('capacitor.config.json')} created!`);\n+function printNextSteps(config: Config) {\n+  logSuccess(`${c.strong(config.app.extConfigName)} created!`);", "originalCommit": "22b9138cd4d634d4a3a1ee79421b1dc97cab4245", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA0NTgwMw==", "url": "https://github.com/ionic-team/capacitor/pull/3756#discussion_r520045803", "bodyText": "init only works on .json files, don't need to change this", "author": "jcesarmobile", "createdAt": "2020-11-09T19:00:36Z", "path": "cli/src/cordova.ts", "diffHunk": "@@ -527,7 +527,7 @@ export async function getCordovaPreferences(config: Config): Promise<any> {\n     const answers = await logPrompt(\n       `${c.strong(\n         `Cordova preferences can be automatically ported to ${c.strong(\n-          'capacitor.config.json',\n+          config.app.extConfigName,", "originalCommit": "22b9138cd4d634d4a3a1ee79421b1dc97cab4245", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5cbc24de8f3add52b805b7871681ec556767c6be", "url": "https://github.com/ionic-team/capacitor/commit/5cbc24de8f3add52b805b7871681ec556767c6be", "message": "document scrollEnabled", "committedDate": "2020-11-09T19:13:26Z", "type": "commit"}, {"oid": "a50c492b47ed3080fb918df9a05e918982747218", "url": "https://github.com/ionic-team/capacitor/commit/a50c492b47ed3080fb918df9a05e918982747218", "message": "reword bundle option", "committedDate": "2020-11-09T19:13:44Z", "type": "commit"}, {"oid": "f74789f9769b2c14085d67db1f37168de606efa8", "url": "https://github.com/ionic-team/capacitor/commit/f74789f9769b2c14085d67db1f37168de606efa8", "message": "clarify default option on allowsLinkPreview", "committedDate": "2020-11-09T19:14:07Z", "type": "commit"}, {"oid": "2473a48bcc0744f2243e9e038b3c6f7bac06b037", "url": "https://github.com/ionic-team/capacitor/commit/2473a48bcc0744f2243e9e038b3c6f7bac06b037", "message": "app id", "committedDate": "2020-11-09T19:37:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM5Mzg1Ng==", "url": "https://github.com/ionic-team/capacitor/pull/3756#discussion_r522393856", "bodyText": "I think it'd be quite useful to optionally support exporting a () => Promise<ExternalConfig> instead of just ExternalConfig.\nWould you accept a pull request?", "author": "buschtoens", "createdAt": "2020-11-12T20:14:56Z", "path": "cli/src/config.ts", "diffHunk": "@@ -57,6 +54,86 @@ export async function loadConfig(): Promise<Config> {\n   return config;\n }\n \n+type ExtConfigPairs = Pick<\n+  AppConfig,\n+  'extConfigType' | 'extConfigName' | 'extConfigFilePath' | 'extConfig'\n+>;\n+\n+async function loadExtConfigTS(\n+  rootDir: string,\n+  extConfigName: string,\n+  extConfigFilePath: string,\n+): Promise<ExtConfigPairs> {\n+  try {\n+    const tsPath = resolveNode(rootDir, 'typescript');\n+\n+    if (!tsPath) {\n+      logFatal(\n+        'Could not find installation of TypeScript.\\n' +\n+          `To use ${c.strong(\n+            extConfigName,\n+          )} files, you must install TypeScript in your project, e.g. w/ ${c.input(\n+            'npm install -D typescript',\n+          )}`,\n+      );\n+    }\n+\n+    const ts = require(tsPath); // eslint-disable-line @typescript-eslint/no-var-requires\n+\n+    return {\n+      extConfigType: 'ts',\n+      extConfigName,\n+      extConfigFilePath: extConfigFilePath,\n+      extConfig: requireTS(ts, extConfigFilePath) as any,", "originalCommit": "2473a48bcc0744f2243e9e038b3c6f7bac06b037", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjU1ODQwNA==", "url": "https://github.com/ionic-team/capacitor/pull/3756#discussion_r522558404", "bodyText": "Yes, I was thinking about this as well. I would be happy to look at a PR that adds that functionality.", "author": "imhoffd", "createdAt": "2020-11-13T01:52:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM5Mzg1Ng=="}], "type": "inlineReview"}]}