{"pr_number": 3796, "pr_title": "feat(iOS): Add local and remote notification router", "pr_createdAt": "2020-11-11T22:25:32Z", "pr_url": "https://github.com/ionic-team/capacitor/pull/3796", "timeline": [{"oid": "5f53de020aa42f5c206d875fea274097650f94ca", "url": "https://github.com/ionic-team/capacitor/commit/5f53de020aa42f5c206d875fea274097650f94ca", "message": "add notification delegate", "committedDate": "2020-11-11T22:24:01Z", "type": "commit"}, {"oid": "28ac7ddfb06f4089e524246592989c4afd2db613", "url": "https://github.com/ionic-team/capacitor/commit/28ac7ddfb06f4089e524246592989c4afd2db613", "message": "expose notification delegate", "committedDate": "2020-11-11T22:54:34Z", "type": "commit"}, {"oid": "0a1a2cdbc56ae73ae7f18dcaa3a780481b140190", "url": "https://github.com/ionic-team/capacitor/commit/0a1a2cdbc56ae73ae7f18dcaa3a780481b140190", "message": "remove redundant modifiers", "committedDate": "2020-11-11T22:57:21Z", "type": "commit"}, {"oid": "445d0dd5bd8709c37988deef768af98ce7477b56", "url": "https://github.com/ionic-team/capacitor/commit/445d0dd5bd8709c37988deef768af98ce7477b56", "message": "these must be public, otherwise 'internal'", "committedDate": "2020-11-20T00:10:50Z", "type": "commit"}, {"oid": "2b85d4a374785f71cd0790cb1d004a04152869b9", "url": "https://github.com/ionic-team/capacitor/commit/2b85d4a374785f71cd0790cb1d004a04152869b9", "message": "Merge branch 'main' into notification-delegate", "committedDate": "2020-11-20T00:12:57Z", "type": "commit"}, {"oid": "b1c87898fa4528be46231b5e00a550964dac090f", "url": "https://github.com/ionic-team/capacitor/commit/b1c87898fa4528be46231b5e00a550964dac090f", "message": "Merge branch 'main' into notification-delegate", "committedDate": "2020-11-20T18:18:31Z", "type": "commit"}, {"oid": "caf7c744218cab7004003967045c592df9adda35", "url": "https://github.com/ionic-team/capacitor/commit/caf7c744218cab7004003967045c592df9adda35", "message": "Merge branch 'main' into notification-delegate", "committedDate": "2020-11-20T18:29:38Z", "type": "commit"}, {"oid": "b296de50f3368db3a27a5d7549f694366d3bc29d", "url": "https://github.com/ionic-team/capacitor/commit/b296de50f3368db3a27a5d7549f694366d3bc29d", "message": "Merge branch 'main' into notification-delegate", "committedDate": "2020-11-24T20:49:47Z", "type": "commit"}, {"oid": "58cade0f1db15b86e3b4ec7378de5ab771e2bf03", "url": "https://github.com/ionic-team/capacitor/commit/58cade0f1db15b86e3b4ec7378de5ab771e2bf03", "message": "configurable", "committedDate": "2020-11-25T01:24:10Z", "type": "commit"}, {"oid": "5ec72b177a935a6324d0f75479d51db9eb3d85c5", "url": "https://github.com/ionic-team/capacitor/commit/5ec72b177a935a6324d0f75479d51db9eb3d85c5", "message": "Merge branch 'main' into notification-delegate", "committedDate": "2020-11-25T01:25:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQyNTQ3Nw==", "url": "https://github.com/ionic-team/capacitor/pull/3796#discussion_r530425477", "bodyText": "This should not be weak. Something needs to keep the instance in memory. Since the bridge creates the object then it should own it.\nAlso, it should be marked as public to match the protocol declaration. The protocol defines the property as read-only so that's how outside classes will see it.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private(set) weak var userNotificationDelegate: UserNotificationCenterDelegate\n          \n          \n            \n                public var userNotificationDelegate: UserNotificationCenterDelegate", "author": "ikeith", "createdAt": "2020-11-25T14:44:25Z", "path": "ios/Capacitor/Capacitor/CapacitorBridge.swift", "diffHunk": "@@ -16,6 +16,8 @@ internal class CapacitorBridge: NSObject, CAPBridgeProtocol {\n         return bridgeDelegate?.bridgedWebView\n     }\n \n+    private(set) weak var userNotificationDelegate: UserNotificationCenterDelegate", "originalCommit": "5ec72b177a935a6324d0f75479d51db9eb3d85c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU0MzM2Mw==", "url": "https://github.com/ionic-team/capacitor/pull/3796#discussion_r530543363", "bodyText": "I think the linter switched it to weak automatically \ud83e\udd14", "author": "imhoffd", "createdAt": "2020-11-25T17:36:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQyNTQ3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQzMTMwMg==", "url": "https://github.com/ionic-team/capacitor/pull/3796#discussion_r530431302", "bodyText": "Does this need a field in the config file? Otherwise turning it off will require that the app developer subclass the view controller to programmatically set it.", "author": "ikeith", "createdAt": "2020-11-25T14:52:22Z", "path": "ios/Capacitor/Capacitor/CAPInstanceConfiguration.h", "diffHunk": "@@ -17,6 +17,7 @@ NS_SWIFT_NAME(InstanceConfiguration)\n @property (nonatomic, readonly) BOOL enableLogging;\n @property (nonatomic, readonly) BOOL enableScrolling;\n @property (nonatomic, readonly) BOOL allowLinkPreviews;\n+@property (nonatomic, readonly) BOOL assignUserNotificationCenterDelegate;", "originalCommit": "5ec72b177a935a6324d0f75479d51db9eb3d85c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU0NDU3Mw==", "url": "https://github.com/ionic-team/capacitor/pull/3796#discussion_r530544573", "bodyText": "I don't think so. Disabling it is likely only a use case for embedded. If I'm mistaken, we can always add a field later.", "author": "imhoffd", "createdAt": "2020-11-25T17:38:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQzMTMwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQzODYwMA==", "url": "https://github.com/ionic-team/capacitor/pull/3796#discussion_r530438600", "bodyText": "What if this was moved into UserNotificationCenterDelegate? It could have a computed property that both returned whether or not it was the active delegate and allowed it be to set. The bridge, then, could just set the flag like:\nuserNotificationDelegate.handleNotifications = configuration.assignUserNotificationDelegate", "author": "ikeith", "createdAt": "2020-11-25T15:01:57Z", "path": "ios/Capacitor/Capacitor/CapacitorBridge.swift", "diffHunk": "@@ -172,6 +174,12 @@ internal class CapacitorBridge: NSObject, CAPBridgeProtocol {\n         self.messageHandlerWrapper = messageHandlerWrapper\n         self.config = configuration\n         self.cordovaParser = cordovaConfiguration\n+        self.userNotificationDelegate = UserNotificationCenterDelegate()\n+\n+        if configuration.assignUserNotificationCenterDelegate {\n+            let center = UNUserNotificationCenter.current()\n+            center.delegate = userNotificationDelegate\n+        }", "originalCommit": "5ec72b177a935a6324d0f75479d51db9eb3d85c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU0NDA3Ng==", "url": "https://github.com/ionic-team/capacitor/pull/3796#discussion_r530544076", "bodyText": "I wasn't quite sure where to place it because it's such global logic. I can change it to see how it looks.", "author": "imhoffd", "createdAt": "2020-11-25T17:37:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQzODYwMA=="}], "type": "inlineReview"}, {"oid": "d083b6704c71e20d3209ad60e55f8bff9cde733c", "url": "https://github.com/ionic-team/capacitor/commit/d083b6704c71e20d3209ad60e55f8bff9cde733c", "message": "Update ios/Capacitor/Capacitor/CapacitorBridge.swift\n\nCo-authored-by: Ian Keith <iankeith@gmail.com>", "committedDate": "2020-11-25T17:39:28Z", "type": "commit"}, {"oid": "e7d99ba11cd91bf12a4fe82fb371067b57116151", "url": "https://github.com/ionic-team/capacitor/commit/e7d99ba11cd91bf12a4fe82fb371067b57116151", "message": "move delegate setup into property", "committedDate": "2020-11-25T17:53:14Z", "type": "commit"}, {"oid": "0a25fff90b4a40ba625957a2c1ef274d6243cc23", "url": "https://github.com/ionic-team/capacitor/commit/0a25fff90b4a40ba625957a2c1ef274d6243cc23", "message": "renames", "committedDate": "2020-11-25T18:01:31Z", "type": "commit"}, {"oid": "b33f55678bb1583a919c64153c6bd669026713ed", "url": "https://github.com/ionic-team/capacitor/commit/b33f55678bb1583a919c64153c6bd669026713ed", "message": "Merge branch 'main' into notification-delegate", "committedDate": "2020-11-25T20:16:48Z", "type": "commit"}]}