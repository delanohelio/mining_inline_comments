{"pr_number": 3599, "pr_title": "feat(cli): add `capacitor run` command", "pr_createdAt": "2020-09-22T22:56:51Z", "pr_url": "https://github.com/ionic-team/capacitor/pull/3599", "timeline": [{"oid": "8c3d3e0965e7d84ee1829338c180a801233e43ff", "url": "https://github.com/ionic-team/capacitor/commit/8c3d3e0965e7d84ee1829338c180a801233e43ff", "message": "strip params from check functions", "committedDate": "2020-09-09T22:50:21Z", "type": "commit"}, {"oid": "2762d7fb5303665f1799e83b6cc8eee04839bfec", "url": "https://github.com/ionic-team/capacitor/commit/2762d7fb5303665f1799e83b6cc8eee04839bfec", "message": "resolveNode doesn't need config", "committedDate": "2020-09-09T23:19:29Z", "type": "commit"}, {"oid": "ca1510d5397d59810d67564688565b906801decf", "url": "https://github.com/ionic-team/capacitor/commit/ca1510d5397d59810d67564688565b906801decf", "message": "remove public config methods and unused properties", "committedDate": "2020-09-10T00:32:43Z", "type": "commit"}, {"oid": "172f594ad35af59716ffaede3991323527596abe", "url": "https://github.com/ionic-team/capacitor/commit/172f594ad35af59716ffaede3991323527596abe", "message": "config refactor", "committedDate": "2020-09-10T01:26:59Z", "type": "commit"}, {"oid": "5381669fcec5ab87cc3106f6f8b125fa9c73919e", "url": "https://github.com/ionic-team/capacitor/commit/5381669fcec5ab87cc3106f6f8b125fa9c73919e", "message": "readonly", "committedDate": "2020-09-10T01:41:23Z", "type": "commit"}, {"oid": "8665579235e43bd4ba0cacaf8a58fc3d140fe1fd", "url": "https://github.com/ionic-team/capacitor/commit/8665579235e43bd4ba0cacaf8a58fc3d140fe1fd", "message": "bug fixes", "committedDate": "2020-09-10T01:52:17Z", "type": "commit"}, {"oid": "b2c4f92a58850736d4c74ddfe789da02ce805fb6", "url": "https://github.com/ionic-team/capacitor/commit/b2c4f92a58850736d4c74ddfe789da02ce805fb6", "message": "fix tests", "committedDate": "2020-09-10T02:11:27Z", "type": "commit"}, {"oid": "5b0f13af57b7ddd9d5347cf46edd88bd29525b4f", "url": "https://github.com/ionic-team/capacitor/commit/5b0f13af57b7ddd9d5347cf46edd88bd29525b4f", "message": "be more clear about resolving package.json", "committedDate": "2020-09-10T16:10:54Z", "type": "commit"}, {"oid": "ff836cba2144c86864e01e8ee87b36771653ea4b", "url": "https://github.com/ionic-team/capacitor/commit/ff836cba2144c86864e01e8ee87b36771653ea4b", "message": "Merge branch 'main' into config-refactor\n\nConflicts:\n\tcli/src/android/add.ts\n\tcli/src/android/common.ts\n\tcli/src/android/doctor.ts\n\tcli/src/android/open.ts\n\tcli/src/android/update.ts\n\tcli/src/common.ts\n\tcli/src/config.ts\n\tcli/src/cordova.ts\n\tcli/src/index.ts\n\tcli/src/ios/add.ts\n\tcli/src/ios/common.ts\n\tcli/src/ios/doctor.ts\n\tcli/src/ios/open.ts\n\tcli/src/ios/update.ts\n\tcli/src/plugin.ts\n\tcli/src/tasks/add.ts\n\tcli/src/tasks/copy.ts\n\tcli/src/tasks/create.ts\n\tcli/src/tasks/doctor.ts\n\tcli/src/tasks/init.ts\n\tcli/src/tasks/list.ts\n\tcli/src/tasks/new-plugin.ts\n\tcli/src/tasks/open.ts\n\tcli/src/tasks/serve.ts\n\tcli/src/tasks/sync.ts\n\tcli/src/tasks/update.ts\n\tcli/src/web/copy.ts\n\tcli/test/util.ts", "committedDate": "2020-09-14T22:07:18Z", "type": "commit"}, {"oid": "a9ee8be99c0d0e2bb19030da505b438573f79fd9", "url": "https://github.com/ionic-team/capacitor/commit/a9ee8be99c0d0e2bb19030da505b438573f79fd9", "message": "Merge branch 'main' into config-refactor", "committedDate": "2020-09-16T00:14:51Z", "type": "commit"}, {"oid": "c04c10f9134a57a11d736bb27ac075b8622d08b7", "url": "https://github.com/ionic-team/capacitor/commit/c04c10f9134a57a11d736bb27ac075b8622d08b7", "message": "refactor platformDir", "committedDate": "2020-09-16T20:21:48Z", "type": "commit"}, {"oid": "b6f3407e02c54dd1246b2fc8d2efc0de9b0ab6d3", "url": "https://github.com/ionic-team/capacitor/commit/b6f3407e02c54dd1246b2fc8d2efc0de9b0ab6d3", "message": "implement ios.path and android.path", "committedDate": "2020-09-16T20:45:46Z", "type": "commit"}, {"oid": "16ce02cae9808249907030745c9aefc740db34ec", "url": "https://github.com/ionic-team/capacitor/commit/16ce02cae9808249907030745c9aefc740db34ec", "message": "Merge branch 'main' into config-refactor", "committedDate": "2020-09-17T21:46:06Z", "type": "commit"}, {"oid": "151a41f3b06e32c969fe5f54b48426f2432edad9", "url": "https://github.com/ionic-team/capacitor/commit/151a41f3b06e32c969fe5f54b48426f2432edad9", "message": "Update cli/src/config.ts\n\nCo-authored-by: jcesarmobile <jcesarmobile@gmail.com>", "committedDate": "2020-09-18T16:40:29Z", "type": "commit"}, {"oid": "be4e89d5a07bb530de54878a893ffaf403d73636", "url": "https://github.com/ionic-team/capacitor/commit/be4e89d5a07bb530de54878a893ffaf403d73636", "message": "show plugin config last when adding it", "committedDate": "2020-09-18T17:25:08Z", "type": "commit"}, {"oid": "8cf2ac8f3e6b48cb6682e4770860a45e4478c089", "url": "https://github.com/ionic-team/capacitor/commit/8cf2ac8f3e6b48cb6682e4770860a45e4478c089", "message": "Merge branch 'main' into config-refactor", "committedDate": "2020-09-18T17:27:57Z", "type": "commit"}, {"oid": "74b85beb2c1d207cf6e784aa56cdf7f82ed7e85a", "url": "https://github.com/ionic-team/capacitor/commit/74b85beb2c1d207cf6e784aa56cdf7f82ed7e85a", "message": "write plugin last (attempt 2 \ud83d\ude02)", "committedDate": "2020-09-21T18:34:30Z", "type": "commit"}, {"oid": "146907dcfef9236a0c4643f381c24c4336198797", "url": "https://github.com/ionic-team/capacitor/commit/146907dcfef9236a0c4643f381c24c4336198797", "message": "FS refactor", "committedDate": "2020-09-21T23:21:55Z", "type": "commit"}, {"oid": "f0e4d0956ab17927a6d7e65fd5659addd172e9ee", "url": "https://github.com/ionic-team/capacitor/commit/f0e4d0956ab17927a6d7e65fd5659addd172e9ee", "message": "wip", "committedDate": "2020-09-22T16:26:27Z", "type": "commit"}, {"oid": "2b2242c0d1633729ba7e893cef01e2c0b76419e2", "url": "https://github.com/ionic-team/capacitor/commit/2b2242c0d1633729ba7e893cef01e2c0b76419e2", "message": "Merge remote-tracking branch 'origin/main' into feat-2294\n\nConflicts:\n\tcli/src/android/update.ts\n\tcli/src/common.ts\n\tcli/src/config.ts\n\tcli/src/definitions.ts\n\tcli/src/ios/common.ts\n\tcli/src/tasks/add.ts", "committedDate": "2020-09-22T16:35:03Z", "type": "commit"}, {"oid": "9cf740de6fa35ab3b1a2f3bab48afd0996279cfc", "url": "https://github.com/ionic-team/capacitor/commit/9cf740de6fa35ab3b1a2f3bab48afd0996279cfc", "message": "Merge branch 'feat-2294' into run-command\n\nConflicts:\n\tcli/src/android/common.ts\n\tcli/src/android/doctor.ts\n\tcli/src/common.ts\n\tcli/src/config.ts\n\tcli/src/ios/common.ts", "committedDate": "2020-09-22T21:19:20Z", "type": "commit"}, {"oid": "9801331d24e5ab65004c2ef3ac39e1939d0a7c06", "url": "https://github.com/ionic-team/capacitor/commit/9801331d24e5ab65004c2ef3ac39e1939d0a7c06", "message": "refactor runCommand to use subprocess lib", "committedDate": "2020-09-22T21:48:26Z", "type": "commit"}, {"oid": "953e91b4da9c270b9cb1fe589188ef72c724f888", "url": "https://github.com/ionic-team/capacitor/commit/953e91b4da9c270b9cb1fe589188ef72c724f888", "message": "poc for android", "committedDate": "2020-09-22T22:48:09Z", "type": "commit"}, {"oid": "c7865fca69dc61c4a608fbf80dfe4dcd6b339442", "url": "https://github.com/ionic-team/capacitor/commit/c7865fca69dc61c4a608fbf80dfe4dcd6b339442", "message": "test fix", "committedDate": "2020-09-22T22:50:41Z", "type": "commit"}, {"oid": "6d1f242f483d0e830416267d05876409e16225d9", "url": "https://github.com/ionic-team/capacitor/commit/6d1f242f483d0e830416267d05876409e16225d9", "message": "Merge remote-tracking branch 'origin/main' into run-command\n\nConflicts:\n\tcli/src/android/common.ts\n\tcli/src/android/doctor.ts\n\tcli/src/common.ts\n\tcli/src/ios/common.ts\n\tcli/src/ios/update.ts", "committedDate": "2020-09-23T23:47:30Z", "type": "commit"}, {"oid": "9eeb26abfa75e64b3858ba6c377a59bfb41ff81c", "url": "https://github.com/ionic-team/capacitor/commit/9eeb26abfa75e64b3858ba6c377a59bfb41ff81c", "message": "target and list options", "committedDate": "2020-09-28T22:21:56Z", "type": "commit"}, {"oid": "b35810297148cc368c83bf40717bcfa102d693db", "url": "https://github.com/ionic-team/capacitor/commit/b35810297148cc368c83bf40717bcfa102d693db", "message": "debug messages", "committedDate": "2020-09-28T23:17:21Z", "type": "commit"}, {"oid": "b189dc2df27ddedad9141fe1a926f138863b90e0", "url": "https://github.com/ionic-team/capacitor/commit/b189dc2df27ddedad9141fe1a926f138863b90e0", "message": "ignore DerivedData where builds are placed", "committedDate": "2020-09-28T23:20:54Z", "type": "commit"}, {"oid": "a4815bc1440825fe987f28a74dc3af57c6bb8866", "url": "https://github.com/ionic-team/capacitor/commit/a4815bc1440825fe987f28a74dc3af57c6bb8866", "message": "Merge branch 'main' into run-command\n\nConflicts:\n\tcli/src/common.ts\n\tcli/src/util/fs.ts", "committedDate": "2020-09-29T18:31:44Z", "type": "commit"}, {"oid": "4b276fe4fab5a3ac2145d57990cb16f2b96abe90", "url": "https://github.com/ionic-team/capacitor/commit/4b276fe4fab5a3ac2145d57990cb16f2b96abe90", "message": "native-run not installed error", "committedDate": "2020-09-29T22:20:16Z", "type": "commit"}, {"oid": "f8a8941e37f44ad1f9c2a628e65dd9c4e13fc10e", "url": "https://github.com/ionic-team/capacitor/commit/f8a8941e37f44ad1f9c2a628e65dd9c4e13fc10e", "message": "remove unused spinner option", "committedDate": "2020-09-29T22:27:25Z", "type": "commit"}, {"oid": "8ec1a27d6d355de8da22b587958a939f2cf231dd", "url": "https://github.com/ionic-team/capacitor/commit/8ec1a27d6d355de8da22b587958a939f2cf231dd", "message": "Merge branch 'main' into run-command", "committedDate": "2020-10-13T00:54:59Z", "type": "commit"}, {"oid": "7a67f8a166c7d64ebb3d5f2db3f0d7810c446081", "url": "https://github.com/ionic-team/capacitor/commit/7a67f8a166c7d64ebb3d5f2db3f0d7810c446081", "message": "fix lint", "committedDate": "2020-10-13T01:44:24Z", "type": "commit"}, {"oid": "470434975ecf482449322246add6ebd58c9d7f56", "url": "https://github.com/ionic-team/capacitor/commit/470434975ecf482449322246add6ebd58c9d7f56", "message": "Merge branch 'main' into run-command", "committedDate": "2020-10-14T13:33:13Z", "type": "commit"}, {"oid": "07ae6798edf35b57f727c7f807aca31a12b3c85d", "url": "https://github.com/ionic-team/capacitor/commit/07ae6798edf35b57f727c7f807aca31a12b3c85d", "message": "Merge branch 'main' into run-command", "committedDate": "2020-10-14T18:03:05Z", "type": "commit"}, {"oid": "e00cd79e75d7397ff2e272b3c7efb2759505798a", "url": "https://github.com/ionic-team/capacitor/commit/e00cd79e75d7397ff2e272b3c7efb2759505798a", "message": "Merge branch 'main' into run-command", "committedDate": "2020-10-15T16:43:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTY5MDg4NQ==", "url": "https://github.com/ionic-team/capacitor/pull/3599#discussion_r505690885", "bodyText": "would be good to give some insight about native-run, install from where? or how?", "author": "jcesarmobile", "createdAt": "2020-10-15T16:46:58Z", "path": "cli/src/common.ts", "diffHunk": "@@ -292,28 +288,62 @@ export async function runPlatformHook(\n   });\n }\n \n-export function runCommand(command: string): Promise<string> {\n-  return new Promise((resolve, reject) => {\n-    exec(command, (error, stdout, stderr) => {\n-      if (error) {\n-        reject(stdout + stderr);\n-      } else {\n-        resolve(stdout);\n-      }\n-    });\n-  });\n+export interface RunCommandOptions {\n+  cwd?: string;\n+}\n+\n+export async function runCommand(\n+  command: string,\n+  args: readonly string[],\n+  options: RunCommandOptions = {},\n+): Promise<string> {\n+  const p = new Subprocess(command, args, options);\n+\n+  try {\n+    return await p.output();\n+  } catch (e) {\n+    if (e instanceof SubprocessError) {\n+      // old behavior of just throwing the stdout/stderr strings\n+      throw e.output ? e.output : e.code;\n+    }\n+\n+    throw e;\n+  }\n+}\n+\n+export async function runNativeRun(\n+  args: readonly string[],\n+  options: RunCommandOptions = {},\n+): Promise<string> {\n+  try {\n+    return await runCommand('native-run', args, options);\n+  } catch (e) {\n+    if (e === ERROR_COMMAND_NOT_FOUND) {\n+      logFatal(\n+        `${c.input('native-run')} not found in PATH\\n` +\n+          `Are you sure ${c.strong('native-run')} is installed?`,", "originalCommit": "e00cd79e75d7397ff2e272b3c7efb2759505798a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4304e17e185585006c485974cf51d12ed6ef03c7", "url": "https://github.com/ionic-team/capacitor/commit/4304e17e185585006c485974cf51d12ed6ef03c7", "message": "show example install command", "committedDate": "2020-10-15T18:13:53Z", "type": "commit"}, {"oid": "0b110df1d8793eeca45baaaae5084171f0385c9d", "url": "https://github.com/ionic-team/capacitor/commit/0b110df1d8793eeca45baaaae5084171f0385c9d", "message": "add native-run as dependency of CLI", "committedDate": "2020-10-15T19:03:16Z", "type": "commit"}, {"oid": "38bdbca08ba19e1df1c87780d02013e5d1be809c", "url": "https://github.com/ionic-team/capacitor/commit/38bdbca08ba19e1df1c87780d02013e5d1be809c", "message": "Merge branch 'main' into run-command", "committedDate": "2020-10-16T11:20:58Z", "type": "commit"}]}