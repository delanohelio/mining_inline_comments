{"pr_number": 3999, "pr_title": "feat(cli): create TS configuration files in `init`", "pr_createdAt": "2020-12-29T02:33:05Z", "pr_url": "https://github.com/ionic-team/capacitor/pull/3999", "timeline": [{"oid": "c795b8c19267e8a88b0caba196a8f84ec3a608d5", "url": "https://github.com/ionic-team/capacitor/commit/c795b8c19267e8a88b0caba196a8f84ec3a608d5", "message": "feat(cli): create TS configuration files in `init`", "committedDate": "2020-12-29T02:32:08Z", "type": "commit"}, {"oid": "029f04bb377b0d5b207cd144b47115cd439bdf7e", "url": "https://github.com/ionic-team/capacitor/commit/029f04bb377b0d5b207cd144b47115cd439bdf7e", "message": "only use TS if typescript is installed", "committedDate": "2020-12-29T02:40:40Z", "type": "commit"}, {"oid": "768d86299bcb2f0a6611cd87143db818d04016fe", "url": "https://github.com/ionic-team/capacitor/commit/768d86299bcb2f0a6611cd87143db818d04016fe", "message": "add back old default", "committedDate": "2020-12-29T02:41:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzUwNzkzOA==", "url": "https://github.com/ionic-team/capacitor/pull/3999#discussion_r553507938", "bodyText": "Not related to this change since you just moved it, but, since platforms are not automatically installed anymore, this commands will end up in errors, so maybe we should remove it or reword?", "author": "jcesarmobile", "createdAt": "2021-01-07T18:32:04Z", "path": "cli/src/tasks/init.ts", "diffHunk": "@@ -132,18 +124,68 @@ async function getWebDir(config: Config, webDir?: string) {\n   return webDir;\n }\n \n+async function runMergeConfig(\n+  config: Config,\n+  extConfig: ExternalConfig,\n+  type: 'json' | 'ts',\n+) {\n+  const configDirectory = dirname(config.app.extConfigFilePath);\n+  const newConfigPath = resolve(\n+    configDirectory,\n+    type === 'ts' ? CONFIG_FILE_NAME_TS : CONFIG_FILE_NAME_JSON,\n+  );\n+\n+  await runTask(\n+    `Creating ${c.strong(basename(newConfigPath))} in ${c.input(\n+      config.app.rootDir,\n+    )}`,\n+    async () => {\n+      await mergeConfig(config, extConfig, newConfigPath);\n+    },\n+  );\n+\n+  if (\n+    newConfigPath !== config.app.extConfigFilePath &&\n+    (await pathExists(config.app.extConfigFilePath))\n+  ) {\n+    const answers = await logPrompt(\n+      `${c.strong(`Remove old ${config.app.extConfigName} file?`)}\\n` +\n+        `The path to your configuration file changed. Would you like to delete the old configuration file?`,\n+      {\n+        type: 'confirm',\n+        name: 'confirm',\n+        message: `Delete ${c.strong(config.app.extConfigName)}?`,\n+        initial: true,\n+      },\n+    );\n+\n+    if (answers.confirm) {\n+      await unlink(config.app.extConfigFilePath);\n+    }\n+  }\n+\n+  printNextSteps(basename(newConfigPath));\n+}\n+\n async function mergeConfig(\n   config: Config,\n   extConfig: ExternalConfig,\n+  newConfigPath: string,\n ): Promise<void> {\n   const oldConfig = { ...config.app.extConfig };\n+  const newConfig = { ...oldConfig, ...extConfig };\n \n-  await writeJSON(\n-    config.app.extConfigFilePath,\n-    {\n-      ...oldConfig,\n-      ...extConfig,\n-    },\n-    { spaces: 2 },\n+  await writeConfig(newConfig, newConfigPath);\n+}\n+\n+function printNextSteps(newConfigName: string) {\n+  logSuccess(`${c.strong(newConfigName)} created!`);\n+  output.write(\n+    `\\nAdd platforms using ${c.input('npx cap add')}:\\n` +\n+      `  ${c.input('npx cap add android')}\\n` +\n+      `  ${c.input('npx cap add ios')}\\n\\n` +", "originalCommit": "768d86299bcb2f0a6611cd87143db818d04016fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzUyNDMyNw==", "url": "https://github.com/ionic-team/capacitor/pull/3999#discussion_r553524327", "bodyText": "Sure, I think we should remove it and keep the link to the workflow docs below. We can add a section about adding platforms there.", "author": "imhoffd", "createdAt": "2021-01-07T19:04:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzUwNzkzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzU2MTA2NQ==", "url": "https://github.com/ionic-team/capacitor/pull/3999#discussion_r553561065", "bodyText": "#4030", "author": "imhoffd", "createdAt": "2021-01-07T20:08:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzUwNzkzOA=="}], "type": "inlineReview"}, {"oid": "f223f9e26609d9afbab00185b11b27897f710698", "url": "https://github.com/ionic-team/capacitor/commit/f223f9e26609d9afbab00185b11b27897f710698", "message": "Merge branch 'main' into init-ts-file", "committedDate": "2021-01-07T20:41:43Z", "type": "commit"}, {"oid": "871b710f6e90e95fc1aa1a61b2c73d1cddb46f51", "url": "https://github.com/ionic-team/capacitor/commit/871b710f6e90e95fc1aa1a61b2c73d1cddb46f51", "message": "Merge branch 'main' into init-ts-file", "committedDate": "2021-01-08T18:05:18Z", "type": "commit"}, {"oid": "e83fafaf62e22ca37f4146e338ad5b49837eeffc", "url": "https://github.com/ionic-team/capacitor/commit/e83fafaf62e22ca37f4146e338ad5b49837eeffc", "message": "Merge branch 'main' into init-ts-file", "committedDate": "2021-01-08T18:56:06Z", "type": "commit"}, {"oid": "ddd676ef58ba9123766e6c81cd4f58c62e67056f", "url": "https://github.com/ionic-team/capacitor/commit/ddd676ef58ba9123766e6c81cd4f58c62e67056f", "message": "prefer 'export default'", "committedDate": "2021-01-08T18:59:07Z", "type": "commit"}, {"oid": "afc27af72acf8acaffdfe9fd1679711ed28d25d4", "url": "https://github.com/ionic-team/capacitor/commit/afc27af72acf8acaffdfe9fd1679711ed28d25d4", "message": "remove unused prompt", "committedDate": "2021-01-08T19:03:44Z", "type": "commit"}, {"oid": "158310d49ada88ba108bb1b8adf8206746cc15a2", "url": "https://github.com/ionic-team/capacitor/commit/158310d49ada88ba108bb1b8adf8206746cc15a2", "message": "Merge branch 'main' into init-ts-file", "committedDate": "2021-01-11T16:53:50Z", "type": "commit"}]}