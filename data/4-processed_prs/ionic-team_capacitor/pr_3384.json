{"pr_number": 3384, "pr_title": "chore(iOS): Cleaning up types for JavaScript <-> Native bridging", "pr_createdAt": "2020-08-04T15:36:41Z", "pr_url": "https://github.com/ionic-team/capacitor/pull/3384", "timeline": [{"oid": "dfc4306d48d76608a84dc6882875665b726a4f78", "url": "https://github.com/ionic-team/capacitor/commit/dfc4306d48d76608a84dc6882875665b726a4f78", "message": "Minor cleanup to eliminate compiler warnings in Capacitor Cordova project", "committedDate": "2020-10-15T14:45:31Z", "type": "commit"}, {"oid": "1df74d6c6a3e4409b27690e3a2d0bdb3e22728b9", "url": "https://github.com/ionic-team/capacitor/commit/1df74d6c6a3e4409b27690e3a2d0bdb3e22728b9", "message": "Support direct building of the capacitor framework. Added modulemaps, updated umbrella headers, updated project settings, removed Capacitor project's Podfile. Updated respective podspecs to match.", "committedDate": "2020-10-15T14:45:54Z", "type": "commit"}, {"oid": "413af81a62174710655db6e29c0465087da10bb8", "url": "https://github.com/ionic-team/capacitor/commit/413af81a62174710655db6e29c0465087da10bb8", "message": "Removing unneeded pod install step so build will work.", "committedDate": "2020-10-15T14:47:02Z", "type": "commit"}, {"oid": "5338f02c2baf466949de285cf3553a942d94276f", "url": "https://github.com/ionic-team/capacitor/commit/5338f02c2baf466949de285cf3553a942d94276f", "message": "Cleanup from cherry-picking commits", "committedDate": "2020-10-15T14:52:06Z", "type": "commit"}, {"oid": "8a40a6ab6d1511187b58b0302a9021f7e1e02753", "url": "https://github.com/ionic-team/capacitor/commit/8a40a6ab6d1511187b58b0302a9021f7e1e02753", "message": "Deleted exclusion of removed file.", "committedDate": "2020-10-15T15:28:18Z", "type": "commit"}, {"oid": "6b0798e22ce689ffee1fa83b5ad56a58e0e6e3dd", "url": "https://github.com/ionic-team/capacitor/commit/6b0798e22ce689ffee1fa83b5ad56a58e0e6e3dd", "message": "Defining new JS types and supporting protocols.", "committedDate": "2020-10-15T15:33:08Z", "type": "commit"}, {"oid": "005ccb8282e989b2f86432eb6007076015c33e92", "url": "https://github.com/ionic-team/capacitor/commit/005ccb8282e989b2f86432eb6007076015c33e92", "message": "Updating CAPPluginCall to use new types.", "committedDate": "2020-10-15T15:33:13Z", "type": "commit"}, {"oid": "216bb707fb979ad6d7768d1e54f400a62d0c682c", "url": "https://github.com/ionic-team/capacitor/commit/216bb707fb979ad6d7768d1e54f400a62d0c682c", "message": "Updating existing code to use new types and accessors.", "committedDate": "2020-10-15T15:34:27Z", "type": "commit"}, {"oid": "5274e81e23f70098d18beb60aa6d80ad25c2310b", "url": "https://github.com/ionic-team/capacitor/commit/5274e81e23f70098d18beb60aa6d80ad25c2310b", "message": "Swiftlint changes", "committedDate": "2020-10-15T15:34:42Z", "type": "commit"}, {"oid": "1597b404fb22ccb58626f4772b8fe17d77efffaf", "url": "https://github.com/ionic-team/capacitor/commit/1597b404fb22ccb58626f4772b8fe17d77efffaf", "message": "Adding excluded header, file references in project.", "committedDate": "2020-10-15T15:47:10Z", "type": "commit"}, {"oid": "1597b404fb22ccb58626f4772b8fe17d77efffaf", "url": "https://github.com/ionic-team/capacitor/commit/1597b404fb22ccb58626f4772b8fe17d77efffaf", "message": "Adding excluded header, file references in project.", "committedDate": "2020-10-15T15:47:10Z", "type": "forcePushed"}, {"oid": "2d69c8e3d488bb6ec35469e5150b007f929c6924", "url": "https://github.com/ionic-team/capacitor/commit/2d69c8e3d488bb6ec35469e5150b007f929c6924", "message": "Adding explicit type coercion to ensure conformance to expected protocol.", "committedDate": "2020-10-15T21:22:22Z", "type": "commit"}, {"oid": "293d17cee88c8fd56fd9732df8c106d5dc093e23", "url": "https://github.com/ionic-team/capacitor/commit/293d17cee88c8fd56fd9732df8c106d5dc093e23", "message": "Swiftlint format", "committedDate": "2020-10-15T21:24:07Z", "type": "commit"}, {"oid": "d15ab9fdb5b7b71578bfa0e0b10eea4a7324de54", "url": "https://github.com/ionic-team/capacitor/commit/d15ab9fdb5b7b71578bfa0e0b10eea4a7324de54", "message": "Merge branch 'main' into ios-build", "committedDate": "2020-10-16T16:48:25Z", "type": "commit"}, {"oid": "3ecc74f1ab45b45977031c8021696626cadcecd3", "url": "https://github.com/ionic-team/capacitor/commit/3ecc74f1ab45b45977031c8021696626cadcecd3", "message": "Merge branch 'main' into jstypes", "committedDate": "2020-10-16T16:48:33Z", "type": "commit"}, {"oid": "28f1eed110f3795cd47e00efea7bf2e02074615e", "url": "https://github.com/ionic-team/capacitor/commit/28f1eed110f3795cd47e00efea7bf2e02074615e", "message": "Reworked CAPLog to prevent race condition between it and CAPConfig.", "committedDate": "2020-10-16T19:34:26Z", "type": "commit"}, {"oid": "3d92dd0fc2825ec92638d1b481f832856d5a9f24", "url": "https://github.com/ionic-team/capacitor/commit/3d92dd0fc2825ec92638d1b481f832856d5a9f24", "message": "Adding empty application shell to host framework for unit tests.", "committedDate": "2020-10-16T19:42:11Z", "type": "commit"}, {"oid": "f3581e0f30ec9f0c510bc562b494f4273fb4cec4", "url": "https://github.com/ionic-team/capacitor/commit/f3581e0f30ec9f0c510bc562b494f4273fb4cec4", "message": "Merge branch 'ios-build' into jstypes", "committedDate": "2020-10-16T19:57:28Z", "type": "commit"}, {"oid": "2bbcb563ecae83f6c256f4a7df69626d34e21074", "url": "https://github.com/ionic-team/capacitor/commit/2bbcb563ecae83f6c256f4a7df69626d34e21074", "message": "Adding unit tests for the type bridging.", "committedDate": "2020-10-19T18:44:04Z", "type": "commit"}, {"oid": "223b683d2f496e1f50bc25dad836e313d66ecacd", "url": "https://github.com/ionic-team/capacitor/commit/223b683d2f496e1f50bc25dad836e313d66ecacd", "message": "Merge branch 'main' into jstypes", "committedDate": "2020-10-19T18:47:23Z", "type": "commit"}, {"oid": "84cb33aa7534bb7603fd4a5f6bcffd62b033084c", "url": "https://github.com/ionic-team/capacitor/commit/84cb33aa7534bb7603fd4a5f6bcffd62b033084c", "message": "Removing deleted file.", "committedDate": "2020-10-19T18:48:26Z", "type": "commit"}, {"oid": "32bfa11ba4b514233861bed13b48b42e5f2ae40f", "url": "https://github.com/ionic-team/capacitor/commit/32bfa11ba4b514233861bed13b48b42e5f2ae40f", "message": "Adding swift lint config file to exclude tests and host app from linting rules", "committedDate": "2020-10-19T19:14:06Z", "type": "commit"}, {"oid": "6598cf6c557bc045be2e6d16a32c19b445b93732", "url": "https://github.com/ionic-team/capacitor/commit/6598cf6c557bc045be2e6d16a32c19b445b93732", "message": "Merge branch 'main' into ios-build", "committedDate": "2020-10-19T21:15:36Z", "type": "commit"}, {"oid": "a0e5e24c968a906fa8fff5280d696a8749419e8f", "url": "https://github.com/ionic-team/capacitor/commit/a0e5e24c968a906fa8fff5280d696a8749419e8f", "message": "Removing reference to deleted file.", "committedDate": "2020-10-19T21:28:37Z", "type": "commit"}, {"oid": "d6d1955bb3c9795848b15870b188d0684f4140fd", "url": "https://github.com/ionic-team/capacitor/commit/d6d1955bb3c9795848b15870b188d0684f4140fd", "message": "Merge branch 'ios-build' into jstypes", "committedDate": "2020-10-19T21:28:57Z", "type": "commit"}, {"oid": "7fb3deb7791a894bb42fa098648dc39f954abfe6", "url": "https://github.com/ionic-team/capacitor/commit/7fb3deb7791a894bb42fa098648dc39f954abfe6", "message": "Merge branch 'main' into ios-build", "committedDate": "2020-10-19T23:00:03Z", "type": "commit"}, {"oid": "4495117f5ce440857491b57debf8c3d2434298be", "url": "https://github.com/ionic-team/capacitor/commit/4495117f5ce440857491b57debf8c3d2434298be", "message": "Merge branch 'main' into ios-build", "committedDate": "2020-10-20T18:24:10Z", "type": "commit"}, {"oid": "36ecfcef7086395b0afa43579b80e3e17fd256ef", "url": "https://github.com/ionic-team/capacitor/commit/36ecfcef7086395b0afa43579b80e3e17fd256ef", "message": "Merge branch 'ios-build' into jstypes", "committedDate": "2020-10-20T18:26:58Z", "type": "commit"}, {"oid": "d44d62b3fe4cb1c55905f51369f8ca8c143e98ff", "url": "https://github.com/ionic-team/capacitor/commit/d44d62b3fe4cb1c55905f51369f8ca8c143e98ff", "message": "Merge branch 'main' into ios-build", "committedDate": "2020-10-21T10:13:38Z", "type": "commit"}, {"oid": "b9e996985c0c692bc4e10f27b5521a78dcda333c", "url": "https://github.com/ionic-team/capacitor/commit/b9e996985c0c692bc4e10f27b5521a78dcda333c", "message": "Removing deleted file reference.", "committedDate": "2020-10-21T17:16:30Z", "type": "commit"}, {"oid": "41151eb4a27f73a980e04964278fcf8af9a7415b", "url": "https://github.com/ionic-team/capacitor/commit/41151eb4a27f73a980e04964278fcf8af9a7415b", "message": "Merge branch 'ios-build' into jstypes", "committedDate": "2020-10-21T17:16:45Z", "type": "commit"}, {"oid": "fbad714be66e96428527c65f5320d3b62a52cc6b", "url": "https://github.com/ionic-team/capacitor/commit/fbad714be66e96428527c65f5320d3b62a52cc6b", "message": "Merge branch 'main' into jstypes", "committedDate": "2020-10-22T18:21:27Z", "type": "commit"}, {"oid": "91ffe8b891e6528935b78bef87aec9943e723659", "url": "https://github.com/ionic-team/capacitor/commit/91ffe8b891e6528935b78bef87aec9943e723659", "message": "Revert \"Reworked CAPLog to prevent race condition between it and CAPConfig.\"\n\nThis reverts commit 28f1eed110f3795cd47e00efea7bf2e02074615e.", "committedDate": "2020-10-22T18:53:50Z", "type": "commit"}, {"oid": "b72720a3fccfb22fd8c9d2cbd44424ff524208b9", "url": "https://github.com/ionic-team/capacitor/commit/b72720a3fccfb22fd8c9d2cbd44424ff524208b9", "message": "Deleting extraneous log statement in test.", "committedDate": "2020-10-22T18:57:16Z", "type": "commit"}, {"oid": "f12d1ee194ad971e8c4a017aa6e111d815fb81f3", "url": "https://github.com/ionic-team/capacitor/commit/f12d1ee194ad971e8c4a017aa6e111d815fb81f3", "message": "Merge branch 'main' into jstypes", "committedDate": "2020-10-23T11:34:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAwOTc2NA==", "url": "https://github.com/ionic-team/capacitor/pull/3384#discussion_r511009764", "bodyText": "Can something like this be used in this 3 fors instead of the guards?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    for type in actionTypes {\n          \n          \n            \n                        guard let type = type as? JSObject else {\n          \n          \n            \n                          continue\n          \n          \n            \n                        }\n          \n          \n            \n                    for case let type as JSObject in actionTypes {", "author": "jcesarmobile", "createdAt": "2020-10-23T16:44:04Z", "path": "ios/Capacitor/Capacitor/Plugins/LocalNotifications.swift", "diffHunk": "@@ -338,6 +338,9 @@ public class CAPLocalNotificationsPlugin: CAPPlugin {\n \n         createdCategories.append(generalCategory)\n         for type in actionTypes {\n+            guard let type = type as? JSObject else {\n+              continue\n+            }", "originalCommit": "f12d1ee194ad971e8c4a017aa6e111d815fb81f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAzODA3MQ==", "url": "https://github.com/ionic-team/capacitor/pull/3384#discussion_r511038071", "bodyText": "That would work. I am little concerned, though, that that kind of syntax might be too esoteric just to save a couple of lines. It could be hard for someone less familiar with Swift to understand if they looked at the core plugins for examples of how to write a plugin.", "author": "ikeith", "createdAt": "2020-10-23T17:38:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAwOTc2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA0NzM4OQ==", "url": "https://github.com/ionic-team/capacitor/pull/3384#discussion_r511047389", "bodyText": "I didn't propose it for saving lines, but because I find the guard with continue confusing.\nCould be possible to indicate in some way that the whole JSArray contain elements of the same type so don't need to cast them inside the for?\nIn the change I proposed (guard let types = call.getArray(\"types\", JSObject.self)), we are saying the elements are JSObject, but we still need to cast them when we go over the Array.", "author": "jcesarmobile", "createdAt": "2020-10-23T17:54:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAwOTc2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA4NTcxOA==", "url": "https://github.com/ionic-team/capacitor/pull/3384#discussion_r511085718", "bodyText": "Oh, I see. Your suggested change is functionally identical so I assumed it was just to be more concise. (I think a for loop with an inner guard is easier to understand but obviously that's subjective) I agree that bubbling the more exact types through the code is better but I was trying to avoid too many changes, especially since I knew the plugins were being split out and I didn't expect this change to get merged quickly. I will update the code to avoid casting types up to a more generic one.", "author": "ikeith", "createdAt": "2020-10-23T18:59:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAwOTc2NA=="}], "type": "inlineReview"}, {"oid": "847e8ee6f6e8366520d85e7546825de3436700f2", "url": "https://github.com/ionic-team/capacitor/commit/847e8ee6f6e8366520d85e7546825de3436700f2", "message": "Cleaning up type handling in LocalNotifications plugin.", "committedDate": "2020-10-23T22:02:09Z", "type": "commit"}, {"oid": "3ff222de8fbb5cf221ca76c20a8deca8a5b52a54", "url": "https://github.com/ionic-team/capacitor/commit/3ff222de8fbb5cf221ca76c20a8deca8a5b52a54", "message": "Merge branch 'main' into jstypes", "committedDate": "2020-10-26T19:20:07Z", "type": "commit"}]}