{"pr_number": 2486, "pr_title": "GH-2485 fix failing test in RDFCollections", "pr_createdAt": "2020-09-05T00:54:31Z", "pr_url": "https://github.com/eclipse/rdf4j/pull/2486", "timeline": [{"oid": "a37f3b1324a3b4e2e40566006b1a24bc4e0fd7e6", "url": "https://github.com/eclipse/rdf4j/commit/a37f3b1324a3b4e2e40566006b1a24bc4e0fd7e6", "message": "GH-2485 downgrade guava testlib", "committedDate": "2020-09-05T00:53:06Z", "type": "commit"}, {"oid": "d90bde21d9d8d4e4c004294e73af29a12c4b940a", "url": "https://github.com/eclipse/rdf4j/commit/d90bde21d9d8d4e4c004294e73af29a12c4b940a", "message": "GH-2485 fully downgrade guava", "committedDate": "2020-09-05T01:02:34Z", "type": "commit"}, {"oid": "ab11590b6e8150c06349e0887e4928bec90dacb5", "url": "https://github.com/eclipse/rdf4j/commit/ab11590b6e8150c06349e0887e4928bec90dacb5", "message": "Revert \"GH-2485 fully downgrade guava\"\n\nThis reverts commit d90bde21d9d8d4e4c004294e73af29a12c4b940a.", "committedDate": "2020-09-05T01:15:41Z", "type": "commit"}, {"oid": "29fb2a14b6c80259ab26bfcfcddf40f610e81529", "url": "https://github.com/eclipse/rdf4j/commit/29fb2a14b6c80259ab26bfcfcddf40f610e81529", "message": "Revert \"GH-2485 downgrade guava testlib\"\n\nThis reverts commit a37f3b1324a3b4e2e40566006b1a24bc4e0fd7e6.", "committedDate": "2020-09-05T01:15:56Z", "type": "commit"}, {"oid": "dcc28851f6821e21c51376e3329ef468e6b1cc40", "url": "https://github.com/eclipse/rdf4j/commit/dcc28851f6821e21c51376e3329ef468e6b1cc40", "message": "GH-2485 split out test cases for non-wellformed collections", "committedDate": "2020-09-05T01:37:53Z", "type": "commit"}, {"oid": "2e60210e212e3c83f5a434cbe0286e85c177f84d", "url": "https://github.com/eclipse/rdf4j/commit/2e60210e212e3c83f5a434cbe0286e85c177f84d", "message": "GH-2485 run 1,000 times to be sure", "committedDate": "2020-09-05T04:09:11Z", "type": "commit"}, {"oid": "d2e031b968b08a5acb0b3065c94f7684b448fbc7", "url": "https://github.com/eclipse/rdf4j/commit/d2e031b968b08a5acb0b3065c94f7684b448fbc7", "message": "Revert \"GH-2485 run 1,000 times to be sure\"\n\nThis reverts commit 2e60210e212e3c83f5a434cbe0286e85c177f84d.", "committedDate": "2020-09-05T04:10:29Z", "type": "commit"}, {"oid": "31b60d3707cbe75cb413b16d2476e2aafdbc97a5", "url": "https://github.com/eclipse/rdf4j/commit/31b60d3707cbe75cb413b16d2476e2aafdbc97a5", "message": "GH-2485 this should reproduce the issue\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-09-06T10:02:03Z", "type": "commit"}, {"oid": "c8c624faf00bed7f10abeed6321ab08026e15634", "url": "https://github.com/eclipse/rdf4j/commit/c8c624faf00bed7f10abeed6321ab08026e15634", "message": "GH-2485 replace existing rdf:rest relation instead of just adding\n\n- test for cycle detection should make sure collection is otherwise wellformed", "committedDate": "2020-09-07T00:14:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMwNjA4NQ==", "url": "https://github.com/eclipse/rdf4j/pull/2486#discussion_r484306085", "bodyText": "Could you add the comment: // supply incorrect head node\nMakes the test easier to read.", "author": "hmottestad", "createdAt": "2020-09-07T09:21:49Z", "path": "core/model/src/test/java/org/eclipse/rdf4j/model/util/RDFCollectionsTest.java", "diffHunk": "@@ -71,35 +70,33 @@ public void testConversionRoundtrip() {\n \n \t}\n \n-\t@Test\n-\tpublic void testNonWellformedCollection() {\n+\t@Test(expected = ModelException.class)\n+\tpublic void testNonWellformedCollection_MissingTerminator() {\n \t\tResource head = vf.createBNode();\n \t\tModel m = RDFCollections.asRDF(values, head, new TreeModel());\n \t\tm.remove(null, RDF.REST, RDF.NIL);\n-\t\ttry {\n-\t\t\tRDFCollections.asValues(m, head, new ArrayList<>());\n-\t\t\tfail(\"collection missing terminator should result in error\");\n-\t\t} catch (ModelException e) {\n-\t\t\t// fall through, expected\n-\t\t}\n-\n-\t\tm = RDFCollections.asRDF(values, head, new TreeModel());\n+\t\tRDFCollections.asValues(m, head, new ArrayList<>());\n+\t}\n+\n+\t@Test(expected = ModelException.class)\n+\tpublic void testNonWellformedCollection_Cycle() {\n+\t\tResource head = vf.createBNode(\"z\");\n+\t\tModel m = RDFCollections.asRDF(values, head, new TreeModel());\n+\n+\t\t// Replace rdf:rest relation for head node with one pointing to itself.\n+\t\t// This introduces a cycle in an otherwise well-formed collection.\n+\t\tm.remove(head, RDF.REST, null);\n \t\tm.add(head, RDF.REST, head);\n \n-\t\ttry {\n-\t\t\tRDFCollections.asValues(m, head, new ArrayList<>());\n-\t\t\tfail(\"collection with cycle should result in error\");\n-\t\t} catch (ModelException e) {\n-\t\t\t// fall through, expected\n-\t\t}\n-\n-\t\t// supply incorrect head node\n-\t\ttry {\n-\t\t\tRDFCollections.asValues(m, vf.createBNode(), new ArrayList<>());\n-\t\t\tfail(\"resource that is not a collection should result in error\");\n-\t\t} catch (ModelException e) {\n-\t\t\t// fall through, expected\n-\t\t}\n+\t\tRDFCollections.asValues(m, head, new ArrayList<>());\n+\t}\n+\n+\t@Test(expected = ModelException.class)\n+\tpublic void testNonWellformedCollection_IncorrectHeadNode() {\n+\t\tResource head = vf.createBNode();\n+\t\tModel m = RDFCollections.asRDF(values, head, new TreeModel());\n+\n+\t\tRDFCollections.asValues(m, vf.createBNode(), new ArrayList<>());", "originalCommit": "c8c624faf00bed7f10abeed6321ab08026e15634", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU4NTgwMw==", "url": "https://github.com/eclipse/rdf4j/pull/2486#discussion_r484585803", "bodyText": "Fixed.", "author": "jeenbroekstra", "createdAt": "2020-09-07T23:31:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMwNjA4NQ=="}], "type": "inlineReview"}, {"oid": "0941302503925e0354e88909f1af1f410fa79895", "url": "https://github.com/eclipse/rdf4j/commit/0941302503925e0354e88909f1af1f410fa79895", "message": "GH-2485 added comment", "committedDate": "2020-09-07T23:30:19Z", "type": "commit"}]}