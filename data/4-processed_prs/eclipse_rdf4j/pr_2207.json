{"pr_number": 2207, "pr_title": "GH-2206 prettier plans by using box-drawing characters to group joins", "pr_createdAt": "2020-05-09T12:19:36Z", "pr_url": "https://github.com/eclipse/rdf4j/pull/2207", "timeline": [{"oid": "4441e068bbc67e90fa10f11d00f46b6c1154eb2c", "url": "https://github.com/eclipse/rdf4j/commit/4441e068bbc67e90fa10f11d00f46b6c1154eb2c", "message": "GH-2206 prettier plans by using box-drawing characters to group joins\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-09T12:18:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3MDQyNg==", "url": "https://github.com/eclipse/rdf4j/pull/2207#discussion_r422570426", "bodyText": "Can you remind me - this is separate from what I would get if I did\n TupleQuery query = conn.prepareTupleQuery(....);\n System.out.println(query);\n\ncorrect? What I'm getting at is that this influences only the output of the Explanation serialization, not if we directly serialize a query algebra node to string. If so: that's good, I'd rather not change the original tupleExpr serialization too much (even if it's not, strictly speaking, a standardized format).", "author": "jeenbroekstra", "createdAt": "2020-05-10T01:46:31Z", "path": "core/query/src/main/java/org/eclipse/rdf4j/query/explanation/GenericPlanNode.java", "diffHunk": "@@ -217,14 +217,25 @@ public void setAlgorithm(String algorithm) {\n \t\tthis.algorithm = algorithm;\n \t}\n \n+\tprivate static int prettyBoxDrawingType = 0;\n+\n \t/**\n \t * Human readable string. Do not attempt to parse this.\n \t *\n \t * @return\n \t */\n \t@Override\n \tpublic String toString() {\n+\t\treturn getHumanReadable(0);", "originalCommit": "4441e068bbc67e90fa10f11d00f46b6c1154eb2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYwNzc2NQ==", "url": "https://github.com/eclipse/rdf4j/pull/2207#discussion_r422607765", "bodyText": "Yes. Printing the query like that just prints the parsed version of the tuple expression. Using the explanation transforms the query into GenericPlanNode, where we have this bow-drawing toString addition.", "author": "hmottestad", "createdAt": "2020-05-10T08:16:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3MDQyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3MDg5Mg==", "url": "https://github.com/eclipse/rdf4j/pull/2207#discussion_r422570892", "bodyText": "If I understood correctly, the idea is to use the double lines for all nodes that have two (or more) children, single lines only for unary predicates. So why is the outer join here single lined, and the inner one double?", "author": "jeenbroekstra", "createdAt": "2020-05-10T01:51:42Z", "path": "core/sail/memory/src/test/java/org/eclipse/rdf4j/sail/memory/QueryPlanRetrievalTest.java", "diffHunk": "@@ -87,32 +87,32 @@ public void testTupleQuery() {\n \t\t\tString actual = query.explain(Explanation.Level.Unoptimized).toString();\n \n \t\t\tString expected = \"Projection\\n\" +\n-\t\t\t\t\t\"   ProjectionElemList\\n\" +\n-\t\t\t\t\t\"      ProjectionElem \\\"a\\\"\\n\" +\n-\t\t\t\t\t\"   Filter\\n\" +\n-\t\t\t\t\t\"      Compare (!=)\\n\" +\n-\t\t\t\t\t\"         Var (name=c)\\n\" +\n-\t\t\t\t\t\"         Var (name=d)\\n\" +\n-\t\t\t\t\t\"      LeftJoin\\n\" +\n-\t\t\t\t\t\"         Join\\n\" +\n-\t\t\t\t\t\"            Join\\n\" +\n-\t\t\t\t\t\"               LeftJoin (new scope)\\n\" +\n-\t\t\t\t\t\"                  SingletonSet\\n\" +\n-\t\t\t\t\t\"                  StatementPattern\\n\" +\n-\t\t\t\t\t\"                     Var (name=d)\\n\" +\n-\t\t\t\t\t\"                     Var (name=e)\\n\" +\n-\t\t\t\t\t\"                     Var (name=f)\\n\" +\n-\t\t\t\t\t\"               StatementPattern\\n\" +\n-\t\t\t\t\t\"                  Var (name=a)\\n\" +\n-\t\t\t\t\t\"                  Var (name=_const_f5e5585a_uri, value=http://www.w3.org/1999/02/22-rdf-syntax-ns#type, anonymous)\\n\"\n+\t\t\t\t\t\"\u2560\u2550\u2550ProjectionElemList\\n\" +\n+\t\t\t\t\t\"\u2551     ProjectionElem \\\"a\\\"\\n\" +\n+\t\t\t\t\t\"\u255a\u2550\u2550Filter\\n\" +\n+\t\t\t\t\t\"   \u251c\u2500\u2500Compare (!=)\\n\" +\n+\t\t\t\t\t\"   \u2502     Var (name=c)\\n\" +\n+\t\t\t\t\t\"   \u2502     Var (name=d)\\n\" +\n+\t\t\t\t\t\"   \u2514\u2500\u2500LeftJoin\\n\" +\n+\t\t\t\t\t\"      \u2560\u2550\u2550Join\\n\" +\n+\t\t\t\t\t\"      \u2551  \u251c\u2500\u2500Join\\n\" +\n+\t\t\t\t\t\"      \u2551  \u2502  \u2560\u2550\u2550LeftJoin (new scope)\\n\" +", "originalCommit": "4441e068bbc67e90fa10f11d00f46b6c1154eb2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYwNzM4Ng==", "url": "https://github.com/eclipse/rdf4j/pull/2207#discussion_r422607386", "bodyText": "It just swaps every other node. So that it\u2019s easier to follow the lines visually. Double vs single has no meaning.", "author": "hmottestad", "createdAt": "2020-05-10T08:13:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3MDg5Mg=="}], "type": "inlineReview"}]}