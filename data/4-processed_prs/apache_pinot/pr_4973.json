{"pr_number": 4973, "pr_title": "Add confluent schema registry message decoder", "pr_createdAt": "2020-01-12T12:26:31Z", "pr_url": "https://github.com/apache/pinot/pull/4973", "timeline": [{"oid": "3f2de0707f1b6828f6c1f50496994b773c432be2", "url": "https://github.com/apache/pinot/commit/3f2de0707f1b6828f6c1f50496994b773c432be2", "message": "Add Avro Schema Registry Message Decoder", "committedDate": "2020-01-12T12:28:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU5NzQ0MQ==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r365597441", "bodyText": "we should not have pinot-avro pull in kafka", "author": "mcvsubbu", "createdAt": "2020-01-12T17:11:10Z", "path": "pinot-plugins/pinot-input-format/pinot-avro/pom.xml", "diffHunk": "@@ -33,6 +33,7 @@\n   <url>https://pinot.apache.org/</url>\n   <properties>\n     <pinot.root>${basedir}/../../..</pinot.root>\n+    <kafka.lib.version>2.0.0</kafka.lib.version>", "originalCommit": "3f2de0707f1b6828f6c1f50496994b773c432be2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU5NzYyOQ==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r365597629", "bodyText": "Please move this to kafka plugins, see KafkaAvroMessageDecoder", "author": "mcvsubbu", "createdAt": "2020-01-12T17:13:17Z", "path": "pinot-plugins/pinot-input-format/pinot-avro/src/main/java/org/apache/pinot/plugin/inputformat/avro/KafkaConfluentSchemaRegistryAvroMessageDecoder.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.plugin.inputformat.avro;\n+\n+import io.confluent.kafka.schemaregistry.client.CachedSchemaRegistryClient;\n+import io.confluent.kafka.schemaregistry.client.SchemaRegistryClient;\n+import io.confluent.kafka.serializers.KafkaAvroDeserializer;\n+import org.apache.avro.generic.GenericData.Record;\n+import org.apache.pinot.spi.data.Schema;\n+import org.apache.pinot.spi.data.readers.GenericRow;\n+import org.apache.pinot.spi.data.readers.RecordExtractor;\n+import org.apache.pinot.spi.plugin.PluginManager;\n+import org.apache.pinot.spi.stream.StreamMessageDecoder;\n+\n+import java.util.Arrays;\n+import java.util.Map;\n+\n+import static com.google.common.base.Preconditions.checkState;\n+import static java.util.Objects.requireNonNull;\n+\n+public class KafkaConfluentSchemaRegistryAvroMessageDecoder implements StreamMessageDecoder<byte[]> {", "originalCommit": "3f2de0707f1b6828f6c1f50496994b773c432be2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYxNzIyNA==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r365617224", "bodyText": "This is in the same package as KafkaAvroMessageDecoder - do you mean have it in a separate module under pinot-input-format?", "author": "elonazoulay", "createdAt": "2020-01-12T22:46:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU5NzYyOQ=="}], "type": "inlineReview"}, {"oid": "8b9acd1ef4da3d4f532d3da002fa131a0786b65f", "url": "https://github.com/apache/pinot/commit/8b9acd1ef4da3d4f532d3da002fa131a0786b65f", "message": "Add Confluent Schema Registry Avro Message Decoder", "committedDate": "2020-01-13T01:31:28Z", "type": "forcePushed"}, {"oid": "f41c9f79f0f2625d3fc2fc778aad94aad0245d8e", "url": "https://github.com/apache/pinot/commit/f41c9f79f0f2625d3fc2fc778aad94aad0245d8e", "message": "Add Confluent Schema Registry Avro Message Decoder", "committedDate": "2020-01-13T04:30:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE2NzgxMg==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r367167812", "bodyText": "can you add some comments on how this is different from AvroDecoder we have in pinot-avro or point to some external link", "author": "kishoreg", "createdAt": "2020-01-15T23:53:12Z", "path": "pinot-plugins/pinot-input-format/pinot-confluent-avro/src/main/java/org/apache/pinot/plugin/inputformat/avro/confluent/KafkaConfluentSchemaRegistryAvroMessageDecoder.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.plugin.inputformat.avro.confluent;\n+\n+import io.confluent.kafka.schemaregistry.client.CachedSchemaRegistryClient;\n+import io.confluent.kafka.schemaregistry.client.SchemaRegistryClient;\n+import io.confluent.kafka.serializers.KafkaAvroDeserializer;\n+import org.apache.avro.generic.GenericData.Record;\n+import org.apache.pinot.plugin.inputformat.avro.AvroRecordExtractor;\n+import org.apache.pinot.spi.data.Schema;\n+import org.apache.pinot.spi.data.readers.GenericRow;\n+import org.apache.pinot.spi.data.readers.RecordExtractor;\n+import org.apache.pinot.spi.plugin.PluginManager;\n+import org.apache.pinot.spi.stream.StreamMessageDecoder;\n+\n+import java.util.Arrays;\n+import java.util.Map;\n+\n+import static com.google.common.base.Preconditions.checkState;\n+import static java.util.Objects.requireNonNull;\n+\n+public class KafkaConfluentSchemaRegistryAvroMessageDecoder implements StreamMessageDecoder<byte[]> {", "originalCommit": "f41c9f79f0f2625d3fc2fc778aad94aad0245d8e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQyNDgwMQ==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r374424801", "bodyText": "Added in pluggablestreams.rst", "author": "elonazoulay", "createdAt": "2020-02-04T00:56:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE2NzgxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE2ODI4NA==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r367168284", "bodyText": "Its probably ok to duplicate the AvroRecordExtractor. Plugin depending on another plugin will probably make things harder. For e.g. Avro versions might be different between pinot-avro and pinot-confluent-avro", "author": "kishoreg", "createdAt": "2020-01-15T23:55:05Z", "path": "pinot-plugins/pinot-input-format/pinot-confluent-avro/src/main/java/org/apache/pinot/plugin/inputformat/avro/confluent/KafkaConfluentSchemaRegistryAvroMessageDecoder.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.plugin.inputformat.avro.confluent;\n+\n+import io.confluent.kafka.schemaregistry.client.CachedSchemaRegistryClient;\n+import io.confluent.kafka.schemaregistry.client.SchemaRegistryClient;\n+import io.confluent.kafka.serializers.KafkaAvroDeserializer;\n+import org.apache.avro.generic.GenericData.Record;\n+import org.apache.pinot.plugin.inputformat.avro.AvroRecordExtractor;\n+import org.apache.pinot.spi.data.Schema;\n+import org.apache.pinot.spi.data.readers.GenericRow;\n+import org.apache.pinot.spi.data.readers.RecordExtractor;\n+import org.apache.pinot.spi.plugin.PluginManager;\n+import org.apache.pinot.spi.stream.StreamMessageDecoder;\n+\n+import java.util.Arrays;\n+import java.util.Map;\n+\n+import static com.google.common.base.Preconditions.checkState;\n+import static java.util.Objects.requireNonNull;\n+\n+public class KafkaConfluentSchemaRegistryAvroMessageDecoder implements StreamMessageDecoder<byte[]> {\n+    private static final String SCHEMA_REGISTRY_REST_URL = \"schema.registry.rest.url\";\n+    private KafkaAvroDeserializer deserializer;\n+    private RecordExtractor<Record> avroRecordConvetrer;\n+    private String topicName;\n+    private Schema pinotSchema;\n+\n+    @Override\n+    public void init(Map<String, String> props, Schema indexingSchema, String topicName) throws Exception {\n+        checkState(props.containsKey(SCHEMA_REGISTRY_REST_URL), \"Missing required property '%s'\", SCHEMA_REGISTRY_REST_URL);\n+        String schemaRegistryUrl = props.get(SCHEMA_REGISTRY_REST_URL);\n+        pinotSchema = requireNonNull(indexingSchema, \"indexingSchema is null\");\n+        SchemaRegistryClient schemaRegistryClient = new CachedSchemaRegistryClient(schemaRegistryUrl, 1000);\n+        deserializer = new KafkaAvroDeserializer(schemaRegistryClient);\n+        this.topicName = requireNonNull(topicName, \"topicName is null\");\n+        this.avroRecordConvetrer = PluginManager.get().createInstance(AvroRecordExtractor.class.getName());", "originalCommit": "f41c9f79f0f2625d3fc2fc778aad94aad0245d8e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE2ODc0MA==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r367168740", "bodyText": "Another option is to create a separate module(not a plugin) called pinot-avro-utils let both pinot-avro and pinot-confluent-avro share that.", "author": "kishoreg", "createdAt": "2020-01-15T23:56:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE2ODI4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc0NjIxNA==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r369746214", "bodyText": "Created pinot-avro-base that both pinot-avro and pinot-confluent-avro plugins use.", "author": "elonazoulay", "createdAt": "2020-01-22T19:04:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE2ODI4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE2ODM3Mg==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r367168372", "bodyText": "typo avroRecordConvetrer", "author": "kishoreg", "createdAt": "2020-01-15T23:55:23Z", "path": "pinot-plugins/pinot-input-format/pinot-confluent-avro/src/main/java/org/apache/pinot/plugin/inputformat/avro/confluent/KafkaConfluentSchemaRegistryAvroMessageDecoder.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.plugin.inputformat.avro.confluent;\n+\n+import io.confluent.kafka.schemaregistry.client.CachedSchemaRegistryClient;\n+import io.confluent.kafka.schemaregistry.client.SchemaRegistryClient;\n+import io.confluent.kafka.serializers.KafkaAvroDeserializer;\n+import org.apache.avro.generic.GenericData.Record;\n+import org.apache.pinot.plugin.inputformat.avro.AvroRecordExtractor;\n+import org.apache.pinot.spi.data.Schema;\n+import org.apache.pinot.spi.data.readers.GenericRow;\n+import org.apache.pinot.spi.data.readers.RecordExtractor;\n+import org.apache.pinot.spi.plugin.PluginManager;\n+import org.apache.pinot.spi.stream.StreamMessageDecoder;\n+\n+import java.util.Arrays;\n+import java.util.Map;\n+\n+import static com.google.common.base.Preconditions.checkState;\n+import static java.util.Objects.requireNonNull;\n+\n+public class KafkaConfluentSchemaRegistryAvroMessageDecoder implements StreamMessageDecoder<byte[]> {\n+    private static final String SCHEMA_REGISTRY_REST_URL = \"schema.registry.rest.url\";\n+    private KafkaAvroDeserializer deserializer;\n+    private RecordExtractor<Record> avroRecordConvetrer;\n+    private String topicName;\n+    private Schema pinotSchema;\n+\n+    @Override\n+    public void init(Map<String, String> props, Schema indexingSchema, String topicName) throws Exception {\n+        checkState(props.containsKey(SCHEMA_REGISTRY_REST_URL), \"Missing required property '%s'\", SCHEMA_REGISTRY_REST_URL);\n+        String schemaRegistryUrl = props.get(SCHEMA_REGISTRY_REST_URL);\n+        pinotSchema = requireNonNull(indexingSchema, \"indexingSchema is null\");\n+        SchemaRegistryClient schemaRegistryClient = new CachedSchemaRegistryClient(schemaRegistryUrl, 1000);\n+        deserializer = new KafkaAvroDeserializer(schemaRegistryClient);\n+        this.topicName = requireNonNull(topicName, \"topicName is null\");\n+        this.avroRecordConvetrer = PluginManager.get().createInstance(AvroRecordExtractor.class.getName());\n+    }\n+\n+    @Override\n+    public GenericRow decode(byte[] payload, GenericRow destination) {\n+        Record avroRecord = (Record) deserializer.deserialize(topicName, payload);\n+        return avroRecordConvetrer.extract(pinotSchema, avroRecord, destination);", "originalCommit": "f41c9f79f0f2625d3fc2fc778aad94aad0245d8e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE2OTQ3NQ==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r367169475", "bodyText": "should we move this to the pom specific to this plugin.", "author": "kishoreg", "createdAt": "2020-01-15T23:59:27Z", "path": "pom.xml", "diffHunk": "@@ -138,6 +138,7 @@\n     To change kafka connector dependency, we only need to update this version number config.\n     TODO: figure out a way to inject kafka dependency instead of explicitly setting the kafka module dependency -->\n     <kafka.version>2.0</kafka.version>\n+    <confluent.version>5.3.1</confluent.version>", "originalCommit": "f41c9f79f0f2625d3fc2fc778aad94aad0245d8e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE2OTU3Ng==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r367169576", "bodyText": "move to pom specific to this plugin?", "author": "kishoreg", "createdAt": "2020-01-15T23:59:51Z", "path": "pom.xml", "diffHunk": "@@ -212,6 +213,14 @@\n       </build>\n     </profile>\n   </profiles>\n+", "originalCommit": "f41c9f79f0f2625d3fc2fc778aad94aad0245d8e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d37346748586cb4cb6bbcc4c5cb608cfe8685224", "url": "https://github.com/apache/pinot/commit/d37346748586cb4cb6bbcc4c5cb608cfe8685224", "message": "Add Confluent Schema Registry Avro Message Decoder", "committedDate": "2020-01-22T11:23:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgyNTQ3Mw==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r372825473", "bodyText": "do we need to define pinot.root?", "author": "xiangfu0", "createdAt": "2020-01-30T08:58:08Z", "path": "pinot-plugins/pinot-input-format/pinot-avro-base/pom.xml", "diffHunk": "@@ -0,0 +1,59 @@\n+<?xml version=\"1.0\"?>\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one\n+    or more contributor license agreements.  See the NOTICE file\n+    distributed with this work for additional information\n+    regarding copyright ownership.  The ASF licenses this file\n+    to you under the Apache License, Version 2.0 (the\n+    \"License\"); you may not use this file except in compliance\n+    with the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing,\n+    software distributed under the License is distributed on an\n+    \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+    KIND, either express or implied.  See the License for the\n+    specific language governing permissions and limitations\n+    under the License.\n+\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>pinot-input-format</artifactId>\n+    <groupId>org.apache.pinot</groupId>\n+    <version>0.3.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>pinot-avro-base</artifactId>\n+  <name>Pinot Avro Base</name>\n+  <url>https://pinot.apache.org/</url>\n+  <properties>\n+    <pinot.root>${basedir}/../../..</pinot.root>", "originalCommit": "d37346748586cb4cb6bbcc4c5cb608cfe8685224", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE5MDU5Nw==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r374190597", "bodyText": "Thanks @fx19880617! Removed. I noticed that this property is set in all the plugins under pinot-input-format. Does it make sense to remove those as well in a separate commit?", "author": "elonazoulay", "createdAt": "2020-02-03T16:06:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgyNTQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQxODIwNA==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r374418204", "bodyText": "FYI, I had to add it back as the property is used by the build and fails without it (mycila license error).", "author": "elonazoulay", "createdAt": "2020-02-04T00:31:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgyNTQ3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgyNTgxMw==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r372825813", "bodyText": "this plugin is already declared in the parent pom", "author": "xiangfu0", "createdAt": "2020-01-30T08:58:53Z", "path": "pinot-plugins/pinot-input-format/pinot-confluent-avro/pom.xml", "diffHunk": "@@ -0,0 +1,134 @@\n+<?xml version=\"1.0\"?>\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one\n+    or more contributor license agreements.  See the NOTICE file\n+    distributed with this work for additional information\n+    regarding copyright ownership.  The ASF licenses this file\n+    to you under the Apache License, Version 2.0 (the\n+    \"License\"); you may not use this file except in compliance\n+    with the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing,\n+    software distributed under the License is distributed on an\n+    \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+    KIND, either express or implied.  See the License for the\n+    specific language governing permissions and limitations\n+    under the License.\n+\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>pinot-input-format</artifactId>\n+    <groupId>org.apache.pinot</groupId>\n+    <version>0.3.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>pinot-confluent-avro</artifactId>\n+  <name>Pinot Avro</name>\n+  <url>https://pinot.apache.org/</url>\n+  <properties>\n+    <pinot.root>${basedir}/../../..</pinot.root>\n+    <kafka.lib.version>2.0.0</kafka.lib.version>\n+    <confluent.version>5.3.1</confluent.version>\n+  </properties>\n+  <build>\n+    <plugins>", "originalCommit": "d37346748586cb4cb6bbcc4c5cb608cfe8685224", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgyNjE2NA==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r372826164", "bodyText": "avro dependency is already defined in pinot-avro-base.", "author": "xiangfu0", "createdAt": "2020-01-30T08:59:40Z", "path": "pinot-plugins/pinot-input-format/pinot-confluent-avro/pom.xml", "diffHunk": "@@ -0,0 +1,134 @@\n+<?xml version=\"1.0\"?>\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one\n+    or more contributor license agreements.  See the NOTICE file\n+    distributed with this work for additional information\n+    regarding copyright ownership.  The ASF licenses this file\n+    to you under the Apache License, Version 2.0 (the\n+    \"License\"); you may not use this file except in compliance\n+    with the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing,\n+    software distributed under the License is distributed on an\n+    \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+    KIND, either express or implied.  See the License for the\n+    specific language governing permissions and limitations\n+    under the License.\n+\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>pinot-input-format</artifactId>\n+    <groupId>org.apache.pinot</groupId>\n+    <version>0.3.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>pinot-confluent-avro</artifactId>\n+  <name>Pinot Avro</name>\n+  <url>https://pinot.apache.org/</url>\n+  <properties>\n+    <pinot.root>${basedir}/../../..</pinot.root>\n+    <kafka.lib.version>2.0.0</kafka.lib.version>\n+    <confluent.version>5.3.1</confluent.version>\n+  </properties>\n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>org.apache.maven.plugins</groupId>\n+        <artifactId>maven-enforcer-plugin</artifactId>\n+      </plugin>\n+    </plugins>\n+  </build>\n+\n+  <repositories>\n+    <repository>\n+      <id>confluent</id>\n+      <url>http://packages.confluent.io/maven/</url>\n+    </repository>\n+  </repositories>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>org.apache.pinot</groupId>\n+      <artifactId>pinot-avro-base</artifactId>\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>org.apache.avro</groupId>\n+      <artifactId>avro</artifactId>", "originalCommit": "d37346748586cb4cb6bbcc4c5cb608cfe8685224", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgyNjk4MA==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r372826980", "bodyText": "is this needed?", "author": "xiangfu0", "createdAt": "2020-01-30T09:01:32Z", "path": "pinot-plugins/pinot-input-format/pinot-csv/pom.xml", "diffHunk": "@@ -43,5 +43,11 @@\n       <groupId>commons-lang</groupId>\n       <artifactId>commons-lang</artifactId>\n     </dependency>\n+    <dependency>", "originalCommit": "d37346748586cb4cb6bbcc4c5cb608cfe8685224", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE5MjkyNA==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r374192924", "bodyText": "The build failed with a dependency error without it.", "author": "elonazoulay", "createdAt": "2020-02-03T16:10:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgyNjk4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgyNzAyOA==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r372827028", "bodyText": "is this needed?", "author": "xiangfu0", "createdAt": "2020-01-30T09:01:38Z", "path": "pinot-plugins/pinot-input-format/pinot-json/pom.xml", "diffHunk": "@@ -39,5 +39,11 @@\n       <groupId>commons-lang</groupId>\n       <artifactId>commons-lang</artifactId>\n     </dependency>\n+    <dependency>\n+      <groupId>org.apache.pinot</groupId>\n+      <artifactId>pinot-spi</artifactId>", "originalCommit": "d37346748586cb4cb6bbcc4c5cb608cfe8685224", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE5MzA3MA==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r374193070", "bodyText": "The build failed with a dependency error without it.", "author": "elonazoulay", "createdAt": "2020-02-03T16:10:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgyNzAyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzMTkwNA==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r374431904", "bodyText": "I thought pinot-spi is in pinot-plugins pom (https://github.com/apache/incubator-pinot/blob/master/pinot-plugins/pom.xml#L50) so you don't need to put it here.\nMaybe to rebase from current master?", "author": "xiangfu0", "createdAt": "2020-02-04T01:25:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgyNzAyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgyNzEwOQ==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r372827109", "bodyText": "is this needed?", "author": "xiangfu0", "createdAt": "2020-01-30T09:01:52Z", "path": "pinot-plugins/pinot-input-format/pinot-parquet/pom.xml", "diffHunk": "@@ -55,5 +65,11 @@\n         </exclusion>\n       </exclusions>\n     </dependency>\n+    <dependency>\n+      <groupId>org.apache.pinot</groupId>\n+      <artifactId>pinot-spi</artifactId>", "originalCommit": "d37346748586cb4cb6bbcc4c5cb608cfe8685224", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE5MzIwMA==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r374193200", "bodyText": "Same as above.", "author": "elonazoulay", "createdAt": "2020-02-03T16:10:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgyNzEwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgyODI4OQ==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r372828289", "bodyText": "why we need kafka-client dependency?", "author": "xiangfu0", "createdAt": "2020-01-30T09:04:37Z", "path": "pinot-plugins/pinot-input-format/pinot-confluent-avro/pom.xml", "diffHunk": "@@ -0,0 +1,134 @@\n+<?xml version=\"1.0\"?>\n+<!--\n+\n+    Licensed to the Apache Software Foundation (ASF) under one\n+    or more contributor license agreements.  See the NOTICE file\n+    distributed with this work for additional information\n+    regarding copyright ownership.  The ASF licenses this file\n+    to you under the Apache License, Version 2.0 (the\n+    \"License\"); you may not use this file except in compliance\n+    with the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing,\n+    software distributed under the License is distributed on an\n+    \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+    KIND, either express or implied.  See the License for the\n+    specific language governing permissions and limitations\n+    under the License.\n+\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>pinot-input-format</artifactId>\n+    <groupId>org.apache.pinot</groupId>\n+    <version>0.3.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>pinot-confluent-avro</artifactId>\n+  <name>Pinot Avro</name>\n+  <url>https://pinot.apache.org/</url>\n+  <properties>\n+    <pinot.root>${basedir}/../../..</pinot.root>\n+    <kafka.lib.version>2.0.0</kafka.lib.version>\n+    <confluent.version>5.3.1</confluent.version>\n+  </properties>\n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>org.apache.maven.plugins</groupId>\n+        <artifactId>maven-enforcer-plugin</artifactId>\n+      </plugin>\n+    </plugins>\n+  </build>\n+\n+  <repositories>\n+    <repository>\n+      <id>confluent</id>\n+      <url>http://packages.confluent.io/maven/</url>\n+    </repository>\n+  </repositories>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>org.apache.pinot</groupId>\n+      <artifactId>pinot-avro-base</artifactId>\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>org.apache.avro</groupId>\n+      <artifactId>avro</artifactId>\n+      <exclusions>\n+        <exclusion>\n+          <groupId>org.slf4j</groupId>\n+          <artifactId>slf4j-api</artifactId>\n+        </exclusion>\n+        <exclusion>\n+          <groupId>org.mortbay.jetty</groupId>\n+          <artifactId>jetty</artifactId>\n+        </exclusion>\n+      </exclusions>\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>org.apache.kafka</groupId>\n+      <artifactId>kafka-clients</artifactId>", "originalCommit": "d37346748586cb4cb6bbcc4c5cb608cfe8685224", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE5Mzc1NA==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r374193754", "bodyText": "The schema registry client has a dependency and a dependency convergence error is thrown without an explicit dependency.", "author": "elonazoulay", "createdAt": "2020-02-03T16:11:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgyODI4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzMjQwNQ==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r374432405", "bodyText": "Is this lib used anywhere in this decoder? shall we exclude this or explicit specify it here?", "author": "xiangfu0", "createdAt": "2020-02-04T01:27:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgyODI4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQzMDI4NQ==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r375430285", "bodyText": "It's used by the schema registry client, as it stores schemas in a kafka topic, and uses the kafka client to retrieve and store metadata. It's a direct dependency of schema-registry client. If we exclude it then we get a ClassNotFound exception. So I would say leave it explicitly specified. Let me know what you think.", "author": "elonazoulay", "createdAt": "2020-02-05T18:28:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgyODI4OQ=="}], "type": "inlineReview"}, {"oid": "38e3cde702e785ea2f40247664ac07123ac96c6a", "url": "https://github.com/apache/pinot/commit/38e3cde702e785ea2f40247664ac07123ac96c6a", "message": "Add Confluent Schema Registry Avro Message Decoder", "committedDate": "2020-02-04T00:27:01Z", "type": "forcePushed"}, {"oid": "801ddaf5ad5508194bbc695552cd7fd5e76b2d27", "url": "https://github.com/apache/pinot/commit/801ddaf5ad5508194bbc695552cd7fd5e76b2d27", "message": "Add Confluent Schema Registry Avro Message Decoder", "committedDate": "2020-02-04T13:27:28Z", "type": "forcePushed"}, {"oid": "5aa3026316642172d53585e41d4bef4f45fce10e", "url": "https://github.com/apache/pinot/commit/5aa3026316642172d53585e41d4bef4f45fce10e", "message": "Add Confluent Schema Registry Avro Message Decoder", "committedDate": "2020-02-24T08:53:06Z", "type": "forcePushed"}, {"oid": "8968e54bf9362559d6462ed4c61af1b85b266dfc", "url": "https://github.com/apache/pinot/commit/8968e54bf9362559d6462ed4c61af1b85b266dfc", "message": "Add Confluent Schema Registry Avro Message Decoder", "committedDate": "2020-02-24T09:15:36Z", "type": "forcePushed"}, {"oid": "543056e1a928d611c2ea65da4fa52545fc598b5d", "url": "https://github.com/apache/pinot/commit/543056e1a928d611c2ea65da4fa52545fc598b5d", "message": "Add Confluent Schema Registry Avro Message Decoder", "committedDate": "2020-02-24T22:00:54Z", "type": "commit"}, {"oid": "543056e1a928d611c2ea65da4fa52545fc598b5d", "url": "https://github.com/apache/pinot/commit/543056e1a928d611c2ea65da4fa52545fc598b5d", "message": "Add Confluent Schema Registry Avro Message Decoder", "committedDate": "2020-02-24T22:00:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0NjA2MQ==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r384046061", "bodyText": "We  have moved the documentation to gitbook. Please add the docs there", "author": "mcvsubbu", "createdAt": "2020-02-25T18:31:30Z", "path": "docs/pluggable_streams.rst", "diffHunk": "@@ -230,6 +230,42 @@ Please note:\n #. Config ``stream.kafka.consumer.type`` should be specified as ``LowLevel`` to use partition level consumer. (The use of ``simple`` instead of ``LowLevel`` is deprecated)\n #. Configs ``stream.kafka.zk.broker.url`` and ``stream.kafka.broker.list`` are required under ``tableIndexConfig.streamConfigs`` to provide kafka related information.\n \n+Here is another example which is used to read avro messages using the schema id from confluent schema registry.", "originalCommit": "543056e1a928d611c2ea65da4fa52545fc598b5d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgzNzUyNw==", "url": "https://github.com/apache/pinot/pull/4973#discussion_r384837527", "bodyText": "Will do this shortly, thanks!", "author": "elonazoulay", "createdAt": "2020-02-26T23:52:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0NjA2MQ=="}], "type": "inlineReview"}]}