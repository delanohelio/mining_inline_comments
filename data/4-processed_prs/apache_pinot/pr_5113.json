{"pr_number": 5113, "pr_title": "[TE] added a couple of validations to check if detection is subscribed & valid; cleaned up other validations", "pr_createdAt": "2020-03-05T00:23:13Z", "pr_url": "https://github.com/apache/pinot/pull/5113", "timeline": [{"oid": "f09723800f0f71f8237ce6bbcc31788e409d77f6", "url": "https://github.com/apache/pinot/commit/f09723800f0f71f8237ce6bbcc31788e409d77f6", "message": "[TE] add validation to check if detection is subscribed before creating a new alert; clean up older validations", "committedDate": "2020-03-05T00:24:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQxMjk5OQ==", "url": "https://github.com/apache/pinot/pull/5113#discussion_r388412999", "bodyText": "There are some use cases (e.g, DHM) that they only want to create alert w/o subscription groups.", "author": "xiaohui-sun", "createdAt": "2020-03-05T16:33:50Z", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/yaml/YamlResource.java", "diffHunk": "@@ -262,6 +263,23 @@ private Response processBadAuthorizationResponse(String type, String operation,\n     return Response.status(Response.Status.UNAUTHORIZED).entity(responseMessage).build();\n   }\n \n+  /**\n+   * Perform some basic validations on the create alert payload\n+   */\n+  public void validateCreateAlertYaml(Map<String, String> config) throws IOException {\n+    Preconditions.checkArgument(config.containsKey(PROP_DETECTION), \"Detection pipeline yaml is missing\");\n+    Preconditions.checkArgument(config.containsKey(PROP_SUBSCRIPTION), \"Subscription group yaml is missing.\");\n+\n+    // check if subscription group has subscribed to the detection\n+    Map<String, Object> detectionConfigMap = new HashMap<>(ConfigUtils.getMap(this.yaml.load(config.get(PROP_DETECTION))));\n+    String detectionName = MapUtils.getString(detectionConfigMap, PROP_DETECTION_NAME);\n+    Map<String, Object> subscriptionConfigMap = new HashMap<>(ConfigUtils.getMap(this.yaml.load(config.get(PROP_SUBSCRIPTION))));\n+    List<String> detectionNames = ConfigUtils.getList(subscriptionConfigMap.get(PROP_DETECTION_NAMES));\n+    Preconditions.checkArgument(detectionNames.contains(detectionName),\n+        \"You have not subscribed to the alert. Please copy-paste the detectionName under the \"", "originalCommit": "f09723800f0f71f8237ce6bbcc31788e409d77f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQzNjk2Ng==", "url": "https://github.com/apache/pinot/pull/5113#discussion_r388436966", "bodyText": "There is already a separate api to create just the detection.", "author": "akshayrai", "createdAt": "2020-03-05T17:10:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQxMjk5OQ=="}], "type": "inlineReview"}, {"oid": "ca720c22d9fec05d3690fd2ec1ba8dfb9bcdd071", "url": "https://github.com/apache/pinot/commit/ca720c22d9fec05d3690fd2ec1ba8dfb9bcdd071", "message": "[TE] add validation to check if detection is subscribed before creating a new alert; clean up older validations", "committedDate": "2020-03-05T18:18:24Z", "type": "commit"}, {"oid": "ca720c22d9fec05d3690fd2ec1ba8dfb9bcdd071", "url": "https://github.com/apache/pinot/commit/ca720c22d9fec05d3690fd2ec1ba8dfb9bcdd071", "message": "[TE] add validation to check if detection is subscribed before creating a new alert; clean up older validations", "committedDate": "2020-03-05T18:18:24Z", "type": "forcePushed"}, {"oid": "9866af80fd64d55de2212da64f39ef34ed16ac2e", "url": "https://github.com/apache/pinot/commit/9866af80fd64d55de2212da64f39ef34ed16ac2e", "message": "rebase changes", "committedDate": "2020-03-05T19:44:15Z", "type": "commit"}]}