{"pr_number": 5155, "pr_title": "[TE] anomaly detection model downloader", "pr_createdAt": "2020-03-16T18:24:55Z", "pr_url": "https://github.com/apache/pinot/pull/5155", "timeline": [{"oid": "90a031ae1c7a4a1d3e1f6c732b8d06531fb073a4", "url": "https://github.com/apache/pinot/commit/90a031ae1c7a4a1d3e1f6c732b8d06531fb073a4", "message": "[TE] anomaly detection model downloaders", "committedDate": "2020-03-16T18:20:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMwNTAwMg==", "url": "https://github.com/apache/pinot/pull/5155#discussion_r393305002", "bodyText": "nit: license header", "author": "akshayrai", "createdAt": "2020-03-16T20:55:05Z", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/model/download/ModelDownloaderManager.java", "diffHunk": "@@ -0,0 +1,68 @@\n+package org.apache.pinot.thirdeye.model.download;", "originalCommit": "90a031ae1c7a4a1d3e1f6c732b8d06531fb073a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkwNjU0Mw==", "url": "https://github.com/apache/pinot/pull/5155#discussion_r393906543", "bodyText": "added", "author": "jihaozh", "createdAt": "2020-03-17T19:04:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMwNTAwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMwNjA2MQ==", "url": "https://github.com/apache/pinot/pull/5155#discussion_r393306061", "bodyText": "Where will this run? every worker?", "author": "akshayrai", "createdAt": "2020-03-16T20:57:05Z", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/model/download/ModelDownloaderManager.java", "diffHunk": "@@ -0,0 +1,68 @@\n+package org.apache.pinot.thirdeye.model.download;\n+\n+import java.lang.reflect.Constructor;\n+import java.nio.file.Paths;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ScheduledExecutorService;\n+import org.apache.pinot.thirdeye.auto.onboard.AutoOnboardService;\n+import org.apache.pinot.thirdeye.common.time.TimeGranularity;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+/**\n+ * The model downloader manager. This class manages the life cycle of the model downloader.\n+ * It constructs the model downloader, and then schedules the model downloader to run periodically and downloads the\n+ * models into a local destination path. The class names, the run frequency and the download path can be configured.\n+ */\n+public class ModelDownloaderManager {\n+  private static final Logger LOG = LoggerFactory.getLogger(AutoOnboardService.class);\n+\n+  private final List<ModelDownloaderConfiguration> configs;\n+  private final Map<String, ModelDownloader> modelDownloaders;\n+  private ScheduledExecutorService scheduledExecutorService;\n+\n+  public ModelDownloaderManager(List<ModelDownloaderConfiguration> modelDownloaderConfigs) {\n+    this.configs = modelDownloaderConfigs;\n+    this.modelDownloaders = new HashMap<>();\n+    this.scheduledExecutorService = Executors.newScheduledThreadPool(5);\n+\n+    constructModelDownloaders();\n+  }\n+\n+  private void constructModelDownloaders() {\n+    for (ModelDownloaderConfiguration config : this.configs) {\n+      try {\n+        Constructor<?> constructor = Class.forName(config.getClassName()).getConstructor(Map.class);\n+        ModelDownloader downloader = (ModelDownloader) constructor.newInstance(config.getProperties());\n+        this.modelDownloaders.put(config.getClassName(), downloader);\n+      } catch (Exception e) {\n+        LOG.warn(\"Failed to initialize model downloader {}\", config.getClassName(), e);\n+      }\n+    }\n+  }\n+\n+  /**\n+   * start the model downloader manager\n+   */\n+  public void start() {", "originalCommit": "90a031ae1c7a4a1d3e1f6c732b8d06531fb073a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMxNzk5Nw==", "url": "https://github.com/apache/pinot/pull/5155#discussion_r393317997", "bodyText": "yes. every worker that needs to run the model", "author": "jihaozh", "createdAt": "2020-03-16T21:23:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMwNjA2MQ=="}], "type": "inlineReview"}, {"oid": "aa0f4fe7ff9f7182bbfbeb804544a7bd49af5424", "url": "https://github.com/apache/pinot/commit/aa0f4fe7ff9f7182bbfbeb804544a7bd49af5424", "message": "address comments", "committedDate": "2020-03-17T19:04:33Z", "type": "commit"}]}