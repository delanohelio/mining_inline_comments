{"pr_number": 5930, "pr_title": "[TE] ThirdEye User Configuration Validation - detection and subscription yaml", "pr_createdAt": "2020-08-26T19:22:30Z", "pr_url": "https://github.com/apache/pinot/pull/5930", "timeline": [{"oid": "05b38074b04c4c30083da37f6fc3e565549c5a06", "url": "https://github.com/apache/pinot/commit/05b38074b04c4c30083da37f6fc3e565549c5a06", "message": "[TE] ThirdEye User Config (Yaml) Validation", "committedDate": "2020-08-26T19:14:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzYyNDIxNA==", "url": "https://github.com/apache/pinot/pull/5930#discussion_r477624214", "bodyText": "shall the rule type be an enum?", "author": "jihaozh", "createdAt": "2020-08-26T22:28:19Z", "path": "thirdeye/thirdeye-pinot/src/main/resources/validators/detection/detection-config-schema.json", "diffHunk": "@@ -0,0 +1,214 @@\n+{\n+  \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n+  \"title\": \"Detection Config Schema\",\n+\n+  \"type\": \"object\",\n+  \"description\": \"YAML representation of metric or composite detection config\",\n+\n+  \"required\": [ \"detectionName\" ],\n+\n+  \"properties\": {\n+    \"detectionName\": {\n+      \"type\": \"string\"\n+    },\n+    \"description\": {\n+      \"type\": \"string\"\n+    },\n+    \"type\": {\n+      \"type\": \"string\",\n+      \"description\": \"detection pipeline type\",\n+      \"enum\": [\n+        \"METRIC_ALERT\",\n+        \"COMPOSITE_ALERT\"\n+      ]\n+    },\n+    \"metric\": {\n+      \"type\": \"string\"\n+    },\n+    \"dataset\": {\n+      \"type\": \"string\"\n+    },\n+    \"active\": {\n+      \"type\": \"boolean\"\n+    },\n+    \"cron\": {\n+      \"type\": \"string\"\n+    },\n+    \"filters\": {\n+      \"$ref\": \"#/definitions/filters\"\n+    },\n+    \"dimensionExploration\": {\n+      \"$ref\": \"#/definitions/dimensionExploration\"\n+    },\n+    \"rules\": {\n+      \"$ref\": \"#/definitions/rules\"\n+    },\n+    \"alerts\": {\n+      \"$ref\": \"#/definitions/alerts\"\n+    },\n+    \"merger\": {\n+      \"$ref\": \"#/definitions/merger\"\n+    },\n+    \"grouper\": {\n+      \"$ref\": \"#/definitions/grouper\"\n+    }\n+  },\n+\n+  \"definitions\": {\n+    \"alerts\": {\n+      \"type\": \"array\",\n+      \"items\": {\n+        \"$ref\": \"#/definitions/subEntity\"\n+      }\n+    },\n+\n+    \"subEntity\": {\n+      \"type\": \"object\",\n+      \"description\": \"a sub-entity detection config\",\n+      \"required\": [ \"name\", \"type\" ],\n+      \"properties\": {\n+        \"name\": {\n+          \"type\": \"string\"\n+        },\n+        \"description\": {\n+          \"type\": \"string\"\n+        },\n+        \"type\": {\n+          \"type\": \"string\",\n+          \"description\": \"detection pipeline type\",\n+          \"enum\": [\n+            \"COMPOSITE_ALERT\",\n+            \"METRIC_ALERT\"\n+          ]\n+        },\n+        \"alerts\": {\n+          \"$ref\": \"#/definitions/alerts\"\n+        },\n+        \"metric\": {\n+          \"type\": \"string\"\n+        },\n+        \"dataset\": {\n+          \"type\": \"string\"\n+        },\n+        \"filters\": {\n+          \"$ref\": \"#/definitions/filters\"\n+        },\n+        \"dimensionExploration\": {\n+          \"$ref\": \"#/definitions/dimensionExploration\"\n+        },\n+        \"rules\": {\n+          \"$ref\": \"#/definitions/rules\"\n+        },\n+        \"merger\": {\n+          \"$ref\": \"#/definitions/merger\"\n+        },\n+        \"grouper\": {\n+          \"$ref\": \"#/definitions/grouper\"\n+        }\n+      },\n+      \"additionalProperties\": false\n+    },\n+\n+    \"dimensionExploration\": {\n+      \"type\": \"object\",\n+      \"description\": \"exploration combination of dimension values\",\n+      \"properties\": {\n+        \"dimensions\": {\n+          \"type\": \"array\",\n+          \"description\": \"dimension column names\",\n+          \"items\": {\n+            \"type\": \"string\"\n+          }\n+        },\n+        \"dimensionFilterMetric\": {\n+          \"type\": \"string\"\n+        }\n+      },\n+      \"patternProperties\": {\n+        \"k|minValue|minContribution|minValueHourly|maxValueHourly|minValueDaily|maxValueDaily\": {\n+          \"type\": \"number\"\n+        }\n+      },\n+      \"additionalProperties\": false\n+    },\n+\n+    \"filters\": {\n+      \"type\": \"object\",\n+      \"description\": \"dimension filters\",\n+      \"patternProperties\": {\n+        \".*\": {\n+          \"type\": \"array\",\n+          \"description\": \"dimension filter values\",\n+          \"items\": {\n+            \"type\": \"string\"\n+          }\n+        }\n+      }\n+    },\n+\n+    \"eachComponent\": {\n+      \"type\": \"array\",\n+      \"items\": {\n+        \"type\": \"object\",\n+        \"required\": [ \"type\", \"name\" ],\n+        \"properties\": {\n+          \"type\": {\n+            \"type\": \"string\"", "originalCommit": "05b38074b04c4c30083da37f6fc3e565549c5a06", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzYyNzM2MA==", "url": "https://github.com/apache/pinot/pull/5930#discussion_r477627360", "bodyText": "We can define an enum, but I avoided it for a couple of reasons.\n\nWe do not want to hard code and maintain the list of possible rule types here.\nWe have internal algorithm types which shouldn't be hardcoded here.\nWe run a validation in the code which will anyways capture if the type is invalid.", "author": "akshayrai", "createdAt": "2020-08-26T22:36:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzYyNDIxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzYyNDk1Mw==", "url": "https://github.com/apache/pinot/pull/5930#discussion_r477624953", "bodyText": "shall the subscription group type be an enum type?", "author": "jihaozh", "createdAt": "2020-08-26T22:30:12Z", "path": "thirdeye/thirdeye-pinot/src/main/resources/validators/subscription/subscription-config-schema.json", "diffHunk": "@@ -0,0 +1,110 @@\n+{\n+  \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n+  \"title\": \"Subscription Config Schema\",\n+\n+  \"type\": \"object\",\n+  \"description\": \"YAML representation of a subscription group config\",\n+  \"required\": [ \"subscriptionGroupName\", \"subscribedDetections\", \"application\", \"alertSchemes\" ],\n+\n+  \"properties\": {\n+    \"subscriptionGroupName\": {\n+      \"type\": \"string\"\n+    },\n+    \"application\": {\n+      \"type\": \"string\"\n+    },\n+    \"type\": {\n+      \"type\": \"string\"", "originalCommit": "05b38074b04c4c30083da37f6fc3e565549c5a06", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzYyNzY0OA==", "url": "https://github.com/apache/pinot/pull/5930#discussion_r477627648", "bodyText": "replied above.", "author": "akshayrai", "createdAt": "2020-08-26T22:37:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzYyNDk1Mw=="}], "type": "inlineReview"}]}