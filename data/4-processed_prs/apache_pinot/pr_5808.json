{"pr_number": 5808, "pr_title": "[TE] Dashboard Resource Refactor", "pr_createdAt": "2020-08-05T02:24:34Z", "pr_url": "https://github.com/apache/pinot/pull/5808", "timeline": [{"oid": "1494573ebc40677a30c4baa5f8055c2b13ba2d6a", "url": "https://github.com/apache/pinot/commit/1494573ebc40677a30c4baa5f8055c2b13ba2d6a", "message": "[TE] Dashboard Resource Refactor\n\nThis change refactors the resource classes.\n - Created a RootResource to hold the \"/\" namespace\n - Most dependencies have been moved to this resource simplifying the DashboardServer\n\n Rebasing and resolving conflicts", "committedDate": "2020-08-05T18:10:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU4ODkwOA==", "url": "https://github.com/apache/pinot/pull/5808#discussion_r466588908", "bodyText": "why these resources are not moved to RootResource\uff1f", "author": "jihaozh", "createdAt": "2020-08-06T17:57:24Z", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/dashboard/ThirdEyeDashboardApplication.java", "diffHunk": "@@ -139,36 +114,11 @@ public void run(ThirdEyeDashboardConfiguration config, Environment env)\n     final JerseyEnvironment jersey = env.jersey();\n     injector = Guice.createInjector(new ThirdEyeDashboardModule(config, env, DAO_REGISTRY));\n     Stream.of(\n-        DetectionConfigurationResource.class,\n-        DatasetAutoOnboardResource.class,\n-        DashboardResource.class,\n-        CacheResource.class,\n         AnomalyResource.class,\n-        EntityManagerResource.class,\n-        MetricConfigResource.class,\n-        DatasetConfigResource.class,\n-        AdminResource.class,\n-        SummaryResource.class,\n-        ThirdEyeResource.class,\n-        DataResource.class,\n-        AnomaliesResource.class,\n-        EntityMappingResource.class,\n-        OnboardDatasetMetricResource.class,\n-        AutoOnboardResource.class,\n-        ConfigResource.class,\n-        CustomizedEventResource.class,\n-        AnomalyFlattenResource.class,\n-        UserDashboardResource.class,\n-        ApplicationResource.class,\n-        DetectionResource.class,\n-        DetectionAlertResource.class,\n-        YamlResource.class,\n-        SqlDataSourceResource.class,\n-        AlertResource.class,\n-        RootCauseTemplateResource.class,\n-        RootCauseSessionResource.class,\n         RootCauseMetricResource.class,\n-        AnomalySearchResource.class\n+        RootCauseSessionResource.class,\n+        RootCauseTemplateResource.class,", "originalCommit": "1494573ebc40677a30c4baa5f8055c2b13ba2d6a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYwMjM3NQ==", "url": "https://github.com/apache/pinot/pull/5808#discussion_r466602375", "bodyText": "There are RCA classes and they need further refactor themselves which seemed a bit out of scope.\nFor example,\nRootCauseResource initialization is conditional on the config but RootCauseSessionResource and RootCauseTemplateResource are not! Also, all of them contribute to the \"/rootcause\" namespace. I think this needs to be investigated and solved separately.\nAnother example is AnomalyResource which maps to \"/dashboard\". Generally by convention, path namespaces and class names are kept very similar so as to understand context. Here, there is a DashboardResource and AnomalyResource both pointing to \"/dashboard\" with a different set of methods. This again seems a separate PR to me.\nI want to fix them but not in this PR. Currently, the changes in this PR are mostly limited to moving \"@path\" from class level to method level.", "author": "suvodeep-pyne", "createdAt": "2020-08-06T18:22:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU4ODkwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU4OTc0OQ==", "url": "https://github.com/apache/pinot/pull/5808#discussion_r466589749", "bodyText": "Swagger isn't working if the resources are put under this class.", "author": "jihaozh", "createdAt": "2020-08-06T17:58:51Z", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/RootResource.java", "diffHunk": "@@ -0,0 +1,201 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ *\n+ */\n+\n+package org.apache.pinot.thirdeye.dashboard.resources;\n+\n+import com.google.inject.Inject;\n+import javax.ws.rs.Path;\n+import org.apache.pinot.thirdeye.api.application.ApplicationResource;\n+import org.apache.pinot.thirdeye.api.user.dashboard.UserDashboardResource;\n+import org.apache.pinot.thirdeye.dashboard.resources.v2.AnomaliesResource;\n+import org.apache.pinot.thirdeye.dashboard.resources.v2.ConfigResource;\n+import org.apache.pinot.thirdeye.dashboard.resources.v2.DataResource;\n+import org.apache.pinot.thirdeye.dashboard.resources.v2.DetectionAlertResource;\n+import org.apache.pinot.thirdeye.dashboard.resources.v2.alerts.AlertResource;\n+import org.apache.pinot.thirdeye.dataset.DatasetAutoOnboardResource;\n+import org.apache.pinot.thirdeye.datasource.sql.resources.SqlDataSourceResource;\n+import org.apache.pinot.thirdeye.detection.DetectionResource;\n+import org.apache.pinot.thirdeye.detection.yaml.YamlResource;\n+\n+/**\n+ * This is the Jersey root endpoint \"/\"\n+ * All child endpoints should be registered here with method level @Path annotations.\n+ *\n+ */\n+@Path(\"/\")\n+public class RootResource {\n+\n+  private final AlertResource alertResource;\n+  private final AdminResource adminResource;\n+  private final AnomaliesResource anomaliesResource;\n+  private final ApplicationResource applicationResource;\n+  private final AutoOnboardResource autoOnboardResource;\n+  private final CacheResource cacheResource;\n+  private final ConfigResource configResource;\n+  private final CustomizedEventResource customizedEventResource;\n+  private final DashboardResource dashboardResource;\n+  private final DataResource dataResource;\n+  private final DatasetAutoOnboardResource datasetAutoOnboardResource;\n+  private final DetectionResource detectionResource;\n+  private final DetectionAlertResource detectionAlertResource;\n+  private final EntityMappingResource entityMappingResource;\n+  private final OnboardDatasetMetricResource onboardDatasetMetricResource;\n+  private final SqlDataSourceResource sqlDataSourceResource;\n+  private final ThirdEyeResource thirdEyeResource;\n+  private final UserDashboardResource userDashboardResource;\n+  private final YamlResource yamlResource;\n+\n+  @Inject\n+  public RootResource(", "originalCommit": "1494573ebc40677a30c4baa5f8055c2b13ba2d6a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYxMDk5Mw==", "url": "https://github.com/apache/pinot/pull/5808#discussion_r466610993", "bodyText": "Thanks for trying this out. Really appreciate it. I missed adding the @Api Tag to the RootResource. Fixed it.", "author": "suvodeep-pyne", "createdAt": "2020-08-06T18:38:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU4OTc0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcwNzMwNw==", "url": "https://github.com/apache/pinot/pull/5808#discussion_r466707307", "bodyText": "it seems this one - AnomalySearchResource  is not added to the RootResource.", "author": "jihaozh", "createdAt": "2020-08-06T21:55:03Z", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/dashboard/ThirdEyeDashboardApplication.java", "diffHunk": "@@ -139,36 +114,11 @@ public void run(ThirdEyeDashboardConfiguration config, Environment env)\n     final JerseyEnvironment jersey = env.jersey();\n     injector = Guice.createInjector(new ThirdEyeDashboardModule(config, env, DAO_REGISTRY));\n     Stream.of(\n-        DetectionConfigurationResource.class,\n-        DatasetAutoOnboardResource.class,\n-        DashboardResource.class,\n-        CacheResource.class,\n         AnomalyResource.class,\n-        EntityManagerResource.class,\n-        MetricConfigResource.class,\n-        DatasetConfigResource.class,\n-        AdminResource.class,\n-        SummaryResource.class,\n-        ThirdEyeResource.class,\n-        DataResource.class,\n-        AnomaliesResource.class,\n-        EntityMappingResource.class,\n-        OnboardDatasetMetricResource.class,\n-        AutoOnboardResource.class,\n-        ConfigResource.class,\n-        CustomizedEventResource.class,\n-        AnomalyFlattenResource.class,\n-        UserDashboardResource.class,\n-        ApplicationResource.class,\n-        DetectionResource.class,\n-        DetectionAlertResource.class,\n-        YamlResource.class,\n-        SqlDataSourceResource.class,\n-        AlertResource.class,\n-        RootCauseTemplateResource.class,\n-        RootCauseSessionResource.class,\n         RootCauseMetricResource.class,\n-        AnomalySearchResource.class", "originalCommit": "33e62ce8f6dfe8e146003fdaa68f0a411a64c3a8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc3MzA5OA==", "url": "https://github.com/apache/pinot/pull/5808#discussion_r466773098", "bodyText": "Yes. Fixed it. I figured out that this one was added in the last couple of days. So the problem for this PR is that since it refactors Resource classes, it needs to be merged quickly else it has to be updated with every incoming resource PR.", "author": "suvodeep-pyne", "createdAt": "2020-08-07T01:36:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcwNzMwNw=="}], "type": "inlineReview"}, {"oid": "5a5e31c81a595f7f52e086ea01ed98a5026faf0a", "url": "https://github.com/apache/pinot/commit/5a5e31c81a595f7f52e086ea01ed98a5026faf0a", "message": "[TE] Dashboard Resource Refactor\n\nThis change refactors the resource classes.\n - Created a RootResource to hold the \"/\" namespace\n - Most dependencies have been moved to this resource simplifying the DashboardServer", "committedDate": "2020-08-11T19:30:12Z", "type": "commit"}, {"oid": "8594eac7001a836be97572a00607a27281dac347", "url": "https://github.com/apache/pinot/commit/8594eac7001a836be97572a00607a27281dac347", "message": "[TE] Dashboard Resource Refactor\n\nThis change refactors the resource classes.\n - Created a RootResource to hold the \"/\" namespace\n - Most dependencies have been moved to this resource simplifying the DashboardServer", "committedDate": "2020-08-11T19:30:12Z", "type": "commit"}, {"oid": "f6135752d8810f7470ded98d487e694849b0bea5", "url": "https://github.com/apache/pinot/commit/f6135752d8810f7470ded98d487e694849b0bea5", "message": "[TE] Dashboard Resource Refactor\n\nThis change refactors the resource classes.\n - Created a RootResource to hold the \"/\" namespace\n - Most dependencies have been moved to this resource simplifying the DashboardServer", "committedDate": "2020-08-11T19:30:12Z", "type": "commit"}, {"oid": "3d0128fe00d4da9e2b8f3fd5ea98302cf1d2f3b7", "url": "https://github.com/apache/pinot/commit/3d0128fe00d4da9e2b8f3fd5ea98302cf1d2f3b7", "message": "[TE] Dashboard Resource Refactor\n\nThis change refactors the resource classes.\n - Created a RootResource to hold the \"/\" namespace\n - Most dependencies have been moved to this resource simplifying the DashboardServer", "committedDate": "2020-08-11T19:30:43Z", "type": "commit"}, {"oid": "52c33c4c61d763ab8863ede70447dc6e5f2c995f", "url": "https://github.com/apache/pinot/commit/52c33c4c61d763ab8863ede70447dc6e5f2c995f", "message": "[TE] Dashboard Resource Refactor\n\nThis change refactors the resource classes.\n - Created a RootResource to hold the \"/\" namespace\n - Most dependencies have been moved to this resource simplifying the DashboardServer", "committedDate": "2020-08-11T19:30:43Z", "type": "commit"}, {"oid": "13a426f9dee3e5b7de70e6c13a5ad26bccf60c49", "url": "https://github.com/apache/pinot/commit/13a426f9dee3e5b7de70e6c13a5ad26bccf60c49", "message": "[TE] Dashboard Resource Refactor\n\nThis change refactors the resource classes.\n - Created a RootResource to hold the \"/\" namespace\n - Most dependencies have been moved to this resource simplifying the DashboardServer", "committedDate": "2020-08-11T19:30:43Z", "type": "commit"}, {"oid": "dedf83b5880f7dfa1bbf66595361e1cff582229b", "url": "https://github.com/apache/pinot/commit/dedf83b5880f7dfa1bbf66595361e1cff582229b", "message": "[TE] Dashboard Resource Refactor\n\nThis change refactors the resource classes.\n - Created a RootResource to hold the \"/\" namespace\n - Most dependencies have been moved to this resource simplifying the DashboardServer\n\n Rebasing and resolving conflicts", "committedDate": "2020-08-11T19:30:43Z", "type": "commit"}, {"oid": "c768cd6e12642a80898bf8a2915c9356f7e8316d", "url": "https://github.com/apache/pinot/commit/c768cd6e12642a80898bf8a2915c9356f7e8316d", "message": "[TE] Dashboard Resource Refactor\n\nThis change refactors the resource classes.\n - Created a RootResource to hold the \"/\" namespace\n - Most dependencies have been moved to this resource simplifying the DashboardServer\n\nFixed Swagger Documentation for RootResource", "committedDate": "2020-08-11T19:30:43Z", "type": "commit"}, {"oid": "a2939b7feeb5ba9ff1f502ba9b6a29aebba85727", "url": "https://github.com/apache/pinot/commit/a2939b7feeb5ba9ff1f502ba9b6a29aebba85727", "message": "[TE] Dashboard Resource Refactor\n\nThis change refactors the resource classes.\n - Created a RootResource to hold the \"/\" namespace\n - Most dependencies have been moved to this resource simplifying the DashboardServer\n\nApplied @Singleton to all resource classes.", "committedDate": "2020-08-11T19:30:43Z", "type": "commit"}, {"oid": "ddd0e9e4b94a89fc131d6e1d36b0e7e62b264a59", "url": "https://github.com/apache/pinot/commit/ddd0e9e4b94a89fc131d6e1d36b0e7e62b264a59", "message": "[TE] Dashboard Resource Refactor\n\nThis change refactors the resource classes.\n - Created a RootResource to hold the \"/\" namespace\n - Most dependencies have been moved to this resource simplifying the DashboardServer\n\nAdded AnomalySearchResource", "committedDate": "2020-08-11T19:30:43Z", "type": "commit"}, {"oid": "fd6d2fab14e9d8dbc5b86e4095710d1d581ce2c9", "url": "https://github.com/apache/pinot/commit/fd6d2fab14e9d8dbc5b86e4095710d1d581ce2c9", "message": "[TE] Dashboard Resource Refactor\n\nThis change refactors the resource classes.\n - Created a RootResource to hold the \"/\" namespace\n - Most dependencies have been moved to this resource simplifying the DashboardServer\n\nFixed RCA requests. Jersey throws 404.\nDashboardResource and AnomalyResource are both tagged with @Path(\"dashboard\") which confuses jersey", "committedDate": "2020-08-11T19:30:43Z", "type": "commit"}, {"oid": "2a205584bb96164b87897923ca01b7b2d08c4d5f", "url": "https://github.com/apache/pinot/commit/2a205584bb96164b87897923ca01b7b2d08c4d5f", "message": "[TE] Dashboard Resource Refactor\n\nThis change refactors the resource classes.\n - Created a RootResource to hold the \"/\" namespace\n - Most dependencies have been moved to this resource simplifying the DashboardServer\n\nResolved conflicts. Added AnomalyDetectionResource path to RootResource", "committedDate": "2020-08-11T19:33:56Z", "type": "commit"}, {"oid": "2a205584bb96164b87897923ca01b7b2d08c4d5f", "url": "https://github.com/apache/pinot/commit/2a205584bb96164b87897923ca01b7b2d08c4d5f", "message": "[TE] Dashboard Resource Refactor\n\nThis change refactors the resource classes.\n - Created a RootResource to hold the \"/\" namespace\n - Most dependencies have been moved to this resource simplifying the DashboardServer\n\nResolved conflicts. Added AnomalyDetectionResource path to RootResource", "committedDate": "2020-08-11T19:33:56Z", "type": "forcePushed"}]}