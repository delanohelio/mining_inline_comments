{"pr_number": 6032, "pr_title": "Improve the realtime time creation unit test", "pr_createdAt": "2020-09-17T23:37:59Z", "pr_url": "https://github.com/apache/pinot/pull/6032", "timeline": [{"oid": "295371e8b3f301783f6f210ffc0494b441047bd6", "url": "https://github.com/apache/pinot/commit/295371e8b3f301783f6f210ffc0494b441047bd6", "message": "Improve the realtime time column validation\n\n1. Added the precondition check for time interval from segment metadata\n2. Added unit tests", "committedDate": "2020-09-17T23:38:50Z", "type": "forcePushed"}, {"oid": "cb5e34e47474d071e45e17a51535f55a26bc7395", "url": "https://github.com/apache/pinot/commit/cb5e34e47474d071e45e17a51535f55a26bc7395", "message": "Improve the realtime time creation unit test\n\n1. Added the precondition check for time interval from segment metadata\n2. Added the unit test to check the case when the invalid time column name\n   is configured in the table config", "committedDate": "2020-09-17T23:52:43Z", "type": "commit"}, {"oid": "cb5e34e47474d071e45e17a51535f55a26bc7395", "url": "https://github.com/apache/pinot/commit/cb5e34e47474d071e45e17a51535f55a26bc7395", "message": "Improve the realtime time creation unit test\n\n1. Added the precondition check for time interval from segment metadata\n2. Added the unit test to check the case when the invalid time column name\n   is configured in the table config", "committedDate": "2020-09-17T23:52:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY0NTA4OA==", "url": "https://github.com/apache/pinot/pull/6032#discussion_r490645088", "bodyText": "Consumption will stop if this condition hits. Are we sure that is what we want?", "author": "mcvsubbu", "createdAt": "2020-09-18T01:14:43Z", "path": "pinot-controller/src/main/java/org/apache/pinot/controller/helix/core/realtime/PinotLLCRealtimeSegmentManager.java", "diffHunk": "@@ -504,6 +504,8 @@ private LLCRealtimeSegmentZKMetadata updateCommittingSegmentZKMetadata(String re\n     committingSegmentZKMetadata.setDownloadUrl(isPeerURL(committingSegmentDescriptor.getSegmentLocation())\n         ? CommonConstants.Segment.METADATA_URI_FOR_PEER_DOWNLOAD : committingSegmentDescriptor.getSegmentLocation());\n     committingSegmentZKMetadata.setCrc(Long.valueOf(segmentMetadata.getCrc()));\n+    Preconditions.checkNotNull(segmentMetadata.getTimeInterval(),", "originalCommit": "cb5e34e47474d071e45e17a51535f55a26bc7395", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY0ODQwMw==", "url": "https://github.com/apache/pinot/pull/6032#discussion_r490648403", "bodyText": "@mcvsubbu This condition should not happen after the fix from #5966. When this happens, the realtime segment commit would anyway fail and the consumption would be stopped due to the null pointer exception. (egmentMetadata.getTimeInterval().getStartMillis() gets called at the following line). I'm just trying to add more information to the logs here since the log message was not informative when we hit that.\nWe recently saw the null pointer error issue (and the consumption actually stopped) when the time column is misconfigured.\n2020/09/17 20:36:52.666 ERROR [SegmentCompletionFSM_XXXXX__3__0__20200915T2142Z] [grizzly-http-server-3] [pinot-controller] [] Caught exception while committing segment metadata for segment: XXXXX__3__0__20200915T2142Z\njava.lang.NullPointerException: null", "author": "snleee", "createdAt": "2020-09-18T01:27:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY0NTA4OA=="}], "type": "inlineReview"}]}