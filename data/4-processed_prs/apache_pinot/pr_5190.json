{"pr_number": 5190, "pr_title": "Nightly publish to bintray", "pr_createdAt": "2020-03-27T03:00:01Z", "pr_url": "https://github.com/apache/pinot/pull/5190", "timeline": [{"oid": "379c56066617fa8c4ff48038125ec5c5f8e9fb47", "url": "https://github.com/apache/pinot/commit/379c56066617fa8c4ff48038125ec5c5f8e9fb47", "message": "Add logic", "committedDate": "2020-03-27T04:02:53Z", "type": "forcePushed"}, {"oid": "f01388ae390885cada5613d6dd621732bf70a11c", "url": "https://github.com/apache/pinot/commit/f01388ae390885cada5613d6dd621732bf70a11c", "message": "Add logic", "committedDate": "2020-03-27T04:27:58Z", "type": "forcePushed"}, {"oid": "88df0592d823298baab6a84d0d27897f2c5d57b4", "url": "https://github.com/apache/pinot/commit/88df0592d823298baab6a84d0d27897f2c5d57b4", "message": "Add logic", "committedDate": "2020-03-27T04:42:32Z", "type": "forcePushed"}, {"oid": "8344358098a10278dbdc49290aa27c3b82a844e3", "url": "https://github.com/apache/pinot/commit/8344358098a10278dbdc49290aa27c3b82a844e3", "message": "Add logic", "committedDate": "2020-03-27T04:54:00Z", "type": "forcePushed"}, {"oid": "6966dfd0a5797076e599c2d8fe9cdc546716e2dc", "url": "https://github.com/apache/pinot/commit/6966dfd0a5797076e599c2d8fe9cdc546716e2dc", "message": "Add logic", "committedDate": "2020-03-27T05:39:43Z", "type": "forcePushed"}, {"oid": "ab32e0b327cfa85d659be11d165edc28c8c4b2ac", "url": "https://github.com/apache/pinot/commit/ab32e0b327cfa85d659be11d165edc28c8c4b2ac", "message": "Deploy pinot to bintray", "committedDate": "2020-03-30T18:22:51Z", "type": "commit"}, {"oid": "e403e671a7798632d14f922819480a67a1492397", "url": "https://github.com/apache/pinot/commit/e403e671a7798632d14f922819480a67a1492397", "message": "Fix the build", "committedDate": "2020-03-30T18:22:51Z", "type": "commit"}, {"oid": "06c34c3ed77718a9c54936d2e3129ea1fcae61db", "url": "https://github.com/apache/pinot/commit/06c34c3ed77718a9c54936d2e3129ea1fcae61db", "message": "Testing", "committedDate": "2020-03-30T18:22:51Z", "type": "commit"}, {"oid": "ef10234dab458d3dee6616add4fdbabb75273020", "url": "https://github.com/apache/pinot/commit/ef10234dab458d3dee6616add4fdbabb75273020", "message": "Add relative path", "committedDate": "2020-03-30T18:22:51Z", "type": "commit"}, {"oid": "83eadbb25e3259506dd722f9a982729b5d4cf9ac", "url": "https://github.com/apache/pinot/commit/83eadbb25e3259506dd722f9a982729b5d4cf9ac", "message": "Change versions before deploying to bintray", "committedDate": "2020-03-30T18:23:17Z", "type": "commit"}, {"oid": "44ee85495858df322d881cbb7e29ad0537253045", "url": "https://github.com/apache/pinot/commit/44ee85495858df322d881cbb7e29ad0537253045", "message": "Fix pom files", "committedDate": "2020-03-30T18:24:03Z", "type": "commit"}, {"oid": "f36c66f6efdf88dd0a4b6bc6802fa13621038895", "url": "https://github.com/apache/pinot/commit/f36c66f6efdf88dd0a4b6bc6802fa13621038895", "message": "Add logic", "committedDate": "2020-03-30T18:25:20Z", "type": "commit"}, {"oid": "ead2ca629e514e188cfaf31e2f3fd114baf8efd5", "url": "https://github.com/apache/pinot/commit/ead2ca629e514e188cfaf31e2f3fd114baf8efd5", "message": "Finalize the PR", "committedDate": "2020-03-30T18:25:20Z", "type": "commit"}, {"oid": "86c4c17b14acc70154f56ac9dff43b626dc411d1", "url": "https://github.com/apache/pinot/commit/86c4c17b14acc70154f56ac9dff43b626dc411d1", "message": "Rebase with master branch", "committedDate": "2020-03-30T18:33:22Z", "type": "commit"}, {"oid": "86c4c17b14acc70154f56ac9dff43b626dc411d1", "url": "https://github.com/apache/pinot/commit/86c4c17b14acc70154f56ac9dff43b626dc411d1", "message": "Rebase with master branch", "committedDate": "2020-03-30T18:33:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNDgyMQ==", "url": "https://github.com/apache/pinot/pull/5190#discussion_r400414821", "bodyText": "This will work. Thank you for coming up with this solution. Dealing with versions is very painful in Maven + CI/CD without unreliable -SNAPSHOTs.\nCurious, where did you find inspiration on how achieve this version bumping?", "author": "mockitoguy", "createdAt": "2020-03-30T18:46:13Z", "path": ".travis/.travis_nightly_build.sh", "diffHunk": "@@ -0,0 +1,31 @@\n+#!/bin/bash -x\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+#\n+\n+if [ -n \"${DEPLOY_BUILD_OPTS}\" ]; then\n+  echo \"Deploying to bintray\"\n+\n+  BUILD_VERSION=$(grep -E \"<revision>(.*)</revision>\" pom.xml | cut -d'>' -f2 | cut -d'<' -f1)\n+  echo \"Current build version: $BUILD_VERSION${DEV_VERSION}\"\n+  mvn versions:set -DnewVersion=\"$BUILD_VERSION${DEV_VERSION}\" -q -B\n+  mvn versions:commit -q -B", "originalCommit": "86c4c17b14acc70154f56ac9dff43b626dc411d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ3NjU3Mw==", "url": "https://github.com/apache/pinot/pull/5190#discussion_r400476573", "bodyText": "I tested it by uploading the generated jars without setting the version, while the bintray returns 409 conflicts when uploading the pom files. Then I feel that may be due the same checksum of the pom files that's already uploaded. Thus, bumping up version might be the option before publishing them.\nAnother obstacle I found here is that travis doesn't work well with mvn help:evaluate -Dexpression=revision -q -DforceStdout, which is used to fetch properties from pom file; it returns nothing.\nI've documented all the traps I met in that instruction.", "author": "jackjlli", "createdAt": "2020-03-30T20:34:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNDgyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxODEwNg==", "url": "https://github.com/apache/pinot/pull/5190#discussion_r400418106", "bodyText": "Looks great!", "author": "mockitoguy", "createdAt": "2020-03-30T18:51:47Z", "path": "pinot-broker/pom.xml", "diffHunk": "@@ -19,12 +19,14 @@\n     under the License.\n \n -->\n-<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n   <modelVersion>4.0.0</modelVersion>\n   <parent>\n     <artifactId>pinot</artifactId>\n     <groupId>org.apache.pinot</groupId>\n-    <version>0.4.0-SNAPSHOT</version>\n+    <version>${revision}${sha1}</version>\n+    <relativePath>..</relativePath>", "originalCommit": "86c4c17b14acc70154f56ac9dff43b626dc411d1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxOTQ1Ng==", "url": "https://github.com/apache/pinot/pull/5190#discussion_r400419456", "bodyText": "I asked @varidhigarg to verify if versions like 0.4.0-dev-1, 0.4.0-dev-2 will work with auto-ELR. We believe it should work so please don't block this PR on this verification - it should not be a blocker for merging this in. Thanks!!", "author": "mockitoguy", "createdAt": "2020-03-30T18:53:56Z", "path": ".travis/.travis_set_deploy_build_opts.sh", "diffHunk": "@@ -0,0 +1,26 @@\n+#!/bin/bash -x\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+#\n+\n+if [ \"$TRAVIS_EVENT_TYPE\" = \"cron\" ]; then\n+  export DEV_VERSION=\"-dev-${TRAVIS_BUILD_NUMBER}\"", "originalCommit": "86c4c17b14acc70154f56ac9dff43b626dc411d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ5NjMyMA==", "url": "https://github.com/apache/pinot/pull/5190#discussion_r400496320", "bodyText": "As long as the mavenmetadata.xml is updated with the latest version we are good to go.", "author": "varidhigarg", "createdAt": "2020-03-30T21:10:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxOTQ1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY0OTY4MQ==", "url": "https://github.com/apache/pinot/pull/5190#discussion_r400649681", "bodyText": "In this case, what will be the behavior of command mvn release how is version been updated there?", "author": "xiangfu0", "createdAt": "2020-03-31T05:20:37Z", "path": "pom.xml", "diffHunk": "@@ -96,8 +97,18 @@\n   <!-- Apache project inception year for generating correct NOTICE file for jar bundle. -->\n   <inceptionYear>2018</inceptionYear>\n \n+  <distributionManagement>\n+    <repository>\n+      <id>bintray-linkedin-maven</id>\n+      <name>linkedin-maven</name>\n+      <url>https://api.bintray.com/maven/linkedin/maven/pinot/;publish=1</url>\n+    </repository>\n+  </distributionManagement>\n+\n   <properties>\n     <pinot.root>${basedir}</pinot.root>\n+    <revision>0.4.0</revision>", "originalCommit": "86c4c17b14acc70154f56ac9dff43b626dc411d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY1OTYwMg==", "url": "https://github.com/apache/pinot/pull/5190#discussion_r400659602", "bodyText": "Since now the version consists of revision and sha1, you can set the version number and then publish the release. An instruction can be found in the link below:\nhttps://techluminary.com/discard-maven-release-plugin-with-a-new-approach/", "author": "jackjlli", "createdAt": "2020-03-31T05:54:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY0OTY4MQ=="}], "type": "inlineReview"}]}