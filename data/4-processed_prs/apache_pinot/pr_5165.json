{"pr_number": 5165, "pr_title": "[TE] Fix issue of displaying latests data in the speed-up case", "pr_createdAt": "2020-03-19T01:25:43Z", "pr_url": "https://github.com/apache/pinot/pull/5165", "timeline": [{"oid": "4351b6d9c8d1b62ee749c84763b4938a06b154a4", "url": "https://github.com/apache/pinot/commit/4351b6d9c8d1b62ee749c84763b4938a06b154a4", "message": "[TE] Fix issue of displaying latests data in the speed-up case", "committedDate": "2020-03-19T00:58:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg==", "url": "https://github.com/apache/pinot/pull/5165#discussion_r395197812", "bodyText": "Why we generate the window larger than endTime?\nShould we fix the window generation logic instead of patching here?", "author": "xiaohui-sun", "createdAt": "2020-03-19T17:27:33Z", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/wrapper/AnomalyDetectorWrapper.java", "diffHunk": "@@ -290,6 +291,16 @@ long getLastTimeStamp() {\n           DateTime startTime = endTime.minus(windowSizePeriod);\n           monitoringWindows.add(new Interval(startTime, endTime));\n         }\n+        if (isSpeedUp) {", "originalCommit": "4351b6d9c8d1b62ee749c84763b4938a06b154a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM3Mzg0NA==", "url": "https://github.com/apache/pinot/pull/5165#discussion_r395373844", "bodyText": "Good point. Changed it.", "author": "vincentchenjl", "createdAt": "2020-03-19T23:25:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM3NTE2NQ==", "url": "https://github.com/apache/pinot/pull/5165#discussion_r395375165", "bodyText": "Thanks for the change. I mean can we change getMonitoringWindows()?\nThis is the original place we generate the windows.", "author": "xiaohui-sun", "createdAt": "2020-03-19T23:30:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM3NzAyNw==", "url": "https://github.com/apache/pinot/pull/5165#discussion_r395377027", "bodyText": "Yes, that's where I added the check.", "author": "vincentchenjl", "createdAt": "2020-03-19T23:36:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTcxOTMxOA==", "url": "https://github.com/apache/pinot/pull/5165#discussion_r395719318", "bodyText": "Sorry I didn't notice that.\nSince here is the place all the windows are generated. I don't see a reason why you need to modify existing windows instead of adding the check when generating the windows.\nCan we just change L289 from\nDateTime endTime = monitoringEndTime.minus(windowDelayPeriod);\nTo:\nDateTime windowEndTime = Math.min(monitoringEndTime.minus(windowDelayPeriod), endTime)?", "author": "xiaohui-sun", "createdAt": "2020-03-20T15:36:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwODA1Mw==", "url": "https://github.com/apache/pinot/pull/5165#discussion_r395908053", "bodyText": "We cannot change the endTime here directly, as it can generate windows that overlaps the previous windows. Either we change the endTime of latest interval or we need to change the logic of generating the windows completely.", "author": "vincentchenjl", "createdAt": "2020-03-20T21:58:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjAwMjYzMg==", "url": "https://github.com/apache/pinot/pull/5165#discussion_r396002632", "bodyText": "Why it can generate windows that overlaps the previous windows? Can we sync offline?", "author": "xiaohui-sun", "createdAt": "2020-03-21T15:40:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjAwNDcwMw==", "url": "https://github.com/apache/pinot/pull/5165#discussion_r396004703", "bodyText": "I got your point. Then we can do a little trick - modify endTime after using it.\nHow about the following? @vincentchenjl\nList monitoringWindows = new ArrayList<>();\nList monitoringWindowEndTimes = getMonitoringWindowEndTimes();\nDateTime detectionEndTime = new DateTime(endTime, dateTimeZone).minus(windowDelayPeriod);\nfor (DateTime monitoringEndTime : monitoringWindowEndTimes) {\nDateTime endTime = monitoringEndTime.minus(windowDelayPeriod);\nDateTime startTime = endTime.minus(windowSizePeriod);\nendTime = endTime.isAfter(detectionEndTime) ? detectionEndTime : endTime;\nmonitoringWindows.add(new Interval(startTime, endTime));\n}", "author": "xiaohui-sun", "createdAt": "2020-03-21T16:07:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2MjY4Mw==", "url": "https://github.com/apache/pinot/pull/5165#discussion_r396762683", "bodyText": "Done.", "author": "vincentchenjl", "createdAt": "2020-03-23T21:18:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjgxMzAwNw==", "url": "https://github.com/apache/pinot/pull/5165#discussion_r396813007", "bodyText": "Great.  Let's not fix for the symptom. Fix for the root cause, as early as possible.", "author": "xiaohui-sun", "createdAt": "2020-03-23T23:14:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg=="}], "type": "inlineReview"}, {"oid": "31e68a6e09981a536837faf13906a7ea588a10aa", "url": "https://github.com/apache/pinot/commit/31e68a6e09981a536837faf13906a7ea588a10aa", "message": "address comment", "committedDate": "2020-03-19T23:22:11Z", "type": "commit"}, {"oid": "ab15a50b373aab96599406c3993bf72e0ea7486d", "url": "https://github.com/apache/pinot/commit/ab15a50b373aab96599406c3993bf72e0ea7486d", "message": "minor change", "committedDate": "2020-03-19T23:23:29Z", "type": "commit"}, {"oid": "29410a54e0dbec91c1f7ef218e11a2dd52a262f9", "url": "https://github.com/apache/pinot/commit/29410a54e0dbec91c1f7ef218e11a2dd52a262f9", "message": "address comments", "committedDate": "2020-03-23T21:17:19Z", "type": "commit"}]}