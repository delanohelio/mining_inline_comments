{"pr_number": 5508, "pr_title": "Enhance quickstart script for CI tests", "pr_createdAt": "2020-06-06T00:42:34Z", "pr_url": "https://github.com/apache/pinot/pull/5508", "timeline": [{"oid": "936329917a996f1357054f9a03a5914dc9a8ef18", "url": "https://github.com/apache/pinot/commit/936329917a996f1357054f9a03a5914dc9a8ef18", "message": "In Travis quickstart, wait for process finishing clean up and terminate\n\nUse TERM signal instead of KILL so that process can execute the shutdown hook\nWait for process to fully terminate before starting the next one\n\nFor all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed", "committedDate": "2020-06-06T01:04:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg5MTUyOA==", "url": "https://github.com/apache/pinot/pull/5508#discussion_r436891528", "bodyText": "this is still not tolerant of failure in curl. The way to do this will be something like\nx=$(curl ...); if [ $? -ne 0 ]; then continue; fi; echo \"$x\" | jq ...", "author": "mcvsubbu", "createdAt": "2020-06-08T17:57:51Z", "path": ".travis/.travis_quickstart.sh", "diffHunk": "@@ -69,7 +75,7 @@ sleep 30\n for i in $(seq 1 200)\n do\n   COUNT_STAR_RES=`curl -X POST --header 'Accept: application/json'  -d '{\"sql\":\"select count(*) from meetupRsvp limit 1\",\"trace\":false}' http://localhost:8000/query/sql | jq '.resultTable.rows[0][0]'`\n- if [[ \"${COUNT_STAR_RES}\" =~ ^[0-9]+$ ]]; then\n+  if [[ \"${COUNT_STAR_RES}\" =~ ^[0-9]+$ ]]; then", "originalCommit": "936329917a996f1357054f9a03a5914dc9a8ef18", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA0NzM1Ng==", "url": "https://github.com/apache/pinot/pull/5508#discussion_r437047356", "bodyText": "Added the handling of the error response", "author": "Jackie-Jiang", "createdAt": "2020-06-08T23:01:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg5MTUyOA=="}], "type": "inlineReview"}, {"oid": "7103132afc07f1a329b11fd91d77657ae74315f7", "url": "https://github.com/apache/pinot/commit/7103132afc07f1a329b11fd91d77657ae74315f7", "message": "Fix Travis quickstart tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready\n- Break each JDK version into a different test", "committedDate": "2020-06-08T22:34:29Z", "type": "forcePushed"}, {"oid": "8aec8aba5b1e24d700e2292b6678807a27ea68e6", "url": "https://github.com/apache/pinot/commit/8aec8aba5b1e24d700e2292b6678807a27ea68e6", "message": "Fix Travis quickstart tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready\n- Break each JDK version into a different test", "committedDate": "2020-06-08T22:47:28Z", "type": "forcePushed"}, {"oid": "d9c610f096da05bdd52b0831fdbe68f88c0c2dd4", "url": "https://github.com/apache/pinot/commit/d9c610f096da05bdd52b0831fdbe68f88c0c2dd4", "message": "Fix Travis quickstart tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready\n- Break each JDK version into a different test", "committedDate": "2020-06-08T22:59:53Z", "type": "forcePushed"}, {"oid": "d9c610f096da05bdd52b0831fdbe68f88c0c2dd4", "url": "https://github.com/apache/pinot/commit/d9c610f096da05bdd52b0831fdbe68f88c0c2dd4", "message": "Fix Travis quickstart tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready\n- Break each JDK version into a different test", "committedDate": "2020-06-08T22:59:53Z", "type": "forcePushed"}, {"oid": "8771647d55163866f9c9db431c8de64cc6755ede", "url": "https://github.com/apache/pinot/commit/8771647d55163866f9c9db431c8de64cc6755ede", "message": "Fix Travis quickstart tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready\n- Break each JDK version into a different test", "committedDate": "2020-06-09T00:15:25Z", "type": "forcePushed"}, {"oid": "d2747115fcae822eef35ce269a755d15f68ef3d8", "url": "https://github.com/apache/pinot/commit/d2747115fcae822eef35ce269a755d15f68ef3d8", "message": "Fix Travis quickstart tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready\n- Break each JDK version into a different test", "committedDate": "2020-06-09T00:44:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzEzMDg5NQ==", "url": "https://github.com/apache/pinot/pull/5508#discussion_r437130895", "bodyText": "how about sleep 2 or 3 seconds instead of just 1 ?", "author": "xiangfu0", "createdAt": "2020-06-09T04:29:29Z", "path": ".travis/.travis_quickstart.sh", "diffHunk": "@@ -30,60 +30,75 @@ java -version\n \n # Quickstart\n DIST_BIN_DIR=`ls -d pinot-distribution/target/apache-pinot-*/apache-pinot-*`\n-cd ${DIST_BIN_DIR}\n+cd \"${DIST_BIN_DIR}\"\n \n # Test quick-start-batch\n bin/quick-start-batch.sh &\n PID=$!\n \n PASS=0\n+\n+# Wait for 30 seconds for table to be set up, then at most 5 minutes to reach the desired state\n sleep 30\n-for i in $(seq 1 200)\n+for i in $(seq 1 300)\n do\n-  COUNT_STAR_RES=`curl -X POST --header 'Accept: application/json'  -d '{\"sql\":\"select count(*) from baseballStats limit 1\",\"trace\":false}' http://localhost:8000/query/sql | jq '.resultTable.rows[0][0]'`\n-  if [[ \"${COUNT_STAR_RES}\" =~ ^[0-9]+$ ]]; then\n-    if [ \"${COUNT_STAR_RES}\" -eq 97889 ]; then\n+  QUERY_RES=`curl -X POST --header 'Accept: application/json'  -d '{\"sql\":\"select count(*) from baseballStats limit 1\",\"trace\":false}' http://localhost:8000/query/sql`\n+  if [ $? -eq 0 ]; then\n+    COUNT_STAR_RES=`echo \"${QUERY_RES}\" | jq '.resultTable.rows[0][0]'`\n+    if [[ \"${COUNT_STAR_RES}\" =~ ^[0-9]+$ ]] && [ \"${COUNT_STAR_RES}\" -eq 97889 ]; then\n       PASS=1\n       break\n     fi\n   fi\n   sleep 1", "originalCommit": "d2747115fcae822eef35ce269a755d15f68ef3d8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc3MzM4OQ==", "url": "https://github.com/apache/pinot/pull/5508#discussion_r437773389", "bodyText": "Make it 150 iterations and sleep 2. Also updated the script for Github Actions", "author": "Jackie-Jiang", "createdAt": "2020-06-09T23:15:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzEzMDg5NQ=="}], "type": "inlineReview"}, {"oid": "d3414f9ce2dc56ee99ba35f4f8bcd1bacb93c2bd", "url": "https://github.com/apache/pinot/commit/d3414f9ce2dc56ee99ba35f4f8bcd1bacb93c2bd", "message": "Enhance quickstart script for CI tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready", "committedDate": "2020-06-09T23:12:59Z", "type": "forcePushed"}, {"oid": "53f2bee1bfce5c445d5f0038dcd17612546bd126", "url": "https://github.com/apache/pinot/commit/53f2bee1bfce5c445d5f0038dcd17612546bd126", "message": "Enhance quickstart script for CI tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready", "committedDate": "2020-06-10T01:16:04Z", "type": "forcePushed"}, {"oid": "475b6934f7b70e54987311dd25b969fd2e8fbae0", "url": "https://github.com/apache/pinot/commit/475b6934f7b70e54987311dd25b969fd2e8fbae0", "message": "Enhance quickstart script for CI tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready", "committedDate": "2020-06-10T02:09:09Z", "type": "commit"}, {"oid": "475b6934f7b70e54987311dd25b969fd2e8fbae0", "url": "https://github.com/apache/pinot/commit/475b6934f7b70e54987311dd25b969fd2e8fbae0", "message": "Enhance quickstart script for CI tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready", "committedDate": "2020-06-10T02:09:09Z", "type": "forcePushed"}]}