{"pr_number": 238, "pr_title": "Copy headers from factory options into grpc requests", "pr_createdAt": "2020-10-29T22:53:34Z", "pr_url": "https://github.com/temporalio/sdk-java/pull/238", "timeline": [{"oid": "3c8ed19d3554a1c099bf5a44c55997aee1db0c43", "url": "https://github.com/temporalio/sdk-java/commit/3c8ed19d3554a1c099bf5a44c55997aee1db0c43", "message": "Copy headers from factory options into grpc requests", "committedDate": "2020-10-29T22:49:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDY2MjIxMg==", "url": "https://github.com/temporalio/sdk-java/pull/238#discussion_r514662212", "bodyText": "It looks like this wouldn't allow binary headers. Should we just change options.headers type to io.grpc.Metadata?", "author": "mfateev", "createdAt": "2020-10-30T01:21:18Z", "path": "temporal-serviceclient/src/main/java/io/temporal/serviceclient/WorkflowServiceStubsImpl.java", "diffHunk": "@@ -138,7 +140,7 @@ public WorkflowServiceStubsImpl(\n         new GrpcMetricsInterceptor(options.getMetricsScope());\n     ClientInterceptor deadlineInterceptor = new GrpcDeadlineInterceptor(options);\n     GrpcTracingInterceptor tracingInterceptor = new GrpcTracingInterceptor();\n-    Metadata headers = new Metadata();\n+    Metadata headers = headersFrom(options.getHeaders());", "originalCommit": "3c8ed19d3554a1c099bf5a44c55997aee1db0c43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDY2NzYyNg==", "url": "https://github.com/temporalio/sdk-java/pull/238#discussion_r514667626", "bodyText": "Good call, let me do that, it would give more flexibility on the client side. Also factory options are tied to grpc anyways so exposing some grpc objects externally wouldn't be too bad. My only concern would be that it's not backwards compatible change, but then again this feature didn't work before so nobody should be relying on it now anyways.", "author": "vitarb", "createdAt": "2020-10-30T01:30:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDY2MjIxMg=="}], "type": "inlineReview"}, {"oid": "2720e87aaddf6d13dc0f2a2da7e1ec93b9ecbe8e", "url": "https://github.com/temporalio/sdk-java/commit/2720e87aaddf6d13dc0f2a2da7e1ec93b9ecbe8e", "message": "Propagate metadata object to options", "committedDate": "2020-10-30T01:41:44Z", "type": "commit"}, {"oid": "c0b6eb2cea049c1b044563105fa9fe54a22a0b35", "url": "https://github.com/temporalio/sdk-java/commit/c0b6eb2cea049c1b044563105fa9fe54a22a0b35", "message": "remove unused", "committedDate": "2020-10-30T01:43:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDcyMTQyNg==", "url": "https://github.com/temporalio/sdk-java/pull/238#discussion_r514721426", "bodyText": "I would merge options headers here. Mutating ones from the options is not clean.", "author": "mfateev", "createdAt": "2020-10-30T02:27:49Z", "path": "temporal-serviceclient/src/main/java/io/temporal/serviceclient/WorkflowServiceStubsImpl.java", "diffHunk": "@@ -138,7 +140,7 @@ public WorkflowServiceStubsImpl(\n         new GrpcMetricsInterceptor(options.getMetricsScope());\n     ClientInterceptor deadlineInterceptor = new GrpcDeadlineInterceptor(options);\n     GrpcTracingInterceptor tracingInterceptor = new GrpcTracingInterceptor();\n-    Metadata headers = new Metadata();\n+    Metadata headers = options.getHeaders();", "originalCommit": "c0b6eb2cea049c1b044563105fa9fe54a22a0b35", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDc0MjY3OA==", "url": "https://github.com/temporalio/sdk-java/pull/238#discussion_r514742678", "bodyText": "Done.", "author": "vitarb", "createdAt": "2020-10-30T02:49:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDcyMTQyNg=="}], "type": "inlineReview"}, {"oid": "762482ba7b35ef852e18cfbdcdf1ef6728752c18", "url": "https://github.com/temporalio/sdk-java/commit/762482ba7b35ef852e18cfbdcdf1ef6728752c18", "message": "Avoid mutating incoming metadata", "committedDate": "2020-10-30T02:46:37Z", "type": "commit"}]}