{"pr_number": 7791, "pr_title": "Add onUpdateHook and onShownHook in card.js", "pr_createdAt": "2020-11-29T01:18:57Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/7791", "timeline": [{"oid": "0ee9ecd88fa8ab1397c0fbd808f6eadc2c8d1821", "url": "https://github.com/ankidroid/Anki-Android/commit/0ee9ecd88fa8ab1397c0fbd808f6eadc2c8d1821", "message": "Add onUpdateHook and onShownHook in card.js", "committedDate": "2020-11-28T23:18:16Z", "type": "commit"}, {"oid": "8da853c30434537437cfabcbb0fa5acb3bd30848", "url": "https://github.com/ankidroid/Anki-Android/commit/8da853c30434537437cfabcbb0fa5acb3bd30848", "message": "Add anki-before-shown and anki-after-shown classes", "committedDate": "2020-12-01T13:18:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM0MDIwNw==", "url": "https://github.com/ankidroid/Anki-Android/pull/7791#discussion_r538340207", "bodyText": "Sorry about the late review, just came up as a \"changed file\" and I was curious.\nHas this been tested on an API 16 emulator? I don't believe that older versions of Android will support promises.", "author": "david-allison-1", "createdAt": "2020-12-08T13:00:24Z", "path": "AnkiDroid/src/main/assets/scripts/card.js", "diffHunk": "@@ -181,33 +181,58 @@ window.onload = function() {\n     window.location.href = \"#answer\";\n };\n \n+function _runHook(arr) {\n+    var promises = [];\n+\n+    for (var i = 0; i < arr.length; i++) {\n+        promises.push(arr[i]());\n+    }\n+\n+    return Promise.all(promises);", "originalCommit": "8da853c30434537437cfabcbb0fa5acb3bd30848", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM4MzQ0OQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/7791#discussion_r538383449", "bodyText": "Are they not getting Chrome updates? They should be getting Chrome updates.\nhttps://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\nSupports down to android 4.4.3, so yes, we likely blew up API16,17,18 - API19 is first with support\nWe'll need to either revert this or bump minSdkVersion\nI actually vote we bump minSdkVersion personally, I think it's time. It is not abandonment, the older users will have 2.14.x forever\nI vote for API19 first, not all the way to API21, that will keep us coincident with the actual need here even though API21 is tempting because it kills need for multidex, I think there are enough users on 19 we wait for at least a cycle\nI'll file a related issue\nNote this is not cavalier: I study the trailing per API user count semifrequently and I'm comfortable the data says this is the right move right now", "author": "mikehardy", "createdAt": "2020-12-08T13:43:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM0MDIwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM4MzY1NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/7791#discussion_r538383655", "bodyText": "Good catch btw @david-allison-1", "author": "mikehardy", "createdAt": "2020-12-08T13:43:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM0MDIwNw=="}], "type": "inlineReview"}]}