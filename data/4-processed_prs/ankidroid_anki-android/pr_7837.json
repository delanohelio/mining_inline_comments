{"pr_number": 7837, "pr_title": "Persist Whiteboard Pen Color ", "pr_createdAt": "2020-12-07T13:32:09Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/7837", "timeline": [{"oid": "1cdc995f4352551c8716cb4618d4aa114af7dd80", "url": "https://github.com/ankidroid/Anki-Android/commit/1cdc995f4352551c8716cb4618d4aa114af7dd80", "message": "TEST: Add tests for getForegroundColor\n\nTo be modified in 7834 - we want to handle the defaults", "committedDate": "2020-12-06T20:50:04Z", "type": "commit"}, {"oid": "a2b32e66ab9aeee789060bee9815311e38f66b9e", "url": "https://github.com/ankidroid/Anki-Android/commit/a2b32e66ab9aeee789060bee9815311e38f66b9e", "message": "LINT: Fix Whiteboard Lint Errors", "committedDate": "2020-12-06T21:01:28Z", "type": "commit"}, {"oid": "c2f959af83907d2e73d3a51032714802ff29c9b3", "url": "https://github.com/ankidroid/Anki-Android/commit/c2f959af83907d2e73d3a51032714802ff29c9b3", "message": "NF: Extract setPenColor\n\nUseful for 7834", "committedDate": "2020-12-06T21:45:42Z", "type": "commit"}, {"oid": "70d78fbf5168c5440d3a0365004710deac5896b5", "url": "https://github.com/ankidroid/Anki-Android/commit/70d78fbf5168c5440d3a0365004710deac5896b5", "message": "NF: ReviewerTest - make startReviewer static\n\nFor use in another class for testing issue 7834", "committedDate": "2020-12-07T13:15:49Z", "type": "commit"}, {"oid": "e354108c051dbbfa0794c0dd692e7dd66f2b0abe", "url": "https://github.com/ankidroid/Anki-Android/commit/e354108c051dbbfa0794c0dd692e7dd66f2b0abe", "message": "Persist Whiteboard Pen Color\n\nPersisted per deck, and night/light mode has different values\n\nFixes 7834", "committedDate": "2020-12-07T13:33:27Z", "type": "commit"}, {"oid": "e354108c051dbbfa0794c0dd692e7dd66f2b0abe", "url": "https://github.com/ankidroid/Anki-Android/commit/e354108c051dbbfa0794c0dd692e7dd66f2b0abe", "message": "Persist Whiteboard Pen Color\n\nPersisted per deck, and night/light mode has different values\n\nFixes 7834", "committedDate": "2020-12-07T13:33:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYxODgyNg==", "url": "https://github.com/ankidroid/Anki-Android/pull/7837#discussion_r537618826", "bodyText": "look at you all fancy and parameterized ;-)", "author": "mikehardy", "createdAt": "2020-12-07T15:56:41Z", "path": "AnkiDroid/src/test/java/com/ichi2/anki/WhiteboardDefaultForegroundColorTest.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/*\n+ *  Copyright (c) 2020 David Allison <davidallisongithub@gmail.com>\n+ *\n+ *  This program is free software; you can redistribute it and/or modify it under\n+ *  the terms of the GNU General Public License as published by the Free Software\n+ *  Foundation; either version 3 of the License, or (at your option) any later\n+ *  version.\n+ *\n+ *  This program is distributed in the hope that it will be useful, but WITHOUT ANY\n+ *  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A\n+ *  PARTICULAR PURPOSE. See the GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License along with\n+ *  this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package com.ichi2.anki;\n+\n+import android.content.Intent;\n+import android.graphics.Color;\n+\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.robolectric.ParameterizedRobolectricTestRunner;\n+\n+import java.util.Arrays;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+\n+@RunWith(ParameterizedRobolectricTestRunner.class)\n+public class WhiteboardDefaultForegroundColorTest extends RobolectricTest {\n+\n+    @ParameterizedRobolectricTestRunner.Parameter()\n+    public boolean mIsInverted;\n+\n+    @ParameterizedRobolectricTestRunner.Parameter(1)\n+    public boolean mIsMonochrome;\n+\n+    @ParameterizedRobolectricTestRunner.Parameter(2)\n+    public int mExpectedResult;\n+\n+    @ParameterizedRobolectricTestRunner.Parameters", "originalCommit": "1cdc995f4352551c8716cb4618d4aa114af7dd80", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzgzMzQ4NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/7837#discussion_r537833485", "bodyText": "I need to find/write a framework for this.\nParameterizedRobolectricTestRunner has a horrible API. Compare it to:\nhttps://docs.nunit.org/articles/nunit/writing-tests/attributes/testcase.html", "author": "david-allison-1", "createdAt": "2020-12-07T21:07:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYxODgyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg0MjM4Nw==", "url": "https://github.com/ankidroid/Anki-Android/pull/7837#discussion_r537842387", "bodyText": "\ud83e\udd14  at some point we're just going to konvert to the kool new way, it doesn't seem so bad in this case https://medium.com/@harmittaa/parametrized-tests-with-robolectric-3666c4794f6b", "author": "mikehardy", "createdAt": "2020-12-07T21:22:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYxODgyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg4NTE0Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/7837#discussion_r537885142", "bodyText": "https://github.com/Pragmatists/JUnitParams\npls\n\nI jest - last kommit in 2018, but please kan we do something better than drinking that koolaid", "author": "david-allison-1", "createdAt": "2020-12-07T22:35:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYxODgyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk0MDQzNQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/7837#discussion_r537940435", "bodyText": "yeah no Pragmatists/JUnitParams#169\noh, kotlin is koming, it's inevitable I think. I'm thinking of a konversion probably in the 2.17ish time frame, expecting 2.15/2.16 will be soaked up by rust infra", "author": "mikehardy", "createdAt": "2020-12-08T00:33:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYxODgyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYyMjc2Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/7837#discussion_r537622762", "bodyText": "interesting - what's the ideal resolution here? more specifically, what does \"reset\" mean? I thought robolectric used sqlite implementation from robolectric, configured for in-memory db and the tests were isolated so each test got it's own db clean?", "author": "mikehardy", "createdAt": "2020-12-07T16:01:33Z", "path": "AnkiDroid/src/test/java/com/ichi2/anki/RobolectricTest.java", "diffHunk": "@@ -96,6 +96,9 @@ public void setUp() {\n \n         //See: #6140 - This global ideally shouldn't exist, but it will cause crashes if set.\n         DialogHandler.discardMessage();\n+\n+        // BUG: We do not reset the MetaDB", "originalCommit": "e354108c051dbbfa0794c0dd692e7dd66f2b0abe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzc0MjA3MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/7837#discussion_r537742071", "bodyText": "I thought robolectric used sqlite implementation from robolectric, configured for in-memory db and the tests were isolated so each test got it's own db clean?\n\nThe tests weren't isolated - this is possibly due to the static variable referencing the database in MetaDB (which we now reset in the .closeDb call), but it warrants investigation.", "author": "david-allison-1", "createdAt": "2020-12-07T18:45:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYyMjc2Mg=="}], "type": "inlineReview"}]}