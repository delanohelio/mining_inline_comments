{"pr_number": 6438, "pr_title": "Convert import/export zip file usage to library: commons-compress - Allows >2GB imports", "pr_createdAt": "2020-06-11T21:47:31Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6438", "timeline": [{"oid": "d11c22fda6eae689d745a690e3b91ae9568becc8", "url": "https://github.com/ankidroid/Anki-Android/commit/d11c22fda6eae689d745a690e3b91ae9568becc8", "message": "Convert import/export to commons-compress\n\nAllows import of apkg >2GB.\n\nnew java.util.zip.ZipFile() failed with:\n\njava.util.zip.ZipException: error in opening zip file\n\nThis was done in the export side to keep library use consistent\n\nSadly, syncing uses `ZipFile.OPEN_READ | ZipFile.OPEN_DELETE`,\nand there does not seem to be a direct replacement in the library\nso I've kept this as using java.util.zip for now.\n\nFixes 6419", "committedDate": "2020-06-11T22:25:50Z", "type": "forcePushed"}, {"oid": "cdaa30aefe91ae28e9cc59c040b672802b06a064", "url": "https://github.com/ankidroid/Anki-Android/commit/cdaa30aefe91ae28e9cc59c040b672802b06a064", "message": "Convert import/export to commons-compress\n\nAllows import of apkg >2GB.\n\nnew java.util.zip.ZipFile() failed with:\n\njava.util.zip.ZipException: error in opening zip file\n\nThis was done in the export side to keep library use consistent\n\nSadly, syncing uses `ZipFile.OPEN_READ | ZipFile.OPEN_DELETE`,\nand there does not seem to be a direct replacement in the library\nso I've kept this as using java.util.zip for now.\n\nFixes 6419", "committedDate": "2020-06-11T23:48:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MTM4MA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6438#discussion_r439661380", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                // noinspection GradleDependency - needs 1.12 as later versions use `File.toPath`\n          \n          \n            \n                // noinspection GradleDependency - pinned at 1.12 until API21 minSdkVersion (File.toPath usage)\n          \n      \n    \n    \n  \n\nThis makes it so it will be searched during minSdkVersion bumps, we (I?) always search for 'APINN' usage", "author": "mikehardy", "createdAt": "2020-06-12T22:08:37Z", "path": "AnkiDroid/build.gradle", "diffHunk": "@@ -144,6 +144,10 @@ dependencies {\n     implementation 'com.getbase:floatingactionbutton:1.10.1'\n     implementation 'org.bitbucket.cowwoc:diff-match-patch:1.2'\n     implementation \"androidx.multidex:multidex:2.0.1\"\n+    // #6419  - API 27 (& maybe others) could not perform new ZipFile() on a 2GB+ apkg\n+    // noinspection GradleDependency - needs 1.12 as later versions use `File.toPath`", "originalCommit": "cdaa30aefe91ae28e9cc59c040b672802b06a064", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTU0OTY2Nw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6438#discussion_r539549667", "bodyText": "I literally thought of this one as I was falling asleep last night, which is a sure sign of mental illness. But I remembered it! Need to do another round of APINN searches, but testing revealed this needs to stay pinned until API26", "author": "mikehardy", "createdAt": "2020-12-09T18:34:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MTM4MA=="}], "type": "inlineReview"}, {"oid": "4d585a67b8b010d7b2834af4b26d343418612044", "url": "https://github.com/ankidroid/Anki-Android/commit/4d585a67b8b010d7b2834af4b26d343418612044", "message": "Convert import/export to commons-compress\n\nAllows import of apkg >2GB.\n\nnew java.util.zip.ZipFile() failed with:\n\njava.util.zip.ZipException: error in opening zip file\n\nThis was done in the export side to keep library use consistent\n\nSadly, syncing uses `ZipFile.OPEN_READ | ZipFile.OPEN_DELETE`,\nand there does not seem to be a direct replacement in the library\nso I've kept this as using java.util.zip for now.\n\nFixes 6419", "committedDate": "2020-06-12T22:15:35Z", "type": "forcePushed"}, {"oid": "27748cbdb5da16f36bf6730767125e48088882c2", "url": "https://github.com/ankidroid/Anki-Android/commit/27748cbdb5da16f36bf6730767125e48088882c2", "message": "Convert import/export to commons-compress\n\nAllows import of apkg >2GB.\n\nnew java.util.zip.ZipFile() failed with:\n\njava.util.zip.ZipException: error in opening zip file\n\nThis was done in the export side to keep library use consistent\n\nSadly, syncing uses `ZipFile.OPEN_READ | ZipFile.OPEN_DELETE`,\nand there does not seem to be a direct replacement in the library\nso I've kept this as using java.util.zip for now.\n\nFixes 6419", "committedDate": "2020-06-13T00:22:20Z", "type": "commit"}, {"oid": "27748cbdb5da16f36bf6730767125e48088882c2", "url": "https://github.com/ankidroid/Anki-Android/commit/27748cbdb5da16f36bf6730767125e48088882c2", "message": "Convert import/export to commons-compress\n\nAllows import of apkg >2GB.\n\nnew java.util.zip.ZipFile() failed with:\n\njava.util.zip.ZipException: error in opening zip file\n\nThis was done in the export side to keep library use consistent\n\nSadly, syncing uses `ZipFile.OPEN_READ | ZipFile.OPEN_DELETE`,\nand there does not seem to be a direct replacement in the library\nso I've kept this as using java.util.zip for now.\n\nFixes 6419", "committedDate": "2020-06-13T00:22:20Z", "type": "forcePushed"}]}