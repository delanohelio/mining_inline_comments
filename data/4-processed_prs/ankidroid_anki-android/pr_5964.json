{"pr_number": 5964, "pr_title": "only call Sched.reset() once on scheduler opening", "pr_createdAt": "2020-04-10T08:01:26Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/5964", "timeline": [{"oid": "e14315c6cecab8c3799f1be9492aaef0fb132e4c", "url": "https://github.com/ankidroid/Anki-Android/commit/e14315c6cecab8c3799f1be9492aaef0fb132e4c", "message": "Reset done a single time on scheduler openinig\n\nOn my collection and my phone, scheduler's reset take 4 seconds. It's\ndone twice when reviewer is opened from deck picker. This is because:\n* to check whether the deck can be reviewer, reset is done to see the\n  correct number of card\n* when reviewer starts, it calls reset to check whether there are\n  actually cards to review/create the queue\n\nBoth actions are useful, but in this case it's a duplicate. Since\nstarting to review a deck from the list of deck is actually an action\nperformed often, it's important that it gets optimized, and thus I add\na notion of \"reset done\" to the intent, to state that reset does not\nhave to be done immediately by reviewer. I also ensure that future\nresets are actually done.", "committedDate": "2020-04-10T08:38:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3NTg1NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/5964#discussion_r406875855", "bodyText": "If we do this, it's a member variable so it should be mSomething\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private boolean reset_done = false;\n          \n          \n            \n                private boolean mSchedResetDone = false;", "author": "mikehardy", "createdAt": "2020-04-10T18:07:04Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -61,6 +61,9 @@\n     private boolean mBlackWhiteboard = true;\n     private boolean mPrefFullscreenReview = false;\n     private static final int ADD_NOTE = 12;\n+    // Deck picker reset scheduler before opening the reviewer. So\n+    // first reset is useless.\n+    private boolean reset_done = false;", "originalCommit": "e14315c6cecab8c3799f1be9492aaef0fb132e4c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg5ODE0MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/5964#discussion_r406898141", "bodyText": "Sorry. Tim just told me a few day ago about m variables. I really need to get my head around the fact that my PR to anki and akindroid needs to follow different rules. That's extremely unintuitive to be honest, since in my headspace, anki and ankidroid are really related", "author": "Arthur-Milchior", "createdAt": "2020-04-10T19:02:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3NTg1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3NTk4Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/5964#discussion_r406875982", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        reset_done = true;\n          \n          \n            \n                        mSchedResetDone = true;", "author": "mikehardy", "createdAt": "2020-04-10T18:07:26Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -96,6 +99,10 @@ protected void onCreate(Bundle savedInstanceState) {\n         Timber.d(\"onCreate()\");\n         super.onCreate(savedInstanceState);\n \n+        if (getIntent().hasExtra(\"com.ichi2.anki.reset_done\")) {\n+            Timber.d(\"reset done\");\n+            reset_done = true;", "originalCommit": "e14315c6cecab8c3799f1be9492aaef0fb132e4c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3NjE4Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/5964#discussion_r406876183", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (!reset_done) {\n          \n          \n            \n                        col.getSched().reset();     // Reset schedule in case card had previous been loaded\n          \n          \n            \n                        reset_done = false;\n          \n          \n            \n                    }\n          \n          \n            \n                    if (!mSchedResetDone) {\n          \n          \n            \n                        col.getSched().reset();     // Reset schedule in case card was previously loaded\n          \n          \n            \n                        mSchedReset = false;\n          \n          \n            \n                    }", "author": "mikehardy", "createdAt": "2020-04-10T18:07:47Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -171,7 +178,10 @@ protected void onCollectionLoaded(Collection col) {\n             setWhiteboardVisibility(whiteboardVisibility);\n         }\n \n-        col.getSched().reset();     // Reset schedule incase card had previous been loaded\n+        if (!reset_done) {\n+            col.getSched().reset();     // Reset schedule in case card had previous been loaded\n+            reset_done = false;\n+        }", "originalCommit": "e14315c6cecab8c3799f1be9492aaef0fb132e4c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg5OTM0OA==", "url": "https://github.com/ankidroid/Anki-Android/pull/5964#discussion_r406899348", "bodyText": "The comment error was already here before this PR. I'm okay to correct it, but it's unrelated to this commit", "author": "Arthur-Milchior", "createdAt": "2020-04-10T19:05:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3NjE4Mw=="}], "type": "inlineReview"}, {"oid": "9de9db89da4164924fdcfb50da4df1cd620d1f6a", "url": "https://github.com/ankidroid/Anki-Android/commit/9de9db89da4164924fdcfb50da4df1cd620d1f6a", "message": "Reset done a single time on scheduler openinig\n\nOn my collection and my phone, scheduler's reset take 4 seconds. It's\ndone twice when reviewer is opened from deck picker. This is because:\n* to check whether the deck can be reviewer, reset is done to see the\n  correct number of card\n* when reviewer starts, it calls reset to check whether there are\n  actually cards to review/create the queue\n\nBoth actions are useful, but in this case it's a duplicate. Since\nstarting to review a deck from the list of deck is actually an action\nperformed often, it's important that it gets optimized, and thus I add\na notion of \"reset done\" to the intent, to state that reset does not\nhave to be done immediately by reviewer. I also ensure that future\nresets are actually done.", "committedDate": "2020-04-10T19:05:45Z", "type": "commit"}, {"oid": "9de9db89da4164924fdcfb50da4df1cd620d1f6a", "url": "https://github.com/ankidroid/Anki-Android/commit/9de9db89da4164924fdcfb50da4df1cd620d1f6a", "message": "Reset done a single time on scheduler openinig\n\nOn my collection and my phone, scheduler's reset take 4 seconds. It's\ndone twice when reviewer is opened from deck picker. This is because:\n* to check whether the deck can be reviewer, reset is done to see the\n  correct number of card\n* when reviewer starts, it calls reset to check whether there are\n  actually cards to review/create the queue\n\nBoth actions are useful, but in this case it's a duplicate. Since\nstarting to review a deck from the list of deck is actually an action\nperformed often, it's important that it gets optimized, and thus I add\na notion of \"reset done\" to the intent, to state that reset does not\nhave to be done immediately by reviewer. I also ensure that future\nresets are actually done.", "committedDate": "2020-04-10T19:05:45Z", "type": "forcePushed"}]}