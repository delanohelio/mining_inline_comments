{"pr_number": 6550, "pr_title": "Change whiteboard pen color while reviewing ", "pr_createdAt": "2020-06-25T06:42:35Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6550", "timeline": [{"oid": "77d6abfbb12a4898098d59bb06670aa9aaec63f6", "url": "https://github.com/ankidroid/Anki-Android/commit/77d6abfbb12a4898098d59bb06670aa9aaec63f6", "message": "\tWhiteboard pen color", "committedDate": "2020-06-25T06:36:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4MTg5NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445381894", "bodyText": "You can make this a local variable", "author": "david-allison-1", "createdAt": "2020-06-25T08:09:01Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -79,6 +79,7 @@\n     private boolean mPrefFullscreenReview = false;\n     private static final int ADD_NOTE = 12;\n     private static final int REQUEST_AUDIO_PERMISSION = 0;\n+    private LinearLayout colorPalette;", "originalCommit": "77d6abfbb12a4898098d59bb06670aa9aaec63f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4MjE3Ng==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445382176", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private LinearLayout colorPalette;\n          \n          \n            \n                private LinearLayout mColorPalette;", "author": "david-allison-1", "createdAt": "2020-06-25T08:09:31Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -66,6 +68,7 @@\n     private boolean mMonochrome;\n     private boolean mUndoModeActive = false;\n \n+    private LinearLayout colorPalette;", "originalCommit": "77d6abfbb12a4898098d59bb06670aa9aaec63f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4MjU0MA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445382540", "bodyText": "Why was this commented out?", "author": "david-allison-1", "createdAt": "2020-06-25T08:10:10Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -241,11 +260,13 @@ private void createBitmap() {\n         // To fix issue #1336, just make the whiteboard big and square.\n         final Point p = getDisplayDimenions();\n         int bitmapSize = Math.max(p.x, p.y);\n+        createBitmap(bitmapSize, bitmapSize, Bitmap.Config.ARGB_8888);\n+        /*\n         if (mMonochrome && !mInvertedColors) {", "originalCommit": "77d6abfbb12a4898098d59bb06670aa9aaec63f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ5MDU2MA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445490560", "bodyText": "When not commented out then pen color change but after drawing complete. The drawn figure change to black color.", "author": "infinyte7", "createdAt": "2020-06-25T11:30:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4MjU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYwOTc4Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445609783", "bodyText": "Wouldn't that the be mPaint line?\nDoes this feature still work in night mode?", "author": "david-allison-1", "createdAt": "2020-06-25T14:39:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4MjU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYyOTE3OA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445629178", "bodyText": "Yes, this work in night mode.  But in normal mode drawn figure color change to black.", "author": "infinyte7", "createdAt": "2020-06-25T15:05:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4MjU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc0NjY1Ng==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445746656", "bodyText": "Could you try 4444, so we conserve memory.", "author": "david-allison-1", "createdAt": "2020-06-25T18:12:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4MjU0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4MjkyMQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445382921", "bodyText": "Move all of these into the case statements (surround the cases with {} if they're declaring variables)", "author": "david-allison-1", "createdAt": "2020-06-25T08:10:47Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -356,6 +377,44 @@ private static Point getDisplayDimenions() {\n         return point;\n     }\n \n+    @Override\n+    public void onClick(View view) {\n+\n+        int redPenColor = Color.parseColor(\"#f44336\");", "originalCommit": "77d6abfbb12a4898098d59bb06670aa9aaec63f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ5NTE0Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445495142", "bodyText": "The default colours seem sensible. At some point we might want to move to a colour picker.\nCould you rebase this to remove references to the .png images and use a vector instead?\n\nSome thing like this can be done. Google Keep\n\nI have used .png for color palette icon in Action Bar as Undo icon used. Undo icon have four png iconhdpi, mdpi, xdpi, xxdpi. So I have created four png icon for color palette icon.", "author": "infinyte7", "createdAt": "2020-06-25T11:40:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4MjkyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTU5Njc1OQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445596759", "bodyText": "We plan to (eventually) remove the four pngs: #5134", "author": "david-allison-1", "createdAt": "2020-06-25T14:22:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4MjkyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYyOTk0NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445629945", "bodyText": "To be updated.", "author": "infinyte7", "createdAt": "2020-06-25T15:06:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4MjkyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4Nzc3Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445387772", "bodyText": "Is this only visible if the whiteboard is visible?", "author": "david-allison-1", "createdAt": "2020-06-25T08:19:04Z", "path": "AnkiDroid/src/main/res/layout/reviewer.xml", "diffHunk": "@@ -37,6 +37,13 @@\n                 android:layout_height=\"match_parent\"\n                 android:layout_below=\"@id/mic_tool_bar_layer\" />\n \n+            <include\n+                layout=\"@layout/reviewer_whiteboard_pen_color\"", "originalCommit": "77d6abfbb12a4898098d59bb06670aa9aaec63f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ5Mjg0Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445492843", "bodyText": "By default visibility is gone.\nreviewer_whiteboard_pen_color.xml#L7\nWhen whiteboard turn on then the color palette icon added to Action bar and after clicking on the open the color panel.\nReviewer.java#L337", "author": "infinyte7", "createdAt": "2020-06-25T11:35:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4Nzc3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTU5NzM4MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445597381", "bodyText": "Sorry! I was referring to the item in the Action Bar. R.id.action_change_whiteboard_pen_color", "author": "david-allison-1", "createdAt": "2020-06-25T14:23:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4Nzc3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4ODE4MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445388181", "bodyText": "might as well remove rather than commenting out", "author": "david-allison-1", "createdAt": "2020-06-25T08:19:45Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -91,7 +94,7 @@ public Whiteboard(AbstractFlashcardViewer cardViewer, boolean inverted, boolean\n         mPaint = new Paint();\n         mPaint.setAntiAlias(true);\n         mPaint.setDither(true);\n-        mPaint.setColor(foregroundColor);\n+        //mPaint.setColor(foregroundColor);", "originalCommit": "77d6abfbb12a4898098d59bb06670aa9aaec63f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM5OTA2NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445399065", "bodyText": "You'll need to update the UndoStack class to allow for colours.\nLikely moving it to a class-based model at this stage, so you'd have one undo stack rather than 3 (potentially 4 with adding in the colour).", "author": "david-allison-1", "createdAt": "2020-06-25T08:38:36Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -356,6 +377,44 @@ private static Point getDisplayDimenions() {\n         return point;\n     }\n \n+    @Override\n+    public void onClick(View view) {\n+\n+        int redPenColor = Color.parseColor(\"#f44336\");\n+        int greenPenColor = Color.parseColor(\"#4caf50\");\n+        int bluePenColor = Color.parseColor(\"#2196f3\");\n+        int yellowPenColor = Color.parseColor(\"#ffeb3b\");\n+\n+        switch (view.getId()) {\n+            case R.id.pen_color_white:\n+                mPaint.setColor(Color.WHITE);\n+                colorPalette.setVisibility(View.GONE);\n+                break;\n+            case R.id.pen_color_black:\n+                mPaint.setColor(Color.BLACK);\n+                colorPalette.setVisibility(View.GONE);\n+                break;\n+            case R.id.pen_color_red:\n+                mPaint.setColor(redPenColor);\n+                colorPalette.setVisibility(View.GONE);\n+                break;\n+            case R.id.pen_color_green:\n+                mPaint.setColor(greenPenColor);\n+                colorPalette.setVisibility(View.GONE);\n+                break;\n+            case R.id.pen_color_blue:\n+                mPaint.setColor(bluePenColor);\n+                colorPalette.setVisibility(View.GONE);\n+                break;\n+            case R.id.pen_color_yellow:\n+                mPaint.setColor(yellowPenColor);\n+                colorPalette.setVisibility(View.GONE);\n+                break;\n+            default:\n+                break;\n+        }\n+    }\n+\n     /**\n      * Keep a stack of all points and paths so that the last stroke can be undone\n      * pop() removes the last stroke from the stack, and apply() redraws it to whiteboard.", "originalCommit": "77d6abfbb12a4898098d59bb06670aa9aaec63f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ5Mzg2Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445493862", "bodyText": "Please explain it more.", "author": "infinyte7", "createdAt": "2020-06-25T11:37:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM5OTA2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYwMzM4Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445603382", "bodyText": "Currently, UndoStack uses 3 stacks to handle undo/redo.\nWhen an undo is performed, two stacks are popped, the canvas is reset, and the stacks are iterated to redraw the canvas.\nTo add colour to this feature, you'll need to add more data to these stacks. This can either be done by using a Pair class (or making a new object), or adding a new stack containing the Paint which was used at the time to draw the lines.\nBoth of the above options aren't great and add complexity.\n\nIt'd be much better to simplify the class to have one stack, and having the object in the stack being an interface which has an `apply(Canvas)`` operation.\nImplement the interface/object with two subclasses: Point and Line\nOnce this is done, you can supply a Paint object to the classes and use it in apply(Canvas) so they can handle different colours.\nThis has the added benefit of simplifying the UndoStack class", "author": "david-allison-1", "createdAt": "2020-06-25T14:31:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM5OTA2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYzNjkzNA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445636934", "bodyText": "I understand it. But implementing this is difficult for me.", "author": "infinyte7", "createdAt": "2020-06-25T15:16:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM5OTA2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY2Njg1Ng==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445666856", "bodyText": "I'll send over some code... give me 5 mins\nEDIT: Just testing... can't be sending over broken code ;)", "author": "david-allison-1", "createdAt": "2020-06-25T16:00:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM5OTA2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY4MTUzNA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445681534", "bodyText": "GitHub's file processing seems broken. Copy to a text file, rename to .patch and apply it (VCS - Apply Patch)\nwhiteboard.patch\nIndex: AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java\nIDEA additional info:\nSubsystem: com.intellij.openapi.diff.impl.patch.CharsetEP\n<+>UTF-8\n===================================================================\n--- AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java\t(revision 8236599b1db98f774a45c4f84de308e16affd0c3)\n+++ AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java\t(date 1593101965792)\n@@ -26,7 +26,7 @@\n import android.graphics.Path;\n import android.graphics.PathMeasure;\n import android.graphics.Point;\n-import android.graphics.PointF;\n+import androidx.annotation.NonNull;\n import androidx.core.content.ContextCompat;\n import android.view.Display;\n import android.view.MotionEvent;\n@@ -272,13 +272,10 @@\n         mCurrentlyDrawing = false;\n         PathMeasure pm = new PathMeasure(mPath, false);\n         mPath.lineTo(mX, mY);\n-        if (pm.getLength() > 0) {\n-            mCanvas.drawPath(mPath, mPaint);\n-            mUndo.add(mPath);\n-        } else {\n-            mCanvas.drawPoint(mX, mY, mPaint);\n-            mUndo.add(mX, mY);\n-        }\n+        Paint paint = new Paint(mPaint);\n+        WhiteboardAction action = pm.getLength() > 0 ? new DrawPath(new Path(mPath), paint) : new DrawPoint(mX, mY, paint);\n+        action.apply(mCanvas);\n+        mUndo.add(action);\n         mUndoModeActive = true;\n         // kill the path so we don't double draw\n         mPath.reset();\n@@ -361,55 +358,75 @@\n      * pop() removes the last stroke from the stack, and apply() redraws it to whiteboard.\n      */\n     private class UndoStack {\n-        private final Stack<Path> mPathStack = new Stack<>();\n-        private final Stack<PointF> mPointStack = new Stack<>();\n-        private final Stack<Integer> mWhichStack = new Stack<>();\n+        private final Stack<WhiteboardAction> mStack = new Stack<>();\n \n-        public void add(Path path) {\n-            mPathStack.add(new Path(path));\n-            mWhichStack.add(0);\n-        }\n-        public void add(float x, float y) {\n-            mPointStack.add(new PointF(x, y));\n-            mWhichStack.add(1);\n+        public void add(WhiteboardAction action) {\n+            mStack.add(action);\n         }\n \n         public void clear() {\n-            mPathStack.clear();\n-            mPointStack.clear();\n-            mWhichStack.clear();\n+            mStack.clear();\n         }\n \n         public int size() {\n-            return mWhichStack.size();\n+            return mStack.size();\n         }\n \n         public void pop() {\n-            if (mWhichStack.size() == 0) return;\n-            switch (mWhichStack.peek()) {\n-                case 0:\n-                    mPathStack.pop();\n-                    break;\n-                case 1:\n-                    mPointStack.pop();\n-                    break;\n-            }\n-            mWhichStack.pop();\n+            mStack.pop();\n         }\n \n         public void apply() {\n             mBitmap.eraseColor(0);\n-            for (Path path : mPathStack) {\n-                mCanvas.drawPath(path, mPaint);\n-            }\n-            for (PointF point : mPointStack) {\n-                mCanvas.drawPoint(point.x, point.y, mPaint);\n+\n+            for (WhiteboardAction action : mStack) {\n+                action.apply(mCanvas);\n             }\n             invalidate();\n         }\n \n         public boolean empty() {\n-            return mWhichStack.empty();\n+            return mStack.empty();\n+        }\n+    }\n+\n+    private interface WhiteboardAction {\n+        void apply(@NonNull Canvas canvas);\n+    }\n+\n+    private static class DrawPoint implements WhiteboardAction {\n+\n+        private final float mX;\n+        private final float mY;\n+        private final Paint mPaint;\n+\n+\n+        public DrawPoint(float x, float y, Paint paint) {\n+            mX = x;\n+            mY = y;\n+            mPaint = paint;\n+        }\n+\n+\n+        @Override\n+        public void apply(@NonNull Canvas canvas) {\n+            canvas.drawPoint(mX, mY, mPaint);\n+        }\n+    }\n+\n+    private static class DrawPath implements WhiteboardAction {\n+        private final Path mPath;\n+        private final Paint mPaint;\n+\n+        public DrawPath(Path path, Paint paint) {\n+            mPath = path;\n+            mPaint = paint;\n+        }\n+\n+\n+        @Override\n+        public void apply(@NonNull Canvas canvas) {\n+            canvas.drawPath(mPath, mPaint);\n         }\n     }", "author": "david-allison-1", "createdAt": "2020-06-25T16:22:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM5OTA2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY5MzI1Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445693252", "bodyText": "Thank you,\nI have added the patch.\nIt is working as expected.", "author": "infinyte7", "createdAt": "2020-06-25T16:40:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM5OTA2NQ=="}], "type": "inlineReview"}, {"oid": "cd46f7c4ca8eb6a2380b7f4b7f2ba73164f10e3f", "url": "https://github.com/ankidroid/Anki-Android/commit/cd46f7c4ca8eb6a2380b7f4b7f2ba73164f10e3f", "message": "\tUpdated Reviewer.java, Whiteboard.java", "committedDate": "2020-06-25T11:36:08Z", "type": "commit"}, {"oid": "526c0db92ac8c7010007a7649e4da14ecc2f7362", "url": "https://github.com/ankidroid/Anki-Android/commit/526c0db92ac8c7010007a7649e4da14ecc2f7362", "message": "    Added vector icon for select pen color icon", "committedDate": "2020-06-25T16:08:47Z", "type": "commit"}, {"oid": "7f2dcf75fe1f523cb2333b364f84ac2e6fd335e7", "url": "https://github.com/ankidroid/Anki-Android/commit/7f2dcf75fe1f523cb2333b364f84ac2e6fd335e7", "message": "    Added patch to Whiteboard.java", "committedDate": "2020-06-25T16:41:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcwMzkyNA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445703924", "bodyText": "Is this available on the fullscreen or no answer buttons layouts?", "author": "david-allison-1", "createdAt": "2020-06-25T16:57:38Z", "path": "AnkiDroid/src/main/res/layout/reviewer.xml", "diffHunk": "@@ -37,6 +37,13 @@\n                 android:layout_height=\"match_parent\"\n                 android:layout_below=\"@id/mic_tool_bar_layer\" />\n \n+            <include", "originalCommit": "7f2dcf75fe1f523cb2333b364f84ac2e6fd335e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcwNzk3MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445707971", "bodyText": "when turning on fullscreen\n06-26 00:57:27.840 16881-16881/com.ichi2.anki E/AndroidRuntime: FATAL EXCEPTION: main\n    Process: com.ichi2.anki, PID: 16881\n    java.lang.RuntimeException: Unable to start activity ComponentInfo{com.ichi2.anki/com.ichi2.anki.Reviewer}: java.lang.NullPointerException: Attempt to invoke virtual method 'void android.widget.Button.setOnClickListener(android.view.View$OnClickListener)' on a null object reference\n        at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2327)\n        at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2392)\n        at android.app.ActivityThread.access$800(ActivityThread.java:153)\n        at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1305)\n        at android.os.Handler.dispatchMessage(Handler.java:102)\n        at android.os.Looper.loop(Looper.java:135)\n        at android.app.ActivityThread.main(ActivityThread.java:5305)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at java.lang.reflect.Method.invoke(Method.java:372)\n        at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:903)\n        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:698)\n     Caused by: java.lang.NullPointerException: Attempt to invoke virtual method 'void android.widget.Button.setOnClickListener(android.view.View$OnClickListener)' on a null object reference\n        at com.ichi2.anki.Whiteboard.<init>(Whiteboard.java:116)\n        at com.ichi2.anki.Reviewer.createWhiteboard(Reviewer.java:747)\n        at com.ichi2.anki.Reviewer.setWhiteboardEnabledState(Reviewer.java:741)\n        at com.ichi2.anki.Reviewer.onCollectionLoaded(Reviewer.java:234)\n        at com.ichi2.anki.AnkiActivity.startLoadingCollection(AnkiActivity.java:319)\n        at com.ichi2.anki.Reviewer.onCreate(Reviewer.java:140)\n        at android.app.Activity.performCreate(Activity.java:5990)\n        at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1106)\n        at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2280)\n        at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2392)\u00a0\n        at android.app.ActivityThread.access$800(ActivityThread.java:153)\u00a0\n        at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1305)\u00a0\n        at android.os.Handler.dispatchMessage(Handler.java:102)\u00a0\n        at android.os.Looper.loop(Looper.java:135)\u00a0\n        at android.app.ActivityThread.main(ActivityThread.java:5305)\u00a0\n        at java.lang.reflect.Method.invoke(Native Method)\u00a0\n        at java.lang.reflect.Method.invoke(Method.java:372)\u00a0\n        at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:903)\u00a0\n        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:698)\u00a0", "author": "infinyte7", "createdAt": "2020-06-25T17:04:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcwMzkyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTczNjIwMA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445736200", "bodyText": "In fullscreen, the reference for these button become nulll.\npenColorWhite.setOnClickListener(this);\npenColorBlack.setOnClickListener(this);\npenColorRed.setOnClickListener(this);\npenColorGreen.setOnClickListener(this);\npenColorBlue.setOnClickListener(this);\npenColorYellow.setOnClickListener(this);", "author": "infinyte7", "createdAt": "2020-06-25T17:54:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcwMzkyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc0MTY0MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445741641", "bodyText": "You need the <include in reviewer_fullscreen.xml", "author": "david-allison-1", "createdAt": "2020-06-25T18:03:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcwMzkyNA=="}], "type": "inlineReview"}, {"oid": "ddf40a5eb5fcaef10fe07f9a7cd638bf54f59243", "url": "https://github.com/ankidroid/Anki-Android/commit/ddf40a5eb5fcaef10fe07f9a7cd638bf54f59243", "message": "\tAdded button to ActionButtonStatus.java", "committedDate": "2020-06-25T16:57:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcwNTIxMw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445705213", "bodyText": "There's also some logic in Reviewer about enabling whitebaord buttons status depending on whether the whiteboard is available or not.", "author": "david-allison-1", "createdAt": "2020-06-25T16:59:48Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/reviewer/ActionButtonStatus.java", "diffHunk": "@@ -61,6 +61,7 @@ public void setup(SharedPreferences preferences) {\n         setupButton(preferences, R.id.action_mark_card, \"customButtonMarkCard\", SHOW_AS_ACTION_IF_ROOM);\n         setupButton(preferences, R.id.action_delete, \"customButtonDelete\", SHOW_AS_ACTION_NEVER);\n         setupButton(preferences, R.id.action_toggle_mic_tool_bar, \"customButtonToggleMicToolBar\", SHOW_AS_ACTION_NEVER);\n+        setupButton(preferences, R.id.action_change_whiteboard_pen_color, \"customButtonWhiteboardPenColor\", SHOW_AS_ACTION_ALWAYS);", "originalCommit": "ddf40a5eb5fcaef10fe07f9a7cd638bf54f59243", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "82c7d650943603dcedadb7e1a9d13bfb00050fcd", "url": "https://github.com/ankidroid/Anki-Android/commit/82c7d650943603dcedadb7e1a9d13bfb00050fcd", "message": "   Updated Reviewer.java", "committedDate": "2020-06-25T17:36:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTczMDQyOQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445730429", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        Drawable whiteboardColorPaletteIcon = ContextCompat.getDrawable(this, R.drawable.ic_color_lens_white_24dp);\n          \n          \n            \n                        Drawable whiteboardColorPaletteIcon = ContextCompat.getDrawable(this, R.drawable.ic_color_lens_white_24dp).mutate();", "author": "david-allison-1", "createdAt": "2020-06-25T17:44:10Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -544,14 +545,24 @@ public boolean onCreateOptionsMenu(Menu menu) {\n             menu.findItem(R.id.action_change_whiteboard_pen_color).setVisible(true);\n \n             Drawable whiteboardIcon = ContextCompat.getDrawable(this, R.drawable.ic_gesture_white_24dp);\n+            Drawable whiteboardColorPaletteIcon = ContextCompat.getDrawable(this, R.drawable.ic_color_lens_white_24dp);", "originalCommit": "82c7d650943603dcedadb7e1a9d13bfb00050fcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "174065d896cbfdf5d420f3cacda9a82b476b917f", "url": "https://github.com/ankidroid/Anki-Android/commit/174065d896cbfdf5d420f3cacda9a82b476b917f", "message": "\tUpdated Reviewer.java", "committedDate": "2020-06-25T17:50:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc0Mzc0MA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445743740", "bodyText": "if you're just implementing the interface to allow setOnClickListener(this), then you can would be better define it as a lambda inside the method and remove the interface impementation\nI believe the syntax would be btn.setOnClickListener(this::onClick). Then you can rename the method to something more readable.", "author": "david-allison-1", "createdAt": "2020-06-25T18:07:44Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -26,20 +26,22 @@\n import android.graphics.Path;\n import android.graphics.PathMeasure;\n import android.graphics.Point;\n-import android.graphics.PointF;\n+import androidx.annotation.NonNull;\n import androidx.core.content.ContextCompat;\n import android.view.Display;\n import android.view.MotionEvent;\n import android.view.View;\n import android.view.WindowManager;\n+import android.widget.Button;\n+import android.widget.LinearLayout;\n \n import java.lang.ref.WeakReference;\n import java.util.Stack;\n \n /**\n  * Whiteboard allowing the user to draw the card's answer on the touchscreen.\n  */\n-public class Whiteboard extends View {\n+public class Whiteboard extends View implements View.OnClickListener {", "originalCommit": "174065d896cbfdf5d420f3cacda9a82b476b917f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc0NDQ3OQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445744479", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private LinearLayout mColorPalette;\n          \n          \n            \n                private final LinearLayout mColorPalette;", "author": "david-allison-1", "createdAt": "2020-06-25T18:09:02Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -66,6 +68,7 @@\n     private boolean mMonochrome;\n     private boolean mUndoModeActive = false;\n \n+    private LinearLayout mColorPalette;", "originalCommit": "174065d896cbfdf5d420f3cacda9a82b476b917f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "46727015c90598ed8ae7fa7d91b67d024a718537", "url": "https://github.com/ankidroid/Anki-Android/commit/46727015c90598ed8ae7fa7d91b67d024a718537", "message": "\tUpdated reviewer_fullscreen.xml, reviewer_fullscreen_noanswers.xml", "committedDate": "2020-06-25T18:09:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc0Njg1MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445746851", "bodyText": "Might as well remove the code rather than commenting it out", "author": "david-allison-1", "createdAt": "2020-06-25T18:13:14Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -241,11 +260,13 @@ private void createBitmap() {\n         // To fix issue #1336, just make the whiteboard big and square.\n         final Point p = getDisplayDimenions();\n         int bitmapSize = Math.max(p.x, p.y);\n+        createBitmap(bitmapSize, bitmapSize, Bitmap.Config.ARGB_8888);\n+        /*\n         if (mMonochrome && !mInvertedColors) {\n             createBitmap(bitmapSize, bitmapSize, Bitmap.Config.ALPHA_8);\n         } else {\n             createBitmap(bitmapSize, bitmapSize, Bitmap.Config.ARGB_4444);", "originalCommit": "174065d896cbfdf5d420f3cacda9a82b476b917f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c8574991523c26f02fe367f6b0849a6458d2423d", "url": "https://github.com/ankidroid/Anki-Android/commit/c8574991523c26f02fe367f6b0849a6458d2423d", "message": "\tUpdated Whiteboard.java", "committedDate": "2020-06-25T18:17:34Z", "type": "commit"}, {"oid": "c8574991523c26f02fe367f6b0849a6458d2423d", "url": "https://github.com/ankidroid/Anki-Android/commit/c8574991523c26f02fe367f6b0849a6458d2423d", "message": "\tUpdated Whiteboard.java", "committedDate": "2020-06-25T18:17:34Z", "type": "forcePushed"}, {"oid": "c8574991523c26f02fe367f6b0849a6458d2423d", "url": "https://github.com/ankidroid/Anki-Android/commit/c8574991523c26f02fe367f6b0849a6458d2423d", "message": "\tUpdated Whiteboard.java", "committedDate": "2020-06-25T18:17:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc5Njc4Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445796783", "bodyText": "There are constants in the Themes class, can you use these?", "author": "david-allison-1", "createdAt": "2020-06-25T19:43:34Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -534,15 +542,27 @@ public boolean onCreateOptionsMenu(Menu menu) {\n                 menu.findItem(R.id.action_clear_whiteboard).setVisible(true);\n             }\n \n+            menu.findItem(R.id.action_change_whiteboard_pen_color).setVisible(true);\n+\n             Drawable whiteboardIcon = ContextCompat.getDrawable(this, R.drawable.ic_gesture_white_24dp);\n+            Drawable whiteboardColorPaletteIcon = ContextCompat.getDrawable(this, R.drawable.ic_color_lens_white_24dp).mutate();\n+\n             if (mShowWhiteboard) {\n                 whiteboardIcon.setAlpha(255);\n                 menu.findItem(R.id.action_hide_whiteboard).setIcon(whiteboardIcon);\n                 menu.findItem(R.id.action_hide_whiteboard).setTitle(R.string.hide_whiteboard);\n+\n+                whiteboardColorPaletteIcon.setAlpha(255);", "originalCommit": "c8574991523c26f02fe367f6b0849a6458d2423d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc5ODIyOA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445798228", "bodyText": "Best to keep it consistent. I'll fix Check Pronunication now\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <string name=\"title_whiteboard_pen_color\">Pen Color</string>\n          \n          \n            \n                <string name=\"title_whiteboard_pen_color\">Pen color</string>", "author": "david-allison-1", "createdAt": "2020-06-25T19:46:34Z", "path": "AnkiDroid/src/main/res/values/02-strings.xml", "diffHunk": "@@ -273,4 +273,6 @@\n     <!-- in options menu & Navigation Drawer -->\n     <string name=\"ankidroid_turn_on_fullscreen_nav_drawer\">Please turn on fullscreen to use Show Navigation Drawer using JavaScript.</string>\n     <string name=\"ankidroid_turn_on_fullscreen_options_menu\">Please turn on fullscreen to use Show Options Menu using JavaScript.</string>\n+\n+    <string name=\"title_whiteboard_pen_color\">Pen Color</string>", "originalCommit": "c8574991523c26f02fe367f6b0849a6458d2423d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc5OTA0MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r445799041", "bodyText": "Implementer's choice: Can be shortened to:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Button penColorWhite = (Button) cardViewer.findViewById(R.id.pen_color_white);\n          \n          \n            \n                    ((Button) cardViewer.findViewById(R.id.pen_color_white)).setOnClickListener(this::onClick);", "author": "david-allison-1", "createdAt": "2020-06-25T19:48:13Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -100,6 +103,22 @@ public Whiteboard(AbstractFlashcardViewer cardViewer, boolean inverted, boolean\n         createBitmap();\n         mPath = new Path();\n         mBitmapPaint = new Paint(Paint.DITHER_FLAG);\n+\n+        // selecting pen color to draw\n+        mColorPalette = (LinearLayout) cardViewer.findViewById(R.id.whiteboard_pen_color);\n+\n+        Button penColorWhite = (Button) cardViewer.findViewById(R.id.pen_color_white);", "originalCommit": "c8574991523c26f02fe367f6b0849a6458d2423d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bc30c1dab10e0e8a60623a76817589ad9961c113", "url": "https://github.com/ankidroid/Anki-Android/commit/bc30c1dab10e0e8a60623a76817589ad9961c113", "message": "Revert \"Fork Update\"", "committedDate": "2020-06-26T03:06:58Z", "type": "commit"}, {"oid": "6a3339cf2689a619dc96747fa51768c24f417c95", "url": "https://github.com/ankidroid/Anki-Android/commit/6a3339cf2689a619dc96747fa51768c24f417c95", "message": "\tUpdate fork", "committedDate": "2020-06-26T03:36:53Z", "type": "commit"}, {"oid": "e660d320dbe1da2d540725138ac3eab07d353f7f", "url": "https://github.com/ankidroid/Anki-Android/commit/e660d320dbe1da2d540725138ac3eab07d353f7f", "message": "Merge remote-tracking branch 'origin/master' into feature-pen-color", "committedDate": "2020-06-26T03:56:34Z", "type": "commit"}, {"oid": "a104048452cd6b64eccdea1081af0e215107e1a8", "url": "https://github.com/ankidroid/Anki-Android/commit/a104048452cd6b64eccdea1081af0e215107e1a8", "message": "\tUpdated", "committedDate": "2020-06-26T05:05:45Z", "type": "commit"}, {"oid": "a104048452cd6b64eccdea1081af0e215107e1a8", "url": "https://github.com/ankidroid/Anki-Android/commit/a104048452cd6b64eccdea1081af0e215107e1a8", "message": "\tUpdated", "committedDate": "2020-06-26T05:05:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjEyMTg0Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r446121842", "bodyText": "Much nicer \ud83d\udc4d", "author": "david-allison-1", "createdAt": "2020-06-26T11:15:36Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -109,6 +112,16 @@ public Whiteboard(AbstractFlashcardViewer cardViewer, boolean inverted, boolean\n         createBitmap();\n         mPath = new Path();\n         mBitmapPaint = new Paint(Paint.DITHER_FLAG);\n+\n+        // selecting pen color to draw\n+        mColorPalette = (LinearLayout) cardViewer.findViewById(R.id.whiteboard_pen_color);\n+\n+        ((Button) cardViewer.findViewById(R.id.pen_color_white)).setOnClickListener(this::onClick);", "originalCommit": "a104048452cd6b64eccdea1081af0e215107e1a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5NTYwMw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r446395603", "bodyText": "If we are using colors that do not have a universal definition, and we are using them both in Java and in XML I think we can define the RGB hex code in XML:\nhttps://developer.android.com/guide/topics/resources/more-resources#Color\nThen reference them by a single name to make sure the colors stay consistent - otherwise we repeat these constants instead of referring to a single definition", "author": "mikehardy", "createdAt": "2020-06-26T20:30:07Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -365,60 +371,117 @@ private static Point getDisplayDimenions() {\n         return point;\n     }\n \n+\n+    public void onClick(View view) {\n+\n+        switch (view.getId()) {\n+            case R.id.pen_color_white:\n+                mPaint.setColor(Color.WHITE);\n+                mColorPalette.setVisibility(View.GONE);\n+                break;\n+            case R.id.pen_color_black:\n+                mPaint.setColor(Color.BLACK);\n+                mColorPalette.setVisibility(View.GONE);\n+                break;\n+            case R.id.pen_color_red:\n+                int redPenColor = Color.parseColor(\"#f44336\");", "originalCommit": "a104048452cd6b64eccdea1081af0e215107e1a8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ4OTQ4Nw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6550#discussion_r446489487", "bodyText": "I used that one but deprecated. So I used ContextCompat.getColor();\nhttps://stackoverflow.com/questions/31590714/getcolorint-id-deprecated-on-android-6-0-marshmallow-api-23", "author": "infinyte7", "createdAt": "2020-06-27T05:54:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5NTYwMw=="}], "type": "inlineReview"}, {"oid": "1aa90865f94d98b9fb901dbe9751ca0564d3ef8e", "url": "https://github.com/ankidroid/Anki-Android/commit/1aa90865f94d98b9fb901dbe9751ca0564d3ef8e", "message": "\tUpdated Whiteboard.java, colors.xml", "committedDate": "2020-06-27T05:53:15Z", "type": "commit"}, {"oid": "2539fa3db1cc4af60937a9e41d1e1ff8419127ef", "url": "https://github.com/ankidroid/Anki-Android/commit/2539fa3db1cc4af60937a9e41d1e1ff8419127ef", "message": "\tUpdated reviewer_whiteboard_pen_color.xml", "committedDate": "2020-06-27T05:59:31Z", "type": "commit"}]}