{"pr_number": 11495, "pr_title": "timetracking: add farming contract functionality", "pr_createdAt": "2020-05-07T17:10:32Z", "pr_url": "https://github.com/runelite/runelite/pull/11495", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTczNzkxNA==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421737914", "bodyText": "Precompile this", "author": "abextm", "createdAt": "2020-05-07T19:21:44Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/farming/FarmingContractManager.java", "diffHunk": "@@ -0,0 +1,351 @@\n+/*\n+ * Copyright (c) 2019, Koekkruimels <https://github.com/koekkruimels>\n+ * Copyright (c) 2020, melky <https://github.com/melkypie>\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this\n+ *    list of conditions and the following disclaimer.\n+ * 2. Redistributions in binary form must reproduce the above copyright notice,\n+ *    this list of conditions and the following disclaimer in the documentation\n+ *    and/or other materials provided with the distribution.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+package net.runelite.client.plugins.timetracking.farming;\n+\n+import java.time.Instant;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import net.runelite.api.Client;\n+import net.runelite.api.coords.WorldPoint;\n+import net.runelite.api.widgets.Widget;\n+import net.runelite.api.widgets.WidgetInfo;\n+import net.runelite.client.config.ConfigManager;\n+import net.runelite.client.game.ItemManager;\n+import net.runelite.client.plugins.timetracking.SummaryState;\n+import net.runelite.client.plugins.timetracking.Tab;\n+import net.runelite.client.plugins.timetracking.TimeTrackingConfig;\n+import net.runelite.client.plugins.timetracking.TimeTrackingPlugin;\n+import net.runelite.client.ui.overlay.infobox.InfoBoxManager;\n+import net.runelite.client.util.Text;\n+\n+@Slf4j\n+public class FarmingContractManager\n+{\n+\tprivate static final int GUILDMASTER_JANE_WIDGET_MODEL_ID = 8628;\n+\tprivate static final int FARMING_GUILD_REGION_ID = 4922;\n+\tprivate static final String CONTRACT_ASSIGN_REGEX = \"(?:We need you to grow|Please could you grow) (?:some|a|an) ([a-zA-Z ]+)(?: for us\\\\?|\\\\.)\";", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTczODEyNg==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421738126", "bodyText": "We need to grow a NullNpcID instead of having random npc constants in plugins", "author": "abextm", "createdAt": "2020-05-07T19:22:07Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/farming/FarmingContractManager.java", "diffHunk": "@@ -0,0 +1,351 @@\n+/*\n+ * Copyright (c) 2019, Koekkruimels <https://github.com/koekkruimels>\n+ * Copyright (c) 2020, melky <https://github.com/melkypie>\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this\n+ *    list of conditions and the following disclaimer.\n+ * 2. Redistributions in binary form must reproduce the above copyright notice,\n+ *    this list of conditions and the following disclaimer in the documentation\n+ *    and/or other materials provided with the distribution.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+package net.runelite.client.plugins.timetracking.farming;\n+\n+import java.time.Instant;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import net.runelite.api.Client;\n+import net.runelite.api.coords.WorldPoint;\n+import net.runelite.api.widgets.Widget;\n+import net.runelite.api.widgets.WidgetInfo;\n+import net.runelite.client.config.ConfigManager;\n+import net.runelite.client.game.ItemManager;\n+import net.runelite.client.plugins.timetracking.SummaryState;\n+import net.runelite.client.plugins.timetracking.Tab;\n+import net.runelite.client.plugins.timetracking.TimeTrackingConfig;\n+import net.runelite.client.plugins.timetracking.TimeTrackingPlugin;\n+import net.runelite.client.ui.overlay.infobox.InfoBoxManager;\n+import net.runelite.client.util.Text;\n+\n+@Slf4j\n+public class FarmingContractManager\n+{\n+\tprivate static final int GUILDMASTER_JANE_WIDGET_MODEL_ID = 8628;\n+\tprivate static final int FARMING_GUILD_REGION_ID = 4922;\n+\tprivate static final String CONTRACT_ASSIGN_REGEX = \"(?:We need you to grow|Please could you grow) (?:some|a|an) ([a-zA-Z ]+)(?: for us\\\\?|\\\\.)\";\n+\tprivate static final String CONTRACT_REWARDED = \"You'll be wanting a reward then. Here you go.\";\n+\n+\tprivate static final String FARMING_REGION_NAME = \"Farming Guild\";\n+\tprivate static final String HTML_STRIP = \"\\\\<[^>]*>\";\n+\tprivate static final String CONFIG_KEY_CONTRACT = \"contract\";\n+\n+\t@Getter\n+\tprivate SummaryState summary = SummaryState.UNKNOWN;\n+\n+\tprivate final Client client;\n+\tprivate final ItemManager itemManager;\n+\tprivate final TimeTrackingConfig config;\n+\tprivate final TimeTrackingPlugin plugin;\n+\tprivate final FarmingWorld farmingWorld;\n+\tprivate final FarmingTracker farmingTracker;\n+\tprivate final InfoBoxManager infoBoxManager;\n+\tprivate final ConfigManager configManager;\n+\n+\tprivate FarmingContract contract = null;\n+\tprivate FarmingContractInfoBox infoBox;\n+\n+\t@Getter\n+\tprivate long completionTime;\n+\n+\t@Inject\n+\tpublic FarmingContractManager(\n+\t\t@Nonnull Client client,\n+\t\t@Nonnull ItemManager itemManager,\n+\t\t@Nonnull TimeTrackingConfig config,\n+\t\t@Nonnull TimeTrackingPlugin plugin,\n+\t\t@Nonnull FarmingWorld farmingWorld,\n+\t\t@Nonnull FarmingTracker farmingTracker,\n+\t\t@Nonnull InfoBoxManager infoBoxManager,\n+\t\t@Nonnull ConfigManager configManager\n+\t)\n+\t{\n+\t\tthis.client = client;\n+\t\tthis.itemManager = itemManager;\n+\t\tthis.config = config;\n+\t\tthis.plugin = plugin;\n+\t\tthis.farmingWorld = farmingWorld;\n+\t\tthis.farmingTracker = farmingTracker;\n+\t\tthis.infoBoxManager = infoBoxManager;\n+\t\tthis.configManager = configManager;\n+\t}\n+\n+\tpublic void setContract(@Nullable FarmingContract contract)\n+\t{\n+\t\tthis.contract = contract;\n+\t\tsetStoredContract(contract);\n+\t\thandleContractState();\n+\t}\n+\n+\tpublic boolean hasContract()\n+\t{\n+\t\treturn contract != null;\n+\t}\n+\n+\t@Nullable\n+\tpublic Tab getContractTab()\n+\t{\n+\t\treturn hasContract() ? contract.getPatchImplementation().getTab() : null;\n+\t}\n+\n+\t@Nullable\n+\tpublic String getContractName()\n+\t{\n+\t\treturn hasContract() ? contract.getName() : null;\n+\t}\n+\n+\tpublic boolean shouldHighlightFarmingTabPanel(@Nonnull FarmingPatch patch)\n+\t{\n+\t\tPatchPrediction patchPrediction = farmingTracker.predictPatch(patch);\n+\t\tif (contract != null &&\n+\t\t\tpatch.getRegion().getName().equalsIgnoreCase(FARMING_REGION_NAME) &&\n+\t\t\tcontract.getPatchImplementation() == patch.getImplementation() &&\n+\t\t\tpatchPrediction != null &&\n+\t\t\t(patchPrediction.getProduce().equals(contract.getProduce()) || summary == SummaryState.EMPTY))\n+\t\t{\n+\t\t\treturn true;\n+\t\t}\n+\t\treturn false;\n+\t}\n+\n+\tpublic void loadContractFromConfig()\n+\t{\n+\t\tcontract = getStoredContract();\n+\t\thandleContractState();\n+\t}\n+\n+\tpublic boolean updateData(WorldPoint loc)\n+\t{\n+\t\tSummaryState oldSummary = summary;\n+\n+\t\thandleContractState();\n+\t\tif (loc.getRegionID() == FARMING_GUILD_REGION_ID)\n+\t\t{\n+\t\t\thandleGuildmasterJaneWidgetDialog();\n+\t\t\thandleInfoBox();\n+\t\t}\n+\t\telse\n+\t\t{\n+\t\t\tif (infoBox != null)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = null;\n+\t\t\t}\n+\t\t}\n+\t\treturn oldSummary != summary;\n+\t}\n+\n+\tprivate void handleInfoBox()\n+\t{\n+\t\tif (infoBox != null)\n+\t\t{\n+\t\t\tif (contract == null)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = null;\n+\t\t\t}\n+\t\t\telse if (infoBox.getContract() != contract)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = new FarmingContractInfoBox(itemManager.getImage(contract.getProduce().getItemID()), plugin, contract, config, this);\n+\t\t\t\tinfoBoxManager.addInfoBox(infoBox);\n+\t\t\t}\n+\t\t}\n+\t\telse if (contract != null)\n+\t\t{\n+\t\t\tinfoBox = new FarmingContractInfoBox(itemManager.getImage(contract.getProduce().getItemID()), plugin, contract, config, this);\n+\t\t\tinfoBoxManager.addInfoBox(infoBox);\n+\t\t}\n+\t}\n+\n+\tprivate void handleGuildmasterJaneWidgetDialog()\n+\t{\n+\t\tWidget npcDialog = client.getWidget(WidgetInfo.DIALOG_NPC_HEAD_MODEL);\n+\n+\t\tif (npcDialog == null || npcDialog.getModelId() != GUILDMASTER_JANE_WIDGET_MODEL_ID)", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTczOTQ2OA==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421739468", "bodyText": ";", "author": "abextm", "createdAt": "2020-05-07T19:24:36Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/farming/FarmingContractManager.java", "diffHunk": "@@ -0,0 +1,351 @@\n+/*\n+ * Copyright (c) 2019, Koekkruimels <https://github.com/koekkruimels>\n+ * Copyright (c) 2020, melky <https://github.com/melkypie>\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this\n+ *    list of conditions and the following disclaimer.\n+ * 2. Redistributions in binary form must reproduce the above copyright notice,\n+ *    this list of conditions and the following disclaimer in the documentation\n+ *    and/or other materials provided with the distribution.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+package net.runelite.client.plugins.timetracking.farming;\n+\n+import java.time.Instant;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import net.runelite.api.Client;\n+import net.runelite.api.coords.WorldPoint;\n+import net.runelite.api.widgets.Widget;\n+import net.runelite.api.widgets.WidgetInfo;\n+import net.runelite.client.config.ConfigManager;\n+import net.runelite.client.game.ItemManager;\n+import net.runelite.client.plugins.timetracking.SummaryState;\n+import net.runelite.client.plugins.timetracking.Tab;\n+import net.runelite.client.plugins.timetracking.TimeTrackingConfig;\n+import net.runelite.client.plugins.timetracking.TimeTrackingPlugin;\n+import net.runelite.client.ui.overlay.infobox.InfoBoxManager;\n+import net.runelite.client.util.Text;\n+\n+@Slf4j\n+public class FarmingContractManager\n+{\n+\tprivate static final int GUILDMASTER_JANE_WIDGET_MODEL_ID = 8628;\n+\tprivate static final int FARMING_GUILD_REGION_ID = 4922;\n+\tprivate static final String CONTRACT_ASSIGN_REGEX = \"(?:We need you to grow|Please could you grow) (?:some|a|an) ([a-zA-Z ]+)(?: for us\\\\?|\\\\.)\";\n+\tprivate static final String CONTRACT_REWARDED = \"You'll be wanting a reward then. Here you go.\";\n+\n+\tprivate static final String FARMING_REGION_NAME = \"Farming Guild\";\n+\tprivate static final String HTML_STRIP = \"\\\\<[^>]*>\";\n+\tprivate static final String CONFIG_KEY_CONTRACT = \"contract\";\n+\n+\t@Getter\n+\tprivate SummaryState summary = SummaryState.UNKNOWN;\n+\n+\tprivate final Client client;\n+\tprivate final ItemManager itemManager;\n+\tprivate final TimeTrackingConfig config;\n+\tprivate final TimeTrackingPlugin plugin;\n+\tprivate final FarmingWorld farmingWorld;\n+\tprivate final FarmingTracker farmingTracker;\n+\tprivate final InfoBoxManager infoBoxManager;\n+\tprivate final ConfigManager configManager;\n+\n+\tprivate FarmingContract contract = null;\n+\tprivate FarmingContractInfoBox infoBox;\n+\n+\t@Getter\n+\tprivate long completionTime;\n+\n+\t@Inject\n+\tpublic FarmingContractManager(\n+\t\t@Nonnull Client client,\n+\t\t@Nonnull ItemManager itemManager,\n+\t\t@Nonnull TimeTrackingConfig config,\n+\t\t@Nonnull TimeTrackingPlugin plugin,\n+\t\t@Nonnull FarmingWorld farmingWorld,\n+\t\t@Nonnull FarmingTracker farmingTracker,\n+\t\t@Nonnull InfoBoxManager infoBoxManager,\n+\t\t@Nonnull ConfigManager configManager\n+\t)\n+\t{\n+\t\tthis.client = client;\n+\t\tthis.itemManager = itemManager;\n+\t\tthis.config = config;\n+\t\tthis.plugin = plugin;\n+\t\tthis.farmingWorld = farmingWorld;\n+\t\tthis.farmingTracker = farmingTracker;\n+\t\tthis.infoBoxManager = infoBoxManager;\n+\t\tthis.configManager = configManager;\n+\t}\n+\n+\tpublic void setContract(@Nullable FarmingContract contract)\n+\t{\n+\t\tthis.contract = contract;\n+\t\tsetStoredContract(contract);\n+\t\thandleContractState();\n+\t}\n+\n+\tpublic boolean hasContract()\n+\t{\n+\t\treturn contract != null;\n+\t}\n+\n+\t@Nullable\n+\tpublic Tab getContractTab()\n+\t{\n+\t\treturn hasContract() ? contract.getPatchImplementation().getTab() : null;\n+\t}\n+\n+\t@Nullable\n+\tpublic String getContractName()\n+\t{\n+\t\treturn hasContract() ? contract.getName() : null;\n+\t}\n+\n+\tpublic boolean shouldHighlightFarmingTabPanel(@Nonnull FarmingPatch patch)\n+\t{\n+\t\tPatchPrediction patchPrediction = farmingTracker.predictPatch(patch);\n+\t\tif (contract != null &&\n+\t\t\tpatch.getRegion().getName().equalsIgnoreCase(FARMING_REGION_NAME) &&\n+\t\t\tcontract.getPatchImplementation() == patch.getImplementation() &&\n+\t\t\tpatchPrediction != null &&\n+\t\t\t(patchPrediction.getProduce().equals(contract.getProduce()) || summary == SummaryState.EMPTY))\n+\t\t{\n+\t\t\treturn true;\n+\t\t}\n+\t\treturn false;\n+\t}\n+\n+\tpublic void loadContractFromConfig()\n+\t{\n+\t\tcontract = getStoredContract();\n+\t\thandleContractState();\n+\t}\n+\n+\tpublic boolean updateData(WorldPoint loc)\n+\t{\n+\t\tSummaryState oldSummary = summary;\n+\n+\t\thandleContractState();\n+\t\tif (loc.getRegionID() == FARMING_GUILD_REGION_ID)\n+\t\t{\n+\t\t\thandleGuildmasterJaneWidgetDialog();\n+\t\t\thandleInfoBox();\n+\t\t}\n+\t\telse\n+\t\t{\n+\t\t\tif (infoBox != null)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = null;\n+\t\t\t}\n+\t\t}\n+\t\treturn oldSummary != summary;\n+\t}\n+\n+\tprivate void handleInfoBox()\n+\t{\n+\t\tif (infoBox != null)\n+\t\t{\n+\t\t\tif (contract == null)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = null;\n+\t\t\t}\n+\t\t\telse if (infoBox.getContract() != contract)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = new FarmingContractInfoBox(itemManager.getImage(contract.getProduce().getItemID()), plugin, contract, config, this);\n+\t\t\t\tinfoBoxManager.addInfoBox(infoBox);\n+\t\t\t}\n+\t\t}\n+\t\telse if (contract != null)\n+\t\t{\n+\t\t\tinfoBox = new FarmingContractInfoBox(itemManager.getImage(contract.getProduce().getItemID()), plugin, contract, config, this);\n+\t\t\tinfoBoxManager.addInfoBox(infoBox);\n+\t\t}\n+\t}\n+\n+\tprivate void handleGuildmasterJaneWidgetDialog()\n+\t{\n+\t\tWidget npcDialog = client.getWidget(WidgetInfo.DIALOG_NPC_HEAD_MODEL);\n+\n+\t\tif (npcDialog == null || npcDialog.getModelId() != GUILDMASTER_JANE_WIDGET_MODEL_ID)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tString dialogText = Text.removeTags(client.getWidget(WidgetInfo.DIALOG_NPC_TEXT).getText());\n+\t\tlog.debug(dialogText + \" \");\n+\n+\t\tif (dialogText.equals(CONTRACT_REWARDED))\n+\t\t{\n+\t\t\tsetContract(null);\n+\t\t\t;", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTczOTgwOQ==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421739809", "bodyText": "@Nonnull is unneeded here", "author": "abextm", "createdAt": "2020-05-07T19:25:14Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/farming/FarmingContractManager.java", "diffHunk": "@@ -0,0 +1,351 @@\n+/*\n+ * Copyright (c) 2019, Koekkruimels <https://github.com/koekkruimels>\n+ * Copyright (c) 2020, melky <https://github.com/melkypie>\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this\n+ *    list of conditions and the following disclaimer.\n+ * 2. Redistributions in binary form must reproduce the above copyright notice,\n+ *    this list of conditions and the following disclaimer in the documentation\n+ *    and/or other materials provided with the distribution.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+package net.runelite.client.plugins.timetracking.farming;\n+\n+import java.time.Instant;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import net.runelite.api.Client;\n+import net.runelite.api.coords.WorldPoint;\n+import net.runelite.api.widgets.Widget;\n+import net.runelite.api.widgets.WidgetInfo;\n+import net.runelite.client.config.ConfigManager;\n+import net.runelite.client.game.ItemManager;\n+import net.runelite.client.plugins.timetracking.SummaryState;\n+import net.runelite.client.plugins.timetracking.Tab;\n+import net.runelite.client.plugins.timetracking.TimeTrackingConfig;\n+import net.runelite.client.plugins.timetracking.TimeTrackingPlugin;\n+import net.runelite.client.ui.overlay.infobox.InfoBoxManager;\n+import net.runelite.client.util.Text;\n+\n+@Slf4j\n+public class FarmingContractManager\n+{\n+\tprivate static final int GUILDMASTER_JANE_WIDGET_MODEL_ID = 8628;\n+\tprivate static final int FARMING_GUILD_REGION_ID = 4922;\n+\tprivate static final String CONTRACT_ASSIGN_REGEX = \"(?:We need you to grow|Please could you grow) (?:some|a|an) ([a-zA-Z ]+)(?: for us\\\\?|\\\\.)\";\n+\tprivate static final String CONTRACT_REWARDED = \"You'll be wanting a reward then. Here you go.\";\n+\n+\tprivate static final String FARMING_REGION_NAME = \"Farming Guild\";\n+\tprivate static final String HTML_STRIP = \"\\\\<[^>]*>\";\n+\tprivate static final String CONFIG_KEY_CONTRACT = \"contract\";\n+\n+\t@Getter\n+\tprivate SummaryState summary = SummaryState.UNKNOWN;\n+\n+\tprivate final Client client;\n+\tprivate final ItemManager itemManager;\n+\tprivate final TimeTrackingConfig config;\n+\tprivate final TimeTrackingPlugin plugin;\n+\tprivate final FarmingWorld farmingWorld;\n+\tprivate final FarmingTracker farmingTracker;\n+\tprivate final InfoBoxManager infoBoxManager;\n+\tprivate final ConfigManager configManager;\n+\n+\tprivate FarmingContract contract = null;\n+\tprivate FarmingContractInfoBox infoBox;\n+\n+\t@Getter\n+\tprivate long completionTime;\n+\n+\t@Inject\n+\tpublic FarmingContractManager(\n+\t\t@Nonnull Client client,", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTczOTg4Mw==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421739883", "bodyText": "@Nonnull is unneeded here", "author": "abextm", "createdAt": "2020-05-07T19:25:23Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/farming/FarmingContractInfoBox.java", "diffHunk": "@@ -0,0 +1,109 @@\n+/*\n+ * Copyright (c) 2019, Koekkruimels <https://github.com/koekkruimels>\n+ * Copyright (c) 2020, melky <https://github.com/melkypie>\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this\n+ *    list of conditions and the following disclaimer.\n+ * 2. Redistributions in binary form must reproduce the above copyright notice,\n+ *    this list of conditions and the following disclaimer in the documentation\n+ *    and/or other materials provided with the distribution.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+package net.runelite.client.plugins.timetracking.farming;\n+\n+import java.awt.Color;\n+import java.awt.image.BufferedImage;\n+import javax.annotation.Nonnull;\n+import lombok.Getter;\n+import net.runelite.client.plugins.Plugin;\n+import net.runelite.client.plugins.timetracking.SummaryState;\n+import net.runelite.client.plugins.timetracking.TimeTrackingConfig;\n+import net.runelite.client.ui.ColorScheme;\n+import net.runelite.client.ui.overlay.infobox.InfoBox;\n+import net.runelite.client.util.ColorUtil;\n+import net.runelite.client.util.Text;\n+\n+class FarmingContractInfoBox extends InfoBox\n+{\n+\t@Getter\n+\tprivate final FarmingContract contract;\n+\tprivate final FarmingContractManager manager;\n+\tprivate final TimeTrackingConfig config;\n+\n+\tFarmingContractInfoBox(@Nonnull BufferedImage image, @Nonnull Plugin plugin, @Nonnull FarmingContract contract, @Nonnull TimeTrackingConfig config, @Nonnull FarmingContractManager manager)", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MDAxOA==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421740018", "bodyText": "Why isn't this just part of Produce?", "author": "abextm", "createdAt": "2020-05-07T19:25:38Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/farming/FarmingContract.java", "diffHunk": "@@ -0,0 +1,139 @@\n+/*\n+ * Copyright (c) 2019, Koekkruimels <https://github.com/koekkruimels>\n+ * Copyright (c) 2020, melky <https://github.com/melkypie>\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this\n+ *    list of conditions and the following disclaimer.\n+ * 2. Redistributions in binary form must reproduce the above copyright notice,\n+ *    this list of conditions and the following disclaimer in the documentation\n+ *    and/or other materials provided with the distribution.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+package net.runelite.client.plugins.timetracking.farming;\n+\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import lombok.AllArgsConstructor;\n+import lombok.Getter;\n+\n+@Getter\n+@AllArgsConstructor\n+enum FarmingContract", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MDQ2NA==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421740464", "bodyText": "its probably more clear to just use a BooleanPredicate than this", "author": "abextm", "createdAt": "2020-05-07T19:26:23Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/OverviewItemPanel.java", "diffHunk": "@@ -43,11 +43,27 @@\n \n class OverviewItemPanel extends JPanel\n {\n+\tinterface TabSwitch\n+\t{\n+\t\tvoid selected();\n+\t}\n+\n+\tinterface Selectable", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MDk5Ng==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421740996", "bodyText": "this can just be a Runnable instead", "author": "abextm", "createdAt": "2020-05-07T19:27:21Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/OverviewItemPanel.java", "diffHunk": "@@ -43,11 +43,27 @@\n \n class OverviewItemPanel extends JPanel\n {\n+\tinterface TabSwitch", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MTQ0Ng==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421741446", "bodyText": "tabSwitch -> onTabSwitched", "author": "abextm", "createdAt": "2020-05-07T19:28:11Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/OverviewItemPanel.java", "diffHunk": "@@ -56,16 +72,23 @@\n \n \tOverviewItemPanel(ItemManager itemManager, TimeTrackingPanel pluginPanel, Tab tab, String title)\n \t{\n+\t\tthis(itemManager, () -> pluginPanel.switchTab(tab), () -> true, tab.getItemID(), title);\n+\t}\n+\n+\tOverviewItemPanel(ItemManager itemManager, TabSwitch tabSwitch, Selectable selectable, int iconItemID, String title)", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0Mjc1OQ==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421742759", "bodyText": "static + move to the top of the class", "author": "abextm", "createdAt": "2020-05-07T19:30:37Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/TimeTrackingPlugin.java", "diffHunk": "@@ -96,6 +102,7 @@\n \n \tprivate WorldPoint lastTickLocation;\n \tprivate boolean lastTickPostLogin;\n+\tprivate final String CONTRACT_COMPLETED = \"You've completed a Farming Guild Contract. You should return to Guildmaster Jane.\";", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MzU5Nw==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421743597", "bodyText": "this is unused", "author": "abextm", "createdAt": "2020-05-07T19:32:12Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/farming/FarmingContractManager.java", "diffHunk": "@@ -0,0 +1,351 @@\n+/*\n+ * Copyright (c) 2019, Koekkruimels <https://github.com/koekkruimels>\n+ * Copyright (c) 2020, melky <https://github.com/melkypie>\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this\n+ *    list of conditions and the following disclaimer.\n+ * 2. Redistributions in binary form must reproduce the above copyright notice,\n+ *    this list of conditions and the following disclaimer in the documentation\n+ *    and/or other materials provided with the distribution.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+package net.runelite.client.plugins.timetracking.farming;\n+\n+import java.time.Instant;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import net.runelite.api.Client;\n+import net.runelite.api.coords.WorldPoint;\n+import net.runelite.api.widgets.Widget;\n+import net.runelite.api.widgets.WidgetInfo;\n+import net.runelite.client.config.ConfigManager;\n+import net.runelite.client.game.ItemManager;\n+import net.runelite.client.plugins.timetracking.SummaryState;\n+import net.runelite.client.plugins.timetracking.Tab;\n+import net.runelite.client.plugins.timetracking.TimeTrackingConfig;\n+import net.runelite.client.plugins.timetracking.TimeTrackingPlugin;\n+import net.runelite.client.ui.overlay.infobox.InfoBoxManager;\n+import net.runelite.client.util.Text;\n+\n+@Slf4j\n+public class FarmingContractManager\n+{\n+\tprivate static final int GUILDMASTER_JANE_WIDGET_MODEL_ID = 8628;\n+\tprivate static final int FARMING_GUILD_REGION_ID = 4922;\n+\tprivate static final String CONTRACT_ASSIGN_REGEX = \"(?:We need you to grow|Please could you grow) (?:some|a|an) ([a-zA-Z ]+)(?: for us\\\\?|\\\\.)\";\n+\tprivate static final String CONTRACT_REWARDED = \"You'll be wanting a reward then. Here you go.\";\n+\n+\tprivate static final String FARMING_REGION_NAME = \"Farming Guild\";\n+\tprivate static final String HTML_STRIP = \"\\\\<[^>]*>\";", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0NTQ2OA==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421745468", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tFarmingContractManager manager\n          \n          \n            \n            \t\tFarmingContractManager farmingContractManager", "author": "abextm", "createdAt": "2020-05-07T19:35:33Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/farming/FarmingTabPanel.java", "diffHunk": "@@ -40,25 +41,29 @@\n import net.runelite.client.plugins.timetracking.TimeablePanel;\n import net.runelite.client.ui.ColorScheme;\n import net.runelite.client.ui.FontManager;\n+import net.runelite.client.util.Text;\n \n public class FarmingTabPanel extends TabContentPanel\n {\n \tprivate final FarmingTracker farmingTracker;\n \tprivate final ItemManager itemManager;\n \tprivate final TimeTrackingConfig config;\n \tprivate final List<TimeablePanel<FarmingPatch>> patchPanels;\n+\tprivate final FarmingContractManager farmingContractManager;\n \n \tFarmingTabPanel(\n \t\tFarmingTracker farmingTracker,\n \t\tItemManager itemManager,\n \t\tTimeTrackingConfig config,\n-\t\tSet<FarmingPatch> patches\n+\t\tSet<FarmingPatch> patches,\n+\t\tFarmingContractManager manager", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0NTg2Nw==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421745867", "bodyText": "remove this newline", "author": "abextm", "createdAt": "2020-05-07T19:36:18Z", "path": "runelite-client/src/main/java/net/runelite/client/util/Text.java", "diffHunk": "@@ -206,4 +210,49 @@ public static boolean matchesSearchTerms(String[] searchTerms, final Collection<\n \t\t}\n \t\treturn true;\n \t}\n+\n+\t/**\n+\t * Returns a formatted time string\n+\t *\n+\t * @param remainingSeconds\n+\t * @param useRelativeTime\n+\t * @return a relative time string (1d 2h 3m) if useRelativeTime is true, date time string (Sunday at 3:05) (at 17:30) if useRelativeTime is false\n+\t */\n+", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0NjAyNA==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421746024", "bodyText": "why did you move this?", "author": "abextm", "createdAt": "2020-05-07T19:36:38Z", "path": "runelite-client/src/main/java/net/runelite/client/util/Text.java", "diffHunk": "@@ -206,4 +210,49 @@ public static boolean matchesSearchTerms(String[] searchTerms, final Collection<\n \t\t}\n \t\treturn true;\n \t}\n+\n+\t/**\n+\t * Returns a formatted time string\n+\t *\n+\t * @param remainingSeconds\n+\t * @param useRelativeTime\n+\t * @return a relative time string (1d 2h 3m) if useRelativeTime is true, date time string (Sunday at 3:05) (at 17:30) if useRelativeTime is false\n+\t */\n+\n+\tpublic static String getFormattedEstimate(long remainingSeconds, boolean useRelativeTime)", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc3MTkzOQ==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421771939", "bodyText": "I couldn't think of a better way to be able to access this for the infobox.", "author": "melkypie", "createdAt": "2020-05-07T20:24:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0NjAyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc3NDIwNQ==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421774205", "bodyText": "just make it public where it used to be?", "author": "abextm", "createdAt": "2020-05-07T20:29:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0NjAyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0NzA5Mw==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421747093", "bodyText": "just store this in FarmingWorld and add a getter so you don't have to iterate", "author": "abextm", "createdAt": "2020-05-07T19:38:39Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/farming/FarmingContractManager.java", "diffHunk": "@@ -0,0 +1,351 @@\n+/*\n+ * Copyright (c) 2019, Koekkruimels <https://github.com/koekkruimels>\n+ * Copyright (c) 2020, melky <https://github.com/melkypie>\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this\n+ *    list of conditions and the following disclaimer.\n+ * 2. Redistributions in binary form must reproduce the above copyright notice,\n+ *    this list of conditions and the following disclaimer in the documentation\n+ *    and/or other materials provided with the distribution.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+package net.runelite.client.plugins.timetracking.farming;\n+\n+import java.time.Instant;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import net.runelite.api.Client;\n+import net.runelite.api.coords.WorldPoint;\n+import net.runelite.api.widgets.Widget;\n+import net.runelite.api.widgets.WidgetInfo;\n+import net.runelite.client.config.ConfigManager;\n+import net.runelite.client.game.ItemManager;\n+import net.runelite.client.plugins.timetracking.SummaryState;\n+import net.runelite.client.plugins.timetracking.Tab;\n+import net.runelite.client.plugins.timetracking.TimeTrackingConfig;\n+import net.runelite.client.plugins.timetracking.TimeTrackingPlugin;\n+import net.runelite.client.ui.overlay.infobox.InfoBoxManager;\n+import net.runelite.client.util.Text;\n+\n+@Slf4j\n+public class FarmingContractManager\n+{\n+\tprivate static final int GUILDMASTER_JANE_WIDGET_MODEL_ID = 8628;\n+\tprivate static final int FARMING_GUILD_REGION_ID = 4922;\n+\tprivate static final String CONTRACT_ASSIGN_REGEX = \"(?:We need you to grow|Please could you grow) (?:some|a|an) ([a-zA-Z ]+)(?: for us\\\\?|\\\\.)\";\n+\tprivate static final String CONTRACT_REWARDED = \"You'll be wanting a reward then. Here you go.\";\n+\n+\tprivate static final String FARMING_REGION_NAME = \"Farming Guild\";\n+\tprivate static final String HTML_STRIP = \"\\\\<[^>]*>\";\n+\tprivate static final String CONFIG_KEY_CONTRACT = \"contract\";\n+\n+\t@Getter\n+\tprivate SummaryState summary = SummaryState.UNKNOWN;\n+\n+\tprivate final Client client;\n+\tprivate final ItemManager itemManager;\n+\tprivate final TimeTrackingConfig config;\n+\tprivate final TimeTrackingPlugin plugin;\n+\tprivate final FarmingWorld farmingWorld;\n+\tprivate final FarmingTracker farmingTracker;\n+\tprivate final InfoBoxManager infoBoxManager;\n+\tprivate final ConfigManager configManager;\n+\n+\tprivate FarmingContract contract = null;\n+\tprivate FarmingContractInfoBox infoBox;\n+\n+\t@Getter\n+\tprivate long completionTime;\n+\n+\t@Inject\n+\tpublic FarmingContractManager(\n+\t\t@Nonnull Client client,\n+\t\t@Nonnull ItemManager itemManager,\n+\t\t@Nonnull TimeTrackingConfig config,\n+\t\t@Nonnull TimeTrackingPlugin plugin,\n+\t\t@Nonnull FarmingWorld farmingWorld,\n+\t\t@Nonnull FarmingTracker farmingTracker,\n+\t\t@Nonnull InfoBoxManager infoBoxManager,\n+\t\t@Nonnull ConfigManager configManager\n+\t)\n+\t{\n+\t\tthis.client = client;\n+\t\tthis.itemManager = itemManager;\n+\t\tthis.config = config;\n+\t\tthis.plugin = plugin;\n+\t\tthis.farmingWorld = farmingWorld;\n+\t\tthis.farmingTracker = farmingTracker;\n+\t\tthis.infoBoxManager = infoBoxManager;\n+\t\tthis.configManager = configManager;\n+\t}\n+\n+\tpublic void setContract(@Nullable FarmingContract contract)\n+\t{\n+\t\tthis.contract = contract;\n+\t\tsetStoredContract(contract);\n+\t\thandleContractState();\n+\t}\n+\n+\tpublic boolean hasContract()\n+\t{\n+\t\treturn contract != null;\n+\t}\n+\n+\t@Nullable\n+\tpublic Tab getContractTab()\n+\t{\n+\t\treturn hasContract() ? contract.getPatchImplementation().getTab() : null;\n+\t}\n+\n+\t@Nullable\n+\tpublic String getContractName()\n+\t{\n+\t\treturn hasContract() ? contract.getName() : null;\n+\t}\n+\n+\tpublic boolean shouldHighlightFarmingTabPanel(@Nonnull FarmingPatch patch)\n+\t{\n+\t\tPatchPrediction patchPrediction = farmingTracker.predictPatch(patch);\n+\t\tif (contract != null &&\n+\t\t\tpatch.getRegion().getName().equalsIgnoreCase(FARMING_REGION_NAME) &&\n+\t\t\tcontract.getPatchImplementation() == patch.getImplementation() &&\n+\t\t\tpatchPrediction != null &&\n+\t\t\t(patchPrediction.getProduce().equals(contract.getProduce()) || summary == SummaryState.EMPTY))\n+\t\t{\n+\t\t\treturn true;\n+\t\t}\n+\t\treturn false;\n+\t}\n+\n+\tpublic void loadContractFromConfig()\n+\t{\n+\t\tcontract = getStoredContract();\n+\t\thandleContractState();\n+\t}\n+\n+\tpublic boolean updateData(WorldPoint loc)\n+\t{\n+\t\tSummaryState oldSummary = summary;\n+\n+\t\thandleContractState();\n+\t\tif (loc.getRegionID() == FARMING_GUILD_REGION_ID)\n+\t\t{\n+\t\t\thandleGuildmasterJaneWidgetDialog();\n+\t\t\thandleInfoBox();\n+\t\t}\n+\t\telse\n+\t\t{\n+\t\t\tif (infoBox != null)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = null;\n+\t\t\t}\n+\t\t}\n+\t\treturn oldSummary != summary;\n+\t}\n+\n+\tprivate void handleInfoBox()\n+\t{\n+\t\tif (infoBox != null)\n+\t\t{\n+\t\t\tif (contract == null)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = null;\n+\t\t\t}\n+\t\t\telse if (infoBox.getContract() != contract)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = new FarmingContractInfoBox(itemManager.getImage(contract.getProduce().getItemID()), plugin, contract, config, this);\n+\t\t\t\tinfoBoxManager.addInfoBox(infoBox);\n+\t\t\t}\n+\t\t}\n+\t\telse if (contract != null)\n+\t\t{\n+\t\t\tinfoBox = new FarmingContractInfoBox(itemManager.getImage(contract.getProduce().getItemID()), plugin, contract, config, this);\n+\t\t\tinfoBoxManager.addInfoBox(infoBox);\n+\t\t}\n+\t}\n+\n+\tprivate void handleGuildmasterJaneWidgetDialog()\n+\t{\n+\t\tWidget npcDialog = client.getWidget(WidgetInfo.DIALOG_NPC_HEAD_MODEL);\n+\n+\t\tif (npcDialog == null || npcDialog.getModelId() != GUILDMASTER_JANE_WIDGET_MODEL_ID)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tString dialogText = Text.removeTags(client.getWidget(WidgetInfo.DIALOG_NPC_TEXT).getText());\n+\t\tlog.debug(dialogText + \" \");\n+\n+\t\tif (dialogText.equals(CONTRACT_REWARDED))\n+\t\t{\n+\t\t\tsetContract(null);\n+\t\t\t;\n+\t\t}\n+\t\thandleContractAssigning(dialogText);\n+\t}\n+\n+\tprivate void handleContractAssigning(@Nonnull String dialogText)\n+\t{\n+\t\tPattern pattern = Pattern.compile(CONTRACT_ASSIGN_REGEX);\n+\t\tMatcher matcher = pattern.matcher(dialogText);\n+\n+\t\tif (!matcher.find())\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tString name = matcher.group(1);\n+\n+\t\tFarmingContract farmingContract = FarmingContract.getByName(name);\n+\n+\t\tif (farmingContract == null)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tFarmingContract currentFarmingContract = contract;\n+\n+\t\tif (farmingContract == currentFarmingContract)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tsetContract(farmingContract);\n+\t}\n+\n+\tprivate void handleContractState()\n+\t{\n+\t\tif (contract == null)\n+\t\t{\n+\t\t\tsummary = SummaryState.UNKNOWN;\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tPatchImplementation patchImplementation = contract.getPatchImplementation();\n+\t\tList<PatchPrediction> predictions = new ArrayList<>();\n+\n+\t\tfor (FarmingRegion farmingRegion : farmingWorld.getRegions().values())\n+\t\t{\n+\t\t\tif (!farmingRegion.getName().equalsIgnoreCase(FARMING_REGION_NAME))", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc1MDQwNw==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421750407", "bodyText": "same as below; don't compare ui strings", "author": "abextm", "createdAt": "2020-05-07T19:44:36Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/farming/FarmingContractManager.java", "diffHunk": "@@ -0,0 +1,351 @@\n+/*\n+ * Copyright (c) 2019, Koekkruimels <https://github.com/koekkruimels>\n+ * Copyright (c) 2020, melky <https://github.com/melkypie>\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this\n+ *    list of conditions and the following disclaimer.\n+ * 2. Redistributions in binary form must reproduce the above copyright notice,\n+ *    this list of conditions and the following disclaimer in the documentation\n+ *    and/or other materials provided with the distribution.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+package net.runelite.client.plugins.timetracking.farming;\n+\n+import java.time.Instant;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import net.runelite.api.Client;\n+import net.runelite.api.coords.WorldPoint;\n+import net.runelite.api.widgets.Widget;\n+import net.runelite.api.widgets.WidgetInfo;\n+import net.runelite.client.config.ConfigManager;\n+import net.runelite.client.game.ItemManager;\n+import net.runelite.client.plugins.timetracking.SummaryState;\n+import net.runelite.client.plugins.timetracking.Tab;\n+import net.runelite.client.plugins.timetracking.TimeTrackingConfig;\n+import net.runelite.client.plugins.timetracking.TimeTrackingPlugin;\n+import net.runelite.client.ui.overlay.infobox.InfoBoxManager;\n+import net.runelite.client.util.Text;\n+\n+@Slf4j\n+public class FarmingContractManager\n+{\n+\tprivate static final int GUILDMASTER_JANE_WIDGET_MODEL_ID = 8628;\n+\tprivate static final int FARMING_GUILD_REGION_ID = 4922;\n+\tprivate static final String CONTRACT_ASSIGN_REGEX = \"(?:We need you to grow|Please could you grow) (?:some|a|an) ([a-zA-Z ]+)(?: for us\\\\?|\\\\.)\";\n+\tprivate static final String CONTRACT_REWARDED = \"You'll be wanting a reward then. Here you go.\";\n+\n+\tprivate static final String FARMING_REGION_NAME = \"Farming Guild\";\n+\tprivate static final String HTML_STRIP = \"\\\\<[^>]*>\";\n+\tprivate static final String CONFIG_KEY_CONTRACT = \"contract\";\n+\n+\t@Getter\n+\tprivate SummaryState summary = SummaryState.UNKNOWN;\n+\n+\tprivate final Client client;\n+\tprivate final ItemManager itemManager;\n+\tprivate final TimeTrackingConfig config;\n+\tprivate final TimeTrackingPlugin plugin;\n+\tprivate final FarmingWorld farmingWorld;\n+\tprivate final FarmingTracker farmingTracker;\n+\tprivate final InfoBoxManager infoBoxManager;\n+\tprivate final ConfigManager configManager;\n+\n+\tprivate FarmingContract contract = null;\n+\tprivate FarmingContractInfoBox infoBox;\n+\n+\t@Getter\n+\tprivate long completionTime;\n+\n+\t@Inject\n+\tpublic FarmingContractManager(\n+\t\t@Nonnull Client client,\n+\t\t@Nonnull ItemManager itemManager,\n+\t\t@Nonnull TimeTrackingConfig config,\n+\t\t@Nonnull TimeTrackingPlugin plugin,\n+\t\t@Nonnull FarmingWorld farmingWorld,\n+\t\t@Nonnull FarmingTracker farmingTracker,\n+\t\t@Nonnull InfoBoxManager infoBoxManager,\n+\t\t@Nonnull ConfigManager configManager\n+\t)\n+\t{\n+\t\tthis.client = client;\n+\t\tthis.itemManager = itemManager;\n+\t\tthis.config = config;\n+\t\tthis.plugin = plugin;\n+\t\tthis.farmingWorld = farmingWorld;\n+\t\tthis.farmingTracker = farmingTracker;\n+\t\tthis.infoBoxManager = infoBoxManager;\n+\t\tthis.configManager = configManager;\n+\t}\n+\n+\tpublic void setContract(@Nullable FarmingContract contract)\n+\t{\n+\t\tthis.contract = contract;\n+\t\tsetStoredContract(contract);\n+\t\thandleContractState();\n+\t}\n+\n+\tpublic boolean hasContract()\n+\t{\n+\t\treturn contract != null;\n+\t}\n+\n+\t@Nullable\n+\tpublic Tab getContractTab()\n+\t{\n+\t\treturn hasContract() ? contract.getPatchImplementation().getTab() : null;\n+\t}\n+\n+\t@Nullable\n+\tpublic String getContractName()\n+\t{\n+\t\treturn hasContract() ? contract.getName() : null;\n+\t}\n+\n+\tpublic boolean shouldHighlightFarmingTabPanel(@Nonnull FarmingPatch patch)\n+\t{\n+\t\tPatchPrediction patchPrediction = farmingTracker.predictPatch(patch);\n+\t\tif (contract != null &&\n+\t\t\tpatch.getRegion().getName().equalsIgnoreCase(FARMING_REGION_NAME) &&", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc1MTM2MA==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421751360", "bodyText": "?", "author": "abextm", "createdAt": "2020-05-07T19:46:19Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/farming/FarmingContractManager.java", "diffHunk": "@@ -0,0 +1,351 @@\n+/*\n+ * Copyright (c) 2019, Koekkruimels <https://github.com/koekkruimels>\n+ * Copyright (c) 2020, melky <https://github.com/melkypie>\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this\n+ *    list of conditions and the following disclaimer.\n+ * 2. Redistributions in binary form must reproduce the above copyright notice,\n+ *    this list of conditions and the following disclaimer in the documentation\n+ *    and/or other materials provided with the distribution.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+package net.runelite.client.plugins.timetracking.farming;\n+\n+import java.time.Instant;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import net.runelite.api.Client;\n+import net.runelite.api.coords.WorldPoint;\n+import net.runelite.api.widgets.Widget;\n+import net.runelite.api.widgets.WidgetInfo;\n+import net.runelite.client.config.ConfigManager;\n+import net.runelite.client.game.ItemManager;\n+import net.runelite.client.plugins.timetracking.SummaryState;\n+import net.runelite.client.plugins.timetracking.Tab;\n+import net.runelite.client.plugins.timetracking.TimeTrackingConfig;\n+import net.runelite.client.plugins.timetracking.TimeTrackingPlugin;\n+import net.runelite.client.ui.overlay.infobox.InfoBoxManager;\n+import net.runelite.client.util.Text;\n+\n+@Slf4j\n+public class FarmingContractManager\n+{\n+\tprivate static final int GUILDMASTER_JANE_WIDGET_MODEL_ID = 8628;\n+\tprivate static final int FARMING_GUILD_REGION_ID = 4922;\n+\tprivate static final String CONTRACT_ASSIGN_REGEX = \"(?:We need you to grow|Please could you grow) (?:some|a|an) ([a-zA-Z ]+)(?: for us\\\\?|\\\\.)\";\n+\tprivate static final String CONTRACT_REWARDED = \"You'll be wanting a reward then. Here you go.\";\n+\n+\tprivate static final String FARMING_REGION_NAME = \"Farming Guild\";\n+\tprivate static final String HTML_STRIP = \"\\\\<[^>]*>\";\n+\tprivate static final String CONFIG_KEY_CONTRACT = \"contract\";\n+\n+\t@Getter\n+\tprivate SummaryState summary = SummaryState.UNKNOWN;\n+\n+\tprivate final Client client;\n+\tprivate final ItemManager itemManager;\n+\tprivate final TimeTrackingConfig config;\n+\tprivate final TimeTrackingPlugin plugin;\n+\tprivate final FarmingWorld farmingWorld;\n+\tprivate final FarmingTracker farmingTracker;\n+\tprivate final InfoBoxManager infoBoxManager;\n+\tprivate final ConfigManager configManager;\n+\n+\tprivate FarmingContract contract = null;\n+\tprivate FarmingContractInfoBox infoBox;\n+\n+\t@Getter\n+\tprivate long completionTime;\n+\n+\t@Inject\n+\tpublic FarmingContractManager(\n+\t\t@Nonnull Client client,\n+\t\t@Nonnull ItemManager itemManager,\n+\t\t@Nonnull TimeTrackingConfig config,\n+\t\t@Nonnull TimeTrackingPlugin plugin,\n+\t\t@Nonnull FarmingWorld farmingWorld,\n+\t\t@Nonnull FarmingTracker farmingTracker,\n+\t\t@Nonnull InfoBoxManager infoBoxManager,\n+\t\t@Nonnull ConfigManager configManager\n+\t)\n+\t{\n+\t\tthis.client = client;\n+\t\tthis.itemManager = itemManager;\n+\t\tthis.config = config;\n+\t\tthis.plugin = plugin;\n+\t\tthis.farmingWorld = farmingWorld;\n+\t\tthis.farmingTracker = farmingTracker;\n+\t\tthis.infoBoxManager = infoBoxManager;\n+\t\tthis.configManager = configManager;\n+\t}\n+\n+\tpublic void setContract(@Nullable FarmingContract contract)\n+\t{\n+\t\tthis.contract = contract;\n+\t\tsetStoredContract(contract);\n+\t\thandleContractState();\n+\t}\n+\n+\tpublic boolean hasContract()\n+\t{\n+\t\treturn contract != null;\n+\t}\n+\n+\t@Nullable\n+\tpublic Tab getContractTab()\n+\t{\n+\t\treturn hasContract() ? contract.getPatchImplementation().getTab() : null;\n+\t}\n+\n+\t@Nullable\n+\tpublic String getContractName()\n+\t{\n+\t\treturn hasContract() ? contract.getName() : null;\n+\t}\n+\n+\tpublic boolean shouldHighlightFarmingTabPanel(@Nonnull FarmingPatch patch)\n+\t{\n+\t\tPatchPrediction patchPrediction = farmingTracker.predictPatch(patch);\n+\t\tif (contract != null &&\n+\t\t\tpatch.getRegion().getName().equalsIgnoreCase(FARMING_REGION_NAME) &&\n+\t\t\tcontract.getPatchImplementation() == patch.getImplementation() &&\n+\t\t\tpatchPrediction != null &&\n+\t\t\t(patchPrediction.getProduce().equals(contract.getProduce()) || summary == SummaryState.EMPTY))\n+\t\t{\n+\t\t\treturn true;\n+\t\t}\n+\t\treturn false;\n+\t}\n+\n+\tpublic void loadContractFromConfig()\n+\t{\n+\t\tcontract = getStoredContract();\n+\t\thandleContractState();\n+\t}\n+\n+\tpublic boolean updateData(WorldPoint loc)\n+\t{\n+\t\tSummaryState oldSummary = summary;\n+\n+\t\thandleContractState();\n+\t\tif (loc.getRegionID() == FARMING_GUILD_REGION_ID)\n+\t\t{\n+\t\t\thandleGuildmasterJaneWidgetDialog();\n+\t\t\thandleInfoBox();\n+\t\t}\n+\t\telse\n+\t\t{\n+\t\t\tif (infoBox != null)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = null;\n+\t\t\t}\n+\t\t}\n+\t\treturn oldSummary != summary;\n+\t}\n+\n+\tprivate void handleInfoBox()\n+\t{\n+\t\tif (infoBox != null)\n+\t\t{\n+\t\t\tif (contract == null)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = null;\n+\t\t\t}\n+\t\t\telse if (infoBox.getContract() != contract)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = new FarmingContractInfoBox(itemManager.getImage(contract.getProduce().getItemID()), plugin, contract, config, this);\n+\t\t\t\tinfoBoxManager.addInfoBox(infoBox);\n+\t\t\t}\n+\t\t}\n+\t\telse if (contract != null)\n+\t\t{\n+\t\t\tinfoBox = new FarmingContractInfoBox(itemManager.getImage(contract.getProduce().getItemID()), plugin, contract, config, this);\n+\t\t\tinfoBoxManager.addInfoBox(infoBox);\n+\t\t}\n+\t}\n+\n+\tprivate void handleGuildmasterJaneWidgetDialog()\n+\t{\n+\t\tWidget npcDialog = client.getWidget(WidgetInfo.DIALOG_NPC_HEAD_MODEL);\n+\n+\t\tif (npcDialog == null || npcDialog.getModelId() != GUILDMASTER_JANE_WIDGET_MODEL_ID)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tString dialogText = Text.removeTags(client.getWidget(WidgetInfo.DIALOG_NPC_TEXT).getText());\n+\t\tlog.debug(dialogText + \" \");", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc1MTg2Mw==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421751863", "bodyText": "just remove these 4 lines, there is no reason for this to be its own method when you are just tail calling it", "author": "abextm", "createdAt": "2020-05-07T19:47:11Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/farming/FarmingContractManager.java", "diffHunk": "@@ -0,0 +1,351 @@\n+/*\n+ * Copyright (c) 2019, Koekkruimels <https://github.com/koekkruimels>\n+ * Copyright (c) 2020, melky <https://github.com/melkypie>\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this\n+ *    list of conditions and the following disclaimer.\n+ * 2. Redistributions in binary form must reproduce the above copyright notice,\n+ *    this list of conditions and the following disclaimer in the documentation\n+ *    and/or other materials provided with the distribution.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+package net.runelite.client.plugins.timetracking.farming;\n+\n+import java.time.Instant;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import net.runelite.api.Client;\n+import net.runelite.api.coords.WorldPoint;\n+import net.runelite.api.widgets.Widget;\n+import net.runelite.api.widgets.WidgetInfo;\n+import net.runelite.client.config.ConfigManager;\n+import net.runelite.client.game.ItemManager;\n+import net.runelite.client.plugins.timetracking.SummaryState;\n+import net.runelite.client.plugins.timetracking.Tab;\n+import net.runelite.client.plugins.timetracking.TimeTrackingConfig;\n+import net.runelite.client.plugins.timetracking.TimeTrackingPlugin;\n+import net.runelite.client.ui.overlay.infobox.InfoBoxManager;\n+import net.runelite.client.util.Text;\n+\n+@Slf4j\n+public class FarmingContractManager\n+{\n+\tprivate static final int GUILDMASTER_JANE_WIDGET_MODEL_ID = 8628;\n+\tprivate static final int FARMING_GUILD_REGION_ID = 4922;\n+\tprivate static final String CONTRACT_ASSIGN_REGEX = \"(?:We need you to grow|Please could you grow) (?:some|a|an) ([a-zA-Z ]+)(?: for us\\\\?|\\\\.)\";\n+\tprivate static final String CONTRACT_REWARDED = \"You'll be wanting a reward then. Here you go.\";\n+\n+\tprivate static final String FARMING_REGION_NAME = \"Farming Guild\";\n+\tprivate static final String HTML_STRIP = \"\\\\<[^>]*>\";\n+\tprivate static final String CONFIG_KEY_CONTRACT = \"contract\";\n+\n+\t@Getter\n+\tprivate SummaryState summary = SummaryState.UNKNOWN;\n+\n+\tprivate final Client client;\n+\tprivate final ItemManager itemManager;\n+\tprivate final TimeTrackingConfig config;\n+\tprivate final TimeTrackingPlugin plugin;\n+\tprivate final FarmingWorld farmingWorld;\n+\tprivate final FarmingTracker farmingTracker;\n+\tprivate final InfoBoxManager infoBoxManager;\n+\tprivate final ConfigManager configManager;\n+\n+\tprivate FarmingContract contract = null;\n+\tprivate FarmingContractInfoBox infoBox;\n+\n+\t@Getter\n+\tprivate long completionTime;\n+\n+\t@Inject\n+\tpublic FarmingContractManager(\n+\t\t@Nonnull Client client,\n+\t\t@Nonnull ItemManager itemManager,\n+\t\t@Nonnull TimeTrackingConfig config,\n+\t\t@Nonnull TimeTrackingPlugin plugin,\n+\t\t@Nonnull FarmingWorld farmingWorld,\n+\t\t@Nonnull FarmingTracker farmingTracker,\n+\t\t@Nonnull InfoBoxManager infoBoxManager,\n+\t\t@Nonnull ConfigManager configManager\n+\t)\n+\t{\n+\t\tthis.client = client;\n+\t\tthis.itemManager = itemManager;\n+\t\tthis.config = config;\n+\t\tthis.plugin = plugin;\n+\t\tthis.farmingWorld = farmingWorld;\n+\t\tthis.farmingTracker = farmingTracker;\n+\t\tthis.infoBoxManager = infoBoxManager;\n+\t\tthis.configManager = configManager;\n+\t}\n+\n+\tpublic void setContract(@Nullable FarmingContract contract)\n+\t{\n+\t\tthis.contract = contract;\n+\t\tsetStoredContract(contract);\n+\t\thandleContractState();\n+\t}\n+\n+\tpublic boolean hasContract()\n+\t{\n+\t\treturn contract != null;\n+\t}\n+\n+\t@Nullable\n+\tpublic Tab getContractTab()\n+\t{\n+\t\treturn hasContract() ? contract.getPatchImplementation().getTab() : null;\n+\t}\n+\n+\t@Nullable\n+\tpublic String getContractName()\n+\t{\n+\t\treturn hasContract() ? contract.getName() : null;\n+\t}\n+\n+\tpublic boolean shouldHighlightFarmingTabPanel(@Nonnull FarmingPatch patch)\n+\t{\n+\t\tPatchPrediction patchPrediction = farmingTracker.predictPatch(patch);\n+\t\tif (contract != null &&\n+\t\t\tpatch.getRegion().getName().equalsIgnoreCase(FARMING_REGION_NAME) &&\n+\t\t\tcontract.getPatchImplementation() == patch.getImplementation() &&\n+\t\t\tpatchPrediction != null &&\n+\t\t\t(patchPrediction.getProduce().equals(contract.getProduce()) || summary == SummaryState.EMPTY))\n+\t\t{\n+\t\t\treturn true;\n+\t\t}\n+\t\treturn false;\n+\t}\n+\n+\tpublic void loadContractFromConfig()\n+\t{\n+\t\tcontract = getStoredContract();\n+\t\thandleContractState();\n+\t}\n+\n+\tpublic boolean updateData(WorldPoint loc)\n+\t{\n+\t\tSummaryState oldSummary = summary;\n+\n+\t\thandleContractState();\n+\t\tif (loc.getRegionID() == FARMING_GUILD_REGION_ID)\n+\t\t{\n+\t\t\thandleGuildmasterJaneWidgetDialog();\n+\t\t\thandleInfoBox();\n+\t\t}\n+\t\telse\n+\t\t{\n+\t\t\tif (infoBox != null)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = null;\n+\t\t\t}\n+\t\t}\n+\t\treturn oldSummary != summary;\n+\t}\n+\n+\tprivate void handleInfoBox()\n+\t{\n+\t\tif (infoBox != null)\n+\t\t{\n+\t\t\tif (contract == null)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = null;\n+\t\t\t}\n+\t\t\telse if (infoBox.getContract() != contract)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = new FarmingContractInfoBox(itemManager.getImage(contract.getProduce().getItemID()), plugin, contract, config, this);\n+\t\t\t\tinfoBoxManager.addInfoBox(infoBox);\n+\t\t\t}\n+\t\t}\n+\t\telse if (contract != null)\n+\t\t{\n+\t\t\tinfoBox = new FarmingContractInfoBox(itemManager.getImage(contract.getProduce().getItemID()), plugin, contract, config, this);\n+\t\t\tinfoBoxManager.addInfoBox(infoBox);\n+\t\t}\n+\t}\n+\n+\tprivate void handleGuildmasterJaneWidgetDialog()\n+\t{\n+\t\tWidget npcDialog = client.getWidget(WidgetInfo.DIALOG_NPC_HEAD_MODEL);\n+\n+\t\tif (npcDialog == null || npcDialog.getModelId() != GUILDMASTER_JANE_WIDGET_MODEL_ID)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tString dialogText = Text.removeTags(client.getWidget(WidgetInfo.DIALOG_NPC_TEXT).getText());\n+\t\tlog.debug(dialogText + \" \");\n+\n+\t\tif (dialogText.equals(CONTRACT_REWARDED))\n+\t\t{\n+\t\t\tsetContract(null);\n+\t\t\t;\n+\t\t}\n+\t\thandleContractAssigning(dialogText);", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc1Mjc1Ng==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421752756", "bodyText": "this is always Math.max(0, v)?", "author": "abextm", "createdAt": "2020-05-07T19:48:45Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/farming/FarmingContractManager.java", "diffHunk": "@@ -0,0 +1,351 @@\n+/*\n+ * Copyright (c) 2019, Koekkruimels <https://github.com/koekkruimels>\n+ * Copyright (c) 2020, melky <https://github.com/melkypie>\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this\n+ *    list of conditions and the following disclaimer.\n+ * 2. Redistributions in binary form must reproduce the above copyright notice,\n+ *    this list of conditions and the following disclaimer in the documentation\n+ *    and/or other materials provided with the distribution.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+package net.runelite.client.plugins.timetracking.farming;\n+\n+import java.time.Instant;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import net.runelite.api.Client;\n+import net.runelite.api.coords.WorldPoint;\n+import net.runelite.api.widgets.Widget;\n+import net.runelite.api.widgets.WidgetInfo;\n+import net.runelite.client.config.ConfigManager;\n+import net.runelite.client.game.ItemManager;\n+import net.runelite.client.plugins.timetracking.SummaryState;\n+import net.runelite.client.plugins.timetracking.Tab;\n+import net.runelite.client.plugins.timetracking.TimeTrackingConfig;\n+import net.runelite.client.plugins.timetracking.TimeTrackingPlugin;\n+import net.runelite.client.ui.overlay.infobox.InfoBoxManager;\n+import net.runelite.client.util.Text;\n+\n+@Slf4j\n+public class FarmingContractManager\n+{\n+\tprivate static final int GUILDMASTER_JANE_WIDGET_MODEL_ID = 8628;\n+\tprivate static final int FARMING_GUILD_REGION_ID = 4922;\n+\tprivate static final String CONTRACT_ASSIGN_REGEX = \"(?:We need you to grow|Please could you grow) (?:some|a|an) ([a-zA-Z ]+)(?: for us\\\\?|\\\\.)\";\n+\tprivate static final String CONTRACT_REWARDED = \"You'll be wanting a reward then. Here you go.\";\n+\n+\tprivate static final String FARMING_REGION_NAME = \"Farming Guild\";\n+\tprivate static final String HTML_STRIP = \"\\\\<[^>]*>\";\n+\tprivate static final String CONFIG_KEY_CONTRACT = \"contract\";\n+\n+\t@Getter\n+\tprivate SummaryState summary = SummaryState.UNKNOWN;\n+\n+\tprivate final Client client;\n+\tprivate final ItemManager itemManager;\n+\tprivate final TimeTrackingConfig config;\n+\tprivate final TimeTrackingPlugin plugin;\n+\tprivate final FarmingWorld farmingWorld;\n+\tprivate final FarmingTracker farmingTracker;\n+\tprivate final InfoBoxManager infoBoxManager;\n+\tprivate final ConfigManager configManager;\n+\n+\tprivate FarmingContract contract = null;\n+\tprivate FarmingContractInfoBox infoBox;\n+\n+\t@Getter\n+\tprivate long completionTime;\n+\n+\t@Inject\n+\tpublic FarmingContractManager(\n+\t\t@Nonnull Client client,\n+\t\t@Nonnull ItemManager itemManager,\n+\t\t@Nonnull TimeTrackingConfig config,\n+\t\t@Nonnull TimeTrackingPlugin plugin,\n+\t\t@Nonnull FarmingWorld farmingWorld,\n+\t\t@Nonnull FarmingTracker farmingTracker,\n+\t\t@Nonnull InfoBoxManager infoBoxManager,\n+\t\t@Nonnull ConfigManager configManager\n+\t)\n+\t{\n+\t\tthis.client = client;\n+\t\tthis.itemManager = itemManager;\n+\t\tthis.config = config;\n+\t\tthis.plugin = plugin;\n+\t\tthis.farmingWorld = farmingWorld;\n+\t\tthis.farmingTracker = farmingTracker;\n+\t\tthis.infoBoxManager = infoBoxManager;\n+\t\tthis.configManager = configManager;\n+\t}\n+\n+\tpublic void setContract(@Nullable FarmingContract contract)\n+\t{\n+\t\tthis.contract = contract;\n+\t\tsetStoredContract(contract);\n+\t\thandleContractState();\n+\t}\n+\n+\tpublic boolean hasContract()\n+\t{\n+\t\treturn contract != null;\n+\t}\n+\n+\t@Nullable\n+\tpublic Tab getContractTab()\n+\t{\n+\t\treturn hasContract() ? contract.getPatchImplementation().getTab() : null;\n+\t}\n+\n+\t@Nullable\n+\tpublic String getContractName()\n+\t{\n+\t\treturn hasContract() ? contract.getName() : null;\n+\t}\n+\n+\tpublic boolean shouldHighlightFarmingTabPanel(@Nonnull FarmingPatch patch)\n+\t{\n+\t\tPatchPrediction patchPrediction = farmingTracker.predictPatch(patch);\n+\t\tif (contract != null &&\n+\t\t\tpatch.getRegion().getName().equalsIgnoreCase(FARMING_REGION_NAME) &&\n+\t\t\tcontract.getPatchImplementation() == patch.getImplementation() &&\n+\t\t\tpatchPrediction != null &&\n+\t\t\t(patchPrediction.getProduce().equals(contract.getProduce()) || summary == SummaryState.EMPTY))\n+\t\t{\n+\t\t\treturn true;\n+\t\t}\n+\t\treturn false;\n+\t}\n+\n+\tpublic void loadContractFromConfig()\n+\t{\n+\t\tcontract = getStoredContract();\n+\t\thandleContractState();\n+\t}\n+\n+\tpublic boolean updateData(WorldPoint loc)\n+\t{\n+\t\tSummaryState oldSummary = summary;\n+\n+\t\thandleContractState();\n+\t\tif (loc.getRegionID() == FARMING_GUILD_REGION_ID)\n+\t\t{\n+\t\t\thandleGuildmasterJaneWidgetDialog();\n+\t\t\thandleInfoBox();\n+\t\t}\n+\t\telse\n+\t\t{\n+\t\t\tif (infoBox != null)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = null;\n+\t\t\t}\n+\t\t}\n+\t\treturn oldSummary != summary;\n+\t}\n+\n+\tprivate void handleInfoBox()\n+\t{\n+\t\tif (infoBox != null)\n+\t\t{\n+\t\t\tif (contract == null)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = null;\n+\t\t\t}\n+\t\t\telse if (infoBox.getContract() != contract)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = new FarmingContractInfoBox(itemManager.getImage(contract.getProduce().getItemID()), plugin, contract, config, this);\n+\t\t\t\tinfoBoxManager.addInfoBox(infoBox);\n+\t\t\t}\n+\t\t}\n+\t\telse if (contract != null)\n+\t\t{\n+\t\t\tinfoBox = new FarmingContractInfoBox(itemManager.getImage(contract.getProduce().getItemID()), plugin, contract, config, this);\n+\t\t\tinfoBoxManager.addInfoBox(infoBox);\n+\t\t}\n+\t}\n+\n+\tprivate void handleGuildmasterJaneWidgetDialog()\n+\t{\n+\t\tWidget npcDialog = client.getWidget(WidgetInfo.DIALOG_NPC_HEAD_MODEL);\n+\n+\t\tif (npcDialog == null || npcDialog.getModelId() != GUILDMASTER_JANE_WIDGET_MODEL_ID)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tString dialogText = Text.removeTags(client.getWidget(WidgetInfo.DIALOG_NPC_TEXT).getText());\n+\t\tlog.debug(dialogText + \" \");\n+\n+\t\tif (dialogText.equals(CONTRACT_REWARDED))\n+\t\t{\n+\t\t\tsetContract(null);\n+\t\t\t;\n+\t\t}\n+\t\thandleContractAssigning(dialogText);\n+\t}\n+\n+\tprivate void handleContractAssigning(@Nonnull String dialogText)\n+\t{\n+\t\tPattern pattern = Pattern.compile(CONTRACT_ASSIGN_REGEX);\n+\t\tMatcher matcher = pattern.matcher(dialogText);\n+\n+\t\tif (!matcher.find())\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tString name = matcher.group(1);\n+\n+\t\tFarmingContract farmingContract = FarmingContract.getByName(name);\n+\n+\t\tif (farmingContract == null)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tFarmingContract currentFarmingContract = contract;\n+\n+\t\tif (farmingContract == currentFarmingContract)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tsetContract(farmingContract);\n+\t}\n+\n+\tprivate void handleContractState()\n+\t{\n+\t\tif (contract == null)\n+\t\t{\n+\t\t\tsummary = SummaryState.UNKNOWN;\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tPatchImplementation patchImplementation = contract.getPatchImplementation();\n+\t\tList<PatchPrediction> predictions = new ArrayList<>();\n+\n+\t\tfor (FarmingRegion farmingRegion : farmingWorld.getRegions().values())\n+\t\t{\n+\t\t\tif (!farmingRegion.getName().equalsIgnoreCase(FARMING_REGION_NAME))\n+\t\t\t{\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tfor (FarmingPatch patch : farmingRegion.getPatches())\n+\t\t\t{\n+\t\t\t\tif (patch.getImplementation() != patchImplementation)\n+\t\t\t\t{\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n+\n+\t\t\t\tPatchPrediction prediction = farmingTracker.predictPatch(patch);\n+\n+\t\t\t\tif (prediction == null)\n+\t\t\t\t{\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n+\n+\t\t\t\tpredictions.add(prediction);\n+\t\t\t}\n+\t\t}\n+\n+\t\tif (predictions.size() == 0)\n+\t\t{\n+\t\t\tsummary = SummaryState.UNKNOWN;\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tlong maxCompletionTime = 0;\n+\t\tint emptyPatches = 0;\n+\n+\t\tfor (PatchPrediction prediction : predictions)\n+\t\t{\n+\t\t\tif (prediction.getProduce() == null || prediction.getProduce() == Produce.WEEDS)\n+\t\t\t{\n+\t\t\t\tsummary = SummaryState.EMPTY;\n+\t\t\t\temptyPatches++;\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tif ((prediction.getProduce() != contract.getProduce() ||\n+\t\t\t\t(contract.requiresHealthCheck() && prediction.getCropState() == CropState.HARVESTABLE)) &&\n+\t\t\t\temptyPatches == 0)\n+\t\t\t{\n+\t\t\t\tsummary = SummaryState.OCCUPIED;\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tmaxCompletionTime = Math.max(maxCompletionTime, prediction.getDoneEstimate());", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc1MzY0Mg==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r421753642", "bodyText": "you can just fieldinject all of these since your ctor is otherwise empty", "author": "abextm", "createdAt": "2020-05-07T19:50:13Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/farming/FarmingContractManager.java", "diffHunk": "@@ -0,0 +1,351 @@\n+/*\n+ * Copyright (c) 2019, Koekkruimels <https://github.com/koekkruimels>\n+ * Copyright (c) 2020, melky <https://github.com/melkypie>\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this\n+ *    list of conditions and the following disclaimer.\n+ * 2. Redistributions in binary form must reproduce the above copyright notice,\n+ *    this list of conditions and the following disclaimer in the documentation\n+ *    and/or other materials provided with the distribution.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+package net.runelite.client.plugins.timetracking.farming;\n+\n+import java.time.Instant;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import net.runelite.api.Client;\n+import net.runelite.api.coords.WorldPoint;\n+import net.runelite.api.widgets.Widget;\n+import net.runelite.api.widgets.WidgetInfo;\n+import net.runelite.client.config.ConfigManager;\n+import net.runelite.client.game.ItemManager;\n+import net.runelite.client.plugins.timetracking.SummaryState;\n+import net.runelite.client.plugins.timetracking.Tab;\n+import net.runelite.client.plugins.timetracking.TimeTrackingConfig;\n+import net.runelite.client.plugins.timetracking.TimeTrackingPlugin;\n+import net.runelite.client.ui.overlay.infobox.InfoBoxManager;\n+import net.runelite.client.util.Text;\n+\n+@Slf4j\n+public class FarmingContractManager\n+{\n+\tprivate static final int GUILDMASTER_JANE_WIDGET_MODEL_ID = 8628;\n+\tprivate static final int FARMING_GUILD_REGION_ID = 4922;\n+\tprivate static final String CONTRACT_ASSIGN_REGEX = \"(?:We need you to grow|Please could you grow) (?:some|a|an) ([a-zA-Z ]+)(?: for us\\\\?|\\\\.)\";\n+\tprivate static final String CONTRACT_REWARDED = \"You'll be wanting a reward then. Here you go.\";\n+\n+\tprivate static final String FARMING_REGION_NAME = \"Farming Guild\";\n+\tprivate static final String HTML_STRIP = \"\\\\<[^>]*>\";\n+\tprivate static final String CONFIG_KEY_CONTRACT = \"contract\";\n+\n+\t@Getter\n+\tprivate SummaryState summary = SummaryState.UNKNOWN;\n+\n+\tprivate final Client client;\n+\tprivate final ItemManager itemManager;\n+\tprivate final TimeTrackingConfig config;\n+\tprivate final TimeTrackingPlugin plugin;\n+\tprivate final FarmingWorld farmingWorld;\n+\tprivate final FarmingTracker farmingTracker;\n+\tprivate final InfoBoxManager infoBoxManager;\n+\tprivate final ConfigManager configManager;\n+\n+\tprivate FarmingContract contract = null;\n+\tprivate FarmingContractInfoBox infoBox;\n+\n+\t@Getter\n+\tprivate long completionTime;\n+\n+\t@Inject\n+\tpublic FarmingContractManager(", "originalCommit": "8f5d8a88ca0efd485190caad9fedcca51ec67d88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "575bcd13c9594b9ba7a1a00ce5793ac477417feb", "url": "https://github.com/runelite/runelite/commit/575bcd13c9594b9ba7a1a00ce5793ac477417feb", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-05-07T21:12:15Z", "type": "forcePushed"}, {"oid": "98bc46e74ff4db0815850e3f8005a907018ee659", "url": "https://github.com/runelite/runelite/commit/98bc46e74ff4db0815850e3f8005a907018ee659", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-05-07T21:19:23Z", "type": "forcePushed"}, {"oid": "1523e476c42f441891243eca2710f8dd55ca6214", "url": "https://github.com/runelite/runelite/commit/1523e476c42f441891243eca2710f8dd55ca6214", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-05-07T21:25:30Z", "type": "forcePushed"}, {"oid": "bf602446601410035f9505c05c4e58c7de0edf36", "url": "https://github.com/runelite/runelite/commit/bf602446601410035f9505c05c4e58c7de0edf36", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-05-07T22:30:53Z", "type": "forcePushed"}, {"oid": "73c467de5430847895efa36886e2c08f8884dddc", "url": "https://github.com/runelite/runelite/commit/73c467de5430847895efa36886e2c08f8884dddc", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-05-08T10:14:45Z", "type": "forcePushed"}, {"oid": "0f01d3909f4e7851a6c2c00dafd42df20df4d21c", "url": "https://github.com/runelite/runelite/commit/0f01d3909f4e7851a6c2c00dafd42df20df4d21c", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-05-08T10:30:29Z", "type": "forcePushed"}, {"oid": "0632c02b0d5337c7c5668a8328a9ea65f5ea4441", "url": "https://github.com/runelite/runelite/commit/0632c02b0d5337c7c5668a8328a9ea65f5ea4441", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-05-08T11:04:03Z", "type": "forcePushed"}, {"oid": "3545be60cc59e5a8bfa90d22ed0a64ed40649c73", "url": "https://github.com/runelite/runelite/commit/3545be60cc59e5a8bfa90d22ed0a64ed40649c73", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-05-08T11:23:51Z", "type": "forcePushed"}, {"oid": "0f570d8379c0b75d09d9f593c649c74b983fd24d", "url": "https://github.com/runelite/runelite/commit/0f570d8379c0b75d09d9f593c649c74b983fd24d", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-05-08T13:17:48Z", "type": "forcePushed"}, {"oid": "c56f93d3d8f49748206824a956646006267f62f2", "url": "https://github.com/runelite/runelite/commit/c56f93d3d8f49748206824a956646006267f62f2", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-05-08T14:57:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQzMDEyNw==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r422430127", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tprivate static final int GUILDMASTER_JANE_WIDGET_MODEL_ID = NullNpcID.NULL_8628;\n          \n          \n            \n            \tprivate static final int GUILDMASTER_JANE_NPC_ID = NullNpcID.NULL_8628;", "author": "abextm", "createdAt": "2020-05-09T00:29:42Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/farming/FarmingContractManager.java", "diffHunk": "@@ -0,0 +1,322 @@\n+/*\n+ * Copyright (c) 2019, Koekkruimels <https://github.com/koekkruimels>\n+ * Copyright (c) 2020, melky <https://github.com/melkypie>\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this\n+ *    list of conditions and the following disclaimer.\n+ * 2. Redistributions in binary form must reproduce the above copyright notice,\n+ *    this list of conditions and the following disclaimer in the documentation\n+ *    and/or other materials provided with the distribution.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+package net.runelite.client.plugins.timetracking.farming;\n+\n+import java.time.Instant;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import net.runelite.api.Client;\n+import net.runelite.api.NullNpcID;\n+import net.runelite.api.coords.WorldPoint;\n+import net.runelite.api.widgets.Widget;\n+import net.runelite.api.widgets.WidgetInfo;\n+import net.runelite.client.config.ConfigManager;\n+import net.runelite.client.game.ItemManager;\n+import net.runelite.client.plugins.timetracking.SummaryState;\n+import net.runelite.client.plugins.timetracking.Tab;\n+import net.runelite.client.plugins.timetracking.TimeTrackingConfig;\n+import net.runelite.client.plugins.timetracking.TimeTrackingPlugin;\n+import net.runelite.client.ui.overlay.infobox.InfoBoxManager;\n+import net.runelite.client.util.Text;\n+\n+@Slf4j\n+public class FarmingContractManager\n+{\n+\tprivate static final int GUILDMASTER_JANE_WIDGET_MODEL_ID = NullNpcID.NULL_8628;", "originalCommit": "c56f93d3d8f49748206824a956646006267f62f2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQzMjAyMQ==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r422432021", "bodyText": "generally prefer having get + guards like these so the guard is attached to the get, as opposed to having a newline separating them:\n\t\t\tPatchPrediction prediction = farmingTracker.predictPatch(patch);\n\t\t\tif (prediction == null)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tProduce produce = prediction.getProduce();", "author": "abextm", "createdAt": "2020-05-09T00:40:48Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/farming/FarmingContractManager.java", "diffHunk": "@@ -0,0 +1,322 @@\n+/*\n+ * Copyright (c) 2019, Koekkruimels <https://github.com/koekkruimels>\n+ * Copyright (c) 2020, melky <https://github.com/melkypie>\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this\n+ *    list of conditions and the following disclaimer.\n+ * 2. Redistributions in binary form must reproduce the above copyright notice,\n+ *    this list of conditions and the following disclaimer in the documentation\n+ *    and/or other materials provided with the distribution.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+package net.runelite.client.plugins.timetracking.farming;\n+\n+import java.time.Instant;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import net.runelite.api.Client;\n+import net.runelite.api.NullNpcID;\n+import net.runelite.api.coords.WorldPoint;\n+import net.runelite.api.widgets.Widget;\n+import net.runelite.api.widgets.WidgetInfo;\n+import net.runelite.client.config.ConfigManager;\n+import net.runelite.client.game.ItemManager;\n+import net.runelite.client.plugins.timetracking.SummaryState;\n+import net.runelite.client.plugins.timetracking.Tab;\n+import net.runelite.client.plugins.timetracking.TimeTrackingConfig;\n+import net.runelite.client.plugins.timetracking.TimeTrackingPlugin;\n+import net.runelite.client.ui.overlay.infobox.InfoBoxManager;\n+import net.runelite.client.util.Text;\n+\n+@Slf4j\n+public class FarmingContractManager\n+{\n+\tprivate static final int GUILDMASTER_JANE_WIDGET_MODEL_ID = NullNpcID.NULL_8628;\n+\tprivate static final int FARMING_GUILD_REGION_ID = 4922;\n+\tprivate static final Pattern CONTRACT_ASSIGN_PATTERN = Pattern.compile(\"(?:We need you to grow|Please could you grow) (?:some|a|an) ([a-zA-Z ]+)(?: for us\\\\?|\\\\.)\");\n+\tprivate static final String CONTRACT_REWARDED = \"You'll be wanting a reward then. Here you go.\";\n+\tprivate static final String CONFIG_KEY_CONTRACT = \"contract\";\n+\n+\t@Getter\n+\tprivate SummaryState summary = SummaryState.UNKNOWN;\n+\n+\t@Inject\n+\tprivate Client client;\n+\n+\t@Inject\n+\tprivate ItemManager itemManager;\n+\n+\t@Inject\n+\tprivate TimeTrackingConfig config;\n+\n+\t@Inject\n+\tprivate TimeTrackingPlugin plugin;\n+\n+\t@Inject\n+\tprivate FarmingWorld farmingWorld;\n+\n+\t@Inject\n+\tprivate FarmingTracker farmingTracker;\n+\n+\t@Inject\n+\tprivate InfoBoxManager infoBoxManager;\n+\n+\t@Inject\n+\tprivate ConfigManager configManager;\n+\n+\t@Getter\n+\tprivate Produce contract = null;\n+\tprivate FarmingContractInfoBox infoBox;\n+\n+\t@Getter\n+\tprivate long completionTime;\n+\n+\tpublic void setContract(@Nullable Produce contract)\n+\t{\n+\t\tthis.contract = contract;\n+\t\tsetStoredContract(contract);\n+\t\thandleContractState();\n+\t}\n+\n+\tpublic boolean hasContract()\n+\t{\n+\t\treturn contract != null;\n+\t}\n+\n+\t@Nullable\n+\tpublic Tab getContractTab()\n+\t{\n+\t\treturn hasContract() ? contract.getPatchImplementation().getTab() : null;\n+\t}\n+\n+\t@Nullable\n+\tpublic String getContractName()\n+\t{\n+\t\treturn hasContract() ? contract.getContractName() : null;\n+\t}\n+\n+\tpublic boolean shouldHighlightFarmingTabPanel(@Nonnull FarmingPatch patch)\n+\t{\n+\t\tPatchPrediction patchPrediction = farmingTracker.predictPatch(patch);\n+\t\tif (contract != null &&\n+\t\t\tpatch.getRegion().getRegionID() == FARMING_GUILD_REGION_ID &&\n+\t\t\tcontract.getPatchImplementation() == patch.getImplementation() &&\n+\t\t\tpatchPrediction != null &&\n+\t\t\t(summary == SummaryState.EMPTY &&\n+\t\t\t\t(patchPrediction.getProduce() == null || patchPrediction.getProduce() == Produce.WEEDS)\n+\t\t\t\t|| patchPrediction.getProduce().equals(contract)))\n+\t\t{\n+\t\t\treturn true;\n+\t\t}\n+\t\treturn false;\n+\t}\n+\n+\tpublic void loadContractFromConfig()\n+\t{\n+\t\tcontract = getStoredContract();\n+\t\thandleContractState();\n+\t}\n+\n+\tpublic boolean updateData(WorldPoint loc)\n+\t{\n+\t\tSummaryState oldSummary = summary;\n+\n+\t\thandleContractState();\n+\t\tif (loc.getRegionID() == FARMING_GUILD_REGION_ID)\n+\t\t{\n+\t\t\thandleGuildmasterJaneWidgetDialog();\n+\t\t\thandleInfoBox();\n+\t\t}\n+\t\telse\n+\t\t{\n+\t\t\tif (infoBox != null)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = null;\n+\t\t\t}\n+\t\t}\n+\t\treturn oldSummary != summary;\n+\t}\n+\n+\tprivate void handleInfoBox()\n+\t{\n+\t\tif (infoBox != null)\n+\t\t{\n+\t\t\tif (contract == null)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = null;\n+\t\t\t}\n+\t\t\telse if (infoBox.getContract() != contract)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = new FarmingContractInfoBox(itemManager.getImage(contract.getItemID()), plugin, contract, config, this);\n+\t\t\t\tinfoBoxManager.addInfoBox(infoBox);\n+\t\t\t}\n+\t\t}\n+\t\telse if (contract != null)\n+\t\t{\n+\t\t\tinfoBox = new FarmingContractInfoBox(itemManager.getImage(contract.getItemID()), plugin, contract, config, this);\n+\t\t\tinfoBoxManager.addInfoBox(infoBox);\n+\t\t}\n+\t}\n+\n+\tprivate void handleGuildmasterJaneWidgetDialog()\n+\t{\n+\t\tWidget npcDialog = client.getWidget(WidgetInfo.DIALOG_NPC_HEAD_MODEL);\n+\n+\t\tif (npcDialog == null || npcDialog.getModelId() != GUILDMASTER_JANE_WIDGET_MODEL_ID)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tString dialogText = Text.removeTags(client.getWidget(WidgetInfo.DIALOG_NPC_TEXT).getText());\n+\n+\t\tif (dialogText.equals(CONTRACT_REWARDED))\n+\t\t{\n+\t\t\tsetContract(null);\n+\t\t}\n+\n+\t\tMatcher matcher = CONTRACT_ASSIGN_PATTERN.matcher(dialogText);\n+\n+\t\tif (!matcher.find())\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tString name = matcher.group(1);\n+\n+\t\tProduce farmingContract = Produce.getByContractName(name);\n+\n+\t\tif (farmingContract == null)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tProduce currentFarmingContract = contract;\n+\n+\t\tif (farmingContract == currentFarmingContract)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tsetContract(farmingContract);\n+\t}\n+\n+\tprivate void handleContractState()\n+\t{\n+\t\tif (contract == null)\n+\t\t{\n+\t\t\tsummary = SummaryState.UNKNOWN;\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tPatchImplementation patchImplementation = contract.getPatchImplementation();\n+\n+\t\tboolean hasEmptyPatch = false;\n+\t\tfor (FarmingPatch patch : farmingWorld.getFarmingGuildRegion().getPatches())\n+\t\t{\n+\t\t\tif (patch.getImplementation() != patchImplementation)\n+\t\t\t{\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tPatchPrediction prediction = farmingTracker.predictPatch(patch);", "originalCommit": "c56f93d3d8f49748206824a956646006267f62f2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQzMjU1Mg==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r422432552", "bodyText": "If you have 2 patches that match this crop, and the first one is growing, but the second one is done, this will say you have to wait, which seems wrong.", "author": "abextm", "createdAt": "2020-05-09T00:43:52Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/farming/FarmingContractManager.java", "diffHunk": "@@ -0,0 +1,322 @@\n+/*\n+ * Copyright (c) 2019, Koekkruimels <https://github.com/koekkruimels>\n+ * Copyright (c) 2020, melky <https://github.com/melkypie>\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this\n+ *    list of conditions and the following disclaimer.\n+ * 2. Redistributions in binary form must reproduce the above copyright notice,\n+ *    this list of conditions and the following disclaimer in the documentation\n+ *    and/or other materials provided with the distribution.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+package net.runelite.client.plugins.timetracking.farming;\n+\n+import java.time.Instant;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import net.runelite.api.Client;\n+import net.runelite.api.NullNpcID;\n+import net.runelite.api.coords.WorldPoint;\n+import net.runelite.api.widgets.Widget;\n+import net.runelite.api.widgets.WidgetInfo;\n+import net.runelite.client.config.ConfigManager;\n+import net.runelite.client.game.ItemManager;\n+import net.runelite.client.plugins.timetracking.SummaryState;\n+import net.runelite.client.plugins.timetracking.Tab;\n+import net.runelite.client.plugins.timetracking.TimeTrackingConfig;\n+import net.runelite.client.plugins.timetracking.TimeTrackingPlugin;\n+import net.runelite.client.ui.overlay.infobox.InfoBoxManager;\n+import net.runelite.client.util.Text;\n+\n+@Slf4j\n+public class FarmingContractManager\n+{\n+\tprivate static final int GUILDMASTER_JANE_WIDGET_MODEL_ID = NullNpcID.NULL_8628;\n+\tprivate static final int FARMING_GUILD_REGION_ID = 4922;\n+\tprivate static final Pattern CONTRACT_ASSIGN_PATTERN = Pattern.compile(\"(?:We need you to grow|Please could you grow) (?:some|a|an) ([a-zA-Z ]+)(?: for us\\\\?|\\\\.)\");\n+\tprivate static final String CONTRACT_REWARDED = \"You'll be wanting a reward then. Here you go.\";\n+\tprivate static final String CONFIG_KEY_CONTRACT = \"contract\";\n+\n+\t@Getter\n+\tprivate SummaryState summary = SummaryState.UNKNOWN;\n+\n+\t@Inject\n+\tprivate Client client;\n+\n+\t@Inject\n+\tprivate ItemManager itemManager;\n+\n+\t@Inject\n+\tprivate TimeTrackingConfig config;\n+\n+\t@Inject\n+\tprivate TimeTrackingPlugin plugin;\n+\n+\t@Inject\n+\tprivate FarmingWorld farmingWorld;\n+\n+\t@Inject\n+\tprivate FarmingTracker farmingTracker;\n+\n+\t@Inject\n+\tprivate InfoBoxManager infoBoxManager;\n+\n+\t@Inject\n+\tprivate ConfigManager configManager;\n+\n+\t@Getter\n+\tprivate Produce contract = null;\n+\tprivate FarmingContractInfoBox infoBox;\n+\n+\t@Getter\n+\tprivate long completionTime;\n+\n+\tpublic void setContract(@Nullable Produce contract)\n+\t{\n+\t\tthis.contract = contract;\n+\t\tsetStoredContract(contract);\n+\t\thandleContractState();\n+\t}\n+\n+\tpublic boolean hasContract()\n+\t{\n+\t\treturn contract != null;\n+\t}\n+\n+\t@Nullable\n+\tpublic Tab getContractTab()\n+\t{\n+\t\treturn hasContract() ? contract.getPatchImplementation().getTab() : null;\n+\t}\n+\n+\t@Nullable\n+\tpublic String getContractName()\n+\t{\n+\t\treturn hasContract() ? contract.getContractName() : null;\n+\t}\n+\n+\tpublic boolean shouldHighlightFarmingTabPanel(@Nonnull FarmingPatch patch)\n+\t{\n+\t\tPatchPrediction patchPrediction = farmingTracker.predictPatch(patch);\n+\t\tif (contract != null &&\n+\t\t\tpatch.getRegion().getRegionID() == FARMING_GUILD_REGION_ID &&\n+\t\t\tcontract.getPatchImplementation() == patch.getImplementation() &&\n+\t\t\tpatchPrediction != null &&\n+\t\t\t(summary == SummaryState.EMPTY &&\n+\t\t\t\t(patchPrediction.getProduce() == null || patchPrediction.getProduce() == Produce.WEEDS)\n+\t\t\t\t|| patchPrediction.getProduce().equals(contract)))\n+\t\t{\n+\t\t\treturn true;\n+\t\t}\n+\t\treturn false;\n+\t}\n+\n+\tpublic void loadContractFromConfig()\n+\t{\n+\t\tcontract = getStoredContract();\n+\t\thandleContractState();\n+\t}\n+\n+\tpublic boolean updateData(WorldPoint loc)\n+\t{\n+\t\tSummaryState oldSummary = summary;\n+\n+\t\thandleContractState();\n+\t\tif (loc.getRegionID() == FARMING_GUILD_REGION_ID)\n+\t\t{\n+\t\t\thandleGuildmasterJaneWidgetDialog();\n+\t\t\thandleInfoBox();\n+\t\t}\n+\t\telse\n+\t\t{\n+\t\t\tif (infoBox != null)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = null;\n+\t\t\t}\n+\t\t}\n+\t\treturn oldSummary != summary;\n+\t}\n+\n+\tprivate void handleInfoBox()\n+\t{\n+\t\tif (infoBox != null)\n+\t\t{\n+\t\t\tif (contract == null)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = null;\n+\t\t\t}\n+\t\t\telse if (infoBox.getContract() != contract)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = new FarmingContractInfoBox(itemManager.getImage(contract.getItemID()), plugin, contract, config, this);\n+\t\t\t\tinfoBoxManager.addInfoBox(infoBox);\n+\t\t\t}\n+\t\t}\n+\t\telse if (contract != null)\n+\t\t{\n+\t\t\tinfoBox = new FarmingContractInfoBox(itemManager.getImage(contract.getItemID()), plugin, contract, config, this);\n+\t\t\tinfoBoxManager.addInfoBox(infoBox);\n+\t\t}\n+\t}\n+\n+\tprivate void handleGuildmasterJaneWidgetDialog()\n+\t{\n+\t\tWidget npcDialog = client.getWidget(WidgetInfo.DIALOG_NPC_HEAD_MODEL);\n+\n+\t\tif (npcDialog == null || npcDialog.getModelId() != GUILDMASTER_JANE_WIDGET_MODEL_ID)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tString dialogText = Text.removeTags(client.getWidget(WidgetInfo.DIALOG_NPC_TEXT).getText());\n+\n+\t\tif (dialogText.equals(CONTRACT_REWARDED))\n+\t\t{\n+\t\t\tsetContract(null);\n+\t\t}\n+\n+\t\tMatcher matcher = CONTRACT_ASSIGN_PATTERN.matcher(dialogText);\n+\n+\t\tif (!matcher.find())\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tString name = matcher.group(1);\n+\n+\t\tProduce farmingContract = Produce.getByContractName(name);\n+\n+\t\tif (farmingContract == null)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tProduce currentFarmingContract = contract;\n+\n+\t\tif (farmingContract == currentFarmingContract)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tsetContract(farmingContract);\n+\t}\n+\n+\tprivate void handleContractState()\n+\t{\n+\t\tif (contract == null)\n+\t\t{\n+\t\t\tsummary = SummaryState.UNKNOWN;\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tPatchImplementation patchImplementation = contract.getPatchImplementation();\n+\n+\t\tboolean hasEmptyPatch = false;\n+\t\tfor (FarmingPatch patch : farmingWorld.getFarmingGuildRegion().getPatches())\n+\t\t{\n+\t\t\tif (patch.getImplementation() != patchImplementation)\n+\t\t\t{\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tPatchPrediction prediction = farmingTracker.predictPatch(patch);\n+\n+\t\t\tif (prediction == null)\n+\t\t\t{\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\t\t\tProduce produce = prediction.getProduce();\n+\n+\t\t\tif (produce == null || produce == Produce.WEEDS)\n+\t\t\t{\n+\t\t\t\tsummary = SummaryState.EMPTY;\n+\t\t\t\thasEmptyPatch = true;\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tif ((contract.requiresHealthCheck() && prediction.getCropState() == CropState.HARVESTABLE)\n+\t\t\t\t&& !hasEmptyPatch)\n+\t\t\t{\n+\t\t\t\tsummary = SummaryState.OCCUPIED;\n+\t\t\t}\n+\n+\t\t\tif (produce != contract)\n+\t\t\t{\n+\t\t\t\tif (!hasEmptyPatch)\n+\t\t\t\t{\n+\t\t\t\t\tsummary = SummaryState.OCCUPIED;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\telse\n+\t\t\t{\n+\t\t\t\tlong estimatedTime = prediction.getDoneEstimate();\n+\n+\t\t\t\tif (estimatedTime <= Instant.now().getEpochSecond())\n+\t\t\t\t{\n+\t\t\t\t\tsummary = SummaryState.COMPLETED;\n+\t\t\t\t\tcompletionTime = 0;\n+\t\t\t\t}\n+\t\t\t\telse\n+\t\t\t\t{\n+\t\t\t\t\tsummary = SummaryState.IN_PROGRESS;\n+\t\t\t\t\tcompletionTime = estimatedTime;\n+\t\t\t\t}\n+\t\t\t\tbreak;", "originalCommit": "c56f93d3d8f49748206824a956646006267f62f2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQ0NTczNw==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r422445737", "bodyText": "Tested this scenario (both ways) and some others after applying new fix.", "author": "melkypie", "createdAt": "2020-05-09T03:00:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQzMjU1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQzMjkzMQ==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r422432931", "bodyText": "remove this newline", "author": "abextm", "createdAt": "2020-05-09T00:46:36Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/timetracking/farming/FarmingContractManager.java", "diffHunk": "@@ -0,0 +1,322 @@\n+/*\n+ * Copyright (c) 2019, Koekkruimels <https://github.com/koekkruimels>\n+ * Copyright (c) 2020, melky <https://github.com/melkypie>\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this\n+ *    list of conditions and the following disclaimer.\n+ * 2. Redistributions in binary form must reproduce the above copyright notice,\n+ *    this list of conditions and the following disclaimer in the documentation\n+ *    and/or other materials provided with the distribution.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+package net.runelite.client.plugins.timetracking.farming;\n+\n+import java.time.Instant;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.inject.Inject;\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import net.runelite.api.Client;\n+import net.runelite.api.NullNpcID;\n+import net.runelite.api.coords.WorldPoint;\n+import net.runelite.api.widgets.Widget;\n+import net.runelite.api.widgets.WidgetInfo;\n+import net.runelite.client.config.ConfigManager;\n+import net.runelite.client.game.ItemManager;\n+import net.runelite.client.plugins.timetracking.SummaryState;\n+import net.runelite.client.plugins.timetracking.Tab;\n+import net.runelite.client.plugins.timetracking.TimeTrackingConfig;\n+import net.runelite.client.plugins.timetracking.TimeTrackingPlugin;\n+import net.runelite.client.ui.overlay.infobox.InfoBoxManager;\n+import net.runelite.client.util.Text;\n+\n+@Slf4j\n+public class FarmingContractManager\n+{\n+\tprivate static final int GUILDMASTER_JANE_WIDGET_MODEL_ID = NullNpcID.NULL_8628;\n+\tprivate static final int FARMING_GUILD_REGION_ID = 4922;\n+\tprivate static final Pattern CONTRACT_ASSIGN_PATTERN = Pattern.compile(\"(?:We need you to grow|Please could you grow) (?:some|a|an) ([a-zA-Z ]+)(?: for us\\\\?|\\\\.)\");\n+\tprivate static final String CONTRACT_REWARDED = \"You'll be wanting a reward then. Here you go.\";\n+\tprivate static final String CONFIG_KEY_CONTRACT = \"contract\";\n+\n+\t@Getter\n+\tprivate SummaryState summary = SummaryState.UNKNOWN;\n+\n+\t@Inject\n+\tprivate Client client;\n+\n+\t@Inject\n+\tprivate ItemManager itemManager;\n+\n+\t@Inject\n+\tprivate TimeTrackingConfig config;\n+\n+\t@Inject\n+\tprivate TimeTrackingPlugin plugin;\n+\n+\t@Inject\n+\tprivate FarmingWorld farmingWorld;\n+\n+\t@Inject\n+\tprivate FarmingTracker farmingTracker;\n+\n+\t@Inject\n+\tprivate InfoBoxManager infoBoxManager;\n+\n+\t@Inject\n+\tprivate ConfigManager configManager;\n+\n+\t@Getter\n+\tprivate Produce contract = null;\n+\tprivate FarmingContractInfoBox infoBox;\n+\n+\t@Getter\n+\tprivate long completionTime;\n+\n+\tpublic void setContract(@Nullable Produce contract)\n+\t{\n+\t\tthis.contract = contract;\n+\t\tsetStoredContract(contract);\n+\t\thandleContractState();\n+\t}\n+\n+\tpublic boolean hasContract()\n+\t{\n+\t\treturn contract != null;\n+\t}\n+\n+\t@Nullable\n+\tpublic Tab getContractTab()\n+\t{\n+\t\treturn hasContract() ? contract.getPatchImplementation().getTab() : null;\n+\t}\n+\n+\t@Nullable\n+\tpublic String getContractName()\n+\t{\n+\t\treturn hasContract() ? contract.getContractName() : null;\n+\t}\n+\n+\tpublic boolean shouldHighlightFarmingTabPanel(@Nonnull FarmingPatch patch)\n+\t{\n+\t\tPatchPrediction patchPrediction = farmingTracker.predictPatch(patch);\n+\t\tif (contract != null &&\n+\t\t\tpatch.getRegion().getRegionID() == FARMING_GUILD_REGION_ID &&\n+\t\t\tcontract.getPatchImplementation() == patch.getImplementation() &&\n+\t\t\tpatchPrediction != null &&\n+\t\t\t(summary == SummaryState.EMPTY &&\n+\t\t\t\t(patchPrediction.getProduce() == null || patchPrediction.getProduce() == Produce.WEEDS)\n+\t\t\t\t|| patchPrediction.getProduce().equals(contract)))\n+\t\t{\n+\t\t\treturn true;\n+\t\t}\n+\t\treturn false;\n+\t}\n+\n+\tpublic void loadContractFromConfig()\n+\t{\n+\t\tcontract = getStoredContract();\n+\t\thandleContractState();\n+\t}\n+\n+\tpublic boolean updateData(WorldPoint loc)\n+\t{\n+\t\tSummaryState oldSummary = summary;\n+\n+\t\thandleContractState();\n+\t\tif (loc.getRegionID() == FARMING_GUILD_REGION_ID)\n+\t\t{\n+\t\t\thandleGuildmasterJaneWidgetDialog();\n+\t\t\thandleInfoBox();\n+\t\t}\n+\t\telse\n+\t\t{\n+\t\t\tif (infoBox != null)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = null;\n+\t\t\t}\n+\t\t}\n+\t\treturn oldSummary != summary;\n+\t}\n+\n+\tprivate void handleInfoBox()\n+\t{\n+\t\tif (infoBox != null)\n+\t\t{\n+\t\t\tif (contract == null)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = null;\n+\t\t\t}\n+\t\t\telse if (infoBox.getContract() != contract)\n+\t\t\t{\n+\t\t\t\tinfoBoxManager.removeInfoBox(infoBox);\n+\t\t\t\tinfoBox = new FarmingContractInfoBox(itemManager.getImage(contract.getItemID()), plugin, contract, config, this);\n+\t\t\t\tinfoBoxManager.addInfoBox(infoBox);\n+\t\t\t}\n+\t\t}\n+\t\telse if (contract != null)\n+\t\t{\n+\t\t\tinfoBox = new FarmingContractInfoBox(itemManager.getImage(contract.getItemID()), plugin, contract, config, this);\n+\t\t\tinfoBoxManager.addInfoBox(infoBox);\n+\t\t}\n+\t}\n+\n+\tprivate void handleGuildmasterJaneWidgetDialog()\n+\t{\n+\t\tWidget npcDialog = client.getWidget(WidgetInfo.DIALOG_NPC_HEAD_MODEL);\n+\n+\t\tif (npcDialog == null || npcDialog.getModelId() != GUILDMASTER_JANE_WIDGET_MODEL_ID)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tString dialogText = Text.removeTags(client.getWidget(WidgetInfo.DIALOG_NPC_TEXT).getText());\n+\n+\t\tif (dialogText.equals(CONTRACT_REWARDED))\n+\t\t{\n+\t\t\tsetContract(null);\n+\t\t}\n+\n+\t\tMatcher matcher = CONTRACT_ASSIGN_PATTERN.matcher(dialogText);\n+\n+\t\tif (!matcher.find())\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tString name = matcher.group(1);\n+\n+\t\tProduce farmingContract = Produce.getByContractName(name);\n+\n+\t\tif (farmingContract == null)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tProduce currentFarmingContract = contract;\n+\n+\t\tif (farmingContract == currentFarmingContract)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tsetContract(farmingContract);\n+\t}\n+\n+\tprivate void handleContractState()\n+\t{\n+\t\tif (contract == null)\n+\t\t{\n+\t\t\tsummary = SummaryState.UNKNOWN;\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tPatchImplementation patchImplementation = contract.getPatchImplementation();\n+\n+\t\tboolean hasEmptyPatch = false;\n+\t\tfor (FarmingPatch patch : farmingWorld.getFarmingGuildRegion().getPatches())\n+\t\t{\n+\t\t\tif (patch.getImplementation() != patchImplementation)\n+\t\t\t{\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tPatchPrediction prediction = farmingTracker.predictPatch(patch);\n+\n+\t\t\tif (prediction == null)\n+\t\t\t{\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\t\t\tProduce produce = prediction.getProduce();\n+\n+\t\t\tif (produce == null || produce == Produce.WEEDS)\n+\t\t\t{\n+\t\t\t\tsummary = SummaryState.EMPTY;\n+\t\t\t\thasEmptyPatch = true;\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tif ((contract.requiresHealthCheck() && prediction.getCropState() == CropState.HARVESTABLE)\n+\t\t\t\t&& !hasEmptyPatch)\n+\t\t\t{\n+\t\t\t\tsummary = SummaryState.OCCUPIED;\n+\t\t\t}\n+\n+\t\t\tif (produce != contract)\n+\t\t\t{\n+\t\t\t\tif (!hasEmptyPatch)\n+\t\t\t\t{\n+\t\t\t\t\tsummary = SummaryState.OCCUPIED;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\telse\n+\t\t\t{\n+\t\t\t\tlong estimatedTime = prediction.getDoneEstimate();\n+\n+\t\t\t\tif (estimatedTime <= Instant.now().getEpochSecond())\n+\t\t\t\t{\n+\t\t\t\t\tsummary = SummaryState.COMPLETED;\n+\t\t\t\t\tcompletionTime = 0;\n+\t\t\t\t}\n+\t\t\t\telse\n+\t\t\t\t{\n+\t\t\t\t\tsummary = SummaryState.IN_PROGRESS;\n+\t\t\t\t\tcompletionTime = estimatedTime;\n+\t\t\t\t}\n+\t\t\t\tbreak;\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\n+\t@Nullable\n+\tprivate Produce getStoredContract()\n+\t{\n+\t\ttry\n+\t\t{\n+\t\t\treturn Produce.getByItemID(Integer.parseInt(configManager.getConfiguration(getConfigGroup(), CONFIG_KEY_CONTRACT)));\n+\t\t}\n+\t\tcatch (NumberFormatException ignored)\n+\t\t{\n+\t\t\treturn null;\n+\t\t}\n+\t}\n+\n+\tprivate void setStoredContract(@Nullable Produce contract)\n+\t{\n+", "originalCommit": "c56f93d3d8f49748206824a956646006267f62f2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3b8870a1b668161683cce3fb42303a0f73e071c8", "url": "https://github.com/runelite/runelite/commit/3b8870a1b668161683cce3fb42303a0f73e071c8", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-05-09T01:46:28Z", "type": "forcePushed"}, {"oid": "9f0a470e4a80bded078191386c0b71d49e8a9cb5", "url": "https://github.com/runelite/runelite/commit/9f0a470e4a80bded078191386c0b71d49e8a9cb5", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-05-09T02:51:37Z", "type": "forcePushed"}, {"oid": "25bcf21c9b435f9ac961f173bb5b381f75db2079", "url": "https://github.com/runelite/runelite/commit/25bcf21c9b435f9ac961f173bb5b381f75db2079", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-05-09T19:15:17Z", "type": "forcePushed"}, {"oid": "b59f7e3c105fb9b23c3c5ebd47bf1afe3efea2c6", "url": "https://github.com/runelite/runelite/commit/b59f7e3c105fb9b23c3c5ebd47bf1afe3efea2c6", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-05-21T20:46:11Z", "type": "forcePushed"}, {"oid": "e72485a752dce7beb4552402a29fed7d9abb78e8", "url": "https://github.com/runelite/runelite/commit/e72485a752dce7beb4552402a29fed7d9abb78e8", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-05-24T16:54:22Z", "type": "forcePushed"}, {"oid": "a6b308ba00d10ac8c38dd15df9df4f05d2937145", "url": "https://github.com/runelite/runelite/commit/a6b308ba00d10ac8c38dd15df9df4f05d2937145", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-05-26T17:34:16Z", "type": "forcePushed"}, {"oid": "a13b23201806be24b774318899aec3205f99b339", "url": "https://github.com/runelite/runelite/commit/a13b23201806be24b774318899aec3205f99b339", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-05-27T21:29:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk4ODE2Mg==", "url": "https://github.com/runelite/runelite/pull/11495#discussion_r436988162", "bodyText": "For some reason the other classes don't do this, but you can have try-with-resources with multiple resources fyi.", "author": "Adam-", "createdAt": "2020-06-08T20:41:41Z", "path": "cache/src/main/java/net/runelite/cache/NpcManager.java", "diffHunk": "@@ -97,14 +97,19 @@ public void java(File java) throws IOException\n \t\tjava.mkdirs();\n \t\ttry (IDClass ids = IDClass.create(java, \"NpcID\"))\n \t\t{\n-\t\t\tfor (NpcDefinition def : npcs.values())\n+\t\t\ttry (IDClass nulls = IDClass.create(java, \"NullNpcID\"))", "originalCommit": "803310d5aa88746db8c1615254597c4c7dc36e9c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "dd573f37fb16a9a393a437cdd3d7a153c489a6d9", "url": "https://github.com/runelite/runelite/commit/dd573f37fb16a9a393a437cdd3d7a153c489a6d9", "message": "runelite-api: add NullNpcID", "committedDate": "2020-06-08T21:16:33Z", "type": "commit"}, {"oid": "14e405056c8cbc96d434a8d52dac669e4321a091", "url": "https://github.com/runelite/runelite/commit/14e405056c8cbc96d434a8d52dac669e4321a091", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-06-08T21:16:33Z", "type": "forcePushed"}, {"oid": "080bba5bb7e3f30e41a0ff3bf4d5801060c5451a", "url": "https://github.com/runelite/runelite/commit/080bba5bb7e3f30e41a0ff3bf4d5801060c5451a", "message": "cache: emit null npc ids", "committedDate": "2020-06-08T21:21:05Z", "type": "commit"}, {"oid": "0f448af1c4a2a2fe9486cd21a4ce4887f2a3fdc5", "url": "https://github.com/runelite/runelite/commit/0f448af1c4a2a2fe9486cd21a4ce4887f2a3fdc5", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-06-08T21:21:09Z", "type": "commit"}, {"oid": "0f448af1c4a2a2fe9486cd21a4ce4887f2a3fdc5", "url": "https://github.com/runelite/runelite/commit/0f448af1c4a2a2fe9486cd21a4ce4887f2a3fdc5", "message": "timetracking: add farming contract functionality\n\nCo-authored-by: Koekkruimels <lifeinvader-dev@outlook.com>", "committedDate": "2020-06-08T21:21:09Z", "type": "forcePushed"}]}