{"pr_number": 12032, "pr_title": "Adding config option to persist tags through restart", "pr_createdAt": "2020-06-29T15:18:16Z", "pr_url": "https://github.com/runelite/runelite/pull/12032", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkxMjY1Mg==", "url": "https://github.com/runelite/runelite/pull/12032#discussion_r447912652", "bodyText": "Are there any situations where we would want to add a Tag/Untag option to npcs which don't exist or have no name? I don't think so. Maybe just return;", "author": "Adam-", "createdAt": "2020-06-30T18:59:56Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/npchighlight/NpcIndicatorsPlugin.java", "diffHunk": "@@ -270,16 +267,50 @@ public void onMenuEntryAdded(MenuEntryAdded event)\n \t\t}\n \t\telse if (menuAction == MenuAction.EXAMINE_NPC && client.isKeyPressed(KeyCode.KC_SHIFT))\n \t\t{\n-\t\t\t// Add tag option\n+\t\t\t// Add tag and tag-all options\n+\t\t\tfinal int id = event.getIdentifier();\n+\t\t\tfinal NPC[] cachedNPCs = client.getCachedNPCs();\n+\t\t\tfinal NPC npcCached = cachedNPCs[id];\n+\t\t\tboolean npcFound = true;\n+\t\t\tboolean matchesList = false;\n+\n+\t\t\tif (npcCached == null || npcCached.getName() == null)\n+\t\t\t{\n+\t\t\t\tnpcFound = false;", "originalCommit": "a6045c672d40b6ab304e4f87449822dff40d8ad2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkyNjEyNQ==", "url": "https://github.com/runelite/runelite/pull/12032#discussion_r447926125", "bodyText": "Even if this fails the normal \"Tag\" option can still be displayed since it's based on the event information. Only reason I did this", "author": "zeffirojoe", "createdAt": "2020-06-30T19:24:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkxMjY1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkyNzA5OQ==", "url": "https://github.com/runelite/runelite/pull/12032#discussion_r447927099", "bodyText": "Right, but I don't think that makes sense? I think it either can't happen, or if it did happen isn't something we would want to try and handle anyway.", "author": "Adam-", "createdAt": "2020-06-30T19:26:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkxMjY1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkxMzQxMw==", "url": "https://github.com/runelite/runelite/pull/12032#discussion_r447913413", "bodyText": "Declare final String npcName = npc.getName().toLowerCase(); once and then reference it and below.", "author": "Adam-", "createdAt": "2020-06-30T19:01:07Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/npchighlight/NpcIndicatorsPlugin.java", "diffHunk": "@@ -270,16 +267,50 @@ public void onMenuEntryAdded(MenuEntryAdded event)\n \t\t}\n \t\telse if (menuAction == MenuAction.EXAMINE_NPC && client.isKeyPressed(KeyCode.KC_SHIFT))\n \t\t{\n-\t\t\t// Add tag option\n+\t\t\t// Add tag and tag-all options\n+\t\t\tfinal int id = event.getIdentifier();\n+\t\t\tfinal NPC[] cachedNPCs = client.getCachedNPCs();\n+\t\t\tfinal NPC npcCached = cachedNPCs[id];\n+\t\t\tboolean npcFound = true;\n+\t\t\tboolean matchesList = false;\n+\n+\t\t\tif (npcCached == null || npcCached.getName() == null)\n+\t\t\t{\n+\t\t\t\tnpcFound = false;\n+\t\t\t}\n+\t\t\telse\n+\t\t\t{\n+\t\t\t\tmatchesList = highlights.stream()\n+\t\t\t\t\t.filter(highlight -> !highlight.equals(npcCached.getName().toLowerCase()))", "originalCommit": "a6045c672d40b6ab304e4f87449822dff40d8ad2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkxNDI5Ng==", "url": "https://github.com/runelite/runelite/pull/12032#discussion_r447914296", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\ttagAllEntry.setOption((Arrays.stream(config.getNpcToHighlight().split(\",\")).anyMatch(npc -> npc.toLowerCase().equals(npcCached.getName().toLowerCase())) ? UNTAG_ALL : TAG_ALL));\n          \n          \n            \n            \t\t\t\ttagAllEntry.setOption(highlights.contains(npcName) ? UNTAG_ALL : TAG_ALL));", "author": "Adam-", "createdAt": "2020-06-30T19:02:35Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/npchighlight/NpcIndicatorsPlugin.java", "diffHunk": "@@ -270,16 +267,50 @@ public void onMenuEntryAdded(MenuEntryAdded event)\n \t\t}\n \t\telse if (menuAction == MenuAction.EXAMINE_NPC && client.isKeyPressed(KeyCode.KC_SHIFT))\n \t\t{\n-\t\t\t// Add tag option\n+\t\t\t// Add tag and tag-all options\n+\t\t\tfinal int id = event.getIdentifier();\n+\t\t\tfinal NPC[] cachedNPCs = client.getCachedNPCs();\n+\t\t\tfinal NPC npcCached = cachedNPCs[id];\n+\t\t\tboolean npcFound = true;\n+\t\t\tboolean matchesList = false;\n+\n+\t\t\tif (npcCached == null || npcCached.getName() == null)\n+\t\t\t{\n+\t\t\t\tnpcFound = false;\n+\t\t\t}\n+\t\t\telse\n+\t\t\t{\n+\t\t\t\tmatchesList = highlights.stream()\n+\t\t\t\t\t.filter(highlight -> !highlight.equals(npcCached.getName().toLowerCase()))\n+\t\t\t\t\t.anyMatch(highlight -> WildcardMatcher.matches(highlight, npcCached.getName().toLowerCase()));\n+\t\t\t}\n+\n \t\t\tMenuEntry[] menuEntries = client.getMenuEntries();\n-\t\t\tmenuEntries = Arrays.copyOf(menuEntries, menuEntries.length + 1);\n+\n+\t\t\tif (npcFound && !matchesList)\n+\t\t\t{\n+\t\t\t\tmenuEntries = Arrays.copyOf(menuEntries, menuEntries.length + 2);\n+\t\t\t\tfinal MenuEntry tagAllEntry = menuEntries[menuEntries.length - 2] = new MenuEntry();\n+\t\t\t\ttagAllEntry.setOption((Arrays.stream(config.getNpcToHighlight().split(\",\")).anyMatch(npc -> npc.toLowerCase().equals(npcCached.getName().toLowerCase())) ? UNTAG_ALL : TAG_ALL));", "originalCommit": "a6045c672d40b6ab304e4f87449822dff40d8ad2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkxNDQ2NQ==", "url": "https://github.com/runelite/runelite/pull/12032#discussion_r447914465", "bodyText": "This just becomes highlighedNpcs.contains(npc)", "author": "Adam-", "createdAt": "2020-06-30T19:02:54Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/npchighlight/NpcIndicatorsPlugin.java", "diffHunk": "@@ -270,16 +267,50 @@ public void onMenuEntryAdded(MenuEntryAdded event)\n \t\t}\n \t\telse if (menuAction == MenuAction.EXAMINE_NPC && client.isKeyPressed(KeyCode.KC_SHIFT))\n \t\t{\n-\t\t\t// Add tag option\n+\t\t\t// Add tag and tag-all options\n+\t\t\tfinal int id = event.getIdentifier();\n+\t\t\tfinal NPC[] cachedNPCs = client.getCachedNPCs();\n+\t\t\tfinal NPC npcCached = cachedNPCs[id];\n+\t\t\tboolean npcFound = true;\n+\t\t\tboolean matchesList = false;\n+\n+\t\t\tif (npcCached == null || npcCached.getName() == null)\n+\t\t\t{\n+\t\t\t\tnpcFound = false;\n+\t\t\t}\n+\t\t\telse\n+\t\t\t{\n+\t\t\t\tmatchesList = highlights.stream()\n+\t\t\t\t\t.filter(highlight -> !highlight.equals(npcCached.getName().toLowerCase()))\n+\t\t\t\t\t.anyMatch(highlight -> WildcardMatcher.matches(highlight, npcCached.getName().toLowerCase()));\n+\t\t\t}\n+\n \t\t\tMenuEntry[] menuEntries = client.getMenuEntries();\n-\t\t\tmenuEntries = Arrays.copyOf(menuEntries, menuEntries.length + 1);\n+\n+\t\t\tif (npcFound && !matchesList)\n+\t\t\t{\n+\t\t\t\tmenuEntries = Arrays.copyOf(menuEntries, menuEntries.length + 2);\n+\t\t\t\tfinal MenuEntry tagAllEntry = menuEntries[menuEntries.length - 2] = new MenuEntry();\n+\t\t\t\ttagAllEntry.setOption((Arrays.stream(config.getNpcToHighlight().split(\",\")).anyMatch(npc -> npc.toLowerCase().equals(npcCached.getName().toLowerCase())) ? UNTAG_ALL : TAG_ALL));\n+\t\t\t\ttagAllEntry.setTarget(event.getTarget());\n+\t\t\t\ttagAllEntry.setParam0(event.getActionParam0());\n+\t\t\t\ttagAllEntry.setParam1(event.getActionParam1());\n+\t\t\t\ttagAllEntry.setIdentifier(event.getIdentifier());\n+\t\t\t\ttagAllEntry.setType(MenuAction.RUNELITE.getId());\n+\t\t\t}\n+\t\t\telse\n+\t\t\t{\n+\t\t\t\tmenuEntries = Arrays.copyOf(menuEntries, menuEntries.length + 1);\n+\t\t\t}\n+\n \t\t\tfinal MenuEntry tagEntry = menuEntries[menuEntries.length - 1] = new MenuEntry();\n-\t\t\ttagEntry.setOption(highlightedNpcs.stream().anyMatch(npc -> npc.getIndex() == event.getIdentifier()) ? UNTAG : TAG);\n+\t\t\ttagEntry.setOption((highlightedNpcs.stream().anyMatch(npc -> npc.getIndex() == event.getIdentifier()) ? UNTAG : TAG));", "originalCommit": "a6045c672d40b6ab304e4f87449822dff40d8ad2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkxNDc5NQ==", "url": "https://github.com/runelite/runelite/pull/12032#discussion_r447914795", "bodyText": "These 3 lines + the conditionals below are duplicated in both branches, so move them to be above.", "author": "Adam-", "createdAt": "2020-06-30T19:03:27Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/npchighlight/NpcIndicatorsPlugin.java", "diffHunk": "@@ -288,37 +319,69 @@ else if (menuAction == MenuAction.EXAMINE_NPC && client.isKeyPressed(KeyCode.KC_\n \tpublic void onMenuOptionClicked(MenuOptionClicked click)\n \t{\n \t\tif (click.getMenuAction() != MenuAction.RUNELITE ||\n-\t\t\t!(click.getMenuOption().equals(TAG) || click.getMenuOption().equals(UNTAG)))\n+\t\t\t(!(click.getMenuOption().equals(TAG) || click.getMenuOption().equals(UNTAG)) &&\n+\t\t\t(!(click.getMenuOption().equals(TAG_ALL) || click.getMenuOption().equals(UNTAG_ALL)))))\n \t\t{\n \t\t\treturn;\n \t\t}\n \n-\t\tfinal int id = click.getId();\n-\t\tfinal boolean removed = npcTags.remove(id);\n-\t\tfinal NPC[] cachedNPCs = client.getCachedNPCs();\n-\t\tfinal NPC npc = cachedNPCs[id];\n-\n-\t\tif (npc == null || npc.getName() == null)\n+\t\tif (click.getMenuOption().equals(TAG) || click.getMenuOption().equals(UNTAG))\n \t\t{\n-\t\t\treturn;\n-\t\t}\n+\t\t\tfinal int id = click.getId();\n+\t\t\tfinal boolean removed = npcTags.remove(id);\n+\t\t\tfinal NPC[] cachedNPCs = client.getCachedNPCs();\n+\t\t\tfinal NPC npc = cachedNPCs[id];\n \n-\t\tif (removed)\n-\t\t{\n-\t\t\thighlightedNpcs.remove(npc);\n-\t\t\tmemorizedNpcs.remove(npc.getIndex());\n+\t\t\tif (npc == null || npc.getName() == null)\n+\t\t\t{\n+\t\t\t\treturn;\n+\t\t\t}\n+\n+\t\t\tif (removed)\n+\t\t\t{\n+\t\t\t\thighlightedNpcs.remove(npc);\n+\t\t\t\tmemorizedNpcs.remove(npc.getIndex());\n+\t\t\t}\n+\t\t\telse\n+\t\t\t{\n+\t\t\t\tif (!client.isInInstancedRegion())\n+\t\t\t\t{\n+\t\t\t\t\tmemorizeNpc(npc);\n+\t\t\t\t\tnpcTags.add(id);\n+\t\t\t\t}\n+\t\t\t\thighlightedNpcs.add(npc);\n+\t\t\t}\n+\n+\t\t\tclick.consume();\n \t\t}\n \t\telse\n \t\t{\n-\t\t\tif (!client.isInInstancedRegion())\n+\t\t\tfinal String npcNames = config.getNpcToHighlight().toLowerCase();\n+\t\t\tList<String> highlightNames = new ArrayList<>();\n+\n+\t\t\tif (!npcNames.trim().isEmpty())\n \t\t\t{\n-\t\t\t\tmemorizeNpc(npc);\n-\t\t\t\tnpcTags.add(id);\n+\t\t\t\thighlightNames = new ArrayList<>(Arrays.asList(npcNames.split(\",\")));\n \t\t\t}\n-\t\t\thighlightedNpcs.add(npc);\n-\t\t}\n \n-\t\tclick.consume();\n+\t\t\tfinal int id = click.getId();", "originalCommit": "a6045c672d40b6ab304e4f87449822dff40d8ad2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkxNTExMg==", "url": "https://github.com/runelite/runelite/pull/12032#discussion_r447915112", "bodyText": "This is force tolowering the user's config option which it should not be doing.", "author": "Adam-", "createdAt": "2020-06-30T19:04:05Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/npchighlight/NpcIndicatorsPlugin.java", "diffHunk": "@@ -288,37 +319,69 @@ else if (menuAction == MenuAction.EXAMINE_NPC && client.isKeyPressed(KeyCode.KC_\n \tpublic void onMenuOptionClicked(MenuOptionClicked click)\n \t{\n \t\tif (click.getMenuAction() != MenuAction.RUNELITE ||\n-\t\t\t!(click.getMenuOption().equals(TAG) || click.getMenuOption().equals(UNTAG)))\n+\t\t\t(!(click.getMenuOption().equals(TAG) || click.getMenuOption().equals(UNTAG)) &&\n+\t\t\t(!(click.getMenuOption().equals(TAG_ALL) || click.getMenuOption().equals(UNTAG_ALL)))))\n \t\t{\n \t\t\treturn;\n \t\t}\n \n-\t\tfinal int id = click.getId();\n-\t\tfinal boolean removed = npcTags.remove(id);\n-\t\tfinal NPC[] cachedNPCs = client.getCachedNPCs();\n-\t\tfinal NPC npc = cachedNPCs[id];\n-\n-\t\tif (npc == null || npc.getName() == null)\n+\t\tif (click.getMenuOption().equals(TAG) || click.getMenuOption().equals(UNTAG))\n \t\t{\n-\t\t\treturn;\n-\t\t}\n+\t\t\tfinal int id = click.getId();\n+\t\t\tfinal boolean removed = npcTags.remove(id);\n+\t\t\tfinal NPC[] cachedNPCs = client.getCachedNPCs();\n+\t\t\tfinal NPC npc = cachedNPCs[id];\n \n-\t\tif (removed)\n-\t\t{\n-\t\t\thighlightedNpcs.remove(npc);\n-\t\t\tmemorizedNpcs.remove(npc.getIndex());\n+\t\t\tif (npc == null || npc.getName() == null)\n+\t\t\t{\n+\t\t\t\treturn;\n+\t\t\t}\n+\n+\t\t\tif (removed)\n+\t\t\t{\n+\t\t\t\thighlightedNpcs.remove(npc);\n+\t\t\t\tmemorizedNpcs.remove(npc.getIndex());\n+\t\t\t}\n+\t\t\telse\n+\t\t\t{\n+\t\t\t\tif (!client.isInInstancedRegion())\n+\t\t\t\t{\n+\t\t\t\t\tmemorizeNpc(npc);\n+\t\t\t\t\tnpcTags.add(id);\n+\t\t\t\t}\n+\t\t\t\thighlightedNpcs.add(npc);\n+\t\t\t}\n+\n+\t\t\tclick.consume();\n \t\t}\n \t\telse\n \t\t{\n-\t\t\tif (!client.isInInstancedRegion())\n+\t\t\tfinal String npcNames = config.getNpcToHighlight().toLowerCase();\n+\t\t\tList<String> highlightNames = new ArrayList<>();\n+\n+\t\t\tif (!npcNames.trim().isEmpty())\n \t\t\t{\n-\t\t\t\tmemorizeNpc(npc);\n-\t\t\t\tnpcTags.add(id);\n+\t\t\t\thighlightNames = new ArrayList<>(Arrays.asList(npcNames.split(\",\")));\n \t\t\t}\n-\t\t\thighlightedNpcs.add(npc);\n-\t\t}\n \n-\t\tclick.consume();\n+\t\t\tfinal int id = click.getId();\n+\t\t\tfinal NPC[] cachedNPCs = client.getCachedNPCs();\n+\t\t\tfinal NPC npc = cachedNPCs[id];\n+\n+\t\t\tif (npc == null || npc.getName() == null)\n+\t\t\t{\n+\t\t\t\treturn;\n+\t\t\t}\n+\n+\t\t\tfinal String name = npc.getName().toLowerCase();\n+\t\t\tfinal boolean removed = highlightNames.remove(name);\n+\n+\t\t\tif (!removed)\n+\t\t\t{\n+\t\t\t\thighlightNames.add(name);\n+\t\t\t}\n+\t\t\tconfig.setNpcToHighlight(String.join(\",\", highlightNames));", "originalCommit": "a6045c672d40b6ab304e4f87449822dff40d8ad2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkzMDA2Mw==", "url": "https://github.com/runelite/runelite/pull/12032#discussion_r447930063", "bodyText": "How would you suggest doing this then? Just directly adding to or removing from the \"highlights\" List?", "author": "zeffirojoe", "createdAt": "2020-06-30T19:32:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkxNTExMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkzMTU5Nw==", "url": "https://github.com/runelite/runelite/pull/12032#discussion_r447931597", "bodyText": "I recommend looking at updateList in the ground items plugin", "author": "Adam-", "createdAt": "2020-06-30T19:35:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkxNTExMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1OTAyNQ==", "url": "https://github.com/runelite/runelite/pull/12032#discussion_r447959025", "bodyText": "This lowercase isn't necessary and just causes it to be added to the user's list in lowercase.", "author": "Adam-", "createdAt": "2020-06-30T20:27:54Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/npchighlight/NpcIndicatorsPlugin.java", "diffHunk": "@@ -303,22 +331,33 @@ public void onMenuOptionClicked(MenuOptionClicked click)\n \t\t\treturn;\n \t\t}\n \n-\t\tif (removed)\n+\t\tif (click.getMenuOption().equals(TAG) || click.getMenuOption().equals(UNTAG))\n \t\t{\n-\t\t\thighlightedNpcs.remove(npc);\n-\t\t\tmemorizedNpcs.remove(npc.getIndex());\n-\t\t}\n-\t\telse\n-\t\t{\n-\t\t\tif (!client.isInInstancedRegion())\n+\t\t\tfinal boolean removed = npcTags.remove(id);\n+\n+\t\t\tif (removed)\n \t\t\t{\n-\t\t\t\tmemorizeNpc(npc);\n-\t\t\t\tnpcTags.add(id);\n+\t\t\t\thighlightedNpcs.remove(npc);\n+\t\t\t\tmemorizedNpcs.remove(npc.getIndex());\n \t\t\t}\n-\t\t\thighlightedNpcs.add(npc);\n+\t\t\telse\n+\t\t\t{\n+\t\t\t\tif (!client.isInInstancedRegion())\n+\t\t\t\t{\n+\t\t\t\t\tmemorizeNpc(npc);\n+\t\t\t\t\tnpcTags.add(id);\n+\t\t\t\t}\n+\t\t\t\thighlightedNpcs.add(npc);\n+\t\t\t}\n+\n+\t\t\tclick.consume();\n \t\t}\n+\t\telse\n+\t\t{\n+\t\t\tfinal String name = npc.getName().toLowerCase();", "originalCommit": "96164fa4f213f5919789c7fd4fefa9d0300413b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1OTIxNA==", "url": "https://github.com/runelite/runelite/pull/12032#discussion_r447959214", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\ttagEntry.setOption((highlightedNpcs.contains(npcCached) ? UNTAG : TAG));\n          \n          \n            \n            \t\t\ttagEntry.setOption(highlightedNpcs.contains(npcCached) ? UNTAG : TAG);", "author": "Adam-", "createdAt": "2020-06-30T20:28:16Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/npchighlight/NpcIndicatorsPlugin.java", "diffHunk": "@@ -270,16 +267,47 @@ public void onMenuEntryAdded(MenuEntryAdded event)\n \t\t}\n \t\telse if (menuAction == MenuAction.EXAMINE_NPC && client.isKeyPressed(KeyCode.KC_SHIFT))\n \t\t{\n-\t\t\t// Add tag option\n+\t\t\t// Add tag and tag-all options\n+\t\t\tfinal int id = event.getIdentifier();\n+\t\t\tfinal NPC[] cachedNPCs = client.getCachedNPCs();\n+\t\t\tfinal NPC npcCached = cachedNPCs[id];\n+\n+\t\t\tif (npcCached == null || npcCached.getName() == null)\n+\t\t\t{\n+\t\t\t\treturn;\n+\t\t\t}\n+\n+\t\t\tfinal String npcName = npcCached.getName().toLowerCase();\n+\t\t\tboolean\tmatchesList = highlights.stream()\n+\t\t\t\t\t.filter(highlight -> !highlight.equals(npcName))\n+\t\t\t\t\t.anyMatch(highlight -> WildcardMatcher.matches(highlight, npcName));\n+\n \t\t\tMenuEntry[] menuEntries = client.getMenuEntries();\n-\t\t\tmenuEntries = Arrays.copyOf(menuEntries, menuEntries.length + 1);\n+\n+\t\t\tif (!matchesList)\n+\t\t\t{\n+\t\t\t\tmenuEntries = Arrays.copyOf(menuEntries, menuEntries.length + 2);\n+\t\t\t\tfinal MenuEntry tagAllEntry = menuEntries[menuEntries.length - 2] = new MenuEntry();\n+\t\t\t\ttagAllEntry.setOption(highlights.contains(npcName) ? UNTAG_ALL : TAG_ALL);\n+\t\t\t\ttagAllEntry.setTarget(event.getTarget());\n+\t\t\t\ttagAllEntry.setParam0(event.getActionParam0());\n+\t\t\t\ttagAllEntry.setParam1(event.getActionParam1());\n+\t\t\t\ttagAllEntry.setIdentifier(event.getIdentifier());\n+\t\t\t\ttagAllEntry.setType(MenuAction.RUNELITE.getId());\n+\t\t\t}\n+\t\t\telse\n+\t\t\t{\n+\t\t\t\tmenuEntries = Arrays.copyOf(menuEntries, menuEntries.length + 1);\n+\t\t\t}\n+\n \t\t\tfinal MenuEntry tagEntry = menuEntries[menuEntries.length - 1] = new MenuEntry();\n-\t\t\ttagEntry.setOption(highlightedNpcs.stream().anyMatch(npc -> npc.getIndex() == event.getIdentifier()) ? UNTAG : TAG);\n+\t\t\ttagEntry.setOption((highlightedNpcs.contains(npcCached) ? UNTAG : TAG));", "originalCommit": "96164fa4f213f5919789c7fd4fefa9d0300413b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk2MTQzNg==", "url": "https://github.com/runelite/runelite/pull/12032#discussion_r447961436", "bodyText": "This should include a comment explaining what it is trying to do, eg\n// Only add Untag options to npcs not highlighted by a wildcard entry, because untag-all will not remove wildcards", "author": "Adam-", "createdAt": "2020-06-30T20:32:32Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/npchighlight/NpcIndicatorsPlugin.java", "diffHunk": "@@ -270,16 +267,47 @@ public void onMenuEntryAdded(MenuEntryAdded event)\n \t\t}\n \t\telse if (menuAction == MenuAction.EXAMINE_NPC && client.isKeyPressed(KeyCode.KC_SHIFT))\n \t\t{\n-\t\t\t// Add tag option\n+\t\t\t// Add tag and tag-all options\n+\t\t\tfinal int id = event.getIdentifier();\n+\t\t\tfinal NPC[] cachedNPCs = client.getCachedNPCs();\n+\t\t\tfinal NPC npcCached = cachedNPCs[id];\n+\n+\t\t\tif (npcCached == null || npcCached.getName() == null)\n+\t\t\t{\n+\t\t\t\treturn;\n+\t\t\t}\n+\n+\t\t\tfinal String npcName = npcCached.getName().toLowerCase();\n+\t\t\tboolean\tmatchesList = highlights.stream()", "originalCommit": "96164fa4f213f5919789c7fd4fefa9d0300413b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk2MTU4NQ==", "url": "https://github.com/runelite/runelite/pull/12032#discussion_r447961585", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\tfinal NPC npcCached = cachedNPCs[id];\n          \n          \n            \n            \t\t\tfinal NPC npc = cachedNPCs[id];\n          \n      \n    \n    \n  \n\nThe \"cached\" name the API uses is basically mis-named currently.", "author": "Adam-", "createdAt": "2020-06-30T20:32:52Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/npchighlight/NpcIndicatorsPlugin.java", "diffHunk": "@@ -270,16 +267,47 @@ public void onMenuEntryAdded(MenuEntryAdded event)\n \t\t}\n \t\telse if (menuAction == MenuAction.EXAMINE_NPC && client.isKeyPressed(KeyCode.KC_SHIFT))\n \t\t{\n-\t\t\t// Add tag option\n+\t\t\t// Add tag and tag-all options\n+\t\t\tfinal int id = event.getIdentifier();\n+\t\t\tfinal NPC[] cachedNPCs = client.getCachedNPCs();\n+\t\t\tfinal NPC npcCached = cachedNPCs[id];", "originalCommit": "96164fa4f213f5919789c7fd4fefa9d0300413b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk2MjI5NA==", "url": "https://github.com/runelite/runelite/pull/12032#discussion_r447962294", "bodyText": "This works due to this triggering the config change event to rebuild npcs right? Would add\n// this triggers the config change event and rebuilds npcs", "author": "Adam-", "createdAt": "2020-06-30T20:34:13Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/npchighlight/NpcIndicatorsPlugin.java", "diffHunk": "@@ -388,6 +427,18 @@ public void onGameTick(GameTick event)\n \t\tlastPlayerLocation = client.getLocalPlayer().getWorldLocation();\n \t}\n \n+\tvoid updateList(String item)\n+\t{\n+\t\tfinal List<String> highlightedNpcs = new ArrayList<>(highlights);\n+\n+\t\tif (!highlightedNpcs.removeIf(item::equalsIgnoreCase))\n+\t\t{\n+\t\t\thighlightedNpcs.add(item);\n+\t\t}\n+\n+\t\tconfig.setNpcToHighlight(Text.toCSV(highlightedNpcs));", "originalCommit": "96164fa4f213f5919789c7fd4fefa9d0300413b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk2MzMzMQ==", "url": "https://github.com/runelite/runelite/pull/12032#discussion_r447963331", "bodyText": "This reduces to:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t(!(click.getMenuOption().equals(TAG) || click.getMenuOption().equals(UNTAG)) &&\n          \n          \n            \n            \t\t\t!(click.getMenuOption().equals(TAG) || click.getMenuOption().equals(UNTAG) || click.getMenuOption().equals(TAG_ALL) || click.getMenuOption().equals(UNTAG_ALL))", "author": "Adam-", "createdAt": "2020-06-30T20:36:25Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/npchighlight/NpcIndicatorsPlugin.java", "diffHunk": "@@ -288,13 +316,13 @@ else if (menuAction == MenuAction.EXAMINE_NPC && client.isKeyPressed(KeyCode.KC_\n \tpublic void onMenuOptionClicked(MenuOptionClicked click)\n \t{\n \t\tif (click.getMenuAction() != MenuAction.RUNELITE ||\n-\t\t\t!(click.getMenuOption().equals(TAG) || click.getMenuOption().equals(UNTAG)))\n+\t\t\t(!(click.getMenuOption().equals(TAG) || click.getMenuOption().equals(UNTAG)) &&", "originalCommit": "96164fa4f213f5919789c7fd4fefa9d0300413b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk2NDI3Nw==", "url": "https://github.com/runelite/runelite/pull/12032#discussion_r447964277", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tvoid updateList(String item)\n          \n          \n            \n            \tprivate void updateNpcsToHighlight(String npc)", "author": "Adam-", "createdAt": "2020-06-30T20:38:28Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/npchighlight/NpcIndicatorsPlugin.java", "diffHunk": "@@ -388,6 +427,18 @@ public void onGameTick(GameTick event)\n \t\tlastPlayerLocation = client.getLocalPlayer().getWorldLocation();\n \t}\n \n+\tvoid updateList(String item)", "originalCommit": "96164fa4f213f5919789c7fd4fefa9d0300413b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk2NDY5NQ==", "url": "https://github.com/runelite/runelite/pull/12032#discussion_r447964695", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tvoid setNpcToHighlight(String key);\n          \n          \n            \n            \tvoid setNpcToHighlight(String npcsToHighlight);", "author": "Adam-", "createdAt": "2020-06-30T20:39:18Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/npchighlight/NpcIndicatorsConfig.java", "diffHunk": "@@ -87,6 +87,13 @@ default String getNpcToHighlight()\n \t\treturn \"\";\n \t}\n \n+\t@ConfigItem(\n+\t\tkeyName = \"npcToHighlight\",\n+\t\tname = \"\",\n+\t\tdescription = \"\"\n+\t)\n+\tvoid setNpcToHighlight(String key);", "originalCommit": "96164fa4f213f5919789c7fd4fefa9d0300413b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e3eae815b69ce6b8ed34d380857c258cad2b2423", "url": "https://github.com/runelite/runelite/commit/e3eae815b69ce6b8ed34d380857c258cad2b2423", "message": "npc indicators: add (un)tag-all option\n\nThis modifies the tagged npc list allowing all npcs of a certain name to\nbe tagged\n\nCo-authored-by: Adam <Adam@sigterm.info>", "committedDate": "2020-07-01T14:23:15Z", "type": "forcePushed"}, {"oid": "80afe21d0e7bad6f62fede1cc29dd8e1d76c792d", "url": "https://github.com/runelite/runelite/commit/80afe21d0e7bad6f62fede1cc29dd8e1d76c792d", "message": "npc indicators: add (un)tag-all option\n\nThis modifies the tagged npc list allowing all npcs of a certain name to\nbe tagged\n\nCo-authored-by: Adam <Adam@sigterm.info>", "committedDate": "2020-07-01T14:47:46Z", "type": "commit"}, {"oid": "80afe21d0e7bad6f62fede1cc29dd8e1d76c792d", "url": "https://github.com/runelite/runelite/commit/80afe21d0e7bad6f62fede1cc29dd8e1d76c792d", "message": "npc indicators: add (un)tag-all option\n\nThis modifies the tagged npc list allowing all npcs of a certain name to\nbe tagged\n\nCo-authored-by: Adam <Adam@sigterm.info>", "committedDate": "2020-07-01T14:47:46Z", "type": "forcePushed"}]}