{"pr_number": 12975, "pr_title": "grounditems: add despawn timer for items placed on tables", "pr_createdAt": "2020-12-25T06:08:56Z", "pr_url": "https://github.com/runelite/runelite/pull/12975", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzgzNjEzNw==", "url": "https://github.com/runelite/runelite/pull/12975#discussion_r557836137", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t// We can only accurately guess despawn times for our own pvm loot, dropped items\n          \n          \n            \n            \t\t// or for items placed on tables\n          \n          \n            \n            \t\t// We can only accurately guess despawn times for our own pvm loot, dropped items,\n          \n          \n            \n            \t\t// and items we placed on tables", "author": "Nightfirecat", "createdAt": "2021-01-15T03:13:07Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/grounditems/GroundItemsOverlay.java", "diffHunk": "@@ -394,8 +395,10 @@ else if (groundItemTimers == DespawnTimerMode.SECONDS || groundItemTimers == Des\n \n \tprivate Instant calculateDespawnTime(GroundItem groundItem)\n \t{\n-\t\t// We can only accurately guess despawn times for our own pvm loot and dropped items\n-\t\tif (groundItem.getLootType() != LootType.PVM && groundItem.getLootType() != LootType.DROPPED)\n+\t\t// We can only accurately guess despawn times for our own pvm loot, dropped items\n+\t\t// or for items placed on tables", "originalCommit": "6ed288256a70e79fb85751fa204baf2fa47d4d4a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzgzNjI0MA==", "url": "https://github.com/runelite/runelite/pull/12975#discussion_r557836240", "bodyText": "Let's make this one type per line now that we're breaking to another line to begin with.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tif (groundItem.getLootType() != LootType.PVM && groundItem.getLootType() != LootType.DROPPED\n          \n          \n            \n            \t\t\t&& groundItem.getLootType() != LootType.TABLE)\n          \n          \n            \n            \t\tif (groundItem.getLootType() != LootType.PVM\n          \n          \n            \n            \t\t\t&& groundItem.getLootType() != LootType.DROPPED\n          \n          \n            \n            \t\t\t&& groundItem.getLootType() != LootType.TABLE)", "author": "Nightfirecat", "createdAt": "2021-01-15T03:13:38Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/grounditems/GroundItemsOverlay.java", "diffHunk": "@@ -394,8 +395,10 @@ else if (groundItemTimers == DespawnTimerMode.SECONDS || groundItemTimers == Des\n \n \tprivate Instant calculateDespawnTime(GroundItem groundItem)\n \t{\n-\t\t// We can only accurately guess despawn times for our own pvm loot and dropped items\n-\t\tif (groundItem.getLootType() != LootType.PVM && groundItem.getLootType() != LootType.DROPPED)\n+\t\t// We can only accurately guess despawn times for our own pvm loot, dropped items\n+\t\t// or for items placed on tables\n+\t\tif (groundItem.getLootType() != LootType.PVM && groundItem.getLootType() != LootType.DROPPED\n+\t\t\t&& groundItem.getLootType() != LootType.TABLE)", "originalCommit": "6ed288256a70e79fb85751fa204baf2fa47d4d4a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzgzNjUyMA==", "url": "https://github.com/runelite/runelite/pull/12975#discussion_r557836520", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t// We can only accurately guess despawn times for our own pvm loot, dropped items\n          \n          \n            \n            \t\t// or for items placed on tables\n          \n          \n            \n            \t\t// We can only accurately guess despawn times for our own pvm loot, dropped items,\n          \n          \n            \n            \t\t// and items we placed on tables", "author": "Nightfirecat", "createdAt": "2021-01-15T03:14:45Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/grounditems/GroundItemsOverlay.java", "diffHunk": "@@ -475,8 +482,10 @@ else if (isInKBDorNMZ())\n \n \tprivate Color getItemTimerColor(GroundItem groundItem)\n \t{\n-\t\t// We can only accurately guess despawn times for our own pvm loot and dropped items\n-\t\tif (groundItem.getLootType() != LootType.PVM && groundItem.getLootType() != LootType.DROPPED)\n+\t\t// We can only accurately guess despawn times for our own pvm loot, dropped items\n+\t\t// or for items placed on tables", "originalCommit": "6ed288256a70e79fb85751fa204baf2fa47d4d4a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzgzNjU3NA==", "url": "https://github.com/runelite/runelite/pull/12975#discussion_r557836574", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tif (groundItem.getLootType() != LootType.PVM && groundItem.getLootType() != LootType.DROPPED\n          \n          \n            \n            \t\t\t&& groundItem.getLootType() != LootType.TABLE)\n          \n          \n            \n            \t\tif (groundItem.getLootType() != LootType.PVM\n          \n          \n            \n            \t\t\t&& groundItem.getLootType() != LootType.DROPPED\n          \n          \n            \n            \t\t\t&& groundItem.getLootType() != LootType.TABLE)", "author": "Nightfirecat", "createdAt": "2021-01-15T03:15:01Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/grounditems/GroundItemsOverlay.java", "diffHunk": "@@ -475,8 +482,10 @@ else if (isInKBDorNMZ())\n \n \tprivate Color getItemTimerColor(GroundItem groundItem)\n \t{\n-\t\t// We can only accurately guess despawn times for our own pvm loot and dropped items\n-\t\tif (groundItem.getLootType() != LootType.PVM && groundItem.getLootType() != LootType.DROPPED)\n+\t\t// We can only accurately guess despawn times for our own pvm loot, dropped items\n+\t\t// or for items placed on tables\n+\t\tif (groundItem.getLootType() != LootType.PVM && groundItem.getLootType() != LootType.DROPPED\n+\t\t\t&& groundItem.getLootType() != LootType.TABLE)", "originalCommit": "6ed288256a70e79fb85751fa204baf2fa47d4d4a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzgzNjgxNQ==", "url": "https://github.com/runelite/runelite/pull/12975#discussion_r557836815", "bodyText": "The menu action will only ever be one or the other, let's not do both checks every time\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tif (menuOptionClicked.getMenuAction() == MenuAction.ITEM_USE_ON_GAME_OBJECT)\n          \n          \n            \n            \t\telse if (menuOptionClicked.getMenuAction() == MenuAction.ITEM_USE_ON_GAME_OBJECT)", "author": "Nightfirecat", "createdAt": "2021-01-15T03:15:58Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/grounditems/GroundItemsPlugin.java", "diffHunk": "@@ -687,5 +695,11 @@ public void onMenuOptionClicked(MenuOptionClicked menuOptionClicked)\n \t\t\t// item spawns that are drops\n \t\t\tdroppedItemQueue.add(itemId);\n \t\t}\n+\t\t// Keep queue of items placed on table\n+\t\tif (menuOptionClicked.getMenuAction() == MenuAction.ITEM_USE_ON_GAME_OBJECT)", "originalCommit": "6ed288256a70e79fb85751fa204baf2fa47d4d4a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzgzNzYyOA==", "url": "https://github.com/runelite/runelite/pull/12975#discussion_r557837628", "bodyText": "This seems wrong. If two items spawn on the same tick, this doesn't make any attempt to check the item ID, tile height, or location to ensure it is the item we placed on a table.", "author": "Nightfirecat", "createdAt": "2021-01-15T03:18:51Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/grounditems/GroundItemsPlugin.java", "diffHunk": "@@ -384,6 +385,7 @@ private GroundItem buildGroundItem(final Tile tile, final TileItem item)\n \t\tfinal int realItemId = itemComposition.getNote() != -1 ? itemComposition.getLinkedNoteId() : itemId;\n \t\tfinal int alchPrice = itemComposition.getHaPrice();\n \t\tfinal boolean dropped = tile.getWorldLocation().equals(client.getLocalPlayer().getWorldLocation()) && droppedItemQueue.remove(itemId);\n+\t\tfinal boolean onTable = tableItemQueue.isEmpty();", "originalCommit": "6ed288256a70e79fb85751fa204baf2fa47d4d4a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI1NTEzNg==", "url": "https://github.com/runelite/runelite/pull/12975#discussion_r559255136", "bodyText": "I think checking for itemID should be enough.", "author": "akhtar-u", "createdAt": "2021-01-17T23:25:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzgzNzYyOA=="}], "type": "inlineReview"}, {"oid": "a3234834396f7299fce5eaadf72f626c94c7db69", "url": "https://github.com/runelite/runelite/commit/a3234834396f7299fce5eaadf72f626c94c7db69", "message": "change boolean to check itemID", "committedDate": "2021-01-17T23:24:00Z", "type": "forcePushed"}, {"oid": "2bfe07daa838e7def590ea6990b605e74b74b3ea", "url": "https://github.com/runelite/runelite/commit/2bfe07daa838e7def590ea6990b605e74b74b3ea", "message": "add despawn timer for items placed on tables", "committedDate": "2021-01-17T23:31:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDU4MjkwMw==", "url": "https://github.com/runelite/runelite/pull/12975#discussion_r560582903", "bodyText": "This should be initialized to -1 on plugin startup, as DWARF_REMAINS is a valid item at ID 0.", "author": "Nightfirecat", "createdAt": "2021-01-20T00:03:00Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/grounditems/GroundItemsPlugin.java", "diffHunk": "@@ -180,6 +180,10 @@\n \tprivate LoadingCache<NamedQuantity, Boolean> highlightedItems;\n \tprivate LoadingCache<NamedQuantity, Boolean> hiddenItems;\n \tprivate final Queue<Integer> droppedItemQueue = EvictingQueue.create(16); // recently dropped items\n+\tprivate final Queue<Integer> tableItemQueue = EvictingQueue.create(16); // recently placed items\n+\n+\t// item being used on table\n+\tprivate int itemUsedID;", "originalCommit": "2bfe07daa838e7def590ea6990b605e74b74b3ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDU4MzAyMw==", "url": "https://github.com/runelite/runelite/pull/12975#discussion_r560583023", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\telse if (menuOptionClicked.getMenuAction() == MenuAction.ITEM_USE_ON_GAME_OBJECT)\n          \n          \n            \n            \t\telse if (itemUsedID != -1 && menuOptionClicked.getMenuAction() == MenuAction.ITEM_USE_ON_GAME_OBJECT)", "author": "Nightfirecat", "createdAt": "2021-01-20T00:03:26Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/grounditems/GroundItemsPlugin.java", "diffHunk": "@@ -687,5 +697,14 @@ public void onMenuOptionClicked(MenuOptionClicked menuOptionClicked)\n \t\t\t// item spawns that are drops\n \t\t\tdroppedItemQueue.add(itemId);\n \t\t}\n+\t\t// Keep queue of items placed on table\n+\t\telse if (menuOptionClicked.getMenuAction() == MenuAction.ITEM_USE)\n+\t\t{\n+\t\t\titemUsedID = menuOptionClicked.getId();\n+\t\t}\n+\t\telse if (menuOptionClicked.getMenuAction() == MenuAction.ITEM_USE_ON_GAME_OBJECT)", "originalCommit": "2bfe07daa838e7def590ea6990b605e74b74b3ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6bc6b59c22ab40b5cf858669981b57c09d82c2ec", "url": "https://github.com/runelite/runelite/commit/6bc6b59c22ab40b5cf858669981b57c09d82c2ec", "message": "initialize itemUsedID to -1", "committedDate": "2021-01-21T20:56:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzQxMDU0Nw==", "url": "https://github.com/runelite/runelite/pull/12975#discussion_r563410547", "bodyText": "I guess you are just copying the dropped item queue logic here; but the dropped item queue exists because you can drop multiple items on each tick, and it needs to be able to track each of them. However you cannot place multiple items on a table on the same tick since it is an object interaction, and so I think this is unnecessary.", "author": "Adam-", "createdAt": "2021-01-25T00:35:54Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/grounditems/GroundItemsPlugin.java", "diffHunk": "@@ -180,6 +180,10 @@\n \tprivate LoadingCache<NamedQuantity, Boolean> highlightedItems;\n \tprivate LoadingCache<NamedQuantity, Boolean> hiddenItems;\n \tprivate final Queue<Integer> droppedItemQueue = EvictingQueue.create(16); // recently dropped items\n+\tprivate final Queue<Integer> tableItemQueue = EvictingQueue.create(16); // recently placed items", "originalCommit": "a8ba7f42ad14b8ed48cecc07653c53d46901bd0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzQxMDkzOA==", "url": "https://github.com/runelite/runelite/pull/12975#discussion_r563410938", "bodyText": "I am fairly certain that tile.getItemLayer().getHeight() > 0 is true iif the item is on a table, so maybe that can just be used instead.", "author": "Adam-", "createdAt": "2021-01-25T00:38:19Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/grounditems/GroundItemsPlugin.java", "diffHunk": "@@ -384,6 +389,7 @@ private GroundItem buildGroundItem(final Tile tile, final TileItem item)\n \t\tfinal int realItemId = itemComposition.getNote() != -1 ? itemComposition.getLinkedNoteId() : itemId;\n \t\tfinal int alchPrice = itemComposition.getHaPrice();\n \t\tfinal boolean dropped = tile.getWorldLocation().equals(client.getLocalPlayer().getWorldLocation()) && droppedItemQueue.remove(itemId);\n+\t\tfinal boolean onTable = tableItemQueue.remove(itemId);", "originalCommit": "a8ba7f42ad14b8ed48cecc07653c53d46901bd0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "571ecffcec0b67ff904af0a3edc63c42ec686a4f", "url": "https://github.com/runelite/runelite/commit/571ecffcec0b67ff904af0a3edc63c42ec686a4f", "message": "remove queue and use itemlayer height", "committedDate": "2021-01-26T03:34:45Z", "type": "forcePushed"}, {"oid": "2b8550c776dd53ce33927652738e348defb20254", "url": "https://github.com/runelite/runelite/commit/2b8550c776dd53ce33927652738e348defb20254", "message": "grounditems: Add despawn timer for items placed on tables", "committedDate": "2021-02-03T04:19:11Z", "type": "forcePushed"}, {"oid": "e90b8293de3e37dc3c99578ce2d7438001492b1c", "url": "https://github.com/runelite/runelite/commit/e90b8293de3e37dc3c99578ce2d7438001492b1c", "message": "grounditems: Add despawn timer for items placed on tables", "committedDate": "2021-02-03T22:45:42Z", "type": "commit"}, {"oid": "e90b8293de3e37dc3c99578ce2d7438001492b1c", "url": "https://github.com/runelite/runelite/commit/e90b8293de3e37dc3c99578ce2d7438001492b1c", "message": "grounditems: Add despawn timer for items placed on tables", "committedDate": "2021-02-03T22:45:42Z", "type": "forcePushed"}]}