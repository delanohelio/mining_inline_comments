{"pr_number": 260, "pr_title": "Add integration tests into Jenkins pipeline", "pr_createdAt": "2020-03-31T11:43:44Z", "pr_url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/260", "timeline": [{"oid": "52795e92c67fe9ebdafdb79d497436a29404960b", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/52795e92c67fe9ebdafdb79d497436a29404960b", "message": "Add integration tests into Jenkins pipeline\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>", "committedDate": "2020-03-31T11:45:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDg1MjcwMw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/260#discussion_r400852703", "bodyText": "is it possible to have it also for chrome? or this is only first portion, and chrome will follow.", "author": "tomcec", "createdAt": "2020-03-31T11:55:29Z", "path": "Jenkinsfile", "diffHunk": "@@ -111,6 +145,29 @@ pipeline {\n                 }\n             }\n         }\n+        stage('Integration test') {\n+            steps {\n+                script {\n+                    if (isTimeTriggeredBuild() && (branchName == 'development' || env.CHANGE_ID)) {\n+                        container('theia') {\n+                            dir('tests') {\n+                                sh './theiaPrepare.sh'\n+                            }\n+                        }\n+                        container('python') {\n+                            dir('tests/theia_automation_lsp') {\n+                                sh 'pip install -r requirements.txt'\n+                                sh 'apt update'\n+                                sh 'apt install firefox-esr -y'\n+                                sh 'PYTHONPATH=`pwd` robot -i Rally -e Unstable --variable HEADLESS:True --outputdir robot_output robot_suites/lsp/local/firefox_lsp_local.robot'", "originalCommit": "52795e92c67fe9ebdafdb79d497436a29404960b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDg1NzAyNw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/260#discussion_r400857027", "bodyText": "The tests are the same. As I understand, there is no need to test on both browsers.\nI also faced issues trying to run tests on chrome and choose firefox because it is a more straightforward solution.\nI'm not plan to add chrome support in this request. But it could be done by a separate change, if needed.", "author": "grianbrcom", "createdAt": "2020-03-31T12:03:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDg1MjcwMw=="}], "type": "inlineReview"}, {"oid": "d18103b4cfcb59c748919b8c6d94073e9e685e5b", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/d18103b4cfcb59c748919b8c6d94073e9e685e5b", "message": "ci: Add integration tests to CI/CD\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>", "committedDate": "2020-04-22T11:49:02Z", "type": "commit"}, {"oid": "d18103b4cfcb59c748919b8c6d94073e9e685e5b", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/d18103b4cfcb59c748919b8c6d94073e9e685e5b", "message": "ci: Add integration tests to CI/CD\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>", "committedDate": "2020-04-22T11:49:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg0MzM3OQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/260#discussion_r413843379", "bodyText": "Since you are touching the kubernetes pod label, be aware that maximum length is 63 characters. Constructing such long label has potential to break that limit - the pod would not be created/started", "author": "filipkroupa", "createdAt": "2020-04-23T14:27:31Z", "path": "Jenkinsfile", "diffHunk": "@@ -37,17 +37,59 @@ spec:\n       name: known-hosts\n \"\"\"\n \n+def kubernetes_test_config = \"\"\"\n+apiVersion: v1\n+kind: Pod\n+spec:\n+  containers:\n+  - name: theia\n+    image: grianbrcom/theia4cobol:1.0.1\n+    tty: true\n+    command: [ \"/bin/bash\", \"-c\", \"--\" ]\n+    args: [ \"while true; do sleep 1000; done;\" ]\n+    resources:\n+      limits:\n+        memory: \"2Gi\"\n+        cpu: \"1\"\n+      requests:\n+        memory: \"2Gi\"\n+        cpu: \"1\"\n+  - name: python\n+    image: grianbrcom/python-firefox:1.0.1\n+    tty: true\n+    resources:\n+      limits:\n+        memory: \"2Gi\"\n+        cpu: \"1\"\n+      requests:\n+        memory: \"2Gi\"\n+        cpu: \"1\"\n+  - name: jnlp\n+    volumeMounts:\n+    - name: volume-known-hosts\n+      mountPath: /home/jenkins/.ssh\n+  volumes:\n+  - name: volume-known-hosts\n+    configMap:\n+      name: known-hosts\n+\"\"\"\n+\n def projectName = 'lsp-for-cobol'\n-def targetFiles = 'lsp-core-cobol-parser/target/**'\n-def kubeLabel = projectName + '_pod_' + env.BUILD_NUMBER + '_' + env.BRANCH_NAME\n-kubeLabel = kubeLabel.replaceAll(/[^a-zA-Z0-9._-]+/,\"\")\n+def kubeLabelPrefix = \"${projectName}_pod_${env.BUILD_NUMBER}_${env.BRANCH_NAME}\".replaceAll(/[^a-zA-Z0-9._-]+/,\"\")\n+def kubeBuildLabel = \"${kubeLabelPrefix}_build\"\n+def kubeTestLabel = \"${kubeBuildLabel}_test\"", "originalCommit": "d18103b4cfcb59c748919b8c6d94073e9e685e5b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY3MzkzOA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/260#discussion_r414673938", "bodyText": "You are right. So, this means for a three-digit build number we should have a branch name length less or equal then 35 characters. The current limit is 41. I could make a short suffix or use the same label for pods.", "author": "grianbrcom", "createdAt": "2020-04-24T15:41:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg0MzM3OQ=="}], "type": "inlineReview"}, {"oid": "944c56d036fe68082ffd0096e52aad8c760c975b", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/944c56d036fe68082ffd0096e52aad8c760c975b", "message": "Merge branch 'development' into integrationTests", "committedDate": "2020-04-28T10:35:24Z", "type": "commit"}, {"oid": "e99780221f6eb99bd8ce07aace21681902ab966c", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/e99780221f6eb99bd8ce07aace21681902ab966c", "message": "Schedule nightly build conditionally\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>", "committedDate": "2020-04-28T15:28:08Z", "type": "commit"}, {"oid": "442c0dd7ed498bfb21341fce03a2545874b1eb9b", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/442c0dd7ed498bfb21341fce03a2545874b1eb9b", "message": "fix branch name variable\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>", "committedDate": "2020-04-28T15:56:45Z", "type": "commit"}, {"oid": "0849cf92f746a20ac0019eeda09fa2ce9fc2d557", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/0849cf92f746a20ac0019eeda09fa2ce9fc2d557", "message": "Ignore failed tests\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>", "committedDate": "2020-05-04T09:29:11Z", "type": "commit"}]}