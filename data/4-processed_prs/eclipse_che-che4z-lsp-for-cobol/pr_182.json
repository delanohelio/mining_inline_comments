{"pr_number": 182, "pr_title": "Zowe copybook tracker #208", "pr_createdAt": "2020-02-04T12:08:12Z", "pr_url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182", "timeline": [{"oid": "61e9f7c1f760bd89f14c34a69d176687cf69dfff", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/61e9f7c1f760bd89f14c34a69d176687cf69dfff", "message": "Base for copybook tracker. WIP", "committedDate": "2020-01-14T10:02:06Z", "type": "commit"}, {"oid": "c5aeb1caf212fab74fed0e1e32777abaa300becb", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/c5aeb1caf212fab74fed0e1e32777abaa300becb", "message": "Introduce default paths setting. WIP.", "committedDate": "2020-01-14T10:02:06Z", "type": "commit"}, {"oid": "5cdd9fea72b4e9fe95c1a6fa5f2fc7ff2596f962", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/5cdd9fea72b4e9fe95c1a6fa5f2fc7ff2596f962", "message": "zOSMF profile listing implementation. WIP.", "committedDate": "2020-01-14T10:02:06Z", "type": "commit"}, {"oid": "4af9d5eba454480c4ee5ed1ec13c23a76c0be60f", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/4af9d5eba454480c4ee5ed1ec13c23a76c0be60f", "message": "Implement member list. WIP.", "committedDate": "2020-01-14T10:02:06Z", "type": "commit"}, {"oid": "0998507f591aa6e448e82aaf6cc3c82229369b0f", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/0998507f591aa6e448e82aaf6cc3c82229369b0f", "message": "Fetch content of members. WIP.", "committedDate": "2020-01-14T10:02:06Z", "type": "commit"}, {"oid": "a1a73b7d983a46c66bbc2d58d6bc64ba6fe3825e", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/a1a73b7d983a46c66bbc2d58d6bc64ba6fe3825e", "message": "Add copyrights", "committedDate": "2020-01-14T10:02:06Z", "type": "commit"}, {"oid": "0357e0aa84000384be74cce655630473d9f59748", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/0357e0aa84000384be74cce655630473d9f59748", "message": "Add progress indication. WIP.", "committedDate": "2020-01-14T10:02:06Z", "type": "commit"}, {"oid": "d802acd65086298a9e54317abe2872aa50973e6c", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/d802acd65086298a9e54317abe2872aa50973e6c", "message": "Use zowe imperative for profiles and zOSMF access.", "committedDate": "2020-01-15T11:34:15Z", "type": "commit"}, {"oid": "c52fbf4912daaa8a46e0c5bc9a296e7aa59bdeec", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/c52fbf4912daaa8a46e0c5bc9a296e7aa59bdeec", "message": "Support .err files added", "committedDate": "2020-01-15T13:11:54Z", "type": "commit"}, {"oid": "21c24e967f91507e485434079d984bdd19273de8", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/21c24e967f91507e485434079d984bdd19273de8", "message": "Remove TODOs", "committedDate": "2020-01-15T13:14:17Z", "type": "commit"}, {"oid": "80f195f94fbc29019f30feb0fe822a99991c805a", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/80f195f94fbc29019f30feb0fe822a99991c805a", "message": "change extension to .dep", "committedDate": "2020-01-15T14:58:59Z", "type": "commit"}, {"oid": "021a9828616f367e541654c441402a3ec339ca1e", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/021a9828616f367e541654c441402a3ec339ca1e", "message": "Introduce new event RUN_ANALYSIS covered by unit test", "committedDate": "2020-01-16T07:59:32Z", "type": "commit"}, {"oid": "feb936585b6af83496e276bd3f7d63b7a7743826", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/feb936585b6af83496e276bd3f7d63b7a7743826", "message": "Generation dummy cobdeps folder with dep file for e2e test purpose", "committedDate": "2020-01-16T08:14:36Z", "type": "commit"}, {"oid": "b23c0f730a6fd18424bc92cac00a98ace551380b", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/b23c0f730a6fd18424bc92cac00a98ace551380b", "message": "Definition test class to cover end to end subscribe, unsubscribe and publish", "committedDate": "2020-01-16T08:49:14Z", "type": "commit"}, {"oid": "cb962a9f95f5cf15901082faeb30200566447f6d", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/cb962a9f95f5cf15901082faeb30200566447f6d", "message": "Set default profile as default selection option.", "committedDate": "2020-01-21T09:09:21Z", "type": "commit"}, {"oid": "e1b4d208f6f0f9a8c4f012b9075f8cbc27fbb5f6", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/e1b4d208f6f0f9a8c4f012b9075f8cbc27fbb5f6", "message": "Introduce unit test for dep file management", "committedDate": "2020-01-24T09:01:28Z", "type": "commit"}, {"oid": "304b4f964642e3fede7e84a40f9892889030ae47", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/304b4f964642e3fede7e84a40f9892889030ae47", "message": "Refine implementation for a better error management in folder and dep file creation/update", "committedDate": "2020-01-28T14:23:19Z", "type": "commit"}, {"oid": "797746d138d63952fe7e28d866d57f1ca506c413", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/797746d138d63952fe7e28d866d57f1ca506c413", "message": "Merge remote-tracking branch 'remotes/origin/development' into 141_DepFileManagement\n\n# Conflicts:\n#\tcom.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/api/CopybookEventFactory.java\n#\tcom.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/factory/RunAnalysisSubscriberFactory.java\n#\tcom.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/impl/RunAnalysisEventSubscriber.java\n#\tcom.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/model/DataEventType.java\n#\tcom.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/model/RunAnalysisEvent.java\n#\tcom.ca.lsp.cobol/lsp-core-domain/src/test/java/com/broadcom/lsp/domain/cobol/event/CopybookEventSubscribersTest.java\n#\tcom.ca.lsp.cobol/lsp-core-domain/src/test/java/com/broadcom/lsp/domain/cobol/event/CopybookEventsTest.java\n#\tcom.ca.lsp.cobol/lsp-service-cobol/pom.xml\n#\tcom.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/CobolWorkspaceServiceImpl.java\n#\tcom.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyLanguageServerImpl.java\n#\tcom.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/service/WorkspaceServiceTest.java", "committedDate": "2020-01-28T15:14:25Z", "type": "commit"}, {"oid": "44f96bbc344991f5ab44615edc6617d67189a973", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/44f96bbc344991f5ab44615edc6617d67189a973", "message": "Adjustment after merge with development branch", "committedDate": "2020-01-29T07:16:45Z", "type": "commit"}, {"oid": "e4d0c85621993867570c1a8a35e19efbe8249d31", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/e4d0c85621993867570c1a8a35e19efbe8249d31", "message": "Fix search for copybook only in COPYBOOKS folder", "committedDate": "2020-01-29T07:30:31Z", "type": "commit"}, {"oid": "cdf75e221d57fb1201b5f3022655108dda4839e7", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/cdf75e221d57fb1201b5f3022655108dda4839e7", "message": "Update header and provide E2E integration test for FileSystemService with databus", "committedDate": "2020-01-29T14:53:09Z", "type": "commit"}, {"oid": "948cdf18150575154070d8fbd0d3d528d5145596", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/948cdf18150575154070d8fbd0d3d528d5145596", "message": "Merge remote-tracking branch 'remotes/origin/development' into 141_DepFileManagement\n\n# Conflicts:\n#\tcom.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/usecases/AnalyzeCopybookCaching.java", "committedDate": "2020-01-29T15:03:59Z", "type": "commit"}, {"oid": "b38f8a70c7d877a63be3b3580759cf3a9321c6ad", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/b38f8a70c7d877a63be3b3580759cf3a9321c6ad", "message": "Consume documentURI information sent on the databus by the preprocessor in order to generate dependency files with the same name as the cobol file scanned by the preprocessor.", "committedDate": "2020-01-29T15:59:27Z", "type": "commit"}, {"oid": "c411fbcb268497a965fd1ede188ba54fc8e64d57", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/c411fbcb268497a965fd1ede188ba54fc8e64d57", "message": "Modify write function to address issues related to the concurrent writing", "committedDate": "2020-01-30T17:17:02Z", "type": "commit"}, {"oid": "ecf643c0f789e90ec1142e4b5736de9427261cea", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/ecf643c0f789e90ec1142e4b5736de9427261cea", "message": "Fix failed test after the introduction of DocumentURI and improved write dependency of file checking for not empty values", "committedDate": "2020-01-31T09:09:30Z", "type": "commit"}, {"oid": "4809f9471923367ae12edc9ac4c5fdf3a3939caa", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/4809f9471923367ae12edc9ac4c5fdf3a3939caa", "message": "Improve create and write on dependency file, cover edge cases that can happen due to failed sync with the filesystem", "committedDate": "2020-01-31T11:06:14Z", "type": "commit"}, {"oid": "489aa7b5b59c9f96571d26f2e5fcc1fa825adb6f", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/489aa7b5b59c9f96571d26f2e5fcc1fa825adb6f", "message": "Add notification message related to gitfs unsupported filesystem", "committedDate": "2020-02-02T09:26:09Z", "type": "commit"}, {"oid": "622c2f02756c07797b03159cec43fe66670908da", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/622c2f02756c07797b03159cec43fe66670908da", "message": "Merge remote-tracking branch 'remotes/origin/development' into 141_DepFileManagement\n\n# Conflicts:\n#\tcom.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "committedDate": "2020-02-02T09:29:16Z", "type": "commit"}, {"oid": "bb6cb57467192dc724fb5be3ceb958f35027fac3", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/bb6cb57467192dc724fb5be3ceb958f35027fac3", "message": "Fix duplicates in pom, removed old TODO and unused variables", "committedDate": "2020-02-02T11:15:05Z", "type": "commit"}, {"oid": "78ef44b5986e311fe8e770aa43d24c531200be43", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/78ef44b5986e311fe8e770aa43d24c531200be43", "message": "Merge branch 'development' into zowe-copybook-tracker", "committedDate": "2020-02-03T14:46:12Z", "type": "commit"}, {"oid": "3a32884ef0e030aadd2ffadbea2da6354c066dc9", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/3a32884ef0e030aadd2ffadbea2da6354c066dc9", "message": "Merge remote-tracking branch 'origin/141_DepFileManagement' into zowe-copybook-tracker", "committedDate": "2020-02-03T14:47:04Z", "type": "commit"}, {"oid": "8da446de1a6fa02ef31ba0681a6815563a246369", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/8da446de1a6fa02ef31ba0681a6815563a246369", "message": "Merge branch 'development' into zowe-copybook-tracker", "committedDate": "2020-02-04T09:24:28Z", "type": "commit"}, {"oid": "456d8f1a37a5d46e4adcceff3d9e31e5a4dcd962", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/456d8f1a37a5d46e4adcceff3d9e31e5a4dcd962", "message": "change copybooks folders name to .copybooks", "committedDate": "2020-02-04T11:02:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0ODA1NQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182#discussion_r374648055", "bodyText": "Why do we store tslint config on the repository?", "author": "temanbrcom", "createdAt": "2020-02-04T12:42:30Z", "path": "clients/cobol-lsp-vscode-extension/tslint.json", "diffHunk": "@@ -31,7 +31,8 @@\n         \"arrow-parens\": [\n             true,\n             \"ban-single-arg-parens\"\n-        ]\n+        ],\n+        \"prettier\": true", "originalCommit": "456d8f1a37a5d46e4adcceff3d9e31e5a4dcd962", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY1Njc2Mg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182#discussion_r374656762", "bodyText": "To have it nice for everyone. It's project-specific settings so I put them to project.", "author": "ishche", "createdAt": "2020-02-04T13:02:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0ODA1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDcwODAwOA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182#discussion_r374708008", "bodyText": "Isn't tslint a dead project?", "author": "temanbrcom", "createdAt": "2020-02-04T14:39:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0ODA1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDcxOTkzMg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182#discussion_r374719932", "bodyText": "It is. But I believe that eslint understand tslint configuration.", "author": "ishche", "createdAt": "2020-02-04T14:57:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0ODA1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDczMzYzMA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182#discussion_r374733630", "bodyText": "I think that it deserves an additional user story to provide a proper eslint config for our requirements.", "author": "temanbrcom", "createdAt": "2020-02-04T15:18:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0ODA1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAxMjI5Mg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182#discussion_r375012292", "bodyText": "Also, the story should be about switching to eslint. I agree.", "author": "ishche", "createdAt": "2020-02-05T01:14:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0ODA1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY1MTQ4MA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182#discussion_r374651480", "bodyText": "\ud83d\ude20", "author": "temanbrcom", "createdAt": "2020-02-04T12:50:24Z", "path": "clients/cobol-lsp-vscode-extension/src/CopybooksDownloader.ts", "diffHunk": "@@ -0,0 +1,143 @@\n+/*\n+ * Copyright (c) 2020 Broadcom.\n+ * The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *   Broadcom, Inc. - initial API and implementation\n+ */\n+\n+import { IProfile } from \"@zowe/imperative\";\n+import * as fs from \"fs\";\n+import * as path from \"path\";\n+import * as vscode from \"vscode\";\n+import { ProfilesMap, ZoweApi } from \"./ZoweApi\";\n+\n+export const DEPENDENCIES_FOLDER: string = \".cobdeps\";\n+export const COPYBOOKS_FOLDER: string = \".copybooks\";\n+\n+const SETTINGS_ROOT = \"cobol-language-support\";\n+\n+export class CopybooksDownloader {\n+    public constructor(private zoweApi: ZoweApi) { }\n+\n+    /**\n+     * @param copybooks array of copybooks names to download\n+     */\n+    // tslint:disable-next-line: cognitive-complexity", "originalCommit": "456d8f1a37a5d46e4adcceff3d9e31e5a4dcd962", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f8b85f1ed93c5c843eca8f2fd8ef1eed965384ac", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/f8b85f1ed93c5c843eca8f2fd8ef1eed965384ac", "message": "Merge branch 'development' into zowe-copybook-tracker", "committedDate": "2020-02-07T10:09:31Z", "type": "commit"}, {"oid": "429d30d7d57fde3a456fcfc31f068c3fa91f6780", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/429d30d7d57fde3a456fcfc31f068c3fa91f6780", "message": "Remove request library dependency and small refactoring", "committedDate": "2020-02-11T13:29:51Z", "type": "commit"}, {"oid": "d198644f3d519dfd8219cb5a1c0fe5f8b6c264b3", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/d198644f3d519dfd8219cb5a1c0fe5f8b6c264b3", "message": "Merge branch 'development' into zowe-copybook-tracker", "committedDate": "2020-02-11T13:31:06Z", "type": "commit"}, {"oid": "e2f507cf9a62c5806ab277b6ddd4c66a71a6a21e", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/e2f507cf9a62c5806ab277b6ddd4c66a71a6a21e", "message": "WIP. Ask to get copybooks. Get profile name base on filepath", "committedDate": "2020-02-12T12:50:35Z", "type": "commit"}, {"oid": "1248e9aeb62fb730e41fde799ca7880ee5a2f0ef", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/1248e9aeb62fb730e41fde799ca7880ee5a2f0ef", "message": "Store profiles for programs in settings.json", "committedDate": "2020-02-13T15:59:33Z", "type": "commit"}, {"oid": "2025c82f7f5e0295b01faf2f55834d66f4cbc67b", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/2025c82f7f5e0295b01faf2f55834d66f4cbc67b", "message": "Listen to settings cahnges", "committedDate": "2020-02-14T10:15:40Z", "type": "commit"}, {"oid": "18b581907e457992c08876c5bb4e3dc84ae84319", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/18b581907e457992c08876c5bb4e3dc84ae84319", "message": "Add redownload all command", "committedDate": "2020-02-14T10:21:22Z", "type": "commit"}, {"oid": "e951f0275a8fb867d2dc950552f591b1358a6377", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/e951f0275a8fb867d2dc950552f591b1358a6377", "message": "new look for package.json configuration structure", "committedDate": "2020-02-17T10:14:59Z", "type": "commit"}, {"oid": "badec55fb86db4c26c0640aed9df01748f9f971f", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/badec55fb86db4c26c0640aed9df01748f9f971f", "message": "Merge branch 'development' into zowe-copybook-tracker", "committedDate": "2020-02-17T10:26:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDEwODgzMg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182#discussion_r380108832", "bodyText": "in order to use autocomplete in settings.json we can not combine different properties under one structure to have something like:\nbroadcom-cobol-lsp.cpy-manager: { paths: {}, profiles: {} } \nthis link is useful for future implementation", "author": "sergiuilie", "createdAt": "2020-02-17T10:45:57Z", "path": "clients/cobol-lsp-vscode-extension/package.json", "diffHunk": "@@ -38,7 +50,24 @@\n                     \".cob\"\n                 ]\n             }\n-        ]\n+        ],\n+        \"configuration\": {\n+            \"title\": \"Broadcom COBOL LSP\",\n+            \"properties\": {\n+                \"broadcom-cobol-lsp.cpy-manager.profiles\": {\n+                    \"type\": \"Object\",\n+                    \"description\": \"Program name to profile map\"\n+                },\n+                \"broadcom-cobol-lsp.cpy-manager.paths\": {", "originalCommit": "badec55fb86db4c26c0640aed9df01748f9f971f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e5215140e56fabb833f1eabf512b4d4164c918fb", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/e5215140e56fabb833f1eabf512b4d4164c918fb", "message": "update settings prefix in code", "committedDate": "2020-02-17T10:49:21Z", "type": "commit"}, {"oid": "03acb651d2db803179be353bbb8530ab62e88149", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/03acb651d2db803179be353bbb8530ab62e88149", "message": "Fix compilation error", "committedDate": "2020-02-17T11:37:27Z", "type": "commit"}, {"oid": "5d5234dd434d511ba2e74337040bb7f7f4cb307c", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/5d5234dd434d511ba2e74337040bb7f7f4cb307c", "message": "Update messages on configuration change", "committedDate": "2020-02-17T12:00:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIyMDQ5OQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182#discussion_r380220499", "bodyText": "just a question, I do like the minimalistic style but do you think that for a newcomer it is easy to read and understand cb and ds variable names?", "author": "sergiuilie", "createdAt": "2020-02-17T14:43:25Z", "path": "clients/cobol-lsp-vscode-extension/src/CopybooksDownloader.ts", "diffHunk": "@@ -0,0 +1,151 @@\n+/*\n+ * Copyright (c) 2020 Broadcom.\n+ * The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *   Broadcom, Inc. - initial API and implementation\n+ */\n+\n+import * as fs from \"fs\";\n+import * as path from \"path\";\n+import * as vscode from \"vscode\";\n+import { SETTINGS_SECTION } from \"./extension\";\n+import { ProfileService } from \"./ProfileService\";\n+import { ZoweApi } from \"./ZoweApi\";\n+\n+export const DEPENDENCIES_FOLDER: string = \".cobdeps\";\n+export const COPYBOOKS_FOLDER: string = \".copybooks\";\n+\n+export class CopybooksDownloader {\n+    public constructor(\n+        private zoweApi: ZoweApi,\n+        private profileService: ProfileService) { }\n+\n+    public async redownloadDependencies(message: string = \"Redownload dependencies requested.\") {\n+        (await vscode.workspace.findFiles(\".cobdeps/**/*.dep\")).forEach(dep => {\n+            const errFile = dep.fsPath.substr(0, dep.fsPath.length - 4) + \".err\";\n+            if (fs.existsSync(errFile)) {\n+                try {\n+                    fs.unlinkSync(errFile);\n+                } catch (error) {\n+                    vscode.window.showErrorMessage(error.toString());\n+                }\n+            }\n+            this.downloadDependencies(dep, message);\n+        });\n+    }\n+    /**\n+     * @param copybooks array of copybooks names to download\n+     */\n+    public async downloadDependencies(uri: vscode.Uri,\n+                                      message: string = \"Program contains dependencies to missing copybooks.\",\n+                                     ): Promise<void> {\n+        // TODO Maybe introduce download queue?\n+        const missingCopybooksFilePath = uri.fsPath.substr(0, uri.fsPath.length - \".dep\".length) + \".err\";\n+        const copybooks: string[] = fs.readFileSync(uri.fsPath).toString().split(\"\\n\")\n+            .filter(e => e.trim().length > 0)\n+            .map(e => e.trim());\n+        const missingCopybooks: string[] = this.readMissingCopybooks(missingCopybooksFilePath);\n+        if (vscode.workspace.workspaceFolders.length === 0) {\n+            vscode.window.showErrorMessage(\"No workspace folder opened.\");\n+            return;\n+        }\n+\n+        const cb: Set<string> = new Set(copybooks);", "originalCommit": "5d5234dd434d511ba2e74337040bb7f7f4cb307c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM4Mzc2Nw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182#discussion_r380383767", "bodyText": "ds seem pretty clear for me, cb - not)\nrenamed", "author": "ishche", "createdAt": "2020-02-17T22:22:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIyMDQ5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIzOTM2NQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182#discussion_r380239365", "bodyText": "you don't get any error here? can you assign empty object to the settingsProfile?", "author": "sergiuilie", "createdAt": "2020-02-17T15:17:30Z", "path": "clients/cobol-lsp-vscode-extension/src/ProfileService.ts", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Copyright (c) 2020 Broadcom.\n+ * The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *   Broadcom, Inc. - initial API and implementation\n+ */\n+\n+import { IProfile } from \"@zowe/imperative\";\n+import * as path from \"path\";\n+import * as vscode from \"vscode\";\n+import { SETTINGS_SECTION } from \"./extension\";\n+import { ProfilesMap, ZoweApi } from \"./ZoweApi\";\n+\n+export class ProfileService {\n+    constructor(private zoweApi: ZoweApi) {\n+    }\n+\n+    public async getProfile(depFile: vscode.Uri): Promise<string> {\n+        const programName = this.getProgramNameFromDepFile(depFile);\n+        const detectedProfile = (await this.findProfileByDependenciesFile(depFile))\n+            || this.tryGetProfileFromSettings(programName);\n+        if (detectedProfile) {\n+            return detectedProfile;\n+        }\n+        const profiles: ProfilesMap = await this.zoweApi.listZOSMFProfiles();\n+        if (Object.keys(profiles).length === 0) {\n+            await vscode.window.showErrorMessage(\"Zowe profile is missing.\");\n+            return undefined;\n+        }\n+        if (Object.keys(profiles).length === 1) {\n+            return Object.keys(profiles)[0];\n+        }\n+        const defaultName = this.zoweApi.getDefaultProfileName();\n+        let items: vscode.QuickPickItem[] = [];\n+        Object.keys(profiles).forEach(name => {\n+            const profile: IProfile = profiles[name];\n+            const item: vscode.QuickPickItem = {\n+                description: profile.username + \"@\" + profile.host + \":\" + profile.port,\n+                label: name,\n+            };\n+            if (defaultName === name) {\n+                items = [item].concat(items);\n+            } else {\n+                items.push(item);\n+            }\n+        });\n+\n+        const selectedProfile = await vscode.window.showQuickPick(items,\n+            { placeHolder: defaultName, canPickMany: false });\n+        if (selectedProfile) {\n+            let settingsProfiles = vscode.workspace.getConfiguration().get(SETTINGS_SECTION + \".profiles\");\n+            settingsProfiles = settingsProfiles ? settingsProfiles : {};", "originalCommit": "5d5234dd434d511ba2e74337040bb7f7f4cb307c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM4MTgzOA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182#discussion_r380381838", "bodyText": "It is an empty object according to package.json\nI use it as a map to store a profile name for program.", "author": "ishche", "createdAt": "2020-02-17T22:13:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIzOTM2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI0NDgwMA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182#discussion_r380244800", "bodyText": "we are depending a lot on this hardcoded parts from Zowe", "author": "sergiuilie", "createdAt": "2020-02-17T15:27:42Z", "path": "clients/cobol-lsp-vscode-extension/src/ZoweApi.ts", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright (c) 2020 Broadcom.\n+ * The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *   Broadcom, Inc. - initial API and implementation\n+ */\n+\n+import { BasicProfileManager, IProfile, Session, RestClient, AbstractSession } from \"@zowe/imperative\";\n+import * as os from \"os\";\n+import * as path from \"path\";\n+\n+export interface ProfilesMap {\n+    [key: string]: IProfile;\n+}\n+\n+export class ZoweApi {\n+    private profileManager = new BasicProfileManager({\n+        profileRootDirectory: path.join(os.homedir(), \".zowe\", \"profiles\"),\n+        type: \"zosmf\",\n+    });\n+\n+    public async listZOSMFProfiles(): Promise<ProfilesMap> {\n+        const profiles: ProfilesMap = {};\n+        for (const loadedProfile of await this.profileManager.loadAll()) {\n+            if (loadedProfile.failNotFound) {\n+                profiles[loadedProfile.name] = loadedProfile.profile;\n+            }\n+        }\n+        return profiles;\n+    }\n+\n+    public getDefaultProfileName() {\n+        return this.profileManager.getDefaultProfileName();\n+    }\n+\n+    public async fetchMember(dataset: string, member: string, profileName: string): Promise<string> {\n+        const session: Session = await this.createSession(profileName);\n+\n+        // default should be https\n+        const rpath = `/zosmf/restfiles/ds/${dataset}(${member})`;\n+        return await RestClient.getExpectString(session, rpath, [{\n+            \"Content-Type\": \"application/json\", \"X-CSRF-ZOSMF-HEADER\": \"\" }]);\n+    }\n+\n+    public async listMembers(dataset: string, profileName: string): Promise<string[]> {\n+        // default should be https\n+        const session: Session = await this.createSession(profileName);\n+        const rpath = `/zosmf/restfiles/ds/${dataset}/member`;", "originalCommit": "5d5234dd434d511ba2e74337040bb7f7f4cb307c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM4MjI1Ng==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182#discussion_r380382256", "bodyText": "It's not Zowe, it's zOSMF. Can you describe more, what problem do you see here?", "author": "ishche", "createdAt": "2020-02-17T22:15:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI0NDgwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTI5MDA3Mg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182#discussion_r381290072", "bodyText": "it is not a problem, the thing is that we hardcode the path and if they change something we are dependent on them", "author": "sergiuilie", "createdAt": "2020-02-19T13:31:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI0NDgwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzExMDE2Ng==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182#discussion_r387110166", "bodyText": "I agree I would prefer to have these values in some resource file", "author": "temanbrcom", "createdAt": "2020-03-03T15:46:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI0NDgwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI2MTAzMA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182#discussion_r380261030", "bodyText": "what does it have to do with the client?", "author": "sergiuilie", "createdAt": "2020-02-17T15:58:09Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/TestModule.java", "diffHunk": "@@ -16,6 +16,8 @@\n package com.ca.lsp.cobol;\n \n import com.broadcom.lsp.cdi.module.DefaultModule;\n+import com.broadcom.lsp.domain.cobol.databus.impl.AbstractDataBusBroker;", "originalCommit": "5d5234dd434d511ba2e74337040bb7f7f4cb307c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "01a630026de83afe95de6f65d039369621d0ee20", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/01a630026de83afe95de6f65d039369621d0ee20", "message": "Merge branch 'development' into zowe-copybook-tracker", "committedDate": "2020-02-17T16:00:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI3MTUzNQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182#discussion_r380271535", "bodyText": "can the profile be a string?", "author": "sergiuilie", "createdAt": "2020-02-17T16:18:46Z", "path": "clients/cobol-lsp-vscode-extension/package.json", "diffHunk": "@@ -38,7 +50,24 @@\n                     \".cob\"\n                 ]\n             }\n-        ]\n+        ],\n+        \"configuration\": {\n+            \"title\": \"Broadcom COBOL LSP\",\n+            \"properties\": {\n+                \"broadcom-cobol-lsp.cpy-manager.profiles\": {", "originalCommit": "01a630026de83afe95de6f65d039369621d0ee20", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM4MjU2OQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/182#discussion_r380382569", "bodyText": "Zowe Profile is a pretty complex structure, here I use an object to store relation with program name (string) to profile name (string)", "author": "ishche", "createdAt": "2020-02-17T22:16:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI3MTUzNQ=="}], "type": "inlineReview"}, {"oid": "8a668a61869eda008896041a2a50d7ba8212514a", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/8a668a61869eda008896041a2a50d7ba8212514a", "message": "Rename some variables", "committedDate": "2020-02-17T22:20:23Z", "type": "commit"}, {"oid": "e4ac5786eb1f15660975bd41a3294737d066884b", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/e4ac5786eb1f15660975bd41a3294737d066884b", "message": "Merge branch 'zowe-copybook-tracker' of github.com:eclipse/che-che4z-lsp-for-cobol into zowe-copybook-tracker", "committedDate": "2020-02-17T22:20:28Z", "type": "commit"}, {"oid": "bbebecff6e913ffb93d86fd3efa359e156999261", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/bbebecff6e913ffb93d86fd3efa359e156999261", "message": "Merge branch 'development' into zowe-copybook-tracker", "committedDate": "2020-02-18T13:35:59Z", "type": "commit"}, {"oid": "ad1c5aa87a65da02a121c058c2699527f451fe68", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/ad1c5aa87a65da02a121c058c2699527f451fe68", "message": "Don't create dataset folder if copybook isn't in", "committedDate": "2020-02-18T15:17:08Z", "type": "commit"}, {"oid": "afbbed7ce4c86b3e3fc6150a0f41cf1102c122ec", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/afbbed7ce4c86b3e3fc6150a0f41cf1102c122ec", "message": "Improve error handling", "committedDate": "2020-02-18T15:25:52Z", "type": "commit"}, {"oid": "5793343b4c5b56d9d4d9ffa2640066e085d64152", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/5793343b4c5b56d9d4d9ffa2640066e085d64152", "message": "Update changelog", "committedDate": "2020-02-19T15:04:09Z", "type": "commit"}, {"oid": "7f2bde731981e7c34c9163e1e09da6573d4d07f9", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/7f2bde731981e7c34c9163e1e09da6573d4d07f9", "message": "Merge branch 'development' into zowe-copybook-tracker", "committedDate": "2020-02-19T15:36:10Z", "type": "commit"}, {"oid": "5cfb5640775a5ddc2eefcece55d8090a4fbdbb89", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/5cfb5640775a5ddc2eefcece55d8090a4fbdbb89", "message": "Suggest to edit path if there is a problem with dataset", "committedDate": "2020-02-21T10:03:09Z", "type": "commit"}, {"oid": "72e2a05e0338eb2b0382fca3baf4535384118cb0", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/72e2a05e0338eb2b0382fca3baf4535384118cb0", "message": "Merge branch 'development' into zowe-copybook-tracker", "committedDate": "2020-02-24T10:19:48Z", "type": "commit"}, {"oid": "a1be290aebcd522838eae23ed4794f0060ca4fdf", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/a1be290aebcd522838eae23ed4794f0060ca4fdf", "message": "Merge branch 'development' into zowe-copybook-tracker", "committedDate": "2020-02-24T13:54:55Z", "type": "commit"}, {"oid": "4d9c6a3c4aad369c2f543195c23df14ab33bf97a", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/4d9c6a3c4aad369c2f543195c23df14ab33bf97a", "message": "add queue and tests for it", "committedDate": "2020-02-24T16:44:01Z", "type": "commit"}, {"oid": "1ca963f39c3a6ff76610128a1dbf0b51e655e8ab", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/1ca963f39c3a6ff76610128a1dbf0b51e655e8ab", "message": "Reset resolve field in queue", "committedDate": "2020-02-24T16:48:06Z", "type": "commit"}, {"oid": "4f77b9f2837642d38d852fe22bd848c984536a49", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/4f77b9f2837642d38d852fe22bd848c984536a49", "message": "Merge branch 'development' into zowe-copybook-tracker", "committedDate": "2020-02-27T07:47:46Z", "type": "commit"}, {"oid": "7efcde5ca1720e9815861ddc9363a2d917aaffd0", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/7efcde5ca1720e9815861ddc9363a2d917aaffd0", "message": "WIP download queue. Remove error files.", "committedDate": "2020-02-27T14:49:09Z", "type": "commit"}, {"oid": "a1f409b3cdf9f743d74583b6e4c4f8d8d36c7272", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/a1f409b3cdf9f743d74583b6e4c4f8d8d36c7272", "message": "Fix lsp start issue", "committedDate": "2020-02-27T15:15:47Z", "type": "commit"}, {"oid": "fd263c5c6c755c6e075e3367b7744a7cce0ed800", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/fd263c5c6c755c6e075e3367b7744a7cce0ed800", "message": "UX fixes", "committedDate": "2020-02-27T15:41:20Z", "type": "commit"}, {"oid": "8cdc3969b8c6ac262bb86609948e34d6591cb9c5", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/8cdc3969b8c6ac262bb86609948e34d6591cb9c5", "message": "Add codeaction to setup dataset paths", "committedDate": "2020-02-28T08:44:10Z", "type": "commit"}, {"oid": "b5a6414acdac61982b7c8ffe8312ae0135b87815", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/b5a6414acdac61982b7c8ffe8312ae0135b87815", "message": "Remove hardcoded version number from code", "committedDate": "2020-02-28T09:51:52Z", "type": "commit"}, {"oid": "8c261fafcb8657cb56d59a73333d76bbf0f6b720", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/8c261fafcb8657cb56d59a73333d76bbf0f6b720", "message": "Switch to default profile name for cb downloader", "committedDate": "2020-02-28T09:59:06Z", "type": "commit"}, {"oid": "a019e0d22d1c141978fa258b2ed4c44f440b62cb", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/a019e0d22d1c141978fa258b2ed4c44f440b62cb", "message": "Impreve error handling", "committedDate": "2020-02-28T15:27:50Z", "type": "commit"}, {"oid": "73c0fb7102adf4d63b3e08920e5d3f2bec9da80b", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/73c0fb7102adf4d63b3e08920e5d3f2bec9da80b", "message": "Read ZOWE_CLI_HOME to load profiles", "committedDate": "2020-03-02T15:10:33Z", "type": "commit"}, {"oid": "80763785c77ab938720cd68d0744e4786aa9d522", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/80763785c77ab938720cd68d0744e4786aa9d522", "message": "fix tests", "committedDate": "2020-03-02T20:20:27Z", "type": "commit"}, {"oid": "988db31832da6db0dce486999e4553376133116d", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/988db31832da6db0dce486999e4553376133116d", "message": "Improve error handling", "committedDate": "2020-03-03T10:35:11Z", "type": "commit"}, {"oid": "e604a5594e7e0b0c96979d8073cf6643d1e818e2", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/e604a5594e7e0b0c96979d8073cf6643d1e818e2", "message": "Fix ZOWE_CLI_HOME to expect .zowe in it", "committedDate": "2020-03-03T11:15:45Z", "type": "commit"}, {"oid": "9cca74db5700be2eec9348f00dd4e36b9d6d19fa", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/9cca74db5700be2eec9348f00dd4e36b9d6d19fa", "message": "Fix error processing", "committedDate": "2020-03-03T11:46:26Z", "type": "commit"}]}