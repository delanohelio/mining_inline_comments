{"pr_number": 532, "pr_title": "Lock copybook download queue in case of wrong MF credentials", "pr_createdAt": "2020-09-23T11:19:56Z", "pr_url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ5MjE1Ng==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493492156", "bodyText": "From telemetry POV could be an interesting event to collect I suppose", "author": "andzac", "createdAt": "2020-09-23T11:47:17Z", "path": "clients/cobol-lsp-vscode-extension/src/services/copybook/CopybookDownloadService.ts", "diffHunk": "@@ -121,15 +146,15 @@ export class CopybookDownloadService implements vscode.Disposable {\n                 switch (e.type) {\n                     case Type.InvalidCredentials:\n                         errorMessage = INVALID_CREDENTIALS_ERROR_MSG.replace(PROFILE_NAME_PLACEHOLDER, element.profile);\n+                        this.locked = true;\n+                        this.queue.clean();", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE0MDI1MA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r494140250", "bodyText": "Make sense.", "author": "grianbrcom", "createdAt": "2020-09-24T08:39:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ5MjE1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ5ODAzMQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493498031", "bodyText": "With the new value defined here, I think is time to find a more appropriate value for that enum. In past was named TextDocumentSyncType because was the reference in the LSP protocol specification for DID_OPEN and DID_CHANGE", "author": "andzac", "createdAt": "2020-09-23T11:53:22Z", "path": "server/src/main/java/com/ca/lsp/cobol/service/TextDocumentSyncType.java", "diffHunk": "@@ -20,5 +20,6 @@\n  */\n public enum TextDocumentSyncType {", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY5NDk5Mw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493694993", "bodyText": "It may be replaced with according methods in CopybookProcessingMode", "author": "temanbrcom", "createdAt": "2020-09-23T15:39:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ5ODAzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE4MDQ2NQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r494180465", "bodyText": "I've deleted this enum.", "author": "grianbrcom", "createdAt": "2020-09-24T09:43:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ5ODAzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUwMDAzNw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493500037", "bodyText": "use copybookProcessingMode instead of syncType", "author": "andzac", "createdAt": "2020-09-23T11:55:29Z", "path": "server/src/main/java/com/ca/lsp/core/cobol/preprocessor/sub/document/CopybookResolution.java", "diffHunk": "@@ -33,5 +34,5 @@\n    */\n   @Nullable\n   CopybookModel resolve(\n-      @Nonnull String copybookName, @Nonnull String documentUri, @Nonnull String syncType);\n+      @Nonnull String copybookName, @Nonnull String documentUri, @Nonnull CopybookProcessingMode syncType);", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUwMDUxNg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493500516", "bodyText": "as above ;)", "author": "andzac", "createdAt": "2020-09-23T11:55:56Z", "path": "server/src/main/java/com/ca/lsp/core/cobol/preprocessor/sub/document/GrammarPreprocessorListenerFactory.java", "diffHunk": "@@ -28,5 +29,5 @@ GrammarPreprocessorListenerImpl create(\n       @Nonnull @Assisted(\"uri\") String uri,\n       @Nonnull BufferedTokenStream tokens,\n       @Nonnull Deque<CopybookUsage> copybookStack,\n-      @Nonnull @Assisted(\"copybookProcessingMode\") String textDocumentSyncType);\n+      @Nonnull @Assisted(\"copybookProcessingMode\") CopybookProcessingMode textDocumentSyncType);", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYyNjkxNg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493626916", "bodyText": "if (match !== null) {\nreturn new RequestLine(\nmatch[1],\nmatch[2],\nmatch[5],\nmatch[6],\n\"verbose\" != match[4]\n);\n}", "author": "asatklichov", "createdAt": "2020-09-23T14:13:15Z", "path": "clients/cobol-lsp-vscode-extension/src/services/Middleware.ts", "diffHunk": "@@ -35,19 +30,43 @@ export class Middleware {\n         token: CancellationToken,\n         next: ConfigurationRequest.HandlerSignature): Promise<HandlerResult<any[], void>> {\n \n-        if (params.items.length > 0) {\n-            const sectionName = params.items[0].section;\n-            if (sectionName.startsWith(\"broadcom-cobol-lsp.copybook-resolve\")) {\n-                const [cobolFileName, copybookName] = Middleware.extractFileAndCopybookNames(sectionName);\n-                return [await this.copybookResolverURI.resolveCopybookURI(copybookName, cobolFileName)];\n-            }\n-            if (sectionName.startsWith(\"broadcom-cobol-lsp.copybook-download\")) {\n-                const extractedNames = params.items.map(item => Middleware.extractFileAndCopybookNames(item.section));\n-                const copybookNames = extractedNames.map(names => names[1]);\n-                this.copybookDownloader.downloadCopybooks(extractedNames[0][0], copybookNames);\n-                return [];\n+        const requestLines = params.items.map(item => Middleware.parseLine(item.section));\n+        if (requestLines.length > 0 && requestLines[0] !== null && requestLines[0].prefix == \"broadcom-cobol-lsp\") {\n+            switch (requestLines[0].command) {\n+                case \"copybook-resolve\":\n+                    return [await this.copybookResolverURI.resolveCopybookURI(requestLines[0].copybookName,\n+                        requestLines[0].cobolFileName)]\n+                case \"copybook-download\":\n+                    const copybookNames = requestLines.map(requestLine => requestLine.copybookName);\n+                    this.copybookDownloader.downloadCopybooks(requestLines[0].cobolFileName, copybookNames,\n+                        requestLines[0].quiet);\n+                    return [];\n             }\n         }\n         return next(params, token);\n     }\n+\n+    private static parseLine(line: string): RequestLine | undefined {\n+        const match = PARAMS_REGEX.exec(line);\n+        if (match === null) {", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYyNzE2OQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493627169", "bodyText": "implicitly returns undefined", "author": "asatklichov", "createdAt": "2020-09-23T14:13:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYyNjkxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE1NTI2OA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r494155268", "bodyText": "Agree.", "author": "grianbrcom", "createdAt": "2020-09-24T09:02:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYyNjkxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY0Njk3OQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493646979", "bodyText": "If I remember correctly, ID in @Assisted required only if there are some similar types injected. Now, all the parameters have different types, so you may use @Assisted without ID", "author": "temanbrcom", "createdAt": "2020-09-23T14:38:17Z", "path": "server/src/main/java/com/ca/lsp/core/cobol/preprocessor/sub/document/GrammarPreprocessorListenerFactory.java", "diffHunk": "@@ -28,5 +29,5 @@ GrammarPreprocessorListenerImpl create(\n       @Nonnull @Assisted(\"uri\") String uri,\n       @Nonnull BufferedTokenStream tokens,\n       @Nonnull Deque<CopybookUsage> copybookStack,\n-      @Nonnull @Assisted(\"copybookProcessingMode\") String textDocumentSyncType);\n+      @Nonnull @Assisted(\"copybookProcessingMode\") CopybookProcessingMode textDocumentSyncType);", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE2NDAwNw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r494164007", "bodyText": "Cool, I can even delete the entire @Assested.", "author": "grianbrcom", "createdAt": "2020-09-24T09:17:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY0Njk3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY1MTk0NQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493651945", "bodyText": "Will fork for now, but later on I would prefer to change the logic using different methods with descriptive names instead of passing the boolean flag.", "author": "temanbrcom", "createdAt": "2020-09-23T14:44:30Z", "path": "server/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "diffHunk": "@@ -216,7 +215,7 @@ private void registerEngineAndAnalyze(String uri, String languageType, String te\n       communications.notifyThatExtensionIsUnsupported(fileExtension);\n     } else if (isCobolFile(languageType)) {\n       communications.notifyThatLoadingInProgress(uri);\n-      analyzeDocumentFirstTime(uri, text);\n+      analyzeDocumentFirstTime(uri, text, false);", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY1Mzc1MA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493653750", "bodyText": "I think this switch may be replaced with different methods dropping the TextDocumentSyncType class. Not necessary to do it now, just a note for future", "author": "temanbrcom", "createdAt": "2020-09-23T14:46:48Z", "path": "server/src/main/java/com/ca/lsp/cobol/service/CopybookProcessingMode.java", "diffHunk": "@@ -42,12 +53,23 @@ public static CopybookProcessingMode getCopybookProcessingMode(\n         : getProcessingModeByTextDocSyncType(textDocumentSyncType);\n   }\n \n-  private static CopybookProcessingMode getProcessingModeByTextDocSyncType(\n+  /**\n+   * Converts sync type into appropriate processing mode.\n+   *\n+   * @param textDocumentSyncType the sync type of the document.\n+   * @return an appropriate processing mode.\n+   */\n+  public static CopybookProcessingMode getProcessingModeByTextDocSyncType(\n       @Nonnull TextDocumentSyncType textDocumentSyncType) {\n-    if (textDocumentSyncType == TextDocumentSyncType.DID_CHANGE) {\n-      return SKIP;\n-    } else {\n-      return ENABLED;\n+    switch (textDocumentSyncType) {\n+      case DID_OPEN:\n+        return ENABLED;\n+      case DID_CHANGE:\n+        return SKIP;\n+      case USER_REQUEST:\n+        return ENABLED_VERBOSE;\n+      default:\n+        return DISABLED;", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY3Mzk3NA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493673974", "bodyText": "I don't see where do you check this value", "author": "temanbrcom", "createdAt": "2020-09-23T15:11:52Z", "path": "server/src/main/java/com/broadcom/lsp/domain/cobol/event/model/RunAnalysisEvent.java", "diffHunk": "@@ -22,7 +22,15 @@\n  * all the registered documents.\n  */\n public class RunAnalysisEvent extends DataEvent {\n+  public final boolean quiet;", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE2NTAyOA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r494165028", "bodyText": "Oops, you are right. I must use it in MyTextDocumentService:observerCallback.", "author": "grianbrcom", "createdAt": "2020-09-24T09:18:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY3Mzk3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY3NDY5OA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493674698", "bodyText": "I think that \"verbose\" here would be more descriptive, but it depends on how do you use it", "author": "temanbrcom", "createdAt": "2020-09-23T15:12:48Z", "path": "server/src/main/java/com/broadcom/lsp/domain/cobol/event/model/RunAnalysisEvent.java", "diffHunk": "@@ -22,7 +22,15 @@\n  * all the registered documents.\n  */\n public class RunAnalysisEvent extends DataEvent {\n+  public final boolean quiet;\n+\n   public RunAnalysisEvent() {\n     super(RUN_ANALYSIS_EVENT, RUN_ANALYSIS_EVENT.getId());\n+    this.quiet = true;\n+  }\n+\n+  public RunAnalysisEvent(boolean quiet) {\n+    super(RUN_ANALYSIS_EVENT, RUN_ANALYSIS_EVENT.getId());\n+    this.quiet = quiet;", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE2NjkwNg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r494166906", "bodyText": "Agree, I'll rename it.", "author": "grianbrcom", "createdAt": "2020-09-24T09:21:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY3NDY5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY4MTIzOA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493681238", "bodyText": "Maybe, it would be more descriptive to say something like \"Copybook downloading stopped due to invalid credentials\". I would recommend to discuss it with @zimlu02 or @zeibura\nBesides that, as I remember, there should be no dots at the end of the info messages", "author": "temanbrcom", "createdAt": "2020-09-23T15:21:17Z", "path": "clients/cobol-lsp-vscode-extension/src/constants.ts", "diffHunk": "@@ -20,6 +20,7 @@ export const COPYBOOKS_FOLDER: string = \".copybooks\";\n export const GITIGNORE_FILE: string = \".gitignore\";\n export const LANGUAGE_ID = \"COBOL\";\n export const PROCESS_DOWNLOAD_ERROR_MSG = \"Some copybooks could not be located. Ensure your configuration contains correct paths to copybooks, including nested copybooks. Missing copybooks: \";\n+export const DOWNLOAD_QUEUE_LOCKED_ERROR_MSG = \"Your queue was locked due to invalid credentials.\";", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE5MjYzOQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r494192639", "bodyText": "I've tried to make it more user friendly:\n\n@zimlu02, @zeibura what do you think?", "author": "grianbrcom", "createdAt": "2020-09-24T10:03:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY4MTIzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY5MDY1Nw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r493690657", "bodyText": "I didn't get why did you change this", "author": "temanbrcom", "createdAt": "2020-09-23T15:33:55Z", "path": "server/src/test/java/com/ca/lsp/cobol/service/MyTextDocumentServiceTest.java", "diffHunk": "@@ -365,8 +369,8 @@ private void verifyCallback(\n       String text,\n       String uri) {\n \n-    verify(engine, timeout(10000).times(2)).analyze(uri, text, CopybookProcessingMode.ENABLED);\n-    verify(communications, times(2)).publishDiagnostics(diagnostics);\n+    verify(engine, timeout(10000).times(1)).analyze(uri, text, CopybookProcessingMode.ENABLED);\n+    verify(communications, times(1)).publishDiagnostics(diagnostics);", "originalCommit": "cc78943d945a523d42d2c0403720225cb9455260", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE3MjUwNg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r494172506", "bodyText": "You are right. I'll return that back.", "author": "grianbrcom", "createdAt": "2020-09-24T09:30:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY5MDY1Nw=="}], "type": "inlineReview"}, {"oid": "d741bb9c713e20b11b89c9b57247bb0872014052", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/d741bb9c713e20b11b89c9b57247bb0872014052", "message": "feat: Lock copybook download queue in case of wrong MF credentials\n\nCloses #488\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>", "committedDate": "2020-09-24T10:05:27Z", "type": "forcePushed"}, {"oid": "d7ac0e28720076a4701b623ce3d9bbdb2638541d", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/d7ac0e28720076a4701b623ce3d9bbdb2638541d", "message": "feat: Lock copybook download queue in case of wrong MF credentials\n\nCloses #488\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>", "committedDate": "2020-09-25T14:12:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYwNjAwNg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r496606006", "bodyText": "I would provide a better description like: \"Given an input string then parseLine returns the RequestLine expected or undefined", "author": "zacanbrcom", "createdAt": "2020-09-29T10:21:02Z", "path": "clients/cobol-lsp-vscode-extension/src/__tests__/MiddlewareTest.spec.ts", "diffHunk": "@@ -73,3 +73,17 @@ describe(\"Copybook downloader\", () => {\n         expect(next).toHaveBeenCalledWith(params, null);\n     });\n });\n+\n+const each = require(\"jest-each\").default;\n+describe(\"Parse line parsing test\", () => {", "originalCommit": "d7ac0e28720076a4701b623ce3d9bbdb2638541d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYxMzAwNQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r496613005", "bodyText": "This description is only a part of a test case name. See an example:", "author": "grianbrcom", "createdAt": "2020-09-29T10:33:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYwNjAwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYxNjQzOA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r496616438", "bodyText": "I saw it, so I will reformulate it like: \"ParseLine() return a RequestLine object or undefined when the input is\" + foreach.\nYou can skip this change if u think is already well enough explicative ;)", "author": "zacanbrcom", "createdAt": "2020-09-29T10:40:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYwNjAwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYyNzgxMA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r496627810", "bodyText": "What about:\ndescribe(\"ParseLine() returns a RequestLine object or undefined in the following cases:\", () => {\n\nThe description shows that it will be a parametrized test.", "author": "grianbrcom", "createdAt": "2020-09-29T11:01:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYwNjAwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY0MTkxMg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r496641912", "bodyText": "YA! u got my point that way :)", "author": "zacanbrcom", "createdAt": "2020-09-29T11:28:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYwNjAwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYxMjUxNQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r496612515", "bodyText": "what about to collapse one level and put there the content of processDownloadError()?", "author": "zacanbrcom", "createdAt": "2020-09-29T10:32:36Z", "path": "clients/cobol-lsp-vscode-extension/src/services/copybook/CopybookDownloadService.ts", "diffHunk": "@@ -82,20 +100,28 @@ export class CopybookDownloadService implements vscode.Disposable {\n                     await this.handleQueue(element, errors, progress);\n \n                     if (this.queue.length === 0 && errors.size > 0) {\n-                        this.createErrorMessageForCopybooks(errors);\n+                        await CopybookDownloadService.createErrorMessageForCopybooks(errors);\n                         errors.clear();\n                     }\n \n                     if (this.queue.length === 0) {\n                         TelemetryService.registerEvent(\"Download copybooks from MF\", [\"copybook\", \"COBOL\", \"experiment-tag\"], \"total time to search copybooks on MF\", new Map().set(\"time elapsed\", TelemetryService.calculateTimeElapsed(startTime, Date.now())));\n-                        startTime = 0;\n+                        startTime = null;\n                     }\n                 });\n         }\n     }\n \n-    private createErrorMessageForCopybooks(datasets: Set<string>) {\n-        this.resolver.processDownloadError(PROCESS_DOWNLOAD_ERROR_MSG + Array.from(datasets));\n+    private static async createErrorMessageForCopybooks(datasets: Set<string>) {\n+        await CopybookDownloadService.processDownloadError(PROCESS_DOWNLOAD_ERROR_MSG + Array.from(datasets));", "originalCommit": "d7ac0e28720076a4701b623ce3d9bbdb2638541d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYyMjcyNQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/532#discussion_r496622725", "bodyText": "processDownloadError() is also used in fetchCopybook. So, I need to put a procedure content into two places.\nUnlike the showQueueLockedDialog function, which I use only once.", "author": "grianbrcom", "createdAt": "2020-09-29T10:51:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYxMjUxNQ=="}], "type": "inlineReview"}, {"oid": "eaab16ebe54664b2e3a00e9bcd168878095f2542", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/eaab16ebe54664b2e3a00e9bcd168878095f2542", "message": "feat: Lock copybook download queue in case of wrong MF credentials\n\nCloses #488\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>", "committedDate": "2020-09-29T12:38:42Z", "type": "commit"}, {"oid": "eaab16ebe54664b2e3a00e9bcd168878095f2542", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/eaab16ebe54664b2e3a00e9bcd168878095f2542", "message": "feat: Lock copybook download queue in case of wrong MF credentials\n\nCloses #488\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>", "committedDate": "2020-09-29T12:38:42Z", "type": "forcePushed"}]}