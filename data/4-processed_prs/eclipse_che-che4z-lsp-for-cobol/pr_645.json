{"pr_number": 645, "pr_title": "fix : [Experimental] LocalCopybookResolverTest fails randomly #626", "pr_createdAt": "2020-11-12T10:54:41Z", "pr_url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/645", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAxNjg2NA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/645#discussion_r522016864", "bodyText": "run coverage in band mode instead of running in parallel. Planning it to keep this flag for some time and observe the performance and the intermittent failing UI test.", "author": "ap891843", "createdAt": "2020-11-12T10:56:15Z", "path": "clients/cobol-lsp-vscode-extension/package.json", "diffHunk": "@@ -150,7 +150,7 @@\n         \"watch\": \"tsc -watch -p ./\",\n         \"postinstall\": \"node ./node_modules/vscode/bin/install\",\n         \"test\": \"jest -w 1 --unhandled-rejections=strict\",\n-        \"coverage\": \"jest --coverage\"\n+        \"coverage\": \"jest --coverage --runInBand\"", "originalCommit": "6e4664df453b099bbf3f9bfdd53c109d76214e2e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAxNzM0MQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/645#discussion_r522017341", "bodyText": "fix unhandledRejection cases.", "author": "ap891843", "createdAt": "2020-11-12T10:57:02Z", "path": "clients/cobol-lsp-vscode-extension/src/__tests__/ChangeDefaultZoweProfileTest.spec.ts", "diffHunk": "@@ -15,6 +15,8 @@\n import {changeDefaultZoweProfile} from \"../commands/ChangeDefaultZoweProfile\";\n import { ProfileService } from \"../services/ProfileService\";\n import {ZoweApi} from \"../services/ZoweApi\";\n+\n+jest.mock(\"../services/ProfileService\");", "originalCommit": "6e4664df453b099bbf3f9bfdd53c109d76214e2e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAxNzQxOA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/645#discussion_r522017418", "bodyText": "fix unhandledRejection cases.", "author": "ap891843", "createdAt": "2020-11-12T10:57:10Z", "path": "clients/cobol-lsp-vscode-extension/src/__tests__/CopybookDownloadServiceTest.spec.ts", "diffHunk": "@@ -54,6 +54,7 @@ beforeEach(() => {\n });\n \n jest.mock(\"../services/reporter/TelemetryService\");\n+jest.mock(\"../services/ProfileService\");", "originalCommit": "6e4664df453b099bbf3f9bfdd53c109d76214e2e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjEyMTYyOQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/645#discussion_r522121629", "bodyText": "Cool! It works for me.", "author": "grianbrcom", "createdAt": "2020-11-12T13:54:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAxNzQxOA=="}], "type": "inlineReview"}, {"oid": "7c9fa76f76c11e12ad8500154040fc70111ffd3c", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/7c9fa76f76c11e12ad8500154040fc70111ffd3c", "message": "fix : LocalCopybookResolverTest fails randomly #626\n\nSigned-off-by: ap891843 <aman.prashant@broadcom.com>", "committedDate": "2020-11-12T13:16:42Z", "type": "forcePushed"}, {"oid": "caf9d146e4faf5e91b6fa64e73ef4db21ca4654b", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/caf9d146e4faf5e91b6fa64e73ef4db21ca4654b", "message": "fix : LocalCopybookResolverTest fails randomly #626\n\nSigned-off-by: ap891843 <aman.prashant@broadcom.com>", "committedDate": "2020-11-12T14:21:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE3MDYzMQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/645#discussion_r522170631", "bodyText": "Why not to keep .not.toThrowError()?", "author": "grianbrcom", "createdAt": "2020-11-12T14:59:12Z", "path": "clients/cobol-lsp-vscode-extension/src/__tests__/LanguageClientServiceTest.spec.ts", "diffHunk": "@@ -51,29 +51,29 @@ const SERVER_ID = \"COBOL\";\n \n beforeEach(() => {\n     jest.clearAllMocks();\n-});\n-\n-describe(\"LanguageClientService negative scenario.\", () => {\n-\n-    test(\"LSP port not defined and jar path doesn't exists\", async () => {\n-        await expect(new LanguageClientService(undefined).checkPrerequisites())\n-        .rejects.toThrowError(\"LSP server for COBOL not found\");\n-}, 10000);\n+    vscode.workspace.getConfiguration(expect.any(String)).get = jest.fn().mockReturnValue(0);\n });\n \n const SERVER_STARTED_MSG = \"server started\";\n const SERVER_STOPPED_MSG = \"server stopped\";\n describe(\"LanguageClientService positive scenario\", () => {\n-\n     beforeEach(() => {\n-        jest.clearAllMocks();\n         languageClientService = new LanguageClientService(middleware);\n         new JavaCheck().isJavaInstalled = jest.fn().mockResolvedValue(true);\n+        vscode.workspace.getConfiguration(expect.any(String)).get = jest.fn().mockReturnValue(0);\n         fs.existsSync = jest.fn().mockReturnValue(true);\n     });\n \n     test(\"Test LanguageClientService checkPrerequisites passes\", async () => {\n-        expect(async () => await languageClientService.checkPrerequisites()).not.toThrowError();\n+        let message = false;\n+        fs.existsSync = jest.fn().mockReturnValue(true);\n+        vscode.workspace.getConfiguration(expect.any(String)).get = jest.fn().mockReturnValue(9999);\n+        try {\n+            await languageClientService.checkPrerequisites();\n+        } catch (error) {\n+            message = error;\n+        }\n+        expect(message).toBeFalsy();", "originalCommit": "caf9d146e4faf5e91b6fa64e73ef4db21ca4654b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE5ODQ4MQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/645#discussion_r522198481", "bodyText": "yes, that was the previous implementation.\nawait expect(languageClientService.checkPrerequisites()).not.toThrowError(); should work.\nBut was failing on my machine.  So I took a long route to resolve everything at code and use jest to assert.\nNo clue why. \ud83e\udd15", "author": "ap891843", "createdAt": "2020-11-12T15:35:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE3MDYzMQ=="}], "type": "inlineReview"}, {"oid": "c9eb63ea6b98d1a8c35fd2aaf6f56349882ab179", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/c9eb63ea6b98d1a8c35fd2aaf6f56349882ab179", "message": "test : LocalCopybookResolverTest fails randomly #626\n\nSigned-off-by: ap891843 <aman.prashant@broadcom.com>", "committedDate": "2020-11-12T15:36:20Z", "type": "commit"}, {"oid": "c9eb63ea6b98d1a8c35fd2aaf6f56349882ab179", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/c9eb63ea6b98d1a8c35fd2aaf6f56349882ab179", "message": "test : LocalCopybookResolverTest fails randomly #626\n\nSigned-off-by: ap891843 <aman.prashant@broadcom.com>", "committedDate": "2020-11-12T15:36:20Z", "type": "forcePushed"}]}