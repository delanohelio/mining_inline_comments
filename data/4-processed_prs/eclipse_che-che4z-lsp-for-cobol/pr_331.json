{"pr_number": 331, "pr_title": "fix: Create a .gitignore file if it doesn't exist #329", "pr_createdAt": "2020-05-04T15:11:00Z", "pr_url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/331", "timeline": [{"oid": "40ca9f7f3c445df894fbe7f050c45064580a310a", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/40ca9f7f3c445df894fbe7f050c45064580a310a", "message": "fix: Create a .gitignore file if it doesn't exist #329\n\nSigned-off-by: as892333 <azat.satklichov@broadcom.com>", "committedDate": "2020-05-04T15:02:59Z", "type": "commit"}, {"oid": "606b8d2d5528b61e0d82b7a40ba0631ba7686164", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/606b8d2d5528b61e0d82b7a40ba0631ba7686164", "message": "revert changes\n\nSigned-off-by: as892333 <azat.satklichov@broadcom.com>", "committedDate": "2020-05-04T16:03:57Z", "type": "commit"}, {"oid": "b7b73fb7aa26dcb56224034fa70e80de9e908bfb", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/b7b73fb7aa26dcb56224034fa70e80de9e908bfb", "message": "Merge branch 'development' into create-gitignore-file-if-not-exists", "committedDate": "2020-05-14T09:45:28Z", "type": "commit"}, {"oid": "8dcdbfffd494bdcb71dae71d9bcb62d9e431a1c2", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/8dcdbfffd494bdcb71dae71d9bcb62d9e431a1c2", "message": "re-organize with .c4z folder and create .gitignore\n\nSigned-off-by: as892333 <azat.satklichov@broadcom.com>", "committedDate": "2020-05-22T14:13:53Z", "type": "commit"}, {"oid": "c0061956b975d4042f2d599ff902d158db64c3c9", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/c0061956b975d4042f2d599ff902d158db64c3c9", "message": "Merge branch 'development' into create-gitignore-file-if-not-exists\n\n# Conflicts:\n#\tclients/cobol-lsp-vscode-extension/src/services/CopybooksDownloader.ts", "committedDate": "2020-05-22T15:22:34Z", "type": "commit"}, {"oid": "1ee9409194bacfa933a513351d12c2be1afdc31e", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/1ee9409194bacfa933a513351d12c2be1afdc31e", "message": "\"typo\"\n\nSigned-off-by: as892333 <azat.satklichov@broadcom.com>", "committedDate": "2020-05-22T15:27:37Z", "type": "commit"}, {"oid": "4924b731d2c1d4c6608a290057948c10f7e8938a", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/4924b731d2c1d4c6608a290057948c10f7e8938a", "message": "\"fix: re-organize with .c4z folder and create .gitignore #331\"\n\nSigned-off-by: Azat Satklichov <azat.satklichov@broadcom.com>", "committedDate": "2020-05-25T11:55:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk4MTA1OA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/331#discussion_r429981058", "bodyText": "@ishche should it be here, what do you think? As well as package-lock.json changes?", "author": "temanbrcom", "createdAt": "2020-05-25T15:05:28Z", "path": "clients/cobol-lsp-vscode-extension/package.json", "diffHunk": "@@ -114,7 +114,7 @@\n         \"test\": \"jest -w 1\"\n     },\n     \"dependencies\": {\n-        \"@zowe/imperative\": \"^4.4.5\",", "originalCommit": "4924b731d2c1d4c6608a290057948c10f7e8938a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAwMTQ0NA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/331#discussion_r430001444", "bodyText": "Too keep version fixed, otherwise needs another TPSR", "author": "asatklichov", "createdAt": "2020-05-25T15:57:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk4MTA1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAwMjA4NQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/331#discussion_r430002085", "bodyText": "Is not clear for me why it was removed from the package json..", "author": "zacanbrcom", "createdAt": "2020-05-25T15:59:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk4MTA1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAwMzI5OQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/331#discussion_r430003299", "bodyText": "@zacanbrcom  Not removed, just fixed version used,  \"@zowe/imperative\": \"4.4.5\" because of TPSR", "author": "asatklichov", "createdAt": "2020-05-25T16:03:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk4MTA1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIwMzIwNw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/331#discussion_r430203207", "bodyText": "Got it! TY", "author": "zacanbrcom", "createdAt": "2020-05-26T07:17:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk4MTA1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk4NTk3OA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/331#discussion_r429985978", "bodyText": "This logging pattern doesn't meet the requirements because it should have a descriptive error message and the caught throwable.\nIt may be like: log.error(\"Error creating parent directories for path\", e);", "author": "temanbrcom", "createdAt": "2020-05-25T15:16:58Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/utils/FileSystemUtils.java", "diffHunk": "@@ -165,6 +192,21 @@ public Path getPath(@Nonnull String basePath, @Nonnull String... more) {\n         .collect(Collectors.toList());\n   }\n \n+  /**\n+   * Creates a directory by creating all nonexistent parent directories first.\n+   *\n+   * @param path\n+   * @return\n+   */\n+  public Path createFolders(Path path) {\n+    try {\n+      return Files.createDirectories(path);\n+    } catch (IOException e) {\n+      log.error(e.getMessage());", "originalCommit": "4924b731d2c1d4c6608a290057948c10f7e8938a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk4NjQ2Ng==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/331#discussion_r429986466", "bodyText": "Good idea to refactor it like that!", "author": "temanbrcom", "createdAt": "2020-05-25T15:18:07Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/utils/FileSystemUtils.java", "diffHunk": "@@ -150,6 +157,26 @@ public Path getPath(@Nonnull String basePath, @Nonnull String... more) {\n     return Paths.get(basePath, more);\n   }\n \n+  /**\n+   * Returns full path for copybook folder which is inside .ch4z folder\n+   *\n+   * @param workspacePath\n+   * @return - full path\n+   */\n+  public Path getCopybookFolderPath(String workspacePath) {\n+    return getPath(workspacePath, C4Z_FOLDER, COPYBOOKS_FOLDER);\n+  }\n+\n+  /**\n+   * Returns full path for cobdeps folder which is inside .ch4z folder\n+   *\n+   * @param workspacePath\n+   * @return - full path\n+   */\n+  public Path getCobolDependencyFolderPath(String workspacePath) {\n+    return getPath(workspacePath, C4Z_FOLDER, COBDEPS_FOLDER);", "originalCommit": "4924b731d2c1d4c6608a290057948c10f7e8938a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk4NzU2Mg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/331#discussion_r429987562", "bodyText": "I would prefer to have these and following cosmetic changes (i.e. typos, documentation etc.) as a part of a separate PR with tag #23", "author": "temanbrcom", "createdAt": "2020-05-25T15:20:53Z", "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/test/java/com/ca/lsp/core/cobol/AbstractCobolLinePreprocessorTest.java", "diffHunk": "@@ -15,14 +15,15 @@\n \n import com.ca.lsp.core.cobol.model.ResultWithErrors;\n import com.ca.lsp.core.cobol.preprocessor.sub.CobolLine;\n+import com.ca.lsp.core.cobol.preprocessor.sub.line.reader.CobolLineReader;\n import com.ca.lsp.core.cobol.preprocessor.sub.line.reader.impl.CobolLineReaderImpl;\n \n import java.util.List;\n \n public abstract class AbstractCobolLinePreprocessorTest {\n \n   protected ResultWithErrors<List<CobolLine>> processText(String text) {\n-    CobolLineReaderImpl reader = new CobolLineReaderImpl();", "originalCommit": "4924b731d2c1d4c6608a290057948c10f7e8938a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIzNTQ1MA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/331#discussion_r430235450", "bodyText": "findFiles uses a global pattern as argument. It's not OS specific AFAIK.", "author": "ishche", "createdAt": "2020-05-26T08:16:44Z", "path": "clients/cobol-lsp-vscode-extension/src/services/CopybooksDownloader.ts", "diffHunk": "@@ -33,7 +34,7 @@ export class CopybooksDownloader implements vscode.Disposable {\n         private pathGenerator: CopybooksPathGenerator) { }\n \n     public async redownloadDependencies(message: string = \"Redownload dependencies requested.\") {\n-        (await vscode.workspace.findFiles(DEPENDENCIES_FOLDER + \"/**/*.dep\")).forEach(dep => {\n+        (await vscode.workspace.findFiles(path.join(C4Z_FOLDER, DEPENDENCIES_FOLDER) + \"/**/*.dep\")).forEach(dep => {", "originalCommit": "4924b731d2c1d4c6608a290057948c10f7e8938a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIzNzExMA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/331#discussion_r430237110", "bodyText": "vscode.workspace.workspaceFolders[0] can be undefine", "author": "ishche", "createdAt": "2020-05-26T08:19:42Z", "path": "clients/cobol-lsp-vscode-extension/src/services/Settings.ts", "diffHunk": "@@ -28,4 +30,33 @@ export function initializeSettings() {\n \n function isUndefinedInWorkspace(property: string, index: number, array: string[]): boolean {\n     return vscode.workspace.getConfiguration(SETTINGS_SECTION).inspect(property).workspaceValue == undefined;\n+}\n+\n+\n+/**\n+ * New file (e.g .gitignore) will be created or edited if exits, under project folder (e.g. workspace/.c4z) with given  pattern\n+ * \n+ * @param path \n+ * @param fileName \n+ * @param pattern \n+ */\n+export function createFileWithGivenPath(folderPath: string, fileName: string, pattern: string): void {\n+\n+    const ch4zPath = path.join(vscode.workspace.workspaceFolders[0].uri.fsPath, folderPath);", "originalCommit": "4924b731d2c1d4c6608a290057948c10f7e8938a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIzODg1Ng==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/331#discussion_r430238856", "bodyText": "Did you try the case if the user opens a new folder or change branch?", "author": "ishche", "createdAt": "2020-05-26T08:22:47Z", "path": "clients/cobol-lsp-vscode-extension/src/extension.ts", "diffHunk": "@@ -92,11 +93,14 @@ export async function activate(context: vscode.ExtensionContext) {\n             new CopybooksCodeActionProvider(profileService)));\n }\n \n-function initWorkspaceTracker(downloader: CopybooksDownloader): vscode.Disposable {\n+function initWorkspaceWatcher(downloader: CopybooksDownloader): vscode.Disposable {\n     const watcher = vscode.workspace.createFileSystemWatcher(\"**/\"\n-        + DEPENDENCIES_FOLDER + \"/**/**.dep\", false, false, true);\n+        + path.join(C4Z_FOLDER, DEPENDENCIES_FOLDER) + \"/**/**.dep\", false, false, true);\n     watcher.onDidCreate(uri => downloader.downloadDependencies(uri,\n         \"Program contains dependencies to missing copybooks.\"));\n     watcher.onDidChange(uri => downloader.downloadDependencies(uri));\n+\n+    //create .gitignore file within .c4z folder\n+    createFileWithGivenPath(C4Z_FOLDER, GITIGNORE_FILE, \"/**\");", "originalCommit": "4924b731d2c1d4c6608a290057948c10f7e8938a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI2ODMxMg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/331#discussion_r430268312", "bodyText": "Yes, for changing ws ok, and branch change has no impact, app works fine with old hierarchy", "author": "asatklichov", "createdAt": "2020-05-26T09:11:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIzODg1Ng=="}], "type": "inlineReview"}, {"oid": "4e8e8af521e7106c23074dc2acaa0b8888689165", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/4e8e8af521e7106c23074dc2acaa0b8888689165", "message": "fix: refactor on review #331\n\nSigned-off-by: Azat Satklichov <azat.satklichov@broadcom.com>", "committedDate": "2020-05-26T09:03:10Z", "type": "commit"}, {"oid": "e08b6304dc09c03df6d26a86f98c42e5975ae333", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/e08b6304dc09c03df6d26a86f98c42e5975ae333", "message": "Update package-lock", "committedDate": "2020-05-26T10:12:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDMyMDA1Mw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/331#discussion_r430320053", "bodyText": "In this case, it won't print the stack trace of the exception. To do that, you may use the method Logger#error(String, Throwable)", "author": "temanbrcom", "createdAt": "2020-05-26T10:43:24Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/utils/FileSystemUtils.java", "diffHunk": "@@ -202,7 +202,7 @@ public Path createFolders(Path path) {\n     try {\n       return Files.createDirectories(path);\n     } catch (IOException e) {\n-      log.error(e.getMessage());\n+      log.error(\"Error creating folders for \"+ path + \": \" + e);", "originalCommit": "4e8e8af521e7106c23074dc2acaa0b8888689165", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ac65f46cecd95fd256269ba04b1c09d437cab95e", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/ac65f46cecd95fd256269ba04b1c09d437cab95e", "message": "fix: update activation event #331\n\nSigned-off-by: Azat Satklichov <azat.satklichov@broadcom.com>", "committedDate": "2020-05-26T10:44:01Z", "type": "commit"}, {"oid": "d830593b24e719ebea04987353deddcd0a30a573", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/d830593b24e719ebea04987353deddcd0a30a573", "message": "fix: err-log #331\n\nSigned-off-by: Azat Satklichov <azat.satklichov@broadcom.com>", "committedDate": "2020-05-26T10:51:24Z", "type": "commit"}]}