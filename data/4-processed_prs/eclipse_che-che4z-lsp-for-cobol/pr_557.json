{"pr_number": 557, "pr_title": "Implementation for folder-based positive tests registry ", "pr_createdAt": "2020-10-14T16:00:10Z", "pr_url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557", "timeline": [{"oid": "c7f3b3292e98f8f02337cef9f744e40677bf00f8", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/c7f3b3292e98f8f02337cef9f744e40677bf00f8", "message": "Implement folder baset test registry\n\nSigned-off-by Leonid Baranov <leonid.baranov@broadcom.com>", "committedDate": "2020-10-14T16:38:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDgyMDg4NQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r504820885", "bodyText": "Please, provide the Javadoc for this class", "author": "temanbrcom", "createdAt": "2020-10-14T16:39:37Z", "path": "server/src/test/java/com/broadcom/lsp/cobol/positive/CobolTextHelper.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package com.broadcom.lsp.cobol.positive;\n+\n+import lombok.experimental.UtilityClass;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+\n+@Slf4j\n+@UtilityClass\n+public class CobolTextHelper {", "originalCommit": "c7f3b3292e98f8f02337cef9f744e40677bf00f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDgyMzE3Ng==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r504823176", "bodyText": "COBOL files don't necessarily have extensions, so it may cause wrong behavior in some cases.", "author": "temanbrcom", "createdAt": "2020-10-14T16:43:20Z", "path": "server/src/test/java/com/broadcom/lsp/cobol/positive/FolderTextRegistry.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package com.broadcom.lsp.cobol.positive;\n+\n+import com.google.common.collect.ArrayListMultimap;\n+import com.google.common.collect.ListMultimap;\n+import com.google.inject.Inject;\n+import com.google.inject.Singleton;\n+import com.google.inject.name.Named;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.lang3.StringUtils;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/** Registry for Cobol source code files. */\n+@Slf4j\n+@Singleton\n+public class FolderTextRegistry implements CobolTextRegistry {\n+\n+    private static final String POSITIVE_ENTRY = \"positive\";\n+    private static final String NEGATIVE_ENTRY = \"negative\";\n+    private static final String COPYBOOK_ENTRY = \"copybooks\";\n+\n+    private final ListMultimap<String, CobolText> texts = ArrayListMultimap.create();\n+\n+    @Inject\n+    public FolderTextRegistry(@Named(\"filesToTestPath\") String pathToTestResources) {\n+        if (StringUtils.isNotEmpty(pathToTestResources)) {\n+            try {\n+                collectFilesToTest(pathToTestResources);\n+            } catch (IOException e) {\n+                LOG.error(e.getMessage());\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public List<CobolText> getPositives() {\n+        return Collections.unmodifiableList(texts.get(POSITIVE_ENTRY));\n+    }\n+\n+    @Override\n+    public List<CobolText> getNegatives() {\n+        return Collections.unmodifiableList(texts.get(NEGATIVE_ENTRY));\n+    }\n+\n+    @Override\n+    public List<CobolText> getCopybooks() {\n+        return Collections.unmodifiableList(texts.get(COPYBOOK_ENTRY));\n+    }\n+\n+    private void collectFilesToTest(String folderPath) throws IOException {\n+        Files.walk(Paths.get(folderPath))\n+                .filter(Files::isRegularFile)\n+                .forEach(this::processFile);\n+    }\n+\n+    private void processFile(Path path) {\n+        String[] parts = path.toString().split(\"/\");\n+        if (parts.length < 2) {\n+            return;\n+        }\n+\n+        String name = parts[parts.length - 1];\n+        String folder = parts[parts.length - 2];", "originalCommit": "c7f3b3292e98f8f02337cef9f744e40677bf00f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTM2MDM4MA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r505360380", "bodyText": "Can you clarify?\nWe have a path like user/folder/filename the last part will be a filename (no matter if it has an extension or not)\nAnd the previous will be a folder name that will be mapped to one of 3 types.", "author": "Nurkambay", "createdAt": "2020-10-15T08:49:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDgyMzE3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTM4MDM1NQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r505380355", "bodyText": "Yes, you're right, I just misunderstood the code", "author": "temanbrcom", "createdAt": "2020-10-15T09:09:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDgyMzE3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg1MTYyNw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r504851627", "bodyText": "I hope that you can use this line here:\nfullText = IOUtils.toString(stream, StandardCharsets.UTF_8.name());\n\nWe already have Apache IO library in our project.", "author": "grianbrcom", "createdAt": "2020-10-14T17:30:34Z", "path": "server/src/test/java/com/broadcom/lsp/cobol/positive/CobolTextHelper.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package com.broadcom.lsp.cobol.positive;\n+\n+import lombok.experimental.UtilityClass;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+\n+@Slf4j\n+@UtilityClass\n+public class CobolTextHelper {\n+    public CobolText fromStream(String name, InputStream stream) {\n+        String fullText = null;\n+        try {\n+            BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(stream));\n+            StringBuilder builder = new StringBuilder();\n+\n+            for (String line = bufferedReader.readLine();\n+                 line != null;\n+                 line = bufferedReader.readLine()) {\n+                builder.append(line).append(\"\\r\\n\");\n+            }\n+            fullText = builder.toString();", "originalCommit": "c7f3b3292e98f8f02337cef9f744e40677bf00f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg1NTY4NQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r504855685", "bodyText": "If we don't plan to use a zip file as a registry, we can delete the entire ZipTextRegistry class and CobolTextHelper.\nIn case we work only with a folder registry, we can read a file via Files.readString(path) in FolderTextRegistry::processFile, no needs to touch InputStream at all.", "author": "grianbrcom", "createdAt": "2020-10-14T17:37:26Z", "path": "server/src/test/java/com/broadcom/lsp/cobol/TestModule.java", "diffHunk": "@@ -61,7 +62,7 @@ protected void configure() {\n     bind(CopybookService.class).to(CopybookServiceImpl.class);\n     bind(Communications.class).to(ServerCommunications.class);\n     bind(TextDocumentService.class).to(CobolTextDocumentService.class);\n-    bind(CobolTextRegistry.class).to(ZipTextRegistry.class);\n+    bind(CobolTextRegistry.class).to(FolderTextRegistry.class);", "originalCommit": "c7f3b3292e98f8f02337cef9f744e40677bf00f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTMxMTM3Mg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r505311372", "bodyText": "Actually, I don't know do we need to have the ability to use ZipTextRegistry. In that case, maybe it is better to be able to detect by path what registry needs to be used here.", "author": "Nurkambay", "createdAt": "2020-10-15T08:07:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg1NTY4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTMyMjA5Mw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r505322093", "bodyText": "We don't need the ZipTextRegistry anymore, so you may remove this class. Also, seems like we don't need this binding - we do not inject this object anywhere", "author": "temanbrcom", "createdAt": "2020-10-15T08:16:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg1NTY4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTMyODMwOA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r505328308", "bodyText": "Got it", "author": "Nurkambay", "createdAt": "2020-10-15T08:22:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg1NTY4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTMxNTk1OA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r505315958", "bodyText": "As I see, for error case, it is still returning the object, and once used below no validation there. Better return Optional object and check ifPresent..", "author": "asatklichov", "createdAt": "2020-10-15T08:11:19Z", "path": "server/src/test/java/com/broadcom/lsp/cobol/positive/CobolTextHelper.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package com.broadcom.lsp.cobol.positive;\n+\n+import lombok.experimental.UtilityClass;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+\n+@Slf4j\n+@UtilityClass\n+public class CobolTextHelper {\n+    public CobolText fromStream(String name, InputStream stream) {\n+        String fullText = null;\n+        try {\n+            BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(stream));\n+            StringBuilder builder = new StringBuilder();\n+\n+            for (String line = bufferedReader.readLine();\n+                 line != null;\n+                 line = bufferedReader.readLine()) {\n+                builder.append(line).append(\"\\r\\n\");\n+            }\n+            fullText = builder.toString();\n+        } catch (IOException e) {\n+            LOG.error(e.getMessage());", "originalCommit": "c7f3b3292e98f8f02337cef9f744e40677bf00f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTMyNzY5Mw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r505327693", "bodyText": "I have just moved this code from one class to another, but I agree it can be re-implemented better \ud83d\udc4d", "author": "Nurkambay", "createdAt": "2020-10-15T08:21:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTMxNTk1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTMxNjUzNw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r505316537", "bodyText": "Regarding to above check here only ifPresent needed", "author": "asatklichov", "createdAt": "2020-10-15T08:11:56Z", "path": "server/src/test/java/com/broadcom/lsp/cobol/positive/FolderTextRegistry.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package com.broadcom.lsp.cobol.positive;\n+\n+import com.google.common.collect.ArrayListMultimap;\n+import com.google.common.collect.ListMultimap;\n+import com.google.inject.Inject;\n+import com.google.inject.Singleton;\n+import com.google.inject.name.Named;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.lang3.StringUtils;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/** Registry for Cobol source code files. */\n+@Slf4j\n+@Singleton\n+public class FolderTextRegistry implements CobolTextRegistry {\n+\n+    private static final String POSITIVE_ENTRY = \"positive\";\n+    private static final String NEGATIVE_ENTRY = \"negative\";\n+    private static final String COPYBOOK_ENTRY = \"copybooks\";\n+\n+    private final ListMultimap<String, CobolText> texts = ArrayListMultimap.create();\n+\n+    @Inject\n+    public FolderTextRegistry(@Named(\"filesToTestPath\") String pathToTestResources) {\n+        if (StringUtils.isNotEmpty(pathToTestResources)) {\n+            try {\n+                collectFilesToTest(pathToTestResources);\n+            } catch (IOException e) {\n+                LOG.error(e.getMessage());\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public List<CobolText> getPositives() {\n+        return Collections.unmodifiableList(texts.get(POSITIVE_ENTRY));\n+    }\n+\n+    @Override\n+    public List<CobolText> getNegatives() {\n+        return Collections.unmodifiableList(texts.get(NEGATIVE_ENTRY));\n+    }\n+\n+    @Override\n+    public List<CobolText> getCopybooks() {\n+        return Collections.unmodifiableList(texts.get(COPYBOOK_ENTRY));\n+    }\n+\n+    private void collectFilesToTest(String folderPath) throws IOException {\n+        Files.walk(Paths.get(folderPath))\n+                .filter(Files::isRegularFile)\n+                .forEach(this::processFile);\n+    }\n+\n+    private void processFile(Path path) {\n+        String[] parts = path.toString().split(\"/\");\n+        if (parts.length < 2) {\n+            return;\n+        }\n+\n+        String name = parts[parts.length - 1];\n+        String folder = parts[parts.length - 2];\n+\n+        try (InputStream stream = Files.newInputStream(path)) {\n+            CobolText loadCobolText = CobolTextHelper.fromStream(name, stream);", "originalCommit": "c7f3b3292e98f8f02337cef9f744e40677bf00f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4374bdd9b57c6b03487f91358c9efa8a36a0e632", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/4374bdd9b57c6b03487f91358c9efa8a36a0e632", "message": "refactor: Positive tests registry", "committedDate": "2020-10-15T08:52:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTMyMzE3Nw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r505323177", "bodyText": "There is a new StringJoiner if you like to try here", "author": "asatklichov", "createdAt": "2020-10-15T08:17:35Z", "path": "server/src/test/java/com/broadcom/lsp/cobol/positive/CobolTextHelper.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package com.broadcom.lsp.cobol.positive;\n+\n+import lombok.experimental.UtilityClass;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+\n+@Slf4j\n+@UtilityClass\n+public class CobolTextHelper {\n+    public CobolText fromStream(String name, InputStream stream) {\n+        String fullText = null;\n+        try {\n+            BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(stream));\n+            StringBuilder builder = new StringBuilder();", "originalCommit": "c7f3b3292e98f8f02337cef9f744e40677bf00f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTM3NzM5Nw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r505377397", "bodyText": "Not needed anymore.", "author": "Nurkambay", "createdAt": "2020-10-15T09:05:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTMyMzE3Nw=="}], "type": "inlineReview"}, {"oid": "327d4a95fe233b1df314a51d9e00ec63edacced9", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/327d4a95fe233b1df314a51d9e00ec63edacced9", "message": "refactor: Folder-based Positive Test Registry\n\nAuthor: Leonid Baranov <leonid.baranov@broadcom.com>", "committedDate": "2020-10-15T09:03:37Z", "type": "forcePushed"}, {"oid": "ac16a2f9cbb0aa13bb1f7707661d74938080b56e", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/ac16a2f9cbb0aa13bb1f7707661d74938080b56e", "message": "refactor: Folder-baset Positive Test Registry\n\nSigned-off by: Leonid Baranov <leonid.baranov@broadcom.com>", "committedDate": "2020-10-15T09:09:07Z", "type": "forcePushed"}, {"oid": "b10a3fb737b4eeb702f15041874ab355d1b53da6", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/b10a3fb737b4eeb702f15041874ab355d1b53da6", "message": "Folder-based Positive Test Registry\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>", "committedDate": "2020-10-15T09:11:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTM4NzYwMw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r505387603", "bodyText": "I just noticed that this class is not used in the dependency injection, so it would be better to remove these @Inject and @Named", "author": "temanbrcom", "createdAt": "2020-10-15T09:18:49Z", "path": "server/src/test/java/com/broadcom/lsp/cobol/positive/FolderTextRegistry.java", "diffHunk": "@@ -0,0 +1,77 @@\n+package com.broadcom.lsp.cobol.positive;\n+\n+import com.google.common.collect.ArrayListMultimap;\n+import com.google.common.collect.ListMultimap;\n+import com.google.inject.Inject;\n+import com.google.inject.Singleton;\n+import com.google.inject.name.Named;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.lang3.StringUtils;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/** Registry for Cobol source code files. */\n+@Slf4j\n+@Singleton\n+public class FolderTextRegistry implements CobolTextRegistry {\n+\n+    private static final String POSITIVE_ENTRY = \"positive\";\n+    private static final String NEGATIVE_ENTRY = \"negative\";\n+    private static final String COPYBOOK_ENTRY = \"copybooks\";\n+\n+    private final ListMultimap<String, CobolText> texts = ArrayListMultimap.create();\n+\n+    @Inject", "originalCommit": "b10a3fb737b4eeb702f15041874ab355d1b53da6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTM5Mjk5Mw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r505392993", "bodyText": "Agree", "author": "Nurkambay", "createdAt": "2020-10-15T09:26:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTM4NzYwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTM5OTcxMw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r505399713", "bodyText": "In my case, the path contains the other slashes \\. I think this regex should match both cases", "author": "temanbrcom", "createdAt": "2020-10-15T09:35:09Z", "path": "server/src/test/java/com/broadcom/lsp/cobol/positive/FolderTextRegistry.java", "diffHunk": "@@ -0,0 +1,77 @@\n+package com.broadcom.lsp.cobol.positive;\n+\n+import com.google.common.collect.ArrayListMultimap;\n+import com.google.common.collect.ListMultimap;\n+import com.google.inject.Inject;\n+import com.google.inject.Singleton;\n+import com.google.inject.name.Named;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.lang3.StringUtils;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/** Registry for Cobol source code files. */\n+@Slf4j\n+@Singleton\n+public class FolderTextRegistry implements CobolTextRegistry {\n+\n+    private static final String POSITIVE_ENTRY = \"positive\";\n+    private static final String NEGATIVE_ENTRY = \"negative\";\n+    private static final String COPYBOOK_ENTRY = \"copybooks\";\n+\n+    private final ListMultimap<String, CobolText> texts = ArrayListMultimap.create();\n+\n+    @Inject\n+    public FolderTextRegistry(@Named(\"filesToTestPath\") String pathToTestResources) {\n+        if (StringUtils.isNotEmpty(pathToTestResources)) {\n+            try {\n+                collectFilesToTest(pathToTestResources);\n+            } catch (IOException e) {\n+                LOG.error(e.getMessage());\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public List<CobolText> getPositives() {\n+        return Collections.unmodifiableList(texts.get(POSITIVE_ENTRY));\n+    }\n+\n+    @Override\n+    public List<CobolText> getNegatives() {\n+        return Collections.unmodifiableList(texts.get(NEGATIVE_ENTRY));\n+    }\n+\n+    @Override\n+    public List<CobolText> getCopybooks() {\n+        return Collections.unmodifiableList(texts.get(COPYBOOK_ENTRY));\n+    }\n+\n+    private void collectFilesToTest(String folderPath) throws IOException {\n+        Files.walk(Paths.get(folderPath))\n+                .filter(Files::isRegularFile)\n+                .forEach(this::processFile);\n+    }\n+\n+    private void processFile(Path path) {\n+        String[] parts = path.toString().split(\"/\");", "originalCommit": "b10a3fb737b4eeb702f15041874ab355d1b53da6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1273d1a5ed14ec123faa5b0b514901d419f9e7b7", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/1273d1a5ed14ec123faa5b0b514901d419f9e7b7", "message": "Folder-based Positive Test Registry\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>", "committedDate": "2020-10-15T09:36:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQwNTgyMA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r505405820", "bodyText": "You should also check if the given folder name is allowed (i.e. positive, negative, or copybooks), or it will consume also git files.", "author": "temanbrcom", "createdAt": "2020-10-15T09:43:22Z", "path": "server/src/test/java/com/broadcom/lsp/cobol/positive/FolderTextRegistry.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.broadcom.lsp.cobol.positive;\n+\n+import com.google.common.collect.ArrayListMultimap;\n+import com.google.common.collect.ListMultimap;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.lang3.StringUtils;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/** Registry for Cobol source code files. */\n+@Slf4j\n+public class FolderTextRegistry implements CobolTextRegistry {\n+  private static final String POSITIVE_ENTRY = \"positive\";\n+  private static final String NEGATIVE_ENTRY = \"negative\";\n+  private static final String COPYBOOK_ENTRY = \"copybooks\";\n+\n+  private final ListMultimap<String, CobolText> texts = ArrayListMultimap.create();\n+\n+  public FolderTextRegistry(String pathToTestResources) {\n+    if (StringUtils.isNotEmpty(pathToTestResources)) {\n+        try {\n+            collectFilesToTest(pathToTestResources);\n+        } catch (IOException e) {\n+            LOG.error(e.getMessage());\n+        }\n+    }\n+  }\n+\n+  @Override\n+  public List<CobolText> getPositives() {\n+    return Collections.unmodifiableList(texts.get(POSITIVE_ENTRY));\n+  }\n+\n+  @Override\n+  public List<CobolText> getNegatives() {\n+        return Collections.unmodifiableList(texts.get(NEGATIVE_ENTRY));\n+    }\n+\n+  @Override\n+  public List<CobolText> getCopybooks() {\n+    return Collections.unmodifiableList(texts.get(COPYBOOK_ENTRY));\n+  }\n+\n+  private void collectFilesToTest(String folderPath) throws IOException {\n+    Files.walk(Paths.get(folderPath))\n+      .filter(Files::isRegularFile)\n+      .forEach(this::processFile);\n+  }\n+\n+  private void processFile(Path path) {\n+    String[] parts = path.toString().split(\"/\");\n+    if (parts.length < 2) {\n+      return;\n+    }\n+\n+    String name = parts[parts.length - 1];\n+    String folder = parts[parts.length - 2];", "originalCommit": "1273d1a5ed14ec123faa5b0b514901d419f9e7b7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQxMzUyOQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r505413529", "bodyText": "Done", "author": "Nurkambay", "createdAt": "2020-10-15T09:53:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQwNTgyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQwOTU1OQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r505409559", "bodyText": "Why do we need this restriction?\nIt matches folder/file.ext, and also matches file.ext. But in the last case we will have an error in line:\nString folder = parts[parts.length - 2];", "author": "grianbrcom", "createdAt": "2020-10-15T09:48:08Z", "path": "server/src/test/java/com/broadcom/lsp/cobol/positive/FolderTextRegistry.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.broadcom.lsp.cobol.positive;\n+\n+import com.google.common.collect.ArrayListMultimap;\n+import com.google.common.collect.ListMultimap;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.lang3.StringUtils;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/** Registry for Cobol source code files. */\n+@Slf4j\n+public class FolderTextRegistry implements CobolTextRegistry {\n+  private static final String POSITIVE_ENTRY = \"positive\";\n+  private static final String NEGATIVE_ENTRY = \"negative\";\n+  private static final String COPYBOOK_ENTRY = \"copybooks\";\n+\n+  private final ListMultimap<String, CobolText> texts = ArrayListMultimap.create();\n+\n+  public FolderTextRegistry(String pathToTestResources) {\n+    if (StringUtils.isNotEmpty(pathToTestResources)) {\n+        try {\n+            collectFilesToTest(pathToTestResources);\n+        } catch (IOException e) {\n+            LOG.error(e.getMessage());\n+        }\n+    }\n+  }\n+\n+  @Override\n+  public List<CobolText> getPositives() {\n+    return Collections.unmodifiableList(texts.get(POSITIVE_ENTRY));\n+  }\n+\n+  @Override\n+  public List<CobolText> getNegatives() {\n+        return Collections.unmodifiableList(texts.get(NEGATIVE_ENTRY));\n+    }\n+\n+  @Override\n+  public List<CobolText> getCopybooks() {\n+    return Collections.unmodifiableList(texts.get(COPYBOOK_ENTRY));\n+  }\n+\n+  private void collectFilesToTest(String folderPath) throws IOException {\n+    Files.walk(Paths.get(folderPath))\n+      .filter(Files::isRegularFile)\n+      .forEach(this::processFile);\n+  }\n+\n+  private void processFile(Path path) {\n+    String[] parts = path.toString().split(\"/\");\n+    if (parts.length < 2) {", "originalCommit": "1273d1a5ed14ec123faa5b0b514901d419f9e7b7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQxMDM4Mg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r505410382", "bodyText": "Could it be the following?\n    String name = path.getFileName().toString();\n    String folder = path.getParent().toString();", "author": "grianbrcom", "createdAt": "2020-10-15T09:49:12Z", "path": "server/src/test/java/com/broadcom/lsp/cobol/positive/FolderTextRegistry.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.broadcom.lsp.cobol.positive;\n+\n+import com.google.common.collect.ArrayListMultimap;\n+import com.google.common.collect.ListMultimap;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.lang3.StringUtils;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/** Registry for Cobol source code files. */\n+@Slf4j\n+public class FolderTextRegistry implements CobolTextRegistry {\n+  private static final String POSITIVE_ENTRY = \"positive\";\n+  private static final String NEGATIVE_ENTRY = \"negative\";\n+  private static final String COPYBOOK_ENTRY = \"copybooks\";\n+\n+  private final ListMultimap<String, CobolText> texts = ArrayListMultimap.create();\n+\n+  public FolderTextRegistry(String pathToTestResources) {\n+    if (StringUtils.isNotEmpty(pathToTestResources)) {\n+        try {\n+            collectFilesToTest(pathToTestResources);\n+        } catch (IOException e) {\n+            LOG.error(e.getMessage());\n+        }\n+    }\n+  }\n+\n+  @Override\n+  public List<CobolText> getPositives() {\n+    return Collections.unmodifiableList(texts.get(POSITIVE_ENTRY));\n+  }\n+\n+  @Override\n+  public List<CobolText> getNegatives() {\n+        return Collections.unmodifiableList(texts.get(NEGATIVE_ENTRY));\n+    }\n+\n+  @Override\n+  public List<CobolText> getCopybooks() {\n+    return Collections.unmodifiableList(texts.get(COPYBOOK_ENTRY));\n+  }\n+\n+  private void collectFilesToTest(String folderPath) throws IOException {\n+    Files.walk(Paths.get(folderPath))\n+      .filter(Files::isRegularFile)\n+      .forEach(this::processFile);\n+  }\n+\n+  private void processFile(Path path) {\n+    String[] parts = path.toString().split(\"/\");\n+    if (parts.length < 2) {\n+      return;\n+    }\n+\n+    String name = parts[parts.length - 1];\n+    String folder = parts[parts.length - 2];", "originalCommit": "1273d1a5ed14ec123faa5b0b514901d419f9e7b7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQxODU4OA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/557#discussion_r505418588", "bodyText": "I got the idea.\n    String name = path.getFileName().toString();\n    String folder = Optional.ofNullable(path.getParent())\n            .map(Path::getFileName)\n            .map(Path::toString)\n            .orElse(\"\");", "author": "Nurkambay", "createdAt": "2020-10-15T10:01:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQxMDM4Mg=="}], "type": "inlineReview"}, {"oid": "e31fb951d922fa81845a816fa77bb639d541dbae", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/e31fb951d922fa81845a816fa77bb639d541dbae", "message": "Folder-based Positive Test Registry\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>", "committedDate": "2020-10-15T09:53:35Z", "type": "forcePushed"}, {"oid": "c514c4c241e6e9a3b9634bd18f4b3bbdd71accbb", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/c514c4c241e6e9a3b9634bd18f4b3bbdd71accbb", "message": "Folder-based Positive Test Registry\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>", "committedDate": "2020-10-15T10:01:27Z", "type": "forcePushed"}, {"oid": "4b44db3cc10dee2baf3f961aa002f314f0cf5e84", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/4b44db3cc10dee2baf3f961aa002f314f0cf5e84", "message": "Folder-based Positive Test Registry\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>", "committedDate": "2020-10-15T10:10:50Z", "type": "forcePushed"}, {"oid": "3d3f591033aa2d2ac5b33d9d01deff86a6c86a1b", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/3d3f591033aa2d2ac5b33d9d01deff86a6c86a1b", "message": "refactor: Folder-based Positive Test Registry #556\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>", "committedDate": "2020-10-15T10:23:29Z", "type": "commit"}, {"oid": "3d3f591033aa2d2ac5b33d9d01deff86a6c86a1b", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/3d3f591033aa2d2ac5b33d9d01deff86a6c86a1b", "message": "refactor: Folder-based Positive Test Registry #556\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>", "committedDate": "2020-10-15T10:23:29Z", "type": "forcePushed"}]}