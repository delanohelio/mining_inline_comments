{"pr_number": 3501, "pr_title": "Update knob control", "pr_createdAt": "2020-09-21T09:13:48Z", "pr_url": "https://github.com/thingsboard/thingsboard/pull/3501", "timeline": [{"oid": "3b135a905fa4e129a084a751ec4928cf84095822", "url": "https://github.com/thingsboard/thingsboard/commit/3b135a905fa4e129a084a751ec4928cf84095822", "message": "Epdate knob control", "committedDate": "2020-09-21T08:49:43Z", "type": "commit"}, {"oid": "e0bc5e4a2bca0ae03dca969e630b84286750f25c", "url": "https://github.com/thingsboard/thingsboard/commit/e0bc5e4a2bca0ae03dca969e630b84286750f25c", "message": "Fix click function", "committedDate": "2020-09-21T09:16:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwMDQ2OA==", "url": "https://github.com/thingsboard/thingsboard/pull/3501#discussion_r492200468", "bodyText": "These imports don't use", "author": "vvlladd28", "createdAt": "2020-09-21T16:40:59Z", "path": "ui-ngx/src/app/modules/home/components/widget/lib/rpc/knob.component.ts", "diffHunk": "@@ -25,6 +25,8 @@ import { CanvasDigitalGauge, CanvasDigitalGaugeOptions } from '@home/components/\n import * as tinycolor_ from 'tinycolor2';\n import { ResizeObserver } from '@juggle/resize-observer';\n import GenericOptions = CanvasGauges.GenericOptions;\n+import {number} from \"prop-types\";\n+import {eventTargetLegacyPatch} from \"zone.js/lib/browser/event-target-legacy\";", "originalCommit": "e0bc5e4a2bca0ae03dca969e630b84286750f25c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIxMTQ5MA==", "url": "https://github.com/thingsboard/thingsboard/pull/3501#discussion_r492211490", "bodyText": "Please formatting this code", "author": "vvlladd28", "createdAt": "2020-09-21T16:59:41Z", "path": "ui-ngx/src/app/modules/home/components/widget/lib/rpc/knob.component.ts", "diffHunk": "@@ -166,43 +170,52 @@ export class KnobComponent extends PageComponent implements OnInit, OnDestroy {\n \n     this.canvasBar = new CanvasDigitalGauge(canvasBarData).draw();\n \n-    this.knob.on('click', (e) => {\n-      if (this.moving) {\n-        this.moving = false;\n-        return false;\n-      }\n-      e.preventDefault();\n \n-      const offset = this.knob.offset();\n-      const center = {\n-        y : offset.top + this.knob.height()/2,\n-        x: offset.left + this.knob.width()/2\n-      };\n-      const rad2deg = 180/Math.PI;\n-      const t: Touch = ((e.originalEvent as any).touches) ? (e.originalEvent as any).touches[0] : e;\n \n-      const a = center.y - t.pageY;\n-      const b = center.x - t.pageX;\n-      let deg = Math.atan2(a,b)*rad2deg;\n-      if(deg < 0){\n-        deg = 360 + deg;\n-      }\n-      if (deg > this.maxDeg) {\n-        if (deg - 360 > this.minDeg) {\n-          deg = deg - 360;\n-        } else {\n+    this.knob.on('click', (e) => {\n+        if (this.moving) {\n+          this.moving = false;\n           return false;\n         }\n+        e.preventDefault();\n+\n+        const offset = this.knob.offset();\n+        const center = {\n+          y: offset.top + this.knob.height() / 2,\n+          x: offset.left + this.knob.width() / 2\n+        };\n+        const rad2deg = 180 / Math.PI;\n+        const t: Touch = ((e.originalEvent as any).touches) ? (e.originalEvent as any).touches[0] : e;\n+        const a = center.y - t.pageY;\n+        const b = center.x - t.pageX;\n+        let deg = Math.atan2(a, b) * rad2deg;\n+        if (deg < 0) {\n+          deg = 360 + deg;\n+        }\n+        if (deg > this.maxDeg) {\n+          if (deg - 360 > this.minDeg) {\n+            deg = deg - 360;\n+          } else {\n+            return false;\n+          }\n+        }\n+        this.currentDeg = deg;\n+        this.lastDeg = deg;\n+        this.knobTopPointerContainer.css('transform', 'rotate(' + (this.currentDeg) + 'deg)');\n+        this.turn(this.degreeToRatio(this.currentDeg));\n+        this.rotation = this.currentDeg;\n+        this.startDeg = -1;\n+        this.rpcUpdateValue(this.newValue);\n+    });\n+\n+    $(document).on('mouseup touchend', (e) => {\n+      if(this.newValue !== this.rpcValue && this.moving) {\n+        this.rpcUpdateValue(this.newValue);\n       }\n-      this.currentDeg = deg;\n-      this.lastDeg = deg;\n-      this.knobTopPointerContainer.css('transform','rotate('+(this.currentDeg)+'deg)');\n-      this.turn(this.degreeToRatio(this.currentDeg));\n-      this.rotation = this.currentDeg;\n-      this.startDeg = -1;\n     });", "originalCommit": "e0bc5e4a2bca0ae03dca969e630b84286750f25c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIxMjc0NQ==", "url": "https://github.com/thingsboard/thingsboard/pull/3501#discussion_r492212745", "bodyText": "You may need to move this code to this.knob.on('mousedown touchstart'", "author": "vvlladd28", "createdAt": "2020-09-21T17:01:44Z", "path": "ui-ngx/src/app/modules/home/components/widget/lib/rpc/knob.component.ts", "diffHunk": "@@ -166,43 +170,52 @@ export class KnobComponent extends PageComponent implements OnInit, OnDestroy {\n \n     this.canvasBar = new CanvasDigitalGauge(canvasBarData).draw();\n \n-    this.knob.on('click', (e) => {\n-      if (this.moving) {\n-        this.moving = false;\n-        return false;\n-      }\n-      e.preventDefault();\n \n-      const offset = this.knob.offset();\n-      const center = {\n-        y : offset.top + this.knob.height()/2,\n-        x: offset.left + this.knob.width()/2\n-      };\n-      const rad2deg = 180/Math.PI;\n-      const t: Touch = ((e.originalEvent as any).touches) ? (e.originalEvent as any).touches[0] : e;\n \n-      const a = center.y - t.pageY;\n-      const b = center.x - t.pageX;\n-      let deg = Math.atan2(a,b)*rad2deg;\n-      if(deg < 0){\n-        deg = 360 + deg;\n-      }\n-      if (deg > this.maxDeg) {\n-        if (deg - 360 > this.minDeg) {\n-          deg = deg - 360;\n-        } else {\n+    this.knob.on('click', (e) => {\n+        if (this.moving) {\n+          this.moving = false;\n           return false;\n         }\n+        e.preventDefault();\n+\n+        const offset = this.knob.offset();\n+        const center = {\n+          y: offset.top + this.knob.height() / 2,\n+          x: offset.left + this.knob.width() / 2\n+        };\n+        const rad2deg = 180 / Math.PI;\n+        const t: Touch = ((e.originalEvent as any).touches) ? (e.originalEvent as any).touches[0] : e;\n+        const a = center.y - t.pageY;\n+        const b = center.x - t.pageX;\n+        let deg = Math.atan2(a, b) * rad2deg;\n+        if (deg < 0) {\n+          deg = 360 + deg;\n+        }\n+        if (deg > this.maxDeg) {\n+          if (deg - 360 > this.minDeg) {\n+            deg = deg - 360;\n+          } else {\n+            return false;\n+          }\n+        }\n+        this.currentDeg = deg;\n+        this.lastDeg = deg;\n+        this.knobTopPointerContainer.css('transform', 'rotate(' + (this.currentDeg) + 'deg)');\n+        this.turn(this.degreeToRatio(this.currentDeg));\n+        this.rotation = this.currentDeg;\n+        this.startDeg = -1;\n+        this.rpcUpdateValue(this.newValue);\n+    });\n+\n+    $(document).on('mouseup touchend', (e) => {\n+      if(this.newValue !== this.rpcValue && this.moving) {\n+        this.rpcUpdateValue(this.newValue);", "originalCommit": "e0bc5e4a2bca0ae03dca969e630b84286750f25c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2b915936487771186da1e3d4ecba3d3a7d091898", "url": "https://github.com/thingsboard/thingsboard/commit/2b915936487771186da1e3d4ecba3d3a7d091898", "message": "Refactoring", "committedDate": "2020-09-22T09:32:14Z", "type": "commit"}, {"oid": "bf386c7a790b85fdcbf8ae67521d8925d5c41d85", "url": "https://github.com/thingsboard/thingsboard/commit/bf386c7a790b85fdcbf8ae67521d8925d5c41d85", "message": "Formatting", "committedDate": "2020-09-22T09:45:11Z", "type": "commit"}, {"oid": "a90fbdd5abd7347568fc8882995b637b96533095", "url": "https://github.com/thingsboard/thingsboard/commit/a90fbdd5abd7347568fc8882995b637b96533095", "message": "Change 'mouseup'", "committedDate": "2020-09-22T11:28:37Z", "type": "commit"}]}