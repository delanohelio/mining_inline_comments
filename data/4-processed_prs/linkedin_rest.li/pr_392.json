{"pr_number": 392, "pr_title": "Adding ability to let users determine if a request should be dispatched to dark clusters", "pr_createdAt": "2020-08-20T19:39:28Z", "pr_url": "https://github.com/linkedin/rest.li/pull/392", "timeline": [{"oid": "1ef412f3c11400c3529d744a289eaf450a2da519", "url": "https://github.com/linkedin/rest.li/commit/1ef412f3c11400c3529d744a289eaf450a2da519", "message": "[darkcluster] Adding identical traffic multiplier strategy", "committedDate": "2020-07-30T21:19:20Z", "type": "commit"}, {"oid": "ee09c898fb75b9cfb3e7e2a0e061b69fc222465c", "url": "https://github.com/linkedin/rest.li/commit/ee09c898fb75b9cfb3e7e2a0e061b69fc222465c", "message": "[darkcluster] Adding identical traffic multiplier strategy", "committedDate": "2020-07-31T01:32:25Z", "type": "commit"}, {"oid": "0fe84dba85315eebaa989fd306766499e86911d1", "url": "https://github.com/linkedin/rest.li/commit/0fe84dba85315eebaa989fd306766499e86911d1", "message": "Add gradle property to skip generateRestModel task (#362)", "committedDate": "2020-08-04T17:21:10Z", "type": "commit"}, {"oid": "9916eab00528bf26af5e84c660b59c69eca91c97", "url": "https://github.com/linkedin/rest.li/commit/9916eab00528bf26af5e84c660b59c69eca91c97", "message": "Implement support for always projecting fields by name. (#358)\n\n* Release 29.4.7", "committedDate": "2020-08-04T17:23:08Z", "type": "commit"}, {"oid": "3f3559a3f61d657a5e0c43e9b16d92f8729a1816", "url": "https://github.com/linkedin/rest.li/commit/3f3559a3f61d657a5e0c43e9b16d92f8729a1816", "message": "[darkcluster] Adding identical traffic multiplier strategy", "committedDate": "2020-08-04T17:24:19Z", "type": "commit"}, {"oid": "090f1a9d810a3830c080454a3e0679aafa9618a6", "url": "https://github.com/linkedin/rest.li/commit/090f1a9d810a3830c080454a3e0679aafa9618a6", "message": "[darkcluster] Adding identical traffic multiplier strategy", "committedDate": "2020-08-04T17:24:20Z", "type": "commit"}, {"oid": "901639b8d7689081f4b846fad4cca3b1169b49aa", "url": "https://github.com/linkedin/rest.li/commit/901639b8d7689081f4b846fad4cca3b1169b49aa", "message": "Merge remote-tracking branch 'upstream/master' into master", "committedDate": "2020-08-04T17:30:13Z", "type": "commit"}, {"oid": "ac220fac4a770d80a82262d068694eb9de03ea0e", "url": "https://github.com/linkedin/rest.li/commit/ac220fac4a770d80a82262d068694eb9de03ea0e", "message": "Merge remote-tracking branch 'upstream/master' into master", "committedDate": "2020-08-04T17:38:42Z", "type": "commit"}, {"oid": "40b11c3f232affd887d9a0d569d0b8c7f776703b", "url": "https://github.com/linkedin/rest.li/commit/40b11c3f232affd887d9a0d569d0b8c7f776703b", "message": "Merge branch 'master' of github.com:srikrish-19/rest.li into master", "committedDate": "2020-08-04T17:44:04Z", "type": "commit"}, {"oid": "4e48e44c9f91bad387d4015710168692110fd25b", "url": "https://github.com/linkedin/rest.li/commit/4e48e44c9f91bad387d4015710168692110fd25b", "message": "Merge branch 'master' of github.com:srikrish-19/rest.li into master", "committedDate": "2020-08-04T18:17:29Z", "type": "commit"}, {"oid": "9cc3957d0d6d8100cdb4c57d9a3a4c5ea8fe8e79", "url": "https://github.com/linkedin/rest.li/commit/9cc3957d0d6d8100cdb4c57d9a3a4c5ea8fe8e79", "message": "darkcluster - identical traffic multiplier: Adding the formula for avg # of dark requests", "committedDate": "2020-08-04T18:17:39Z", "type": "commit"}, {"oid": "478fa28e9a7acdc45c314e26fd751d614aad0eab", "url": "https://github.com/linkedin/rest.li/commit/478fa28e9a7acdc45c314e26fd751d614aad0eab", "message": "Merge branch 'master' of github.com:srikrish-19/rest.li into master", "committedDate": "2020-08-04T18:18:37Z", "type": "commit"}, {"oid": "d60568b5a6d391cdf1fcec170de90951e8eaf263", "url": "https://github.com/linkedin/rest.li/commit/d60568b5a6d391cdf1fcec170de90951e8eaf263", "message": "updating changelog", "committedDate": "2020-08-04T21:30:20Z", "type": "commit"}, {"oid": "96a843e233e6479da2b7d9ac3d5ee628f7027b9a", "url": "https://github.com/linkedin/rest.li/commit/96a843e233e6479da2b7d9ac3d5ee628f7027b9a", "message": "Merge remote-tracking branch 'upstream/master' into master", "committedDate": "2020-08-07T18:41:09Z", "type": "commit"}, {"oid": "23ab8d1e639966f926fc42ec138c872a4590ba44", "url": "https://github.com/linkedin/rest.li/commit/23ab8d1e639966f926fc42ec138c872a4590ba44", "message": "Merge remote-tracking branch 'upstream/master' into master", "committedDate": "2020-08-20T17:59:59Z", "type": "commit"}, {"oid": "fe25d7edd334e783f377a260353c9fd8884dc05c", "url": "https://github.com/linkedin/rest.li/commit/fe25d7edd334e783f377a260353c9fd8884dc05c", "message": "Adding ability to let users determine if a request should be dispatched to dark clusters", "committedDate": "2020-08-20T19:20:01Z", "type": "commit"}, {"oid": "7e8a0fb518c32a56354ff100cf9e01345ceb64ae", "url": "https://github.com/linkedin/rest.li/commit/7e8a0fb518c32a56354ff100cf9e01345ceb64ae", "message": "adding some documentation", "committedDate": "2020-08-20T19:29:36Z", "type": "commit"}, {"oid": "3d9d91cc81cfba7ade08afa8d42ad2992abde6ca", "url": "https://github.com/linkedin/rest.li/commit/3d9d91cc81cfba7ade08afa8d42ad2992abde6ca", "message": "Updating changelog", "committedDate": "2020-08-20T19:34:29Z", "type": "commit"}, {"oid": "b862a5d635bf16266893973d68cdfa4fb8308960", "url": "https://github.com/linkedin/rest.li/commit/b862a5d635bf16266893973d68cdfa4fb8308960", "message": "moving interface to api package", "committedDate": "2020-08-20T19:36:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIzMDM1Nw==", "url": "https://github.com/linkedin/rest.li/pull/392#discussion_r474230357", "bodyText": "this name can be confused with the other Verifier ... and you can't tell what's what when configuring config properties. What about DarkCustomGatekeeper? DarkGatekeeper?", "author": "davidhoa", "createdAt": "2020-08-20T19:41:38Z", "path": "darkcluster/src/main/java/com/linkedin/darkcluster/api/DarkDispatcherVerifier.java", "diffHunk": "@@ -0,0 +1,20 @@\n+package com.linkedin.darkcluster.api;\n+\n+import com.linkedin.r2.message.RequestContext;\n+import com.linkedin.r2.message.rest.RestRequest;\n+\n+\n+/**\n+ * Interface that lets users define custom logic to determine if a given request is to be dispatched to dark cluster or not.\n+ */\n+@FunctionalInterface\n+public interface DarkDispatcherVerifier", "originalCommit": "b862a5d635bf16266893973d68cdfa4fb8308960", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIzMzk2OA==", "url": "https://github.com/linkedin/rest.li/pull/392#discussion_r474233968", "bodyText": "Will call it DarkGateKeeper", "author": "srikrish-19", "createdAt": "2020-08-20T19:48:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIzMDM1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIzMjQ4Ng==", "url": "https://github.com/linkedin/rest.li/pull/392#discussion_r474232486", "bodyText": "lets  create a no op implementation and do the null check here, instead of on every request.", "author": "davidhoa", "createdAt": "2020-08-20T19:45:38Z", "path": "darkcluster/src/main/java/com/linkedin/darkcluster/impl/DarkClusterManagerImpl.java", "diffHunk": "@@ -54,19 +54,27 @@\n   private final Facilities _facilities;\n   private final String _sourceClusterName;\n   private final DarkClusterStrategyFactory _darkClusterStrategyFactory;\n+  private final DarkDispatcherVerifier _darkDispatcherVerifier;\n   private Map<String, AtomicReference<URIRewriter>> _uriRewriterMap;\n \n   public DarkClusterManagerImpl(@Nonnull String sourceClusterName, @Nonnull Facilities facilities,\n                                 @Nonnull DarkClusterStrategyFactory strategyFactory, String whiteListRegEx,\n                                 String blackListRegEx, @Nonnull Notifier notifier)\n   {\n+    this(sourceClusterName, facilities, strategyFactory, whiteListRegEx, blackListRegEx, notifier, null);\n+  }\n+\n+  public DarkClusterManagerImpl(@Nonnull String sourceClusterName, @Nonnull Facilities facilities,\n+      @Nonnull DarkClusterStrategyFactory strategyFactory, String whiteListRegEx,\n+      String blackListRegEx, @Nonnull Notifier notifier, DarkDispatcherVerifier darkDispatcherVerifier) {\n     _whiteListRegEx = whiteListRegEx == null ? null : Pattern.compile(whiteListRegEx);\n     _blackListRegEx = blackListRegEx == null ? null : Pattern.compile(blackListRegEx);\n     _notifier = notifier;\n     _facilities = facilities;\n     _sourceClusterName = sourceClusterName;\n     _darkClusterStrategyFactory = strategyFactory;\n     _uriRewriterMap = new HashMap<>();\n+    _darkDispatcherVerifier = darkDispatcherVerifier;", "originalCommit": "b862a5d635bf16266893973d68cdfa4fb8308960", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e2979ef6238f5884a2054c272984b79687aba790", "url": "https://github.com/linkedin/rest.li/commit/e2979ef6238f5884a2054c272984b79687aba790", "message": "Fixing dhoa's comments", "committedDate": "2020-08-20T19:53:10Z", "type": "commit"}, {"oid": "4957ee5bd9d84c12557f6f4dffa42c9541efca3e", "url": "https://github.com/linkedin/rest.li/commit/4957ee5bd9d84c12557f6f4dffa42c9541efca3e", "message": "Fixing changelog", "committedDate": "2020-08-20T20:01:31Z", "type": "commit"}]}