{"pr_number": 1850, "pr_title": "Phenotype Enum Standardization and Fully Implementing Vehicle, ProtoMech, and Naval Phenotypes", "pr_createdAt": "2020-07-09T15:52:42Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/1850", "timeline": [{"oid": "3213c3abfaaacfeb93b7b789f1cb75eac7c26beb", "url": "https://github.com/MegaMek/mekhq/commit/3213c3abfaaacfeb93b7b789f1cb75eac7c26beb", "message": "Creating initial Phenotype Enum", "committedDate": "2020-05-02T01:45:22Z", "type": "commit"}, {"oid": "8c6cb30ae150188472943570cff91d70d9356952", "url": "https://github.com/MegaMek/mekhq/commit/8c6cb30ae150188472943570cff91d70d9356952", "message": "Starting to Implement Phenotype Odds", "committedDate": "2020-05-02T01:45:46Z", "type": "commit"}, {"oid": "75710ee3339afda1bc3cb631ef1e744e305d6bd0", "url": "https://github.com/MegaMek/mekhq/commit/75710ee3339afda1bc3cb631ef1e744e305d6bd0", "message": "Continuing to implement bloodname and phenotype changes", "committedDate": "2020-05-02T13:53:30Z", "type": "commit"}, {"oid": "ffd88e8f7412313b8485e8b20db190a280b74c51", "url": "https://github.com/MegaMek/mekhq/commit/ffd88e8f7412313b8485e8b20db190a280b74c51", "message": "Finishing implementing Phenotype and Bloodname changes", "committedDate": "2020-05-02T15:10:07Z", "type": "commit"}, {"oid": "48e4ae272dbb2cbb0cc449e2c3af2e78314b579e", "url": "https://github.com/MegaMek/mekhq/commit/48e4ae272dbb2cbb0cc449e2c3af2e78314b579e", "message": "Fixing phenotype/bloodname issues", "committedDate": "2020-05-02T16:51:31Z", "type": "commit"}, {"oid": "7202d1629e21df4f241a1b18fd273c6fc48759fe", "url": "https://github.com/MegaMek/mekhq/commit/7202d1629e21df4f241a1b18fd273c6fc48759fe", "message": "Fixing selected faction not working properly", "committedDate": "2020-05-02T17:15:26Z", "type": "commit"}, {"oid": "cfbebbdf59fb5ebb738471d2ee92b6a70c11dd74", "url": "https://github.com/MegaMek/mekhq/commit/cfbebbdf59fb5ebb738471d2ee92b6a70c11dd74", "message": "Fixing merge conflicts", "committedDate": "2020-07-03T16:51:54Z", "type": "commit"}, {"oid": "85f442ba0d86ff076ecbea8d17e4d96e312e5272", "url": "https://github.com/MegaMek/mekhq/commit/85f442ba0d86ff076ecbea8d17e4d96e312e5272", "message": "Fixing merge conflicts", "committedDate": "2020-07-08T00:09:17Z", "type": "commit"}, {"oid": "c75169df9a0c9eee3797173f8c9ac4e2c5796f3e", "url": "https://github.com/MegaMek/mekhq/commit/c75169df9a0c9eee3797173f8c9ac4e2c5796f3e", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_Bloodnames", "committedDate": "2020-07-09T15:21:19Z", "type": "commit"}, {"oid": "e20b51c635e4ba58ecccafff1243ad819faab3ed", "url": "https://github.com/MegaMek/mekhq/commit/e20b51c635e4ba58ecccafff1243ad819faab3ed", "message": "Code cleanup from personal review", "committedDate": "2020-07-09T15:49:34Z", "type": "commit"}, {"oid": "695818813718934f2ebc9b724341b59f1afba80f", "url": "https://github.com/MegaMek/mekhq/commit/695818813718934f2ebc9b724341b59f1afba80f", "message": "Fixing merge conflicts", "committedDate": "2020-07-14T13:34:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE3OTQ5Mg==", "url": "https://github.com/MegaMek/mekhq/pull/1850#discussion_r456179492", "bodyText": "Let's leave this here. It is extremely useful for debugging, or if you want to generate some specific units.", "author": "NickAragua", "createdAt": "2020-07-17T02:12:56Z", "path": "MekHQ/src/mekhq/campaign/mission/AtBDynamicScenarioFactory.java", "diffHunk": "@@ -1301,66 +1318,6 @@ public static Entity createEntityWithCrew(String faction, int skill, Campaign ca\n         return en;\n     }\n \n-    /**\n-     * Generates a new Entity without using a RAT. Useful for \"persistent\" or fixed units.\n-     *\n-     * @param name            Full name (chassis + model) of the entity to generate.\n-     * @param fName            Faction code to use for crew name generation\n-     * @param skill            RandomSkillsGenerator.L_* constant for the average force skill level.\n-     * @param campaign\n-     * @return                A new Entity\n-     */\n-    @Deprecated //Deprecated 15-Feb-2020 as unused, needs the current name system to be implemented if activated\n-    private static Entity getEntityByName(String name, String fName, int skill, Campaign campaign) {", "originalCommit": "695818813718934f2ebc9b724341b59f1afba80f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgxNTg3NA==", "url": "https://github.com/MegaMek/mekhq/pull/1850#discussion_r456815874", "bodyText": "This will need to be modified then, as it doesn't work properly as it is currently because of personnel changes, and has not since February. If you want me to I can restore it and fix it?", "author": "Windchild292", "createdAt": "2020-07-18T18:33:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE3OTQ5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEzOTA3MQ==", "url": "https://github.com/MegaMek/mekhq/pull/1850#discussion_r458139071", "bodyText": "Refactored it down so that it just uses the createEntityWithCrew but first grabs the MechSummary. This keeps the current behaviour while being less code.", "author": "Windchild292", "createdAt": "2020-07-21T14:26:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE3OTQ5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE4MDAxMA==", "url": "https://github.com/MegaMek/mekhq/pull/1850#discussion_r456180010", "bodyText": "Let's go through this file and put some documentation on the methods.", "author": "NickAragua", "createdAt": "2020-07-17T02:15:06Z", "path": "MekHQ/src/mekhq/campaign/personnel/Clan.java", "diffHunk": "@@ -0,0 +1,293 @@\n+/*\n+ * Copyright (c) 2020 - The MegaMek Team. All Rights Reserved.\n+ * This file is part of MekHQ.\n+ *\n+ * MekHQ is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * MekHQ is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with MekHQ. If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package mekhq.campaign.personnel;\n+\n+import megamek.common.Compute;\n+import megamek.common.logging.LogLevel;\n+import megamek.common.util.StringUtil;\n+import mekhq.MekHQ;\n+import mekhq.MekHqXmlUtil;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.Element;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+\n+import javax.xml.parsers.DocumentBuilder;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.util.*;\n+\n+/**\n+ * This is used to supply clan data needed to generate bloodnames\n+ * TODO : This should probably be merged into Faction\n+ */\n+public class Clan {\n+    //region Variable Declarations\n+    private static Map<String, Clan> allClans;\n+\n+    private String code;\n+    private String generationCode; // this is used to enable RA name generation using CSR lists, for example\n+    private String fullName;\n+    private int startDate;\n+    private int endDate;\n+    private int abjurationDate;\n+    private List<DatedRecord> rivals;\n+    private List<DatedRecord> nameChanges;\n+    private boolean homeClan;\n+    //endregion Variable Declarations\n+\n+    public Clan() {\n+        startDate = 2807;\n+        endDate = 9999;\n+        abjurationDate = 0;\n+        rivals = new ArrayList<>();\n+        nameChanges = new ArrayList<>();\n+    }\n+\n+    @Override\n+    public boolean equals(Object o) {\n+        if (o instanceof Clan) {\n+            return code.equals(((Clan) o).code);\n+        } else if (o instanceof String) {\n+            return code.equals(o);\n+        } else {\n+            return false;\n+        }\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return Objects.hashCode(getCode());\n+    }\n+\n+    public static Clan getClan(String code) {\n+        return allClans.get(code);\n+    }\n+\n+    public static Collection<Clan> getClans() {\n+        return allClans.values();\n+    }\n+\n+    public String getCode() {\n+        return code;\n+    }\n+\n+    public String getGenerationCode() {", "originalCommit": "695818813718934f2ebc9b724341b59f1afba80f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE4MDA4NQ==", "url": "https://github.com/MegaMek/mekhq/pull/1850#discussion_r456180085", "bodyText": "At the very least the public ones.", "author": "NickAragua", "createdAt": "2020-07-17T02:15:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE4MDAxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE4MDQ0NQ==", "url": "https://github.com/MegaMek/mekhq/pull/1850#discussion_r456180445", "bodyText": "I wonder if anyone actually has saves from before 3.4. I would suggest moving this out into a separate method.", "author": "NickAragua", "createdAt": "2020-07-17T02:16:39Z", "path": "MekHQ/src/mekhq/campaign/personnel/Person.java", "diffHunk": "@@ -2156,6 +2109,36 @@ public static Person generateInstanceFromXML(Node wn, Campaign c, Version versio\n                 retVal.setExpectedDueDate(retVal.getDueDate());\n             }\n \n+            //versions before 0.3.4 did not have proper clan phenotypes\n+            if (version.isLowerThan(\"0.3.4\") && c.getFaction().isClan()) {", "originalCommit": "695818813718934f2ebc9b724341b59f1afba80f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQxMTQ2MA==", "url": "https://github.com/MegaMek/mekhq/pull/1850#discussion_r456411460", "bodyText": "Next part of my person changes following this and genealogy is going to be reworking the xml read/write into a simpler format. This will be part of doing so.", "author": "Windchild292", "createdAt": "2020-07-17T12:31:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE4MDQ0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcxMTIwOQ==", "url": "https://github.com/MegaMek/mekhq/pull/1850#discussion_r457711209", "bodyText": "Forgot to add to this: Should there be bonuses here for the other phenotypes?", "author": "Windchild292", "createdAt": "2020-07-20T21:49:11Z", "path": "MekHQ/src/mekhq/gui/dialog/CustomizePersonDialog.java", "diffHunk": "@@ -1315,36 +1295,39 @@ public int getAge() {\n     }\n \n     private void backgroundChanged() {\n-        int pheno = choicePheno.getSelectedIndex();\n         boolean clanner = chkClan.isSelected();\n         clearAllPhenotypeBonuses();\n         if (clanner) {\n-            switch(pheno) {\n-                case Person.PHENOTYPE_MW:\n-                    skillBonus.get(SkillType.S_GUN_MECH).setValue(1);\n-                    skillBonus.get(SkillType.S_PILOT_MECH).setValue(1);\n-                    break;\n-                case Person.PHENOTYPE_AERO:\n-                    skillBonus.get(SkillType.S_GUN_AERO).setValue(1);\n-                    skillBonus.get(SkillType.S_PILOT_AERO).setValue(1);\n-                    skillBonus.get(SkillType.S_GUN_JET).setValue(1);\n-                    skillBonus.get(SkillType.S_PILOT_JET).setValue(1);\n-                    skillBonus.get(SkillType.S_GUN_PROTO).setValue(1);\n-                    break;\n-                case Person.PHENOTYPE_BA:\n-                    skillBonus.get(SkillType.S_GUN_BA).setValue(1);\n-                    break;\n-                case Person.PHENOTYPE_VEE:\n-                    skillBonus.get(SkillType.S_GUN_VEE).setValue(1);\n-                    skillBonus.get(SkillType.S_PILOT_GVEE).setValue(1);\n-                    skillBonus.get(SkillType.S_PILOT_NVEE).setValue(1);\n-                    skillBonus.get(SkillType.S_PILOT_VTOL).setValue(1);\n-                    break;\n+            final Phenotype phenotype = (Phenotype) choicePhenotype.getSelectedItem();\n+            if (phenotype != null) {\n+                // TODO : Windchild should there be more bonus' here for the other phenotypes?\n+                switch (phenotype) {\n+                    case MECHWARRIOR:\n+                        skillBonus.get(SkillType.S_GUN_MECH).setValue(1);\n+                        skillBonus.get(SkillType.S_PILOT_MECH).setValue(1);\n+                        break;\n+                    case AEROSPACE:\n+                        skillBonus.get(SkillType.S_GUN_AERO).setValue(1);\n+                        skillBonus.get(SkillType.S_PILOT_AERO).setValue(1);\n+                        skillBonus.get(SkillType.S_GUN_JET).setValue(1);\n+                        skillBonus.get(SkillType.S_PILOT_JET).setValue(1);\n+                        skillBonus.get(SkillType.S_GUN_PROTO).setValue(1);\n+                        break;\n+                    case ELEMENTAL:\n+                        skillBonus.get(SkillType.S_GUN_BA).setValue(1);\n+                        break;\n+                    case VEHICLE:\n+                        skillBonus.get(SkillType.S_GUN_VEE).setValue(1);\n+                        skillBonus.get(SkillType.S_PILOT_GVEE).setValue(1);\n+                        skillBonus.get(SkillType.S_PILOT_NVEE).setValue(1);\n+                        skillBonus.get(SkillType.S_PILOT_VTOL).setValue(1);\n+                        break;\n+                }", "originalCommit": "695818813718934f2ebc9b724341b59f1afba80f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE0NTYxNA==", "url": "https://github.com/MegaMek/mekhq/pull/1850#discussion_r458145614", "bodyText": "I'm not familiar with the rules for it, so I can't say one way or the other. Shouldn't be too hard to implement if that's the case, though.", "author": "NickAragua", "createdAt": "2020-07-21T14:34:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcxMTIwOQ=="}], "type": "inlineReview"}, {"oid": "25e0be9f6ab8ebe3ad2dd49f1e8c2cf4b15ca460", "url": "https://github.com/MegaMek/mekhq/commit/25e0be9f6ab8ebe3ad2dd49f1e8c2cf4b15ca460", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_Bloodnames", "committedDate": "2020-07-20T21:50:56Z", "type": "commit"}, {"oid": "c773b6187f0903e4ba99c7e21acc0355684399eb", "url": "https://github.com/MegaMek/mekhq/commit/c773b6187f0903e4ba99c7e21acc0355684399eb", "message": "Readding and reworking getEntityByName as per review", "committedDate": "2020-07-21T14:26:49Z", "type": "commit"}, {"oid": "fd1b96050123fe669434f1f48a91120cc88dcc30", "url": "https://github.com/MegaMek/mekhq/commit/fd1b96050123fe669434f1f48a91120cc88dcc30", "message": "Reverting some autoformatting issues", "committedDate": "2020-07-21T14:36:15Z", "type": "commit"}, {"oid": "f9cd6266ca0b1054bc6fab7a6fa6bbb5ca08e953", "url": "https://github.com/MegaMek/mekhq/commit/f9cd6266ca0b1054bc6fab7a6fa6bbb5ca08e953", "message": "Adding comments to Clan.java", "committedDate": "2020-07-21T14:54:54Z", "type": "commit"}]}