{"pr_number": 1765, "pr_title": "1569/1570 Phase 1: Genealogy", "pr_createdAt": "2020-05-24T15:18:43Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/1765", "timeline": [{"oid": "19d4575ef09f32c733f303b882495dab5f084b5d", "url": "https://github.com/MegaMek/mekhq/commit/19d4575ef09f32c733f303b882495dab5f084b5d", "message": "Fixing localization name for left leg", "committedDate": "2020-04-09T17:07:44Z", "type": "commit"}, {"oid": "9aa8107f7467691c9dc3cea05a59d312c518c3cf", "url": "https://github.com/MegaMek/mekhq/commit/9aa8107f7467691c9dc3cea05a59d312c518c3cf", "message": "Fixing other localization", "committedDate": "2020-04-09T17:08:16Z", "type": "commit"}, {"oid": "ac1cfa1f795bfec514b19dd4f4cecded1968721d", "url": "https://github.com/MegaMek/mekhq/commit/ac1cfa1f795bfec514b19dd4f4cecded1968721d", "message": "Creating a FamilialRelationshipTypes Enum", "committedDate": "2020-04-09T17:09:05Z", "type": "commit"}, {"oid": "a032deb5752571572606226244450b5f43b6be6f", "url": "https://github.com/MegaMek/mekhq/commit/a032deb5752571572606226244450b5f43b6be6f", "message": "Renaming FamilyRelationshipTypes to FamilyRelationshipType", "committedDate": "2020-04-09T17:19:39Z", "type": "commit"}, {"oid": "c7fdc9943fffba42097267c580699d1b1f86d308", "url": "https://github.com/MegaMek/mekhq/commit/c7fdc9943fffba42097267c580699d1b1f86d308", "message": "Adding the Partner relationship type", "committedDate": "2020-04-09T19:24:18Z", "type": "commit"}, {"oid": "3a4b537297e0af5a086673bb193890a8bfd47645", "url": "https://github.com/MegaMek/mekhq/commit/3a4b537297e0af5a086673bb193890a8bfd47645", "message": "Creating FamilialConnectionType enum", "committedDate": "2020-04-09T19:40:27Z", "type": "commit"}, {"oid": "2fabe95766f4740631a83f1a2de87cf756f822e1", "url": "https://github.com/MegaMek/mekhq/commit/2fabe95766f4740631a83f1a2de87cf756f822e1", "message": "Adding support for late spouse prefix, widow, and divorced", "committedDate": "2020-04-10T14:15:09Z", "type": "commit"}, {"oid": "3af447989b8065bb61911215a0991180258c5516", "url": "https://github.com/MegaMek/mekhq/commit/3af447989b8065bb61911215a0991180258c5516", "message": "Adding a method to return the children of a person", "committedDate": "2020-04-10T14:15:36Z", "type": "commit"}, {"oid": "508ab58ff1ab324ac4dd91da4244288c36da81ac", "url": "https://github.com/MegaMek/mekhq/commit/508ab58ff1ab324ac4dd91da4244288c36da81ac", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_FamilyTree", "committedDate": "2020-04-11T00:11:55Z", "type": "commit"}, {"oid": "537fff64be7418bab2d03dbbd52e5e9b26366375", "url": "https://github.com/MegaMek/mekhq/commit/537fff64be7418bab2d03dbbd52e5e9b26366375", "message": "Adding Great-Grandaunt and Great-Granduncle", "committedDate": "2020-04-11T00:57:34Z", "type": "commit"}, {"oid": "4df5ec6f81bf578d503e599d5c9f19125b8ac077", "url": "https://github.com/MegaMek/mekhq/commit/4df5ec6f81bf578d503e599d5c9f19125b8ac077", "message": "Moving campaign to have babies generated in Person", "committedDate": "2020-04-11T01:49:09Z", "type": "commit"}, {"oid": "7b2680beee81001f3956e1a7d6b788a92b265cb3", "url": "https://github.com/MegaMek/mekhq/commit/7b2680beee81001f3956e1a7d6b788a92b265cb3", "message": "Adding TODO to fix the processNewDayPersonnel method in the future", "committedDate": "2020-04-11T01:50:15Z", "type": "commit"}, {"oid": "50181872cf047fce70c22dffedba051a2f89a700", "url": "https://github.com/MegaMek/mekhq/commit/50181872cf047fce70c22dffedba051a2f89a700", "message": "starting to tear out ancestors", "committedDate": "2020-04-12T13:19:58Z", "type": "commit"}, {"oid": "d1c03fdf377294a28123d160e760c364700762c7", "url": "https://github.com/MegaMek/mekhq/commit/d1c03fdf377294a28123d160e760c364700762c7", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_FamilyTree", "committedDate": "2020-04-15T12:41:51Z", "type": "commit"}, {"oid": "21dc859970db6762ac41871bdf7fbd9d0c4b8f58", "url": "https://github.com/MegaMek/mekhq/commit/21dc859970db6762ac41871bdf7fbd9d0c4b8f58", "message": "Adding half-siblings and a key list for any sibling enum values", "committedDate": "2020-04-15T17:13:32Z", "type": "commit"}, {"oid": "5271110632304a46a8394859cd61787cd2d2355d", "url": "https://github.com/MegaMek/mekhq/commit/5271110632304a46a8394859cd61787cd2d2355d", "message": "Tearing out ancestors - only migration left", "committedDate": "2020-04-15T19:59:08Z", "type": "commit"}, {"oid": "c3aa94ee5956fc30cc58e017cbfb6fb9fe31f514", "url": "https://github.com/MegaMek/mekhq/commit/c3aa94ee5956fc30cc58e017cbfb6fb9fe31f514", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_FamilyTree", "committedDate": "2020-04-20T14:05:46Z", "type": "commit"}, {"oid": "696658e759ee73ead088747572af69b55f77b219", "url": "https://github.com/MegaMek/mekhq/commit/696658e759ee73ead088747572af69b55f77b219", "message": "Removing unused import", "committedDate": "2020-04-20T14:08:43Z", "type": "commit"}, {"oid": "8e0d59bea0e1f54f939dcf5b1a552df8064b8c42", "url": "https://github.com/MegaMek/mekhq/commit/8e0d59bea0e1f54f939dcf5b1a552df8064b8c42", "message": "Fixing merge conflicts", "committedDate": "2020-05-08T14:27:14Z", "type": "commit"}, {"oid": "6b3b9e7c83a2e0aad9a7d955014c44103fd8aaaa", "url": "https://github.com/MegaMek/mekhq/commit/6b3b9e7c83a2e0aad9a7d955014c44103fd8aaaa", "message": "Fixing merge conflicts", "committedDate": "2020-05-08T18:28:21Z", "type": "commit"}, {"oid": "46ade18b381d68a4a2eea9d26a4e6ac9a3772c86", "url": "https://github.com/MegaMek/mekhq/commit/46ade18b381d68a4a2eea9d26a4e6ac9a3772c86", "message": "Removing TeamId as unused", "committedDate": "2020-05-08T18:37:29Z", "type": "commit"}, {"oid": "ff72209b797f911da2ae3ffe603491ed7f4cd878", "url": "https://github.com/MegaMek/mekhq/commit/ff72209b797f911da2ae3ffe603491ed7f4cd878", "message": "Moving any remaning ancestors usage to be based on an inline migration class in the campaign xml parser", "committedDate": "2020-05-08T19:57:57Z", "type": "commit"}, {"oid": "f18416f280b00112514f547775b4aff01dfb9f8e", "url": "https://github.com/MegaMek/mekhq/commit/f18416f280b00112514f547775b4aff01dfb9f8e", "message": "Moving all traces of Ancestors except one call to CampaignXmlParser", "committedDate": "2020-05-08T20:14:22Z", "type": "commit"}, {"oid": "69a5782d5c79ef7890ce6514550d80790c0b910c", "url": "https://github.com/MegaMek/mekhq/commit/69a5782d5c79ef7890ce6514550d80790c0b910c", "message": "adding initial migration for ancestry", "committedDate": "2020-05-08T21:56:41Z", "type": "commit"}, {"oid": "b954316280539f2a9d26f413dba60d864009d54a", "url": "https://github.com/MegaMek/mekhq/commit/b954316280539f2a9d26f413dba60d864009d54a", "message": "Finishing family migration, pre-testing", "committedDate": "2020-05-08T22:02:06Z", "type": "commit"}, {"oid": "2defe8c808b282b168d93550de3ef4e8f9d30a4f", "url": "https://github.com/MegaMek/mekhq/commit/2defe8c808b282b168d93550de3ef4e8f9d30a4f", "message": "Removing unused import", "committedDate": "2020-05-09T12:41:41Z", "type": "commit"}, {"oid": "7cdc538823f420f6f199400daa1e14d8ce497639", "url": "https://github.com/MegaMek/mekhq/commit/7cdc538823f420f6f199400daa1e14d8ce497639", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_FamilyTree", "committedDate": "2020-05-24T14:27:50Z", "type": "commit"}, {"oid": "25ee0bd2012966eeffd5e9107f66177eadae8d33", "url": "https://github.com/MegaMek/mekhq/commit/25ee0bd2012966eeffd5e9107f66177eadae8d33", "message": "Fixing genealogy bugs, part 1", "committedDate": "2020-05-24T14:36:46Z", "type": "commit"}, {"oid": "28fcf5c907d002a24654564ef93189e1839ad59c", "url": "https://github.com/MegaMek/mekhq/commit/28fcf5c907d002a24654564ef93189e1839ad59c", "message": "Removing two unused imports", "committedDate": "2020-05-24T15:25:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0OTY0MA==", "url": "https://github.com/MegaMek/mekhq/pull/1765#discussion_r429649640", "bodyText": "I think this is ripe for unit tests, along with removing relations to make sure the tree is pruned.", "author": "sixlettervariables", "createdAt": "2020-05-24T15:47:49Z", "path": "MekHQ/src/mekhq/campaign/personnel/familyTree/Genealogy.java", "diffHunk": "@@ -0,0 +1,504 @@\n+/*\n+ * Copyright (c) 2020 - The MegaMek Team. All Rights Reserved.\n+ *\n+ * This file is part of MekHQ.\n+ *\n+ * MekHQ is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * MekHQ is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with MekHQ.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package mekhq.campaign.personnel.familyTree;\n+\n+import megamek.common.Crew;\n+import megamek.common.annotations.Nullable;\n+import mekhq.MekHQ;\n+import mekhq.MekHqXmlSerializable;\n+import mekhq.MekHqXmlUtil;\n+import mekhq.campaign.Campaign;\n+import mekhq.campaign.personnel.FormerSpouse;\n+import mekhq.campaign.personnel.Person;\n+import mekhq.campaign.personnel.enums.FamilialRelationshipType;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+\n+import java.io.PrintWriter;\n+import java.io.Serializable;\n+import java.util.*;\n+\n+public class Genealogy implements Serializable, MekHqXmlSerializable {\n+    //region Variables\n+    private static final long serialVersionUID = -6350146649504329173L;\n+    private UUID spouse;\n+    private List<FormerSpouse> formerSpouses;\n+    private Map<FamilialRelationshipType, List<UUID>> family;\n+    //endregion Variables\n+\n+    //region Constructors\n+    public Genealogy() {\n+        this.spouse = null;\n+        this.formerSpouses = new ArrayList<>();\n+        this.family = new HashMap<>();\n+    }\n+    //endregion Constructors\n+\n+    //region Getters/Setters\n+    /**\n+     * @param campaign the campaign the person is in\n+     * @return the person's spouse, or null if they don't have a spouse\n+     */\n+    @Nullable\n+    public Person getSpouse(Campaign campaign) {\n+        return campaign.getPerson(getSpouseId());\n+    }\n+\n+    /**\n+     * @return the current person's spouse's id\n+     */\n+    @Nullable\n+    public UUID getSpouseId() {\n+        return spouse;\n+    }\n+\n+    /**\n+     * @param spouse the new spouse id for the current person\n+     */\n+    public void setSpouse(@Nullable UUID spouse) {\n+        this.spouse = spouse;\n+    }\n+\n+    /**\n+     * @return a list of FormerSpouse objects for all the former spouses of the current person\n+     */\n+    public List<FormerSpouse> getFormerSpouses() {\n+        return formerSpouses;\n+    }\n+\n+    /**\n+     * @param formerSpouse a former spouse to add the the current person's list\n+     */\n+    public void addFormerSpouse(FormerSpouse formerSpouse) {\n+        getFormerSpouses().add(formerSpouse);\n+    }\n+\n+    /**\n+     * This is implemented for future use, as it will be required for the family tree implementation\n+     * @param formerSpouse the former spouse to remove from the current person's list\n+     */\n+    public void removeFormerSpouse(FormerSpouse formerSpouse) {\n+        getFormerSpouses().remove(formerSpouse);\n+    }\n+\n+    /**\n+     * @return the family map for this person\n+     */\n+    public Map<FamilialRelationshipType, List<UUID>> getFamily() {\n+        return family;\n+    }\n+\n+    /**\n+     * This is used to add a new family member\n+     * @param relationshipType the relationship type between the two people\n+     * @param id the id of the person to add\n+     */\n+    public void addFamilyMember(FamilialRelationshipType relationshipType, UUID id) {\n+        if (id != null) {\n+            getFamily().putIfAbsent(relationshipType, new ArrayList<>());\n+            getFamily().get(relationshipType).add(id);\n+        }\n+    }\n+\n+    /**\n+     * This is implemented for future use, as it will be required for the family tree implementation\n+     * @param relationshipType the FamilialRelationshipType of the person to remove\n+     * @param id the id of the person to remove\n+     */\n+    public void removeFamilyMember(FamilialRelationshipType relationshipType, UUID id) {\n+        if (getFamily().get(relationshipType) == null) {\n+            MekHQ.getLogger().error(getClass(), \"removeFamilyMember\",\n+                    \"Could not remove unknown family member of relationship \"\n+                            + relationshipType.name() + \" and UUID \" + id.toString() + \".\");\n+            return;\n+        }\n+\n+        List<UUID> familyTypeMembers = getFamily().get(relationshipType);\n+        familyTypeMembers.remove(id);\n+        if (familyTypeMembers.isEmpty()) {\n+            getFamily().remove(relationshipType);\n+        }\n+    }\n+    //endregion Getters/Setters\n+\n+    //region Boolean Checks\n+    /**\n+     * @return true if the person has either a spouse, any children, or specified parents.\n+     *          These are required for any extended family to exist.\n+     */\n+    public boolean hasAnyFamily() {\n+        return hasChildren() || hasSpouse() || hasParents();\n+    }\n+\n+    /**\n+     * @return true if the person has a spouse, false otherwise\n+     */\n+    public boolean hasSpouse() {\n+        return (getSpouseId() != null);\n+    }\n+\n+    /**\n+     * @return true if the person has a former spouse, false otherwise\n+     */\n+    public boolean hasFormerSpouse() {\n+        return !getFormerSpouses().isEmpty();\n+    }\n+\n+    /**\n+     * @return true if the person has at least one kid, false otherwise\n+     */\n+    public boolean hasChildren() {\n+        return (getFamily().get(FamilialRelationshipType.CHILD) != null);\n+    }\n+\n+    /**\n+     * @return true if the Person has any parents, otherwise false\n+     */\n+    public boolean hasParents() {\n+        return (getFamily().get(FamilialRelationshipType.PARENT) != null);\n+    }\n+\n+    // Recursive Search Format to determine mutual ancestry\n+    public boolean checkMutualAncestors(Person person, Campaign campaign) {", "originalCommit": "28fcf5c907d002a24654564ef93189e1839ad59c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgwMTQxMA==", "url": "https://github.com/MegaMek/mekhq/pull/1765#discussion_r432801410", "bodyText": "And while you're at it, let's put some comments on these public methods, as I don't really have any idea what they do just looking at the name.", "author": "NickAragua", "createdAt": "2020-05-30T02:18:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0OTY0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgwMTA1MA==", "url": "https://github.com/MegaMek/mekhq/pull/1765#discussion_r432801050", "bodyText": "Let's put a comment on this public method.", "author": "NickAragua", "createdAt": "2020-05-30T02:13:02Z", "path": "MekHQ/src/mekhq/campaign/io/CampaignXmlParser.java", "diffHunk": "@@ -1901,4 +1861,72 @@ private static void updatePlanetaryEventsFromXML(Node wn) {\n             }\n         }\n     }\n+\n+\n+    //region Migration Methods\n+    //region Ancestry Migration\n+    private static Map<UUID, List<Person>> ancestryMigrationMap = new HashMap<>();\n+\n+    public static void addToAncestryMigrationMap(UUID ancestorsId, Person person) {", "originalCommit": "28fcf5c907d002a24654564ef93189e1839ad59c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgwMTMzMw==", "url": "https://github.com/MegaMek/mekhq/pull/1765#discussion_r432801333", "bodyText": "Seems like some comments would be helpful for this enum in general.", "author": "NickAragua", "createdAt": "2020-05-30T02:17:14Z", "path": "MekHQ/src/mekhq/campaign/personnel/enums/FamilialRelationshipType.java", "diffHunk": "@@ -0,0 +1,172 @@\n+/*\n+ * Copyright (c) 2020 - The MegaMek Team. All rights reserved.\n+ *\n+ * This file is part of MekHQ.\n+ *\n+ * MekHQ is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * MekHQ is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with MekHQ.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package mekhq.campaign.personnel.enums;\n+\n+import megamek.common.Crew;\n+import megamek.common.util.EncodeControl;\n+import mekhq.MekHQ;\n+import mekhq.campaign.personnel.Person;\n+\n+import java.util.ResourceBundle;\n+\n+public enum FamilialRelationshipType {", "originalCommit": "28fcf5c907d002a24654564ef93189e1839ad59c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c647251434126fff8795a67be5be87e3bc4ae637", "url": "https://github.com/MegaMek/mekhq/commit/c647251434126fff8795a67be5be87e3bc4ae637", "message": "Fixing merge conflicts", "committedDate": "2020-06-03T15:22:45Z", "type": "commit"}, {"oid": "0538fca197a55d02de8ff82b5f3c8b036dfb10c5", "url": "https://github.com/MegaMek/mekhq/commit/0538fca197a55d02de8ff82b5f3c8b036dfb10c5", "message": "Implementing JavaDoc comments as per review", "committedDate": "2020-06-03T16:31:09Z", "type": "commit"}, {"oid": "cb4244090e3b39e669d1c9e6ba78c83645ec26e8", "url": "https://github.com/MegaMek/mekhq/commit/cb4244090e3b39e669d1c9e6ba78c83645ec26e8", "message": "Fixing merge conflicts", "committedDate": "2020-06-25T13:18:38Z", "type": "commit"}, {"oid": "a9ec9d964ae836a79c03bf7a5d5601e7b3923a07", "url": "https://github.com/MegaMek/mekhq/commit/a9ec9d964ae836a79c03bf7a5d5601e7b3923a07", "message": "Switching Siblings to be determined based on parential children", "committedDate": "2020-06-25T14:09:19Z", "type": "commit"}, {"oid": "7d607c8b2ee508fe4aca9bba68df752f56e185cd", "url": "https://github.com/MegaMek/mekhq/commit/7d607c8b2ee508fe4aca9bba68df752f56e185cd", "message": "Removing outdated todo", "committedDate": "2020-06-25T14:12:28Z", "type": "commit"}, {"oid": "2eb5476f53ad9b5a77fdd8cc1cced44ce0762adf", "url": "https://github.com/MegaMek/mekhq/commit/2eb5476f53ad9b5a77fdd8cc1cced44ce0762adf", "message": "Fixing merge conflicts", "committedDate": "2020-07-13T13:56:54Z", "type": "commit"}, {"oid": "649749e7d148609d0bfda3ded9c5fcca178c445f", "url": "https://github.com/MegaMek/mekhq/commit/649749e7d148609d0bfda3ded9c5fcca178c445f", "message": "Fixing checkMutualAncestors and adding unit testing for it", "committedDate": "2020-07-13T15:38:23Z", "type": "commit"}, {"oid": "c24f2bcf98d10fa06e3e155975f294748627a622", "url": "https://github.com/MegaMek/mekhq/commit/c24f2bcf98d10fa06e3e155975f294748627a622", "message": "Adding heavy unit testing to Genealogy", "committedDate": "2020-07-13T16:11:48Z", "type": "commit"}, {"oid": "556ac7337d35bbd270ce06f048f7113a70212098", "url": "https://github.com/MegaMek/mekhq/commit/556ac7337d35bbd270ce06f048f7113a70212098", "message": "Adding missing comment", "committedDate": "2020-07-13T16:24:19Z", "type": "commit"}, {"oid": "8fa4ae36f44e0ba25cf3d9224ad71949cffd7307", "url": "https://github.com/MegaMek/mekhq/commit/8fa4ae36f44e0ba25cf3d9224ad71949cffd7307", "message": "Renaming option", "committedDate": "2020-07-13T16:39:53Z", "type": "commit"}, {"oid": "30bff3c3a028a821ef2d0f3543c30ce5297231c2", "url": "https://github.com/MegaMek/mekhq/commit/30bff3c3a028a821ef2d0f3543c30ce5297231c2", "message": "Fixing merge conflicts", "committedDate": "2020-07-14T13:37:37Z", "type": "commit"}, {"oid": "b7869cbdd0eea75574ed68493370d31d4f9d31d0", "url": "https://github.com/MegaMek/mekhq/commit/b7869cbdd0eea75574ed68493370d31d4f9d31d0", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_FamilyTree", "committedDate": "2020-07-23T15:47:44Z", "type": "commit"}, {"oid": "54e87d43ae962527b28e1879830c5dfd52ce5ea2", "url": "https://github.com/MegaMek/mekhq/commit/54e87d43ae962527b28e1879830c5dfd52ce5ea2", "message": "Fixing merge conflicts", "committedDate": "2020-07-26T14:49:40Z", "type": "commit"}]}