{"pr_number": 2102, "pr_title": "Cleaning up unit XML Write", "pr_createdAt": "2020-10-02T21:56:10Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/2102", "timeline": [{"oid": "fea9d4e67b60849ba4622a8e77fa750b33efa932", "url": "https://github.com/MegaMek/mekhq/commit/fea9d4e67b60849ba4622a8e77fa750b33efa932", "message": "Cleaning up unit XML Write", "committedDate": "2020-10-02T21:52:43Z", "type": "commit"}, {"oid": "39ecc0d467aebf54ae7ec2be703306aa5c48c328", "url": "https://github.com/MegaMek/mekhq/commit/39ecc0d467aebf54ae7ec2be703306aa5c48c328", "message": "Fixing trailing XML tag indent", "committedDate": "2020-10-02T21:55:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA4MTkyOA==", "url": "https://github.com/MegaMek/mekhq/pull/2102#discussion_r499081928", "bodyText": "Can this be null?", "author": "sixlettervariables", "createdAt": "2020-10-02T22:58:02Z", "path": "MekHQ/src/mekhq/campaign/unit/Unit.java", "diffHunk": "@@ -1675,135 +1678,141 @@ public Money getBuyCost() {\n     }\n \n     @Override\n-    public void writeToXml(PrintWriter pw1, int indentLvl) {\n-        pw1.println(MekHqXmlUtil.indentStr(indentLvl) + \"<unit id=\\\"\" + id.toString()\n+    public void writeToXml(PrintWriter pw1, int indent) {\n+        pw1.println(MekHqXmlUtil.indentStr(indent++) + \"<unit id=\\\"\" + id.toString()\n                 + \"\\\" type=\\\"\" + this.getClass().getName() + \"\\\">\");\n \n-        pw1.println(MekHqXmlUtil.writeEntityToXmlString(entity, indentLvl+1, getCampaign().getEntities()));\n+        pw1.println(MekHqXmlUtil.writeEntityToXmlString(entity, indent, getCampaign().getEntities()));\n         for (UUID did : drivers) {\n-            pw1.println(MekHqXmlUtil.indentStr(indentLvl + 1) + \"<driverId>\"\n-                    + did.toString() + \"</driverId>\");\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"driverId\", did);\n         }\n         for (UUID gid : gunners) {\n-            pw1.println(MekHqXmlUtil.indentStr(indentLvl + 1) + \"<gunnerId>\"\n-                    + gid.toString() + \"</gunnerId>\");\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"gunnerId\", gid);\n         }\n         for (UUID vid : vesselCrew) {\n-            pw1.println(MekHqXmlUtil.indentStr(indentLvl + 1) + \"<vesselCrewId>\"\n-                    + vid.toString() + \"</vesselCrewId>\");\n-        }\n-        if (null != navigator) {\n-            pw1.println(MekHqXmlUtil.indentStr(indentLvl+1)\n-                    +\"<navigatorId>\"\n-                    +navigator.toString()\n-                    +\"</navigatorId>\");\n-        }\n-        if (null != techOfficer) {\n-            pw1.println(MekHqXmlUtil.indentStr(indentLvl+1)\n-                    +\"<techOfficerId>\"\n-                    +techOfficer.toString()\n-                    +\"</techOfficerId>\");\n-        }\n-        if (null != tech) {\n-            pw1.println(MekHqXmlUtil.indentStr(indentLvl+1)\n-                    +\"<techId>\"\n-                    +tech.toString()\n-                    +\"</techId>\");\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"vesselCrewId\", vid);\n         }\n+        MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"navigatorId\", navigator);\n+        MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"techOfficerId\", techOfficer);\n+        MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"techId\", tech);\n+\n         // If this entity is assigned to a transport, write that\n         if (hasTransportShipId()) {\n             for (UUID id : getTransportShipId().keySet()) {\n-                pw1.println(MekHqXmlUtil.indentStr(indentLvl+1) + \"<transportShip id=\\\"\" + id.toString()\n+                pw1.println(MekHqXmlUtil.indentStr(indent) + \"<transportShip id=\\\"\" + id.toString()\n                         + \"\\\" baynumber=\\\"\" + getTransportShipId().get(id) + \"\\\"/>\");\n             }\n         }\n         for (UUID uid : getTransportedUnits()) {\n-            pw1.println(MekHqXmlUtil.indentStr(indentLvl + 1) + \"<transportedUnitId>\"\n-                    + uid.toString() + \"</transportedUnitId>\");\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"transportedUnitId\", uid);\n         }\n         //Used transport bay space\n-        if (getEntity() != null && !getEntity().getTransportBays().isEmpty()) {\n-            pw1.println(MekHqXmlUtil.indentStr(indentLvl + 1) + \"<asfCapacity>\"\n-                    + aeroCapacity + \"</asfCapacity>\");\n-            pw1.println(MekHqXmlUtil.indentStr(indentLvl + 1) + \"<baCapacity>\"\n-                    + baCapacity + \"</baCapacity>\");\n-            pw1.println(MekHqXmlUtil.indentStr(indentLvl + 1) + \"<dockCapacity>\"\n-                    + dockCapacity + \"</dockCapacity>\");\n-            pw1.println(MekHqXmlUtil.indentStr(indentLvl + 1) + \"<hVeeCapacity>\"\n-                    + hVeeCapacity + \"</hVeeCapacity>\");\n-            pw1.println(MekHqXmlUtil.indentStr(indentLvl + 1) + \"<infCapacity>\"\n-                    + infCapacity + \"</infCapacity>\");\n-            pw1.println(MekHqXmlUtil.indentStr(indentLvl + 1) + \"<lVeeCapacity>\"\n-                    + lVeeCapacity + \"</lVeeCapacity>\");\n-            pw1.println(MekHqXmlUtil.indentStr(indentLvl + 1) + \"<mechCapacity>\"\n-                    + mechCapacity + \"</mechCapacity>\");\n-            pw1.println(MekHqXmlUtil.indentStr(indentLvl + 1) + \"<protoCapacity>\"\n-                    + protoCapacity + \"</protoCapacity>\");\n-            pw1.println(MekHqXmlUtil.indentStr(indentLvl + 1) + \"<scCapacity>\"\n-                    + scCapacity + \"</scCapacity>\");\n-            pw1.println(MekHqXmlUtil.indentStr(indentLvl + 1) + \"<shVeeCapacity>\"\n-                    + shVeeCapacity + \"</shVeeCapacity>\");\n+        if ((getEntity() != null) && !getEntity().getTransportBays().isEmpty()) {\n+            if (aeroCapacity > 0) {\n+                MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"asfCapacity\", aeroCapacity);\n+            }\n+\n+            if (baCapacity > 0) {\n+                MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"baCapacity\", baCapacity);\n+            }\n+\n+            if (dockCapacity > 0) {\n+                MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"dockCapacity\", dockCapacity);\n+            }\n+\n+            if (hVeeCapacity > 0) {\n+                MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"hVeeCapacity\", hVeeCapacity);\n+            }\n+\n+            if (infCapacity > 0) {\n+                MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"infCapacity\", infCapacity);\n+            }\n+\n+            if (lVeeCapacity > 0) {\n+                MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"lVeeCapacity\", lVeeCapacity);\n+            }\n+\n+            if (mechCapacity > 0) {\n+                MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"mechCapacity\", mechCapacity);\n+            }\n+\n+            if (protoCapacity > 0) {\n+                MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"protoCapacity\", protoCapacity);\n+            }\n+\n+            if (scCapacity > 0) {\n+                MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"scCapacity\", scCapacity);\n+            }\n+\n+            if (shVeeCapacity > 0) {\n+                MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"shVeeCapacity\", shVeeCapacity);\n+            }\n         }\n         //Salvage status\n-        pw1.println(MekHqXmlUtil.indentStr(indentLvl + 1) + \"<salvaged>\"\n-                + salvaged + \"</salvaged>\");\n-        pw1.println(MekHqXmlUtil.indentStr(indentLvl + 1) + \"<site>\" + site\n-                + \"</site>\");\n-        pw1.println(MekHqXmlUtil.indentStr(indentLvl+1)\n-                +\"<forceId>\"\n-                +forceId\n-                +\"</forceId>\");\n-        pw1.println(MekHqXmlUtil.indentStr(indentLvl+1)\n-                +\"<scenarioId>\"\n-                +scenarioId\n-                +\"</scenarioId>\");\n-        pw1.println(MekHqXmlUtil.indentStr(indentLvl+1)\n-                +\"<daysToArrival>\"\n-                +daysToArrival\n-                +\"</daysToArrival>\");\n-        pw1.println(MekHqXmlUtil.indentStr(indentLvl+1)\n-                +\"<daysSinceMaintenance>\"\n-                +daysSinceMaintenance\n-                +\"</daysSinceMaintenance>\");\n-        pw1.println(MekHqXmlUtil.indentStr(indentLvl+1)\n-                +\"<daysActivelyMaintained>\"\n-                +daysActivelyMaintained\n-                +\"</daysActivelyMaintained>\");\n-        pw1.println(MekHqXmlUtil.indentStr(indentLvl+1)\n-                +\"<astechDaysMaintained>\"\n-                +astechDaysMaintained\n-                +\"</astechDaysMaintained>\");\n-        pw1.println(MekHqXmlUtil.indentStr(indentLvl+1)\n-                +\"<mothballTime>\"\n-                +mothballTime\n-                +\"</mothballTime>\");\n-        pw1.println(MekHqXmlUtil.indentStr(indentLvl+1)\n-                +\"<mothballed>\"\n-                +mothballed\n-                +\"</mothballed>\");\n-        pw1.println(MekHqXmlUtil.indentStr(indentLvl+1)\n-                +\"<fluffName>\"\n-                +MekHqXmlUtil.escape(fluffName)\n-                +\"</fluffName>\");\n-        pw1.println(MekHqXmlUtil.indentStr(indentLvl+1)\n-                +\"<history>\"\n-                +MekHqXmlUtil.escape(history)\n-                +\"</history>\");\n-        if (null != refit) {\n-            refit.writeToXml(pw1, indentLvl+1);\n+        if (salvaged) {\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"salvaged\", true);\n+        }\n+\n+        if (site != SITE_BAY) {\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"site\", site);\n+        }\n+\n+        if (forceId != Force.FORCE_NONE) {\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"forceId\", forceId);\n+        }\n+\n+        if (scenarioId != Scenario.S_DEFAULT_ID) {\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"scenarioId\", scenarioId);\n+        }\n+\n+        if (daysToArrival > 0) {\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"daysToArrival\", daysToArrival);\n+        }\n+\n+        if (daysSinceMaintenance > 0) {\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"daysSinceMaintenance\", daysSinceMaintenance);\n+        }\n+\n+        if (daysActivelyMaintained > 0) {\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"daysActivelyMaintained\", daysActivelyMaintained);\n+        }\n+\n+        if (astechDaysMaintained > 0) {\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"astechDaysMaintained\", astechDaysMaintained);\n+        }\n+\n+        if (mothballTime > 0) {\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"mothballTime\", mothballTime);\n+        }\n+\n+        if (mothballed) {\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"mothballed\", true);\n+        }\n+\n+        if (!fluffName.isEmpty()) {", "originalCommit": "39ecc0d467aebf54ae7ec2be703306aa5c48c328", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA4NTA4Ng==", "url": "https://github.com/MegaMek/mekhq/pull/2102#discussion_r499085086", "bodyText": "Good catch. I've pushed a fix where the fluff name can't be null but is now only an empty string.", "author": "Windchild292", "createdAt": "2020-10-02T23:13:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA4MTkyOA=="}], "type": "inlineReview"}, {"oid": "270740e63b45da4a849f75b5067221a0ad700b8f", "url": "https://github.com/MegaMek/mekhq/commit/270740e63b45da4a849f75b5067221a0ad700b8f", "message": "Removing any chance of fluff name being null", "committedDate": "2020-10-02T23:12:36Z", "type": "commit"}, {"oid": "bb0134603656362e9e5c7f980100d8b8ee4ef2c3", "url": "https://github.com/MegaMek/mekhq/commit/bb0134603656362e9e5c7f980100d8b8ee4ef2c3", "message": "Fixing missed pilotId removal", "committedDate": "2020-10-02T23:13:56Z", "type": "commit"}]}