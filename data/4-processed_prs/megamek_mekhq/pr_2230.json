{"pr_number": 2230, "pr_title": "Issue #2166: NRE in Money::plus/Money::minus", "pr_createdAt": "2020-11-14T22:09:01Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/2230", "timeline": [{"oid": "29b7860ab0b14d39244568cb1034512a3ae19daf", "url": "https://github.com/MegaMek/mekhq/commit/29b7860ab0b14d39244568cb1034512a3ae19daf", "message": "Avoid NRE in Money::plus/Money::minus, fixing #2166", "committedDate": "2020-11-14T22:05:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQ2OTAyMA==", "url": "https://github.com/MegaMek/mekhq/pull/2230#discussion_r523469020", "bodyText": "This ensures we get a clone of the underlying BigMoney instance and don't share it between two Money instances.", "author": "sixlettervariables", "createdAt": "2020-11-14T22:09:30Z", "path": "MekHQ/src/mekhq/campaign/finances/Money.java", "diffHunk": "@@ -102,6 +102,10 @@ public Money absolute() {\n     }\n \n     public Money plus(Money amount) {\n+        if (amount == null) {\n+            return plus(0L);", "originalCommit": "29b7860ab0b14d39244568cb1034512a3ae19daf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQ2OTAzNA==", "url": "https://github.com/MegaMek/mekhq/pull/2230#discussion_r523469034", "bodyText": "This ensures we get a clone of the underlying BigMoney instance and don't share it between two Money instances.", "author": "sixlettervariables", "createdAt": "2020-11-14T22:09:34Z", "path": "MekHQ/src/mekhq/campaign/finances/Money.java", "diffHunk": "@@ -114,6 +118,10 @@ public Money plus(List<Money> amounts) {\n     }\n \n     public Money minus(Money amount) {\n+        if (amount == null) {\n+            return minus(0L);", "originalCommit": "29b7860ab0b14d39244568cb1034512a3ae19daf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQ2OTE4NA==", "url": "https://github.com/MegaMek/mekhq/pull/2230#discussion_r523469184", "bodyText": "Easy ternary candidate, plus why not instead return Money.zero() ?", "author": "Windchild292", "createdAt": "2020-11-14T22:11:39Z", "path": "MekHQ/src/mekhq/campaign/finances/Money.java", "diffHunk": "@@ -102,6 +102,10 @@ public Money absolute() {\n     }\n \n     public Money plus(Money amount) {\n+        if (amount == null) {\n+            return plus(0L);\n+        }\n+\n         return new Money(getWrapped().plus(amount.getWrapped()));", "originalCommit": "29b7860ab0b14d39244568cb1034512a3ae19daf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzc5NjIzMw==", "url": "https://github.com/MegaMek/mekhq/pull/2230#discussion_r523796233", "bodyText": "Preferred the simpler version.", "author": "sixlettervariables", "createdAt": "2020-11-15T18:43:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQ2OTE4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzc5NjMwMg==", "url": "https://github.com/MegaMek/mekhq/pull/2230#discussion_r523796302", "bodyText": "What do you mean simpler? Money.zero() is our normal way to do so and this can cause confusion in the future.", "author": "Windchild292", "createdAt": "2020-11-15T18:44:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQ2OTE4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzc5NjU2MA==", "url": "https://github.com/MegaMek/mekhq/pull/2230#discussion_r523796560", "bodyText": "plus(Money.zero()) would just call this method again", "author": "sixlettervariables", "createdAt": "2020-11-15T18:46:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQ2OTE4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQ2OTE4OQ==", "url": "https://github.com/MegaMek/mekhq/pull/2230#discussion_r523469189", "bodyText": "Same as above", "author": "Windchild292", "createdAt": "2020-11-14T22:11:50Z", "path": "MekHQ/src/mekhq/campaign/finances/Money.java", "diffHunk": "@@ -114,6 +118,10 @@ public Money plus(List<Money> amounts) {\n     }\n \n     public Money minus(Money amount) {\n+        if (amount == null) {\n+            return minus(0L);\n+        }\n+\n         return new Money(getWrapped().minus(amount.getWrapped()));\n     }", "originalCommit": "29b7860ab0b14d39244568cb1034512a3ae19daf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}