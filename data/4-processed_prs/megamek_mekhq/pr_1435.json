{"pr_number": 1435, "pr_title": "Fix and log invalid lc ammo bin", "pr_createdAt": "2020-01-29T16:46:17Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/1435", "timeline": [{"oid": "68df9b6a69659aa0289606896835bb81f3108cac", "url": "https://github.com/MegaMek/mekhq/commit/68df9b6a69659aa0289606896835bb81f3108cac", "message": "Fix and log invalid lc ammo bin", "committedDate": "2020-01-29T16:40:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUwMzcwNw==", "url": "https://github.com/MegaMek/mekhq/pull/1435#discussion_r372503707", "bodyText": "You definitely need a null check on mounted before calling mounted.getType(). I'd suggest moving the logic from the if statement on line 280 into the if statement on line 276, then making 280 an \"else\".", "author": "apokrovski", "createdAt": "2020-01-29T16:50:40Z", "path": "MekHQ/src/mekhq/campaign/parts/equipment/LargeCraftAmmoBin.java", "diffHunk": "@@ -270,9 +270,14 @@ public MissingPart getMissingPart() {\n \n     @Override\n     public void updateConditionFromEntity(boolean checkForDestruction) {\n+        final String METHOD_NAME = \"updateConditionFromEntity()\"; //$NON-NLS-1$\n         if(null != unit) {\n             Mounted mounted = unit.getEntity().getEquipment(equipmentNum);\n-            if(null != mounted) {\n+            if (!(mounted.getType() instanceof AmmoType)) {\n+                MekHQ.getLogger().log(LargeCraftAmmoBin.class, METHOD_NAME, LogLevel.WARNING,\n+                        unit.getName() + \" has invalid ammo bin at equipment number \" + equipmentNum);\n+            }\n+            if(null != mounted && mounted.getType() instanceof AmmoType) {", "originalCommit": "68df9b6a69659aa0289606896835bb81f3108cac", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUwNDczMg==", "url": "https://github.com/MegaMek/mekhq/pull/1435#discussion_r372504732", "bodyText": "Mounted can't be null at this point because if it were it would have thrown a NullPointerException on line 276. If it's possible that this is null, then that needs to be part of the check (which should also be logged, since that's also a problem).", "author": "neoancient", "createdAt": "2020-01-29T16:52:28Z", "path": "MekHQ/src/mekhq/campaign/parts/equipment/LargeCraftAmmoBin.java", "diffHunk": "@@ -270,9 +270,14 @@ public MissingPart getMissingPart() {\n \n     @Override\n     public void updateConditionFromEntity(boolean checkForDestruction) {\n+        final String METHOD_NAME = \"updateConditionFromEntity()\"; //$NON-NLS-1$\n         if(null != unit) {\n             Mounted mounted = unit.getEntity().getEquipment(equipmentNum);\n-            if(null != mounted) {\n+            if (!(mounted.getType() instanceof AmmoType)) {\n+                MekHQ.getLogger().log(LargeCraftAmmoBin.class, METHOD_NAME, LogLevel.WARNING,\n+                        unit.getName() + \" has invalid ammo bin at equipment number \" + equipmentNum);\n+            }\n+            if(null != mounted && mounted.getType() instanceof AmmoType) {", "originalCommit": "68df9b6a69659aa0289606896835bb81f3108cac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUxMjY4Ng==", "url": "https://github.com/MegaMek/mekhq/pull/1435#discussion_r372512686", "bodyText": "Fixed.", "author": "mkerensky", "createdAt": "2020-01-29T17:06:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUwNDczMg=="}], "type": "inlineReview"}, {"oid": "46d7327c07911d6e7d5fa15cd231ed97a9640726", "url": "https://github.com/MegaMek/mekhq/commit/46d7327c07911d6e7d5fa15cd231ed97a9640726", "message": "Improves log message and logs null mounted", "committedDate": "2020-01-29T17:05:52Z", "type": "commit"}]}