{"pr_number": 83, "pr_title": "Add cmake", "pr_createdAt": "2020-04-06T17:11:06Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/83", "timeline": [{"oid": "def8a6929f9db66d04b6855a0e60395d38b69d6d", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/def8a6929f9db66d04b6855a0e60395d38b69d6d", "message": "added cmake to build library", "committedDate": "2020-04-06T06:41:27Z", "type": "commit"}, {"oid": "f066bddbdce2bcbc17cbb37f86871039356edb0f", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/f066bddbdce2bcbc17cbb37f86871039356edb0f", "message": "moved submodule to v1.7.3.6", "committedDate": "2020-04-06T16:07:19Z", "type": "commit"}, {"oid": "13b929a9c1ecefe85da2fd2f9282629f8d3538c3", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/13b929a9c1ecefe85da2fd2f9282629f8d3538c3", "message": "updated CMakeLists.txt", "committedDate": "2020-04-06T16:20:24Z", "type": "commit"}, {"oid": "eb4355795937b6ca7df4cb68f12b131e70154a0b", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/eb4355795937b6ca7df4cb68f12b131e70154a0b", "message": "added library build information", "committedDate": "2020-04-06T17:02:16Z", "type": "commit"}, {"oid": "19eee61e86576c509af99ee33e82ef70f330f7b4", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/19eee61e86576c509af99ee33e82ef70f330f7b4", "message": "added license headers", "committedDate": "2020-04-06T17:09:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI1MzY2Ng==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/83#discussion_r405253666", "bodyText": "Probably need ${CMAKE_CURRENT_SOURCE_DIR}/external/nmslib/similarity_search", "author": "chenqi0805", "createdAt": "2020-04-08T04:38:41Z", "path": "jni/CMakeLists.txt", "diffHunk": "@@ -0,0 +1,56 @@\n+#\n+#   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+#\n+#   Licensed under the Apache License, Version 2.0 (the \"License\").\n+#   You may not use this file except in compliance with the License.\n+#   A copy of the License is located at\n+#\n+#       http://www.apache.org/licenses/LICENSE-2.0\n+#\n+#   or in the \"license\" file accompanying this file. This file is distributed\n+#   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+#   express or implied. See the License for the specific language governing\n+#   permissions and limitations under the License.\n+#\n+\n+cmake_minimum_required(VERSION 2.8)\n+\n+project(KNNIndexV1_7_3_6)\n+\n+set(CMAKE_CXX_STANDARD 11)\n+set(CMAKE_CXX_STANDARD_REQUIRED True)\n+\n+# Target Library to be built\n+set(KNN_INDEX KNNIndexV1_7_3_6)\n+\n+# Check if similarity search exists\n+find_path(NMS_REPO_DIR NAMES similarity_search PATHS ${CMAKE_CURRENT_SOURCE_DIR}/external/nmslib REQUIRED)\n+\n+# If not, pull the updated submodule\n+if (NOT EXISTS ${NMS_REPO_DIR})\n+    message(STATUS \"Could not find nmslib. Pulling updated submodule.\")\n+    execute_process(COMMAND git submodule update --init -- external/nmslib WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})\n+endif ()\n+\n+# Add the subdirectory so it is possible to use its targets\n+add_subdirectory(external/nmslib/similarity_search)", "originalCommit": "19eee61e86576c509af99ee33e82ef70f330f7b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY5MjIzNA==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/83#discussion_r405692234", "bodyText": "Good catch. Updated thanks!", "author": "jmazanec15", "createdAt": "2020-04-08T17:27:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI1MzY2Ng=="}], "type": "inlineReview"}, {"oid": "801534aff21a8069b18a98919a0bb62b2c7de63f", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/801534aff21a8069b18a98919a0bb62b2c7de63f", "message": "Updated CMakeLists", "committedDate": "2020-04-08T17:26:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg2NjI4OQ==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/83#discussion_r405866289", "bodyText": "I find out that .dylib will facilitate debugging jni code. Specifically, one can use \"attach to process\" in C++ IDE to successfully attach to jps. For .jnilib it will not work for unknown reason. Maybe it is worth building an extra shared library on macOS to facilitate development?", "author": "chenqi0805", "createdAt": "2020-04-08T23:11:05Z", "path": "jni/CMakeLists.txt", "diffHunk": "@@ -0,0 +1,56 @@\n+#\n+#   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+#\n+#   Licensed under the Apache License, Version 2.0 (the \"License\").\n+#   You may not use this file except in compliance with the License.\n+#   A copy of the License is located at\n+#\n+#       http://www.apache.org/licenses/LICENSE-2.0\n+#\n+#   or in the \"license\" file accompanying this file. This file is distributed\n+#   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+#   express or implied. See the License for the specific language governing\n+#   permissions and limitations under the License.\n+#\n+\n+cmake_minimum_required(VERSION 2.8)\n+\n+project(KNNIndexV1_7_3_6)\n+\n+set(CMAKE_CXX_STANDARD 11)\n+set(CMAKE_CXX_STANDARD_REQUIRED True)\n+\n+# Target Library to be built\n+set(KNN_INDEX KNNIndexV1_7_3_6)\n+\n+# Check if similarity search exists\n+find_path(NMS_REPO_DIR NAMES similarity_search PATHS ${CMAKE_CURRENT_SOURCE_DIR}/external/nmslib REQUIRED)\n+\n+# If not, pull the updated submodule\n+if (NOT EXISTS ${NMS_REPO_DIR})\n+    message(STATUS \"Could not find nmslib. Pulling updated submodule.\")\n+    execute_process(COMMAND git submodule update --init -- external/nmslib WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})\n+endif ()\n+\n+# Add the subdirectory so it is possible to use its targets\n+add_subdirectory(${CMAKE_CURRENT_SOURCE_DIR}/external/nmslib/similarity_search)\n+\n+# Set OS specific variables\n+if (${CMAKE_SYSTEM_NAME} STREQUAL Darwin)\n+    set(JVM_OS_TYPE darwin)\n+    set(LIB_EXT .jnilib)", "originalCommit": "801534aff21a8069b18a98919a0bb62b2c7de63f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg5MTUyMg==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/83#discussion_r405891522", "bodyText": "Interesting, that would help development. It may be out of the scope of this PR, but is worth investigating. Could you create an issue for it?", "author": "jmazanec15", "createdAt": "2020-04-09T00:34:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg2NjI4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkwMDc0Mw==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/83#discussion_r405900743", "bodyText": "#87", "author": "chenqi0805", "createdAt": "2020-04-09T01:08:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg2NjI4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQwMzMxNg==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/83#discussion_r406403316", "bodyText": "Thanks!", "author": "jmazanec15", "createdAt": "2020-04-09T18:41:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg2NjI4OQ=="}], "type": "inlineReview"}]}