{"pr_number": 291, "pr_title": "Upgrade nmslib to v2.0.8 in JNI library", "pr_createdAt": "2020-12-30T00:28:01Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/291", "timeline": [{"oid": "30282a64e39cd918c57660b7d17432d3cb058a9b", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/30282a64e39cd918c57660b7d17432d3cb058a9b", "message": "Upgrade library naming from 206 to 207", "committedDate": "2020-12-29T22:46:38Z", "type": "commit"}, {"oid": "932ae00f9de5a913683c35ca300b7f6d36686a67", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/932ae00f9de5a913683c35ca300b7f6d36686a67", "message": "Update nmslib to 2.0.7", "committedDate": "2020-12-29T23:49:09Z", "type": "commit"}, {"oid": "1dc106167e8e4ead649dc9c8eb9fd8c7d2ea58a7", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/1dc106167e8e4ead649dc9c8eb9fd8c7d2ea58a7", "message": "Bump nmslib to v2.0.8", "committedDate": "2021-01-03T16:59:56Z", "type": "commit"}, {"oid": "a3b6ac744ab7ca8595068f96c5b06ad64691d9e4", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/a3b6ac744ab7ca8595068f96c5b06ad64691d9e4", "message": "Update tests to use l2 squared (as opposed to l2)", "committedDate": "2021-01-05T18:15:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjE1MTkxMg==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/291#discussion_r552151912", "bodyText": "assertEquals(expected, actual, ... )", "author": "VijayanB", "createdAt": "2021-01-05T19:39:46Z", "path": "src/test/java/com/amazon/opendistroforelasticsearch/knn/index/codec/KNNCodecTestCase.java", "diffHunk": "@@ -153,8 +153,8 @@ public void testMultiFieldsKnnIndex(Codec codec) throws Exception {\n         IndexSearcher searcher = new IndexSearcher(reader);\n         float score = searcher.search(new KNNQuery(\"test_vector\", new float[] {1.0f, 0.0f, 0.0f}, 1, \"dummy\"), 10).scoreDocs[0].score;\n         float score1 = searcher.search(new KNNQuery(\"my_vector\", new float[] {1.0f, 2.0f}, 1, \"dummy\"), 10).scoreDocs[0].score;\n-        assertEquals(score, 0.1667f, 0.01f);\n-        assertEquals(score1, 0.0714f, 0.01f);\n+        assertEquals(score, 1.0f/(1 + 25), 0.01f);", "originalCommit": "a3b6ac744ab7ca8595068f96c5b06ad64691d9e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjI2Njg4OQ==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/291#discussion_r552266889", "bodyText": "Good point. Im trying to fix these as I go. Will update.", "author": "jmazanec15", "createdAt": "2021-01-05T23:48:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjE1MTkxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjE1NDc5OA==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/291#discussion_r552154798", "bodyText": "why can't we create a \"latest\" as enum value, so that we don't have to update this line every time. What do you think?", "author": "VijayanB", "createdAt": "2021-01-05T19:45:25Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/knn/index/util/NmsLibVersion.java", "diffHunk": "@@ -20,14 +20,14 @@\n     /**\n      * Latest available nmslib version\n      */\n-    V206(\"206\"){\n+    V208(\"208\"){\n         @Override\n         public String indexLibraryVersion() {\n-            return \"KNNIndexV2_0_6\";\n+            return \"KNNIndexV2_0_8\";\n         }\n     };\n \n-    public static final NmsLibVersion LATEST = V206;\n+    public static final NmsLibVersion LATEST = V208;", "originalCommit": "a3b6ac744ab7ca8595068f96c5b06ad64691d9e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjI2NjQ1MQ==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/291#discussion_r552266451", "bodyText": "I think we could but Im not sure how it would be better. The purpose of using the versioning is to handle potential backwards compatibility issues if we upgrade to an nmslib version that breaks backwards compatibility. We havent had this issue so far, so we just replace the nmslib version with the new one.\nHowever, if we end up having this issue, it seems to me, LATEST should just be a pointer to an enum value and enum values should be concrete versions.", "author": "jmazanec15", "createdAt": "2021-01-05T23:47:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjE1NDc5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjI0ODU3Ng==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/291#discussion_r552248576", "bodyText": "Lets keep the versioning in the interface so that it would be easy to support backward compatibility when we find one.  lets add v208 similar to v206", "author": "vamshin", "createdAt": "2021-01-05T22:56:52Z", "path": "jni/include/com_amazon_opendistroforelasticsearch_knn_index_nmslib_KNNIndex.h", "diffHunk": "@@ -1,50 +1,50 @@\n /* DO NOT EDIT THIS FILE - it is machine generated */\n #include <jni.h>\n-/* Header for class com_amazon_opendistroforelasticsearch_knn_index_v206_KNNIndex */\n+/* Header for class com_amazon_opendistroforelasticsearch_knn_index_nmslib_KNNIndex */\n \n-#ifndef _Included_com_amazon_opendistroforelasticsearch_knn_index_v206_KNNIndex\n-#define _Included_com_amazon_opendistroforelasticsearch_knn_index_v206_KNNIndex\n+#ifndef _Included_com_amazon_opendistroforelasticsearch_knn_index_nmslib_KNNIndex\n+#define _Included_com_amazon_opendistroforelasticsearch_knn_index_nmslib_KNNIndex\n #ifdef __cplusplus\n extern \"C\" {\n #endif\n /*\n- * Class:     com_amazon_opendistroforelasticsearch_knn_index_v206_KNNIndex\n+ * Class:     com_amazon_opendistroforelasticsearch_knn_index_nmslib_KNNIndex\n  * Method:    saveIndex\n  * Signature: ([I[[FLjava/lang/String;[Ljava/lang/String;Ljava/lang/String;)V\n  */\n-JNIEXPORT void JNICALL Java_com_amazon_opendistroforelasticsearch_knn_index_v206_KNNIndex_saveIndex\n+JNIEXPORT void JNICALL Java_com_amazon_opendistroforelasticsearch_knn_index_nmslib_KNNIndex_saveIndex\n   (JNIEnv *, jclass, jintArray, jobjectArray, jstring, jobjectArray, jstring);\n \n /*\n- * Class:     com_amazon_opendistroforelasticsearch_knn_index_v206_KNNIndex\n+ * Class:     com_amazon_opendistroforelasticsearch_knn_index_nmslib_KNNIndex\n  * Method:    queryIndex\n  * Signature: (J[FI)[Lcom/amazon/opendistroforelasticsearch/knn/index/KNNQueryResult;\n  */\n-JNIEXPORT jobjectArray JNICALL Java_com_amazon_opendistroforelasticsearch_knn_index_v206_KNNIndex_queryIndex\n+JNIEXPORT jobjectArray JNICALL Java_com_amazon_opendistroforelasticsearch_knn_index_nmslib_KNNIndex_queryIndex\n   (JNIEnv *, jclass, jlong, jfloatArray, jint);\n \n /*\n- * Class:     com_amazon_opendistroforelasticsearch_knn_index_v206_KNNIndex\n+ * Class:     com_amazon_opendistroforelasticsearch_knn_index_nmslib_KNNIndex\n  * Method:    init\n  * Signature: (Ljava/lang/String;[Ljava/lang/String;Ljava/lang/String;)J\n  */\n-JNIEXPORT jlong JNICALL Java_com_amazon_opendistroforelasticsearch_knn_index_v206_KNNIndex_init\n+JNIEXPORT jlong JNICALL Java_com_amazon_opendistroforelasticsearch_knn_index_nmslib_KNNIndex_init\n   (JNIEnv *, jclass, jstring, jobjectArray, jstring);\n \n /*\n- * Class:     com_amazon_opendistroforelasticsearch_knn_index_v206_KNNIndex\n+ * Class:     com_amazon_opendistroforelasticsearch_knn_index_nmslib_KNNIndex\n  * Method:    gc\n  * Signature: (J)V\n  */\n-JNIEXPORT void JNICALL Java_com_amazon_opendistroforelasticsearch_knn_index_v206_KNNIndex_gc\n+JNIEXPORT void JNICALL Java_com_amazon_opendistroforelasticsearch_knn_index_nmslib_KNNIndex_gc\n   (JNIEnv *, jclass, jlong);\n \n /*\n- * Class:     com_amazon_opendistroforelasticsearch_knn_index_v206_KNNIndex\n+ * Class:     com_amazon_opendistroforelasticsearch_knn_index_nmslib_KNNIndex\n  * Method:    initLibrary\n  * Signature: ()V\n  */\n-JNIEXPORT void JNICALL Java_com_amazon_opendistroforelasticsearch_knn_index_v206_KNNIndex_initLibrary\n+JNIEXPORT void JNICALL Java_com_amazon_opendistroforelasticsearch_knn_index_nmslib_KNNIndex_initLibrary", "originalCommit": "a3b6ac744ab7ca8595068f96c5b06ad64691d9e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjI2NzQwMw==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/291#discussion_r552267403", "bodyText": "Makes sense. Will update.", "author": "jmazanec15", "createdAt": "2021-01-05T23:48:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjI0ODU3Ng=="}], "type": "inlineReview"}, {"oid": "6f3eaf53573532a54809350efec729438fb96ea1", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/6f3eaf53573532a54809350efec729438fb96ea1", "message": "revert naming convention for lib", "committedDate": "2021-01-05T23:41:17Z", "type": "commit"}, {"oid": "ee3f6c38cd59355958fa715c4adc89cbc5564d30", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/ee3f6c38cd59355958fa715c4adc89cbc5564d30", "message": "fix order in assert in tests", "committedDate": "2021-01-05T23:49:55Z", "type": "commit"}]}