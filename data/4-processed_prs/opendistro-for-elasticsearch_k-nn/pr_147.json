{"pr_number": 147, "pr_title": "Elasticsearch 7.8 support", "pr_createdAt": "2020-06-24T05:49:45Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/147", "timeline": [{"oid": "856074a172f9ee4d9d4264892308c10799051a96", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/856074a172f9ee4d9d4264892308c10799051a96", "message": "7.8 support", "committedDate": "2020-06-23T23:48:57Z", "type": "commit"}, {"oid": "c84ee0e4437e958b752b7e04e30a3c2ab2f614e2", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/c84ee0e4437e958b752b7e04e30a3c2ab2f614e2", "message": "7.8 support", "committedDate": "2020-06-24T05:47:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk1NTA4Mg==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/147#discussion_r444955082", "bodyText": "Why is this commented out?", "author": "jmazanec15", "createdAt": "2020-06-24T14:53:11Z", "path": "build.gradle", "diffHunk": "@@ -40,7 +40,7 @@ plugins {\n     id 'java-library'\n     id 'nebula.ospackage' version \"8.3.0\" apply false\n     id 'idea'\n-    id 'jacoco'\n+    //id 'jacoco'", "originalCommit": "c84ee0e4437e958b752b7e04e30a3c2ab2f614e2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk1NTI4MQ==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/147#discussion_r444955281", "bodyText": "Why is this commented out?", "author": "jmazanec15", "createdAt": "2020-06-24T14:53:30Z", "path": "build.gradle", "diffHunk": "@@ -52,12 +52,12 @@ def integTestDependOnJniLib = false\n if (!usingRemoteCluster) {\n     integTestDependOnJniLib = true\n     if (!usingMultiNode) {\n-        apply from: 'build-tools/knnplugin-coverage.gradle'\n+       // apply from: 'build-tools/knnplugin-coverage.gradle'", "originalCommit": "c84ee0e4437e958b752b7e04e30a3c2ab2f614e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNDg0OQ==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/147#discussion_r445024849", "bodyText": "Good catch. Forgot to fix the jacoco. Its WIP", "author": "vamshin", "createdAt": "2020-06-24T16:35:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk1NTI4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk1NTYyNw==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/147#discussion_r444955627", "bodyText": "Because this is just upgrading ES version, ODFE version does not need to be bumped up.", "author": "jmazanec15", "createdAt": "2020-06-24T14:54:00Z", "path": "build.gradle", "diffHunk": "@@ -52,12 +52,12 @@ def integTestDependOnJniLib = false\n if (!usingRemoteCluster) {\n     integTestDependOnJniLib = true\n     if (!usingMultiNode) {\n-        apply from: 'build-tools/knnplugin-coverage.gradle'\n+       // apply from: 'build-tools/knnplugin-coverage.gradle'\n     }\n }\n \n ext {\n-    opendistroVersion = '1.8.0'\n+    opendistroVersion = '1.9.0'", "originalCommit": "c84ee0e4437e958b752b7e04e30a3c2ab2f614e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNDU4MQ==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/147#discussion_r445024581", "bodyText": "makes sense. Will revert it.", "author": "vamshin", "createdAt": "2020-06-24T16:34:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk1NTYyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk1NTg0Ng==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/147#discussion_r444955846", "bodyText": "Is this WIP?", "author": "jmazanec15", "createdAt": "2020-06-24T14:54:18Z", "path": "build.gradle", "diffHunk": "@@ -75,11 +75,11 @@ allprojects {\n }\n \n \n-jacoco {\n-    toolVersion = \"0.8.5\"\n-}\n-\n-check.dependsOn jacocoTestReport\n+//jacoco {", "originalCommit": "c84ee0e4437e958b752b7e04e30a3c2ab2f614e2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk1Njc5Mg==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/147#discussion_r444956792", "bodyText": "Why can we remove this?", "author": "jmazanec15", "createdAt": "2020-06-24T14:55:31Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/knn/index/KNNVectorFieldMapper.java", "diffHunk": "@@ -49,7 +48,7 @@\n /**\n  * Field Mapper for KNN vector type.\n  */\n-public class KNNVectorFieldMapper extends FieldMapper implements ArrayValueMapperParser {", "originalCommit": "c84ee0e4437e958b752b7e04e30a3c2ab2f614e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNDAwMA==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/147#discussion_r445024000", "bodyText": "ArrayValueMapperParser is removed in ES version 7.8. So refactored around that", "author": "vamshin", "createdAt": "2020-06-24T16:33:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk1Njc5Mg=="}], "type": "inlineReview"}, {"oid": "bbe6e5526989784dc00d5d836388b480ac7571a0", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/bbe6e5526989784dc00d5d836388b480ac7571a0", "message": "7.8 support", "committedDate": "2020-06-25T04:14:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYzODU2Mw==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/147#discussion_r445638563", "bodyText": "Just curious, what does this do?", "author": "jmazanec15", "createdAt": "2020-06-25T15:18:44Z", "path": "build-tools/knnplugin-coverage.gradle", "diffHunk": "@@ -74,7 +74,7 @@ allprojects{\n         jacocoTestReport.dependsOn integTest.runner\n \n         testClusters.integTest {\n-            jvmArgs \" ${dummyIntegTest.jacoco.getAsJvmArg()}\"\n+            jvmArgs \" ${dummyIntegTest.jacoco.getAsJvmArg()}\".replace('javaagent:','javaagent:/')", "originalCommit": "bbe6e5526989784dc00d5d836388b480ac7571a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY2MTE0Nw==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/147#discussion_r445661147", "bodyText": "Fixes jacocoagent path to work with gradle 6.5 for integration tests", "author": "vamshin", "createdAt": "2020-06-25T15:51:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYzODU2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYzODk0Nw==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/147#discussion_r445638947", "bodyText": "Why was this removed?", "author": "jmazanec15", "createdAt": "2020-06-25T15:19:17Z", "path": "build.gradle", "diffHunk": "@@ -209,8 +209,7 @@ forbiddenPatterns {\n // see https://github.com/elastic/elasticsearch/blob/323f312bbc829a63056a79ebe45adced5099f6e6/buildSrc/src/main/java/org/elasticsearch/gradle/precommit/TestingConventionsTasks.java\n // enable testingConventions check will cause errors like:  \"Classes ending with [Tests] must subclass [LuceneTestCase]\"\n testingConventions.enabled = false\n-licenseHeaders.enabled = true", "originalCommit": "bbe6e5526989784dc00d5d836388b480ac7571a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY2MTI5MA==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/147#discussion_r445661290", "bodyText": "this was a duplicate", "author": "vamshin", "createdAt": "2020-06-25T15:51:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYzODk0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY3MzcwOA==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/147#discussion_r445673708", "bodyText": "Oh cool", "author": "jmazanec15", "createdAt": "2020-06-25T16:10:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYzODk0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYzOTI3Ng==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/147#discussion_r445639276", "bodyText": "Nice, will save us some trouble", "author": "jmazanec15", "createdAt": "2020-06-25T15:19:46Z", "path": "build.gradle", "diffHunk": "@@ -231,7 +230,7 @@ afterEvaluate {\n         dirMode 0755\n \n         requires('elasticsearch-oss', versions.elasticsearch, EQUAL)\n-        requires(\"opendistro-knnlib\",  \"1.8.0.0\",  EQUAL)\n+        requires(\"opendistro-knnlib\",  \"${opendistroVersion}.0\",  EQUAL)", "originalCommit": "bbe6e5526989784dc00d5d836388b480ac7571a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY0MDUzMQ==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/147#discussion_r445640531", "bodyText": "Curious, what does this do?", "author": "jmazanec15", "createdAt": "2020-06-25T15:21:24Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/knn/index/KNNVectorFieldMapper.java", "diffHunk": "@@ -235,6 +234,11 @@ public Query termQuery(Object value, QueryShardContext context) {\n         }\n     }\n \n+    @Override\n+    public final boolean parsesArrayValue() {", "originalCommit": "bbe6e5526989784dc00d5d836388b480ac7571a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY2MTc3OQ==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/147#discussion_r445661779", "bodyText": "It tells the parser to expect array. Otherwise, it treats as a single value and fails validating the vector with respect to number of dimensions", "author": "vamshin", "createdAt": "2020-06-25T15:52:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY0MDUzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY3NDE3NQ==", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/147#discussion_r445674175", "bodyText": "Oh interesting. Thanks", "author": "jmazanec15", "createdAt": "2020-06-25T16:11:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY0MDUzMQ=="}], "type": "inlineReview"}, {"oid": "eb7cba4ea6293d5a223ba1f9317a66a43097ab77", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/eb7cba4ea6293d5a223ba1f9317a66a43097ab77", "message": "deprecate/remove shared library from buildSrc (#149)\n\n* deprecate/remove shared library from buildSrc\r\n\r\n* refactor build.gradle", "committedDate": "2020-06-25T20:35:32Z", "type": "commit"}, {"oid": "03f01992a29a63daa8ebc7e024bab42de9f6ef73", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/03f01992a29a63daa8ebc7e024bab42de9f6ef73", "message": "7.8 support", "committedDate": "2020-06-25T20:49:23Z", "type": "commit"}, {"oid": "1712e4e73c5f8ae3942a18f01fb91981df784a57", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/1712e4e73c5f8ae3942a18f01fb91981df784a57", "message": "7.8 support", "committedDate": "2020-06-25T20:49:23Z", "type": "commit"}, {"oid": "68ed56c67b58d69e4f6a383f70dd746a670baac0", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/68ed56c67b58d69e4f6a383f70dd746a670baac0", "message": "7.8 support", "committedDate": "2020-06-25T20:49:23Z", "type": "commit"}, {"oid": "5b3be53591ac82d36017928c2e12442996640720", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/5b3be53591ac82d36017928c2e12442996640720", "message": "refactor build.gradle", "committedDate": "2020-06-25T20:55:26Z", "type": "commit"}]}