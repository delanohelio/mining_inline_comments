{"pr_number": 2820, "pr_title": "CorfuStore streaming redesign part 2 - txn stream tagging support.", "pr_createdAt": "2020-11-06T23:36:45Z", "pr_url": "https://github.com/CorfuDB/CorfuDB/pull/2820", "timeline": [{"oid": "4af3ba32f22b27142f8b46667e42bd599e891a4f", "url": "https://github.com/CorfuDB/CorfuDB/commit/4af3ba32f22b27142f8b46667e42bd599e891a4f", "message": "CorfuStore streaming redesign part 2 - txn stream tagging support.\n\nIntroducing transaction stream tagging that adds a stream tag option\nwhen opening corfu obejcts, which will later be used to send\ntransactional updates to crresponding transaction streams when\ntransactions commit.\n\nCo-authored-by: pankti-m <pmajmudar@vmware.com>", "committedDate": "2020-11-09T08:28:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE5MTg5NA==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2820#discussion_r520191894", "bodyText": "why do we add the stream tags only if transaction logging is enabled?", "author": "pankti-m", "createdAt": "2020-11-09T23:42:44Z", "path": "runtime/src/main/java/org/corfudb/runtime/object/transactions/OptimisticTransactionalContext.java", "diffHunk": "@@ -244,10 +236,13 @@ public long getConflictSetAndCommit(ConflictSetInfo conflictSet) {\n             return NOWRITE_ADDRESS;\n         }\n \n-        // Write to the transaction stream if transaction logging is enabled\n-        Set<UUID> affectedStreamsIds = new HashSet<>(getWriteSetInfo().getWriteSet().getEntryMap().keySet());\n+        Set<UUID> affectedStreamsIds = new HashSet<>(getWriteSetInfo()\n+                .getWriteSet().getEntryMap().keySet());\n \n-        if (this.transaction.isLoggingEnabled()) {\n+        // Write to transaction streams if transaction logging is enabled.\n+        if (transaction.isLoggingEnabled()) {\n+            affectedStreamsIds.addAll(getWriteSetInfo().getStreamTags());", "originalCommit": "4af3ba32f22b27142f8b46667e42bd599e891a4f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI1MzYzOA==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2820#discussion_r520253638", "bodyText": "Yea, having stream tag implies requiring transaction logging. I removed that.", "author": "WenbinZhu", "createdAt": "2020-11-10T02:54:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE5MTg5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU2Mzk5Nw==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2820#discussion_r525563997", "bodyText": "@pankti-m I think we still need the add tags only if transaction logging is enabled. There needs to be a switch to turn off transction logging so that listeners won't get notifications, for example LR requires transaction logging to be turned off.", "author": "WenbinZhu", "createdAt": "2020-11-17T22:21:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE5MTg5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE5NjI2NA==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2820#discussion_r520196264", "bodyText": "do we need to provide both this and the below interface?", "author": "pankti-m", "createdAt": "2020-11-09T23:54:29Z", "path": "runtime/src/main/java/org/corfudb/runtime/view/SMRObject.java", "diffHunk": "@@ -107,13 +114,23 @@ private void verify() {\n             return this;\n         }\n \n+        public SMRObject.Builder<T> setStreamTags(Set<UUID> tags) {", "originalCommit": "4af3ba32f22b27142f8b46667e42bd599e891a4f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI1NDExMA==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2820#discussion_r520254110", "bodyText": "This one is used for CorfuStore to extract and supply the tags, the other one can be a convinience, currently it's used in tests, but can also be a convenience when using CorfuTable directly.", "author": "WenbinZhu", "createdAt": "2020-11-10T02:55:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE5NjI2NA=="}], "type": "inlineReview"}, {"oid": "817e8054434fe69692abb7591e5784d6a5948714", "url": "https://github.com/CorfuDB/CorfuDB/commit/817e8054434fe69692abb7591e5784d6a5948714", "message": "CorfuStore streaming redesign part 2 - txn stream tagging support.\n\nIntroducing transaction stream tagging that adds a stream tag option\nwhen opening corfu obejcts, which will later be used to send\ntransactional updates to crresponding transaction streams when\ntransactions commit.\n\nCo-authored-by: pankti-m <pmajmudar@vmware.com>", "committedDate": "2020-11-10T02:51:58Z", "type": "forcePushed"}, {"oid": "72d22d984afd32b55cb85cbe237d17ee74b51653", "url": "https://github.com/CorfuDB/CorfuDB/commit/72d22d984afd32b55cb85cbe237d17ee74b51653", "message": "CorfuStore streaming redesign part 2 - txn stream tagging support.\n\nIntroducing transaction stream tagging that adds a stream tag option\nwhen opening corfu obejcts, which will later be used to send\ntransactional updates to crresponding transaction streams when\ntransactions commit.\n\nCo-authored-by: pankti-m <pmajmudar@vmware.com>", "committedDate": "2020-11-10T22:33:28Z", "type": "forcePushed"}, {"oid": "fa42e6f1eefbc68f92cc76abb5eacadedc40aa97", "url": "https://github.com/CorfuDB/CorfuDB/commit/fa42e6f1eefbc68f92cc76abb5eacadedc40aa97", "message": "CorfuStore streaming redesign part 2 - txn stream tagging support.\n\nIntroducing transaction stream tagging that adds a stream tag option\nwhen opening corfu obejcts, which will later be used to send\ntransactional updates to crresponding transaction streams when\ntransactions commit.\n\nCo-authored-by: pankti-m <pmajmudar@vmware.com>", "committedDate": "2020-11-17T22:20:07Z", "type": "commit"}, {"oid": "fa42e6f1eefbc68f92cc76abb5eacadedc40aa97", "url": "https://github.com/CorfuDB/CorfuDB/commit/fa42e6f1eefbc68f92cc76abb5eacadedc40aa97", "message": "CorfuStore streaming redesign part 2 - txn stream tagging support.\n\nIntroducing transaction stream tagging that adds a stream tag option\nwhen opening corfu obejcts, which will later be used to send\ntransactional updates to crresponding transaction streams when\ntransactions commit.\n\nCo-authored-by: pankti-m <pmajmudar@vmware.com>", "committedDate": "2020-11-17T22:20:07Z", "type": "forcePushed"}]}