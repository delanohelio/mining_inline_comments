{"pr_number": 2838, "pr_title": "Shorten the logging of Protobuf Messages", "pr_createdAt": "2020-12-03T18:09:36Z", "pr_url": "https://github.com/CorfuDB/CorfuDB/pull/2838", "timeline": [{"oid": "d1f284fe56bca5c4d3e8f79509d923bb2ed0bf9a", "url": "https://github.com/CorfuDB/CorfuDB/commit/d1f284fe56bca5c4d3e8f79509d923bb2ed0bf9a", "message": "Shorten the logging of Protobuf Messages\n\nIt produces lots of new lines when logging the Protobuf\nMessages. This modification helps to make things logged in a\ncleaner way without new lines.", "committedDate": "2020-12-03T18:48:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUxMTAzMQ==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2838#discussion_r535511031", "bodyText": "There's also an instance in validateClientId.", "author": "zfrenette", "createdAt": "2020-12-03T19:16:16Z", "path": "runtime/src/main/java/org/corfudb/runtime/clients/NettyClientRouter.java", "diffHunk": "@@ -662,7 +663,7 @@ public void sendRequest(CorfuMessage.RequestPayloadMsg payload, long epoch,\n \n         // Write this message out on the channel\n         channel.writeAndFlush(request, channel.voidPromise());\n-        log.trace(\"Sent one-way request message: {}\", request.getHeader());\n+        log.trace(\"Sent one-way request message: {}\", TextFormat.shortDebugString(request.getHeader()));\n     }\n \n     /**", "originalCommit": "d1f284fe56bca5c4d3e8f79509d923bb2ed0bf9a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUzNjgwOQ==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2838#discussion_r535536809", "bodyText": "Added", "author": "xcchang", "createdAt": "2020-12-03T19:47:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUxMTAzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUxOTg0OQ==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2838#discussion_r535519849", "bodyText": "There's a couple of instances in NettyCorfuMsgEncoder as well.", "author": "zfrenette", "createdAt": "2020-12-03T19:26:55Z", "path": "runtime/src/main/java/org/corfudb/protocols/wireprotocol/ClientHandshakeHandler.java", "diffHunk": "@@ -1,5 +1,6 @@\n package org.corfudb.protocols.wireprotocol;\n \n+import com.google.protobuf.TextFormat;", "originalCommit": "d1f284fe56bca5c4d3e8f79509d923bb2ed0bf9a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUzNjg1Nw==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2838#discussion_r535536857", "bodyText": "Added", "author": "xcchang", "createdAt": "2020-12-03T19:47:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUxOTg0OQ=="}], "type": "inlineReview"}, {"oid": "8dec4640f176933a18d38ff7fc59665fb6dad7ca", "url": "https://github.com/CorfuDB/CorfuDB/commit/8dec4640f176933a18d38ff7fc59665fb6dad7ca", "message": "Shorten the logging of Protobuf Messages\n\nIt produces lots of new lines when logging the Protobuf\nMessages. This modification helps to make things logged in a\ncleaner way without new lines.", "committedDate": "2020-12-03T19:46:56Z", "type": "forcePushed"}, {"oid": "833ea5f3ace2c09c4ad16b4debf7116c9f98b926", "url": "https://github.com/CorfuDB/CorfuDB/commit/833ea5f3ace2c09c4ad16b4debf7116c9f98b926", "message": "Shorten the logging of Protobuf Messages\n\nIt produces lots of new lines when logging the Protobuf\nMessages. This modification helps to make things logged in a\ncleaner way without new lines.", "committedDate": "2020-12-07T19:48:10Z", "type": "forcePushed"}, {"oid": "8ed51693566fe9d3733a47599815713a3ecd22b8", "url": "https://github.com/CorfuDB/CorfuDB/commit/8ed51693566fe9d3733a47599815713a3ecd22b8", "message": "Shorten the logging of Protobuf Messages\n\nIt produces lots of new lines when logging the Protobuf\nMessages. This modification helps to make things logged in a\ncleaner way without new lines.", "committedDate": "2020-12-14T23:05:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk0Mzk2MA==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2838#discussion_r542943960", "bodyText": "can you wrap this with a if (log.isTraceEnabled())", "author": "Maithem", "createdAt": "2020-12-15T00:08:42Z", "path": "infrastructure/src/main/java/org/corfudb/infrastructure/IServerRouter.java", "diffHunk": "@@ -210,7 +211,8 @@ default void sendWrongEpochError(HeaderMsg requestHeader, ChannelHandlerContext\n         sendResponse(response, ctx);\n \n         log.trace(\"sendWrongEpochError[{}]: Incoming request received with wrong epoch, got {}, expected {}, \" +\n-                \"request was {}\", requestHeader.getRequestId(), requestHeader.getEpoch(), correctEpoch, requestHeader);\n+                \"request was {}\", requestHeader.getRequestId(), requestHeader.getEpoch(),", "originalCommit": "8ed51693566fe9d3733a47599815713a3ecd22b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk0ODYwNw==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2838#discussion_r542948607", "bodyText": "Added, thanks!", "author": "xcchang", "createdAt": "2020-12-15T00:18:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk0Mzk2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk0NDI0Mw==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2838#discussion_r542944243", "bodyText": "Here too.", "author": "Maithem", "createdAt": "2020-12-15T00:08:58Z", "path": "infrastructure/src/main/java/org/corfudb/infrastructure/IServerRouter.java", "diffHunk": "@@ -225,7 +227,7 @@ default void sendNoBootstrapError(HeaderMsg requestHeader, ChannelHandlerContext\n         sendResponse(response, ctx);\n \n         log.trace(\"sendNoBootstrapError[{}]: Received request but not bootstrapped! Request was {}\",\n-                requestHeader.getRequestId(), requestHeader);\n+                requestHeader.getRequestId(), TextFormat.shortDebugString(requestHeader));", "originalCommit": "8ed51693566fe9d3733a47599815713a3ecd22b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk0ODY0Mw==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2838#discussion_r542948643", "bodyText": "Added, thanks!", "author": "xcchang", "createdAt": "2020-12-15T00:18:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk0NDI0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk0NTQwNQ==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2838#discussion_r542945405", "bodyText": "This will be computed even if it wont be logged. I think its better shorten the string if trace is enabled.", "author": "Maithem", "createdAt": "2020-12-15T00:10:33Z", "path": "runtime/src/main/java/org/corfudb/runtime/clients/NettyClientRouter.java", "diffHunk": "@@ -593,7 +594,7 @@ public void stop() {\n \n         // Write this message out on the channel\n         channel.writeAndFlush(request, channel.voidPromise());\n-        log.trace(\"Sent request message: {}\", request.getHeader());\n+        log.trace(\"Sent request message: {}\", TextFormat.shortDebugString(request.getHeader()));", "originalCommit": "8ed51693566fe9d3733a47599815713a3ecd22b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk0ODY3Mw==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2838#discussion_r542948673", "bodyText": "Added, thanks!", "author": "xcchang", "createdAt": "2020-12-15T00:18:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk0NTQwNQ=="}], "type": "inlineReview"}, {"oid": "a3b7b5759da8d35621005e1250f0d5755702029d", "url": "https://github.com/CorfuDB/CorfuDB/commit/a3b7b5759da8d35621005e1250f0d5755702029d", "message": "Shorten the logging of Protobuf Messages\n\nIt produces lots of new lines when logging the Protobuf\nMessages. This modification helps to make things logged in a\ncleaner way without new lines.", "committedDate": "2020-12-15T00:18:06Z", "type": "commit"}, {"oid": "a3b7b5759da8d35621005e1250f0d5755702029d", "url": "https://github.com/CorfuDB/CorfuDB/commit/a3b7b5759da8d35621005e1250f0d5755702029d", "message": "Shorten the logging of Protobuf Messages\n\nIt produces lots of new lines when logging the Protobuf\nMessages. This modification helps to make things logged in a\ncleaner way without new lines.", "committedDate": "2020-12-15T00:18:06Z", "type": "forcePushed"}]}