{"pr_number": 1712, "pr_title": "HIVE-24433 - AutoCompaction is not getting triggered for CamelCase Partition Values", "pr_createdAt": "2020-11-26T02:03:28Z", "pr_url": "https://github.com/apache/hive/pull/1712", "timeline": [{"oid": "990bfd2aaf98ae6477a8d7ba0fb3f2874da7c375", "url": "https://github.com/apache/hive/commit/990bfd2aaf98ae6477a8d7ba0fb3f2874da7c375", "message": "HIVE-24433 - AutoCompaction is not getting triggered for CamelCase Partition Values", "committedDate": "2020-11-26T21:27:38Z", "type": "forcePushed"}, {"oid": "7ed99e0661d57f256c48f4b9ef95d64d6b6456a7", "url": "https://github.com/apache/hive/commit/7ed99e0661d57f256c48f4b9ef95d64d6b6456a7", "message": "HIVE-24433 - AutoCompaction is not getting triggered for CamelCase Partition Values", "committedDate": "2020-11-27T05:51:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ2MzExNw==", "url": "https://github.com/apache/hive/pull/1712#discussion_r532463117", "bodyText": "@nareshpr , do you know if partition key name (name=value) is already normalized here?", "author": "deniskuzZ", "createdAt": "2020-11-30T09:44:10Z", "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/txn/TxnHandler.java", "diffHunk": "@@ -2725,7 +2725,7 @@ private void insertTxnComponents(long txnid, LockRequest rqst, Connection dbConn\n           }\n           String dbName = normalizeCase(lc.getDbname());\n           String tblName = normalizeCase(lc.getTablename());\n-          String partName = normalizeCase(lc.getPartitionname());\n+          String partName = lc.getPartitionname();", "originalCommit": "7ed99e0661d57f256c48f4b9ef95d64d6b6456a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjgyMTU1Mg==", "url": "https://github.com/apache/hive/pull/1712#discussion_r532821552", "bodyText": "Yes, i validated below 4 SQL's with my patch, partition(key=value) is already normalized\ninsert into table abc PARTITION(CitY='Bangalore') values('Dan');\ninsert overwrite table abc partition(CiTy='Bangalore') select Name from abc;\nupdate table abc set Name='xy' where CiTy='Bangalore';\ndelete from abc where CiTy='Bangalore';", "author": "nareshpr", "createdAt": "2020-11-30T18:48:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ2MzExNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE5NTg0Mg==", "url": "https://github.com/apache/hive/pull/1712#discussion_r533195842", "bodyText": "Could there be an issue with partition key name normalization if HMS API is used outside of Hive, for example via Impala?", "author": "deniskuzZ", "createdAt": "2020-12-01T09:14:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ2MzExNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzY0MDQwMg==", "url": "https://github.com/apache/hive/pull/1712#discussion_r533640402", "bodyText": "I doubt HMS API's will hit this flow. Let me know any example or testcase. If required, i can change code to split key=value & convert key to lowerCase and join. Let me know if that is required.", "author": "nareshpr", "createdAt": "2020-12-01T18:44:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ2MzExNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDk0MDU3MA==", "url": "https://github.com/apache/hive/pull/1712#discussion_r534940570", "bodyText": "Impala uses HMS API for transaction management. They rely on a TxnHandler.lock() method to handle concurrent txns.", "author": "deniskuzZ", "createdAt": "2020-12-03T08:46:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ2MzExNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg5OTQzNg==", "url": "https://github.com/apache/hive/pull/1712#discussion_r535899436", "bodyText": "I changed it to split & convert partition key to lower key.", "author": "nareshpr", "createdAt": "2020-12-04T07:49:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ2MzExNw=="}], "type": "inlineReview"}, {"oid": "c4c3c059f935df37375b0f2df3574d6bde672d30", "url": "https://github.com/apache/hive/commit/c4c3c059f935df37375b0f2df3574d6bde672d30", "message": "HIVE-24433 - AutoCompaction is not getting triggered for CamelCase Partition Values", "committedDate": "2020-12-04T05:06:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTkwNjM5MA==", "url": "https://github.com/apache/hive/pull/1712#discussion_r535906390", "bodyText": "No need for the else clause", "author": "klcopp", "createdAt": "2020-12-04T08:02:50Z", "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/txn/TxnHandler.java", "diffHunk": "@@ -2877,6 +2877,20 @@ private static String normalizeCase(String s) {\n     return s == null ? null : s.toLowerCase();\n   }\n \n+  private static String normalizePartitionCase(String s) {\n+    if (s == null) {\n+      return null;\n+    } else {", "originalCommit": "c4c3c059f935df37375b0f2df3574d6bde672d30", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTkxMDg1MA==", "url": "https://github.com/apache/hive/pull/1712#discussion_r535910850", "bodyText": "@nareshpr, LGTM, however could you please try to reuse FileUtils.makePartName(List partCols, List vals):\nMap<String, String> map = Splitter.on( \"=\" ).withKeyValueSeparator( Path.SEPARATOR ).split(lc.getPartitionname());\nreturn FileUtils.makePartName(new ArrayList<>(map.keySet()), new ArrayList<>(map.values()));", "author": "deniskuzZ", "createdAt": "2020-12-04T08:11:30Z", "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/txn/TxnHandler.java", "diffHunk": "@@ -2877,6 +2877,20 @@ private static String normalizeCase(String s) {\n     return s == null ? null : s.toLowerCase();\n   }\n \n+  private static String normalizePartitionCase(String s) {", "originalCommit": "c4c3c059f935df37375b0f2df3574d6bde672d30", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "31fbd32e013e01f678293f811643751f01de5d94", "url": "https://github.com/apache/hive/commit/31fbd32e013e01f678293f811643751f01de5d94", "message": "HIVE-24433 - AutoCompaction is not getting triggered for CamelCase Partition Values", "committedDate": "2020-12-04T09:24:10Z", "type": "forcePushed"}, {"oid": "782f9528891dde4488414a6f05db2f2cbf13b6f5", "url": "https://github.com/apache/hive/commit/782f9528891dde4488414a6f05db2f2cbf13b6f5", "message": "HIVE-24433 - AutoCompaction is not getting triggered for CamelCase Partition Values", "committedDate": "2020-12-04T17:51:33Z", "type": "forcePushed"}, {"oid": "bd36bc2fe761c50ef75cd696920e5a4f124f086a", "url": "https://github.com/apache/hive/commit/bd36bc2fe761c50ef75cd696920e5a4f124f086a", "message": "HIVE-24433 - AutoCompaction is not getting triggered for CamelCase Partition Values", "committedDate": "2020-12-05T02:02:58Z", "type": "forcePushed"}, {"oid": "9147ad6b6c1ce3deffef600eef9dcced212abddc", "url": "https://github.com/apache/hive/commit/9147ad6b6c1ce3deffef600eef9dcced212abddc", "message": "HIVE-24433 - AutoCompaction is not getting triggered for CamelCase Partition Values", "committedDate": "2020-12-05T02:05:47Z", "type": "commit"}, {"oid": "9147ad6b6c1ce3deffef600eef9dcced212abddc", "url": "https://github.com/apache/hive/commit/9147ad6b6c1ce3deffef600eef9dcced212abddc", "message": "HIVE-24433 - AutoCompaction is not getting triggered for CamelCase Partition Values", "committedDate": "2020-12-05T02:05:47Z", "type": "forcePushed"}]}