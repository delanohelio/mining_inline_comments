{"pr_number": 1064, "pr_title": "HIVE-23624: Add metastore metrics to show the compaction status", "pr_createdAt": "2020-06-05T14:21:33Z", "pr_url": "https://github.com/apache/hive/pull/1064", "timeline": [{"oid": "f58a208b3164e905b8d9504affb647f3ee0f0e22", "url": "https://github.com/apache/hive/commit/f58a208b3164e905b8d9504affb647f3ee0f0e22", "message": "HIVE-23624: Add metastore metrics to show the compaction status", "committedDate": "2020-06-05T14:19:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk2Nzk4OA==", "url": "https://github.com/apache/hive/pull/1064#discussion_r435967988", "bodyText": "element.getPartitionname() can return null, resulting in a key=\"dbName/tableName/null\"", "author": "lcspinter", "createdAt": "2020-06-05T14:41:28Z", "path": "ql/src/java/org/apache/hadoop/hive/ql/txn/compactor/Initiator.java", "diffHunk": "@@ -487,4 +492,31 @@ private boolean isEligibleForCompaction(CompactionInfo ci, ShowCompactResponse c\n     }\n     return true;\n   }\n+\n+  @VisibleForTesting\n+  protected static void updateCompactionMetrics(ShowCompactResponse showCompactResponse) {\n+    Map<String, ShowCompactResponseElement> lastElements = new HashMap<>();\n+\n+    // Get the last compaction for each db/table/partition\n+    for(ShowCompactResponseElement element : showCompactResponse.getCompacts()) {\n+      String key = element.getDbname() + \"/\" + element.getTablename() + \"/\" + element.getPartitionname();", "originalCommit": "f58a208b3164e905b8d9504affb647f3ee0f0e22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk3NTIyOQ==", "url": "https://github.com/apache/hive/pull/1064#discussion_r435975229", "bodyText": "Added null check as suggested.\nThanks!", "author": "pvary", "createdAt": "2020-06-05T14:52:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk2Nzk4OA=="}], "type": "inlineReview"}, {"oid": "199f65fc5e6cb37a21713ac42362aee057d6e3d3", "url": "https://github.com/apache/hive/commit/199f65fc5e6cb37a21713ac42362aee057d6e3d3", "message": "Added null check as Laszlo Pinter suggested", "committedDate": "2020-06-05T14:51:28Z", "type": "commit"}, {"oid": "6fc5d0fa976aae44afe82361ecba9da569b3a852", "url": "https://github.com/apache/hive/commit/6fc5d0fa976aae44afe82361ecba9da569b3a852", "message": "only update  metrics if needed", "committedDate": "2020-06-08T08:02:44Z", "type": "commit"}, {"oid": "d4e4bd6b3614a6ea5989d33bd94fb8984c7f9b4f", "url": "https://github.com/apache/hive/commit/d4e4bd6b3614a6ea5989d33bd94fb8984c7f9b4f", "message": "Fixing pre-commit test failure", "committedDate": "2020-06-08T11:25:22Z", "type": "commit"}]}