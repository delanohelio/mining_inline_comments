{"pr_number": 1795, "pr_title": "HIVE-24550: Cleanup only transaction information for the current DriverContext", "pr_createdAt": "2020-12-18T21:36:05Z", "pr_url": "https://github.com/apache/hive/pull/1795", "timeline": [{"oid": "b6267383d2bc43deb5544ad31d45a970d28c834b", "url": "https://github.com/apache/hive/commit/b6267383d2bc43deb5544ad31d45a970d28c834b", "message": "HIVE-24550: Cleanup only transaction information for the current DriverContext", "committedDate": "2020-12-18T21:31:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI1ODg5OQ==", "url": "https://github.com/apache/hive/pull/1795#discussion_r551258899", "bodyText": "If the TxnManager is handling a new query, would the old transaction be closed correctly?", "author": "pvary", "createdAt": "2021-01-04T11:21:51Z", "path": "ql/src/java/org/apache/hadoop/hive/ql/DriverTxnHandler.java", "diffHunk": "@@ -527,11 +527,15 @@ void release() {\n     release(!hiveLocks.isEmpty());\n   }\n \n-  void destroy() {\n+  void destroy(String queryIdFromDriver) {\n+    // We need cleanup transactions, even if we did not acquired locks yet\n+    // However TxnManager is bound to session, so wee need to check if it is already handling a new query", "originalCommit": "b6267383d2bc43deb5544ad31d45a970d28c834b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3NzE5OA==", "url": "https://github.com/apache/hive/pull/1795#discussion_r551277198", "bodyText": "If txnManager is handling a new query, the previous one must be either committed or aborted otherwise the second query's openTxn call would have failed with an exception.", "author": "pvargacl", "createdAt": "2021-01-04T12:03:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI1ODg5OQ=="}], "type": "inlineReview"}]}