{"pr_number": 1568, "pr_title": "HIVE-24255: StorageHandler with select-limit query is returning 0 rows", "pr_createdAt": "2020-10-09T22:57:50Z", "pr_url": "https://github.com/apache/hive/pull/1568", "timeline": [{"oid": "03345d69a68b573cb8d3af621845761bec4881c9", "url": "https://github.com/apache/hive/commit/03345d69a68b573cb8d3af621845761bec4881c9", "message": "HIVE-24255: StorageHandler with select-limit query is returning 0 rows", "committedDate": "2020-10-12T19:02:54Z", "type": "forcePushed"}, {"oid": "f4627086307828b82a557099b855e792dc8891ad", "url": "https://github.com/apache/hive/commit/f4627086307828b82a557099b855e792dc8891ad", "message": "HIVE-24255: StorageHandler with select-limit query is returning 0 rows", "committedDate": "2020-10-12T21:53:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU4ODQ5MA==", "url": "https://github.com/apache/hive/pull/1568#discussion_r503588490", "bodyText": "Can we move this check to just after getting TableScanOperator i.e. line 94/95? We will avoid un-necessary checkQBpForGlobalLimit and findOperators.", "author": "vineetgarg02", "createdAt": "2020-10-12T23:47:26Z", "path": "ql/src/java/org/apache/hadoop/hive/ql/optimizer/GlobalLimitOptimizer.java", "diffHunk": "@@ -99,27 +99,31 @@ public ParseContext transform(ParseContext pctx) throws SemanticException {\n         LimitDesc tempGlobalLimitDesc = tempGlobalLimit.getConf();\n         Table tab = ts.getConf().getTableMetadata();\n         Set<FilterOperator> filterOps = OperatorUtils.findOperators(ts, FilterOperator.class);\n-\n-        if (!tab.isPartitioned()) {\n-          if (filterOps.size() == 0) {\n-            Integer tempOffset = tempGlobalLimitDesc.getOffset();\n-            globalLimitCtx.enableOpt(tempGlobalLimitDesc.getLimit(),\n-                (tempOffset == null) ? 0 : tempOffset);\n-          }\n-        } else {\n-          // check if the pruner only contains partition columns\n-          if (onlyContainsPartnCols(tab, filterOps)) {\n-\n-            String alias = (String) topOps.keySet().toArray()[0];\n-            PrunedPartitionList partsList = pctx.getPrunedPartitions(alias, ts);\n-\n-            // If there is any unknown partition, create a map-reduce job for\n-            // the filter to prune correctly\n-            if (!partsList.hasUnknownPartitions()) {\n+        // StorageHandlers will always have empty tablePath.\n+        // GenMapRedUtils.setMapWork removes empty tablePath from input dir with select-Limit\n+        // InputFormat.getSplits wont be called if no input path & TS Vertex will have 0 task parallelism\n+        if (tab.getStorageHandler() == null) {", "originalCommit": "f4627086307828b82a557099b855e792dc8891ad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzYwMjM1Nw==", "url": "https://github.com/apache/hive/pull/1568#discussion_r503602357", "bodyText": "Handled in the new commit Vineet. Thanks for review.", "author": "nareshpr", "createdAt": "2020-10-13T00:28:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU4ODQ5MA=="}], "type": "inlineReview"}, {"oid": "c6aa48c262cdfda3a9be3da9bedfee47deb2f0bc", "url": "https://github.com/apache/hive/commit/c6aa48c262cdfda3a9be3da9bedfee47deb2f0bc", "message": "HIVE-24255: StorageHandler with select-limit query is returning 0 rows", "committedDate": "2020-10-13T00:19:27Z", "type": "forcePushed"}, {"oid": "cf464ffaf65ab269a8c954b7985146df5e7132ee", "url": "https://github.com/apache/hive/commit/cf464ffaf65ab269a8c954b7985146df5e7132ee", "message": "HIVE-24255: StorageHandler with select-limit query is returning 0 rows", "committedDate": "2020-10-13T08:09:54Z", "type": "commit"}, {"oid": "cf464ffaf65ab269a8c954b7985146df5e7132ee", "url": "https://github.com/apache/hive/commit/cf464ffaf65ab269a8c954b7985146df5e7132ee", "message": "HIVE-24255: StorageHandler with select-limit query is returning 0 rows", "committedDate": "2020-10-13T08:09:54Z", "type": "forcePushed"}]}