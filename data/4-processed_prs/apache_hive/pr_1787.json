{"pr_number": 1787, "pr_title": "HIVE-24470: Separate HiveMetaStore Thrift and Driver logic", "pr_createdAt": "2020-12-16T01:35:20Z", "pr_url": "https://github.com/apache/hive/pull/1787", "timeline": [{"oid": "396c655ff43b06226267a2d4095050eb08eee4ab", "url": "https://github.com/apache/hive/commit/396c655ff43b06226267a2d4095050eb08eee4ab", "message": "Copy HMSHandler to a separate class out of HiveMetastore", "committedDate": "2020-12-16T01:52:05Z", "type": "forcePushed"}, {"oid": "a669fce5a0c7336d6168851361a4bd5c6e5fa945", "url": "https://github.com/apache/hive/commit/a669fce5a0c7336d6168851361a4bd5c6e5fa945", "message": "Copy HMSHandler to a separate class out of HiveMetastore", "committedDate": "2020-12-16T20:49:50Z", "type": "forcePushed"}, {"oid": "4742788eb76e48fa83fbdf1480aab5d26936c5c6", "url": "https://github.com/apache/hive/commit/4742788eb76e48fa83fbdf1480aab5d26936c5c6", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder", "committedDate": "2020-12-16T21:25:12Z", "type": "forcePushed"}, {"oid": "fdeb88a5d87890a7e747c0d350c9578d2ddbb79f", "url": "https://github.com/apache/hive/commit/fdeb88a5d87890a7e747c0d350c9578d2ddbb79f", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder.", "committedDate": "2020-12-17T00:17:22Z", "type": "forcePushed"}, {"oid": "c4db25db438c66dee59aad40635f4168286a6bfa", "url": "https://github.com/apache/hive/commit/c4db25db438c66dee59aad40635f4168286a6bfa", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder.", "committedDate": "2020-12-17T00:26:01Z", "type": "forcePushed"}, {"oid": "9959e28ba4c7b0d86608a1037ca3e8c1b37814f4", "url": "https://github.com/apache/hive/commit/9959e28ba4c7b0d86608a1037ca3e8c1b37814f4", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder.", "committedDate": "2020-12-17T00:34:12Z", "type": "forcePushed"}, {"oid": "0f941bfd34668de39feb6bc1b200afc26a2c99c8", "url": "https://github.com/apache/hive/commit/0f941bfd34668de39feb6bc1b200afc26a2c99c8", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder.", "committedDate": "2020-12-19T06:57:09Z", "type": "forcePushed"}, {"oid": "f756d12f4f57daf507c729128d3a7443833180e0", "url": "https://github.com/apache/hive/commit/f756d12f4f57daf507c729128d3a7443833180e0", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder.", "committedDate": "2020-12-19T08:05:16Z", "type": "forcePushed"}, {"oid": "66952cf5e3d78ffdf68d4e6c17c2d57edba728c6", "url": "https://github.com/apache/hive/commit/66952cf5e3d78ffdf68d4e6c17c2d57edba728c6", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder.", "committedDate": "2020-12-19T17:53:10Z", "type": "forcePushed"}, {"oid": "ca1fca8f87e068c5aca32c1b71f75aacd8d90929", "url": "https://github.com/apache/hive/commit/ca1fca8f87e068c5aca32c1b71f75aacd8d90929", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder", "committedDate": "2020-12-19T20:09:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg4NzQ0MA==", "url": "https://github.com/apache/hive/pull/1787#discussion_r546887440", "bodyText": "You can remove Constants just like in the previous patch. Same is true for other classes where you've removed unused imports in the previous patch, but not in this one for some reason.", "author": "miklosgergely", "createdAt": "2020-12-21T19:25:05Z", "path": "ql/src/java/org/apache/hadoop/hive/ql/security/authorization/StorageBasedAuthorizationProvider.java", "diffHunk": "@@ -28,7 +28,7 @@\n import javax.security.auth.login.LoginException;\n \n import org.apache.hadoop.hive.conf.Constants;", "originalCommit": "090a3956de518599cefac468953d1a09eb71137a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE0MTQ1MA==", "url": "https://github.com/apache/hive/pull/1787#discussion_r547141450", "bodyText": "Removed", "author": "dataproc-metastore", "createdAt": "2020-12-22T08:38:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg4NzQ0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg4OTc0NQ==", "url": "https://github.com/apache/hive/pull/1787#discussion_r546889745", "bodyText": "Please fix the indentation. There are a lot of other indentation issues introduced since the last version (also some fixed). Please run a checkstyle check (mvn checkstyle:checkstyle) on the metastore-server project, and fix at least the indentation issues in the HMSHandler class (preferably all the other issues too in this class).", "author": "miklosgergely", "createdAt": "2020-12-21T19:30:38Z", "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/HMSHandler.java", "diffHunk": "@@ -0,0 +1,10189 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hive.metastore;\n+\n+import com.codahale.metrics.Counter;\n+import com.codahale.metrics.Timer;\n+import com.facebook.fb303.FacebookBase;\n+import com.facebook.fb303.fb_status;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Preconditions;\n+import com.google.common.base.Splitter;\n+import com.google.common.base.Supplier;\n+import com.google.common.base.Suppliers;\n+import com.google.common.collect.Lists;\n+import com.google.common.util.concurrent.ThreadFactoryBuilder;\n+import org.apache.commons.collections.CollectionUtils;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileStatus;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.hive.common.AcidConstants;\n+import org.apache.hadoop.hive.common.AcidMetaDataFile;\n+import org.apache.hadoop.hive.common.StatsSetupConst;\n+import org.apache.hadoop.hive.common.TableName;\n+import org.apache.hadoop.hive.common.ValidReaderWriteIdList;\n+import org.apache.hadoop.hive.common.ValidWriteIdList;\n+import org.apache.hadoop.hive.common.repl.ReplConst;\n+import org.apache.hadoop.hive.metastore.api.*;\n+import org.apache.hadoop.hive.metastore.conf.MetastoreConf;\n+import org.apache.hadoop.hive.metastore.conf.MetastoreConf.ConfVars;\n+import org.apache.hadoop.hive.metastore.events.AbortTxnEvent;\n+import org.apache.hadoop.hive.metastore.events.AcidWriteEvent;\n+import org.apache.hadoop.hive.metastore.events.AddCheckConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AddDefaultConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AddForeignKeyEvent;\n+import org.apache.hadoop.hive.metastore.events.AddNotNullConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AddPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.AddPrimaryKeyEvent;\n+import org.apache.hadoop.hive.metastore.events.AddSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.AddUniqueConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AllocWriteIdEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterTableEvent;\n+import org.apache.hadoop.hive.metastore.events.CommitTxnEvent;\n+import org.apache.hadoop.hive.metastore.events.CommitCompactionEvent;\n+import org.apache.hadoop.hive.metastore.events.ConfigChangeEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateFunctionEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateTableEvent;\n+import org.apache.hadoop.hive.metastore.events.DeletePartitionColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.events.DeleteTableColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.events.DropCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.DropConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.DropDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.DropFunctionEvent;\n+import org.apache.hadoop.hive.metastore.events.DropISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.DropPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.DropSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.DropTableEvent;\n+import org.apache.hadoop.hive.metastore.events.InsertEvent;\n+import org.apache.hadoop.hive.metastore.events.LoadPartitionDoneEvent;\n+import org.apache.hadoop.hive.metastore.events.OpenTxnEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAddPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAddSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAuthorizationCallEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreEventContext;\n+import org.apache.hadoop.hive.metastore.events.PreLoadPartitionDoneEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadhSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.UpdatePartitionColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.events.UpdateTableColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.messaging.EventMessage;\n+import org.apache.hadoop.hive.metastore.messaging.EventMessage.EventType;\n+import org.apache.hadoop.hive.metastore.metrics.Metrics;\n+import org.apache.hadoop.hive.metastore.metrics.MetricsConstants;\n+import org.apache.hadoop.hive.metastore.metrics.PerfLogger;\n+import org.apache.hadoop.hive.metastore.partition.spec.PartitionSpecProxy;\n+import org.apache.hadoop.hive.metastore.txn.CompactionInfo;\n+import org.apache.hadoop.hive.metastore.txn.TxnStore;\n+import org.apache.hadoop.hive.metastore.txn.TxnUtils;\n+import org.apache.hadoop.hive.metastore.utils.FileUtils;\n+import org.apache.hadoop.hive.metastore.utils.FilterUtils;\n+import org.apache.hadoop.hive.metastore.utils.HdfsUtils;\n+import org.apache.hadoop.hive.metastore.utils.JavaUtils;\n+import org.apache.hadoop.hive.metastore.utils.MetaStoreServerUtils;\n+import org.apache.hadoop.hive.metastore.utils.MetaStoreUtils;\n+import org.apache.hadoop.hive.metastore.utils.MetastoreVersionInfo;\n+import org.apache.hadoop.hive.metastore.utils.SecurityUtils;\n+import org.apache.hadoop.security.UserGroupInformation;\n+import org.apache.hadoop.util.ReflectionUtils;\n+import org.apache.thrift.TException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import javax.jdo.JDOException;\n+import java.io.IOException;\n+import java.lang.reflect.Constructor;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Modifier;\n+import java.lang.reflect.UndeclaredThrowableException;\n+import java.nio.ByteBuffer;\n+import java.security.PrivilegedExceptionAction;\n+import java.util.AbstractMap;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.BitSet;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.LinkedHashMap;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.Future;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+import java.util.concurrent.atomic.AtomicInteger;\n+import java.util.regex.Pattern;\n+\n+import static org.apache.commons.lang3.StringUtils.isBlank;\n+import static org.apache.commons.lang3.StringUtils.join;\n+import static org.apache.hadoop.hive.metastore.Warehouse.DEFAULT_CATALOG_NAME;\n+import static org.apache.hadoop.hive.metastore.Warehouse.DEFAULT_DATABASE_COMMENT;\n+import static org.apache.hadoop.hive.metastore.Warehouse.DEFAULT_DATABASE_NAME;\n+import static org.apache.hadoop.hive.metastore.Warehouse.getCatalogQualifiedTableName;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.CAT_NAME;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.DB_NAME;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.getDefaultCatalog;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.parseDbName;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.prependCatalogToDbName;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.prependNotNullCatToDbName;\n+\n+public class HMSHandler extends FacebookBase implements IHMSHandler {\n+  public static final Logger LOG = LoggerFactory.getLogger(HMSHandler.class);\n+  private final Configuration conf; // stores datastore (jpox) properties,\n+                                   // right now they come from jpox.properties\n+\n+  // Flag to control that always threads are initialized only once\n+  // instead of multiple times\n+  private final static AtomicBoolean alwaysThreadsInitialized =\n+      new AtomicBoolean(false);\n+\n+  private static String currentUrl;\n+  private FileMetadataManager fileMetadataManager;\n+  private PartitionExpressionProxy expressionProxy;\n+  private StorageSchemaReader storageSchemaReader;\n+  private IMetaStoreMetadataTransformer transformer;\n+\n+  // Variables for metrics\n+  // Package visible so that HMSMetricsListener can see them.\n+  static AtomicInteger databaseCount, tableCount, partCount;\n+\n+  public static final String PARTITION_NUMBER_EXCEED_LIMIT_MSG =\n+      \"Number of partitions scanned (=%d) on table '%s' exceeds limit (=%d). This is controlled on the metastore server by %s.\";\n+\n+  // Used for testing to simulate method timeout.\n+  @VisibleForTesting\n+  static boolean TEST_TIMEOUT_ENABLED = false;\n+  @VisibleForTesting\n+  static long TEST_TIMEOUT_VALUE = -1;\n+\n+  public static final String ADMIN = \"admin\";\n+  public static final String PUBLIC = \"public\";\n+\n+  static final String NO_FILTER_STRING = \"\";\n+  static final int UNLIMITED_MAX_PARTITIONS = -1;\n+\n+  private Warehouse wh; // hdfs warehouse\n+  private static final ThreadLocal<RawStore> threadLocalMS =\n+      new ThreadLocal<RawStore>() {\n+        @Override\n+        protected RawStore initialValue() {\n+          return null;\n+        }\n+      };\n+\n+  private static final ThreadLocal<TxnStore> threadLocalTxn = new ThreadLocal<TxnStore>() {\n+    @Override\n+    protected TxnStore initialValue() {\n+      return null;\n+    }\n+  };\n+\n+  private static final ThreadLocal<Map<String, com.codahale.metrics.Timer.Context>> timerContexts =\n+      new ThreadLocal<Map<String, com.codahale.metrics.Timer.Context>>() {\n+    @Override", "originalCommit": "090a3956de518599cefac468953d1a09eb71137a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE5MjMyNQ==", "url": "https://github.com/apache/hive/pull/1787#discussion_r547192325", "bodyText": "Fixed the indentation in HMSHandler and HiveMetaStore. Some of the issues in HMSHandler stem from mismatch of Thrift method names and checkstyle rules, I don't think they are touchable. I fixed many others, WDYT now?", "author": "dataproc-metastore", "createdAt": "2020-12-22T10:20:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg4OTc0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzM0MzE5MQ==", "url": "https://github.com/apache/hive/pull/1787#discussion_r547343191", "bodyText": "Sure, no need to fix those. Thanks!", "author": "miklosgergely", "createdAt": "2020-12-22T15:31:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg4OTc0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5OTk5Mg==", "url": "https://github.com/apache/hive/pull/1787#discussion_r546899992", "bodyText": "Unnecessary import.", "author": "miklosgergely", "createdAt": "2020-12-21T19:52:42Z", "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/TSetIpAddressProcessor.java", "diffHunk": "@@ -21,7 +21,7 @@\n import java.lang.reflect.InvocationTargetException;\n import java.net.Socket;\n \n-import org.apache.hadoop.hive.metastore.HiveMetaStore.HMSHandler;\n+import org.apache.hadoop.hive.metastore.HMSHandler;", "originalCommit": "090a3956de518599cefac468953d1a09eb71137a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE0MTI2MA==", "url": "https://github.com/apache/hive/pull/1787#discussion_r547141260", "bodyText": "Fixed, thanks!", "author": "dataproc-metastore", "createdAt": "2020-12-22T08:38:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5OTk5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkwMDk1OA==", "url": "https://github.com/apache/hive/pull/1787#discussion_r546900958", "bodyText": "Unnecessary import.", "author": "miklosgergely", "createdAt": "2020-12-21T19:55:03Z", "path": "standalone-metastore/metastore-server/src/test/java/org/apache/hadoop/hive/metastore/IpAddressListener.java", "diffHunk": "@@ -22,7 +22,7 @@\n import java.net.UnknownHostException;\n \n import org.apache.hadoop.conf.Configuration;\n-import org.apache.hadoop.hive.metastore.HiveMetaStore.HMSHandler;\n+import org.apache.hadoop.hive.metastore.HMSHandler;", "originalCommit": "090a3956de518599cefac468953d1a09eb71137a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE0MTMxNA==", "url": "https://github.com/apache/hive/pull/1787#discussion_r547141314", "bodyText": "Fixed!", "author": "dataproc-metastore", "createdAt": "2020-12-22T08:38:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkwMDk1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODU0ODIwMQ==", "url": "https://github.com/apache/hive/pull/1787#discussion_r558548201", "bodyText": "Since this is top level class, can you add a class level comment here on what is the main purpose of this class and any additional useful details to know for someone who is not familiar with code?", "author": "vihangk1", "createdAt": "2021-01-15T19:31:51Z", "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/HMSHandler.java", "diffHunk": "@@ -0,0 +1,10155 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hive.metastore;\n+\n+import com.codahale.metrics.Counter;\n+import com.codahale.metrics.Timer;\n+import com.facebook.fb303.FacebookBase;\n+import com.facebook.fb303.fb_status;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Preconditions;\n+import com.google.common.base.Splitter;\n+import com.google.common.base.Supplier;\n+import com.google.common.base.Suppliers;\n+import com.google.common.collect.Lists;\n+import com.google.common.util.concurrent.ThreadFactoryBuilder;\n+import org.apache.commons.collections.CollectionUtils;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileStatus;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.hive.common.AcidConstants;\n+import org.apache.hadoop.hive.common.AcidMetaDataFile;\n+import org.apache.hadoop.hive.common.StatsSetupConst;\n+import org.apache.hadoop.hive.common.TableName;\n+import org.apache.hadoop.hive.common.ValidReaderWriteIdList;\n+import org.apache.hadoop.hive.common.ValidWriteIdList;\n+import org.apache.hadoop.hive.common.repl.ReplConst;\n+import org.apache.hadoop.hive.metastore.api.*;\n+import org.apache.hadoop.hive.metastore.conf.MetastoreConf;\n+import org.apache.hadoop.hive.metastore.events.AbortTxnEvent;\n+import org.apache.hadoop.hive.metastore.events.AcidWriteEvent;\n+import org.apache.hadoop.hive.metastore.events.AddCheckConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AddDefaultConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AddForeignKeyEvent;\n+import org.apache.hadoop.hive.metastore.events.AddNotNullConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AddPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.AddPrimaryKeyEvent;\n+import org.apache.hadoop.hive.metastore.events.AddSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.AddUniqueConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AllocWriteIdEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterTableEvent;\n+import org.apache.hadoop.hive.metastore.events.CommitTxnEvent;\n+import org.apache.hadoop.hive.metastore.events.ConfigChangeEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateFunctionEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateTableEvent;\n+import org.apache.hadoop.hive.metastore.events.DeletePartitionColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.events.DeleteTableColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.events.DropCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.DropConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.DropDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.DropFunctionEvent;\n+import org.apache.hadoop.hive.metastore.events.DropISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.DropPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.DropSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.DropTableEvent;\n+import org.apache.hadoop.hive.metastore.events.InsertEvent;\n+import org.apache.hadoop.hive.metastore.events.LoadPartitionDoneEvent;\n+import org.apache.hadoop.hive.metastore.events.OpenTxnEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAddPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAddSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAuthorizationCallEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreEventContext;\n+import org.apache.hadoop.hive.metastore.events.PreLoadPartitionDoneEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadhSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.UpdatePartitionColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.events.UpdateTableColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.messaging.EventMessage;\n+import org.apache.hadoop.hive.metastore.metrics.Metrics;\n+import org.apache.hadoop.hive.metastore.metrics.MetricsConstants;\n+import org.apache.hadoop.hive.metastore.metrics.PerfLogger;\n+import org.apache.hadoop.hive.metastore.partition.spec.PartitionSpecProxy;\n+import org.apache.hadoop.hive.metastore.txn.CompactionInfo;\n+import org.apache.hadoop.hive.metastore.txn.TxnStore;\n+import org.apache.hadoop.hive.metastore.txn.TxnUtils;\n+import org.apache.hadoop.hive.metastore.utils.FileUtils;\n+import org.apache.hadoop.hive.metastore.utils.FilterUtils;\n+import org.apache.hadoop.hive.metastore.utils.HdfsUtils;\n+import org.apache.hadoop.hive.metastore.utils.JavaUtils;\n+import org.apache.hadoop.hive.metastore.utils.MetaStoreServerUtils;\n+import org.apache.hadoop.hive.metastore.utils.MetaStoreUtils;\n+import org.apache.hadoop.hive.metastore.utils.MetastoreVersionInfo;\n+import org.apache.hadoop.hive.metastore.utils.SecurityUtils;\n+import org.apache.hadoop.security.UserGroupInformation;\n+import org.apache.hadoop.util.ReflectionUtils;\n+import org.apache.thrift.TException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import javax.jdo.JDOException;\n+import java.io.IOException;\n+import java.lang.reflect.Constructor;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Modifier;\n+import java.lang.reflect.UndeclaredThrowableException;\n+import java.nio.ByteBuffer;\n+import java.security.PrivilegedExceptionAction;\n+import java.util.AbstractMap;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.BitSet;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.LinkedHashMap;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.Future;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+import java.util.concurrent.atomic.AtomicInteger;\n+import java.util.regex.Pattern;\n+\n+import static org.apache.commons.lang3.StringUtils.isBlank;\n+import static org.apache.commons.lang3.StringUtils.join;\n+import static org.apache.hadoop.hive.metastore.Warehouse.DEFAULT_CATALOG_NAME;\n+import static org.apache.hadoop.hive.metastore.Warehouse.DEFAULT_DATABASE_COMMENT;\n+import static org.apache.hadoop.hive.metastore.Warehouse.DEFAULT_DATABASE_NAME;\n+import static org.apache.hadoop.hive.metastore.Warehouse.getCatalogQualifiedTableName;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.CAT_NAME;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.DB_NAME;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.getDefaultCatalog;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.parseDbName;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.prependCatalogToDbName;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.prependNotNullCatToDbName;\n+\n+public class HMSHandler extends FacebookBase implements IHMSHandler {", "originalCommit": "948f06762577c5be35d34ee95149b7493685396a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTE5MDA2MQ==", "url": "https://github.com/apache/hive/pull/1787#discussion_r559190061", "bodyText": "Sure, will do.", "author": "dataproc-metastore", "createdAt": "2021-01-17T14:34:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODU0ODIwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODU0OTAzNQ==", "url": "https://github.com/apache/hive/pull/1787#discussion_r558549035", "bodyText": "Is this a copy of the nested class or did you have to make any changes to it? If yes, can you please describe the changes so that it is easier to review?", "author": "vihangk1", "createdAt": "2021-01-15T19:32:50Z", "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/HMSHandler.java", "diffHunk": "@@ -0,0 +1,10155 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hive.metastore;\n+\n+import com.codahale.metrics.Counter;\n+import com.codahale.metrics.Timer;\n+import com.facebook.fb303.FacebookBase;\n+import com.facebook.fb303.fb_status;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Preconditions;\n+import com.google.common.base.Splitter;\n+import com.google.common.base.Supplier;\n+import com.google.common.base.Suppliers;\n+import com.google.common.collect.Lists;\n+import com.google.common.util.concurrent.ThreadFactoryBuilder;\n+import org.apache.commons.collections.CollectionUtils;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileStatus;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.hive.common.AcidConstants;\n+import org.apache.hadoop.hive.common.AcidMetaDataFile;\n+import org.apache.hadoop.hive.common.StatsSetupConst;\n+import org.apache.hadoop.hive.common.TableName;\n+import org.apache.hadoop.hive.common.ValidReaderWriteIdList;\n+import org.apache.hadoop.hive.common.ValidWriteIdList;\n+import org.apache.hadoop.hive.common.repl.ReplConst;\n+import org.apache.hadoop.hive.metastore.api.*;\n+import org.apache.hadoop.hive.metastore.conf.MetastoreConf;\n+import org.apache.hadoop.hive.metastore.events.AbortTxnEvent;\n+import org.apache.hadoop.hive.metastore.events.AcidWriteEvent;\n+import org.apache.hadoop.hive.metastore.events.AddCheckConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AddDefaultConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AddForeignKeyEvent;\n+import org.apache.hadoop.hive.metastore.events.AddNotNullConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AddPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.AddPrimaryKeyEvent;\n+import org.apache.hadoop.hive.metastore.events.AddSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.AddUniqueConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AllocWriteIdEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterTableEvent;\n+import org.apache.hadoop.hive.metastore.events.CommitTxnEvent;\n+import org.apache.hadoop.hive.metastore.events.ConfigChangeEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateFunctionEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateTableEvent;\n+import org.apache.hadoop.hive.metastore.events.DeletePartitionColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.events.DeleteTableColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.events.DropCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.DropConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.DropDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.DropFunctionEvent;\n+import org.apache.hadoop.hive.metastore.events.DropISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.DropPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.DropSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.DropTableEvent;\n+import org.apache.hadoop.hive.metastore.events.InsertEvent;\n+import org.apache.hadoop.hive.metastore.events.LoadPartitionDoneEvent;\n+import org.apache.hadoop.hive.metastore.events.OpenTxnEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAddPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAddSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAuthorizationCallEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreEventContext;\n+import org.apache.hadoop.hive.metastore.events.PreLoadPartitionDoneEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadhSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.UpdatePartitionColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.events.UpdateTableColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.messaging.EventMessage;\n+import org.apache.hadoop.hive.metastore.metrics.Metrics;\n+import org.apache.hadoop.hive.metastore.metrics.MetricsConstants;\n+import org.apache.hadoop.hive.metastore.metrics.PerfLogger;\n+import org.apache.hadoop.hive.metastore.partition.spec.PartitionSpecProxy;\n+import org.apache.hadoop.hive.metastore.txn.CompactionInfo;\n+import org.apache.hadoop.hive.metastore.txn.TxnStore;\n+import org.apache.hadoop.hive.metastore.txn.TxnUtils;\n+import org.apache.hadoop.hive.metastore.utils.FileUtils;\n+import org.apache.hadoop.hive.metastore.utils.FilterUtils;\n+import org.apache.hadoop.hive.metastore.utils.HdfsUtils;\n+import org.apache.hadoop.hive.metastore.utils.JavaUtils;\n+import org.apache.hadoop.hive.metastore.utils.MetaStoreServerUtils;\n+import org.apache.hadoop.hive.metastore.utils.MetaStoreUtils;\n+import org.apache.hadoop.hive.metastore.utils.MetastoreVersionInfo;\n+import org.apache.hadoop.hive.metastore.utils.SecurityUtils;\n+import org.apache.hadoop.security.UserGroupInformation;\n+import org.apache.hadoop.util.ReflectionUtils;\n+import org.apache.thrift.TException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import javax.jdo.JDOException;\n+import java.io.IOException;\n+import java.lang.reflect.Constructor;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Modifier;\n+import java.lang.reflect.UndeclaredThrowableException;\n+import java.nio.ByteBuffer;\n+import java.security.PrivilegedExceptionAction;\n+import java.util.AbstractMap;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.BitSet;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.LinkedHashMap;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.Future;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+import java.util.concurrent.atomic.AtomicInteger;\n+import java.util.regex.Pattern;\n+\n+import static org.apache.commons.lang3.StringUtils.isBlank;\n+import static org.apache.commons.lang3.StringUtils.join;\n+import static org.apache.hadoop.hive.metastore.Warehouse.DEFAULT_CATALOG_NAME;\n+import static org.apache.hadoop.hive.metastore.Warehouse.DEFAULT_DATABASE_COMMENT;\n+import static org.apache.hadoop.hive.metastore.Warehouse.DEFAULT_DATABASE_NAME;\n+import static org.apache.hadoop.hive.metastore.Warehouse.getCatalogQualifiedTableName;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.CAT_NAME;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.DB_NAME;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.getDefaultCatalog;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.parseDbName;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.prependCatalogToDbName;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.prependNotNullCatToDbName;\n+\n+public class HMSHandler extends FacebookBase implements IHMSHandler {", "originalCommit": "948f06762577c5be35d34ee95149b7493685396a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTE4OTU1OQ==", "url": "https://github.com/apache/hive/pull/1787#discussion_r559189559", "bodyText": "I changed only some access modifiers that were necessary for HiveMetaStore to work. Other than that, it's a 1:1 copy.", "author": "dataproc-metastore", "createdAt": "2021-01-17T14:29:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODU0OTAzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODU1MDE2Mw==", "url": "https://github.com/apache/hive/pull/1787#discussion_r558550163", "bodyText": "This method is exclusively doing all the operations in HMSHandler. Does it make sense to have this method here?", "author": "vihangk1", "createdAt": "2021-01-15T19:35:20Z", "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java", "diffHunk": "@@ -10740,7 +10740,7 @@ private static String getServerHostName() throws Exception {\n     }\n   }\n \n-  private static void cleanupRawStore() {\n+  static void cleanupRawStore() {", "originalCommit": "948f06762577c5be35d34ee95149b7493685396a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTE4OTU2Mg==", "url": "https://github.com/apache/hive/pull/1787#discussion_r559189562", "bodyText": "I'm not sure, I'll move it to HMSHandler. Thanks!", "author": "dataproc-metastore", "createdAt": "2021-01-17T14:29:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODU1MDE2Mw=="}], "type": "inlineReview"}, {"oid": "84d36d307e4d9a8b8ecb8399a2ab1dc5bb9996d9", "url": "https://github.com/apache/hive/commit/84d36d307e4d9a8b8ecb8399a2ab1dc5bb9996d9", "message": "Move new features from HiveMetaStore.HMSHandler to standalone HMSHandler to resolve merge conflicts", "committedDate": "2021-01-22T16:25:37Z", "type": "forcePushed"}, {"oid": "ee7b44e169f0fde4da2ceb83bba3517593a81a5c", "url": "https://github.com/apache/hive/commit/ee7b44e169f0fde4da2ceb83bba3517593a81a5c", "message": "Copy HMSHandler to a separate class out of HiveMetastore", "committedDate": "2021-01-31T19:57:31Z", "type": "commit"}, {"oid": "0c49ab9352b6d7588d5b44e2b965e1781b7cc027", "url": "https://github.com/apache/hive/commit/0c49ab9352b6d7588d5b44e2b965e1781b7cc027", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder", "committedDate": "2021-01-31T19:57:54Z", "type": "commit"}, {"oid": "72f53dca34e9e69ad8debf285715023aa6fa9258", "url": "https://github.com/apache/hive/commit/72f53dca34e9e69ad8debf285715023aa6fa9258", "message": "Remove unused imports in HiveMetaStore", "committedDate": "2021-01-31T19:57:58Z", "type": "commit"}, {"oid": "e122199482cb381a07652986889b576e166581c9", "url": "https://github.com/apache/hive/commit/e122199482cb381a07652986889b576e166581c9", "message": "Remove unused imports", "committedDate": "2021-01-31T19:57:58Z", "type": "commit"}, {"oid": "99815d0369078f23389c1db1280090487c1432c9", "url": "https://github.com/apache/hive/commit/99815d0369078f23389c1db1280090487c1432c9", "message": "Fix indentation and other Checkstyle violations in HMSHandler, HiveMetaStore, HMSMetricsListener, HiveMetaStoreChecker, TestHiveMetaStoreTimeout, IHMSHandler", "committedDate": "2021-01-31T19:57:58Z", "type": "commit"}, {"oid": "5d7f508c3ca5975e504cb0b4befe84a6760fcc87", "url": "https://github.com/apache/hive/commit/5d7f508c3ca5975e504cb0b4befe84a6760fcc87", "message": "Move cleanupRawStore method from HiveMetaStore to HMSHandler. Add a class-level comment to HMSHandler", "committedDate": "2021-01-31T19:57:59Z", "type": "commit"}, {"oid": "611f14714864f8e852646179c1e3d5dec69e5414", "url": "https://github.com/apache/hive/commit/611f14714864f8e852646179c1e3d5dec69e5414", "message": "Move new features from HiveMetaStore.HMSHandler to standalone HMSHandler to resolve merge conflicts", "committedDate": "2021-01-31T19:57:59Z", "type": "commit"}, {"oid": "611f14714864f8e852646179c1e3d5dec69e5414", "url": "https://github.com/apache/hive/commit/611f14714864f8e852646179c1e3d5dec69e5414", "message": "Move new features from HiveMetaStore.HMSHandler to standalone HMSHandler to resolve merge conflicts", "committedDate": "2021-01-31T19:57:59Z", "type": "forcePushed"}, {"oid": "109f30be4f3661dce5fde2a9f2bd1967db15d2e7", "url": "https://github.com/apache/hive/commit/109f30be4f3661dce5fde2a9f2bd1967db15d2e7", "message": "Modify HMSHanlder to merge changes from HIVE-24667", "committedDate": "2021-01-31T20:20:09Z", "type": "forcePushed"}, {"oid": "7f1f72e41b6a33c27700b64ee5db5b561d63b660", "url": "https://github.com/apache/hive/commit/7f1f72e41b6a33c27700b64ee5db5b561d63b660", "message": "Modify HMSHanlder to merge changes from HIVE-24667.", "committedDate": "2021-02-01T00:39:21Z", "type": "forcePushed"}, {"oid": "bc15db7427f291725813d61f0791ca6754c5aed0", "url": "https://github.com/apache/hive/commit/bc15db7427f291725813d61f0791ca6754c5aed0", "message": "Modify HMSHanlder to merge changes from HIVE-24667", "committedDate": "2021-02-01T03:04:40Z", "type": "forcePushed"}, {"oid": "203fd72c373c33cb267754d8fa02a720da05ef65", "url": "https://github.com/apache/hive/commit/203fd72c373c33cb267754d8fa02a720da05ef65", "message": "Modify HMSHanlder to merge changes from HIVE-24667.", "committedDate": "2021-02-01T17:01:27Z", "type": "forcePushed"}, {"oid": "a2894240c7370117e1a04129fa6f032a98b7b9ff", "url": "https://github.com/apache/hive/commit/a2894240c7370117e1a04129fa6f032a98b7b9ff", "message": "Modify HMSHanlder to merge changes from HIVE-24667", "committedDate": "2021-02-02T00:20:27Z", "type": "commit"}, {"oid": "a2894240c7370117e1a04129fa6f032a98b7b9ff", "url": "https://github.com/apache/hive/commit/a2894240c7370117e1a04129fa6f032a98b7b9ff", "message": "Modify HMSHanlder to merge changes from HIVE-24667", "committedDate": "2021-02-02T00:20:27Z", "type": "forcePushed"}]}