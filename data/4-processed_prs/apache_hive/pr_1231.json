{"pr_number": 1231, "pr_title": "HIVE-23822 Sorted dynamic partition optimization could remove auto stat task", "pr_createdAt": "2020-07-08T22:59:25Z", "pr_url": "https://github.com/apache/hive/pull/1231", "timeline": [{"oid": "f0d78b9ed74f0e9affb19a099e68119ab4d2833c", "url": "https://github.com/apache/hive/commit/f0d78b9ed74f0e9affb19a099e68119ab4d2833c", "message": "HIVE-23822 Sorted dynamic partition optimization could remove auto stat task", "committedDate": "2020-07-09T19:33:47Z", "type": "forcePushed"}, {"oid": "719090e0c6bc276027c650198ceb892fc70a9fb1", "url": "https://github.com/apache/hive/commit/719090e0c6bc276027c650198ceb892fc70a9fb1", "message": "HIVE-23822 Sorted dynamic partition optimization could remove auto stat task", "committedDate": "2020-07-10T18:01:54Z", "type": "forcePushed"}, {"oid": "9cc0f986765c066d15c326a16980a5c945c13dfd", "url": "https://github.com/apache/hive/commit/9cc0f986765c066d15c326a16980a5c945c13dfd", "message": "HIVE-23822 Sorted dynamic partition optimization could remove auto stat task", "committedDate": "2020-07-13T20:08:29Z", "type": "forcePushed"}, {"oid": "a030d50eebbf43c84528b2ec006cd39ef13cd1d5", "url": "https://github.com/apache/hive/commit/a030d50eebbf43c84528b2ec006cd39ef13cd1d5", "message": "HIVE-23822 Sorted dynamic partition optimization could remove auto stat task.", "committedDate": "2020-07-14T00:44:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA5MjE4Ng==", "url": "https://github.com/apache/hive/pull/1231#discussion_r454092186", "bodyText": "In which case would we have a RS with multiple children? I thought this would never happen. Can we leave a comment explaining it? Otherwise, we should add a Precondition with number of children 1.", "author": "jcamachor", "createdAt": "2020-07-14T04:27:29Z", "path": "ql/src/java/org/apache/hadoop/hive/ql/optimizer/SortedDynPartitionOptimizer.java", "diffHunk": "@@ -409,26 +409,54 @@ private boolean removeRSInsertedByEnforceBucketing(FileSinkOperator fsOp) {\n       // and grand child\n       if (found) {\n         Operator<? extends OperatorDesc> rsParent = rsToRemove.getParentOperators().get(0);\n-        Operator<? extends OperatorDesc> rsChild = rsToRemove.getChildOperators().get(0);\n-        Operator<? extends OperatorDesc> rsGrandChild = rsChild.getChildOperators().get(0);\n-\n-        if (rsChild instanceof SelectOperator) {\n-          // if schema size cannot be matched, then it could be because of constant folding\n-          // converting partition column expression to constant expression. The constant\n-          // expression will then get pruned by column pruner since it will not reference to\n-          // any columns.\n-          if (rsParent.getSchema().getSignature().size() !=\n-              rsChild.getSchema().getSignature().size()) {\n+        List<Operator<? extends OperatorDesc>> rsChildren = rsToRemove.getChildOperators();\n+\n+        Operator<? extends OperatorDesc> rsChildToRemove = null;\n+\n+        for (Operator<? extends OperatorDesc> rsChild : rsChildren) {", "originalCommit": "a030d50eebbf43c84528b2ec006cd39ef13cd1d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ2MjM4Mw==", "url": "https://github.com/apache/hive/pull/1231#discussion_r454462383", "bodyText": "I assumed that this could be possibility and therefore accounted for it, but if this assumption is wrong I update the code.", "author": "vineetgarg02", "createdAt": "2020-07-14T15:55:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA5MjE4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ2NDI5Ng==", "url": "https://github.com/apache/hive/pull/1231#discussion_r454464296", "bodyText": "Yes, there should not be a RS with multiple children, we can simplify that code. You can even add an assert to the new code to make sure.", "author": "jcamachor", "createdAt": "2020-07-14T15:57:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA5MjE4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUxMTQyOA==", "url": "https://github.com/apache/hive/pull/1231#discussion_r454511428", "bodyText": "@jcamachor I have addressed in latest commit.", "author": "vineetgarg02", "createdAt": "2020-07-14T17:10:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA5MjE4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY0NTE1MA==", "url": "https://github.com/apache/hive/pull/1231#discussion_r454645150", "bodyText": "@jcamachor all tests passed.", "author": "vineetgarg02", "createdAt": "2020-07-14T21:06:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA5MjE4Ng=="}], "type": "inlineReview"}, {"oid": "5b02c5e55cf64a28dc601697ce0f7ff88b0e43cb", "url": "https://github.com/apache/hive/commit/5b02c5e55cf64a28dc601697ce0f7ff88b0e43cb", "message": "HIVE-23822 Sorted dynamic partition optimization could remove auto stat task.", "committedDate": "2020-07-14T17:05:37Z", "type": "commit"}, {"oid": "4da601069ed5a26bae488a8a4698a9611e6a7858", "url": "https://github.com/apache/hive/commit/4da601069ed5a26bae488a8a4698a9611e6a7858", "message": "Addressing review comments", "committedDate": "2020-07-14T17:07:44Z", "type": "commit"}, {"oid": "4da601069ed5a26bae488a8a4698a9611e6a7858", "url": "https://github.com/apache/hive/commit/4da601069ed5a26bae488a8a4698a9611e6a7858", "message": "Addressing review comments", "committedDate": "2020-07-14T17:07:44Z", "type": "forcePushed"}]}