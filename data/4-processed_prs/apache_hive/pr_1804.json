{"pr_number": 1804, "pr_title": "HIVE-24558 : Handle update in table level regular expression", "pr_createdAt": "2020-12-22T09:34:14Z", "pr_url": "https://github.com/apache/hive/pull/1804", "timeline": [{"oid": "9e9f15745a5f584983496c6feb7734998344b7d3", "url": "https://github.com/apache/hive/commit/9e9f15745a5f584983496c6feb7734998344b7d3", "message": "HIVE-24558 : Handle update in table level regular expression", "committedDate": "2020-12-22T10:52:11Z", "type": "forcePushed"}, {"oid": "5bc9524b591ee1468825a770b73e143d5699b641", "url": "https://github.com/apache/hive/commit/5bc9524b591ee1468825a770b73e143d5699b641", "message": "HIVE-24558 : Handle update in table level regular expression", "committedDate": "2020-12-23T13:04:54Z", "type": "forcePushed"}, {"oid": "fbed68b1b7fd28bed06b93063f9a50133191abf3", "url": "https://github.com/apache/hive/commit/fbed68b1b7fd28bed06b93063f9a50133191abf3", "message": "HIVE-24558 : Handle update in table level regular expression", "committedDate": "2020-12-23T13:50:35Z", "type": "forcePushed"}, {"oid": "6dc8dcc574441d6a7755667faf64dad5d9a4a348", "url": "https://github.com/apache/hive/commit/6dc8dcc574441d6a7755667faf64dad5d9a4a348", "message": "HIVE-24558 : Handle update in table level regular expression", "committedDate": "2020-12-24T13:53:46Z", "type": "forcePushed"}, {"oid": "f3fd18359136568cfb618097363fc9d2f0b0e5a5", "url": "https://github.com/apache/hive/commit/f3fd18359136568cfb618097363fc9d2f0b0e5a5", "message": "HIVE-24558 : Handle update in table level regular expression", "committedDate": "2021-01-04T18:41:44Z", "type": "forcePushed"}, {"oid": "dd929520b0cbf71879383db845ed4dc83be5de19", "url": "https://github.com/apache/hive/commit/dd929520b0cbf71879383db845ed4dc83be5de19", "message": "HIVE-24558 : Handle update in table level regular expression", "committedDate": "2021-01-06T04:46:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDY3MDY3NQ==", "url": "https://github.com/apache/hive/pull/1804#discussion_r554670675", "bodyText": "nit: getExcludedTableNames() /getIncludedTableNames() methods can be replaced by replScope.excludedTableNamePattern and replScope.includedTableNamePattern respectively.", "author": "pkumarsinha", "createdAt": "2021-01-11T03:12:29Z", "path": "standalone-metastore/metastore-common/src/main/java/org/apache/hadoop/hive/common/repl/ReplScope.java", "diffHunk": "@@ -116,4 +117,27 @@ private boolean inTableExcludedList(final String tableName) {\n     }\n     return excludedTableNamePattern.matcher(tableName).matches();\n   }\n+\n+  @Override\n+  public boolean equals(Object o) {\n+    if (o == this) {\n+      return true;\n+    }\n+    if (! (o instanceof ReplScope)) {\n+      return false;\n+    }\n+\n+    ReplScope replScope = (ReplScope)o;\n+    return ((replScope.getExcludedTableNames() == null ?  (this.excludedTableNames == null) :\n+      replScope.getExcludedTableNames().equals(this.excludedTableNames))", "originalCommit": "dd929520b0cbf71879383db845ed4dc83be5de19", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDY3Mjg0NA==", "url": "https://github.com/apache/hive/pull/1804#discussion_r554672844", "bodyText": "dmd.setDump(DumpType.BOOTSTRAP, bootDumpBeginReplId, bootDumpEndReplId, cmRoot, executorId,\nwork.oldReplScope != null);\nShouldn't this line also also previousReplScopeModified() otherwise load will always assume that there is change in expession.", "author": "pkumarsinha", "createdAt": "2021-01-11T03:25:26Z", "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/repl/ReplDumpTask.java", "diffHunk": "@@ -410,12 +413,16 @@ private boolean shouldDump(Path previousDumpPath) throws IOException {\n    * @return true if need to examine tables for dump and false if not.\n    */\n   private boolean shouldExamineTablesToDump() {\n-    return (work.oldReplScope != null)\n+    return (previousReplScopeModified())\n             || !tablesForBootstrap.isEmpty()\n             || conf.getBoolVar(HiveConf.ConfVars.REPL_BOOTSTRAP_ACID_TABLES)\n             || conf.getBoolVar(HiveConf.ConfVars.REPL_INCLUDE_EXTERNAL_TABLES);\n   }\n \n+  private boolean previousReplScopeModified() {", "originalCommit": "dd929520b0cbf71879383db845ed4dc83be5de19", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4d2e9bbe532604244bbedb339e37392157a2e888", "url": "https://github.com/apache/hive/commit/4d2e9bbe532604244bbedb339e37392157a2e888", "message": "Resolve review comments", "committedDate": "2021-01-12T06:46:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjI1NDgxOQ==", "url": "https://github.com/apache/hive/pull/1804#discussion_r556254819", "bodyText": "We can  reuse the  same DumpMetaData object in the below check also, would avoid FileSystem read call:\nif (isBootStrap) {\nreturn shouldResumePreviousDump(new DumpMetaData(hiveDumpPath, conf));\n}\nSecond thing, I was also wondering if isBootStrap is true , do we even need that check or we can simply return false.", "author": "pkumarsinha", "createdAt": "2021-01-13T04:26:46Z", "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/repl/ReplDumpTask.java", "diffHunk": "@@ -968,6 +979,9 @@ private boolean shouldResumePreviousDump(Path lastDumpPath, boolean isBootStrap)\n       return false;\n     }\n     Path hiveDumpPath = new Path(lastDumpPath, ReplUtils.REPL_HIVE_BASE_DIR);\n+    if (tableExpressionModified(new DumpMetaData(hiveDumpPath, conf))) {", "originalCommit": "4f579bd960532366d2fad54abdde71d8429fac8f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjI4MDAxMA==", "url": "https://github.com/apache/hive/pull/1804#discussion_r556280010", "bodyText": "Yes we can reuse the same.\nIf its bootstrap then also we need this check. Because for bootstrap, we reuse the same directory, delete the metadata dir, but data dir is still reused.", "author": "aasha", "createdAt": "2021-01-13T05:59:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjI1NDgxOQ=="}], "type": "inlineReview"}, {"oid": "4101a88fba3e55be4809d916016a8d712df07b23", "url": "https://github.com/apache/hive/commit/4101a88fba3e55be4809d916016a8d712df07b23", "message": "Resolve review comments", "committedDate": "2021-01-13T06:24:28Z", "type": "forcePushed"}, {"oid": "e7d45a865cda2160ccbd172a119d69ca9887f4de", "url": "https://github.com/apache/hive/commit/e7d45a865cda2160ccbd172a119d69ca9887f4de", "message": "Resolve test fixes", "committedDate": "2021-01-18T13:20:50Z", "type": "forcePushed"}, {"oid": "98b3bf4ee2528550e1a42115f628ba35ac921901", "url": "https://github.com/apache/hive/commit/98b3bf4ee2528550e1a42115f628ba35ac921901", "message": "Fix tests", "committedDate": "2021-01-18T16:39:07Z", "type": "forcePushed"}, {"oid": "333798445c977b218d8cd3e43d0a16d06bb735f7", "url": "https://github.com/apache/hive/commit/333798445c977b218d8cd3e43d0a16d06bb735f7", "message": "Fix tests", "committedDate": "2021-01-18T16:55:16Z", "type": "forcePushed"}, {"oid": "add277f56b57ce086a5be00e3004fd6ec64ddcc6", "url": "https://github.com/apache/hive/commit/add277f56b57ce086a5be00e3004fd6ec64ddcc6", "message": "HIVE-24558 : Handle update in table level regular expression", "committedDate": "2021-01-19T02:12:09Z", "type": "commit"}, {"oid": "7345a247ae360c99bef56666276cec0837c0b8a5", "url": "https://github.com/apache/hive/commit/7345a247ae360c99bef56666276cec0837c0b8a5", "message": "Resolve review comments", "committedDate": "2021-01-19T02:12:09Z", "type": "commit"}, {"oid": "68a0823c1278760b47275c0daacdb529575fbb3b", "url": "https://github.com/apache/hive/commit/68a0823c1278760b47275c0daacdb529575fbb3b", "message": "Resolve review comments", "committedDate": "2021-01-19T02:12:09Z", "type": "commit"}, {"oid": "5ab31f0fc9a77ab112218c9864be05b418ec3ec5", "url": "https://github.com/apache/hive/commit/5ab31f0fc9a77ab112218c9864be05b418ec3ec5", "message": "Resolve test fixes", "committedDate": "2021-01-19T02:12:09Z", "type": "commit"}, {"oid": "9b2fb2de46e4e72fc21a9df18288550cc1b54e22", "url": "https://github.com/apache/hive/commit/9b2fb2de46e4e72fc21a9df18288550cc1b54e22", "message": "Fix tests", "committedDate": "2021-01-19T02:19:58Z", "type": "commit"}, {"oid": "9b2fb2de46e4e72fc21a9df18288550cc1b54e22", "url": "https://github.com/apache/hive/commit/9b2fb2de46e4e72fc21a9df18288550cc1b54e22", "message": "Fix tests", "committedDate": "2021-01-19T02:19:58Z", "type": "forcePushed"}]}