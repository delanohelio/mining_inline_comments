{"pr_number": 1792, "pr_title": "HIVE-24551: Hive should include transitive dependencies from calcite after shading it", "pr_createdAt": "2020-12-17T02:31:21Z", "pr_url": "https://github.com/apache/hive/pull/1792", "timeline": [{"oid": "1d1f542fc1ecfc5a74942e72a48052f1e2aed9eb", "url": "https://github.com/apache/hive/commit/1d1f542fc1ecfc5a74942e72a48052f1e2aed9eb", "message": "HIVE-24551", "committedDate": "2020-12-17T02:26:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3MjIyNQ==", "url": "https://github.com/apache/hive/pull/1792#discussion_r544772225", "bodyText": "One question. Will this be flaky? Once calcite changes transitive dependencies, seems we also need to update this.", "author": "viirya", "createdAt": "2020-12-17T02:50:24Z", "path": "ql/pom.xml", "diffHunk": "@@ -880,6 +880,12 @@\n                   <include>joda-time:joda-time</include>\n                   <include>org.apache.calcite:*</include>\n                   <include>org.apache.calcite.avatica:avatica</include>\n+                  <!-- include all of calcite's transitive dependencies as well since\n+                    otherwise they'll be removed in assembly packaging -->\n+                  <include>net.hydromatic:eigenbase-properties</include>\n+                  <include>org.codehaus.janino:janino</include>\n+                  <include>org.codehaus.janino:commons-compiler</include>\n+                  <include>org.pentaho:pentaho-aggdesigner-algorithm</include>", "originalCommit": "1d1f542fc1ecfc5a74942e72a48052f1e2aed9eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3OTkzOQ==", "url": "https://github.com/apache/hive/pull/1792#discussion_r544779939", "bodyText": "Yeah that's the downside of it - whenever we upgrade calcite we should check its dependencies and update here as well. I'm not sure if there is an easy way to include an artifact and all its transitive dependencies in the maven-shade-plugin", "author": "sunchao", "createdAt": "2020-12-17T03:13:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3MjIyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ3ODM0Nw==", "url": "https://github.com/apache/hive/pull/1792#discussion_r545478347", "bodyText": "BTW, I remember in the latest branch, the shading guava PR doesn't include transitive dependencies like that. Do we also need to do it for the branch?", "author": "viirya", "createdAt": "2020-12-17T23:43:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3MjIyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ4MDg4MA==", "url": "https://github.com/apache/hive/pull/1792#discussion_r545480880", "bodyText": "I still need to verify whether there is issue in master/4.0.0 as well - it uses calcite 1.21 which no longer depend on eigenbase that is causing the issue in our case, but I think it might be good to always include transitive dependencies anyway.", "author": "sunchao", "createdAt": "2020-12-17T23:50:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3MjIyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTUzMTI2MQ==", "url": "https://github.com/apache/hive/pull/1792#discussion_r545531261", "bodyText": "So I tried master branch and didn't hit the issue. However I think I may still open another PR for it since we don't really when the transitive dependencies will be needed at runtime.", "author": "sunchao", "createdAt": "2020-12-18T02:25:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3MjIyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTUzNDQwNA==", "url": "https://github.com/apache/hive/pull/1792#discussion_r545534404", "bodyText": "Oh actually in master we already handles this here, as part of HIVE-22126. I think we should follow the same approach and explicitly add the transitive dependency in Hive's top-level pom. I think this is also how Spark manages its transitive dependencies? it might be better than pulling out the classes and putting them in the fat jar.", "author": "sunchao", "createdAt": "2020-12-18T02:34:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3MjIyNQ=="}], "type": "inlineReview"}, {"oid": "700112a4e869c3881f3e5158743f701bd3f01b11", "url": "https://github.com/apache/hive/commit/700112a4e869c3881f3e5158743f701bd3f01b11", "message": "Empty commit to trigger CI again", "committedDate": "2020-12-17T17:40:02Z", "type": "commit"}, {"oid": "2a970908ee515dc70e05cff3cd16ed1722db21ba", "url": "https://github.com/apache/hive/commit/2a970908ee515dc70e05cff3cd16ed1722db21ba", "message": "revert previous change", "committedDate": "2020-12-18T02:42:47Z", "type": "commit"}, {"oid": "11f3d3b22bc9293640e294cf59847b82e7f3cc01", "url": "https://github.com/apache/hive/commit/11f3d3b22bc9293640e294cf59847b82e7f3cc01", "message": "add dependencies instead", "committedDate": "2020-12-18T04:31:47Z", "type": "commit"}, {"oid": "09c4e3ea0324553e4ff1a8074bb16e6b14a5ae39", "url": "https://github.com/apache/hive/commit/09c4e3ea0324553e4ff1a8074bb16e6b14a5ae39", "message": "bump accumulo version to 1.7.3 and decrease test timeout to 4hr", "committedDate": "2020-12-19T20:23:20Z", "type": "commit"}]}