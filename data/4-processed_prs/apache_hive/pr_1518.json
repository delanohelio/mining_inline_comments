{"pr_number": 1518, "pr_title": "HIVE-24191: Introduce configurable user to run compaction as", "pr_createdAt": "2020-09-23T11:45:46Z", "pr_url": "https://github.com/apache/hive/pull/1518", "timeline": [{"oid": "9ee76d0aa0b9671f56940ce9543ccdc697ab2f51", "url": "https://github.com/apache/hive/commit/9ee76d0aa0b9671f56940ce9543ccdc697ab2f51", "message": "HIVE-24191: Introduce configurable user to run compaction as NOTE: TestRestrictedList will fail", "committedDate": "2020-09-23T11:14:39Z", "type": "commit"}, {"oid": "1f5ff016967eb26f86d086e6cbc1cdaa6a54a84e", "url": "https://github.com/apache/hive/commit/1f5ff016967eb26f86d086e6cbc1cdaa6a54a84e", "message": "Move config from MetastoreConf to HiveConf because HiveConf has restricted list", "committedDate": "2020-09-23T11:32:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUxNjQ3Mg==", "url": "https://github.com/apache/hive/pull/1518#discussion_r493516472", "bodyText": "This will be used on HMS and occasionally on HS2 (if the Worker is HS2).\nWhere are those other Compaction related configs? If everything is on HMS side, please move this there too", "author": "pvary", "createdAt": "2020-09-23T12:13:56Z", "path": "common/src/java/org/apache/hadoop/hive/conf/HiveConf.java", "diffHunk": "@@ -3098,6 +3098,10 @@ private static void populateLlapDaemonVarsSet(Set<String> llapDaemonVarsSetLocal\n         \"This is set to compactor from within the query based compactor. This enables the Tez SplitGrouper \"\n         + \"to group splits based on their bucket number, so that all rows from different bucket files \"\n         + \" for the same bucket number can end up in the same bucket file after the compaction.\"),\n+    // MetastoreConf doesn't have a restricted list. Otherwise can be moved there.\n+    COMPACTOR_RUN_AS_USER(\"hive.compactor.run.as.user\", \"\",\n+        \"Specify the user to run compaction (Worker) and compaction-related file listing (Initiator, Cleaner) as. \" +\n+        \"If empty string, defaults to table/partition directory owner. Restricted.\"),", "originalCommit": "1f5ff016967eb26f86d086e6cbc1cdaa6a54a84e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUyMDYwNQ==", "url": "https://github.com/apache/hive/pull/1518#discussion_r493520605", "bodyText": "MetastoreConf, but it has no restricted list AFAIK. Implementing one would be a new feature that isn't covered by this ticket.", "author": "klcopp", "createdAt": "2020-09-23T12:18:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUxNjQ3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUyMzg1NA==", "url": "https://github.com/apache/hive/pull/1518#discussion_r493523854", "bodyText": "AFAIK only very specific HMS confs could be changed by the user (HiveConf.metaConfVars). So restricting it might not be needed.", "author": "pvary", "createdAt": "2020-09-23T12:22:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUxNjQ3Mg=="}], "type": "inlineReview"}, {"oid": "ad9c13e2ab80dc458281bc30d51f4417d74d6874", "url": "https://github.com/apache/hive/commit/ad9c13e2ab80dc458281bc30d51f4417d74d6874", "message": "Move config back to HiveConf; remove from restricted list. Reasoning: Compactor thread configs can't be changed without a HS2/HMS restart", "committedDate": "2020-09-23T12:42:41Z", "type": "commit"}, {"oid": "73701d0253cc8a977204989b0e6eb43efbb40817", "url": "https://github.com/apache/hive/commit/73701d0253cc8a977204989b0e6eb43efbb40817", "message": "Fix tests", "committedDate": "2020-09-24T07:45:16Z", "type": "commit"}]}