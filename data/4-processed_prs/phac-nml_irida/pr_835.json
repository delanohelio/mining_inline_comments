{"pr_number": 835, "pr_title": "Refactor fastqc page", "pr_createdAt": "2020-10-23T16:16:40Z", "pr_url": "https://github.com/phac-nml/irida/pull/835", "timeline": [{"oid": "139845ae0399cc73ea9aa42936a8341d24590480", "url": "https://github.com/phac-nml/irida/commit/139845ae0399cc73ea9aa42936a8341d24590480", "message": "Added react pages for fastqc images, overrepresented sequences, fastqc details. Added ajax controller. Added dto for FastQCDetails", "committedDate": "2020-10-21T21:16:26Z", "type": "commit"}, {"oid": "9c271d4180ce305d7639fd449fdbb787a7c5c0a1", "url": "https://github.com/phac-nml/irida/commit/9c271d4180ce305d7639fd449fdbb787a7c5c0a1", "message": "Added overrepresented sequences and details retrieved from server", "committedDate": "2020-10-22T20:59:28Z", "type": "commit"}, {"oid": "8ecefccb0e9e2961e6ce5ffd20787ae36f33927d", "url": "https://github.com/phac-nml/irida/commit/8ecefccb0e9e2961e6ce5ffd20787ae36f33927d", "message": "Removed tests no longer required. Added translations. Updated to remove page variables and rather get ids from the url. Updated FastQCCharts to display the fastqc images. Cleaned up SequenceFileController.", "committedDate": "2020-10-23T16:15:39Z", "type": "commit"}, {"oid": "b20999bdbf3c3bce317d11edf61c466f7083b3a1", "url": "https://github.com/phac-nml/irida/commit/b20999bdbf3c3bce317d11edf61c466f7083b3a1", "message": "Added javadocs", "committedDate": "2020-10-23T16:19:10Z", "type": "commit"}, {"oid": "aea11c08be634c86b5b177f25280996297aeb657", "url": "https://github.com/phac-nml/irida/commit/aea11c08be634c86b5b177f25280996297aeb657", "message": "Added missing translations. Removed page variables from template", "committedDate": "2020-10-23T16:23:37Z", "type": "commit"}, {"oid": "b6516176996f03c807f5960c3194a18a684f7197", "url": "https://github.com/phac-nml/irida/commit/b6516176996f03c807f5960c3194a18a684f7197", "message": "Removed logging statement. Added badge with count of overrepresented sequences to link", "committedDate": "2020-10-23T17:49:41Z", "type": "commit"}, {"oid": "aa089ab37952a4ebcf277819445c3feea764e695", "url": "https://github.com/phac-nml/irida/commit/aa089ab37952a4ebcf277819445c3feea764e695", "message": "Refactored constants into separate file. Added showZero to badge so it displays if the count is 0", "committedDate": "2020-10-23T18:13:25Z", "type": "commit"}, {"oid": "40188c965764cf3e382cb55d195a234273838ed4", "url": "https://github.com/phac-nml/irida/commit/40188c965764cf3e382cb55d195a234273838ed4", "message": "Removed translations no longer required. Added info alert to fastqc component.", "committedDate": "2020-10-23T21:29:27Z", "type": "commit"}, {"oid": "ed4f2289929a35edd9e10b1dd6a7764021712b52", "url": "https://github.com/phac-nml/irida/commit/ed4f2289929a35edd9e10b1dd6a7764021712b52", "message": "Added sequencefileajaxcontroller test. Updated display of sequences and percentages on the overrepresented sequences page.", "committedDate": "2020-10-26T21:07:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU3NTc1MA==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r512575750", "bodyText": "Make sure to set up the onBack handler which should take you back to the sample files page.", "author": "joshsadam", "createdAt": "2020-10-27T10:31:11Z", "path": "src/main/webapp/resources/js/pages/sequence-files/components/FastQC.jsx", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * This file is responsible for displaying the\n+ * tabs required and default renders the\n+ * FastQCCharts component.\n+ */\n+\n+import React, { Suspense, useEffect, useState } from \"react\";\n+import { setBaseUrl } from \"../../../utilities/url-utilities\";\n+import { PageWrapper } from \"../../../components/page/PageWrapper\";\n+import { Link, Location, Router } from \"@reach/router\";\n+import { Badge, Menu } from \"antd\";\n+import { ContentLoading } from \"../../../components/loader\";\n+\n+import { SPACE_MD, SPACE_XS } from \"../../../styles/spacing\"\n+import { getFastQCDetails } from \"../../../apis/files/sequence-files\";\n+import {\n+  seqObjId,\n+  seqFileId,\n+  urlMatch\n+} from \"../fastqc-constants\";\n+import { InfoAlert } from \"../../../components/alerts\";\n+import { blue6 } from \"../../../styles/colors\";\n+\n+const FastQCDetails = React.lazy(() => import(\"./FastQCDetails\"));\n+const FastQCCharts = React.lazy(() => import(\"./FastQCCharts\"));\n+const OverRepresentedSequences = React.lazy(() => import(\"./OverRepresentedSequences\"));\n+\n+export default function FastQC() {\n+  const [loading, setLoading] = useState(true);\n+  const [fastQC, setFastQC] = useState({});\n+  const [file, setFile] = useState({});\n+\n+  const DEFAULT_URL = setBaseUrl(urlMatch[0]);\n+\n+  const [selectedKeys, setSelectedKeys] = React.useState(() => {\n+    // Create a regex from the string with an additional string at the end\n+    const regexStr = urlMatch[0] + \"/(\\\\w*)?\";\n+    const urlRegex = new RegExp(regexStr, \"i\");\n+\n+    const urlMatchRegex = window.location.href.match(urlRegex);\n+    // Grab the key if it exists from the match array otherwise default to 'charts'\n+    return urlMatchRegex !== null ? urlMatchRegex[1] : \"charts\";\n+  });\n+\n+  useEffect(() => {\n+    getFastQCDetails(seqObjId, seqFileId).then(({ analysisFastQC, sequenceFile }) => {\n+      setFile(sequenceFile);\n+      setFastQC(analysisFastQC);\n+      setLoading(false);\n+    });\n+  }, []);\n+\n+  return (\n+    <PageWrapper title={file.fileName}>", "originalCommit": "ed4f2289929a35edd9e10b1dd6a7764021712b52", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc4NTI0Mg==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r512785242", "bodyText": "As discussed we are going to leave this for now", "author": "deepsidhu85", "createdAt": "2020-10-27T15:21:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU3NTc1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU3ODgxNA==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r512578814", "bodyText": "I think using the Image tag here might be a little overkill.  I think you might want to consider displaying the images at a decent size.  I don't think they need to be clickable since there are only 3.", "author": "joshsadam", "createdAt": "2020-10-27T10:36:01Z", "path": "src/main/webapp/resources/js/pages/sequence-files/components/FastQCCharts.jsx", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * This file renders the FastQC charts component.\n+ */\n+\n+import React, { useEffect, useState } from \"react\";\n+import { Col, Image, Layout , Row, Typography} from \"antd\";\n+import { SPACE_MD } from \"../../../styles/spacing\";\n+import { grey1 } from \"../../../styles/colors\";\n+import { TabPaneContent } from \"../../../components/tabs/TabPaneContent\";\n+import { getFastQCImages } from \"../../../apis/files/sequence-files\";\n+import { ContentLoading } from \"../../../components/loader\";\n+import {\n+  seqObjId,\n+  seqFileId\n+} from \"../fastqc-constants\";\n+\n+export default function FastQCCharts() {\n+\n+  const [loading, setLoading] = useState(true);\n+  const [perBase, setPerBase] = useState(\"\");\n+  const [perSeq, setPerSeq] = useState(\"\");\n+  const [duplicationLevel, setDuplicationLevel] = useState(\"\");\n+  const [fastQCVersion, setFastQCVersion] = useState(\"\");\n+\n+  useEffect(() => {\n+    getFastQCImages(seqObjId, seqFileId).then(({ perbaseChart, persequenceChart, duplicationlevelChart, fastQCVersion }) => {\n+      // Convert the images from byte arrays into a png images\n+      setPerBase(`data:image/png;base64,${perbaseChart}`);\n+      setPerSeq(`data:image/png;base64,${persequenceChart}`);\n+      setDuplicationLevel(`data:image/png;base64,${duplicationlevelChart}`);\n+\n+      setFastQCVersion(fastQCVersion);\n+      setLoading(false);\n+    });\n+  }, []);\n+\n+  return (\n+    <div>\n+    {\n+      loading ?\n+        <ContentLoading message={i18n(\"FastQC.fetchingCharts\")}/>\n+        :\n+        <Layout style={{paddingLeft: SPACE_MD, backgroundColor: grey1}}>\n+          <TabPaneContent title={i18n(\"FastQC.charts\")}>\n+            <Typography.Paragraph>{i18n(\"FastQC.overrepresentedSequencesDescription\", fastQCVersion)}</Typography.Paragraph>\n+            <Row\n+              gutter={[16, 16]}\n+              style={{ padding: SPACE_MD }}\n+            >\n+              <Col sm={24} md={12}>\n+                <Image src={perBase} />", "originalCommit": "ed4f2289929a35edd9e10b1dd6a7764021712b52", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc4NTQxMg==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r512785412", "bodyText": "Updated in 4372be3", "author": "deepsidhu85", "createdAt": "2020-10-27T15:21:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU3ODgxNA=="}], "type": "inlineReview"}, {"oid": "4372be3feec2c4a30cd9973883f6d7e8fa1df2a3", "url": "https://github.com/phac-nml/irida/commit/4372be3feec2c4a30cd9973883f6d7e8fa1df2a3", "message": "Updated to use img tag. Removed extra alert.", "committedDate": "2020-10-27T15:19:19Z", "type": "commit"}, {"oid": "c33e7333361fdde4e1c61a410be57178c84f08d8", "url": "https://github.com/phac-nml/irida/commit/c33e7333361fdde4e1c61a410be57178c84f08d8", "message": "Added requestmapping to view fastqc results when clicking on link on samples/ page. Updated to check if window.location.pathname matches the url", "committedDate": "2020-10-27T16:11:50Z", "type": "commit"}, {"oid": "3f4c4e79be23142a33d27757ab5eb740af7ebfa3", "url": "https://github.com/phac-nml/irida/commit/3f4c4e79be23142a33d27757ab5eb740af7ebfa3", "message": "Updated percentage column to show 1 decimal place", "committedDate": "2020-10-27T17:53:23Z", "type": "commit"}, {"oid": "c0d7464e4db3696ee5f20fc7bf3866166c569e46", "url": "https://github.com/phac-nml/irida/commit/c0d7464e4db3696ee5f20fc7bf3866166c569e46", "message": "Added tests. Added class names for tests", "committedDate": "2020-10-27T20:33:34Z", "type": "commit"}, {"oid": "03c9b4b52376da0f42147a4f23efbd300ad0cbdd", "url": "https://github.com/phac-nml/irida/commit/03c9b4b52376da0f42147a4f23efbd300ad0cbdd", "message": "Updated CHANGELOG", "committedDate": "2020-10-27T21:11:08Z", "type": "commit"}, {"oid": "b5ecc8e7816d5049359e352b93fc4c70c6602b08", "url": "https://github.com/phac-nml/irida/commit/b5ecc8e7816d5049359e352b93fc4c70c6602b08", "message": "Merged dev and fixed merge conflicts", "committedDate": "2020-10-28T13:45:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE1OTExOA==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514159118", "bodyText": "Images look a bit small now.  You may want to consider increasing the widths on the Col spans a little.  Playing a bit just with <Col span={24}> seemed to work ok.  On wider screens it gets really big so maybe set an xl or xxl breakpoint, but I think I would skip the smaller ones.", "author": "joshsadam", "createdAt": "2020-10-29T10:36:43Z", "path": "src/main/webapp/resources/js/pages/sequence-files/components/FastQCCharts.jsx", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * This file renders the FastQC charts component.\n+ */\n+\n+import React, { useEffect, useState } from \"react\";\n+import { Col, Layout , Row, Typography} from \"antd\";\n+import { SPACE_MD } from \"../../../styles/spacing\";\n+import { grey1 } from \"../../../styles/colors\";\n+import { TabPaneContent } from \"../../../components/tabs/TabPaneContent\";\n+import { getFastQCImages } from \"../../../apis/files/sequence-files\";\n+import { ContentLoading } from \"../../../components/loader\";\n+import {\n+  seqObjId,\n+  seqFileId\n+} from \"../fastqc-constants\";\n+\n+import styled from \"styled-components\";\n+\n+const StyledImage = styled.img`\n+  height: 100%;\n+  width: 100%;\n+`;\n+\n+export default function FastQCCharts() {\n+\n+  const [loading, setLoading] = useState(true);\n+  const [perBase, setPerBase] = useState(\"\");\n+  const [perSeq, setPerSeq] = useState(\"\");\n+  const [duplicationLevel, setDuplicationLevel] = useState(\"\");\n+  const [fastQCVersion, setFastQCVersion] = useState(\"\");\n+\n+  useEffect(() => {\n+    getFastQCImages(seqObjId, seqFileId).then(({ perbaseChart, persequenceChart, duplicationlevelChart, fastQCVersion }) => {\n+      // Convert the images from byte arrays into a png images\n+      setPerBase(`data:image/png;base64,${perbaseChart}`);\n+      setPerSeq(`data:image/png;base64,${persequenceChart}`);\n+      setDuplicationLevel(`data:image/png;base64,${duplicationlevelChart}`);\n+\n+      setFastQCVersion(fastQCVersion);\n+      setLoading(false);\n+    });\n+  }, []);\n+\n+  return (\n+    <div>\n+    {\n+      loading ?\n+        <ContentLoading message={i18n(\"FastQC.fetchingCharts\")}/>\n+        :\n+        <Layout style={{paddingLeft: SPACE_MD, backgroundColor: grey1}}>\n+          <TabPaneContent title={i18n(\"FastQC.charts\")} xxl={16}>\n+            <Typography.Paragraph>{i18n(\"FastQC.overrepresentedSequencesDescription\", fastQCVersion)}</Typography.Paragraph>\n+            <Row\n+              gutter={[16, 16]}\n+              style={{ padding: SPACE_MD }}\n+            >\n+              <Col sm={24} md={18} xl={16} xxl={12}>", "originalCommit": "b5ecc8e7816d5049359e352b93fc4c70c6602b08", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDMyNTQ0OA==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514325448", "bodyText": "Updated in 139845a", "author": "deepsidhu85", "createdAt": "2020-10-29T14:57:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE1OTExOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE1OTMyNA==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514159324", "bodyText": "Can you add:\n  border: 1px solid ${grey4};\n  padding: ${SPACE_MD};\n  border-radius: 2px;", "author": "joshsadam", "createdAt": "2020-10-29T10:37:04Z", "path": "src/main/webapp/resources/js/pages/sequence-files/components/FastQCCharts.jsx", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * This file renders the FastQC charts component.\n+ */\n+\n+import React, { useEffect, useState } from \"react\";\n+import { Col, Layout , Row, Typography} from \"antd\";\n+import { SPACE_MD } from \"../../../styles/spacing\";\n+import { grey1 } from \"../../../styles/colors\";\n+import { TabPaneContent } from \"../../../components/tabs/TabPaneContent\";\n+import { getFastQCImages } from \"../../../apis/files/sequence-files\";\n+import { ContentLoading } from \"../../../components/loader\";\n+import {\n+  seqObjId,\n+  seqFileId\n+} from \"../fastqc-constants\";\n+\n+import styled from \"styled-components\";\n+\n+const StyledImage = styled.img`\n+  height: 100%;\n+  width: 100%;", "originalCommit": "b5ecc8e7816d5049359e352b93fc4c70c6602b08", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDMyNTUzOQ==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514325539", "bodyText": "Added in 139845a", "author": "deepsidhu85", "createdAt": "2020-10-29T14:57:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE1OTMyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE1OTU1NQ==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514159555", "bodyText": "Comments", "author": "joshsadam", "createdAt": "2020-10-29T10:37:27Z", "path": "src/main/webapp/resources/js/pages/sequence-files/components/FastQCDetails.jsx", "diffHunk": "@@ -0,0 +1,96 @@\n+/*\n+ * This file renders the FastQC details component.\n+ */\n+\n+import React, { useEffect, useState } from \"react\";\n+import { Divider, Layout, Typography } from \"antd\";\n+import { SPACE_MD } from \"../../../styles/spacing\";\n+import { grey1 } from \"../../../styles/colors\";\n+import { TabPaneContent } from \"../../../components/tabs/TabPaneContent\";\n+import { BasicList } from \"../../../components/lists\";\n+import { getFastQCDetails } from \"../../../apis/files/sequence-files\";\n+import { formatDate } from \"../../../utilities/date-utilities\";\n+import { ContentLoading } from \"../../../components/loader\";\n+import { seqFileId, seqObjId } from \"../fastqc-constants\";\n+", "originalCommit": "b5ecc8e7816d5049359e352b93fc4c70c6602b08", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDMyNTYxOA==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514325618", "bodyText": "Added in 139845a", "author": "deepsidhu85", "createdAt": "2020-10-29T14:57:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE1OTU1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE1OTg2OQ==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514159869", "bodyText": "Comments", "author": "joshsadam", "createdAt": "2020-10-29T10:38:01Z", "path": "src/main/webapp/resources/js/pages/sequence-files/components/OverRepresentedSequences.jsx", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * This file renders the OverRepresentedSequences component.\n+ */\n+\n+import React, { useEffect, useState } from \"react\";\n+import { Layout, Table, Typography } from \"antd\";\n+import { SPACE_MD } from \"../../../styles/spacing\";\n+import { grey1 } from \"../../../styles/colors\";\n+import { TabPaneContent } from \"../../../components/tabs/TabPaneContent\";\n+import { getOverRepresentedSequences } from \"../../../apis/files/sequence-files\";\n+import {\n+  seqObjId,\n+  seqFileId\n+} from \"../fastqc-constants\";\n+import { Monospace } from \"../../../components/typography\";\n+\n+export default function OverRepresentedSequences() {", "originalCommit": "b5ecc8e7816d5049359e352b93fc4c70c6602b08", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDMyNTcwMw==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514325703", "bodyText": "Added in 139845a", "author": "deepsidhu85", "createdAt": "2020-10-29T14:57:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE1OTg2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE2MDIyOQ==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514160229", "bodyText": "LOL, oh this is fun!", "author": "joshsadam", "createdAt": "2020-10-29T10:38:37Z", "path": "src/main/webapp/resources/js/pages/sequence-files/fastqc-constants.js", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * Constants file for the FastQC react components", "originalCommit": "b5ecc8e7816d5049359e352b93fc4c70c6602b08", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDMxNzYwNQ==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514317605", "bodyText": "Haha so much fun!", "author": "deepsidhu85", "createdAt": "2020-10-29T14:48:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE2MDIyOQ=="}], "type": "inlineReview"}, {"oid": "cf58113ebe4c86d6272c27a0db02788cfa80a470", "url": "https://github.com/phac-nml/irida/commit/cf58113ebe4c86d6272c27a0db02788cfa80a470", "message": "Changed image column widths and added borders. Added comments. Fixed test", "committedDate": "2020-10-29T14:57:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ1OTUyMA==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514459520", "bodyText": "Why are you not creating a UI service to handle this stuff?", "author": "joshsadam", "createdAt": "2020-10-29T17:59:29Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/SequenceFileAjaxController.java", "diffHunk": "@@ -0,0 +1,117 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.files;\n+\n+import java.io.IOException;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RequestParam;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import ca.corefacility.bioinformatics.irida.exceptions.EntityNotFoundException;\n+import ca.corefacility.bioinformatics.irida.model.sequenceFile.SequenceFile;\n+import ca.corefacility.bioinformatics.irida.model.sequenceFile.SequencingObject;\n+import ca.corefacility.bioinformatics.irida.model.workflow.analysis.AnalysisFastQC;\n+import ca.corefacility.bioinformatics.irida.ria.web.files.dto.FastQCDetailsResponse;\n+import ca.corefacility.bioinformatics.irida.ria.web.files.dto.FastQCImagesResponse;\n+import ca.corefacility.bioinformatics.irida.service.AnalysisService;\n+import ca.corefacility.bioinformatics.irida.service.SequencingObjectService;\n+\n+/**\n+ * Ajax controller to get data for the fastqc page.\n+ */\n+@RestController\n+@Scope(\"session\")\n+@RequestMapping(\"/ajax/sequenceFiles\")\n+public class SequenceFileAjaxController {\n+\n+\tprivate AnalysisService analysisService;\n+\tprivate SequencingObjectService sequencingObjectService;\n+\n+\tpublic static final String IMG_PERBASE = \"perbase\";\n+\tpublic static final String IMG_PERSEQUENCE = \"persequence\";\n+\tpublic static final String IMG_DUPLICATION_LEVEL = \"duplicationlevel\";\n+\n+\tpublic static final String[] qcFileTypes = { \"perbase\", \"persequence\", \"duplicationlevel\" };\n+\n+\t@Autowired\n+\tpublic SequenceFileAjaxController(AnalysisService analysisService,\n+\t\t\tSequencingObjectService sequencingObjectService) {", "originalCommit": "cf58113ebe4c86d6272c27a0db02788cfa80a470", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUxMTE0OQ==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514511149", "bodyText": "Added in 8d915d2", "author": "deepsidhu85", "createdAt": "2020-10-29T19:26:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ1OTUyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ2MjAzMA==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514462030", "bodyText": "if it is an index.js file you don't need to add that part.", "author": "joshsadam", "createdAt": "2020-10-29T18:03:24Z", "path": "src/main/webapp/entries.js", "diffHunk": "@@ -79,4 +79,5 @@ module.exports = {\n   \"project-metadata-templates\":\n     \"./resources/js/pages/projects/metadata-templates\",\n   admin: \"./resources/js/pages/admin/index.js\",\n+  \"sequence-files\": \"./resources/js/pages/sequence-files/index.js\",", "originalCommit": "cf58113ebe4c86d6272c27a0db02788cfa80a470", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUxMDIzMQ==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514510231", "bodyText": "Updated in 8d915d2", "author": "deepsidhu85", "createdAt": "2020-10-29T19:24:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ2MjAzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ2MjM5NQ==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514462395", "bodyText": "Aren't we throwing errors.", "author": "joshsadam", "createdAt": "2020-10-29T18:03:59Z", "path": "src/main/webapp/resources/js/apis/files/sequence-files.js", "diffHunk": "@@ -0,0 +1,71 @@\n+/**\n+ * FastQC related API functions\n+ */\n+\n+import { setBaseUrl } from \"../../utilities/url-utilities\";\n+import axios from \"axios\";\n+\n+const BASE_URL = setBaseUrl(`/ajax/sequenceFiles`);\n+\n+/*\n+ * Get the fastqc details.\n+ * @param {number} sequencingObjectId SequencingObject ID\n+ * @param {number} sequenceFileId SequenceFile ID\n+ * @return {Promise<*>} `data` contains the OK response and a dto with the fastqc details;\n+ *                      `error` contains error information if an error occurred.\n+ */\n+export async function getFastQCDetails(sequencingObjectId, sequenceFileId) {\n+  try {\n+    const { data } = await axios.get(`${BASE_URL}/fastqc-details`, {\n+      params: {\n+        sequencingObjectId,\n+        sequenceFileId\n+      }\n+    });\n+    return data;\n+  }  catch (error) {\n+    return { error };", "originalCommit": "cf58113ebe4c86d6272c27a0db02788cfa80a470", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUxMDE2OA==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514510168", "bodyText": "Updated in 8d915d2", "author": "deepsidhu85", "createdAt": "2020-10-29T19:24:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ2MjM5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ3MTMwOA==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514471308", "bodyText": "I don't think you need this, plus it is really smelly.  If you want to what I would to is add a props attribute to the object and then spread it.  That way you will automatically get the class name you want:\nCalling code:\n{\n      title: i18n(\"FastQC.maxLength\"),\n      desc: fastQC.maxLength,\n      props: {\n\t\tclassName: \"t-fastqc-max-length\", \n\t\t// whatever other props like style, ect...\n\t }\n},\nAnd then in you BasicList:\n <List.Item.Meta\n            title={<Text strong>{item.title}</Text>}\n            description={item.desc}\n            {...item.props}\n          />", "author": "joshsadam", "createdAt": "2020-10-29T18:18:08Z", "path": "src/main/webapp/resources/js/components/lists/BasicList.jsx", "diffHunk": "@@ -21,7 +21,8 @@ const { Text } = Typography;\n \n export function BasicList({\n   itemLayout = \"horizontal\",\n-  dataSource = { dataSource }\n+  dataSource = { dataSource },\n+  customClassNames = false", "originalCommit": "cf58113ebe4c86d6272c27a0db02788cfa80a470", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUxMDExMQ==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514510111", "bodyText": "Updated in 8d915d2", "author": "deepsidhu85", "createdAt": "2020-10-29T19:24:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ3MTMwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ3MzE0Nw==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514473147", "bodyText": "This still feels like you are leaving the images pretty small at the xl  level", "author": "joshsadam", "createdAt": "2020-10-29T18:21:01Z", "path": "src/main/webapp/resources/js/pages/sequence-files/components/FastQCCharts.jsx", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * This file renders the FastQC charts component.\n+ */\n+\n+import React, { useEffect, useState } from \"react\";\n+import { Col, Layout , Row, Typography} from \"antd\";\n+import { SPACE_MD } from \"../../../styles/spacing\";\n+import { grey1, grey4 } from \"../../../styles/colors\";\n+import { TabPaneContent } from \"../../../components/tabs/TabPaneContent\";\n+import { getFastQCImages } from \"../../../apis/files/sequence-files\";\n+import { ContentLoading } from \"../../../components/loader\";\n+import {\n+  seqObjId,\n+  seqFileId\n+} from \"../fastqc-constants\";\n+\n+import styled from \"styled-components\";\n+\n+const StyledImage = styled.img`\n+  height: 100%;\n+  width: 100%;\n+  border: 1px solid ${grey4};\n+  padding: ${SPACE_MD};\n+  border-radius: 2px;\n+`;\n+\n+export default function FastQCCharts() {\n+\n+  const [loading, setLoading] = useState(true);\n+  const [perBase, setPerBase] = useState(\"\");\n+  const [perSeq, setPerSeq] = useState(\"\");\n+  const [duplicationLevel, setDuplicationLevel] = useState(\"\");\n+  const [fastQCVersion, setFastQCVersion] = useState(\"\");\n+\n+  useEffect(() => {\n+    getFastQCImages(seqObjId, seqFileId).then(({ perbaseChart, persequenceChart, duplicationlevelChart, fastQCVersion }) => {\n+      // Convert the images from byte arrays into a png images\n+      setPerBase(`data:image/png;base64,${perbaseChart}`);\n+      setPerSeq(`data:image/png;base64,${persequenceChart}`);\n+      setDuplicationLevel(`data:image/png;base64,${duplicationlevelChart}`);\n+\n+      setFastQCVersion(fastQCVersion);\n+      setLoading(false);\n+    });\n+  }, []);\n+\n+  return (\n+    <div>\n+    {\n+      loading ?\n+        <ContentLoading message={i18n(\"FastQC.fetchingCharts\")}/>\n+        :\n+        <Layout style={{paddingLeft: SPACE_MD, backgroundColor: grey1}}>\n+          <TabPaneContent title={i18n(\"FastQC.charts\")} xxl={16}>\n+            <Typography.Paragraph>{i18n(\"FastQC.overrepresentedSequencesDescription\", fastQCVersion)}</Typography.Paragraph>\n+            <Row\n+              gutter={[16, 16]}\n+              style={{ padding: SPACE_MD }}\n+            >\n+              <Col span={24} xl={16} xxl={12}>", "originalCommit": "cf58113ebe4c86d6272c27a0db02788cfa80a470", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ5NDkyNQ==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514494925", "bodyText": "They look huge on my monitors. What do you suggest to set it to?", "author": "deepsidhu85", "createdAt": "2020-10-29T18:57:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ3MzE0Nw=="}], "type": "inlineReview"}, {"oid": "8d915d2b5135ef05b2f4eafaebe586d755b13903", "url": "https://github.com/phac-nml/irida/commit/8d915d2b5135ef05b2f4eafaebe586d755b13903", "message": "Added UISequenceFileService. Added tests for service. Moved logic testing services into the service from the ajax controller. Updated sequence-files.js functions to throw an error if one is returned from the server. Removed customclassnames attribute from BasicList and instead added a props attribute to list items which contain the classname", "committedDate": "2020-10-29T19:20:09Z", "type": "commit"}, {"oid": "4b52f05043bb4bb15953598aa6e56c89c22c1868", "url": "https://github.com/phac-nml/irida/commit/4b52f05043bb4bb15953598aa6e56c89c22c1868", "message": "Updated tests. Added fastqc images which are used by tests. Updated db xml file", "committedDate": "2020-10-29T21:59:15Z", "type": "commit"}, {"oid": "1cd2bb91f0ce4d5cd0757f35c21a315e7857255a", "url": "https://github.com/phac-nml/irida/commit/1cd2bb91f0ce4d5cd0757f35c21a315e7857255a", "message": "Merged dev and fixed merge conflicts. Removed unused imports", "committedDate": "2020-10-30T13:30:41Z", "type": "commit"}, {"oid": "29661f39cf76d74a123e58c121692176ca981352", "url": "https://github.com/phac-nml/irida/commit/29661f39cf76d74a123e58c121692176ca981352", "message": "Instead of erroring out on a page if an image is not found we return a byte array of 0 length", "committedDate": "2020-10-30T15:34:27Z", "type": "commit"}, {"oid": "bd98a62546c41717b65cb512346c2168aaf55caa", "url": "https://github.com/phac-nml/irida/commit/bd98a62546c41717b65cb512346c2168aaf55caa", "message": "Reverted to throwing IOException if file can't be read", "committedDate": "2020-10-30T18:56:05Z", "type": "commit"}, {"oid": "5409253747a2803d9b82d025e5cc3d6463c51b38", "url": "https://github.com/phac-nml/irida/commit/5409253747a2803d9b82d025e5cc3d6463c51b38", "message": ":recycle: Refactored the way the navigation system gets its information\n\nMade better use of reach router Location and useParams to get details.", "committedDate": "2020-10-30T19:20:10Z", "type": "commit"}, {"oid": "dc73c84f466bc22f03937f4764485ea02ae5acf3", "url": "https://github.com/phac-nml/irida/commit/dc73c84f466bc22f03937f4764485ea02ae5acf3", "message": "That should not have been comiited", "committedDate": "2020-10-30T19:23:16Z", "type": "commit"}, {"oid": "f61b1fb6afaddb5375092df0d5c72e2bc3856932", "url": "https://github.com/phac-nml/irida/commit/f61b1fb6afaddb5375092df0d5c72e2bc3856932", "message": "Merge branch 'refactor-fastqc-page' into refactor-fastqc-page-NAVIGATION\n\n# Conflicts:\n#\tsrc/main/webapp/resources/js/pages/sequence-files/components/FastQCCharts.jsx", "committedDate": "2020-10-30T19:25:08Z", "type": "commit"}, {"oid": "74e15c6cdcb164727067122fe09ac609ba4800f8", "url": "https://github.com/phac-nml/irida/commit/74e15c6cdcb164727067122fe09ac609ba4800f8", "message": "Fixed merge conflict", "committedDate": "2020-10-30T19:26:06Z", "type": "commit"}, {"oid": "26b3d5154592fdf9046c63698c4f24bd17f66a1c", "url": "https://github.com/phac-nml/irida/commit/26b3d5154592fdf9046c63698c4f24bd17f66a1c", "message": "Merge pull request #7 from phac-nml/refactor-fastqc-page-NAVIGATION\n\nRefactor fastqc page navigation", "committedDate": "2020-10-30T19:48:43Z", "type": "commit"}, {"oid": "90442eb01dc259d9118a5554483e3e8cc596c138", "url": "https://github.com/phac-nml/irida/commit/90442eb01dc259d9118a5554483e3e8cc596c138", "message": "Fixed issue with old 'summary' link", "committedDate": "2020-10-31T01:41:50Z", "type": "commit"}, {"oid": "77c80997391eb93f68383dc8125d99394691933b", "url": "https://github.com/phac-nml/irida/commit/77c80997391eb93f68383dc8125d99394691933b", "message": ":construction: Initial context work", "committedDate": "2020-10-31T02:49:38Z", "type": "commit"}, {"oid": "9cc6b1dddc584be334b30aff67502a497c5ff5cf", "url": "https://github.com/phac-nml/irida/commit/9cc6b1dddc584be334b30aff67502a497c5ff5cf", "message": "Images don't need to be in the context", "committedDate": "2020-10-31T03:17:30Z", "type": "commit"}, {"oid": "45da767fdd65002973f401bbf2ff3e57a9564e45", "url": "https://github.com/phac-nml/irida/commit/45da767fdd65002973f401bbf2ff3e57a9564e45", "message": "Merge pull request #8 from phac-nml/refactor-fastqc-context\n\n:construction: Initial context work", "committedDate": "2020-10-31T16:55:34Z", "type": "commit"}, {"oid": "83628c4c636c9c4a49099e94d1317e0658983acf", "url": "https://github.com/phac-nml/irida/commit/83628c4c636c9c4a49099e94d1317e0658983acf", "message": "Added redirect from summary pages. Images not found/readable will not throw an exception and cause page to error but will instead return an empty byte array.", "committedDate": "2020-10-31T19:11:57Z", "type": "commit"}, {"oid": "4bf3f04cbf9174990aa7295b204fb32407ea5552", "url": "https://github.com/phac-nml/irida/commit/4bf3f04cbf9174990aa7295b204fb32407ea5552", "message": "Added logger error messages for when reading an image file throws an exception. Updated fastqc page navigation to work in all cases", "committedDate": "2020-10-31T19:55:16Z", "type": "commit"}, {"oid": "85d60a0d09e1e228eee49a6f7d9ea5ac73ee4266", "url": "https://github.com/phac-nml/irida/commit/85d60a0d09e1e228eee49a6f7d9ea5ac73ee4266", "message": "Removed unused import and added missing @param to javadoc", "committedDate": "2020-10-31T21:02:59Z", "type": "commit"}, {"oid": "9c7fa82231b64cb0e1c30639ccd54cf07739b842", "url": "https://github.com/phac-nml/irida/commit/9c7fa82231b64cb0e1c30639ccd54cf07739b842", "message": "Refactored redirect", "committedDate": "2020-11-01T16:55:36Z", "type": "commit"}, {"oid": "953ffeb24c1ac1fa655c273ddc6676d57bf944a7", "url": "https://github.com/phac-nml/irida/commit/953ffeb24c1ac1fa655c273ddc6676d57bf944a7", "message": "Fixed uri for sequencingruns", "committedDate": "2020-11-01T17:03:34Z", "type": "commit"}, {"oid": "0c555c85911915a623406911392d51757e549023", "url": "https://github.com/phac-nml/irida/commit/0c555c85911915a623406911392d51757e549023", "message": "Merge branch 'development' into refactor-fastqc-page", "committedDate": "2020-11-02T12:54:34Z", "type": "commit"}]}