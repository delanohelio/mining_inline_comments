{"pr_number": 699, "pr_title": "Remove momentjs (except on project samples page)", "pr_createdAt": "2020-05-22T14:03:02Z", "pr_url": "https://github.com/phac-nml/irida/pull/699", "timeline": [{"oid": "f3ae16a9fba2f2f4f091df3b678f91c5465a09ae", "url": "https://github.com/phac-nml/irida/commit/f3ae16a9fba2f2f4f091df3b678f91c5465a09ae", "message": "\ud83d\udc7d\ufe0f Fixed missing i18n strings", "committedDate": "2020-05-22T13:43:42Z", "type": "commit"}, {"oid": "23f631f0a1ca4277ce0e53b3d41756e7bbea95ff", "url": "https://github.com/phac-nml/irida/commit/23f631f0a1ca4277ce0e53b3d41756e7bbea95ff", "message": "Updating to remove \"most\" of momentjs", "committedDate": "2020-05-22T13:44:56Z", "type": "commit"}, {"oid": "e4d863d87600829d948d36b7eb7ddff9286fbd1b", "url": "https://github.com/phac-nml/irida/commit/e4d863d87600829d948d36b7eb7ddff9286fbd1b", "message": "Updated CHANGELOG", "committedDate": "2020-05-22T14:02:43Z", "type": "commit"}, {"oid": "d82cc8e1955113db4c98ad56b37c8c92f85d1fb9", "url": "https://github.com/phac-nml/irida/commit/d82cc8e1955113db4c98ad56b37c8c92f85d1fb9", "message": "Merge branch '\u26d4\ufe0f-development' into replace-momentjs", "committedDate": "2020-05-23T01:52:15Z", "type": "commit"}, {"oid": "bc3db41b31d07065da8fe028a4bdf8e808ec979e", "url": "https://github.com/phac-nml/irida/commit/bc3db41b31d07065da8fe028a4bdf8e808ec979e", "message": "Date format update in UI, needed to update test", "committedDate": "2020-05-25T11:48:53Z", "type": "commit"}, {"oid": "a76cfaabc950ef38016d28c19c0351d7648507c4", "url": "https://github.com/phac-nml/irida/commit/a76cfaabc950ef38016d28c19c0351d7648507c4", "message": "Decided to remove the seconds", "committedDate": "2020-05-25T11:50:36Z", "type": "commit"}, {"oid": "3694a3c21b3a169d9a0cec97f18ddd873ee09cc0", "url": "https://github.com/phac-nml/irida/commit/3694a3c21b3a169d9a0cec97f18ddd873ee09cc0", "message": "Fixed wrong humanization", "committedDate": "2020-05-25T16:09:32Z", "type": "commit"}, {"oid": "12c74b56f02d38df498da5eefa0b84ea12771432", "url": "https://github.com/phac-nml/irida/commit/12c74b56f02d38df498da5eefa0b84ea12771432", "message": "Fixed time format", "committedDate": "2020-05-25T18:04:09Z", "type": "commit"}, {"oid": "cb6ef17c2fbce0f134be177a383a79262fbf083f", "url": "https://github.com/phac-nml/irida/commit/cb6ef17c2fbce0f134be177a383a79262fbf083f", "message": "Fixed broken testing time format and link", "committedDate": "2020-05-25T19:11:45Z", "type": "commit"}, {"oid": "d9acc4eb752c51d089dd84030951a6d441dc5717", "url": "https://github.com/phac-nml/irida/commit/d9acc4eb752c51d089dd84030951a6d441dc5717", "message": "Merge branch '\u26d4\ufe0f-development' into replace-momentjs", "committedDate": "2020-05-26T18:47:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUyNjQ5Ng==", "url": "https://github.com/phac-nml/irida/pull/699#discussion_r430526496", "bodyText": "Change the constant d to something more descriptive", "author": "deepsidhu85", "createdAt": "2020-05-26T15:59:49Z", "path": "src/main/webapp/resources/js/utilities/date-utilities.js", "diffHunk": "@@ -1,79 +1,72 @@\n-import moment from \"moment\";\n+import dayjs from \"dayjs\";\n+import relativeTime from \"dayjs/plugin/relativeTime\";\n+import duration from \"dayjs/plugin/duration\";\n \n-export function formatInternationalizedDateTime(d, options = {}) {\n-  const params = {\n+export function formatInternationalizedDateTime(\n+  d,\n+  options = {\n     hour: \"numeric\",\n     minute: \"numeric\",\n-    second: \"numeric\",\n     year: \"numeric\",\n     month: \"short\",\n     day: \"numeric\",\n-    ...options\n-  };\n-  return new Intl.DateTimeFormat(window.TL.LANGUAGE_TAG, params).format(\n+  }\n+) {\n+  if (!isDate(d)) return \"\";\n+  return new Intl.DateTimeFormat(window.TL.LANGUAGE_TAG, options).format(\n     new Date(d)\n   );\n }\n \n-/**\n- * Get how much time has passed since a certain date.\n- * @param {Number} now current\n- * @param {Number} date event occurred\n- * @return {string} formatted time since.\n- */\n-export function formatTimeForNow({ now, date }) {\n-  const dNow = new Date(now);\n-  const dDate = new Date(date);\n-  if (moment.isDate(dNow) && moment.isDate(dDate)) {\n-    return moment(dDate).from(moment(dNow));\n-  }\n-}\n-\n /**\n  * Generate the a human readable form from milliseconds.\n  * @param {Number} date to format\n  * @return {string} humanized version of the date\n  */\n export function getHumanizedDuration({ date }) {\n-  if (date !== null) {\n-    return moment.duration(date).humanize();\n-  }\n-  return \"\";\n+  dayjs.extend(duration);\n+  dayjs.extend(relativeTime);\n+  return dayjs.duration(-date).humanize(false);\n }\n \n /**\n  * Generate the time from now.  Renders as human readable.s\n- * @param {string} date raw string date from server\n+ * @param {number} date raw string date from server\n  * @return {*}\n  */\n export function fromNow({ date }) {\n-  const start = new Date(date);\n-  if (moment.isDate(start)) {\n-    const t = moment(start).fromNow();\n-    return t;\n-  }\n-  return \"\";\n+  // Using dayjs because Intl.RelativeTimeFormat does not have browser\n+  // support in IE11 or safari yet.\n+  dayjs.extend(duration);\n+  dayjs.extend(relativeTime);\n+  const d1 = dayjs();\n+  const d2 = dayjs(date);\n+  return dayjs.duration(d2.diff(d1)).humanize(true);\n }\n \n /**\n  * Format unix timestamp as human readable string.\n- * @param  {Number} date unix timestamp\n+ * @param  {(string | number)} date unix timestamp\n  * @param {String} format defaults to \"lll\" which is mmm dd, YYYY h:mm AM\n  * @return {string} formatted date\n  */\n-export function formatDate({ date, format = \"lll\" }) {\n-  const t = new Date(date);\n-  if (moment.isDate(t)) {\n-    return moment(t).format(format);\n-  }\n-  return \"\";\n+export function formatDate({ date, format }) {\n+  return formatInternationalizedDateTime(date, format);\n }\n \n /**\n  * Utility function to determine if a string is a date.\n- * @param {string} date\n+ * @param {(number | string)} date\n  * @returns {boolean}\n  */\n export function isDate(date) {\n-  return moment.isDate(new Date(date));\n+  const d = new Date(date);", "originalCommit": "cb6ef17c2fbce0f134be177a383a79262fbf083f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY2MzM4NA==", "url": "https://github.com/phac-nml/irida/pull/699#discussion_r430663384", "bodyText": "Removed in 32cc2f1", "author": "joshsadam", "createdAt": "2020-05-26T19:41:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUyNjQ5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUyNjg5Ng==", "url": "https://github.com/phac-nml/irida/pull/699#discussion_r430526896", "bodyText": "Change the constant d1 and d2 to something more descriptive", "author": "deepsidhu85", "createdAt": "2020-05-26T16:00:23Z", "path": "src/main/webapp/resources/js/utilities/date-utilities.js", "diffHunk": "@@ -1,79 +1,72 @@\n-import moment from \"moment\";\n+import dayjs from \"dayjs\";\n+import relativeTime from \"dayjs/plugin/relativeTime\";\n+import duration from \"dayjs/plugin/duration\";\n \n-export function formatInternationalizedDateTime(d, options = {}) {\n-  const params = {\n+export function formatInternationalizedDateTime(\n+  d,\n+  options = {\n     hour: \"numeric\",\n     minute: \"numeric\",\n-    second: \"numeric\",\n     year: \"numeric\",\n     month: \"short\",\n     day: \"numeric\",\n-    ...options\n-  };\n-  return new Intl.DateTimeFormat(window.TL.LANGUAGE_TAG, params).format(\n+  }\n+) {\n+  if (!isDate(d)) return \"\";\n+  return new Intl.DateTimeFormat(window.TL.LANGUAGE_TAG, options).format(\n     new Date(d)\n   );\n }\n \n-/**\n- * Get how much time has passed since a certain date.\n- * @param {Number} now current\n- * @param {Number} date event occurred\n- * @return {string} formatted time since.\n- */\n-export function formatTimeForNow({ now, date }) {\n-  const dNow = new Date(now);\n-  const dDate = new Date(date);\n-  if (moment.isDate(dNow) && moment.isDate(dDate)) {\n-    return moment(dDate).from(moment(dNow));\n-  }\n-}\n-\n /**\n  * Generate the a human readable form from milliseconds.\n  * @param {Number} date to format\n  * @return {string} humanized version of the date\n  */\n export function getHumanizedDuration({ date }) {\n-  if (date !== null) {\n-    return moment.duration(date).humanize();\n-  }\n-  return \"\";\n+  dayjs.extend(duration);\n+  dayjs.extend(relativeTime);\n+  return dayjs.duration(-date).humanize(false);\n }\n \n /**\n  * Generate the time from now.  Renders as human readable.s\n- * @param {string} date raw string date from server\n+ * @param {number} date raw string date from server\n  * @return {*}\n  */\n export function fromNow({ date }) {\n-  const start = new Date(date);\n-  if (moment.isDate(start)) {\n-    const t = moment(start).fromNow();\n-    return t;\n-  }\n-  return \"\";\n+  // Using dayjs because Intl.RelativeTimeFormat does not have browser\n+  // support in IE11 or safari yet.\n+  dayjs.extend(duration);\n+  dayjs.extend(relativeTime);\n+  const d1 = dayjs();", "originalCommit": "cb6ef17c2fbce0f134be177a383a79262fbf083f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY2MzQxOQ==", "url": "https://github.com/phac-nml/irida/pull/699#discussion_r430663419", "bodyText": "Removed in 32cc2f1", "author": "joshsadam", "createdAt": "2020-05-26T19:41:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUyNjg5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUyNzE2Nw==", "url": "https://github.com/phac-nml/irida/pull/699#discussion_r430527167", "bodyText": "Change the constant d to something more descriptive", "author": "deepsidhu85", "createdAt": "2020-05-26T16:00:47Z", "path": "src/main/webapp/resources/js/utilities/date-utilities.js", "diffHunk": "@@ -1,79 +1,72 @@\n-import moment from \"moment\";\n+import dayjs from \"dayjs\";\n+import relativeTime from \"dayjs/plugin/relativeTime\";\n+import duration from \"dayjs/plugin/duration\";\n \n-export function formatInternationalizedDateTime(d, options = {}) {\n-  const params = {\n+export function formatInternationalizedDateTime(\n+  d,", "originalCommit": "cb6ef17c2fbce0f134be177a383a79262fbf083f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY2MzQ3Nw==", "url": "https://github.com/phac-nml/irida/pull/699#discussion_r430663477", "bodyText": "Renamed in b901455", "author": "joshsadam", "createdAt": "2020-05-26T19:41:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUyNzE2Nw=="}], "type": "inlineReview"}, {"oid": "32cc2f166c5daf0684c0290146aad66b22d24703", "url": "https://github.com/phac-nml/irida/commit/32cc2f166c5daf0684c0290146aad66b22d24703", "message": "Removed undescriptive variables", "committedDate": "2020-05-26T19:40:17Z", "type": "commit"}, {"oid": "b9014552b2d05dfd2ba96f50c7e74571063595a0", "url": "https://github.com/phac-nml/irida/commit/b9014552b2d05dfd2ba96f50c7e74571063595a0", "message": "Renamed variable", "committedDate": "2020-05-26T19:42:11Z", "type": "commit"}, {"oid": "e9791929ef7e1483903b768d2ffa071cc94c14f3", "url": "https://github.com/phac-nml/irida/commit/e9791929ef7e1483903b768d2ffa071cc94c14f3", "message": "Merge branch 'development' into replace-momentjs", "committedDate": "2020-05-29T18:39:06Z", "type": "commit"}, {"oid": "923a69cb04e626d91d3da312c03daf593af73e21", "url": "https://github.com/phac-nml/irida/commit/923a69cb04e626d91d3da312c03daf593af73e21", "message": ":memo: Updated CHANGELOG.md", "committedDate": "2020-05-29T18:39:33Z", "type": "commit"}, {"oid": "fd337f7be152a60bbba674fa33bb67861f9dc658", "url": "https://github.com/phac-nml/irida/commit/fd337f7be152a60bbba674fa33bb67861f9dc658", "message": "Merge branch 'development' into replace-momentjs\n\n# Conflicts:\n#\tCHANGELOG.md", "committedDate": "2020-06-01T20:39:32Z", "type": "commit"}]}