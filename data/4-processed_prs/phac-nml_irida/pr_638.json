{"pr_number": 638, "pr_title": "Linker assembly toggle", "pr_createdAt": "2020-03-25T13:59:03Z", "pr_url": "https://github.com/phac-nml/irida/pull/638", "timeline": [{"oid": "6ad446d12c061687ab4d93d8afbcbc91dc272714", "url": "https://github.com/phac-nml/irida/commit/6ad446d12c061687ab4d93d8afbcbc91dc272714", "message": "starting to add toggles for which filetype for the linker", "committedDate": "2020-03-24T19:38:26Z", "type": "commit"}, {"oid": "10b66cda7a0c5a2cfb9ac5fb75e10eaf9bc95036", "url": "https://github.com/phac-nml/irida/commit/10b66cda7a0c5a2cfb9ac5fb75e10eaf9bc95036", "message": "trying to get the linker text to update using state", "committedDate": "2020-03-25T13:57:58Z", "type": "commit"}, {"oid": "4c9350f9db3d107bb099e4296fcece5de4213eda", "url": "https://github.com/phac-nml/irida/commit/4c9350f9db3d107bb099e4296fcece5de4213eda", "message": "Working updated modal", "committedDate": "2020-03-25T15:35:41Z", "type": "commit"}, {"oid": "dfa9305d3777479f631035abd09fdb3018800b39", "url": "https://github.com/phac-nml/irida/commit/dfa9305d3777479f631035abd09fdb3018800b39", "message": "Adding logic to add typestring", "committedDate": "2020-03-25T19:58:52Z", "type": "commit"}, {"oid": "a5faa455e8e2d5aa45a3309285657cc9f901e8b0", "url": "https://github.com/phac-nml/irida/commit/a5faa455e8e2d5aa45a3309285657cc9f901e8b0", "message": "added i18n and some comments for the linker stuff", "committedDate": "2020-03-25T20:27:42Z", "type": "commit"}, {"oid": "ce6bcdf73830dc402661f17e1765034eb004c3e5", "url": "https://github.com/phac-nml/irida/commit/ce6bcdf73830dc402661f17e1765034eb004c3e5", "message": "updated changelog with linker script stuff", "committedDate": "2020-03-25T20:29:13Z", "type": "commit"}, {"oid": "e7d03eb344763fac12f6f78dae2690b48ed1f7c3", "url": "https://github.com/phac-nml/irida/commit/e7d03eb344763fac12f6f78dae2690b48ed1f7c3", "message": "updated docs with new linker screenshot", "committedDate": "2020-03-25T20:37:08Z", "type": "commit"}, {"oid": "7e70467c45d41c19dbf07b4b279ba8619a3d4d59", "url": "https://github.com/phac-nml/irida/commit/7e70467c45d41c19dbf07b4b279ba8619a3d4d59", "message": "added test functionality for linker types", "committedDate": "2020-03-25T20:45:14Z", "type": "commit"}, {"oid": "18429c6ac2e5a4064ff9f11c222b0d397ee6d2b5", "url": "https://github.com/phac-nml/irida/commit/18429c6ac2e5a4064ff9f11c222b0d397ee6d2b5", "message": "Merge branch 'development' into linker-assembly-toggle", "committedDate": "2020-03-26T12:50:16Z", "type": "commit"}, {"oid": "ba2cde9a19c77894e1e6c1da4c67a1b9bd0dd99d", "url": "https://github.com/phac-nml/irida/commit/ba2cde9a19c77894e1e6c1da4c67a1b9bd0dd99d", "message": "updated comments for the linker script", "committedDate": "2020-03-26T14:53:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY0MDYzMw==", "url": "https://github.com/phac-nml/irida/pull/638#discussion_r398640633", "bodyText": "Remove {\" \"} that's an artifact from formatting with Prettier. It thinks you literally want to add a space.", "author": "joshsadam", "createdAt": "2020-03-26T14:59:31Z", "path": "src/main/webapp/resources/js/pages/projects/samples/linker/Linker.jsx", "diffHunk": "@@ -27,33 +27,79 @@ const CommandText = styled(Paragraph)`\n  * @constructor\n  */\n function Linker() {\n+  const options = [\n+    { label: i18n(\"Linker.fastq\"), value: \"fastq\" },\n+    { label: i18n(\"Linker.assembly\"), value: \"assembly\" }\n+  ];\n+\n+  //this will hold the base string of the script with the projects & samples.  The filetypes will be appended before displaying.\n+  let scriptString = undefined;\n+\n+  let modal = undefined; \n+\n+  const ModalContents = (\n+    { command } \n+  ) => (\n+    <>\n+      {\" \"}", "originalCommit": "ba2cde9a19c77894e1e6c1da4c67a1b9bd0dd99d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIwNTk2MA==", "url": "https://github.com/phac-nml/irida/pull/638#discussion_r400205960", "bodyText": "Removed in 0c2a1d3", "author": "tom114", "createdAt": "2020-03-30T13:49:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY0MDYzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg2MDg5Mg==", "url": "https://github.com/phac-nml/irida/pull/638#discussion_r398860892", "bodyText": "You can rename a variable when you are destructuring the object, so:\n getNGSLinkerCode(detail).then(({ data : scriptString }) => {\n\nwould give the same result.", "author": "joshsadam", "createdAt": "2020-03-26T20:11:29Z", "path": "src/main/webapp/resources/js/pages/projects/samples/linker/Linker.jsx", "diffHunk": "@@ -27,33 +27,79 @@ const CommandText = styled(Paragraph)`\n  * @constructor\n  */\n function Linker() {\n+  const options = [\n+    { label: i18n(\"Linker.fastq\"), value: \"fastq\" },\n+    { label: i18n(\"Linker.assembly\"), value: \"assembly\" }\n+  ];\n+\n+  //this will hold the base string of the script with the projects & samples.  The filetypes will be appended before displaying.\n+  let scriptString = undefined;\n+\n+  let modal = undefined; \n+\n+  const ModalContents = (\n+    { command } \n+  ) => (\n+    <>\n+      {\" \"}\n+      <Paragraph>{i18n(\"Linker.details\")}</Paragraph>\n+      <Text type=\"secondary\">\n+        <span dangerouslySetInnerHTML={{ __html: i18n(\"Linker.note\") }} />\n+      </Text>\n+      <br/><br/>\n+      <Text strong>{i18n(\"Linker.types\")}</Text> <Checkbox.Group\n+        options={options}\n+        defaultValue={[\"fastq\"]}\n+        onChange={updateCommand}\n+      />\n+      <CommandText\n+        className=\"t-cmd-text\"\n+        ellipsis={{ rows: 1 }}\n+        copyable={ command }\n+      >\n+        {command}\n+      </CommandText>\n+      \n+    </>\n+  );\n+\n   function handleSampleIds(e) {\n-    // Post data to get linker command.\n+    // Post data to the server to get the linker command.\n     const { detail } = e;\n     getNGSLinkerCode(detail).then(({ data }) => {\n-      Modal.success({\n+      scriptString = data;", "originalCommit": "ba2cde9a19c77894e1e6c1da4c67a1b9bd0dd99d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIwNzQ4OQ==", "url": "https://github.com/phac-nml/irida/pull/638#discussion_r400207489", "bodyText": "So this wasn't just renaming the variable.  That variable is at https://github.com/phac-nml/irida/pull/638/files#diff-383b10c14b55cb1fcd2260780fbcf323R36 to hold the base of the script string so when it gets updated it doesn't have to repeat the server call.  See how it's building the string to display at https://github.com/phac-nml/irida/pull/638/files#diff-383b10c14b55cb1fcd2260780fbcf323R97.\nLet me know if there's a different way to go about this.", "author": "tom114", "createdAt": "2020-03-30T13:51:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg2MDg5Mg=="}], "type": "inlineReview"}, {"oid": "0c2a1d3124b439acc7a9338ab6289d8a6d349209", "url": "https://github.com/phac-nml/irida/commit/0c2a1d3124b439acc7a9338ab6289d8a6d349209", "message": "removed unnecessary space", "committedDate": "2020-03-30T13:48:23Z", "type": "commit"}, {"oid": "b5b0314aae7da120866d10aaeb1d26ed3e4b4ee1", "url": "https://github.com/phac-nml/irida/commit/b5b0314aae7da120866d10aaeb1d26ed3e4b4ee1", "message": "Cleaned up how modal get updated", "committedDate": "2020-03-30T16:09:52Z", "type": "commit"}, {"oid": "46931f5fb80dc24ea9a492508e01aa606963192c", "url": "https://github.com/phac-nml/irida/commit/46931f5fb80dc24ea9a492508e01aa606963192c", "message": "Made default `fastq` not `fasta`", "committedDate": "2020-03-30T18:51:35Z", "type": "commit"}, {"oid": "c6a0457908e38f97b05412e6ed6795d8d3539266", "url": "https://github.com/phac-nml/irida/commit/c6a0457908e38f97b05412e6ed6795d8d3539266", "message": "Merge pull request #35 from phac-nml/linker-assembly-toggle-modal-cleanup\n\nLinker toggle Modal cleanup", "committedDate": "2020-03-30T20:42:25Z", "type": "commit"}, {"oid": "d7a50a5efe0c4c2001dca9d08035b8e444c447d0", "url": "https://github.com/phac-nml/irida/commit/d7a50a5efe0c4c2001dca9d08035b8e444c447d0", "message": "Merge branch 'development' into linker-assembly-toggle", "committedDate": "2020-03-30T21:18:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0MjE1MQ==", "url": "https://github.com/phac-nml/irida/pull/638#discussion_r401042151", "bodyText": "Replace this with IconCode it's already in the imports, but I must have missed updating it.  Please then remove the import for CodeOutlined", "author": "joshsadam", "createdAt": "2020-03-31T16:17:14Z", "path": "src/main/webapp/resources/js/pages/projects/samples/linker/Linker.jsx", "diffHunk": "@@ -27,58 +29,85 @@ const CommandText = styled(Paragraph)`\n  * @constructor\n  */\n function Linker() {\n-  function handleSampleIds(e) {\n-    // Post data to get linker command.\n-    const { detail } = e;\n+  const [visible, setVisible] = useState(false);\n+  const [types, setTypes] = useState([\"fastq\"]);\n+  const [scriptString, setScriptString] = useState();\n+  const [command, setCommand] = useState();\n+\n+  const options = [\n+    { label: i18n(\"Linker.fastq\"), value: \"fastq\" },\n+    { label: i18n(\"Linker.assembly\"), value: \"assembly\" }\n+  ];\n+\n+  function handleSampleIds({ detail }) {\n     getNGSLinkerCode(detail).then(({ data }) => {\n-      Modal.success({\n-        className: \"t-linker-modal\",\n-        width: 500,\n-        title: i18n(\"Linker.title\"),\n-        content: (\n-          <>\n-            <Paragraph>{i18n(\"Linker.details\")}</Paragraph>\n-            <Text type=\"secondary\">\n-              <span dangerouslySetInnerHTML={{ __html: i18n(\"Linker.note\") }} />\n-            </Text>\n-            <CommandText\n-              className=\"t-cmd-text\"\n-              ellipsis={{ rows: 1 }}\n-              copyable={{ text: data }}\n-            >\n-              {data}\n-            </CommandText>\n-          </>\n-        )\n-      });\n+      // Post data to the server to get the linker command.\n+      setScriptString(data);\n+      setVisible(true);\n     });\n   }\n \n+  useEffect(() => {\n+    setCommand(\n+      types.length ? `${scriptString} -t ${types.join(\",\")}` : scriptString\n+    );\n+  }, [scriptString, types]);\n+\n   /*\n   These Listeners and Dispatchers are a way to get around the separation between react\n   components and the legacy JS code already on the page.\n   */\n   document.addEventListener(\"sample-ids-return\", handleSampleIds, false);\n \n-  function showModal() {\n+  function getIds() {\n     document.dispatchEvent(new Event(\"sample-ids\"));\n   }\n \n   return (\n-    <Button\n-      type=\"link\"\n-      style={{\n-        margin: `0 inherit`,\n-        padding: 0,\n-        color: grey9\n-      }}\n-      className=\"t-linker-btn\"\n-      onClick={showModal}\n-    >\n-      {/* constant marginRight here to match old styles */}\n-      <IconCode style={{ marginRight: 2 }} />\n-      {i18n(\"project.samples.export.linker\")}\n-    </Button>\n+    <>\n+      <Button\n+        type=\"link\"\n+        style={{\n+          margin: `0 inherit`,\n+          padding: 0,\n+          color: grey9\n+        }}\n+        className=\"t-linker-btn\"\n+        onClick={getIds}\n+      >\n+        {/* constant marginRight here to match old styles */}\n+        <CodeOutlined style={{ marginRight: 2 }} />", "originalCommit": "d7a50a5efe0c4c2001dca9d08035b8e444c447d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYwNTI0NQ==", "url": "https://github.com/phac-nml/irida/pull/638#discussion_r401605245", "bodyText": "Done in 6cff5b9", "author": "tom114", "createdAt": "2020-04-01T13:15:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0MjE1MQ=="}], "type": "inlineReview"}, {"oid": "6cff5b9ca56d1d2460ba79d3eb1cc7e96f9407e7", "url": "https://github.com/phac-nml/irida/commit/6cff5b9ca56d1d2460ba79d3eb1cc7e96f9407e7", "message": "changed to iconcode", "committedDate": "2020-04-01T13:14:07Z", "type": "commit"}, {"oid": "3cb9bdbf0ba0a1269c15d38f6ee8506120399875", "url": "https://github.com/phac-nml/irida/commit/3cb9bdbf0ba0a1269c15d38f6ee8506120399875", "message": "Merge branch 'development' into linker-assembly-toggle", "committedDate": "2020-04-07T17:38:01Z", "type": "commit"}, {"oid": "e8203909b964efd7e7442db6f25dd1f33540c533", "url": "https://github.com/phac-nml/irida/commit/e8203909b964efd7e7442db6f25dd1f33540c533", "message": "added linker detail in changelog", "committedDate": "2020-04-07T17:38:57Z", "type": "commit"}, {"oid": "2ae9c56540296cf728ebac3271d69ce4ccc76e62", "url": "https://github.com/phac-nml/irida/commit/2ae9c56540296cf728ebac3271d69ce4ccc76e62", "message": "Revert \"added linker detail in changelog\"\n\nThis reverts commit e8203909b964efd7e7442db6f25dd1f33540c533.", "committedDate": "2020-04-07T17:40:17Z", "type": "commit"}, {"oid": "22a686bb61ecec798832145a790126a019f40c63", "url": "https://github.com/phac-nml/irida/commit/22a686bb61ecec798832145a790126a019f40c63", "message": "Merge branch 'development' into linker-assembly-toggle", "committedDate": "2020-04-08T13:39:07Z", "type": "commit"}]}