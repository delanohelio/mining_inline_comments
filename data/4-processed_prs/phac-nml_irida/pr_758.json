{"pr_number": 758, "pr_title": "Fixed user groups redirect routing", "pr_createdAt": "2020-07-20T14:59:16Z", "pr_url": "https://github.com/phac-nml/irida/pull/758", "timeline": [{"oid": "a4e3ed2976fe1b0a28f8a6ab6f39d3b325b9e8c8", "url": "https://github.com/phac-nml/irida/commit/a4e3ed2976fe1b0a28f8a6ab6f39d3b325b9e8c8", "message": "Fixed user groups redirect routing", "committedDate": "2020-07-19T06:48:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUyMzgxNQ==", "url": "https://github.com/phac-nml/irida/pull/758#discussion_r457523815", "bodyText": "Consider use useResetFormOnCloseModal it automatically resets the form when the modal closes. \u00a0See AddGroupButton.jsx.", "author": "joshsadam", "createdAt": "2020-07-20T16:03:48Z", "path": "src/main/webapp/resources/js/pages/UserGroupsPage/components/CreateNewUserGroupButton.jsx", "diffHunk": "@@ -3,13 +3,14 @@ import { AddNewButton } from \"../../../components/Buttons/AddNewButton\";\n import { Form, Input, Modal } from \"antd\";\n import { createUserGroup } from \"../../../apis/users/groups\";\n import { useNavigate } from \"@reach/router\";\n+import { setBaseUrl } from \"../../../utilities/url-utilities\";", "originalCommit": "a4e3ed2976fe1b0a28f8a6ab6f39d3b325b9e8c8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU1MDA5NA==", "url": "https://github.com/phac-nml/irida/pull/758#discussion_r457550094", "bodyText": "Call the setBaseUrl on it here. Even better would be creating a constant for the url since it is the same as what you are passing in the path", "author": "joshsadam", "createdAt": "2020-07-20T16:45:28Z", "path": "src/main/webapp/resources/js/pages/UserGroupsPage/index.js", "diffHunk": "@@ -43,8 +43,8 @@ export function UserGroups() {\n     >\n       <RolesProvider rolesFn={getUserGroupRoles}>\n         <Router style={{ height: \"100%\" }}>\n-          <UserGroupsPage path={setBaseUrl(\"/groups\")} />\n-          <UserGroupsDetailsPage path={setBaseUrl(\"/groups/:id\")} />\n+          <UserGroupsPage baseUrl={\"/groups\"} path={setBaseUrl(\"/groups\")} />", "originalCommit": "a4e3ed2976fe1b0a28f8a6ab6f39d3b325b9e8c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQ2MDkyOA==", "url": "https://github.com/phac-nml/irida/pull/758#discussion_r466460928", "bodyText": "Awesome, can you just update the JSDoc for the baseUrl to state that it should already be set. \u00a0Easier to understand if we use this component in different places.", "author": "joshsadam", "createdAt": "2020-08-06T14:38:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU1MDA5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU1MjgzNQ==", "url": "https://github.com/phac-nml/irida/pull/758#discussion_r457552835", "bodyText": "Same here, I think it is more clear to call setBaseUrl here since you only append to it in the child component.", "author": "joshsadam", "createdAt": "2020-07-20T16:50:02Z", "path": "src/main/webapp/resources/js/pages/admin/components/AdminUserGroupsPage.jsx", "diffHunk": "@@ -0,0 +1,27 @@\n+import React, { lazy } from \"react\";\n+import { Router } from \"@reach/router\";\n+import { setBaseUrl } from \"../../../utilities/url-utilities\";\n+import { RolesProvider } from \"../../../contexts\";\n+import { getUserGroupRoles } from \"../../../apis/users/groups\";\n+\n+const UserGroupsPage = lazy(() => import(\"../../UserGroupsPage/components/UserGroupsPage\"));\n+const UserGroupsDetailsPage = lazy(() =>\n+  import(\"../../UserGroupsPage/components/UserGroupDetailsPage\")\n+);\n+\n+/**\n+ * React component to display pages related to User Groups in the Admin Panel. This is a base page\n+ * for both listing of user groups and user group details.\n+ * @returns {*}\n+ * @constructor\n+ */\n+export default function AdminUserGroupsPage() {\n+  return (\n+      <RolesProvider rolesFn={getUserGroupRoles}>\n+        <Router>\n+          <UserGroupsPage baseUrl={\"/admin/groups\"} path={setBaseUrl(\"\")} />", "originalCommit": "a4e3ed2976fe1b0a28f8a6ab6f39d3b325b9e8c8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "77b236fe185afe38ed2d6f68a1ba127489f055f2", "url": "https://github.com/phac-nml/irida/commit/77b236fe185afe38ed2d6f68a1ba127489f055f2", "message": "Changed baseUrl usage, modified delete user group button to allow usage in admin panel, still need to fix tests", "committedDate": "2020-07-22T02:57:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEzOTk1Mg==", "url": "https://github.com/phac-nml/irida/pull/758#discussion_r459139952", "bodyText": "Since setBaseUrl(\"/admin/groups\") is called multiple times it would be better to set this as a constant", "author": "deepsidhu85", "createdAt": "2020-07-22T23:28:59Z", "path": "src/main/webapp/resources/js/pages/admin/components/AdminUserGroupsPage.jsx", "diffHunk": "@@ -19,8 +19,8 @@ export default function AdminUserGroupsPage() {\n   return (\n       <RolesProvider rolesFn={getUserGroupRoles}>\n         <Router>\n-          <UserGroupsPage baseUrl={\"/admin/groups\"} path={setBaseUrl(\"\")} />\n-          <UserGroupsDetailsPage baseUrl={\"/admin/groups\"} path={setBaseUrl(\"/:id\")} />\n+          <UserGroupsPage baseUrl={setBaseUrl(\"/admin/groups\")} path={setBaseUrl(\"\")} />", "originalCommit": "77b236fe185afe38ed2d6f68a1ba127489f055f2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "425e44453d05a120c09d27d9ffeb6d68355f384a", "url": "https://github.com/phac-nml/irida/commit/425e44453d05a120c09d27d9ffeb6d68355f384a", "message": "Fixed user groups tests by waiting for route change, added deletion notification that still needs to be fixed to show up in admin panel", "committedDate": "2020-07-27T19:20:41Z", "type": "commit"}, {"oid": "6754e09e39f9c0ccde878ccefc452a5a66737bd3", "url": "https://github.com/phac-nml/irida/commit/6754e09e39f9c0ccde878ccefc452a5a66737bd3", "message": "Changed delete user group notification to use antd and fixed problem of it not showing up in admin panel", "committedDate": "2020-07-28T14:35:25Z", "type": "commit"}, {"oid": "f88eac4f1ff13997435212f5fb62b18b3db160e0", "url": "https://github.com/phac-nml/irida/commit/f88eac4f1ff13997435212f5fb62b18b3db160e0", "message": "Removed unused methods in UserGroupsController.java", "committedDate": "2020-07-28T21:08:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE3NDAyNA==", "url": "https://github.com/phac-nml/irida/pull/758#discussion_r463174024", "bodyText": "You don't need to interpolate the baseUrl here just navigate(baseUrl, {replace:true}).", "author": "joshsadam", "createdAt": "2020-07-30T17:58:49Z", "path": "src/main/webapp/resources/js/pages/UserGroupsPage/components/UserGroupDetailsPage.jsx", "diffHunk": "@@ -123,29 +132,24 @@ export default function UserGroupDetailsPage({ id }) {\n   const DeleteGroup = () => (\n     <div>\n       <WarningAlert message={i18n(\"UserGroupDetailsPage.delete-warning\")} />\n-      <form\n-        style={{ marginTop: SPACE_SM }}\n-        ref={deleteRef}\n-        action={setBaseUrl(`/groups/${id}/delete`)}\n-        method=\"POST\"\n-      >\n+      <div style={{ marginTop: SPACE_SM }}>\n         <Popconfirm\n-          onConfirm={() => deleteRef.current.submit()}\n+          onConfirm={deleteUserGroup}\n           title={i18n(\"UserGroupDetailsPage.delete-confirm\")}\n           okButtonProps={{ className: \"t-delete-confirm-btn\" }}\n         >\n           <Button className=\"t-delete-group-btn\" type=\"primary\" danger>\n             {i18n(\"UserGroupDetailsPage.delete-button\")}\n           </Button>\n         </Popconfirm>\n-      </form>\n+      </div>\n     </div>\n   );\n \n   return (\n     <PageWrapper\n       title={\"User Groups\"}\n-      onBack={() => navigate(setBaseUrl(\"/groups\"), { replace: true })}\n+      onBack={() => navigate(`${baseUrl}`, { replace: true })}", "originalCommit": "f88eac4f1ff13997435212f5fb62b18b3db160e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQ2MTQwMg==", "url": "https://github.com/phac-nml/irida/pull/758#discussion_r466461402", "bodyText": "Same here for JSDoc", "author": "joshsadam", "createdAt": "2020-08-06T14:38:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE3NDAyNA=="}], "type": "inlineReview"}, {"oid": "c2ea9ea90c43ac85c91edab2aebfb1f73e64a871", "url": "https://github.com/phac-nml/irida/commit/c2ea9ea90c43ac85c91edab2aebfb1f73e64a871", "message": "Allowed Admin Panel to work with modified context path and fixed side menu selection", "committedDate": "2020-07-31T15:18:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzMDk1Mg==", "url": "https://github.com/phac-nml/irida/pull/758#discussion_r466030952", "bodyText": "One last change otherwise everything else is good to go from my end. Can you create a function that does this instead of doing it inline and add a comment to the function as to why this needs to be done\nkeyname[0].split('/')[0]", "author": "deepsidhu85", "createdAt": "2020-08-05T22:05:54Z", "path": "src/main/webapp/resources/js/pages/admin/components/AdminSideMenu.jsx", "diffHunk": "@@ -33,19 +33,19 @@ export default function AdminHeader() {\n                 <img style={{ height: 64, width: 200 }} src={setBaseUrl(\"/resources/img/irida_logo_dark.svg\")}/>\n               </Link>\n               <Menu className={\"t-admin-side-menu\"} style={{ height: '100vh' }} theme={\"dark\"} mode={\"inline\"}\n-                    selectedKeys={[keyname ? keyname[1] : ADMIN.STATISTICS]}>\n+                    selectedKeys={[keyname ? keyname[0].split('/')[0] : ADMIN.STATISTICS]}>", "originalCommit": "c2ea9ea90c43ac85c91edab2aebfb1f73e64a871", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "26bc9acd1683e1275fef98a92b5570ace9548f51", "url": "https://github.com/phac-nml/irida/commit/26bc9acd1683e1275fef98a92b5570ace9548f51", "message": "Updated JSDoc for baseUrl and added parseKey method for side menu item selection", "committedDate": "2020-08-09T04:09:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAwMDMzNg==", "url": "https://github.com/phac-nml/irida/pull/758#discussion_r468000336", "bodyText": "JSDoc for baseUrl", "author": "joshsadam", "createdAt": "2020-08-10T15:41:46Z", "path": "src/main/webapp/resources/js/pages/UserGroupsPage/components/CreateNewUserGroupButton.jsx", "diffHunk": "@@ -1,22 +1,32 @@\n-import React, { useContext, useEffect, useRef, useState } from \"react\";\n+import React, { useEffect, useRef, useState } from \"react\";\n import { AddNewButton } from \"../../../components/Buttons/AddNewButton\";\n import { Form, Input, Modal } from \"antd\";\n import { createUserGroup } from \"../../../apis/users/groups\";\n import { useNavigate } from \"@reach/router\";\n+import { useResetFormOnCloseModal } from \"../../../hooks\";\n \n /**\n  * React component to render a button to create a new user group\n  * @returns {*}\n  * @constructor\n  */\n-export function CreateNewUserGroupButton() {\n+export function CreateNewUserGroupButton({ baseUrl }) {", "originalCommit": "26bc9acd1683e1275fef98a92b5570ace9548f51", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAwNTIxMw==", "url": "https://github.com/phac-nml/irida/pull/758#discussion_r468005213", "bodyText": "Can you move this to the top of the function, I like to have all the useState's together", "author": "joshsadam", "createdAt": "2020-08-10T15:49:11Z", "path": "src/main/webapp/resources/js/pages/UserGroupsPage/components/CreateNewUserGroupButton.jsx", "diffHunk": "@@ -1,22 +1,32 @@\n-import React, { useContext, useEffect, useRef, useState } from \"react\";\n+import React, { useEffect, useRef, useState } from \"react\";\n import { AddNewButton } from \"../../../components/Buttons/AddNewButton\";\n import { Form, Input, Modal } from \"antd\";\n import { createUserGroup } from \"../../../apis/users/groups\";\n import { useNavigate } from \"@reach/router\";\n+import { useResetFormOnCloseModal } from \"../../../hooks\";\n \n /**\n  * React component to render a button to create a new user group\n  * @returns {*}\n  * @constructor\n  */\n-export function CreateNewUserGroupButton() {\n+export function CreateNewUserGroupButton({ baseUrl }) {\n   /*\n   Required a reference to the user select input so that focus can be set\n   to it when the window opens.\n    */\n   const inputRef = useRef();\n   const [visible, setVisible] = useState();\n+\n+  /*\n+  Ant Design form\n+   */\n   const [form] = Form.useForm();\n+  useResetFormOnCloseModal({\n+    form,\n+    visible,\n+  });\n+\n   const navigate = useNavigate();\n \n   const [error, setError] = useState();", "originalCommit": "26bc9acd1683e1275fef98a92b5570ace9548f51", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAwNjQ0Mg==", "url": "https://github.com/phac-nml/irida/pull/758#discussion_r468006442", "bodyText": "JSDoc for baseUrl", "author": "joshsadam", "createdAt": "2020-08-10T15:51:09Z", "path": "src/main/webapp/resources/js/pages/UserGroupsPage/components/UserGroupsTable.jsx", "diffHunk": "@@ -14,14 +12,14 @@ const { Paragraph } = Typography;\n  * @returns {*}\n  * @constructor\n  */\n-export function UserGroupsTable() {\n+export function UserGroupsTable({ baseUrl }) {", "originalCommit": "26bc9acd1683e1275fef98a92b5570ace9548f51", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2b117c417416f2dadebdc8adc4cf6028d1a4970e", "url": "https://github.com/phac-nml/irida/commit/2b117c417416f2dadebdc8adc4cf6028d1a4970e", "message": "Added baseUrl JSDoc to more files", "committedDate": "2020-08-10T16:10:31Z", "type": "commit"}]}