{"pr_number": 564, "pr_title": "SRA Upload: Append .gz to uploaded filenames if fastq files are compressed", "pr_createdAt": "2020-01-10T17:43:57Z", "pr_url": "https://github.com/phac-nml/irida/pull/564", "timeline": [{"oid": "d509c29f3adf1c0de0ef730071e73852a7612589", "url": "https://github.com/phac-nml/irida/commit/d509c29f3adf1c0de0ef730071e73852a7612589", "message": "Append .gz to uploaded filenames if fastq files are compressed", "committedDate": "2020-01-10T17:40:26Z", "type": "commit"}, {"oid": "e77f4b2069af1434dd0a41e5c7daed41198f70a3", "url": "https://github.com/phac-nml/irida/commit/e77f4b2069af1434dd0a41e5c7daed41198f70a3", "message": "Fix detection of .gz file extension", "committedDate": "2020-01-10T18:22:58Z", "type": "commit"}, {"oid": "890ef9433452e53d0e447d5e59f62d9b9d91d623", "url": "https://github.com/phac-nml/irida/commit/890ef9433452e53d0e447d5e59f62d9b9d91d623", "message": "Adjust NCBI SRA submission template to handle gzipped fastq", "committedDate": "2020-01-10T19:00:24Z", "type": "commit"}, {"oid": "1040fb0eb3fc8e5d5012a00c36b9c66e7d3e5d14", "url": "https://github.com/phac-nml/irida/commit/1040fb0eb3fc8e5d5012a00c36b9c66e7d3e5d14", "message": "Handle fastq and fastq.gz files, both paired and single in submission.xml template", "committedDate": "2020-01-10T19:15:44Z", "type": "commit"}, {"oid": "7bda091898473166a61f0b3b8ef4fdf55653de94", "url": "https://github.com/phac-nml/irida/commit/7bda091898473166a61f0b3b8ef4fdf55653de94", "message": "Fix preparing reverse filename in submission.xml template", "committedDate": "2020-01-10T19:23:27Z", "type": "commit"}, {"oid": "5ad65798f23bb4339a3ccf6fed055842396b2f05", "url": "https://github.com/phac-nml/irida/commit/5ad65798f23bb4339a3ccf6fed055842396b2f05", "message": "Typo getFile() -> getFiles()", "committedDate": "2020-01-10T20:15:04Z", "type": "commit"}, {"oid": "31425ea32e7e23b710440e8c5da7d3051979dc2e", "url": "https://github.com/phac-nml/irida/commit/31425ea32e7e23b710440e8c5da7d3051979dc2e", "message": "Add test for creating NCBI upload with fastq.gz extension", "committedDate": "2020-01-10T20:25:54Z", "type": "commit"}, {"oid": "f115ca25b8e94590bfcec142f2824763d05548f6", "url": "https://github.com/phac-nml/irida/commit/f115ca25b8e94590bfcec142f2824763d05548f6", "message": "Updated CHANGELOG", "committedDate": "2020-01-10T20:30:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMxNTUwMw==", "url": "https://github.com/phac-nml/irida/pull/564#discussion_r370315503", "bodyText": "Can you add some comment blocks in here for what this is for?", "author": "tom114", "createdAt": "2020-01-23T19:37:27Z", "path": "src/main/resources/ca/corefacility/bioinformatics/irida/export/ncbi.xml", "diffHunk": "@@ -18,9 +18,16 @@\n \n \t<Action th:each=\"sample : ${submission.bioSampleFiles}\">\n \t\t<AddFiles target_db=\"SRA\" th:each=\"file : ${sample.files}\">\n-\t\t\t<File th:attr=\"file_path=${file.getId() + '.fastq'}\">\n-\t\t\t\t<DataType>generic-data</DataType>\n-\t\t\t</File>\n+\t\t\t<div th:if=\"${file.getFiles().toString().endsWith(&quot;.gz&quot;)}\">\n+\t\t\t\t<File th:attr=\"file_path=${file.getId() + '.fastq.gz'}\">", "originalCommit": "f115ca25b8e94590bfcec142f2824763d05548f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMxNjI4Ng==", "url": "https://github.com/phac-nml/irida/pull/564#discussion_r370316286", "bodyText": "Rather than a <div> please use a <th:block> instead.  The th:block won't show up in the resulting xml like the div will.\nhttps://www.thymeleaf.org/doc/tutorials/2.1/usingthymeleaf.html#synthetic-thblock-tag", "author": "tom114", "createdAt": "2020-01-23T19:39:06Z", "path": "src/main/resources/ca/corefacility/bioinformatics/irida/export/ncbi.xml", "diffHunk": "@@ -18,9 +18,16 @@\n \n \t<Action th:each=\"sample : ${submission.bioSampleFiles}\">\n \t\t<AddFiles target_db=\"SRA\" th:each=\"file : ${sample.files}\">\n-\t\t\t<File th:attr=\"file_path=${file.getId() + '.fastq'}\">\n-\t\t\t\t<DataType>generic-data</DataType>\n-\t\t\t</File>\n+\t\t\t<div th:if=\"${file.getFiles().toString().endsWith(&quot;.gz&quot;)}\">", "originalCommit": "f115ca25b8e94590bfcec142f2824763d05548f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMxNjY0Nw==", "url": "https://github.com/phac-nml/irida/pull/564#discussion_r370316647", "bodyText": "Thanks for adding the zipped test.", "author": "tom114", "createdAt": "2020-01-23T19:39:49Z", "path": "src/test/java/ca/corefacility/bioinformatics/irida/service/export/ExportUploadServiceTest.java", "diffHunk": "@@ -84,9 +84,54 @@ public void testUploadSubmission() throws UploadException, IOException {\n \t\tassertTrue(\"seqfile created\", fileSystem.exists(createdDirectory + \"/\" + createdFile.getId() + \".fastq\"));\n \t}\n \n+\t@Test\n+\tpublic void testUploadSubmissionGzipped() throws UploadException, IOException {", "originalCommit": "f115ca25b8e94590bfcec142f2824763d05548f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f473f27a28c2f00c63809d8b61cb461b25b31e84", "url": "https://github.com/phac-nml/irida/commit/f473f27a28c2f00c63809d8b61cb461b25b31e84", "message": "Merge branch 'development' into ncbi-sra-upload-gzipped", "committedDate": "2020-01-24T18:04:09Z", "type": "commit"}, {"oid": "24a660d96192b9bb2b15ae811fd676c65dc2f088", "url": "https://github.com/phac-nml/irida/commit/24a660d96192b9bb2b15ae811fd676c65dc2f088", "message": "Switch div to th:block", "committedDate": "2020-01-24T18:06:58Z", "type": "commit"}, {"oid": "d04fe39fcd3e4a38ac1896e595435c9449878340", "url": "https://github.com/phac-nml/irida/commit/d04fe39fcd3e4a38ac1896e595435c9449878340", "message": "Switch other divs to th:block", "committedDate": "2020-01-24T18:08:28Z", "type": "commit"}, {"oid": "32e187faa64d421c6209197efda3a572aa27c6c4", "url": "https://github.com/phac-nml/irida/commit/32e187faa64d421c6209197efda3a572aa27c6c4", "message": "Add comment explaining handling of gzipped fastqs", "committedDate": "2020-01-24T18:12:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQyODAzMw==", "url": "https://github.com/phac-nml/irida/pull/564#discussion_r371428033", "bodyText": "Just doing some final testing with this.  Can you make these \"parser level\" comments?  It will make them not appear in the final rendered xml.  It just means changing the comment block format a to <!--/*  your comment here */-->\nSee https://www.thymeleaf.org/doc/tutorials/2.1/usingthymeleaf.html#thymeleaf-parser-level-comment-blocks for more", "author": "tom114", "createdAt": "2020-01-27T19:11:41Z", "path": "src/main/resources/ca/corefacility/bioinformatics/irida/export/ncbi.xml", "diffHunk": "@@ -17,10 +17,22 @@\n \t</Description>\n \n \t<Action th:each=\"sample : ${submission.bioSampleFiles}\">\n+\t\t<!-- IRIDA sequence files may either be plaintext (.fastq) or gzip compressed (.fastq.gz)", "originalCommit": "32e187faa64d421c6209197efda3a572aa27c6c4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "226501d64e960fe7e68fa321d304258c9cfe6178", "url": "https://github.com/phac-nml/irida/commit/226501d64e960fe7e68fa321d304258c9cfe6178", "message": "Change to parser-level comment", "committedDate": "2020-01-28T18:12:18Z", "type": "commit"}]}