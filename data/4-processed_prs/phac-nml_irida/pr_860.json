{"pr_number": 860, "pr_title": "Upgrade admin new announcement modal", "pr_createdAt": "2020-11-17T20:18:30Z", "pr_url": "https://github.com/phac-nml/irida/pull/860", "timeline": [{"oid": "819d37089c21a79df00e04ec0a178981ce1c054d", "url": "https://github.com/phac-nml/irida/commit/819d37089c21a79df00e04ec0a178981ce1c054d", "message": "adding title and priority to admin new announcement modal", "committedDate": "2020-11-17T20:15:12Z", "type": "commit"}, {"oid": "c9b3926b24a2a1a0e08c873530ef8afcd1bb2435", "url": "https://github.com/phac-nml/irida/commit/c9b3926b24a2a1a0e08c873530ef8afcd1bb2435", "message": "Working on new create announcement modal", "committedDate": "2020-11-18T15:17:41Z", "type": "commit"}, {"oid": "0b0ef29e910232ae60ab202f50beb936f9963b5d", "url": "https://github.com/phac-nml/irida/commit/0b0ef29e910232ae60ab202f50beb936f9963b5d", "message": "Merge remote-tracking branch 'origin/announcements-upgrade-admin-forms' into announcements-upgrade-admin-forms", "committedDate": "2020-11-18T15:18:01Z", "type": "commit"}, {"oid": "9e0f3f5186b84bbe84dc4f64986f6be5132423a0", "url": "https://github.com/phac-nml/irida/commit/9e0f3f5186b84bbe84dc4f64986f6be5132423a0", "message": "setting a fixed width on the priority column of the admin announcements table", "committedDate": "2020-11-18T16:45:13Z", "type": "commit"}, {"oid": "a92f907537ac87a27d560544f2c27c270b1cc3d4", "url": "https://github.com/phac-nml/irida/commit/a92f907537ac87a27d560544f2c27c270b1cc3d4", "message": "changing modal.confirm to a modal as we are able to set the visibility", "committedDate": "2020-11-18T16:50:52Z", "type": "commit"}, {"oid": "b7cee39b6c58b4fc53a7838a37cd6990376e8b14", "url": "https://github.com/phac-nml/irida/commit/b7cee39b6c58b4fc53a7838a37cd6990376e8b14", "message": "adding i18n properties", "committedDate": "2020-11-18T18:25:05Z", "type": "commit"}, {"oid": "ea6a093aa2c5708d53e04a2ed88ff8627468172f", "url": "https://github.com/phac-nml/irida/commit/ea6a093aa2c5708d53e04a2ed88ff8627468172f", "message": "fixing form preservation not working", "committedDate": "2020-11-18T18:36:32Z", "type": "commit"}, {"oid": "984d376a2e036f59ae6f5da31dc6caa72853b821", "url": "https://github.com/phac-nml/irida/commit/984d376a2e036f59ae6f5da31dc6caa72853b821", "message": "adding missing i18n and comment", "committedDate": "2020-11-18T18:51:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM0NjY2Ng==", "url": "https://github.com/phac-nml/irida/pull/860#discussion_r526346666", "bodyText": "Instead of a react fragment, let's use Space to give some breathing room between the icon and the title.\ntitle={\n        <Space>\n          <IconEdit style={{ color: FONT_COLOR_PRIMARY }} />\n          {i18n(\"CreateNewAnnouncement.title\")}\n        </Space>\n      }", "author": "joshsadam", "createdAt": "2020-11-18T19:02:26Z", "path": "src/main/webapp/resources/js/pages/admin/components/announcements/CreateAnnouncementModal.jsx", "diffHunk": "@@ -0,0 +1,81 @@\n+import React, { useRef } from \"react\";\n+import { Checkbox, Form, Input, Modal } from \"antd\";\n+import { IconEdit } from \"../../../../components/icons/Icons\";\n+import { FONT_COLOR_PRIMARY } from \"../../../../styles/fonts\";\n+import { MarkdownEditor } from \"../../../../components/markdown/MarkdownEditor\";\n+\n+/**\n+ * React component to display an Ant Design Modal containing a form to create a new announcement\n+ * @param {boolean} visible - whether the modal is open or not\n+ * @param {function} closeModal - the function to close the modal\n+ * @param {function} createAnnouncement - the function to create a new announcement and refresh the table\n+ * @returns {JSX.Element}\n+ * @constructor\n+ */\n+export function CreateAnnouncementModal({\n+  visible,\n+  closeModal,\n+  createAnnouncement,\n+}) {\n+  const markdownRef = useRef();\n+  const [form] = Form.useForm();\n+\n+  const onCancel = () => {\n+    form.resetFields();\n+    closeModal();\n+  };\n+\n+  function saveMarkdown() {\n+    form.validateFields().then((values) => {\n+      const markdown = markdownRef.current.getMarkdown();\n+      const title = values.title;\n+      const priority = values.priority;\n+\n+      createAnnouncement(title, markdown, priority);\n+      closeModal();\n+    });\n+  }\n+  return (\n+    <Modal\n+      visible={visible}\n+      title={\n+        <>", "originalCommit": "984d376a2e036f59ae6f5da31dc6caa72853b821", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM2NDI3OA==", "url": "https://github.com/phac-nml/irida/pull/860#discussion_r526364278", "bodyText": "Please see 3bdf855", "author": "ksierks", "createdAt": "2020-11-18T19:31:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM0NjY2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM0NzM3OA==", "url": "https://github.com/phac-nml/irida/pull/860#discussion_r526347378", "bodyText": "You're form is not resetting when the modal is closed.  This might be a little tricky as you will need to reset the contents of the markdown as well.", "author": "joshsadam", "createdAt": "2020-11-18T19:03:40Z", "path": "src/main/webapp/resources/js/pages/admin/components/announcements/CreateAnnouncementModal.jsx", "diffHunk": "@@ -0,0 +1,81 @@\n+import React, { useRef } from \"react\";\n+import { Checkbox, Form, Input, Modal } from \"antd\";\n+import { IconEdit } from \"../../../../components/icons/Icons\";\n+import { FONT_COLOR_PRIMARY } from \"../../../../styles/fonts\";\n+import { MarkdownEditor } from \"../../../../components/markdown/MarkdownEditor\";\n+\n+/**\n+ * React component to display an Ant Design Modal containing a form to create a new announcement\n+ * @param {boolean} visible - whether the modal is open or not\n+ * @param {function} closeModal - the function to close the modal\n+ * @param {function} createAnnouncement - the function to create a new announcement and refresh the table\n+ * @returns {JSX.Element}\n+ * @constructor\n+ */\n+export function CreateAnnouncementModal({\n+  visible,\n+  closeModal,\n+  createAnnouncement,\n+}) {\n+  const markdownRef = useRef();\n+  const [form] = Form.useForm();\n+\n+  const onCancel = () => {\n+    form.resetFields();\n+    closeModal();\n+  };\n+\n+  function saveMarkdown() {\n+    form.validateFields().then((values) => {\n+      const markdown = markdownRef.current.getMarkdown();\n+      const title = values.title;\n+      const priority = values.priority;\n+\n+      createAnnouncement(title, markdown, priority);\n+      closeModal();\n+    });\n+  }\n+  return (\n+    <Modal\n+      visible={visible}\n+      title={\n+        <>\n+          <IconEdit style={{ color: FONT_COLOR_PRIMARY }} />\n+          {i18n(\"CreateNewAnnouncement.title\")}\n+        </>\n+      }\n+      width=\"80%\"\n+      okText={i18n(\"CreateNewAnnouncement.okBtn\")}\n+      okButtonProps={{\n+        className: \"t-submit-announcement\",\n+      }}\n+      onOk={saveMarkdown}\n+      onCancel={onCancel}", "originalCommit": "984d376a2e036f59ae6f5da31dc6caa72853b821", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM1MzExOA==", "url": "https://github.com/phac-nml/irida/pull/860#discussion_r526353118", "bodyText": "Can you also make the wording a little more descriptive.  I suck at word smithing, but even \"Set as priority announcement\"", "author": "joshsadam", "createdAt": "2020-11-18T19:13:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM0NzM3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM4MjA5MA==", "url": "https://github.com/phac-nml/irida/pull/860#discussion_r526382090", "bodyText": "Not sure I understood this one fully, but I tried. Please see 984d376.", "author": "ksierks", "createdAt": "2020-11-18T20:00:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM0NzM3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjU2NTU3MQ==", "url": "https://github.com/phac-nml/irida/pull/860#discussion_r526565571", "bodyText": "Just change the checkbox label from \"Priority\" to \"Set as a priority message\"  or something similar.", "author": "joshsadam", "createdAt": "2020-11-19T03:12:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM0NzM3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk0OTA0OQ==", "url": "https://github.com/phac-nml/irida/pull/860#discussion_r526949049", "bodyText": "Oh ok. Please see 458b3dc.", "author": "ksierks", "createdAt": "2020-11-19T14:54:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM0NzM3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk4Mjk0MA==", "url": "https://github.com/phac-nml/irida/pull/860#discussion_r526982940", "bodyText": "Hopefully, this is closer. Please see d48a28b.", "author": "ksierks", "createdAt": "2020-11-19T15:36:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM0NzM3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk4MzYyOA==", "url": "https://github.com/phac-nml/irida/pull/860#discussion_r526983628", "bodyText": "That looks great", "author": "joshsadam", "createdAt": "2020-11-19T15:37:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM0NzM3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM1MTM1Mg==", "url": "https://github.com/phac-nml/irida/pull/860#discussion_r526351352", "bodyText": "Checkboxes are a little trickier than this.  I am sure you noticed that it looks a bit off with the label on a different line than the checkbox, makes it feel like the checkbox is a poor orphan child.\n\nThis is the way to write it to get it all working together:\n<Form.Item name=\"priority\" valuePropName=\"checked\">\n   <Checkbox>{i18n(\"announcement.control.priority\")}</Checkbox>\n</Form.Item>", "author": "joshsadam", "createdAt": "2020-11-18T19:10:28Z", "path": "src/main/webapp/resources/js/pages/admin/components/announcements/CreateAnnouncementModal.jsx", "diffHunk": "@@ -0,0 +1,81 @@\n+import React, { useRef } from \"react\";\n+import { Checkbox, Form, Input, Modal } from \"antd\";\n+import { IconEdit } from \"../../../../components/icons/Icons\";\n+import { FONT_COLOR_PRIMARY } from \"../../../../styles/fonts\";\n+import { MarkdownEditor } from \"../../../../components/markdown/MarkdownEditor\";\n+\n+/**\n+ * React component to display an Ant Design Modal containing a form to create a new announcement\n+ * @param {boolean} visible - whether the modal is open or not\n+ * @param {function} closeModal - the function to close the modal\n+ * @param {function} createAnnouncement - the function to create a new announcement and refresh the table\n+ * @returns {JSX.Element}\n+ * @constructor\n+ */\n+export function CreateAnnouncementModal({\n+  visible,\n+  closeModal,\n+  createAnnouncement,\n+}) {\n+  const markdownRef = useRef();\n+  const [form] = Form.useForm();\n+\n+  const onCancel = () => {\n+    form.resetFields();\n+    closeModal();\n+  };\n+\n+  function saveMarkdown() {\n+    form.validateFields().then((values) => {\n+      const markdown = markdownRef.current.getMarkdown();\n+      const title = values.title;\n+      const priority = values.priority;\n+\n+      createAnnouncement(title, markdown, priority);\n+      closeModal();\n+    });\n+  }\n+  return (\n+    <Modal\n+      visible={visible}\n+      title={\n+        <>\n+          <IconEdit style={{ color: FONT_COLOR_PRIMARY }} />\n+          {i18n(\"CreateNewAnnouncement.title\")}\n+        </>\n+      }\n+      width=\"80%\"\n+      okText={i18n(\"CreateNewAnnouncement.okBtn\")}\n+      okButtonProps={{\n+        className: \"t-submit-announcement\",\n+      }}\n+      onOk={saveMarkdown}\n+      onCancel={onCancel}\n+    >\n+      <Form layout=\"vertical\" form={form}>\n+        <Form.Item\n+          name=\"title\"\n+          label={i18n(\"announcement.control.title\")}\n+          rules={[\n+            {\n+              required: true,\n+              message: i18n(\"CreateNewAnnouncement.form.title\"),\n+            },\n+          ]}\n+        >\n+          <Input />\n+        </Form.Item>\n+        <Form.Item name=\"message\" label={i18n(\"announcement.control.message\")}>\n+          <MarkdownEditor ref={markdownRef} />\n+        </Form.Item>\n+        <Form.Item\n+          name=\"priority\"\n+          label={i18n(\"announcement.control.priority\")}\n+          valuePropName=\"checked\"\n+        >\n+          <Checkbox />", "originalCommit": "984d376a2e036f59ae6f5da31dc6caa72853b821", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM2NDYyOQ==", "url": "https://github.com/phac-nml/irida/pull/860#discussion_r526364629", "bodyText": "Please see 5d067ff", "author": "ksierks", "createdAt": "2020-11-18T19:31:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM1MTM1Mg=="}], "type": "inlineReview"}, {"oid": "3bdf855381a0c447dffa1528a00bad9702726e58", "url": "https://github.com/phac-nml/irida/commit/3bdf855381a0c447dffa1528a00bad9702726e58", "message": "adding some space between the icon and title", "committedDate": "2020-11-18T19:21:18Z", "type": "commit"}, {"oid": "5d067ffcd1bb1b26262527921f01ada91f173fb4", "url": "https://github.com/phac-nml/irida/commit/5d067ffcd1bb1b26262527921f01ada91f173fb4", "message": "fixing the poor orphan checkbox", "committedDate": "2020-11-18T19:24:11Z", "type": "commit"}, {"oid": "4a5dc4336711173327e2db79ac17deefd7eeee2c", "url": "https://github.com/phac-nml/irida/commit/4a5dc4336711173327e2db79ac17deefd7eeee2c", "message": "fixing resetting form after saving an announcement", "committedDate": "2020-11-18T19:59:00Z", "type": "commit"}, {"oid": "458b3dc5c8e84271f36f8cf25345b23fcb75674c", "url": "https://github.com/phac-nml/irida/commit/458b3dc5c8e84271f36f8cf25345b23fcb75674c", "message": "renaming the priority label in the new announcement form", "committedDate": "2020-11-19T14:52:15Z", "type": "commit"}, {"oid": "d48a28b22916603a02a375fd03370557118dd28d", "url": "https://github.com/phac-nml/irida/commit/d48a28b22916603a02a375fd03370557118dd28d", "message": "rearranging some i18n properties", "committedDate": "2020-11-19T15:34:45Z", "type": "commit"}, {"oid": "d48a28b22916603a02a375fd03370557118dd28d", "url": "https://github.com/phac-nml/irida/commit/d48a28b22916603a02a375fd03370557118dd28d", "message": "rearranging some i18n properties", "committedDate": "2020-11-19T15:34:45Z", "type": "forcePushed"}, {"oid": "d48a28b22916603a02a375fd03370557118dd28d", "url": "https://github.com/phac-nml/irida/commit/d48a28b22916603a02a375fd03370557118dd28d", "message": "rearranging some i18n properties", "committedDate": "2020-11-19T15:34:45Z", "type": "forcePushed"}, {"oid": "fd442be9b59f51937427606b0a7cef51b4f9e688", "url": "https://github.com/phac-nml/irida/commit/fd442be9b59f51937427606b0a7cef51b4f9e688", "message": "Merge branch 'announcements-upgrade-base' into announcements-upgrade-admin-forms", "committedDate": "2020-11-19T19:18:08Z", "type": "commit"}]}