{"pr_number": 789, "pr_title": "Removed page variables for analysis and updated to use ajax to get an\u2026", "pr_createdAt": "2020-08-28T17:30:47Z", "pr_url": "https://github.com/phac-nml/irida/pull/789", "timeline": [{"oid": "96d2a6c65b28b8114685394474d652237b174932", "url": "https://github.com/phac-nml/irida/commit/96d2a6c65b28b8114685394474d652237b174932", "message": "Removed page variables for analysis and updated to use ajax to get analysis details.", "committedDate": "2020-08-28T17:29:31Z", "type": "commit"}, {"oid": "48b7d5a5f5eed69b0488e08d29070143a056ca48", "url": "https://github.com/phac-nml/irida/commit/48b7d5a5f5eed69b0488e08d29070143a056ca48", "message": "Removed @param principal no longer required. Updated AnalysisControllerTest", "committedDate": "2020-09-01T15:26:52Z", "type": "commit"}, {"oid": "a42378c3f779f10fe566a2bbad2cee592932e9b5", "url": "https://github.com/phac-nml/irida/commit/a42378c3f779f10fe566a2bbad2cee592932e9b5", "message": "Removed unused imports. Updated AnalysisContext to set if the analysis should display the tree tab", "committedDate": "2020-09-03T19:03:16Z", "type": "commit"}, {"oid": "6c638a6f81373942cc03efe3738653ba287a9bad", "url": "https://github.com/phac-nml/irida/commit/6c638a6f81373942cc03efe3738653ba287a9bad", "message": "Added javadoc for method", "committedDate": "2020-09-03T19:05:21Z", "type": "commit"}, {"oid": "e4bad74b15034b7e4107149275d7fbd0b0c14ec7", "url": "https://github.com/phac-nml/irida/commit/e4bad74b15034b7e4107149275d7fbd0b0c14ec7", "message": "Added function comment. Refactored import statements into one", "committedDate": "2020-09-03T19:41:17Z", "type": "commit"}, {"oid": "69a5173918a6a448e752b3d171886910beb14f46", "url": "https://github.com/phac-nml/irida/commit/69a5173918a6a448e752b3d171886910beb14f46", "message": "Added missing @param tag", "committedDate": "2020-09-03T20:34:31Z", "type": "commit"}, {"oid": "cd66b6bb19cc87069a1d83fb412d12488fd20494", "url": "https://github.com/phac-nml/irida/commit/cd66b6bb19cc87069a1d83fb412d12488fd20494", "message": "Updated to use analysis id obtained in analysisContext. Removed unused import", "committedDate": "2020-09-04T19:17:00Z", "type": "commit"}, {"oid": "d530938ff519d196a4cabc6321abdb05b6967342", "url": "https://github.com/phac-nml/irida/commit/d530938ff519d196a4cabc6321abdb05b6967342", "message": "Merge branch 'development' into cleanup-analysis-context-page-variables", "committedDate": "2020-09-08T14:06:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk2NzIyNw==", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r484967227", "bodyText": "I am seeing warnings in this file that several of the auto wired components are not being used (emailController, analysisAudit, analysisTypeService), can you clean this up?", "author": "joshsadam", "createdAt": "2020-09-08T14:31:41Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisController.java", "diffHunk": "@@ -1,8 +1,6 @@\n package ca.corefacility.bioinformatics.irida.ria.web.analysis;\n \n import java.security.Principal;\n-import java.util.Date;\n-import java.util.Optional;\n \n import org.slf4j.Logger;", "originalCommit": "d530938ff519d196a4cabc6321abdb05b6967342", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY5OTcyNw==", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r485699727", "bodyText": "Removed in 8d63f91", "author": "deepsidhu85", "createdAt": "2020-09-09T15:23:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk2NzIyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk2ODU5Mw==", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r484968593", "bodyText": "Why are you keeping this one variable on the page?", "author": "joshsadam", "createdAt": "2020-09-08T14:33:27Z", "path": "src/main/webapp/pages/analysis.html", "diffHunk": "@@ -5,20 +5,13 @@\n   data-layout-decorate=\"~{template/page}\"\n >\n   <head>\n-    <title th:text=\"#{analysis.title(${analysisSubmission.getName()})}\">ANALYSIS RESULTS</title>\n+    <title th:text=\"#{analysis.title(${analysisName})}\">ANALYSIS RESULTS</title>\n     <link rel=\"stylesheet\" th:href=\"@{/dist/css/analysis.bundle.css}\" />\n \n     <script th:inline=\"javascript\">\n+\n       window.PAGE = {\n-        analysis: [[${analysisSubmission}]],\n-        analysisName: [[${analysisSubmission.getName()}]],\n-        analysisState: [[${analysisSubmission.getAnalysisState()}]],\n         analysisType: [[${analysisType}]],", "originalCommit": "d530938ff519d196a4cabc6321abdb05b6967342", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcwMDAxOQ==", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r485700019", "bodyText": "Removed in 8d63f91", "author": "deepsidhu85", "createdAt": "2020-09-09T15:24:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk2ODU5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk3MTE1NQ==", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r484971155", "bodyText": "Wouldn't these all default to null or false without stating them here?  Since none of these are objects you can just leave them off and add them as needed.", "author": "joshsadam", "createdAt": "2020-09-08T14:36:42Z", "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -31,18 +35,19 @@ export const stateMap = {\n   COMPLETED: 5\n };\n \n-export const isAdmin = window.PAGE.isAdmin;\n-\n const initialContext = {\n-  analysis: window.PAGE.analysis,\n-  analysisName: window.PAGE.analysisName,\n-  analysisState: window.PAGE.analysisState,\n-  analysisType: window.PAGE.analysisType.type,\n-  analysisViewer: window.PAGE.analysisViewer,\n-  isCompleted: window.PAGE.analysisState === \"COMPLETED\",\n-  isError: window.PAGE.analysisState.includes(\"ERROR\"),\n-  previousState: window.PAGE.previousState,\n-  duration: window.PAGE.duration\n+  analysis: null,", "originalCommit": "d530938ff519d196a4cabc6321abdb05b6967342", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcwMDMwNw==", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r485700307", "bodyText": "If we don't set them then we get a bunch of undefined errors", "author": "deepsidhu85", "createdAt": "2020-09-09T15:24:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk3MTE1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk3Mjk3Mw==", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r484972973", "bodyText": "This looks like it would be simpler just to destructor the response and just explicitly state the ones that are not. e.g\nreturn {...analysisContexxt, ...res, isCompleted: res.analysisState === \"COMPLETED\"}", "author": "joshsadam", "createdAt": "2020-09-08T14:39:05Z", "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -51,12 +56,49 @@ const AnalysisContext = React.createContext(initialContext);\n \n function AnalysisProvider(props) {\n   const [analysisContext, setAnalysisContext] = useState(initialContext);\n+  const analysisIdentifier = window.location.pathname.match(/analysis\\/(\\d+)/)[1];\n+\n+  useEffect(() => {\n+    getAnalysisInfo(analysisIdentifier).then(res => {\n+      setAnalysisContext(analysisContext => {\n+        return {\n+          ...analysisContext,\n+          analysis: res.analysis,", "originalCommit": "d530938ff519d196a4cabc6321abdb05b6967342", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4MzU0OA==", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r484983548", "bodyText": "I might even go as far as making the response from the server have all the variables set exactly as you want them (e.g. isCompleted, etc...) be set server side properly", "author": "joshsadam", "createdAt": "2020-09-08T14:53:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk3Mjk3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcwMDQxMw==", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r485700413", "bodyText": "Updated in 8d63f91", "author": "deepsidhu85", "createdAt": "2020-09-09T15:24:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk3Mjk3Mw=="}], "type": "inlineReview"}, {"oid": "8d63f91593b46a445bb918bea869f802e346b15f", "url": "https://github.com/phac-nml/irida/commit/8d63f91593b46a445bb918bea869f802e346b15f", "message": "Removed unused services from analysiscontroller and analysiscontrollertest. Updated logic for getting analysis details to set isCompleted, isError, and/or if the tree tab should be displayed for an analysis.", "committedDate": "2020-09-08T20:34:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU1MzU1MQ==", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r485553551", "bodyText": "Move this into you loading useEffect that way it does not happen on every re-render.  You can store the value in a setState variable by the same name.", "author": "joshsadam", "createdAt": "2020-09-09T11:58:20Z", "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -51,12 +55,30 @@ const AnalysisContext = React.createContext(initialContext);\n \n function AnalysisProvider(props) {\n   const [analysisContext, setAnalysisContext] = useState(initialContext);\n+  const analysisIdentifier = window.location.pathname.match(/analysis\\/(\\d+)/)[1];", "originalCommit": "8d63f91593b46a445bb918bea869f802e346b15f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcwMDU4Nw==", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r485700587", "bodyText": "Updated in 91b5b8f", "author": "deepsidhu85", "createdAt": "2020-09-09T15:24:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU1MzU1MQ=="}], "type": "inlineReview"}, {"oid": "91b5b8f9ea189503d79174656273a9f018de1d60", "url": "https://github.com/phac-nml/irida/commit/91b5b8f9ea189503d79174656273a9f018de1d60", "message": "Moved setting of analysis identifier into useeffect. Changed method from which newick string is obtained", "committedDate": "2020-09-09T14:58:18Z", "type": "commit"}, {"oid": "0c3ba688b9ee6cd4dbea41205936ba090f91aa46", "url": "https://github.com/phac-nml/irida/commit/0c3ba688b9ee6cd4dbea41205936ba090f91aa46", "message": "Modified assertEquals text. Updated logic to set treeDefault to true only if a newick string is not null", "committedDate": "2020-09-09T16:32:31Z", "type": "commit"}, {"oid": "20706240fe9788875389c355fa69a731c73667ce", "url": "https://github.com/phac-nml/irida/commit/20706240fe9788875389c355fa69a731c73667ce", "message": "Removed logging statement", "committedDate": "2020-09-09T16:59:20Z", "type": "commit"}, {"oid": "7b6def5bd07cbdc1f22afd587940c06aa726c879", "url": "https://github.com/phac-nml/irida/commit/7b6def5bd07cbdc1f22afd587940c06aa726c879", "message": "Updated test", "committedDate": "2020-09-09T17:10:12Z", "type": "commit"}, {"oid": "6b37dbe8bf41d8c91282165bcfec37091d687372", "url": "https://github.com/phac-nml/irida/commit/6b37dbe8bf41d8c91282165bcfec37091d687372", "message": "Updated tests to pass the number of download buttons expected", "committedDate": "2020-09-09T18:30:31Z", "type": "commit"}]}