{"pr_number": 1059, "pr_title": "CDAP-16517 skip header", "pr_createdAt": "2020-04-01T01:41:19Z", "pr_url": "https://github.com/cdapio/hydrator-plugins/pull/1059", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTMxNjIwMA==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1059#discussion_r401316200", "bodyText": "better to write just one file in the caller and pass in the File as an argument, especially since the caller is now checking the output.", "author": "albertshau", "createdAt": "2020-04-01T02:09:39Z", "path": "core-plugins/src/test/java/io/cdap/plugin/batch/source/FileBatchSourceTest.java", "diffHunk": "@@ -372,6 +373,51 @@ public void testPathGlobbing() throws Exception {\n     Assert.assertTrue(outputValue.contains(\"CDAP,Platform\"));\n   }\n \n+  @Test\n+  public void testSkipHeader() throws Exception {\n+    Schema schema = Schema.recordOf(\"user\",\n+                                    Schema.Field.of(\"body\", Schema.of(Schema.Type.STRING)),\n+                                    Schema.Field.of(\"offset\", Schema.of(Schema.Type.LONG)));\n+    Set<StructuredRecord> expected = ImmutableSet.of(\n+      StructuredRecord.builder(schema).set(\"body\", \"123\").set(\"offset\", 4L).build(),\n+      StructuredRecord.builder(schema).set(\"body\", \"456\").set(\"offset\", 8L).build());\n+    Assert.assertEquals(expected, testSkipHeader(\"text\", \"\", schema));;\n+\n+    schema = Schema.recordOf(\"user\",\n+                             Schema.Field.of(\"val1\", Schema.of(Schema.Type.INT)),\n+                             Schema.Field.of(\"val2\", Schema.of(Schema.Type.INT)),\n+                             Schema.Field.of(\"val3\", Schema.of(Schema.Type.INT)));\n+    expected = ImmutableSet.of(\n+      StructuredRecord.builder(schema).set(\"val1\", 1).set(\"val2\", 2).set(\"val3\", 3).build(),\n+      StructuredRecord.builder(schema).set(\"val1\", 4).set(\"val2\", 5).set(\"val3\", 6).build());\n+    Assert.assertEquals(expected, testSkipHeader(\"csv\", \",\", schema));\n+    Assert.assertEquals(expected, testSkipHeader(\"tsv\", \"\\t\", schema));\n+    Assert.assertEquals(expected, testSkipHeader(\"delimited\", \" \", schema));\n+  }\n+\n+  private Set<StructuredRecord> testSkipHeader(String format, String delimeter, Schema schema) throws Exception {\n+    File inputFile = temporaryFolder.newFile();\n+\n+    try (Writer writer = new FileWriter(inputFile)) {", "originalCommit": "d56ee9ff5cc384fa38f45b634ab3333ef9dd512f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTMxNzEyMQ==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1059#discussion_r401317121", "bodyText": "the content in the file is different for each delimiter, so we cannot use one single file for testing", "author": "yaojiefeng", "createdAt": "2020-04-01T02:13:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTMxNjIwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTMxNjM0NQ==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1059#discussion_r401316345", "bodyText": "Whether to skip the first line of each file.", "author": "albertshau", "createdAt": "2020-04-01T02:10:18Z", "path": "format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSourceConfig.java", "diffHunk": "@@ -94,6 +93,12 @@\n     + \"is anything other than 'delimited'.\")\n   private String delimiter;\n \n+  @Macro\n+  @Nullable\n+  @Description(\"Whether to skip header for the files. Supported formats are 'text', 'csv', 'tsv', 'delimited'. \" +", "originalCommit": "d56ee9ff5cc384fa38f45b634ab3333ef9dd512f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTMxNjQ0OA==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1059#discussion_r401316448", "bodyText": "Whether to skip the first line of each file", "author": "albertshau", "createdAt": "2020-04-01T02:10:48Z", "path": "core-plugins/docs/File-batchsource.md", "diffHunk": "@@ -22,6 +22,8 @@ If the format is 'text', the schema must contain a field named 'body' of type 's\n \n **Delimiter:** Delimiter to use when the format is 'delimited'. This will be ignored for other formats.\n \n+**Skip Header** Whether to skip header for the files. Supported formats are 'text', 'csv', 'tsv', 'delimited'.", "originalCommit": "d56ee9ff5cc384fa38f45b634ab3333ef9dd512f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1b0fdf15049eb0c76c2319b3dabf5213de4474ae", "url": "https://github.com/cdapio/hydrator-plugins/commit/1b0fdf15049eb0c76c2319b3dabf5213de4474ae", "message": "CDAP-16517 skip header", "committedDate": "2020-04-01T02:16:15Z", "type": "commit"}, {"oid": "1b0fdf15049eb0c76c2319b3dabf5213de4474ae", "url": "https://github.com/cdapio/hydrator-plugins/commit/1b0fdf15049eb0c76c2319b3dabf5213de4474ae", "message": "CDAP-16517 skip header", "committedDate": "2020-04-01T02:16:15Z", "type": "forcePushed"}, {"oid": "e0b667863dcc51518684456129a7c1b207433185", "url": "https://github.com/cdapio/hydrator-plugins/commit/e0b667863dcc51518684456129a7c1b207433185", "message": "update submodules to fix build", "committedDate": "2020-04-01T21:03:50Z", "type": "commit"}]}