{"pr_number": 793, "pr_title": "[KOGITO-3460] Create native daily build", "pr_createdAt": "2020-09-29T15:36:01Z", "pr_url": "https://github.com/kiegroup/kogito-runtimes/pull/793", "timeline": [{"oid": "0caa0a24e31f8b642f6f063a80d1d09c7bf6e7a2", "url": "https://github.com/kiegroup/kogito-runtimes/commit/0caa0a24e31f8b642f6f063a80d1d09c7bf6e7a2", "message": "[KOGITO-3460] Create native daily build", "committedDate": "2020-09-29T15:29:55Z", "type": "commit"}, {"oid": "792f30518d9e29c1d002eb5dd615b7ece3434e17", "url": "https://github.com/kiegroup/kogito-runtimes/commit/792f30518d9e29c1d002eb5dd615b7ece3434e17", "message": "[KOGITO-3460] Create native daily build", "committedDate": "2020-09-29T15:30:45Z", "type": "commit"}, {"oid": "483fdc1cffd44cb2d3aae0d02dda6f9c48eccc9f", "url": "https://github.com/kiegroup/kogito-runtimes/commit/483fdc1cffd44cb2d3aae0d02dda6f9c48eccc9f", "message": "[KOGITO-3460] Create native daily build", "committedDate": "2020-09-29T15:31:26Z", "type": "commit"}, {"oid": "d1f77c185af4036a217839175b8454c93be1b6ae", "url": "https://github.com/kiegroup/kogito-runtimes/commit/d1f77c185af4036a217839175b8454c93be1b6ae", "message": "[KOGITO-3460] Create native daily build", "committedDate": "2020-09-29T15:33:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE3ODYwOQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497178609", "bodyText": "do we have podman installed in the Jenkins slave machines? Docker is there for sure.", "author": "cristianonicolai", "createdAt": "2020-09-30T00:29:11Z", "path": "Jenkinsfile.native", "diffHunk": "@@ -0,0 +1,109 @@\n+@Library('jenkins-pipeline-shared-libraries')_\n+\n+pipeline {\n+    agent {\n+        label 'kie-rhel7 && kie-mem16g'\n+    }\n+    tools {\n+        maven 'kie-maven-3.6.2'\n+        jdk 'kie-jdk11'\n+    }\n+    triggers {\n+        cron ('H 10 * * *')\n+    }\n+    options {\n+        buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '', numToKeepStr: '5')\n+        timeout(time: 360, unit: 'MINUTES')\n+    }\n+    parameters {\n+        string(name: 'BRANCH_NAME', defaultValue: \"master\", description: 'Set the branch to build&test')\n+    }\n+    environment {\n+        KOGITO_CI_EMAIL_TO = credentials('KOGITO_CI_EMAIL_TO')\n+        MAVEN_OPTS = '-Xms1024m -Xmx4g'\n+    }\n+    stages {\n+        stage('Initialize') {\n+            steps {\n+                script {\n+                    mailer.buildLogScriptPR()\n+\n+                    checkoutRepo(\"kogito-runtimes\")\n+                    checkoutRepo(\"kogito-apps\")\n+                    checkoutRepo(\"kogito-examples\")\n+                }\n+            }\n+        }\n+        stage('Build kogito-runtimes (-Pnative)') {\n+            steps {\n+                script {\n+                    mavenCleanInstallNative(\"kogito-runtimes\")\n+                }\n+            }\n+            post {\n+                always {\n+                    saveReports()\n+                }\n+            }\n+        }\n+        stage('Build kogito-apps (-Pnative)') {\n+            steps {\n+                script {\n+                    mavenCleanInstallNative(\"kogito-apps\")\n+                }\n+            }\n+            post {\n+                always {\n+                    saveReports()\n+                }\n+            }\n+        }\n+        stage('Build kogito-examples (-Pnative)') {\n+            steps {\n+                script {\n+                    mavenCleanInstallNative(\"kogito-examples\")\n+                }\n+            }\n+            post {\n+                always {\n+                    saveReports()\n+                }\n+            }\n+        }\n+    }\n+    post {\n+        unsuccessful {\n+            sendNotification()\n+        }\n+        always {\n+            junit '**/target/surefire-reports/**/*.xml'\n+            cleanWs()\n+        }\n+    }\n+}\n+\n+void sendNotification(){\n+    emailext body: \"Kogito daily native #${BUILD_NUMBER} was: ${currentBuild.currentResult}\\nPlease look here: ${BUILD_URL}\",\n+             subject: \"[${params.BRANCH_NAME}][d] Runtimes native\",\n+             to: env.KOGITO_CI_EMAIL_TO\n+}\n+\n+void saveReports(boolean allowEmpty=false){\n+    junit testResults: '**/target/surefire-reports/**/*.xml, **/target/failsafe-reports/**/*.xml', allowEmptyResults: allowEmpty\n+}\n+\n+void checkoutRepo(String repo, String dirName=repo) {\n+    dir(dirName) {\n+        checkout(githubscm.resolveRepository(repoName, \"kiegroup\", params.BRANCH_NAME, false))\n+    }\n+}\n+\n+void mavenCleanInstallNative(String repoName, String dirName = repoName) {\n+    dir(dirName){\n+        mavenCleanInstall(\"-Pnative -Dquarkus.native.container-build=true -Dquarkus.native.container-runtime=podman\")", "originalCommit": "d1f77c185af4036a217839175b8454c93be1b6ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzI3MTU4MQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497271581", "bodyText": "yeah right ... could be a problem on kie-rhel7 agent. We should use kogito-cloud instead", "author": "radtriste", "createdAt": "2020-09-30T06:32:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE3ODYwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzMxMTgwMg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497311802", "bodyText": "Changed agent to kogito-cloud. Let me know if I need to change to docker too or if it is fine to use podman", "author": "danielezonca", "createdAt": "2020-09-30T07:54:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE3ODYwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzMxNzAwMg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497317002", "bodyText": "podman is ok on this agent", "author": "radtriste", "createdAt": "2020-09-30T08:02:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE3ODYwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQyMTUwMQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497421501", "bodyText": "cool", "author": "cristianonicolai", "createdAt": "2020-09-30T11:00:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE3ODYwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzI3MDYxNQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497270615", "bodyText": "I think this should be a multibranch pipeline. Thus BRANCH_NAME is already provided as env by Jenkins.\nparameters part can be deleted ;)", "author": "radtriste", "createdAt": "2020-09-30T06:30:01Z", "path": "Jenkinsfile.native", "diffHunk": "@@ -0,0 +1,109 @@\n+@Library('jenkins-pipeline-shared-libraries')_\n+\n+pipeline {\n+    agent {\n+        label 'kie-rhel7 && kie-mem16g'\n+    }\n+    tools {\n+        maven 'kie-maven-3.6.2'\n+        jdk 'kie-jdk11'\n+    }\n+    triggers {\n+        cron ('H 10 * * *')\n+    }\n+    options {\n+        buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '', numToKeepStr: '5')\n+        timeout(time: 360, unit: 'MINUTES')\n+    }\n+    parameters {\n+        string(name: 'BRANCH_NAME', defaultValue: \"master\", description: 'Set the branch to build&test')", "originalCommit": "d1f77c185af4036a217839175b8454c93be1b6ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzMxMTgzMw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497311833", "bodyText": "Done", "author": "danielezonca", "createdAt": "2020-09-30T07:54:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzI3MDYxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzI3MDg4Nw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497270887", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                         subject: \"[${params.BRANCH_NAME}][d] Runtimes native\",\n          \n          \n            \n                         subject: \"[${env.BRANCH_NAME}][d] Runtimes native\",", "author": "radtriste", "createdAt": "2020-09-30T06:30:40Z", "path": "Jenkinsfile.native", "diffHunk": "@@ -0,0 +1,109 @@\n+@Library('jenkins-pipeline-shared-libraries')_\n+\n+pipeline {\n+    agent {\n+        label 'kie-rhel7 && kie-mem16g'\n+    }\n+    tools {\n+        maven 'kie-maven-3.6.2'\n+        jdk 'kie-jdk11'\n+    }\n+    triggers {\n+        cron ('H 10 * * *')\n+    }\n+    options {\n+        buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '', numToKeepStr: '5')\n+        timeout(time: 360, unit: 'MINUTES')\n+    }\n+    parameters {\n+        string(name: 'BRANCH_NAME', defaultValue: \"master\", description: 'Set the branch to build&test')\n+    }\n+    environment {\n+        KOGITO_CI_EMAIL_TO = credentials('KOGITO_CI_EMAIL_TO')\n+        MAVEN_OPTS = '-Xms1024m -Xmx4g'\n+    }\n+    stages {\n+        stage('Initialize') {\n+            steps {\n+                script {\n+                    mailer.buildLogScriptPR()\n+\n+                    checkoutRepo(\"kogito-runtimes\")\n+                    checkoutRepo(\"kogito-apps\")\n+                    checkoutRepo(\"kogito-examples\")\n+                }\n+            }\n+        }\n+        stage('Build kogito-runtimes (-Pnative)') {\n+            steps {\n+                script {\n+                    mavenCleanInstallNative(\"kogito-runtimes\")\n+                }\n+            }\n+            post {\n+                always {\n+                    saveReports()\n+                }\n+            }\n+        }\n+        stage('Build kogito-apps (-Pnative)') {\n+            steps {\n+                script {\n+                    mavenCleanInstallNative(\"kogito-apps\")\n+                }\n+            }\n+            post {\n+                always {\n+                    saveReports()\n+                }\n+            }\n+        }\n+        stage('Build kogito-examples (-Pnative)') {\n+            steps {\n+                script {\n+                    mavenCleanInstallNative(\"kogito-examples\")\n+                }\n+            }\n+            post {\n+                always {\n+                    saveReports()\n+                }\n+            }\n+        }\n+    }\n+    post {\n+        unsuccessful {\n+            sendNotification()\n+        }\n+        always {\n+            junit '**/target/surefire-reports/**/*.xml'\n+            cleanWs()\n+        }\n+    }\n+}\n+\n+void sendNotification(){\n+    emailext body: \"Kogito daily native #${BUILD_NUMBER} was: ${currentBuild.currentResult}\\nPlease look here: ${BUILD_URL}\",\n+             subject: \"[${params.BRANCH_NAME}][d] Runtimes native\",", "originalCommit": "d1f77c185af4036a217839175b8454c93be1b6ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzMxMTg3MQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497311871", "bodyText": "Done", "author": "danielezonca", "createdAt": "2020-09-30T07:54:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzI3MDg4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzI3MTIwMA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497271200", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    checkout(githubscm.resolveRepository(repoName, \"kiegroup\", params.BRANCH_NAME, false))\n          \n          \n            \n                    checkout(githubscm.resolveRepository(repoName, \"kiegroup\", env.BRANCH_NAME, false))", "author": "radtriste", "createdAt": "2020-09-30T06:31:28Z", "path": "Jenkinsfile.native", "diffHunk": "@@ -0,0 +1,109 @@\n+@Library('jenkins-pipeline-shared-libraries')_\n+\n+pipeline {\n+    agent {\n+        label 'kie-rhel7 && kie-mem16g'\n+    }\n+    tools {\n+        maven 'kie-maven-3.6.2'\n+        jdk 'kie-jdk11'\n+    }\n+    triggers {\n+        cron ('H 10 * * *')\n+    }\n+    options {\n+        buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '', numToKeepStr: '5')\n+        timeout(time: 360, unit: 'MINUTES')\n+    }\n+    parameters {\n+        string(name: 'BRANCH_NAME', defaultValue: \"master\", description: 'Set the branch to build&test')\n+    }\n+    environment {\n+        KOGITO_CI_EMAIL_TO = credentials('KOGITO_CI_EMAIL_TO')\n+        MAVEN_OPTS = '-Xms1024m -Xmx4g'\n+    }\n+    stages {\n+        stage('Initialize') {\n+            steps {\n+                script {\n+                    mailer.buildLogScriptPR()\n+\n+                    checkoutRepo(\"kogito-runtimes\")\n+                    checkoutRepo(\"kogito-apps\")\n+                    checkoutRepo(\"kogito-examples\")\n+                }\n+            }\n+        }\n+        stage('Build kogito-runtimes (-Pnative)') {\n+            steps {\n+                script {\n+                    mavenCleanInstallNative(\"kogito-runtimes\")\n+                }\n+            }\n+            post {\n+                always {\n+                    saveReports()\n+                }\n+            }\n+        }\n+        stage('Build kogito-apps (-Pnative)') {\n+            steps {\n+                script {\n+                    mavenCleanInstallNative(\"kogito-apps\")\n+                }\n+            }\n+            post {\n+                always {\n+                    saveReports()\n+                }\n+            }\n+        }\n+        stage('Build kogito-examples (-Pnative)') {\n+            steps {\n+                script {\n+                    mavenCleanInstallNative(\"kogito-examples\")\n+                }\n+            }\n+            post {\n+                always {\n+                    saveReports()\n+                }\n+            }\n+        }\n+    }\n+    post {\n+        unsuccessful {\n+            sendNotification()\n+        }\n+        always {\n+            junit '**/target/surefire-reports/**/*.xml'\n+            cleanWs()\n+        }\n+    }\n+}\n+\n+void sendNotification(){\n+    emailext body: \"Kogito daily native #${BUILD_NUMBER} was: ${currentBuild.currentResult}\\nPlease look here: ${BUILD_URL}\",\n+             subject: \"[${params.BRANCH_NAME}][d] Runtimes native\",\n+             to: env.KOGITO_CI_EMAIL_TO\n+}\n+\n+void saveReports(boolean allowEmpty=false){\n+    junit testResults: '**/target/surefire-reports/**/*.xml, **/target/failsafe-reports/**/*.xml', allowEmptyResults: allowEmpty\n+}\n+\n+void checkoutRepo(String repo, String dirName=repo) {\n+    dir(dirName) {\n+        checkout(githubscm.resolveRepository(repoName, \"kiegroup\", params.BRANCH_NAME, false))", "originalCommit": "d1f77c185af4036a217839175b8454c93be1b6ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzMxMTkxNw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497311917", "bodyText": "Done", "author": "danielezonca", "createdAt": "2020-09-30T07:54:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzI3MTIwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzI3NzA4Ng==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497277086", "bodyText": "As mentioned by @cristianonicolai\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    label 'kie-rhel7 && kie-mem16g'\n          \n          \n            \n                    label 'kogito-cloud'", "author": "radtriste", "createdAt": "2020-09-30T06:46:11Z", "path": "Jenkinsfile.native", "diffHunk": "@@ -0,0 +1,109 @@\n+@Library('jenkins-pipeline-shared-libraries')_\n+\n+pipeline {\n+    agent {\n+        label 'kie-rhel7 && kie-mem16g'", "originalCommit": "d1f77c185af4036a217839175b8454c93be1b6ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzI3ODk1MQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497278951", "bodyText": "kogito-cloud has 16GB mem already", "author": "radtriste", "createdAt": "2020-09-30T06:50:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzI3NzA4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzMxMjA0Mw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497312043", "bodyText": "Done", "author": "danielezonca", "createdAt": "2020-09-30T07:54:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzI3NzA4Ng=="}], "type": "inlineReview"}, {"oid": "7cca2a843dc91dd4de6b62fee29adc60d89cbd2c", "url": "https://github.com/kiegroup/kogito-runtimes/commit/7cca2a843dc91dd4de6b62fee29adc60d89cbd2c", "message": "Merge remote-tracking branch 'upstream/master' into KOGITO-3460", "committedDate": "2020-09-30T07:52:24Z", "type": "commit"}, {"oid": "e4cd2d8d54bfc06922ed9b148555616dd865a589", "url": "https://github.com/kiegroup/kogito-runtimes/commit/e4cd2d8d54bfc06922ed9b148555616dd865a589", "message": "[KOGITO-3460] Fixes", "committedDate": "2020-09-30T07:53:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzMxNzU2Nw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497317567", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                maven.runMavenWithSubmarineSettings(\"clean install ${env.MAVEN_EXTRA_ARGS} ${extraArgs}\", false)\n          \n          \n            \n                maven.runMavenWithSubmarineSettings(\"clean install ${env.MAVEN_OPTS} ${extraArgs}\", false)\n          \n      \n    \n    \n  \n\nor ?", "author": "radtriste", "createdAt": "2020-09-30T08:03:10Z", "path": "Jenkinsfile.native", "diffHunk": "@@ -0,0 +1,106 @@\n+@Library('jenkins-pipeline-shared-libraries')_\n+\n+pipeline {\n+    agent {\n+        label 'kogito-cloud'\n+    }\n+    tools {\n+        maven 'kie-maven-3.6.2'\n+        jdk 'kie-jdk11'\n+    }\n+    triggers {\n+        cron ('H 10 * * *')\n+    }\n+    options {\n+        buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '', numToKeepStr: '5')\n+        timeout(time: 360, unit: 'MINUTES')\n+    }\n+    environment {\n+        KOGITO_CI_EMAIL_TO = credentials('KOGITO_CI_EMAIL_TO')\n+        MAVEN_OPTS = '-Xms1024m -Xmx4g'\n+    }\n+    stages {\n+        stage('Initialize') {\n+            steps {\n+                script {\n+                    mailer.buildLogScriptPR()\n+\n+                    checkoutRepo(\"kogito-runtimes\")\n+                    checkoutRepo(\"kogito-apps\")\n+                    checkoutRepo(\"kogito-examples\")\n+                }\n+            }\n+        }\n+        stage('Build kogito-runtimes (-Pnative)') {\n+            steps {\n+                script {\n+                    mavenCleanInstallNative(\"kogito-runtimes\")\n+                }\n+            }\n+            post {\n+                always {\n+                    saveReports()\n+                }\n+            }\n+        }\n+        stage('Build kogito-apps (-Pnative)') {\n+            steps {\n+                script {\n+                    mavenCleanInstallNative(\"kogito-apps\")\n+                }\n+            }\n+            post {\n+                always {\n+                    saveReports()\n+                }\n+            }\n+        }\n+        stage('Build kogito-examples (-Pnative)') {\n+            steps {\n+                script {\n+                    mavenCleanInstallNative(\"kogito-examples\")\n+                }\n+            }\n+            post {\n+                always {\n+                    saveReports()\n+                }\n+            }\n+        }\n+    }\n+    post {\n+        unsuccessful {\n+            sendNotification()\n+        }\n+        always {\n+            junit '**/target/surefire-reports/**/*.xml'\n+            cleanWs()\n+        }\n+    }\n+}\n+\n+void sendNotification(){\n+    emailext body: \"Kogito daily native #${BUILD_NUMBER} was: ${currentBuild.currentResult}\\nPlease look here: ${BUILD_URL}\",\n+             subject: \"[${env.BRANCH_NAME}][d] Runtimes native\",\n+             to: env.KOGITO_CI_EMAIL_TO\n+}\n+\n+void saveReports(boolean allowEmpty=false){\n+    junit testResults: '**/target/surefire-reports/**/*.xml, **/target/failsafe-reports/**/*.xml', allowEmptyResults: allowEmpty\n+}\n+\n+void checkoutRepo(String repo, String dirName=repo) {\n+    dir(dirName) {\n+        checkout(githubscm.resolveRepository(repoName, \"kiegroup\", env.BRANCH_NAME, false))\n+    }\n+}\n+\n+void mavenCleanInstallNative(String repoName, String dirName = repoName) {\n+    dir(dirName){\n+        mavenCleanInstall(\"-Pnative -Dquarkus.native.container-build=true -Dquarkus.native.container-runtime=podman\")\n+    }\n+}\n+\n+void mavenCleanInstall(String extraArgs){\n+    maven.runMavenWithSubmarineSettings(\"clean install ${env.MAVEN_EXTRA_ARGS} ${extraArgs}\", false)", "originalCommit": "e4cd2d8d54bfc06922ed9b148555616dd865a589", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzMxNzkxNw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497317917", "bodyText": "btw, not sure we should keep MAVEN_OPTS for native ...", "author": "radtriste", "createdAt": "2020-09-30T08:03:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzMxNzU2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzMzOTI1MQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497339251", "bodyText": "Fixed. I think it could make sense to preserve MAVEN_OPS: the build is still a maven build with then an additional step to perform native compilation", "author": "danielezonca", "createdAt": "2020-09-30T08:38:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzMxNzU2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM2MzIwNA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497363204", "bodyText": "yeah but will 4G be enough for compilation/testing ?", "author": "radtriste", "createdAt": "2020-09-30T09:16:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzMxNzU2Nw=="}], "type": "inlineReview"}, {"oid": "d7ca2108b7d4b3906b4dc83fbc13bfe6d0c5ab9a", "url": "https://github.com/kiegroup/kogito-runtimes/commit/d7ca2108b7d4b3906b4dc83fbc13bfe6d0c5ab9a", "message": "[KOGITO-3460] Fixes", "committedDate": "2020-09-30T08:37:18Z", "type": "commit"}, {"oid": "b37511d48778c4c6ee6932013a7ecc1547039fa2", "url": "https://github.com/kiegroup/kogito-runtimes/commit/b37511d48778c4c6ee6932013a7ecc1547039fa2", "message": "[KOGITO-3460] Fix variable name", "committedDate": "2020-09-30T11:58:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ2MDA4Ng==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497460086", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                maven.runMavenWithSubmarineSettings(\"clean install ${env.MAVEN_OPTS} ${extraArgs}\", false)\n          \n          \n            \n                maven.runMavenWithSubmarineSettings(\"clean install ${extraArgs}\", false)\n          \n      \n    \n    \n  \n\nMAVEN_OPTS env is taken automatically by Maven ;)", "author": "radtriste", "createdAt": "2020-09-30T12:13:48Z", "path": "Jenkinsfile.native", "diffHunk": "@@ -0,0 +1,106 @@\n+@Library('jenkins-pipeline-shared-libraries')_\n+\n+pipeline {\n+    agent {\n+        label 'kogito-cloud'\n+    }\n+    tools {\n+        maven 'kie-maven-3.6.2'\n+        jdk 'kie-jdk11'\n+    }\n+    triggers {\n+        cron ('H 10 * * *')\n+    }\n+    options {\n+        buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '', numToKeepStr: '5')\n+        timeout(time: 360, unit: 'MINUTES')\n+    }\n+    environment {\n+        KOGITO_CI_EMAIL_TO = credentials('KOGITO_CI_EMAIL_TO')\n+        MAVEN_OPTS = '-Xms1024m -Xmx4g'\n+    }\n+    stages {\n+        stage('Initialize') {\n+            steps {\n+                script {\n+                    mailer.buildLogScriptPR()\n+\n+                    checkoutRepo(\"kogito-runtimes\")\n+                    checkoutRepo(\"kogito-apps\")\n+                    checkoutRepo(\"kogito-examples\")\n+                }\n+            }\n+        }\n+        stage('Build kogito-runtimes (-Pnative)') {\n+            steps {\n+                script {\n+                    mavenCleanInstallNative(\"kogito-runtimes\")\n+                }\n+            }\n+            post {\n+                always {\n+                    saveReports()\n+                }\n+            }\n+        }\n+        stage('Build kogito-apps (-Pnative)') {\n+            steps {\n+                script {\n+                    mavenCleanInstallNative(\"kogito-apps\")\n+                }\n+            }\n+            post {\n+                always {\n+                    saveReports()\n+                }\n+            }\n+        }\n+        stage('Build kogito-examples (-Pnative)') {\n+            steps {\n+                script {\n+                    mavenCleanInstallNative(\"kogito-examples\")\n+                }\n+            }\n+            post {\n+                always {\n+                    saveReports()\n+                }\n+            }\n+        }\n+    }\n+    post {\n+        unsuccessful {\n+            sendNotification()\n+        }\n+        always {\n+            junit '**/target/surefire-reports/**/*.xml'\n+            cleanWs()\n+        }\n+    }\n+}\n+\n+void sendNotification(){\n+    emailext body: \"Kogito daily native #${BUILD_NUMBER} was: ${currentBuild.currentResult}\\nPlease look here: ${BUILD_URL}\",\n+             subject: \"[${env.BRANCH_NAME}][d] Runtimes native\",\n+             to: env.KOGITO_CI_EMAIL_TO\n+}\n+\n+void saveReports(boolean allowEmpty=false){\n+    junit testResults: '**/target/surefire-reports/**/*.xml, **/target/failsafe-reports/**/*.xml', allowEmptyResults: allowEmpty\n+}\n+\n+void checkoutRepo(String repoName, String dirName=repoName) {\n+    dir(dirName) {\n+        checkout(githubscm.resolveRepository(repoName, \"kiegroup\", env.BRANCH_NAME, false))\n+    }\n+}\n+\n+void mavenCleanInstallNative(String repoName, String dirName = repoName) {\n+    dir(dirName){\n+        mavenCleanInstall(\"-Pnative -Dquarkus.native.container-build=true -Dquarkus.native.container-runtime=podman\")\n+    }\n+}\n+\n+void mavenCleanInstall(String extraArgs){\n+    maven.runMavenWithSubmarineSettings(\"clean install ${env.MAVEN_OPTS} ${extraArgs}\", false)", "originalCommit": "b37511d48778c4c6ee6932013a7ecc1547039fa2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ2MTA0OA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497461048", "bodyText": "Done :)", "author": "danielezonca", "createdAt": "2020-09-30T12:15:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ2MDA4Ng=="}], "type": "inlineReview"}, {"oid": "b2fc5d8004715f9cc6490d240f19fb0a8d1d28c0", "url": "https://github.com/kiegroup/kogito-runtimes/commit/b2fc5d8004715f9cc6490d240f19fb0a8d1d28c0", "message": "[KOGITO-3460] Fix params", "committedDate": "2020-09-30T12:14:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ2MDYzMQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497460631", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    stage('Build kogito-runtimes (-Pnative)') {\n          \n          \n            \n                    stage('Build kogito-runtimes') {", "author": "radtriste", "createdAt": "2020-09-30T12:14:43Z", "path": "Jenkinsfile.native", "diffHunk": "@@ -0,0 +1,106 @@\n+@Library('jenkins-pipeline-shared-libraries')_\n+\n+pipeline {\n+    agent {\n+        label 'kogito-cloud'\n+    }\n+    tools {\n+        maven 'kie-maven-3.6.2'\n+        jdk 'kie-jdk11'\n+    }\n+    triggers {\n+        cron ('H 10 * * *')\n+    }\n+    options {\n+        buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '', numToKeepStr: '5')\n+        timeout(time: 360, unit: 'MINUTES')\n+    }\n+    environment {\n+        KOGITO_CI_EMAIL_TO = credentials('KOGITO_CI_EMAIL_TO')\n+        MAVEN_OPTS = '-Xms1024m -Xmx4g'\n+    }\n+    stages {\n+        stage('Initialize') {\n+            steps {\n+                script {\n+                    mailer.buildLogScriptPR()\n+\n+                    checkoutRepo(\"kogito-runtimes\")\n+                    checkoutRepo(\"kogito-apps\")\n+                    checkoutRepo(\"kogito-examples\")\n+                }\n+            }\n+        }\n+        stage('Build kogito-runtimes (-Pnative)') {", "originalCommit": "b37511d48778c4c6ee6932013a7ecc1547039fa2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ2MTk4Ng==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497461986", "bodyText": "Done", "author": "danielezonca", "createdAt": "2020-09-30T12:17:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ2MDYzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ2MDcyOQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497460729", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    stage('Build kogito-apps (-Pnative)') {\n          \n          \n            \n                    stage('Build kogito-apps') {", "author": "radtriste", "createdAt": "2020-09-30T12:14:54Z", "path": "Jenkinsfile.native", "diffHunk": "@@ -0,0 +1,106 @@\n+@Library('jenkins-pipeline-shared-libraries')_\n+\n+pipeline {\n+    agent {\n+        label 'kogito-cloud'\n+    }\n+    tools {\n+        maven 'kie-maven-3.6.2'\n+        jdk 'kie-jdk11'\n+    }\n+    triggers {\n+        cron ('H 10 * * *')\n+    }\n+    options {\n+        buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '', numToKeepStr: '5')\n+        timeout(time: 360, unit: 'MINUTES')\n+    }\n+    environment {\n+        KOGITO_CI_EMAIL_TO = credentials('KOGITO_CI_EMAIL_TO')\n+        MAVEN_OPTS = '-Xms1024m -Xmx4g'\n+    }\n+    stages {\n+        stage('Initialize') {\n+            steps {\n+                script {\n+                    mailer.buildLogScriptPR()\n+\n+                    checkoutRepo(\"kogito-runtimes\")\n+                    checkoutRepo(\"kogito-apps\")\n+                    checkoutRepo(\"kogito-examples\")\n+                }\n+            }\n+        }\n+        stage('Build kogito-runtimes (-Pnative)') {\n+            steps {\n+                script {\n+                    mavenCleanInstallNative(\"kogito-runtimes\")\n+                }\n+            }\n+            post {\n+                always {\n+                    saveReports()\n+                }\n+            }\n+        }\n+        stage('Build kogito-apps (-Pnative)') {", "originalCommit": "b37511d48778c4c6ee6932013a7ecc1547039fa2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ2MTkzOQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497461939", "bodyText": "Done", "author": "danielezonca", "createdAt": "2020-09-30T12:16:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ2MDcyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ2MDgxNQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497460815", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    stage('Build kogito-examples (-Pnative)') {\n          \n          \n            \n                    stage('Build kogito-examples') {", "author": "radtriste", "createdAt": "2020-09-30T12:15:03Z", "path": "Jenkinsfile.native", "diffHunk": "@@ -0,0 +1,106 @@\n+@Library('jenkins-pipeline-shared-libraries')_\n+\n+pipeline {\n+    agent {\n+        label 'kogito-cloud'\n+    }\n+    tools {\n+        maven 'kie-maven-3.6.2'\n+        jdk 'kie-jdk11'\n+    }\n+    triggers {\n+        cron ('H 10 * * *')\n+    }\n+    options {\n+        buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '', numToKeepStr: '5')\n+        timeout(time: 360, unit: 'MINUTES')\n+    }\n+    environment {\n+        KOGITO_CI_EMAIL_TO = credentials('KOGITO_CI_EMAIL_TO')\n+        MAVEN_OPTS = '-Xms1024m -Xmx4g'\n+    }\n+    stages {\n+        stage('Initialize') {\n+            steps {\n+                script {\n+                    mailer.buildLogScriptPR()\n+\n+                    checkoutRepo(\"kogito-runtimes\")\n+                    checkoutRepo(\"kogito-apps\")\n+                    checkoutRepo(\"kogito-examples\")\n+                }\n+            }\n+        }\n+        stage('Build kogito-runtimes (-Pnative)') {\n+            steps {\n+                script {\n+                    mavenCleanInstallNative(\"kogito-runtimes\")\n+                }\n+            }\n+            post {\n+                always {\n+                    saveReports()\n+                }\n+            }\n+        }\n+        stage('Build kogito-apps (-Pnative)') {\n+            steps {\n+                script {\n+                    mavenCleanInstallNative(\"kogito-apps\")\n+                }\n+            }\n+            post {\n+                always {\n+                    saveReports()\n+                }\n+            }\n+        }\n+        stage('Build kogito-examples (-Pnative)') {", "originalCommit": "b37511d48778c4c6ee6932013a7ecc1547039fa2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ2MjA5Ng==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/793#discussion_r497462096", "bodyText": "Done", "author": "danielezonca", "createdAt": "2020-09-30T12:17:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ2MDgxNQ=="}], "type": "inlineReview"}, {"oid": "5cc2778f808d71e9be2519c510cddebbeca6516b", "url": "https://github.com/kiegroup/kogito-runtimes/commit/5cc2778f808d71e9be2519c510cddebbeca6516b", "message": "[KOGITO-3460] Minor fix", "committedDate": "2020-09-30T12:16:37Z", "type": "commit"}, {"oid": "db6d7f098e6c55c9a856b6f0f3eaa8da12c88d47", "url": "https://github.com/kiegroup/kogito-runtimes/commit/db6d7f098e6c55c9a856b6f0f3eaa8da12c88d47", "message": "Merge remote-tracking branch 'upstream/master' into KOGITO-3460", "committedDate": "2020-10-01T08:49:26Z", "type": "commit"}, {"oid": "cd42c5fa9e4d129ecf24509264e6de7ad379d118", "url": "https://github.com/kiegroup/kogito-runtimes/commit/cd42c5fa9e4d129ecf24509264e6de7ad379d118", "message": "[KOGITO-3460] Make -apps compile in jvm mode", "committedDate": "2020-10-01T11:58:31Z", "type": "commit"}]}