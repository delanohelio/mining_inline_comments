{"pr_number": 309, "pr_title": "KOGITO-1145 - Business relevant process variables support", "pr_createdAt": "2020-02-12T15:48:40Z", "pr_url": "https://github.com/kiegroup/kogito-runtimes/pull/309", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU5ODM4Nw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/309#discussion_r378598387", "bodyText": "@mswiderski is the intention that we support \"custom tags\"? Im asking that because if not, I would suggest us to have a enum to define these values, avoiding potential mistakes and making it easy for developers to know the possible values.", "author": "cristianonicolai", "createdAt": "2020-02-13T00:56:49Z", "path": "api/kogito-internal/src/main/java/org/kie/internal/kogito/codegen/VariableInfo.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*\n+ * Copyright 2019 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.internal.kogito.codegen;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target({ElementType.FIELD})\n+public @interface VariableInfo {\n+   /**\n+    * Variable tags assigned to given property of the model\n+    */\n+   String tags() default \"\";", "originalCommit": "c9bba9ac13df779a9654303e4a924d00a6b3e762", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY3MzIwNQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/309#discussion_r378673205", "bodyText": "yes, we do support custom tags", "author": "mswiderski", "createdAt": "2020-02-13T06:32:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU5ODM4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTAyNzY3OA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/309#discussion_r379027678", "bodyText": "In case of multiple tags for the same variable, the idea is to serialize them in an array? Otherwise, maybe it is worth making String[] tags() instead of a single String, WDYT?", "author": "tiagodolphine", "createdAt": "2020-02-13T18:03:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU5ODM4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI4MTk5NQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/309#discussion_r379281995", "bodyText": "since this is mainly data carrier and simply maps the customTags metaData to this annotation I'd stick to simple string ... I guess this would be also easier to deal with in the proto file that data index would interpret. @cristianonicolai what's your opinion?", "author": "mswiderski", "createdAt": "2020-02-14T07:23:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU5ODM4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU5OTQ1Nw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/309#discussion_r378599457", "bodyText": "@mswiderski if we add an enum, I would suggest calling this simply business then add a comment with the explanation, just to shorten it.", "author": "cristianonicolai", "createdAt": "2020-02-13T01:01:05Z", "path": "api/kogito-services/src/main/java/org/kie/kogito/services/event/impl/ProcessInstanceEventBatch.java", "diffHunk": "@@ -37,10 +40,14 @@\n import org.kie.kogito.event.EventBatch;\n import org.kie.kogito.services.event.ProcessInstanceDataEvent;\n import org.kie.kogito.services.event.UserTaskInstanceDataEvent;\n+import org.kie.kogito.services.event.VariableInstanceDataEvent;\n \n \n public class ProcessInstanceEventBatch implements EventBatch {\n     \n+    public static final String BUSINESS_RELEVANT = \"business-relevant\";", "originalCommit": "c9bba9ac13df779a9654303e4a924d00a6b3e762", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY3MzM0Ng==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/309#discussion_r378673346", "bodyText": "we can shorten it anyway, just let me know if we have better name, as business itself sounds bit too generic", "author": "mswiderski", "createdAt": "2020-02-13T06:32:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU5OTQ1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU5OTk4Nw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/309#discussion_r378599987", "bodyText": "@mswiderski I couldn't get the default behaviour for variables. Would that be tracked? Should we make that configurable, so for instance if we want to enable audit for all variables changes we wouldnt need to mark all variables with this tag?", "author": "cristianonicolai", "createdAt": "2020-02-13T01:03:16Z", "path": "api/kogito-services/src/main/java/org/kie/kogito/services/event/impl/ProcessInstanceEventBatch.java", "diffHunk": "@@ -90,6 +98,12 @@ public void append(Object rawEvent) {\n                 if (workItem instanceof HumanTaskWorkItem && workItemTransitionEvent.isTransitioned()) {\n                     userTaskInstances.putIfAbsent(workItem.getId(), createUserTask(workItemTransitionEvent));                    \n                 }\n+            } else if (event instanceof ProcessVariableChangedEvent) {\n+                ProcessVariableChangedEvent variableChangedEvent = (ProcessVariableChangedEvent) event;\n+                \n+                if (variableChangedEvent.hasTag(BUSINESS_RELEVANT) || variableChangedEvent.hasTag(TRACKED)) {", "originalCommit": "c9bba9ac13df779a9654303e4a924d00a6b3e762", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY3MzU4Mg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/309#discussion_r378673582", "bodyText": "no, I'd prefer to be explicitly enabled ... maybe we can think about some global switch but I wouldn't go for it at first as this can be really chatty when it comes to events being emitted.", "author": "mswiderski", "createdAt": "2020-02-13T06:33:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU5OTk4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODc1ODYzMg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/309#discussion_r378758632", "bodyText": "@ricardozanini FYI, new topic for runtimes", "author": "cristianonicolai", "createdAt": "2020-02-13T09:59:49Z", "path": "addons/events/kogito-events-reactive-messaging-addon/src/main/java/org/kie/kogito/events/rm/ReactiveMessagingEventPublisher.java", "diffHunk": "@@ -39,6 +39,7 @@\n public class ReactiveMessagingEventPublisher implements EventPublisher {\n     private static final String PI_TOPIC_NAME = \"kogito-processinstances-events\";\n     private static final String UI_TOPIC_NAME = \"kogito-usertaskinstances-events\";\n+    private static final String VI_TOPIC_NAME = \"kogito-variables-events\";", "originalCommit": "c9bba9ac13df779a9654303e4a924d00a6b3e762", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "38793d8dda914231f52fb660846f30a6dbfb5257", "url": "https://github.com/kiegroup/kogito-runtimes/commit/38793d8dda914231f52fb660846f30a6dbfb5257", "message": "KOGITO-1145 - Business relevant process variables support", "committedDate": "2020-02-13T11:24:41Z", "type": "forcePushed"}, {"oid": "68eb6e6cedd9a30127af52aeea18ef6596512521", "url": "https://github.com/kiegroup/kogito-runtimes/commit/68eb6e6cedd9a30127af52aeea18ef6596512521", "message": "KOGITO-1145 - Business relevant process variables support", "committedDate": "2020-02-13T12:05:31Z", "type": "forcePushed"}, {"oid": "cf4b0045ccca09827cd76de184ec796ace92d310", "url": "https://github.com/kiegroup/kogito-runtimes/commit/cf4b0045ccca09827cd76de184ec796ace92d310", "message": "KOGITO-1145 - Business relevant process variables support", "committedDate": "2020-02-13T15:38:38Z", "type": "forcePushed"}, {"oid": "fa2751f5caa04be4cdeeaf26961ef3544c23cb97", "url": "https://github.com/kiegroup/kogito-runtimes/commit/fa2751f5caa04be4cdeeaf26961ef3544c23cb97", "message": "KOGITO-1145 - Business relevant process variables support", "committedDate": "2020-02-14T07:44:22Z", "type": "commit"}, {"oid": "fa2751f5caa04be4cdeeaf26961ef3544c23cb97", "url": "https://github.com/kiegroup/kogito-runtimes/commit/fa2751f5caa04be4cdeeaf26961ef3544c23cb97", "message": "KOGITO-1145 - Business relevant process variables support", "committedDate": "2020-02-14T07:44:22Z", "type": "forcePushed"}]}