{"pr_number": 758, "pr_title": "[JENKINS-61930] JCasC testing", "pr_createdAt": "2020-04-16T13:00:49Z", "pr_url": "https://github.com/jenkinsci/kubernetes-plugin/pull/758", "timeline": [{"oid": "07561d6e0a616d444260ecc6fe0a332d36983575", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/07561d6e0a616d444260ecc6fe0a332d36983575", "message": "[JENKINS-61930] JCasC testing", "committedDate": "2020-04-16T13:00:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUzNzY1MA==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/758#discussion_r409537650", "bodyText": "Better to use the BOM.", "author": "jglick", "createdAt": "2020-04-16T13:02:54Z", "path": "pom.xml", "diffHunk": "@@ -53,6 +53,7 @@\n     <pipeline-model-definition.version>1.6.0</pipeline-model-definition.version>\n     <slf4jVersion>1.7.26</slf4jVersion>\n     <useBeta>true</useBeta>\n+    <configuration-as-code.version>1.36</configuration-as-code.version>", "originalCommit": "07561d6e0a616d444260ecc6fe0a332d36983575", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUzODMxNA==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/758#discussion_r409538314", "bodyText": "OK I am bored already. \ud83d\ude2a", "author": "jglick", "createdAt": "2020-04-16T13:03:58Z", "path": "src/test/java/org/csanchez/jenkins/plugins/kubernetes/casc/CasCTest.java", "diffHunk": "@@ -0,0 +1,79 @@\n+package org.csanchez.jenkins.plugins.kubernetes.casc;\n+\n+import io.jenkins.plugins.casc.misc.RoundTripAbstractTest;\n+import org.csanchez.jenkins.plugins.kubernetes.ContainerLivenessProbe;\n+import org.csanchez.jenkins.plugins.kubernetes.ContainerTemplate;\n+import org.csanchez.jenkins.plugins.kubernetes.KubernetesCloud;\n+import org.csanchez.jenkins.plugins.kubernetes.PodTemplate;\n+import org.csanchez.jenkins.plugins.kubernetes.pod.yaml.Merge;\n+import org.csanchez.jenkins.plugins.kubernetes.pod.yaml.Overrides;\n+import org.csanchez.jenkins.plugins.kubernetes.volumes.workspace.DynamicPVCWorkspaceVolume;\n+import org.csanchez.jenkins.plugins.kubernetes.volumes.workspace.WorkspaceVolume;\n+import org.jvnet.hudson.test.RestartableJenkinsRule;\n+\n+import java.util.List;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.isA;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+public class CasCTest extends RoundTripAbstractTest {\n+\n+    @Override\n+    protected void assertConfiguredAsExpected(RestartableJenkinsRule r, String configContent) {\n+        KubernetesCloud cloud = r.j.jenkins.clouds.get(KubernetesCloud.class);\n+        assertNotNull(cloud);\n+        assertEquals(\"10\",cloud.getContainerCapStr());\n+        assertEquals(\"http://jenkinshost:8080/jenkins/\", cloud.getJenkinsUrl());\n+        assertEquals(\"32\", cloud.getMaxRequestsPerHostStr());\n+        assertEquals(\"kubernetes\", cloud.name);\n+        List<PodTemplate> templates = cloud.getTemplates();\n+        assertNotNull(templates);\n+        assertEquals(3, templates.size());\n+        PodTemplate podTemplate = templates.get(0);\n+        assertEquals(false, podTemplate.isHostNetwork());\n+        assertEquals(\"java\", podTemplate.getLabel());\n+        assertEquals(\"default-java\", podTemplate.getName());\n+        assertThat(podTemplate.getYamlMergeStrategy(), isA(Overrides.class));\n+        podTemplate = templates.get(1);\n+        assertEquals(false, podTemplate.isHostNetwork());\n+        assertEquals(\"dynamic-pvc\", podTemplate.getLabel());\n+        assertEquals(\"dynamic-pvc\", podTemplate.getName());\n+        assertThat(podTemplate.getYamlMergeStrategy(), isA(Overrides.class));\n+        WorkspaceVolume workspaceVolume = podTemplate.getWorkspaceVolume();\n+        assertNotNull(workspaceVolume);\n+        assertThat(workspaceVolume, isA(DynamicPVCWorkspaceVolume.class));\n+        DynamicPVCWorkspaceVolume dynamicPVCVolume = (DynamicPVCWorkspaceVolume) workspaceVolume;\n+        assertEquals(\"ReadWriteOnce\", dynamicPVCVolume.getAccessModes());", "originalCommit": "07561d6e0a616d444260ecc6fe0a332d36983575", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTU0MTU1MA==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/758#discussion_r409541550", "bodyText": "Ugly. We cannot convert to type Integer?", "author": "jglick", "createdAt": "2020-04-16T13:08:44Z", "path": "src/test/resources/org/csanchez/jenkins/plugins/kubernetes/casc/casc_envVar_keyValue.yaml", "diffHunk": "@@ -0,0 +1,12 @@\n+jenkins:\n+  clouds:\n+    - kubernetes:\n+        containerCapStr: \"10\"", "originalCommit": "07561d6e0a616d444260ecc6fe0a332d36983575", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "37b9e97ef211c216675f429224935397f8fa8013", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/37b9e97ef211c216675f429224935397f8fa8013", "message": "use version from bom", "committedDate": "2020-04-16T13:18:53Z", "type": "commit"}, {"oid": "9fff7a7feb18a3f6ced58dca03922f7fb006f257", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/9fff7a7feb18a3f6ced58dca03922f7fb006f257", "message": "Clean up and accept int variants for fields using strings", "committedDate": "2020-04-16T13:33:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTY1NjM1Ng==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/758#discussion_r409656356", "bodyText": "They're up to 1.39 now.", "author": "kerogers-cloudbees", "createdAt": "2020-04-16T15:39:38Z", "path": "pom.xml", "diffHunk": "@@ -53,6 +53,7 @@\n     <pipeline-model-definition.version>1.6.0</pipeline-model-definition.version>\n     <slf4jVersion>1.7.26</slf4jVersion>\n     <useBeta>true</useBeta>\n+    <configuration-as-code.version>1.36</configuration-as-code.version>", "originalCommit": "07561d6e0a616d444260ecc6fe0a332d36983575", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTY1ODI5Mg==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/758#discussion_r409658292", "bodyText": "I'll just pick up whatever is in BOM, I don't think we need anything particular that is in 1.39", "author": "Vlatombe", "createdAt": "2020-04-16T15:42:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTY1NjM1Ng=="}], "type": "inlineReview"}]}