{"pr_number": 309, "pr_title": "Add AppId and OrgId as secrets and write them to CloudSQL.", "pr_createdAt": "2020-05-01T21:05:56Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/309", "timeline": [{"oid": "752026ef937ddb0ac85e39d209850e5f20c0f358", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/752026ef937ddb0ac85e39d209850e5f20c0f358", "message": "Add AppId and OrgId as secrets.", "committedDate": "2020-05-01T21:04:22Z", "type": "commit"}, {"oid": "178034716807f14e1ce4b44dc27926f24a44094a", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/178034716807f14e1ce4b44dc27926f24a44094a", "message": "Script to copy AppId and OrgId to SQL.", "committedDate": "2020-05-01T21:05:11Z", "type": "commit"}, {"oid": "fd4aa23f91519f41e2b00a7b3036f06b1cb27b57", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/fd4aa23f91519f41e2b00a7b3036f06b1cb27b57", "message": "Merge branch 'early-access' into app-org-info", "committedDate": "2020-05-01T21:06:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ3MTM1Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/309#discussion_r419471352", "bodyText": "could we get these values from env-variables? or generate them using a prefix that gets passed to the script?", "author": "zohrehj", "createdAt": "2020-05-04T14:18:32Z", "path": "Terraform/copy_mobile_app_info_to_sql.sh", "diffHunk": "@@ -0,0 +1,30 @@\n+#!/bin/bash\n+# Script to copy AppId and OrgId from gcloud secret to CloudSQL.\n+set -e\n+\n+SECRET_PROJECT=heroes-hat-dev-devops\n+DATA_PROJECT=heroes-hat-dev-data\n+SQL_IMPORT_BUCKET=heroes-hat-dev-data-sql-import\n+TMPFILE=$(mktemp)", "originalCommit": "fd4aa23f91519f41e2b00a7b3036f06b1cb27b57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDUzMTM3OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/309#discussion_r420531379", "bodyText": "It would be hard. Added a TODO for now.", "author": "kuoyuchi", "createdAt": "2020-05-06T03:53:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ3MTM1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk5OTA1Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/309#discussion_r420999053", "bodyText": "sgtm", "author": "zohrehj", "createdAt": "2020-05-06T18:21:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ3MTM1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ4MDY0MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/309#discussion_r419480640", "bodyText": "should DummyOrgName be set in a variable on top so that it can be easily changed later?", "author": "zohrehj", "createdAt": "2020-05-04T14:30:55Z", "path": "Terraform/copy_mobile_app_info_to_sql.sh", "diffHunk": "@@ -0,0 +1,30 @@\n+#!/bin/bash\n+# Script to copy AppId and OrgId from gcloud secret to CloudSQL.\n+set -e\n+\n+SECRET_PROJECT=heroes-hat-dev-devops\n+DATA_PROJECT=heroes-hat-dev-data\n+SQL_IMPORT_BUCKET=heroes-hat-dev-data-sql-import\n+TMPFILE=$(mktemp)\n+\n+# Write user registration server db name to TMPFILE.\n+echo \"USE \\`mystudies_userregistration\\`;\" >> ${TMPFILE}\n+\n+# Read AppId and OrgId from secrets..\n+APP_ID=`gcloud --project=${SECRET_PROJECT} secrets versions access latest --secret=mobile-app-appid`\n+ORG_ID=`gcloud --project=${SECRET_PROJECT} secrets versions access latest --secret=mobile-app-orgid`\n+\n+# Write corresponding SQL commands to TMPFILE.\n+echo \"INSERT INTO org_info (id, name, org_id) VALUES(1, \\\"DummyOrgName\\\", \\\"${ORG_ID}\\\");\" >> ${TMPFILE}", "originalCommit": "fd4aa23f91519f41e2b00a7b3036f06b1cb27b57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ4MDg2MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/309#discussion_r419480861", "bodyText": "or taken from secrets as well?", "author": "zohrehj", "createdAt": "2020-05-04T14:31:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ4MDY0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDUzMTIzMA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/309#discussion_r420531230", "bodyText": "Done. Changed to a var in this shell script.", "author": "kuoyuchi", "createdAt": "2020-05-06T03:52:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ4MDY0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ4MTQzNA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/309#discussion_r419481434", "bodyText": "how come org and app_info both get id=1, but you are setting id=2 for location. Is there another location that's set before this one?", "author": "zohrehj", "createdAt": "2020-05-04T14:32:00Z", "path": "Terraform/copy_mobile_app_info_to_sql.sh", "diffHunk": "@@ -0,0 +1,30 @@\n+#!/bin/bash\n+# Script to copy AppId and OrgId from gcloud secret to CloudSQL.\n+set -e\n+\n+SECRET_PROJECT=heroes-hat-dev-devops\n+DATA_PROJECT=heroes-hat-dev-data\n+SQL_IMPORT_BUCKET=heroes-hat-dev-data-sql-import\n+TMPFILE=$(mktemp)\n+\n+# Write user registration server db name to TMPFILE.\n+echo \"USE \\`mystudies_userregistration\\`;\" >> ${TMPFILE}\n+\n+# Read AppId and OrgId from secrets..\n+APP_ID=`gcloud --project=${SECRET_PROJECT} secrets versions access latest --secret=mobile-app-appid`\n+ORG_ID=`gcloud --project=${SECRET_PROJECT} secrets versions access latest --secret=mobile-app-orgid`\n+\n+# Write corresponding SQL commands to TMPFILE.\n+echo \"INSERT INTO org_info (id, name, org_id) VALUES(1, \\\"DummyOrgName\\\", \\\"${ORG_ID}\\\");\" >> ${TMPFILE}\n+echo \"INSERT INTO app_info (app_info_id, custom_app_id, org_info_id) VALUES(1, \\\"${APP_ID}\\\", 1);\" >> ${TMPFILE}\n+echo \"INSERT INTO locations (id, is_default) VALUES(2, \\\"Y\\\");\" >> ${TMPFILE}", "originalCommit": "fd4aa23f91519f41e2b00a7b3036f06b1cb27b57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDUzMTM0NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/309#discussion_r420531345", "bodyText": "Change to 1.", "author": "kuoyuchi", "createdAt": "2020-05-06T03:53:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ4MTQzNA=="}], "type": "inlineReview"}, {"oid": "5e90de970d735902d208a2c11d2928bfdeae08a2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5e90de970d735902d208a2c11d2928bfdeae08a2", "message": "Merge branch 'early-access' into app-org-info", "committedDate": "2020-05-05T16:45:00Z", "type": "commit"}, {"oid": "fa175f9fb6eb2dc5a1f3135f6349fd7bd67e3510", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/fa175f9fb6eb2dc5a1f3135f6349fd7bd67e3510", "message": "Merge branch 'early-access' into app-org-info", "committedDate": "2020-05-05T16:47:56Z", "type": "commit"}, {"oid": "5e40da3bc334e5c8984526e7a741ce9b394afa66", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5e40da3bc334e5c8984526e7a741ce9b394afa66", "message": "Add TODO.", "committedDate": "2020-05-06T03:53:33Z", "type": "commit"}, {"oid": "f04cd0ab80a5779d390d0ff7110fa43735787070", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f04cd0ab80a5779d390d0ff7110fa43735787070", "message": "Merge branch 'app-org-info' of https://github.com/GoogleCloudPlatform/fda-mystudies into app-org-info", "committedDate": "2020-05-06T03:54:03Z", "type": "commit"}, {"oid": "a9265316e3aedc14554cf26405c8194dc16220b6", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a9265316e3aedc14554cf26405c8194dc16220b6", "message": "Merge branch 'early-access' into app-org-info", "committedDate": "2020-05-06T03:54:24Z", "type": "commit"}, {"oid": "8cae3b407f9055b13a9dfa71ac562f5c1db01a47", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8cae3b407f9055b13a9dfa71ac562f5c1db01a47", "message": "Merge branch 'early-access' into app-org-info", "committedDate": "2020-05-06T18:22:00Z", "type": "commit"}, {"oid": "1be1a78d74ed9c63c2ccde40edad5425b4ea70a3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1be1a78d74ed9c63c2ccde40edad5425b4ea70a3", "message": "Merge branch 'early-access' into app-org-info", "committedDate": "2020-05-06T22:20:54Z", "type": "commit"}, {"oid": "9605473f773c61b1f9a81c29fef12124c9a86568", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/9605473f773c61b1f9a81c29fef12124c9a86568", "message": "Merge branch 'early-access' into app-org-info", "committedDate": "2020-05-07T19:45:39Z", "type": "commit"}, {"oid": "3697d848d0ad270a0af93e9986e186fad23fc64b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3697d848d0ad270a0af93e9986e186fad23fc64b", "message": "Merge branch 'early-access' into app-org-info", "committedDate": "2020-05-07T19:59:49Z", "type": "commit"}]}