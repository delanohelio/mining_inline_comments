{"pr_number": 1116, "pr_title": "Database schema dumps for Participant Datastore/Participant Manager,OAuth-SCIM-Service and Response Server", "pr_createdAt": "2020-10-05T12:26:39Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1116", "timeline": [{"oid": "9a85d35010aece41e0d47c1f342c6982f531c24e", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/9a85d35010aece41e0d47c1f342c6982f531c24e", "message": "database dump for all the modules\n\ndatabase dump for all the modules", "committedDate": "2020-10-05T12:21:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY1Mjk3MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1116#discussion_r499652971", "bodyText": "Please move the insert commands out of the schema dumps and into a separate file, we can then look into recreating the insert with a bash script, similar to what we had for client_id/client_secret insertions.", "author": "zohrehj", "createdAt": "2020-10-05T14:44:27Z", "path": "user-registration-server-ws/sqlscript/mystudies_participant_datastore_db_script.sql", "diffHunk": "@@ -389,21 +408,26 @@ CREATE TABLE IF NOT EXISTS `user_details` (\n   KEY `user_details_last_name_idx` (`last_name`),\n   KEY `FKo905twpc0drywmf4x5e0io0cn` (`app_info_id`),\n   CONSTRAINT `FKo905twpc0drywmf4x5e0io0cn` FOREIGN KEY (`app_info_id`) REFERENCES `app_info` (`id`)\n-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;\n+) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n \n -- Data exporting was unselected.\n \n--- Dumping structure for table demo_db.user_institution\n+-- Dumping structure for table mystudies_participant_datastore.user_institution\n+DROP TABLE IF EXISTS `user_institution`;\n CREATE TABLE IF NOT EXISTS `user_institution` (\n   `id` varchar(255) NOT NULL,\n   `institution_id` varchar(128) DEFAULT NULL,\n   `user_details_id` varchar(255) NOT NULL,\n   PRIMARY KEY (`id`),\n   KEY `FKrwwx4csj1ske5o4m74lmusqbv` (`user_details_id`),\n   CONSTRAINT `FKrwwx4csj1ske5o4m74lmusqbv` FOREIGN KEY (`user_details_id`) REFERENCES `user_details` (`id`) ON DELETE CASCADE\n-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;\n+) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n \n--- Data exporting was unselected.\n+INSERT INTO `locations` (`id`, `created_time`, `created_by`, `custom_id`, `description`, `is_default`, `updated_time`, `modified_by`, `name`, `status`) VALUES\n+\t('1', '2020-10-05 19:45:08', '1', 'location1', 'location1', 'Y', '2020-09-25 19:45:24', '1', 'Location', 1);\n+\n+INSERT INTO `ur_admin_user` (`id`, `created_time`, `created_by`, `email`, `email_changed`, `first_name`, `last_name`, `location_permission`, `phone_number`, `security_code`, `security_code_expire_date`, `status`, `super_admin`, `ur_admin_auth_id`) VALUES\n+('c9d30d67-0477-4a8c-8490-0fa1e0300bd0', '2020-10-05 19:50:15', '1', 'superadmin@gmail.com', b'0', 'Super', 'Admin', 1, '9876543210', 'af92f34e0ae6fc3c707446797b7db5b4be78ec699899061a448f8bc18990d75f', '2022-09-25 20:06:43', 1, b'1', '96494ebc2ae5ac344437ec19bfc0b09267a876015b277e1f6e9bfc871f578508');", "originalCommit": "9a85d35010aece41e0d47c1f342c6982f531c24e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTcxNTI5NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1116#discussion_r499715294", "bodyText": "moved out insert script into a separate sql file [mystudies_superadmin_db_script.sql]", "author": "aswinijena100", "createdAt": "2020-10-05T16:13:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY1Mjk3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY1MzY3OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1116#discussion_r499653679", "bodyText": "please move out of the main schema dump and into a separate sql file, e.g. superadmin.sql", "author": "zohrehj", "createdAt": "2020-10-05T14:45:24Z", "path": "oauth-scim-module/sqlscript/mystudies_oauth_server_hydra_db_script.sql", "diffHunk": "@@ -0,0 +1,52 @@\n+-- --------------------------------------------------------\n+-- Host:                         35.196.150.7\n+-- Server version:               5.7.25-google - (Google)\n+-- Server OS:                    Linux\n+-- HeidiSQL Version:             11.0.0.5919\n+-- --------------------------------------------------------\n+\n+/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;\n+/*!40101 SET NAMES utf8 */;\n+/*!50503 SET NAMES utf8mb4 */;\n+/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;\n+/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;\n+\n+\n+-- Dumping database structure for oauth_server_hydra\n+DROP DATABASE IF EXISTS `oauth_server_hydra`;\n+CREATE DATABASE IF NOT EXISTS `oauth_server_hydra` /*!40100 DEFAULT CHARACTER SET utf8 */;\n+USE `oauth_server_hydra`;\n+\n+-- Dumping structure for table oauth_server_hydra.users\n+DROP TABLE IF EXISTS `users`;\n+CREATE TABLE IF NOT EXISTS `users` (\n+  `id` varchar(255) NOT NULL,\n+  `app_id` varchar(100) NOT NULL,\n+  `created` timestamp NULL DEFAULT CURRENT_TIMESTAMP,\n+  `email` varchar(320) NOT NULL,\n+  `status` int(11) NOT NULL,\n+  `temp_reg_id` varchar(64) DEFAULT NULL,\n+  `user_id` varchar(64) DEFAULT NULL,\n+  `user_info` json NOT NULL,\n+  PRIMARY KEY (`id`),\n+  UNIQUE KEY `user_id_index` (`user_id`),\n+  UNIQUE KEY `temp_reg_id_index` (`temp_reg_id`),\n+  KEY `users_app_id_email_idx` (`app_id`,`email`)\n+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n+\n+/*\n+-- Query: SELECT * FROM oauth_scim_db.users\n+LIMIT 0, 1000\n+\n+-- Date: 2020-10-05 15:18\n+\n+\t\"email\":\"superadmin@gmail.com\",\n+\t\"password\":\"Ch@ngeM3\",\n+\t\"appId\":\"PARTICIPANT MANAGER\",\n+\t\"status\":0\n+*/\n+INSERT INTO `users` (`id`,`app_id`,`created`,`email`,`status`,`temp_reg_id`,`user_id`,`user_info`) VALUES ('8ad16a8c74f823a10174f82c9a300001','PARTICIPANT MANAGER','2020-10-05 15:21:46','superadmin@gmail.com',0,'bd676334dd745c6afaa6547f9736a4c4df411a3ca2c4f514070daae31008cd9d','96494ebc2ae5ac344437ec19bfc0b09267a876015b277e1f6e9bfc871f578508','{\\\"password\\\": {\\\"hash\\\": \\\"9bb85ab372ccd4b69b78477a89ddd8437d26e0fe10d2618e1edf48cddf56f1d2fcf9de71a39cdae01493c69e2bbc1b3ff890eda31ee2f4c00967e17f8fe03556\\\", \\\"salt\\\": \\\"1e73c28e50e41f2d2175ba3ba3349395ebe80c42f837ffaaa06a7adf170bd3238fbda39cb6357b8410aeafcd8647619abfd2657900bd26011c7775504760c968\\\", \\\"expire_timestamp\\\": 1609667506735}, \\\"password_history\\\": [{\\\"hash\\\": \\\"9bb85ab372ccd4b69b78477a89ddd8437d26e0fe10d2618e1edf48cddf56f1d2fcf9de71a39cdae01493c69e2bbc1b3ff890eda31ee2f4c00967e17f8fe03556\\\", \\\"salt\\\": \\\"1e73c28e50e41f2d2175ba3ba3349395ebe80c42f837ffaaa06a7adf170bd3238fbda39cb6357b8410aeafcd8647619abfd2657900bd26011c7775504760c968\\\", \\\"expire_timestamp\\\": 1609667506735}]}');", "originalCommit": "9a85d35010aece41e0d47c1f342c6982f531c24e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTcxNTMyNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1116#discussion_r499715326", "bodyText": "moved out insert script into a separate sql file [mystudies_superadmin_db_script.sql]", "author": "aswinijena100", "createdAt": "2020-10-05T16:13:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY1MzY3OQ=="}], "type": "inlineReview"}, {"oid": "11589619e9d0b03693fa19129761fd29c2327a5d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/11589619e9d0b03693fa19129761fd29c2327a5d", "message": "Merge branch 'develop' into develop-databse-dump-for-services", "committedDate": "2020-10-05T15:07:03Z", "type": "commit"}, {"oid": "2b44dd9973b31aa4d594001f374ae993ca227615", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/2b44dd9973b31aa4d594001f374ae993ca227615", "message": "moved out insert script from the main schema db script\n\nmoved out insert script from the main schema db script", "committedDate": "2020-10-05T16:12:30Z", "type": "commit"}, {"oid": "52915b0819a564ac6eaa20dc9041a999c9b5a4d2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/52915b0819a564ac6eaa20dc9041a999c9b5a4d2", "message": "Merge branch 'develop' into develop-databse-dump-for-services", "committedDate": "2020-10-06T05:25:04Z", "type": "commit"}]}