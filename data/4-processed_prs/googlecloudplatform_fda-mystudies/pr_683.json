{"pr_number": 683, "pr_title": "mock oauth service has been implemented", "pr_createdAt": "2020-07-27T14:58:35Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683", "timeline": [{"oid": "bc5aa765e4c38a134a92172ceca027eaee80e52b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/bc5aa765e4c38a134a92172ceca027eaee80e52b", "message": "mock auth service has been implemented", "committedDate": "2020-07-27T14:54:34Z", "type": "commit"}, {"oid": "ac80ea914fda97db82778d864f6e4df2302c13cc", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ac80ea914fda97db82778d864f6e4df2302c13cc", "message": "test cases issue has been fixed", "committedDate": "2020-07-27T15:35:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE1NzcyMQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461157721", "bodyText": "unnecessary call to super()", "author": "nikklassen", "createdAt": "2020-07-27T20:42:58Z", "path": "UR-web-app/src/app/service/auth.service.ts", "diffHunk": "@@ -0,0 +1,74 @@\n+import {Injectable} from '@angular/core';\n+import {HttpClient} from '@angular/common/http';\n+import {CookieService} from 'ngx-cookie-service';\n+import {User} from '../entity/user';\n+import {EntityService} from './entity.service';\n+import {Router} from '@angular/router';\n+import {AccessToken} from '../entity/AccessToken';\n+import {environment} from 'src/environments/environment';\n+import {ProfileService} from './profile.service';\n+import {UnsubscribeOnDestroyAdapter} from '../unsubscribe-on-destroy-adapter';\n+\n+@Injectable({providedIn: 'root'})\n+export class AuthService extends UnsubscribeOnDestroyAdapter {\n+  constructor(\n+    private readonly http: HttpClient,\n+    public cookieService: CookieService,\n+    public entityService: EntityService<AccessToken>,\n+    public router: Router,\n+    private readonly profilService: ProfileService,\n+  ) {\n+    super();", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA1MDA0NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463050045", "bodyText": "Updated.", "author": "firdosebtc1", "createdAt": "2020-07-30T14:44:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE1NzcyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE1NzkxOQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461157919", "bodyText": "hasCredentials?", "author": "nikklassen", "createdAt": "2020-07-27T20:43:22Z", "path": "UR-web-app/src/app/service/auth.service.ts", "diffHunk": "@@ -0,0 +1,74 @@\n+import {Injectable} from '@angular/core';\n+import {HttpClient} from '@angular/common/http';\n+import {CookieService} from 'ngx-cookie-service';\n+import {User} from '../entity/user';\n+import {EntityService} from './entity.service';\n+import {Router} from '@angular/router';\n+import {AccessToken} from '../entity/AccessToken';\n+import {environment} from 'src/environments/environment';\n+import {ProfileService} from './profile.service';\n+import {UnsubscribeOnDestroyAdapter} from '../unsubscribe-on-destroy-adapter';\n+\n+@Injectable({providedIn: 'root'})\n+export class AuthService extends UnsubscribeOnDestroyAdapter {\n+  constructor(\n+    private readonly http: HttpClient,\n+    public cookieService: CookieService,\n+    public entityService: EntityService<AccessToken>,\n+    public router: Router,\n+    private readonly profilService: ProfileService,\n+  ) {\n+    super();\n+  }\n+  checkCredentials(): boolean {", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA1MDEwMA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463050100", "bodyText": "Updated.", "author": "firdosebtc1", "createdAt": "2020-07-30T14:45:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE1NzkxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE1ODM1MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461158350", "bodyText": "what are these parameters? Should they be in environment?", "author": "nikklassen", "createdAt": "2020-07-27T20:44:12Z", "path": "UR-web-app/src/app/service/auth.service.ts", "diffHunk": "@@ -0,0 +1,74 @@\n+import {Injectable} from '@angular/core';\n+import {HttpClient} from '@angular/common/http';\n+import {CookieService} from 'ngx-cookie-service';\n+import {User} from '../entity/user';\n+import {EntityService} from './entity.service';\n+import {Router} from '@angular/router';\n+import {AccessToken} from '../entity/AccessToken';\n+import {environment} from 'src/environments/environment';\n+import {ProfileService} from './profile.service';\n+import {UnsubscribeOnDestroyAdapter} from '../unsubscribe-on-destroy-adapter';\n+\n+@Injectable({providedIn: 'root'})\n+export class AuthService extends UnsubscribeOnDestroyAdapter {\n+  constructor(\n+    private readonly http: HttpClient,\n+    public cookieService: CookieService,\n+    public entityService: EntityService<AccessToken>,\n+    public router: Router,\n+    private readonly profilService: ProfileService,\n+  ) {\n+    super();\n+  }\n+  checkCredentials(): boolean {\n+    return (\n+      this.cookieService.check('accessToken') &&\n+      this.cookieService.check('user')\n+    );\n+  }\n+  getLoggedInUserDetails(): User | null {\n+    if (this.cookieService.check('user')) {\n+      return JSON.parse(this.cookieService.get('user')) as User;\n+    }\n+    return null;\n+  }\n+  getLoggedInUserAccessToken(): string {\n+    return this.cookieService.get('accessToken');\n+  }\n+\n+  redirectToLoginPage(): void {\n+    void this.router.navigate(['/callback'], {\n+      queryParams: {\n+        code: 'l4hQQM-guBDwbpo76dHJs-8.ufR0YLll0menniGz5A-YN95DfCFOKg',", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA3MjU3MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463072570", "bodyText": "Here I'm just hard coding query param which I will receiving in call back url from oauth server", "author": "firdosebtc1", "createdAt": "2020-07-30T15:16:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE1ODM1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzIzNzU4OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463237589", "bodyText": "Don't these tokens expire? Can we use the proxy config I suggested to circumvent auth instead of hardcoding in tokens?", "author": "nikklassen", "createdAt": "2020-07-30T19:58:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE1ODM1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ5NTM0Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463495346", "bodyText": "This values will be removed when we integrate with hydra oauth server and this mock oauth service is created only for temporary solution till that time as per your previous PR comments where we were hard coding in the headers.We will be integrating the oauth server once this already developed and tested angular components are pushed to Github PRs", "author": "firdosebtc1", "createdAt": "2020-07-31T09:07:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE1ODM1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzYyNDMxMQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463624311", "bodyText": "My previous comments were about finding a way to add the headers so the requests would work, but hard coding data is not the best way to accomplish this. If you're not going to change this here I can only suggest that in the future you try to order your development so that you don't end up needing to do things like this, i.e. write the full auth solution first, or use proxies like I discussed.", "author": "nikklassen", "createdAt": "2020-07-31T13:52:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE1ODM1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE1OTkyNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461159925", "bodyText": "You don't need a canActivate guard here, the usual way to do this is to just redirect the user from this component if they are already logged in", "author": "nikklassen", "createdAt": "2020-07-27T20:47:14Z", "path": "UR-web-app/src/app/app-routing.module.ts", "diffHunk": "@@ -5,16 +5,21 @@ import {SetUpAccountComponent} from './auth/set-up-account/set-up-account.compon\n import {ForgotPasswordComponent} from './auth/forgot-password/forgot-password.component';\n import {PageNotFoundComponent} from './page-not-found/page-not-found.component';\n import {SiteCoordinatorModule} from './site-coordinator/site-coordinator.module';\n+import {CallbackComponent} from './auth/callback/callback.component';\n+import {AuthGuard} from './service/auth.guard';\n+import {LoginGuard} from './service/login.guard';\n const routes: Routes = [\n-  {path: 'login', component: LoginComponent},\n+  {path: 'login', component: LoginComponent, canActivate: [LoginGuard]},", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA3MDQ3MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463070470", "bodyText": "Updated.", "author": "firdosebtc1", "createdAt": "2020-07-30T15:13:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE1OTkyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE2NTM2Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461165367", "bodyText": "Can you name this something more specific than \"Callback\"", "author": "nikklassen", "createdAt": "2020-07-27T20:57:35Z", "path": "UR-web-app/src/app/app-routing.module.ts", "diffHunk": "@@ -5,16 +5,21 @@ import {SetUpAccountComponent} from './auth/set-up-account/set-up-account.compon\n import {ForgotPasswordComponent} from './auth/forgot-password/forgot-password.component';\n import {PageNotFoundComponent} from './page-not-found/page-not-found.component';\n import {SiteCoordinatorModule} from './site-coordinator/site-coordinator.module';\n+import {CallbackComponent} from './auth/callback/callback.component';\n+import {AuthGuard} from './service/auth.guard';\n+import {LoginGuard} from './service/login.guard';\n const routes: Routes = [\n-  {path: 'login', component: LoginComponent},\n+  {path: 'login', component: LoginComponent, canActivate: [LoginGuard]},\n   {path: 'forgot-password', component: ForgotPasswordComponent},\n   {path: 'set-up-account', component: SetUpAccountComponent},\n+  {path: 'callback', component: CallbackComponent},", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA3MDI5MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463070291", "bodyText": "Updated.", "author": "firdosebtc1", "createdAt": "2020-07-30T15:12:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE2NTM2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE2Nzc1OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461167759", "bodyText": "I don't really want hacks in the application to support development. I would rather we use https://webpack.js.org/configuration/dev-server/#devserverproxy to do this. You can set the auth server to point at the proxy, and return these hardcoded responses in development", "author": "nikklassen", "createdAt": "2020-07-27T21:02:05Z", "path": "UR-web-app/src/app/http-interceptors/auth.interceptor.ts", "diffHunk": "@@ -6,36 +6,53 @@ import {\n   HttpRequest,\n   HttpEvent,\n   HttpErrorResponse,\n+  HttpResponse,\n } from '@angular/common/http';\n import {finalize} from 'rxjs/operators';\n import {User} from '../entity/user';\n-import {Observable, OperatorFunction, throwError} from 'rxjs';\n+import {Observable, OperatorFunction, throwError, of} from 'rxjs';\n import {catchError} from 'rxjs/operators';\n import {ToastrService} from 'ngx-toastr';\n+import {AuthService} from '../service/auth.service';\n+import accessToken from 'src/app/auth/access-token.json';\n+import {AccessToken} from '../entity/AccessToken';\n+import account from 'src/app/auth/account.json';\n import {ErrorCodesEnum, getMessage} from '../shared/error.codes.enum';\n import {ApiResponse} from '../entity/api.response.model';\n+import {environment} from 'src/environments/environment';\n \n @Injectable()\n export class AuthInterceptor implements HttpInterceptor {\n   constructor(\n     private readonly spinner: NgxSpinnerService,\n     private readonly toasterService: ToastrService,\n+    private readonly authService: AuthService,\n   ) {}\n \n-  getUserDetails(): User | null {\n-    const currentUser = localStorage.getItem('currentUser');\n-    if (currentUser === null) {\n-      return null;\n-    }\n-    return JSON.parse(currentUser) as User;\n-  }\n   intercept(\n     req: HttpRequest<unknown>,\n     next: HttpHandler,\n   ): Observable<HttpEvent<unknown>> {\n+    if (req.url === `${environment.authServerUrl}/oauth2/token`) {", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ5NDgwNA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463494804", "bodyText": "This code will be removed when we integrate with hydra oauth server and this mock oauth service is created only for temporary solution till that time as per your previous PR comments where we were hard coding in the headers.We will be integrating the oauth server once this already developed and tested angular components are pushed to Github PRs", "author": "firdosebtc1", "createdAt": "2020-07-31T09:06:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE2Nzc1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE2ODE3MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461168171", "bodyText": "Why do you need !this.authService.checkCredentials()? Isn't user === null sufficient?", "author": "nikklassen", "createdAt": "2020-07-27T21:02:56Z", "path": "UR-web-app/src/app/http-interceptors/auth.interceptor.ts", "diffHunk": "@@ -6,36 +6,53 @@ import {\n   HttpRequest,\n   HttpEvent,\n   HttpErrorResponse,\n+  HttpResponse,\n } from '@angular/common/http';\n import {finalize} from 'rxjs/operators';\n import {User} from '../entity/user';\n-import {Observable, OperatorFunction, throwError} from 'rxjs';\n+import {Observable, OperatorFunction, throwError, of} from 'rxjs';\n import {catchError} from 'rxjs/operators';\n import {ToastrService} from 'ngx-toastr';\n+import {AuthService} from '../service/auth.service';\n+import accessToken from 'src/app/auth/access-token.json';\n+import {AccessToken} from '../entity/AccessToken';\n+import account from 'src/app/auth/account.json';\n import {ErrorCodesEnum, getMessage} from '../shared/error.codes.enum';\n import {ApiResponse} from '../entity/api.response.model';\n+import {environment} from 'src/environments/environment';\n \n @Injectable()\n export class AuthInterceptor implements HttpInterceptor {\n   constructor(\n     private readonly spinner: NgxSpinnerService,\n     private readonly toasterService: ToastrService,\n+    private readonly authService: AuthService,\n   ) {}\n \n-  getUserDetails(): User | null {\n-    const currentUser = localStorage.getItem('currentUser');\n-    if (currentUser === null) {\n-      return null;\n-    }\n-    return JSON.parse(currentUser) as User;\n-  }\n   intercept(\n     req: HttpRequest<unknown>,\n     next: HttpHandler,\n   ): Observable<HttpEvent<unknown>> {\n+    if (req.url === `${environment.authServerUrl}/oauth2/token`) {\n+      return of(\n+        new HttpResponse({\n+          status: 200,\n+          body: accessToken as AccessToken,\n+        }),\n+      );\n+    }\n+    if (req.url === `${environment.baseUrl}/users`) {\n+      return of(\n+        new HttpResponse({\n+          status: 200,\n+          body: account as User,\n+        }),\n+      );\n+    }\n     void this.spinner.show();\n-    const user = this.getUserDetails();\n-    if (user === null) {\n+    const user = this.authService.getLoggedInUserDetails();\n+\n+    if (user === null || !this.authService.checkCredentials()) {", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA3MjkyMA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463072920", "bodyText": "Updated this auth service method", "author": "firdosebtc1", "createdAt": "2020-07-30T15:16:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE2ODE3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE2ODczOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461168738", "bodyText": "Please be more consistent in how you name files. The angular style is to use lowercase and dashes, like access-token.ts", "author": "nikklassen", "createdAt": "2020-07-27T21:04:02Z", "path": "UR-web-app/src/app/entity/AccessToken.ts", "diffHunk": "@@ -0,0 +1,8 @@\n+export interface AccessToken {", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE2OTQzNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461169435", "bodyText": "You don't need to unsubscribe from an HTTP request", "author": "nikklassen", "createdAt": "2020-07-27T21:05:17Z", "path": "UR-web-app/src/app/service/auth.service.ts", "diffHunk": "@@ -0,0 +1,74 @@\n+import {Injectable} from '@angular/core';\n+import {HttpClient} from '@angular/common/http';\n+import {CookieService} from 'ngx-cookie-service';\n+import {User} from '../entity/user';\n+import {EntityService} from './entity.service';\n+import {Router} from '@angular/router';\n+import {AccessToken} from '../entity/AccessToken';\n+import {environment} from 'src/environments/environment';\n+import {ProfileService} from './profile.service';\n+import {UnsubscribeOnDestroyAdapter} from '../unsubscribe-on-destroy-adapter';\n+\n+@Injectable({providedIn: 'root'})\n+export class AuthService extends UnsubscribeOnDestroyAdapter {\n+  constructor(\n+    private readonly http: HttpClient,\n+    public cookieService: CookieService,\n+    public entityService: EntityService<AccessToken>,\n+    public router: Router,\n+    private readonly profilService: ProfileService,\n+  ) {\n+    super();\n+  }\n+  checkCredentials(): boolean {\n+    return (\n+      this.cookieService.check('accessToken') &&\n+      this.cookieService.check('user')\n+    );\n+  }\n+  getLoggedInUserDetails(): User | null {\n+    if (this.cookieService.check('user')) {\n+      return JSON.parse(this.cookieService.get('user')) as User;\n+    }\n+    return null;\n+  }\n+  getLoggedInUserAccessToken(): string {\n+    return this.cookieService.get('accessToken');\n+  }\n+\n+  redirectToLoginPage(): void {\n+    void this.router.navigate(['/callback'], {\n+      queryParams: {\n+        code: 'l4hQQM-guBDwbpo76dHJs-8.ufR0YLll0menniGz5A-YN95DfCFOKg',\n+        userId:\n+          'b45bc4f67fd77ebb6db9a94f8abd9a0470b07f4098f7934234f12a5bee975231',\n+      },\n+    });\n+  }\n+  getToken(code: string, userId: string): void {\n+    const payload = {\n+      grant_type: 'authorization_code',\n+      scope: 'openid',\n+      redirect_uri: environment.redirectUrl,\n+      code: code,\n+      userId: userId,\n+    };\n+    this.subs.add(", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE2OTk3Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461169977", "bodyText": "This method POSTs to a server, isn't not a get. Please rename.", "author": "nikklassen", "createdAt": "2020-07-27T21:06:18Z", "path": "UR-web-app/src/app/service/auth.service.ts", "diffHunk": "@@ -0,0 +1,74 @@\n+import {Injectable} from '@angular/core';\n+import {HttpClient} from '@angular/common/http';\n+import {CookieService} from 'ngx-cookie-service';\n+import {User} from '../entity/user';\n+import {EntityService} from './entity.service';\n+import {Router} from '@angular/router';\n+import {AccessToken} from '../entity/AccessToken';\n+import {environment} from 'src/environments/environment';\n+import {ProfileService} from './profile.service';\n+import {UnsubscribeOnDestroyAdapter} from '../unsubscribe-on-destroy-adapter';\n+\n+@Injectable({providedIn: 'root'})\n+export class AuthService extends UnsubscribeOnDestroyAdapter {\n+  constructor(\n+    private readonly http: HttpClient,\n+    public cookieService: CookieService,\n+    public entityService: EntityService<AccessToken>,\n+    public router: Router,\n+    private readonly profilService: ProfileService,\n+  ) {\n+    super();\n+  }\n+  checkCredentials(): boolean {\n+    return (\n+      this.cookieService.check('accessToken') &&\n+      this.cookieService.check('user')\n+    );\n+  }\n+  getLoggedInUserDetails(): User | null {\n+    if (this.cookieService.check('user')) {\n+      return JSON.parse(this.cookieService.get('user')) as User;\n+    }\n+    return null;\n+  }\n+  getLoggedInUserAccessToken(): string {\n+    return this.cookieService.get('accessToken');\n+  }\n+\n+  redirectToLoginPage(): void {\n+    void this.router.navigate(['/callback'], {\n+      queryParams: {\n+        code: 'l4hQQM-guBDwbpo76dHJs-8.ufR0YLll0menniGz5A-YN95DfCFOKg',\n+        userId:\n+          'b45bc4f67fd77ebb6db9a94f8abd9a0470b07f4098f7934234f12a5bee975231',\n+      },\n+    });\n+  }\n+  getToken(code: string, userId: string): void {", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MDE4Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461170182", "bodyText": "How do you know the user is logged in? This could be a stale access token", "author": "nikklassen", "createdAt": "2020-07-27T21:06:37Z", "path": "UR-web-app/src/app/service/auth.service.ts", "diffHunk": "@@ -0,0 +1,74 @@\n+import {Injectable} from '@angular/core';\n+import {HttpClient} from '@angular/common/http';\n+import {CookieService} from 'ngx-cookie-service';\n+import {User} from '../entity/user';\n+import {EntityService} from './entity.service';\n+import {Router} from '@angular/router';\n+import {AccessToken} from '../entity/AccessToken';\n+import {environment} from 'src/environments/environment';\n+import {ProfileService} from './profile.service';\n+import {UnsubscribeOnDestroyAdapter} from '../unsubscribe-on-destroy-adapter';\n+\n+@Injectable({providedIn: 'root'})\n+export class AuthService extends UnsubscribeOnDestroyAdapter {\n+  constructor(\n+    private readonly http: HttpClient,\n+    public cookieService: CookieService,\n+    public entityService: EntityService<AccessToken>,\n+    public router: Router,\n+    private readonly profilService: ProfileService,\n+  ) {\n+    super();\n+  }\n+  checkCredentials(): boolean {\n+    return (\n+      this.cookieService.check('accessToken') &&\n+      this.cookieService.check('user')\n+    );\n+  }\n+  getLoggedInUserDetails(): User | null {\n+    if (this.cookieService.check('user')) {\n+      return JSON.parse(this.cookieService.get('user')) as User;\n+    }\n+    return null;\n+  }\n+  getLoggedInUserAccessToken(): string {", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MDI3NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461170275", "bodyText": "Same as getLoggedInUserAccessToken", "author": "nikklassen", "createdAt": "2020-07-27T21:06:50Z", "path": "UR-web-app/src/app/service/auth.service.ts", "diffHunk": "@@ -0,0 +1,74 @@\n+import {Injectable} from '@angular/core';\n+import {HttpClient} from '@angular/common/http';\n+import {CookieService} from 'ngx-cookie-service';\n+import {User} from '../entity/user';\n+import {EntityService} from './entity.service';\n+import {Router} from '@angular/router';\n+import {AccessToken} from '../entity/AccessToken';\n+import {environment} from 'src/environments/environment';\n+import {ProfileService} from './profile.service';\n+import {UnsubscribeOnDestroyAdapter} from '../unsubscribe-on-destroy-adapter';\n+\n+@Injectable({providedIn: 'root'})\n+export class AuthService extends UnsubscribeOnDestroyAdapter {\n+  constructor(\n+    private readonly http: HttpClient,\n+    public cookieService: CookieService,\n+    public entityService: EntityService<AccessToken>,\n+    public router: Router,\n+    private readonly profilService: ProfileService,\n+  ) {\n+    super();\n+  }\n+  checkCredentials(): boolean {\n+    return (\n+      this.cookieService.check('accessToken') &&\n+      this.cookieService.check('user')\n+    );\n+  }\n+  getLoggedInUserDetails(): User | null {", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MDU2OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461170568", "bodyText": "Same as getToken, this is not just getting a profile.", "author": "nikklassen", "createdAt": "2020-07-27T21:07:27Z", "path": "UR-web-app/src/app/service/auth.service.ts", "diffHunk": "@@ -0,0 +1,74 @@\n+import {Injectable} from '@angular/core';\n+import {HttpClient} from '@angular/common/http';\n+import {CookieService} from 'ngx-cookie-service';\n+import {User} from '../entity/user';\n+import {EntityService} from './entity.service';\n+import {Router} from '@angular/router';\n+import {AccessToken} from '../entity/AccessToken';\n+import {environment} from 'src/environments/environment';\n+import {ProfileService} from './profile.service';\n+import {UnsubscribeOnDestroyAdapter} from '../unsubscribe-on-destroy-adapter';\n+\n+@Injectable({providedIn: 'root'})\n+export class AuthService extends UnsubscribeOnDestroyAdapter {\n+  constructor(\n+    private readonly http: HttpClient,\n+    public cookieService: CookieService,\n+    public entityService: EntityService<AccessToken>,\n+    public router: Router,\n+    private readonly profilService: ProfileService,\n+  ) {\n+    super();\n+  }\n+  checkCredentials(): boolean {\n+    return (\n+      this.cookieService.check('accessToken') &&\n+      this.cookieService.check('user')\n+    );\n+  }\n+  getLoggedInUserDetails(): User | null {\n+    if (this.cookieService.check('user')) {\n+      return JSON.parse(this.cookieService.get('user')) as User;\n+    }\n+    return null;\n+  }\n+  getLoggedInUserAccessToken(): string {\n+    return this.cookieService.get('accessToken');\n+  }\n+\n+  redirectToLoginPage(): void {\n+    void this.router.navigate(['/callback'], {\n+      queryParams: {\n+        code: 'l4hQQM-guBDwbpo76dHJs-8.ufR0YLll0menniGz5A-YN95DfCFOKg',\n+        userId:\n+          'b45bc4f67fd77ebb6db9a94f8abd9a0470b07f4098f7934234f12a5bee975231',\n+      },\n+    });\n+  }\n+  getToken(code: string, userId: string): void {\n+    const payload = {\n+      grant_type: 'authorization_code',\n+      scope: 'openid',\n+      redirect_uri: environment.redirectUrl,\n+      code: code,\n+      userId: userId,\n+    };\n+    this.subs.add(\n+      this.entityService\n+        .authServerPost(JSON.stringify(payload), 'oauth2/token')\n+        .subscribe((response) => {\n+          this.cookieService.set('accessToken', response.accessToken);\n+          this.cookieService.set('refreshToken', response.refreshToken);\n+          this.getProfile();\n+        }),\n+    );\n+  }\n+  getProfile(): void {", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MDcwOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461170708", "bodyText": "profileService", "author": "nikklassen", "createdAt": "2020-07-27T21:07:43Z", "path": "UR-web-app/src/app/service/auth.service.ts", "diffHunk": "@@ -0,0 +1,74 @@\n+import {Injectable} from '@angular/core';\n+import {HttpClient} from '@angular/common/http';\n+import {CookieService} from 'ngx-cookie-service';\n+import {User} from '../entity/user';\n+import {EntityService} from './entity.service';\n+import {Router} from '@angular/router';\n+import {AccessToken} from '../entity/AccessToken';\n+import {environment} from 'src/environments/environment';\n+import {ProfileService} from './profile.service';\n+import {UnsubscribeOnDestroyAdapter} from '../unsubscribe-on-destroy-adapter';\n+\n+@Injectable({providedIn: 'root'})\n+export class AuthService extends UnsubscribeOnDestroyAdapter {\n+  constructor(\n+    private readonly http: HttpClient,\n+    public cookieService: CookieService,\n+    public entityService: EntityService<AccessToken>,\n+    public router: Router,\n+    private readonly profilService: ProfileService,", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MDk2OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461170969", "bodyText": "UserService?", "author": "nikklassen", "createdAt": "2020-07-27T21:08:11Z", "path": "UR-web-app/src/app/service/profile.service.ts", "diffHunk": "@@ -0,0 +1,20 @@\n+import {Injectable} from '@angular/core';\n+import {HttpClient} from '@angular/common/http';\n+import {CookieService} from 'ngx-cookie-service';\n+import {User} from '../entity/user';\n+import {EntityService} from './entity.service';\n+import {Observable} from 'rxjs';\n+import {Router} from '@angular/router';\n+\n+@Injectable({providedIn: 'root'})\n+export class ProfileService {", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MTEyOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461171128", "bodyText": "Just use this.http directly", "author": "nikklassen", "createdAt": "2020-07-27T21:08:34Z", "path": "UR-web-app/src/app/service/profile.service.ts", "diffHunk": "@@ -0,0 +1,20 @@\n+import {Injectable} from '@angular/core';\n+import {HttpClient} from '@angular/common/http';\n+import {CookieService} from 'ngx-cookie-service';\n+import {User} from '../entity/user';\n+import {EntityService} from './entity.service';\n+import {Observable} from 'rxjs';\n+import {Router} from '@angular/router';\n+\n+@Injectable({providedIn: 'root'})\n+export class ProfileService {\n+  constructor(\n+    private readonly http: HttpClient,\n+    public cookieService: CookieService,\n+    public entityService: EntityService<User>,\n+    public router: Router,\n+  ) {}\n+  getProfile(): Observable<User> {\n+    return this.entityService.get('/users');", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MTIzMw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461171233", "bodyText": "cookieService and router are not used", "author": "nikklassen", "createdAt": "2020-07-27T21:08:48Z", "path": "UR-web-app/src/app/service/profile.service.ts", "diffHunk": "@@ -0,0 +1,20 @@\n+import {Injectable} from '@angular/core';\n+import {HttpClient} from '@angular/common/http';\n+import {CookieService} from 'ngx-cookie-service';\n+import {User} from '../entity/user';\n+import {EntityService} from './entity.service';\n+import {Observable} from 'rxjs';\n+import {Router} from '@angular/router';\n+\n+@Injectable({providedIn: 'root'})\n+export class ProfileService {\n+  constructor(\n+    private readonly http: HttpClient,\n+    public cookieService: CookieService,", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MTQ3MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461171471", "bodyText": "You shouldn't be checking routes here, only include this guard on relevant routes", "author": "nikklassen", "createdAt": "2020-07-27T21:09:18Z", "path": "UR-web-app/src/app/service/login.guard.ts", "diffHunk": "@@ -0,0 +1,20 @@\n+import {Injectable} from '@angular/core';\n+import {CanActivate, UrlTree, Router} from '@angular/router';\n+import {AuthService} from './auth.service';\n+\n+@Injectable({\n+  providedIn: 'root',\n+})\n+export class LoginGuard implements CanActivate {\n+  constructor(\n+    private readonly authService: AuthService,\n+    private readonly router: Router,\n+  ) {}\n+\n+  canActivate(): boolean | UrlTree {\n+    return (\n+      !this.authService.checkCredentials() ||\n+      this.router.parseUrl('/coordinator')", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MTczMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461171732", "bodyText": "This isn't generally useful, this code should be moved to the auth service", "author": "nikklassen", "createdAt": "2020-07-27T21:09:49Z", "path": "UR-web-app/src/app/service/entity.service.ts", "diffHunk": "@@ -30,4 +31,8 @@ export class EntityService<T> {\n     const serviceUrl = Location.joinWithSlash(this.baseUrl, urlpath);\n     return this.http.put<T>(serviceUrl, bodydata);\n   }\n+  authServerPost(bodydata: string, urlpath: string): Observable<T> {", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MTk5Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461171993", "bodyText": "Same as LoginGuard, you shouldn't be checking routes here, only include this guard on relevant routes", "author": "nikklassen", "createdAt": "2020-07-27T21:10:19Z", "path": "UR-web-app/src/app/service/auth.guard.ts", "diffHunk": "@@ -0,0 +1,19 @@\n+import {Injectable} from '@angular/core';\n+import {CanActivate, UrlTree, Router} from '@angular/router';\n+import {AuthService} from './auth.service';\n+\n+@Injectable({\n+  providedIn: 'root',\n+})\n+export class AuthGuard implements CanActivate {\n+  constructor(\n+    private readonly authService: AuthService,\n+    private readonly router: Router,\n+  ) {}\n+\n+  canActivate(): boolean | UrlTree {\n+    return (\n+      this.authService.checkCredentials() || this.router.parseUrl('/login')", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA3NDExMA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463074110", "bodyText": "Here I'm navigating user to login page whenever user is not logged ,as I need to perform some operation when user hits /coordinator url without login", "author": "firdosebtc1", "createdAt": "2020-07-30T15:18:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MTk5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzIzNjA5MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463236090", "bodyText": "Sorry, this feature was added since I last wrote Angular. This looks like a boolean expression that says \"the user can activate this route if they have credentials or if the route is /login\".\nCan you rewrite it like this to emphasize that it's a redirect and not a boolean result?\nif (!this.authService.checkCredentials()) {\n    return this.router.parseUrl('/login');\n}\nreturn true;", "author": "nikklassen", "createdAt": "2020-07-30T19:56:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MTk5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzYyODU3MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463628570", "bodyText": "Updated.", "author": "firdosebtc1", "createdAt": "2020-07-31T14:00:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MTk5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MjMyMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461172322", "bodyText": "Something needs to happen if these aren't set, we don't want the user to just sit on a blank page", "author": "nikklassen", "createdAt": "2020-07-27T21:11:04Z", "path": "UR-web-app/src/app/auth/callback/callback.component.ts", "diffHunk": "@@ -0,0 +1,27 @@\n+import {Component, OnInit} from '@angular/core';\n+import {ActivatedRoute, Router} from '@angular/router';\n+import {HttpClient} from '@angular/common/http';\n+import {CookieService} from 'ngx-cookie-service';\n+import {AuthService} from 'src/app/service/auth.service';\n+\n+@Component({\n+  selector: 'app-callback',\n+  templateUrl: './callback.component.html',\n+  styleUrls: ['./callback.component.scss'],\n+})\n+export class CallbackComponent implements OnInit {\n+  constructor(\n+    private readonly activatedRoute: ActivatedRoute,\n+    private readonly http: HttpClient,\n+    public cookieService: CookieService,\n+    public authService: AuthService,\n+    private readonly router: Router,\n+  ) {}\n+  ngOnInit(): void {\n+    this.activatedRoute.queryParams.subscribe((params) => {\n+      if (params.code && params.userId) {", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA5NjY5Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463096693", "bodyText": "Updated.", "author": "firdosebtc1", "createdAt": "2020-07-30T15:50:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MjMyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MjM5Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461172397", "bodyText": "You don't need a style file for this", "author": "nikklassen", "createdAt": "2020-07-27T21:11:14Z", "path": "UR-web-app/src/app/auth/callback/callback.component.ts", "diffHunk": "@@ -0,0 +1,27 @@\n+import {Component, OnInit} from '@angular/core';\n+import {ActivatedRoute, Router} from '@angular/router';\n+import {HttpClient} from '@angular/common/http';\n+import {CookieService} from 'ngx-cookie-service';\n+import {AuthService} from 'src/app/service/auth.service';\n+\n+@Component({\n+  selector: 'app-callback',\n+  templateUrl: './callback.component.html',\n+  styleUrls: ['./callback.component.scss'],", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MjU4Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461172587", "bodyText": "You don't need a template for this", "author": "nikklassen", "createdAt": "2020-07-27T21:11:35Z", "path": "UR-web-app/src/app/auth/callback/callback.component.ts", "diffHunk": "@@ -0,0 +1,27 @@\n+import {Component, OnInit} from '@angular/core';\n+import {ActivatedRoute, Router} from '@angular/router';\n+import {HttpClient} from '@angular/common/http';\n+import {CookieService} from 'ngx-cookie-service';\n+import {AuthService} from 'src/app/service/auth.service';\n+\n+@Component({\n+  selector: 'app-callback',\n+  templateUrl: './callback.component.html',", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA2OTk3OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463069979", "bodyText": "Updated.", "author": "firdosebtc1", "createdAt": "2020-07-30T15:12:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MjU4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MjcyMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461172722", "bodyText": "remove unused services", "author": "nikklassen", "createdAt": "2020-07-27T21:11:54Z", "path": "UR-web-app/src/app/auth/callback/callback.component.ts", "diffHunk": "@@ -0,0 +1,27 @@\n+import {Component, OnInit} from '@angular/core';\n+import {ActivatedRoute, Router} from '@angular/router';\n+import {HttpClient} from '@angular/common/http';\n+import {CookieService} from 'ngx-cookie-service';\n+import {AuthService} from 'src/app/service/auth.service';\n+\n+@Component({\n+  selector: 'app-callback',\n+  templateUrl: './callback.component.html',\n+  styleUrls: ['./callback.component.scss'],\n+})\n+export class CallbackComponent implements OnInit {\n+  constructor(\n+    private readonly activatedRoute: ActivatedRoute,\n+    private readonly http: HttpClient,\n+    public cookieService: CookieService,", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA2OTg1OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463069859", "bodyText": "Updated.", "author": "firdosebtc1", "createdAt": "2020-07-30T15:12:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MjcyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzYyNzIzOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463627238", "bodyText": "I don't see any changes", "author": "nikklassen", "createdAt": "2020-07-31T13:57:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MjcyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY0Nzg3Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463647872", "bodyText": "Updated.", "author": "firdosebtc1", "createdAt": "2020-07-31T14:34:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MjcyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MzUxNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461173515", "bodyText": "Needs a test for parsing the query parameters", "author": "nikklassen", "createdAt": "2020-07-27T21:13:29Z", "path": "UR-web-app/src/app/auth/callback/callback.component.spec.ts", "diffHunk": "@@ -0,0 +1,29 @@\n+import {async, ComponentFixture, TestBed} from '@angular/core/testing';\n+import {CallbackComponent} from './callback.component';\n+import {RouterTestingModule} from '@angular/router/testing';\n+import {AuthService} from 'src/app/service/auth.service';\n+import {HttpClientModule} from '@angular/common/http';\n+import {EntityService} from 'src/app/service/entity.service';\n+\n+describe('CallbackComponent', () => {", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzYyNzM5Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463627392", "bodyText": "Still waiting for this", "author": "nikklassen", "createdAt": "2020-07-31T13:58:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MzUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzYzMDQwNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463630406", "bodyText": "As per internal discussion ,we will be writing test case for this when we are integrating hydra oauth server", "author": "firdosebtc1", "createdAt": "2020-07-31T14:03:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3MzUxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3NDcxMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461174712", "bodyText": "Can you add a dev environment to angular.json so that I can use my own URLs?", "author": "nikklassen", "createdAt": "2020-07-27T21:15:52Z", "path": "UR-web-app/src/environments/environment.ts", "diffHunk": "@@ -4,7 +4,9 @@\n \n export const environment = {", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3NDkyNA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r461174924", "bodyText": "Please remove when hardcoded data is removed", "author": "nikklassen", "createdAt": "2020-07-27T21:16:18Z", "path": "UR-web-app/tsconfig.json", "diffHunk": "@@ -14,6 +14,8 @@\n     \"importHelpers\": true,\n     \"target\": \"es6\",\n     \"typeRoots\": [\"node_modules/@types\"],\n-    \"lib\": [\"es2018\", \"dom\"]\n+    \"lib\": [\"es2018\", \"dom\"],\n+    \"resolveJsonModule\": true,", "originalCommit": "ac80ea914fda97db82778d864f6e4df2302c13cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA2OTYxMQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463069611", "bodyText": "Sure", "author": "firdosebtc1", "createdAt": "2020-07-30T15:11:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE3NDkyNA=="}], "type": "inlineReview"}, {"oid": "a33b1f4ece76e61690c9c61c44565f89803c6eef", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a33b1f4ece76e61690c9c61c44565f89803c6eef", "message": "code review comments has been fixed", "committedDate": "2020-07-30T14:36:55Z", "type": "commit"}, {"oid": "c037b180985b13f17fefcbfc1b7f15a556489f1c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c037b180985b13f17fefcbfc1b7f15a556489f1c", "message": "formatting has been done", "committedDate": "2020-07-30T14:41:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA0Njg4NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463046885", "bodyText": "You don't have this on the /login route.", "author": "nikklassen", "createdAt": "2020-07-30T14:40:47Z", "path": "UR-web-app/src/app/service/auth.guard.ts", "diffHunk": "@@ -12,8 +12,6 @@ export class AuthGuard implements CanActivate {\n   ) {}\n \n   canActivate(): boolean | UrlTree {\n-    return (\n-      this.authService.checkCredentials() || this.router.parseUrl('/login')\n-    );\n+    return this.authService.hasCredentials() || this.router.parseUrl('/login');", "originalCommit": "a33b1f4ece76e61690c9c61c44565f89803c6eef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA0OTcyNA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463049724", "bodyText": "typo", "author": "nikklassen", "createdAt": "2020-07-30T14:44:35Z", "path": "UR-web-app/src/app/auth/login/login.component.ts", "diffHunk": "@@ -14,6 +14,10 @@ export class LoginComponent {\n   ) {}\n \n   ngOnInit(): void {\n-    this.authService.redirectToLoginPage();\n+    if (!this.authService.hasCredentials()) {\n+      this.authService.redirectToLoginPage();\n+    } else {\n+     void this.router.navigate(['/coordiantor/']);", "originalCommit": "a33b1f4ece76e61690c9c61c44565f89803c6eef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA5NzExMQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463097111", "bodyText": "Updated.", "author": "firdosebtc1", "createdAt": "2020-07-30T15:51:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA0OTcyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA1MzM5Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463053396", "bodyText": "I've mentioned this on several other reviews, you don't need to call JSON.stringify, this happens automatically", "author": "nikklassen", "createdAt": "2020-07-30T14:49:27Z", "path": "UR-web-app/src/app/service/auth.service.ts", "diffHunk": "@@ -45,30 +40,29 @@ export class AuthService extends UnsubscribeOnDestroyAdapter {\n       },\n     });\n   }\n-  getToken(code: string, userId: string): void {\n+  grantAuthorization(code: string, userId: string): void {\n     const payload = {\n       grant_type: 'authorization_code',\n       scope: 'openid',\n       redirect_uri: environment.redirectUrl,\n       code: code,\n       userId: userId,\n     };\n-    this.subs.add(\n-      this.entityService\n-        .authServerPost(JSON.stringify(payload), 'oauth2/token')\n-        .subscribe((response) => {\n-          this.cookieService.set('accessToken', response.accessToken);\n-          this.cookieService.set('refreshToken', response.refreshToken);\n-          this.getProfile();\n-        }),\n-    );\n+    this.http\n+      .post<AccessToken>(\n+        `${environment.authServerUrl}/oauth2/token`,\n+        JSON.stringify(payload),", "originalCommit": "a33b1f4ece76e61690c9c61c44565f89803c6eef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "413d5c907ef2d174d2eaec0ddcc30caeb07b8bad", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/413d5c907ef2d174d2eaec0ddcc30caeb07b8bad", "message": "test case issues has been fixed", "committedDate": "2020-07-30T15:11:23Z", "type": "commit"}, {"oid": "2445bafd34b9fdad8c2dceddb5bcd4a617c610a2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/2445bafd34b9fdad8c2dceddb5bcd4a617c610a2", "message": "few other issues has been fixed", "committedDate": "2020-07-30T15:41:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzIzNjgwOQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/683#discussion_r463236809", "bodyText": "I think you want a navigateTo here", "author": "nikklassen", "createdAt": "2020-07-30T19:57:27Z", "path": "UR-web-app/src/app/auth/login-callback/login-callback.component.ts", "diffHunk": "@@ -20,6 +20,8 @@ export class LoginCallbackComponent implements OnInit {\n     this.activatedRoute.queryParams.subscribe((params) => {\n       if (params.code && params.userId) {\n         this.authService.grantAuthorization(params.code, params.userId);\n+      } else {\n+        void this.router.parseUrl('/login');", "originalCommit": "2445bafd34b9fdad8c2dceddb5bcd4a617c610a2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f0097dbe2f92949308bacb31d4d4f3e100d48b80", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f0097dbe2f92949308bacb31d4d4f3e100d48b80", "message": "few other clients fixes has been done", "committedDate": "2020-07-31T07:14:03Z", "type": "commit"}, {"oid": "b1a4e7c4e404c384fb7db6eaf941ed776593e348", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/b1a4e7c4e404c384fb7db6eaf941ed776593e348", "message": "few other fixes has been done", "committedDate": "2020-07-31T14:26:29Z", "type": "commit"}, {"oid": "e687d1ed285720f80c23e0aea6effc2bb38ba0a2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e687d1ed285720f80c23e0aea6effc2bb38ba0a2", "message": "build issue has been fixed", "committedDate": "2020-07-31T14:32:14Z", "type": "commit"}, {"oid": "0e7cf1d8f671dc0d48ac3fce12b63ab69f570071", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0e7cf1d8f671dc0d48ac3fce12b63ab69f570071", "message": "Merge branch 'develop' into urwebapp-mock-oauth-server", "committedDate": "2020-08-03T06:59:35Z", "type": "commit"}]}