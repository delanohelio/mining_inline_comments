{"pr_number": 2070, "pr_title": "Fixed issue #2013 Study Builder - Potential XSS issues in JSP pages", "pr_createdAt": "2020-11-17T13:43:05Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2070", "timeline": [{"oid": "fba76f88833a78dd2a2038ae126f1a04b13c8cbd", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/fba76f88833a78dd2a2038ae126f1a04b13c8cbd", "message": "Fixed issue Study Builder - Potential XSS issues in JSP pages #2013\n\nFixed issue Study Builder - Potential XSS issues in JSP pages #2013", "committedDate": "2020-11-17T13:37:51Z", "type": "commit"}, {"oid": "2fa2716bfeac4a3e5ffec44970e4bedb26a7be4c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/2fa2716bfeac4a3e5ffec44970e4bedb26a7be4c", "message": "Merge branch 'develop' into study-builder-xss-security-issue-2013", "committedDate": "2020-11-17T13:45:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIxNzA1MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2070#discussion_r525217050", "bodyText": "fix nesting of elements", "author": "zohrehj", "createdAt": "2020-11-17T14:54:37Z", "path": "study-builder/fdahpStudyDesigner/src/main/webapp/WEB-INF/view/study/consentReviewAndEConsentPage.jsp", "diffHunk": "@@ -907,66 +910,52 @@\n     var tagline_description = $(\"#taglineDescriptionId\").val();\n     var short_description = $(\"#shortDescriptionId\").val();\n     var long_descriptionId = $(\"#longDescriptionId\").val();\n-    $('.force-overflow__').html('');\n-    var data = '<div class=\"pp__title\" id=\"titleModalId\">';\n-    if (titleText != '' && titleText != null && typeof titleText != 'undefined') {\n-      data += titleText + '</div>';\n-    } else {\n-      data += ' -NA-</div>';\n+    $(\"#learnMoreId\").show();\n+    $(\"#tagLineDescriptionModalId\").show();\n+    if (titleText == '' || titleText == null || typeof titleText == 'undefined') {\n+    \ttitleText = ' -NA-';\n     }\n-    data += '<div class=\"pp__tagline\" id=\"tagLineDescriptionModalId\">';\n-    if (tagline_description != '' && tagline_description != null && typeof tagline_description\n-        != 'undefined') {\n-      data += tagline_description + '</div>';\n-    } else {\n-      data += ' -NA-</div>';\n+    $(\"#titleModalId\").text(titleText);\n+    \n+    if (tagline_description == '' || tagline_description == null || typeof tagline_description\n+        == 'undefined') {\n+    \ttagline_description = ' -NA-';\n     }\n+    \n+    $(\"#tagLineDescriptionModalId\").text(tagline_description);\n \n-    data += '<div class=\"pp__learnMore\"><a href=\"javascript:void(0)\" data-toggle=\"modal\" onclick=\"previewLearnMore();\">Learn more</a>'\n-        + '</div>'\n-        + '<div class=\"pp__ul mt-xlg\">';\n     if (short_description != '' && short_description != null && typeof short_description\n         != 'undefined') {\n-      data += '<div class=\"panel-group overview-panel\" id=\"accordion\">'\n-          + '<div class=\"panel panel-default\">'\n-          + '<div class=\"panel-heading\">'\n-          + '<div class=\"panel-title\" style=\"font-weight: bold;\">'\n-          + '<a data-toggle=\"collapse\" data-parent=\"#accordion\" href=\"#collapse1\" aria-expanded=\"true\">'\n-          + '<div class=\"text-left dis-inline pull-left\">'\n-          + '<span class=\"ellipsis__\">' + 'Share my data with ' + short_description\n-          + ' and qualified researchers worldwide' + '</span>'\n-          + '</div>'\n-          + '<div class=\"text-right dis-inline pull-right\"><span class=\"glyphicon glyphicon-chevron-right\"></span>'\n-          + '</div><div class=\"clearfix\"></div></a></div></div>'\n-          + '<div id=\"collapse1\" class=\"panel-collapse collapse\"><div class=\"panel-body\">'\n-          + 'Share my data with ' + short_description + ' and qualified researchers worldwide'\n-          + '</div></div></div></div>';\n-\n+      short_description = 'Share my data with ' + short_description + ' and qualified researchers worldwide';\n+      $(\"#accordionEllipsis\").text(short_description);\n+      $(\"#accordionCollapse1\").text(short_description);\n+      $(\"#accordianNA\").hide();\n+      $(\"#accordion\").show();\n     } else {\n-      data += '<ul class=\"\"><li id=\"shortDescriptionModalId\" style=\"font-weight: bold;\"> - NA - </li></ul>';\n+      short_description = '';\n+      $(\"#accordionEllipsis\").text(short_description);\n+      $(\"#accordionCollapse1\").text(short_description);\n+      $(\"#shortDescriptionModalId\").text(' - NA - ');\n+      $(\"#accordianNA\").show();\n+      $(\"#accordion\").hide();\n     }\n \n     if (long_descriptionId != '' && long_descriptionId != null && typeof long_descriptionId\n         != 'undefined') {\n-      data += '<div class=\"panel-group overview-panel\" id=\"accordion1\">'\n-          + '<div class=\"panel panel-default\">'\n-          + '<div class=\"panel-heading\">'\n-          + '<div class=\"panel-title\" style=\"font-weight: bold;\">'\n-          + '<a data-toggle=\"collapse\" data-parent=\"#accordion1\" href=\"#collapse2\" aria-expanded=\"true\">'\n-          + '<div class=\"text-left dis-inline pull-left\">'\n-          + '<span class=\"ellipsis__\">' + 'Only share my data with ' + long_descriptionId\n-          + '</span>'\n-          + '</div>'\n-          + '<div class=\"text-right dis-inline pull-right\"><span class=\"glyphicon glyphicon-chevron-right\"></span>'\n-          + '</div><div class=\"clearfix\"></div></a></div></div>'\n-          + '<div id=\"collapse2\" class=\"panel-collapse collapse\"><div class=\"panel-body\">'\n-          + 'Only share my data with ' + long_descriptionId + '</div></div></div></div>';\n+     long_descriptionId = 'Only share my data with ' + long_descriptionId;\n+   \t $(\"#accordion1Ellipsis\").text(long_descriptionId);\n+   \t $(\"#accordion1Collapse2\").text(long_descriptionId);\n+   \t $(\"#accordian1NA\").hide();\n+   \t $(\"#accordion1\").show();\n     } else {\n-      data += '<ul class=\"\"><li id=\"longDescriptionModalId\" style=\"font-weight: bold;\"> - NA - </li></ul>';\n-    }\n-    data += '</div>';\n+     long_descriptionId = '';\n+   \t $(\"#accordion1Ellipsis\").text(long_descriptionId);\n+   \t $(\"#accordion1Collapse2\").text(long_descriptionId);", "originalCommit": "2fa2716bfeac4a3e5ffec44970e4bedb26a7be4c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI3NjU2MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2070#discussion_r525276561", "bodyText": "Here in different elements I am setting the value, nesting of elements looks correct.\n#accordion1Ellipsis tag is inside panel-heading, then #accordion1Collapse2 tag inside panel-collapse.\nKindly suggest/ let me know if I missed anything.\nWe did buddy testing for this screen before raising PR.\nParallelly QA is testing other screens of study builder.", "author": "harisboston", "createdAt": "2020-11-17T15:58:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIxNzA1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODM0MzcxMQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2070#discussion_r528343711", "bodyText": "commented on the line. first line long_descriptionId = ''; should be nested at the same level as the rest of the block.", "author": "zohrehj", "createdAt": "2020-11-22T14:30:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIxNzA1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIxODgzNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2070#discussion_r525218835", "bodyText": "no user/variable data should be passed via append. please fix", "author": "zohrehj", "createdAt": "2020-11-17T14:56:36Z", "path": "study-builder/fdahpStudyDesigner/src/main/webapp/WEB-INF/view/study/questionStep.jsp", "diffHunk": "@@ -4557,15 +4557,15 @@\n                 var message = data.message;\n                 var formulaResponseJsonObject = data.formulaResponseJsonObject;\n                 if (message == \"SUCCESS\") {\n-                  $('#lhsValueId').html(\"<b>\" + formulaResponseJsonObject.lhsData + \"</b>\");\n-                  $('#rhsValueId').html(\"<b>\" + formulaResponseJsonObject.rhsData + \"</b>\");\n+                  $('#lhsValueId').append(\"<b>\" + formulaResponseJsonObject.lhsData + \"</b>\");\n+                  $('#rhsValueId').append(\"<b>\" + formulaResponseJsonObject.rhsData + \"</b>\");", "originalCommit": "2fa2716bfeac4a3e5ffec44970e4bedb26a7be4c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI4OTc2Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2070#discussion_r525289766", "bodyText": "I have fixed this code in PR #2014.\nI have created a dependent PR #2070 on top of PR #2014.\nIn this PR I just removed .html() from overViewPage.jsp and consentReviewAndEConsentPage.jsp pages.", "author": "harisboston", "createdAt": "2020-11-17T16:14:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIxODgzNQ=="}], "type": "inlineReview"}, {"oid": "006560ab094d3b4ba0283c0a557ea6d408582111", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/006560ab094d3b4ba0283c0a557ea6d408582111", "message": "Fixed review comment of issue #2013 Study Builder - Potential XSS issues in JSP pages #2070\n\nFixed review comment of issue #2013 Study Builder - Potential XSS issues in JSP pages #2070", "committedDate": "2020-11-17T16:24:31Z", "type": "commit"}, {"oid": "eec78f6afa4fc5c66bf32ddcee7dff7dd25aeec5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/eec78f6afa4fc5c66bf32ddcee7dff7dd25aeec5", "message": "Merge branch 'develop' into study-builder-xss-security-issue-2013", "committedDate": "2020-11-22T13:14:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODM0MzQyNw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2070#discussion_r528343427", "bodyText": "this should be nested with 2 spaces, it's 1 right now.", "author": "zohrehj", "createdAt": "2020-11-22T14:29:37Z", "path": "study-builder/fdahpStudyDesigner/src/main/webapp/WEB-INF/view/study/consentReviewAndEConsentPage.jsp", "diffHunk": "@@ -907,66 +910,52 @@\n     var tagline_description = $(\"#taglineDescriptionId\").val();\n     var short_description = $(\"#shortDescriptionId\").val();\n     var long_descriptionId = $(\"#longDescriptionId\").val();\n-    $('.force-overflow__').empty();\n-    var data = '<div class=\"pp__title\" id=\"titleModalId\">';\n-    if (titleText != '' && titleText != null && typeof titleText != 'undefined') {\n-      data += titleText + '</div>';\n-    } else {\n-      data += ' -NA-</div>';\n+    $(\"#learnMoreId\").show();\n+    $(\"#tagLineDescriptionModalId\").show();\n+    if (titleText == '' || titleText == null || typeof titleText == 'undefined') {\n+    \ttitleText = ' -NA-';\n     }\n-    data += '<div class=\"pp__tagline\" id=\"tagLineDescriptionModalId\">';\n-    if (tagline_description != '' && tagline_description != null && typeof tagline_description\n-        != 'undefined') {\n-      data += tagline_description + '</div>';\n-    } else {\n-      data += ' -NA-</div>';\n+    $(\"#titleModalId\").text(titleText);\n+    \n+    if (tagline_description == '' || tagline_description == null || typeof tagline_description\n+        == 'undefined') {\n+    \ttagline_description = ' -NA-';\n     }\n+    \n+    $(\"#tagLineDescriptionModalId\").text(tagline_description);\n \n-    data += '<div class=\"pp__learnMore\"><a href=\"javascript:void(0)\" data-toggle=\"modal\" onclick=\"previewLearnMore();\">Learn more</a>'\n-        + '</div>'\n-        + '<div class=\"pp__ul mt-xlg\">';\n     if (short_description != '' && short_description != null && typeof short_description\n         != 'undefined') {\n-      data += '<div class=\"panel-group overview-panel\" id=\"accordion\">'\n-          + '<div class=\"panel panel-default\">'\n-          + '<div class=\"panel-heading\">'\n-          + '<div class=\"panel-title\" style=\"font-weight: bold;\">'\n-          + '<a data-toggle=\"collapse\" data-parent=\"#accordion\" href=\"#collapse1\" aria-expanded=\"true\">'\n-          + '<div class=\"text-left dis-inline pull-left\">'\n-          + '<span class=\"ellipsis__\">' + 'Share my data with ' + short_description\n-          + ' and qualified researchers worldwide' + '</span>'\n-          + '</div>'\n-          + '<div class=\"text-right dis-inline pull-right\"><span class=\"glyphicon glyphicon-chevron-right\"></span>'\n-          + '</div><div class=\"clearfix\"></div></a></div></div>'\n-          + '<div id=\"collapse1\" class=\"panel-collapse collapse\"><div class=\"panel-body\">'\n-          + 'Share my data with ' + short_description + ' and qualified researchers worldwide'\n-          + '</div></div></div></div>';\n-\n+      short_description = 'Share my data with ' + short_description + ' and qualified researchers worldwide';\n+      $(\"#accordionEllipsis\").text(short_description);\n+      $(\"#accordionCollapse1\").text(short_description);\n+      $(\"#accordianNA\").hide();\n+      $(\"#accordion\").show();\n     } else {\n-      data += '<ul class=\"\"><li id=\"shortDescriptionModalId\" style=\"font-weight: bold;\"> - NA - </li></ul>';\n+      short_description = '';\n+      $(\"#accordionEllipsis\").text(short_description);\n+      $(\"#accordionCollapse1\").text(short_description);\n+      $(\"#shortDescriptionModalId\").text(' - NA - ');\n+      $(\"#accordianNA\").show();\n+      $(\"#accordion\").hide();\n     }\n \n     if (long_descriptionId != '' && long_descriptionId != null && typeof long_descriptionId\n         != 'undefined') {\n-      data += '<div class=\"panel-group overview-panel\" id=\"accordion1\">'\n-          + '<div class=\"panel panel-default\">'\n-          + '<div class=\"panel-heading\">'\n-          + '<div class=\"panel-title\" style=\"font-weight: bold;\">'\n-          + '<a data-toggle=\"collapse\" data-parent=\"#accordion1\" href=\"#collapse2\" aria-expanded=\"true\">'\n-          + '<div class=\"text-left dis-inline pull-left\">'\n-          + '<span class=\"ellipsis__\">' + 'Only share my data with ' + long_descriptionId\n-          + '</span>'\n-          + '</div>'\n-          + '<div class=\"text-right dis-inline pull-right\"><span class=\"glyphicon glyphicon-chevron-right\"></span>'\n-          + '</div><div class=\"clearfix\"></div></a></div></div>'\n-          + '<div id=\"collapse2\" class=\"panel-collapse collapse\"><div class=\"panel-body\">'\n-          + 'Only share my data with ' + long_descriptionId + '</div></div></div></div>';\n+     long_descriptionId = 'Only share my data with ' + long_descriptionId;\n+   \t $(\"#accordion1Ellipsis\").text(long_descriptionId);\n+   \t $(\"#accordion1Collapse2\").text(long_descriptionId);\n+   \t $(\"#accordian1NA\").hide();\n+   \t $(\"#accordion1\").show();\n     } else {\n-      data += '<ul class=\"\"><li id=\"longDescriptionModalId\" style=\"font-weight: bold;\"> - NA - </li></ul>';\n-    }\n-    data += '</div>';\n+     long_descriptionId = '';", "originalCommit": "eec78f6afa4fc5c66bf32ddcee7dff7dd25aeec5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}