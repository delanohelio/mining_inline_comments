{"pr_number": 122, "pr_title": "Combine all clusters into one", "pr_createdAt": "2020-04-09T13:49:53Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/122", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIzNzU3NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/122#discussion_r406237574", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            module \"heroes-hat-cluster\" {\n          \n          \n            \n            module \"heroes_hat_cluster\" {", "author": "umairidris", "createdAt": "2020-04-09T14:17:21Z", "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-apps/apps/main.tf", "diffHunk": "@@ -6,131 +6,21 @@ terraform {\n \n # From\n # https://github.com/terraform-google-modules/terraform-google-kubernetes-engine/tree/master/modules/safer-cluster-update-variant\n-\n-# Auth server\n-module \"gke-auth-server\" {\n-  source = \"terraform-google-modules/kubernetes-engine/google//modules/safer-cluster\"\n-\n-  # Required\n-  name                   = \"auth-server-ws-cluster\"\n-  kubernetes_version     = \"1.14.10-gke.24\"\n-  project_id             = var.project_id\n-  region                 = var.gke_region\n-  regional               = true\n-  network_project_id     = var.network_project_id\n-  network                = var.network\n-  subnetwork             = var.subnetwork\n-  ip_range_pods          = \"auth-server-ws-cluster-ip-range-pods\"\n-  ip_range_services      = \"auth-server-ws-cluster-ip-range-svc\"\n-  master_ipv4_cidr_block = \"172.16.0.0/28\"\n-\n-  # Optional\n-  # Some of these were taken from the example config at\n-  # https://github.com/terraform-google-modules/terraform-google-kubernetes-engine/tree/master/examples/safer_cluster\n-  istio             = true\n-  skip_provisioners = true\n-\n-  # Need to either disable private endpoint, or enable master auth networks.\n-  enable_private_endpoint = false\n-}\n-\n-# Response server\n-module \"gke-response-server\" {\n-  source = \"terraform-google-modules/kubernetes-engine/google//modules/safer-cluster\"\n-\n-  # Required\n-  name                   = \"response-server-ws-cluster\"\n-  kubernetes_version     = \"1.14.10-gke.24\"\n-  project_id             = var.project_id\n-  region                 = var.gke_region\n-  regional               = true\n-  network_project_id     = var.network_project_id\n-  network                = var.network\n-  subnetwork             = var.subnetwork\n-  ip_range_pods          = \"response-server-ws-cluster-ip-range-pods\"\n-  ip_range_services      = \"response-server-ws-cluster-ip-range-svc\"\n-  master_ipv4_cidr_block = \"172.16.1.0/28\"\n-\n-  # Optional\n-  # Some of these were taken from the example config at\n-  # https://github.com/terraform-google-modules/terraform-google-kubernetes-engine/tree/master/examples/safer_cluster\n-  istio             = true\n-  skip_provisioners = true\n-\n-  # Need to either disable private endpoint, or enable master auth networks.\n-  enable_private_endpoint = false\n-}\n-\n-# Study designer\n-module \"gke-study-designer\" {\n-  source = \"terraform-google-modules/kubernetes-engine/google//modules/safer-cluster\"\n-\n-  # Required\n-  name                   = \"study-designer-cluster\"\n-  kubernetes_version     = \"1.14.10-gke.24\"\n-  project_id             = var.project_id\n-  region                 = var.gke_region\n-  regional               = true\n-  network_project_id     = var.network_project_id\n-  network                = var.network\n-  subnetwork             = var.subnetwork\n-  ip_range_pods          = \"study-designer-cluster-ip-range-pods\"\n-  ip_range_services      = \"study-designer-cluster-ip-range-svc\"\n-  master_ipv4_cidr_block = \"172.16.2.0/28\"\n-\n-  # Optional\n-  # Some of these were taken from the example config at\n-  # https://github.com/terraform-google-modules/terraform-google-kubernetes-engine/tree/master/examples/safer_cluster\n-  istio             = true\n-  skip_provisioners = true\n-\n-  # Need to either disable private endpoint, or enable master auth networks.\n-  enable_private_endpoint = false\n-}\n-\n-# Study metadata\n-module \"gke-study-metadata\" {\n-  source = \"terraform-google-modules/kubernetes-engine/google//modules/safer-cluster\"\n-\n-  # Required\n-  name                   = \"study-meta-data-cluster\"\n-  kubernetes_version     = \"1.14.10-gke.24\"\n-  project_id             = var.project_id\n-  region                 = var.gke_region\n-  regional               = true\n-  network_project_id     = var.network_project_id\n-  network                = var.network\n-  subnetwork             = var.subnetwork\n-  ip_range_pods          = \"study-meta-data-cluster-ip-range-pods\"\n-  ip_range_services      = \"study-meta-data-cluster-ip-range-svc\"\n-  master_ipv4_cidr_block = \"172.16.3.0/28\"\n-\n-  # Optional\n-  # Some of these were taken from the example config at\n-  # https://github.com/terraform-google-modules/terraform-google-kubernetes-engine/tree/master/examples/safer_cluster\n-  istio             = true\n-  skip_provisioners = true\n-\n-  # Need to either disable private endpoint, or enable master auth networks.\n-  enable_private_endpoint = false\n-}\n-\n-# User registration server\n-module \"gke-registration-server\" {\n+module \"heroes-hat-cluster\" {", "originalCommit": "094b6b888595fc3daa87f20d9f79b4c0c158196f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI0ODYwMw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/122#discussion_r406248603", "bodyText": "Done.", "author": "MartinPetkov", "createdAt": "2020-04-09T14:32:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIzNzU3NA=="}], "type": "inlineReview"}, {"oid": "18913896bed5108e89982dc396736f50c982c224", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/18913896bed5108e89982dc396736f50c982c224", "message": "Combine all clusters into one\n\nIt seems the FDA MyStudies team has moved towards combining all servers into\none cluster, \"heroes-hat-dev\". Adjust Terraform configs to match that.\n\nAlso increase the IP ranges for pods and services, to leave more room for\nscaling.", "committedDate": "2020-04-09T14:33:24Z", "type": "commit"}]}