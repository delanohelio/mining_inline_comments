{"pr_number": 1824, "pr_title": "Deployment fixes #1799 & #1793", "pr_createdAt": "2020-11-04T21:29:04Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1824", "timeline": [{"oid": "d2cebe8ded3137ffaae30d2421cd23cc27e402b8", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d2cebe8ded3137ffaae30d2421cd23cc27e402b8", "message": "Auth-server: Change package to jar, use tomcat image and delete dockerfile", "committedDate": "2020-11-04T21:19:31Z", "type": "commit"}, {"oid": "714710d2f7c124e4b2e8c6cc44c21df59ecf81be", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/714710d2f7c124e4b2e8c6cc44c21df59ecf81be", "message": "Participant-datastore: use tomcat image, upgrade jib", "committedDate": "2020-11-04T21:22:09Z", "type": "commit"}, {"oid": "1bca9c86144e77b9552d2cffe0f68aed0c79195d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1bca9c86144e77b9552d2cffe0f68aed0c79195d", "message": "Participant-manager-datastore: use tomcat image, fix cloudbuild and upgrade jib", "committedDate": "2020-11-04T21:24:19Z", "type": "commit"}, {"oid": "89e415880d80fa6f0996cb5be1b0e9862042c01b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/89e415880d80fa6f0996cb5be1b0e9862042c01b", "message": "Response-datastore: integrate with jib", "committedDate": "2020-11-04T21:25:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY0NzcyNw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1824#discussion_r517647727", "bodyText": "Since the artifact is no longer WAR, it doesn't make much sense to use a tomcat image. Having a JRE is sufficient.", "author": "chanseokoh", "createdAt": "2020-11-04T21:42:04Z", "path": "oauth-scim-module/oauth-scim-service/pom.xml", "diffHunk": "@@ -158,7 +157,10 @@\n       <plugin>\n         <groupId>com.google.cloud.tools</groupId>\n         <artifactId>jib-maven-plugin</artifactId>\n-        <version>2.5.2</version>\n+        <version>2.6.0</version>\n+        <configuration>\n+          <from><image>tomcat:9.0.33-jdk11-openjdk</image></from>", "originalCommit": "89e415880d80fa6f0996cb5be1b0e9862042c01b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY1MTc4NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1824#discussion_r517651785", "bodyText": "That's true, I changed it to keep all images consistent.", "author": "zohrehj", "createdAt": "2020-11-04T21:50:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY0NzcyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA5MDMwMA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1824#discussion_r518090300", "bodyText": "It's your call, but it's like you are using postgres:9.6.19 as a base image while you are not using postgreSQL.", "author": "chanseokoh", "createdAt": "2020-11-05T14:25:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY0NzcyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODE5OTU3Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1824#discussion_r518199573", "bodyText": "This is what was used in the original docker file; and I am not seeing any references to postgres, can you point me to where postgres is included?", "author": "zohrehj", "createdAt": "2020-11-05T16:47:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY0NzcyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODIwMjM0MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1824#discussion_r518202340", "bodyText": "You didn't have postgreSQL; sorry, I was just making an analogy. You are including a tomcat installation (and their dependent system libraries) only to not use it by anyone, just taking space to create a bigger image for no good reasons. That's just what I'm saying.", "author": "chanseokoh", "createdAt": "2020-11-05T16:51:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY0NzcyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODIzMTA2Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1824#discussion_r518231062", "bodyText": "I see, I'll look into removing it after verifying that everything works as expected with the jar packaging.", "author": "zohrehj", "createdAt": "2020-11-05T17:32:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY0NzcyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA3MDY5NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1824#discussion_r518070695", "bodyText": "doesn't it required\n<container><appRoot>/usr/local/tomcat/webapps/oauth-scim-service</appRoot></container> ?", "author": "aswinijena100", "createdAt": "2020-11-05T13:59:18Z", "path": "oauth-scim-module/oauth-scim-service/pom.xml", "diffHunk": "@@ -158,7 +157,10 @@\n       <plugin>\n         <groupId>com.google.cloud.tools</groupId>\n         <artifactId>jib-maven-plugin</artifactId>\n-        <version>2.5.2</version>\n+        <version>2.6.0</version>\n+        <configuration>\n+          <from><image>tomcat:9.0.33-jdk11-openjdk</image></from>", "originalCommit": "89e415880d80fa6f0996cb5be1b0e9862042c01b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA4NjQ3MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1824#discussion_r518086471", "bodyText": "No. Since this is not a WAR artifact, even tomcat doesn't have to run at all. The oauth-scim-service app will be run directly on JVM with java -cp ... com.google.cloud.healthcare.fdamystudies.Application.", "author": "chanseokoh", "createdAt": "2020-11-05T14:20:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA3MDY5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEzNDA2NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1824#discussion_r518134065", "bodyText": "Oh, and I see these are Spring Boot projects, so chances are that removing <packaging>war will work, but I guess this doesn't have to be in this PR.", "author": "chanseokoh", "createdAt": "2020-11-05T15:23:26Z", "path": "participant-datastore/consent-mgmt-module/consent-mgmt/pom.xml", "diffHunk": "@@ -259,7 +259,11 @@\n       <plugin>\n         <groupId>com.google.cloud.tools</groupId>\n         <artifactId>jib-maven-plugin</artifactId>\n-        <version>2.5.2</version>\n+        <version>2.6.0</version>", "originalCommit": "89e415880d80fa6f0996cb5be1b0e9862042c01b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODE0OTM0Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1824#discussion_r518149346", "bodyText": "I tried the change in a few other pom.xml, and the applications were missing additional dependencies. For now I filed a bug to address then at a later time.", "author": "zohrehj", "createdAt": "2020-11-05T15:40:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEzNDA2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODE1NTYyMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1824#discussion_r518155622", "bodyText": "Chances are that some dependencies (like the embedded tomcat below) have the \"provided\" scope and being excluded at runtime:\n     <dependency>\n       <groupId>org.springframework.boot</groupId>\n       <artifactId>spring-boot-starter-tomcat</artifactId>\n-      <scope>provided</scope>\n     </dependency>\nNot sure if starter-web is needed at runtime though.\n    <dependency>\n      <groupId>org.springframework.boot</groupId>\n      <artifactId>spring-boot-starter-web</artifactId>\n      <scope>provided</scope>\n    </dependency>", "author": "chanseokoh", "createdAt": "2020-11-05T15:48:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEzNDA2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODIwMDUyMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1824#discussion_r518200522", "bodyText": "Good points, we should review these dependencies at some point, but I would prefer to not increase the scope of this PR.", "author": "zohrehj", "createdAt": "2020-11-05T16:48:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEzNDA2NQ=="}], "type": "inlineReview"}, {"oid": "d5d444e24582d7f37af0b92c4340ee314811dc4c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d5d444e24582d7f37af0b92c4340ee314811dc4c", "message": "Update study-datastore to use tomcat", "committedDate": "2020-11-05T15:42:39Z", "type": "commit"}, {"oid": "1728d3377b4cd45e33434bedfdcf5a2e445f815f", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1728d3377b4cd45e33434bedfdcf5a2e445f815f", "message": "Merge branch 'develop' into deployment-fixes", "committedDate": "2020-11-05T16:39:13Z", "type": "commit"}, {"oid": "ea9e70c6940cb7bc27ffa87a8b6143f4a3656144", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ea9e70c6940cb7bc27ffa87a8b6143f4a3656144", "message": "Merge branch 'develop' into deployment-fixes", "committedDate": "2020-11-06T15:43:17Z", "type": "commit"}, {"oid": "2a809f69edc22529cb08bf58bf262b3587a9a840", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/2a809f69edc22529cb08bf58bf262b3587a9a840", "message": "Merge branch 'develop' into deployment-fixes", "committedDate": "2020-11-06T16:21:49Z", "type": "commit"}, {"oid": "7abf246c8e15983fb3b5d68d5787a31811d4d72d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/7abf246c8e15983fb3b5d68d5787a31811d4d72d", "message": "Merge branch 'develop' into deployment-fixes", "committedDate": "2020-11-06T17:43:29Z", "type": "commit"}]}