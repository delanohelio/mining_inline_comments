{"pr_number": 896, "pr_title": "Study Builder - Externalized Configuration", "pr_createdAt": "2020-09-07T12:15:00Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/896", "timeline": [{"oid": "0d06f33cc655798b52ee52f09a972c1295989caf", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0d06f33cc655798b52ee52f09a972c1295989caf", "message": "Study Builder - Externalized Configuration\n\nStudy Builder - Externalized Configuration\nCode format + Organize Imports", "committedDate": "2020-09-07T12:12:02Z", "type": "commit"}, {"oid": "2b0b75cf78a8eecd2211e55b5fad27d30aa2ebc7", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/2b0b75cf78a8eecd2211e55b5fad27d30aa2ebc7", "message": "changed datastore url\n\nchanged datastore url", "committedDate": "2020-09-08T11:26:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1MzA1NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/896#discussion_r487053054", "bodyText": "please remove", "author": "zohrehj", "createdAt": "2020-09-11T13:42:08Z", "path": "WCP/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyDAO.java", "diffHunk": "@@ -46,6 +41,11 @@\n import com.fdahpstudydesigner.bo.StudyPermissionBO;\n import com.fdahpstudydesigner.bo.UserBO;\n import com.fdahpstudydesigner.util.SessionObject;\n+import java.util.HashMap;\n+/** @author BTC */", "originalCommit": "2b0b75cf78a8eecd2211e55b5fad27d30aa2ebc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODM3NTg3OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/896#discussion_r488375879", "bodyText": "removed now", "author": "aswinijena100", "createdAt": "2020-09-15T04:28:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1MzA1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1NTQyOQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/896#discussion_r487055429", "bodyText": "create a wrapper class for calling study builder to hold this information. The fact that you have ?securityToken= in the URL is a detail of the call and does not belong in the properties.\nLet's keep the properties files to what needs to change between deployments", "author": "zohrehj", "createdAt": "2020-09-11T13:45:42Z", "path": "WCP/fdahpStudyDesigner/src/main/resources/application_local.properties", "diffHunk": "@@ -17,56 +17,36 @@ fda.currentPath=catalina.home\n fda.imgDisplaydPath=/fdaResources/\n \n #User registration server root URL\n-fda.registration.root.url=http://${REGISTRATION_SERVER_URL}/myStudiesUserMgmtWS\n+fda.registration.root.url=${USER_MGMT_SERVICE_URL}\n \n #For  server\n-acceptLinkMail=http://${BASE_URL}/studybuilder/createPassword.do?securityToken=\n-login.url=http://${BASE_URL}/studybuilder/login.do\n-signUp.url=http://${BASE_URL}/studybuilder/signUp.do?securityToken=\n+acceptLinkMail=${STUDY_BUILDER_URL}/createPassword.do?securityToken=\n+login.url=${STUDY_BUILDER_URL}/login.do\n+signUp.url=${STUDY_BUILDER_URL}/signUp.do?securityToken=", "originalCommit": "2b0b75cf78a8eecd2211e55b5fad27d30aa2ebc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODM3NTc2OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/896#discussion_r488375769", "bodyText": "Please find Dhanya's comment in PR #890\nWe've followed same pattern in all the services for API endpoints, this requires lot of code changes if we need to build the endpoint from application. We'll keep the API endpoints in properties for this release and address this in next release if we really need to make the changes. I personally prefer to keep API endpoints in properties file.", "author": "aswinijena100", "createdAt": "2020-09-15T04:28:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1NTQyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcyNDU3MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/896#discussion_r488724570", "bodyText": "I still do not like the fact that you are passing call specific query params in the URLs", "author": "zohrehj", "createdAt": "2020-09-15T14:42:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1NTQyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1NjUzNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/896#discussion_r487056535", "bodyText": "same here, only keep the base url in the properties files; the rest of the path can be set within a class that has knowledge of the userRegistration API", "author": "zohrehj", "createdAt": "2020-09-11T13:47:27Z", "path": "WCP/fdahpStudyDesigner/src/main/resources/application_local.properties", "diffHunk": "@@ -17,56 +17,36 @@ fda.currentPath=catalina.home\n fda.imgDisplaydPath=/fdaResources/\n \n #User registration server root URL\n-fda.registration.root.url=http://${REGISTRATION_SERVER_URL}/myStudiesUserMgmtWS\n+fda.registration.root.url=${USER_MGMT_SERVICE_URL}\n \n #For  server\n-acceptLinkMail=http://${BASE_URL}/studybuilder/createPassword.do?securityToken=\n-login.url=http://${BASE_URL}/studybuilder/login.do\n-signUp.url=http://${BASE_URL}/studybuilder/signUp.do?securityToken=\n+acceptLinkMail=${STUDY_BUILDER_URL}/createPassword.do?securityToken=\n+login.url=${STUDY_BUILDER_URL}/login.do\n+signUp.url=${STUDY_BUILDER_URL}/signUp.do?securityToken=\n \n # TODO: Change the IP/port to an env var and pass it in yaml file instead.\n-db.url=localhost:3306/${DB_NAME}\n+db.url=jdbc:mysql://127.0.0.1:3306/${DB_NAME}?autoReconnect=true\n db.username=${DB_USER}\n db.password=${DB_PASS}\n \n-########################## Web Configuration Portal Web-Services (WCP WS) Configuration Details  STARTS ##########################\n-#DataBase Configuration\n-hibernate.connection.url=jdbc:mysql://localhost:3306/${DB_NAME}\n-hibernate.connection.username=${DB_USER}\n-hibernate.connection.password=${DB_PASS}\n-\n fda.smd.catalinaPath=catalina.home\n \n-#Study Image/Logo Path Local\n-fda.smd.study.thumbnailPath=http://dummy-value/fdaResources/studylogo/\n-fda.smd.study.pagePath=http://dummy-value/fdaResources/studypages/\n-fda.smd.resource.pdfPath=http://dummy-value/fdaResources/studyResources/\n-fda.smd.questionnaire.image=http://dummy-value/fdaResources/questionnaire/\n-fda.smd.gatewayResource.pdfPath=http://dummy-value/fdaResources/gatewayResource/App_Glossary.pdf\n-\n-fda.smd.pricaypolicy=dummy-value\n-fda.smd.terms=dummy-value\n-\n-#Reachout email\n-fda.smd.feedback=dummy-value\n-fda.smd.contactus=dummy-value\n-\n #App Environment -- > possible value : local / uat / prod\n fda.env=local\n \n fda.current.path=catalina.home\n fda.docs.responses.path=/webapps/FDAResponce\n \n #User Registration Server URL\n-userRegistrationServerUrl=http://${REGISTRATION_SERVER_URL}/myStudiesUserMgmtWS/studies/studymetadata\n+userRegistrationServerUrl=${USER_MGMT_SERVICE_URL}/studies/studymetadata", "originalCommit": "2b0b75cf78a8eecd2211e55b5fad27d30aa2ebc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODM3NTgxNA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/896#discussion_r488375814", "bodyText": "Please find Dhanya's comment in PR #890 done the changes\nWe've followed same pattern in all the services for API endpoints, this requires lot of code changes if we need to build the endpoint from application. We'll keep the API endpoints in properties for this release and address this in next release if we really need to make the changes. I personally prefer to keep API endpoints in properties file.", "author": "aswinijena100", "createdAt": "2020-09-15T04:28:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1NjUzNQ=="}], "type": "inlineReview"}, {"oid": "8b313b3ac37d90f8312d56e09060ced25cd72b85", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8b313b3ac37d90f8312d56e09060ced25cd72b85", "message": "removed Author info\n\nremoved Author info", "committedDate": "2020-09-15T04:28:55Z", "type": "commit"}, {"oid": "41ed042c290f90e9c728ecb4655db57a88ba7b82", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/41ed042c290f90e9c728ecb4655db57a88ba7b82", "message": "Merge branch 'develop' into studybuilder-externalized-configuration", "committedDate": "2020-09-15T04:30:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcyMzQ5Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/896#discussion_r488723492", "bodyText": "this seems wrong, why are you passing the application_local.properties in the code?\nWhat happens when we build the application with a different profile? would this overwrite the profile specific props?", "author": "zohrehj", "createdAt": "2020-09-15T14:41:27Z", "path": "WCP/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/util/FdahpStudyDesignerUtil.java", "diffHunk": "@@ -267,7 +265,8 @@ public static String genarateEmailContent(String emailContentName, Map<String, S\n         hm.put(key, value);\n       }\n       ServletContext context = ServletContextHolder.getServletContext();\n-      Properties prop = PropertiesUtil.makePropertiesWithEnvironmentVariables(\"application_local.properties\");\n+      Properties prop =\n+          PropertiesUtil.makePropertiesWithEnvironmentVariables(\"application_local.properties\");", "originalCommit": "41ed042c290f90e9c728ecb4655db57a88ba7b82", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcyNTA4OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/896#discussion_r488725089", "bodyText": "please remove start and end styled comments", "author": "zohrehj", "createdAt": "2020-09-15T14:43:35Z", "path": "WCP/fdahpStudyDesigner/src/main/resources/application_local.properties", "diffHunk": "@@ -17,56 +17,36 @@ fda.currentPath=catalina.home\n fda.imgDisplaydPath=/fdaResources/\n \n #User registration server root URL\n-fda.registration.root.url=http://${REGISTRATION_SERVER_URL}/myStudiesUserMgmtWS\n+fda.registration.root.url=${USER_MGMT_SERVICE_URL}\n \n #For  server\n-acceptLinkMail=http://${BASE_URL}/studybuilder/createPassword.do?securityToken=\n-login.url=http://${BASE_URL}/studybuilder/login.do\n-signUp.url=http://${BASE_URL}/studybuilder/signUp.do?securityToken=\n+acceptLinkMail=${STUDY_BUILDER_URL}/createPassword.do?securityToken=\n+login.url=${STUDY_BUILDER_URL}/login.do\n+signUp.url=${STUDY_BUILDER_URL}/signUp.do?securityToken=\n \n # TODO: Change the IP/port to an env var and pass it in yaml file instead.\n-db.url=localhost:3306/${DB_NAME}\n+db.url=jdbc:mysql://127.0.0.1:3306/${DB_NAME}?autoReconnect=true\n db.username=${DB_USER}\n db.password=${DB_PASS}\n \n-########################## Web Configuration Portal Web-Services (WCP WS) Configuration Details  STARTS ##########################\n-#DataBase Configuration\n-hibernate.connection.url=jdbc:mysql://localhost:3306/${DB_NAME}\n-hibernate.connection.username=${DB_USER}\n-hibernate.connection.password=${DB_PASS}\n-\n fda.smd.catalinaPath=catalina.home\n \n-#Study Image/Logo Path Local\n-fda.smd.study.thumbnailPath=http://dummy-value/fdaResources/studylogo/\n-fda.smd.study.pagePath=http://dummy-value/fdaResources/studypages/\n-fda.smd.resource.pdfPath=http://dummy-value/fdaResources/studyResources/\n-fda.smd.questionnaire.image=http://dummy-value/fdaResources/questionnaire/\n-fda.smd.gatewayResource.pdfPath=http://dummy-value/fdaResources/gatewayResource/App_Glossary.pdf\n-\n-fda.smd.pricaypolicy=dummy-value\n-fda.smd.terms=dummy-value\n-\n-#Reachout email\n-fda.smd.feedback=dummy-value\n-fda.smd.contactus=dummy-value\n-\n #App Environment -- > possible value : local / uat / prod\n fda.env=local\n \n fda.current.path=catalina.home\n fda.docs.responses.path=/webapps/FDAResponce\n \n #User Registration Server URL\n-userRegistrationServerUrl=http://${REGISTRATION_SERVER_URL}/myStudiesUserMgmtWS/studies/studymetadata\n+userRegistrationServerUrl=${USER_MGMT_SERVICE_URL}/studies/studymetadata\n \n #Response Server URL\n-responseServerUrl=http://${RESPONSE_SERVER_URL}/mystudies-response-server/studymetadata\n+responseServerUrl=${RESPONSE_SERVER_URL}/studymetadata\n \n #clientId\n-WCPClientId=${CLIENT_ID}\n+security.oauth2.client.client-id=${CLIENT_ID}\n \n #SecretKey\n-WCPSecretKey=${SECRET_KEY}\n+security.oauth2.client.client-secret=${SECRET_KEY}\n \n ########################## Web Configuration Portal Web-Services (WCP WS) Configuration Details ENDS ##########################", "originalCommit": "41ed042c290f90e9c728ecb4655db57a88ba7b82", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg2NjI5Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/896#discussion_r495866297", "bodyText": "removed end styled comment", "author": "Kantharajut-btc", "createdAt": "2020-09-28T11:21:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcyNTA4OQ=="}], "type": "inlineReview"}, {"oid": "7b8472534abcf510f7714f3d2a72c1af555cfef0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/7b8472534abcf510f7714f3d2a72c1af555cfef0", "message": "Added DB reference link for properties\n\nAdded DB reference link for properties", "committedDate": "2020-09-18T12:10:24Z", "type": "commit"}, {"oid": "a92b1ff0d71c02ce6eb3a05f495cb149d4a0ee6f", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a92b1ff0d71c02ce6eb3a05f495cb149d4a0ee6f", "message": "Merge branch 'develop' into studybuilder-externalized-configuration", "committedDate": "2020-09-26T07:31:03Z", "type": "commit"}, {"oid": "55b40d36d8b8ee9f0210b8d958dbadf41f39dc2d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/55b40d36d8b8ee9f0210b8d958dbadf41f39dc2d", "message": "Merge branch 'develop' into studybuilder-externalized-configuration", "committedDate": "2020-09-26T12:41:06Z", "type": "commit"}, {"oid": "1ddd120a5d238b8909d92c594443524d6b1fe35d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1ddd120a5d238b8909d92c594443524d6b1fe35d", "message": "removed end styled comment\n\nremoved end styled comment", "committedDate": "2020-09-28T11:20:12Z", "type": "commit"}]}