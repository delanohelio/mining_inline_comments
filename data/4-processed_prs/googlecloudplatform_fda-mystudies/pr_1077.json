{"pr_number": 1077, "pr_title": "Study Builder - Audit log Implementation for StudyController with Test Cases", "pr_createdAt": "2020-09-29T15:03:18Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1077", "timeline": [{"oid": "fb228fb2fbb26a781810f3b20aa6e1124750928c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/fb228fb2fbb26a781810f3b20aa6e1124750928c", "message": "Added test cases in studyController\n\nAdded test cases in studyController.\nFormat + organize import", "committedDate": "2020-09-29T15:00:31Z", "type": "commit"}, {"oid": "cc39d388c37b9c6598c245aad036a840decccecb", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/cc39d388c37b9c6598c245aad036a840decccecb", "message": "Merge branch 'develop' into study-builder-studyController-auditlog-test", "committedDate": "2020-09-29T15:04:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg3NDE0MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1077#discussion_r496874140", "bodyText": "typo here, please fix", "author": "saminguyen", "createdAt": "2020-09-29T16:25:12Z", "path": "WCP/fdahpStudyDesigner/src/test/java/com/fdahpstudydesigner/controller/StudyControllerTest.java", "diffHunk": "@@ -470,4 +488,435 @@ public void shouldSaveOrUpdateSyudySettings() throws Exception {\n \n     verifyAuditEventCall(STUDY_SETTINGS_SAVED_OR_UPDATED);\n   }\n+\n+  @Test\n+  public void shouldSaveOrUpdateStudyConsentSection() throws Exception {\n+    HttpHeaders headers = getCommonHeaders();\n+\n+    SessionObject session = new SessionObject();\n+    session.setUserId(Integer.parseInt(USER_ID_VALUE));\n+    session.setStudySession(new ArrayList<>(Arrays.asList(0)));\n+    session.setSessionId(UUID.randomUUID().toString());\n+\n+    HashMap<String, Object> sessionAttributes = getSessionAttributes();\n+    sessionAttributes.put(FdahpStudyDesignerConstants.SESSION_OBJECT, session);\n+    sessionAttributes.put(STUDY_ID_ATTR_NAME, STUDY_ID_VALUE);\n+    sessionAttributes.put(CUSTOM_STUDY_ID_ATTR_NAME, CUSTOM_STUDY_ID_VALUE);\n+\n+    ConsentInfoBo ConsentInfoBo = new ConsentInfoBo();\n+    ConsentInfoBo.setStudyId(678574);\n+\n+    MockHttpServletRequestBuilder requestBuilder =\n+        post(PathMappingUri.SAVE_OR_UPDATE_CONSENT_INFO.getPath())\n+            .headers(headers)\n+            .sessionAttrs(sessionAttributes);\n+\n+    addParams(requestBuilder, ConsentInfoBo);\n+    mockMvc\n+        .perform(requestBuilder)\n+        .andDo(print())\n+        .andExpect(status().isFound())\n+        .andExpect(view().name(\"redirect:/adminStudies/consentListPage.do\"));\n+\n+    verifyAuditEventCall(STUDY_CONSENT_SECTIONS_SAVED_OR_UPDATED);\n+  }\n+\n+  @Test\n+  public void shouldCompleteSyudySettings() throws Exception {", "originalCommit": "cc39d388c37b9c6598c245aad036a840decccecb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg4Njg3Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1077#discussion_r496886873", "bodyText": "Fixed review comment", "author": "harisboston", "createdAt": "2020-09-29T16:43:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg3NDE0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg3OTUxOQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1077#discussion_r496879519", "bodyText": "Why are we changing these values. Also this makes CUSTOM_STUDY_ID_VALUE an unused var, please remove if not needed", "author": "saminguyen", "createdAt": "2020-09-29T16:32:17Z", "path": "WCP/fdahpStudyDesigner/src/test/java/com/fdahpstudydesigner/controller/StudyControllerTest.java", "diffHunk": "@@ -326,12 +344,12 @@ public void shouldLaunchStudy() throws Exception {\n \n     HashMap<String, Object> sessionAttributes = getSessionAttributes();\n     sessionAttributes.put(FdahpStudyDesignerConstants.SESSION_OBJECT, session);\n-    sessionAttributes.put(CUSTOM_STUDY_ID_ATTR_NAME, CUSTOM_STUDY_ID_VALUE);\n+    sessionAttributes.put(CUSTOM_STUDY_ID_ATTR_NAME, \"678595\");", "originalCommit": "cc39d388c37b9c6598c245aad036a840decccecb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg5Mzc5Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1077#discussion_r496893796", "bodyText": "Since multiple test cases are using common table, so it will override the values and effect other test case.\nso we need to have different rows and respective ID's.\nCUSTOM_STUDY_ID_VALUE is used in many places, modified the value only for effected test cases.", "author": "harisboston", "createdAt": "2020-09-29T16:53:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg3OTUxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg4MDQzMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1077#discussion_r496880432", "bodyText": "store this in a constant?", "author": "saminguyen", "createdAt": "2020-09-29T16:33:41Z", "path": "WCP/fdahpStudyDesigner/src/test/java/com/fdahpstudydesigner/controller/StudyControllerTest.java", "diffHunk": "@@ -470,4 +488,435 @@ public void shouldSaveOrUpdateSyudySettings() throws Exception {\n \n     verifyAuditEventCall(STUDY_SETTINGS_SAVED_OR_UPDATED);\n   }\n+\n+  @Test\n+  public void shouldSaveOrUpdateStudyConsentSection() throws Exception {\n+    HttpHeaders headers = getCommonHeaders();\n+\n+    SessionObject session = new SessionObject();\n+    session.setUserId(Integer.parseInt(USER_ID_VALUE));\n+    session.setStudySession(new ArrayList<>(Arrays.asList(0)));\n+    session.setSessionId(UUID.randomUUID().toString());\n+\n+    HashMap<String, Object> sessionAttributes = getSessionAttributes();\n+    sessionAttributes.put(FdahpStudyDesignerConstants.SESSION_OBJECT, session);\n+    sessionAttributes.put(STUDY_ID_ATTR_NAME, STUDY_ID_VALUE);\n+    sessionAttributes.put(CUSTOM_STUDY_ID_ATTR_NAME, CUSTOM_STUDY_ID_VALUE);\n+\n+    ConsentInfoBo ConsentInfoBo = new ConsentInfoBo();\n+    ConsentInfoBo.setStudyId(678574);", "originalCommit": "cc39d388c37b9c6598c245aad036a840decccecb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg4OTU5NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1077#discussion_r496889595", "bodyText": "Fixed review comment", "author": "harisboston", "createdAt": "2020-09-29T16:47:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg4MDQzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg4MDcwOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1077#discussion_r496880708", "bodyText": "similar as above", "author": "saminguyen", "createdAt": "2020-09-29T16:33:57Z", "path": "WCP/fdahpStudyDesigner/src/test/java/com/fdahpstudydesigner/controller/StudyControllerTest.java", "diffHunk": "@@ -470,4 +488,435 @@ public void shouldSaveOrUpdateSyudySettings() throws Exception {\n \n     verifyAuditEventCall(STUDY_SETTINGS_SAVED_OR_UPDATED);\n   }\n+\n+  @Test\n+  public void shouldSaveOrUpdateStudyConsentSection() throws Exception {\n+    HttpHeaders headers = getCommonHeaders();\n+\n+    SessionObject session = new SessionObject();\n+    session.setUserId(Integer.parseInt(USER_ID_VALUE));\n+    session.setStudySession(new ArrayList<>(Arrays.asList(0)));\n+    session.setSessionId(UUID.randomUUID().toString());\n+\n+    HashMap<String, Object> sessionAttributes = getSessionAttributes();\n+    sessionAttributes.put(FdahpStudyDesignerConstants.SESSION_OBJECT, session);\n+    sessionAttributes.put(STUDY_ID_ATTR_NAME, STUDY_ID_VALUE);\n+    sessionAttributes.put(CUSTOM_STUDY_ID_ATTR_NAME, CUSTOM_STUDY_ID_VALUE);\n+\n+    ConsentInfoBo ConsentInfoBo = new ConsentInfoBo();\n+    ConsentInfoBo.setStudyId(678574);\n+\n+    MockHttpServletRequestBuilder requestBuilder =\n+        post(PathMappingUri.SAVE_OR_UPDATE_CONSENT_INFO.getPath())\n+            .headers(headers)\n+            .sessionAttrs(sessionAttributes);\n+\n+    addParams(requestBuilder, ConsentInfoBo);\n+    mockMvc\n+        .perform(requestBuilder)\n+        .andDo(print())\n+        .andExpect(status().isFound())\n+        .andExpect(view().name(\"redirect:/adminStudies/consentListPage.do\"));\n+\n+    verifyAuditEventCall(STUDY_CONSENT_SECTIONS_SAVED_OR_UPDATED);\n+  }\n+\n+  @Test\n+  public void shouldCompleteSyudySettings() throws Exception {\n+    HttpHeaders headers = getCommonHeaders();\n+\n+    SessionObject session = new SessionObject();\n+    session.setUserId(Integer.parseInt(STUDY_ID_VALUE));\n+    session.setStudySession(new ArrayList<>(Arrays.asList(0)));\n+    session.setSessionId(UUID.randomUUID().toString());\n+\n+    HashMap<String, Object> sessionAttributes = getSessionAttributes();\n+    sessionAttributes.put(FdahpStudyDesignerConstants.SESSION_OBJECT, session);\n+    sessionAttributes.put(CUSTOM_STUDY_ID_ATTR_NAME, STUDY_ID_VALUE);\n+\n+    StudyBo studyBo = new StudyBo();\n+    studyBo.setId(678574);", "originalCommit": "cc39d388c37b9c6598c245aad036a840decccecb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg4OTc4NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1077#discussion_r496889784", "bodyText": "Fixed review comment", "author": "harisboston", "createdAt": "2020-09-29T16:47:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg4MDcwOA=="}], "type": "inlineReview"}, {"oid": "39830d3eac8d3a3737cea3f405b0367ad8825da7", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/39830d3eac8d3a3737cea3f405b0367ad8825da7", "message": "Assigned constant var\n\nAssigned constant var", "committedDate": "2020-09-29T16:55:12Z", "type": "commit"}, {"oid": "6a3a9015d6a34ce7e15ecd14291b9b3746b74496", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6a3a9015d6a34ce7e15ecd14291b9b3746b74496", "message": "Merge branch 'study-builder-studyController-auditlog-test' of https://github.com/GoogleCloudPlatform/fda-mystudies into study-builder-studyController-auditlog-test", "committedDate": "2020-09-29T16:55:34Z", "type": "commit"}, {"oid": "aaea4dda6c853c6da450656fa3a5703fba15fcd0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/aaea4dda6c853c6da450656fa3a5703fba15fcd0", "message": "Merge branch 'develop' into study-builder-studyController-auditlog-test", "committedDate": "2020-09-29T16:58:21Z", "type": "commit"}, {"oid": "0b850695fd72510eb3fec463ba8cf1d338dd2ce4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0b850695fd72510eb3fec463ba8cf1d338dd2ce4", "message": "Merge branch 'develop' into study-builder-studyController-auditlog-test", "committedDate": "2020-09-30T01:50:29Z", "type": "commit"}]}