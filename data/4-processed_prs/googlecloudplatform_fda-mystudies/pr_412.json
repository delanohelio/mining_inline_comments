{"pr_number": 412, "pr_title": "update docs and scripts", "pr_createdAt": "2020-05-21T16:52:17Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/412", "timeline": [{"oid": "45d373a49a58f4c74ecd615c9790e9a6e1bfb8c8", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/45d373a49a58f4c74ecd615c9790e9a6e1bfb8c8", "message": "update docs and scripts", "committedDate": "2020-05-21T16:51:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc4ODUzMw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/412#discussion_r428788533", "bodyText": "I'm wondering if git mv would be better for git history purpose, but this PR is good as is.", "author": "kuoyuchi", "createdAt": "2020-05-21T17:04:41Z", "path": "Terraform/rename.sh", "diffHunk": "@@ -53,17 +72,16 @@ do\n   cp -r ${SRC_PROJ_BASE}-$d/project ${DST_PROJ_BASE}-$d/\n done\n \n-# Phase 2\n-cp -r ${SRC_PROJ_BASE}-networks/networks ${DST_PROJ_BASE}-networks/\n-cp -r ${SRC_PROJ_BASE}-data/data ${DST_PROJ_BASE}-data/\n-cp -r ${SRC_PROJ_BASE}-resp-firebase/firebase ${DST_PROJ_BASE}-resp-firebase/\n+# Deployment Phase 2 - Uncomment after Phase 1 is deployed\n+# cp -r ${SRC_PROJ_BASE}-networks/networks ${DST_PROJ_BASE}-networks/", "originalCommit": "45d373a49a58f4c74ecd615c9790e9a6e1bfb8c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgzMzM0Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/412#discussion_r428833347", "bodyText": "I just tried it and seems that only works for moving within the same git repo.", "author": "xingao267", "createdAt": "2020-05-21T18:25:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc4ODUzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc5NTEwMA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/412#discussion_r428795100", "bodyText": "I wonder if we can create a link instead, e.g. comment out [GCS backend](../bootstrap/main.tf#L32-L35)", "author": "zohrehj", "createdAt": "2020-05-21T17:16:34Z", "path": "Terraform/README.md", "diffHunk": "@@ -97,72 +97,140 @@ To see what resources each deployment provisions, check out the comments in each\n \n ## Deployment Steps\n \n-1.  Authenticate as a super admin using `gcloud auth login [ACCOUNT]`.\n+1. Authenticate as a super admin using `gcloud auth login [ACCOUNT]`.\n \n     WARNING: remember to run `gcloud auth revoke` to logout as a super admin.\n     Being logged in as a super admin beyond the initial setup is dangerous!\n \n-1.  Checkout the Terraform configs and set some helper environment variables.\n+1. Checkout the Terraform configs and set some helper environment variables.\n \n-    ```\n-    $ git clone my-repo\n-    $ cd my-repo\n-    $ ROOT=$PWD\n+    ```bash\n+    git clone my-repo\n+    cd my-repo\n+    ROOT=$PWD\n     ```\n \n     If you would like to deploy the same infrastructure based on the Terraform\n     configs in this directory but in a different organization with different\n-    resource prefix or namings, use the `rename.sh` script.\n+    resource prefix or namings, use the `rename.sh` script with your environment\n+    specific values filled in. Note that `rename.sh` should be run several times\n+    with corresponding deployment phase block uncommented. Cross reference this\n+    `README.md` file and documentations in the `rename.sh` together do complete\n+    the deployment.\n \n-1.  The bootstrap config must be deployed first in order to create the `devops`\n-    project which will host your Terraform state and CICD pipelines.\n+    `rename.sh` script uses configs in this directory and copy them over with value\n+    substitutions to a target local directory to host your new final Terraform configs.\n \n-    ```\n-    $ cd $ROOT/bootstrap\n-    $ terraform init\n-    $ terraform plan\n-    $ terraform apply\n+1. Run `rename.sh` in this directory (later referenced as the original directory) to\n+    copy the Deployment Phase 1 configs to your target directory.\n+\n+1. Go to the target directory.\n+\n+1. Deploy the `$ROOT/bootstrap/` folder first to create the `devops` project and\n+    Terraform state bucket.\n+\n+    Make sure in your first deployment in a new organization, Comment out the `backend`\n+    block (L32-35) in `$ROOT/bootstrap/main.tf` first.\n+\n+    ```bash\n+    cd $ROOT/bootstrap\n+    terraform init\n+    terraform apply\n     ```\n \n     Your `devops` project should now be ready.\n \n-1.  Backup the state of the `devops` project to the newly created state bucket\n-    by uncommenting out the `terraform` block in `$ROOT/bootstrap/main.tf` and\n-    running:\n+1. Backup the state of the `devops` project to the newly created state bucket", "originalCommit": "45d373a49a58f4c74ecd615c9790e9a6e1bfb8c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg1NDExNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/412#discussion_r428854115", "bodyText": "Done. Thanks for the suggestion. This is great!", "author": "xingao267", "createdAt": "2020-05-21T19:05:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc5NTEwMA=="}], "type": "inlineReview"}, {"oid": "41b481baac8458bd562c8ac1dd883fc5b3e804a7", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/41b481baac8458bd562c8ac1dd883fc5b3e804a7", "message": "add link", "committedDate": "2020-05-21T18:56:06Z", "type": "commit"}, {"oid": "8236b03721b201d6b5e85f7951657f42e45b5fdc", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8236b03721b201d6b5e85f7951657f42e45b5fdc", "message": "fix links", "committedDate": "2020-05-21T18:59:23Z", "type": "commit"}, {"oid": "4489f0c4e7fd2b4aa273e510915df7d22815e4df", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4489f0c4e7fd2b4aa273e510915df7d22815e4df", "message": "more links", "committedDate": "2020-05-21T19:03:53Z", "type": "commit"}, {"oid": "0847be24f470efe27e27807e188ccc677c769a22", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0847be24f470efe27e27807e188ccc677c769a22", "message": "more doc", "committedDate": "2020-05-21T19:08:00Z", "type": "commit"}, {"oid": "3fdc6de931af0a1a80b0b19a9d8a37e0f125bdbc", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3fdc6de931af0a1a80b0b19a9d8a37e0f125bdbc", "message": "Add mobile app secrets copy to sql instruction.", "committedDate": "2020-05-21T20:46:25Z", "type": "commit"}]}