{"pr_number": 765, "pr_title": "Participant manager email service implementation for add new user and update user apis", "pr_createdAt": "2020-08-18T06:22:24Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/765", "timeline": [{"oid": "6935a620a482b1859de6f20940a7d190dc8a0c30", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6935a620a482b1859de6f20940a7d190dc8a0c30", "message": "email service has been implemented for add new user as well as update user", "committedDate": "2020-08-18T05:57:16Z", "type": "commit"}, {"oid": "505e2022be4371e7da03c9a6cf2e2bf8e30879ae", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/505e2022be4371e7da03c9a6cf2e2bf8e30879ae", "message": "Merge branch 'participant-manager-get-consent-document' of https://github.com/GoogleCloudPlatform/fda-mystudies into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis", "committedDate": "2020-08-18T06:03:32Z", "type": "commit"}, {"oid": "521e965e059712498cd7759624fe9e7af01f4521", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/521e965e059712498cd7759624fe9e7af01f4521", "message": "Merge branch 'develop' of https://github.com/GoogleCloudPlatform/fda-mystudies into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis\n\n# Conflicts:\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/config/AppPropertyConfig.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/UserMapper.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/ManageUserServiceImpl.java", "committedDate": "2020-08-20T15:12:41Z", "type": "commit"}, {"oid": "2017887be1d942f720a6ba278f5827bd702c55f5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/2017887be1d942f720a6ba278f5827bd702c55f5", "message": "Merge branch 'develop' into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis", "committedDate": "2020-08-20T15:15:14Z", "type": "commit"}, {"oid": "24b9918668b7e55ac8c5bfae57f4b6f44d969097", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/24b9918668b7e55ac8c5bfae57f4b6f44d969097", "message": "Merge branch 'develop' of https://github.com/GoogleCloudPlatform/fda-mystudies into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis", "committedDate": "2020-08-20T15:25:01Z", "type": "commit"}, {"oid": "217ee566ea17ea42ea90f756b104f95dc278b284", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/217ee566ea17ea42ea90f756b104f95dc278b284", "message": "Merge branch 'develop' into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis", "committedDate": "2020-08-20T15:54:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA5MjAyNA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/765#discussion_r474092024", "bodyText": "This is not sufficient. Since you have different MimeMessage constructed for sendInvitationEmail() and sendUserUpdatedEmail() that should be reflected in unit testing also.", "author": "saminguyen", "createdAt": "2020-08-20T15:54:41Z", "path": "participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserControllerTest.java", "diffHunk": "@@ -210,6 +217,8 @@ public void shouldCreateSuperAdminUser() throws Exception {\n             .andExpect(jsonPath(\"$.userId\", notNullValue()))\n             .andReturn();\n \n+    verify(emailSender, atLeastOnce()).send(isA(MimeMessage.class));", "originalCommit": "2017887be1d942f720a6ba278f5827bd702c55f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA5MjczMA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/765#discussion_r474092730", "bodyText": "https://stackoverflow.com/questions/16854993/how-do-i-test-the-javamailsender-of-spring There is an example of testing for how MimeMessage was formed using Mockito in the second response here. I think this would be a helpful example", "author": "saminguyen", "createdAt": "2020-08-20T15:55:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA5MjAyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUwMzA4OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/765#discussion_r474503089", "bodyText": "Thanks for sharing the SO post. This configuration has been implemented in AppConfigTest class.", "author": "chiranjibi009", "createdAt": "2020-08-21T08:09:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA5MjAyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjA5MjIxNA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/765#discussion_r476092214", "bodyText": "I looked at the AppConfigtest. I was saying that we should not just check for isA(MimeMessage.class) but also the content of the message being sent", "author": "saminguyen", "createdAt": "2020-08-25T02:48:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA5MjAyNA=="}], "type": "inlineReview"}, {"oid": "8ea92f42ac900a026a06313ac25cf3155c56565a", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8ea92f42ac900a026a06313ac25cf3155c56565a", "message": "Merge branch 'develop' into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis", "committedDate": "2020-08-21T06:21:28Z", "type": "commit"}, {"oid": "f5dadc5e7fad101675e5cfb0871818b9df752d4b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f5dadc5e7fad101675e5cfb0871818b9df752d4b", "message": "Merge branch 'participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis' of https://github.com/GoogleCloudPlatform/fda-mystudies into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis", "committedDate": "2020-08-21T08:30:35Z", "type": "commit"}, {"oid": "1cb24fa1f7a43ca0b620688ad7611f68e621191d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1cb24fa1f7a43ca0b620688ad7611f68e621191d", "message": "Merge branch 'develop' into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis", "committedDate": "2020-08-21T19:47:58Z", "type": "commit"}, {"oid": "da0863da968e95a832414f96a5c379b3c1d70151", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/da0863da968e95a832414f96a5c379b3c1d70151", "message": "Merge branch 'develop' of https://github.com/GoogleCloudPlatform/fda-mystudies into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis\n\n# Conflicts:\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/ManageUserServiceImpl.java\n#\tparticipant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserControllerTest.java", "committedDate": "2020-08-25T05:51:24Z", "type": "commit"}, {"oid": "89447051d9761328566ff66e11871d979f83e347", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/89447051d9761328566ff66e11871d979f83e347", "message": "Merge branch 'develop' into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis", "committedDate": "2020-08-26T22:11:47Z", "type": "commit"}, {"oid": "d142c00b39af2ae7ff7094f5029cae4f94bc0d75", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d142c00b39af2ae7ff7094f5029cae4f94bc0d75", "message": "add MimeMessage test example", "committedDate": "2020-08-27T01:46:32Z", "type": "commit"}, {"oid": "fd40fa0396519cda091a9f85d03277e771f49cc9", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/fd40fa0396519cda091a9f85d03277e771f49cc9", "message": "Merge branch 'participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis' of https://github.com/GoogleCloudPlatform/fda-mystudies into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis", "committedDate": "2020-08-27T01:55:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzkxMzM1Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/765#discussion_r477913353", "bodyText": "@chiranjibi009 I added some sample test code in here for your reference. Please make sure to test for other fields of MimeMessage, too. Sorry about missing this while reviewing PR #711. We should add a quick TODO for adding to the tests there also.", "author": "saminguyen", "createdAt": "2020-08-27T02:00:04Z", "path": "participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserControllerTest.java", "diffHunk": "@@ -221,7 +222,10 @@ public void shouldCreateSuperAdminUser() throws Exception {\n             .andExpect(jsonPath(\"$.userId\", notNullValue()))\n             .andReturn();\n \n-    verify(emailSender, atLeastOnce()).send(isA(MimeMessage.class));\n+    ArgumentCaptor<MimeMessage> mimeMessageArgumentCaptor = ArgumentCaptor.forClass(MimeMessage.class);\n+    verify(emailSender, atLeastOnce()).send(mimeMessageArgumentCaptor.capture());\n+    MimeMessage capturedMimeMessage = mimeMessageArgumentCaptor.getValue();\n+    assertEquals(capturedMimeMessage.getAllRecipients()[0].toString(), TestConstants.USER_EMAIL_VALUE);", "originalCommit": "d142c00b39af2ae7ff7094f5029cae4f94bc0d75", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9bf077c44f80208bb81321c31f34c4aa4f5d79ab", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/9bf077c44f80208bb81321c31f34c4aa4f5d79ab", "message": "Merge branch 'develop' of https://github.com/GoogleCloudPlatform/fda-mystudies into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis", "committedDate": "2020-08-27T06:53:27Z", "type": "commit"}, {"oid": "c1227ee1344c8332a4c0de164d3c5233be7b16d9", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c1227ee1344c8332a4c0de164d3c5233be7b16d9", "message": "Merge branch 'develop' into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis", "committedDate": "2020-08-27T12:21:32Z", "type": "commit"}, {"oid": "9b5fe8e3f73fe6e6e43bb2815e03c6bc57d2f1a0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/9b5fe8e3f73fe6e6e43bb2815e03c6bc57d2f1a0", "message": "Merge branch 'participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis' of https://github.com/GoogleCloudPlatform/fda-mystudies into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis", "committedDate": "2020-08-27T12:28:10Z", "type": "commit"}, {"oid": "d69eee42043671745299ae525888a166f4ec17ec", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d69eee42043671745299ae525888a166f4ec17ec", "message": "Merge branch 'develop' into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis", "committedDate": "2020-08-28T06:16:31Z", "type": "commit"}, {"oid": "88d4c91a94d52d9d3431b8dd39c6f614740f9d07", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/88d4c91a94d52d9d3431b8dd39c6f614740f9d07", "message": "Merge branch 'develop' into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis", "committedDate": "2020-08-28T06:30:32Z", "type": "commit"}, {"oid": "49b73a92ce5e35ac89115197faa8a511b9c292de", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/49b73a92ce5e35ac89115197faa8a511b9c292de", "message": "Merge branch 'develop' into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis", "committedDate": "2020-09-01T07:03:32Z", "type": "commit"}, {"oid": "cacf03ef602be9dd9e731597abdc3f1721656840", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/cacf03ef602be9dd9e731597abdc3f1721656840", "message": "email service configuration added as per common service", "committedDate": "2020-09-07T07:52:09Z", "type": "commit"}, {"oid": "eaf118e48a41960a0aa4eda6db365fcb65eb23fa", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/eaf118e48a41960a0aa4eda6db365fcb65eb23fa", "message": "Added verifyMimeMessage to BaseMockIT\n\nAdded verifyMimeMessage to BaseMockIT", "committedDate": "2020-09-10T09:55:32Z", "type": "commit"}, {"oid": "5e955765199c60cab0d7e6245015aa15e920be1a", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5e955765199c60cab0d7e6245015aa15e920be1a", "message": "Merge branch 'participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis' of https://github.com/GoogleCloudPlatform/fda-mystudies into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis\n\n# Conflicts:\n#\tparticipant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserControllerTest.java", "committedDate": "2020-09-10T13:10:14Z", "type": "commit"}, {"oid": "e003fc04d948d4fbb7e21cd97b817ceec00aa363", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e003fc04d948d4fbb7e21cd97b817ceec00aa363", "message": "Fixed Review Comment\n\nFixed Review Comment", "committedDate": "2020-09-11T09:03:46Z", "type": "commit"}, {"oid": "dff19588d900087a1057a064d543ef4ee3a0f3c8", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/dff19588d900087a1057a064d543ef4ee3a0f3c8", "message": "Merge branch 'develop' into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis", "committedDate": "2020-09-11T09:28:09Z", "type": "commit"}, {"oid": "35770f54ca571747e85a3e0f0d3f0b0206a172a4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/35770f54ca571747e85a3e0f0d3f0b0206a172a4", "message": "Merge branch 'develop' into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis", "committedDate": "2020-09-14T08:12:35Z", "type": "commit"}, {"oid": "ab046f52e50fdf828f24aedabe79568f5f6f2f85", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ab046f52e50fdf828f24aedabe79568f5f6f2f85", "message": "replaced \"@\" with \"{{\" and \"}}\"\n\nreplaced \"@\" with \"{{\" and \"}}\"", "committedDate": "2020-09-14T13:09:41Z", "type": "commit"}, {"oid": "dbf428bfce1a08ee21cad50b9418c9bf829ab60f", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/dbf428bfce1a08ee21cad50b9418c9bf829ab60f", "message": "Merge branch 'develop' into participant-manager-email-service-implementation-for-add-new-user-and-update-user-apis", "committedDate": "2020-09-14T19:01:18Z", "type": "commit"}]}