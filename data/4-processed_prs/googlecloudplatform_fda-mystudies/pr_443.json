{"pr_number": 443, "pr_title": "Integration test changes for enroll mgmt bundle", "pr_createdAt": "2020-06-04T09:29:18Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443", "timeline": [{"oid": "6a7c78a8365f5a7ab7d3764349c13b7a2e8230ad", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6a7c78a8365f5a7ab7d3764349c13b7a2e8230ad", "message": "code commit for enroll mgmt bundle( for ParticipantInformationController and EnrollmentTokenController only )  integration test changes", "committedDate": "2020-06-04T09:26:31Z", "type": "commit"}, {"oid": "d295d8826e528ad8d2c78ab43f897ae9860d1a4b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d295d8826e528ad8d2c78ab43f897ae9860d1a4b", "message": "failed to bind exception issue fix for port 8001", "committedDate": "2020-06-04T10:17:18Z", "type": "commit"}, {"oid": "76311a052e7bff655d0e726f62f03584496fda33", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/76311a052e7bff655d0e726f62f03584496fda33", "message": "port changed to 8002", "committedDate": "2020-06-04T10:19:50Z", "type": "commit"}, {"oid": "5ec16c233f5b849742a607de7d0adc42ecea6dac", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5ec16c233f5b849742a607de7d0adc42ecea6dac", "message": "PR build check failed fix", "committedDate": "2020-06-04T11:15:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk2MjQ2Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r436962466", "bodyText": "performGet?", "author": "nikklassen", "createdAt": "2020-06-08T19:53:04Z", "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/EnrollmentTokenControllerTest.java", "diffHunk": "@@ -0,0 +1,185 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.EnrollmentBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.EnrollmentTokenController;\n+import com.google.cloud.healthcare.fdamystudies.service.EnrollmentTokenService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+\n+public class EnrollmentTokenControllerTest extends BaseMockIT {\n+\n+  private static final String PING_PATH = \"/ping\";\n+  private static final String VALIDATE_ENROLLMENT_TOKEN_PATH = \"/validateEnrollmentToken\";\n+  private static final String ENROLL_PATH = \"/enroll\";\n+\n+  @Autowired private EnrollmentTokenController controller;\n+  @Autowired private EnrollmentTokenService enrollmentTokenService;\n+\n+  @Test\n+  public void contextLoads() {\n+    assertNotNull(controller);\n+    assertNotNull(mockMvc);\n+    assertNotNull(enrollmentTokenService);\n+  }\n+\n+  @Test\n+  public void ping() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    mockMvc.perform(get(PING_PATH).headers(headers)).andDo(print()).andExpect(status().isOk());", "originalCommit": "5ec16c233f5b849742a607de7d0adc42ecea6dac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI1MDg0MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r437250840", "bodyText": "changed to performGet", "author": "aswinijena100", "createdAt": "2020-06-09T09:02:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk2MjQ2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk2NDIwOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r436964208", "bodyText": "put instead of remove then add.", "author": "nikklassen", "createdAt": "2020-06-08T19:56:23Z", "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/EnrollmentTokenControllerTest.java", "diffHunk": "@@ -0,0 +1,185 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.EnrollmentBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.EnrollmentTokenController;\n+import com.google.cloud.healthcare.fdamystudies.service.EnrollmentTokenService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+\n+public class EnrollmentTokenControllerTest extends BaseMockIT {\n+\n+  private static final String PING_PATH = \"/ping\";\n+  private static final String VALIDATE_ENROLLMENT_TOKEN_PATH = \"/validateEnrollmentToken\";\n+  private static final String ENROLL_PATH = \"/enroll\";\n+\n+  @Autowired private EnrollmentTokenController controller;\n+  @Autowired private EnrollmentTokenService enrollmentTokenService;\n+\n+  @Test\n+  public void contextLoads() {\n+    assertNotNull(controller);\n+    assertNotNull(mockMvc);\n+    assertNotNull(enrollmentTokenService);\n+  }\n+\n+  @Test\n+  public void ping() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    mockMvc.perform(get(PING_PATH).headers(headers)).andDo(print()).andExpect(status().isOk());\n+  }\n+\n+  @Test\n+  public void validateEnrollmentTokenSuccess() throws Exception {\n+\n+    String requestJson = getEnrollmentJson(Constants.TOKEN, Constants.STUDYOF_HEALTH);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void validateEnrollmentTokenBadRequests() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    // without study id\n+    String requestJson = getEnrollmentJson(Constants.TOKEN, null);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // without token\n+    requestJson = getEnrollmentJson(null, Constants.STUDYOF_HEALTH_CLOSE);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // unkown token id\n+    requestJson = getEnrollmentJson(Constants.UNKOWN_TOKEN, Constants.STUDYOF_HEALTH);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+  }\n+\n+  @Test\n+  public void validateEnrollmentTokenForbidden() throws Exception {\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    // study id not exists\n+    String requestJson = getEnrollmentJson(Constants.TOKEN, Constants.STUDYID_NOT_EXIST);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", FORBIDDEN);\n+\n+    // token already use\n+    requestJson = getEnrollmentJson(Constants.TOKEN_ALREADY_USED, Constants.STUDYOF_HEALTH_1);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", FORBIDDEN);\n+  }\n+\n+  @Test\n+  public void validateEnrollmentTokenUnAuthorised() throws Exception {\n+    // without userId header\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+    headers.remove(Constants.USER_ID_HEADER);\n+\n+    String requestJson = getEnrollmentJson(Constants.TOKEN, Constants.STUDYOF_HEALTH);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", UNAUTHORIZED);\n+  }\n+\n+  @Test\n+  public void enrollParticipantSuccessStudyTypeClose() throws Exception {\n+\n+    // study type close\n+    String requestJson = getEnrollmentJson(Constants.TOKEN_NEW, Constants.STUDYOF_HEALTH_CLOSE);\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    performPost(ENROLL_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void enrollParticipantSuccessStudyTypeOpen() throws Exception {\n+    // study type open\n+    String requestJson = getEnrollmentJson(Constants.TOKEN_NEW, Constants.STUDYOF_HEALTH);\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    performPost(ENROLL_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void enrollParticipantSuccessNewUser() throws Exception {\n+    // new user id\n+    String requestJson = getEnrollmentJson(Constants.TOKEN_NEW, Constants.STUDYOF_HEALTH);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+    headers.remove(Constants.USER_ID_HEADER);\n+    headers.add(Constants.USER_ID_HEADER, Constants.NEW_USER_ID);", "originalCommit": "5ec16c233f5b849742a607de7d0adc42ecea6dac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI1MzA5Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r437253096", "bodyText": "\"put\" we cannot use its accepting List instead of this we used \"set\"", "author": "aswinijena100", "createdAt": "2020-06-09T09:04:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk2NDIwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk2NzUyOQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r436967529", "bodyText": "Just add this to the common headers, all requests are JSON.", "author": "nikklassen", "createdAt": "2020-06-08T20:02:59Z", "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/testutils/TestUtils.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.google.cloud.healthcare.fdamystudies.testutils;\n+\n+import javax.ws.rs.core.MediaType;\n+import org.springframework.http.HttpHeaders;\n+\n+public class TestUtils {\n+\n+  public static void addUserIdHeader(HttpHeaders headers) {\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+  }\n+\n+  public static HttpHeaders getCommonHeaders() {\n+    HttpHeaders headers = new HttpHeaders();\n+    headers.add(Constants.CLIENT_TOKEN_HEADER, Constants.CLIENT_TOKEN_VALUE);\n+    headers.add(Constants.ACCESS_TOKEN_HEADER, Constants.ACCESS_TOKEN_VALUE);\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+    return headers;\n+  }\n+\n+  public static void addHeader(HttpHeaders headers, String headerName, String headerValue) {\n+    headers.add(headerName, headerValue);\n+  }\n+\n+  public static void addContentTypeAcceptHeaders(HttpHeaders headers) {\n+    addHeader(headers, HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON);", "originalCommit": "5ec16c233f5b849742a607de7d0adc42ecea6dac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI1NDQ0NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r437254445", "bodyText": "added inside getCommonHeaders", "author": "aswinijena100", "createdAt": "2020-06-09T09:06:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk2NzUyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk2ODIyMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r436968222", "bodyText": "This just obscures the function call. Remove it and use .add directly.", "author": "nikklassen", "createdAt": "2020-06-08T20:04:26Z", "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/testutils/TestUtils.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.google.cloud.healthcare.fdamystudies.testutils;\n+\n+import javax.ws.rs.core.MediaType;\n+import org.springframework.http.HttpHeaders;\n+\n+public class TestUtils {\n+\n+  public static void addUserIdHeader(HttpHeaders headers) {\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+  }\n+\n+  public static HttpHeaders getCommonHeaders() {\n+    HttpHeaders headers = new HttpHeaders();\n+    headers.add(Constants.CLIENT_TOKEN_HEADER, Constants.CLIENT_TOKEN_VALUE);\n+    headers.add(Constants.ACCESS_TOKEN_HEADER, Constants.ACCESS_TOKEN_VALUE);\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+    return headers;\n+  }\n+\n+  public static void addHeader(HttpHeaders headers, String headerName, String headerValue) {", "originalCommit": "5ec16c233f5b849742a607de7d0adc42ecea6dac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI1MjU1MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r437252551", "bodyText": "removed addHeader method and used .add", "author": "aswinijena100", "createdAt": "2020-06-09T09:03:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk2ODIyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk2ODU0OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r436968548", "bodyText": "function is unused.", "author": "nikklassen", "createdAt": "2020-06-08T20:05:04Z", "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/testutils/TestUtils.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.google.cloud.healthcare.fdamystudies.testutils;\n+\n+import javax.ws.rs.core.MediaType;\n+import org.springframework.http.HttpHeaders;\n+\n+public class TestUtils {\n+\n+  public static void addUserIdHeader(HttpHeaders headers) {", "originalCommit": "5ec16c233f5b849742a607de7d0adc42ecea6dac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI1NDY4OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r437254688", "bodyText": "removed this unused method", "author": "aswinijena100", "createdAt": "2020-06-09T09:06:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk2ODU0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk4MTA5NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r436981095", "bodyText": "typo: unknown", "author": "nikklassen", "createdAt": "2020-06-08T20:29:25Z", "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/EnrollmentTokenControllerTest.java", "diffHunk": "@@ -0,0 +1,185 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.EnrollmentBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.EnrollmentTokenController;\n+import com.google.cloud.healthcare.fdamystudies.service.EnrollmentTokenService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+\n+public class EnrollmentTokenControllerTest extends BaseMockIT {\n+\n+  private static final String PING_PATH = \"/ping\";\n+  private static final String VALIDATE_ENROLLMENT_TOKEN_PATH = \"/validateEnrollmentToken\";\n+  private static final String ENROLL_PATH = \"/enroll\";\n+\n+  @Autowired private EnrollmentTokenController controller;\n+  @Autowired private EnrollmentTokenService enrollmentTokenService;\n+\n+  @Test\n+  public void contextLoads() {\n+    assertNotNull(controller);\n+    assertNotNull(mockMvc);\n+    assertNotNull(enrollmentTokenService);\n+  }\n+\n+  @Test\n+  public void ping() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    mockMvc.perform(get(PING_PATH).headers(headers)).andDo(print()).andExpect(status().isOk());\n+  }\n+\n+  @Test\n+  public void validateEnrollmentTokenSuccess() throws Exception {\n+\n+    String requestJson = getEnrollmentJson(Constants.TOKEN, Constants.STUDYOF_HEALTH);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void validateEnrollmentTokenBadRequests() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    // without study id\n+    String requestJson = getEnrollmentJson(Constants.TOKEN, null);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // without token\n+    requestJson = getEnrollmentJson(null, Constants.STUDYOF_HEALTH_CLOSE);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // unkown token id\n+    requestJson = getEnrollmentJson(Constants.UNKOWN_TOKEN, Constants.STUDYOF_HEALTH);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+  }\n+\n+  @Test\n+  public void validateEnrollmentTokenForbidden() throws Exception {\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    // study id not exists\n+    String requestJson = getEnrollmentJson(Constants.TOKEN, Constants.STUDYID_NOT_EXIST);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", FORBIDDEN);\n+\n+    // token already use\n+    requestJson = getEnrollmentJson(Constants.TOKEN_ALREADY_USED, Constants.STUDYOF_HEALTH_1);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", FORBIDDEN);\n+  }\n+\n+  @Test\n+  public void validateEnrollmentTokenUnAuthorised() throws Exception {\n+    // without userId header\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+    headers.remove(Constants.USER_ID_HEADER);\n+\n+    String requestJson = getEnrollmentJson(Constants.TOKEN, Constants.STUDYOF_HEALTH);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", UNAUTHORIZED);\n+  }\n+\n+  @Test\n+  public void enrollParticipantSuccessStudyTypeClose() throws Exception {\n+\n+    // study type close\n+    String requestJson = getEnrollmentJson(Constants.TOKEN_NEW, Constants.STUDYOF_HEALTH_CLOSE);\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    performPost(ENROLL_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void enrollParticipantSuccessStudyTypeOpen() throws Exception {\n+    // study type open\n+    String requestJson = getEnrollmentJson(Constants.TOKEN_NEW, Constants.STUDYOF_HEALTH);\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    performPost(ENROLL_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void enrollParticipantSuccessNewUser() throws Exception {\n+    // new user id\n+    String requestJson = getEnrollmentJson(Constants.TOKEN_NEW, Constants.STUDYOF_HEALTH);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+    headers.remove(Constants.USER_ID_HEADER);\n+    headers.add(Constants.USER_ID_HEADER, Constants.NEW_USER_ID);\n+\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    performPost(ENROLL_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void enrollParticipantBadRequests() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    // without study id\n+    String requestJson = getEnrollmentJson(Constants.TOKEN_NEW, null);\n+    performPost(ENROLL_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // without token\n+    requestJson = getEnrollmentJson(null, Constants.STUDYOF_HEALTH_CLOSE);\n+    performPost(ENROLL_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // unkown token id", "originalCommit": "5ec16c233f5b849742a607de7d0adc42ecea6dac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI1NDk4Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r437254986", "bodyText": "typo corrected", "author": "aswinijena100", "createdAt": "2020-06-09T09:06:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk4MTA5NQ=="}], "type": "inlineReview"}, {"oid": "494f112308cb540d64b3a6ea6ad1a2fae6ff79a5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/494f112308cb540d64b3a6ea6ad1a2fae6ff79a5", "message": "PR #443 comment fixes", "committedDate": "2020-06-09T09:00:35Z", "type": "commit"}, {"oid": "6bca78ffdca30358134dda5971b54b5c40522bdf", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6bca78ffdca30358134dda5971b54b5c40522bdf", "message": "Merge branch 'early-access' into early-access-enroll-mgmt-integration-test-change", "committedDate": "2020-06-09T09:07:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ4NDY0MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r437484641", "bodyText": "I haven't seen this used anywhere else in our code. I don't think we should start using it here.", "author": "nikklassen", "createdAt": "2020-06-09T14:50:47Z", "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/EnrollmentTokenControllerTest.java", "diffHunk": "@@ -53,44 +51,47 @@ public void validateEnrollmentTokenSuccess() throws Exception {\n   public void validateEnrollmentTokenBadRequests() throws Exception {\n \n     HttpHeaders headers = TestUtils.getCommonHeaders();\n-    TestUtils.addContentTypeAcceptHeaders(headers);\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n \n     // without study id\n     String requestJson = getEnrollmentJson(Constants.TOKEN, null);\n-    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+    performPost(\n+        VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, StringUtils.EMPTY, BAD_REQUEST);", "originalCommit": "6bca78ffdca30358134dda5971b54b5c40522bdf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5MDU4Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r437490582", "bodyText": "did u mean for  StringUtils.EMPTY ? Shall I replace with  double quote only", "author": "aswinijena100", "createdAt": "2020-06-09T14:58:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ4NDY0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5NDQ0Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r437494446", "bodyText": "Yes. I prefer \"\" for consistency.", "author": "nikklassen", "createdAt": "2020-06-09T15:03:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ4NDY0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5NzIzNw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r437497237", "bodyText": "Thanks for the confirmation. Did the changes and committed the code.", "author": "aswinijena100", "createdAt": "2020-06-09T15:07:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ4NDY0MQ=="}], "type": "inlineReview"}, {"oid": "dfecdf067c9bd77da1b2b047e58d354fc47bc113", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/dfecdf067c9bd77da1b2b047e58d354fc47bc113", "message": "Merge branch 'early-access' into early-access-enroll-mgmt-integration-test-change", "committedDate": "2020-06-09T14:59:08Z", "type": "commit"}, {"oid": "d9839b80b0456a23c5a8420cff7fe442396b23c7", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d9839b80b0456a23c5a8420cff7fe442396b23c7", "message": "removed StringUtils.EMPTY for code consistency", "committedDate": "2020-06-09T15:05:48Z", "type": "commit"}, {"oid": "81f3b63556beff9c06414b9b8bc2d5e294870a74", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/81f3b63556beff9c06414b9b8bc2d5e294870a74", "message": "Merge branch 'early-access-enroll-mgmt-integration-test-change' of https://github.com/GoogleCloudPlatform/fda-mystudies into early-access-enroll-mgmt-integration-test-change", "committedDate": "2020-06-09T15:05:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUxMDMwNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r437510306", "bodyText": "What about all the other usages?", "author": "nikklassen", "createdAt": "2020-06-09T15:17:57Z", "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/EnrollmentTokenControllerTest.java", "diffHunk": "@@ -170,7 +170,7 @@ public void enrollParticipantForbidden() throws Exception {\n \n     // study id not exists\n     requestJson = getEnrollmentJson(Constants.TOKEN_NEW, Constants.STUDYID_NOT_EXIST);\n-    performPost(ENROLL_PATH, requestJson, headers, StringUtils.EMPTY, FORBIDDEN);\n+    performPost(ENROLL_PATH, requestJson, headers, \"\", FORBIDDEN);", "originalCommit": "d9839b80b0456a23c5a8420cff7fe442396b23c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUyMzk2NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r437523964", "bodyText": "Sorry for the mistake. removed from all the usages.", "author": "aswinijena100", "createdAt": "2020-06-09T15:31:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUxMDMwNg=="}], "type": "inlineReview"}, {"oid": "a59c5249c71703945dff85a367cf8a764cb75e69", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a59c5249c71703945dff85a367cf8a764cb75e69", "message": "removed StringUtils.EMPTY", "committedDate": "2020-06-09T15:29:40Z", "type": "commit"}, {"oid": "b19ceb9b4e3d7070021276e607b7c381235d6836", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/b19ceb9b4e3d7070021276e607b7c381235d6836", "message": "Stringutils.empty removed", "committedDate": "2020-06-09T15:35:06Z", "type": "commit"}, {"oid": "c4eab6963e878b6cc286c466769f7716e2795f7a", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c4eab6963e878b6cc286c466769f7716e2795f7a", "message": "further commit to PR comment fixes", "committedDate": "2020-06-10T04:42:47Z", "type": "commit"}, {"oid": "e9b099ac4d4d99626650f2e22366f674541d4d1b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e9b099ac4d4d99626650f2e22366f674541d4d1b", "message": "Merge branch 'early-access' into early-access-enroll-mgmt-integration-test-change", "committedDate": "2020-06-10T04:45:37Z", "type": "commit"}, {"oid": "e623070761681f34b99f6531278f596b3a04315d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e623070761681f34b99f6531278f596b3a04315d", "message": "Merge branch 'early-access' into early-access-enroll-mgmt-integration-test-change", "committedDate": "2020-06-10T13:19:29Z", "type": "commit"}, {"oid": "f3088c484f1425c62ef21a28b7d9046d58936fa1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f3088c484f1425c62ef21a28b7d9046d58936fa1", "message": "Merge branch 'early-access' into early-access-enroll-mgmt-integration-test-change", "committedDate": "2020-06-10T13:57:26Z", "type": "commit"}]}