{"pr_number": 773, "pr_title": "User Management - Create AppPermission and StudyPermission records for SuperAdmin", "pr_createdAt": "2020-08-19T15:16:42Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773", "timeline": [{"oid": "1652df66d904ba933446aa0f463e0832e2a562b3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1652df66d904ba933446aa0f463e0832e2a562b3", "message": "added code to insert AppPermission and StudyPermission for SuperAdmin\n\nadded code to insert AppPermission and StudyPermission for SuperAdmin", "committedDate": "2020-08-19T15:12:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIzOTM5Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773#discussion_r473239397", "bodyText": "nit: assigning the null value is redundant", "author": "saminguyen", "createdAt": "2020-08-19T18:32:23Z", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/StudiesDaoImpl.java", "diffHunk": "@@ -61,6 +65,12 @@ public ErrorBean saveStudyMetadata(StudyMetadataBean studyMetadataBean) {\n     AppInfoDetailsBO appInfo = null;\n     OrgInfo orgInfo = null;\n \n+    UserRegAdminUser superAdminUser = null;\n+\n+    AppPermission appPermission = null;\n+\n+    StudyPermission studyPermission = null;", "originalCommit": "1652df66d904ba933446aa0f463e0832e2a562b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY5Mjk5OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773#discussion_r473692999", "bodyText": "Fixed review comment.", "author": "monica-BTC", "createdAt": "2020-08-20T07:28:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIzOTM5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI0OTYwNw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773#discussion_r473249607", "bodyText": "appPermissionList and studyPermissionList", "author": "saminguyen", "createdAt": "2020-08-19T18:51:45Z", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudiesControllerTest.java", "diffHunk": "@@ -86,6 +95,39 @@ public void addUpdateStudyMetadataSuccess() throws Exception {\n     assertEquals(Constants.STUDY_TAGLINE, studyInfoBo.getTagline());\n   }\n \n+  @Test\n+  public void addUpdateStudyMetadataSuccessForPermissions() throws Exception {\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    StudyMetadataBean studyMetaDataBean = createStudyMetadataBean();\n+    studyMetaDataBean.setStudyId(Constants.NEW_STUDY_ID);\n+    studyMetaDataBean.setAppId(Constants.NEW_APP_ID_VALUE);\n+    String requestJson = getObjectMapper().writeValueAsString(studyMetaDataBean);\n+    performPost(\n+        STUDY_METADATA_PATH, requestJson, headers, String.valueOf(HttpStatus.OK.value()), OK);\n+\n+    List<AppPermission> appPermission = appPermissionRepository.findAll();\n+    List<StudyPermission> studyPermission = studyPermissionRepository.findAll();", "originalCommit": "1652df66d904ba933446aa0f463e0832e2a562b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY1MDM4Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773#discussion_r473650386", "bodyText": "Renamed to appPermissionList and studyPermissionList", "author": "monica-BTC", "createdAt": "2020-08-20T06:34:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI0OTYwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI1MTY2Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773#discussion_r473251662", "bodyText": "Shouldn't we check for all the fields that is set in StudiesDaoImpl? (createBy, urAdminUser, etc)", "author": "saminguyen", "createdAt": "2020-08-19T18:55:51Z", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudiesControllerTest.java", "diffHunk": "@@ -86,6 +95,39 @@ public void addUpdateStudyMetadataSuccess() throws Exception {\n     assertEquals(Constants.STUDY_TAGLINE, studyInfoBo.getTagline());\n   }\n \n+  @Test\n+  public void addUpdateStudyMetadataSuccessForPermissions() throws Exception {\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    StudyMetadataBean studyMetaDataBean = createStudyMetadataBean();\n+    studyMetaDataBean.setStudyId(Constants.NEW_STUDY_ID);\n+    studyMetaDataBean.setAppId(Constants.NEW_APP_ID_VALUE);\n+    String requestJson = getObjectMapper().writeValueAsString(studyMetaDataBean);\n+    performPost(\n+        STUDY_METADATA_PATH, requestJson, headers, String.valueOf(HttpStatus.OK.value()), OK);\n+\n+    List<AppPermission> appPermission = appPermissionRepository.findAll();\n+    List<StudyPermission> studyPermission = studyPermissionRepository.findAll();\n+\n+    AppPermission app =\n+        appPermission\n+            .stream()\n+            .filter(x -> x.getAppInfo().getAppId().equals(Constants.NEW_APP_ID_VALUE))\n+            .findFirst()\n+            .orElse(null);\n+    StudyPermission study =\n+        studyPermission\n+            .stream()\n+            .filter(x -> x.getStudyInfo().getCustomId().equals(Constants.NEW_STUDY_ID))\n+            .findFirst()\n+            .orElse(null);\n+    assertNotNull(app);\n+    assertEquals(Constants.NEW_APP_ID_VALUE, app.getAppInfo().getAppId());\n+    assertEquals(Permission.READ_EDIT.value(), app.getEdit());\n+    assertNotNull(study);\n+    assertEquals(Constants.NEW_STUDY_ID, study.getStudyInfo().getCustomId());\n+    assertEquals(Permission.READ_EDIT.value(), study.getEdit());", "originalCommit": "1652df66d904ba933446aa0f463e0832e2a562b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY1MjkyOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773#discussion_r473652928", "bodyText": "Checked for createdBy and userRegAdminUser.", "author": "monica-BTC", "createdAt": "2020-08-20T06:38:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI1MTY2Mg=="}], "type": "inlineReview"}, {"oid": "576d88beba9d2967588e91adbea18ab6e61fa4bf", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/576d88beba9d2967588e91adbea18ab6e61fa4bf", "message": "fixed PR comments\n\nfixed PR comments", "committedDate": "2020-08-20T06:31:55Z", "type": "commit"}, {"oid": "ffbd600bd71e7b5e26b23a89c34a0c02b50b7d58", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ffbd600bd71e7b5e26b23a89c34a0c02b50b7d58", "message": "Merge branch 'develop' into user-management-app-study-permission", "committedDate": "2020-08-20T14:43:46Z", "type": "commit"}, {"oid": "efdd98373c412e9643e34f0054179fdc2ef394e8", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/efdd98373c412e9643e34f0054179fdc2ef394e8", "message": "resolved conflicts\n\nresolved conflicts", "committedDate": "2020-08-20T15:22:52Z", "type": "commit"}, {"oid": "6a41698fb7e731549afe9c53c8a5c5a268cdfdd6", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6a41698fb7e731549afe9c53c8a5c5a268cdfdd6", "message": "Merge branch 'develop' into user-management-app-study-permission", "committedDate": "2020-08-20T15:38:58Z", "type": "commit"}]}