{"pr_number": 1013, "pr_title": "Common Service: Fixed issue #1004", "pr_createdAt": "2020-09-22T15:30:36Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1013", "timeline": [{"oid": "330ea17f47e2171181a55d68d01f4d86ae5f8f55", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/330ea17f47e2171181a55d68d01f4d86ae5f8f55", "message": "Fixed issue #1004\n\nFixed issue #1004", "committedDate": "2020-09-22T15:19:16Z", "type": "commit"}, {"oid": "c5e1905e3eb423ac452781033d52edf5c077d6f2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c5e1905e3eb423ac452781033d52edf5c077d6f2", "message": "Fixed build issue\n\nFixed build issue", "committedDate": "2020-09-22T15:47:56Z", "type": "commit"}, {"oid": "1f6ec87c2e0bf597463e25abc69c6fb32e52c70f", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1f6ec87c2e0bf597463e25abc69c6fb32e52c70f", "message": "removed index for foreign keys\n\nremoved index for foreign keys as it will be generated by default", "committedDate": "2020-09-23T14:15:44Z", "type": "commit"}, {"oid": "3ee795ff7f6204573222a83297be804b3629e28d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3ee795ff7f6204573222a83297be804b3629e28d", "message": "Merge branch 'develop' into common-service-issue-1004", "committedDate": "2020-09-23T14:16:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg3NjY1Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1013#discussion_r493876657", "bodyText": "unique should be false by default, no need to add here.", "author": "zohrehj", "createdAt": "2020-09-23T20:31:12Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AuthInfoEntity.java", "diffHunk": "@@ -31,7 +32,16 @@\n @Setter\n @Getter\n @Entity\n-@Table(name = \"auth_info\")\n+@Table(\n+    name = \"auth_info\",\n+    indexes = {\n+      @Index(\n+          name = \"auth_info_remote_notification_flag_idx\",\n+          columnList = \"remote_notification_flag\",\n+          unique = false),", "originalCommit": "3ee795ff7f6204573222a83297be804b3629e28d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDkwNzc2OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1013#discussion_r494907768", "bodyText": "removed unique = false", "author": "Kantharajut-btc", "createdAt": "2020-09-25T10:51:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg3NjY1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg3NzE4OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1013#discussion_r493877188", "bodyText": "custom_app_id has unique=true annotation, it should have an automatically generated unique index.", "author": "zohrehj", "createdAt": "2020-09-23T20:32:12Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AppEntity.java", "diffHunk": "@@ -36,7 +37,9 @@\n @Setter\n @Getter\n @Entity\n-@Table(name = \"app_info\")\n+@Table(\n+    name = \"app_info\",\n+    indexes = {@Index(name = \"app_info_custom_app_id_idx\", columnList = \"custom_app_id\")})", "originalCommit": "3ee795ff7f6204573222a83297be804b3629e28d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgwOTQ2NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1013#discussion_r494809464", "bodyText": "@Kantharajut-btc index automatically generated for unique columns. please remove @Index(name = \"app_info_custom_app_id_idx\"\nUNIQUE KEY `UK_mghpamjyxooxd77dchdkmxjwk` (`custom_app_id`),\nKEY `app_info_custom_app_id_idx` (`custom_app_id`)", "author": "dhanyak-btc", "createdAt": "2020-09-25T07:48:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg3NzE4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg3ODcyOQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1013#discussion_r493878729", "bodyText": "user_id should have an automatic index, if joincolumn is used.\nfor other fields, please provide the query to verify what is the best index we can create; i.e. would it be better to have a multicolumn one, or individual columns.", "author": "zohrehj", "createdAt": "2020-09-23T20:34:58Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/UserDetailsEntity.java", "diffHunk": "@@ -52,6 +53,11 @@\n       @UniqueConstraint(\n           columnNames = {\"user_id\", \"app_info_id\"},\n           name = \"user_details_user_id_app_info_id_uidx\")\n+    },\n+    indexes = {\n+      @Index(name = \"user_details_email_idx\", columnList = \"email\"),\n+      @Index(name = \"user_details_user_id_idx\", columnList = \"user_id\"),", "originalCommit": "3ee795ff7f6204573222a83297be804b3629e28d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgxMTE3Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1013#discussion_r494811176", "bodyText": "@Kantharajut-btc please remove index for column user_id\nUNIQUE KEY `user_details_user_id_app_info_id_uidx` (`user_id`,`app_info_id`),\n KEY `user_details_email_idx` (`email`),\n KEY `user_details_user_id_idx` (`user_id`),\n KEY `user_details_last_name_idx` (`last_name`),\n KEY `FKo905twpc0drywmf4x5e0io0cn` (`app_info_id`),", "author": "dhanyak-btc", "createdAt": "2020-09-25T07:52:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg3ODcyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg3ODkxNw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1013#discussion_r493878917", "bodyText": "why do we need an index for last_name?", "author": "zohrehj", "createdAt": "2020-09-23T20:35:16Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/UserDetailsEntity.java", "diffHunk": "@@ -52,6 +53,11 @@\n       @UniqueConstraint(\n           columnNames = {\"user_id\", \"app_info_id\"},\n           name = \"user_details_user_id_app_info_id_uidx\")\n+    },\n+    indexes = {\n+      @Index(name = \"user_details_email_idx\", columnList = \"email\"),\n+      @Index(name = \"user_details_user_id_idx\", columnList = \"user_id\"),\n+      @Index(name = \"user_details_last_name_idx\", columnList = \"last_name\")", "originalCommit": "3ee795ff7f6204573222a83297be804b3629e28d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDkxNDU4NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1013#discussion_r494914584", "bodyText": "we were fetching the data based on last_name in one of the  test case , hence removed", "author": "Kantharajut-btc", "createdAt": "2020-09-25T11:06:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg3ODkxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg3OTU2OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1013#discussion_r493879569", "bodyText": "same here, columns with unique or joinColumn notation, most likely don't need an index.\nFor other values, document the query that needs the index so that we can confirm what index is best suitable for query.", "author": "zohrehj", "createdAt": "2020-09-23T20:36:34Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/UserRegAdminEntity.java", "diffHunk": "@@ -38,7 +39,13 @@\n @Getter\n @Setter\n @Entity\n-@Table(name = \"ur_admin_user\")\n+@Table(\n+    name = \"ur_admin_user\",\n+    indexes = {\n+      @Index(name = \"ur_admin_user_email_idx\", columnList = \"email\"),\n+      @Index(name = \"ur_admin_user_ur_admin_auth_id_idx\", columnList = \"ur_admin_auth_id\"),\n+      @Index(name = \"ur_admin_user_security_code_idx\", columnList = \"security_code\")", "originalCommit": "3ee795ff7f6204573222a83297be804b3629e28d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDkxMzk1OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1013#discussion_r494913958", "bodyText": "removed index for unique constraints", "author": "Kantharajut-btc", "createdAt": "2020-09-25T11:05:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg3OTU2OQ=="}], "type": "inlineReview"}, {"oid": "44c01eb6a5e57f2600dafdfc446198f728d99aea", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/44c01eb6a5e57f2600dafdfc446198f728d99aea", "message": "Fixed PR comments\n\nFixed PR comments", "committedDate": "2020-09-25T10:48:11Z", "type": "commit"}, {"oid": "144737bdf32b403cfdddc3372ecd9b6d52627c7c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/144737bdf32b403cfdddc3372ecd9b6d52627c7c", "message": "Fixed PR comment\n\nFixed PR comment", "committedDate": "2020-09-25T11:00:53Z", "type": "commit"}, {"oid": "ad52c8dbc19e8be8e9ad517464f210eaad2fa52b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ad52c8dbc19e8be8e9ad517464f210eaad2fa52b", "message": "Merge branch 'develop' into common-service-issue-1004", "committedDate": "2020-09-25T11:06:59Z", "type": "commit"}, {"oid": "b24f1240a81fcdaa57cc055d85eaca8ac33875bf", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/b24f1240a81fcdaa57cc055d85eaca8ac33875bf", "message": "added new sql script", "committedDate": "2020-09-25T11:43:42Z", "type": "commit"}, {"oid": "51fc0d50b691cdda1ec6f2ab031bd64130329330", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/51fc0d50b691cdda1ec6f2ab031bd64130329330", "message": "Merge branch 'common-service-issue-1004' of https://github.com/GoogleCloudPlatform/fda-mystudies into common-service-issue-1004", "committedDate": "2020-09-25T11:43:49Z", "type": "commit"}, {"oid": "82e0ab846f9902b45643341ffe5be8ac116b3ce1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/82e0ab846f9902b45643341ffe5be8ac116b3ce1", "message": "Merge branch 'develop' into common-service-issue-1004", "committedDate": "2020-09-25T14:53:37Z", "type": "commit"}, {"oid": "5b32f6607e22d645496f262b6685ea01f3d69835", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5b32f6607e22d645496f262b6685ea01f3d69835", "message": "Merge branch 'develop' into common-service-issue-1004", "committedDate": "2020-09-25T14:54:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA0MTY4Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1013#discussion_r495041686", "bodyText": "https://stackoverflow.com/questions/10524651/is-there-any-performance-gain-in-indexing-a-boolean-field\nNo need to index a column that only has a few values, even with index in worst case you would need to iterate through 1/3 of the table, and index has storage and performance costs as well.", "author": "zohrehj", "createdAt": "2020-09-25T14:50:50Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AuthInfoEntity.java", "diffHunk": "@@ -31,7 +32,15 @@\n @Setter\n @Getter\n @Entity\n-@Table(name = \"auth_info\")\n+@Table(", "originalCommit": "51fc0d50b691cdda1ec6f2ab031bd64130329330", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA2ODg0NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1013#discussion_r495068844", "bodyText": "removed index for boolean field", "author": "Kantharajut-btc", "createdAt": "2020-09-25T15:33:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA0MTY4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA0MzY2MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1013#discussion_r495043660", "bodyText": "what is the query that uses this index?", "author": "zohrehj", "createdAt": "2020-09-25T14:53:58Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/ParticipantRegistrySiteEntity.java", "diffHunk": "@@ -41,10 +42,15 @@\n @Entity\n @Table(\n     name = \"participant_registry_site\",\n+    indexes = {\n+      @Index(\n+          name = \"participant_registry_site_onboarding_status_idx\",", "originalCommit": "82e0ab846f9902b45643341ffe5be8ac116b3ce1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA3MTE1OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1013#discussion_r495071158", "bodyText": "onboarding_status column is used in below queries (ParticipantRegistrySiteRepository  class)\n@Query(\n      \"SELECT pr FROM ParticipantRegistrySiteEntity pr \"\n          + \"where pr.site.id = :siteId and pr.onboardingStatus = :onboardingStatus order by created desc\")\n  public Page<ParticipantRegistrySiteEntity> findBySiteIdAndStatus(\n      String siteId, String onboardingStatus, Pageable pageable);\n\t  \n@Query(\n      \"SELECT COUNT(pr) FROM ParticipantRegistrySiteEntity pr where pr.site.id = :siteId and pr.onboardingStatus = :onboardingStatus\")\n  public Long countBySiteIdAndStatus(String siteId, String onboardingStatus);", "author": "Kantharajut-btc", "createdAt": "2020-09-25T15:37:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA0MzY2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA4NDAyMw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1013#discussion_r495084023", "bodyText": "both these queries are filtering on site_id, and then status; since site_id does not have an index, let's make this into a composite index for both columns instead.", "author": "zohrehj", "createdAt": "2020-09-25T15:58:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA0MzY2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTEwOTI4MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1013#discussion_r495109280", "bodyText": "added composite index", "author": "Kantharajut-btc", "createdAt": "2020-09-25T16:44:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA0MzY2MA=="}], "type": "inlineReview"}, {"oid": "a7ed68be01bf78bcf18ba186c3f1c1bf063b0bea", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a7ed68be01bf78bcf18ba186c3f1c1bf063b0bea", "message": "removed index for boolean field\n\nremoved index for boolean field", "committedDate": "2020-09-25T15:38:16Z", "type": "commit"}, {"oid": "888eb89d58746014c5321c09054b861c299bdf8a", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/888eb89d58746014c5321c09054b861c299bdf8a", "message": "Merge branch 'common-service-issue-1004' of https://github.com/GoogleCloudPlatform/fda-mystudies into common-service-issue-1004", "committedDate": "2020-09-25T15:38:32Z", "type": "commit"}, {"oid": "ceeb3b8da6deaeb1aedce4b8edc5cbbb2936eaa8", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ceeb3b8da6deaeb1aedce4b8edc5cbbb2936eaa8", "message": "Merge branch 'develop' into common-service-issue-1004", "committedDate": "2020-09-25T15:52:42Z", "type": "commit"}, {"oid": "8cb2f04f1edd14aa22ed68d07a2c64d7e98ca183", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8cb2f04f1edd14aa22ed68d07a2c64d7e98ca183", "message": "Fixed PR comment\n\nFixed PR comment", "committedDate": "2020-09-25T16:43:40Z", "type": "commit"}, {"oid": "4896a8fd2ab7ba6dbf842fc0c9257d0865032ac1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4896a8fd2ab7ba6dbf842fc0c9257d0865032ac1", "message": "Merge branch 'common-service-issue-1004' of https://github.com/GoogleCloudPlatform/fda-mystudies into common-service-issue-1004", "committedDate": "2020-09-25T16:43:50Z", "type": "commit"}, {"oid": "21c2da7078c84231b5e815787eed254a200a38ee", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/21c2da7078c84231b5e815787eed254a200a38ee", "message": "Merge branch 'develop' into common-service-issue-1004", "committedDate": "2020-09-25T16:44:23Z", "type": "commit"}, {"oid": "96927ab7fda611a8177d75a23767e03a6c909cb6", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/96927ab7fda611a8177d75a23767e03a6c909cb6", "message": "Merge branch 'develop' into common-service-issue-1004", "committedDate": "2020-09-25T16:58:57Z", "type": "commit"}]}