{"pr_number": 794, "pr_title": "iOS - Fix offline syncing of study state.", "pr_createdAt": "2020-08-24T11:18:17Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/794", "timeline": [{"oid": "4f3621a07d1016da97a6e2c384bd3347f9d1b4da", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4f3621a07d1016da97a6e2c384bd3347f9d1b4da", "message": "Fix offline syncing of study state.", "committedDate": "2020-08-24T10:49:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTYyMjI4Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/794#discussion_r475622287", "bodyText": "why is this toggle and not = true?\nin what situation would we want to set this to false when calling syncOfflineSavedData ?", "author": "zohrehj", "createdAt": "2020-08-24T13:50:58Z", "path": "iOS/HPHC/HPHC/Networking/APIs/ResponseServices.swift", "diffHunk": "@@ -187,7 +189,7 @@ class ResponseServices: NSObject {\n     headers: [String: String]?,\n     delegate: NMWebServiceDelegate\n   ) {\n-\n+    self.isOfflineSyncRequest.toggle()", "originalCommit": "4f3621a07d1016da97a6e2c384bd3347f9d1b4da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTY1MzgyNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/794#discussion_r475653826", "bodyText": "It's initialized as false initially and this method gets called only from Offline Syncing which will toggle it to true.", "author": "tushar-boston", "createdAt": "2020-08-24T14:28:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTYyMjI4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTY1NTk4NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/794#discussion_r475655984", "bodyText": "then change to = true to be clear on that", "author": "zohrehj", "createdAt": "2020-08-24T14:31:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTYyMjI4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTYyMzcwMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/794#discussion_r475623702", "bodyText": "Do you simply ignore the NetworkErrors on offlineSyncRequest?\nIf yes, please leave a comment to explain why it is safe to ignore", "author": "zohrehj", "createdAt": "2020-08-24T13:52:12Z", "path": "iOS/HPHC/HPHC/Networking/APIs/ResponseServices.swift", "diffHunk": "@@ -446,13 +448,13 @@ extension ResponseServices: NMWebServiceDelegate {\n       || requestName as String == ResponseMethods.updateActivityState.description\n     {\n \n-      if error.code == kNoNetworkErrorCode {\n+      if error.code == kNoNetworkErrorCode, !isOfflineSyncRequest {", "originalCommit": "4f3621a07d1016da97a6e2c384bd3347f9d1b4da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTY1NTkzMw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/794#discussion_r475655933", "bodyText": "I'm ignoring this block execution with offline syncing call as it was saving the object again in the DB if the request gets failed due to network again. I'll add a comment here why it's ignored.", "author": "tushar-boston", "createdAt": "2020-08-24T14:31:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTYyMzcwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTYyNjcwMA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/794#discussion_r475626700", "bodyText": "what happens if the sync fails?\nMaybe we should delete the previous value only when the sync request has succeeded?", "author": "zohrehj", "createdAt": "2020-08-24T13:54:42Z", "path": "iOS/HPHC/HPHC/Utils/Helpers/SyncUpdate/SyncUpdate.swift", "diffHunk": "@@ -106,7 +117,8 @@ extension SyncUpdate: NMWebServiceDelegate {\n   func startedRequest(_ manager: NetworkManager, requestName: NSString) {}\n \n   func finishedRequest(_ manager: NetworkManager, requestName: NSString, response: AnyObject?) {\n-    self.syncDataToServer()\n+    deleteSyncedObject()", "originalCommit": "4f3621a07d1016da97a6e2c384bd3347f9d1b4da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTY1NzEzNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/794#discussion_r475657136", "bodyText": "This func finishedRequest gets called only when the sync is successful and I'm deleting the synced value after that only.", "author": "tushar-boston", "createdAt": "2020-08-24T14:33:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTYyNjcwMA=="}], "type": "inlineReview"}, {"oid": "3393ca6fbd32c49dd8785d99fbf47d3c9537492b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3393ca6fbd32c49dd8785d99fbf47d3c9537492b", "message": "Add sync logic comments.", "committedDate": "2020-08-24T15:47:23Z", "type": "commit"}, {"oid": "a8159c17ea9b78ec60d2cfde5b0c09ceea6e6a55", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a8159c17ea9b78ec60d2cfde5b0c09ceea6e6a55", "message": "Merge branch 'develop' into ios-offline-sync-patch", "committedDate": "2020-08-25T17:02:50Z", "type": "commit"}, {"oid": "d9e6f0100229d251cc805966cf1b9350736c9607", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d9e6f0100229d251cc805966cf1b9350736c9607", "message": "Merge branch 'develop' into ios-offline-sync-patch", "committedDate": "2020-08-25T17:25:46Z", "type": "commit"}]}