{"pr_number": 890, "pr_title": "User Mgmt service- Externalized configuration", "pr_createdAt": "2020-09-06T13:34:24Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890", "timeline": [{"oid": "47e1b59dce844f0ff4f9854b30b0dcc5a8a9d801", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/47e1b59dce844f0ff4f9854b30b0dcc5a8a9d801", "message": "User Mgmt service- Externalized configuration\n\nUser Mgmt service- Externalized configuration.", "committedDate": "2020-09-06T13:32:03Z", "type": "commit"}, {"oid": "e642422b179014ae5793e07c0d3371722eaeab9b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e642422b179014ae5793e07c0d3371722eaeab9b", "message": "rename client id and secret key as per existing placeholder in EAP\n\nrename client id and secret key as per existing placeholder in EAP", "committedDate": "2020-09-06T18:33:33Z", "type": "commit"}, {"oid": "3904a2ce15a8c256d63b9f810f88c0f1557bbd04", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3904a2ce15a8c256d63b9f810f88c0f1557bbd04", "message": "changed datasource url\n\nchanged datasource url", "committedDate": "2020-09-08T11:12:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzMDIzMQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r485130231", "bodyText": "static imports should be above the non-static imports according to https://google.github.io/styleguide/javaguide.html#s3.3.3-import-ordering-and-spacing", "author": "zohrehj", "createdAt": "2020-09-08T18:55:31Z", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserSupportServiceImpl.java", "diffHunk": "@@ -27,6 +22,11 @@\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.stereotype.Service;\n \n+import static com.google.cloud.healthcare.fdamystudies.common.UserMgmntEvent.CONTACT_US_CONTENT_EMAILED;", "originalCommit": "3904a2ce15a8c256d63b9f810f88c0f1557bbd04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI4MTg0Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r486281843", "bodyText": "resolved import order now", "author": "aswinijena100", "createdAt": "2020-09-10T12:03:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzMDIzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzMTE1Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r485131153", "bodyText": "why use this notation here?", "author": "zohrehj", "createdAt": "2020-09-08T18:57:09Z", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/resources/application.properties", "diffHunk": "@@ -1,9 +1,25 @@\n-#dev\n+#spring configurations\n+spring.profiles.active=@spring.profiles.active@", "originalCommit": "3904a2ce15a8c256d63b9f810f88c0f1557bbd04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkxOTg0OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r486919849", "bodyText": "We've <profiles> in pom.xml to replace @spring.profiles.active@ with values like local, dev, qa. Our test environment deployment takes configuration from application-<profile>.properties.", "author": "dhanyak-btc", "createdAt": "2020-09-11T09:41:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzMTE1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzMjYxMw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r485132613", "bodyText": "leave as update for now", "author": "zohrehj", "createdAt": "2020-09-08T18:59:49Z", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/resources/application.properties", "diffHunk": "@@ -1,9 +1,25 @@\n-#dev\n+#spring configurations\n+spring.profiles.active=@spring.profiles.active@\n+spring.main.allow-bean-definition-overriding=true\n+\n+# log configuration\n+logging.path=${LOG_PATH}\n+logging.file=${logging.path}/user_mgmt_service.log\n+logging.file.max-size= 1024KB\n+\n+logging.level.root=WARN\n+logging.level.com.google.cloud.healthcare.fdamystudies=WARN\n+\n email.code.expire_time = 15\n \n-spring.datasource.url=jdbc:mysql://35.196.150.7/mystudies_userregistration?createDatabaseIfNotExist=true&autoReconnect=true&characterEncoding=utf8&useSSL=false&allowPublicKeyRetrieval=true\n-spring.datasource.username=registration-server-user\n-spring.datasource.password=f]E45/=P\n+spring.datasource.url=jdbc:mysql://127.0.0.1:3306/${DB_NAME}?createDatabaseIfNotExist=true&autoReconnect=true&characterEncoding=utf8&useSSL=false&allowPublicKeyRetrieval=true\n+spring.datasource.username=${DB_USER}\n+spring.datasource.password=${DB_PASS}\n+spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver\n+# JPA \n+spring.jpa.database-platform=org.hibernate.dialect.MySQL5InnoDBDialect\n+spring.jpa.show-sql=false\n+spring.jpa.hibernate.ddl-auto=none", "originalCommit": "3904a2ce15a8c256d63b9f810f88c0f1557bbd04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI4MjM4Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r486282383", "bodyText": "changed to update", "author": "aswinijena100", "createdAt": "2020-09-10T12:04:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzMjYxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzMzI5MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r485133291", "bodyText": "should these be turned into variables as well?", "author": "zohrehj", "createdAt": "2020-09-08T19:00:56Z", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/resources/application.properties", "diffHunk": "@@ -13,95 +29,65 @@ spring.datasource.hikari.minimum-idle=10\n spring.datasource.hikari.maximum-pool-size=100\n spring.datasource.hikari.connectionTimeout=30000\n spring.datasource.hikari.maxLifetime=1800000\n-spring.datasource.driver-class-name=com.mysql.jdbc.Driver\n-spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL5InnoDBDialect\n-\n-# JPA \n-spring.jpa.show-sql=true\n-spring.jpa.hibernate.ddl-auto=update\n-spring.jpa.hibernate.naming.strategy=org.hibernate.cfg.ImprovedNamingStrategy\n-\n \n # EMBEDDED SERVER CONFIGURATION\n server.servlet.contextPath=/myStudiesUserMgmtWS\n-\n #local to run\n server.port=8090\n \n # HTTP encoding\n spring.http.encoding.charset=UTF-8\n-\n spring.jmx.enabled = false\n \n-interceptor=/register,/resendConfirmation,/healthCheck\n-\n-#API calls directly from another server\n-serverApiUrls=/studies/studymetadata,/studies/sendNotification\n-\n-\n-from.email.address=apps@boston-technology.com\n-from.email.password=Btc@app@123\n+from.email.address=${FROM_EMAIL_ADDRESS}\n+from.email.password=${FROM_EMAIL_PASSWORD}\n # Unused with IP whitelist.\n-\n-smtp.hostname=smtp.gmail.com\n+smtp.hostname=${SMTP_HOSTNAME}\n smtp.port=465\n factory.value=javax.net.ssl.SSLSocketFactory\n \n-from.email.use_ip_whitelist=\n+from.email.use_ip_whitelist=${SMTP_USE_IP_WHITELIST}\n # Domain should be the email domain excluding the end,\n # i.e. rocketturtle instead of rocketturtle.net\n-from.email.domain=\n-\n+from.email.domain=${FROM_EMAIL_DOMAIN}\n # Empty whitelist means all domains are valid.\n email.whitelisted_domains=\n-\n-cloud.institution.bucket=\n-\n+cloud.institution.bucket=${INSTITUTION_RESOURCES_BUCKET_NAME}\n \n AUTH_KEY_FCM=XXXX\n-\n API_URL_FCM=https://fcm.googleapis.com/fcm/send", "originalCommit": "3904a2ce15a8c256d63b9f810f88c0f1557bbd04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk1MTMzMw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r486951333", "bodyText": "created a placeholder ${FCM_API_URL} for this", "author": "aswinijena100", "createdAt": "2020-09-11T10:17:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzMzI5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzNDAxMQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r485134011", "bodyText": "these values do not need to be in application properties, since we do not expect them to be different per deployment. the only part, that will be different is the base_url, the rest can be generated in the code.", "author": "zohrehj", "createdAt": "2020-09-08T19:02:16Z", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/resources/application.properties", "diffHunk": "@@ -13,95 +29,65 @@ spring.datasource.hikari.minimum-idle=10\n spring.datasource.hikari.maximum-pool-size=100\n spring.datasource.hikari.connectionTimeout=30000\n spring.datasource.hikari.maxLifetime=1800000\n-spring.datasource.driver-class-name=com.mysql.jdbc.Driver\n-spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL5InnoDBDialect\n-\n-# JPA \n-spring.jpa.show-sql=true\n-spring.jpa.hibernate.ddl-auto=update\n-spring.jpa.hibernate.naming.strategy=org.hibernate.cfg.ImprovedNamingStrategy\n-\n \n # EMBEDDED SERVER CONFIGURATION\n server.servlet.contextPath=/myStudiesUserMgmtWS\n-\n #local to run\n server.port=8090\n \n # HTTP encoding\n spring.http.encoding.charset=UTF-8\n-\n spring.jmx.enabled = false\n \n-interceptor=/register,/resendConfirmation,/healthCheck\n-\n-#API calls directly from another server\n-serverApiUrls=/studies/studymetadata,/studies/sendNotification\n-\n-\n-from.email.address=apps@boston-technology.com\n-from.email.password=Btc@app@123\n+from.email.address=${FROM_EMAIL_ADDRESS}\n+from.email.password=${FROM_EMAIL_PASSWORD}\n # Unused with IP whitelist.\n-\n-smtp.hostname=smtp.gmail.com\n+smtp.hostname=${SMTP_HOSTNAME}\n smtp.port=465\n factory.value=javax.net.ssl.SSLSocketFactory\n \n-from.email.use_ip_whitelist=\n+from.email.use_ip_whitelist=${SMTP_USE_IP_WHITELIST}\n # Domain should be the email domain excluding the end,\n # i.e. rocketturtle instead of rocketturtle.net\n-from.email.domain=\n-\n+from.email.domain=${FROM_EMAIL_DOMAIN}\n # Empty whitelist means all domains are valid.\n email.whitelisted_domains=\n-\n-cloud.institution.bucket=\n-\n+cloud.institution.bucket=${INSTITUTION_RESOURCES_BUCKET_NAME}\n \n AUTH_KEY_FCM=XXXX\n-\n API_URL_FCM=https://fcm.googleapis.com/fcm/send\n-\n-#Auth Server Local\n-\n-register.url=http://35.193.185.224:8087/oauth-scim-service/users\n-auth.server.updateStatus.url=http://35.193.185.224:8087/oauth-scim-service/users/{userId}\n-\n-response.server.url.participant.withdraw=http://35.193.185.224:8084/mystudies-response-server/participant/withdraw\n-\n #App security\n certificate.name=push_prod.p12\n-\n certificate.password=XXXX\n+#please keep sandbox/production based on your ios app release type\n+ios.push.notification.type=sandbox\n \n-confirmation.mail.subject=Welcome to the <App Name> App!\n+#Auth Server Local\n+register.url=${HYDRA_ADMIN_URL}/users\n+auth.server.updateStatus.url=${HYDRA_ADMIN_URL}/users/{userId}\n+response.server.url.participant.withdraw=${RESPONSE_SERVER_URL}/participant/withdraw", "originalCommit": "3904a2ce15a8c256d63b9f810f88c0f1557bbd04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkyNjU2Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r486926566", "bodyText": "We've followed same pattern in all the services for API endpoints, this requires lot of code changes if we need to build the endpoint from application. We'll keep the API endpoints in properties for this release and address this in next release if we really need to make the changes. I personally prefer to keep API endpoints in properties file.", "author": "dhanyak-btc", "createdAt": "2020-09-11T09:48:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzNDAxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg3NjYzOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r487876638", "bodyText": "Dhanya, I assumed you changed the pattern in an earlier PR based on your comment there.\nAre other modules all still following this pattern?", "author": "zohrehj", "createdAt": "2020-09-14T12:35:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzNDAxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg3OTU0OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r487879549", "bodyText": "@zohrehj , I refactored the code only for Redirect URLs not for API endpoints.", "author": "dhanyak-btc", "createdAt": "2020-09-14T12:40:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzNDAxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg4MTM1MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r487881351", "bodyText": "@aswinijena100 please correct below prop values as given  below.\nregister.url=${SCIM_AUTH_URL}/users\nauth.server.updateStatus.url=${SCIM_AUTH_URL}/users/{userId}", "author": "dhanyak-btc", "createdAt": "2020-09-14T12:43:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzNDAxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODM3MDIyNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r488370226", "bodyText": "@dhanyak-btc done the changes as suggested.", "author": "aswinijena100", "createdAt": "2020-09-15T04:06:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzNDAxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzNDQ5MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r485134491", "bodyText": "should the  also be replaced in the code?\nThe value can come from the database; app record associated with a given study", "author": "zohrehj", "createdAt": "2020-09-08T19:03:10Z", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/resources/application.properties", "diffHunk": "@@ -13,95 +29,65 @@ spring.datasource.hikari.minimum-idle=10\n spring.datasource.hikari.maximum-pool-size=100\n spring.datasource.hikari.connectionTimeout=30000\n spring.datasource.hikari.maxLifetime=1800000\n-spring.datasource.driver-class-name=com.mysql.jdbc.Driver\n-spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL5InnoDBDialect\n-\n-# JPA \n-spring.jpa.show-sql=true\n-spring.jpa.hibernate.ddl-auto=update\n-spring.jpa.hibernate.naming.strategy=org.hibernate.cfg.ImprovedNamingStrategy\n-\n \n # EMBEDDED SERVER CONFIGURATION\n server.servlet.contextPath=/myStudiesUserMgmtWS\n-\n #local to run\n server.port=8090\n \n # HTTP encoding\n spring.http.encoding.charset=UTF-8\n-\n spring.jmx.enabled = false\n \n-interceptor=/register,/resendConfirmation,/healthCheck\n-\n-#API calls directly from another server\n-serverApiUrls=/studies/studymetadata,/studies/sendNotification\n-\n-\n-from.email.address=apps@boston-technology.com\n-from.email.password=Btc@app@123\n+from.email.address=${FROM_EMAIL_ADDRESS}\n+from.email.password=${FROM_EMAIL_PASSWORD}\n # Unused with IP whitelist.\n-\n-smtp.hostname=smtp.gmail.com\n+smtp.hostname=${SMTP_HOSTNAME}\n smtp.port=465\n factory.value=javax.net.ssl.SSLSocketFactory\n \n-from.email.use_ip_whitelist=\n+from.email.use_ip_whitelist=${SMTP_USE_IP_WHITELIST}\n # Domain should be the email domain excluding the end,\n # i.e. rocketturtle instead of rocketturtle.net\n-from.email.domain=\n-\n+from.email.domain=${FROM_EMAIL_DOMAIN}\n # Empty whitelist means all domains are valid.\n email.whitelisted_domains=\n-\n-cloud.institution.bucket=\n-\n+cloud.institution.bucket=${INSTITUTION_RESOURCES_BUCKET_NAME}\n \n AUTH_KEY_FCM=XXXX\n-\n API_URL_FCM=https://fcm.googleapis.com/fcm/send\n-\n-#Auth Server Local\n-\n-register.url=http://35.193.185.224:8087/oauth-scim-service/users\n-auth.server.updateStatus.url=http://35.193.185.224:8087/oauth-scim-service/users/{userId}\n-\n-response.server.url.participant.withdraw=http://35.193.185.224:8084/mystudies-response-server/participant/withdraw\n-\n #App security\n certificate.name=push_prod.p12\n-\n certificate.password=XXXX\n+#please keep sandbox/production based on your ios app release type\n+ios.push.notification.type=sandbox\n \n-confirmation.mail.subject=Welcome to the <App Name> App!\n+#Auth Server Local\n+register.url=${HYDRA_ADMIN_URL}/users\n+auth.server.updateStatus.url=${HYDRA_ADMIN_URL}/users/{userId}\n+response.server.url.participant.withdraw=${RESPONSE_SERVER_URL}/participant/withdraw\n \n-confirmation.mail.content=<html><body><div style='margin:20px;padding:10px;font-family: sans-serif;font-size: 14px;'><span>Hi,</span><br/><br/><span>Thank you for registering with us! We look forward to having you on board and actively taking part in<br/>research studies conducted by the &lt;Org Name&gt; and its partners.</span><br/><br/><span>Your sign-up process is almost complete. Please use the verification code provided below to<br/>complete the Verification step in the mobile app.</span><br/><br/><span><strong>Verification Code:</strong><b>$securitytoken</b> </span></span><br/><br/><span>This code can be used only once and is valid for a period of 48 hours only.</span><br/><br/><span>Please note that  registration (or sign up) for the app  is requested only to provide you with a <br/>seamless experience of using the app. Your registration information does not become part of <br/>the data collected for any study housed in the app.Each study has its own consent process, <br/>and no data for any study will be collected unless and until you provide an informed consent<br/> prior to joining the study. </span><br/><br/><span>For any questions or assistance, please write to <a>&lt;contact email address&gt;</a> </span><br/><br/><span style='font-size:15px;'>Thanks,</span><br/><span>The &lt;Org Name&gt; MyStudies Support Team</span><br/><span>----------------------------------------------------</span><br/><span style='font-size:10px;'>PS - This is an auto-generated email. Please do not reply.</span></div></body></html>\n \n-#please keep sandbox/production based on your ios app release type\n-ios.push.notification.type=sandbox\n+confirmation.mail.subject=Welcome to the <App Name> App!", "originalCommit": "3904a2ce15a8c256d63b9f810f88c0f1557bbd04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEyMTA5MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r487121090", "bodyText": "@zohrehj you are right, this should be dynamically replaced from the app information stored in the database, depending on the app (App ID) fhat the email is being sent out for.  We have a task in Track 1 (release 2) for centralization of all branding elements across platform components so that developers don't need to replace values in multiple places in the code. As part of this, elements such as app name is to be read from the database for the app in question. This should get addressed by the end of release 2.", "author": "SR-btc", "createdAt": "2020-09-11T15:27:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzNDQ5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI2OTYyNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r487269625", "bodyText": "Sounds good.\nPlease file a corresponding bug leave a TODO with the bug number here.", "author": "zohrehj", "createdAt": "2020-09-11T20:16:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzNDQ5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODM3MDE0MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r488370141", "bodyText": "Added TODO comment with bug number", "author": "aswinijena100", "createdAt": "2020-09-15T04:06:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzNDQ5MQ=="}], "type": "inlineReview"}, {"oid": "7d05ea13760f88551e7c38868ad79cdd7e1ce973", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/7d05ea13760f88551e7c38868ad79cdd7e1ce973", "message": "Organized imports to keep static imports above the non-static imports\n\nOrganized imports to keep static imports above the non-static imports", "committedDate": "2020-09-09T13:11:25Z", "type": "commit"}, {"oid": "357b6d9e32725cac374429e7bd9a89f4aae8faca", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/357b6d9e32725cac374429e7bd9a89f4aae8faca", "message": "changed ddl-auto property values to update\n\nchanged ddl-auto property values to update", "committedDate": "2020-09-10T13:57:43Z", "type": "commit"}, {"oid": "31bfacf9870abe2fd2bfa021a325d2ae93f40aa2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/31bfacf9870abe2fd2bfa021a325d2ae93f40aa2", "message": "added placeholder for FCM url\n\nadded placeholder for FCM url", "committedDate": "2020-09-11T10:16:24Z", "type": "commit"}, {"oid": "b42ca11b712c2b32bdac1fcc1146aa94a6f35d9a", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/b42ca11b712c2b32bdac1fcc1146aa94a6f35d9a", "message": "Merge branch 'oauth_scim_externalized_configuration' into user-reg-server-externalized-configuration", "committedDate": "2020-09-11T10:18:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI3MDI3MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r487270271", "bodyText": "nit: add a single space after '#'", "author": "zohrehj", "createdAt": "2020-09-11T20:18:30Z", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/resources/application.properties", "diffHunk": "@@ -13,95 +29,65 @@ spring.datasource.hikari.minimum-idle=10\n spring.datasource.hikari.maximum-pool-size=100\n spring.datasource.hikari.connectionTimeout=30000\n spring.datasource.hikari.maxLifetime=1800000\n-spring.datasource.driver-class-name=com.mysql.jdbc.Driver\n-spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL5InnoDBDialect\n-\n-# JPA \n-spring.jpa.show-sql=true\n-spring.jpa.hibernate.ddl-auto=update\n-spring.jpa.hibernate.naming.strategy=org.hibernate.cfg.ImprovedNamingStrategy\n-\n \n # EMBEDDED SERVER CONFIGURATION\n server.servlet.contextPath=/myStudiesUserMgmtWS\n-\n #local to run\n server.port=8090\n \n # HTTP encoding\n spring.http.encoding.charset=UTF-8\n-\n spring.jmx.enabled = false\n \n-interceptor=/register,/resendConfirmation,/healthCheck\n-\n-#API calls directly from another server\n-serverApiUrls=/studies/studymetadata,/studies/sendNotification\n-\n-\n-from.email.address=apps@boston-technology.com\n-from.email.password=Btc@app@123\n+from.email.address=${FROM_EMAIL_ADDRESS}\n+from.email.password=${FROM_EMAIL_PASSWORD}\n # Unused with IP whitelist.\n-\n-smtp.hostname=smtp.gmail.com\n+smtp.hostname=${SMTP_HOSTNAME}\n smtp.port=465\n factory.value=javax.net.ssl.SSLSocketFactory\n \n-from.email.use_ip_whitelist=\n+from.email.use_ip_whitelist=${SMTP_USE_IP_WHITELIST}\n # Domain should be the email domain excluding the end,\n-# i.e. domain instead of domain.com\n-from.email.domain=\n-\n+# i.e. rocketturtle instead of rocketturtle.net\n+from.email.domain=${FROM_EMAIL_DOMAIN}\n # Empty whitelist means all domains are valid.\n email.whitelisted_domains=\n-\n-cloud.institution.bucket=\n-\n+cloud.institution.bucket=${INSTITUTION_RESOURCES_BUCKET_NAME}\n \n AUTH_KEY_FCM=XXXX\n-\n-API_URL_FCM=https://fcm.googleapis.com/fcm/send\n-\n-#Auth Server Local\n-\n-register.url=http://35.193.185.224:8087/oauth-scim-service/users\n-auth.server.updateStatus.url=http://35.193.185.224:8087/oauth-scim-service/users/{userId}\n-\n-response.server.url.participant.withdraw=http://35.193.185.224:8084/mystudies-response-server/participant/withdraw\n-\n+API_URL_FCM=${FCM_API_URL}/send\n #App security\n certificate.name=push_prod.p12\n-\n certificate.password=XXXX\n+#please keep sandbox/production based on your ios app release type\n+ios.push.notification.type=sandbox\n \n-confirmation.mail.subject=Welcome to the <App Name> App!\n+#Auth Server Local\n+register.url=${HYDRA_ADMIN_URL}/users\n+auth.server.updateStatus.url=${HYDRA_ADMIN_URL}/users/{userId}\n+response.server.url.participant.withdraw=${RESPONSE_SERVER_URL}/participant/withdraw\n \n-confirmation.mail.content=<html><body><div style='margin:20px;padding:10px;font-family: sans-serif;font-size: 14px;'><span>Hi,</span><br/><br/><span>Thank you for registering with us! We look forward to having you on board and actively taking part in<br/>research studies conducted by the &lt;Org Name&gt; and its partners.</span><br/><br/><span>Your sign-up process is almost complete. Please use the verification code provided below to<br/>complete the Verification step in the mobile app.</span><br/><br/><span><strong>Verification Code:</strong><b>$securitytoken</b> </span></span><br/><br/><span>This code can be used only once and is valid for a period of 48 hours only.</span><br/><br/><span>Please note that  registration (or sign up) for the app  is requested only to provide you with a <br/>seamless experience of using the app. Your registration information does not become part of <br/>the data collected for any study housed in the app.Each study has its own consent process, <br/>and no data for any study will be collected unless and until you provide an informed consent<br/> prior to joining the study. </span><br/><br/><span>For any questions or assistance, please write to <a>&lt;contact email address&gt;</a> </span><br/><br/><span style='font-size:15px;'>Thanks,</span><br/><span>The &lt;Org Name&gt; MyStudies Support Team</span><br/><span>----------------------------------------------------</span><br/><span style='font-size:10px;'>PS - This is an auto-generated email. Please do not reply.</span></div></body></html>\n \n-#please keep sandbox/production based on your ios app release type\n-ios.push.notification.type=sandbox\n+confirmation.mail.subject=Welcome to the <App Name> App!\n+confirmation.mail.content=<html><body><div style='margin:20px;padding:10px;font-family: sans-serif;font-size: 14px;'><span>Hi,</span><br/><br/><span>Thank you for registering with us! We look forward to having you on board and actively taking part in<br/>research studies conducted by the &lt;Org Name&gt; and its partners.</span><br/><br/><span>Your sign-up process is almost complete. Please use the verification code provided below to<br/>complete the Verification step in the mobile app.</span><br/><br/><span><strong>Verification Code:</strong><b>$securitytoken</b> </span></span><br/><br/><span>This code can be used only once and is valid for a period of 48 hours only.</span><br/><br/><span>Please note that  registration (or sign up) for the app  is requested only to provide you with a <br/>seamless experience of using the app. Your registration information does not become part of <br/>the data collected for any study housed in the app.Each study has its own consent process, <br/>and no data for any study will be collected unless and until you provide an informed consent<br/> prior to joining the study. </span><br/><br/><span>For any questions or assistance, please write to <a>&lt;contact email address&gt;</a> </span><br/><br/><span style='font-size:15px;'>Thanks,</span><br/><span>The &lt;Org Name&gt; MyStudies Support Team</span><br/><span>----------------------------------------------------</span><br/><span style='font-size:10px;'>PS - This is an auto-generated email. Please do not reply.</span></div></body></html>\n \n # Feedback & Contactus mail content starts\n feedback.email=<Feedback Mail>\n-\n feedback.mail.subject=<App Name> App Feedback:\n-\n feedback.mail.content=<html><body><div><div><span>Hi</span></div><br\\><div><span>A user of the &lt;App Name&gt; mobile app has provided feedback via the app. Here&#39;s the content of the feedback:</span></div><br\\><div><span><i>$body</i></span></div><br\\><div><span>Thanks,</span><br\\><span>The &lt;Org Name&gt; MyStudies Support Team</span><br\\><span>-------------------------------------------</span><br\\><span style='font-size:10px;'>Note: This is an auto-generated email. Please do not reply.</span></div></div></body></html>\n-\n contactus.email=<ContactUs Mail>\n-\n contactus.mail.subject=<App Name> App Helpdesk:\n-\n contactus.mail.content=<html><body><div><div><span>Hi</span></div><br\\><div style='padding-bottom:10px;'><span>A user of the &lt;App Neme&gt; mobile app has reached out this helpdesk via the &#39;Contact Us&#39; form in the mobile app. The details submitted in the form are given below:</span></div><div><div>___________________________________________</div><div style='padding-top:20px;'>First Name: $firstName</div><div style='padding-top:10px;'>Email: <a href='mailto: $email'> $email </a></div><div style='padding-top:10px;'>Subject: $subject</div><div style='padding-top:10px;padding-bottom:10px'>Message: $body</div></div><div>___________________________________________</div><div style='padding-top:10px;'><span>Please respond to the app user at the email provided.</span></div><br\\><div><span>Thanks,</span><br\\><span>The &lt;Org Name&gt; MyStudies Support Team</span><br\\><span>-------------------------------------------</span><br\\><span style='font-size:10px;'>Note: This is an auto-generated email. Please do not reply.</span></div></div></body></html>\n # Feedback & Contactus mail content ends\n \n-security.oauth2.client.client-id= oauth-scim-client-id\n-security.oauth2.client.client-secret= oauth-scim-client-secret\n+org.name =${ORG_NAME}\n \n-security.oauth2.introspection_endpoint=http://35.193.185.224:8087/oauth-scim-service/oauth2/introspect\n-security.oauth2.token_endpoint=http://35.193.185.224:8087/oauth-scim-service/oauth2/token\n-security.oauth2.client.redirect-uri=http://35.193.185.224:8087/oauth-scim-service/login\n-\n-spring.main.allow-bean-definition-overriding=true\n+security.oauth2.client.client-id=${CLIENT_ID}\n+security.oauth2.client.client-secret=${SECRET_KEY}\n+security.oauth2.introspection_endpoint=${HYDRA_ADMIN_URL}/oauth2/introspect\n+security.oauth2.token_endpoint=${SCIM_AUTH_URL}/oauth2/token\n+security.oauth2.client.redirect-uri=${SCIM_AUTH_URL}/login\n \n-org.name = Org Name\n+#Enabale/Disable components from common service", "originalCommit": "b42ca11b712c2b32bdac1fcc1146aa94a6f35d9a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODM3MDM1MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r488370351", "bodyText": "added space after '#'", "author": "aswinijena100", "createdAt": "2020-09-15T04:06:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI3MDI3MQ=="}], "type": "inlineReview"}, {"oid": "43b7e35cdd09f90a36f490b5a3998bd660dc1b10", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/43b7e35cdd09f90a36f490b5a3998bd660dc1b10", "message": "review comment fixes\n\nreview comment fixes", "committedDate": "2020-09-15T04:05:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODY4MzY2Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r488683667", "bodyText": "certificate values should all come from env as well, no?", "author": "zohrehj", "createdAt": "2020-09-15T13:50:16Z", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/resources/application.properties", "diffHunk": "@@ -13,95 +29,65 @@ spring.datasource.hikari.minimum-idle=10\n spring.datasource.hikari.maximum-pool-size=100\n spring.datasource.hikari.connectionTimeout=30000\n spring.datasource.hikari.maxLifetime=1800000\n-spring.datasource.driver-class-name=com.mysql.jdbc.Driver\n-spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL5InnoDBDialect\n-\n-# JPA \n-spring.jpa.show-sql=true\n-spring.jpa.hibernate.ddl-auto=update\n-spring.jpa.hibernate.naming.strategy=org.hibernate.cfg.ImprovedNamingStrategy\n-\n \n # EMBEDDED SERVER CONFIGURATION\n server.servlet.contextPath=/myStudiesUserMgmtWS\n-\n #local to run\n server.port=8090\n \n # HTTP encoding\n spring.http.encoding.charset=UTF-8\n-\n spring.jmx.enabled = false\n \n-interceptor=/register,/resendConfirmation,/healthCheck\n-\n-#API calls directly from another server\n-serverApiUrls=/studies/studymetadata,/studies/sendNotification\n-\n-\n-from.email.address=apps@boston-technology.com\n-from.email.password=Btc@app@123\n+from.email.address=${FROM_EMAIL_ADDRESS}\n+from.email.password=${FROM_EMAIL_PASSWORD}\n # Unused with IP whitelist.\n-\n-smtp.hostname=smtp.gmail.com\n+smtp.hostname=${SMTP_HOSTNAME}\n smtp.port=465\n factory.value=javax.net.ssl.SSLSocketFactory\n \n-from.email.use_ip_whitelist=\n+from.email.use_ip_whitelist=${SMTP_USE_IP_WHITELIST}\n # Domain should be the email domain excluding the end,\n # i.e. rocketturtle instead of rocketturtle.net\n-from.email.domain=\n-\n+from.email.domain=${FROM_EMAIL_DOMAIN}\n # Empty whitelist means all domains are valid.\n email.whitelisted_domains=\n-\n-cloud.institution.bucket=\n-\n+cloud.institution.bucket=${INSTITUTION_RESOURCES_BUCKET_NAME}\n \n AUTH_KEY_FCM=XXXX\n-\n API_URL_FCM=https://fcm.googleapis.com/fcm/send\n-\n-#Auth Server Local\n-\n-register.url=http://35.193.185.224:8087/oauth-scim-service/users\n-auth.server.updateStatus.url=http://35.193.185.224:8087/oauth-scim-service/users/{userId}\n-\n-response.server.url.participant.withdraw=http://35.193.185.224:8084/mystudies-response-server/participant/withdraw\n-\n #App security\n certificate.name=push_prod.p12\n-\n certificate.password=XXXX\n+#please keep sandbox/production based on your ios app release type\n+ios.push.notification.type=sandbox", "originalCommit": "3904a2ce15a8c256d63b9f810f88c0f1557bbd04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE3Nzg5Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r489177893", "bodyText": "It can be configured as env variable as this one is depends IOS app platform. Added ${IOS_NOTIFICATION_TYPE} now", "author": "aswinijena100", "createdAt": "2020-09-16T05:48:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODY4MzY2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODY4NDE4Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r488684187", "bodyText": "the addition of {userId} seems different from other URLs, can you please point out to where it gets updated in the code?", "author": "zohrehj", "createdAt": "2020-09-15T13:50:53Z", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/resources/application.properties", "diffHunk": "@@ -13,95 +29,65 @@ spring.datasource.hikari.minimum-idle=10\n spring.datasource.hikari.maximum-pool-size=100\n spring.datasource.hikari.connectionTimeout=30000\n spring.datasource.hikari.maxLifetime=1800000\n-spring.datasource.driver-class-name=com.mysql.jdbc.Driver\n-spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL5InnoDBDialect\n-\n-# JPA \n-spring.jpa.show-sql=true\n-spring.jpa.hibernate.ddl-auto=update\n-spring.jpa.hibernate.naming.strategy=org.hibernate.cfg.ImprovedNamingStrategy\n-\n \n # EMBEDDED SERVER CONFIGURATION\n server.servlet.contextPath=/myStudiesUserMgmtWS\n-\n #local to run\n server.port=8090\n \n # HTTP encoding\n spring.http.encoding.charset=UTF-8\n-\n spring.jmx.enabled = false\n \n-interceptor=/register,/resendConfirmation,/healthCheck\n-\n-#API calls directly from another server\n-serverApiUrls=/studies/studymetadata,/studies/sendNotification\n-\n-\n-from.email.address=apps@boston-technology.com\n-from.email.password=Btc@app@123\n+from.email.address=${FROM_EMAIL_ADDRESS}\n+from.email.password=${FROM_EMAIL_PASSWORD}\n # Unused with IP whitelist.\n-\n-smtp.hostname=smtp.gmail.com\n+smtp.hostname=${SMTP_HOSTNAME}\n smtp.port=465\n factory.value=javax.net.ssl.SSLSocketFactory\n \n-from.email.use_ip_whitelist=\n+from.email.use_ip_whitelist=${SMTP_USE_IP_WHITELIST}\n # Domain should be the email domain excluding the end,\n # i.e. rocketturtle instead of rocketturtle.net\n-from.email.domain=\n-\n+from.email.domain=${FROM_EMAIL_DOMAIN}\n # Empty whitelist means all domains are valid.\n email.whitelisted_domains=\n-\n-cloud.institution.bucket=\n-\n+cloud.institution.bucket=${INSTITUTION_RESOURCES_BUCKET_NAME}\n \n AUTH_KEY_FCM=XXXX\n-\n API_URL_FCM=https://fcm.googleapis.com/fcm/send\n-\n-#Auth Server Local\n-\n-register.url=http://35.193.185.224:8087/oauth-scim-service/users\n-auth.server.updateStatus.url=http://35.193.185.224:8087/oauth-scim-service/users/{userId}\n-\n-response.server.url.participant.withdraw=http://35.193.185.224:8084/mystudies-response-server/participant/withdraw\n-\n #App security\n certificate.name=push_prod.p12\n-\n certificate.password=XXXX\n+#please keep sandbox/production based on your ios app release type\n+ios.push.notification.type=sandbox\n \n-confirmation.mail.subject=Welcome to the <App Name> App!\n+#Auth Server Local\n+register.url=${HYDRA_ADMIN_URL}/users\n+auth.server.updateStatus.url=${HYDRA_ADMIN_URL}/users/{userId}", "originalCommit": "3904a2ce15a8c256d63b9f810f88c0f1557bbd04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE3MzQzMQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r489173431", "bodyText": "fda-mystudies/user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/util/UserManagementUtil.java\n    \n    \n        Lines 56 to 80\n      in\n      a26203c\n    \n    \n    \n    \n\n        \n          \n           public UpdateEmailStatusResponse updateUserInfoInAuthServer( \n        \n\n        \n          \n               UpdateEmailStatusRequest updateEmailStatusRequest, String userId) { \n        \n\n        \n          \n             logger.info(\"(Util)....UserManagementUtil.updateUserInfoInAuthServer()......STARTED\"); \n        \n\n        \n          \n            \n        \n\n        \n          \n             HttpHeaders headers = new HttpHeaders(); \n        \n\n        \n          \n             headers.setContentType(MediaType.APPLICATION_JSON); \n        \n\n        \n          \n             headers.add(\"Authorization\", \"Bearer \" + oauthService.getAccessToken()); \n        \n\n        \n          \n            \n        \n\n        \n          \n             HttpEntity<UpdateEmailStatusRequest> request = \n        \n\n        \n          \n                 new HttpEntity<>(updateEmailStatusRequest, headers); \n        \n\n        \n          \n             ResponseEntity<UpdateEmailStatusResponse> responseEntity = \n        \n\n        \n          \n                 restTemplate.exchange( \n        \n\n        \n          \n                     appConfig.getAuthServerUpdateStatusUrl(), \n        \n\n        \n          \n                     HttpMethod.PUT, \n        \n\n        \n          \n                     request, \n        \n\n        \n          \n                     UpdateEmailStatusResponse.class, \n        \n\n        \n          \n                     userId); \n        \n\n        \n          \n             UpdateEmailStatusResponse updateEmailResponse = responseEntity.getBody(); \n        \n\n        \n          \n            \n        \n\n        \n          \n             logger.debug( \n        \n\n        \n          \n                 String.format( \n        \n\n        \n          \n                     \"status =%d, message=%s\", \n        \n\n        \n          \n                     updateEmailResponse.getHttpStatusCode(), updateEmailResponse.getMessage())); \n        \n\n        \n          \n             return updateEmailResponse; \n        \n\n        \n          \n           }", "author": "aswinijena100", "createdAt": "2020-09-16T05:34:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODY4NDE4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA2NDkzMQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r495064931", "bodyText": "thanks", "author": "zohrehj", "createdAt": "2020-09-25T15:27:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODY4NDE4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODY4NTI4Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r488685282", "bodyText": "what about this property?should it be coming from a variable?", "author": "zohrehj", "createdAt": "2020-09-15T13:52:22Z", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/resources/application.properties", "diffHunk": "@@ -1,107 +1,93 @@\n-#dev\n+# spring configurations\n+spring.profiles.active=@spring.profiles.active@\n+spring.main.allow-bean-definition-overriding=true\n+\n+# log configuration\n+logging.path=${LOG_PATH}\n+logging.file=${logging.path}/user_mgmt_service.log\n+logging.file.max-size= 1024KB\n+\n+logging.level.root=WARN\n+logging.level.com.google.cloud.healthcare.fdamystudies=WARN\n+\n email.code.expire_time = 15\n \n-spring.datasource.url=jdbc:mysql://35.196.150.7/mystudies_userregistration?createDatabaseIfNotExist=true&autoReconnect=true&characterEncoding=utf8&useSSL=false&allowPublicKeyRetrieval=true\n-spring.datasource.username=registration-server-user\n-spring.datasource.password=f]E45/=P\n+spring.datasource.url=jdbc:mysql://127.0.0.1:3306/${DB_NAME}?createDatabaseIfNotExist=true&autoReconnect=true&characterEncoding=utf8&useSSL=false&allowPublicKeyRetrieval=true\n+spring.datasource.username=${DB_USER}\n+spring.datasource.password=${DB_PASS}\n+spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver\n+# JPA \n+spring.jpa.database-platform=org.hibernate.dialect.MySQL5InnoDBDialect\n+spring.jpa.show-sql=false\n+spring.jpa.hibernate.ddl-auto=update\n \n-#hikari   \n+# hikari   \n spring.datasource.type=com.zaxxer.hikari.HikariDataSource\n spring.datasource.hikari.connection-test-query=SELECT 1\n spring.datasource.hikari.idle-timeout=600000\n spring.datasource.hikari.minimum-idle=10\n spring.datasource.hikari.maximum-pool-size=100\n spring.datasource.hikari.connectionTimeout=30000\n spring.datasource.hikari.maxLifetime=1800000\n-spring.datasource.driver-class-name=com.mysql.jdbc.Driver\n-spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL5InnoDBDialect\n-\n-# JPA \n-spring.jpa.show-sql=true\n-spring.jpa.hibernate.ddl-auto=update\n-spring.jpa.hibernate.naming.strategy=org.hibernate.cfg.ImprovedNamingStrategy\n-\n \n # EMBEDDED SERVER CONFIGURATION\n server.servlet.contextPath=/myStudiesUserMgmtWS\n-\n-#local to run\n+# local to run\n server.port=8090\n \n # HTTP encoding\n spring.http.encoding.charset=UTF-8\n-\n spring.jmx.enabled = false\n \n-interceptor=/register,/resendConfirmation,/healthCheck\n-\n-#API calls directly from another server\n-serverApiUrls=/studies/studymetadata,/studies/sendNotification\n-\n-\n-from.email.address=apps@boston-technology.com\n-from.email.password=Btc@app@123\n+from.email.address=${FROM_EMAIL_ADDRESS}\n+from.email.password=${FROM_EMAIL_PASSWORD}\n # Unused with IP whitelist.\n-\n-smtp.hostname=smtp.gmail.com\n+smtp.hostname=${SMTP_HOSTNAME}\n smtp.port=465\n factory.value=javax.net.ssl.SSLSocketFactory\n \n-from.email.use_ip_whitelist=\n+from.email.use_ip_whitelist=${SMTP_USE_IP_WHITELIST}\n # Domain should be the email domain excluding the end,\n-# i.e. domain instead of domain.com\n-from.email.domain=\n-\n+# i.e. rocketturtle instead of rocketturtle.net\n+from.email.domain=${FROM_EMAIL_DOMAIN}\n # Empty whitelist means all domains are valid.\n email.whitelisted_domains=\n-\n-cloud.institution.bucket=\n-\n+cloud.institution.bucket=${INSTITUTION_RESOURCES_BUCKET_NAME}\n \n AUTH_KEY_FCM=XXXX", "originalCommit": "43b7e35cdd09f90a36f490b5a3998bd660dc1b10", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE3ODY2NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r489178665", "bodyText": "Its not used, hence removed now", "author": "aswinijena100", "createdAt": "2020-09-16T05:50:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODY4NTI4Mg=="}], "type": "inlineReview"}, {"oid": "aeda268cd57af05f39af385519c324bee4ec2193", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/aeda268cd57af05f39af385519c324bee4ec2193", "message": "Review comment fixes on 19/09/2020\n\nReview comment fixes on 19/09/2020", "committedDate": "2020-09-16T05:51:22Z", "type": "commit"}, {"oid": "cbc793ed3e2488591f6ada094dc8a66c451ff89a", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/cbc793ed3e2488591f6ada094dc8a66c451ff89a", "message": "Merge branch 'develop' into user-reg-server-externalized-configuration", "committedDate": "2020-09-16T05:54:18Z", "type": "commit"}, {"oid": "4ce7b85f68d96a60c416625835ee7a7af9687fbd", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4ce7b85f68d96a60c416625835ee7a7af9687fbd", "message": "refactored properties\n\nrefactored properties", "committedDate": "2020-09-18T11:54:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk5MjIxMQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/890#discussion_r490992211", "bodyText": "can you add a comment or example of what this URL should come from?", "author": "zohrehj", "createdAt": "2020-09-18T14:33:55Z", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/resources/application.properties", "diffHunk": "@@ -1,107 +1,88 @@\n-#dev\n+# spring configurations\n+spring.profiles.active=@spring.profiles.active@\n+spring.main.allow-bean-definition-overriding=true\n+\n+# log configuration\n+logging.path=${LOG_PATH}\n+logging.file=${logging.path}/user_mgmt_service.log\n+logging.file.max-size= 1024KB\n+\n+logging.level.root=WARN\n+logging.level.com.google.cloud.healthcare.fdamystudies=WARN\n+\n email.code.expire_time = 15\n \n-spring.datasource.url=jdbc:mysql://35.196.150.7/mystudies_userregistration?createDatabaseIfNotExist=true&autoReconnect=true&characterEncoding=utf8&useSSL=false&allowPublicKeyRetrieval=true\n-spring.datasource.username=registration-server-user\n-spring.datasource.password=f]E45/=P\n+# Refer https://dev.mysql.com/doc/connector-j/8.0/en/connector-j-reference-configuration-properties.html\n+spring.datasource.url=jdbc:mysql://127.0.0.1:3306/${DB_NAME}\n+spring.datasource.username=${DB_USER}\n+spring.datasource.password=${DB_PASS}\n+spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver\n+spring.jpa.database-platform=org.hibernate.dialect.MySQL5InnoDBDialect\n+spring.jpa.show-sql=false\n+spring.jpa.hibernate.ddl-auto=none\n \n-#hikari   \n+# https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html#data-properties\n spring.datasource.type=com.zaxxer.hikari.HikariDataSource\n spring.datasource.hikari.connection-test-query=SELECT 1\n spring.datasource.hikari.idle-timeout=600000\n spring.datasource.hikari.minimum-idle=10\n spring.datasource.hikari.maximum-pool-size=100\n spring.datasource.hikari.connectionTimeout=30000\n spring.datasource.hikari.maxLifetime=1800000\n-spring.datasource.driver-class-name=com.mysql.jdbc.Driver\n-spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL5InnoDBDialect\n-\n-# JPA \n-spring.jpa.show-sql=true\n-spring.jpa.hibernate.ddl-auto=update\n-spring.jpa.hibernate.naming.strategy=org.hibernate.cfg.ImprovedNamingStrategy\n-\n \n # EMBEDDED SERVER CONFIGURATION\n server.servlet.contextPath=/myStudiesUserMgmtWS\n-\n-#local to run\n+# local to run\n server.port=8090\n \n # HTTP encoding\n spring.http.encoding.charset=UTF-8\n-\n spring.jmx.enabled = false\n \n-interceptor=/register,/resendConfirmation,/healthCheck\n-\n-#API calls directly from another server\n-serverApiUrls=/studies/studymetadata,/studies/sendNotification\n-\n-\n-from.email.address=apps@boston-technology.com\n-from.email.password=Btc@app@123\n+from.email.address=${FROM_EMAIL_ADDRESS}\n+from.email.password=${FROM_EMAIL_PASSWORD}\n # Unused with IP whitelist.\n-\n-smtp.hostname=smtp.gmail.com\n+smtp.hostname=${SMTP_HOSTNAME}\n smtp.port=465\n factory.value=javax.net.ssl.SSLSocketFactory\n \n-from.email.use_ip_whitelist=\n+from.email.use_ip_whitelist=${SMTP_USE_IP_WHITELIST}\n # Domain should be the email domain excluding the end,\n-# i.e. domain instead of domain.com\n-from.email.domain=\n-\n+# i.e. rocketturtle instead of rocketturtle.net\n+from.email.domain=${FROM_EMAIL_DOMAIN}\n # Empty whitelist means all domains are valid.\n email.whitelisted_domains=\n+cloud.institution.bucket=${INSTITUTION_RESOURCES_BUCKET_NAME}\n ", "originalCommit": "4ce7b85f68d96a60c416625835ee7a7af9687fbd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0eabfb087b2dd5a7177ef87327ae8cd8722e5e49", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0eabfb087b2dd5a7177ef87327ae8cd8722e5e49", "message": "Merge branch 'develop' into user-reg-server-externalized-configuration", "committedDate": "2020-09-25T12:36:50Z", "type": "commit"}, {"oid": "e65c8fbfb1da998fe573011419e50b9030c8285c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e65c8fbfb1da998fe573011419e50b9030c8285c", "message": "Merge branch 'develop' into user-reg-server-externalized-configuration", "committedDate": "2020-09-25T15:44:43Z", "type": "commit"}, {"oid": "297ccd8c48e6a12d502ea16028290709e46ad616", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/297ccd8c48e6a12d502ea16028290709e46ad616", "message": "Merge branch 'develop' into user-reg-server-externalized-configuration", "committedDate": "2020-09-25T15:54:22Z", "type": "commit"}, {"oid": "19e39fa28ebe301fd927d5ad058a5c89c00c6d26", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/19e39fa28ebe301fd927d5ad058a5c89c00c6d26", "message": "Merge branch 'develop' into user-reg-server-externalized-configuration", "committedDate": "2020-09-25T16:05:33Z", "type": "commit"}]}