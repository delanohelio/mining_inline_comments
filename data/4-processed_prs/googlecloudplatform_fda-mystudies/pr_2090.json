{"pr_number": 2090, "pr_title": "Add logs writer permission for Service Accounts to fix issue 2058", "pr_createdAt": "2020-11-18T21:59:25Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090", "timeline": [{"oid": "a951fc3fd04445ebcdc65e34c86ffa3384186792", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a951fc3fd04445ebcdc65e34c86ffa3384186792", "message": "Add logs writer permission for Service Accounts to fix issue 2058", "committedDate": "2020-11-18T21:57:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2MDkwNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090#discussion_r526460905", "bodyText": "Should be inserted at line L605 so those permissions are added in the apps projects. Since the SAs are created in the same deployment, we need to ensure the permissions are granted after the SAs are created. To do that, we can use references to enforce the dependency. For example\ndo\n\"\"serviceAccount:$${google_service_account.auth_server_gke_sa.account_id}@{{$prefix}}-{{$env}}-apps.iam.gserviceaccount.com\"\ninstead of \"serviceAccount:auth-server-gke-sa@{{$prefix}}-{{$env}}-apps.iam.gserviceaccount.com\" directly.\nBe careful with the Terraform references should use _ instead of -", "author": "xingao267", "createdAt": "2020-11-18T22:19:02Z", "path": "deployment.hcl", "diffHunk": "@@ -749,6 +749,19 @@ EOF\n           \"serviceAccount:participant-manager-gke-sa@{{$prefix}}-{{$env}}-apps.iam.gserviceaccount.com\",\n           \"serviceAccount:triggers-pubsub-handler-gke-sa@{{$prefix}}-{{$env}}-apps.iam.gserviceaccount.com\",\n         ]\n+        \"roles/logging.logWriter \" = [", "originalCommit": "a951fc3fd04445ebcdc65e34c86ffa3384186792", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ4Njc4MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090#discussion_r526486780", "bodyText": "Done", "author": "saminguyen", "createdAt": "2020-11-18T23:17:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2MDkwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUwNzAwOQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090#discussion_r526507009", "bodyText": "I guess we probably refer to the same file at different commit. Should be added after https://github.com/GoogleCloudPlatform/fda-mystudies/blob/develop/mystudies.hcl#L604", "author": "xingao267", "createdAt": "2020-11-19T00:12:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2MDkwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYwNTk0Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090#discussion_r526605946", "bodyText": "I think I finally got it.", "author": "saminguyen", "createdAt": "2020-11-19T05:37:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2MDkwNQ=="}], "type": "inlineReview"}, {"oid": "81440c1b426ea88187cce74dec1548ed02a6779c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/81440c1b426ea88187cce74dec1548ed02a6779c", "message": "moved the logs writer roll assignments up", "committedDate": "2020-11-18T23:00:21Z", "type": "commit"}, {"oid": "0b020dd09e7f19151261af5455ff6b35bc68e3d7", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0b020dd09e7f19151261af5455ff6b35bc68e3d7", "message": "fixed conflicts", "committedDate": "2020-11-18T23:14:08Z", "type": "commit"}, {"oid": "e82c948a84e8b444949ad72e9f291bfeadb94424", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e82c948a84e8b444949ad72e9f291bfeadb94424", "message": "fixed references", "committedDate": "2020-11-18T23:17:06Z", "type": "commit"}, {"oid": "40744c4f72c4922be94dec0255b17a29f18bef24", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/40744c4f72c4922be94dec0255b17a29f18bef24", "message": "fixed references", "committedDate": "2020-11-19T05:35:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk3NzMzNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090#discussion_r526977335", "bodyText": "Consider adding a comment why these IAM bindings are needed.", "author": "xingao267", "createdAt": "2020-11-19T15:29:12Z", "path": "mystudies.hcl", "diffHunk": "@@ -602,6 +602,19 @@ template \"project_apps\" {\n         { account_id = \"participant-manager-gke-sa\" },\n         { account_id = \"triggers-pubsub-handler-gke-sa\" },\n       ]\n+", "originalCommit": "40744c4f72c4922be94dec0255b17a29f18bef24", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA1NDI2OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090#discussion_r527054268", "bodyText": "Done", "author": "saminguyen", "createdAt": "2020-11-19T17:08:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk3NzMzNQ=="}], "type": "inlineReview"}, {"oid": "22b655140186635acd0192aad64aa02cc92e4331", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/22b655140186635acd0192aad64aa02cc92e4331", "message": "added comment", "committedDate": "2020-11-19T17:07:01Z", "type": "commit"}, {"oid": "ed227f9c038e79bde461835f3be7b28af3c54d96", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ed227f9c038e79bde461835f3be7b28af3c54d96", "message": "Merge branch 'develop' into fix-issue-2058", "committedDate": "2020-11-19T17:12:35Z", "type": "commit"}, {"oid": "101693f7cf1d380493c02da6b95f021775dd003e", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/101693f7cf1d380493c02da6b95f021775dd003e", "message": "Merge branch 'develop' into fix-issue-2058", "committedDate": "2020-11-19T17:13:03Z", "type": "commit"}]}