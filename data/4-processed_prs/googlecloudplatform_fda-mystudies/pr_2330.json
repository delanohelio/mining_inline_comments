{"pr_number": 2330, "pr_title": "PM Web App -App participant registry server side pagination", "pr_createdAt": "2020-12-10T17:22:01Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330", "timeline": [{"oid": "29b79bd686979ab53f3bfa2ed8251d3305db5ff0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/29b79bd686979ab53f3bfa2ed8251d3305db5ff0", "message": "app participant registry server side pagination", "committedDate": "2020-12-10T17:19:20Z", "type": "commit"}, {"oid": "375fce69af013ab3a51b32da88ce3948cc09777b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/375fce69af013ab3a51b32da88ce3948cc09777b", "message": "Merge branch 'develop' into pm-webapp-app-participant-pagination", "committedDate": "2020-12-10T17:22:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY4OTc0NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#discussion_r540689744", "bodyText": "this should check whether page > 1, to prevent ever returning a negative offset.", "author": "zohrehj", "createdAt": "2020-12-11T04:53:20Z", "path": "participant-manager/src/app/site-coordinator/apps/app-details/app-details.component.ts", "diffHunk": "@@ -59,23 +63,45 @@ export class AppDetailsComponent\n \n   fetchParticipantsDetails(): void {\n     this.appDetail$ = combineLatest(\n-      this.appDetailsService.get(this.appId),\n-      this.query$,\n+      this.appDetailsService.get(\n+        this.appId,\n+        this.offset,\n+        this.limit,\n+        this.searchTerm,\n+        this.sortBy[0].replace('_', ''),\n+        this.sortOrder,\n+      ),\n     ).pipe(\n-      map(([appDetails, query]) => {\n-        this.appDetailsBackup = JSON.parse(\n-          JSON.stringify(appDetails),\n-        ) as AppDetails;\n-        this.appDetailsBackup.participants = this.appDetailsBackup.participants.filter(\n-          (participant: Participant) =>\n-            participant.email?.toLowerCase().includes(query.toLowerCase()),\n-        );\n-        return this.appDetailsBackup;\n+      map(([appDetails]) => {\n+        return appDetails;\n       }),\n     );\n   }\n \n   search(query: string): void {\n-    this.query$.next(query.trim());\n+    this.currentPage = 1;\n+    this.offset = 0;\n+    this.searchTerm = query.trim().toLowerCase();\n+    this.fetchParticipantsDetails();\n+  }\n+\n+  pageChange(page: number): void {\n+    this.currentPage = page;\n+    this.offset = (page - 1) * this.limit;", "originalCommit": "375fce69af013ab3a51b32da88ce3948cc09777b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDcxMjExOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#discussion_r540712118", "bodyText": "Updated.", "author": "firdosebtc1", "createdAt": "2020-12-11T06:05:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY4OTc0NA=="}], "type": "inlineReview"}, {"oid": "80b90311632938f9418838f9210288439909b6f5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/80b90311632938f9418838f9210288439909b6f5", "message": "code review comments has been resolved", "committedDate": "2020-12-11T05:59:38Z", "type": "commit"}, {"oid": "e88bf312cb325125acad03b20b0c523c4b2187de", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e88bf312cb325125acad03b20b0c523c4b2187de", "message": "Merge branch 'develop' into pm-webapp-app-participant-pagination", "committedDate": "2020-12-11T06:05:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTEyMjk1Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#discussion_r541122953", "bodyText": "you need to handle the case when page =0, your code does nothing right now", "author": "zohrehj", "createdAt": "2020-12-11T17:52:11Z", "path": "participant-manager/src/app/site-coordinator/apps/app-details/app-details.component.ts", "diffHunk": "@@ -59,23 +63,47 @@ export class AppDetailsComponent\n \n   fetchParticipantsDetails(): void {\n     this.appDetail$ = combineLatest(\n-      this.appDetailsService.get(this.appId),\n-      this.query$,\n+      this.appDetailsService.get(\n+        this.appId,\n+        this.offset,\n+        this.limit,\n+        this.searchTerm,\n+        this.sortBy[0].replace('_', ''),\n+        this.sortOrder,\n+      ),\n     ).pipe(\n-      map(([appDetails, query]) => {\n-        this.appDetailsBackup = JSON.parse(\n-          JSON.stringify(appDetails),\n-        ) as AppDetails;\n-        this.appDetailsBackup.participants = this.appDetailsBackup.participants.filter(\n-          (participant: Participant) =>\n-            participant.email?.toLowerCase().includes(query.toLowerCase()),\n-        );\n-        return this.appDetailsBackup;\n+      map(([appDetails]) => {\n+        return appDetails;\n       }),\n     );\n   }\n \n   search(query: string): void {\n-    this.query$.next(query.trim());\n+    this.currentPage = 1;\n+    this.offset = 0;\n+    this.searchTerm = query.trim().toLowerCase();\n+    this.fetchParticipantsDetails();\n+  }\n+\n+  pageChange(page: number): void {\n+    if (page >= 1) {\n+      this.currentPage = page;\n+      this.offset = (page - 1) * this.limit;\n+      this.fetchParticipantsDetails();\n+    }", "originalCommit": "e88bf312cb325125acad03b20b0c523c4b2187de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE0NjA5OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#discussion_r542146099", "bodyText": "we are using ngx-pagination plugin for pagination and the plugin gives page numbers from 1 to n ,0 can't be a page number here", "author": "firdosebtc1", "createdAt": "2020-12-14T06:42:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTEyMjk1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjM5Njg2Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#discussion_r542396867", "bodyText": "what is page set to if it's not passed through pagination?", "author": "zohrehj", "createdAt": "2020-12-14T13:49:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTEyMjk1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQwNTU4MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#discussion_r542405581", "bodyText": "by default current page will be 1 on page load", "author": "firdosebtc1", "createdAt": "2020-12-14T14:01:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTEyMjk1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjYxNjUyNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#discussion_r542616525", "bodyText": "what does your backend expect? most databases assume first page is 0.", "author": "zohrehj", "createdAt": "2020-12-14T18:30:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTEyMjk1Mw=="}], "type": "inlineReview"}, {"oid": "e5053968c9535358f2c07e9d2505b215deb8cd50", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e5053968c9535358f2c07e9d2505b215deb8cd50", "message": "Merge branch 'develop' into pm-webapp-app-participant-pagination", "committedDate": "2020-12-14T13:55:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQwNTI2Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#discussion_r542405262", "bodyText": "by default current page will be 1 on page load", "author": "firdosebtc1", "createdAt": "2020-12-14T14:00:40Z", "path": "participant-manager/src/app/site-coordinator/apps/app-details/app-details.component.ts", "diffHunk": "@@ -18,13 +18,17 @@ export class AppDetailsComponent\n   extends UnsubscribeOnDestroyAdapter\n   implements OnInit {\n   appId = '';\n-  query$ = new BehaviorSubject('');\n   appDetail$: Observable<AppDetails> = of();\n-  appDetailsBackup = {} as AppDetails;\n   statusEnum = Status;\n   enrolledStudies: EnrolledStudy[] = [];\n   studyTypes = StudyType;\n-\n+  // pagination\n+  limit = 10;\n+  currentPage = 1;", "originalCommit": "e5053968c9535358f2c07e9d2505b215deb8cd50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQzODMyNw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#discussion_r542438327", "bodyText": "then why are onSortOrder and other methods setting it to 0?", "author": "zohrehj", "createdAt": "2020-12-14T14:44:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQwNTI2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU2ODc5Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#discussion_r542568797", "bodyText": "updated current page to 0 in all places ,Please check", "author": "firdosebtc1", "createdAt": "2020-12-14T17:28:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQwNTI2Mg=="}], "type": "inlineReview"}, {"oid": "47a617decbdc619ff1b0b56a733e1a429f610f98", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/47a617decbdc619ff1b0b56a733e1a429f610f98", "message": "code review comments has been resolved", "committedDate": "2020-12-14T17:27:58Z", "type": "commit"}, {"oid": "5b152ed0d2a6ff1ab691e4196ea0f756b1ca5667", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5b152ed0d2a6ff1ab691e4196ea0f756b1ca5667", "message": "Merge branch 'develop' of https://github.com/GoogleCloudPlatform/fda-mystudies into pm-webapp-app-participant-pagination\n\n# Conflicts:\n#\tparticipant-manager/src/app/site-coordinator/apps/apps.module.ts", "committedDate": "2020-12-15T06:11:42Z", "type": "commit"}, {"oid": "8de64068250fd58ed8d44e9da0e888a7470bf829", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8de64068250fd58ed8d44e9da0e888a7470bf829", "message": "Merge branch 'develop' into pm-webapp-app-participant-pagination", "committedDate": "2020-12-15T14:45:46Z", "type": "commit"}, {"oid": "d07e7717ab487e86ee0e2dc49dbc5527f7e14290", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d07e7717ab487e86ee0e2dc49dbc5527f7e14290", "message": "Merge branch 'develop' into pm-webapp-app-participant-pagination", "committedDate": "2020-12-15T14:48:50Z", "type": "commit"}, {"oid": "29c583803421bb058899e5247e09a498b9b17665", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/29c583803421bb058899e5247e09a498b9b17665", "message": "Merge branch 'develop' into pm-webapp-app-participant-pagination", "committedDate": "2020-12-15T14:50:00Z", "type": "commit"}]}