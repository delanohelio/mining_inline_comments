{"pr_number": 2327, "pr_title": "Fixed #2269 urls.error does not appear to be configured in Hydra", "pr_createdAt": "2020-12-10T16:17:59Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2327", "timeline": [{"oid": "50e3222bac8a13ee8d6cd0845106d95c288d3a77", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/50e3222bac8a13ee8d6cd0845106d95c288d3a77", "message": "Fixed urls.error does not appear to be configured in Hydra #2269\n\nFixed urls.error does not appear to be configured in Hydra #2269", "committedDate": "2020-12-10T16:13:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDMwMzI5MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2327#discussion_r540303290", "bodyText": "[auth-server Checks] reported by reviewdog \ud83d\udc36\nMissing a Javadoc comment.", "author": "github-actions", "createdAt": "2020-12-10T16:19:36Z", "path": "auth-server/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/controller/GenericErrorController.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.oauthscim.controller;\n+\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.ERROR_VIEW_NAME;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.REDIRECT_ERROR_VIEW;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLDecoder;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import org.apache.commons.lang3.StringUtils;\n+import org.slf4j.ext.XLogger;\n+import org.slf4j.ext.XLoggerFactory;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.stereotype.Controller;\n+import org.springframework.ui.Model;\n+import org.springframework.web.bind.annotation.GetMapping;\n+\n+@Controller\n+public class GenericErrorController {\n+  private XLogger logger = XLoggerFactory.getXLogger(GenericErrorController.class.getName());\n+\n+  @GetMapping(value = \"/oauth2/error\")", "originalCommit": "50e3222bac8a13ee8d6cd0845106d95c288d3a77", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM0NDcwMA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2327#discussion_r540344700", "bodyText": "please add a description here.", "author": "zohrehj", "createdAt": "2020-12-10T17:09:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDMwMzI5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDgxOTU3Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2327#discussion_r540819576", "bodyText": "Fixed review comment", "author": "harisboston", "createdAt": "2020-12-11T09:45:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDMwMzI5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDMwNjMyNA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2327#discussion_r540306324", "bodyText": "how do you know this is a sign in error? just logging the error message might be a safer approach", "author": "zohrehj", "createdAt": "2020-12-10T16:23:32Z", "path": "auth-server/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/controller/GenericErrorController.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.oauthscim.controller;\n+\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.ERROR_VIEW_NAME;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.REDIRECT_ERROR_VIEW;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLDecoder;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import org.apache.commons.lang3.StringUtils;\n+import org.slf4j.ext.XLogger;\n+import org.slf4j.ext.XLoggerFactory;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.stereotype.Controller;\n+import org.springframework.ui.Model;\n+import org.springframework.web.bind.annotation.GetMapping;\n+\n+@Controller\n+public class GenericErrorController {\n+  private XLogger logger = XLoggerFactory.getXLogger(GenericErrorController.class.getName());\n+\n+  @GetMapping(value = \"/oauth2/error\")\n+  public String error(HttpServletRequest request, HttpServletResponse response, Model model)\n+      throws UnsupportedEncodingException {\n+    String errorDetails = request.getQueryString();\n+    if (StringUtils.isEmpty(errorDetails)) {\n+      return ERROR_VIEW_NAME;\n+    }\n+\n+    logger.error(\n+        String.format(\"sign-in failed due to %s\", URLDecoder.decode(errorDetails, \"UTF-8\")));", "originalCommit": "50e3222bac8a13ee8d6cd0845106d95c288d3a77", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDMyMjAwMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2327#discussion_r540322002", "bodyText": "Fixed review comment", "author": "harisboston", "createdAt": "2020-12-10T16:40:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDMwNjMyNA=="}], "type": "inlineReview"}, {"oid": "04276da8413b92320fee1596b90baf03ae2af00f", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/04276da8413b92320fee1596b90baf03ae2af00f", "message": "Fixed build failure\n\nFixed build failure", "committedDate": "2020-12-10T16:23:54Z", "type": "commit"}, {"oid": "d164e396a22403fdef67b656a648d0dcd4921187", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d164e396a22403fdef67b656a648d0dcd4921187", "message": "Fixed review comment\n\nFixed review comment", "committedDate": "2020-12-10T16:37:10Z", "type": "commit"}, {"oid": "8b0997f6d09b76e301937fac957a3b54858afdd3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8b0997f6d09b76e301937fac957a3b54858afdd3", "message": "Merge branch 'develop' into hydra-error-issue-2269", "committedDate": "2020-12-10T16:40:10Z", "type": "commit"}, {"oid": "8f8779e7d7e6f677781c65a6f23a1d98a66206f9", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8f8779e7d7e6f677781c65a6f23a1d98a66206f9", "message": "Merge branch 'develop' into hydra-error-issue-2269", "committedDate": "2020-12-10T17:30:19Z", "type": "commit"}, {"oid": "e7036b04b92db44f1f5d91d7dda570b6a686c190", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e7036b04b92db44f1f5d91d7dda570b6a686c190", "message": "Fixed review comment of PR  #2327\n\nFixed review comment of PR  #2327", "committedDate": "2020-12-11T09:19:09Z", "type": "commit"}, {"oid": "ff91da15e9b589963f75ce2ec109616736cff00c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ff91da15e9b589963f75ce2ec109616736cff00c", "message": "Merge branch 'develop' into hydra-error-issue-2269", "committedDate": "2020-12-11T09:22:10Z", "type": "commit"}, {"oid": "a510b90489bf1672ce7afb7a15c2775afb85e8f7", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a510b90489bf1672ce7afb7a15c2775afb85e8f7", "message": "Merge branch 'develop' into hydra-error-issue-2269", "committedDate": "2020-12-11T09:30:47Z", "type": "commit"}, {"oid": "9eb3b2e9543a7f00aa92233b9be9a87da1316598", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/9eb3b2e9543a7f00aa92233b9be9a87da1316598", "message": "Added Copyright\n\nAdded Copyright", "committedDate": "2020-12-11T10:24:18Z", "type": "commit"}, {"oid": "7e6e69ea48644e664ddb220be770c2adce78c3a7", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/7e6e69ea48644e664ddb220be770c2adce78c3a7", "message": "Merge branch 'develop' into hydra-error-issue-2269", "committedDate": "2020-12-14T10:39:44Z", "type": "commit"}, {"oid": "1d143383ad41f6f8361ab9d207ef952aebe0aec2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1d143383ad41f6f8361ab9d207ef952aebe0aec2", "message": "Update variables.env\n\nUpdate variables.env", "committedDate": "2020-12-14T13:01:11Z", "type": "commit"}, {"oid": "af17e8b9c8b462598554e53812e16a6ea890c95e", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/af17e8b9c8b462598554e53812e16a6ea890c95e", "message": "Updated D:\\BTC \\hydra\\variables.env\n\nUpdated D:\\BTC \\hydra\\variables.env", "committedDate": "2020-12-14T13:32:11Z", "type": "commit"}, {"oid": "fc6c3e8c3487cfcf722cd07b112454d4e6adb7c3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/fc6c3e8c3487cfcf722cd07b112454d4e6adb7c3", "message": "Merge branch 'develop' into hydra-error-issue-2269", "committedDate": "2020-12-14T14:04:21Z", "type": "commit"}, {"oid": "5292f494d52593a5245ae02ecc628ffe8c42492e", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5292f494d52593a5245ae02ecc628ffe8c42492e", "message": "Updated tf-deployment.yaml\n\nUpdated tf-deployment.yaml", "committedDate": "2020-12-14T16:12:56Z", "type": "commit"}, {"oid": "adfc3fa6ed421831ef65ed6419b917f97dd029f6", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/adfc3fa6ed421831ef65ed6419b917f97dd029f6", "message": "Merge branch 'develop' into hydra-error-issue-2269", "committedDate": "2020-12-14T16:39:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjUzMzg3Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2327#discussion_r542533872", "bodyText": "looks like this is not needed since URLS_ERROR in entrypoint.bash is only using AUTH_SERVER_BASE_URL and does not need any other values to be specified.", "author": "zohrehj", "createdAt": "2020-12-14T16:43:25Z", "path": "hydra/tf-deployment.yaml", "diffHunk": "@@ -59,6 +59,11 @@ spec:\n             secretKeyRef:\n               name: shared-secrets\n               key: base_url\n+        - name: URLS_ERROR\n+          valueFrom:\n+            secretKeyRef:\n+              name: shared-secrets\n+              key: base_url", "originalCommit": "adfc3fa6ed421831ef65ed6419b917f97dd029f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU0NTYwNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2327#discussion_r542545606", "bodyText": "Fixed review comment", "author": "harisboston", "createdAt": "2020-12-14T16:58:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjUzMzg3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjUzNDI2Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2327#discussion_r542534267", "bodyText": "@jkrogers18 to confirm.", "author": "zohrehj", "createdAt": "2020-12-14T16:43:50Z", "path": "hydra/variables.env", "diffHunk": "@@ -26,6 +26,12 @@ HYDRA_PUBLIC_BASE_URL=\n # For example, https://10.128.0.3\n AUTH_SERVER_BASE_URL=\n \n+# ORY Hydra error: Sets the error endpoint. \n+# The error ui will be shown when an OAuth2/Hydra error occurs that which can not be sent back to the client.\n+# Base URL of your `Auth server` instance\n+# For example, URLS_ERROR=https://10.128.0.3/oauth2/error\n+URLS_ERROR=\n+", "originalCommit": "adfc3fa6ed421831ef65ed6419b917f97dd029f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzMxOTAwMQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2327#discussion_r543319001", "bodyText": "Is \"/oauth2/error\" always the path to get to the error page? And is the that page already created for the customer? (e..g they don't have to make a custom error page at that location?). Also I'm wondering why the context path for the auth-server e.g. domain.com/auth-server/oauth2/error is removed - is that on purpose?\nIt seems that this entry is redundant because you already know the auth server URL from AUTH_SERVER_BASE_URL and everything else is constant. If that is correct then this should not be in variables.env but constructed from AUTH_SERVER_BASE_URL in entrypoiny.bash", "author": "jkrogers18", "createdAt": "2020-12-15T12:56:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjUzNDI2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzQ2NDMzMA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2327#discussion_r543464330", "bodyText": "@jkrogers18 Yes, \"/oauth2/error\" is the path to get to the custom error page (error.html) if there is any error from Hydra.\nRemoved URLS_ERROR from variables.env file.", "author": "harisboston", "createdAt": "2020-12-15T15:52:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjUzNDI2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzQ2NDg3NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2327#discussion_r543464875", "bodyText": "@jkrogers18 Yes, \"/oauth2/error\" is the path to get to the custom error page (error.html) if there is any error from Hydra.\nRemoved URLS_ERROR from variables.env file.", "author": "harisboston", "createdAt": "2020-12-15T15:52:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjUzNDI2Nw=="}], "type": "inlineReview"}, {"oid": "224044c502df8cde552c9db0187738816e61ca0c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/224044c502df8cde552c9db0187738816e61ca0c", "message": "Fixed review comment\n\nFixed review comment", "committedDate": "2020-12-14T16:52:41Z", "type": "commit"}, {"oid": "1366e15c2b8fa097ad383c547ae403a10b74017d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1366e15c2b8fa097ad383c547ae403a10b74017d", "message": "Merge branch 'develop' into hydra-error-issue-2269", "committedDate": "2020-12-14T16:58:21Z", "type": "commit"}, {"oid": "a591d7d887fa815740af80f633ee37c059930b6c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a591d7d887fa815740af80f633ee37c059930b6c", "message": "Merge branch 'develop' into hydra-error-issue-2269", "committedDate": "2020-12-14T17:55:19Z", "type": "commit"}, {"oid": "5083c6aa26b25a019c4fb3c8c5580a8e80374112", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5083c6aa26b25a019c4fb3c8c5580a8e80374112", "message": "Merge branch 'develop' into hydra-error-issue-2269", "committedDate": "2020-12-15T09:43:41Z", "type": "commit"}, {"oid": "939bfb376fc864aca1048ea8cca9d529c327ba51", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/939bfb376fc864aca1048ea8cca9d529c327ba51", "message": "updated variable.env\n\nupdated variable.env", "committedDate": "2020-12-15T15:36:29Z", "type": "commit"}, {"oid": "6ed751bca0b273d78f48d693d625e196facb1ea3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6ed751bca0b273d78f48d693d625e196facb1ea3", "message": "Merge branch 'develop' into hydra-error-issue-2269", "committedDate": "2020-12-15T15:52:14Z", "type": "commit"}, {"oid": "298f3a7167a87381f7aa86b0cf1295fea761cd52", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/298f3a7167a87381f7aa86b0cf1295fea761cd52", "message": "Merge branch 'develop' into hydra-error-issue-2269", "committedDate": "2020-12-15T16:06:43Z", "type": "commit"}]}