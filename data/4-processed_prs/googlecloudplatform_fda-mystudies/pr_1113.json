{"pr_number": 1113, "pr_title": "iOS - Hydra registration flow", "pr_createdAt": "2020-10-05T03:32:13Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1113", "timeline": [{"oid": "924f2179ab7921857d5c23de5ac36377bdf747a4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/924f2179ab7921857d5c23de5ac36377bdf747a4", "message": "Add Hydra registration.", "committedDate": "2020-09-28T06:27:39Z", "type": "commit"}, {"oid": "ace937ec68f85dc6ead223c6c086b672a273e5b7", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ace937ec68f85dc6ead223c6c086b672a273e5b7", "message": "Hydra forgot password and verification flow.", "committedDate": "2020-09-28T06:27:48Z", "type": "commit"}, {"oid": "17650f3d43855b2c6a43b2722d55eff67a0ca436", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/17650f3d43855b2c6a43b2722d55eff67a0ca436", "message": "Add Hydra logout.", "committedDate": "2020-09-28T06:28:13Z", "type": "commit"}, {"oid": "50491d1e01e232640c77caeb6b8cf074ae0b25d3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/50491d1e01e232640c77caeb6b8cf074ae0b25d3", "message": "Add registration UI test.", "committedDate": "2020-09-28T09:48:55Z", "type": "commit"}, {"oid": "3f9d11292137f97a9fcffa7994ef0fd7cb0723a0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3f9d11292137f97a9fcffa7994ef0fd7cb0723a0", "message": "fix verification flow", "committedDate": "2020-10-05T03:28:02Z", "type": "commit"}, {"oid": "16a658c2c2af7bb53247aa8797a58e51c9bb438e", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/16a658c2c2af7bb53247aa8797a58e51c9bb438e", "message": "Merge branch 'develop' into ios-hydra-services", "committedDate": "2020-10-05T03:37:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA3ODg1Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1113#discussion_r501078853", "bodyText": "please file a bug for remaining work and link in the TODO.", "author": "zohrehj", "createdAt": "2020-10-07T14:53:35Z", "path": "iOS/HPHC/HPHC/Networking/Services/APIService.swift", "diffHunk": "@@ -29,7 +29,17 @@ class APIService {\n           completion(nil, false, .defaultError)\n         }\n       case .failure:\n-        completion(nil, false, ApiError.defaultError) // TODO: Parse errors.\n+        if let error = ApiError(data: response.data) {\n+          if let code = error.code,\n+            code == .tokenExpired\n+          {\n+            // TODO: Refresh the token", "originalCommit": "16a658c2c2af7bb53247aa8797a58e51c9bb438e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExMTM4MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1113#discussion_r501111381", "bodyText": "I've actually updated it in the other PR. Raised issue #1170 and will close it from the linked PR.", "author": "tushar-boston", "createdAt": "2020-10-07T15:35:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA3ODg1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA4MDUxOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1113#discussion_r501080518", "bodyText": "shouldn't correlationID get stored? the way it is, it will return a new value for each call.", "author": "zohrehj", "createdAt": "2020-10-07T14:55:36Z", "path": "iOS/HPHC/HPHC/Networking/Services/SessionService.swift", "diffHunk": "@@ -27,7 +27,7 @@ class SessionService {\n   }\n \n   /// Current App Session ID\n-  private(set) var correlationID: String = {\n+  static var correlationID: String = {", "originalCommit": "16a658c2c2af7bb53247aa8797a58e51c9bb438e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExMzA3OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1113#discussion_r501113078", "bodyText": "Yes, you're right. It's not going to calculate each time getter gets called. I've also marked it as a static property so that it never changes in the current app session.", "author": "tushar-boston", "createdAt": "2020-10-07T15:38:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA4MDUxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA4MTk3OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1113#discussion_r501081978", "bodyText": "Is this a new text? if yes, please get it reviewed/approved.", "author": "zohrehj", "createdAt": "2020-10-07T14:57:32Z", "path": "iOS/HPHC/HPHC/Utils/Resources/Localizable/LocalizableString.swift", "diffHunk": "@@ -26,5 +28,7 @@ enum LocalizableString: String {\n   case blockerScreenLabelText = \"Please update to the latest version of the app to continue.\"\n   case appStoreUpdateText = \"Please go to AppStore to update to the latest version of the app.\"\n \n+  // MARK: - Errors\n+  case badHappened = \"Something bad happened\"", "originalCommit": "16a658c2c2af7bb53247aa8797a58e51c9bb438e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExNjM0Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1113#discussion_r501116342", "bodyText": "@sharathblr Could you please review this?", "author": "tushar-boston", "createdAt": "2020-10-07T15:42:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA4MTk3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI0OTI5Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1113#discussion_r503249297", "bodyText": "@tushar-boston -This has been reviewed and looks good.", "author": "sharathblr", "createdAt": "2020-10-12T12:05:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA4MTk3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA4MzE2MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1113#discussion_r501083161", "bodyText": "is there a need to verify success, or do failures automatically get surfaced?", "author": "zohrehj", "createdAt": "2020-10-07T14:59:00Z", "path": "iOS/HPHC/MyStudiesUITests/AuthTests.swift", "diffHunk": "@@ -0,0 +1,54 @@\n+//  Copyright 2020 Google LLC\n+//\n+//  Use of this source code is governed by an MIT-style\n+//  license that can be found in the LICENSE file or at\n+//  https://opensource.org/licenses/MIT.\n+\n+import XCTest\n+\n+class MyStudiesUITests: XCTestCase {\n+\n+  override func setUpWithError() throws {\n+    // In UI tests it is usually best to stop immediately when a failure occurs.\n+    continueAfterFailure = false\n+  }\n+\n+  func testLaunchPerformance() throws {\n+    if #available(macOS 10.15, iOS 13.0, tvOS 13.0, *) {\n+      // This measures how long it takes to launch your application.\n+      measure(metrics: [XCTOSSignpostMetric.applicationLaunch]) {\n+        XCUIApplication().launch()\n+      }\n+    }\n+  }\n+\n+  func testRegistrationFlow() {\n+\n+    let app = XCUIApplication()\n+    app.launch()\n+\n+    app.buttons[\"New User?\"].tap()\n+\n+    let tablesQuery2 = app.tables\n+    let tablesQuery = tablesQuery2\n+\n+    let emailField = tablesQuery.textFields[\"enter email\"]\n+    emailField.tap()\n+    emailField.typeText(\"test@xyz.la\")\n+\n+    let passwordField = tablesQuery.secureTextFields[\"add password\"]\n+    passwordField.tap()\n+    passwordField.typeText(\"Test@124\")\n+\n+    let confirmPasswordField = tablesQuery.secureTextFields[\"confirm password\"]\n+    confirmPasswordField.tap()\n+    confirmPasswordField.typeText(\"Test@124\")\n+\n+    app.tables.buttons[\"notChecked\"].tap()\n+\n+    app.toolbars[\"Toolbar\"].buttons[\"Done\"].tap()\n+    app.buttons[\"Submit\"].tap()\n+", "originalCommit": "16a658c2c2af7bb53247aa8797a58e51c9bb438e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTEyNTA5NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1113#discussion_r501125094", "bodyText": "failures automatically get surfaced. e.g. app.buttons[\"Submit\"].tap() executed and if the app was unable to find the button with \"Submit\" text, it'll fail the test case.", "author": "tushar-boston", "createdAt": "2020-10-07T15:54:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA4MzE2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA4MzQ4MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1113#discussion_r501083480", "bodyText": "if possible, please add test for a failure scenario as well.", "author": "zohrehj", "createdAt": "2020-10-07T14:59:24Z", "path": "iOS/HPHC/MyStudiesUITests/AuthTests.swift", "diffHunk": "@@ -0,0 +1,54 @@\n+//  Copyright 2020 Google LLC\n+//\n+//  Use of this source code is governed by an MIT-style\n+//  license that can be found in the LICENSE file or at\n+//  https://opensource.org/licenses/MIT.\n+\n+import XCTest\n+\n+class MyStudiesUITests: XCTestCase {\n+\n+  override func setUpWithError() throws {\n+    // In UI tests it is usually best to stop immediately when a failure occurs.\n+    continueAfterFailure = false\n+  }\n+\n+  func testLaunchPerformance() throws {\n+    if #available(macOS 10.15, iOS 13.0, tvOS 13.0, *) {\n+      // This measures how long it takes to launch your application.\n+      measure(metrics: [XCTOSSignpostMetric.applicationLaunch]) {\n+        XCUIApplication().launch()\n+      }\n+    }\n+  }\n+\n+  func testRegistrationFlow() {", "originalCommit": "16a658c2c2af7bb53247aa8797a58e51c9bb438e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExODg3MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1113#discussion_r501118871", "bodyText": "If there's any change in the flow than the same test case will fail. A failure test case is not required here.", "author": "tushar-boston", "createdAt": "2020-10-07T15:45:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA4MzQ4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk1Njk2OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1113#discussion_r501956969", "bodyText": "that's an assumption, the intent behind a failure test is to make sure that your application handles error as expected. e.g. auth failure gets shown to user with the correct error message etc\nIt is possible for an application to never fail and for that behavior to be incorrect as well.", "author": "zohrehj", "createdAt": "2020-10-08T19:18:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA4MzQ4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQyNzQ1Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1113#discussion_r502427457", "bodyText": "This is a UI test case and we should be just writing a correct flow. The test case will fail with a proper error if any element on the UI is moved and the flow is breaking due to some changes not implemented properly.", "author": "tushar-boston", "createdAt": "2020-10-09T13:29:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA4MzQ4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc2MDU0Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1113#discussion_r504760547", "bodyText": "then add a non-UI test to verify expected exception cases", "author": "zohrehj", "createdAt": "2020-10-14T15:14:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA4MzQ4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUyOTQyMw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1113#discussion_r513529423", "bodyText": "Added another test case for the failed scenario.", "author": "tushar-boston", "createdAt": "2020-10-28T15:17:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA4MzQ4MA=="}], "type": "inlineReview"}, {"oid": "1b5f78eb04062b3501994bfe4abba50c1a083a17", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1b5f78eb04062b3501994bfe4abba50c1a083a17", "message": "Avoid update profile call for logged out user.", "committedDate": "2020-10-07T16:15:44Z", "type": "commit"}, {"oid": "74e92dbae032806805556984689952d8ecb11c7e", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/74e92dbae032806805556984689952d8ecb11c7e", "message": "Merge branch 'develop' into ios-hydra-services", "committedDate": "2020-10-28T10:46:42Z", "type": "commit"}, {"oid": "4ce157e576a8f2ab742960e2baa3893930ab133d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4ce157e576a8f2ab742960e2baa3893930ab133d", "message": "Add failed registration test case.", "committedDate": "2020-10-28T15:13:57Z", "type": "commit"}, {"oid": "ffe66a15da5ed9841788b18bcf23710e9e359fec", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ffe66a15da5ed9841788b18bcf23710e9e359fec", "message": "Update endpoint.", "committedDate": "2020-10-28T15:14:17Z", "type": "commit"}, {"oid": "5b66611b9a5b671dbfbfc8703d6319fbd29f3783", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5b66611b9a5b671dbfbfc8703d6319fbd29f3783", "message": "Merge branch 'develop' into ios-hydra-services", "committedDate": "2020-10-29T03:21:00Z", "type": "commit"}]}