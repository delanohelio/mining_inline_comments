{"pr_number": 1082, "pr_title": "Consent Service : Fixed issue #1038, Build issue due to timestamp in consent document filepath", "pr_createdAt": "2020-09-29T17:36:25Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1082", "timeline": [{"oid": "5c219517d1f30432ce9f2efd3cfd4e7ef6afcd89", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5c219517d1f30432ce9f2efd3cfd4e7ef6afcd89", "message": "Fixed issue #1038\n\nFixed issue #1038", "committedDate": "2020-09-29T17:26:51Z", "type": "commit"}, {"oid": "5e3a3171ee6ebce0ba3be0151cb623d79da5687c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5e3a3171ee6ebce0ba3be0151cb623d79da5687c", "message": "Merge branch 'develop' into consent-service-issue#1038", "committedDate": "2020-09-29T17:42:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk2NDkwNw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1082#discussion_r496964907", "bodyText": "this has the same flakiness issue around midnight. A better solution is to return the generated filename (with timestamp) and use the returned value in tests.", "author": "zohrehj", "createdAt": "2020-09-29T18:53:18Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserConsentManagementController.java", "diffHunk": "@@ -154,13 +154,9 @@\n               if (!StringUtils.isEmpty(consentStatusBean.getConsent().getPdf())) {\n                 String underDirectory = userId + \"/\" + consentStatusBean.getStudyId();\n                 String fileName =\n-                    userId\n+                    consentStatusBean.getConsent().getVersion()\n                         + \"_\"\n-                        + consentStatusBean.getStudyId()\n-                        + \"_\"\n-                        + consentStatusBean.getConsent().getVersion()\n-                        + \"_\"\n-                        + new SimpleDateFormat(\"MMddyyyyHHmmss\").format(new Date())\n+                        + new SimpleDateFormat(\"MMddyyyy\").format(new Date())", "originalCommit": "5e3a3171ee6ebce0ba3be0151cb623d79da5687c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcxMjYwNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1082#discussion_r497712605", "bodyText": "Fixed Review comment.", "author": "monica-BTC", "createdAt": "2020-09-30T18:22:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk2NDkwNw=="}], "type": "inlineReview"}, {"oid": "f12218598a8597c063e0fa4718f915595b717a51", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f12218598a8597c063e0fa4718f915595b717a51", "message": "Fixed Review Comment\n\nFixed Review Comment", "committedDate": "2020-09-30T18:14:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcwODgxMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1082#discussion_r497708812", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nDistance between variable 'consentDocumentFileName' declaration and its first usage is 10, but allowed 3.  Consider making that variable final if you still need to store its value in advance (before method calls that might have side effects on the original value).", "author": "github-actions", "createdAt": "2020-09-30T18:15:12Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/UserConsentManagementControllerTests.java", "diffHunk": "@@ -106,15 +105,21 @@ public void updateEligibilityConsentStatus() throws Exception {\n     HttpHeaders headers = TestUtils.getCommonHeaders();\n     headers.add(\"Authorization\", VALID_BEARER_TOKEN);\n     TestUtils.addContentTypeAcceptHeaders(headers);\n-    mockMvc\n-        .perform(\n-            post(ApiEndpoint.UPDATE_ELIGIBILITY_CONSENT.getPath())\n-                .content(requestJson)\n-                .headers(headers)\n-                .contextPath(getContextPath()))\n-        .andDo(print())\n-        .andExpect(status().isOk())\n-        .andExpect(content().string(containsString(Constants.UPDATE_CONSENT_SUCCESS_MSG)));\n+    MvcResult result =\n+        mockMvc\n+            .perform(\n+                post(ApiEndpoint.UPDATE_ELIGIBILITY_CONSENT.getPath())\n+                    .content(requestJson)\n+                    .headers(headers)\n+                    .contextPath(getContextPath()))\n+            .andDo(print())\n+            .andExpect(status().isOk())\n+            .andExpect(content().string(containsString(Constants.UPDATE_CONSENT_SUCCESS_MSG)))\n+            .andExpect(jsonPath(\"$.consentDocumentFileName\").isNotEmpty())\n+            .andReturn();\n+\n+    String consentDocumentFileName =", "originalCommit": "f12218598a8597c063e0fa4718f915595b717a51", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcwODgxMw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1082#discussion_r497708813", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nDistance between variable 'consentDocumentFileName' declaration and its first usage is 10, but allowed 3.  Consider making that variable final if you still need to store its value in advance (before method calls that might have side effects on the original value).", "author": "github-actions", "createdAt": "2020-09-30T18:15:12Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/UserConsentManagementControllerTests.java", "diffHunk": "@@ -210,15 +202,21 @@ public void updateEligibilityConsentStatusUpdateExisting() throws Exception {\n     HttpHeaders headers = TestUtils.getCommonHeaders();\n     TestUtils.addContentTypeAcceptHeaders(headers);\n     headers.add(\"Authorization\", VALID_BEARER_TOKEN);\n-    mockMvc\n-        .perform(\n-            post(ApiEndpoint.UPDATE_ELIGIBILITY_CONSENT.getPath())\n-                .content(requestJson)\n-                .headers(headers)\n-                .contextPath(getContextPath()))\n-        .andDo(print())\n-        .andExpect(status().isOk())\n-        .andExpect(content().string(containsString(Constants.UPDATE_CONSENT_SUCCESS_MSG)));\n+    MvcResult result =\n+        mockMvc\n+            .perform(\n+                post(ApiEndpoint.UPDATE_ELIGIBILITY_CONSENT.getPath())\n+                    .content(requestJson)\n+                    .headers(headers)\n+                    .contextPath(getContextPath()))\n+            .andDo(print())\n+            .andExpect(status().isOk())\n+            .andExpect(content().string(containsString(Constants.UPDATE_CONSENT_SUCCESS_MSG)))\n+            .andExpect(jsonPath(\"$.consentDocumentFileName\").isNotEmpty())\n+            .andReturn();\n+\n+    String consentDocumentFileName =", "originalCommit": "f12218598a8597c063e0fa4718f915595b717a51", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcwODgxNA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1082#discussion_r497708814", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nDistance between variable 'consentDocumentFileName' declaration and its first usage is 10, but allowed 3.  Consider making that variable final if you still need to store its value in advance (before method calls that might have side effects on the original value).", "author": "github-actions", "createdAt": "2020-09-30T18:15:12Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/UserConsentManagementControllerTests.java", "diffHunk": "@@ -310,15 +295,21 @@ public void updateEligibilityConsentStatusAddNewVersion() throws Exception {\n     HttpHeaders headers = TestUtils.getCommonHeaders();\n     TestUtils.addContentTypeAcceptHeaders(headers);\n     headers.add(\"Authorization\", VALID_BEARER_TOKEN);\n-    mockMvc\n-        .perform(\n-            post(ApiEndpoint.UPDATE_ELIGIBILITY_CONSENT.getPath())\n-                .content(requestJson)\n-                .headers(headers)\n-                .contextPath(getContextPath()))\n-        .andDo(print())\n-        .andExpect(status().isOk())\n-        .andExpect(content().string(containsString(Constants.UPDATE_CONSENT_SUCCESS_MSG)));\n+    MvcResult result =\n+        mockMvc\n+            .perform(\n+                post(ApiEndpoint.UPDATE_ELIGIBILITY_CONSENT.getPath())\n+                    .content(requestJson)\n+                    .headers(headers)\n+                    .contextPath(getContextPath()))\n+            .andDo(print())\n+            .andExpect(status().isOk())\n+            .andExpect(content().string(containsString(Constants.UPDATE_CONSENT_SUCCESS_MSG)))\n+            .andExpect(jsonPath(\"$.consentDocumentFileName\").isNotEmpty())\n+            .andReturn();\n+\n+    String consentDocumentFileName =", "originalCommit": "f12218598a8597c063e0fa4718f915595b717a51", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9800a2f9eeca710adace9463db4127ca6aa42c87", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/9800a2f9eeca710adace9463db4127ca6aa42c87", "message": "fixed comments\n\nfixed comments", "committedDate": "2020-09-30T18:19:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcxMjExNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1082#discussion_r497712116", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nDistance between variable 'result' declaration and its first usage is 10, but allowed 3.  Consider making that variable final if you still need to store its value in advance (before method calls that might have side effects on the original value).", "author": "github-actions", "createdAt": "2020-09-30T18:21:18Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/UserConsentManagementControllerTests.java", "diffHunk": "@@ -106,15 +105,18 @@ public void updateEligibilityConsentStatus() throws Exception {\n     HttpHeaders headers = TestUtils.getCommonHeaders();\n     headers.add(\"Authorization\", VALID_BEARER_TOKEN);\n     TestUtils.addContentTypeAcceptHeaders(headers);\n-    mockMvc\n-        .perform(\n-            post(ApiEndpoint.UPDATE_ELIGIBILITY_CONSENT.getPath())\n-                .content(requestJson)\n-                .headers(headers)\n-                .contextPath(getContextPath()))\n-        .andDo(print())\n-        .andExpect(status().isOk())\n-        .andExpect(content().string(containsString(Constants.UPDATE_CONSENT_SUCCESS_MSG)));\n+    MvcResult result =", "originalCommit": "9800a2f9eeca710adace9463db4127ca6aa42c87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcxMjExOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1082#discussion_r497712118", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nDistance between variable 'result' declaration and its first usage is 10, but allowed 3.  Consider making that variable final if you still need to store its value in advance (before method calls that might have side effects on the original value).", "author": "github-actions", "createdAt": "2020-09-30T18:21:18Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/UserConsentManagementControllerTests.java", "diffHunk": "@@ -210,15 +200,18 @@ public void updateEligibilityConsentStatusUpdateExisting() throws Exception {\n     HttpHeaders headers = TestUtils.getCommonHeaders();\n     TestUtils.addContentTypeAcceptHeaders(headers);\n     headers.add(\"Authorization\", VALID_BEARER_TOKEN);\n-    mockMvc\n-        .perform(\n-            post(ApiEndpoint.UPDATE_ELIGIBILITY_CONSENT.getPath())\n-                .content(requestJson)\n-                .headers(headers)\n-                .contextPath(getContextPath()))\n-        .andDo(print())\n-        .andExpect(status().isOk())\n-        .andExpect(content().string(containsString(Constants.UPDATE_CONSENT_SUCCESS_MSG)));\n+    MvcResult result =", "originalCommit": "9800a2f9eeca710adace9463db4127ca6aa42c87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcxMjExOQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1082#discussion_r497712119", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nDistance between variable 'result' declaration and its first usage is 10, but allowed 3.  Consider making that variable final if you still need to store its value in advance (before method calls that might have side effects on the original value).", "author": "github-actions", "createdAt": "2020-09-30T18:21:18Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/UserConsentManagementControllerTests.java", "diffHunk": "@@ -310,15 +293,18 @@ public void updateEligibilityConsentStatusAddNewVersion() throws Exception {\n     HttpHeaders headers = TestUtils.getCommonHeaders();\n     TestUtils.addContentTypeAcceptHeaders(headers);\n     headers.add(\"Authorization\", VALID_BEARER_TOKEN);\n-    mockMvc\n-        .perform(\n-            post(ApiEndpoint.UPDATE_ELIGIBILITY_CONSENT.getPath())\n-                .content(requestJson)\n-                .headers(headers)\n-                .contextPath(getContextPath()))\n-        .andDo(print())\n-        .andExpect(status().isOk())\n-        .andExpect(content().string(containsString(Constants.UPDATE_CONSENT_SUCCESS_MSG)));\n+    MvcResult result =", "originalCommit": "9800a2f9eeca710adace9463db4127ca6aa42c87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c655c1559c9a7805a6456d09eb02a4c0edad1096", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c655c1559c9a7805a6456d09eb02a4c0edad1096", "message": "Merge branch 'develop' into consent-service-issue#1038", "committedDate": "2020-09-30T18:22:40Z", "type": "commit"}]}