{"pr_number": 1121, "pr_title": "iOS - Change password service implementation", "pr_createdAt": "2020-10-05T18:44:16Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1121", "timeline": [{"oid": "14209f771f6c66e0fb0790ee763c999abffa9e14", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/14209f771f6c66e0fb0790ee763c999abffa9e14", "message": "Change password from profile.", "committedDate": "2020-09-28T06:46:37Z", "type": "commit"}, {"oid": "f749e5849ea22d9982f043cdcf0d07c2e272436c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f749e5849ea22d9982f043cdcf0d07c2e272436c", "message": "Store access token and user details after change password", "committedDate": "2020-10-05T18:38:27Z", "type": "commit"}, {"oid": "2e21d58fcbcd3c98aab3e012e31bb1079f13d40b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/2e21d58fcbcd3c98aab3e012e31bb1079f13d40b", "message": "Add refresh token hydra API", "committedDate": "2020-10-07T10:38:22Z", "type": "commit"}, {"oid": "becd4360bb62879e671691ef658154097522e7f2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/becd4360bb62879e671691ef658154097522e7f2", "message": "- Integrate refresh token with other services and error handling\n- Remove Org Id", "committedDate": "2020-10-07T11:30:03Z", "type": "commit"}, {"oid": "21d2c4603d876adcd44fab606227802372460ade", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/21d2c4603d876adcd44fab606227802372460ade", "message": "Remove Org ID", "committedDate": "2020-10-07T15:59:55Z", "type": "commit"}, {"oid": "9dcbf4cb80d0a2b4a9e109b883d185fe3e752810", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/9dcbf4cb80d0a2b4a9e109b883d185fe3e752810", "message": "Error cleanup", "committedDate": "2020-10-07T16:13:01Z", "type": "commit"}, {"oid": "3b51e1a39cd2b47d6884b9757b366103709680bc", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3b51e1a39cd2b47d6884b9757b366103709680bc", "message": "Update hardcoded error codes with enum values", "committedDate": "2020-10-12T08:10:33Z", "type": "commit"}, {"oid": "f7f67b31adfd1f056d8325f1ec5d87d2643d5c0e", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f7f67b31adfd1f056d8325f1ec5d87d2643d5c0e", "message": "Merge branch 'ios-hydra-services-tests' into ios-password-change\n\n* ios-hydra-services-tests:\n  Update App transport settings\n  Add test configuration.\n  Add registration UI test with mocking the API.\n  Add Embassy and EnvoyAmbassador cocoapods\n  Add registration UI test.", "committedDate": "2020-10-12T10:22:53Z", "type": "commit"}, {"oid": "0aa2783e13476b8af398232b0ef5db752e7aec19", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0aa2783e13476b8af398232b0ef5db752e7aec19", "message": "Add logged in user change password UI test case", "committedDate": "2020-10-12T12:59:07Z", "type": "commit"}, {"oid": "61d2f772ab7b3260c579c2fedaae9db6b4018fb9", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/61d2f772ab7b3260c579c2fedaae9db6b4018fb9", "message": "Update authorization token to get response service.", "committedDate": "2020-10-14T09:19:29Z", "type": "commit"}, {"oid": "ba9fbc5aca611d0c6b247c8a4ef7c1810a214ed3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ba9fbc5aca611d0c6b247c8a4ef7c1810a214ed3", "message": "Fix callback navigation.", "committedDate": "2020-10-14T09:24:46Z", "type": "commit"}, {"oid": "e718c6eee96c6dffd54fa2065a2fb0826bde665a", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e718c6eee96c6dffd54fa2065a2fb0826bde665a", "message": "Update authorization token for response service. (#1367)", "committedDate": "2020-10-15T05:51:42Z", "type": "commit"}, {"oid": "55db1ee4cc8e2566adb62f94bd4e8ff680186aaa", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/55db1ee4cc8e2566adb62f94bd4e8ff680186aaa", "message": "Fix Login callback navigation (#1368)", "committedDate": "2020-10-15T05:52:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU2MDcxMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1121#discussion_r505560712", "bodyText": "This is dangerous and could make your app vulnerable to future attacks. You should not make any changes to the flow of the code in order to test it.", "author": "zohrehj", "createdAt": "2020-10-15T13:53:19Z", "path": "iOS/HPHC/HPHC/Controllers/SplashViewController.swift", "diffHunk": "@@ -60,7 +60,7 @@ class SplashViewController: UIViewController {\n       self.initilizeStudyForStandaloneApp()\n     } else {\n \n-      if User.currentUser.authToken != nil {\n+      if User.currentUser.authToken != nil || isTestingLoggedUser {", "originalCommit": "0aa2783e13476b8af398232b0ef5db752e7aec19", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE5MjAyNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1121#discussion_r508192026", "bodyText": "This is the App launch argument passed from the test bundle and common practice to mock some exceptional cases.\nvar isTestingLoggedUser: Bool { return ProcessInfo.processInfo.arguments.contains(\"LOGGED_USER\") }\nIn case of change the password, the user should be logged In. There're two ways to listen to this launch argument, either in the test bundle or in the App. From the test bundle, we can run the test case to log in to the test user before executing the actual test case but I can't mock the login part as it's on web.", "author": "tushar-boston", "createdAt": "2020-10-20T03:47:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU2MDcxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ2NzYzOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1121#discussion_r508467638", "bodyText": "Can you stub the request to the web login and return a fake login token?", "author": "zohrehj", "createdAt": "2020-10-20T12:42:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU2MDcxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODcxNDEyMQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1121#discussion_r508714121", "bodyText": "No, mocking the web login requires it to be loaded. I've already tried many ways to make it easy and found this to be working fine.", "author": "tushar-boston", "createdAt": "2020-10-20T17:34:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU2MDcxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODcyNDcxNw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1121#discussion_r508724717", "bodyText": "not mocking, stubbing the get request that loads the URL and instead running the function that returns the fake login token.\nThis discussion is getting long, please file a bug to address this in a separate PR and I will approve to unblock you for now.", "author": "zohrehj", "createdAt": "2020-10-20T17:52:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU2MDcxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODcyOTU1MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1121#discussion_r508729550", "bodyText": "There are multiple calls happening in the login flow. I've opened issue #1563 to update the test case with another possible approach later.", "author": "tushar-boston", "createdAt": "2020-10-20T17:59:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU2MDcxMg=="}], "type": "inlineReview"}, {"oid": "4e3bbfc22f23975bd8254745ea648c46be127d3b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4e3bbfc22f23975bd8254745ea648c46be127d3b", "message": "iOS - Hydra Refresh token (#1174)", "committedDate": "2020-10-29T15:16:33Z", "type": "commit"}, {"oid": "42a871d9171fc079c3eca5dfb2301a9599345163", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/42a871d9171fc079c3eca5dfb2301a9599345163", "message": "Merge branch 'ios-hydra-services-tests' into ios-password-change", "committedDate": "2020-10-29T15:17:46Z", "type": "commit"}]}