{"pr_number": 317, "pr_title": "Add IAM on consent documents bucket and firebase project", "pr_createdAt": "2020-05-02T04:41:26Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/317", "timeline": [{"oid": "ee526fdb652f280daa2f2420610618a26862a703", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ee526fdb652f280daa2f2420610618a26862a703", "message": "add iam", "committedDate": "2020-05-02T04:38:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODg5MjYxOQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/317#discussion_r418892619", "bodyText": "user-registration", "author": "xingao267", "createdAt": "2020-05-02T04:45:41Z", "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-data/data/terragrunt.hcl", "diffHunk": "@@ -31,6 +31,24 @@ dependency \"network\" {\n   }\n }\n \n+dependency \"apps\" {\n+  config_path = \"../../project.heroes-hat-dev-apps/apps\"\n+\n+  mock_outputs = {\n+    service_account = \"mock-gke-service-account\"\n+    apps_service_accounts = {\n+      response-server = {\n+        email = \"mock-app-gke@mock-project.iam.gserviceaccount.com\"\n+      }\n+    }\n+  }\n+}\n+\n+\n inputs = {\n   network = dependency.network.outputs.private_network.id\n+  consent_documents_iam_members = [{\n+    role   = \"roles/storage.objectCreator\"\n+    member = \"serviceAccount:${dependency.apps.outputs.apps_service_accounts[\"response-server\"].email}\"", "originalCommit": "ee526fdb652f280daa2f2420610618a26862a703", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODg5NTQ1Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/317#discussion_r418895456", "bodyText": "The right sa or server here should be user-registration according to https://github.com/GoogleCloudPlatform/fda-mystudies/pull/313/files?", "author": "xingao267", "createdAt": "2020-05-02T04:53:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODg5MjYxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODg5NjgwMA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/317#discussion_r418896800", "bodyText": "Sorry you're right. Too late at night :D The title of the PR confuesd me", "author": "umairidris", "createdAt": "2020-05-02T04:56:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODg5MjYxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODg5NDM5Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/317#discussion_r418894392", "bodyText": "user-registration", "author": "xingao267", "createdAt": "2020-05-02T04:50:18Z", "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-data/data/terragrunt.hcl", "diffHunk": "@@ -31,6 +31,24 @@ dependency \"network\" {\n   }\n }\n \n+dependency \"apps\" {\n+  config_path = \"../../project.heroes-hat-dev-apps/apps\"\n+\n+  mock_outputs = {\n+    service_account = \"mock-gke-service-account\"\n+    apps_service_accounts = {\n+      response-server = {\n+        email = \"mock-app-gke@mock-project.iam.gserviceaccount.com\"", "originalCommit": "ee526fdb652f280daa2f2420610618a26862a703", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4ODAwNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/317#discussion_r418988005", "bodyText": "Done", "author": "umairidris", "createdAt": "2020-05-02T17:55:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODg5NDM5Mg=="}], "type": "inlineReview"}, {"oid": "afba32e29750f088f7240d2a5ea3268cfff02ad3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/afba32e29750f088f7240d2a5ea3268cfff02ad3", "message": "user", "committedDate": "2020-05-02T04:58:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkxNDYyMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/317#discussion_r418914622", "bodyText": "I think we need objectAdmin here because it also needs to read data from this bucket (e.g. when user download their own consent form).", "author": "kuoyuchi", "createdAt": "2020-05-02T05:42:53Z", "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-data/data/terragrunt.hcl", "diffHunk": "@@ -31,6 +31,24 @@ dependency \"network\" {\n   }\n }\n \n+dependency \"apps\" {\n+  config_path = \"../../project.heroes-hat-dev-apps/apps\"\n+\n+  mock_outputs = {\n+    service_account = \"mock-gke-service-account\"\n+    apps_service_accounts = {\n+      user-registration = {\n+        email = \"mock-app-gke@mock-project.iam.gserviceaccount.com\"\n+      }\n+    }\n+  }\n+}\n+\n+\n inputs = {\n   network = dependency.network.outputs.private_network.id\n+  consent_documents_iam_members = [{\n+    role   = \"roles/storage.objectCreator\"", "originalCommit": "afba32e29750f088f7240d2a5ea3268cfff02ad3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4Nzk4Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/317#discussion_r418987982", "bodyText": "Done", "author": "umairidris", "createdAt": "2020-05-02T17:55:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkxNDYyMg=="}], "type": "inlineReview"}, {"oid": "f64f5c13b928f0d534b9c19b52c5c63df6b46534", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f64f5c13b928f0d534b9c19b52c5c63df6b46534", "message": "Merge branch 'early-access' into simplify", "committedDate": "2020-05-02T05:43:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkxNzk1MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/317#discussion_r418917950", "bodyText": "I think for whatever reason, the current project name is \"heroes-hat-dev-resp-firebase\".", "author": "kuoyuchi", "createdAt": "2020-05-02T05:58:25Z", "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-resp-firebase/iam/terraform.tfvars", "diffHunk": "@@ -0,0 +1,15 @@\n+# Copyright 2020 Google Inc.\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+project_id = \"heroes-hat-dev-firebase\"", "originalCommit": "f64f5c13b928f0d534b9c19b52c5c63df6b46534", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4ODEzNA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/317#discussion_r418988134", "bodyText": "Fixed", "author": "umairidris", "createdAt": "2020-05-02T17:56:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkxNzk1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkxODY5OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/317#discussion_r418918698", "bodyText": "Do we need to add the \"serviceAccount:\" prefix here as well?", "author": "kuoyuchi", "createdAt": "2020-05-02T06:08:00Z", "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-resp-firebase/iam/main.tf", "diffHunk": "@@ -0,0 +1,29 @@\n+# Copyright 2020 Google Inc.\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+terraform {\n+  required_version = \"~> 0.12.0\"\n+  required_providers {\n+    google      = \"~> 3.0\"\n+    google-beta = \"~> 3.0\"\n+  }\n+  backend \"gcs\" {}\n+}\n+\n+resource \"google_project_iam_member\" \"datastore_user_service_accounts\" {\n+  for_each = toset(var.datastore_user_service_accounts)\n+  project  = var.project_id\n+  role     = \"roles/datastore.user\"\n+  member   = each.key", "originalCommit": "f64f5c13b928f0d534b9c19b52c5c63df6b46534", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4ODAyMw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/317#discussion_r418988023", "bodyText": "I added it in the terragrunt.hcl file", "author": "umairidris", "createdAt": "2020-05-02T17:55:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkxODY5OA=="}], "type": "inlineReview"}, {"oid": "cfef0156d239c6a8bff5371fba8190a8af67caa3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/cfef0156d239c6a8bff5371fba8190a8af67caa3", "message": "obj adm", "committedDate": "2020-05-02T17:54:41Z", "type": "commit"}, {"oid": "c98a4ce8603453fdc55992e064da58f7445f4f0f", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c98a4ce8603453fdc55992e064da58f7445f4f0f", "message": "Merge branch 'simplify' of https://github.com/GoogleCloudPlatform/fda-mystudies into simplify", "committedDate": "2020-05-02T17:54:48Z", "type": "commit"}, {"oid": "468cdfd8149d5da90dd70d69338e63335cf69f84", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/468cdfd8149d5da90dd70d69338e63335cf69f84", "message": "Merge branch 'early-access' into simplify", "committedDate": "2020-05-02T17:55:30Z", "type": "commit"}, {"oid": "1499e73cc20ff30b141db2697485beff352693f8", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1499e73cc20ff30b141db2697485beff352693f8", "message": "project id", "committedDate": "2020-05-02T17:56:25Z", "type": "commit"}, {"oid": "eabd103d2f93434dd1d914f80383502d4c217837", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/eabd103d2f93434dd1d914f80383502d4c217837", "message": "Merge branch 'simplify' of https://github.com/GoogleCloudPlatform/fda-mystudies into simplify", "committedDate": "2020-05-02T17:56:30Z", "type": "commit"}, {"oid": "0cb7a631608788466232f9ef114daa39a42168f3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0cb7a631608788466232f9ef114daa39a42168f3", "message": "Merge branch 'early-access' into simplify", "committedDate": "2020-05-02T19:56:27Z", "type": "commit"}, {"oid": "ebbb09f1ad65c4f67f77fe7713c11fe7888df26f", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ebbb09f1ad65c4f67f77fe7713c11fe7888df26f", "message": "Merge branch 'early-access' into simplify", "committedDate": "2020-05-02T20:18:29Z", "type": "commit"}]}