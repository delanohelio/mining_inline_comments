{"pr_number": 798, "pr_title": "iOS - Add force upgrade configuration", "pr_createdAt": "2020-08-24T16:15:18Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/798", "timeline": [{"oid": "d4102bcf470c04b6eca670e18bc69225c0881fd0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d4102bcf470c04b6eca670e18bc69225c0881fd0", "message": "Add configuration for force upgrade.", "committedDate": "2020-08-21T11:59:24Z", "type": "commit"}, {"oid": "9887db0988656e428360e02d1fa47a2fedfdf054", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/9887db0988656e428360e02d1fa47a2fedfdf054", "message": "formatting.", "committedDate": "2020-08-21T12:20:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ3MzY4NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/798#discussion_r476473684", "bodyText": "the appLink created here would be different from the one you were using previously:\nhttps://itunes.apple.com/us/app/fda-my-studies/id1242835330?ls=1&mt=8\nvs what you are creating for appleID: 1242835330\nhttps://apps.apple.com/app/apple-store/id1242835330 ?", "author": "zohrehj", "createdAt": "2020-08-25T14:03:28Z", "path": "iOS/HPHC/HPHC/Views/UIViews+Additions/ForceUpdate/AppUpdateBlocker.swift", "diffHunk": "@@ -35,28 +49,34 @@ class AppUpdateBlocker: UIView {\n   /// - Parameters:\n   ///   - frame: Rect for the view\n   /// - Returns: New object of `AppUpdateBlocker` Type\n-  class func instanceFromNib(frame: CGRect) -> AppUpdateBlocker {\n-\n+  class func instanceFromNib(\n+    frame: CGRect,\n+    detail: JSONDictionary\n+  ) -> AppUpdateBlocker {\n     let view =\n-      UINib(nibName: \"AppUpdateBlocker\", bundle: nil).instantiate(\n-        withOwner: nil,\n-        options: nil\n-      )[0] as! AppUpdateBlocker\n+      UINib(nibName: \"AppUpdateBlocker\", bundle: nil).instantiate(withOwner: nil, options: nil)[0] as! AppUpdateBlocker\n     view.frame = frame\n     view.layoutIfNeeded()\n     return view\n+  }\n \n+  func configureView(with latestVersion: String) {\n+    self.buttonUpgrade.layer.borderColor = #colorLiteral(red: 0, green: 0.4862745098, blue: 0.7294117647, alpha: 1)\n+    self.labelMessage.text = LocalizableString.blockerScreenLabelText.localizedString\n+    self.appIconView.image = self.appIcon\n   }\n \n-  // MARK: - Action\n+  // MARK: - Actions\n \n   @IBAction func buttonUpgradeAction() {\n-    guard\n-      let url = URL(\n-        string: \"https://itunes.apple.com/us/app/fda-my-studies/id1242835330?ls=1&mt=8\"\n-      )\n-    else { return }\n-    if UIApplication.shared.canOpenURL(url) {\n+    guard let appleID = Branding.appleID, !appleID.isEmpty else {\n+      // Ask user to update from AppStore.\n+      self.makeToast(LocalizableString.appStoreUpdateText.localizedString)\n+      return\n+    }\n+    let appStoreLink = \"https://apps.apple.com/app/apple-store\"\n+    let appLink = appStoreLink + \"/id\" + appleID", "originalCommit": "9887db0988656e428360e02d1fa47a2fedfdf054", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU5NTAxNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/798#discussion_r476595016", "bodyText": "This is a new URL and not any country-specific. We have tested this and redirection works fine with any country App Apple ID.", "author": "tushar-boston", "createdAt": "2020-08-25T16:53:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ3MzY4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ3NDQ4Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/798#discussion_r476474482", "bodyText": "typo: AppStore Connect\nplease provide an example of what this ID looks like", "author": "zohrehj", "createdAt": "2020-08-25T14:04:32Z", "path": "iOS/HPHC/HPHC/Branding/Branding.swift", "diffHunk": "@@ -107,4 +108,9 @@ enum Branding {\n     return brandConfig[JSONKey.standaloneStudyID] as? String ?? \"\"\n   }\n \n+  /// Unique ID of the App generated by Apple on AppStore Conect.", "originalCommit": "9887db0988656e428360e02d1fa47a2fedfdf054", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU5OTk4NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/798#discussion_r476599984", "bodyText": "Updated.", "author": "tushar-boston", "createdAt": "2020-08-25T17:01:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ3NDQ4Mg=="}], "type": "inlineReview"}, {"oid": "ffa957f04ea251bcc2279bf79761755b48382ab0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ffa957f04ea251bcc2279bf79761755b48382ab0", "message": "Fix typo.", "committedDate": "2020-08-25T17:00:21Z", "type": "commit"}, {"oid": "44b09f48315453a08ad014053d0cd3c8ade7e3cf", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/44b09f48315453a08ad014053d0cd3c8ade7e3cf", "message": "Merge branch 'develop' into ios-force-ug-configuration", "committedDate": "2020-08-25T17:27:49Z", "type": "commit"}]}