{"pr_number": 269, "pr_title": "Populate an answer for the dummy SUM question.", "pr_createdAt": "2020-04-29T17:05:38Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/269", "timeline": [{"oid": "d33ff2021ce2a7de9b6afcbdde67f92ed1139794", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d33ff2021ce2a7de9b6afcbdde67f92ed1139794", "message": "populate an answer for the dummy SUM question.", "committedDate": "2020-04-26T01:05:54Z", "type": "commit"}, {"oid": "0ac92b4a358474e23917ff909336c62469111335", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0ac92b4a358474e23917ff909336c62469111335", "message": "Remove debug logs and add comments.", "committedDate": "2020-04-29T17:07:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ5MDg1NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/269#discussion_r417490854", "bodyText": "can you explain why we need this case?", "author": "zohrehj", "createdAt": "2020-04-29T17:34:09Z", "path": "response-server-ws/src/main/java/com/google/cloud/healthcare/fdamystudies/service/ActivityResponseProcessorServiceImpl.java", "diffHunk": "@@ -160,12 +160,46 @@ private void processActivityResponses(\n         plugInMetadataToResponses(activityMetadataBeanFromWCP, responseBean, false);\n       }\n     }\n+    if (scoreSumResponseBean == null) {", "originalCommit": "0ac92b4a358474e23917ff909336c62469111335", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUwMTkyMQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/269#discussion_r417501921", "bodyText": "i.e. what's the scenario where dummy sum question has been added to the questionnaire but the response is not found in the loop above.", "author": "zohrehj", "createdAt": "2020-04-29T17:51:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ5MDg1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzU3NzE3OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/269#discussion_r417577179", "bodyText": "Added comment.", "author": "kuoyuchi", "createdAt": "2020-04-29T20:02:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ5MDg1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ5NzI5Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/269#discussion_r417497296", "bodyText": "this would overwrite the responseBean if there are multiple matches found.\nSo it clearly expects only a single match; so maybe the method should fail if there are in fact more than a single match?", "author": "zohrehj", "createdAt": "2020-04-29T17:44:46Z", "path": "response-server-ws/src/main/java/com/google/cloud/healthcare/fdamystudies/service/ActivityResponseProcessorServiceImpl.java", "diffHunk": "@@ -160,12 +160,46 @@ private void processActivityResponses(\n         plugInMetadataToResponses(activityMetadataBeanFromWCP, responseBean, false);\n       }\n     }\n+    if (scoreSumResponseBean == null) {\n+      // Try to create a response for the dummy sum question by copying from metadata.\n+      scoreSumResponseBean =\n+          maybeCreateDummySumResponseFromMetadata(activityMetadataBeanFromWCP);\n+      if (scoreSumResponseBean != null) {\n+        // If copying is successful, add it to the list of responses.\n+        questionnaireResponses.add(scoreSumResponseBean);\n+      }\n+    }\n     if (scoreSumResponseBean != null) {\n       // Iterate through responses for a second pass to calculate the score sum if the dummy sum question presents.\n       calculateScoreSum(questionnaireResponses,scoreSumResponseBean);\n     }\n   }\n \n+  // Returns an empty response with metadata copied from the dummy sum question, or null if the dummy sum question is not found in metadata.\n+  private static QuestionnaireActivityStepsBean maybeCreateDummySumResponseFromMetadata(\n+      List<QuestionnaireActivityStepsBean> activityMetadataBeanFromWCP) {\n+    List<QuestionnaireActivityStepsBean> metadataMatchList = \n+          activityMetadataBeanFromWCP\n+              .stream()\n+              .filter(QuestionnaireActivityStepsBeanPredicate.questionKeyMatch(\n+                  AppConstants.DUMMY_SUM_QUESTION_KEY))\n+              .collect(Collectors.<QuestionnaireActivityStepsBean>toList());\n+    // Return null if dummy sum question is not found from metadata.\n+    if (metadataMatchList == null || metadataMatchList.isEmpty()) return null;\n+    // Otherwise, create a new entry and copy contents from metadata.\n+    QuestionnaireActivityStepsBean responseBean = new QuestionnaireActivityStepsBean();\n+    for (QuestionnaireActivityStepsBean metadataMatchBean : metadataMatchList) {", "originalCommit": "0ac92b4a358474e23917ff909336c62469111335", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzU3NzE5OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/269#discussion_r417577199", "bodyText": "Done.", "author": "kuoyuchi", "createdAt": "2020-04-29T20:02:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ5NzI5Ng=="}], "type": "inlineReview"}, {"oid": "1dd4fc821b83d666be8f71f28ee910207797c5ef", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1dd4fc821b83d666be8f71f28ee910207797c5ef", "message": "Check for matched metadata to be exactly 1.", "committedDate": "2020-04-29T20:02:03Z", "type": "commit"}, {"oid": "81c22d61b14dd68524472610e2598494444f4957", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/81c22d61b14dd68524472610e2598494444f4957", "message": "Merge branch 'early-access' into sum-question-hide", "committedDate": "2020-04-29T20:04:05Z", "type": "commit"}, {"oid": "44175d62f317af798dd3238563de39795e227c1b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/44175d62f317af798dd3238563de39795e227c1b", "message": "Merge branch 'early-access' into sum-question-hide", "committedDate": "2020-04-29T21:20:54Z", "type": "commit"}]}