{"pr_number": 1865, "pr_title": "iOS - Handle expired token error.", "pr_createdAt": "2020-11-05T12:31:27Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1865", "timeline": [{"oid": "9318c034e7bff8219168da86321a856888154311", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/9318c034e7bff8219168da86321a856888154311", "message": "Handle expired token error.", "committedDate": "2020-11-05T11:56:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODMzODUwNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1865#discussion_r518338506", "bodyText": "this would show the expired error for all internal server errors, I don't think that is what we want.\nAre there no other indications of when a user session has expired? maybe you can check the session and only show that when you have confirmed that it is expired?", "author": "zohrehj", "createdAt": "2020-11-05T20:16:49Z", "path": "iOS/HPHC/HPHC/Networking/APIs/HydraAPI.swift", "diffHunk": "@@ -101,7 +101,11 @@ struct HydraAPI {\n           completion(false, .unwrapError)\n         }\n       } else {\n-        completion(false, error)\n+        if error?.code == HTTPError.internalServerError.rawValue {\n+          completion(false, ApiError.sessionExpiredError)\n+        } else {\n+          completion(false, error)\n+        }", "originalCommit": "9318c034e7bff8219168da86321a856888154311", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgyNzkyNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1865#discussion_r518827925", "bodyText": "I was told by @dhanyak-btc to consider internal server error as the session expired for refresh token API. So if the refresh token API fails with an internal server error, user will see the session expired message and will be logged out from the current session.", "author": "tushar-boston", "createdAt": "2020-11-06T15:32:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODMzODUwNg=="}], "type": "inlineReview"}]}