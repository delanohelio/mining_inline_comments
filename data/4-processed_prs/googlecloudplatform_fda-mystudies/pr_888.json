{"pr_number": 888, "pr_title": "OAuth Scim Service - Externalized configuration And Add @EntityScan to exclude common entities", "pr_createdAt": "2020-09-06T11:11:23Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/888", "timeline": [{"oid": "d9de97e54c24d8820d472c3447d83ec99752ce73", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d9de97e54c24d8820d472c3447d83ec99752ce73", "message": "OAuth Scim Service - Externalized Configuration\n\nOAuth Scim Service - Externalized Configuration", "committedDate": "2020-09-06T11:01:46Z", "type": "commit"}, {"oid": "44cd76a847e372d5d544c69fe219a85781d976f7", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/44cd76a847e372d5d544c69fe219a85781d976f7", "message": "Added @EntityScan to avoid creating tables for Entities in common-service\n\nAdded @EntityScan to avoid creating tables for Entities in common-service\n\nRemoved participant.datastore.entities.enabled=false", "committedDate": "2020-09-06T11:09:40Z", "type": "commit"}, {"oid": "286636f830de8bee8bc623cb0db08c8d06633cc9", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/286636f830de8bee8bc623cb0db08c8d06633cc9", "message": "Added ${CLIENT_ID} and ${SECRET_KEY}\n\nAdded ${CLIENT_ID} and ${SECRET_KEY}", "committedDate": "2020-09-06T14:14:36Z", "type": "commit"}, {"oid": "1c086c2851dfe0b5ed5c968f246c720d067c8ea6", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1c086c2851dfe0b5ed5c968f246c720d067c8ea6", "message": "Changed datasource url and actuator properties\n\nChanged datasource url and actuator properties", "committedDate": "2020-09-08T10:52:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk3NTQ0NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/888#discussion_r484975445", "bodyText": "any reason why these values have been changed?", "author": "zohrehj", "createdAt": "2020-09-08T14:42:21Z", "path": "common-modules/common-tests/src/main/resources/application-mockit-common.properties", "diffHunk": "@@ -1,13 +1,15 @@\n+spring.profiles.active=mockit", "originalCommit": "1c086c2851dfe0b5ed5c968f246c720d067c8ea6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI3OTc2OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/888#discussion_r486279769", "bodyText": "We can set the active profile using annotation and property name. I used @ActiveProfiles(\"mockit\") in BaseMockIT class, while externalizing the configuration I noticed I didn't set spring.profiles.active=mockit so added it. I think this will help developers to avoid any confusion on how spring boot is setting active profile to mockit.", "author": "dhanyak-btc", "createdAt": "2020-09-10T11:59:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk3NTQ0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4MzEwNA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/888#discussion_r484983104", "bodyText": "why change this?", "author": "zohrehj", "createdAt": "2020-09-08T14:52:27Z", "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/mapper/UserMapper.java", "diffHunk": "@@ -12,7 +12,7 @@\n import com.google.cloud.healthcare.fdamystudies.beans.UserResponse;\n import com.google.cloud.healthcare.fdamystudies.common.IdGenerator;\n import com.google.cloud.healthcare.fdamystudies.common.UserAccountStatus;\n-import com.google.cloud.healthcare.fdamystudies.oauthscim.model.UserEntity;\n+import com.google.cloud.healthcare.fdamystudies.oauthscim.model.oauthscim.UserEntity;", "originalCommit": "1c086c2851dfe0b5ed5c968f246c720d067c8ea6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQyMjUzMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/888#discussion_r486422532", "bodyText": "My apologies, while debugging the test I noticed entities from common-service were created in h2 database.  To fix the issue, I needed to add @EntityScan with a different package name to the Application class.\nIn common-service, the package name was com.google.cloud.healthcare.fdamystudies.model so I added a sub-package oauthscim. I really didn't see the oauthscim before the model in package name.\nI've reverted the changes.", "author": "dhanyak-btc", "createdAt": "2020-09-10T15:11:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4MzEwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4Mzk1Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/888#discussion_r484983953", "bodyText": "what's the reason for this change?\nhaving oauthscim.mode.oauthscim as the package does not read very well.", "author": "zohrehj", "createdAt": "2020-09-08T14:53:37Z", "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/model/oauthscim/UserEntity.java", "diffHunk": "@@ -6,7 +6,7 @@\n  * https://opensource.org/licenses/MIT.\n  */\n \n-package com.google.cloud.healthcare.fdamystudies.oauthscim.model;\n+package com.google.cloud.healthcare.fdamystudies.oauthscim.model.oauthscim;", "originalCommit": "1c086c2851dfe0b5ed5c968f246c720d067c8ea6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQyMzQyMw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/888#discussion_r486423423", "bodyText": "My bad, I've reverted the changes.", "author": "dhanyak-btc", "createdAt": "2020-09-10T15:12:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4Mzk1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4NTc4NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/888#discussion_r484985784", "bodyText": "unless we expect the application to be able to change this URL, this does not need to be part of application properties.\nKeeping only the PARTICIPANT_MANAGER_URL as a variable, we can generate the rest of the paths in the application.", "author": "zohrehj", "createdAt": "2020-09-08T14:56:04Z", "path": "oauth-scim-module/oauth-scim-service/src/main/resources/application.properties", "diffHunk": "@@ -26,12 +82,43 @@ oauth.scim.service.max.invalid.login.attempts=5\n oauth.scim.service.account.lockout.period.minutes=15\n oauth.scim.service.reset.password.expiry.hours=48\n # Email configs\n-mail.contact-email=apps@boston-technology.com\n-mail.from-email=apps@boston-technology.com\n+mail.contact-email=${MAIL_CONTACT_EMAIL}\n+mail.from-email=${MAIL_FROM_EMAIL}\n \n mail.subject.reset-password=Password Help for your account:  @orgId@\\u2019s  Study Builder portal\n mail.body.reset-password=<html><body><div style='margin:20px;padding:10px;font-family: sans-serif;font-size: 14px;'><span>Hi,</span><br/><br/><span>Thank you for reaching out for password help for your account on @orgId@&apos;s Study Builder portal.</span><br/><br/><span>Here is a temporary password which you can use to sign in to the @orgId@ MyStudies App.<br/> You will be required to set up a new password after signing in.</span><br/><br/><span><strong>Temporary Password: </strong><b>@tempPassword@</b> </span><br/><br/><span>Please note that this temporary password can be used only once and is valid for a period of 48 hours only.</span><br/><br/><span>For any questions or assistance, please write to <a>@contactEmail@</a> </span><br/><br/><span style='font-size:15px;'>Thanks,</span><br/><span>The @orgId@ MyStudies Support Team</span><br/><span>----------------------------------------------------</span><br/><span style='font-size:10px;'>PS - This is an auto-generated email. Please do not reply. In case you did not request password help, please visit the app and change your password as a precautionary measure.</span></div></body></html>\n \n oauth.scim.service.email.account.locked.subject=Your account has been locked.\n oauth.scim.service.email.account.locked.content=<html><body><div style='margin:20px;padding:10px;font-family: sans-serif;font-size: 14px;'><span>Hi,</span><br/><br/><span>This is to inform you that, as a security measure, your user account for @appId@ app<br/>has been temporarily locked for a period of ${oauth.scim.service.account.lockout.period.minutes} minutes, due to multiple consecutive failed sign-in<br/>attempts with incorrect password.<br/><br/><span>Please try signing in again after this period.</span><br/><br/><span>Alternatively, you could reset your password as follows:</span><br/><br/><span>Use the temporary password given below to sign in to the @appId@ app. You will be<br/>required to set up a new password after signing in.</span><br/><br/><span><strong>Temporary Password: </strong>@tempPassword@</span><br/><br/><span>Please note that this temporary password can be used only once and is valid for a period of<br/>${oauth.scim.service.account.lockout.period.minutes} minutes only.</span><br/><br/><span>For any questions or assistance, please write to <a>@contactEmail@</a></span><br/><br/><span style='font-size:15px;'>Thanks,</span><span>The @appId@ Support Team<span><br/><span>-------------------------------------------------------------------------------------------------</span><br/><span style='font-size:10px;'>Note: This is an auto-generated email. Please do not reply.</span></div></body></html>\n \n+# Redirect URL's\n+participant.manager.callback-url=${PARTICIPANT_MANAGER_URL}/callback", "originalCommit": "1c086c2851dfe0b5ed5c968f246c720d067c8ea6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQzMzQxNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/888#discussion_r486433415", "bodyText": "I personally prefer to keep the URLs in properties as it's easy to make any changes in future. Participant Manager web application requires '/#' for routing, so I changed the redirect URLs.", "author": "dhanyak-btc", "createdAt": "2020-09-10T15:26:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4NTc4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ2NTczMA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/888#discussion_r486465730", "bodyText": "problem is that any change in the path will require a deployment anyway, so we are not really saving any time.\nAlso by listing these here, we are promising a level of customization to our users that I don't think we are ready to provide.\nI would prefer to limit the prod properties to handful of values that the user actually needs to provide and not confuse them with values that they should not be touching.\nalso why do we need '/#' for routing?", "author": "zohrehj", "createdAt": "2020-09-10T16:11:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4NTc4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgzODYzNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/888#discussion_r486838635", "bodyText": "Fixed review comment as per the suggestion above - Keeping only the PARTICIPANT_MANAGER_URL as a variable, we can generate the rest of the paths in the application.", "author": "dhanyak-btc", "createdAt": "2020-09-11T07:52:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4NTc4NA=="}], "type": "inlineReview"}, {"oid": "ee6d18c853627f8e44f596b3b0e7b8f97bf4661e", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ee6d18c853627f8e44f596b3b0e7b8f97bf4661e", "message": "Reverted entity package name changes\n\nReverted entity package name changes", "committedDate": "2020-09-10T11:52:00Z", "type": "commit"}, {"oid": "fa82c495ff3af62494f9e50c0d523ffa9f9bdcde", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/fa82c495ff3af62494f9e50c0d523ffa9f9bdcde", "message": "Added # to participant manager redirect url\n\nAdded # to participant manager redirect url", "committedDate": "2020-09-10T15:24:22Z", "type": "commit"}, {"oid": "fe461a9cd77d9d62619e2c878ee3467d36092e7e", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/fe461a9cd77d9d62619e2c878ee3467d36092e7e", "message": "Merge branch 'develop' into oauth_scim_externalized_configuration", "committedDate": "2020-09-10T15:29:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ5NzE4Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/888#discussion_r486497187", "bodyText": "one idea is to include /# in PARTICIPANT_MANAGER_URL", "author": "zohrehj", "createdAt": "2020-09-10T17:00:53Z", "path": "oauth-scim-module/oauth-scim-service/src/main/resources/application.properties", "diffHunk": "@@ -26,12 +82,43 @@ oauth.scim.service.max.invalid.login.attempts=5\n oauth.scim.service.account.lockout.period.minutes=15\n oauth.scim.service.reset.password.expiry.hours=48\n # Email configs\n-mail.contact-email=apps@boston-technology.com\n-mail.from-email=apps@boston-technology.com\n+mail.contact-email=${MAIL_CONTACT_EMAIL}\n+mail.from-email=${MAIL_FROM_EMAIL}\n \n mail.subject.reset-password=Password Help for your account:  @orgId@\\u2019s  Study Builder portal\n mail.body.reset-password=<html><body><div style='margin:20px;padding:10px;font-family: sans-serif;font-size: 14px;'><span>Hi,</span><br/><br/><span>Thank you for reaching out for password help for your account on @orgId@&apos;s Study Builder portal.</span><br/><br/><span>Here is a temporary password which you can use to sign in to the @orgId@ MyStudies App.<br/> You will be required to set up a new password after signing in.</span><br/><br/><span><strong>Temporary Password: </strong><b>@tempPassword@</b> </span><br/><br/><span>Please note that this temporary password can be used only once and is valid for a period of 48 hours only.</span><br/><br/><span>For any questions or assistance, please write to <a>@contactEmail@</a> </span><br/><br/><span style='font-size:15px;'>Thanks,</span><br/><span>The @orgId@ MyStudies Support Team</span><br/><span>----------------------------------------------------</span><br/><span style='font-size:10px;'>PS - This is an auto-generated email. Please do not reply. In case you did not request password help, please visit the app and change your password as a precautionary measure.</span></div></body></html>\n \n oauth.scim.service.email.account.locked.subject=Your account has been locked.\n oauth.scim.service.email.account.locked.content=<html><body><div style='margin:20px;padding:10px;font-family: sans-serif;font-size: 14px;'><span>Hi,</span><br/><br/><span>This is to inform you that, as a security measure, your user account for @appId@ app<br/>has been temporarily locked for a period of ${oauth.scim.service.account.lockout.period.minutes} minutes, due to multiple consecutive failed sign-in<br/>attempts with incorrect password.<br/><br/><span>Please try signing in again after this period.</span><br/><br/><span>Alternatively, you could reset your password as follows:</span><br/><br/><span>Use the temporary password given below to sign in to the @appId@ app. You will be<br/>required to set up a new password after signing in.</span><br/><br/><span><strong>Temporary Password: </strong>@tempPassword@</span><br/><br/><span>Please note that this temporary password can be used only once and is valid for a period of<br/>${oauth.scim.service.account.lockout.period.minutes} minutes only.</span><br/><br/><span>For any questions or assistance, please write to <a>@contactEmail@</a></span><br/><br/><span style='font-size:15px;'>Thanks,</span><span>The @appId@ Support Team<span><br/><span>-------------------------------------------------------------------------------------------------</span><br/><span style='font-size:10px;'>Note: This is an auto-generated email. Please do not reply.</span></div></body></html>\n \n+# Redirect URL's\n+participant.manager.callback-url=${PARTICIPANT_MANAGER_URL}/#/callback", "originalCommit": "fe461a9cd77d9d62619e2c878ee3467d36092e7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUxOTM0Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/888#discussion_r486519342", "bodyText": "this is just a suggestion though, I am open to leaving it as is.", "author": "zohrehj", "createdAt": "2020-09-10T17:38:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ5NzE4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgzODg0OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/888#discussion_r486838848", "bodyText": "Fixed review comment as per the suggestion above - Keeping only the PARTICIPANT_MANAGER_URL as a variable, we can generate the rest of the paths in the application.", "author": "dhanyak-btc", "createdAt": "2020-09-11T07:53:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ5NzE4Nw=="}], "type": "inlineReview"}, {"oid": "3dd34d7283574ff93fc0ee5848d662e7fbd025c4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3dd34d7283574ff93fc0ee5848d662e7fbd025c4", "message": "Merge branch 'develop' into oauth_scim_externalized_configuration", "committedDate": "2020-09-11T07:30:20Z", "type": "commit"}, {"oid": "f130e2758cef33efb415ef614c18d5cd8f9969f9", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f130e2758cef33efb415ef614c18d5cd8f9969f9", "message": "Fixed review comment on redirect urls\n\nFixed review comment on redirect urls", "committedDate": "2020-09-11T07:50:18Z", "type": "commit"}, {"oid": "5c57cdbd0dd5356a759350899bbd0392c7ab8f69", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5c57cdbd0dd5356a759350899bbd0392c7ab8f69", "message": "updated actuator link\n\nupdated actuator link", "committedDate": "2020-09-11T08:30:36Z", "type": "commit"}, {"oid": "e450d5adb554b758105b1b5d8bebbce95e43bbd8", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e450d5adb554b758105b1b5d8bebbce95e43bbd8", "message": "Merge branch 'develop' into oauth_scim_externalized_configuration", "committedDate": "2020-09-14T05:13:41Z", "type": "commit"}, {"oid": "a5ede4e17f9e672431c8ba6f7a72ea576cf939be", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a5ede4e17f9e672431c8ba6f7a72ea576cf939be", "message": "Merge branch 'develop' into oauth_scim_externalized_configuration", "committedDate": "2020-09-14T05:17:35Z", "type": "commit"}]}