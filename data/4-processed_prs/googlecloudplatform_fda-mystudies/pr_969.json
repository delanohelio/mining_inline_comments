{"pr_number": 969, "pr_title": "Fixed issue #968 OAuth Scim Service - verify MimeMessage content in Tests ", "pr_createdAt": "2020-09-14T15:41:12Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/969", "timeline": [{"oid": "687ab6b3c038bddec28a8cc933cc12afb172bbd7", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/687ab6b3c038bddec28a8cc933cc12afb172bbd7", "message": "oauth scim email service implementation for resetPassword and sendAccountLockedEmail\n\noauth scim email service implementation for resetPassword and sendAccountLockedEmail", "committedDate": "2020-09-14T15:28:30Z", "type": "commit"}, {"oid": "2d497e8d81031a58691b36aa9e5011122f7751be", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/2d497e8d81031a58691b36aa9e5011122f7751be", "message": "Merge branch 'develop' into oauth-scim-email-service-implementation", "committedDate": "2020-09-15T05:03:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODM5Nzc4Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/969#discussion_r488397782", "bodyText": "If this is done for all MimeMessage verification it would make sense to move it into verifyMimeMessage() itself, and we can just make the method void", "author": "saminguyen", "createdAt": "2020-09-15T05:39:29Z", "path": "oauth-scim-module/oauth-scim-service/src/test/java/com/google/cloud/healthcare/fdamystudies/oauthscim/controller/LoginControllerTest.java", "diffHunk": "@@ -363,6 +370,24 @@ public void shouldSendAccountLockedEmail() throws Exception {\n     userEntity = userRepository.findByUserId(userResponse.getUserId()).get();\n     assertTrue(\n         UserAccountStatus.ACCOUNT_LOCKED.equals(UserAccountStatus.valueOf(userEntity.getStatus())));\n+\n+    String subject = getMailAccountLockedSubject();\n+    String body =\n+        String.join(\n+            \"<br/>\",\n+            \"This is to inform you that, as a security measure, your user account for MyStudies app\",\n+            \"has been temporarily locked for a period of 15 minutes, due to multiple consecutive failed sign-in\",\n+            \"attempts with incorrect password.\");\n+\n+    MimeMessage mail =\n+        verifyMimeMessage(EMAIL_VALUE, appPropertyConfig.getFromEmail(), subject, body);\n+    verifyDoesNotContain(mail.getContent().toString(), \"@tempPassword@\", \"@appId\");", "originalCommit": "687ab6b3c038bddec28a8cc933cc12afb172bbd7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI2OTg2MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/969#discussion_r490269861", "bodyText": "Temporary password is randomly generated and it's hash value is stored in database. We can't use assertEqual for comparing the MimeMessage mail body for this scenario, this needs to be asserted differently so added verifyDoesNotContain method. Please review and approve the PR.", "author": "dhanyak-btc", "createdAt": "2020-09-17T14:00:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODM5Nzc4Mg=="}], "type": "inlineReview"}, {"oid": "5a52c8544a44990cb9c6e04e5a4518eb7f1878e2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5a52c8544a44990cb9c6e04e5a4518eb7f1878e2", "message": "Fixed Build issue\n\nFixed Build issue", "committedDate": "2020-09-15T06:04:09Z", "type": "commit"}, {"oid": "15718fa2340022d560baa83a6925e2c5d709d8d1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/15718fa2340022d560baa83a6925e2c5d709d8d1", "message": "Merge branch 'develop' into oauth-scim-email-service-implementation", "committedDate": "2020-09-18T05:02:33Z", "type": "commit"}]}