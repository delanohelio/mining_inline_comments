{"pr_number": 898, "pr_title": "Study Metadata - Externalized Configuration", "pr_createdAt": "2020-09-07T12:45:09Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/898", "timeline": [{"oid": "f44575707694d41366eb540f861472cac647646a", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f44575707694d41366eb540f861472cac647646a", "message": "Study Metadata : Externalized Configuration\n\nStudy Metadata Externalized Configuration\nCode Format + Organize Imports\nProperty Clean up(removed unused properties)", "committedDate": "2020-09-07T12:44:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA2OTI3Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/898#discussion_r487069272", "bodyText": "this seems like a significant change, does this setup require the deployment of wcp-resources as a separate pod?", "author": "zohrehj", "createdAt": "2020-09-11T14:07:23Z", "path": "WCP-WS/src/main/resources/application.properties", "diffHunk": "@@ -1,46 +1,25 @@\n-# User registration server root URL\n-fda.registration.root.url=http://dummy-value/myStudiesUserMgmtWS\n-\n-#For server\n-fda.imgUploadPath=/webapps/fdaResources/\n-fda.currentPath=catalina.home\n-fda.imgDisplaydPath=/fdaResources/\n-\n-#For  server\n-acceptLinkMail =http://${BASE_URL}/studybuilder/createPassword.do?securityToken=\n-login.url=http://${BASE_URL}/studybuilder/login.do\n-signUp.url=http://${BASE_URL}/studybuilder/signUp.do?securityToken=\n-\n-# TODO: Change the IP/port to an env var and pass it in yaml file instead.\n-db.url=localhost:3306/${DB_NAME}\n-db.username=${DB_USER}\n-db.password=${DB_PASS}\n \n ########################## Web Configuration Portal Web-Services (WCP WS) Configuration Details  STARTS ##########################\n #DataBase Configuration\n # TODO: Change the IP/port to an env var and pass it in yaml file instead.\n # TODO: Figure out how to make hibernate respect env variables.\n # FOR NOW WE NEED TO MANUALLY CHANGE ${DB_NAME}, ${DB_USER} AND ${DB_PASS} IN THIS FILE BEFORE BUILDING THE IMAGE.\n-hibernate.connection.url=jdbc:mysql://localhost:3306/${DB_NAME}?autoReconnect=true\n+hibernate.connection.url=jdbc:mysql://${CLOUD_SQL_INSTANCE_IP}/${DB_NAME}?autoReconnect=true\n hibernate.connection.driver_class=com.mysql.cj.jdbc.Driver\n hibernate.connection.username=${DB_USER}\n hibernate.connection.password=${DB_PASS}\n \n fda.smd.catalinaPath=catalina.home\n \n #Study Image/Logo Path Local\n-fda.smd.study.thumbnailPath=http://${BASE_URL}/fdaResources/studylogo/\n-fda.smd.study.pagePath=http://${BASE_URL}/fdaResources/studypages/\n-fda.smd.resource.pdfPath=http://${BASE_URL}/fdaResources/studyResources/\n-fda.smd.questionnaire.image=http://${BASE_URL}/fdaResources/questionnaire/\n-fda.smd.gatewayResource.pdfPath=http://${BASE_URL}/fdaResources/gatewayResource/App_Glossary.pdf\n+fda.smd.study.thumbnailPath=${STUDY_BULDER_RESOURCE_URL}/studylogo/\n+fda.smd.study.pagePath=${STUDY_BULDER_RESOURCE_URL}/studypages/\n+fda.smd.resource.pdfPath=${STUDY_BULDER_RESOURCE_URL}/studyResources/\n+fda.smd.questionnaire.image=${STUDY_BULDER_RESOURCE_URL}/questionnaire/\n+fda.smd.gatewayResource.pdfPath=${STUDY_BULDER_RESOURCE_URL}/gatewayResource/App_Glossary.pdf", "originalCommit": "f44575707694d41366eb540f861472cac647646a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODM5MTAzMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/898#discussion_r488391032", "bodyText": "My Bad.. separate pod will not work . As per existing deployment we need to use same gcpfuse only or resources needs to deploy under server where studybuilder deployed . Hence revert the changes and pointing to studybuilder now.", "author": "aswinijena100", "createdAt": "2020-09-15T05:16:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA2OTI3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA2OTUwOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/898#discussion_r487069508", "bodyText": "nit: terms_and_conditions_url", "author": "zohrehj", "createdAt": "2020-09-11T14:07:46Z", "path": "WCP-WS/src/main/resources/application.properties", "diffHunk": "@@ -1,46 +1,25 @@\n-# User registration server root URL\n-fda.registration.root.url=http://dummy-value/myStudiesUserMgmtWS\n-\n-#For server\n-fda.imgUploadPath=/webapps/fdaResources/\n-fda.currentPath=catalina.home\n-fda.imgDisplaydPath=/fdaResources/\n-\n-#For  server\n-acceptLinkMail =http://${BASE_URL}/studybuilder/createPassword.do?securityToken=\n-login.url=http://${BASE_URL}/studybuilder/login.do\n-signUp.url=http://${BASE_URL}/studybuilder/signUp.do?securityToken=\n-\n-# TODO: Change the IP/port to an env var and pass it in yaml file instead.\n-db.url=localhost:3306/${DB_NAME}\n-db.username=${DB_USER}\n-db.password=${DB_PASS}\n \n ########################## Web Configuration Portal Web-Services (WCP WS) Configuration Details  STARTS ##########################\n #DataBase Configuration\n # TODO: Change the IP/port to an env var and pass it in yaml file instead.\n # TODO: Figure out how to make hibernate respect env variables.\n # FOR NOW WE NEED TO MANUALLY CHANGE ${DB_NAME}, ${DB_USER} AND ${DB_PASS} IN THIS FILE BEFORE BUILDING THE IMAGE.\n-hibernate.connection.url=jdbc:mysql://localhost:3306/${DB_NAME}?autoReconnect=true\n+hibernate.connection.url=jdbc:mysql://${CLOUD_SQL_INSTANCE_IP}/${DB_NAME}?autoReconnect=true\n hibernate.connection.driver_class=com.mysql.cj.jdbc.Driver\n hibernate.connection.username=${DB_USER}\n hibernate.connection.password=${DB_PASS}\n \n fda.smd.catalinaPath=catalina.home\n \n #Study Image/Logo Path Local\n-fda.smd.study.thumbnailPath=http://${BASE_URL}/fdaResources/studylogo/\n-fda.smd.study.pagePath=http://${BASE_URL}/fdaResources/studypages/\n-fda.smd.resource.pdfPath=http://${BASE_URL}/fdaResources/studyResources/\n-fda.smd.questionnaire.image=http://${BASE_URL}/fdaResources/questionnaire/\n-fda.smd.gatewayResource.pdfPath=http://${BASE_URL}/fdaResources/gatewayResource/App_Glossary.pdf\n+fda.smd.study.thumbnailPath=${STUDY_BULDER_RESOURCE_URL}/studylogo/\n+fda.smd.study.pagePath=${STUDY_BULDER_RESOURCE_URL}/studypages/\n+fda.smd.resource.pdfPath=${STUDY_BULDER_RESOURCE_URL}/studyResources/\n+fda.smd.questionnaire.image=${STUDY_BULDER_RESOURCE_URL}/questionnaire/\n+fda.smd.gatewayResource.pdfPath=${STUDY_BULDER_RESOURCE_URL}/gatewayResource/App_Glossary.pdf\n \n-fda.smd.pricaypolicy=https://www.fda.gov/AboutFDA/AboutThisWebsite/WebsitePolicies/#privacy\n-fda.smd.terms=https://www.fda.gov/AboutFDA/AboutThisWebsite/WebsitePolicies/\n-\n-#Reachout email\n-fda.smd.feedback=dummy-value\n-fda.smd.contactus=dummy-value\n+fda.smd.pricaypolicy=${PRIVACY_POLICY_URL}\n+fda.smd.terms=${TERMS_AND_CONDITION_URL}", "originalCommit": "f44575707694d41366eb540f861472cac647646a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODM4OTYzMA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/898#discussion_r488389630", "bodyText": "changed to terms_and_conditions_url", "author": "aswinijena100", "createdAt": "2020-09-15T05:11:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA2OTUwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA3MDY2MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/898#discussion_r487070660", "bodyText": "nit: please remove the start and end comment.", "author": "zohrehj", "createdAt": "2020-09-11T14:09:38Z", "path": "WCP-WS/src/main/resources/application.properties", "diffHunk": "@@ -49,16 +28,7 @@ fda.current.path=catalina.home\n fda.docs.responses.path=/webapps/FDAResponce\n \n #User Registration Server URL\n-userRegistrationServerUrl=http://${USER_REGISTRATION_SERVER}/myStudiesUserMgmtWS/studies/studymetadata\n-userRegistrationServerPersonalizedResourcesUrl=http://${USER_REGISTRATION_SERVER}/myStudiesUserMgmtWS/getPersonalizedResources\n-\n-#Response Server URL\n-responseServerUrl=http://${RESPONSE_SERVER}/mystudies-response-server/studymetadata\n-\n-#clientId\n-WCPClientId=${CLIENT_ID}\n-\n-#SecretKey\n-WCPSecretKey=${SECRET_KEY}\n+userRegistrationServerUrl=${USER_MGMT_SERVICE_URL}/studies/studymetadata\n+userRegistrationServerPersonalizedResourcesUrl=${USER_MGMT_SERVICE_URL}/getPersonalizedResources\n \n ########################## Web Configuration Portal Web-Services (WCP WS) Configuration Details ENDS ##########################", "originalCommit": "f44575707694d41366eb540f861472cac647646a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODM4OTU1MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/898#discussion_r488389550", "bodyText": "Removed  now", "author": "aswinijena100", "createdAt": "2020-09-15T05:11:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA3MDY2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA3MTIxNA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/898#discussion_r487071214", "bodyText": "are these properties in use?\ncan you please add comments to clarify what they are used for?", "author": "zohrehj", "createdAt": "2020-09-11T14:10:25Z", "path": "WCP-WS/src/main/resources/application.properties", "diffHunk": "@@ -1,46 +1,25 @@\n-# User registration server root URL\n-fda.registration.root.url=http://dummy-value/myStudiesUserMgmtWS\n-\n-#For server\n-fda.imgUploadPath=/webapps/fdaResources/\n-fda.currentPath=catalina.home\n-fda.imgDisplaydPath=/fdaResources/\n-\n-#For  server\n-acceptLinkMail =http://${BASE_URL}/studybuilder/createPassword.do?securityToken=\n-login.url=http://${BASE_URL}/studybuilder/login.do\n-signUp.url=http://${BASE_URL}/studybuilder/signUp.do?securityToken=\n-\n-# TODO: Change the IP/port to an env var and pass it in yaml file instead.\n-db.url=localhost:3306/${DB_NAME}\n-db.username=${DB_USER}\n-db.password=${DB_PASS}\n \n ########################## Web Configuration Portal Web-Services (WCP WS) Configuration Details  STARTS ##########################\n #DataBase Configuration\n # TODO: Change the IP/port to an env var and pass it in yaml file instead.\n # TODO: Figure out how to make hibernate respect env variables.\n # FOR NOW WE NEED TO MANUALLY CHANGE ${DB_NAME}, ${DB_USER} AND ${DB_PASS} IN THIS FILE BEFORE BUILDING THE IMAGE.\n-hibernate.connection.url=jdbc:mysql://localhost:3306/${DB_NAME}?autoReconnect=true\n+hibernate.connection.url=jdbc:mysql://${CLOUD_SQL_INSTANCE_IP}/${DB_NAME}?autoReconnect=true\n hibernate.connection.driver_class=com.mysql.cj.jdbc.Driver\n hibernate.connection.username=${DB_USER}\n hibernate.connection.password=${DB_PASS}\n \n fda.smd.catalinaPath=catalina.home\n \n #Study Image/Logo Path Local\n-fda.smd.study.thumbnailPath=http://${BASE_URL}/fdaResources/studylogo/\n-fda.smd.study.pagePath=http://${BASE_URL}/fdaResources/studypages/\n-fda.smd.resource.pdfPath=http://${BASE_URL}/fdaResources/studyResources/\n-fda.smd.questionnaire.image=http://${BASE_URL}/fdaResources/questionnaire/\n-fda.smd.gatewayResource.pdfPath=http://${BASE_URL}/fdaResources/gatewayResource/App_Glossary.pdf\n+fda.smd.study.thumbnailPath=${STUDY_BULDER_RESOURCE_URL}/studylogo/\n+fda.smd.study.pagePath=${STUDY_BULDER_RESOURCE_URL}/studypages/\n+fda.smd.resource.pdfPath=${STUDY_BULDER_RESOURCE_URL}/studyResources/\n+fda.smd.questionnaire.image=${STUDY_BULDER_RESOURCE_URL}/questionnaire/\n+fda.smd.gatewayResource.pdfPath=${STUDY_BULDER_RESOURCE_URL}/gatewayResource/App_Glossary.pdf\n \n-fda.smd.pricaypolicy=https://www.fda.gov/AboutFDA/AboutThisWebsite/WebsitePolicies/#privacy\n-fda.smd.terms=https://www.fda.gov/AboutFDA/AboutThisWebsite/WebsitePolicies/\n-\n-#Reachout email\n-fda.smd.feedback=dummy-value\n-fda.smd.contactus=dummy-value\n+fda.smd.pricaypolicy=${PRIVACY_POLICY_URL}\n+fda.smd.terms=${TERMS_AND_CONDITION_URL}\n \n #App Environment -- > possible value : local / uat / prod\n fda.env=local", "originalCommit": "f44575707694d41366eb540f861472cac647646a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA3MjE4MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/898#discussion_r487072181", "bodyText": "I would like only the base URL to be passed in the properties file, other endpoints would ideally get generated in a java class that holds user_mgmt_service api information.", "author": "zohrehj", "createdAt": "2020-09-11T14:11:50Z", "path": "WCP-WS/src/main/resources/application.properties", "diffHunk": "@@ -49,16 +28,7 @@ fda.current.path=catalina.home\n fda.docs.responses.path=/webapps/FDAResponce\n \n #User Registration Server URL\n-userRegistrationServerUrl=http://${USER_REGISTRATION_SERVER}/myStudiesUserMgmtWS/studies/studymetadata\n-userRegistrationServerPersonalizedResourcesUrl=http://${USER_REGISTRATION_SERVER}/myStudiesUserMgmtWS/getPersonalizedResources\n-\n-#Response Server URL\n-responseServerUrl=http://${RESPONSE_SERVER}/mystudies-response-server/studymetadata\n-\n-#clientId\n-WCPClientId=${CLIENT_ID}\n-\n-#SecretKey\n-WCPSecretKey=${SECRET_KEY}\n+userRegistrationServerUrl=${USER_MGMT_SERVICE_URL}/studies/studymetadata\n+userRegistrationServerPersonalizedResourcesUrl=${USER_MGMT_SERVICE_URL}/getPersonalizedResources", "originalCommit": "f44575707694d41366eb540f861472cac647646a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODM4OTQ1Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/898#discussion_r488389453", "bodyText": "Please find Dhanya's comment in PR #890\nWe've followed same pattern in all the services for API endpoints, this requires lot of code changes if we need to build the endpoint from application. We'll keep the API endpoints in properties for this release and address this in next release if we really need to make the changes. I personally prefer to keep API endpoints in properties file.", "author": "aswinijena100", "createdAt": "2020-09-15T05:11:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA3MjE4MQ=="}], "type": "inlineReview"}, {"oid": "328b884cf37e55c852de6e45c8b75a5cdc63ea0f", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/328b884cf37e55c852de6e45c8b75a5cdc63ea0f", "message": "Merge branch 'develop' into studymetadata-externalized-configuration", "committedDate": "2020-09-15T11:16:43Z", "type": "commit"}, {"oid": "7384ce6644be6631823f912889a899becae376b5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/7384ce6644be6631823f912889a899becae376b5", "message": "Added DB refernce link for properties and removed unused property\n\nAdded DB refernce link for properties and removed unused property", "committedDate": "2020-09-18T12:13:15Z", "type": "commit"}, {"oid": "dc1280fa5a1e040b5139ade947b647ff369a36d9", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/dc1280fa5a1e040b5139ade947b647ff369a36d9", "message": "Merge branch 'develop' into studymetadata-externalized-configuration", "committedDate": "2020-09-25T18:03:57Z", "type": "commit"}, {"oid": "a8504769c673f86c3b72bc0a33beb12e8a59523e", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a8504769c673f86c3b72bc0a33beb12e8a59523e", "message": "Merge branch 'develop' into studymetadata-externalized-configuration", "committedDate": "2020-09-26T07:21:41Z", "type": "commit"}, {"oid": "abac37d1b1fd9b4cabbaf4ddf7a61db0e2904db5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/abac37d1b1fd9b4cabbaf4ddf7a61db0e2904db5", "message": "Merge branch 'develop' into studymetadata-externalized-configuration", "committedDate": "2020-09-26T12:41:34Z", "type": "commit"}, {"oid": "1f22ca0fbf379cac0e2ce631d04969added2cbd2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1f22ca0fbf379cac0e2ce631d04969added2cbd2", "message": "Merge branch 'develop' into studymetadata-externalized-configuration", "committedDate": "2020-09-28T13:58:28Z", "type": "commit"}]}