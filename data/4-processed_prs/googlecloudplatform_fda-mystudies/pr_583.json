{"pr_number": 583, "pr_title": "Change Password: PUT /v1/users/{userId} endpoint implementation with Integration tests", "pr_createdAt": "2020-06-30T09:44:04Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/583", "timeline": [{"oid": "b91396b757e2909a7deb5e584ad153bbc3dcc9d6", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/b91396b757e2909a7deb5e584ad153bbc3dcc9d6", "message": "Change Password: PUT /v1/users/{userId} endpoint implementation with Integration tests\n\nChange Password: PUT /v1/users/{userId} endpoint implementation with Integration tests", "committedDate": "2020-06-30T09:43:30Z", "type": "commit"}, {"oid": "80259a3069d1b6b8162afe303c9456a6a22078e0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/80259a3069d1b6b8162afe303c9456a6a22078e0", "message": "Refactored the code to fix common review comments\n\nPR#586 We shouldn't be using the same request for two different actions.\nCreated ChangePasswordRequest with validation annotations and removed UserValidator.\n\nInverted the condition\n\nPR#575 Removed versioning from endpoints.", "committedDate": "2020-07-08T09:02:14Z", "type": "commit"}, {"oid": "257dafb5efbe924d6b638f0f73000221ad05ba5d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/257dafb5efbe924d6b638f0f73000221ad05ba5d", "message": "Removed /v1 to fix build failure\n\nRemoved /v1 to fix build failure", "committedDate": "2020-07-08T09:24:15Z", "type": "commit"}, {"oid": "d49b3cd331adcb2817a8f2fb3323b15ebe673f50", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d49b3cd331adcb2817a8f2fb3323b15ebe673f50", "message": "Removed unused constants\n\nRemoved unused constants", "committedDate": "2020-07-08T12:54:59Z", "type": "commit"}, {"oid": "e873164d2fd685b8d29d2881968f92f492f956d0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e873164d2fd685b8d29d2881968f92f492f956d0", "message": "Used UC Detector plugin to find unused variables/methods, fixed build issue\n\nUsed UC Detector plugin to find unused variables/methods, fixed build issue", "committedDate": "2020-07-08T13:05:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTY2OTE1Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/583#discussion_r451669156", "bodyText": "Why is this being changed in the PR for change password?", "author": "saminguyen", "createdAt": "2020-07-08T16:22:06Z", "path": "audit-log-module/audit-log-service/src/test/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/ApiEndpoint.java", "diffHunk": "@@ -12,7 +12,7 @@\n import java.net.URL;\n \n public enum ApiEndpoint {\n-  HEALTH(\"http://localhost:8001/audit-log-service/v1/healthCheck\"),\n+  HEALTH(\"http://localhost:8001/audit-log-service/healthCheck\"),", "originalCommit": "e873164d2fd685b8d29d2881968f92f492f956d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjA3ODIxNw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/583#discussion_r452078217", "bodyText": "Zohreh commented on versioning in API endpoints in PR#575.  I removed /v1 from HEALTH endpoint to fix test failure.", "author": "dhanyak-btc", "createdAt": "2020-07-09T09:14:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTY2OTE1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTg4NTI3OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/583#discussion_r451885278", "bodyText": "Is there a reason for so many backslashes. Wouldn't this suffice\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  \"^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[!\\\\\\\\\\\\\\\"#$%&'()*+,-.:;<=>?@\\\\\\\\\\\\\\\\[\\\\\\\\\\\\\\\\]^_`{|}~]).{8,64}$\";\n          \n          \n            \n                  \"^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[!\\\"#$%&'()*+,-.:;<=>?@\\[\\]^_`{|}~]).{8,64}$\";", "author": "saminguyen", "createdAt": "2020-07-08T23:46:47Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/ChangePasswordRequest.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.beans;\n+\n+import javax.validation.constraints.Pattern;\n+import javax.validation.constraints.Size;\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Getter\n+@Setter\n+public class ChangePasswordRequest {\n+\n+  private static final String PASSWORD_REGEX =\n+      \"^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[!\\\\\\\\\\\\\\\"#$%&'()*+,-.:;<=>?@\\\\\\\\\\\\\\\\[\\\\\\\\\\\\\\\\]^_`{|}~]).{8,64}$\";", "originalCommit": "e873164d2fd685b8d29d2881968f92f492f956d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjA4MTA4MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/583#discussion_r452081081", "bodyText": "Thanks Sami for providing the regex. I've changed the regex value, please review.", "author": "dhanyak-btc", "createdAt": "2020-07-09T09:18:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTg4NTI3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTg5NTgwNA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/583#discussion_r451895804", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                logger.entry(\"begin updateUser()\");\n          \n          \n            \n                logger.entry(\"begin changePassword()\");", "author": "saminguyen", "createdAt": "2020-07-09T00:24:02Z", "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/service/UserServiceImpl.java", "diffHunk": "@@ -61,30 +69,97 @@ public UserResponse createUser(UserRequest userRequest) {\n \n     // save user account details\n     UserEntity userEntity = UserMapper.fromUserRequest(userRequest);\n-    ObjectNode userInfo = getUserInfoWithPasswordAndPasswordHistory(userRequest);\n+    ObjectNode userInfo = getObjectNode();\n+    setPasswordAndPasswordHistoryFields(userRequest.getPassword(), userInfo);\n+\n     userEntity.setUserInfo(userInfo.toString());\n     userEntity = repository.saveAndFlush(userEntity);\n     logger.exit(String.format(\"id=%s\", userEntity.getId()));\n     return UserMapper.toUserResponse(userEntity);\n   }\n \n-  private ObjectNode getUserInfoWithPasswordAndPasswordHistory(UserRequest userRequest) {\n+  private void setPasswordAndPasswordHistoryFields(String password, ObjectNode userInfo) {\n     // encrypt the password using random salt\n     String rawSalt = salt();\n-    String encrypted = encrypt(userRequest.getPassword(), rawSalt);\n+    String encrypted = encrypt(password, rawSalt);\n \n     ObjectNode passwordNode = getObjectNode();\n     passwordNode.put(HASH, hash(encrypted));\n     passwordNode.put(SALT, rawSalt);\n     passwordNode.put(\n         EXPIRES_AT, DateTimeUtils.getSystemDateTimestamp(appConfig.getPasswordExpiryDays(), 0, 0));\n \n-    ArrayNode passwordHistory = createArrayNode();\n+    ArrayNode passwordHistory =\n+        userInfo.hasNonNull(PASSWORD_HISTORY)\n+            ? (ArrayNode) userInfo.get(PASSWORD_HISTORY)\n+            : createArrayNode();\n     passwordHistory.add(passwordNode);\n \n-    ObjectNode userInfo = getObjectNode();\n+    // keep only 'X' previous passwords\n+    logger.trace(String.format(\"password history has %d elements\", passwordHistory.size()));\n+    while (passwordHistory.size() > appConfig.getPasswordHistoryMaxSize()) {\n+      passwordHistory.remove(0);\n+    }\n+\n     userInfo.set(PASSWORD, passwordNode);\n     userInfo.set(PASSWORD_HISTORY, passwordHistory);\n-    return userInfo;\n+  }\n+\n+  @Override\n+  public ChangePasswordResponse changePassword(ChangePasswordRequest userRequest)\n+      throws JsonProcessingException {\n+    logger.entry(\"begin updateUser()\");", "originalCommit": "e873164d2fd685b8d29d2881968f92f492f956d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjA4MTQxOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/583#discussion_r452081418", "bodyText": "Replaced updateUser() with changePassword(). Please review.", "author": "dhanyak-btc", "createdAt": "2020-07-09T09:19:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTg5NTgwNA=="}], "type": "inlineReview"}, {"oid": "44c5e16d17a90a941e0e42a370f20424d64b43a4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/44c5e16d17a90a941e0e42a370f20424d64b43a4", "message": "Fixed PR#583 review comments\n\nFixed PR#583 review comments", "committedDate": "2020-07-09T09:17:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQyNjIyNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/583#discussion_r452426226", "bodyText": "nit: If this method is only going to be used for changePassword, I think it should be renamed to sth like  validateChangePasswordRequest instead just to be clear", "author": "saminguyen", "createdAt": "2020-07-09T18:58:19Z", "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/service/UserServiceImpl.java", "diffHunk": "@@ -61,30 +69,97 @@ public UserResponse createUser(UserRequest userRequest) {\n \n     // save user account details\n     UserEntity userEntity = UserMapper.fromUserRequest(userRequest);\n-    ObjectNode userInfo = getUserInfoWithPasswordAndPasswordHistory(userRequest);\n+    ObjectNode userInfo = getObjectNode();\n+    setPasswordAndPasswordHistoryFields(userRequest.getPassword(), userInfo);\n+\n     userEntity.setUserInfo(userInfo.toString());\n     userEntity = repository.saveAndFlush(userEntity);\n     logger.exit(String.format(\"id=%s\", userEntity.getId()));\n     return UserMapper.toUserResponse(userEntity);\n   }\n \n-  private ObjectNode getUserInfoWithPasswordAndPasswordHistory(UserRequest userRequest) {\n+  private void setPasswordAndPasswordHistoryFields(String password, ObjectNode userInfo) {\n     // encrypt the password using random salt\n     String rawSalt = salt();\n-    String encrypted = encrypt(userRequest.getPassword(), rawSalt);\n+    String encrypted = encrypt(password, rawSalt);\n \n     ObjectNode passwordNode = getObjectNode();\n     passwordNode.put(HASH, hash(encrypted));\n     passwordNode.put(SALT, rawSalt);\n     passwordNode.put(\n         EXPIRES_AT, DateTimeUtils.getSystemDateTimestamp(appConfig.getPasswordExpiryDays(), 0, 0));\n \n-    ArrayNode passwordHistory = createArrayNode();\n+    ArrayNode passwordHistory =\n+        userInfo.hasNonNull(PASSWORD_HISTORY)\n+            ? (ArrayNode) userInfo.get(PASSWORD_HISTORY)\n+            : createArrayNode();\n     passwordHistory.add(passwordNode);\n \n-    ObjectNode userInfo = getObjectNode();\n+    // keep only 'X' previous passwords\n+    logger.trace(String.format(\"password history has %d elements\", passwordHistory.size()));\n+    while (passwordHistory.size() > appConfig.getPasswordHistoryMaxSize()) {\n+      passwordHistory.remove(0);\n+    }\n+\n     userInfo.set(PASSWORD, passwordNode);\n     userInfo.set(PASSWORD_HISTORY, passwordHistory);\n-    return userInfo;\n+  }\n+\n+  @Override\n+  public ChangePasswordResponse changePassword(ChangePasswordRequest userRequest)\n+      throws JsonProcessingException {\n+    logger.entry(\"begin changePassword()\");\n+    Optional<UserEntity> optionalEntity = repository.findByUserId(userRequest.getUserId());\n+\n+    if (!optionalEntity.isPresent()) {\n+      logger.exit(ErrorCode.USER_NOT_FOUND);\n+      return new ChangePasswordResponse(ErrorCode.USER_NOT_FOUND);\n+    }\n+\n+    UserEntity userEntity = optionalEntity.get();\n+    ObjectNode userInfo = (ObjectNode) toJsonNode(userEntity.getUserInfo());\n+    ArrayNode passwordHistory =\n+        userInfo.hasNonNull(PASSWORD_HISTORY)\n+            ? (ArrayNode) userInfo.get(PASSWORD_HISTORY)\n+            : createArrayNode();\n+    JsonNode currentPwdNode = userInfo.get(PASSWORD);\n+\n+    ErrorCode errorCode = validatePasswords(userRequest, currentPwdNode, passwordHistory);\n+    if (errorCode != null) {\n+      logger.exit(String.format(\"change password failed with error code=%s\", errorCode));\n+      return new ChangePasswordResponse(errorCode);\n+    }\n+\n+    setPasswordAndPasswordHistoryFields(userRequest.getNewPassword(), userInfo);\n+    userEntity.setUserInfo(userInfo.toString());\n+    repository.saveAndFlush(userEntity);\n+    logger.exit(\"Your password has been changed successfully!\");\n+    return new ChangePasswordResponse(\n+        HttpStatus.OK, \"Your password has been changed successfully!\");\n+  }\n+\n+  private ErrorCode validatePasswords(", "originalCommit": "44c5e16d17a90a941e0e42a370f20424d64b43a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAzODM1Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/583#discussion_r453038353", "bodyText": "Renamed the method to validateChangePasswordRequest", "author": "dhanyak-btc", "createdAt": "2020-07-10T19:27:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQyNjIyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMzY5OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/583#discussion_r452503699", "bodyText": "Couple questions: Why do we have two different error codes, where in some cases the int value matches with EC-xxx and in some other cases it does not? According to the documentation in https://docs.google.com/document/d/1zxyUj9OD26aCMosdw2AdgLz4nYta2XM5s6h4SJGT1T4/edit#heading=h.gjdgxs there are no cases for 404 error codes. We should update USER_NOT_FOUND code to 400 or update the doc.", "author": "saminguyen", "createdAt": "2020-07-09T21:35:32Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ErrorCode.java", "diffHunk": "@@ -31,6 +31,16 @@\n \n   UNAUTHORIZED(401, \"EC-401\", \"Unauthorized\", \"Invalid token\"),\n \n+  USER_NOT_FOUND(404, \"EC-114\", Constants.BAD_REQUEST, \"User not found\"),\n+\n+  CURRENT_PASSWORD_INVALID(400, \"EC-119\", Constants.BAD_REQUEST, \"Current password is invalid\"),\n+\n+  ENFORCE_PASSWORD_HISTORY(\n+      400,\n+      \"EC-105\",", "originalCommit": "44c5e16d17a90a941e0e42a370f20424d64b43a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAzNzI5Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/583#discussion_r453037292", "bodyText": "404 for user not found is correct. I also found similar answer in SO post. The link in your review comment is an old auth server design document, new auth server integrates with Hydra hence it's design is different. I'll ask the Business Analyst to collect all message code and error code in a spreadsheet and then we'll update the EC-xxx codes in this enum.", "author": "dhanyak-btc", "createdAt": "2020-07-10T19:25:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMzY5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNDA0Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/583#discussion_r452504046", "bodyText": "nit: typo\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public void shouldReturnCurrentPasswordInvalidErrroCodeForChangePasswordAction()\n          \n          \n            \n              public void shouldReturnCurrentPasswordInvalidErrorCodeForChangePasswordAction()", "author": "saminguyen", "createdAt": "2020-07-09T21:36:24Z", "path": "oauth-scim-module/oauth-scim-service/src/test/java/com/google/cloud/healthcare/fdamystudies/oauthscim/controller/UserControllerTest.java", "diffHunk": "@@ -145,8 +157,144 @@ public void shouldReturnEmailExistsErrorCode() throws Exception {\n         .andExpect(jsonPath(\"$.error_description\").value(ErrorCode.EMAIL_EXISTS.getDescription()));\n   }\n \n+  @Test\n+  public void shouldReturnBadRequestForChangePasswordAction()\n+      throws MalformedURLException, JsonProcessingException, Exception {\n+    HttpHeaders headers = getCommonHeaders();\n+    headers.add(\"Authorization\", VALID_BEARER_TOKEN);\n+\n+    ChangePasswordRequest userRequest = new ChangePasswordRequest();\n+    userRequest.setNewPassword(\"new_password\");\n+    userRequest.setCurrentPassword(\"example_current_password\");\n+\n+    MvcResult result =\n+        mockMvc\n+            .perform(\n+                put(ApiEndpoint.CHANGE_PASSWORD.getPath(), IdGenerator.id())\n+                    .contextPath(getContextPath())\n+                    .content(asJsonString(userRequest))\n+                    .headers(headers))\n+            .andDo(print())\n+            .andExpect(status().isBadRequest())\n+            .andExpect(jsonPath(\"$.violations\").isArray())\n+            .andReturn();\n+\n+    String actualResponse = result.getResponse().getContentAsString();\n+    String expectedResponse =\n+        readJsonFile(\"/response/change_password_bad_request_response_from_annotations.json\");\n+    JSONAssert.assertEquals(expectedResponse, actualResponse, JSONCompareMode.NON_EXTENSIBLE);\n+  }\n+\n+  @Test\n+  @Order(3)\n+  public void shouldReturnCurrentPasswordInvalidErrroCodeForChangePasswordAction()", "originalCommit": "44c5e16d17a90a941e0e42a370f20424d64b43a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAzOTExMQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/583#discussion_r453039111", "bodyText": "Fixed the typo", "author": "dhanyak-btc", "createdAt": "2020-07-10T19:29:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNDA0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNDI0Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/583#discussion_r452504242", "bodyText": "typo here too\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public void shouldReturnUserNotFoundErrroCodeForChangePasswordAction()\n          \n          \n            \n              public void shouldReturnUserNotFoundErrorCodeForChangePasswordAction()", "author": "saminguyen", "createdAt": "2020-07-09T21:36:47Z", "path": "oauth-scim-module/oauth-scim-service/src/test/java/com/google/cloud/healthcare/fdamystudies/oauthscim/controller/UserControllerTest.java", "diffHunk": "@@ -145,8 +157,144 @@ public void shouldReturnEmailExistsErrorCode() throws Exception {\n         .andExpect(jsonPath(\"$.error_description\").value(ErrorCode.EMAIL_EXISTS.getDescription()));\n   }\n \n+  @Test\n+  public void shouldReturnBadRequestForChangePasswordAction()\n+      throws MalformedURLException, JsonProcessingException, Exception {\n+    HttpHeaders headers = getCommonHeaders();\n+    headers.add(\"Authorization\", VALID_BEARER_TOKEN);\n+\n+    ChangePasswordRequest userRequest = new ChangePasswordRequest();\n+    userRequest.setNewPassword(\"new_password\");\n+    userRequest.setCurrentPassword(\"example_current_password\");\n+\n+    MvcResult result =\n+        mockMvc\n+            .perform(\n+                put(ApiEndpoint.CHANGE_PASSWORD.getPath(), IdGenerator.id())\n+                    .contextPath(getContextPath())\n+                    .content(asJsonString(userRequest))\n+                    .headers(headers))\n+            .andDo(print())\n+            .andExpect(status().isBadRequest())\n+            .andExpect(jsonPath(\"$.violations\").isArray())\n+            .andReturn();\n+\n+    String actualResponse = result.getResponse().getContentAsString();\n+    String expectedResponse =\n+        readJsonFile(\"/response/change_password_bad_request_response_from_annotations.json\");\n+    JSONAssert.assertEquals(expectedResponse, actualResponse, JSONCompareMode.NON_EXTENSIBLE);\n+  }\n+\n+  @Test\n+  @Order(3)\n+  public void shouldReturnCurrentPasswordInvalidErrroCodeForChangePasswordAction()\n+      throws MalformedURLException, JsonProcessingException, Exception {\n+    HttpHeaders headers = getCommonHeaders();\n+    headers.add(\"Authorization\", VALID_BEARER_TOKEN);\n+\n+    ChangePasswordRequest request = new ChangePasswordRequest();\n+    request.setCurrentPassword(\"CurrentM0ck!tPassword\");\n+    request.setNewPassword(\"NewM0ck!tPassword\");\n+\n+    mockMvc\n+        .perform(\n+            put(ApiEndpoint.CHANGE_PASSWORD.getPath(), userId)\n+                .contextPath(getContextPath())\n+                .content(asJsonString(request))\n+                .headers(headers))\n+        .andDo(print())\n+        .andExpect(status().isBadRequest())\n+        .andExpect(\n+            jsonPath(\"$.error_description\")\n+                .value(ErrorCode.CURRENT_PASSWORD_INVALID.getDescription()));\n+  }\n+\n+  @Test\n+  public void shouldReturnUserNotFoundErrroCodeForChangePasswordAction()", "originalCommit": "44c5e16d17a90a941e0e42a370f20424d64b43a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAzOTE0NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/583#discussion_r453039144", "bodyText": "Fixed the typo", "author": "dhanyak-btc", "createdAt": "2020-07-10T19:29:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNDI0Mg=="}], "type": "inlineReview"}, {"oid": "616e486eababa2f699a942423d32dafedef4f1fe", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/616e486eababa2f699a942423d32dafedef4f1fe", "message": "Fixed typo and nit review comments\n\nFixed typo and nit review comments", "committedDate": "2020-07-10T19:27:27Z", "type": "commit"}, {"oid": "12357bef2e8871038c03113430e4275627b78e13", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/12357bef2e8871038c03113430e4275627b78e13", "message": "Merge branch 'develop' into oauth-scim-module-change-password", "committedDate": "2020-07-20T06:16:24Z", "type": "commit"}]}