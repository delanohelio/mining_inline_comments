{"pr_number": 272, "pr_title": "Setup app-specific secrets.", "pr_createdAt": "2020-04-29T19:50:28Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/272", "timeline": [{"oid": "015d5cc8e3fe8f179660b9f4c616171d1d88086f", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/015d5cc8e3fe8f179660b9f4c616171d1d88086f", "message": "Generate google_secret_manager_secrets for client_id and secret_key", "committedDate": "2020-04-29T19:01:10Z", "type": "commit"}, {"oid": "cf7610d1b600443326a06f4bb233e9af65d2b856", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/cf7610d1b600443326a06f4bb233e9af65d2b856", "message": "Introduce new app-specific kubernetes secrets.", "committedDate": "2020-04-29T19:49:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzU3NTI4Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/272#discussion_r417575286", "bodyText": "thanks for adding these!", "author": "zohrehj", "createdAt": "2020-04-29T19:59:15Z", "path": "Terraform/kubernetes/secrets.tf", "diffHunk": "@@ -46,7 +53,9 @@ data \"google_secret_manager_secret_version\" \"secrets\" {\n       \"my-studies-email-password\",\n     ],\n     formatlist(\"%s-db-user\", local.apps),\n-    formatlist(\"%s-db-password\", local.apps))\n+    formatlist(\"%s-db-password\", local.apps),\n+    formatlist(\"mystudies-%s-client-id\", local.auth_server_app_codes),\n+    formatlist(\"mystudies-%s-secret-key\", local.auth_server_app_codes))\n   )", "originalCommit": "cf7610d1b600443326a06f4bb233e9af65d2b856", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzU4MjM5OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/272#discussion_r417582398", "bodyText": "where is apps_db_names used?\nalso we really need to clean these up :-(", "author": "zohrehj", "createdAt": "2020-04-29T20:12:18Z", "path": "Terraform/secrets/main.tf", "diffHunk": "@@ -26,6 +26,31 @@ terraform {\n   }\n }\n \n+locals {\n+  apps = [\n+    \"auth-server\",\n+    \"response-server\",\n+    \"study-designer\",\n+    \"study-meta-data\",\n+    \"user-registration\",\n+  ]\n+  apps_db_names = {\n+    \"auth-server\"       = \"auth_server\"\n+    \"response-server\"   = \"mystudies_response_server\"\n+    \"study-designer\"    = \"fda_hphc\"\n+    \"study-meta-data\"   = \"fda_hphc\"\n+    \"user-registration\" = \"mystudies_userregistration\"\n+  }", "originalCommit": "cf7610d1b600443326a06f4bb233e9af65d2b856", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYwMjExMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/272#discussion_r417602112", "bodyText": "Removed. I originally want to refactor the db-related secrets to here as well, but on second thought I'll leave that for a separate change later.", "author": "kuoyuchi", "createdAt": "2020-04-29T20:48:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzU4MjM5OA=="}], "type": "inlineReview"}, {"oid": "aea0aebb8334ad576510883ecb0576f0dbc466d0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/aea0aebb8334ad576510883ecb0576f0dbc466d0", "message": "Remove unused variables.", "committedDate": "2020-04-29T20:47:09Z", "type": "commit"}, {"oid": "18026c7c8dda219a6ccb34d0afc477a6b2547e11", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/18026c7c8dda219a6ccb34d0afc477a6b2547e11", "message": "Merge branch 'early-access' into tf-secrets", "committedDate": "2020-04-29T20:49:01Z", "type": "commit"}, {"oid": "1c8e534e7c4e601a71310a364ecce454aa70a32c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1c8e534e7c4e601a71310a364ecce454aa70a32c", "message": "run terraform fmt to fix presubmit.", "committedDate": "2020-04-29T21:02:58Z", "type": "commit"}, {"oid": "2f5e5f9d45435e3b155e3dc9c526c8a5997bb4a4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/2f5e5f9d45435e3b155e3dc9c526c8a5997bb4a4", "message": "Merge branch 'tf-secrets' of https://github.com/GoogleCloudPlatform/fda-mystudies into tf-secrets", "committedDate": "2020-04-29T21:03:25Z", "type": "commit"}]}