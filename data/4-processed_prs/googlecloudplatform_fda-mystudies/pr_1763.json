{"pr_number": 1763, "pr_title": "Sql Injection issue fixes for StudyQuestionnaireDAOImpl", "pr_createdAt": "2020-11-02T09:55:39Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763", "timeline": [{"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/cfaba01d02e590f18c4fb354a2daaf5736f0e35d", "message": "SQL_Injection queries updated", "committedDate": "2020-11-02T09:50:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAyNzMzNw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516027337", "bodyText": ":questionnaireId", "author": "zohrehj", "createdAt": "2020-11-02T14:55:23Z", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -3132,22 +3191,26 @@ public String reOrderQuestionnaireSteps(\n               \"update response_sub_type_value rs,questionnaires_steps q set rs.destination_step_id = NULL \"\n                   + \"where rs.response_type_id=q.instruction_form_id and q.step_type='\"\n                   + FdahpStudyDesignerConstants.QUESTION_STEP\n-                  + \"' and q.questionnaires_id=\"\n-                  + questionnaireId\n+                  + \"' and q.questionnaires_id=questionnaireId \"", "originalCommit": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQzNzEwNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516437106", "bodyText": "Resolved", "author": "vinuth1488", "createdAt": "2020-11-03T05:40:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAyNzMzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAyODQxMw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516028413", "bodyText": "please pass this as a parameter as well", "author": "zohrehj", "createdAt": "2020-11-02T14:56:52Z", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -3404,14 +3473,16 @@ public InstructionsBo saveOrUpdateInstructionsBo(\n         instructionsBo.setQuestionnairesStepsBo(questionnairesStepsBo);\n         if ((questionnairesStepsBo != null) && (count > 0)) {\n           String updateQuery =\n-              \"update QuestionnairesStepsBo QSBO set QSBO.destinationStep=\"\n-                  + questionnairesStepsBo.getStepId()\n+              \"update QuestionnairesStepsBo QSBO set QSBO.destinationStep=:stepId \"\n                   + \" where \"\n                   + \"QSBO.destinationStep=0 and QSBO.sequenceNo=\"\n                   + (count - 1)", "originalCommit": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQzNzEyNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516437125", "bodyText": "Resolved", "author": "vinuth1488", "createdAt": "2020-11-03T05:40:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAyODQxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAyOTk2Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516029967", "bodyText": "nit: :stepType", "author": "zohrehj", "createdAt": "2020-11-02T14:59:05Z", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -3572,13 +3645,14 @@ public QuestionsBo saveOrUpdateQuestion(QuestionsBo questionsBo) {\n         if (!questionsBo.getStatus()) {\n           if (questionsBo.getQuestionnaireId() != null) {\n             query =\n-                session.createQuery(\n-                    \"From QuestionnairesStepsBo QSBO where QSBO.instructionFormId=\"\n-                        + questionsBo.getFromId()\n-                        + \" and QSBO.stepType='\"\n-                        + FdahpStudyDesignerConstants.FORM_STEP\n-                        + \"' and QSBO.active=1 and QSBO.questionnairesId=\"\n-                        + questionsBo.getQuestionnaireId());\n+                session\n+                    .createQuery(\n+                        \"From QuestionnairesStepsBo QSBO where QSBO.instructionFormId=:fromId \"\n+                            + \" and QSBO.stepType=:setType \"", "originalCommit": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQzNzE1NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516437155", "bodyText": "Resolved", "author": "vinuth1488", "createdAt": "2020-11-03T05:40:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAyOTk2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAzMDcxOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516030718", "bodyText": "nit: :formId", "author": "zohrehj", "createdAt": "2020-11-02T15:00:07Z", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -3609,10 +3684,11 @@ public QuestionsBo saveOrUpdateQuestion(QuestionsBo questionsBo) {\n           formMappingBo.setActive(true);\n           int sequenceNo = 0;\n           query =\n-              session.createQuery(\n-                  \"From FormMappingBo FMBO where FMBO.formId=\"\n-                      + questionsBo.getFromId()\n-                      + \" and FMBO.active=1 order by FMBO.sequenceNo DESC\");\n+              session\n+                  .createQuery(\n+                      \"From FormMappingBo FMBO where FMBO.formId=:fromId \"", "originalCommit": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQzNzIzNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516437236", "bodyText": "Resolved", "author": "vinuth1488", "createdAt": "2020-11-03T05:41:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAzMDcxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NjE5MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516046190", "bodyText": "missed midified_date", "author": "zohrehj", "createdAt": "2020-11-02T15:22:02Z", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -4648,27 +4786,25 @@ public String updateAnchordateInQuestionnaire(\n                   session\n                       .createSQLQuery(\n                           \"update questionnaires set status=0,anchor_date_id=null,\"\n-                              + \"modified_by=\"\n-                              + sessionObject.getUserId()\n+                              + \"modified_by=:userId \"\n                               + \",modified_date='\"\n                               + FdahpStudyDesignerUtil.getCurrentDateTime()", "originalCommit": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQzNzE2OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516437169", "bodyText": "Resolved", "author": "vinuth1488", "createdAt": "2020-11-03T05:41:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NjE5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NjQ4MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516046481", "bodyText": "same here, you missed modified_date", "author": "zohrehj", "createdAt": "2020-11-02T15:22:29Z", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -4648,27 +4786,25 @@ public String updateAnchordateInQuestionnaire(\n                   session\n                       .createSQLQuery(\n                           \"update questionnaires set status=0,anchor_date_id=null,\"\n-                              + \"modified_by=\"\n-                              + sessionObject.getUserId()\n+                              + \"modified_by=:userId \"\n                               + \",modified_date='\"\n                               + FdahpStudyDesignerUtil.getCurrentDateTime()\n-                              + \"' where active=1 and anchor_date_id in(\"\n-                              + StringUtils.join(anchorIds, \",\")\n-                              + \")\")\n+                              + \"' where active=1 and anchor_date_id in( :anchorIds ) \")\n+                      .setInteger(\"userId\", sessionObject.getUserId())\n+                      .setParameterList(\"anchorIds\", anchorIds)\n                       .executeUpdate();\n               if (count1 > 0) {\n                 studySequence.setStudyExcQuestionnaries(false);\n               }\n               int count2 =\n                   session\n                       .createSQLQuery(\n-                          \"update active_task set action=0 ,anchor_date_id=null, modified_by=\"\n-                              + sessionObject.getUserId()\n+                          \"update active_task set action=0 ,anchor_date_id=null, modified_by=:userId \"\n                               + \",modified_date='\"\n                               + FdahpStudyDesignerUtil.getCurrentDateTime()", "originalCommit": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQzNzE5Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516437197", "bodyText": "Resolved", "author": "vinuth1488", "createdAt": "2020-11-03T05:41:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NjQ4MQ=="}], "type": "inlineReview"}, {"oid": "44f3cd80e8eb6bcc59061a33ff7d549508354ef3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/44f3cd80e8eb6bcc59061a33ff7d549508354ef3", "message": "SQL_Changes asked by zohrehj", "committedDate": "2020-11-03T05:37:40Z", "type": "commit"}, {"oid": "b2890e65c79ff0babdf33a6226b99b9744d017ee", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/b2890e65c79ff0babdf33a6226b99b9744d017ee", "message": "Merge branch 'develop' into studybuilder_sql_issues_vinuth2_PR", "committedDate": "2020-11-03T13:43:08Z", "type": "commit"}]}