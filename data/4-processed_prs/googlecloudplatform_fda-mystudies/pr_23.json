{"pr_number": 23, "pr_title": "Unc cv19 iOS build", "pr_createdAt": "2020-03-23T21:38:26Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23", "timeline": [{"oid": "a23fb25d9b674a29b6e9e46966a7f7abbe0208f6", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a23fb25d9b674a29b6e9e46966a7f7abbe0208f6", "message": "Create build-iOS.yml", "committedDate": "2020-02-26T11:05:06Z", "type": "commit"}, {"oid": "1086a8054568c4b7680cb9ea106f547228decf16", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1086a8054568c4b7680cb9ea106f547228decf16", "message": "Merge pull request #8 from tushar-boston/ios-patch-1\n\nCreate build-iOS.yml", "committedDate": "2020-02-26T15:02:56Z", "type": "commit"}, {"oid": "97618077cb1bea8bc23d1807d539373c5178dd3d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/97618077cb1bea8bc23d1807d539373c5178dd3d", "message": "iOS files path changes. (#17) (#18)\n\n* iOS files path changes. (#17)\r\n\r\n* Update files path.\r\n\r\n* Create build-iOS.yml\r\n\r\n* Update copyrights.", "committedDate": "2020-03-12T10:08:39Z", "type": "commit"}, {"oid": "a7c34b7c9d49ed2219a17b75b3db391cd6479190", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a7c34b7c9d49ed2219a17b75b3db391cd6479190", "message": "Style guide update & removed unused files. (#19)\n\n* Style guide changes.\r\n\r\n* Run swift-format\r\n\r\n* Delete unused files\r\n\r\n* Clean debug print logs\r\n\r\n* formatting and commented out code cleanup.", "committedDate": "2020-03-18T17:22:04Z", "type": "commit"}, {"oid": "b434722ec9012eb972ff77edd961bd692857cf1e", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/b434722ec9012eb972ff77edd961bd692857cf1e", "message": "- GCP server updates.", "committedDate": "2020-03-23T21:24:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc3NzEwMw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396777103", "bodyText": "I noticed the error code change, is that a typo?", "author": "zohrehj", "createdAt": "2020-03-23T21:48:32Z", "path": "iOS/HPHC/HPHC/Controllers/GatewayUI/ProfileViewUI/ProfileViewController.swift", "diffHunk": "@@ -808,7 +809,8 @@ extension ProfileViewController: NMWebServiceDelegate {\n   func failedRequest(_ manager: NetworkManager, requestName: NSString, error: NSError) {\n     self.removeProgressIndicator()\n \n-    if error.code == 403 {  //  unauthorized\n+    if requestName as String == AuthServerMethods.getRefreshedToken.description && error.code == 401", "originalCommit": "b434722ec9012eb972ff77edd961bd692857cf1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNTY4Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396905687", "bodyText": "Nope, this error code updated to 401 with new Auth server.", "author": "tushar-boston", "createdAt": "2020-03-24T05:11:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc3NzEwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc3NzMzMA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396777330", "bodyText": "nit: double comment\nalso code changed from 403 to 401?", "author": "zohrehj", "createdAt": "2020-03-23T21:49:03Z", "path": "iOS/HPHC/HPHC/Controllers/GatewayUI/SlideMenu/LeftMenuViewController.swift", "diffHunk": "@@ -613,7 +612,8 @@ extension LeftMenuViewController: NMWebServiceDelegate {\n   func failedRequest(_ manager: NetworkManager, requestName: NSString, error: NSError) {\n     UIApplication.shared.keyWindow?.addProgressIndicatorOnWindowFromTop()\n \n-    if error.code == 403 {  // unauthorized\n+    if requestName as String == AuthServerMethods.getRefreshedToken.description && error.code == 401\n+    {  //unauthorized  // unauthorized", "originalCommit": "b434722ec9012eb972ff77edd961bd692857cf1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNjEwOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396906108", "bodyText": "Same, error code updated.", "author": "tushar-boston", "createdAt": "2020-03-24T05:13:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc3NzMzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc3NzU5MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396777590", "bodyText": "nit: double comment", "author": "zohrehj", "createdAt": "2020-03-23T21:49:37Z", "path": "iOS/HPHC/HPHC/Controllers/GatewayUI/StudyUI/StudyListViewController.swift", "diffHunk": "@@ -1090,7 +1082,8 @@ extension StudyListViewController: NMWebServiceDelegate {\n     let appdelegate = (UIApplication.shared.delegate as? AppDelegate)!\n     appdelegate.window?.removeProgressIndicatorFromWindow()\n \n-    if error.code == 403 {  // unauthorized Access\n+    if requestName as String == AuthServerMethods.getRefreshedToken.description && error.code == 401\n+    {  //unauthorized  // unauthorized Access", "originalCommit": "b434722ec9012eb972ff77edd961bd692857cf1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNzIxMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396907212", "bodyText": "fixed.", "author": "tushar-boston", "createdAt": "2020-03-24T05:18:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc3NzU5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc3ODI5NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396778294", "bodyText": "please remove", "author": "zohrehj", "createdAt": "2020-03-23T21:51:11Z", "path": "iOS/HPHC/HPHC/Default.xcconfig", "diffHunk": "@@ -0,0 +1,50 @@\n+//\n+//  Default.xcconfig\n+//  HPHC", "originalCommit": "b434722ec9012eb972ff77edd961bd692857cf1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNzIyOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396907228", "bodyText": "fixed.", "author": "tushar-boston", "createdAt": "2020-03-24T05:18:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc3ODI5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc3ODc2NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396778765", "bodyText": "please remove", "author": "zohrehj", "createdAt": "2020-03-23T21:52:15Z", "path": "iOS/HPHC/HPHC/Networking/APIs/ConsentServices.swift", "diffHunk": "@@ -0,0 +1,179 @@\n+//\n+//  AuthServices.swift\n+//  HPHC", "originalCommit": "b434722ec9012eb972ff77edd961bd692857cf1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNzIzOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396907238", "bodyText": "fixed.", "author": "tushar-boston", "createdAt": "2020-03-24T05:19:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc3ODc2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc4MDMxOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396780318", "bodyText": "nit: typo seceretKey", "author": "zohrehj", "createdAt": "2020-03-23T21:55:27Z", "path": "iOS/HPHC/HPHC/Networking/Configurations/AuthServerConfiguration.swift", "diffHunk": "@@ -0,0 +1,100 @@\n+//  Copyright 2020 Google LLC\n+//\n+//  Use of this source code is governed by an MIT-style\n+//  license that can be found in the LICENSE file or at\n+//  https://opensource.org/licenses/MIT.\n+\n+import UIKit\n+\n+enum AuthServerMethods: String {\n+\n+  case login\n+  case forgotPassword\n+  case logout\n+  case changePassword\n+  case getRefreshedToken\n+\n+  var description: String {\n+    switch self {\n+    default:\n+      return self.apiPath\n+    }\n+  }\n+\n+  var apiPath: String {\n+    switch self {\n+    default:\n+      return self.rawValue\n+    }\n+  }\n+\n+  var method: Method {\n+\n+    switch self {\n+\n+    case .logout:\n+      //DELETE Methods\n+      return Method(\n+        methodName: self.apiPath,\n+        methodType: .httpMethodDELETE,\n+        requestType: .requestTypeJSON\n+      )\n+    default:\n+      //POST Methods\n+      return Method(\n+        methodName: self.apiPath,\n+        methodType: .httpMethodPOST,\n+        requestType: .requestTypeJSON\n+      )\n+\n+    }\n+  }\n+\n+}\n+// MARK: - Set the server end points\n+enum AuthServerURLConstants {\n+  static let ProductionURL = API.authURL\n+  static let DevelopmentURL = API.authURL\n+}\n+\n+class AuthServerConfiguration: NetworkConfiguration {\n+  static let configuration = AuthServerConfiguration()\n+\n+  // MARK: Delegates\n+  override func getProductionURL() -> String {\n+    return AuthServerURLConstants.ProductionURL\n+  }\n+\n+  override func getDevelopmentURL() -> String {\n+    return AuthServerURLConstants.DevelopmentURL\n+  }\n+\n+  override func getDefaultHeaders() -> [String: String] {\n+\n+    let clientId = RegistrationServerAPIKey.apiKey\n+    let seceretKey = RegistrationServerSecretKey.secretKey\n+\n+    var header = [\n+      \"appId\": AppConfiguration.appID,\n+      \"orgId\": AppConfiguration.orgID,\n+    ]\n+\n+    if User.currentUser.authToken != nil {\n+      header[kUserAuthToken] = User.currentUser.authToken\n+      header[\"clientToken\"] = User.currentUser.clientToken\n+    } else {\n+      header[\"clientId\"] = clientId\n+      header[\"secretKey\"] = seceretKey", "originalCommit": "b434722ec9012eb972ff77edd961bd692857cf1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNzI1Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396907257", "bodyText": "fixed.", "author": "tushar-boston", "createdAt": "2020-03-24T05:19:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc4MDMxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc4MTE0Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396781142", "bodyText": "please only add the Google copyright to files that have been updated with new functionality, not sure why this one has been changed", "author": "zohrehj", "createdAt": "2020-03-23T21:57:17Z", "path": "iOS/HPHC/HPHC/Networking/Network setup/NetworkConstants.swift", "diffHunk": "@@ -1,6 +1,7 @@\n // License Agreement for FDA My Studies\n-// Copyright \u00a9 2017-2019 Harvard Pilgrim Health Care Institute (HPHCI) and its Contributors. Permission is\n-// hereby granted, free of charge, to any person obtaining a copy of this software and associated\n+// Copyright \u00a9 2017-2019 Harvard Pilgrim Health Care Institute (HPHCI) and its Contributors.\n+// Copyright 2020 Google LLC", "originalCommit": "b434722ec9012eb972ff77edd961bd692857cf1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNzc5NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396907794", "bodyText": "Updated back to old copyrights.", "author": "tushar-boston", "createdAt": "2020-03-24T05:21:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc4MTE0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc4MTQwNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396781406", "bodyText": "same here. was this file updated aside from style guide changes?", "author": "zohrehj", "createdAt": "2020-03-23T21:57:47Z", "path": "iOS/HPHC/HPHC/Networking/Network setup/NetworkManager.swift", "diffHunk": "@@ -1,6 +1,7 @@\n // License Agreement for FDA My Studies\n-// Copyright \u00a9 2017-2019 Harvard Pilgrim Health Care Institute (HPHCI) and its Contributors. Permission is\n-// hereby granted, free of charge, to any person obtaining a copy of this software and associated\n+// Copyright \u00a9 2017-2019 Harvard Pilgrim Health Care Institute (HPHCI) and its Contributors.\n+// Copyright 2020 Google LLC", "originalCommit": "b434722ec9012eb972ff77edd961bd692857cf1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNzc1Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396907757", "bodyText": "No, updated back to old copyrights.", "author": "tushar-boston", "createdAt": "2020-03-24T05:21:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc4MTQwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc4MjIyNw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396782227", "bodyText": "this file should have Google copyright header added to it, since there are some code changes.", "author": "zohrehj", "createdAt": "2020-03-23T21:59:41Z", "path": "iOS/HPHC/HPHC/Views/Cells/TableView/Study/StudyListCell.swift", "diffHunk": "@@ -44,6 +44,12 @@ class StudyListCell: UITableViewCell {\n   var selectedStudy: Study!\n   weak var delegate: StudyListDelegates?\n \n+  /// Cell cleanup.", "originalCommit": "b434722ec9012eb972ff77edd961bd692857cf1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwODAxNA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396908014", "bodyText": "Updated.", "author": "tushar-boston", "createdAt": "2020-03-24T05:22:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc4MjIyNw=="}], "type": "inlineReview"}, {"oid": "47c0f7de7641994467050d90c8042eca7ec6f42d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/47c0f7de7641994467050d90c8042eca7ec6f42d", "message": "Copyrights & comments cleanup.", "committedDate": "2020-03-24T05:26:59Z", "type": "commit"}]}