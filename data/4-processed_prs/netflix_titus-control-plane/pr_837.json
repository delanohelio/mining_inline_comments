{"pr_number": 837, "pr_title": "Adding schedulerName attribute to ApplicationSLA", "pr_createdAt": "2020-04-17T21:50:51Z", "pr_url": "https://github.com/Netflix/titus-control-plane/pull/837", "timeline": [{"oid": "977bddc7bfeaeacc33d15b82157aff95a6f9b48f", "url": "https://github.com/Netflix/titus-control-plane/commit/977bddc7bfeaeacc33d15b82157aff95a6f9b48f", "message": "Refactoring ConstraintValidators to sanitize violation message so it is not an EL expression", "committedDate": "2020-02-29T00:54:26Z", "type": "commit"}, {"oid": "59b0d7d80b1dc3c194b5e7b59d2dff898514cc8c", "url": "https://github.com/Netflix/titus-control-plane/commit/59b0d7d80b1dc3c194b5e7b59d2dff898514cc8c", "message": "Merge pull request #3 from joshi-keyur/VUL-1981/sanitize-violation-message\n\nRefactoring ConstraintValidators to sanitize violation message templates", "committedDate": "2020-02-29T01:35:15Z", "type": "commit"}, {"oid": "b10fc85d64c5ae72663a0de03d3d48bf916af138", "url": "https://github.com/Netflix/titus-control-plane/commit/b10fc85d64c5ae72663a0de03d3d48bf916af138", "message": "Replacing the Wrapper class with a Function which sanitizes the string message", "committedDate": "2020-03-02T20:35:03Z", "type": "commit"}, {"oid": "9eb082394c84d191cc6de9318260b5866ae0ea3f", "url": "https://github.com/Netflix/titus-control-plane/commit/9eb082394c84d191cc6de9318260b5866ae0ea3f", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-03-03T19:24:20Z", "type": "commit"}, {"oid": "eebceece71c91139503a318afc7ebeeb678ed356", "url": "https://github.com/Netflix/titus-control-plane/commit/eebceece71c91139503a318afc7ebeeb678ed356", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-03-03T22:20:36Z", "type": "commit"}, {"oid": "bb750fa731641fd1538b2b8057146c114509a858", "url": "https://github.com/Netflix/titus-control-plane/commit/bb750fa731641fd1538b2b8057146c114509a858", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-03-11T00:15:42Z", "type": "commit"}, {"oid": "e88f776c66c32702286e2ad3e9b1a5888c388804", "url": "https://github.com/Netflix/titus-control-plane/commit/e88f776c66c32702286e2ad3e9b1a5888c388804", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-03-16T00:47:46Z", "type": "commit"}, {"oid": "205853bb81846f2fa265db2570d392cdcbc54326", "url": "https://github.com/Netflix/titus-control-plane/commit/205853bb81846f2fa265db2570d392cdcbc54326", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-03-31T21:47:21Z", "type": "commit"}, {"oid": "9737864bccf7114edbb2ab78e0028f483ad613fb", "url": "https://github.com/Netflix/titus-control-plane/commit/9737864bccf7114edbb2ab78e0028f483ad613fb", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-04-10T23:31:27Z", "type": "commit"}, {"oid": "4ab2af94f2e309ccae885329c53b92f7b68e724c", "url": "https://github.com/Netflix/titus-control-plane/commit/4ab2af94f2e309ccae885329c53b92f7b68e724c", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-04-14T00:45:06Z", "type": "commit"}, {"oid": "2a3d0749cd9ff5ac92bebce1c49d275ace83f3d2", "url": "https://github.com/Netflix/titus-control-plane/commit/2a3d0749cd9ff5ac92bebce1c49d275ace83f3d2", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-04-14T19:45:50Z", "type": "commit"}, {"oid": "2acb17cade27bce3a36dc7d03f7ed98d831a0cf4", "url": "https://github.com/Netflix/titus-control-plane/commit/2acb17cade27bce3a36dc7d03f7ed98d831a0cf4", "message": "WIP: Introduce schedulerName to ApplicationSLA and use default scheduler value \"fenzo\"", "committedDate": "2020-04-14T23:40:02Z", "type": "commit"}, {"oid": "26d9906ff53d600ac8b7aeb6ff739b58be4f7f24", "url": "https://github.com/Netflix/titus-control-plane/commit/26d9906ff53d600ac8b7aeb6ff739b58be4f7f24", "message": "PR review comments", "committedDate": "2020-04-15T23:56:07Z", "type": "commit"}, {"oid": "b4c2f61677fbcf244420437b2a9c64dbc9a2f3ec", "url": "https://github.com/Netflix/titus-control-plane/commit/b4c2f61677fbcf244420437b2a9c64dbc9a2f3ec", "message": "Fixed typo", "committedDate": "2020-04-16T17:03:04Z", "type": "commit"}, {"oid": "fa13bb987e90b423cf4ca08b20572c7b2ed64493", "url": "https://github.com/Netflix/titus-control-plane/commit/fa13bb987e90b423cf4ca08b20572c7b2ed64493", "message": "Handle updates by removing previous instance from the scheduler cache", "committedDate": "2020-04-17T21:37:17Z", "type": "commit"}, {"oid": "21fe05c2b85279e2c3943cc593a4703c5d015397", "url": "https://github.com/Netflix/titus-control-plane/commit/21fe05c2b85279e2c3943cc593a4703c5d015397", "message": "Additional tests for find-by-scheduler and update operations", "committedDate": "2020-04-17T21:39:24Z", "type": "commit"}, {"oid": "f4d1e147bb2ff7ffa077ccfa13b1a379f1966472", "url": "https://github.com/Netflix/titus-control-plane/commit/f4d1e147bb2ff7ffa077ccfa13b1a379f1966472", "message": "Merge pull request #4 from joshi-keyur/ApplicationSLA-model-extension\n\nAdd schedulerName attribute to ApplicationSLA and supporting API changes", "committedDate": "2020-04-17T21:44:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ5OTYwMw==", "url": "https://github.com/Netflix/titus-control-plane/pull/837#discussion_r410499603", "bodyText": "Jackson annotation are in ApplicationSlaMixIn. You should not add them here.", "author": "tbak", "createdAt": "2020-04-17T22:29:44Z", "path": "titus-api/src/main/java/com/netflix/titus/api/model/ApplicationSLA.java", "diffHunk": "@@ -30,20 +38,29 @@\n \n     private final ResourceDimension resourceDimension;\n \n+    private final String schedulerName;\n+\n     /**\n      * Total number of instances required by this application. Titus will keep pre-allocated resources to always\n      * fulfill this requirement.\n      */\n     private int instanceCount;\n \n-    public ApplicationSLA(String appName,\n-                          Tier tier,\n-                          ResourceDimension resourceDimension,\n-                          int instanceCount) {\n+    @JsonCreator\n+    public ApplicationSLA(@JsonProperty(\"appName\") String appName,", "originalCommit": "f4d1e147bb2ff7ffa077ccfa13b1a379f1966472", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUyNTMxNQ==", "url": "https://github.com/Netflix/titus-control-plane/pull/837#discussion_r410525315", "bodyText": "Fixed. Thanks", "author": "joshi-keyur", "createdAt": "2020-04-18T00:35:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ5OTYwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwMDUzNw==", "url": "https://github.com/Netflix/titus-control-plane/pull/837#discussion_r410500537", "bodyText": "Does .onErrorReturn(t -> null) emit null value or  nothing at all?", "author": "tbak", "createdAt": "2020-04-17T22:33:20Z", "path": "titus-server-master/src/main/java/com/netflix/titus/master/service/management/internal/DefaultApplicationSlaManagementService.java", "diffHunk": "@@ -52,6 +52,12 @@ public DefaultApplicationSlaManagementService(CapacityMonitoringService capacity\n                 .toList().toBlocking().firstOrDefault(Collections.emptyList());\n     }\n \n+    @Override\n+    public Collection<ApplicationSLA> getApplicationSLAsForScheduler(String schedulerName) {\n+        return storage.findBySchedulerName(schedulerName).onErrorReturn(t -> null)", "originalCommit": "f4d1e147bb2ff7ffa077ccfa13b1a379f1966472", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDU1ODQ5NA==", "url": "https://github.com/Netflix/titus-control-plane/pull/837#discussion_r410558494", "bodyText": "It emits a null value that would appear in the return collection. This behavior is borrowed from the other get methods in this service. Should we do anything differently here and possibly at other places?", "author": "joshi-keyur", "createdAt": "2020-04-18T02:15:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwMDUzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcxNDY0NQ==", "url": "https://github.com/Netflix/titus-control-plane/pull/837#discussion_r410714645", "bodyText": "Yes, this is incorrect. Could you also fix the other method? What happens if a list of null is returned?", "author": "tbak", "createdAt": "2020-04-18T15:48:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwMDUzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkwNDg2MA==", "url": "https://github.com/Netflix/titus-control-plane/pull/837#discussion_r411904860", "bodyText": "Changed onErrorReturn() to doOnError() and added error logging. Please review.", "author": "joshi-keyur", "createdAt": "2020-04-21T06:27:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwMDUzNw=="}], "type": "inlineReview"}, {"oid": "c667ac71a53d71d8a07884a4721d157e50e57b6e", "url": "https://github.com/Netflix/titus-control-plane/commit/c667ac71a53d71d8a07884a4721d157e50e57b6e", "message": "Removing Jackson annotations and moving to ApplicationSlaMixIn", "committedDate": "2020-04-18T00:25:21Z", "type": "commit"}, {"oid": "960dc44d5704b1a667bbf1e4b1a47a650ebed680", "url": "https://github.com/Netflix/titus-control-plane/commit/960dc44d5704b1a667bbf1e4b1a47a650ebed680", "message": "Added error logging and more integration tests", "committedDate": "2020-04-21T06:22:33Z", "type": "commit"}, {"oid": "5c93df457a58c4cc7018e8b4f2f2fb2ca2c67182", "url": "https://github.com/Netflix/titus-control-plane/commit/5c93df457a58c4cc7018e8b4f2f2fb2ca2c67182", "message": "Partially reverting the change to fix broken integration tests", "committedDate": "2020-04-21T07:18:49Z", "type": "commit"}, {"oid": "e97936e821c5d5ce8872eecebfbd1dd84ac08374", "url": "https://github.com/Netflix/titus-control-plane/commit/e97936e821c5d5ce8872eecebfbd1dd84ac08374", "message": "Removing TODO comment", "committedDate": "2020-04-22T04:43:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM1MjAxNw==", "url": "https://github.com/Netflix/titus-control-plane/pull/837#discussion_r413352017", "bodyText": "there is -> there are", "author": "corindwyer", "createdAt": "2020-04-22T21:39:44Z", "path": "titus-api/src/main/java/com/netflix/titus/api/store/v2/ApplicationSlaStoreCache.java", "diffHunk": "@@ -32,15 +36,17 @@\n \n /**\n  * Caching proxy for {@link ApplicationSlaStore}. It loads all data on startup in a blocking mode to fail fast,\n- * in case the is any problem with the storage.\n+ * in case there is any problem with the storage.", "originalCommit": "e97936e821c5d5ce8872eecebfbd1dd84ac08374", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM1MjE4Ng==", "url": "https://github.com/Netflix/titus-control-plane/pull/837#discussion_r413352186", "bodyText": "autoformat class should move this curly up a line", "author": "corindwyer", "createdAt": "2020-04-22T21:40:05Z", "path": "titus-api/src/main/java/com/netflix/titus/api/store/v2/ApplicationSlaStoreCache.java", "diffHunk": "@@ -50,12 +56,22 @@ public ApplicationSlaStoreCache(ApplicationSlaStore delegate) {\n     public Observable<Void> enterActiveMode() {\n         logger.info(\"Entering active mode\");\n         this.cache = loadCache(delegate);\n+        this.cacheBySchedulerName = loadSchedulerMapCache(this.cache);\n         return Observable.empty();\n     }\n \n     @Override\n     public Observable<Void> create(ApplicationSLA applicationSLA) {\n-        return delegate.create(applicationSLA).doOnCompleted(() -> cache.put(applicationSLA.getAppName(), applicationSLA));\n+        return delegate.create(applicationSLA).doOnCompleted(() ->\n+        {", "originalCommit": "e97936e821c5d5ce8872eecebfbd1dd84ac08374", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e7b0271e79d4277cd2e30b1e74adf7b1f0acb102", "url": "https://github.com/Netflix/titus-control-plane/commit/e7b0271e79d4277cd2e30b1e74adf7b1f0acb102", "message": "Formatting changes", "committedDate": "2020-04-22T22:24:20Z", "type": "commit"}]}