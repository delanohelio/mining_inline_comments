{"pr_number": 840, "pr_title": "Change task dependency rules to avoid issues caused by the recent gradle upgrade", "pr_createdAt": "2020-04-22T21:37:45Z", "pr_url": "https://github.com/Netflix/titus-control-plane/pull/840", "timeline": [{"oid": "50079ff78ca45b8e9f53b98178f4a16178091073", "url": "https://github.com/Netflix/titus-control-plane/commit/50079ff78ca45b8e9f53b98178f4a16178091073", "message": "Change task dependency rules to avoid issues caused by the recent gradle upgrade", "committedDate": "2020-04-22T21:35:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM1MzMxOQ==", "url": "https://github.com/Netflix/titus-control-plane/pull/840#discussion_r413353319", "bodyText": "could this be done inside the gradle JVM instead of shelling out here? Shelling out has all sorts of implications and assumptions about where it is running\nE.g.: https://docs.gradle.org/current/userguide/working_with_files.html#sec:moving_files_example or directly registering a task of type: Copy instead of type: Exec", "author": "fabiokung", "createdAt": "2020-04-22T21:42:05Z", "path": "titus-common-grpc-api/build.gradle", "diffHunk": "@@ -22,13 +22,11 @@ dependencies {\n }\n \n if (project.hasProperty(\"idlLocal\")) {\n-    task extractProto {\n-        doLast {\n-            copy {\n-                from '../../titus-api-definitions/src/main/proto'\n-                into new File(buildDir, \"extracted-protos/main\")\n-            }\n-        }\n+    tasks.register('copyProtos', Exec) {\n+        commandLine \"/bin/bash\", \"-c\", \"cp -R \" + new File(buildDir, '../../../titus-api-definitions/src/main/proto/netflix')  + \" \" + new File(buildDir, \"extracted-protos/main\")", "originalCommit": "50079ff78ca45b8e9f53b98178f4a16178091073", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM1NjY1Mw==", "url": "https://github.com/Netflix/titus-control-plane/pull/840#discussion_r413356653", "bodyText": "I will try ant task. Copy does not work (gradle decides to skip the task).", "author": "tbak", "createdAt": "2020-04-22T21:48:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM1MzMxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM2MDc1OQ==", "url": "https://github.com/Netflix/titus-control-plane/pull/840#discussion_r413360759", "bodyText": "I am not getting any success with ant task as well.\nAnyway this property is only set in the local builds to use local version of titus-api-definitions. It is not used in the regular build process.", "author": "tbak", "createdAt": "2020-04-22T21:56:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM1MzMxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM2MTMyNQ==", "url": "https://github.com/Netflix/titus-control-plane/pull/840#discussion_r413361325", "bodyText": "Yeah, it was strange to me that you were shelling out instead of using the gradle task but I did not know the gradle task was the issue in the first place.", "author": "corindwyer", "createdAt": "2020-04-22T21:57:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM1MzMxOQ=="}], "type": "inlineReview"}]}