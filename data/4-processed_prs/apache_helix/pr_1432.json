{"pr_number": 1432, "pr_title": "Enhancement of ClusterVerifier and TaskDriver", "pr_createdAt": "2020-10-02T22:57:31Z", "pr_url": "https://github.com/apache/helix/pull/1432", "timeline": [{"oid": "c0024d059861e416bacaa637182372d29095e769", "url": "https://github.com/apache/helix/commit/c0024d059861e416bacaa637182372d29095e769", "message": "Ehancement of ClusterVerifier and TaskDriver #1431\n\nfix clusterVerifier to take waitTillVeriy and also enhance\nlogging of TaskDriver and TaskUtil to make sure the job\nadding and selective update race condition would have a\nlog", "committedDate": "2020-10-02T22:48:44Z", "type": "commit"}, {"oid": "e2c3f44fee0c6616331b268b800081e89969aa07", "url": "https://github.com/apache/helix/commit/e2c3f44fee0c6616331b268b800081e89969aa07", "message": "fix a space", "committedDate": "2020-10-02T23:53:45Z", "type": "commit"}, {"oid": "7a8a70c898322e1eee73e192b5a7af843ea7d9ae", "url": "https://github.com/apache/helix/commit/7a8a70c898322e1eee73e192b5a7af843ea7d9ae", "message": "add track issue #1245", "committedDate": "2020-10-03T02:39:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkzODM3NA==", "url": "https://github.com/apache/helix/pull/1432#discussion_r499938374", "bodyText": "Note that these constructors are deprecated and suggest to use builder. So you may also want to add this new parameter to the builder.", "author": "zhangmeng916", "createdAt": "2020-10-06T00:12:33Z", "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/BestPossibleExternalViewVerifier.java", "diffHunk": "@@ -78,8 +78,8 @@\n    */\n   @Deprecated\n   public BestPossibleExternalViewVerifier(String zkAddr, String clusterName, Set<String> resources,\n-      Map<String, Map<String, String>> errStates, Set<String> expectLiveInstances) {\n-    super(zkAddr, clusterName);\n+      Map<String, Map<String, String>> errStates, Set<String> expectLiveInstances, int waitTillVerify) {", "originalCommit": "7a8a70c898322e1eee73e192b5a7af843ea7d9ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk1MTAwNQ==", "url": "https://github.com/apache/helix/pull/1432#discussion_r499951005", "bodyText": "This is good point.\nIn fact, we already added them in the builder. See this pull, https://github.com/apache/helix/pull/1328/files\nThe thing is that in  pull 1328, we missed some places which is addressed in this pull.\nThe big pull #1227 validated that all missing ones are all addressed here. No more missing ones.", "author": "kaisun2000", "createdAt": "2020-10-06T01:03:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkzODM3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkzODU0NQ==", "url": "https://github.com/apache/helix/pull/1432#discussion_r499938545", "bodyText": "Could you please add some doc about the rationale of adding waiting time?", "author": "zhangmeng916", "createdAt": "2020-10-06T00:13:13Z", "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/BestPossibleExternalViewVerifier.java", "diffHunk": "@@ -78,8 +78,8 @@\n    */\n   @Deprecated\n   public BestPossibleExternalViewVerifier(String zkAddr, String clusterName, Set<String> resources,\n-      Map<String, Map<String, String>> errStates, Set<String> expectLiveInstances) {\n-    super(zkAddr, clusterName);\n+      Map<String, Map<String, String>> errStates, Set<String> expectLiveInstances, int waitTillVerify) {", "originalCommit": "7a8a70c898322e1eee73e192b5a7af843ea7d9ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk1MTA5MQ==", "url": "https://github.com/apache/helix/pull/1432#discussion_r499951091", "bodyText": "Good point, let me do it.", "author": "kaisun2000", "createdAt": "2020-10-06T01:03:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkzODU0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk1MzkxNw==", "url": "https://github.com/apache/helix/pull/1432#discussion_r499953917", "bodyText": "This is added.\n   /**\n     * The class of verify() methods in this class and its subclass such as \n     * BestPossibleExternalViewVerifier is intend to wait for the cluster converging to a stable \n     * state after changes in the cluster. However, after making changes, it would take some time\n     * till controller taking the changes in. Thus, if we verify() too early, before controller\n     * taking the changes, the class may mistake the previous stable cluster state as new (expected)\n     * stable state. This would cause various issues. Thus, we supply a waitPeriod before starting\n     * to validate next expected state to avoid this pre-mature stable state validation.\n     */\n    public B setWaitTillVerify(int waitPeriod) {\n      _waitPeriodTillVerify = waitPeriod;\n      return (B) this;\n    }", "author": "kaisun2000", "createdAt": "2020-10-06T01:14:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkzODU0NQ=="}], "type": "inlineReview"}, {"oid": "34cd67898b02cfc1d6afdf9f85dc6eeabb2b0fbd", "url": "https://github.com/apache/helix/commit/34cd67898b02cfc1d6afdf9f85dc6eeabb2b0fbd", "message": "address Meng's feedback.", "committedDate": "2020-10-06T01:15:18Z", "type": "commit"}]}