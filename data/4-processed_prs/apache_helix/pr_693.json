{"pr_number": 693, "pr_title": "Removed useless znodes to resolve dependency between test methods in TestZKUtil", "pr_createdAt": "2020-01-21T23:27:52Z", "pr_url": "https://github.com/apache/helix/pull/693", "timeline": [{"oid": "3976be5303b0eb14eb74b82cdd5cfe27ea589169", "url": "https://github.com/apache/helix/commit/3976be5303b0eb14eb74b82cdd5cfe27ea589169", "message": "Removed useless znodes to resolve dependency between test methods in TestZKUtil (apache#689)", "committedDate": "2020-01-21T23:57:03Z", "type": "forcePushed"}, {"oid": "d6835665556fd56a1f47791646c776ba1e34c894", "url": "https://github.com/apache/helix/commit/d6835665556fd56a1f47791646c776ba1e34c894", "message": "Removed useless znodes to resolve dependency between test methods in TestZKUtil (apache#689)", "committedDate": "2020-01-22T00:12:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMxNzMwMQ==", "url": "https://github.com/apache/helix/pull/693#discussion_r369317301", "bodyText": "Nit, this line is unnecessary. Style format file is updated in master branch. You may want to re-import the file in your Intellij so this line won't be formatted.", "author": "huizhilu", "createdAt": "2020-01-22T00:33:18Z", "path": "helix-core/src/test/java/org/apache/helix/manager/zk/TestZKUtil.java", "diffHunk": "@@ -37,13 +37,15 @@\n import org.testng.annotations.BeforeClass;\n import org.testng.annotations.Test;\n \n+\n public class TestZKUtil extends ZkUnitTestBase {\n   private static Logger LOG = LoggerFactory.getLogger(TestZKUtil.class);\n \n   String clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();\n \n   @BeforeClass()\n-  public void beforeClass() throws Exception {\n+  public void beforeClass()\n+      throws Exception {", "originalCommit": "d6835665556fd56a1f47791646c776ba1e34c894", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3b51688e6dfb39a3ce3b1bf60fdcdb1a1a9bf70d", "url": "https://github.com/apache/helix/commit/3b51688e6dfb39a3ce3b1bf60fdcdb1a1a9bf70d", "message": "Removed useless znodes to resolve dependency between test methods in TestZKUtil (apache#689)", "committedDate": "2020-01-22T00:42:58Z", "type": "commit"}, {"oid": "3b51688e6dfb39a3ce3b1bf60fdcdb1a1a9bf70d", "url": "https://github.com/apache/helix/commit/3b51688e6dfb39a3ce3b1bf60fdcdb1a1a9bf70d", "message": "Removed useless znodes to resolve dependency between test methods in TestZKUtil (apache#689)", "committedDate": "2020-01-22T00:42:58Z", "type": "forcePushed"}, {"oid": "9777873f68bc2bbb574d0970093a5a386b8a2b51", "url": "https://github.com/apache/helix/commit/9777873f68bc2bbb574d0970093a5a386b8a2b51", "message": "Remove created nodes after each test method (apache#689)", "committedDate": "2020-01-24T01:11:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ5NzI4NA==", "url": "https://github.com/apache/helix/pull/693#discussion_r370497284", "bodyText": "This is like delete and re-create the cluster, which I don't believe is a better way than deleting the path in the required methods.\nNot every method needs deleting. Ex. testIsClusterSetup.\nIn my opinion, if a method creates the path, it is the method's responsibility to clean up.", "author": "huizhilu", "createdAt": "2020-01-24T07:10:18Z", "path": "helix-core/src/test/java/org/apache/helix/manager/zk/TestZKUtil.java", "diffHunk": "@@ -63,6 +65,13 @@ public void afterClass() {\n     deleteCluster(clusterName);\n   }\n \n+  @AfterMethod()\n+  public void afterMethod() {\n+    String path = PropertyPathBuilder.instanceConfig(clusterName);\n+    _gZkClient.deleteRecursively(path);\n+    _gZkClient.createPersistent(path);", "originalCommit": "9777873f68bc2bbb574d0970093a5a386b8a2b51", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc4NDk1MA==", "url": "https://github.com/apache/helix/pull/693#discussion_r370784950", "bodyText": "I agree it can cause unnecessary delete operation calls such as in testIsClusterSetup, but it doesn't add too much latency since what it does is deleting the nodes, not recreating the cluster . It is also safer than leaving the clean up responsibility to each method, as it can make sure the cluster is clean for each test method. I think both way work and it's barely a trade off.", "author": "mgao0", "createdAt": "2020-01-24T18:45:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ5NzI4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc4OTY0Mg==", "url": "https://github.com/apache/helix/pull/693#discussion_r370789642", "bodyText": "I checked the test cases one by one, there is no test which is testing to create the root path (please correct me if I am wrong). Given so, re-create the root path is easier and safer.\nIf we really have a case that requires the root path non-exists, feel free to change that test.", "author": "jiajunwang", "createdAt": "2020-01-24T18:55:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ5NzI4NA=="}], "type": "inlineReview"}]}