{"pr_number": 1089, "pr_title": "Implement getStat in ZookeeperAccessor", "pr_createdAt": "2020-06-12T03:53:38Z", "pr_url": "https://github.com/apache/helix/pull/1089", "timeline": [{"oid": "9fa37ab5ed6b896a9654e806db22cc1250ae2985", "url": "https://github.com/apache/helix/commit/9fa37ab5ed6b896a9654e806db22cc1250ae2985", "message": "Implement getStat in ZookeeperAccessor", "committedDate": "2020-06-12T03:48:27Z", "type": "commit"}, {"oid": "5f06e1108ee8d641fc59d4f85b4b84b52a413481", "url": "https://github.com/apache/helix/commit/5f06e1108ee8d641fc59d4f85b4b84b52a413481", "message": "sadf", "committedDate": "2020-06-12T03:54:23Z", "type": "commit"}, {"oid": "8583f8275afe90e7a2b27a45cafa3311f57ac6ec", "url": "https://github.com/apache/helix/commit/8583f8275afe90e7a2b27a45cafa3311f57ac6ec", "message": "adsf", "committedDate": "2020-06-12T03:56:07Z", "type": "commit"}, {"oid": "54d4950b029837a9b85c00442ecc3fc3b916586c", "url": "https://github.com/apache/helix/commit/54d4950b029837a9b85c00442ecc3fc3b916586c", "message": "add stat by default", "committedDate": "2020-06-12T06:13:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY0NzU2Ng==", "url": "https://github.com/apache/helix/pull/1089#discussion_r439647566", "bodyText": "You might want to checkout this method of the Zookeeper Stat class, simply implement an OutputArchive to avoid hardcode getting fields here.\npublic void serialize(OutputArchive a_, String tag) throws java.io.IOException {\na_.startRecord(this,tag);\na_.writeLong(czxid,\"czxid\");\na_.writeLong(mzxid,\"mzxid\");\na_.writeLong(ctime,\"ctime\");\na_.writeLong(mtime,\"mtime\");\na_.writeInt(version,\"version\");\na_.writeInt(cversion,\"cversion\");\na_.writeInt(aversion,\"aversion\");\na_.writeLong(ephemeralOwner,\"ephemeralOwner\");\na_.writeInt(dataLength,\"dataLength\");\na_.writeInt(numChildren,\"numChildren\");\na_.writeLong(pzxid,\"pzxid\");\na_.endRecord(this,tag);\n}", "author": "jiajunwang", "createdAt": "2020-06-12T21:22:06Z", "path": "helix-core/src/main/java/org/apache/helix/manager/zk/ZKUtil.java", "diffHunk": "@@ -632,4 +634,39 @@ private static RealmAwareZkClient getHelixZkClient(String zkAddr) {\n     return DedicatedZkClientFactory.getInstance()\n         .buildZkClient(new HelixZkClient.ZkConnectionConfig(zkAddr), clientConfig);\n   }\n+\n+  /**\n+   * Convert Stat fields into a Map.\n+   *     private long czxid;\n+   *     private long mzxid;\n+   *     private long ctime;\n+   *     private long mtime;\n+   *     private int version;\n+   *     private int cversion;\n+   *     private int aversion;\n+   *     private long ephemeralOwner;\n+   *     private int dataLength;\n+   *     private int numChildren;\n+   *     private long pzxid;\n+   * @param stat\n+   * @return\n+   */\n+  public static Map<String, String> fromStatToMap(Stat stat) {", "originalCommit": "54d4950b029837a9b85c00442ecc3fc3b916586c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY1NzM4Ng==", "url": "https://github.com/apache/helix/pull/1089#discussion_r439657386", "bodyText": "@jiajunwang I already did consider this option, but OutputArchive/serialize is used for different purposes (for real serialization to an output buffer of sort). This requires more code and adds complexity/dependency on apache.jute which we don't simply need.\nAt the end of the day, the Stat function is also hardcoding it, and I'm not worried about Stat arbitrarily changing internal fields moving forward.", "author": "narendly", "createdAt": "2020-06-12T21:53:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY0NzU2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MjA2MA==", "url": "https://github.com/apache/helix/pull/1089#discussion_r439662060", "bodyText": "Agreed. Great that you checked that option already.", "author": "jiajunwang", "createdAt": "2020-06-12T22:11:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY0NzU2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY0OTE5Mw==", "url": "https://github.com/apache/helix/pull/1089#discussion_r439649193", "bodyText": "I think getStat return null if the path does not exist. So you don't need to call exists before this line.", "author": "jiajunwang", "createdAt": "2020-06-12T21:27:12Z", "path": "helix-rest/src/main/java/org/apache/helix/rest/server/resources/zookeeper/ZooKeeperAccessor.java", "diffHunk": "@@ -165,6 +179,24 @@ private Response getChildren(BaseDataAccessor<byte[]> zkBaseDataAccessor, String\n     }\n   }\n \n+  /**\n+   * Returns the ZNode Stat object given the path.\n+   * @param zkBaseDataAccessor\n+   * @param path\n+   * @return\n+   */\n+  private Response getStat(BaseDataAccessor<byte[]> zkBaseDataAccessor, String path) {\n+    if (zkBaseDataAccessor.exists(path, AccessOption.PERSISTENT)) {\n+      Stat stat = zkBaseDataAccessor.getStat(path, AccessOption.PERSISTENT);", "originalCommit": "54d4950b029837a9b85c00442ecc3fc3b916586c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MDMwOA==", "url": "https://github.com/apache/helix/pull/1089#discussion_r439660308", "bodyText": "Changed", "author": "narendly", "createdAt": "2020-06-12T22:04:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY0OTE5Mw=="}], "type": "inlineReview"}, {"oid": "e7d2e5fb40e803aa0c52521bb0e2b31f899f18c1", "url": "https://github.com/apache/helix/commit/e7d2e5fb40e803aa0c52521bb0e2b31f899f18c1", "message": "address comments", "committedDate": "2020-06-12T22:04:09Z", "type": "commit"}]}