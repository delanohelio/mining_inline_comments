{"pr_number": 1061, "pr_title": "Remove previousAssignment from FixedTargetTaskAssignmentCalculator", "pr_createdAt": "2020-06-04T20:38:59Z", "pr_url": "https://github.com/apache/helix/pull/1061", "timeline": [{"oid": "0726f33fd1c6d289b1cb6d7e5abc5b0e52bf6d98", "url": "https://github.com/apache/helix/commit/0726f33fd1c6d289b1cb6d7e5abc5b0e52bf6d98", "message": "Remove previousAssignment from FixedTargetTaskAssignmentCalculator\n\nThe FixedTargetTaskAssignmentCalculator class is relying on the previousAssignment.\nIn this commit, this method has been modified and previousAssignment has been\nreplaced with the context information.", "committedDate": "2020-06-04T18:29:09Z", "type": "commit"}, {"oid": "9745afe38eb76ab01bfb551660a918ca14939bc1", "url": "https://github.com/apache/helix/commit/9745afe38eb76ab01bfb551660a918ca14939bc1", "message": "minor fix", "committedDate": "2020-06-06T17:32:28Z", "type": "commit"}, {"oid": "9745afe38eb76ab01bfb551660a918ca14939bc1", "url": "https://github.com/apache/helix/commit/9745afe38eb76ab01bfb551660a918ca14939bc1", "message": "minor fix", "committedDate": "2020-06-06T17:32:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYyMTA1Mw==", "url": "https://github.com/apache/helix/pull/1061#discussion_r437621053", "bodyText": "I dont think any one is using this class. Shall we remove it? Or at least, let's deprecate the class instead of changing the public API for backward incompatible change.", "author": "junkaixue", "createdAt": "2020-06-09T18:06:08Z", "path": "helix-core/src/main/java/org/apache/helix/task/DeprecatedTaskRebalancer.java", "diffHunk": "@@ -110,10 +109,9 @@\n    * @return map of instances to set of partition numbers\n    */", "originalCommit": "9745afe38eb76ab01bfb551660a918ca14939bc1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY3MTk4Ng==", "url": "https://github.com/apache/helix/pull/1061#discussion_r437671986", "bodyText": "Removed.", "author": "alirezazamani", "createdAt": "2020-06-09T19:38:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYyMTA1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYyMTQ1Ng==", "url": "https://github.com/apache/helix/pull/1061#discussion_r437621456", "bodyText": "So it may not be safe to change public API directly. My suggestion is to deprecate the method and create a new one if necessary.\nThis deprecated function can call the new function.", "author": "junkaixue", "createdAt": "2020-06-09T18:06:52Z", "path": "helix-core/src/main/java/org/apache/helix/task/FixedTargetTaskAssignmentCalculator.java", "diffHunk": "@@ -78,11 +78,11 @@ public FixedTargetTaskAssignmentCalculator(AssignableInstanceManager assignableI\n \n   @Override\n   public Map<String, SortedSet<Integer>> getTaskAssignment(CurrentStateOutput currStateOutput,", "originalCommit": "9745afe38eb76ab01bfb551660a918ca14939bc1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY4Mzk1Ng==", "url": "https://github.com/apache/helix/pull/1061#discussion_r437683956", "bodyText": "Done.", "author": "alirezazamani", "createdAt": "2020-06-09T20:00:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYyMTQ1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYyNDI0Ng==", "url": "https://github.com/apache/helix/pull/1061#discussion_r437624246", "bodyText": "Same here. Shall we remove this class?", "author": "junkaixue", "createdAt": "2020-06-09T18:11:42Z", "path": "helix-core/src/main/java/org/apache/helix/task/FixedTargetTaskRebalancer.java", "diffHunk": "@@ -48,13 +48,11 @@\n   }", "originalCommit": "9745afe38eb76ab01bfb551660a918ca14939bc1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY3NDU4MQ==", "url": "https://github.com/apache/helix/pull/1061#discussion_r437674581", "bodyText": "Removed.", "author": "alirezazamani", "createdAt": "2020-06-09T19:42:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYyNDI0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYyNDYxNg==", "url": "https://github.com/apache/helix/pull/1061#discussion_r437624616", "bodyText": "Better not change public API, we can deprecate it and add a new one.", "author": "junkaixue", "createdAt": "2020-06-09T18:12:23Z", "path": "helix-core/src/main/java/org/apache/helix/task/GenericTaskAssignmentCalculator.java", "diffHunk": "@@ -65,9 +65,9 @@\n \n   @Override\n   public Map<String, SortedSet<Integer>> getTaskAssignment(CurrentStateOutput currStateOutput,\n-      ResourceAssignment prevAssignment, Collection<String> instances, JobConfig jobCfg,\n-      final JobContext jobContext, WorkflowConfig workflowCfg, WorkflowContext workflowCtx,\n-      Set<Integer> partitionSet, Map<String, IdealState> idealStateMap) {\n+      Collection<String> instances, JobConfig jobCfg, final JobContext jobContext,", "originalCommit": "9745afe38eb76ab01bfb551660a918ca14939bc1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY4NDA1MA==", "url": "https://github.com/apache/helix/pull/1061#discussion_r437684050", "bodyText": "Done.", "author": "alirezazamani", "createdAt": "2020-06-09T20:00:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYyNDYxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYyNDg4OQ==", "url": "https://github.com/apache/helix/pull/1061#discussion_r437624889", "bodyText": "Same here. Shall we remove the rebalancer related class. Or, at least, deprecate it.", "author": "junkaixue", "createdAt": "2020-06-09T18:12:50Z", "path": "helix-core/src/main/java/org/apache/helix/task/GenericTaskRebalancer.java", "diffHunk": "@@ -40,18 +40,18 @@\n \n   @Override\n   public Set<Integer> getAllTaskPartitions(JobConfig jobCfg, JobContext jobCtx,\n-      WorkflowConfig workflowCfg, WorkflowContext workflowCtx, WorkflowControllerDataProvider cache) {\n-    return taskAssignmentCalculator\n-        .getAllTaskPartitions(jobCfg, jobCtx, workflowCfg, workflowCtx, cache.getIdealStates());\n+      WorkflowConfig workflowCfg, WorkflowContext workflowCtx,", "originalCommit": "9745afe38eb76ab01bfb551660a918ca14939bc1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY3NDc4MA==", "url": "https://github.com/apache/helix/pull/1061#discussion_r437674780", "bodyText": "Removed.", "author": "alirezazamani", "createdAt": "2020-06-09T19:43:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYyNDg4OQ=="}], "type": "inlineReview"}, {"oid": "7d2d65092e5719578cb1845b30ad17c45b163035", "url": "https://github.com/apache/helix/commit/7d2d65092e5719578cb1845b30ad17c45b163035", "message": "Address comments", "committedDate": "2020-06-09T20:04:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY5MTA3OA==", "url": "https://github.com/apache/helix/pull/1061#discussion_r437691078", "bodyText": "Would this break backward compatibility for existing long-running TF resources?", "author": "narendly", "createdAt": "2020-06-09T20:14:24Z", "path": "helix-core/src/main/java/org/apache/helix/model/IdealState.java", "diffHunk": "@@ -721,9 +719,7 @@ private RebalanceMode normalizeRebalanceMode(IdealStateModeProperty mode) {\n       String rebalancerName = getRebalancerClassName();\n       if (rebalancerName != null) {\n         if (rebalancerName.equals(JobRebalancer.class.getName())\n-            || rebalancerName.equals(WorkflowRebalancer.class.getName())\n-            || rebalancerName.equals(GenericTaskRebalancer.class.getName())\n-            || rebalancerName.equals(FixedTargetTaskRebalancer.class.getName())) {\n+            || rebalancerName.equals(WorkflowRebalancer.class.getName())) {", "originalCommit": "7d2d65092e5719578cb1845b30ad17c45b163035", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY5NTM2Mg==", "url": "https://github.com/apache/helix/pull/1061#discussion_r437695362", "bodyText": "I think we are safe because the remove ones have been deprecated around 4 years ago. Perhaps it is time to do some cleaning for TF code base.", "author": "alirezazamani", "createdAt": "2020-06-09T20:22:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY5MTA3OA=="}], "type": "inlineReview"}, {"oid": "9d5b0201489247516a09b2cf8958e0036ff6676b", "url": "https://github.com/apache/helix/commit/9d5b0201489247516a09b2cf8958e0036ff6676b", "message": "log added for legacy rebalancers", "committedDate": "2020-06-10T18:13:11Z", "type": "commit"}, {"oid": "9d5b0201489247516a09b2cf8958e0036ff6676b", "url": "https://github.com/apache/helix/commit/9d5b0201489247516a09b2cf8958e0036ff6676b", "message": "log added for legacy rebalancers", "committedDate": "2020-06-10T18:13:11Z", "type": "forcePushed"}, {"oid": "ae1e40e76a83421ae8b3ffe08d15a9a4537dee51", "url": "https://github.com/apache/helix/commit/ae1e40e76a83421ae8b3ffe08d15a9a4537dee51", "message": "minor change", "committedDate": "2020-06-10T18:23:00Z", "type": "commit"}]}