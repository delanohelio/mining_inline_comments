{"pr_number": 959, "pr_title": "Fix Regression on Flaky Tests in TestResourceAccessor", "pr_createdAt": "2020-04-20T20:45:48Z", "pr_url": "https://github.com/apache/helix/pull/959", "timeline": [{"oid": "3440a1e6ba0d0f81bbfb4ff1ef069aa1e10f5bd7", "url": "https://github.com/apache/helix/commit/3440a1e6ba0d0f81bbfb4ff1ef069aa1e10f5bd7", "message": "Stabilize flaky ResourceAccessor tests", "committedDate": "2020-04-17T19:40:52Z", "type": "commit"}, {"oid": "5751b4d9461a20e75abe523dbe4de7dafae37b38", "url": "https://github.com/apache/helix/commit/5751b4d9461a20e75abe523dbe4de7dafae37b38", "message": "Clean up code", "committedDate": "2020-04-20T18:47:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY4NzM5Mw==", "url": "https://github.com/apache/helix/pull/959#discussion_r411687393", "bodyText": "Why do you need to create a HelixAdmin object every time this is called? Also, why do you need to wrap this into a private method especially when the function signatures are exactly the same?", "author": "narendly", "createdAt": "2020-04-20T20:58:07Z", "path": "helix-rest/src/test/java/org/apache/helix/rest/server/TestResourceAccessor.java", "diffHunk": "@@ -657,19 +660,9 @@ private void createDummyMapping(String clusterName, String resourceName,\n     System.out.println(\"End test :\" + TestHelper.getTestMethodName());\n   }\n \n-  private void stopClustersControllers() {\n-    for (ClusterControllerManager cm : _clusterControllerManagers) {\n-      if (cm != null && cm.isConnected()) {\n-        cm.syncStop();\n-      }\n-    }\n+  private void enableCluster(String clusterName, boolean enable) {\n+    HelixAdmin helixAdmin = new ZKHelixAdmin(_gZkClient);\n+    helixAdmin.enableCluster(clusterName, enable);", "originalCommit": "5751b4d9461a20e75abe523dbe4de7dafae37b38", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY4ODc0OQ==", "url": "https://github.com/apache/helix/pull/959#discussion_r411688749", "bodyText": "Also, don't we already have a HelixAdmin in the parent abstract class created with _gZkClient already?", "author": "narendly", "createdAt": "2020-04-20T21:00:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY4NzM5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY5MjI5Mw==", "url": "https://github.com/apache/helix/pull/959#discussion_r411692293", "bodyText": "+1. I believe _gSetupTool.getClusterManagementTool() gives you helix admin and this function enableCluster(). So _gSetupTool.getClusterManagementTool().enableCluster() is one line you need. This private method may not be needed.", "author": "huizhilu", "createdAt": "2020-04-20T21:06:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY4NzM5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTczNDIxNA==", "url": "https://github.com/apache/helix/pull/959#discussion_r411734214", "bodyText": "Wasn't able to find HelixAdmin in the parent class, but @pkuwm is correct. Thank you for the pointers and updated accordingly!", "author": "NealSun96", "createdAt": "2020-04-20T22:28:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY4NzM5Mw=="}], "type": "inlineReview"}, {"oid": "b15e7d34c2228974b36dfce47bfa582211dacad0", "url": "https://github.com/apache/helix/commit/b15e7d34c2228974b36dfce47bfa582211dacad0", "message": "Use HelixAdmin from gSetupTool", "committedDate": "2020-04-20T22:22:25Z", "type": "commit"}, {"oid": "e79cb1f243257015f5cdce135e27e596a5e9ba1b", "url": "https://github.com/apache/helix/commit/e79cb1f243257015f5cdce135e27e596a5e9ba1b", "message": "remove unnecessary imports", "committedDate": "2020-04-20T22:29:10Z", "type": "commit"}]}