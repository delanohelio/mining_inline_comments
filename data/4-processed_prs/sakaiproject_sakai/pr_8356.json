{"pr_number": 8356, "pr_title": "SAK-43564: Samigo hotspot answer is correct but grade is 0 with \"Don't allow partial credit\"", "pr_createdAt": "2020-07-13T08:16:35Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/8356", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE0ODczMw==", "url": "https://github.com/sakaiproject/sakai/pull/8356#discussion_r458148733", "bodyText": "I know this was n't added by you but this number looks strange?", "author": "ern", "createdAt": "2020-07-21T14:38:35Z", "path": "samigo/samigo-services/src/java/org/sakaiproject/tool/assessment/services/GradingService.java", "diffHunk": "@@ -1003,9 +1030,19 @@ public int compare(ItemGradingData o1, ItemGradingData o2) {\n         \t\t}\n         \t}\n         }\n-        if ((TypeIfc.IMAGEMAP_QUESTION.equals(itemType))&&(NeededAllOk)&&((autoScore==-123456789)||!imageMapAllOk)){\n-        \tautoScore=0;\n-        \timageMapAllOk=false;\n+        \n+        if (TypeIfc.IMAGEMAP_QUESTION.equals(itemType) && neededAllOk){\n+        \tif(!imageMapAlreadyOk) {\n+        \t\tautoScore = 0;\n+        \t}else if(autoScore == -123456789){", "originalCommit": "7a436ffee702e9003da5a8d1e67d0ff09f0b5543", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI4MzI0Nw==", "url": "https://github.com/sakaiproject/sakai/pull/8356#discussion_r459283247", "bodyText": "it's just like a mark that we need all right answers and the actual answer is not right. I replaced it by a constant now.", "author": "feralvarez95", "createdAt": "2020-07-23T08:13:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE0ODczMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE1MDA1OQ==", "url": "https://github.com/sakaiproject/sakai/pull/8356#discussion_r458150059", "bodyText": "Update this with a newer style loop (for, foreach, lambda)", "author": "ern", "createdAt": "2020-07-21T14:40:15Z", "path": "samigo/samigo-services/src/java/org/sakaiproject/tool/assessment/services/GradingService.java", "diffHunk": "@@ -3391,6 +3428,26 @@ private boolean isCalcQuestion(List tempItemGradinglist, Map publishedItemHash)\n \t  }\n \t  return false;\n   }\n+  \n+  /**\n+   * IMAGE_MAP QUESTION\n+   * Simple to check to see if this is a calculated question. It's used in storeGrades() to see if the sort is necessary.\n+   */\n+  private boolean isImageMapQuestion(List tempItemGradinglist, Map publishedItemHash) {\n+\t  if (tempItemGradinglist == null) return false;\n+\t  if (tempItemGradinglist.isEmpty()) return false;\n+\t  \n+\t  Iterator iter = tempItemGradinglist.iterator();\n+\t  while(iter.hasNext()){", "originalCommit": "7a436ffee702e9003da5a8d1e67d0ff09f0b5543", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMwNjk0MA==", "url": "https://github.com/sakaiproject/sakai/pull/8356#discussion_r459306940", "bodyText": "done!", "author": "feralvarez95", "createdAt": "2020-07-23T08:56:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE1MDA1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE1MzcxMg==", "url": "https://github.com/sakaiproject/sakai/pull/8356#discussion_r458153712", "bodyText": "It would be ideal to externalize this comparator so that in can be unit tested.\nAlso see springs NullSafeComparator or use java's newer lambda comparator which deals with nulls in a better way either is fine.\nExample org.sakaiproject.util.comparator.UserSortNameComparator or https://www.baeldung.com/java-8-comparator-comparing", "author": "ern", "createdAt": "2020-07-21T14:44:53Z", "path": "samigo/samigo-services/src/java/org/sakaiproject/tool/assessment/services/GradingService.java", "diffHunk": "@@ -912,6 +909,23 @@ public int compare(ItemGradingData o1, ItemGradingData o2) {\n \t      });\n       }\n       \n+    //IMAGEMAP_QUESTION - order by itemGradingId if it is an imageMap question\n+      if (isImageMapQuestion(tempItemGradinglist, publishedItemHash)) {\n+\t      Collections.sort(tempItemGradinglist, new Comparator<ItemGradingData>(){\n+\t    \t  public int compare(ItemGradingData o1, ItemGradingData o2) {", "originalCommit": "7a436ffee702e9003da5a8d1e67d0ff09f0b5543", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMxMTQzOA==", "url": "https://github.com/sakaiproject/sakai/pull/8356#discussion_r459311438", "bodyText": "I created a class, but we need compare Longs, so I just moved it to a file. How do you see it?", "author": "feralvarez95", "createdAt": "2020-07-23T09:04:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE1MzcxMg=="}], "type": "inlineReview"}, {"oid": "956e0bf47e802ea60b0fc4bcf6e987f5ecce971c", "url": "https://github.com/sakaiproject/sakai/commit/956e0bf47e802ea60b0fc4bcf6e987f5ecce971c", "message": "SAK-43564: Samigo hotspot answer is correct but grade is 0 with 'Don't allow partial credit'", "committedDate": "2020-07-23T08:02:42Z", "type": "forcePushed"}, {"oid": "e508149507b33b62bc5d03ae2779aad0a766721c", "url": "https://github.com/sakaiproject/sakai/commit/e508149507b33b62bc5d03ae2779aad0a766721c", "message": "SAK-43564: Samigo hotspot answer is correct but grade is 0 with 'Don't allow partial credit'", "committedDate": "2020-07-23T08:12:07Z", "type": "forcePushed"}, {"oid": "1c3ce1cb5c3f98aa5530cfac88815aadf1be8fe8", "url": "https://github.com/sakaiproject/sakai/commit/1c3ce1cb5c3f98aa5530cfac88815aadf1be8fe8", "message": "SAK-43564: Samigo hotspot answer is correct but grade is 0 with 'Don't allow partial credit'", "committedDate": "2020-07-23T08:14:44Z", "type": "forcePushed"}, {"oid": "3eee35d8fb7edc4aeeb8ef84102678589ea17ca2", "url": "https://github.com/sakaiproject/sakai/commit/3eee35d8fb7edc4aeeb8ef84102678589ea17ca2", "message": "SAK-43564: Samigo hotspot answer is correct but grade is 0 with 'Don't allow partial credit'", "committedDate": "2020-07-23T09:15:52Z", "type": "forcePushed"}, {"oid": "8068aab78e2b3e3b2bf9e0c33d361e46c2685b40", "url": "https://github.com/sakaiproject/sakai/commit/8068aab78e2b3e3b2bf9e0c33d361e46c2685b40", "message": "SAK-43564: Samigo hotspot answer is correct but grade is 0 with 'Don't allow partial credit'", "committedDate": "2020-07-23T09:19:30Z", "type": "forcePushed"}, {"oid": "c3af5bb3257ac42ff58da049fdff914af9ff4aed", "url": "https://github.com/sakaiproject/sakai/commit/c3af5bb3257ac42ff58da049fdff914af9ff4aed", "message": "SAK-43564: Samigo hotspot answer is correct but grade is 0 with 'Don't allow partial credit'", "committedDate": "2020-07-23T11:13:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc1MDQ1MA==", "url": "https://github.com/sakaiproject/sakai/pull/8356#discussion_r483750450", "bodyText": "This comparator should have a unit test and I would also look at using:\norg.springframework.util.comparator.NullSafeComparator\nas it's accounts for nulls already.", "author": "ern", "createdAt": "2020-09-04T17:05:15Z", "path": "samigo/samigo-services/src/java/org/sakaiproject/tool/assessment/util/comparator/ImageMapGradingItemComparator.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package org.sakaiproject.tool.assessment.util.comparator;\r\n+\r\n+import java.util.Comparator;\r\n+import org.sakaiproject.tool.assessment.data.dao.grading.ItemGradingData;\r\n+\r\n+/**\r\n+ * This sorts ItemGrading items by itemGradingId.\r\n+ */\r\n+\r\n+public class ImageMapGradingItemComparator implements Comparator<ItemGradingData> {\r", "originalCommit": "c3af5bb3257ac42ff58da049fdff914af9ff4aed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE2NjQ0Ng==", "url": "https://github.com/sakaiproject/sakai/pull/8356#discussion_r486166446", "bodyText": "Done!", "author": "feralvarez95", "createdAt": "2020-09-10T08:39:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc1MDQ1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTk2Mzk3OA==", "url": "https://github.com/sakaiproject/sakai/pull/8356#discussion_r491963978", "bodyText": "@ern All changes has been done. Please merge", "author": "jesusmmp", "createdAt": "2020-09-21T11:18:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc1MDQ1MA=="}], "type": "inlineReview"}, {"oid": "c0fdd94653c359181b4ca52715c25be1f38527be", "url": "https://github.com/sakaiproject/sakai/commit/c0fdd94653c359181b4ca52715c25be1f38527be", "message": "SAK-43564: Samigo hotspot answer is correct but grade is 0 with 'Don't allow partial credit'", "committedDate": "2020-09-10T07:48:32Z", "type": "forcePushed"}, {"oid": "208747511a10a6b0930b867c361829bc815ea9f9", "url": "https://github.com/sakaiproject/sakai/commit/208747511a10a6b0930b867c361829bc815ea9f9", "message": "SAK-43564: Samigo hotspot answer is correct but grade is 0 with 'Don't allow partial credit'", "committedDate": "2020-09-23T08:59:22Z", "type": "commit"}, {"oid": "208747511a10a6b0930b867c361829bc815ea9f9", "url": "https://github.com/sakaiproject/sakai/commit/208747511a10a6b0930b867c361829bc815ea9f9", "message": "SAK-43564: Samigo hotspot answer is correct but grade is 0 with 'Don't allow partial credit'", "committedDate": "2020-09-23T08:59:22Z", "type": "forcePushed"}]}