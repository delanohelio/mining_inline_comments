{"pr_number": 8171, "pr_title": "SAK-43502 Recover focus after updating cells and avoid data lose afte\u2026", "pr_createdAt": "2020-04-22T12:28:46Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/8171", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjkzNzc2OA==", "url": "https://github.com/sakaiproject/sakai/pull/8171#discussion_r412937768", "bodyText": "Looks like there's a label missing for this input. That makes it hard for people using screen readers or voice control to use the input.", "author": "accesslint", "createdAt": "2020-04-22T12:28:53Z", "path": "gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SettingsGradingSchemaPanel.html", "diffHunk": "@@ -42,8 +42,8 @@ <h3 class=\"panel-title\">\n \t\t\t\t\t\t\t\t\t</thead>\n \t\t\t\t\t\t\t\t\t<tbody>\n \t\t\t\t\t\t\t\t\t<tr wicket:id=\"schemaView\" class=\"gb-schema-row\">\n-\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"grade\" type=\"text\" size=\"10\" class=\"form-control\" /></td>\n-\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"minPercent\" type=\"text\" size=\"10\" class=\"form-control\" /></td>\n+\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"grade\" type=\"text\" size=\"10\" class=\"form-control schema-input\" /></td>", "originalCommit": "a46b5f4e2c812fadf25ade2dea5d820884d0f551", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjkzNzc3MA==", "url": "https://github.com/sakaiproject/sakai/pull/8171#discussion_r412937770", "bodyText": "Looks like there's a label missing for this input. That makes it hard for people using screen readers or voice control to use the input.", "author": "accesslint", "createdAt": "2020-04-22T12:28:54Z", "path": "gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SettingsGradingSchemaPanel.html", "diffHunk": "@@ -42,8 +42,8 @@ <h3 class=\"panel-title\">\n \t\t\t\t\t\t\t\t\t</thead>\n \t\t\t\t\t\t\t\t\t<tbody>\n \t\t\t\t\t\t\t\t\t<tr wicket:id=\"schemaView\" class=\"gb-schema-row\">\n-\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"grade\" type=\"text\" size=\"10\" class=\"form-control\" /></td>\n-\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"minPercent\" type=\"text\" size=\"10\" class=\"form-control\" /></td>\n+\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"grade\" type=\"text\" size=\"10\" class=\"form-control schema-input\" /></td>\n+\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"minPercent\" type=\"text\" size=\"10\" class=\"form-control schema-input\" /></td>", "originalCommit": "a46b5f4e2c812fadf25ade2dea5d820884d0f551", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1261a15032bfc7bc7dba45067003e22d883f05c6", "url": "https://github.com/sakaiproject/sakai/commit/1261a15032bfc7bc7dba45067003e22d883f05c6", "message": "SAK-43502 Recover focus after updating cells and avoid data lose after adding a new category", "committedDate": "2020-04-23T12:09:32Z", "type": "commit"}, {"oid": "1261a15032bfc7bc7dba45067003e22d883f05c6", "url": "https://github.com/sakaiproject/sakai/commit/1261a15032bfc7bc7dba45067003e22d883f05c6", "message": "SAK-43502 Recover focus after updating cells and avoid data lose after adding a new category", "committedDate": "2020-04-23T12:09:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYxMTg0MQ==", "url": "https://github.com/sakaiproject/sakai/pull/8171#discussion_r416611841", "bodyText": "I'd put an aria-label on this.", "author": "adrianfish", "createdAt": "2020-04-28T13:27:33Z", "path": "gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SettingsGradingSchemaPanel.html", "diffHunk": "@@ -42,8 +42,8 @@ <h3 class=\"panel-title\">\n \t\t\t\t\t\t\t\t\t</thead>\n \t\t\t\t\t\t\t\t\t<tbody>\n \t\t\t\t\t\t\t\t\t<tr wicket:id=\"schemaView\" class=\"gb-schema-row\">\n-\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"grade\" type=\"text\" size=\"10\" class=\"form-control\" /></td>\n-\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"minPercent\" type=\"text\" size=\"10\" class=\"form-control\" /></td>\n+\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"grade\" type=\"text\" size=\"10\" class=\"form-control schema-input\" /></td>", "originalCommit": "1261a15032bfc7bc7dba45067003e22d883f05c6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyNTU1OA==", "url": "https://github.com/sakaiproject/sakai/pull/8171#discussion_r416625558", "bodyText": "I'd just use vanillajs here. jQuery seems like overkill\nif (document.activeElement.classList.contains(\"schema-input\")) {\nsakai.gradebookng.settings.gradingschemas.cellName = document.activeElement.getAttribute('name');\n}", "author": "adrianfish", "createdAt": "2020-04-28T13:45:39Z", "path": "gradebookng/tool/src/webapp/scripts/gradebook-settings.js", "diffHunk": "@@ -100,6 +108,23 @@ GradebookGradingSchemaSettings.prototype.focusLastRow = function() {\n   Wicket.Focus.setFocusOnId($input.attr(\"id\"));\n }\n \n+GradebookGradingSchemaSettings.prototype.getFocusedCell = function() {\n+  var $activeElement = $(document.activeElement);", "originalCommit": "1261a15032bfc7bc7dba45067003e22d883f05c6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYzMDEyNg==", "url": "https://github.com/sakaiproject/sakai/pull/8171#discussion_r416630126", "bodyText": "This seems an expensive lookup. It looks like it will scan the entire dom for this attribute and that can be a lot of markup in gbng. I'd anchor the search using an id from an ancestor. Lot faster.", "author": "adrianfish", "createdAt": "2020-04-28T13:51:32Z", "path": "gradebookng/tool/src/webapp/scripts/gradebook-settings.js", "diffHunk": "@@ -100,6 +108,23 @@ GradebookGradingSchemaSettings.prototype.focusLastRow = function() {\n   Wicket.Focus.setFocusOnId($input.attr(\"id\"));\n }\n \n+GradebookGradingSchemaSettings.prototype.getFocusedCell = function() {\n+  var $activeElement = $(document.activeElement);\n+  if ($activeElement.hasClass('schema-input')) {\n+    sakai.gradebookng.settings.gradingschemas.cellName = $activeElement.attr('name');\n+  }\n+}\n+\n+GradebookGradingSchemaSettings.prototype.focusPreviousCell = function() {\n+  // This is a trick to focus the previous focused cell after table re-render\n+  var cellName = sakai.gradebookng.settings.gradingschemas.cellName;\n+  var $inputSameName = $('[name=\"' + cellName + '\"]');", "originalCommit": "1261a15032bfc7bc7dba45067003e22d883f05c6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYzMjQxMA==", "url": "https://github.com/sakaiproject/sakai/pull/8171#discussion_r416632410", "bodyText": "Generally, I'd use vanillajs here. You can use querySelectorAll and forEach on the results of that.", "author": "adrianfish", "createdAt": "2020-04-28T13:54:28Z", "path": "gradebookng/tool/src/webapp/scripts/gradebook-settings.js", "diffHunk": "@@ -100,6 +108,23 @@ GradebookGradingSchemaSettings.prototype.focusLastRow = function() {\n   Wicket.Focus.setFocusOnId($input.attr(\"id\"));\n }\n \n+GradebookGradingSchemaSettings.prototype.getFocusedCell = function() {\n+  var $activeElement = $(document.activeElement);\n+  if ($activeElement.hasClass('schema-input')) {\n+    sakai.gradebookng.settings.gradingschemas.cellName = $activeElement.attr('name');\n+  }\n+}\n+\n+GradebookGradingSchemaSettings.prototype.focusPreviousCell = function() {\n+  // This is a trick to focus the previous focused cell after table re-render\n+  var cellName = sakai.gradebookng.settings.gradingschemas.cellName;\n+  var $inputSameName = $('[name=\"' + cellName + '\"]');\n+  if ($inputSameName.length > 0) {\n+    $inputSameName.focus();", "originalCommit": "1261a15032bfc7bc7dba45067003e22d883f05c6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8f2727289c90e2a062679539d2f87d29eb8443bd", "url": "https://github.com/sakaiproject/sakai/commit/8f2727289c90e2a062679539d2f87d29eb8443bd", "message": "Moved from jQuery to vanillajs.\n\nTightened up schema cell selector", "committedDate": "2020-08-31T15:53:46Z", "type": "commit"}]}