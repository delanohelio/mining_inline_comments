{"pr_number": 8817, "pr_title": "SAK-44562 library / portal - ckeditor support dark theme", "pr_createdAt": "2020-11-17T15:32:07Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/8817", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxMTExMQ==", "url": "https://github.com/sakaiproject/sakai/pull/8817#discussion_r525311111", "bodyText": "I'd use a template literal for this entire template block, backticks.", "author": "adrianfish", "createdAt": "2020-11-17T16:40:48Z", "path": "library/src/webapp-filtered/editor/ckeditor.launch.js", "diffHunk": "@@ -301,12 +301,260 @@ sakai.editor.editors.ckeditor.launch = function(targetId, config, w, h) {\n         //If the siteskin is defined, add the print.css\n         if (sakai.editor.sitePrintSkin) {\n             ckconfig.contentsCss.push(sakai.editor.sitePrintSkin);\n-        } \n+        }\n         CKEDITOR.dtd.$removeEmpty.span = false;\n         CKEDITOR.dtd.$removeEmpty['i'] = false;\n         //Add greek special characters to set\n         ckconfig.specialChars = CKEDITOR.config.specialChars.concat([ [\"&alpha;\",\"alpha\"],[\"&beta;\",\"beta\"],[\"&gamma;\",\"gamma\"],[\"&delta;\",\"delta\"],[\"&epsilon;\",\"epsilon\"],[\"&zeta;\",\"zeta\"],[\"&eta;\",\"eta\"],[\"&theta;\",\"theta\"], [\"&iota;\",\"iota\"],[\"&kappa;\",\"kappa\"],[\"&lambda;\",\"lambda\"],[\"&mu;\",\"mu\"],[\"&nu;\",\"nu\"],[\"&xi;\",\"xi\"],[\"&omicron;\",\"omnicron\"],[\"&pi;\",\"pi\"],[\"&rho;\",\"rho\"],[\"&sigma;\",\"sigma\"],[\"&tau;\",\"tau\"],[\"&upsilon;\",\"upsilon\"], [\"&phi;\",\"phi\"],[\"&chi;\",\"chi\"],[\"&psi;\",\"psi\"],[\"&omega;\",\"omega\"],[\"&Alpha;\",\"Alpha\"],[\"&Beta;\",\"Beta\"],[\"&Gamma;\",\"Gamma\"],[\"&Delta;\",\"Delta\"],[\"&Epsilon;\",\"Epsilon\"],[\"&Zeta;\",\"Zeta\"],[\"&Eta;\",\"Eta\"],[\"&Theta;\",\"Theta\"], [\"&Iota;\",\"Iota\"],[\"&Kappa;\",\"Kappa\"],[\"&Lambda;\",\"Lambda\"],[\"&Mu;\",\"Mu\"],[\"&Nu;\",\"Nu\"],[\"&Xi;\",\"Xi\"],[\"&Omicron;\",\"Omnicron\"],[\"&Pi;\",\"Pi\"],[\"&Rho;\",\"Rho\"],[\"&Sigma;\",\"Sigma\"],[\"&Tau;\",\"Tau\"],[\"&Upsilon;\",\"Upsilon\"], [\"&Phi;\",\"Phi\"],[\"&Chi;\",\"Chi\"],[\"&Psi;\",\"Psi\"],[\"&Omega;\",\"Omega\"] ]);\n \n+        //SAK-44562\n+        if (sakai.editor.sitePropertiesSkin) {\n+            ckconfig.contentsCss.push(sakai.editor.sitePropertiesSkin);\n+            ckconfig.contentsCss.push('/library/editor/ckeditor.css');\n+        }\n+        CKEDITOR.on('instanceLoaded', function(editor){\n+            if (document.firstElementChild.classList.contains('sakai-dark-theme')){\n+                editor.editor.document.$.firstElementChild.classList.add('sakai-dark-theme');\n+            }\n+        })\n+\n+        //Enable ckeditor to reflect themeswitcher changes. Overrides:\n+        //https://github.com/ckeditor/ckeditor4/blob/a786d6f43c17ef90c13b1cf001dbd00204a622b1/skins/moono-lisa/skin.js\n+        CKEDITOR.skin.chameleon = ( function() {\n+\n+        templates = {\n+            editor: new CKEDITOR.template(\n+                '.cke_reset_all, .cke_reset_all *, .cke_reset_all a, .cke_reset_all textarea [' +\n+                    'color:{defaultTextColor};' +\n+                '] ' +\n+                '{id}.cke_chrome [' +\n+                    'color:{defaultTextColor};' +\n+                    'border-color:{defaultBorder};' +\n+                '] ' +\n+                '{id} .cke_top [ ' +\n+                    'background-color:{defaultBackground};' +\n+                    'border-bottom-color:{defaultBorder};' +\n+                '] ' +\n+                '{id} .cke_bottom [' +\n+                    'background-color:{defaultBackground};' +\n+                    'border-top-color:{defaultBorder};' +\n+                '] ' +\n+                '{id} .cke_resizer [' +\n+                    'border-right-color:{ckeResizer}' +\n+                '] ' +\n+                '{id} .cke_wysiwyg_frame,' +\n+                '{id} .cke_wysiwyg_div [' +\n+                    'background:{defaultBackground}' +\n+                '] ' +\n+                '{id} textarea.cke_source [' +\n+                    'background-color: {defaultBackground};' +\n+                    'color: {defaultTextColor};' +\n+                ']' +\n+        \n+                // Dialogs.\n+                '{id} .cke_dialog_title [' +\n+                    'color:{defaultTextColor};' +\n+                    'background-color:{defaultBackground};' +\n+                    'border-bottom-color:{defaultBorder};' +\n+                '] ' +\n+                '{id} .cke_dialog_footer [' +\n+                    'color:{defaultTextColor};' +\n+                    'background-color:{defaultBackground};' +\n+                    'outline-color:{defaultBorder};' +\n+                '] ' +\n+                '{id} .cke_dialog_tab [' +\n+                    'color:{defaultTextColor};' +\n+                    'background-color:{dialogTab};' +\n+                    'border-color:{defaultBorder};' +\n+                '] ' +\n+                '{id} .cke_dialog_tab:hover, {id} .cke_dialog_tab_selected:hover [' +\n+                    'color:{menubuttonTextHover};' +\n+                    'background-color:{lightBackground};' +\n+                '] ' +\n+                '{id} .cke_dialog_contents [' +\n+                    'color:{defaultTextColor};' +\n+                    'background-color:{defaultBackground};' +\n+                    'border-top-color:{defaultBorder};' +\n+                '] ' +\n+                '{id} .cke_dialog_tab_selected [' +\n+                    'color:{defaultTextColor};' +\n+                    'background:{dialogTabSelected};' +\n+                    'border-bottom-color:{dialogTabSelectedBorder};' +\n+                '] ' +\n+                '{id} .cke_dialog_body [' +\n+                    'color:{defaultTextColor};' +\n+                    'background:{dialogBody};' +\n+                    'border-color:{defaultBorder};' +\n+                '] ' +\n+                '.cke_dialog a.cke_dialog_ui_button [' +\n+                    'background:{menubutton};' +\n+                    'color: {menubuttonIcon};' +\n+                '] ' +\n+                '.cke_dialog a.cke_dialog_ui_button:hover [' +\n+                    'background:{menubuttonHover};' +\n+                    'color:{menubuttonTextHover};' +\n+                '] ' +\n+                '.cke_dialog a.cke_dialog_ui_button.cke_dialog_ui_button_ok [' +\n+                    'background:{okBackground};' +\n+                    'border-color:{okBorderColor};' +\n+                    'color: {okColor};' +\n+                '] ' +\n+                '{id} input.cke_dialog_ui_input_text, {id} input.cke_dialog_ui_input_password, {id} input.cke_dialog_ui_input_tel, {id} textarea.cke_dialog_ui_input_textarea, {id} select.cke_dialog_ui_input_select [' +\n+                    'background:{dialogBody};' +\n+                    'border-color:{defaultBorder};' +\n+                    'color:{defaultTextColor};' +\n+                '] ' +\n+                // Toolbars, buttons.\n+                '{id} a.cke_button .cke_button_icon [' +\n+                    'filter: {invertIfDarkMode}' +\n+                ']' +\n+                '{id} a.cke_button_off:hover,' +\n+                '{id} a.cke_button_off:focus,' +\n+                '{id} a.cke_button_off:active [' +\n+                    'background-color:{darkBackground};' +\n+                    'border-color:{toolbarElementsBorder};' +\n+                    'color:{defaultTextColor};' +\n+                '] ' +\n+                '{id} .cke_button_label,' +\n+                '{id} a.cke_button_off:hover .cke_button_label,' +\n+                '{id} a.cke_button_off:focus .cke_button_label,' +\n+                '{id} a.cke_button_off:active .cke_button_label [' +\n+                    'color:{defaultTextColor};' +\n+                '] ' +\n+                '{id} .cke_button_on [' +\n+                    'background-color:{ckeButtonOn};' +\n+                    'border-color:{toolbarElementsBorder};' +\n+                '] ' +\n+                '{id} .cke_toolbar_separator,' +\n+                '{id} .cke_toolgroup a.cke_button:last-child:after,' +\n+                '{id} .cke_toolgroup a.cke_button.cke_button_disabled:hover:last-child:after [' +\n+                    'background-color: {toolbarElementsBorder};' +\n+                    'border-color: {toolbarElementsBorder};' +\n+                '] ' +\n+                '{id} .cke_button_arrow [' +\n+                    'border--top-color: {toolbarElementsBorder};' +\n+                '] ' +\n+                // Combo buttons.\n+                '{id} a.cke_combo_button:hover,' +\n+                '{id} a.cke_combo_button:focus,' +\n+                '{id} .cke_combo_on a.cke_combo_button [' +\n+                    'border-color:{toolbarElementsBorder};' +\n+                    'color:{menubuttonTextHover};' +\n+                    'background-color:{darkBackground};' +\n+                '] ' +\n+                '{id} .cke_combo_arrow,' +\n+                '{id} .cke_combo:after [' +\n+                    'border-color:{toolbarElementsBorder};' +\n+                '] ' +\n+                '{id} .cke_combo_text [' +\n+                    'color:{defaultTextColor};' +\n+                '] ' +\n+                // Elementspath.\n+                '{id} .cke_path_item [' +\n+                    'color:{elementsPathColor};' +\n+                '] ' +\n+                '{id} a.cke_path_item:hover,' +\n+                '{id} a.cke_path_item:focus,' +\n+                '{id} a.cke_path_item:active [' +\n+                    'color:{menubuttonTextHover};' +\n+                    'background-color:{darkBackground};' +\n+                '] ' +\n+                '{id}.cke_panel [' +\n+                    'border-color:{defaultBorder};' +\n+                '] ' +\n+                '.cke_panel_list .cke_panel_listItem [' +\n+                    'background:{defaultBackground};' +\n+                '] '\n+            ),\n+            panel: new CKEDITOR.template(\n+                // Panel drop-downs.\n+                '.cke_panel_grouptitle [' +\n+                    'background-color:{lightBackground};' +\n+                    'border-color:{defaultBorder};' +\n+                '] ' +\n+                // Context menus.\n+                '.cke_menubutton_icon [' +\n+                    'background-color:{menubuttonIcon};' +\n+                '] ' +\n+                '.cke_menubutton:hover,' +\n+                '.cke_menubutton:focus,' +\n+                '.cke_menubutton:active [' +\n+                    'color:{menubuttonTextHover};' +\n+                    'background-color:{menubuttonHover};' +\n+                '] ' +\n+                '.cke_menubutton:hover .cke_menubutton_icon, ' +\n+                '.cke_menubutton:focus .cke_menubutton_icon, ' +\n+                '.cke_menubutton:active .cke_menubutton_icon [' +\n+                    'color:{menubuttonTextHover};' +\n+                    'background-color:{menubuttonIconHover};' +\n+                '] ' +\n+                '.cke_menubutton_disabled:hover .cke_menubutton_icon,' +\n+                '.cke_menubutton_disabled:focus .cke_menubutton_icon,' +\n+                '.cke_menubutton_disabled:active .cke_menubutton_icon [' +\n+                    'background-color:{menubuttonIcon};' +\n+                '] ' +\n+                '.cke_menuseparator [' +\n+                    'background-color:{menubuttonIcon};' +\n+                '] ' +\n+                // Color boxes.\n+                'a:hover.cke_colorbox, ' +\n+                'a:active.cke_colorbox [' +\n+                    'border-color:{defaultBorder};' +\n+                '] ' +\n+                'a:hover.cke_colorauto, ' +\n+                'a:hover.cke_colormore, ' +\n+                'a:active.cke_colorauto, ' +\n+                'a:active.cke_colormore [' +\n+                    'background-color:{ckeColorauto};' +\n+                    'border-color:{defaultBorder};' +\n+                '] '", "originalCommit": "ed2afb53467fd612dc960d1d9415c107b193469c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "35649ea963e56416e43920d2abbdc842ab529aed", "url": "https://github.com/sakaiproject/sakai/commit/35649ea963e56416e43920d2abbdc842ab529aed", "message": "SAK-44562 library / portal - ckeditor support dark theme", "committedDate": "2020-11-18T04:09:42Z", "type": "forcePushed"}, {"oid": "e3dc3d8d3bef4c66ea3d70db56c86ad84b45b06e", "url": "https://github.com/sakaiproject/sakai/commit/e3dc3d8d3bef4c66ea3d70db56c86ad84b45b06e", "message": "SAK-44562 library / portal - ckeditor support dark theme", "committedDate": "2020-11-18T04:26:48Z", "type": "forcePushed"}, {"oid": "7848abad12dd1af131d99704c8b0fa29921c490f", "url": "https://github.com/sakaiproject/sakai/commit/7848abad12dd1af131d99704c8b0fa29921c490f", "message": "SAK-44562 library / portal - ckeditor support dark theme", "committedDate": "2020-11-18T04:28:26Z", "type": "forcePushed"}, {"oid": "bfbdb147e05d6955145944a6e4d3211910289f32", "url": "https://github.com/sakaiproject/sakai/commit/bfbdb147e05d6955145944a6e4d3211910289f32", "message": "SAK-44562 library / portal - ckeditor support dark theme", "committedDate": "2020-12-01T16:38:17Z", "type": "forcePushed"}, {"oid": "702e56b4b6e18b5be90ef857119af71bfbe4a873", "url": "https://github.com/sakaiproject/sakai/commit/702e56b4b6e18b5be90ef857119af71bfbe4a873", "message": "SAK-44562 library / portal - ckeditor support dark theme", "committedDate": "2020-12-01T17:02:50Z", "type": "forcePushed"}, {"oid": "98881e2e2f0733f6f2f8e29a54bd8bc4b1449574", "url": "https://github.com/sakaiproject/sakai/commit/98881e2e2f0733f6f2f8e29a54bd8bc4b1449574", "message": "SAK-44562 library / portal - ckeditor support dark theme", "committedDate": "2020-12-01T17:18:02Z", "type": "forcePushed"}, {"oid": "0c88b33d33e9921a31a86aba8cd5adcd0912beb9", "url": "https://github.com/sakaiproject/sakai/commit/0c88b33d33e9921a31a86aba8cd5adcd0912beb9", "message": "SAK-44562 library / portal - ckeditor support dark theme", "committedDate": "2020-12-03T02:09:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDYxNTE2NQ==", "url": "https://github.com/sakaiproject/sakai/pull/8817#discussion_r534615165", "bodyText": "I'd like to avoid multiple html/:root selectors that only exist for defining custom properties so I removed these and put the font-family in sass/_defaults and the table-even-color in sass/themes/_light.scss", "author": "profmikegreene", "createdAt": "2020-12-03T02:14:32Z", "path": "library/src/morpheus-master/sass/base/_defaults.scss", "diffHunk": "@@ -257,7 +257,3 @@ span.marker {\n     margin: 0;\n   }\n }\n-html {\n-    --sakai-font-family: roboto, arial, sans-serif;\n-    --sakai-table-even-color: #f4f4f4;\n-}", "originalCommit": "0c88b33d33e9921a31a86aba8cd5adcd0912beb9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a84a07706b60ba3ca2167473a56557798392fff2", "url": "https://github.com/sakaiproject/sakai/commit/a84a07706b60ba3ca2167473a56557798392fff2", "message": "SAK-44562 library / portal - ckeditor support dark theme", "committedDate": "2020-12-03T02:32:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDYyMjcxNg==", "url": "https://github.com/sakaiproject/sakai/pull/8817#discussion_r534622716", "bodyText": "Removing these bootstrap overrides completely after discussing with Shawn. Previous commit I had updated the bgcolor with a custom property, but it isn't really necessary at all.", "author": "profmikegreene", "createdAt": "2020-12-03T02:35:27Z", "path": "library/src/morpheus-master/sass/modules/connection-manager/_base.scss", "diffHunk": "@@ -334,8 +334,3 @@\n \t\theight: 375px;\n   }\n }\n-\n-.modal-backdrop {\n-  background-color: #FFFFFF !important;\n-  opacity: 0.4 !important;\n-}", "originalCommit": "a84a07706b60ba3ca2167473a56557798392fff2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDYyNTUyMA==", "url": "https://github.com/sakaiproject/sakai/pull/8817#discussion_r534625520", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \ta:hover,\n          \n          \n            \n            \ta:focus,\n          \n          \n            \n            \ta:active {\n          \n          \n            \n            \ta:focus,\n          \n          \n            \n            \ta:hover,\n          \n          \n            \n            \ta:active {", "author": "fostersdesign", "createdAt": "2020-12-03T02:43:39Z", "path": "library/src/morpheus-master/sass/modules/editor/_base.scss", "diffHunk": "@@ -32,6 +35,23 @@\n }\n .cke_dialog_contents_body .cke_tpl_list {\n \theight: 430px !important;\n+\tbackground: var(--sakai-background-color-1);\n+\tborder-color: var(--sakai-border-color);\n+\t.cke_tpl_item {\n+\t\tborder-color:var(--sakai-border-color);\n+\t\tcolor:var(--sakai-text-color-1);\n+\t}\n+\ta:hover,\n+\ta:focus,\n+\ta:active {", "originalCommit": "a84a07706b60ba3ca2167473a56557798392fff2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTMzODQwOA==", "url": "https://github.com/sakaiproject/sakai/pull/8817#discussion_r535338408", "bodyText": "@ern this is what we were going to ask about during ui call today. I wrote this with the rationale that all the other CSS files generated in library have these functions, so the new properties.css file should have them as well even though there's not a use case for using that file currently outside of ckeditor. I worried that someone would come along and expect to be able to call that properties.css file the same way they do tool.css and would get tripped up if these functions didn't exist.", "author": "profmikegreene", "createdAt": "2020-12-03T15:35:06Z", "path": "portal/portal-util/util/src/java/org/sakaiproject/portal/util/CSSUtils.java", "diffHunk": "@@ -224,8 +255,12 @@ public static String getCssToolSkinLink(String skin, boolean isInlineRequest) {\n \t\tString headCssPrintSkin = \"<link href=\\\"\" \n \t\t\t\t+ getCssPrintSkinCDN(skin)\n \t\t\t\t+ \"\\\" type=\\\"text/css\\\" rel=\\\"stylesheet\\\" media=\\\"print\\\" />\\n\";\n+\n+\t\tString headCssPropertiesSkin = \"<link href=\\\"\" \n+\t\t\t\t+ getCssPropertiesSkinCDN(skin)\n+\t\t\t\t+ \"\\\" type=\\\"text/css\\\" rel=\\\"stylesheet\\\" media=\\\"screen, tty, tv, handheld, projection\\\" />\\n\";\n \t\t\n-\t\treturn headCssToolSkin + headCssPrintSkin;\n+\t\treturn headCssToolSkin + headCssPrintSkin + headCssPropertiesSkin;", "originalCommit": "a84a07706b60ba3ca2167473a56557798392fff2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ddc249089d31f86b7b0c29bc66bb193be72c4ed4", "url": "https://github.com/sakaiproject/sakai/commit/ddc249089d31f86b7b0c29bc66bb193be72c4ed4", "message": "SAK-44562 library / portal - ckeditor support dark theme", "committedDate": "2020-12-08T16:14:51Z", "type": "commit"}, {"oid": "ddc249089d31f86b7b0c29bc66bb193be72c4ed4", "url": "https://github.com/sakaiproject/sakai/commit/ddc249089d31f86b7b0c29bc66bb193be72c4ed4", "message": "SAK-44562 library / portal - ckeditor support dark theme", "committedDate": "2020-12-08T16:14:51Z", "type": "forcePushed"}]}