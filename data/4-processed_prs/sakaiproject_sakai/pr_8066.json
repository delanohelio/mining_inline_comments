{"pr_number": 8066, "pr_title": "SAK-43357 allow rubrics component to save evaluations", "pr_createdAt": "2020-03-24T11:01:20Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/8066", "timeline": [{"oid": "ace66a0f15e54e6b03ff4d76e3bac91049faf381", "url": "https://github.com/sakaiproject/sakai/commit/ace66a0f15e54e6b03ff4d76e3bac91049faf381", "message": "SAK-43357 allow rubrics component to save evaluations\n\nhttps://jira.sakaiproject.org/browse/SAK-43357", "committedDate": "2020-03-24T10:35:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA2NzA5NQ==", "url": "https://github.com/sakaiproject/sakai/pull/8066#discussion_r397067095", "bodyText": "Looks like there's a label missing for this input. That makes it hard for people using screen readers or voice control to use the input.", "author": "accesslint", "createdAt": "2020-03-24T11:01:28Z", "path": "rubrics/tool/src/main/frontend/webcomponents/js/sakai-rubric-grading.js", "diffHunk": "@@ -41,73 +57,301 @@ export class SakaiRubricGrading extends RubricsElement {\n     }\n   }\n \n-  shouldUpdate(changedProperties) {\n-    return this.i18nLoaded && changedProperties.has(\"rubric\");\n-  }\n-\n   render() {\n \n     return html`\n       <h3 style=\"margin-bottom: 10px;\">${this.rubric.title}</h3>\n+      <div class=\"criterion grading style-scope sakai-rubric-criteria-grading\" style=\"margin-bottom: 10px;\">\n+      ${this.criteria.map(c => html`\n+        <div id=\"criterion_row_${c.id}\" class=\"criterion-row\">\n+          <div class=\"criterion-detail\">\n+            <h4 class=\"criterion-title\">${c.title}</h4>\n+            <p>${c.description}</p>\n+          </div>\n+          <div class=\"criterion-ratings\" style=\"margin-bottom: 15px !important;\">\n+            <div class=\"cr-table\">\n+              <div class=\"cr-table-row\">\n+              ${c.ratings.map(r => html`\n+                <div class=\"rating-item ${this.selectedRatings.includes(r.id) ? \"selected\" : \"\"}\" data-rating-id=\"${r.id}\" id=\"rating-item-${r.id}\" data-criterion-id=\"${c.id}\" @click=\"${this.toggleRating}\">\n+                  <h5 class=\"criterion-item-title\">${r.title}</h5>\n+                  <p>${r.description}</p>\n+                  <span class=\"points\" data-points=\"${r.points}\">${r.points.toLocaleString(this.locale)} <sr-lang key=\"points\">Points</sr-lang></span>\n+                </div>\n+              `)}\n+              </div>\n+            </div>\n+          </div>\n+          <div class=\"criterion-actions\">\n+            <sakai-rubric-grading-comment id=\"comment-for-${c.id}\" @comment-shown=${this.commentShown} @update-comment=\"${this.updateComment}\" criterion=\"${JSON.stringify(c)}\" evaluated-item-id=\"${this.evaluatedItemId}\" entity-id=\"${this.entityId}\"></sakai-rubric-grading-comment>\n+            <div>\n+              <strong id=\"points-display-${c.id}\" class=\"points-display ${this.getOverriddenClass(c.pointoverride, c.selectedvalue)}\">\n+                ${c.selectedvalue}\n+              </strong>\n+            </div>\n+            ${this.association.parameters.fineTunePoints ? html`\n+                <input type=\"number\" step=\"0.01\" min=\"0\" max=\"${ifDefined(c.pointrange ? c.pointrange.high : undefined)}\"\n+                    title=\"${tr(\"point_override_details\")}\"\n+                    data-criterion-id=\"${c.id}\"\n+                    name=\"rbcs-${this.evaluatedItemId}-${this.entityId}-criterion-override-${c.id}\"\n+                    class=\"fine-tune-points form-control hide-input-arrows\"\n+                    @input=${this.fineTuneRating}\n+                    .value=\"${c.pointoverride}\"\n+                />\n+              ` : \"\"}\n+            <input aria-labelledby=\"${tr(\"points\")}\" type=\"hidden\" id=\"rbcs-${this.evaluatedItemId}-${this.entityId}-criterion-${c.id}\" name=\"rbcs-${this.evaluatedItemId}-${this.entityId}-criterion-${c.id}\" .value=\"${c.selectedvalue}\">\n+            <input type=\"hidden\" name=\"rbcs-${this.evaluatedItemId}-${this.entityId}-criterionrating-${c.id}\" .value=\"${c.selectedRatingId}\">", "originalCommit": "ace66a0f15e54e6b03ff4d76e3bac91049faf381", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}