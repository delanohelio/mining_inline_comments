{"pr_number": 8647, "pr_title": "SAK-44397: Bugs fixes for SAK-42856: Provide a way to reply private", "pr_createdAt": "2020-10-01T16:38:59Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/8647", "timeline": [{"oid": "a23ff9ad3598045e23b7029ee360a4ae65304d8f", "url": "https://github.com/sakaiproject/sakai/commit/a23ff9ad3598045e23b7029ee360a4ae65304d8f", "message": "SAK-44397: Bugs fixes for SAK-42856: Provide a way to reply private\nmessages from external mail", "committedDate": "2020-10-01T16:24:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODUxODE1Nw==", "url": "https://github.com/sakaiproject/sakai/pull/8647#discussion_r498518157", "bodyText": "use the ServerConfigurationService api vs the cover", "author": "ern", "createdAt": "2020-10-01T21:17:43Z", "path": "msgcntr/messageforums-component-impl/src/java/org/sakaiproject/component/app/messageforums/ui/PrivateMessageManagerImpl.java", "diffHunk": "@@ -1184,7 +1184,7 @@ private String getSystemAndReplyEmail(String defaultEmail, User currentUser, Mes\n \t\t    else\n \t\t\t    systemEmail = ServerConfigurationService.getString(FROM_ADDRESS, defaultEmail);\n \t    }\n-\t\tif ((\"all\".equals(ServerConfigurationService.getString(REAL_REPLY, \"none\")) || contextId.contains(ServerConfigurationService.getString(REAL_REPLY, \"none\"))) && systemEmail.equalsIgnoreCase(ServerConfigurationService.getString(FROM_ADDRESS, defaultEmail))) {\n+\t\tif (ServerConfigurationService.getStrings(REAL_REPLY)!=null && (\"all\".equals(ServerConfigurationService.getString(REAL_REPLY, \"none\")) || Arrays.asList(ServerConfigurationService.getStrings(REAL_REPLY)).contains(contextId)) && systemEmail.equalsIgnoreCase(ServerConfigurationService.getString(FROM_ADDRESS, defaultEmail))) {", "originalCommit": "a23ff9ad3598045e23b7029ee360a4ae65304d8f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODUxODIxNQ==", "url": "https://github.com/sakaiproject/sakai/pull/8647#discussion_r498518215", "bodyText": "use the ServerConfigurationService api vs the cover", "author": "ern", "createdAt": "2020-10-01T21:17:51Z", "path": "msgcntr/messageforums-component-impl/src/java/org/sakaiproject/component/app/messageforums/ui/PrivateMessageManagerImpl.java", "diffHunk": "@@ -1452,7 +1452,7 @@ private String buildMessageBody(PrivateMessage message) {\n \t      getResourceBundleString(EMAIL_FOOTER1) + \" \" + ServerConfigurationService.getString(\"ui.service\",\"Sakai\") +\n \t  \" \" + getResourceBundleString(EMAIL_FOOTER2) + \" \\\"\" +\n \t  siteTitle + \"\\\" \" + getResourceBundleString(EMAIL_FOOTER3) + \"\\n\";\n-\t  if ((\"all\".equals(ServerConfigurationService.getString(REAL_REPLY, \"none\")) || contextId.contains(ServerConfigurationService.getString(REAL_REPLY, \"none\")))){\n+\t  if (ServerConfigurationService.getStrings(REAL_REPLY)!=null && (\"all\".equals(ServerConfigurationService.getString(REAL_REPLY, \"none\")) || Arrays.asList(ServerConfigurationService.getStrings(REAL_REPLY)).contains(contextId))){", "originalCommit": "a23ff9ad3598045e23b7029ee360a4ae65304d8f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODUxODg1Mg==", "url": "https://github.com/sakaiproject/sakai/pull/8647#discussion_r498518852", "bodyText": "use Types", "author": "ern", "createdAt": "2020-10-01T21:19:30Z", "path": "msgcntr/messageforums-component-impl/src/java/org/sakaiproject/component/app/messageforums/ui/PrivateMessageManagerImpl.java", "diffHunk": "@@ -2235,7 +2235,7 @@ public void processPvtMsgReplySentAction(PrivateMessage currentMessage, PrivateM\n \t\t\t\t  log.error(e.getMessage(), e);\n \t\t\t  }\n \n-\t\t\t  Event event = eventTrackingService.newEvent(DiscussionForumService.EVENT_MESSAGES_RESPONSE, getEventMessage(currentMessage, DiscussionForumService.MESSAGES_TOOL_ID, rrepMsg.getAuthorId(), ((PrivateMessageRecipientImpl)currentMessage.getRecipients().get(0)).getContextId()), null, true, NotificationService.NOTI_OPTIONAL, statement);\n+\t\t\t  Event event = eventTrackingService.newEvent(DiscussionForumService.EVENT_MESSAGES_RESPONSE, getEventMessage(currentMessage, DiscussionForumService.MESSAGES_TOOL_ID, rrepMsg.getAuthorId(), ((PrivateMessageRecipientImpl)currentMessage.getRecipients().get(0)).getContextId()), contextId, true, NotificationService.NOTI_OPTIONAL, statement);", "originalCommit": "a23ff9ad3598045e23b7029ee360a4ae65304d8f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e9529e43927bb14141e89cf4b6bc70fd5a611167", "url": "https://github.com/sakaiproject/sakai/commit/e9529e43927bb14141e89cf4b6bc70fd5a611167", "message": "SAK-44397: Resolved Issues", "committedDate": "2020-10-08T09:14:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODYwNDQwNw==", "url": "https://github.com/sakaiproject/sakai/pull/8647#discussion_r508604407", "bodyText": "use a local variable for serverConfigurationService.getStrings(REAL_REPLY)", "author": "ern", "createdAt": "2020-10-20T15:23:33Z", "path": "msgcntr/messageforums-component-impl/src/java/org/sakaiproject/component/app/messageforums/ui/PrivateMessageManagerImpl.java", "diffHunk": "@@ -1449,21 +1449,21 @@ private String buildMessageBody(PrivateMessage message) {\n \t  }\n \n \t  String footer = \"<p>----------------------<br>\" +\n-\t      getResourceBundleString(EMAIL_FOOTER1) + \" \" + ServerConfigurationService.getString(\"ui.service\",\"Sakai\") +\n+\t      getResourceBundleString(EMAIL_FOOTER1) + \" \" + serverConfigurationService.getString(\"ui.service\",\"Sakai\") +\n \t  \" \" + getResourceBundleString(EMAIL_FOOTER2) + \" \\\"\" +\n \t  siteTitle + \"\\\" \" + getResourceBundleString(EMAIL_FOOTER3) + \"\\n\";\n-\t  if ((\"all\".equals(ServerConfigurationService.getString(REAL_REPLY, \"none\")) || contextId.contains(ServerConfigurationService.getString(REAL_REPLY, \"none\")))){\n+\t  if (serverConfigurationService.getStrings(REAL_REPLY)!=null && (\"all\".equals(serverConfigurationService.getString(REAL_REPLY, \"none\")) || Arrays.asList(serverConfigurationService.getStrings(REAL_REPLY)).contains(contextId))){", "originalCommit": "e9529e43927bb14141e89cf4b6bc70fd5a611167", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "104f79284e30b60557abd1d1cc24def1cc38593d", "url": "https://github.com/sakaiproject/sakai/commit/104f79284e30b60557abd1d1cc24def1cc38593d", "message": "SAK-44397: use a local variable for\nserverConfigurationService.getStrings(REAL_REPLY)", "committedDate": "2020-10-27T09:01:06Z", "type": "commit"}]}