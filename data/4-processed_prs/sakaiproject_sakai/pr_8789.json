{"pr_number": 8789, "pr_title": "SAK-44630 allow institution to send Sakai TAs to Turnitin as Instructors", "pr_createdAt": "2020-11-05T21:43:00Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/8789", "timeline": [{"oid": "995e5653fd84b1a6896efdd6df77c50446acea55", "url": "https://github.com/sakaiproject/sakai/commit/995e5653fd84b1a6896efdd6df77c50446acea55", "message": "SAK-44630 allow institution to send Sakai TAs to Turnitin as Instructors", "committedDate": "2020-11-05T21:38:27Z", "type": "commit"}, {"oid": "6dc4919911e2430b1764eb8e09028db26622f97d", "url": "https://github.com/sakaiproject/sakai/commit/6dc4919911e2430b1764eb8e09028db26622f97d", "message": "config setting", "committedDate": "2020-11-05T21:40:54Z", "type": "commit"}, {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6", "url": "https://github.com/sakaiproject/sakai/commit/a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6", "message": "fix build", "committedDate": "2020-11-05T21:50:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc2OTQ2Ng==", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518769466", "bodyText": "you may want to change this to snake case to be consistent with the other permissions", "author": "baholladay", "createdAt": "2020-11-06T14:01:25Z", "path": "config/configuration/bundles/src/bundle/org/sakaiproject/config/bundle/default.sakai.properties", "diffHunk": "@@ -2074,6 +2074,10 @@\n # turnitin.report_gen_speed.setting.2=1\n # turnitin.report_gen_speed.setting.3=2\n \n+# Allow Sakai TAs to be sent to Turnitin as Instructors so they can view TII reports\n+# DEFAULT: false\n+# turnitin.enrollAssistantsAsInstructors=true", "originalCommit": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgyMjc5NA==", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518822794", "bodyText": "agree", "author": "ottenhoff", "createdAt": "2020-11-06T15:24:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc2OTQ2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MDE2MQ==", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518770161", "bodyText": "@SuppressWarnings is not needed any longer", "author": "baholladay", "createdAt": "2020-11-06T14:02:33Z", "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "diffHunk": "@@ -2260,23 +2269,22 @@ private String getTEM(String cid) {\n \t * @return\n \t */\n \t@SuppressWarnings(\"unchecked\")", "originalCommit": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MDI1NQ==", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518770255", "bodyText": "@SuppressWarnings is not needed any longer", "author": "baholladay", "createdAt": "2020-11-06T14:02:43Z", "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "diffHunk": "@@ -2260,23 +2269,22 @@ private String getTEM(String cid) {\n \t * @return\n \t */\n \t@SuppressWarnings(\"unchecked\")\n-\tpublic Map getInstructorInfo(String siteId) {\n+\tpublic Map<String, String> getInstructorInfo(String siteId) {\n \t\treturn getInstructorInfo(siteId, false);\n \t}\n \n \t@SuppressWarnings(\"unchecked\")", "originalCommit": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MDc1MQ==", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518770751", "bodyText": "final isn't needed", "author": "baholladay", "createdAt": "2020-11-06T14:03:40Z", "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "diffHunk": "@@ -2312,14 +2320,24 @@ public Map getInstructorInfo(String siteId, boolean ignoreUseSource) {\n \t\treturn togo;\n \t}\n \n-\tprivate Set<String> getActiveInstructorIds(String INST_ROLE, Site site) {\n+\tprivate Set<String> getActiveUsersForRole(final String rolePermission, final String siteId) {", "originalCommit": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MTA3Mg==", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518771072", "bodyText": "spacing", "author": "baholladay", "createdAt": "2020-11-06T14:04:10Z", "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "diffHunk": "@@ -2312,14 +2320,24 @@ public Map getInstructorInfo(String siteId, boolean ignoreUseSource) {\n \t\treturn togo;\n \t}\n \n-\tprivate Set<String> getActiveInstructorIds(String INST_ROLE, Site site) {\n+\tprivate Set<String> getActiveUsersForRole(final String rolePermission, final String siteId) {\n+\t\ttry {\n+\t\t\tSite site = siteService.getSite(siteId);\n+\t\t\treturn getActiveUsersForRole(rolePermission, site);\n+\t\t} catch (IdUnusedException e) {\n+\t\t\tlog.info(\"Ignoring site \" + siteId + \" which no longer exists.\");\n+\t\t}\n+\n+    return new HashSet<String>();", "originalCommit": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgyMzcwMw==", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518823703", "bodyText": "yup tabs", "author": "ottenhoff", "createdAt": "2020-11-06T15:25:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MTA3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MzA4MQ==", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518773081", "bodyText": "is final needed here?", "author": "baholladay", "createdAt": "2020-11-06T14:07:27Z", "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "diffHunk": "@@ -2750,39 +2768,13 @@ private User getUser(String userid) {\n \t\treturn user;\n \t}\n \n-\t/**\n-\t * Return a Map containing all users of x type enrolled on a site\n-\t * @param siteId Sakai site ID\n-\t * @param role specific user role e.g. 'instructor'\n-\t * @return\n-\t */\n-\t@SuppressWarnings(\"unchecked\")\n-\tprivate Map getAllUsers(String siteId, String role) {\n-\t\tString ROLE = \"section.role.\"+role;\n-\t\tMap<String,String> users = new HashMap<>();\n-\t\tSite site = null;\n-\t\ttry {\n-\t\t\tsite = siteService.getSite(siteId);\n-\t\t\tSet<String> instIds = site.getUsersIsAllowed(ROLE);\n-\t\t\tList<User> activeUsers = userDirectoryService.getUsers(instIds);\n-\t\t\tfor (int i = 0; i < activeUsers.size(); i++) {\n-\t\t\t\tUser user = activeUsers.get(i);\n-\t\t\t\tusers.put(user.getId(),user.getId());\n-\t\t\t}\n-\t\t} catch (IdUnusedException e) {\n-\t\t\tlog.error(\"Unable to fetch site in getAllUsers: \" + siteId, e);\n-\t\t} catch (Exception e) {\n-\t\t\tlog.error(\"Exception in getAllUsers\", e);\n-\t\t}\n-\t\treturn users;\n-\t}\n \t/**\n \t * The primary method of this class. Syncs the enrollment between a Sakai\n \t * Site and it's corresponding\n \t *\n \t * @param sakaiSiteID\n \t */\n-\tprivate boolean syncSiteWithTurnitin(String sakaiSiteID) {\n+\tprivate boolean syncSiteWithTurnitin(final String sakaiSiteID) {", "originalCommit": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgyNDEwNQ==", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518824105", "bodyText": "not really needed just helps me when doing refactoring as the IDE then lets me know if the value is being manipulated", "author": "ottenhoff", "createdAt": "2020-11-06T15:26:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MzA4MQ=="}], "type": "inlineReview"}, {"oid": "c841ef5a7e4bfa43183cc4ffb9e10187bf86bb44", "url": "https://github.com/sakaiproject/sakai/commit/c841ef5a7e4bfa43183cc4ffb9e10187bf86bb44", "message": "bryan suggestions", "committedDate": "2020-11-06T15:26:34Z", "type": "commit"}]}