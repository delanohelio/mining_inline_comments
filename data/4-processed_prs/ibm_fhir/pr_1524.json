{"pr_number": 1524, "pr_title": "Implicit base not picked up in FHIR Reference search #300", "pr_createdAt": "2020-09-24T19:29:45Z", "pr_url": "https://github.com/IBM/FHIR/pull/1524", "timeline": [{"oid": "f9de7762db94ad125d129b3a7fb8119208162ad7", "url": "https://github.com/IBM/FHIR/commit/f9de7762db94ad125d129b3a7fb8119208162ad7", "message": "Implicit base not picked up in FHIR Reference search #300\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-09-24T19:28:49Z", "type": "commit"}, {"oid": "20fb25271adf36ab3ec0a3b75b13b8bc3354fdc0", "url": "https://github.com/IBM/FHIR/commit/20fb25271adf36ab3ec0a3b75b13b8bc3354fdc0", "message": "Implicit base not picked up in FHIR Reference search #300\n\n- Added Integration Test\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-09-24T19:39:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ3NzY5Mw==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r495477693", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    //", "author": "lmsurpre", "createdAt": "2020-09-26T17:26:32Z", "path": "fhir-persistence/src/test/java/com/ibm/fhir/persistence/search/test/AbstractSearchReferenceTest.java", "diffHunk": "@@ -75,13 +82,12 @@ public void testSearchReference_Reference_relative_revinclude() throws Exception\n \n     @Test\n     public void testSearchReference_Reference_absolute() throws Exception {\n-        // TODO if the resource contained an absolute URI which matches the hostname\n-        // where the current test was running, would these work?\n-//        assertSearchReturnsSavedResource(\"Reference-absolute\", \"123\");\n-//        assertSearchReturnsSavedResource(\"Reference-absolute\", \"Patient/123\");\n-//        assertSearchReturnsSavedResource(\"Reference-absolute:Patient\", \"123\");\n-\n         assertSearchReturnsSavedResource(\"Reference-absolute\", \"https://example.com/Patient/123\");\n+        assertSearchReturnsSavedResource(\"Reference-absolute\", \"Patient/123\");\n+        assertSearchReturnsSavedResource(\"Reference-absolute\", \"123\");\n+\n+        //", "originalCommit": "20fb25271adf36ab3ec0a3b75b13b8bc3354fdc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ3Nzg2Nw==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r495477867", "bodyText": "probably want to flip these back to INFO", "author": "lmsurpre", "createdAt": "2020-09-26T17:28:43Z", "path": "fhir-persistence/src/test/resources/logging.unitTest.properties", "diffHunk": "@@ -49,5 +49,5 @@ java.util.logging.ConsoleHandler.formatter = java.util.logging.SimpleFormatter\n ############################################################\n \n # Set this to FINE or higher to output the SQL statements and related debug info\n-com.ibm.fhir.persistence.level = INFO\n-com.ibm.fhir.search.level = INFO\n+com.ibm.fhir.persistence.level = FINE\n+com.ibm.fhir.search.level = FINE", "originalCommit": "20fb25271adf36ab3ec0a3b75b13b8bc3354fdc0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMwMTI2Ng==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r496301266", "bodyText": "fixed", "author": "prb112", "createdAt": "2020-09-29T00:06:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ3Nzg2Nw=="}], "type": "inlineReview"}, {"oid": "3e9a05923726013b5755b47176a6b4eb5976d225", "url": "https://github.com/IBM/FHIR/commit/3e9a05923726013b5755b47176a6b4eb5976d225", "message": "fix: changed the FHIR Request Context that is set in the default of the tests for SortParameter, the reason is when a refernece is used, we requery it parse the possible values needed in the search\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-09-29T00:04:28Z", "type": "commit"}, {"oid": "48f5bb0c93fa5e9f87a5de175390bf934371a578", "url": "https://github.com/IBM/FHIR/commit/48f5bb0c93fa5e9f87a5de175390bf934371a578", "message": "fix: turned the logging back to the default of info\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-09-29T00:05:51Z", "type": "commit"}, {"oid": "9e3e65db1f635c18d4d2782200d7d2cc9c1e44bd", "url": "https://github.com/IBM/FHIR/commit/9e3e65db1f635c18d4d2782200d7d2cc9c1e44bd", "message": "fix: formatting in a test\r\n\r\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\nCo-authored-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-09-29T00:07:05Z", "type": "commit"}, {"oid": "6c673ee7ba72f4986001abc2f219acadcae26d4b", "url": "https://github.com/IBM/FHIR/commit/6c673ee7ba72f4986001abc2f219acadcae26d4b", "message": "fix: wrong resource was compared to id\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-09-29T12:53:47Z", "type": "commit"}, {"oid": "638e6fff08f48ac21cdb109e6759a04531fd6b76", "url": "https://github.com/IBM/FHIR/commit/638e6fff08f48ac21cdb109e6759a04531fd6b76", "message": "Merge branch 'issue-300a' of github.com:IBM/FHIR into issue-300a", "committedDate": "2020-09-29T12:54:19Z", "type": "commit"}, {"oid": "7219374d26a94d15a38fd634f39f94f96ff2031d", "url": "https://github.com/IBM/FHIR/commit/7219374d26a94d15a38fd634f39f94f96ff2031d", "message": "Merge branch 'master' into issue-300a", "committedDate": "2020-09-29T18:41:51Z", "type": "commit"}, {"oid": "5d193ceddbeac1a247263e84cb75863452da0a08", "url": "https://github.com/IBM/FHIR/commit/5d193ceddbeac1a247263e84cb75863452da0a08", "message": "fix: bulk export missing the incoming url\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-09-29T19:48:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUxMjEyNA==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r497512124", "bodyText": "is this related to issue #300 at all, or its just a \"bonus\" ?", "author": "lmsurpre", "createdAt": "2020-09-30T13:32:45Z", "path": "fhir-bulkimportexport-webapp/src/main/java/META-INF/batch-jobs/FhirBulkExportChunkJob.xml", "diffHunk": "@@ -15,6 +15,7 @@\n                     <property name=\"fhir.search.pagesize\" value=\"#{jobParameters['fhir.search.pagesize']}\"/>\n                     <property name=\"fhir.typeFilters\" value=\"#{jobParameters['fhir.typeFilters']}\"/>\n                     <property name=\"fhir.exportFormat\" value=\"#{jobParameters['fhir.exportFormat']}\"/>\n+                    <property name=\"incomingUrl\" value=\"#{jobParameters['incomingUrl']}\"/>", "originalCommit": "5d193ceddbeac1a247263e84cb75863452da0a08", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUxODYyMw==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r497518623", "bodyText": "unfortunately, it's related - it's interpreting the incomingUrl inorder to form the target URL in a reference lookup", "author": "prb112", "createdAt": "2020-09-30T13:41:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUxMjEyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUyNzI0MQ==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r497527241", "bodyText": "ah, ok, makes sense.  glad you thought through all the ramifications of the changes...i might have missed this impact to export", "author": "lmsurpre", "createdAt": "2020-09-30T13:52:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUxMjEyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUxNzk0Ng==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r497517946", "bodyText": "I don't think this is right.  The value of the extension extracted by Reference-relative is Patient/123, whereas here we are explicitly saying we'd like a Basic resource.", "author": "lmsurpre", "createdAt": "2020-09-30T13:40:44Z", "path": "fhir-persistence/src/test/java/com/ibm/fhir/persistence/search/test/AbstractSearchReferenceTest.java", "diffHunk": "@@ -34,22 +36,27 @@ protected void setTenant() throws Exception {\n         FHIRRequestContext.get().setTenantId(\"reference\");\n     }\n \n+    @BeforeClass\n+    public void createReference() throws FHIRException {\n+        String originalRequestUri = \"https://example.com/Patient/123\";\n+        FHIRRequestContext context = FHIRRequestContext.get();\n+        context.setOriginalRequestUri(originalRequestUri);\n+    }\n+\n     @Test\n     public void testSearchReference_Reference_relative() throws Exception {\n         // Reference by id really only works when the system knows which resource type(s)\n         // can be referenced from a given element.\n-        // TODO does this work if you define the extension in a StructureDefinition\n-        // and declare the allowed types?\n-//        assertSearchReturnsSavedResource(\"Reference-relative\", \"123\");\n-\n         assertSearchReturnsSavedResource(\"Reference-relative\", \"Patient/123\");\n+        assertSearchReturnsSavedResource(\"Reference-relative\", \"123\");\n \n-        // TODO if this matched the hostname that the test was running on, would it work?\n-//        assertSearchReturnsSavedResource(\"Reference-relative\", \"https://example.com/Patient/123\");\n+        assertSearchReturnsSavedResource(\"Reference-relative\", \"https://example.com/Patient/123\");\n \n         assertSearchReturnsSavedResource(\"Reference-relative:Patient\", \"123\");\n-        assertSearchDoesntReturnSavedResource(\"Reference-relative:Basic\", \"123\");\n \n+        // Originally the following test was set to not return a value, as we are now using 123 as a valid value, it\n+        // does return the expected resource\n+        assertSearchReturnsSavedResource(\"Reference-relative:Basic\", \"123\");", "originalCommit": "5d193ceddbeac1a247263e84cb75863452da0a08", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUxODk3MQ==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r497518971", "bodyText": "that may be my fault... I'll double check this afternoon", "author": "prb112", "createdAt": "2020-09-30T13:42:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUxNzk0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQwMTAzNA==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r498401034", "bodyText": "fixed, I had to pass down the modified resource target", "author": "prb112", "createdAt": "2020-10-01T17:19:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUxNzk0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUyNDgxMA==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r497524810", "bodyText": "I think this was an inadvertent find/replace\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # Set this to INFO or higher to output the SQL statements and related debug info\n          \n          \n            \n            # Set this to FINE or higher to output the SQL statements and related debug info", "author": "lmsurpre", "createdAt": "2020-09-30T13:49:31Z", "path": "fhir-persistence/src/test/resources/logging.unitTest.properties", "diffHunk": "@@ -48,6 +48,6 @@ java.util.logging.ConsoleHandler.formatter = java.util.logging.SimpleFormatter\n # Provides extra control for each logger.\n ############################################################\n \n-# Set this to FINE or higher to output the SQL statements and related debug info\n+# Set this to INFO or higher to output the SQL statements and related debug info", "originalCommit": "5d193ceddbeac1a247263e84cb75863452da0a08", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bad8fd0cf8bd8bcfd304592040d27602126916af", "url": "https://github.com/IBM/FHIR/commit/bad8fd0cf8bd8bcfd304592040d27602126916af", "message": "Update fhir-persistence/src/test/resources/logging.unitTest.properties\r\n\r\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\nCo-authored-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-09-30T13:50:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUyNjY4Nw==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r497526687", "bodyText": "Given the other find/replace issue, I'm not sure if this change was intentional or not.  I think we should leave it at FINE so that you only need to change one place (below) to enable FINE logging to console.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            java.util.logging.ConsoleHandler.level = INFO\n          \n          \n            \n            java.util.logging.ConsoleHandler.level = FINE", "author": "lmsurpre", "createdAt": "2020-09-30T13:51:54Z", "path": "fhir-persistence/src/test/resources/logging.unitTest.properties", "diffHunk": "@@ -35,7 +35,7 @@ handlers= java.util.logging.ConsoleHandler\n ############################################################\n \n # Limit the messages that are printed to the console\n-java.util.logging.ConsoleHandler.level = FINE\n+java.util.logging.ConsoleHandler.level = INFO", "originalCommit": "5d193ceddbeac1a247263e84cb75863452da0a08", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUyOTc0NA==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r497529744", "bodyText": "minor formatting suggestion, take or leave:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return \"JobParameter [fhirResourceType=\" + fhirResourceType + \", fhirSearchFromDate=\" + fhirSearchFromDate + \", fhirTenant=\" + fhirTenant\n          \n          \n            \n                            + \", fhirDataStoreId=\" + fhirDataStoreId + \", fhirPatientGroupId=\" + fhirPatientGroupId + \", fhirTypeFilters=\" + fhirTypeFilters\n          \n          \n            \n                            + \", fhirExportFormat=\" + fhirExportFormat + \", inputs=\" + inputs + \", storageDetail=\" + storageDetail + \", incomingUrl=\" + incomingUrl\n          \n          \n            \n                            + \", cosBucketName=\" + cosBucketName + \", cosOperationBucketNameOo=\" + cosOperationBucketNameOo + \", cosLocation=\" + cosLocation\n          \n          \n            \n                            + \", cosEndpointUrl=\" + cosEndpointUrl + \", cosCredentialIbm=\" + cosCredentialIbm + \", cosApiKey=\" + cosApiKey + \", cosSrvInstId=\"\n          \n          \n            \n                            + cosSrvInstId + \", cosBucketPathPrefix=\" + cosBucketPathPrefix + \"]\";\n          \n          \n            \n                    return \"JobParameter [fhirResourceType=\" + fhirResourceType + \n          \n          \n            \n                            \", fhirSearchFromDate=\" + fhirSearchFromDate + \n          \n          \n            \n                            \", fhirTenant=\" + fhirTenant + \n          \n          \n            \n                            \", fhirDataStoreId=\" + fhirDataStoreId + \n          \n          \n            \n                            \", fhirPatientGroupId=\" + fhirPatientGroupId + \n          \n          \n            \n                            \", fhirTypeFilters=\" + fhirTypeFilters + \n          \n          \n            \n                            \", fhirExportFormat=\" + fhirExportFormat + \n          \n          \n            \n                            \", inputs=\" + inputs + \n          \n          \n            \n                            \", storageDetail=\" + storageDetail + \n          \n          \n            \n                            \", incomingUrl=\" + incomingUrl + \n          \n          \n            \n                            \", cosBucketName=\" + cosBucketName + \n          \n          \n            \n                            \", cosOperationBucketNameOo=\" + cosOperationBucketNameOo + \n          \n          \n            \n                            \", cosLocation=\" + cosLocation + \n          \n          \n            \n                            \", cosEndpointUrl=\" + cosEndpointUrl + \n          \n          \n            \n                            \", cosCredentialIbm=\" + cosCredentialIbm + \n          \n          \n            \n                            \", cosApiKey=\" + cosApiKey + \n          \n          \n            \n                            \", cosSrvInstId=\" + cosSrvInstId + \n          \n          \n            \n                            \", cosBucketPathPrefix=\" + cosBucketPathPrefix + \"]\";", "author": "lmsurpre", "createdAt": "2020-09-30T13:55:44Z", "path": "operation/fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/model/type/JobParameter.java", "diffHunk": "@@ -475,11 +500,11 @@ public static void parse(Builder builder, JsonObject obj) throws FHIROperationEx\n \n     @Override\n     public String toString() {\n-        return \"JobParameter [fhirResourceType=\" + fhirResourceType + \", fhirSearchFromDate=\" + fhirSearchFromDate\n-                + \", fhirTenant=\" + fhirTenant + \", fhirDataStoreId=\" + fhirDataStoreId + \", fhirPatientGroupId=\"\n-                + fhirPatientGroupId + \", fhirTypeFilters=\" + fhirTypeFilters + \", cosBucketName=\" + cosBucketName\n-                + \", cosLocation=\" + cosLocation + \", cosEndpointUrl=\" + cosEndpointUrl + \", cosCredentialIbm=\"\n-                + cosCredentialIbm + \", cosApiKey=\" + cosApiKey + \", cosSrvInstId=\" + cosSrvInstId\n-                + \", cosBucketPathPrefix=\" + cosBucketPathPrefix + \"]\";\n+        return \"JobParameter [fhirResourceType=\" + fhirResourceType + \", fhirSearchFromDate=\" + fhirSearchFromDate + \", fhirTenant=\" + fhirTenant\n+                + \", fhirDataStoreId=\" + fhirDataStoreId + \", fhirPatientGroupId=\" + fhirPatientGroupId + \", fhirTypeFilters=\" + fhirTypeFilters\n+                + \", fhirExportFormat=\" + fhirExportFormat + \", inputs=\" + inputs + \", storageDetail=\" + storageDetail + \", incomingUrl=\" + incomingUrl\n+                + \", cosBucketName=\" + cosBucketName + \", cosOperationBucketNameOo=\" + cosOperationBucketNameOo + \", cosLocation=\" + cosLocation\n+                + \", cosEndpointUrl=\" + cosEndpointUrl + \", cosCredentialIbm=\" + cosCredentialIbm + \", cosApiKey=\" + cosApiKey + \", cosSrvInstId=\"\n+                + cosSrvInstId + \", cosBucketPathPrefix=\" + cosBucketPathPrefix + \"]\";", "originalCommit": "bad8fd0cf8bd8bcfd304592040d27602126916af", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUzMTYyNA==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r497531624", "bodyText": "minor formatting suggestion\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Response response =\n          \n          \n            \n                            target.path(\"AllergyIntolerance\").queryParam(\"patient\", patientId).request(FHIRMediaType.APPLICATION_FHIR_JSON).header(\"X-FHIR-TENANT-ID\", tenantName).header(\"X-FHIR-DSID\", dataStoreId).get();\n          \n          \n            \n                    Response response = target.path(\"AllergyIntolerance\")\n          \n          \n            \n                            .queryParam(\"patient\", patientId)\n          \n          \n            \n                            .request(FHIRMediaType.APPLICATION_FHIR_JSON)\n          \n          \n            \n                            .header(\"X-FHIR-TENANT-ID\", tenantName)\n          \n          \n            \n                            .header(\"X-FHIR-DSID\", dataStoreId)\n          \n          \n            \n                            .get();", "author": "lmsurpre", "createdAt": "2020-09-30T13:58:05Z", "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/SearchTest.java", "diffHunk": "@@ -1474,4 +1474,22 @@ public void testSearchAllergyIntoleranceWithWildcardMultipleIncludedAndProvenceR\n         }\n     }\n \n-}\n+    @Test(groups = { \"server-search\" }, dependsOnMethods = { \"testCreateAllergyIntolerance\", \"testCreateProvenance\" })\n+    public void testSearchWithRelativePatientId() {\n+        WebTarget target = getWebTarget();\n+        Response response =\n+                target.path(\"AllergyIntolerance\").queryParam(\"patient\", patientId).request(FHIRMediaType.APPLICATION_FHIR_JSON).header(\"X-FHIR-TENANT-ID\", tenantName).header(\"X-FHIR-DSID\", dataStoreId).get();", "originalCommit": "bad8fd0cf8bd8bcfd304592040d27602126916af", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b8f9aee55eea00cff803279734e1a98e431fce43", "url": "https://github.com/IBM/FHIR/commit/b8f9aee55eea00cff803279734e1a98e431fce43", "message": "Update operation/fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/model/type/JobParameter.java\r\n\r\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\nCo-authored-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-09-30T14:26:32Z", "type": "commit"}, {"oid": "b45c3ff845483f9429a2e4ae06cf2ce9f16c072c", "url": "https://github.com/IBM/FHIR/commit/b45c3ff845483f9429a2e4ae06cf2ce9f16c072c", "message": "Update fhir-server-test/src/test/java/com/ibm/fhir/server/test/SearchTest.java\r\n\r\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\nCo-authored-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-09-30T14:26:43Z", "type": "commit"}, {"oid": "a5127bbf02383e01276eea0d0ad7f334a491d817", "url": "https://github.com/IBM/FHIR/commit/a5127bbf02383e01276eea0d0ad7f334a491d817", "message": "Update fhir-persistence/src/test/resources/logging.unitTest.properties\r\n\r\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\nCo-authored-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-09-30T14:26:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2NjIxNw==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r497566217", "bodyText": "sorry, missed this one on first pass.  the extra indent here is used here to distinguish this as a continuation of the method signature and not the first line of the method\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String queryParameterValueString) throws FHIRSearchException, Exception {\n          \n          \n            \n                        String queryParameterValueString) throws FHIRSearchException, Exception {", "author": "lmsurpre", "createdAt": "2020-09-30T14:42:05Z", "path": "fhir-search/src/main/java/com/ibm/fhir/search/util/SearchUtil.java", "diffHunk": "@@ -804,13 +805,13 @@ public static FHIRSearchContext parseQueryParameters(Class<?> resourceType,\n      * Common logic from handling a single queryParameterValueString based on its type\n      */\n     private static List<QueryParameterValue> processQueryParameterValueString(Class<?> resourceType, SearchParameter searchParameter, Modifier modifier,\n-            String queryParameterValueString) throws FHIRSearchException, Exception {\n+        String queryParameterValueString) throws FHIRSearchException, Exception {", "originalCommit": "a5127bbf02383e01276eea0d0ad7f334a491d817", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQwMDE5OA==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r498400198", "bodyText": "this should be fixed", "author": "prb112", "createdAt": "2020-10-01T17:18:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2NjIxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2NjkxMw==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r497566913", "bodyText": "the extra indent here is used to distinguish this as a continuation of the method signature and not the first line of the method\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    List<Type> compTypes, String queryParameterValuesString) throws FHIRSearchException {\n          \n          \n            \n                        List<Type> compTypes, String queryParameterValuesString) throws FHIRSearchException {", "author": "lmsurpre", "createdAt": "2020-09-30T14:42:56Z", "path": "fhir-search/src/main/java/com/ibm/fhir/search/util/SearchUtil.java", "diffHunk": "@@ -823,16 +824,16 @@ public static FHIRSearchContext parseQueryParameters(Class<?> resourceType,\n                     SearchParameter referencedParam = getSearchParameter(resourceType, component.getDefinition());\n                     compTypes.add(Type.fromValue(referencedParam.getType().getValue()));\n                 }\n-                queryParameterValues = parseCompositeQueryParameterValuesString(parameterCode, compTypes, queryParameterValueString);\n+                queryParameterValues = parseCompositeQueryParameterValuesString(searchParameter, parameterCode, compTypes, queryParameterValueString);\n             } else {\n-                queryParameterValues = parseQueryParameterValuesString(type, queryParameterValueString);\n+                queryParameterValues = parseQueryParameterValuesString(searchParameter, type, queryParameterValueString, null);\n             }\n         }\n         return queryParameterValues;\n     }\n \n-    private static List<QueryParameterValue> parseCompositeQueryParameterValuesString(String compositeParamCode, List<Type> compTypes,\n-            String queryParameterValuesString) throws FHIRSearchException {\n+    private static List<QueryParameterValue> parseCompositeQueryParameterValuesString(SearchParameter searchParameter, String compositeParamCode,\n+        List<Type> compTypes, String queryParameterValuesString) throws FHIRSearchException {", "originalCommit": "a5127bbf02383e01276eea0d0ad7f334a491d817", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2NzQ5Mw==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r497567493", "bodyText": "the extra indent here is used to distinguish this as a continuation of the method signature and not the first line of the method\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String queryParameterValuesString, String modifierResourceTypeName) throws FHIRSearchException {\n          \n          \n            \n                        String queryParameterValuesString, String modifierResourceTypeName) throws FHIRSearchException {", "author": "lmsurpre", "createdAt": "2020-09-30T14:43:41Z", "path": "fhir-search/src/main/java/com/ibm/fhir/search/util/SearchUtil.java", "diffHunk": "@@ -861,12 +862,13 @@ public static FHIRSearchContext parseQueryParameters(Class<?> resourceType,\n         return parameterValues;\n     }\n \n-    private static List<QueryParameterValue> parseQueryParameterValuesString(Type type,\n-            String queryParameterValuesString) throws FHIRSearchException {\n+    private static List<QueryParameterValue> parseQueryParameterValuesString(SearchParameter searchParameter, Type type,\n+        String queryParameterValuesString, String modifierResourceTypeName) throws FHIRSearchException {", "originalCommit": "a5127bbf02383e01276eea0d0ad7f334a491d817", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQwMDYzNA==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r498400634", "bodyText": "should be fixed", "author": "prb112", "createdAt": "2020-10-01T17:18:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2NzQ5Mw=="}], "type": "inlineReview"}, {"oid": "c3229b86a2ef138b5013e9699d640d257b4f72f1", "url": "https://github.com/IBM/FHIR/commit/c3229b86a2ef138b5013e9699d640d257b4f72f1", "message": "fix: reverted a change to relative test and support for modifier types\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-10-01T17:13:43Z", "type": "commit"}, {"oid": "b4ba6538a30300038f700a637a0dad7b0ecc6598", "url": "https://github.com/IBM/FHIR/commit/b4ba6538a30300038f700a637a0dad7b0ecc6598", "message": "Merge branch 'issue-300a' of github.com:IBM/FHIR into issue-300a", "committedDate": "2020-10-01T17:14:11Z", "type": "commit"}, {"oid": "d1e37d0dd8a9ee851bdb662b207be847ab9ccbc5", "url": "https://github.com/IBM/FHIR/commit/d1e37d0dd8a9ee851bdb662b207be847ab9ccbc5", "message": "Update fhir-search/src/main/java/com/ibm/fhir/search/util/SearchUtil.java\r\n\r\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\nCo-authored-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-01T17:18:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU1MTY3NA==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r499551674", "bodyText": "what does it do for parameters that can point at multiple different types?", "author": "lmsurpre", "createdAt": "2020-10-05T12:12:21Z", "path": "fhir-search/src/test/java/com/ibm/fhir/search/reference/ReferenceTypeTest.java", "diffHunk": "@@ -0,0 +1,141 @@\n+/*\n+ * (C) Copyright IBM Corp. 2020\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package com.ibm.fhir.search.reference;\n+\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertTrue;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import org.testng.annotations.Test;\n+\n+import com.ibm.fhir.search.parameters.QueryParameterValue;\n+import com.ibm.fhir.search.reference.value.CanonicalUrlHandlerImpl;\n+import com.ibm.fhir.search.reference.value.IdHandlerImpl;\n+import com.ibm.fhir.search.reference.value.TypeIdHandlerImpl;\n+import com.ibm.fhir.search.reference.value.UrlHandlerImpl;\n+\n+public class ReferenceTypeTest {", "originalCommit": "d1e37d0dd8a9ee851bdb662b207be847ab9ccbc5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU1Mjg5NA==", "url": "https://github.com/IBM/FHIR/pull/1524#discussion_r499552894", "bodyText": "The code matrixes the targets creating multiple Search Parameter Values", "author": "prb112", "createdAt": "2020-10-05T12:14:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU1MTY3NA=="}], "type": "inlineReview"}, {"oid": "eb0493419e5fdd68e18dbf8d6dd1b3d7f1d7ec20", "url": "https://github.com/IBM/FHIR/commit/eb0493419e5fdd68e18dbf8d6dd1b3d7f1d7ec20", "message": "doc: update the conformance document to indicate how references are treated\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-10-05T12:42:52Z", "type": "commit"}]}