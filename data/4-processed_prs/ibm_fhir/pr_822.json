{"pr_number": 822, "pr_title": "Enhance documentation for Db2 on Cloud Field Mapping #821", "pr_createdAt": "2020-03-20T12:36:24Z", "pr_url": "https://github.com/IBM/FHIR/pull/822", "timeline": [{"oid": "1d71db14942dc56a6db7f569f7b7a275aa9ecd85", "url": "https://github.com/IBM/FHIR/commit/1d71db14942dc56a6db7f569f7b7a275aa9ecd85", "message": "Enhance documentation for Db2 on Cloud Field Mapping #821\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-03-20T12:35:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjExMTcxNg==", "url": "https://github.com/IBM/FHIR/pull/822#discussion_r396111716", "bodyText": "I don't think this is right.  Instead, it should be the API Key generated for the user created in the FHIRUSER group (i.e. the IBMid user created from https://github.com/IBM/FHIR/blob/master/docs/src/pages/guides/DB2OnCloudSetup.md#fhirserver-user-and-api-key )", "author": "lmsurpre", "createdAt": "2020-03-22T16:18:29Z", "path": "docs/src/pages/guides/DB2OnCloudSetup.md", "diffHunk": "@@ -167,9 +167,45 @@ The FHIR server uses a proxy datasource mechanism, allowing new datasources to b\n         }\n ```\n \n-Note that no username properties are given, because the authentication module only requires the API-KEY.\n+#### Mapping from IBM Db2 on Cloud Endpoint Credentials\n \n+This section explains how to populate the FHIR datasource from IBM Db2 on Cloud configuration details from an example configuration: \n \n+**Example: Credential**\n+``` json\n+{\n+  \"hostname\": \"dashdb-enterprise-xxxxxxx.services.dal.bluemix.net\",\n+  \"password\": \"my-key\",\n+  \"https_url\": \"https://dashdb-enterprise-xxxxxxx.services.dal.bluemix.net\",\n+  \"port\": 50000,\n+  \"ssldsn\": \"DATABASE=BLUDB;HOSTNAME=dashdb-enterprise-xxxxxx.services.dal.bluemix.net;PORT=50001;PROTOCOL=TCPIP;UID=bluadmin;PWD=my-key;Security=SSL;\",\n+  \"host\": \"dashdb-enterprise-xxxxxxx.services.dal.bluemix.net\",\n+  \"jdbcurl\": \"jdbc:db2://dashdb-enterprise-xxxxxxx.services.dal.bluemix.net:50000/BLUDB\",\n+  \"uri\": \"db2://bluadmin:my-key@dashdb-enterprise-xxxxxxx.services.dal.bluemix.net:50000/BLUDB\",\n+  \"db\": \"BLUDB\",\n+  \"dsn\": \"DATABASE=BLUDB;HOSTNAME=dashdb-enterprise-xxxxxxx.services.dal.bluemix.net;PORT=50000;PROTOCOL=TCPIP;UID=bluadmin;PWD=my-key;\",\n+  \"username\": \"bluadmin\",\n+  \"ssljdbcurl\": \"jdbc:db2://dashdb-enterprise-xxxxxxx.services.dal.bluemix.net:50001/BLUDB:sslConnection=true;\"\n+}\n+```\n+\n+Use the following table to populate your datasource. \n+\n+| IBM FHIR Server Configuration  | Description |\n+|----|----|\n+| serverName | from the credential object select `hostname` |\n+| portNumber | from the credential object select  `port` |\n+| databaseName | from the credential object select  `db`, generally always `BLUDB` |\n+| apiKey | from the `password` field |", "originalCommit": "1d71db14942dc56a6db7f569f7b7a275aa9ecd85", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMyMzAwOA==", "url": "https://github.com/IBM/FHIR/pull/822#discussion_r399323008", "bodyText": "The new language looks good, thanks.", "author": "lmsurpre", "createdAt": "2020-03-27T14:53:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjExMTcxNg=="}], "type": "inlineReview"}, {"oid": "8c04231ce28075c0df97285e25c15c63e2430c77", "url": "https://github.com/IBM/FHIR/commit/8c04231ce28075c0df97285e25c15c63e2430c77", "message": "Enhance documentation for Db2 on Cloud Field Mapping #821\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-03-27T13:38:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMwMjc0Mw==", "url": "https://github.com/IBM/FHIR/pull/822#discussion_r399302743", "bodyText": "maybe we should explain where this file is by default?", "author": "lmsurpre", "createdAt": "2020-03-27T14:26:22Z", "path": "docs/src/pages/guides/DB2OnCloudSetup.md", "diffHunk": "@@ -98,28 +101,25 @@ You should now be able to connect to the database as the FHIRSERVER user using o\n \n The Db2 driver jar contains a main which can be executed to test the connection - very convenient for checking the API-key/Service-Id/Db2-User-Id configuration is correct.\n \n-```\n+``` bash\n java -cp /path/to/db2jcc4.jar com.ibm.db2.jcc.DB2Jcc  -url \"jdbc:db2://<DB2-HOSTNAME>:50001/BLUDB:apiKey=<API-KEY>;securityMechanism=15;sslConnection=true;sslTrustStoreLocation=/path/to/truststore.jks;sslTrustStorePassword=<TRUSTSTORE-PASSWORD>;\"\n-\n-\n-        <DB-HOSTNAME>: the hostname of your Db2 service from the Service Credentials page\n-            <API-KEY>: the API key value created in the previous section\n-<TRUSTSTORE-PASSWORD>: the password for your truststore\n-\n ```\n \n+- <DB-HOSTNAME>: the hostname of your Db2 service from the Service Credentials page\n+- <API-KEY>: the API key value created in the previous section\n+- <TRUSTSTORE-PASSWORD>: the password for your truststore\n+\n Notes:\n   1. Don't forget the trailing `;` in the URL. Some of the documented examples don't include it, but it is required in order for the connection to work, although this may be fixed in a future driver release. This only affects this test URL, not the actual FHIR server configuration.\n   2. When using an API Key, no username needs to be provided. This is because the API Key maps to a ServiceId, and that ServiceId is mapped to the Db2 user.\n \n ### Configuring a Liberty Datasource with API Key\n \n-The FHIR export feature utilizes Java Batch (JSR-352) provided by the batch-1.0 feature in Liberty Profile. The JPA persistence layer can be configured to use Db2 as follows:\n+The IBM FHIR Server Import/Export feature utilizes Java Batch (JSR-352) provided by the batch-1.0 feature in Liberty Profile. The persistence layer can be configured to use Db2 as follows:\n \n Create a Db2 user (e.g. FHIRBATCH) and associate it with a ServiceId (no need to create an Administration user, a simple user has sufficient privileges). Using a valid API-KEY for the given ServiceId, configure a new datasource and the Java Batch persistence layer as follows:\n \n-```\n-\n+``` xml", "originalCommit": "8c04231ce28075c0df97285e25c15c63e2430c77", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e66aa9947b77336c997df3c64f4d05894df5fba5", "url": "https://github.com/IBM/FHIR/commit/e66aa9947b77336c997df3c64f4d05894df5fba5", "message": "Enhance documentation for Db2 on Cloud Field Mapping #821\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-03-27T15:01:40Z", "type": "commit"}, {"oid": "fe21bfa0515490a800da3248be92241dd9d4d452", "url": "https://github.com/IBM/FHIR/commit/fe21bfa0515490a800da3248be92241dd9d4d452", "message": "Enhance documentation for Db2 on Cloud Field Mapping #821\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-03-27T15:24:21Z", "type": "commit"}]}