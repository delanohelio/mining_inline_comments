{"pr_number": 640, "pr_title": "Issue 223 - enable e2e db2 tests during Integration build", "pr_createdAt": "2020-01-28T13:56:22Z", "pr_url": "https://github.com/IBM/FHIR/pull/640", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxNzM1NQ==", "url": "https://github.com/IBM/FHIR/pull/640#discussion_r371817355", "bodyText": "Please update the copyright above to 2020", "author": "prb112", "createdAt": "2020-01-28T13:59:40Z", "path": "build/post-integration-test-docker.sh", "diffHunk": "@@ -18,33 +18,26 @@ rm -fr ${it_results} 2>/dev/null\n mkdir -p ${it_results}/server-logs\n mkdir -p ${it_results}/fhir-server-test\n \n-containerId=$(docker ps -a | grep fhir-test | cut -d ' ' -f 1)\n+containerId=$(docker ps -a | grep fhir | cut -d ' ' -f 1)", "originalCommit": "3fed86cd33e7c360cba9ffa4c07722037564732e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxNzYxOQ==", "url": "https://github.com/IBM/FHIR/pull/640#discussion_r371817619", "bodyText": "Why ol?", "author": "prb112", "createdAt": "2020-01-28T14:00:10Z", "path": "build/post-integration-test-docker.sh", "diffHunk": "@@ -18,33 +18,26 @@ rm -fr ${it_results} 2>/dev/null\n mkdir -p ${it_results}/server-logs\n mkdir -p ${it_results}/fhir-server-test\n \n-containerId=$(docker ps -a | grep fhir-test | cut -d ' ' -f 1)\n+containerId=$(docker ps -a | grep fhir | cut -d ' ' -f 1)\n if [[ -z \"${containerId}\" ]]; then\n-    echo \"Warning: Could not find fhir-test container!!!\"\n+    echo \"Warning: Could not find fhir container!!!\"\n else\n-    echo \"fhir-test container id: $containerId\"\n+    echo \"fhir container id: $containerId\"\n \n     # Grab the container's console log\n     docker logs $containerId  >& ${it_results}/docker-console.txt\n \n     echo \"Gathering pre-test server logs from docker container: $containerId\"\n-    docker cp -L $containerId:/opt/ibm/fhir-server/wlp/usr/servers/fhir-server/logs ${it_results}/server-logs\n+    docker cp -L $containerId:/opt/ol/wlp/usr/servers/fhir-server/logs ${it_results}/server-logs", "originalCommit": "3fed86cd33e7c360cba9ffa4c07722037564732e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgyMTg3OA==", "url": "https://github.com/IBM/FHIR/pull/640#discussion_r371821878", "bodyText": "read through... it's a-ok now.", "author": "prb112", "createdAt": "2020-01-28T14:08:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxNzYxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzMzk2Ng==", "url": "https://github.com/IBM/FHIR/pull/640#discussion_r371833966", "bodyText": "ol = openliberty, thats where the openliberty image installs liberty", "author": "lmsurpre", "createdAt": "2020-01-28T14:28:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxNzYxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxODg4MQ==", "url": "https://github.com/IBM/FHIR/pull/640#discussion_r371818881", "bodyText": "copyright", "author": "prb112", "createdAt": "2020-01-28T14:02:42Z", "path": "fhir-install/docker/volumes/scripts/deploy-fhir.sh", "diffHunk": "@@ -5,9 +5,6 @@\n # SPDX-License-Identifier: Apache-2.0\n ###############################################################################\n \n-rm -fr ~/fhir-installer\n-rm -fr /opt/ibm/fhir-server\n-unzip ~/dist/fhir-server-distribution.zip -d ~/fhir-installer\n-export JAVA_HOME=/opt/ibm/fhir-server/wlp/ibm-java-x86_64-80\n-export PATH=$JAVA_HOME/bin:$PATH\n-~/fhir-installer/fhir-server-dist/install.sh /opt/ibm/fhir-server\n+rm -rf /tmp/fhir-installer", "originalCommit": "3fed86cd33e7c360cba9ffa4c07722037564732e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxOTgyMQ==", "url": "https://github.com/IBM/FHIR/pull/640#discussion_r371819821", "bodyText": "switch to\n#!/usr/bin/env bash", "author": "prb112", "createdAt": "2020-01-28T14:04:37Z", "path": "fhir-install/docker/deploySchemaAndTenant.sh", "diffHunk": "@@ -0,0 +1,25 @@\n+#!/bin/bash", "originalCommit": "05bdebb4abad486deb0c21bf68a426b26775902c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgyMDE2NA==", "url": "https://github.com/IBM/FHIR/pull/640#discussion_r371820164", "bodyText": "If we increment the version, it could be a pain to pick this up.\nMaybe pickup version somewhere else?", "author": "prb112", "createdAt": "2020-01-28T14:05:19Z", "path": "fhir-install/docker/deploySchemaAndTenant.sh", "diffHunk": "@@ -0,0 +1,25 @@\n+#!/bin/bash\n+###############################################################################\n+# (C) Copyright IBM Corp. 2020\n+#\n+# SPDX-License-Identifier: Apache-2.0\n+###############################################################################\n+set -ex\n+\n+java -jar volumes/schema/fhir-persistence-schema-4.0.1-SNAPSHOT-cli.jar \\", "originalCommit": "05bdebb4abad486deb0c21bf68a426b26775902c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzNDUxNQ==", "url": "https://github.com/IBM/FHIR/pull/640#discussion_r371834515", "bodyText": "i think we could use a * in the jar name if you're comfortable with that", "author": "lmsurpre", "createdAt": "2020-01-28T14:28:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgyMDE2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzODk4NA==", "url": "https://github.com/IBM/FHIR/pull/640#discussion_r371838984", "bodyText": "schema-*-SNAPSHOT?", "author": "prb112", "createdAt": "2020-01-28T14:35:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgyMDE2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzOTEyMg==", "url": "https://github.com/IBM/FHIR/pull/640#discussion_r371839122", "bodyText": "I think it makes sense - and it's controlled", "author": "prb112", "createdAt": "2020-01-28T14:35:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgyMDE2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTkyMTkxMg==", "url": "https://github.com/IBM/FHIR/pull/640#discussion_r371921912", "bodyText": "I was thinking fhir-persistence-schema-*-cli.jar, but if you want to restrict it to SNAPSHOTs just let me know.", "author": "lmsurpre", "createdAt": "2020-01-28T16:42:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgyMDE2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTkyOTA5Mg==", "url": "https://github.com/IBM/FHIR/pull/640#discussion_r371929092", "bodyText": "good point... I think you have the right approach.", "author": "prb112", "createdAt": "2020-01-28T16:54:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgyMDE2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgyMDU0NA==", "url": "https://github.com/IBM/FHIR/pull/640#discussion_r371820544", "bodyText": "no shell declaration #!/usr/bin/env bash", "author": "prb112", "createdAt": "2020-01-28T14:05:54Z", "path": "fhir-install/docker/create-database.sh", "diffHunk": "@@ -1,28 +1,28 @@\n-# \n-# (C) Copyright IBM Corp. 2019\n+#", "originalCommit": "05bdebb4abad486deb0c21bf68a426b26775902c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgyMTI3OQ==", "url": "https://github.com/IBM/FHIR/pull/640#discussion_r371821279", "bodyText": "copyright", "author": "prb112", "createdAt": "2020-01-28T14:07:05Z", "path": "fhir-install/docker/copy-test-operations.sh", "diffHunk": "@@ -8,4 +8,5 @@\n DIST=\"volumes/dist\"\n \n echo \"Copying test artifacts to install location...\"\n+mkdir -p ${DIST}/userlib", "originalCommit": "05bdebb4abad486deb0c21bf68a426b26775902c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgyMTU3NQ==", "url": "https://github.com/IBM/FHIR/pull/640#discussion_r371821575", "bodyText": "extra line", "author": "prb112", "createdAt": "2020-01-28T14:07:38Z", "path": "fhir-install/docker/Dockerfile-ol", "diffHunk": "@@ -0,0 +1,52 @@\n+# ----------------------------------------------------------------------------\n+# (C) Copyright IBM Corp. 2016, 2020\n+#\n+# SPDX-License-Identifier: Apache-2.0\n+# ----------------------------------------------------------------------------\n+\n+FROM openliberty/open-liberty as base\n+\n+ENV LICENSE accept\n+\n+USER root\n+RUN \\\n+  yum update -y && \\\n+  yum install -y unzip nmap-ncat && \\\n+  yum -y clean all\n+\n+USER 1001\n+COPY volumes/dist /dist\n+COPY volumes/scripts  /scripts\n+RUN unzip -qq /dist/fhir-server-distribution.zip -d /tmp && \\\n+    /tmp/fhir-server-dist/install-fhir.sh /opt/ol/wlp && \\\n+    rm -fr /opt/ol/wlp/usr/servers/fhir-server/config/* && \\\n+    cp -pr /dist/config/* /opt/ol/wlp/usr/servers/fhir-server/config/ && \\\n+    cp -pr /dist/userlib/* /opt/ol/wlp/usr/servers/fhir-server/userlib/\n+\n+", "originalCommit": "05bdebb4abad486deb0c21bf68a426b26775902c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjAwNTQ2Ng==", "url": "https://github.com/IBM/FHIR/pull/640#discussion_r372005466", "bodyText": "purposeful to separate the second FROM from the top half...something we do to reduce image size", "author": "lmsurpre", "createdAt": "2020-01-28T19:20:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgyMTU3NQ=="}], "type": "inlineReview"}, {"oid": "920707be6b6c0081a65128896e1263334e193e71", "url": "https://github.com/IBM/FHIR/commit/920707be6b6c0081a65128896e1263334e193e71", "message": "add detail to FHIRValidator javadoc\n\nbased on a user question about what is the behavior for\nresource-asserted profiles that are unknown to the server\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-01-28T14:12:16Z", "type": "commit"}, {"oid": "131868127976febce591b066b9ba373b92532723", "url": "https://github.com/IBM/FHIR/commit/131868127976febce591b066b9ba373b92532723", "message": "refactored docker integration tests to use db2\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-01-28T14:12:17Z", "type": "commit"}, {"oid": "83a184da978720288dc79e0c150bc101eed4e708", "url": "https://github.com/IBM/FHIR/commit/83a184da978720288dc79e0c150bc101eed4e708", "message": "update failing integration tests to avoid fallback to default dsid\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-01-28T14:16:31Z", "type": "commit"}, {"oid": "83a184da978720288dc79e0c150bc101eed4e708", "url": "https://github.com/IBM/FHIR/commit/83a184da978720288dc79e0c150bc101eed4e708", "message": "update failing integration tests to avoid fallback to default dsid\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-01-28T14:16:31Z", "type": "forcePushed"}, {"oid": "7c507a78de9e9f50c8284991aeb5ed39419a6baa", "url": "https://github.com/IBM/FHIR/commit/7c507a78de9e9f50c8284991aeb5ed39419a6baa", "message": "update copyrights and use wildcard version per PR feedback\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-01-28T19:27:02Z", "type": "forcePushed"}, {"oid": "a406c43538bed37cff739493c731751828fa78aa", "url": "https://github.com/IBM/FHIR/commit/a406c43538bed37cff739493c731751828fa78aa", "message": "update copyrights and use wildcard version per PR feedback\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-01-28T19:28:50Z", "type": "forcePushed"}, {"oid": "41ad9ba01f8d440902d10a64ccec92f183ba63b5", "url": "https://github.com/IBM/FHIR/commit/41ad9ba01f8d440902d10a64ccec92f183ba63b5", "message": "update copyrights and use wildcard version per PR feedback\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-01-28T19:46:07Z", "type": "forcePushed"}, {"oid": "84efd89c3739ac13692cf312d995fcce10204adf", "url": "https://github.com/IBM/FHIR/commit/84efd89c3739ac13692cf312d995fcce10204adf", "message": "update copyrights and use wildcard version per PR feedback\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-01-28T19:57:53Z", "type": "commit"}, {"oid": "84efd89c3739ac13692cf312d995fcce10204adf", "url": "https://github.com/IBM/FHIR/commit/84efd89c3739ac13692cf312d995fcce10204adf", "message": "update copyrights and use wildcard version per PR feedback\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-01-28T19:57:53Z", "type": "forcePushed"}]}