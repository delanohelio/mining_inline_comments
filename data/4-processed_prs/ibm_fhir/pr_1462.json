{"pr_number": 1462, "pr_title": "feat: US-Core: Upgrade to STU3 Release 3.1.1 #1311 #1427", "pr_createdAt": "2020-08-31T18:25:29Z", "pr_url": "https://github.com/IBM/FHIR/pull/1462", "timeline": [{"oid": "5bf73281e5dba3b1c6b4c0c3a1220739204b0250", "url": "https://github.com/IBM/FHIR/commit/5bf73281e5dba3b1c6b4c0c3a1220739204b0250", "message": "feat: US-Core: Upgrade to STU3 Release 3.1.1 #1311 #1427\n\n- Added XML and JSON examples for fhir-ig-us-core and add entries in\nIndex.java\n- Added the specification artifacts and cleaned up the\nCapabilityStatements so CapabilityStatement.text contains valid XHTML\n- Updated the CHANGELOG with spec element changes\n- Update Tests for profile changes\n- Add fhir-examples to pom.xml for fhir-ig-us-core\n- Created Factory to run through the Spec Tests\n\t- Modified DiagnosticReport-cardiology-report.json and\nDiagnosticReport-cardiology-report.xml to corrected hash value\n\t- Modified MedicationRequest-uscore-mo2.xml and\nMedicationRequest-uscore-mo2.json (invalid xhtml)\nMedicationRequest-uscore-mo2.json as it contains invalid XHTML in the\nnarrative text\n- Added IT tests for:\n\t- USCoreAllergyIntoleranceTest - SHOULD/SHALL and REVINCLUDE\n\t- USCoreCarePlanTest - SHOULD/SHALL with one caveat the implication of\nsystem|code is not supported.  We support system less only.\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-08-31T18:19:09Z", "type": "commit"}, {"oid": "bef63607bd2452ae767dd4cba233af1e9f13b51a", "url": "https://github.com/IBM/FHIR/commit/bef63607bd2452ae767dd4cba233af1e9f13b51a", "message": "doc: updated the doc to indicate support for STU3.1.1\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-08-31T20:31:30Z", "type": "commit"}, {"oid": "1d8a28c7bf4d7bcbc14924bd8712402528c09629", "url": "https://github.com/IBM/FHIR/commit/1d8a28c7bf4d7bcbc14924bd8712402528c09629", "message": "Merge branch 'master' into issue-1427", "committedDate": "2020-09-01T17:05:24Z", "type": "commit"}, {"oid": "f39735264a1b1ce8f7edb67b30c5b5aac1c1491c", "url": "https://github.com/IBM/FHIR/commit/f39735264a1b1ce8f7edb67b30c5b5aac1c1491c", "message": "fix: US-Core: Create Integration Tests for STU3 Release 3.1.1\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-09-01T17:19:04Z", "type": "commit"}, {"oid": "1c0a2259e63a5fc52771431bec65b3efd1bdb547", "url": "https://github.com/IBM/FHIR/commit/1c0a2259e63a5fc52771431bec65b3efd1bdb547", "message": "feature: US-Core: Create Integration Tests for STU3 Release 3.1.1\n\n- Integration Test\n\t- USCoreCareTeamTest\n\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-09-01T18:45:31Z", "type": "commit"}, {"oid": "3ae0e6079131c4b8748d486a404ef1fd0f030ed2", "url": "https://github.com/IBM/FHIR/commit/3ae0e6079131c4b8748d486a404ef1fd0f030ed2", "message": "fix: SparkParquetWriterTest fails unexpectedly #1471\n\n- Disables the Unit Tests on Windows Build and Update windows.yml to\ncatch early Windows Build Errors\n- Update the automation to not skipTests\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-09-02T15:13:38Z", "type": "commit"}, {"oid": "99a7077573c4cb168ce26bb672bd8dcb1fb26433", "url": "https://github.com/IBM/FHIR/commit/99a7077573c4cb168ce26bb672bd8dcb1fb26433", "message": "Merge branch 'master' into issue-1427", "committedDate": "2020-09-02T15:31:51Z", "type": "commit"}, {"oid": "e78fe49522cedfea6ca60962fd5b6691b4ea53e5", "url": "https://github.com/IBM/FHIR/commit/e78fe49522cedfea6ca60962fd5b6691b4ea53e5", "message": "US-Core: Create Integration Tests for STU3 Release 3.1.1 #1311\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-09-02T15:35:07Z", "type": "commit"}, {"oid": "9a6b11cbeb9af4f36be4e77d3ddf068e29e0cc45", "url": "https://github.com/IBM/FHIR/commit/9a6b11cbeb9af4f36be4e77d3ddf068e29e0cc45", "message": "US-Core: Create Integration Tests for STU3 Release 3.1.1 #1311\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-09-02T15:40:23Z", "type": "commit"}, {"oid": "196480bf5347f781a2bfa85ea70fc8157fb43405", "url": "https://github.com/IBM/FHIR/commit/196480bf5347f781a2bfa85ea70fc8157fb43405", "message": "US-Core: Create Integration Tests for STU3 Release 3.1.1 #1311\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-09-02T15:49:12Z", "type": "commit"}, {"oid": "2b6bc86778b8820f1ca16bb2804a0a936e6cf60c", "url": "https://github.com/IBM/FHIR/commit/2b6bc86778b8820f1ca16bb2804a0a936e6cf60c", "message": "fix: add inline debugging\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-09-02T17:11:38Z", "type": "commit"}, {"oid": "e8cded39edf04c17fc6d4c00eebc44e007c071ce", "url": "https://github.com/IBM/FHIR/commit/e8cded39edf04c17fc6d4c00eebc44e007c071ce", "message": "fix: Change single test\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-09-02T17:16:28Z", "type": "commit"}, {"oid": "dc08fde2bd32427751567d0238db018d7fda5fe3", "url": "https://github.com/IBM/FHIR/commit/dc08fde2bd32427751567d0238db018d7fda5fe3", "message": "fix: debug issue on Windows integration tests\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-09-02T17:55:20Z", "type": "commit"}, {"oid": "433c3126121ade1e82eeca07d9b63832c91e16b4", "url": "https://github.com/IBM/FHIR/commit/433c3126121ade1e82eeca07d9b63832c91e16b4", "message": "fix: debug issue on Windows integration tests\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-09-02T18:23:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI4NDcxMA==", "url": "https://github.com/IBM/FHIR/pull/1462#discussion_r482284710", "bodyText": "unless you repeated the same set of changes, i wonder if we could just scrap this historic detail and just go with whatever changes you made to STU3.1.1 artifacts\nsomeone could check the git history if they really cared about what we did to the 3.1 artifacts that we no longer include...", "author": "lmsurpre", "createdAt": "2020-09-02T18:31:02Z", "path": "conformance/fhir-ig-us-core/CHANGELOG", "diffHunk": "@@ -1,5 +1,23 @@\n-Changed constraint provenance-1 in StructureDefinition-us-core-provenance.json from: ($this.agent.who.resolve().is Practitioner or Device) implies exists() to: ($this.agent.who.resolve().is(Practitioner) or $this.agent.who.resolve().is(Device)) implies exists() to correct a FHIRPath syntax error\n+# Version 1\n+- Changed constraint provenance-1 in StructureDefinition-us-core-provenance.json from: ($this.agent.who.resolve().is Practitioner or Device) implies exists() to: ($this.agent.who.resolve().is(Practitioner) or $this.agent.who.resolve().is(Device)) implies exists() to correct a FHIRPath syntax error\n     See: https://jira.hl7.org/browse/FHIR-27065 for more information\n+- Changed SearchParameter-us-core-procedure-date.json from Procedure.occurence to Procedure.performed\n+    See: https://jira.hl7.org/browse/FHIR-27887 for more information", "originalCommit": "433c3126121ade1e82eeca07d9b63832c91e16b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjMxMDM5Mg==", "url": "https://github.com/IBM/FHIR/pull/1462#discussion_r482310392", "bodyText": "Agree. Changes to the current version should be sufficient.", "author": "JohnTimm", "createdAt": "2020-09-02T18:58:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI4NDcxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjM3NzA0OA==", "url": "https://github.com/IBM/FHIR/pull/1462#discussion_r482377048", "bodyText": "10-4.  I'll clean this up.", "author": "prb112", "createdAt": "2020-09-02T19:56:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI4NDcxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjM4NzQ3Nw==", "url": "https://github.com/IBM/FHIR/pull/1462#discussion_r482387477", "bodyText": "Fixed", "author": "prb112", "createdAt": "2020-09-02T20:04:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI4NDcxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI5MjU5OQ==", "url": "https://github.com/IBM/FHIR/pull/1462#discussion_r482292599", "bodyText": "did we open a ticket at jira.hl7.org for this one?", "author": "lmsurpre", "createdAt": "2020-09-02T18:39:32Z", "path": "conformance/fhir-ig-us-core/CHANGELOG", "diffHunk": "@@ -1,5 +1,23 @@\n-Changed constraint provenance-1 in StructureDefinition-us-core-provenance.json from: ($this.agent.who.resolve().is Practitioner or Device) implies exists() to: ($this.agent.who.resolve().is(Practitioner) or $this.agent.who.resolve().is(Device)) implies exists() to correct a FHIRPath syntax error\n+# Version 1\n+- Changed constraint provenance-1 in StructureDefinition-us-core-provenance.json from: ($this.agent.who.resolve().is Practitioner or Device) implies exists() to: ($this.agent.who.resolve().is(Practitioner) or $this.agent.who.resolve().is(Device)) implies exists() to correct a FHIRPath syntax error\n     See: https://jira.hl7.org/browse/FHIR-27065 for more information\n+- Changed SearchParameter-us-core-procedure-date.json from Procedure.occurence to Procedure.performed\n+    See: https://jira.hl7.org/browse/FHIR-27887 for more information\n \n-Changed SearchParameter-us-core-procedure-date.json from Procedure.occurence to Procedure.performed\n-    See: https://jira.hl7.org/browse/FHIR-27887 for more information\n\\ No newline at end of file\n+# Version 2\n+Source - http://hl7.org/fhir/us/core/STU3.1.1/\n+- Removed 3.1.0 Artifacts\n+- Updated to 3.1.1 Artifacts STU3.1.1\n+- Moved the package.tgz's examples folder to the fhir-examples project\n+- Changed the text-generated for the CapabilityStatements CapabilityStatement-us-core-client.json and CapabilityStatement-us-core-server.json\n+    as the xhtml was invalid\n+- Per https://github.com/IBM/FHIR/issues/1460 Relaxed required to extensible\n+    - https://jira.hl7.org/browse/FHIR-27911 Change binding to UCUM from required to extensible + max binding UCUM\n+    - Per https://chat.fhir.org/#narrow/stream/179252-IG-creation/topic/US.20Core.20QA.20Issue.20.233-.20nasty.20profiling.20error\n+    - Changed Required to extensible for \n+        - \"id\": \"Observation.component:FlowRate.value[x]\",\n+        - \"id\": \"Observation.component:Concentration.code\",\n+- Modify MedicationRequest-uscore-mo2.json and MedicationRequest-uscore-mo2.xml to remove invalid XHTML\n+   - Any <p> (or other block-level element) will implicitly close any open <p>.\n+   - https://www.w3.org/TR/html401/struct/text.html#h-9.3.1\n+   - The P element represents a paragraph. It cannot contain block-level elements (including P itself).", "originalCommit": "433c3126121ade1e82eeca07d9b63832c91e16b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjM4OTk4MA==", "url": "https://github.com/IBM/FHIR/pull/1462#discussion_r482389980", "bodyText": "Yes, I've added them in  (I had only copied them to the Issue)\nFixed in Next one.", "author": "prb112", "createdAt": "2020-09-02T20:06:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI5MjU5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI5NDk3MA==", "url": "https://github.com/IBM/FHIR/pull/1462#discussion_r482294970", "bodyText": "did we need to generate our own .index.json file for US Core?  does it include an .index.json that just isn't valid or does it not even have one?", "author": "lmsurpre", "createdAt": "2020-09-02T18:42:08Z", "path": "conformance/fhir-ig-us-core/src/main/java/com/ibm/fhir/ig/us/core/util/IndexGenerator.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ * (C) Copyright IBM Corp. 2020\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.ibm.fhir.ig.us.core.util;\n+\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.FileOutputStream;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.io.OutputStream;\n+\n+import com.ibm.fhir.model.format.Format;\n+import com.ibm.fhir.model.parser.FHIRParser;\n+import com.ibm.fhir.model.parser.exception.FHIRParserException;\n+import com.ibm.fhir.model.resource.Resource;\n+import com.ibm.fhir.registry.util.Index;\n+import com.ibm.fhir.registry.util.Index.Entry;\n+\n+public class IndexGenerator {", "originalCommit": "433c3126121ade1e82eeca07d9b63832c91e16b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjMxMzAyNg==", "url": "https://github.com/IBM/FHIR/pull/1462#discussion_r482313026", "bodyText": "This is a net new file. The version in master does not have an IndexGenerator utility class. @prb112 does the latest. version not include a .index.json file?", "author": "JohnTimm", "createdAt": "2020-09-02T19:01:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI5NDk3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjM3NjMxMw==", "url": "https://github.com/IBM/FHIR/pull/1462#discussion_r482376313", "bodyText": "so - I totally own this one... I copied from a directory (. is hidden) so I had to generate the index.  I'll copy over the official one and remove the Generator.  This is on me.", "author": "prb112", "createdAt": "2020-09-02T19:56:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI5NDk3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjM5MDI4MA==", "url": "https://github.com/IBM/FHIR/pull/1462#discussion_r482390280", "bodyText": "Fixed (lesson learned on hidden files)", "author": "prb112", "createdAt": "2020-09-02T20:06:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI5NDk3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI5NjkxMQ==", "url": "https://github.com/IBM/FHIR/pull/1462#discussion_r482296911", "bodyText": "pretty minor, but this will be taken as javadoc for only PROFILES_US_CORE_JSON.  i'd suggest we either change it to a block comment (removing a single *) or just have one for each.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                /**\n          \n          \n            \n                 * US Core Examples in XML and JSON\n          \n          \n            \n                 */\n          \n          \n            \n                PROFILES_US_CORE_JSON(\"/profiles-us-core-json.txt\"),\n          \n          \n            \n                /*\n          \n          \n            \n                 * US Core Examples in XML and JSON\n          \n          \n            \n                 */\n          \n          \n            \n                PROFILES_US_CORE_JSON(\"/profiles-us-core-json.txt\"),", "author": "lmsurpre", "createdAt": "2020-09-02T18:44:18Z", "path": "fhir-examples/src/main/java/com/ibm/fhir/examples/Index.java", "diffHunk": "@@ -90,15 +101,28 @@\n      */\n     PROFILES_PDEX_PLAN_NET_JSON(\"/profiles-pdex-plan-net-json.txt\"),\n \n+    /**\n+     * US Core Examples in XML and JSON\n+     */\n+    PROFILES_US_CORE_JSON(\"/profiles-us-core-json.txt\"),", "originalCommit": "433c3126121ade1e82eeca07d9b63832c91e16b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjM4MjYzOQ==", "url": "https://github.com/IBM/FHIR/pull/1462#discussion_r482382639", "bodyText": "sometimes for comments like these I prefer the old-fashioned // to make it clear its not javadoc:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                /**\n          \n          \n            \n                 * US Core Examples in XML and JSON\n          \n          \n            \n                 */\n          \n          \n            \n                PROFILES_US_CORE_JSON(\"/profiles-us-core-json.txt\"),\n          \n          \n            \n                ///////////////////////////////////\n          \n          \n            \n                // US Core Examples in XML and JSON\n          \n          \n            \n                ///////////////////////////////////\n          \n          \n            \n                PROFILES_US_CORE_JSON(\"/profiles-us-core-json.txt\"),", "author": "lmsurpre", "createdAt": "2020-09-02T20:01:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI5NjkxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjM5NDc5Ng==", "url": "https://github.com/IBM/FHIR/pull/1462#discussion_r482394796", "bodyText": "Fixed locally and bundled into one PR", "author": "prb112", "createdAt": "2020-09-02T20:10:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI5NjkxMQ=="}], "type": "inlineReview"}, {"oid": "10451ed3b9447a8f5ac4688b528d1cc2a6c8887c", "url": "https://github.com/IBM/FHIR/commit/10451ed3b9447a8f5ac4688b528d1cc2a6c8887c", "message": "fix: per code review of the US Core STU 3.1.1\n\n- Fix the Workflow\n- Copied over the hidden .index.json to the us-core package\n- Removed the IndexGenerator (wasn't needed)\n- Cleaned up change log to include only what is relevant and necessary\n- Fixed up the index to not include javadoc\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-09-02T20:10:15Z", "type": "commit"}]}