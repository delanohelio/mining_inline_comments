{"pr_number": 1502, "pr_title": "issue #1500 validate resources in bundles just once", "pr_createdAt": "2020-09-11T00:43:48Z", "pr_url": "https://github.com/IBM/FHIR/pull/1502", "timeline": [{"oid": "33777741716112876736efb0f9c5f6baa2fe67ab", "url": "https://github.com/IBM/FHIR/commit/33777741716112876736efb0f9c5f6baa2fe67ab", "message": "issue #1500 validate resources in bundles just once\n\nSigned-off-by: Robin Arnold <robin.arnold23@ibm.com>", "committedDate": "2020-09-11T00:42:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAwMTM5MA==", "url": "https://github.com/IBM/FHIR/pull/1502#discussion_r487001390", "bodyText": "small comment, no action necessary, just awareness.\nit comes off as a double negative and makes it slightly less readable", "author": "prb112", "createdAt": "2020-09-11T12:08:18Z", "path": "fhir-server/src/main/java/com/ibm/fhir/server/resources/FHIRResource.java", "diffHunk": "@@ -59,6 +59,7 @@\n  */\n public class FHIRResource {\n     private static final Logger log = java.util.logging.Logger.getLogger(FHIRResource.class.getName());\n+    protected static final boolean NO_SKIP_VALIDATION = false; // do not skip validation", "originalCommit": "33777741716112876736efb0f9c5f6baa2fe67ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA2NjE5Ng==", "url": "https://github.com/IBM/FHIR/pull/1502#discussion_r487066196", "bodyText": "Yeah, I struggled with this myself...I have SKIP_VALIDATION in other places. I thought of DO_VALIDATION...but then the value would be false also, so that's just as confusing. No win.", "author": "punktilious", "createdAt": "2020-09-11T14:02:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAwMTM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODM0NjE2Mg==", "url": "https://github.com/IBM/FHIR/pull/1502#discussion_r488346162", "bodyText": "FWIW I find either SKIP_VALIDATION = false or DO_VALIDATION = true to be less confusing than NO_SKIP_VALIDATION = false", "author": "lmsurpre", "createdAt": "2020-09-15T02:33:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAwMTM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTExNTc4OQ==", "url": "https://github.com/IBM/FHIR/pull/1502#discussion_r489115789", "bodyText": "I've addressed this by taking John's suggestion of using a couple of default methods in the interface.", "author": "punktilious", "createdAt": "2020-09-16T01:58:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAwMTM5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAwMTg3MQ==", "url": "https://github.com/IBM/FHIR/pull/1502#discussion_r487001871", "bodyText": "Since this is used in two spots, perhaps it should be reconciled into one constant", "author": "prb112", "createdAt": "2020-09-11T12:09:19Z", "path": "fhir-server/src/main/java/com/ibm/fhir/server/util/FHIRRestHelper.java", "diffHunk": "@@ -100,7 +100,9 @@\n \n     private static final String EXTENSION_URL = \"http://ibm.com/fhir/extension\";\n     private static final String LOCAL_REF_PREFIX = \"urn:\";\n-\n+    private static final boolean SKIP_VALIDATION = true; // constant for when we want to avoid repeating validation\n+    private static final boolean NO_SKIP_VALIDATION = false; // do not skip validation", "originalCommit": "33777741716112876736efb0f9c5f6baa2fe67ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTExNTg3MA==", "url": "https://github.com/IBM/FHIR/pull/1502#discussion_r489115870", "bodyText": "cleaned up", "author": "punktilious", "createdAt": "2020-09-16T01:58:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAwMTg3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAwMjg4Mw==", "url": "https://github.com/IBM/FHIR/pull/1502#discussion_r487002883", "bodyText": "should it just be the validateInput(newResource)'s output not passing to a new arraylist?", "author": "prb112", "createdAt": "2020-09-11T12:11:17Z", "path": "fhir-server/src/main/java/com/ibm/fhir/server/util/FHIRRestHelper.java", "diffHunk": "@@ -382,7 +385,7 @@ private FHIRRestOperationResponse doPatchOrUpdate(String type, String id, FHIRPa\n             }\n \n             // Validate the input and, if valid, start collecting supplemental warnings\n-            List<Issue> warnings = new ArrayList<>(validateInput(newResource));\n+            List<Issue> warnings = skipValidation ? new ArrayList<>() : new ArrayList<>(validateInput(newResource));", "originalCommit": "33777741716112876736efb0f9c5f6baa2fe67ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA2OTA4MA==", "url": "https://github.com/IBM/FHIR/pull/1502#discussion_r487069080", "bodyText": "I wanted to keep the semantics the same as the old code. I thought that warnings might be added to later on, hence the need to put it into its own list (the validateInput could be immutable). I think a better pattern would be to create the list, then pass it in for example: validateInput(warnings, newResource); The validateInput method could simply return the number of warnings it added.", "author": "punktilious", "createdAt": "2020-09-11T14:07:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAwMjg4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAwMzMzNw==", "url": "https://github.com/IBM/FHIR/pull/1502#discussion_r487003337", "bodyText": "should we drop this line?", "author": "prb112", "createdAt": "2020-09-11T12:12:18Z", "path": "operation/fhir-operation-document/src/main/java/com/ibm/fhir/operation/document/DocumentOperation.java", "diffHunk": "@@ -76,7 +76,7 @@ protected Parameters doInvoke(FHIROperationContext operationContext, Class<? ext\n                     \n                     if (persist) {\n                         // FHIRResourceHelper resourceHelper = (FHIRResourceHelper) operationContext.getProperty(FHIROperationContext.PROPNAME_RESOURCE_HELPER;", "originalCommit": "33777741716112876736efb0f9c5f6baa2fe67ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "69b90b1dfd1517980ba057a7885539371f3d32c8", "url": "https://github.com/IBM/FHIR/commit/69b90b1dfd1517980ba057a7885539371f3d32c8", "message": "issue #1500 address review comments to simplify bool constants\n\nSigned-off-by: Robin Arnold <robin.arnold23@ibm.com>", "committedDate": "2020-09-16T00:04:27Z", "type": "commit"}, {"oid": "653c3a5baa8615c51f35fc9e1778f14e6118e5cc", "url": "https://github.com/IBM/FHIR/commit/653c3a5baa8615c51f35fc9e1778f14e6118e5cc", "message": "issue #1500 review comments fixing doCreate\n\nSigned-off-by: Robin Arnold <robin.arnold23@ibm.com>", "committedDate": "2020-09-16T01:32:16Z", "type": "commit"}]}