{"pr_number": 847, "pr_title": "--add-tenant-key missing in docs #846", "pr_createdAt": "2020-03-24T17:58:08Z", "pr_url": "https://github.com/IBM/FHIR/pull/847", "timeline": [{"oid": "ce22f305bcfc44f8f2c91e04e9fa412ca5913030", "url": "https://github.com/IBM/FHIR/commit/ce22f305bcfc44f8f2c91e04e9fa412ca5913030", "message": "--add-tenant-key missing in docs #846\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-03-24T17:57:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM1OTI0NA==", "url": "https://github.com/IBM/FHIR/pull/847#discussion_r397359244", "bodyText": "The other snippets in this README use default as the tenant name.\nI think we should either do the same here (or update everywhere to TENANT_NAME).", "author": "lmsurpre", "createdAt": "2020-03-24T18:06:23Z", "path": "fhir-persistence-schema/README.md", "diffHunk": "@@ -141,6 +141,23 @@ Edit `wlp/usr/servers/fhir-server/config/default/fhir-server-config.json` and ad\n --tenant-key \"<the-base64-tenant-key>\"\n ```\n \n+### Add a Key to Existing Tenant\n+To add a tenant key for an existing tenant, replace FHIRDATA with your client schema, and TENANT_NAME with your tenant's name. \n+\n+```\n+--prop-file db2.properties\n+--schema-name FHIRDATA\n+--add-tenant-key TENANT_NAME", "originalCommit": "ce22f305bcfc44f8f2c91e04e9fa412ca5913030", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM2MDI4NQ==", "url": "https://github.com/IBM/FHIR/pull/847#discussion_r397360285", "bodyText": "do we have info about when is needed to add a key to existing tenant? and how to delete the old tenant key if need etc.", "author": "albertwang-ibm", "createdAt": "2020-03-24T18:08:05Z", "path": "fhir-persistence-schema/README.md", "diffHunk": "@@ -141,6 +141,23 @@ Edit `wlp/usr/servers/fhir-server/config/default/fhir-server-config.json` and ad\n --tenant-key \"<the-base64-tenant-key>\"\n ```\n \n+### Add a Key to Existing Tenant\n+To add a tenant key for an existing tenant, replace FHIRDATA with your client schema, and TENANT_NAME with your tenant's name. \n+", "originalCommit": "ce22f305bcfc44f8f2c91e04e9fa412ca5913030", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM3MjM4Mg==", "url": "https://github.com/IBM/FHIR/pull/847#discussion_r397372382", "bodyText": "I actually had the same thought.  I don't think there is a function to remove a prior key, but I think there should be.", "author": "lmsurpre", "createdAt": "2020-03-24T18:27:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM2MDI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM3ODE3Ng==", "url": "https://github.com/IBM/FHIR/pull/847#discussion_r397378176", "bodyText": "I can add a comment on this.", "author": "prb112", "createdAt": "2020-03-24T18:37:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM2MDI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM3OTY0Mg==", "url": "https://github.com/IBM/FHIR/pull/847#discussion_r397379642", "bodyText": "We only have allocate and drop and add", "author": "prb112", "createdAt": "2020-03-24T18:39:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM2MDI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM4MDUzMQ==", "url": "https://github.com/IBM/FHIR/pull/847#discussion_r397380531", "bodyText": "thoughts?", "author": "prb112", "createdAt": "2020-03-24T18:41:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM2MDI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM4NDU4Nw==", "url": "https://github.com/IBM/FHIR/pull/847#discussion_r397384587", "bodyText": "allocateTenant will add the tenant and also create a tenant key.\ndoes dropTenant drop all tenant keys? I guess it should.\ndid Robin add the add key for existing tenant feature for security reason? e.g, the tenant key is expose, so need a new key for the tenant ... if so, I think, we do need a command to remove the key ...  and I guess, all the tenant keys of a tenant can work to access the tenant, so if don't delete the old key could bring security issue. ...", "author": "albertwang-ibm", "createdAt": "2020-03-24T18:48:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM2MDI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM4NjM1Mg==", "url": "https://github.com/IBM/FHIR/pull/847#discussion_r397386352", "bodyText": "or it could be that, Robin added this feature just in case the old tenant key is missed/forgotten, but we still want to access that tenant, so this make it handy for us to just create a new key for the tenant and then use it to access the tenant ...", "author": "albertwang-ibm", "createdAt": "2020-03-24T18:51:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM2MDI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM5MzM0NA==", "url": "https://github.com/IBM/FHIR/pull/847#discussion_r397393344", "bodyText": "dropTenant does not remove a key.  it just change the tenant status and removes the partition.  add-tenant-key was for key rotation (except there are NO delete-key features)", "author": "prb112", "createdAt": "2020-03-24T19:02:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM2MDI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQwOTkxNg==", "url": "https://github.com/IBM/FHIR/pull/847#discussion_r397409916", "bodyText": "ha, I see. then I think if possible, we need:\n(1) add removing all the tenant keys function in dropTenant, otherwise they are just useless garbage data after the tenant is dropped.\n(2) add remove key command, use tenant name and key as parameter.\nAnd as I remember, the tenant key itself is not stored in DB, but the hash with a salt of the key is stored in db instead, so we will need to remove the hash from the table instead...", "author": "albertwang-ibm", "createdAt": "2020-03-24T19:32:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM2MDI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQxMDA3Mg==", "url": "https://github.com/IBM/FHIR/pull/847#discussion_r397410072", "bodyText": "but anyway, I'm OK with this document change.", "author": "albertwang-ibm", "createdAt": "2020-03-24T19:32:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM2MDI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQxNDk2Mg==", "url": "https://github.com/IBM/FHIR/pull/847#discussion_r397414962", "bodyText": "it's best to leave it.  I think it's good audit data, and ensures the id is not re-used.", "author": "prb112", "createdAt": "2020-03-24T19:41:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM2MDI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQxNTE3MQ==", "url": "https://github.com/IBM/FHIR/pull/847#discussion_r397415171", "bodyText": "I think remove key should be added, that's fairly easy to use.  If agreed, we can create an issue to track", "author": "prb112", "createdAt": "2020-03-24T19:42:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM2MDI4NQ=="}], "type": "inlineReview"}, {"oid": "f33cde3938e80ef308e8eb51ba71754c4b5d8f75", "url": "https://github.com/IBM/FHIR/commit/f33cde3938e80ef308e8eb51ba71754c4b5d8f75", "message": "--add-tenant-key missing in docs #846\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-03-24T18:41:03Z", "type": "commit"}]}