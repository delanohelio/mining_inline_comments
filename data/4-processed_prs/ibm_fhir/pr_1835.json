{"pr_number": 1835, "pr_title": "ci: introduce integration tests for fhir-audit", "pr_createdAt": "2020-12-17T00:54:40Z", "pr_url": "https://github.com/IBM/FHIR/pull/1835", "timeline": [{"oid": "a2e4d3469dcfcf7b9506074cc720ebf1ac8567ec", "url": "https://github.com/IBM/FHIR/commit/a2e4d3469dcfcf7b9506074cc720ebf1ac8567ec", "message": "ci: introduce integration tests for fhir-audit\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-17T00:53:44Z", "type": "commit"}, {"oid": "c2d23fc78efed3ed17ff22bd93fccc1516b48aea", "url": "https://github.com/IBM/FHIR/commit/c2d23fc78efed3ed17ff22bd93fccc1516b48aea", "message": "ci: introduce integration tests for fhir-audit\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-17T01:05:52Z", "type": "commit"}, {"oid": "0c381cb290d6509f9d1dc55083bea0b04c7e5c0e", "url": "https://github.com/IBM/FHIR/commit/0c381cb290d6509f9d1dc55083bea0b04c7e5c0e", "message": "ci: add integration tests for fhir-audit feature and fix one bug with use of/from\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-18T21:17:19Z", "type": "commit"}, {"oid": "de915b057bc5ecf451f72044383ddf0e5c057c94", "url": "https://github.com/IBM/FHIR/commit/de915b057bc5ecf451f72044383ddf0e5c057c94", "message": "fix: pseudo tty\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-18T21:38:26Z", "type": "commit"}, {"oid": "95b5f3cc69a62aca0177e309b78e2bea2983de69", "url": "https://github.com/IBM/FHIR/commit/95b5f3cc69a62aca0177e309b78e2bea2983de69", "message": "fix: small change to the timeout length to 120s\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-18T22:05:37Z", "type": "commit"}, {"oid": "07e59d9dbd50d2a71204f81d6bb5ee2814f6b771", "url": "https://github.com/IBM/FHIR/commit/07e59d9dbd50d2a71204f81d6bb5ee2814f6b771", "message": "fix: alternative method for getting the results from the kafka-1 container\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-19T00:40:36Z", "type": "commit"}, {"oid": "373a33bed737e608b0c002eeae1259095750921b", "url": "https://github.com/IBM/FHIR/commit/373a33bed737e608b0c002eeae1259095750921b", "message": "fix: alternative method for getting the results from the kafka-1 container\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-19T01:02:32Z", "type": "commit"}, {"oid": "28e3a225f69d6c387072092c9f070915588ee3d4", "url": "https://github.com/IBM/FHIR/commit/28e3a225f69d6c387072092c9f070915588ee3d4", "message": "fix: add get_results.sh creation of the directory\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-19T01:21:50Z", "type": "commit"}, {"oid": "8480d53b25d76b90595c5237b4bee2b86120e8ec", "url": "https://github.com/IBM/FHIR/commit/8480d53b25d76b90595c5237b4bee2b86120e8ec", "message": "fix: update\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-19T01:43:13Z", "type": "commit"}, {"oid": "0c8aec5a9d172cb6ac17016b96820071ab7c239f", "url": "https://github.com/IBM/FHIR/commit/0c8aec5a9d172cb6ac17016b96820071ab7c239f", "message": "fix: update\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-19T02:03:25Z", "type": "commit"}, {"oid": "1bb4051e180d15463312b70ecd5d6d6d5873e898", "url": "https://github.com/IBM/FHIR/commit/1bb4051e180d15463312b70ecd5d6d6d5873e898", "message": "fix: for privileged execution\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-19T14:29:32Z", "type": "commit"}, {"oid": "8f40b7fe09b13ee764fbcab03e294b08118223c8", "url": "https://github.com/IBM/FHIR/commit/8f40b7fe09b13ee764fbcab03e294b08118223c8", "message": "fix: difference running ci local and remote\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-19T19:26:46Z", "type": "commit"}, {"oid": "7397d51b40a7c53814d9fac72418a6792ad2893a", "url": "https://github.com/IBM/FHIR/commit/7397d51b40a7c53814d9fac72418a6792ad2893a", "message": "fix: audit\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-19T19:49:02Z", "type": "commit"}, {"oid": "660e0ed279d587fd4e712e2376e81df9153340f9", "url": "https://github.com/IBM/FHIR/commit/660e0ed279d587fd4e712e2376e81df9153340f9", "message": "fix: audit with docker copy\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-19T19:57:12Z", "type": "commit"}, {"oid": "93a841ec9bcaa22afcc6eff3f228f89304ff928e", "url": "https://github.com/IBM/FHIR/commit/93a841ec9bcaa22afcc6eff3f228f89304ff928e", "message": "fix: adding tty support and stdin support\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-20T00:32:08Z", "type": "commit"}, {"oid": "eb41738f6e29a35a602abf277762801b179eb1fe", "url": "https://github.com/IBM/FHIR/commit/eb41738f6e29a35a602abf277762801b179eb1fe", "message": "fix: work around tty issue\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-20T00:53:55Z", "type": "commit"}, {"oid": "051686e7d110176c0944fab133dc5f54ca4651cf", "url": "https://github.com/IBM/FHIR/commit/051686e7d110176c0944fab133dc5f54ca4651cf", "message": "removing the tty references -it\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-20T01:14:48Z", "type": "commit"}, {"oid": "57a84599ec6fe28bdb16592fa3e6badb95c8a3ed", "url": "https://github.com/IBM/FHIR/commit/57a84599ec6fe28bdb16592fa3e6badb95c8a3ed", "message": "changed the execution pattern\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-20T01:53:45Z", "type": "commit"}, {"oid": "7741957be26fbc9b697632039e7dc494401ca4b2", "url": "https://github.com/IBM/FHIR/commit/7741957be26fbc9b697632039e7dc494401ca4b2", "message": "changed the execution pattern\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-20T15:36:44Z", "type": "commit"}, {"oid": "f2e7926308e1fb71482b02ffbbf26ceab10b5bc0", "url": "https://github.com/IBM/FHIR/commit/f2e7926308e1fb71482b02ffbbf26ceab10b5bc0", "message": "fix: update to predefine output file\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-23T00:46:44Z", "type": "commit"}, {"oid": "2f6001df182bc81ce68d2c59a12445b3181d34ac", "url": "https://github.com/IBM/FHIR/commit/2f6001df182bc81ce68d2c59a12445b3181d34ac", "message": "fix: update to predefine output file\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-23T01:12:45Z", "type": "commit"}, {"oid": "9c8a29ee5974f420c1ac8b8f8f51290a9a2be3fa", "url": "https://github.com/IBM/FHIR/commit/9c8a29ee5974f420c1ac8b8f8f51290a9a2be3fa", "message": "fix permissions\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-23T01:31:33Z", "type": "commit"}, {"oid": "34d0f6e532c29e24a8a9f746686149aa3e73689d", "url": "https://github.com/IBM/FHIR/commit/34d0f6e532c29e24a8a9f746686149aa3e73689d", "message": "fix permissions\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-23T01:55:43Z", "type": "commit"}, {"oid": "ae794e96eb80e8e6c698f15597b08cb92a220407", "url": "https://github.com/IBM/FHIR/commit/ae794e96eb80e8e6c698f15597b08cb92a220407", "message": "fix permissions\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-23T01:57:19Z", "type": "commit"}, {"oid": "39c7ef6b4c2e2b70edc12fea2e12b93a004beee6", "url": "https://github.com/IBM/FHIR/commit/39c7ef6b4c2e2b70edc12fea2e12b93a004beee6", "message": "fix permissions\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-23T02:19:37Z", "type": "commit"}, {"oid": "7906ba7d1eb27f58012f04272ae963f2b8cdbdd6", "url": "https://github.com/IBM/FHIR/commit/7906ba7d1eb27f58012f04272ae963f2b8cdbdd6", "message": "fix permissions\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-23T14:41:17Z", "type": "commit"}, {"oid": "3ceea7613512109da1faf6794374c26a8e3e9145", "url": "https://github.com/IBM/FHIR/commit/3ceea7613512109da1faf6794374c26a8e3e9145", "message": "fix permissions\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-23T14:49:36Z", "type": "commit"}, {"oid": "f003467291d602304c3dc5c28d5f2afab9fc8105", "url": "https://github.com/IBM/FHIR/commit/f003467291d602304c3dc5c28d5f2afab9fc8105", "message": "ci: work around issue with tty\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2021-01-04T16:46:48Z", "type": "commit"}, {"oid": "d08d4b576075ab6434218dd7e964eaef1d2272c2", "url": "https://github.com/IBM/FHIR/commit/d08d4b576075ab6434218dd7e964eaef1d2272c2", "message": "ci: work around issue with tty\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2021-01-04T17:10:22Z", "type": "commit"}, {"oid": "35e6474d569a0bfeeef620c66a71981d9cdd50a3", "url": "https://github.com/IBM/FHIR/commit/35e6474d569a0bfeeef620c66a71981d9cdd50a3", "message": "fix: change the integration pattern slightly for tty\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2021-01-04T18:39:25Z", "type": "commit"}, {"oid": "4a19aed04008c63f111847f9e498f7e8d9142580", "url": "https://github.com/IBM/FHIR/commit/4a19aed04008c63f111847f9e498f7e8d9142580", "message": "fix: change the integration pattern slightly for tty\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2021-01-04T19:10:10Z", "type": "commit"}, {"oid": "49a709da8fabfe1ec3f95158b79c8a0bed812223", "url": "https://github.com/IBM/FHIR/commit/49a709da8fabfe1ec3f95158b79c8a0bed812223", "message": "fix: change the integration pattern slightly for tty\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2021-01-04T20:14:12Z", "type": "commit"}, {"oid": "5a517d1c402fa5c4fd88b73521a7825c618881e2", "url": "https://github.com/IBM/FHIR/commit/5a517d1c402fa5c4fd88b73521a7825c618881e2", "message": "Merge branch 'master' of github.com:IBM/FHIR", "committedDate": "2021-01-04T21:05:06Z", "type": "commit"}, {"oid": "096f1b49c6f749af23085d98985eead7e541c688", "url": "https://github.com/IBM/FHIR/commit/096f1b49c6f749af23085d98985eead7e541c688", "message": "Merge branch 'master' into ci-fhir-audit", "committedDate": "2021-01-04T21:05:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTU4Njg3OA==", "url": "https://github.com/IBM/FHIR/pull/1835#discussion_r551586878", "bodyText": "typo and a bit akward\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The GitHub Action is parameterized with a matrix for each new audits. Each additional entry in the array ends up greating a multiple of the automation steps which must complete successfully for the workflow. For instance, kafka is parameterized and executes a job for each audit layer value in the matrix (one java x one audit = 1 workflow job). \n          \n          \n            \n            The GitHub Action is parameterized with a matrix for each new audits. Each additional entry in the array ends up creating multiple automation steps which must complete successfully for the workflow. For instance, kafka is parameterized and executes a job for each audit layer value in the matrix (one java x one audit = 1 workflow job).", "author": "lmsurpre", "createdAt": "2021-01-04T21:45:56Z", "path": "build/audit/README.md", "diffHunk": "@@ -0,0 +1,53 @@\n+# End-to-End Automation Framework for FHIR Audit Integration Tests\n+\n+This document outlines the end-to-end audit automation framework. \n+\n+The automation runs with these steps: \n+\n+- **Checkout source code** - Checks out the git code and populates the `github` environment variables.\n+- **Set up java** - Downloads and setup java based on the matrix values `matrix.java`.\n+- **Setup prerequisites** - This step builds the required artifacts necessary to test the build with the audit. \n+- **Server Integration Tests - Additional audit Layers** - The step executes the pre-integration-docker, then integration-test-docker and runs the post-integration-docker scripts.\n+- **Gather error logs** - This step only runs upon an error condition. \n+- **Upload logs** - The step uploads the results of the integration tests and the error condition logs are posted to the job. \n+\n+The GitHub Action is parameterized with a matrix for each new audits. Each additional entry in the array ends up greating a multiple of the automation steps which must complete successfully for the workflow. For instance, kafka is parameterized and executes a job for each audit layer value in the matrix (one java x one audit = 1 workflow job). ", "originalCommit": "096f1b49c6f749af23085d98985eead7e541c688", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "67a543d2d0b9ac49e32064af31dfc160b0905d03", "url": "https://github.com/IBM/FHIR/commit/67a543d2d0b9ac49e32064af31dfc160b0905d03", "message": "Update build/audit/README.md\r\n\r\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\nCo-authored-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2021-01-04T22:00:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTYwMTA3OA==", "url": "https://github.com/IBM/FHIR/pull/1835#discussion_r551601078", "bodyText": "how close does this need to be to our kafka client dependency version?\nassuming they should match, we'll want to somehow remember this version is hardcoded here...", "author": "lmsurpre", "createdAt": "2021-01-04T22:14:44Z", "path": "build/audit/kafka/integration-test.sh", "diffHunk": "@@ -0,0 +1,62 @@\n+#!/usr/bin/env bash\n+\n+###############################################################################\n+# (C) Copyright IBM Corp. 2020\n+#\n+# SPDX-License-Identifier: Apache-2.0\n+###############################################################################\n+\n+set -o errexit\n+set -o nounset\n+set -o pipefail\n+\n+# downloads and extracts kafka to a directory\n+download(){\n+    if [ ! -f ${WORKSPACE}/build/audit/kafka/workarea/kafka.tgz ]\n+    then \n+        curl -L -o ${WORKSPACE}/build/audit/kafka/workarea/kafka.tgz http://www-us.apache.org/dist/kafka/2.7.0/kafka_2.13-2.7.0.tgz", "originalCommit": "67a543d2d0b9ac49e32064af31dfc160b0905d03", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTYwNzgxOQ==", "url": "https://github.com/IBM/FHIR/pull/1835#discussion_r551607819", "bodyText": "It doesn't I left this in here... but I don't think we'll really need it - it's a easy way to flip back to downloading rather than running in docker", "author": "prb112", "createdAt": "2021-01-04T22:30:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTYwMTA3OA=="}], "type": "inlineReview"}]}