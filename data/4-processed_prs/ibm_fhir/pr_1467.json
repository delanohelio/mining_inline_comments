{"pr_number": 1467, "pr_title": "Issue #1421 - update code validation to enforce new validation rules", "pr_createdAt": "2020-09-01T14:49:45Z", "pr_url": "https://github.com/IBM/FHIR/pull/1467", "timeline": [{"oid": "74affa6c3502dec716e51d2b2d32ddf6ab64b296", "url": "https://github.com/IBM/FHIR/commit/74affa6c3502dec716e51d2b2d32ddf6ab64b296", "message": "Issue #1421 - update code validation to enforce new validation rules\n\nSigned-off-by: Mike Schroeder <mschroed@us.ibm.com>", "committedDate": "2020-09-01T14:48:10Z", "type": "commit"}, {"oid": "1c110f88085895e9e2a4c79a01b1e59c055ad1be", "url": "https://github.com/IBM/FHIR/commit/1c110f88085895e9e2a4c79a01b1e59c055ad1be", "message": "Issue #1421 - update carin-bb test for new validation warnings\n\nSigned-off-by: Mike Schroeder <mschroed@us.ibm.com>", "committedDate": "2020-09-01T15:42:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTI5NzYxNw==", "url": "https://github.com/IBM/FHIR/pull/1467#discussion_r481297617", "bodyText": "because our object are immutable, you could actually \"cheat\" and re-use the same one in multiple places.\nstill, thats an optimization that probably isn't needed in the example generator, just wanted to make you aware of the possibility", "author": "lmsurpre", "createdAt": "2020-09-01T17:01:31Z", "path": "fhir-examples-generator/src/main/java/com/ibm/fhir/examples/DataCreatorBase.java", "diffHunk": "@@ -237,6 +239,16 @@ protected Object createArgument(Class<?> owningClass, Method builderMethod, Clas\n         return builder.extension(e);\n     }\n \n+    protected CodeableConcept.Builder setDataAbsentReasonCoding(CodeableConcept.Builder builder) {\n+        Coding coding = Coding.builder()\n+                .extension(Extension.builder()\n+                .url(\"http://hl7.org/fhir/StructureDefinition/data-absent-reason\")\n+                .value(Code.of(\"unknown\"))\n+                .build())\n+                .build();", "originalCommit": "1c110f88085895e9e2a4c79a01b1e59c055ad1be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM3NjAyNg==", "url": "https://github.com/IBM/FHIR/pull/1467#discussion_r481376026", "bodyText": "thanks for the tip!", "author": "michaelwschroeder", "createdAt": "2020-09-01T19:18:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTI5NzYxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMxNTczNA==", "url": "https://github.com/IBM/FHIR/pull/1467#discussion_r481315734", "bodyText": "does it also control whether we do syntax-based validation of UCUM and Language valuesets?", "author": "lmsurpre", "createdAt": "2020-09-01T17:33:20Z", "path": "fhir-model/src/main/java/com/ibm/fhir/model/config/FHIRModelConfig.java", "diffHunk": "@@ -39,10 +39,16 @@\n      */\n     public static final String PROPERTY_CHECK_REFERENCE_TYPES = \"com.ibm.fhir.model.checkReferenceTypes\";\n \n+    /**\n+     * Used to determine whether CodeableConcepts that don't contain both system and code are checked during object construction\n+     */\n+    public static final String PROPERTY_ADVANCED_CODEABLE_CONCEPT_VALIDATION = \"com.ibm.fhir.model.advancedCodeableConcepValidation\";", "originalCommit": "1c110f88085895e9e2a4c79a01b1e59c055ad1be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM3NjM0MQ==", "url": "https://github.com/IBM/FHIR/pull/1467#discussion_r481376341", "bodyText": "Yes. I've updated the prologue to reflect that.", "author": "michaelwschroeder", "createdAt": "2020-09-01T19:19:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMxNTczNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMxODM3OQ==", "url": "https://github.com/IBM/FHIR/pull/1467#discussion_r481318379", "bodyText": "This is a breaking change for this Java API. fhir-model is the one module where we are trying to keep some backwards-compatibility (e.g. see the project README at https://github.com/IBM/FHIR).\nCan we deprecate that old method and add the new one instead of the replace?", "author": "lmsurpre", "createdAt": "2020-09-01T17:38:05Z", "path": "fhir-model/src/main/java/com/ibm/fhir/model/util/ValidationSupport.java", "diffHunk": "@@ -604,19 +408,166 @@ public static void prohibited(Element element, String elementName) {\n     }\n \n     /**\n-     * @throws IllegalStateExeption if the codeableConcept has coding elements that do not include codes from the required binding\n+     * Check that the specified list of elements contain a code that is a member of the specified value set.\n+     * \n+     * @param elements\n+     *     the list of elements for which to check codes\n+     * @param elementName\n+     *     the name of the element\n+     * @param valueSet\n+     *     the URL of the value set to check membership against\n+     * @param system\n+     *     the value set system\n+     * @param codes\n+     *     the value set codes\n+     * @throws IllegalStateExeption if each element in the list does not include a code from the required value set\n      */\n-    public static void checkCodeableConcept(CodeableConcept codeableConcept, String elementName, String valueSet, String system, String... codes) {", "originalCommit": "1c110f88085895e9e2a4c79a01b1e59c055ad1be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM3NTg2MQ==", "url": "https://github.com/IBM/FHIR/pull/1467#discussion_r481375861", "bodyText": "Done.", "author": "michaelwschroeder", "createdAt": "2020-09-01T19:18:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMxODM3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMzMzQwMw==", "url": "https://github.com/IBM/FHIR/pull/1467#discussion_r481333403", "bodyText": "this method was never included in a release, so i think its fine to delete", "author": "lmsurpre", "createdAt": "2020-09-01T18:04:29Z", "path": "fhir-model/src/main/java/com/ibm/fhir/model/util/ValidationSupport.java", "diffHunk": "@@ -204,207 +209,6 @@ public static void checkUri(String s) {\n         }\n     }\n \n-    /**\n-     * Checks that each language code in the list has a valid BCP-47 syntax.\n-     * @param language the language code list\n-     * @param elementName the element name\n-     * @throws IllegalStateException if the passed language code list is not valid\n-     */\n-    public static void checkLanguageCodes(List<Code> languages, String elementName) {", "originalCommit": "1c110f88085895e9e2a4c79a01b1e59c055ad1be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMzMzQ4OA==", "url": "https://github.com/IBM/FHIR/pull/1467#discussion_r481333488", "bodyText": "this method was never included in a release, so i think its fine to delete", "author": "lmsurpre", "createdAt": "2020-09-01T18:04:37Z", "path": "fhir-model/src/main/java/com/ibm/fhir/model/util/ValidationSupport.java", "diffHunk": "@@ -204,207 +209,6 @@ public static void checkUri(String s) {\n         }\n     }\n \n-    /**\n-     * Checks that each language code in the list has a valid BCP-47 syntax.\n-     * @param language the language code list\n-     * @param elementName the element name\n-     * @throws IllegalStateException if the passed language code list is not valid\n-     */\n-    public static void checkLanguageCodes(List<Code> languages, String elementName) {\n-        if (languages != null) {\n-            for (Code language : languages) {\n-                checkLanguageCode(language, elementName);\n-            }\n-        }\n-    }\n-    \n-    /**\n-     * Checks that the language code has a valid BCP-47 syntax.\n-     * @param language the language code\n-     * @param elementName the element name\n-     * @throws IllegalStateException if the passed language code is not valid\n-     */\n-    public static void checkLanguageCode(Code language, String elementName) {", "originalCommit": "1c110f88085895e9e2a4c79a01b1e59c055ad1be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "13940f5a82bd87c7be50ddd99d2e2983c8f37fef", "url": "https://github.com/IBM/FHIR/commit/13940f5a82bd87c7be50ddd99d2e2983c8f37fef", "message": "Issue #1421 - updates after review comments\n\nSigned-off-by: Mike Schroeder <mschroed@us.ibm.com>", "committedDate": "2020-09-01T19:17:59Z", "type": "commit"}, {"oid": "3897bd5fad5e16949136599b1c75462a11b9e247", "url": "https://github.com/IBM/FHIR/commit/3897bd5fad5e16949136599b1c75462a11b9e247", "message": "Issue #1421 - rename advancedCodeableConceptValidation\n\nSigned-off-by: Mike Schroeder <mschroed@us.ibm.com>", "committedDate": "2020-09-01T20:06:57Z", "type": "commit"}, {"oid": "c20868fe71f7f2e61b5dd98079b35c6be07af4dc", "url": "https://github.com/IBM/FHIR/commit/c20868fe71f7f2e61b5dd98079b35c6be07af4dc", "message": "Issue #1421 - fix validation config, add documentation of new property\n\nSigned-off-by: Mike Schroeder <mschroed@us.ibm.com>", "committedDate": "2020-09-01T20:47:56Z", "type": "commit"}]}