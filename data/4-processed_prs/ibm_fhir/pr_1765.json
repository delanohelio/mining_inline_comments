{"pr_number": 1765, "pr_title": "fix: automation update and modification for readme #1724", "pr_createdAt": "2020-12-01T14:19:43Z", "pr_url": "https://github.com/IBM/FHIR/pull/1765", "timeline": [{"oid": "22fc3d95222b0d83d831b403939339693f6106ae", "url": "https://github.com/IBM/FHIR/commit/22fc3d95222b0d83d831b403939339693f6106ae", "message": "fix: automation update and modification for readme #1724\n\n- datasource.xml is created as the default which enables bootstrapping\n- datasource-bootstrap.xml changed to reflect the referenced datasource\n- updated README.md in the disabled folder to reflect the appropriate\nbehavior and expectation\n- update the automation to reflect the dual usage.\n\t- copy-server-config.sh controls db2 is updated to use old method\n\t- postgres pre-integration-test.sh uses new method\n\t- pre-integration-test.sh uses new method (default derby)\n- Update the User Guide to reflect the changes\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-01T14:18:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU2OTg4OQ==", "url": "https://github.com/IBM/FHIR/pull/1765#discussion_r533569889", "bodyText": "I think this is what failed...", "author": "prb112", "createdAt": "2020-12-01T16:56:48Z", "path": "build/persistence/postgres/pre-integration-test.sh", "diffHunk": "@@ -50,11 +50,12 @@ copy_server_config(){\n     cp -pr ${WORKSPACE}/fhir-server/liberty-config-tenants/config/* $DIST/config\n     cp -pr ${WORKSPACE}/fhir-server/liberty-config/config/default/fhir-server-config-postgresql.json $DIST/config/default/fhir-server-config.json\n \n-    echo \"Replacing datasource content in server configDropins...\"\n-    rm -f $DIST/overrides/datasource-*.xml 2> /dev/null\n+    # Note the overrides folder is specifically mounted to the docker image under configDropins/overrides\n+    echo \"Creating an overrides folder in $DIST\"\n     mkdir -p $DIST/overrides\n-    cp -p ${WORKSPACE}/fhir-server/liberty-config/configDropins/overrides/datasource-bootstrap.xml $DIST/overrides\n-    cp -p ${WORKSPACE}/fhir-server/liberty-config/configDropins/overrides/datasource-postgresql.xml $DIST/overrides\n+    \n+    # Copy and rename the postgres override\n+    cp -p ${WORKSPACE}/fhir-server/liberty-config/configDropins/disabled/datasource-postgresql.xml $DIST/overrides/datasource.xml", "originalCommit": "22fc3d95222b0d83d831b403939339693f6106ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU4ODEwMw==", "url": "https://github.com/IBM/FHIR/pull/1765#discussion_r533588103", "bodyText": "I think we want the derby (bootstrap) config too because some of the server tests run against different tenants and, for reduced build times, we only provision a postgresql schema for the default tenant.", "author": "lmsurpre", "createdAt": "2020-12-01T17:22:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU2OTg4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzYyOTAxMQ==", "url": "https://github.com/IBM/FHIR/pull/1765#discussion_r533629011", "bodyText": "never mind, I see the bootstrap datasources are included in the configDropins/defaults", "author": "lmsurpre", "createdAt": "2020-12-01T18:25:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU2OTg4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzYzODgzMw==", "url": "https://github.com/IBM/FHIR/pull/1765#discussion_r533638833", "bodyText": "I think I found the issue: a bad change to the datasource definitions.  I think the datasource properties need to be a peer of the jdbcDriver, not a child.  Also fixed indentations so we hopefully don't make that mistake again.", "author": "lmsurpre", "createdAt": "2020-12-01T18:41:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU2OTg4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU3NTc5NQ==", "url": "https://github.com/IBM/FHIR/pull/1765#discussion_r533575795", "bodyText": "we're mixing datasource and datastore again...probably should match the others:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Continuing the above example, configure a drop-in server configuration file 'configDropins/overrides/datastore.xml' as follows:\n          \n          \n            \n            Continuing the above example, configure a drop-in server configuration file 'configDropins/overrides/datasource.xml' as follows:", "author": "lmsurpre", "createdAt": "2020-12-01T17:04:54Z", "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -450,7 +450,7 @@ The 'dataSourceJndiName' property can be removed as it is only used when 'enable\n \n When configured explicitly, the jndiName does not have to follow the standard naming convention, although this is not recommended.\n \n-Continuing the above example, configure a drop-in server configuration file 'configDropins/overrides/datastore-default.xml' as follows:\n+Continuing the above example, configure a drop-in server configuration file 'configDropins/overrides/datastore.xml' as follows:", "originalCommit": "22fc3d95222b0d83d831b403939339693f6106ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzYzNjI2OQ==", "url": "https://github.com/IBM/FHIR/pull/1765#discussion_r533636269", "bodyText": "I included this change in my commit", "author": "lmsurpre", "createdAt": "2020-12-01T18:37:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU3NTc5NQ=="}], "type": "inlineReview"}, {"oid": "d18ff45b2777cc892df2745a3e87f4e8f6920e3c", "url": "https://github.com/IBM/FHIR/commit/d18ff45b2777cc892df2745a3e87f4e8f6920e3c", "message": "fix the datasource definitions\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-12-01T18:31:48Z", "type": "commit"}, {"oid": "a3f3b747713a476811eb6ff3eab60cecb637180d", "url": "https://github.com/IBM/FHIR/commit/a3f3b747713a476811eb6ff3eab60cecb637180d", "message": "dummy commit to force rebuild\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-12-01T21:50:47Z", "type": "commit"}]}