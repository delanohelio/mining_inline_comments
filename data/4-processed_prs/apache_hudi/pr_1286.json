{"pr_number": 1286, "pr_title": "[HUDI-564] Added new test cases for HoodieLogFormat and HoodieLogFormatVersion.", "pr_createdAt": "2020-01-27T23:35:13Z", "pr_url": "https://github.com/apache/hudi/pull/1286", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjU2Njc4MA==", "url": "https://github.com/apache/hudi/pull/1286#discussion_r372566780", "bodyText": "nit : s/scheme/schema/", "author": "n3nash", "createdAt": "2020-01-29T18:51:54Z", "path": "hudi-common/src/test/java/org/apache/hudi/common/table/log/TestHoodieLogFormat.java", "diffHunk": "@@ -1296,4 +1297,36 @@ public void testBasicAppendAndTraverseInReverse() throws IOException, URISyntaxE\n     assertFalse(reader.hasPrev());\n     reader.close();\n   }\n+\n+  @Test\n+  public void testV0Format() throws IOException, InterruptedException, URISyntaxException {\n+    // HoodieLogFormatVersion.DEFAULT_VERSION has been deprecated so we cannot\n+    // create a writer for it. So these tests are only for the HoodieAvroDataBlock\n+    // of older version.\n+    Schema schema = getSimpleSchema();\n+    List<IndexedRecord> records = SchemaTestUtil.generateTestRecords(0, 100);\n+    List<IndexedRecord> recordsCopy = new ArrayList<>(records);\n+    assertEquals(records.size(), 100);\n+    assertEquals(recordsCopy.size(), 100);\n+    HoodieAvroDataBlock dataBlock = new HoodieAvroDataBlock(records, schema);\n+    byte[] content = dataBlock.getBytes(schema);\n+    assertTrue(content.length > 0);\n+\n+    HoodieLogBlock logBlock = HoodieAvroDataBlock.getBlock(content, schema);\n+    assertEquals(logBlock.getBlockType(), HoodieLogBlockType.AVRO_DATA_BLOCK);\n+    List<IndexedRecord> readRecords = ((HoodieAvroDataBlock)logBlock).getRecords();\n+    assertEquals(readRecords.size(), recordsCopy.size());\n+    for (int i = 0; i < recordsCopy.size(); ++i) {\n+      assertEquals(recordsCopy.get(i), readRecords.get(i));\n+    }\n+\n+    // Reader scheme is optional if it is same as write schema", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjU3MTY0OA==", "url": "https://github.com/apache/hudi/pull/1286#discussion_r372571648", "bodyText": "Fixed", "author": "prashantwason", "createdAt": "2020-01-29T19:01:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjU2Njc4MA=="}], "type": "inlineReview"}, {"oid": "f08e52b889e09867daa39e35a1ce4fa031a9afc3", "url": "https://github.com/apache/hudi/commit/f08e52b889e09867daa39e35a1ce4fa031a9afc3", "message": "[HUDI-564] Added new test cases for HoodieLogFormat and HoodieLogFormatVersion.", "committedDate": "2020-01-29T19:00:18Z", "type": "commit"}, {"oid": "f08e52b889e09867daa39e35a1ce4fa031a9afc3", "url": "https://github.com/apache/hudi/commit/f08e52b889e09867daa39e35a1ce4fa031a9afc3", "message": "[HUDI-564] Added new test cases for HoodieLogFormat and HoodieLogFormatVersion.", "committedDate": "2020-01-29T19:00:18Z", "type": "forcePushed"}]}