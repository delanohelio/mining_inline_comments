{"pr_number": 1412, "pr_title": "[HUDI-504] Restructuring and auto-generation of docs", "pr_createdAt": "2020-03-16T18:33:03Z", "pr_url": "https://github.com/apache/hudi/pull/1412", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI2OTU3NQ==", "url": "https://github.com/apache/hudi/pull/1412#discussion_r393269575", "bodyText": "I found a better way to control whether push build result or not, by using $TRAVIS_PULL_REQUEST env variable.\n\n\nCopying conversation from RFC.. I was still trying to understand https://docs.travis-ci.com/user/web-ui/#build-pushed-branches \"Build pushed pull requests\" option that we need to enable in travis CI. This is already ON and after each pull request is merged to master, a job runs.\nI understand that's what we want to do here as well. i.e once the docs PR is approved, merged, then this job should run and auto generate the site..\nFew questions..\n\nHow does this file interplay with .travis.yml on master.. Travis will only look into this file, since the PR's base is asf-site?\nTRAVIS_PULL_REQUEST is set to the pull request number if the current job is a pull request build, or false if it\u2019s not. (from travis docs). Below you are exiting if its a PR and proceeding to build if it's a pushed pull request.. i.e the change has been landed on asf-site already and this job is triggered after that?", "author": "vinothchandar", "createdAt": "2020-03-16T19:42:34Z", "path": ".travis.yml", "diffHunk": "@@ -0,0 +1,42 @@\n+language: ruby\n+rvm:\n+  - 2.6.3\n+\n+git:\n+  clone: false\n+\n+env:\n+  global:\n+    - GIT_USER=\"CI BOT\"\n+    - GIT_EMAIL=\"cibot@hudi.apache.org\"\n+    - GIT_REPO=\"apache\"\n+    - GIT_PROJECT=\"incubator-hudi\"\n+    - GIT_BRANCH=\"asf-site\"\n+    - DOCS_ROOT=\"`pwd`/${GIT_PROJECT}/docs\"\n+\n+before_install:\n+  - git config --global user.name ${GIT_USER}\n+  - git config --global user.email ${GIT_EMAIL}\n+  - git clone https://${GIT_TOKEN}@github.com/${GIT_REPO}/${GIT_PROJECT}.git\n+  - cd ${GIT_PROJECT} && git checkout ${GIT_BRANCH}\n+  - gem install bundler:2.0.2\n+\n+script:\n+  - pushd ${DOCS_ROOT}\n+  - bundle install\n+  - bundle update --bundler\n+  - bundle exec jekyll build _config.yml --source . --destination _site\n+  - popd\n+\n+after_success:", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyNzU0Mw==", "url": "https://github.com/apache/hudi/pull/1412#discussion_r393427543", "bodyText": "hi @vinothchandar\n\n1 How does this file interplay with .travis.yml on master..\n\nper branch uses their own .travis.yml\n\ni.e the change has been landed on asf-site already and this job is triggered after that?\n\nright, job will be triggered once merged.", "author": "lamberken", "createdAt": "2020-03-17T03:36:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI2OTU3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUyOTk1Mw==", "url": "https://github.com/apache/hudi/pull/1412#discussion_r394529953", "bodyText": "is there any chance that this branch already exists?  (e.g travis caching the git clone etc?)", "author": "vinothchandar", "createdAt": "2020-03-18T17:44:25Z", "path": ".travis.yml", "diffHunk": "@@ -0,0 +1,40 @@\n+language: ruby\n+rvm:\n+  - 2.6.3\n+\n+env:\n+  global:\n+    - GIT_USER=\"CI BOT\"\n+    - GIT_EMAIL=\"cibot@hudi.apache.org\"\n+    - GIT_REPO=\"apache\"\n+    - GIT_PROJECT=\"incubator-hudi\"\n+    - GIT_BRANCH=\"asf-site\"\n+    - DOCS_ROOT=\"`pwd`/docs\"\n+\n+before_install:\n+  - git config --global user.name ${GIT_USER}\n+  - git config --global user.email ${GIT_EMAIL}\n+  - git remote add hudi https://${GIT_TOKEN}@github.com/${GIT_REPO}/${GIT_PROJECT}.git\n+  - git checkout -b pr", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0MDA4Ng==", "url": "https://github.com/apache/hudi/pull/1412#discussion_r394540086", "bodyText": "We didn't specify the cache config like bellow, so IMO, the travis will not cache it.\ncache:\n  directories:\n    - \"$HOME/.m2\"", "author": "lamberken", "createdAt": "2020-03-18T18:00:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUyOTk1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU1MzE2NA==", "url": "https://github.com/apache/hudi/pull/1412#discussion_r394553164", "bodyText": "okay.. just to be safe, do you want to account for that scenario? We can also file a follow up JIRA", "author": "vinothchandar", "createdAt": "2020-03-18T18:23:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUyOTk1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU1NTg0OQ==", "url": "https://github.com/apache/hudi/pull/1412#discussion_r394555849", "bodyText": "It's too late today, will double check it.", "author": "lamberken", "createdAt": "2020-03-18T18:28:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUyOTk1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc2Nzc5Ng==", "url": "https://github.com/apache/hudi/pull/1412#discussion_r394767796", "bodyText": "Double checked, always say \"Switched to a new branch 'pr'\", means that travis doesn't cache it.\nhttps://www.travis-ci.org/github/lamber-ken/hdocs/builds/664223886\nhttps://www.travis-ci.org/github/lamber-ken/hdocs/builds/664223922\n$ git checkout -b pr\nSwitched to a new branch 'pr'", "author": "lamberken", "createdAt": "2020-03-19T03:15:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUyOTk1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUzMDI4Mg==", "url": "https://github.com/apache/hudi/pull/1412#discussion_r394530282", "bodyText": "why these changes?", "author": "vinothchandar", "createdAt": "2020-03-18T17:44:57Z", "path": "docs/_includes/nav_list", "diffHunk": "@@ -18,20 +18,19 @@\n             {% assign menu_label = \"\u6587\u6863\u83dc\u5355\" %}\n         {% endif %}\n     {% elsif page.version == \"0.5.1\" %}\n-            {% assign navigation = site.data.navigation[\"0.5.1_docs\"] %}\n+        {% assign navigation = site.data.navigation[\"0.5.1_docs\"] %}", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUzNjA0NA==", "url": "https://github.com/apache/hudi/pull/1412#discussion_r394536044", "bodyText": "Here is a bug, it'll cause build failed\n\nUpdate", "author": "lamberken", "createdAt": "2020-03-18T17:54:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUzMDI4Mg=="}], "type": "inlineReview"}, {"oid": "7bbfacaff77921162f9fa3173f5e5d72c4d9b2be", "url": "https://github.com/apache/hudi/commit/7bbfacaff77921162f9fa3173f5e5d72c4d9b2be", "message": "[HUDI-504] Restructuring and auto-generation of docs", "committedDate": "2020-03-19T09:58:31Z", "type": "commit"}, {"oid": "0791ffe128eda24fd8117d60444dcf439a1e0d1a", "url": "https://github.com/apache/hudi/commit/0791ffe128eda24fd8117d60444dcf439a1e0d1a", "message": "mkdir test-content folder firstly", "committedDate": "2020-03-23T06:25:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ5ODg3MQ==", "url": "https://github.com/apache/hudi/pull/1412#discussion_r396498871", "bodyText": "@lamber-ken curious why this was needed now", "author": "vinothchandar", "createdAt": "2020-03-23T14:37:54Z", "path": ".travis.yml", "diffHunk": "@@ -31,7 +31,7 @@ after_success:\n   - echo $TRAVIS_PULL_REQUEST\n   - 'if [ \"$TRAVIS_PULL_REQUEST\" != \"false\" ]; then echo \"ignore push build result for per submit\"; exit 0; fi'\n   - 'if [ \"$TRAVIS_PULL_REQUEST\" = \"false\" ]; then echo \"pushing build result ...\"; fi'\n-  - \\cp -rf ${DOCS_ROOT}/_site/* test-content\n+  - mkdir test-content && \\cp -rf ${DOCS_ROOT}/_site/* test-content", "originalCommit": "0791ffe128eda24fd8117d60444dcf439a1e0d1a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY1NTc2Mg==", "url": "https://github.com/apache/hudi/pull/1412#discussion_r396655762", "bodyText": "if test-content doesn't exits, \\cp command doesn't work in macOS, so I think create it before copy content to it is better as you mentioned.", "author": "lamberken", "createdAt": "2020-03-23T18:11:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ5ODg3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY1Nzg0Nw==", "url": "https://github.com/apache/hudi/pull/1412#discussion_r396657847", "bodyText": "it worked well during my previous tests in travis ci env.", "author": "lamberken", "createdAt": "2020-03-23T18:14:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ5ODg3MQ=="}], "type": "inlineReview"}]}