{"pr_number": 1816, "pr_title": "[HUDI-859]: Added section for key generation in writing data docs", "pr_createdAt": "2020-07-10T19:06:11Z", "pr_url": "https://github.com/apache/hudi/pull/1816", "timeline": [{"oid": "de4adde64ca404d268417c1e08bbfe4a6376f39f", "url": "https://github.com/apache/hudi/commit/de4adde64ca404d268417c1e08bbfe4a6376f39f", "message": "[HUDI-859]: Added section for key generation in Writing data page", "committedDate": "2020-07-10T18:30:22Z", "type": "commit"}, {"oid": "2dc71b2876bf9adf321fc3ca4a5705e7ef021a47", "url": "https://github.com/apache/hudi/commit/2dc71b2876bf9adf321fc3ca4a5705e7ef021a47", "message": "Merge branch 'asf-site' of https://github.com/apache/incubator-hudi into asf-site-docs", "committedDate": "2020-07-10T18:33:27Z", "type": "commit"}, {"oid": "98d07c2775ab489c51262346f08f9a695072de99", "url": "https://github.com/apache/hudi/commit/98d07c2775ab489c51262346f08f9a695072de99", "message": "[HUDI-859]: added key generation section in writing data docs", "committedDate": "2020-07-10T19:00:12Z", "type": "commit"}, {"oid": "3dabb3dda59227e3129fbe3d40424725c0541bcf", "url": "https://github.com/apache/hudi/commit/3dabb3dda59227e3129fbe3d40424725c0541bcf", "message": "[HUDI-859]: removed unnecessary changes", "committedDate": "2020-07-10T19:05:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNDc0NA==", "url": "https://github.com/apache/hudi/pull/1816#discussion_r453204744", "bodyText": "should we also point out the hoodie.datasource.write.keygenerator.class should be set to NonpartitionedKeyGenerator ?", "author": "leesf", "createdAt": "2020-07-11T15:18:37Z", "path": "docs/_docs/2_2_writing_data.md", "diffHunk": "@@ -28,6 +28,58 @@ can be chosen/changed across each commit/deltacommit issued against the table.\n  of initial load. However, this just does a best-effort job at sizing files vs guaranteeing file sizes like inserts/upserts do. \n \n \n+## Key Generation\n+\n+Hudi maintains hoodie keys (record key + partition path) for uniquely identifying a particular record. Hudi currently supports different combinations of record keys and partition paths as below - \n+\n+ - Simple record key (consisting of only one field) and simple partition path (with optional hive style partitioning)\n+ - Simple record key and custom timestamp based partition path (with optional hive style partitioning)\n+ - Composite record keys (combination of multiple fields) and composite partition paths\n+ - Composite record keys and timestamp based partition paths (composite also supported)\n+ - Non partitioned table\n+\n+`CustomKeyGenerator.java` (part of hudi-spark module) class provides great support for generating hoodie keys of all the above listed types. All you need to do is supply values for the following properties properly to create your desired keys - \n+\n+```java\n+hoodie.datasource.write.recordkey.field\n+hoodie.datasource.write.partitionpath.field\n+hoodie.datasource.write.keygenerator.class\n+```\n+\n+For having composite record keys, you need to provide comma separated fields like\n+```java\n+hoodie.datasource.write.recordkey.field=field1,field2\n+```\n+\n+This will create your record key in the format `field1:value1,field2:value2` and so on, otherwise you can specify only one field in case of simple record keys. `CustomKeyGenerator` class defines an enum `PartitionKeyType` for configuring partition paths. It can take two possible values - SIMPLE and TIMESTAMP. \n+The value for `hoodie.datasource.write.partitionpath.field` property in case of partitioned tables needs to be provided in the format `field1:PartitionKeyType1,field2:PartitionKeyType2` and so on. For example, if you want to create partition path using 2 fields `country` and `date` where the latter has timestamp based values and needs to be customised in a given format, you can specify the following \n+\n+```java\n+hoodie.datasource.write.partitionpath.field=country:SIMPLE,date:TIMESTAMP\n+``` \n+This will create the partition path in the format `<country_name>/<date>` or `country=<country_name>/date=<date>` depending on whether you want hive style partitioning or not.\n+\n+`TimestampBasedKeyGenerator` class defines the following properties which can be used for doing the customizations for timestamp based partition paths\n+\n+```java\n+hoodie.deltastreamer.keygen.timebased.timestamp.type\n+  This defines the type of the value that your field contains. It can be in string format or epoch format, for example\n+hoodie.deltastreamer.keygen.timebased.timestamp.scalar.time.unit\n+  This defines the granularity of your field, whether it contains the values in seconds or milliseconds\n+hoodie.deltastreamer.keygen.timebased.input.dateformat\n+  This defines the custom format in which the values are present in your field, for example yyyy/MM/dd\n+hoodie.deltastreamer.keygen.timebased.output.dateformat\n+  This defines the custom format in which you want the partition paths to be created, for example dt=yyyyMMdd\n+hoodie.deltastreamer.keygen.timebased.timezone\n+  This defines the timezone which the timestamp based values belong to\n+```\n+\n+Finally, if you want to have non partitioned table, you can simply leave the property blank like", "originalCommit": "3dabb3dda59227e3129fbe3d40424725c0541bcf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNTY3Mg==", "url": "https://github.com/apache/hudi/pull/1816#discussion_r453205672", "bodyText": "Maybe I can add hoodie.datasource.write.keygenerator.class should be set to CustomKeyGenerator class for all cases. Even non partitioned table can be handled with CustomKeyGenerator only.", "author": "pratyakshsharma", "createdAt": "2020-07-11T15:28:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNDc0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTczMzM4OQ==", "url": "https://github.com/apache/hudi/pull/1816#discussion_r469733389", "bodyText": "Maybe I can add hoodie.datasource.write.keygenerator.class should be set to CustomKeyGenerator class for all cases. Even non partitioned table can be handled with CustomKeyGenerator only.\n\nI think that should be okay. Just to avoid confusion, you can add that CustomKeyGenerator can also handle non partitioned data set on setting the key generator class as CustomKeyGenerator and leaving empty for hoodie.datasource.write.partitionpath.field=", "author": "bhasudha", "createdAt": "2020-08-13T06:50:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNDc0NA=="}], "type": "inlineReview"}, {"oid": "e0372e177251c7ec9ec9e89f211f6a5afb11fa4f", "url": "https://github.com/apache/hudi/commit/e0372e177251c7ec9ec9e89f211f6a5afb11fa4f", "message": "[HUDI-859]: addressed review comments", "committedDate": "2020-07-11T15:42:28Z", "type": "commit"}, {"oid": "ca3b85a6ec9e3add9b2859bedb52629bcca52340", "url": "https://github.com/apache/hudi/commit/ca3b85a6ec9e3add9b2859bedb52629bcca52340", "message": "[HUDI-859]: review comments addressed", "committedDate": "2020-07-23T12:24:36Z", "type": "commit"}, {"oid": "9e2ff95a96d0f715243da38ae02e1c9c5ed967e3", "url": "https://github.com/apache/hudi/commit/9e2ff95a96d0f715243da38ae02e1c9c5ed967e3", "message": "Minor fixes", "committedDate": "2020-08-13T07:47:50Z", "type": "commit"}]}