{"pr_number": 1732, "pr_title": "[HUDI-1004] Support update metrics in HoodieDeltaStreamerMetrics", "pr_createdAt": "2020-06-13T08:16:57Z", "pr_url": "https://github.com/apache/hudi/pull/1732", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU4OTE2Mw==", "url": "https://github.com/apache/hudi/pull/1732#discussion_r440589163", "bodyText": "\\after updated, the updated value would not be sent as well?", "author": "leesf", "createdAt": "2020-06-16T05:09:32Z", "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/deltastreamer/HoodieDeltaStreamerMetrics.java", "diffHunk": "@@ -67,12 +73,41 @@ String getMetricsName(String action, String metric) {\n \n   public void updateDeltaStreamerMetrics(long durationInNs, long hiveSyncNs) {\n     if (config.isMetricsOn()) {\n-      Metrics.registerGauge(getMetricsName(\"deltastreamer\", \"duration\"), getDurationInMs(durationInNs));\n-      Metrics.registerGauge(getMetricsName(\"deltastreamer\", \"hiveSyncDuration\"), getDurationInMs(hiveSyncNs));\n+      registerOrUpdateMetrics(getMetricsName(\"deltastreamer\", \"duration\"), getDurationInMs(durationInNs));\n+      registerOrUpdateMetrics(getMetricsName(\"deltastreamer\", \"hiveSyncDuration\"), getDurationInMs(hiveSyncNs));\n     }\n   }\n \n   public long getDurationInMs(long ctxDuration) {\n     return ctxDuration / 1000000;\n   }\n+  \n+  public void registerOrUpdateMetrics(String metricsName, Object value) {\n+    if (metrics.containsKey(metricsName)) {\n+      metrics.get(metricsName).set(value);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDYyNjQ3OQ==", "url": "https://github.com/apache/hudi/pull/1732#discussion_r440626479", "bodyText": "Update value will be sent by MetricsGraphiteReporter, MetricsGraphiteReporter.start() start GraphiteReporter and will report metric periodically.", "author": "shenh062326", "createdAt": "2020-06-16T06:58:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU4OTE2Mw=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ2OTM0OQ==", "url": "https://github.com/apache/hudi/pull/1732#discussion_r446469349", "bodyText": "Please name \u2018HoodieGauge\u2019", "author": "vinothchandar", "createdAt": "2020-06-27T01:45:50Z", "path": "hudi-client/src/main/java/org/apache/hudi/metrics/HudiGauge.java", "diffHunk": "@@ -25,22 +25,21 @@\n  * Similar to {@link Gauge}, but metric value is updated via calling {@link #setValue(T)} instead.\n  * </p>\n  */\n-public class SimpleSettableGauge<T> implements SettableGauge<T> {\n+public class HudiGauge<T> implements Gauge<T> {\n   private volatile T value;\n \n   /**\n    * Create an instance with a default value.\n    *\n    * @param defaultValue default value\n    */\n-  public SimpleSettableGauge(T defaultValue) {\n+  public HudiGauge(T defaultValue) {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwODExNg==", "url": "https://github.com/apache/hudi/pull/1732#discussion_r446508116", "bodyText": "Change to HoodieGauge.", "author": "shenh062326", "createdAt": "2020-06-27T09:58:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ2OTM0OQ=="}], "type": "inlineReview"}, {"oid": "e540395e64869641d236a14600f90c97cd4067fb", "url": "https://github.com/apache/hudi/commit/e540395e64869641d236a14600f90c97cd4067fb", "message": "[HUDI-1004] Support update metrics in HoodieDeltaStreamerMetrics", "committedDate": "2020-06-27T09:56:37Z", "type": "commit"}, {"oid": "e540395e64869641d236a14600f90c97cd4067fb", "url": "https://github.com/apache/hudi/commit/e540395e64869641d236a14600f90c97cd4067fb", "message": "[HUDI-1004] Support update metrics in HoodieDeltaStreamerMetrics", "committedDate": "2020-06-27T09:56:37Z", "type": "forcePushed"}]}