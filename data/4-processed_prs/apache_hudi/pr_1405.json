{"pr_number": 1405, "pr_title": "[HUDI-344] Add partitioner param to Exporter", "pr_createdAt": "2020-03-14T06:24:12Z", "pr_url": "https://github.com/apache/hudi/pull/1405", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5NTYxNQ==", "url": "https://github.com/apache/hudi/pull/1405#discussion_r392595615", "bodyText": "\"hudi\" would be constant?", "author": "leesf", "createdAt": "2020-03-14T15:16:03Z", "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/HoodieSnapshotExporter.java", "diffHunk": "@@ -113,21 +126,7 @@ public int export(SparkSession spark, Config cfg) throws IOException {\n         return -1;\n       }\n       if (!cfg.outputFormat.equalsIgnoreCase(\"hudi\")) {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYwNjcwMw==", "url": "https://github.com/apache/hudi/pull/1405#discussion_r392606703", "bodyText": "Sure. Will fix this once #1404 merged, with explicit format checking.", "author": "xushiyan", "createdAt": "2020-03-14T17:56:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5NTYxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5NTc3Nw==", "url": "https://github.com/apache/hudi/pull/1405#discussion_r392595777", "bodyText": "Also need UT for user-defined Partitioner?", "author": "leesf", "createdAt": "2020-03-14T15:18:18Z", "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/HoodieSnapshotExporter.java", "diffHunk": "@@ -47,36 +49,47 @@\n import org.apache.spark.sql.SparkSession;\n import org.apache.spark.sql.execution.datasources.DataSource;\n \n-import scala.Tuple2;\n-import scala.collection.JavaConversions;\n-\n import java.io.IOException;\n import java.io.Serializable;\n import java.util.ArrayList;\n-import java.util.Arrays;\n import java.util.List;\n import java.util.stream.Collectors;\n \n+import scala.Tuple2;\n+import scala.collection.JavaConversions;\n+\n /**\n  * Export the latest records of Hudi dataset to a set of external files (e.g., plain parquet files).\n  *\n  * @experimental This export is an experimental tool. If you want to export hudi to hudi, please use HoodieSnapshotCopier.\n  */\n public class HoodieSnapshotExporter {\n+\n+  @FunctionalInterface\n+  public interface Partitioner {\n+\n+    DataFrameWriter<Row> partition(Dataset<Row> source);\n+\n+  }", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYwNjcxMQ==", "url": "https://github.com/apache/hudi/pull/1405#discussion_r392606711", "bodyText": "Sure. Will fix this once #1404 merged.", "author": "xushiyan", "createdAt": "2020-03-14T17:56:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5NTc3Nw=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzUzMzU4Ng==", "url": "https://github.com/apache/hudi/pull/1405#discussion_r393533586", "bodyText": "should we document this that only support three formats?", "author": "leesf", "createdAt": "2020-03-17T09:09:11Z", "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/HoodieSnapshotExporter.java", "diffHunk": "@@ -45,41 +50,65 @@\n import org.apache.spark.sql.Row;\n import org.apache.spark.sql.SaveMode;\n import org.apache.spark.sql.SparkSession;\n-import org.apache.spark.sql.execution.datasources.DataSource;\n-\n-import scala.Tuple2;\n-import scala.collection.JavaConversions;\n \n import java.io.IOException;\n import java.io.Serializable;\n import java.util.ArrayList;\n-import java.util.Arrays;\n import java.util.List;\n import java.util.stream.Collectors;\n \n+import scala.Tuple2;\n+import scala.collection.JavaConversions;\n+\n /**\n  * Export the latest records of Hudi dataset to a set of external files (e.g., plain parquet files).\n  *\n  * @experimental This export is an experimental tool. If you want to export hudi to hudi, please use HoodieSnapshotCopier.\n  */\n public class HoodieSnapshotExporter {\n+\n+  @FunctionalInterface\n+  public interface Partitioner {\n+\n+    DataFrameWriter<Row> partition(Dataset<Row> source);\n+\n+  }\n+\n   private static final Logger LOG = LogManager.getLogger(HoodieSnapshotExporter.class);\n \n+  public static class OutputFormatValidator implements IValueValidator<String> {\n+\n+    static final String HUDI = \"hudi\";\n+    static final List<String> FORMATS = ImmutableList.of(\"json\", \"parquet\", HUDI);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg3Mjk0Mw==", "url": "https://github.com/apache/hudi/pull/1405#discussion_r393872943", "bodyText": "@leesf Sure add some explanation in the CLI help line", "author": "xushiyan", "createdAt": "2020-03-17T18:06:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzUzMzU4Ng=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "8e8d156f5873c2bafd2e7478883983808106d151", "url": "https://github.com/apache/hudi/commit/8e8d156f5873c2bafd2e7478883983808106d151", "message": "[HUDI-344] Add partitioner param to Exporter\n\n* allow custom repartitioning during export", "committedDate": "2020-03-17T20:58:56Z", "type": "commit"}, {"oid": "3e29052c502e71cb5016e2781e0829b2c498b83b", "url": "https://github.com/apache/hudi/commit/3e29052c502e71cb5016e2781e0829b2c498b83b", "message": "[HUDI-344] Add UT for user defined partitioner", "committedDate": "2020-03-17T20:58:56Z", "type": "commit"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "7b00b57712c7406e0be67c9b10c1a5ef45814b5c", "url": "https://github.com/apache/hudi/commit/7b00b57712c7406e0be67c9b10c1a5ef45814b5c", "message": "Add help line explanation", "committedDate": "2020-03-17T22:20:29Z", "type": "commit"}, {"oid": "7b00b57712c7406e0be67c9b10c1a5ef45814b5c", "url": "https://github.com/apache/hudi/commit/7b00b57712c7406e0be67c9b10c1a5ef45814b5c", "message": "Add help line explanation", "committedDate": "2020-03-17T22:20:29Z", "type": "forcePushed"}]}