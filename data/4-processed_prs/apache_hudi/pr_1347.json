{"pr_number": 1347, "pr_title": "[HUDI-627] Aggregate code coverage and publish to codecov.io during CI", "pr_createdAt": "2020-02-21T21:28:17Z", "pr_url": "https://github.com/apache/hudi/pull/1347", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ4MDQyOQ==", "url": "https://github.com/apache/hudi/pull/1347#discussion_r383480429", "bodyText": "Integration tests do not generate jacoco report (as yet). This is not detected by codecov as an error.  So it may be simple to just add \"bash <(curl -s https://codecov.io/bash)\" directly to the travis.yml. Future changes to integration test wont require any changes here.", "author": "prashantwason", "createdAt": "2020-02-24T19:54:22Z", "path": "scripts/upload_code_coverage.sh", "diffHunk": "@@ -0,0 +1,28 @@\n+#!/bin/bash\n+\n+################################################################################\n+#  Licensed to the Apache Software Foundation (ASF) under one\n+#  or more contributor license agreements.  See the NOTICE file\n+#  distributed with this work for additional information\n+#  regarding copyright ownership.  The ASF licenses this file\n+#  to you under the Apache License, Version 2.0 (the\n+#  \"License\"); you may not use this file except in compliance\n+#  with the License.  You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+#  Unless required by applicable law or agreed to in writing, software\n+#  distributed under the License is distributed on an \"AS IS\" BASIS,\n+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+#  See the License for the specific language governing permissions and\n+# limitations under the License.\n+################################################################################\n+\n+mode=$1\n+\n+if [ \"$mode\" = \"unit\" ];", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzUwNjE5Nw==", "url": "https://github.com/apache/hudi/pull/1347#discussion_r383506197", "bodyText": "made changes as u have suggested.", "author": "ramachandranms", "createdAt": "2020-02-24T20:49:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ4MDQyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ4MzY3Ng==", "url": "https://github.com/apache/hudi/pull/1347#discussion_r383483676", "bodyText": "As per the following link, you can have JaCoCo append coverage of all modules in the same file in the parent module target folder. We can change the dataFile to \"${project.basedir}/../target/coverage-reports/jacoco-ut.exec\".\nMight also have to change the prepare-agent destFile.\nhttps://community.sonarsource.com/t/unit-tests-across-multi-module-projects/9662/3", "author": "prashantwason", "createdAt": "2020-02-24T20:00:35Z", "path": "pom.xml", "diffHunk": "@@ -278,8 +276,6 @@\n                 <goal>report</goal>\n               </goals>\n               <configuration>\n-                <!-- Sets the path to the file which contains the execution data. -->\n-                <dataFile>${project.build.directory}/coverage-reports/jacoco-ut.exec</dataFile>", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzUwMDM2OA==", "url": "https://github.com/apache/hudi/pull/1347#discussion_r383500368", "bodyText": "This seems to be specific to how sonarqube works and we don't use sonar/sonarqube for aggregation\nThis is the recommendation from official jacoco documentation, which I have followed in this PR.\n\nI did try out the sonar documentation on a test project locally and couldn't make it to work.", "author": "ramachandranms", "createdAt": "2020-02-24T20:37:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ4MzY3Ng=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzY4MTAxNA==", "url": "https://github.com/apache/hudi/pull/1347#discussion_r383681014", "bodyText": "is there a way to do this without adding this module?", "author": "vinothchandar", "createdAt": "2020-02-25T06:29:26Z", "path": "pom.xml", "diffHunk": "@@ -51,6 +51,7 @@\n     <module>packaging/hudi-timeline-server-bundle</module>\n     <module>docker/hoodie/hadoop</module>\n     <module>hudi-integ-test</module>\n+    <module>hudi-test-coverage-aggregator</module>", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1MzA2MA==", "url": "https://github.com/apache/hudi/pull/1347#discussion_r384053060", "bodyText": "for now we cannot do without adding a new module in jacoco. there is a PR out in jacoco OSS to avoid this. But it is not getting much traction. i am closely following it. will remove this module once that PR gets merged to a release. for now this is just a wrapper module that does not get deployed.", "author": "ramachandranms", "createdAt": "2020-02-25T18:44:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzY4MTAxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkxOTI0Mg==", "url": "https://github.com/apache/hudi/pull/1347#discussion_r384919242", "bodyText": "I really dislike the additional module. can you reuse one of the bundle modules instead?  or hudi-integ-test?", "author": "vinothchandar", "createdAt": "2020-02-27T05:25:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzY4MTAxNA=="}], "type": "inlineReview"}, {"oid": "cd1477eead52bf4a00a76070c64576b1d4e3ea06", "url": "https://github.com/apache/hudi/commit/cd1477eead52bf4a00a76070c64576b1d4e3ea06", "message": "[HUDI-627] Aggregate code coverage and publish to codecov.io during CI", "committedDate": "2020-02-27T20:08:26Z", "type": "commit"}, {"oid": "cd1477eead52bf4a00a76070c64576b1d4e3ea06", "url": "https://github.com/apache/hudi/commit/cd1477eead52bf4a00a76070c64576b1d4e3ea06", "message": "[HUDI-627] Aggregate code coverage and publish to codecov.io during CI", "committedDate": "2020-02-27T20:08:26Z", "type": "forcePushed"}]}