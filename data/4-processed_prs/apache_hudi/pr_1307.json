{"pr_number": 1307, "pr_title": "[HUDI-570] Improve test coverage for FSUtils.java", "pr_createdAt": "2020-02-05T01:24:55Z", "pr_url": "https://github.com/apache/hudi/pull/1307", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAzODQ2Nw==", "url": "https://github.com/apache/hudi/pull/1307#discussion_r375038467", "bodyText": "We shouldn't have counter variables as members of a test class, each test might mutate it and eventually break other tests", "author": "n3nash", "createdAt": "2020-02-05T03:05:49Z", "path": "hudi-common/src/test/java/org/apache/hudi/common/util/TestFSUtils.java", "diffHunk": "@@ -43,11 +49,33 @@\n import java.util.stream.Stream;\n \n import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n \n /**\n  * Tests file system utils.\n  */\n public class TestFSUtils extends HoodieCommonTestHarness {\n+  private long minRollbackToKeep = 10;", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTUyMDAyNA==", "url": "https://github.com/apache/hudi/pull/1307#discussion_r375520024", "bodyText": "incorporated the comments.", "author": "nbalajee", "createdAt": "2020-02-05T21:33:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAzODQ2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAzODk4MA==", "url": "https://github.com/apache/hudi/pull/1307#discussion_r375038980", "bodyText": "You don't need this init, the HoodieTestHarness actually creates a DFS based file system which works for log records and should not run into the exception for which you might be creating the local file system", "author": "n3nash", "createdAt": "2020-02-05T03:08:30Z", "path": "hudi-common/src/test/java/org/apache/hudi/common/util/TestFSUtils.java", "diffHunk": "@@ -43,11 +49,33 @@\n import java.util.stream.Stream;\n \n import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n \n /**\n  * Tests file system utils.\n  */\n public class TestFSUtils extends HoodieCommonTestHarness {\n+  private long minRollbackToKeep = 10;\n+  private long minCleanToKeep = 10;\n+  protected transient FileSystem fs;\n+  protected String basePath = null;\n+\n+  @Before", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTUyMDA5NQ==", "url": "https://github.com/apache/hudi/pull/1307#discussion_r375520095", "bodyText": "incorporated the comments.", "author": "nbalajee", "createdAt": "2020-02-05T21:33:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAzODk4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAzOTExNw==", "url": "https://github.com/apache/hudi/pull/1307#discussion_r375039117", "bodyText": "Once you use the basePath from the DFS started by the TestHarness and create files underneath, when the test dies, it will automatically clean those files. You shouldn't need to clean it here", "author": "n3nash", "createdAt": "2020-02-05T03:09:13Z", "path": "hudi-common/src/test/java/org/apache/hudi/common/util/TestFSUtils.java", "diffHunk": "@@ -261,4 +289,87 @@ public void testLogFilesComparison() {\n   public static String makeOldLogFileName(String fileId, String logFileExtension, String baseCommitTime, int version) {\n     return \".\" + String.format(\"%s_%s%s.%d\", fileId, baseCommitTime, logFileExtension, version);\n   }\n+\n+  private void cleanupFiles(File[] cleanupFiles) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4361654eb252cbf96f6b7236462846e03749c44d", "url": "https://github.com/apache/hudi/commit/4361654eb252cbf96f6b7236462846e03749c44d", "message": "[HUDI-570] - Improve test coverage for FSUtils.java", "committedDate": "2020-02-05T21:27:59Z", "type": "commit"}, {"oid": "4361654eb252cbf96f6b7236462846e03749c44d", "url": "https://github.com/apache/hudi/commit/4361654eb252cbf96f6b7236462846e03749c44d", "message": "[HUDI-570] - Improve test coverage for FSUtils.java", "committedDate": "2020-02-05T21:27:59Z", "type": "forcePushed"}]}