{"pr_number": 1898, "pr_title": "[HUDI-1140] Fix Jcommander issue for --hoodie-conf in DeltaStreamer", "pr_createdAt": "2020-08-01T23:15:45Z", "pr_url": "https://github.com/apache/hudi/pull/1898", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU2MDI1Ng==", "url": "https://github.com/apache/hudi/pull/1898#discussion_r464560256", "bodyText": "can be removed.", "author": "bvaradar", "createdAt": "2020-08-03T17:36:26Z", "path": "hudi-utilities/src/test/java/org/apache/hudi/utilities/functional/TestHoodieDeltaStreamer.java", "diffHunk": "@@ -394,6 +414,95 @@ public void testProps() {\n         props.getString(\"hoodie.datasource.write.keygenerator.class\"));\n   }\n \n+  private static HoodieDeltaStreamer.Config getBaseConfig() {\n+    // Base config with all required fields\n+    HoodieDeltaStreamer.Config base = new HoodieDeltaStreamer.Config();\n+    base.targetBasePath = TGT_BASE_PATH_VALUE;\n+    base.tableType = TABLE_TYPE_VALUE;\n+    base.targetTableName = TARGET_TABLE_VALUE;\n+    return base;\n+  }\n+\n+  private static Stream<Arguments> provideValidCliArgs() {\n+\n+    HoodieDeltaStreamer.Config base = getBaseConfig();\n+    // String parameter\n+    HoodieDeltaStreamer.Config conf1 = getBaseConfig();\n+    conf1.baseFileFormat = BASE_FILE_FORMAT_VALUE;\n+\n+    // Integer parameter\n+    HoodieDeltaStreamer.Config conf2 = getBaseConfig();\n+    conf2.sourceLimit = Long.parseLong(SOURCE_LIMIT_VALUE);\n+\n+    // Boolean Parameter\n+    HoodieDeltaStreamer.Config conf3 = getBaseConfig();\n+    conf3.enableHiveSync = true;\n+\n+    // ArrayList Parameter with 1 value\n+    HoodieDeltaStreamer.Config conf4 = getBaseConfig();\n+    conf4.configs = Arrays.asList(HOODIE_CONF_VALUE1);\n+\n+    // ArrayList Parameter with comma separated values\n+    HoodieDeltaStreamer.Config conf5 = getBaseConfig();\n+    conf5.configs = Arrays.asList(HOODIE_CONF_VALUE2);\n+\n+    // Multiple ArrayList values\n+    HoodieDeltaStreamer.Config conf6 = getBaseConfig();\n+    conf6.configs = Arrays.asList(HOODIE_CONF_VALUE1, HOODIE_CONF_VALUE2);\n+\n+    // Super set of all cases\n+    HoodieDeltaStreamer.Config conf = getBaseConfig();\n+    conf.baseFileFormat = BASE_FILE_FORMAT_VALUE;\n+    conf.sourceLimit = Long.parseLong(SOURCE_LIMIT_VALUE);\n+    conf.enableHiveSync = true;\n+    conf.configs = Arrays.asList(HOODIE_CONF_VALUE1, HOODIE_CONF_VALUE2);\n+\n+    String[] allConfig = new String[]{TGT_BASE_PATH_PARAM, TGT_BASE_PATH_VALUE, SOURCE_LIMIT_PARAM,\n+        SOURCE_LIMIT_VALUE, TABLE_TYPE_PARAM, TABLE_TYPE_VALUE, TARGET_TABLE_PARAM, TARGET_TABLE_VALUE,\n+        BASE_FILE_FORMAT_PARAM, BASE_FILE_FORMAT_VALUE, ENABLE_HIVE_SYNC_PARAM, HOODIE_CONF_PARAM, HOODIE_CONF_VALUE1,\n+        HOODIE_CONF_PARAM, HOODIE_CONF_VALUE2};\n+\n+    return Stream.of(\n+            // Base\n+            Arguments.of(new String[] {TGT_BASE_PATH_PARAM, TGT_BASE_PATH_VALUE,\n+                TABLE_TYPE_PARAM, TABLE_TYPE_VALUE, TARGET_TABLE_PARAM, TARGET_TABLE_VALUE}, base),\n+            // String\n+            Arguments.of(new String[] {TGT_BASE_PATH_PARAM, TGT_BASE_PATH_VALUE,\n+                TABLE_TYPE_PARAM, TABLE_TYPE_VALUE, TARGET_TABLE_PARAM, TARGET_TABLE_VALUE,\n+                BASE_FILE_FORMAT_PARAM, BASE_FILE_FORMAT_VALUE}, conf1),\n+            // Integer\n+            Arguments.of(new String[] {TGT_BASE_PATH_PARAM, TGT_BASE_PATH_VALUE,\n+                TABLE_TYPE_PARAM, TABLE_TYPE_VALUE, TARGET_TABLE_PARAM, TARGET_TABLE_VALUE,\n+                SOURCE_LIMIT_PARAM, SOURCE_LIMIT_VALUE}, conf2),\n+            // Boolean\n+            Arguments.of(new String[] {TGT_BASE_PATH_PARAM, TGT_BASE_PATH_VALUE,\n+                TABLE_TYPE_PARAM, TABLE_TYPE_VALUE, TARGET_TABLE_PARAM, TARGET_TABLE_VALUE,\n+                ENABLE_HIVE_SYNC_PARAM}, conf3),\n+            // Array List 1\n+            Arguments.of(new String[] {TGT_BASE_PATH_PARAM, TGT_BASE_PATH_VALUE,\n+                TABLE_TYPE_PARAM, TABLE_TYPE_VALUE, TARGET_TABLE_PARAM, TARGET_TABLE_VALUE,\n+                HOODIE_CONF_PARAM, HOODIE_CONF_VALUE1}, conf4),\n+            // Array List with comma\n+            Arguments.of(new String[] {TGT_BASE_PATH_PARAM, TGT_BASE_PATH_VALUE,\n+                TABLE_TYPE_PARAM, TABLE_TYPE_VALUE, TARGET_TABLE_PARAM, TARGET_TABLE_VALUE,\n+                HOODIE_CONF_PARAM, HOODIE_CONF_VALUE2}, conf5),\n+            // Array list with multiple values\n+            Arguments.of(new String[] {TGT_BASE_PATH_PARAM, TGT_BASE_PATH_VALUE,\n+                TABLE_TYPE_PARAM, TABLE_TYPE_VALUE, TARGET_TABLE_PARAM, TARGET_TABLE_VALUE,\n+                HOODIE_CONF_PARAM, HOODIE_CONF_VALUE1, HOODIE_CONF_PARAM, HOODIE_CONF_VALUE2}, conf6),\n+            // All\n+            Arguments.of(allConfig, conf)\n+    );\n+  }\n+  \n+  @ParameterizedTest\n+  @MethodSource(\"provideValidCliArgs\")\n+  public void testValidCommandLineArgs(String[] args, HoodieDeltaStreamer.Config expected) {\n+    System.out.println(\"Expected: \");", "originalCommit": "8c9840d3a6edd70fb881d341323863111f4800db", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU2NDUwMA==", "url": "https://github.com/apache/hudi/pull/1898#discussion_r464564500", "bodyText": "Question : Any specific reason why equals/hashcode are added ? Was it added as part of general  best-practices ?", "author": "bvaradar", "createdAt": "2020-08-03T17:41:09Z", "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/deltastreamer/HoodieDeltaStreamer.java", "diffHunk": "@@ -306,16 +317,106 @@ public boolean isInlineCompactionEnabled() {\n       return !continuousMode && !forceDisableCompaction\n           && HoodieTableType.MERGE_ON_READ.equals(HoodieTableType.valueOf(tableType));\n     }\n+", "originalCommit": "8c9840d3a6edd70fb881d341323863111f4800db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU2ODczNQ==", "url": "https://github.com/apache/hudi/pull/1898#discussion_r464568735", "bodyText": "Yes I wanted to add equals() for better testability and hence added hashcode() as both go hand-in-hand", "author": "sreeram26", "createdAt": "2020-08-03T17:48:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU2NDUwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2MDYzNA==", "url": "https://github.com/apache/hudi/pull/1898#discussion_r464660634", "bodyText": "How about making this class public and moving it to a more general package e.g. hudi-common?\nThere are some other classes which might also need this VoidSplitter, e.g. https://github.com/apache/hudi/blob/master/hudi-utilities/src/main/java/org/apache/hudi/utilities/HDFSParquetImporter.java#L280, https://github.com/apache/hudi/blob/master/hudi-utilities/src/main/java/org/apache/hudi/utilities/HoodieCompactor.java#L92", "author": "zhedoubushishi", "createdAt": "2020-08-03T21:02:42Z", "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/deltastreamer/HoodieDeltaStreamer.java", "diffHunk": "@@ -165,6 +168,12 @@ public Operation convert(String value) throws ParameterException {\n     }\n   }\n \n+  private static final class VoidSplitter implements IParameterSplitter {", "originalCommit": "99a09437f114fb7690d0b1100d17545c7d1eca47", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY4MTU3OQ==", "url": "https://github.com/apache/hudi/pull/1898#discussion_r464681579", "bodyText": "I was a little skeptical about making this change apply for all CLIs. But on second thought, looked at documentation and README files, all of them have --hoodie-conf A --hoodie-conf B way so no one in theory should be sending --hoodie-conf A,B in their usecases. So will move it to common and apply this change for all of the classes using hoodie-conf", "author": "sreeram26", "createdAt": "2020-08-03T21:52:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2MDYzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwNjE3NQ==", "url": "https://github.com/apache/hudi/pull/1898#discussion_r464706175", "bodyText": "Thanks for confirming!", "author": "zhedoubushishi", "createdAt": "2020-08-03T23:03:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2MDYzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE4NjMyMw==", "url": "https://github.com/apache/hudi/pull/1898#discussion_r465186323", "bodyText": "@zhedoubushishi : Lets not bring in jcommander dependency to hudi-common. hudi-common is a core package used across different environments. This can be made the first level class but lets keep it in hudi-utilities : org.apache.hudi.utilities", "author": "bvaradar", "createdAt": "2020-08-04T16:43:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2MDYzNA=="}], "type": "inlineReview"}, {"oid": "57d63cc922327f2f6eca92c720171c2914a5bdfa", "url": "https://github.com/apache/hudi/commit/57d63cc922327f2f6eca92c720171c2914a5bdfa", "message": "Move VoidSplitter to hudi-common", "committedDate": "2020-08-04T15:02:06Z", "type": "forcePushed"}, {"oid": "5230f8cd58d27876165b34d115aeb47ad77605f5", "url": "https://github.com/apache/hudi/commit/5230f8cd58d27876165b34d115aeb47ad77605f5", "message": "[HUDI-1140] Fix Jcommander issue for --hoodie-conf in DeltaStreamer", "committedDate": "2020-08-04T15:07:16Z", "type": "forcePushed"}, {"oid": "4b34401a62dcd3b070c4dae919312e4d663503d5", "url": "https://github.com/apache/hudi/commit/4b34401a62dcd3b070c4dae919312e4d663503d5", "message": "[HUDI-1140] Fix Jcommander issue for --hoodie-conf in DeltaStreamer", "committedDate": "2020-08-04T16:47:21Z", "type": "forcePushed"}, {"oid": "43b3907a50fc5cf7679c9a148e70ebd931946af8", "url": "https://github.com/apache/hudi/commit/43b3907a50fc5cf7679c9a148e70ebd931946af8", "message": "[HUDI-1140] Fix Jcommander issue for --hoodie-conf in DeltaStreamer", "committedDate": "2020-08-04T23:09:50Z", "type": "forcePushed"}, {"oid": "ac0ad66ded018e3666354525a4c5ca8eb99844b2", "url": "https://github.com/apache/hudi/commit/ac0ad66ded018e3666354525a4c5ca8eb99844b2", "message": "[HUDI-1140] Fix Jcommander issue for --hoodie-conf in DeltaStreamer", "committedDate": "2020-08-05T00:00:56Z", "type": "forcePushed"}, {"oid": "0d786b6062c37bc1c32766bd63acb7f82633d14b", "url": "https://github.com/apache/hudi/commit/0d786b6062c37bc1c32766bd63acb7f82633d14b", "message": "[HUDI-1140] Fix Jcommander issue for --hoodie-conf in DeltaStreamer", "committedDate": "2020-08-05T01:43:53Z", "type": "commit"}, {"oid": "0d786b6062c37bc1c32766bd63acb7f82633d14b", "url": "https://github.com/apache/hudi/commit/0d786b6062c37bc1c32766bd63acb7f82633d14b", "message": "[HUDI-1140] Fix Jcommander issue for --hoodie-conf in DeltaStreamer", "committedDate": "2020-08-05T01:43:53Z", "type": "forcePushed"}]}