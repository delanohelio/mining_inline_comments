{"pr_number": 987, "pr_title": "feat: set requestId for fast query path in QueryRequestInfo instead of QueryJobConfiguration", "pr_createdAt": "2020-12-02T15:50:51Z", "pr_url": "https://github.com/googleapis/java-bigquery/pull/987", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ0MzY5OQ==", "url": "https://github.com/googleapis/java-bigquery/pull/987#discussion_r536443699", "bodyText": "Need to validate that what is captured is actually what we expect to see (except the requestId).", "author": "epavan123", "createdAt": "2020-12-04T23:29:57Z", "path": "google-cloud-bigquery/src/test/java/com/google/cloud/bigquery/BigQueryImplTest.java", "diffHunk": "@@ -1885,9 +1885,8 @@ public void testFastQueryRequestCompleted() throws InterruptedException {\n             .setTotalBytesProcessed(42L)\n             .setTotalRows(BigInteger.valueOf(1L));\n \n-    QueryRequestInfo requestInfo = new QueryRequestInfo(QUERY_JOB_CONFIGURATION_FOR_QUERY);\n-\n-    when(bigqueryRpcMock.queryRpc(PROJECT, requestInfo.toPb())).thenReturn(queryResponsePb);\n+    when(bigqueryRpcMock.queryRpc(eq(PROJECT), requestPbCapture.capture()))", "originalCommit": "df941a18009b6f3ced5798cc432117f0a2622518", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ1MDkyNw==", "url": "https://github.com/googleapis/java-bigquery/pull/987#discussion_r536450927", "bodyText": "Done: 7123195", "author": "stephaniewang526", "createdAt": "2020-12-04T23:55:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ0MzY5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ0NzEzMw==", "url": "https://github.com/googleapis/java-bigquery/pull/987#discussion_r536447133", "bodyText": "Are there any cases where a QueryRequestInfo may get reused? Such usage may indicate we set this at time of sending the request (outside of the retry wrapper) rather than time of instantiating the request.", "author": "shollyman", "createdAt": "2020-12-04T23:41:22Z", "path": "google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/QueryRequestInfo.java", "diffHunk": "@@ -49,9 +50,9 @@\n     this.maxResults = config.getMaxResults();\n     this.query = config.getQuery();\n     this.queryParameters = config.toPb().getQuery().getQueryParameters();\n+    this.requestId = UUID.randomUUID().toString();", "originalCommit": "df941a18009b6f3ced5798cc432117f0a2622518", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ1NDE3Mg==", "url": "https://github.com/googleapis/java-bigquery/pull/987#discussion_r536454172", "bodyText": "Yes -- we decided to design it to set this requestId at the time of instantiating the request object which means when a user runs the same QueryJobConfiguration twice, they will be sending two requestIds.", "author": "stephaniewang526", "createdAt": "2020-12-05T00:06:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ0NzEzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ1Njk3MA==", "url": "https://github.com/googleapis/java-bigquery/pull/987#discussion_r536456970", "bodyText": "Thanks for clarifying.  My worry was mostly around cases where someone may retain a reference and use this in unexpected ways.", "author": "shollyman", "createdAt": "2020-12-05T00:17:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ0NzEzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ1ODUxOQ==", "url": "https://github.com/googleapis/java-bigquery/pull/987#discussion_r536458519", "bodyText": "Noted -- thank you!", "author": "stephaniewang526", "createdAt": "2020-12-05T00:23:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ0NzEzMw=="}], "type": "inlineReview"}, {"oid": "988a2ba4924463999882f7ba88bad2984a4b1421", "url": "https://github.com/googleapis/java-bigquery/commit/988a2ba4924463999882f7ba88bad2984a4b1421", "message": "feat: set requestId for fast query path in QueryRequestInfo instead of QueryJobConfiguration.", "committedDate": "2020-12-05T00:31:24Z", "type": "commit"}, {"oid": "d0d7254f48f64f4dd8c8c943a1bee24d4911774f", "url": "https://github.com/googleapis/java-bigquery/commit/d0d7254f48f64f4dd8c8c943a1bee24d4911774f", "message": "push more changes", "committedDate": "2020-12-05T00:31:31Z", "type": "commit"}, {"oid": "8c4439a280534aa6c2a1003bb3914f00cd7b4fdf", "url": "https://github.com/googleapis/java-bigquery/commit/8c4439a280534aa6c2a1003bb3914f00cd7b4fdf", "message": "fix: toEquals() test case", "committedDate": "2020-12-05T00:31:31Z", "type": "commit"}, {"oid": "030135a21737e28b1ce1fc6da9d0aa675223dabe", "url": "https://github.com/googleapis/java-bigquery/commit/030135a21737e28b1ce1fc6da9d0aa675223dabe", "message": "update to use ArgumentCaptor to avoid Matcher issue", "committedDate": "2020-12-05T00:31:31Z", "type": "commit"}, {"oid": "71c46ae85da282aa27b21050a5c015aa09a9d58c", "url": "https://github.com/googleapis/java-bigquery/commit/71c46ae85da282aa27b21050a5c015aa09a9d58c", "message": "nit", "committedDate": "2020-12-05T00:31:31Z", "type": "commit"}, {"oid": "91e1fb9ef6a03e2b083440906bd76e0ac4521807", "url": "https://github.com/googleapis/java-bigquery/commit/91e1fb9ef6a03e2b083440906bd76e0ac4521807", "message": "add check for QueryRequestCapture against QueryJobConfiguration", "committedDate": "2020-12-05T00:31:32Z", "type": "commit"}, {"oid": "91e1fb9ef6a03e2b083440906bd76e0ac4521807", "url": "https://github.com/googleapis/java-bigquery/commit/91e1fb9ef6a03e2b083440906bd76e0ac4521807", "message": "add check for QueryRequestCapture against QueryJobConfiguration", "committedDate": "2020-12-05T00:31:32Z", "type": "forcePushed"}]}