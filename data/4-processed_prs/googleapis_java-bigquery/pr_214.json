{"pr_number": 214, "pr_title": "samples: new sample bigquery_auth_drive_scope", "pr_createdAt": "2020-03-06T20:27:35Z", "pr_url": "https://github.com/googleapis/java-bigquery/pull/214", "timeline": [{"oid": "932746b78b318ecf2fad1382b10ebfe6bfaaafa6", "url": "https://github.com/googleapis/java-bigquery/commit/932746b78b318ecf2fad1382b10ebfe6bfaaafa6", "message": "samples: new sample bigquery_auth_drive_scope", "committedDate": "2020-03-06T20:25:30Z", "type": "commit"}, {"oid": "70554b3d146aab067ee45966c4dff5dae3695d17", "url": "https://github.com/googleapis/java-bigquery/commit/70554b3d146aab067ee45966c4dff5dae3695d17", "message": "nit", "committedDate": "2020-03-06T20:35:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE1MTYzMw==", "url": "https://github.com/googleapis/java-bigquery/pull/214#discussion_r389151633", "bodyText": "Doesn't really make sense to print this multiple times.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                System.out.println(\"Datasets:\");\n          \n          \n            \n                System.out.println(\"Auth succeeded with multiple scopes. Datasets:\");", "author": "kurtisvg", "createdAt": "2020-03-06T21:25:23Z", "path": "samples/src/main/java/com/example/bigquery/AuthDriveScope.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.bigquery;\n+\n+// [START bigquery_auth_drive_scope]\n+import com.google.auth.oauth2.GoogleCredentials;\n+import com.google.auth.oauth2.ServiceAccountCredentials;\n+import com.google.cloud.bigquery.BigQuery;\n+import com.google.cloud.bigquery.BigQueryOptions;\n+import com.google.cloud.bigquery.Dataset;\n+import com.google.common.collect.ImmutableSet;\n+import java.io.IOException;\n+\n+public class AuthDriveScope {\n+\n+  public static void setAuthDriveScope() throws IOException {\n+    // Create credentials with Drive & BigQuery API scopes.\n+    // Both APIs must be enabled for your project before running this code.\n+    GoogleCredentials credentials =\n+        ServiceAccountCredentials.getApplicationDefault()\n+            .createScoped(\n+                ImmutableSet.of(\n+                    \"https://www.googleapis.com/auth/bigquery\",\n+                    \"https://www.googleapis.com/auth/drive\"));\n+\n+    // Instantiate a client.\n+    BigQuery bigquery =\n+        BigQueryOptions.newBuilder().setCredentials(credentials).build().getService();\n+\n+    // Use the client.\n+    System.out.println(\"Datasets:\");", "originalCommit": "70554b3d146aab067ee45966c4dff5dae3695d17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE1MTc2Nw==", "url": "https://github.com/googleapis/java-bigquery/pull/214#discussion_r389151767", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      \"Auth succeeded with multiple scopes. Dataset %s%n\", dataset.getDatasetId().getDataset());\n          \n          \n            \n                      \"Dataset: %s%n\", dataset.getDatasetId().getDataset());", "author": "kurtisvg", "createdAt": "2020-03-06T21:25:43Z", "path": "samples/src/main/java/com/example/bigquery/AuthDriveScope.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.bigquery;\n+\n+// [START bigquery_auth_drive_scope]\n+import com.google.auth.oauth2.GoogleCredentials;\n+import com.google.auth.oauth2.ServiceAccountCredentials;\n+import com.google.cloud.bigquery.BigQuery;\n+import com.google.cloud.bigquery.BigQueryOptions;\n+import com.google.cloud.bigquery.Dataset;\n+import com.google.common.collect.ImmutableSet;\n+import java.io.IOException;\n+\n+public class AuthDriveScope {\n+\n+  public static void setAuthDriveScope() throws IOException {\n+    // Create credentials with Drive & BigQuery API scopes.\n+    // Both APIs must be enabled for your project before running this code.\n+    GoogleCredentials credentials =\n+        ServiceAccountCredentials.getApplicationDefault()\n+            .createScoped(\n+                ImmutableSet.of(\n+                    \"https://www.googleapis.com/auth/bigquery\",\n+                    \"https://www.googleapis.com/auth/drive\"));\n+\n+    // Instantiate a client.\n+    BigQuery bigquery =\n+        BigQueryOptions.newBuilder().setCredentials(credentials).build().getService();\n+\n+    // Use the client.\n+    System.out.println(\"Datasets:\");\n+    for (Dataset dataset : bigquery.listDatasets().iterateAll()) {\n+      System.out.printf(\n+          \"Auth succeeded with multiple scopes. Dataset %s%n\", dataset.getDatasetId().getDataset());", "originalCommit": "70554b3d146aab067ee45966c4dff5dae3695d17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE1MjYyNg==", "url": "https://github.com/googleapis/java-bigquery/pull/214#discussion_r389152626", "bodyText": "Can we use the wording on the other samples? About reusing the client for multiple requests?", "author": "kurtisvg", "createdAt": "2020-03-06T21:27:41Z", "path": "samples/src/main/java/com/example/bigquery/AuthDriveScope.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.bigquery;\n+\n+// [START bigquery_auth_drive_scope]\n+import com.google.auth.oauth2.GoogleCredentials;\n+import com.google.auth.oauth2.ServiceAccountCredentials;\n+import com.google.cloud.bigquery.BigQuery;\n+import com.google.cloud.bigquery.BigQueryOptions;\n+import com.google.cloud.bigquery.Dataset;\n+import com.google.common.collect.ImmutableSet;\n+import java.io.IOException;\n+\n+public class AuthDriveScope {\n+\n+  public static void setAuthDriveScope() throws IOException {\n+    // Create credentials with Drive & BigQuery API scopes.\n+    // Both APIs must be enabled for your project before running this code.\n+    GoogleCredentials credentials =\n+        ServiceAccountCredentials.getApplicationDefault()\n+            .createScoped(\n+                ImmutableSet.of(\n+                    \"https://www.googleapis.com/auth/bigquery\",\n+                    \"https://www.googleapis.com/auth/drive\"));\n+\n+    // Instantiate a client.", "originalCommit": "70554b3d146aab067ee45966c4dff5dae3695d17", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg2OTAwMQ==", "url": "https://github.com/googleapis/java-bigquery/pull/214#discussion_r389869001", "bodyText": "yes - will do", "author": "stephaniewang526", "createdAt": "2020-03-09T18:07:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE1MjYyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE1MjgwOA==", "url": "https://github.com/googleapis/java-bigquery/pull/214#discussion_r389152808", "bodyText": "Shouldn't this catch the BigQueryException error?", "author": "kurtisvg", "createdAt": "2020-03-06T21:28:08Z", "path": "samples/src/main/java/com/example/bigquery/AuthDriveScope.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.bigquery;\n+\n+// [START bigquery_auth_drive_scope]\n+import com.google.auth.oauth2.GoogleCredentials;\n+import com.google.auth.oauth2.ServiceAccountCredentials;\n+import com.google.cloud.bigquery.BigQuery;\n+import com.google.cloud.bigquery.BigQueryOptions;\n+import com.google.cloud.bigquery.Dataset;\n+import com.google.common.collect.ImmutableSet;\n+import java.io.IOException;\n+\n+public class AuthDriveScope {\n+\n+  public static void setAuthDriveScope() throws IOException {\n+    // Create credentials with Drive & BigQuery API scopes.\n+    // Both APIs must be enabled for your project before running this code.\n+    GoogleCredentials credentials =\n+        ServiceAccountCredentials.getApplicationDefault()\n+            .createScoped(\n+                ImmutableSet.of(\n+                    \"https://www.googleapis.com/auth/bigquery\",\n+                    \"https://www.googleapis.com/auth/drive\"));\n+\n+    // Instantiate a client.\n+    BigQuery bigquery =\n+        BigQueryOptions.newBuilder().setCredentials(credentials).build().getService();\n+\n+    // Use the client.\n+    System.out.println(\"Datasets:\");\n+    for (Dataset dataset : bigquery.listDatasets().iterateAll()) {\n+      System.out.printf(\n+          \"Auth succeeded with multiple scopes. Dataset %s%n\", dataset.getDatasetId().getDataset());\n+    }\n+  }", "originalCommit": "70554b3d146aab067ee45966c4dff5dae3695d17", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg2OTEwNA==", "url": "https://github.com/googleapis/java-bigquery/pull/214#discussion_r389869104", "bodyText": "yes - agree", "author": "stephaniewang526", "createdAt": "2020-03-09T18:07:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE1MjgwOA=="}], "type": "inlineReview"}, {"oid": "c841991852a9a0fd7fe2a6d804afd0db99a650d9", "url": "https://github.com/googleapis/java-bigquery/commit/c841991852a9a0fd7fe2a6d804afd0db99a650d9", "message": "nit\n\nCo-Authored-By: Kurtis Van Gent <31518063+kurtisvg@users.noreply.github.com>", "committedDate": "2020-03-09T18:01:26Z", "type": "commit"}, {"oid": "6dca6bf911efb8b144dd64f7f50db72d5d318336", "url": "https://github.com/googleapis/java-bigquery/commit/6dca6bf911efb8b144dd64f7f50db72d5d318336", "message": "nit\n\nCo-Authored-By: Kurtis Van Gent <31518063+kurtisvg@users.noreply.github.com>", "committedDate": "2020-03-09T18:01:35Z", "type": "commit"}, {"oid": "26d8015103e592a0ea1a2d1ffdcd3faca072dcf2", "url": "https://github.com/googleapis/java-bigquery/commit/26d8015103e592a0ea1a2d1ffdcd3faca072dcf2", "message": "update based on comments", "committedDate": "2020-03-09T18:07:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk5NzcyOQ==", "url": "https://github.com/googleapis/java-bigquery/pull/214#discussion_r389997729", "bodyText": "Ok, but if you aren't handling it, and not providing any useful advice, you probably should let the higher level handle.", "author": "lesv", "createdAt": "2020-03-09T22:32:17Z", "path": "samples/src/main/java/com/example/bigquery/AuthDriveScope.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.bigquery;\n+\n+// [START bigquery_auth_drive_scope]\n+import com.google.auth.oauth2.GoogleCredentials;\n+import com.google.auth.oauth2.ServiceAccountCredentials;\n+import com.google.cloud.bigquery.BigQuery;\n+import com.google.cloud.bigquery.BigQueryException;\n+import com.google.cloud.bigquery.BigQueryOptions;\n+import com.google.cloud.bigquery.Dataset;\n+import com.google.common.collect.ImmutableSet;\n+import java.io.IOException;\n+\n+public class AuthDriveScope {\n+\n+  public static void setAuthDriveScope() throws IOException {\n+    // Create credentials with Drive & BigQuery API scopes.\n+    // Both APIs must be enabled for your project before running this code.\n+    GoogleCredentials credentials =\n+        ServiceAccountCredentials.getApplicationDefault()\n+            .createScoped(\n+                ImmutableSet.of(\n+                    \"https://www.googleapis.com/auth/bigquery\",\n+                    \"https://www.googleapis.com/auth/drive\"));\n+\n+    try {\n+      // Initialize client that will be used to send requests. This client only needs to be created\n+      // once, and can be reused for multiple requests.\n+      BigQuery bigquery =\n+          BigQueryOptions.newBuilder().setCredentials(credentials).build().getService();\n+\n+      // Use the client.\n+      System.out.println(\"Auth succeeded with multiple scopes. Datasets:\");\n+      for (Dataset dataset : bigquery.listDatasets().iterateAll()) {\n+        System.out.printf(\"Dataset: %s%n\", dataset.getDatasetId().getDataset());\n+      }\n+    } catch (BigQueryException e) {\n+      System.out.println(\"Auth failed due to error: \\n\" + e.toString());\n+    }", "originalCommit": "26d8015103e592a0ea1a2d1ffdcd3faca072dcf2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}