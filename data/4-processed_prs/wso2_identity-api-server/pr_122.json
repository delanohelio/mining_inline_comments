{"pr_number": 122, "pr_title": "Modify user store meta type endpoint", "pr_createdAt": "2020-03-23T02:38:43Z", "pr_url": "https://github.com/wso2/identity-api-server/pull/122", "timeline": [{"oid": "44fc7abacee19ccf15ae00247454e48e800997fb", "url": "https://github.com/wso2/identity-api-server/commit/44fc7abacee19ccf15ae00247454e48e800997fb", "message": "Modify user store meta endpoint to give metadata of particular userstore type", "committedDate": "2020-03-22T16:51:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIwNjcxNA==", "url": "https://github.com/wso2/identity-api-server/pull/122#discussion_r396206714", "bodyText": "why were the pagination + sorting params removed?", "author": "emswbandara", "createdAt": "2020-03-23T04:22:26Z", "path": "components/org.wso2.carbon.identity.api.server.userstore/org.wso2.carbon.identity.api.server.userstore.v1/src/main/java/org/wso2/carbon/identity/api/server/userstore/v1/core/ServerUserStoreService.java", "diffHunk": "@@ -238,35 +238,24 @@ public UserStoreConfigurationsRes getUserStoreByDomainId(String domainId) {\n     }\n \n     /**\n-     * Retrieve the meta of configured user store type.\n+     * Retrieve the meta of user store type.\n      *\n      * @param typeId the user store type id.\n-     * @param limit  items per page.\n-     * @param offset to specify the offset param.\n-     * @param filter to specify the filtering capabilities.\n-     * @param sort   to specify the sorting order.\n      * @return MetaUserStoreType.\n      */\n \n-    public List<MetaUserStoreType> getUserStoreManagerProperties(String typeId, Integer limit, Integer offset,\n-                                                                 String filter, String sort) {\n-\n-        handleNotImplementedBehaviour(limit, offset, filter, sort);\n+    public MetaUserStoreType getUserStoreManagerProperties(String typeId) {", "originalCommit": "44fc7abacee19ccf15ae00247454e48e800997fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIxMjQ5OQ==", "url": "https://github.com/wso2/identity-api-server/pull/122#discussion_r396212499", "bodyText": "Previously pagination and sorting have been added because it retrieves an array containing all configured userstores which are in the defined userstore type. Thus, the same set of properties which can be configured for that userstore type is repeated.\nex: If we use \"typeId\": \"VW5pcXVlSURKREJDVXNlclN0b3JlTWFuYWdlcg\" which maps with\n\"typeName\": \"UniqueIDJDBCUserStoreManager\", and there are 20 userstores configured in that type, the response contains all of these userstores properties. We can use pagination to take 10 results per page. Similarly, sorting can be used to sort the response according to user store name, etc. However, this is not supported yet.\nSince now we provide only the set of properties for the particular user store type, pagination and sorting are not required.", "author": "AnuradhaSK", "createdAt": "2020-03-23T04:52:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIwNjcxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIwNzE1OQ==", "url": "https://github.com/wso2/identity-api-server/pull/122#discussion_r396207159", "bodyText": "can classNames become null here? if so we need to add a null check.", "author": "emswbandara", "createdAt": "2020-03-23T04:24:44Z", "path": "components/org.wso2.carbon.identity.api.server.userstore/org.wso2.carbon.identity.api.server.userstore.v1/src/main/java/org/wso2/carbon/identity/api/server/userstore/v1/core/ServerUserStoreService.java", "diffHunk": "@@ -238,35 +238,24 @@ public UserStoreConfigurationsRes getUserStoreByDomainId(String domainId) {\n     }\n \n     /**\n-     * Retrieve the meta of configured user store type.\n+     * Retrieve the meta of user store type.\n      *\n      * @param typeId the user store type id.\n-     * @param limit  items per page.\n-     * @param offset to specify the offset param.\n-     * @param filter to specify the filtering capabilities.\n-     * @param sort   to specify the sorting order.\n      * @return MetaUserStoreType.\n      */\n \n-    public List<MetaUserStoreType> getUserStoreManagerProperties(String typeId, Integer limit, Integer offset,\n-                                                                 String filter, String sort) {\n-\n-        handleNotImplementedBehaviour(limit, offset, filter, sort);\n+    public MetaUserStoreType getUserStoreManagerProperties(String typeId) {\n \n         UserStoreConfigService userStoreConfigService = UserStoreConfigServiceHolder.getUserStoreConfigService();\n+        Set<String> classNames;\n         try {\n-            UserStoreDTO[] userStoreDTOS = userStoreConfigService.getUserStores();\n-            if (userStoreDTOS.length == 0) {\n-                throw handleException(Response.Status.NOT_FOUND, UserStoreConstants.ErrorMessage.ERROR_CODE_NOT_FOUND);\n-            }\n-            List<UserStoreDTO> userStoresByTypeNameList = new ArrayList<>();\n-            for (UserStoreDTO userStoreDTO : userStoreDTOS) {\n-                if (Objects.equals(getUserStoreType(base64URLDecodeId(typeId)), userStoreDTO.getClassName())) {\n-                    userStoresByTypeNameList.add(userStoreDTO);\n-                }\n+            classNames = userStoreConfigService.getAvailableUserStoreClasses();\n+            if (classNames.contains(getUserStoreType(base64URLDecodeId(typeId)))) {", "originalCommit": "44fc7abacee19ccf15ae00247454e48e800997fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU4NjI5OQ==", "url": "https://github.com/wso2/identity-api-server/pull/122#discussion_r396586299", "bodyText": "addressed in f145414", "author": "AnuradhaSK", "createdAt": "2020-03-23T16:31:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIwNzE1OQ=="}], "type": "inlineReview"}, {"oid": "f145414e186a1a82b6bc5e4cdd984d641d680ca8", "url": "https://github.com/wso2/identity-api-server/commit/f145414e186a1a82b6bc5e4cdd984d641d680ca8", "message": "Add null check on classNames set", "committedDate": "2020-03-23T16:26:03Z", "type": "commit"}, {"oid": "1858735d552af847784bd640d2346186216cbb6f", "url": "https://github.com/wso2/identity-api-server/commit/1858735d552af847784bd640d2346186216cbb6f", "message": "Change swagger definition in /userstores/meta/types/{type-id}", "committedDate": "2020-03-25T06:21:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzYzNDAxNQ==", "url": "https://github.com/wso2/identity-api-server/pull/122#discussion_r397634015", "bodyText": "shall we use CollectionUtils.isNotEmpty(classNames) here?", "author": "emswbandara", "createdAt": "2020-03-25T06:34:23Z", "path": "components/org.wso2.carbon.identity.api.server.userstore/org.wso2.carbon.identity.api.server.userstore.v1/src/main/java/org/wso2/carbon/identity/api/server/userstore/v1/core/ServerUserStoreService.java", "diffHunk": "@@ -238,35 +238,24 @@ public UserStoreConfigurationsRes getUserStoreByDomainId(String domainId) {\n     }\n \n     /**\n-     * Retrieve the meta of configured user store type.\n+     * Retrieve the meta of user store type.\n      *\n      * @param typeId the user store type id.\n-     * @param limit  items per page.\n-     * @param offset to specify the offset param.\n-     * @param filter to specify the filtering capabilities.\n-     * @param sort   to specify the sorting order.\n      * @return MetaUserStoreType.\n      */\n \n-    public List<MetaUserStoreType> getUserStoreManagerProperties(String typeId, Integer limit, Integer offset,\n-                                                                 String filter, String sort) {\n-\n-        handleNotImplementedBehaviour(limit, offset, filter, sort);\n+    public MetaUserStoreType getUserStoreManagerProperties(String typeId) {\n \n         UserStoreConfigService userStoreConfigService = UserStoreConfigServiceHolder.getUserStoreConfigService();\n+        Set<String> classNames;\n         try {\n-            UserStoreDTO[] userStoreDTOS = userStoreConfigService.getUserStores();\n-            if (userStoreDTOS.length == 0) {\n-                throw handleException(Response.Status.NOT_FOUND, UserStoreConstants.ErrorMessage.ERROR_CODE_NOT_FOUND);\n-            }\n-            List<UserStoreDTO> userStoresByTypeNameList = new ArrayList<>();\n-            for (UserStoreDTO userStoreDTO : userStoreDTOS) {\n-                if (Objects.equals(getUserStoreType(base64URLDecodeId(typeId)), userStoreDTO.getClassName())) {\n-                    userStoresByTypeNameList.add(userStoreDTO);\n-                }\n+            classNames = userStoreConfigService.getAvailableUserStoreClasses();\n+            if (!classNames.isEmpty() && classNames.contains(getUserStoreType(base64URLDecodeId(typeId)))) {", "originalCommit": "1858735d552af847784bd640d2346186216cbb6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY2NDMyMA==", "url": "https://github.com/wso2/identity-api-server/pull/122#discussion_r397664320", "bodyText": "addressed in 2231481", "author": "AnuradhaSK", "createdAt": "2020-03-25T07:59:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzYzNDAxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzYzNDIxOA==", "url": "https://github.com/wso2/identity-api-server/pull/122#discussion_r397634218", "bodyText": "check whether properties is null before calling its methods", "author": "emswbandara", "createdAt": "2020-03-25T06:35:08Z", "path": "components/org.wso2.carbon.identity.api.server.userstore/org.wso2.carbon.identity.api.server.userstore.v1/src/main/java/org/wso2/carbon/identity/api/server/userstore/v1/core/ServerUserStoreService.java", "diffHunk": "@@ -483,32 +472,26 @@ private void addUserstoreProperties(UserStoreDTO userStoreDTO, UserStoreListResp\n     }\n \n     /**\n-     * Construct the configured user store type's meta.\n+     * Construct the user store type's meta.\n      *\n-     * @param userStoreDTOS the list of {@link UserStoreDTO}.\n      * @param typeId        the type id of the user store.\n      * @return MetaUserStoreType.\n      */\n-    private List<MetaUserStoreType> buildUserStoreMetaResponse(List<UserStoreDTO> userStoreDTOS, String typeId) {\n-\n-        List<MetaUserStoreType> metaUserStoreTypes = new ArrayList<>();\n-        for (UserStoreDTO userStoreDTO : userStoreDTOS) {\n-            Properties properties = UserStoreManagerRegistry.getUserStoreProperties(userStoreDTO.getClassName());\n-            MetaUserStoreType metaUserStore = new MetaUserStoreType();\n-            UserStorePropertiesRes userStorePropertiesRes = new UserStorePropertiesRes();\n-            userStorePropertiesRes.mandatory(buildPropertiesRes(properties.getMandatoryProperties()));\n-            userStorePropertiesRes.optional(buildPropertiesRes(properties.getOptionalProperties()));\n-            userStorePropertiesRes.advanced(buildPropertiesRes(properties.getAdvancedProperties()));\n-            metaUserStore.setProperties(userStorePropertiesRes);\n-            metaUserStore.setTypeId(typeId);\n-            metaUserStore.setName(userStoreDTO.getDomainId());\n-            metaUserStore.setDescription(userStoreDTO.getDescription());\n-            metaUserStore.setTypeName(base64URLDecodeId(typeId));\n-            metaUserStore.setClassName(getUserStoreType(base64URLDecodeId(typeId)));\n-            metaUserStoreTypes.add(metaUserStore);\n-\n-        }\n-        return metaUserStoreTypes;\n+    private MetaUserStoreType buildUserStoreMetaResponse(String typeId) {\n+\n+        Properties properties = UserStoreManagerRegistry.getUserStoreProperties(\n+                getUserStoreType(base64URLDecodeId(typeId)));\n+        MetaUserStoreType metaUserStore = new MetaUserStoreType();\n+        UserStorePropertiesRes userStorePropertiesRes = new UserStorePropertiesRes();\n+        userStorePropertiesRes.mandatory(buildPropertiesRes(properties.getMandatoryProperties()));", "originalCommit": "1858735d552af847784bd640d2346186216cbb6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY2NDI2OQ==", "url": "https://github.com/wso2/identity-api-server/pull/122#discussion_r397664269", "bodyText": "addressed in 2231481", "author": "AnuradhaSK", "createdAt": "2020-03-25T07:59:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzYzNDIxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzYzNDQ1OA==", "url": "https://github.com/wso2/identity-api-server/pull/122#discussion_r397634458", "bodyText": "shall we call base64URLDecodeId(typeId) once , assign it to a variable and re-use line line 491 and 492", "author": "emswbandara", "createdAt": "2020-03-25T06:36:06Z", "path": "components/org.wso2.carbon.identity.api.server.userstore/org.wso2.carbon.identity.api.server.userstore.v1/src/main/java/org/wso2/carbon/identity/api/server/userstore/v1/core/ServerUserStoreService.java", "diffHunk": "@@ -483,32 +472,26 @@ private void addUserstoreProperties(UserStoreDTO userStoreDTO, UserStoreListResp\n     }\n \n     /**\n-     * Construct the configured user store type's meta.\n+     * Construct the user store type's meta.\n      *\n-     * @param userStoreDTOS the list of {@link UserStoreDTO}.\n      * @param typeId        the type id of the user store.\n      * @return MetaUserStoreType.\n      */\n-    private List<MetaUserStoreType> buildUserStoreMetaResponse(List<UserStoreDTO> userStoreDTOS, String typeId) {\n-\n-        List<MetaUserStoreType> metaUserStoreTypes = new ArrayList<>();\n-        for (UserStoreDTO userStoreDTO : userStoreDTOS) {\n-            Properties properties = UserStoreManagerRegistry.getUserStoreProperties(userStoreDTO.getClassName());\n-            MetaUserStoreType metaUserStore = new MetaUserStoreType();\n-            UserStorePropertiesRes userStorePropertiesRes = new UserStorePropertiesRes();\n-            userStorePropertiesRes.mandatory(buildPropertiesRes(properties.getMandatoryProperties()));\n-            userStorePropertiesRes.optional(buildPropertiesRes(properties.getOptionalProperties()));\n-            userStorePropertiesRes.advanced(buildPropertiesRes(properties.getAdvancedProperties()));\n-            metaUserStore.setProperties(userStorePropertiesRes);\n-            metaUserStore.setTypeId(typeId);\n-            metaUserStore.setName(userStoreDTO.getDomainId());\n-            metaUserStore.setDescription(userStoreDTO.getDescription());\n-            metaUserStore.setTypeName(base64URLDecodeId(typeId));\n-            metaUserStore.setClassName(getUserStoreType(base64URLDecodeId(typeId)));\n-            metaUserStoreTypes.add(metaUserStore);\n-\n-        }\n-        return metaUserStoreTypes;\n+    private MetaUserStoreType buildUserStoreMetaResponse(String typeId) {\n+\n+        Properties properties = UserStoreManagerRegistry.getUserStoreProperties(\n+                getUserStoreType(base64URLDecodeId(typeId)));\n+        MetaUserStoreType metaUserStore = new MetaUserStoreType();\n+        UserStorePropertiesRes userStorePropertiesRes = new UserStorePropertiesRes();\n+        userStorePropertiesRes.mandatory(buildPropertiesRes(properties.getMandatoryProperties()));\n+        userStorePropertiesRes.optional(buildPropertiesRes(properties.getOptionalProperties()));\n+        userStorePropertiesRes.advanced(buildPropertiesRes(properties.getAdvancedProperties()));\n+        metaUserStore.setProperties(userStorePropertiesRes);\n+        metaUserStore.setTypeId(typeId);\n+        metaUserStore.setTypeName(base64URLDecodeId(typeId));\n+        metaUserStore.setClassName(getUserStoreType(base64URLDecodeId(typeId)));", "originalCommit": "1858735d552af847784bd640d2346186216cbb6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzYzNDY3Nw==", "url": "https://github.com/wso2/identity-api-server/pull/122#discussion_r397634677", "bodyText": "we can assign the variable in the beginning of the method and re-use in line 483 as well", "author": "emswbandara", "createdAt": "2020-03-25T06:36:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzYzNDQ1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY2NDE2NA==", "url": "https://github.com/wso2/identity-api-server/pull/122#discussion_r397664164", "bodyText": "addressed in 2231481", "author": "AnuradhaSK", "createdAt": "2020-03-25T07:59:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzYzNDQ1OA=="}], "type": "inlineReview"}, {"oid": "22314815863e0cfd7d96fc976fd0084f6a288512", "url": "https://github.com/wso2/identity-api-server/commit/22314815863e0cfd7d96fc976fd0084f6a288512", "message": "Address comments", "committedDate": "2020-03-25T06:56:33Z", "type": "commit"}, {"oid": "5fa36469ffa00f5a83148cb234ff672e6e601afa", "url": "https://github.com/wso2/identity-api-server/commit/5fa36469ffa00f5a83148cb234ff672e6e601afa", "message": "Modify line length", "committedDate": "2020-03-25T07:06:19Z", "type": "commit"}, {"oid": "269ccf92237870ba60eae27433529d234c0cfb6c", "url": "https://github.com/wso2/identity-api-server/commit/269ccf92237870ba60eae27433529d234c0cfb6c", "message": "Add self attribute to AvailableUserStoreClassesRes model", "committedDate": "2020-03-25T07:57:20Z", "type": "commit"}, {"oid": "8b7b1a9406d0d300bd1ae6da49bd018b310edd87", "url": "https://github.com/wso2/identity-api-server/commit/8b7b1a9406d0d300bd1ae6da49bd018b310edd87", "message": "Format code", "committedDate": "2020-03-25T08:14:56Z", "type": "commit"}]}