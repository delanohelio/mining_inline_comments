{"pr_number": 444, "pr_title": "Music album details", "pr_createdAt": "2020-04-18T10:57:28Z", "pr_url": "https://github.com/jellyfin/jellyfin-androidtv/pull/444", "timeline": [{"oid": "429e8712a0f3152043f3d8b9b5b3eaa05614047a", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/429e8712a0f3152043f3d8b9b5b3eaa05614047a", "message": "Implement minimal album details", "committedDate": "2020-05-04T08:12:28Z", "type": "commit"}, {"oid": "54e8ce917c2ff8616eb07cc15a1323ef832d50c5", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/54e8ce917c2ff8616eb07cc15a1323ef832d50c5", "message": "Open albums in DetailsActivity instead of ItemListActivity", "committedDate": "2020-05-04T08:12:28Z", "type": "commit"}, {"oid": "e7bb584a3ea4334111a9fc88438d04344c44ee2d", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/e7bb584a3ea4334111a9fc88438d04344c44ee2d", "message": "Show songs on album page", "committedDate": "2020-05-04T08:12:29Z", "type": "commit"}, {"oid": "e7bb584a3ea4334111a9fc88438d04344c44ee2d", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/e7bb584a3ea4334111a9fc88438d04344c44ee2d", "message": "Show songs on album page", "committedDate": "2020-05-04T08:12:29Z", "type": "forcePushed"}, {"oid": "710192f980f4a7a8f2a660dfa8614df6eb08ae67", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/710192f980f4a7a8f2a660dfa8614df6eb08ae67", "message": "Fix scrolling issues of the vertical list", "committedDate": "2020-05-13T15:30:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc5ODY3Ng==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/444#discussion_r425798676", "bodyText": "Issue found: UndocumentedPublicClass - [SongPresenter] at /src/app/src/main/java/org/jellyfin/androidtv/details/presenters/SongPresenter.kt:22:1", "author": "anthonylavado", "createdAt": "2020-05-15T13:23:53Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/presenters/SongPresenter.kt", "diffHunk": "@@ -0,0 +1,85 @@\n+package org.jellyfin.androidtv.details.presenters\n+\n+import android.view.Gravity\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.leanback.widget.Presenter\n+import kotlinx.android.synthetic.main.list_item_song.view.*\n+import kotlinx.coroutines.Dispatchers\n+import kotlinx.coroutines.GlobalScope\n+import kotlinx.coroutines.launch\n+import kotlinx.coroutines.withContext\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.TvApp\n+import org.jellyfin.androidtv.model.itemtypes.Audio\n+import org.jellyfin.androidtv.playback.MediaManager\n+import org.jellyfin.androidtv.util.TimeUtils\n+import org.jellyfin.androidtv.util.Utils\n+import org.jellyfin.androidtv.util.apiclient.PlaybackHelper\n+import org.jellyfin.androidtv.util.apiclient.getItem\n+\n+class SongPresenter : Presenter() {", "originalCommit": "710192f980f4a7a8f2a660dfa8614df6eb08ae67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc5ODY5NQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/444#discussion_r425798695", "bodyText": "Issue found: UndocumentedPublicFunction - [getAlbumsForArtist] at /src/app/src/main/java/org/jellyfin/androidtv/util/apiclient/ApiClientExtensions.kt:148:1", "author": "anthonylavado", "createdAt": "2020-05-15T13:23:54Z", "path": "app/src/main/java/org/jellyfin/androidtv/util/apiclient/ApiClientExtensions.kt", "diffHunk": "@@ -134,11 +145,13 @@ private suspend fun ApiClient.getEpisodesOfSeason(seasonId: String): List<Episod\n \t})\n }\n \n-suspend fun ApiClient.getAlbumsForArtist(artist: Artist): List<Album>? = suspendCoroutine { continuation ->\n+suspend fun ApiClient.getAlbumsForArtist(artist: Artist): List<Album>? = getAlbumsForArtists(arrayOf(artist.id))", "originalCommit": "710192f980f4a7a8f2a660dfa8614df6eb08ae67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc5ODcxMQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/444#discussion_r425798711", "bodyText": "Issue found: UndocumentedPublicClass - [AlbumDetailsFragment] at /src/app/src/main/java/org/jellyfin/androidtv/details/fragments/AlbumDetailsFragment.kt:26:1", "author": "anthonylavado", "createdAt": "2020-05-15T13:23:55Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/fragments/AlbumDetailsFragment.kt", "diffHunk": "@@ -0,0 +1,78 @@\n+package org.jellyfin.androidtv.details.fragments\n+\n+import androidx.leanback.widget.ArrayObjectAdapter\n+import androidx.leanback.widget.ClassPresenterSelector\n+import androidx.lifecycle.MutableLiveData\n+import kotlinx.coroutines.Dispatchers\n+import kotlinx.coroutines.async\n+import kotlinx.coroutines.awaitAll\n+import kotlinx.coroutines.withContext\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.TvApp\n+import org.jellyfin.androidtv.details.actions.InstantMixAction\n+import org.jellyfin.androidtv.details.actions.PlayFromBeginningAction\n+import org.jellyfin.androidtv.details.actions.ShuffleAction\n+import org.jellyfin.androidtv.details.actions.ToggleFavoriteAction\n+import org.jellyfin.androidtv.details.presenters.ItemPresenter\n+import org.jellyfin.androidtv.details.presenters.SongPresenter\n+import org.jellyfin.androidtv.details.rows.DetailsOverviewRow\n+import org.jellyfin.androidtv.model.itemtypes.Album\n+import org.jellyfin.androidtv.util.addIfNotEmpty\n+import org.jellyfin.androidtv.util.apiclient.getAlbumsForArtists\n+import org.jellyfin.androidtv.util.apiclient.getSimilarItems", "originalCommit": "710192f980f4a7a8f2a660dfa8614df6eb08ae67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc5ODcyMQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/444#discussion_r425798721", "bodyText": "Issue found: UndocumentedPublicClass - [Audio] at /src/app/src/main/java/org/jellyfin/androidtv/model/itemtypes/LiftedItems.kt:104:1", "author": "anthonylavado", "createdAt": "2020-05-15T13:23:57Z", "path": "app/src/main/java/org/jellyfin/androidtv/model/itemtypes/LiftedItems.kt", "diffHunk": "@@ -86,10 +87,21 @@ class LocalTrailer(original: BaseItemDto) : PlayableItem(original)\n \n class Video(original: BaseItemDto) : PlayableItem(original)\n \n-class Album(original: BaseItemDto) : BaseItem(original)\n+class Album(original: BaseItemDto) : BaseItem(original), Ratable {\n+\tval artist: List<NameIdPair> = original.artistItems.toList()\n+\n+\toverride val officialRating: String? = original.officialRating\n+\toverride val communityRating: Float? = original.communityRating\n+\toverride val criticsRating: Float? = original.criticRating\n+}\n \n class Artist(original: BaseItemDto) : BaseItem(original), Ratable {\n \toverride val officialRating: String? = original.officialRating\n \toverride val communityRating: Float? = original.communityRating\n \toverride val criticsRating: Float? = original.criticRating\n }\n+\n+class Audio(original: BaseItemDto) : PlayableItem(original) {", "originalCommit": "710192f980f4a7a8f2a660dfa8614df6eb08ae67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc5ODczNg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/444#discussion_r425798736", "bodyText": "Issue found: UndocumentedPublicClass - [ViewHolder] at /src/app/src/main/java/org/jellyfin/androidtv/details/presenters/VerticalListRowPresenter.kt:40:2", "author": "anthonylavado", "createdAt": "2020-05-15T13:23:58Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/presenters/VerticalListRowPresenter.kt", "diffHunk": "@@ -0,0 +1,45 @@\n+package org.jellyfin.androidtv.details.presenters\n+\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.leanback.widget.ItemBridgeAdapter\n+import androidx.leanback.widget.RowPresenter\n+import androidx.recyclerview.widget.LinearLayoutManager\n+import kotlinx.android.synthetic.main.row_vertical_list.view.*\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.details.rows.VerticalListRow\n+\n+class VerticalListRowPresenter : RowPresenter() {\n+\tinit {\n+\t\theaderPresenter = null\n+\t\tselectEffectEnabled = false\n+\t}\n+\n+\toverride fun createRowViewHolder(parent: ViewGroup): ViewHolder {\n+\t\tval view = LayoutInflater\n+\t\t\t.from(parent.context)\n+\t\t\t.inflate(R.layout.row_vertical_list, parent, false)\n+\n+\t\treturn ViewHolder(view)\n+\t}\n+\n+\toverride fun onBindRowViewHolder(holder: RowPresenter.ViewHolder, item: Any) {\n+\t\tsuper.onBindRowViewHolder(holder, item)\n+\n+\t\tval vh = holder as ViewHolder\n+\t\tval rowItem = item as VerticalListRow\n+\n+\t\tvh.itemBridgeAdapter.setAdapter(rowItem.adapter)\n+\t\tvh.items.apply {\n+\t\t\tlayoutManager = LinearLayoutManager(context, LinearLayoutManager.VERTICAL, false)\n+\t\t\tadapter = vh.itemBridgeAdapter\n+\t\t}\n+\t}\n+\n+\tclass ViewHolder(view: View) : RowPresenter.ViewHolder(view) {", "originalCommit": "710192f980f4a7a8f2a660dfa8614df6eb08ae67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc5ODc0Ng==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/444#discussion_r425798746", "bodyText": "Issue found: UndocumentedPublicFunction - [getSongsForAlbum] at /src/app/src/main/java/org/jellyfin/androidtv/util/apiclient/ApiClientExtensions.kt:169:1", "author": "anthonylavado", "createdAt": "2020-05-15T13:23:59Z", "path": "app/src/main/java/org/jellyfin/androidtv/util/apiclient/ApiClientExtensions.kt", "diffHunk": "@@ -153,3 +166,23 @@ suspend fun ApiClient.getAlbumsForArtist(artist: Artist): List<Album>? = suspend\n \t\t}\n \t})\n }\n+suspend fun ApiClient.getSongsForAlbum(albumId: String): List<Audio>? = suspendCoroutine { continuation ->", "originalCommit": "710192f980f4a7a8f2a660dfa8614df6eb08ae67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc5ODc3MQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/444#discussion_r425798771", "bodyText": "Issue found: UndocumentedPublicClass - [ViewHolder] at /src/app/src/main/java/org/jellyfin/androidtv/details/presenters/SongPresenter.kt:78:2", "author": "anthonylavado", "createdAt": "2020-05-15T13:24:00Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/presenters/SongPresenter.kt", "diffHunk": "@@ -0,0 +1,85 @@\n+package org.jellyfin.androidtv.details.presenters\n+\n+import android.view.Gravity\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.leanback.widget.Presenter\n+import kotlinx.android.synthetic.main.list_item_song.view.*\n+import kotlinx.coroutines.Dispatchers\n+import kotlinx.coroutines.GlobalScope\n+import kotlinx.coroutines.launch\n+import kotlinx.coroutines.withContext\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.TvApp\n+import org.jellyfin.androidtv.model.itemtypes.Audio\n+import org.jellyfin.androidtv.playback.MediaManager\n+import org.jellyfin.androidtv.util.TimeUtils\n+import org.jellyfin.androidtv.util.Utils\n+import org.jellyfin.androidtv.util.apiclient.PlaybackHelper\n+import org.jellyfin.androidtv.util.apiclient.getItem\n+\n+class SongPresenter : Presenter() {\n+\toverride fun onCreateViewHolder(parent: ViewGroup): ViewHolder {\n+\t\tval view = LayoutInflater\n+\t\t\t.from(parent.context)\n+\t\t\t.inflate(R.layout.list_item_song, parent, false)\n+\n+\t\treturn ViewHolder(view)\n+\t}\n+\n+\toverride fun onBindViewHolder(viewHolder: Presenter.ViewHolder, item: Any) {\n+\t\tval audio = item as Audio\n+\t\tval vh = viewHolder as ViewHolder\n+\n+\t\tvh.container.setOnClickListener { showMenu(it, audio) }\n+\t\tvh.index.text = audio.index.toString()\n+\t\tvh.title.text = audio.title\n+\t\tvh.artist.text = audio.artists.joinToString(\", \")\n+\t\tvh.duration.text = audio.durationTicks?.let { TimeUtils.formatMillis(it / 10000L) }\n+\t}\n+\n+\toverride fun onUnbindViewHolder(viewHolder: Presenter.ViewHolder) {\n+\t\tval vh = viewHolder as ViewHolder\n+\n+\t\tvh.container.setOnClickListener(null)\n+\t}\n+\n+\tprivate fun showMenu(row: View, item: Audio) {\n+\t\tUtils.createPopupMenu(row.context, row, Gravity.END).apply {\n+\t\t\tmenu.add(R.string.lbl_play).setOnMenuItemClickListener {\n+\t\t\t\tGlobalScope.launch(Dispatchers.IO) {\n+\t\t\t\t\tval baseItem = TvApp.getApplication().apiClient.getItem(item.id)!!\n+\n+\t\t\t\t\twithContext(Dispatchers.Main) { MediaManager.playNow(baseItem) }\n+\t\t\t\t}\n+\n+\t\t\t\ttrue\n+\t\t\t}\n+\n+\t\t\tmenu.add(R.string.lbl_add_to_queue).setOnMenuItemClickListener {\n+\t\t\t\tGlobalScope.launch(Dispatchers.IO) {\n+\t\t\t\t\tval baseItem = TvApp.getApplication().apiClient.getItem(item.id)!!\n+\n+\t\t\t\t\twithContext(Dispatchers.Main) { MediaManager.queueAudioItem(baseItem) }\n+\t\t\t\t}\n+\n+\t\t\t\ttrue\n+\t\t\t}\n+\n+\t\t\tmenu.add(R.string.lbl_instant_mix).setOnMenuItemClickListener {\n+\t\t\t\tPlaybackHelper.playInstantMix(item.id)\n+\n+\t\t\t\ttrue\n+\t\t\t}\n+\t\t}.show()\n+\t}\n+\n+\tclass ViewHolder(view: View) : Presenter.ViewHolder(view) {", "originalCommit": "710192f980f4a7a8f2a660dfa8614df6eb08ae67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc5ODc5Mw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/444#discussion_r425798793", "bodyText": "Issue found: UndocumentedPublicClass - [VerticalListRow] at /src/app/src/main/java/org/jellyfin/androidtv/details/rows/VerticalListRow.kt:7:1", "author": "anthonylavado", "createdAt": "2020-05-15T13:24:02Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/rows/VerticalListRow.kt", "diffHunk": "@@ -0,0 +1,10 @@\n+package org.jellyfin.androidtv.details.rows\n+\n+import androidx.leanback.widget.HeaderItem\n+import androidx.leanback.widget.ListRow\n+import androidx.leanback.widget.ObjectAdapter\n+\n+class VerticalListRow(", "originalCommit": "710192f980f4a7a8f2a660dfa8614df6eb08ae67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc5ODgyMg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/444#discussion_r425798822", "bodyText": "Issue found: UndocumentedPublicFunction - [getAlbumsForArtists] at /src/app/src/main/java/org/jellyfin/androidtv/util/apiclient/ApiClientExtensions.kt:150:1", "author": "anthonylavado", "createdAt": "2020-05-15T13:24:03Z", "path": "app/src/main/java/org/jellyfin/androidtv/util/apiclient/ApiClientExtensions.kt", "diffHunk": "@@ -134,11 +145,13 @@ private suspend fun ApiClient.getEpisodesOfSeason(seasonId: String): List<Episod\n \t})\n }\n \n-suspend fun ApiClient.getAlbumsForArtist(artist: Artist): List<Album>? = suspendCoroutine { continuation ->\n+suspend fun ApiClient.getAlbumsForArtist(artist: Artist): List<Album>? = getAlbumsForArtists(arrayOf(artist.id))\n+\n+suspend fun ApiClient.getAlbumsForArtists(artists: Array<String>): List<Album>? = suspendCoroutine { continuation ->", "originalCommit": "710192f980f4a7a8f2a660dfa8614df6eb08ae67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc5ODg0NA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/444#discussion_r425798844", "bodyText": "Issue found: UndocumentedPublicClass - [VerticalListRowPresenter] at /src/app/src/main/java/org/jellyfin/androidtv/details/presenters/VerticalListRowPresenter.kt:13:1", "author": "anthonylavado", "createdAt": "2020-05-15T13:24:05Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/presenters/VerticalListRowPresenter.kt", "diffHunk": "@@ -0,0 +1,45 @@\n+package org.jellyfin.androidtv.details.presenters\n+\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.leanback.widget.ItemBridgeAdapter\n+import androidx.leanback.widget.RowPresenter\n+import androidx.recyclerview.widget.LinearLayoutManager\n+import kotlinx.android.synthetic.main.row_vertical_list.view.*\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.details.rows.VerticalListRow\n+\n+class VerticalListRowPresenter : RowPresenter() {", "originalCommit": "710192f980f4a7a8f2a660dfa8614df6eb08ae67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc5ODg1OQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/444#discussion_r425798859", "bodyText": "Issue found: UndocumentedPublicClass - [Album] at /src/app/src/main/java/org/jellyfin/androidtv/model/itemtypes/LiftedItems.kt:90:1", "author": "anthonylavado", "createdAt": "2020-05-15T13:24:06Z", "path": "app/src/main/java/org/jellyfin/androidtv/model/itemtypes/LiftedItems.kt", "diffHunk": "@@ -86,10 +87,21 @@ class LocalTrailer(original: BaseItemDto) : PlayableItem(original)\n \n class Video(original: BaseItemDto) : PlayableItem(original)\n \n-class Album(original: BaseItemDto) : BaseItem(original)\n+class Album(original: BaseItemDto) : BaseItem(original), Ratable {", "originalCommit": "710192f980f4a7a8f2a660dfa8614df6eb08ae67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b37182daa8eccd9c35b170cd04500eee11c2ea46", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/b37182daa8eccd9c35b170cd04500eee11c2ea46", "message": "Fix albums not playing", "committedDate": "2020-05-20T16:15:47Z", "type": "commit"}]}