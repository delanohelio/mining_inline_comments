{"pr_number": 275, "pr_title": "Added play and resume actions", "pr_createdAt": "2020-01-24T00:07:22Z", "pr_url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275", "timeline": [{"oid": "a20ccded6a3602582c40227a64ac63f79e865005", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/a20ccded6a3602582c40227a64ac63f79e865005", "message": "Added play and resume actions as well as app crashing dummies for the others", "committedDate": "2020-01-24T00:05:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc5NzMxNA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370797314", "bodyText": "Might be worth splitting the user specific data to a separate class. Something like \"Episode\" and \"UserEpisode\". This way we can (in the future) cache episode data in the app when switching users.\nNot necessary though", "author": "nielsvanvelzen", "createdAt": "2020-01-24T19:13:28Z", "path": "app/src/main/java/org/jellyfin/androidtv/model/itemtypes/Episode.kt", "diffHunk": "@@ -7,5 +7,7 @@ data class Episode (\n \t//TODO: Chapters: ArrayList<ChapterInfoDto>\n \tval communityRating: Double,\n \tval name: String,\n-\tval description: String\n+\tval description: String,\n+\tval canResume: Boolean,", "originalCommit": "a20ccded6a3602582c40227a64ac63f79e865005", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgyMjI4NQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370822285", "bodyText": "Right, we need to very much rethink the whole model though, should we do this here, via Issue or Matrix?", "author": "AndreasGB", "createdAt": "2020-01-24T20:12:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc5NzMxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgyNTA0Nw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370825047", "bodyText": "Probably in the issue or a new PR", "author": "nielsvanvelzen", "createdAt": "2020-01-24T20:20:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc5NzMxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg0NzQ3MA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370847470", "bodyText": "Okay, let's move this to a new PR", "author": "AndreasGB", "createdAt": "2020-01-24T21:20:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc5NzMxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc5OTQ2Ng==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370799466", "bodyText": "val actualPlaybackPositionInMillis by lazy {\n    playbackPositionTicks / 10000 - TvApp.getApplication().resumePreroll\n}\nThe \"by\" syntax will move the setter & getter to a separate implementation. The \"lazy\" function will run the expression when the value of the property is first requested.\nThis would replace the set in the \"init\" function\nReference: https://kotlinlang.org/docs/reference/delegated-properties.html", "author": "nielsvanvelzen", "createdAt": "2020-01-24T19:18:16Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/actions/ResumeAction.kt", "diffHunk": "@@ -0,0 +1,38 @@\n+package org.jellyfin.androidtv.details.actions\n+\n+import android.content.Context\n+import android.content.Intent\n+import android.drm.DrmStore\n+import android.util.Log\n+import androidx.core.content.ContextCompat.startActivity\n+import kotlinx.android.synthetic.main.text_under_button.view.*\n+import kotlinx.coroutines.Dispatchers\n+import kotlinx.coroutines.GlobalScope\n+import kotlinx.coroutines.launch\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.TvApp\n+import org.jellyfin.androidtv.playback.MediaManager\n+import org.jellyfin.androidtv.util.TimeUtils\n+import org.jellyfin.androidtv.util.apiclient.PlaybackHelper\n+import org.jellyfin.apiclient.interaction.Response\n+import org.jellyfin.apiclient.model.dto.BaseItemDto\n+import org.jellyfin.apiclient.model.dto.BaseItemType\n+\n+private const val LOG_TAG = \"ResumeAction\"\n+\n+class ResumeAction(context: Context, val playbackPositionTicks: Long, val itemID: String) : PlaybackAction(ActionID.RESUME.id, context) {\n+\tval actualPlaybackPositionInMillis: Long", "originalCommit": "a20ccded6a3602582c40227a64ac63f79e865005", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgyMjkyOA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370822928", "bodyText": "Ah, nice. Done.", "author": "AndreasGB", "createdAt": "2020-01-24T20:14:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc5OTQ2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwMDE5Mw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370800193", "bodyText": "override fun onClick() = GlobalScope.launch(Dispatchers.Main) {\n\tLog.i(LOG_TAG, \"Resume Clicked!\")\n\tplayItemWithID(itemID, actualPlaybackPositionInMillis, false)\n}", "author": "nielsvanvelzen", "createdAt": "2020-01-24T19:19:52Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/actions/ResumeAction.kt", "diffHunk": "@@ -0,0 +1,38 @@\n+package org.jellyfin.androidtv.details.actions\n+\n+import android.content.Context\n+import android.content.Intent\n+import android.drm.DrmStore\n+import android.util.Log\n+import androidx.core.content.ContextCompat.startActivity\n+import kotlinx.android.synthetic.main.text_under_button.view.*\n+import kotlinx.coroutines.Dispatchers\n+import kotlinx.coroutines.GlobalScope\n+import kotlinx.coroutines.launch\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.TvApp\n+import org.jellyfin.androidtv.playback.MediaManager\n+import org.jellyfin.androidtv.util.TimeUtils\n+import org.jellyfin.androidtv.util.apiclient.PlaybackHelper\n+import org.jellyfin.apiclient.interaction.Response\n+import org.jellyfin.apiclient.model.dto.BaseItemDto\n+import org.jellyfin.apiclient.model.dto.BaseItemType\n+\n+private const val LOG_TAG = \"ResumeAction\"\n+\n+class ResumeAction(context: Context, val playbackPositionTicks: Long, val itemID: String) : PlaybackAction(ActionID.RESUME.id, context) {\n+\tval actualPlaybackPositionInMillis: Long\n+\n+\tinit {\n+\t\tthis.actualPlaybackPositionInMillis = playbackPositionTicks / 10000 - TvApp.getApplication().resumePreroll\n+\t\tthis.label1 = context.getString(R.string.lbl_resume_from, TimeUtils.formatMillis(actualPlaybackPositionInMillis))\n+\t}\n+\n+\toverride fun onClick() {", "originalCommit": "a20ccded6a3602582c40227a64ac63f79e865005", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgxODcxMA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370818710", "bodyText": "Hmm, like this it complains that the Return Type is a Job, so it seems like we would also need to adjust the base class. Shall we do this?", "author": "AndreasGB", "createdAt": "2020-01-24T20:03:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwMDE5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgyNTI5NQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370825295", "bodyText": "Oh in that case we can do 2 things:\nEnd the expression with Unit (the void type of Kotlin) or don't change it.\n(I'd say just leave it for now)", "author": "nielsvanvelzen", "createdAt": "2020-01-24T20:20:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwMDE5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgyNTg2OA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370825868", "bodyText": "Okay, thanks. Will leave it.", "author": "AndreasGB", "createdAt": "2020-01-24T20:22:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwMDE5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwMjYxMw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370802613", "bodyText": "Should probably add an extension function to PlaybackHelper for coroutines instead of callback here (just like for the API).", "author": "nielsvanvelzen", "createdAt": "2020-01-24T19:25:18Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/actions/PlaybackAction.kt", "diffHunk": "@@ -0,0 +1,45 @@\n+package org.jellyfin.androidtv.details.actions\n+\n+import android.content.Context\n+import android.content.Intent\n+import android.util.Log\n+import androidx.core.content.ContextCompat\n+import kotlinx.coroutines.Dispatchers\n+import kotlinx.coroutines.withContext\n+import org.jellyfin.androidtv.TvApp\n+import org.jellyfin.androidtv.playback.MediaManager\n+import org.jellyfin.androidtv.util.apiclient.PlaybackHelper\n+import org.jellyfin.androidtv.util.apiclient.getItem\n+import org.jellyfin.apiclient.interaction.Response\n+import org.jellyfin.apiclient.model.dto.BaseItemDto\n+import org.jellyfin.apiclient.model.dto.BaseItemType\n+\n+private const val LOG_TAG = \"PlaybackAction\"\n+\n+abstract class PlaybackAction(id: Long, context: Context) : BaseAction(id, context) {\n+\t// TODO: This is super fucked, but at least it works for now until we clean up more messes.\n+\tprotected suspend fun playItemWithID(id: String, pos: Long, shuffle: Boolean) = withContext(Dispatchers.IO) {\n+\t\tval baseItem = TvApp.getApplication().apiClient.getItem(id)\n+\t\tif (baseItem == null) {\n+\t\t\tLog.e(LOG_TAG, \"Failed to get a base item for the given ID\")\n+\t\t\treturn@withContext\n+\t\t}\n+\t\tplay(baseItem, pos, shuffle)\n+\t}\n+\n+\tprivate fun play(item: BaseItemDto, pos: Long, shuffle: Boolean) {\n+\t\tPlaybackHelper.getItemsToPlay(item, pos == 0L && item.baseItemType == BaseItemType.Movie, shuffle, object : Response<List<BaseItemDto>>() {", "originalCommit": "a20ccded6a3602582c40227a64ac63f79e865005", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwNjc5NQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370806795", "bodyText": "Why is this called label is that a google thingy or our thingy?", "author": "nielsvanvelzen", "createdAt": "2020-01-24T19:34:28Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/actions/PlayFromBeginningAction.kt", "diffHunk": "@@ -0,0 +1,23 @@\n+package org.jellyfin.androidtv.details.actions\n+\n+import android.content.Context\n+import android.util.Log\n+import kotlinx.coroutines.Dispatchers\n+import kotlinx.coroutines.GlobalScope\n+import kotlinx.coroutines.launch\n+import org.jellyfin.androidtv.R\n+\n+private const val LOG_TAG = \"PlayFromBeginningAction\"\n+\n+class PlayFromBeginningAction(context: Context, val itemID: String) : PlaybackAction(ActionID.PLAY_FROM_BEGINNING.id, context) {\n+\tinit {\n+\t    label1 = context.getString(R.string.lbl_play)", "originalCommit": "a20ccded6a3602582c40227a64ac63f79e865005", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgxNzEwOA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370817108", "bodyText": "That's a Google thing sadly, I dislike the name as well.", "author": "AndreasGB", "createdAt": "2020-01-24T19:58:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwNjc5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgyNTg0OQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370825849", "bodyText": "The should've called it \"title\" and \"subtitle\" or something. We can't do anything about it though", "author": "nielsvanvelzen", "createdAt": "2020-01-24T20:22:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwNjc5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwNzY1MA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370807650", "bodyText": "Maybe add a typecheck if it actually is a BaseAction (just to be sure)", "author": "nielsvanvelzen", "createdAt": "2020-01-24T19:36:28Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/EpisodeDetailsFragment.kt", "diffHunk": "@@ -33,23 +38,37 @@ class EpisodeDetailsFragment(private val data: Episode) : BaseDetailsFragment()\n \t\t\t// Attach your media item details presenter to the row presenter:\n \t\t\tval detailsDescriptionPresenter = DetailsDescriptionPresenter(title = data.name, subtitle = \"TODO\", body = data.description)\n \n+\t\t\tval overviewRowPresenter = FullWidthDetailsOverviewRowPresenter(\n+\t\t\t\tdetailsDescriptionPresenter,\n+\t\t\t\tprimaryImageBitmap?.let { DetailsOverviewLogoPresenter() })\n+\n+\t\t\toverviewRowPresenter.onActionClickedListener = OnActionClickedListener {\n+\t\t\t\tval action = it as BaseAction", "originalCommit": "a20ccded6a3602582c40227a64ac63f79e865005", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgxNjQzMg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370816432", "bodyText": "Will do", "author": "AndreasGB", "createdAt": "2020-01-24T19:57:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwNzY1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwODE3MA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370808170", "bodyText": "I'm now thinking it might be nicer to use \"episode\" instead of \"data\". Looks more clear when using the actual data.", "author": "nielsvanvelzen", "createdAt": "2020-01-24T19:37:40Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/EpisodeDetailsFragment.kt", "diffHunk": "@@ -8,9 +8,14 @@ import kotlinx.coroutines.Dispatchers\n import kotlinx.coroutines.GlobalScope\n import kotlinx.coroutines.launch\n import org.jellyfin.androidtv.TvApp\n+import org.jellyfin.androidtv.details.actions.BaseAction\n+import org.jellyfin.androidtv.details.actions.PlayFromBeginningAction\n+import org.jellyfin.androidtv.details.actions.ResumeAction\n import org.jellyfin.androidtv.model.itemtypes.Episode\n import org.jellyfin.apiclient.model.dto.ImageOptions\n \n+private const val LOG_TAG = \"EpisodeDetailsFragment\"\n+\n class EpisodeDetailsFragment(private val data: Episode) : BaseDetailsFragment() {", "originalCommit": "a20ccded6a3602582c40227a64ac63f79e865005", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgxNTYwNg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370815606", "bodyText": "Will do", "author": "AndreasGB", "createdAt": "2020-01-24T19:55:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwODE3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwODU3Mw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370808573", "bodyText": "I think an ArrayObjectAdapter works better so we don't need to add the integers for ordering (just make sure everything is added in the same place)", "author": "nielsvanvelzen", "createdAt": "2020-01-24T19:38:40Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/EpisodeDetailsFragment.kt", "diffHunk": "@@ -33,23 +38,37 @@ class EpisodeDetailsFragment(private val data: Episode) : BaseDetailsFragment()\n \t\t\t// Attach your media item details presenter to the row presenter:\n \t\t\tval detailsDescriptionPresenter = DetailsDescriptionPresenter(title = data.name, subtitle = \"TODO\", body = data.description)\n \n+\t\t\tval overviewRowPresenter = FullWidthDetailsOverviewRowPresenter(\n+\t\t\t\tdetailsDescriptionPresenter,\n+\t\t\t\tprimaryImageBitmap?.let { DetailsOverviewLogoPresenter() })\n+\n+\t\t\toverviewRowPresenter.onActionClickedListener = OnActionClickedListener {\n+\t\t\t\tval action = it as BaseAction\n+\t\t\t\taction.onClick()\n+\t\t\t}\n \n-\t\t\taddClassPresenter(DetailsOverviewRow::class.java,\n-\t\t\t\tFullWidthDetailsOverviewRowPresenter(\n-\t\t\t\t\tdetailsDescriptionPresenter,\n-\t\t\t\t\tprimaryImageBitmap?.let { DetailsOverviewLogoPresenter() }))\n+\t\t\taddClassPresenter(DetailsOverviewRow::class.java, overviewRowPresenter)\n \n \n \t\t\taddClassPresenter(ListRow::class.java, ListRowPresenter())\n \t\t}\n \t\trowsAdapter = ArrayObjectAdapter(selector)\n \n-\t\tval detailsOverview = DetailsOverviewRow(\"Media Item Details\").apply {\n-\t\t\timageDrawable = BitmapDrawable(resources, primaryImageBitmap)\n-\t\t\t// Add images and action buttons to the details view\n-\t\t\taddAction(Action(1, \"Continue from 12:10\"))\n-\t\t\taddAction(Action(2, \"Play from Beginning\"))\n+\t\tval actionsAdapter = SparseArrayObjectAdapter()", "originalCommit": "a20ccded6a3602582c40227a64ac63f79e865005", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwODcxMA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370808710", "bodyText": "Also, using the .apply or .also function is possible here too", "author": "nielsvanvelzen", "createdAt": "2020-01-24T19:39:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwODU3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgxOTQ4MA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370819480", "bodyText": "The documentation recommended it, but for now it doesn't make much of a difference. Should I still change it to ArrayObjectAdapter?", "author": "AndreasGB", "createdAt": "2020-01-24T20:04:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwODU3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgyNjE4Ng==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370826186", "bodyText": "I think the docs recommend it because they are expecting the actions to be added/removed from various places. But we're doing it in a single place so a normal adapter should work fine.", "author": "nielsvanvelzen", "createdAt": "2020-01-24T20:23:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwODU3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwODkzMw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370808933", "bodyText": "Btw, I'm ignoring the hardcoded strings for now but they need to be addressed at some point", "author": "nielsvanvelzen", "createdAt": "2020-01-24T19:39:40Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/EpisodeDetailsFragment.kt", "diffHunk": "@@ -33,23 +38,37 @@ class EpisodeDetailsFragment(private val data: Episode) : BaseDetailsFragment()\n \t\t\t// Attach your media item details presenter to the row presenter:\n \t\t\tval detailsDescriptionPresenter = DetailsDescriptionPresenter(title = data.name, subtitle = \"TODO\", body = data.description)\n \n+\t\t\tval overviewRowPresenter = FullWidthDetailsOverviewRowPresenter(\n+\t\t\t\tdetailsDescriptionPresenter,\n+\t\t\t\tprimaryImageBitmap?.let { DetailsOverviewLogoPresenter() })\n+\n+\t\t\toverviewRowPresenter.onActionClickedListener = OnActionClickedListener {\n+\t\t\t\tval action = it as BaseAction\n+\t\t\t\taction.onClick()\n+\t\t\t}\n \n-\t\t\taddClassPresenter(DetailsOverviewRow::class.java,\n-\t\t\t\tFullWidthDetailsOverviewRowPresenter(\n-\t\t\t\t\tdetailsDescriptionPresenter,\n-\t\t\t\t\tprimaryImageBitmap?.let { DetailsOverviewLogoPresenter() }))\n+\t\t\taddClassPresenter(DetailsOverviewRow::class.java, overviewRowPresenter)\n \n \n \t\t\taddClassPresenter(ListRow::class.java, ListRowPresenter())\n \t\t}\n \t\trowsAdapter = ArrayObjectAdapter(selector)\n \n-\t\tval detailsOverview = DetailsOverviewRow(\"Media Item Details\").apply {\n-\t\t\timageDrawable = BitmapDrawable(resources, primaryImageBitmap)\n-\t\t\t// Add images and action buttons to the details view\n-\t\t\taddAction(Action(1, \"Continue from 12:10\"))\n-\t\t\taddAction(Action(2, \"Play from Beginning\"))\n+\t\tval actionsAdapter = SparseArrayObjectAdapter()\n+\t\tif (data.canResume) actionsAdapter.set(0, ResumeAction(context!!, data.playbackPositionTicks, data.id))\n+\t\tactionsAdapter.set(1, PlayFromBeginningAction(context!!, data.id))\n+\t\tactionsAdapter.set(2, Action(1, \"Set Watched\"))\n+\t\tactionsAdapter.set(3, Action(1, \"Add Favorite\"))\n+\t\tactionsAdapter.set(4, Action(1, \"Add to Queue\"))\n+\t\tactionsAdapter.set(5, Action(1, \"Go to Series\"))\n+\t\tactionsAdapter.set(6, Action(1, \"Delete\"))\n+\n+\t\tval detailsOverview = DetailsOverviewRow(\"Media Item Details\").also {", "originalCommit": "a20ccded6a3602582c40227a64ac63f79e865005", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b176e1f632438a7b37f34527df6c6eff7eca7986", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/b176e1f632438a7b37f34527df6c6eff7eca7986", "message": "Incorporate Niels feedback. Thanks :)", "committedDate": "2020-01-24T21:23:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg0OTA4MQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370849081", "bodyText": "Should probably move this out of the apiclient package", "author": "nielsvanvelzen", "createdAt": "2020-01-24T21:25:09Z", "path": "app/src/main/java/org/jellyfin/androidtv/util/apiclient/PlaybackHelperExtensions.kt", "diffHunk": "@@ -0,0 +1,21 @@\n+package org.jellyfin.androidtv.util.apiclient", "originalCommit": "b176e1f632438a7b37f34527df6c6eff7eca7986", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg1MDgzMA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370850830", "bodyText": ".apply could be added directly after creating the instance.\nval actionsAdapter = ArrayObjectAdapter().apply{ /*code */ }", "author": "nielsvanvelzen", "createdAt": "2020-01-24T21:29:40Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/EpisodeDetailsFragment.kt", "diffHunk": "@@ -24,32 +29,53 @@ class EpisodeDetailsFragment(private val data: Episode) : BaseDetailsFragment()\n \n \tprivate suspend fun buildDetails() {\n \n-\t\tLog.i(\"EpisodeDetailsFragment\", data.name)\n+\t\tLog.i(\"EpisodeDetailsFragment\", episode.name)\n \n-\t\tval primaryImageUrl = TvApp.getApplication().apiClient.GetImageUrl(data.id, ImageOptions())\n+\t\tval primaryImageUrl = TvApp.getApplication().apiClient.GetImageUrl(episode.id, ImageOptions())\n \t\tval primaryImageBitmap = getImageFromURL(primaryImageUrl)\n \n \t\tval selector = ClassPresenterSelector().apply {\n \t\t\t// Attach your media item details presenter to the row presenter:\n-\t\t\tval detailsDescriptionPresenter = DetailsDescriptionPresenter(title = data.name, subtitle = \"TODO\", body = data.description)\n+\t\t\tval detailsDescriptionPresenter = DetailsDescriptionPresenter(title = episode.name, subtitle = \"TODO\", body = episode.description)\n+\n+\t\t\tval overviewRowPresenter = FullWidthDetailsOverviewRowPresenter(\n+\t\t\t\tdetailsDescriptionPresenter,\n+\t\t\t\tprimaryImageBitmap?.let { DetailsOverviewLogoPresenter() })\n \n+\t\t\toverviewRowPresenter.onActionClickedListener = OnActionClickedListener {\n+\t\t\t\tif (it is BaseAction) {\n+\t\t\t\t\tval action = it as BaseAction\n+\t\t\t\t\taction.onClick()\n+\t\t\t\t} else {\n+\t\t\t\t\tLog.e(LOG_TAG, \"The clicked Action did not derive from BaseAction, this is unsupported!\")\n+\t\t\t\t}\n+\t\t\t}\n \n-\t\t\taddClassPresenter(DetailsOverviewRow::class.java,\n-\t\t\t\tFullWidthDetailsOverviewRowPresenter(\n-\t\t\t\t\tdetailsDescriptionPresenter,\n-\t\t\t\t\tprimaryImageBitmap?.let { DetailsOverviewLogoPresenter() }))\n+\t\t\taddClassPresenter(DetailsOverviewRow::class.java, overviewRowPresenter)\n \n \n \t\t\taddClassPresenter(ListRow::class.java, ListRowPresenter())\n \t\t}\n \t\trowsAdapter = ArrayObjectAdapter(selector)\n \n-\t\tval detailsOverview = DetailsOverviewRow(\"Media Item Details\").apply {\n-\t\t\timageDrawable = BitmapDrawable(resources, primaryImageBitmap)\n-\t\t\t// Add images and action buttons to the details view\n-\t\t\taddAction(Action(1, \"Continue from 12:10\"))\n-\t\t\taddAction(Action(2, \"Play from Beginning\"))\n+\t\tval actionsAdapter = SparseArrayObjectAdapter()\n+\t\tactionsAdapter.apply {", "originalCommit": "b176e1f632438a7b37f34527df6c6eff7eca7986", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg1Mjg2MQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/275#discussion_r370852861", "bodyText": "Okay, will change it and remove the SparseArrayObjectAdapter", "author": "AndreasGB", "createdAt": "2020-01-24T21:35:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg1MDgzMA=="}], "type": "inlineReview"}, {"oid": "3064fc2d3284c8291de9132c4d038a78aa4cfc7c", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/3064fc2d3284c8291de9132c4d038a78aa4cfc7c", "message": "Replace SparseArrayObjectAdapter with simpler ArrayObjectAdapter", "committedDate": "2020-01-24T21:39:13Z", "type": "commit"}]}