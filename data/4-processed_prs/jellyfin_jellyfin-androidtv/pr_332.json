{"pr_number": 332, "pr_title": "Add MultiBadgeCardView", "pr_createdAt": "2020-02-11T20:05:32Z", "pr_url": "https://github.com/jellyfin/jellyfin-androidtv/pull/332", "timeline": [{"oid": "dfda34500c8c39acbf3bc3d815eb46d1a823eadf", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/dfda34500c8c39acbf3bc3d815eb46d1a823eadf", "message": "Add captures folder (used by layout inspector) to .gitignore", "committedDate": "2020-02-11T15:31:58Z", "type": "commit"}, {"oid": "40799aef2c160bc95cd341cec7d0fdac8a0918ff", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/40799aef2c160bc95cd341cec7d0fdac8a0918ff", "message": "Initial version of MultiBadgeItemCardView", "committedDate": "2020-02-11T15:32:32Z", "type": "commit"}, {"oid": "b048f887749bc29236beefb8c06aa707b72e7194", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/b048f887749bc29236beefb8c06aa707b72e7194", "message": "Preliminary MultiBadgeItemCardView", "committedDate": "2020-02-11T20:03:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ3MTY2NA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/332#discussion_r378471664", "bodyText": "Does this function properly convert display pixels to pixels?", "author": "nielsvanvelzen", "createdAt": "2020-02-12T19:41:18Z", "path": "app/src/main/java/org/jellyfin/androidtv/presentation/MultiBadgeImageCardView.kt", "diffHunk": "@@ -0,0 +1,134 @@\n+package org.jellyfin.androidtv.presentation\n+\n+import android.animation.ObjectAnimator\n+import android.content.Context\n+import android.graphics.drawable.Drawable\n+import android.util.AttributeSet\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.leanback.widget.BaseCardView\n+import kotlinx.android.synthetic.main.multi_badge_image_card_view.view.*\n+import org.jellyfin.androidtv.R\n+\n+class MultiBadgeImageCardView(context: Context, attrs: AttributeSet?, defStyleAttr: Int) : BaseCardView(context, attrs, defStyleAttr) {\n+\tprivate val mFadeInAnimator: ObjectAnimator\n+\tprivate var mAttachedToWindow: Boolean = false\n+\n+\tvar mainImageDrawable: Drawable?\n+\t\tget() = main_image.drawable\n+\t\tset(value) { setMainImage(value, true) }\n+\n+\tvar titleText: CharSequence\n+\t\tget() = title_text.text\n+\t\tset(value) { title_text.text = value }\n+\n+\tvar contentText: CharSequence?\n+\t\tget() = content_text.text\n+\t\tset(value) { content_text.text = value }\n+\n+\tval badgeContainers: Map<BadgeLocation, ViewGroup>\n+\n+\tconstructor(context: Context) : this(context, null)\n+\tconstructor(context: Context, attrs: AttributeSet?) : this(context, attrs, R.attr.imageCardViewStyle)\n+\n+\tinit {\n+\t    isFocusable = true\n+\t\tisFocusableInTouchMode = true\n+\n+\t\tval inflater = LayoutInflater.from(context)\n+\t\tinflater.inflate(R.layout.multi_badge_image_card_view, this)\n+\t\tval cardAttrs = context.obtainStyledAttributes(attrs, R.styleable.lbImageCardView, defStyleAttr, R.style.Widget_Leanback_ImageCardView)\n+\n+\t\t// TODO ViewCompat.saveAttributeDataForStyleable call that is here in the original\n+\n+\n+\t\tmFadeInAnimator = ObjectAnimator.ofFloat(main_image, View.ALPHA, 1f).apply {\n+\t\t\tduration = main_image.resources.getInteger(android.R.integer.config_shortAnimTime).toLong()\n+\t\t}\n+\n+\t\tval backgroundDrawable: Drawable? = cardAttrs.getDrawable(R.styleable.lbImageCardView_infoAreaBackground)\n+\t\tif (backgroundDrawable != null) {\n+\t\t\tbackground = backgroundDrawable\n+\t\t}\n+\n+\t\tbadgeContainers = mapOf<BadgeLocation, ViewGroup>(\n+\t\t\tBadgeLocation.TOP_LEFT to badge_top_left,\n+\t\t\tBadgeLocation.TOP_RIGHT to badge_top_right,\n+\t\t\tBadgeLocation.BOTTOM_LEFT to badge_bottom_left,\n+\t\t\tBadgeLocation.BOTTOM_RIGHT to badge_bottom_right,\n+\t\t\tBadgeLocation.CONTENT_LEFT to content_badge_left,\n+\t\t\tBadgeLocation.CONTENT_RIGHT to content_badge_right\n+\t\t)\n+\n+\t\tcardAttrs.recycle()\n+\t}\n+\n+\tfun setBadge(badge: View?, badgeLocation: BadgeLocation) {\n+\t\tval badgeContainer = badgeContainers.getValue(badgeLocation)\n+\t\tbadgeContainer.removeAllViews()\n+\n+\t\tif (badge != null) {\n+\t\t\tbadgeContainer.apply {\n+\t\t\t\tvisibility = ViewGroup.VISIBLE\n+\t\t\t\taddView(badge)\n+\t\t\t}\n+\t\t} else {\n+\t\t\tbadgeContainer.apply {\n+\t\t\t\tvisibility = ViewGroup.GONE\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tfun setMainImage(drawable: Drawable?, fade: Boolean) {\n+\t\tmain_image.setImageDrawable(drawable)\n+\n+\t\tif (drawable == null) {\n+\t\t\tmFadeInAnimator.cancel()\n+\t\t\tmain_image.apply {\n+\t\t\t\talpha = 1f\n+\t\t\t\tvisibility = View.INVISIBLE\n+\t\t\t}\n+\t\t} else {\n+\t\t\tif (fade) {\n+\t\t\t\tfadeIn()\n+\t\t\t} else {\n+\t\t\t\tmFadeInAnimator.cancel()\n+\t\t\t\tmain_image.alpha = 1f\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tfun setMainImageDimensions(width: Int, height: Int) {", "originalCommit": "b048f887749bc29236beefb8c06aa707b72e7194", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU0MTQxMQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/332#discussion_r378541411", "bodyText": "No, it takes raw pixels atm, should I move to dp?", "author": "AndreasGB", "createdAt": "2020-02-12T22:08:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ3MTY2NA=="}], "type": "inlineReview"}, {"oid": "a5d7ade58f56a9d8a5eb542d432d6fd779ee33fb", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/a5d7ade58f56a9d8a5eb542d432d6fd779ee33fb", "message": "Use Int extension method for dp conversion + tiny bugfix", "committedDate": "2020-02-12T22:29:07Z", "type": "commit"}, {"oid": "834aa6f61b2a5581b3165f63b5a081104c8db5a2", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/834aa6f61b2a5581b3165f63b5a081104c8db5a2", "message": "Move MultiBadgeImageCardView to UI package", "committedDate": "2020-02-13T10:06:38Z", "type": "commit"}]}