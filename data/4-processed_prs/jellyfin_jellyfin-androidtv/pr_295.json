{"pr_number": 295, "pr_title": "Implement Cast display for Movies", "pr_createdAt": "2020-02-05T19:54:42Z", "pr_url": "https://github.com/jellyfin/jellyfin-androidtv/pull/295", "timeline": [{"oid": "6a9383bcc21e58b0ab3c90ab3177c8691f5ad76f", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/6a9383bcc21e58b0ab3c90ab3177c8691f5ad76f", "message": "Initial PersonPresenter as well as cast display for movies", "committedDate": "2020-02-05T19:49:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQ5NTU3NA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/295#discussion_r375495574", "bodyText": "Can be moved to a seperate file as it doesn't use our base class (yet?)", "author": "nielsvanvelzen", "createdAt": "2020-02-05T20:39:58Z", "path": "app/src/main/java/org/jellyfin/androidtv/model/itemtypes/LiftedItems.kt", "diffHunk": "@@ -36,4 +39,14 @@ class Episode(original: BaseItemDto) : PlayableItem(original) {\n \t}\n }\n \n-class Movie(original: BaseItemDto) : PlayableItem(original)\n+class Person(original: BaseItemPerson) {", "originalCommit": "6a9383bcc21e58b0ab3c90ab3177c8691f5ad76f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTUwMDI3Nw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/295#discussion_r375500277", "bodyText": "Oh, forgot to ask that. I wonder if persons should remain separate or become an item as well. Currently they are their entirely own thing in the apiclient", "author": "AndreasGB", "createdAt": "2020-02-05T20:50:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQ5NTU3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQ5NTc1Nw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/295#discussion_r375495757", "bodyText": "Don't persons support multiple images? In that case we could use the imagecollection", "author": "nielsvanvelzen", "createdAt": "2020-02-05T20:40:24Z", "path": "app/src/main/java/org/jellyfin/androidtv/model/itemtypes/LiftedItems.kt", "diffHunk": "@@ -36,4 +39,14 @@ class Episode(original: BaseItemDto) : PlayableItem(original) {\n \t}\n }\n \n-class Movie(original: BaseItemDto) : PlayableItem(original)\n+class Person(original: BaseItemPerson) {\n+\tval id: String = original.id\n+\tval name: String = original.name\n+\tval role: String = original.role\n+\tval type: PersonType = original.personType\n+\tval primaryImage: ImageCollection.Image? = original.primaryImageTag?.let { ImageCollection.Image(original.id, ImageType.Primary, it) }", "originalCommit": "6a9383bcc21e58b0ab3c90ab3177c8691f5ad76f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQ5OTc4Mw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/295#discussion_r375499783", "bodyText": "I doesn't seem like they do, Persons are weirdly different from all other items. (https://github.com/jellyfin/jellyfin-apiclient-java/blob/36cd46c6682fd9506385f87510e182fa332e5210/library/src/main/java/org/jellyfin/apiclient/model/dto/BaseItemPerson.java)", "author": "AndreasGB", "createdAt": "2020-02-05T20:49:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQ5NTc1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTUwMTM2Ng==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/295#discussion_r375501366", "bodyText": "I looked at the network responses in the web version and it looks like the \"BaseItemPerson\" is not actually the base type \"person\". It's an object used with minimal data showing the relation between a series/movie and a person.\nWe should probably rename it", "author": "nielsvanvelzen", "createdAt": "2020-02-05T20:52:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQ5NTc1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU2MTE0Ng==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/295#discussion_r375561146", "bodyText": "Oh whoops. FullDetailsActivity uses it to display this row, so I assumed it is the only representation of persons :D Will do the rename later.", "author": "AndreasGB", "createdAt": "2020-02-05T23:13:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQ5NTc1Nw=="}], "type": "inlineReview"}, {"oid": "4b0ee283b5e7eaff1f1f3d0c3aad32c4c8ebc9ea", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/4b0ee283b5e7eaff1f1f3d0c3aad32c4c8ebc9ea", "message": "Item Click handling moved to Presenters, new Marquee ImageCardView Style, Refactoring", "committedDate": "2020-02-07T13:48:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYwMjc4Mg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/295#discussion_r376602782", "bodyText": "override fun onBindViewHolder(viewHolder: ViewHolder, item: Any) {\nshould work, so you won't need the requireNotNull calls", "author": "nielsvanvelzen", "createdAt": "2020-02-07T20:54:45Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/PersonPresenter.kt", "diffHunk": "@@ -1,28 +1,42 @@\n package org.jellyfin.androidtv.details\n \n+import android.content.Context\n+import android.content.Intent\n import android.graphics.drawable.BitmapDrawable\n import android.view.ViewGroup\n+import androidx.appcompat.view.ContextThemeWrapper\n import androidx.leanback.widget.ImageCardView\n-import androidx.leanback.widget.Presenter\n import kotlinx.coroutines.Dispatchers\n import kotlinx.coroutines.GlobalScope\n import kotlinx.coroutines.launch\n import org.jellyfin.androidtv.R\n import org.jellyfin.androidtv.TvApp\n-import org.jellyfin.androidtv.model.itemtypes.Person\n-import org.jellyfin.androidtv.presentation.MyImageCardView\n+import org.jellyfin.androidtv.base.ClickablePresenter\n+import org.jellyfin.androidtv.model.itemtypes.BriefPersonData\n \n private const val LOG_TAG = \"PersonPresenter\"\n \n-class PersonPresenter : Presenter() {\n+class PersonPresenter(private val context: Context) : ClickablePresenter() {\n+\n+\toverride fun onItemClicked(item: Any?) {\n+\t\trequireNotNull(item)\n+\t\tval person = item as BriefPersonData\n+\t\tval intent = Intent(context, FullDetailsActivity::class.java)\n+\t\tintent.putExtra(\"ItemId\", person.id)\n+\n+\t\tcontext.startActivity(intent)\n+\t}\n+\n \toverride fun onCreateViewHolder(parent: ViewGroup?): ViewHolder {\n-\t\treturn ViewHolder(ImageCardView(parent!!.context))\n+\t\treturn ViewHolder(ImageCardView(ContextThemeWrapper(parent!!.context, R.style.MarqueeImageCardViewTheme)))\n \t}\n \n \toverride fun onBindViewHolder(viewHolder: ViewHolder?, item: Any?) {", "originalCommit": "4b0ee283b5e7eaff1f1f3d0c3aad32c4c8ebc9ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYwMzA5Nw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/295#discussion_r376603097", "bodyText": "Interface might be better if it only defines the \"clickability\"", "author": "nielsvanvelzen", "createdAt": "2020-02-07T20:55:39Z", "path": "app/src/main/java/org/jellyfin/androidtv/base/ClickablePresenter.kt", "diffHunk": "@@ -0,0 +1,7 @@\n+package org.jellyfin.androidtv.base\n+\n+import androidx.leanback.widget.Presenter\n+\n+abstract class ClickablePresenter : Presenter() {", "originalCommit": "4b0ee283b5e7eaff1f1f3d0c3aad32c4c8ebc9ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYwMzI5OQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/295#discussion_r376603299", "bodyText": "Might be worth using a generic on the class/interface so we don't need to use the any type", "author": "nielsvanvelzen", "createdAt": "2020-02-07T20:56:06Z", "path": "app/src/main/java/org/jellyfin/androidtv/base/ClickablePresenter.kt", "diffHunk": "@@ -0,0 +1,7 @@\n+package org.jellyfin.androidtv.base\n+\n+import androidx.leanback.widget.Presenter\n+\n+abstract class ClickablePresenter : Presenter() {\n+\tabstract fun onItemClicked(item: Any?)", "originalCommit": "4b0ee283b5e7eaff1f1f3d0c3aad32c4c8ebc9ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYwNzE5OQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/295#discussion_r376607199", "bodyText": "Doesn't usage of generics yield completely different classes? In C# at least it does iirc. If so that mean as a consequence, that we can no longer call the onItemClicked method on a common parent type, no?", "author": "AndreasGB", "createdAt": "2020-02-07T21:05:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYwMzI5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYxNzkwNg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/295#discussion_r376617906", "bodyText": "I don't know how C# handles and have no idea if it actually is possible. If it does it will make the code more typesafe as I don't like having to cast \"Any\" to the objects we expect. Changes are it will introduce issues later.", "author": "nielsvanvelzen", "createdAt": "2020-02-07T21:33:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYwMzI5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjY2MTQwNg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/295#discussion_r376661406", "bodyText": "While I agree that it would be nice, I currently don't see a way to make it happen. I think somewhere a down cast has to happen, as we are given an Any for item. Maybe I'm too sleepy to see it right now though. Can you please have a look tomorrow as well?", "author": "AndreasGB", "createdAt": "2020-02-07T23:59:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYwMzI5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYwNDE4MQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/295#discussion_r376604181", "bodyText": "Use this.context instead of this.activity", "author": "nielsvanvelzen", "createdAt": "2020-02-07T20:58:04Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/MovieDetailsFragment.kt", "diffHunk": "@@ -1,22 +1,19 @@\n package org.jellyfin.androidtv.details\n \n-import android.content.Intent\n-import android.util.Log\n import androidx.leanback.widget.*\n import org.jellyfin.androidtv.R\n import org.jellyfin.androidtv.details.actions.*\n import org.jellyfin.androidtv.model.itemtypes.Movie\n-import org.jellyfin.androidtv.model.itemtypes.Person\n import org.jellyfin.androidtv.presentation.InfoCardPresenter\n \n private const val LOG_TAG = \"MovieDetailsFragment\"\n \n-class MovieDetailsFragment(item: Movie) : BaseDetailsFragment<Movie>(item), OnItemViewClickedListener {\n+class MovieDetailsFragment(item: Movie) : BaseDetailsFragment<Movie>(item) {\n \n \tprivate val detailsRow by lazy { DetailsOverviewRow(Unit).apply { actionsAdapter = ActionAdapter() } }\n //\tprivate val chaptersRow by lazy { Row() }\n //\tprivate val staffRow by lazy { Row() }\n-\tprivate val charactersRow by lazy { ListRow(HeaderItem(\"Cast/Crew\"), ArrayObjectAdapter(PersonPresenter())) }\n+\tprivate val charactersRow by lazy { ListRow(HeaderItem(\"Cast/Crew\"), ArrayObjectAdapter(PersonPresenter(this.activity!!))) }", "originalCommit": "4b0ee283b5e7eaff1f1f3d0c3aad32c4c8ebc9ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e5fe796ba251ca90abfabf9a03dc80cfdb9457b6", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/e5fe796ba251ca90abfabf9a03dc80cfdb9457b6", "message": "Refactoring ClickablePresenter to ItemClickListener Interface + minor other refactors", "committedDate": "2020-02-07T23:21:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjY5Nzg0MA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/295#discussion_r376697840", "bodyText": "We don't need this import. When using Android Studio you can have it fix your imports when creating commits. (option for this is in the commit dialog)", "author": "nielsvanvelzen", "createdAt": "2020-02-08T08:55:04Z", "path": "app/src/main/java/org/jellyfin/androidtv/base/IItemClickListener.kt", "diffHunk": "@@ -0,0 +1,7 @@\n+package org.jellyfin.androidtv.base\n+\n+import androidx.leanback.widget.Presenter", "originalCommit": "e5fe796ba251ca90abfabf9a03dc80cfdb9457b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjcwNjI1NQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/295#discussion_r376706255", "bodyText": "Okay, setting that now for the future, and removing this import. Thanks :)", "author": "AndreasGB", "createdAt": "2020-02-08T12:03:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjY5Nzg0MA=="}], "type": "inlineReview"}, {"oid": "648d7d0ee95811d8f0b260b459e2037f2cea21e7", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/648d7d0ee95811d8f0b260b459e2037f2cea21e7", "message": "Remove unnecessary import", "committedDate": "2020-02-08T12:03:37Z", "type": "commit"}]}