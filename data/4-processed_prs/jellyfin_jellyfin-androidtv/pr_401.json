{"pr_number": 401, "pr_title": "Add theme support", "pr_createdAt": "2020-03-15T06:21:44Z", "pr_url": "https://github.com/jellyfin/jellyfin-androidtv/pull/401", "timeline": [{"oid": "e046e08f13b2195c8e8ccfc02ae02f77e4112953", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/e046e08f13b2195c8e8ccfc02ae02f77e4112953", "message": "Add user preference for app theme", "committedDate": "2020-03-15T06:08:18Z", "type": "commit"}, {"oid": "8ca0ef3fd7bb914dc95abd088de988ee1a477d01", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/8ca0ef3fd7bb914dc95abd088de988ee1a477d01", "message": "Fix app theme preference position", "committedDate": "2020-03-15T06:08:18Z", "type": "commit"}, {"oid": "d226dc9feed7e8a962c800dfc486bd29f57dac5d", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/d226dc9feed7e8a962c800dfc486bd29f57dac5d", "message": "Add special theme", "committedDate": "2020-03-15T06:20:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY1NDI1OA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/401#discussion_r392654258", "bodyText": "If you make ThemeManager itself an object you won't need to do the companion object thingy.\nhttps://kotlinlang.org/docs/tutorials/kotlin-for-py/objects-and-companion-objects.html", "author": "nielsvanvelzen", "createdAt": "2020-03-15T08:59:21Z", "path": "app/src/main/java/org/jellyfin/androidtv/presentation/ThemeManager.kt", "diffHunk": "@@ -0,0 +1,28 @@\n+package org.jellyfin.androidtv.presentation\n+\n+import android.app.Activity\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.preferences.enums.AppTheme\n+import org.jellyfin.androidtv.preferences.ui.PreferencesActivity\n+\n+class ThemeManager {", "originalCommit": "d226dc9feed7e8a962c800dfc486bd29f57dac5d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY1NDQ4NQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/401#discussion_r392654485", "bodyText": "Can we rename the themes (or the enums) to have consistent naming?\nIt doesn't make sense to me like this:\n\nDark, Theme_Jellyfin\nEmerald, Theme_Jellyfin_Legacy\nHotdog, Theme_Jellyfin_HotDogStand", "author": "nielsvanvelzen", "createdAt": "2020-03-15T09:03:16Z", "path": "app/src/main/java/org/jellyfin/androidtv/preferences/enums/AppTheme.kt", "diffHunk": "@@ -0,0 +1,18 @@\n+package org.jellyfin.androidtv.preferences.enums\n+\n+enum class AppTheme {", "originalCommit": "d226dc9feed7e8a962c800dfc486bd29f57dac5d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY1NDU5OQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/401#discussion_r392654599", "bodyText": "Missing @string", "author": "nielsvanvelzen", "createdAt": "2020-03-15T09:05:43Z", "path": "app/src/main/res/xml/preferences.xml", "diffHunk": "@@ -26,6 +26,11 @@\n     </PreferenceCategory>\n \n     <PreferenceCategory android:title=\"@string/pref_general\">\n+        <ListPreference\n+            android:entries=\"@array/app_theme_entries\"\n+            android:entryValues=\"@array/app_theme_values\"\n+            android:key=\"app_theme\"\n+            android:title=\"App Theme\" />", "originalCommit": "d226dc9feed7e8a962c800dfc486bd29f57dac5d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY1NDkwMQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/401#discussion_r392654901", "bodyText": "Isn't it possible to use activity.setTheme() here?", "author": "nielsvanvelzen", "createdAt": "2020-03-15T09:10:15Z", "path": "app/src/main/java/org/jellyfin/androidtv/base/AppThemeCallbacks.kt", "diffHunk": "@@ -0,0 +1,54 @@\n+package org.jellyfin.androidtv.base\n+\n+import android.app.Activity\n+import android.app.Application\n+import android.os.Bundle\n+import android.util.Log\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.TvApp\n+import org.jellyfin.androidtv.preferences.enums.AppTheme\n+import org.jellyfin.androidtv.preferences.ui.PreferencesActivity\n+import org.jellyfin.androidtv.presentation.ThemeManager\n+\n+private const val LOG_TAG = \"AppThemeCallbacks\"\n+\n+class AppThemeCallbacks : Application.ActivityLifecycleCallbacks {\n+\tprivate var lastTheme: AppTheme? = null\n+\tprivate var lastPreferencesTheme: AppTheme? = null\n+\n+\toverride fun onActivityPaused(activity: Activity) {\n+\t}\n+\n+\toverride fun onActivityStarted(activity: Activity) {\n+\t}\n+\n+\toverride fun onActivityDestroyed(activity: Activity) {\n+\t}\n+\n+\toverride fun onActivitySaveInstanceState(activity: Activity, outState: Bundle) {\n+\t}\n+\n+\toverride fun onActivityStopped(activity: Activity) {\n+\t}\n+\n+\toverride fun onActivityCreated(activity: Activity, savedInstanceState: Bundle?) {\n+\t\tTvApp.getApplication().userPreferences.appTheme.let {\n+\t\t\tLog.i(LOG_TAG, \"Applying theme: $it\")\n+\t\t\tactivity.setTheme(ThemeManager.getTheme(activity, it))\n+\t\t\twhen (activity) {\n+\t\t\t\tis PreferencesActivity -> lastPreferencesTheme = it\n+\t\t\t\telse -> lastTheme = it\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\toverride fun onActivityResumed(activity: Activity) {\n+\t\tval lastThemeForActivity = if (activity is PreferencesActivity) lastPreferencesTheme else lastTheme\n+\t\tTvApp.getApplication().userPreferences.appTheme.let {\n+\t\t\tif (lastThemeForActivity != null && lastThemeForActivity != it) {", "originalCommit": "d226dc9feed7e8a962c800dfc486bd29f57dac5d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY3NDQ1Mw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/401#discussion_r392674453", "bodyText": "The activity has to be recreated for the theme to be applied.", "author": "thornbill", "createdAt": "2020-03-15T13:34:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY1NDkwMQ=="}], "type": "inlineReview"}, {"oid": "e771cc32e5f2b9788d5f89548b08b4e4bf8bfb01", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/e771cc32e5f2b9788d5f89548b08b4e4bf8bfb01", "message": "Fix code review feedback", "committedDate": "2020-03-16T19:48:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI3OTg1OA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/401#discussion_r393279858", "bodyText": "You forgot to update these with the enum change. (They should be exactly the same as the enums)", "author": "nielsvanvelzen", "createdAt": "2020-03-16T20:02:38Z", "path": "app/src/main/res/values/array.xml", "diffHunk": "@@ -3,6 +3,14 @@\n     xmlns:tools=\"http://schemas.android.com/tools\"\n     tools:ignore=\"MissingTranslation\">\n \n+    <string-array name=\"app_theme_entries\">\n+        <item>@string/pref_theme_dark</item>\n+        <item>@string/pref_theme_emerald</item>\n+    </string-array>\n+    <string-array name=\"app_theme_values\">", "originalCommit": "e771cc32e5f2b9788d5f89548b08b4e4bf8bfb01", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4cd69936becf826327ca052ae97a1f1e8c29b912", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/4cd69936becf826327ca052ae97a1f1e8c29b912", "message": "Fix array values and default value", "committedDate": "2020-03-16T20:24:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI5MzI4NQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/401#discussion_r393293285", "bodyText": "Adding app:useSimpleSummaryProvider=\"true\" will show the currently selected theme as \"description\".", "author": "nielsvanvelzen", "createdAt": "2020-03-16T20:32:25Z", "path": "app/src/main/res/xml/preferences.xml", "diffHunk": "@@ -26,6 +26,12 @@\n     </PreferenceCategory>\n \n     <PreferenceCategory android:title=\"@string/pref_general\">\n+        <ListPreference\n+            android:defaultValue=\"Theme_Jellyfin\"\n+            android:entries=\"@array/app_theme_entries\"\n+            android:entryValues=\"@array/app_theme_values\"\n+            android:key=\"app_theme\"\n+            android:title=\"@string/pref_app_theme\" />", "originalCommit": "4cd69936becf826327ca052ae97a1f1e8c29b912", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "79ae013efb96091bd2999b5a45df6ddb7be8684a", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/79ae013efb96091bd2999b5a45df6ddb7be8684a", "message": "Use simple summary provider for preferences", "committedDate": "2020-03-17T03:54:32Z", "type": "commit"}]}