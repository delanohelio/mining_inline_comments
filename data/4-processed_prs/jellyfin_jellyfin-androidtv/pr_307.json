{"pr_number": 307, "pr_title": "Custom detail layout", "pr_createdAt": "2020-02-06T18:58:21Z", "pr_url": "https://github.com/jellyfin/jellyfin-androidtv/pull/307", "timeline": [{"oid": "8a247ce1b474601ad83fab494f93d18311c8021c", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/8a247ce1b474601ad83fab494f93d18311c8021c", "message": "Add critics rating and start on media stream info", "committedDate": "2020-02-14T15:17:33Z", "type": "forcePushed"}, {"oid": "606e2280ef915bed7747eb0563f80e62136e29b9", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/606e2280ef915bed7747eb0563f80e62136e29b9", "message": "Start on detail layout", "committedDate": "2020-02-14T16:30:55Z", "type": "commit"}, {"oid": "9ae4522bf77bce701c6a444703302790609a5549", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/9ae4522bf77bce701c6a444703302790609a5549", "message": "Add genres", "committedDate": "2020-02-14T16:30:56Z", "type": "commit"}, {"oid": "0af2830bc8f6b4c8bc76b878f90299fb8be9b4cd", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/0af2830bc8f6b4c8bc76b878f90299fb8be9b4cd", "message": "Add new genre dto class (depends on jellyfin-apiclient-java#36)", "committedDate": "2020-02-14T16:30:57Z", "type": "commit"}, {"oid": "c1a61b6d94ee3e3ab4ad188dac66e15bb51a87b1", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/c1a61b6d94ee3e3ab4ad188dac66e15bb51a87b1", "message": "Add tags and original title", "committedDate": "2020-02-14T16:30:58Z", "type": "commit"}, {"oid": "7075e948e8bca9fcb0ac73394febc01ac42d9576", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/7075e948e8bca9fcb0ac73394febc01ac42d9576", "message": "Add official rating", "committedDate": "2020-02-14T16:30:59Z", "type": "commit"}, {"oid": "08ee105f65ae353cac4161ed492d8d88fcfb7eab", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/08ee105f65ae353cac4161ed492d8d88fcfb7eab", "message": "small change", "committedDate": "2020-02-14T16:31:00Z", "type": "commit"}, {"oid": "d47010c37f5f6628c12eb926a0f6680b5c526088", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/d47010c37f5f6628c12eb926a0f6680b5c526088", "message": "Add critics rating and start on media stream info", "committedDate": "2020-02-14T16:31:00Z", "type": "commit"}, {"oid": "10a5d4c1b27cf8d83565a4da77b03a4d6468ca2f", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/10a5d4c1b27cf8d83565a4da77b03a4d6468ca2f", "message": "Fix bad rebase", "committedDate": "2020-02-14T16:31:34Z", "type": "commit"}, {"oid": "8fd93c26ffd50ba4323154c2717c370c6065f1a0", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/8fd93c26ffd50ba4323154c2717c370c6065f1a0", "message": "Use actual stream information", "committedDate": "2020-02-14T16:31:35Z", "type": "commit"}, {"oid": "46a707b37bb753c7226bc661a441ad30790c4ba6", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/46a707b37bb753c7226bc661a441ad30790c4ba6", "message": "Add duration / ends labels", "committedDate": "2020-02-14T16:31:36Z", "type": "commit"}, {"oid": "46a707b37bb753c7226bc661a441ad30790c4ba6", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/46a707b37bb753c7226bc661a441ad30790c4ba6", "message": "Add duration / ends labels", "committedDate": "2020-02-14T16:31:36Z", "type": "forcePushed"}, {"oid": "4938efb6babab38b0e622d4b3b6794f88bf6adc3", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/4938efb6babab38b0e622d4b3b6794f88bf6adc3", "message": "Fix large margins when description is missing or small", "committedDate": "2020-02-14T16:49:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTgyOTI5OA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/307#discussion_r379829298", "bodyText": "Wait.. when did I do this lol", "author": "nielsvanvelzen", "createdAt": "2020-02-15T12:40:26Z", "path": "app/src/main/res/layout/row_details_description_genre_button.xml", "diffHunk": "@@ -0,0 +1,14 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<Button xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:tools=\"http://schemas.android.com/tools\"\n+    style=\"@style/Button.Outline\"\n+    android:layout_width=\"wrap_content\"\n+    android:layout_height=\"wrap_content\"\n+    android:minHeight=\"0dp\"\n+    android:minWidth=\"0dp\"\n+    tools:text=\"Fantasy\"", "originalCommit": "4938efb6babab38b0e622d4b3b6794f88bf6adc3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTgyODY4MQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/307#discussion_r379828681", "bodyText": "As mentioned in chat, should be 10000", "author": "AndreasGB", "createdAt": "2020-02-15T12:26:46Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/DetailsDescriptionPresenter.kt", "diffHunk": "@@ -1,16 +1,156 @@\n package org.jellyfin.androidtv.details\n \n-import androidx.leanback.widget.AbstractDetailsDescriptionPresenter\n+import android.text.SpannableStringBuilder\n+import android.text.format.DateFormat\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import android.widget.LinearLayout\n+import android.widget.TextView\n+import androidx.core.text.bold\n+import androidx.leanback.widget.Presenter\n+import androidx.recyclerview.widget.RecyclerView\n+import kotlinx.android.synthetic.main.row_details_description.view.*\n+import org.jellyfin.androidtv.R\n import org.jellyfin.androidtv.model.itemtypes.BaseItem\n+import org.jellyfin.androidtv.model.itemtypes.Movie\n+import org.jellyfin.androidtv.model.itemtypes.PlayableItem\n+import org.jellyfin.androidtv.ui.RecyclerViewSpacingDecoration\n+import org.jellyfin.androidtv.ui.widget.Rating\n+import org.jellyfin.androidtv.util.TimeUtils\n+import org.jellyfin.apiclient.model.entities.MediaStreamType\n \n-class DetailsDescriptionPresenter : AbstractDetailsDescriptionPresenter() {\n-\toverride fun onBindDescription(viewHolder: ViewHolder, item: Any) {\n-\t\tif (item !is BaseItem) return\n+class DetailsDescriptionPresenter : Presenter() {\n+\tclass ViewHolder(view: View) : Presenter.ViewHolder(view) {\n+\t\tval title: TextView = view.findViewById(R.id.details_description_title)\n+\t\tval subtitle: TextView = view.findViewById(R.id.details_description_subtitle)\n \n-\t\tviewHolder.also {\n-\t\t\tit.title.text = item.name\n-//\t\t\tit.subtitle.text = subtitle\n-\t\t\tit.body.text = item.description\n+\t\tval year: TextView = view.details_description_year\n+\t\tval officialRating: TextView = view.details_description_official_rating\n+\t\tval communityRating: Rating = view.details_description_community_rating\n+\t\tval criticsRating: Rating = view.details_description_critics_rating\n+\n+\t\tval genres: RecyclerView = view.details_description_genres.apply {\n+\t\t\tadapter = GenreAdapter()\n+\t\t\taddItemDecoration(RecyclerViewSpacingDecoration(8))\n \t\t}\n+\n+\t\tval body: TextView = view.details_description_body\n+\n+\t\tval tags: TextView = view.details_description_tags\n+\n+\t\tval durationInfo: LinearLayout = view.details_description_duration_info\n+\t\tval duration: TextView = view.details_description_duration_info_duration\n+\t\tval endsAt: TextView = view.details_description_duration_info_end\n+\n+\t\tval streams: LinearLayout = view.details_description_streams\n+\t\tval videoStreamLabel: TextView = view.details_description_streams_video_label\n+\t\tval videoStreamValue: TextView = view.details_description_streams_video_value\n+\t\tval audioStreamLabel: TextView = view.details_description_streams_audio_label\n+\t\tval audioStreamValue: TextView = view.details_description_streams_audio_value\n+\t\tval textStreamLabel: TextView = view.details_description_streams_text_label\n+\t\tval textStreamValue: TextView = view.details_description_streams_text_value\n+\t}\n+\n+\toverride fun onCreateViewHolder(parent: ViewGroup): ViewHolder {\n+\t\tval view = LayoutInflater\n+\t\t\t.from(parent.context)\n+\t\t\t.inflate(R.layout.row_details_description, parent, false)\n+\n+\t\treturn ViewHolder(view)\n \t}\n+\n+\toverride fun onBindViewHolder(viewHolder: Presenter.ViewHolder, item: Any) {\n+\t\tviewHolder as ViewHolder\n+\t\titem as BaseItem\n+\n+\t\t// title\n+\t\tviewHolder.title.text = item.title\n+\n+\t\t// Original title\n+\t\tif (item.titleOriginal != null && item.titleOriginal != item.title) {\n+\t\t\tviewHolder.subtitle.text = item.titleOriginal\n+\t\t\tviewHolder.subtitle.visibility = View.VISIBLE\n+\t\t} else {\n+\t\t\tviewHolder.subtitle.visibility = View.GONE\n+\t\t}\n+\n+\t\t// rating\n+\t\tif (item is Movie) { //todo move those properties to baseitem or something\n+\t\t\tviewHolder.year.text = item.productionYear.toString()\n+\n+\t\t\tif (item.officialRating != null) {\n+\t\t\t\tviewHolder.officialRating.text = item.officialRating\n+\t\t\t\tviewHolder.officialRating.visibility = View.VISIBLE\n+\t\t\t} else {\n+\t\t\t\tviewHolder.officialRating.visibility = View.GONE\n+\t\t\t}\n+\n+\t\t\tviewHolder.communityRating.value = item.communityRating\n+\n+\t\t\tif (item.criticsRating != null) {\n+\t\t\t\tviewHolder.criticsRating.value = item.criticsRating\n+\t\t\t\tviewHolder.criticsRating.visibility = View.VISIBLE\n+\t\t\t} else {\n+\t\t\t\tviewHolder.criticsRating.visibility = View.GONE\n+\t\t\t}\n+\t\t}\n+\n+\t\tif (item is PlayableItem) {\n+\t\t\t(viewHolder.genres.adapter as GenreAdapter).setItems(item.genres)\n+\n+\t\t\tval videoStream = item.mediaInfo.streams.find { it.type == MediaStreamType.Video }\n+\t\t\tif (videoStream != null) {\n+\t\t\t\tviewHolder.videoStreamValue.text = videoStream.displayTitle\n+\t\t\t\tviewHolder.videoStreamLabel.visibility = View.VISIBLE\n+\t\t\t\tviewHolder.videoStreamValue.visibility = View.VISIBLE\n+\t\t\t} else {\n+\t\t\t\tviewHolder.videoStreamLabel.visibility = View.GONE\n+\t\t\t\tviewHolder.videoStreamValue.visibility = View.GONE\n+\t\t\t}\n+\n+\t\t\tval audioStream = item.mediaInfo.streams.find { it.type == MediaStreamType.Audio }\n+\t\t\tif (audioStream != null) {\n+\t\t\t\tviewHolder.audioStreamValue.text = audioStream.displayTitle\n+\t\t\t\tviewHolder.audioStreamLabel.visibility = View.VISIBLE\n+\t\t\t\tviewHolder.audioStreamValue.visibility = View.VISIBLE\n+\t\t\t} else {\n+\t\t\t\tviewHolder.audioStreamLabel.visibility = View.GONE\n+\t\t\t\tviewHolder.audioStreamValue.visibility = View.GONE\n+\t\t\t}\n+\n+\t\t\tval textStream = item.mediaInfo.streams.find { it.type == MediaStreamType.Subtitle }\n+\t\t\tif (textStream != null) {\n+\t\t\t\tviewHolder.textStreamValue.text = textStream.displayTitle\n+\t\t\t\tviewHolder.textStreamLabel.visibility = View.VISIBLE\n+\t\t\t\tviewHolder.textStreamValue.visibility = View.VISIBLE\n+\t\t\t} else {\n+\t\t\t\tviewHolder.textStreamLabel.visibility = View.GONE\n+\t\t\t\tviewHolder.textStreamValue.visibility = View.GONE\n+\t\t\t}\n+\n+\t\t\tviewHolder.streams.visibility = View.VISIBLE\n+\n+\t\t\tviewHolder.duration.text = TimeUtils.formatMillis(item.durationTicks / 10000)\n+\t\t\tviewHolder.endsAt.text = DateFormat.getTimeFormat(viewHolder.view.context).format(System.currentTimeMillis() + (item.durationTicks - item.playbackPositionTicks) / 1000)", "originalCommit": "4938efb6babab38b0e622d4b3b6794f88bf6adc3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTgyOTY3Mg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/307#discussion_r379829672", "bodyText": "Why do you create the elements manually and not using a layout file?", "author": "AndreasGB", "createdAt": "2020-02-15T12:48:59Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/widget/Rating.kt", "diffHunk": "@@ -0,0 +1,73 @@\n+package org.jellyfin.androidtv.ui.widget\n+\n+import android.content.Context\n+import android.util.AttributeSet\n+import android.view.Gravity\n+import android.view.View\n+import android.widget.ImageView\n+import android.widget.RelativeLayout\n+import android.widget.TextView\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.util.dp\n+import kotlin.math.roundToInt\n+import kotlin.properties.Delegates\n+\n+class Rating(context: Context, attrs: AttributeSet?) : RelativeLayout(context, attrs) {\n+\tprivate val attributes = context.theme.obtainStyledAttributes(attrs, R.styleable.Rating, 0, 0)\n+\n+\tprivate val imageView = ImageView(context).apply {", "originalCommit": "4938efb6babab38b0e622d4b3b6794f88bf6adc3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1NjI2MQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/307#discussion_r379856261", "bodyText": "It's simple enough to not use a XML file. I hate XML files. If I don't need to use them I don't.", "author": "nielsvanvelzen", "createdAt": "2020-02-15T21:10:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTgyOTY3Mg=="}], "type": "inlineReview"}, {"oid": "68c8b9947df636cfcd876449e6ec87c048d046de", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/68c8b9947df636cfcd876449e6ec87c048d046de", "message": "Misc fixes", "committedDate": "2020-02-15T21:15:12Z", "type": "commit"}]}