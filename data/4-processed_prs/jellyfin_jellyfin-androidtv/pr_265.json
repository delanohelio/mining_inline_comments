{"pr_number": 265, "pr_title": "Playing Next screen", "pr_createdAt": "2020-01-17T22:12:39Z", "pr_url": "https://github.com/jellyfin/jellyfin-androidtv/pull/265", "timeline": [{"oid": "0e3a42ccbf1e48cd07a7e8653c3b85c0969b0618", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/0e3a42ccbf1e48cd07a7e8653c3b85c0969b0618", "message": "Fix text overflowing in large descriptions causing the layout to look weird", "committedDate": "2020-02-08T21:38:49Z", "type": "forcePushed"}, {"oid": "9154bea85e1449438c0203c49d5490bd9ad5c058", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/9154bea85e1449438c0203c49d5490bd9ad5c058", "message": "Fix import", "committedDate": "2020-02-13T09:50:10Z", "type": "forcePushed"}, {"oid": "3dba76e453614799b30054d4d6024c05ed110155", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/3dba76e453614799b30054d4d6024c05ed110155", "message": "Add setting to choose timeout", "committedDate": "2020-02-13T15:32:23Z", "type": "forcePushed"}, {"oid": "7376501b9bd4137031251eabe1dcb9d7e238e8c9", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/7376501b9bd4137031251eabe1dcb9d7e238e8c9", "message": "Add setting to choose timeout", "committedDate": "2020-02-13T18:04:49Z", "type": "forcePushed"}, {"oid": "5b4c54711e25b9ac70a5064fcd48064fd0e4fa31", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/5b4c54711e25b9ac70a5064fcd48064fd0e4fa31", "message": "Initial progress", "committedDate": "2020-02-16T11:43:53Z", "type": "commit"}, {"oid": "35383f8478f326cefb73e95b18de5b0722929d56", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/35383f8478f326cefb73e95b18de5b0722929d56", "message": "Design update", "committedDate": "2020-02-16T11:43:54Z", "type": "commit"}, {"oid": "e16fae93bea68723081e9429440b0af1ba69400d", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/e16fae93bea68723081e9429440b0af1ba69400d", "message": "Start on actions", "committedDate": "2020-02-16T11:43:55Z", "type": "commit"}, {"oid": "0f8cc87279afc5874b011174c9ce09fa8567bc59", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/0f8cc87279afc5874b011174c9ce09fa8567bc59", "message": "Rewrite without leanback", "committedDate": "2020-02-16T11:43:55Z", "type": "commit"}, {"oid": "70db1529b8873956f20ca2005e53c2175dd9d64a", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/70db1529b8873956f20ca2005e53c2175dd9d64a", "message": "Move content loading to activity", "committedDate": "2020-02-16T11:43:56Z", "type": "commit"}, {"oid": "374a9a5e574a9a53645bb824f77ad4ac81f2e19b", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/374a9a5e574a9a53645bb824f77ad4ac81f2e19b", "message": "Initial integration", "committedDate": "2020-02-16T11:43:57Z", "type": "commit"}, {"oid": "677986912814ab6af3698e133fbb4306226f01f1", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/677986912814ab6af3698e133fbb4306226f01f1", "message": "Misc", "committedDate": "2020-02-16T11:43:58Z", "type": "commit"}, {"oid": "371d285e3968cd515af671725a54d1a61edc225f", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/371d285e3968cd515af671725a54d1a61edc225f", "message": "Fix up next not playing video", "committedDate": "2020-02-16T11:43:59Z", "type": "commit"}, {"oid": "afdc48146ede53d2f6109c8563868703638f589d", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/afdc48146ede53d2f6109c8563868703638f589d", "message": "Fix hardcoded string", "committedDate": "2020-02-16T11:43:59Z", "type": "commit"}, {"oid": "bde415414d555146e570f304bbe6b8fd3294e57e", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/bde415414d555146e570f304bbe6b8fd3294e57e", "message": "Log close reason", "committedDate": "2020-02-16T11:43:59Z", "type": "commit"}, {"oid": "7baf50cf4d47739f91d6c75c51e32e808b998b45", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/7baf50cf4d47739f91d6c75c51e32e808b998b45", "message": "Fix text overflowing in large descriptions causing the layout to look weird", "committedDate": "2020-02-16T11:44:00Z", "type": "commit"}, {"oid": "5b20b49769e829f1b87b6154054196e9bac9eb34", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/5b20b49769e829f1b87b6154054196e9bac9eb34", "message": "Fix import", "committedDate": "2020-02-16T11:44:01Z", "type": "commit"}, {"oid": "0443d9e5531f966fdd434a026c979a0212d3087b", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/0443d9e5531f966fdd434a026c979a0212d3087b", "message": "Add setting to choose timeout", "committedDate": "2020-02-16T11:44:26Z", "type": "commit"}, {"oid": "59a0fd9e6aa55ea07e9bf6f13ce08555a594fc65", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/59a0fd9e6aa55ea07e9bf6f13ce08555a594fc65", "message": "Convert to constraint layout", "committedDate": "2020-02-16T11:44:27Z", "type": "commit"}, {"oid": "3fd1f9e3e88620c1598fb9550e5ee23102eea9ca", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/3fd1f9e3e88620c1598fb9550e5ee23102eea9ca", "message": "Use buttons for a better user experience", "committedDate": "2020-02-16T11:44:28Z", "type": "commit"}, {"oid": "9c9986229a065d96869d83972be2257501b193dc", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/9c9986229a065d96869d83972be2257501b193dc", "message": "Rename from upnext, UpNext and up_next to NextUp and next_up", "committedDate": "2020-02-16T11:44:28Z", "type": "commit"}, {"oid": "02f7bc0239a2eb17a8d4e2e8dce5c9f21596005c", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/02f7bc0239a2eb17a8d4e2e8dce5c9f21596005c", "message": "Start on custom button that can show progress", "committedDate": "2020-02-16T11:44:29Z", "type": "commit"}, {"oid": "408548c5a2ee74be1b4eb6fa8695aa75cebe7dc7", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/408548c5a2ee74be1b4eb6fa8695aa75cebe7dc7", "message": "Finish progress bar in button", "committedDate": "2020-02-16T12:04:27Z", "type": "commit"}, {"oid": "408548c5a2ee74be1b4eb6fa8695aa75cebe7dc7", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/408548c5a2ee74be1b4eb6fa8695aa75cebe7dc7", "message": "Finish progress bar in button", "committedDate": "2020-02-16T12:04:27Z", "type": "forcePushed"}, {"oid": "badbd2d532a182ee07ba90a1f403107572c63dba", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/badbd2d532a182ee07ba90a1f403107572c63dba", "message": "Remove debug code", "committedDate": "2020-02-16T12:08:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkwMTI5MQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/265#discussion_r379901291", "bodyText": "Is that comment really correct?", "author": "AndreasGB", "createdAt": "2020-02-16T12:55:26Z", "path": "app/src/main/java/org/jellyfin/androidtv/util/apiclient/ApiClientExtensions.kt", "diffHunk": "@@ -27,3 +29,12 @@ suspend fun ApiClient.getUserViews(): ItemsResult? = suspendCoroutine { continua\n \t\toverride fun onError(exception: Exception?) = continuation.resume(null)\n \t})\n }\n+/**\n+ * Adds a coroutine capable version of the \"getNextUpEpisodes\" function", "originalCommit": "badbd2d532a182ee07ba90a1f403107572c63dba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkwNTc0OQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/265#discussion_r379905749", "bodyText": "no it's not", "author": "nielsvanvelzen", "createdAt": "2020-02-16T14:04:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkwMTI5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkwMjE4MQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/265#discussion_r379902181", "bodyText": "I would remove the padding here to make it better to fit into other views, who then themselves can decide how to margin it", "author": "AndreasGB", "createdAt": "2020-02-16T13:09:13Z", "path": "app/src/main/res/layout/fragment_next_up_buttons.xml", "diffHunk": "@@ -0,0 +1,46 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:tools=\"http://schemas.android.com/tools\"\n+    android:layout_width=\"wrap_content\"\n+    android:layout_height=\"wrap_content\"\n+    android:orientation=\"horizontal\"\n+    android:padding=\"16dp\">", "originalCommit": "badbd2d532a182ee07ba90a1f403107572c63dba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkwMjI2MQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/265#discussion_r379902261", "bodyText": "Would move this into the Overlay layout", "author": "AndreasGB", "createdAt": "2020-02-16T13:11:04Z", "path": "app/src/main/res/layout/fragment_next_up.xml", "diffHunk": "@@ -0,0 +1,76 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    xmlns:tools=\"http://schemas.android.com/tools\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"match_parent\"\n+    tools:background=\"@drawable/moviebg\">\n+\n+    <!-- Overlay -->\n+    <androidx.constraintlayout.widget.ConstraintLayout\n+        android:id=\"@+id/content\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:background=\"@drawable/noise\"\n+        android:orientation=\"horizontal\"\n+        android:padding=\"16dp\"\n+        app:layout_constraintBottom_toBottomOf=\"parent\"\n+        app:layout_constraintEnd_toEndOf=\"parent\"\n+        app:layout_constraintStart_toStartOf=\"parent\">\n+\n+        <ImageView\n+            android:id=\"@+id/image\"\n+            style=\"@style/Widget.Leanback\"\n+            android:layout_width=\"wrap_content\"\n+            android:layout_height=\"175dp\"\n+            android:adjustViewBounds=\"true\"\n+            android:maxWidth=\"400dp\"\n+            app:layout_constraintStart_toStartOf=\"parent\"\n+            app:layout_constraintTop_toTopOf=\"parent\"\n+            app:layout_goneMarginEnd=\"0dp\"\n+            tools:src=\"@drawable/app_logo\" />\n+\n+        <TextView\n+            android:id=\"@+id/nextup\"\n+            style=\"@style/TextAppearance.Leanback.DetailsDescriptionTitle\"\n+            android:layout_width=\"0dp\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_marginStart=\"16dp\"\n+            android:text=\"@string/lbl_next_up\"\n+            app:layout_constraintEnd_toEndOf=\"parent\"\n+            app:layout_constraintStart_toEndOf=\"@id/image\"\n+            app:layout_constraintTop_toTopOf=\"parent\" />\n+\n+        <TextView\n+            android:id=\"@+id/title\"\n+            style=\"@style/TextAppearance.Leanback.DetailsDescriptionSubtitle\"\n+            android:layout_width=\"0dp\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_marginStart=\"16dp\"\n+            app:layout_constraintEnd_toEndOf=\"parent\"\n+            app:layout_constraintStart_toEndOf=\"@id/image\"\n+            app:layout_constraintTop_toBottomOf=\"@id/nextup\"\n+            tools:text=\"Episode title\" />\n+\n+        <TextView\n+            android:id=\"@+id/description\"\n+            style=\"@style/TextAppearance.Leanback.DetailsDescriptionBody\"\n+            android:layout_width=\"0dp\"\n+            android:layout_height=\"0dp\"\n+            android:layout_marginStart=\"16dp\"\n+            android:ellipsize=\"end\"\n+            android:maxLines=\"6\"\n+            app:layout_constraintBottom_toBottomOf=\"parent\"\n+            app:layout_constraintEnd_toEndOf=\"parent\"\n+            app:layout_constraintStart_toEndOf=\"@id/image\"\n+            app:layout_constraintTop_toBottomOf=\"@id/title\"\n+            tools:text=\"Episode description\" />\n+    </androidx.constraintlayout.widget.ConstraintLayout>\n+\n+    <org.jellyfin.androidtv.playback.nextup.NextUpButtons", "originalCommit": "badbd2d532a182ee07ba90a1f403107572c63dba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkwNTk1MQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/265#discussion_r379905951", "bodyText": "This should be done at a later moment when we're supporting a negative timeout for the buttons. For now it's embedded in the fragment so the code is entirely separated.", "author": "nielsvanvelzen", "createdAt": "2020-02-16T14:08:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkwMjI2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkwMjI4Mg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/265#discussion_r379902282", "bodyText": "Would set this to 4 to end above the NextUpButtons", "author": "AndreasGB", "createdAt": "2020-02-16T13:11:27Z", "path": "app/src/main/res/layout/fragment_next_up.xml", "diffHunk": "@@ -0,0 +1,76 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    xmlns:tools=\"http://schemas.android.com/tools\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"match_parent\"\n+    tools:background=\"@drawable/moviebg\">\n+\n+    <!-- Overlay -->\n+    <androidx.constraintlayout.widget.ConstraintLayout\n+        android:id=\"@+id/content\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:background=\"@drawable/noise\"\n+        android:orientation=\"horizontal\"\n+        android:padding=\"16dp\"\n+        app:layout_constraintBottom_toBottomOf=\"parent\"\n+        app:layout_constraintEnd_toEndOf=\"parent\"\n+        app:layout_constraintStart_toStartOf=\"parent\">\n+\n+        <ImageView\n+            android:id=\"@+id/image\"\n+            style=\"@style/Widget.Leanback\"\n+            android:layout_width=\"wrap_content\"\n+            android:layout_height=\"175dp\"\n+            android:adjustViewBounds=\"true\"\n+            android:maxWidth=\"400dp\"\n+            app:layout_constraintStart_toStartOf=\"parent\"\n+            app:layout_constraintTop_toTopOf=\"parent\"\n+            app:layout_goneMarginEnd=\"0dp\"\n+            tools:src=\"@drawable/app_logo\" />\n+\n+        <TextView\n+            android:id=\"@+id/nextup\"\n+            style=\"@style/TextAppearance.Leanback.DetailsDescriptionTitle\"\n+            android:layout_width=\"0dp\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_marginStart=\"16dp\"\n+            android:text=\"@string/lbl_next_up\"\n+            app:layout_constraintEnd_toEndOf=\"parent\"\n+            app:layout_constraintStart_toEndOf=\"@id/image\"\n+            app:layout_constraintTop_toTopOf=\"parent\" />\n+\n+        <TextView\n+            android:id=\"@+id/title\"\n+            style=\"@style/TextAppearance.Leanback.DetailsDescriptionSubtitle\"\n+            android:layout_width=\"0dp\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_marginStart=\"16dp\"\n+            app:layout_constraintEnd_toEndOf=\"parent\"\n+            app:layout_constraintStart_toEndOf=\"@id/image\"\n+            app:layout_constraintTop_toBottomOf=\"@id/nextup\"\n+            tools:text=\"Episode title\" />\n+\n+        <TextView\n+            android:id=\"@+id/description\"\n+            style=\"@style/TextAppearance.Leanback.DetailsDescriptionBody\"\n+            android:layout_width=\"0dp\"\n+            android:layout_height=\"0dp\"\n+            android:layout_marginStart=\"16dp\"\n+            android:ellipsize=\"end\"\n+            android:maxLines=\"6\"", "originalCommit": "badbd2d532a182ee07ba90a1f403107572c63dba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkwMjMwNw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/265#discussion_r379902307", "bodyText": "app:layout_constraintBottom_toTopOf=\"@id/fragment_next_up_buttons\" to avoid underflowing the buttons with text", "author": "AndreasGB", "createdAt": "2020-02-16T13:11:52Z", "path": "app/src/main/res/layout/fragment_next_up.xml", "diffHunk": "@@ -0,0 +1,76 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    xmlns:tools=\"http://schemas.android.com/tools\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"match_parent\"\n+    tools:background=\"@drawable/moviebg\">\n+\n+    <!-- Overlay -->\n+    <androidx.constraintlayout.widget.ConstraintLayout\n+        android:id=\"@+id/content\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:background=\"@drawable/noise\"\n+        android:orientation=\"horizontal\"\n+        android:padding=\"16dp\"\n+        app:layout_constraintBottom_toBottomOf=\"parent\"\n+        app:layout_constraintEnd_toEndOf=\"parent\"\n+        app:layout_constraintStart_toStartOf=\"parent\">\n+\n+        <ImageView\n+            android:id=\"@+id/image\"\n+            style=\"@style/Widget.Leanback\"\n+            android:layout_width=\"wrap_content\"\n+            android:layout_height=\"175dp\"\n+            android:adjustViewBounds=\"true\"\n+            android:maxWidth=\"400dp\"\n+            app:layout_constraintStart_toStartOf=\"parent\"\n+            app:layout_constraintTop_toTopOf=\"parent\"\n+            app:layout_goneMarginEnd=\"0dp\"\n+            tools:src=\"@drawable/app_logo\" />\n+\n+        <TextView\n+            android:id=\"@+id/nextup\"\n+            style=\"@style/TextAppearance.Leanback.DetailsDescriptionTitle\"\n+            android:layout_width=\"0dp\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_marginStart=\"16dp\"\n+            android:text=\"@string/lbl_next_up\"\n+            app:layout_constraintEnd_toEndOf=\"parent\"\n+            app:layout_constraintStart_toEndOf=\"@id/image\"\n+            app:layout_constraintTop_toTopOf=\"parent\" />\n+\n+        <TextView\n+            android:id=\"@+id/title\"\n+            style=\"@style/TextAppearance.Leanback.DetailsDescriptionSubtitle\"\n+            android:layout_width=\"0dp\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_marginStart=\"16dp\"\n+            app:layout_constraintEnd_toEndOf=\"parent\"\n+            app:layout_constraintStart_toEndOf=\"@id/image\"\n+            app:layout_constraintTop_toBottomOf=\"@id/nextup\"\n+            tools:text=\"Episode title\" />\n+\n+        <TextView\n+            android:id=\"@+id/description\"\n+            style=\"@style/TextAppearance.Leanback.DetailsDescriptionBody\"\n+            android:layout_width=\"0dp\"\n+            android:layout_height=\"0dp\"\n+            android:layout_marginStart=\"16dp\"\n+            android:ellipsize=\"end\"\n+            android:maxLines=\"6\"\n+            app:layout_constraintBottom_toBottomOf=\"parent\"", "originalCommit": "badbd2d532a182ee07ba90a1f403107572c63dba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkwNjU2MA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/265#discussion_r379906560", "bodyText": "Because the buttons are not defined in the same constraintlayout it's not possible. With the max lines set to 4 it should be good now though.", "author": "nielsvanvelzen", "createdAt": "2020-02-16T14:17:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkwMjMwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkwMzU2OA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/265#discussion_r379903568", "bodyText": "Maybe log an error in the null case and finish()", "author": "AndreasGB", "createdAt": "2020-02-16T13:31:31Z", "path": "app/src/main/java/org/jellyfin/androidtv/playback/nextup/NextUpActivity.kt", "diffHunk": "@@ -0,0 +1,65 @@\n+package org.jellyfin.androidtv.playback.nextup\n+\n+import android.os.Bundle\n+import android.util.Log\n+import androidx.fragment.app.FragmentActivity\n+import androidx.leanback.app.BackgroundManager\n+import com.squareup.picasso.Picasso\n+import kotlinx.coroutines.Dispatchers\n+import kotlinx.coroutines.GlobalScope\n+import kotlinx.coroutines.launch\n+import kotlinx.coroutines.withContext\n+import org.acra.ACRA.LOG_TAG\n+import org.jellyfin.androidtv.TvApp\n+import org.jellyfin.androidtv.util.apiclient.getItem\n+import org.jellyfin.apiclient.model.dto.ImageOptions\n+\n+class NextUpActivity : FragmentActivity() {\n+\tprivate lateinit var fragment: NextUpFragment\n+\n+\toverride fun onCreate(savedInstanceState: Bundle?) {\n+\t\tsuper.onCreate(savedInstanceState)\n+\n+\t\tval id = intent.getStringExtra(\"id\")\n+\t\tif (id == null) {\n+\t\t\tLog.e(LOG_TAG, \"No id found in bundle for NextUpActivity.\")\n+\t\t\tfinish()\n+\t\t}\n+\n+\t\t// Add background manager\n+\t\tBackgroundManager.getInstance(this).attach(window)\n+\n+\t\t// Load item info\n+\t\tGlobalScope.launch(Dispatchers.Main) {\n+\t\t\tval data = loadItemData(id) ?: return@launch", "originalCommit": "badbd2d532a182ee07ba90a1f403107572c63dba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkwNDQ3Nw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/265#discussion_r379904477", "bodyText": "This is not present in the current version of the overlay, I think this file is broken. This ProgressBar was removed in ed01855#diff-92d250046e8bf52735338f876b5b0009", "author": "AndreasGB", "createdAt": "2020-02-16T13:45:36Z", "path": "app/src/main/res/layout/vlc_player_interface.xml", "diffHunk": "@@ -58,114 +58,170 @@\n \n     </FrameLayout>\n \n-    <include\n-        android:id=\"@+id/smNextUpPanel\"\n-        layout=\"@layout/small_upnext_panel\"\n-        android:layout_width=\"match_parent\"\n-        android:layout_height=\"75dp\"\n-        android:layout_gravity=\"bottom\" />\n+\n+    <ProgressBar", "originalCommit": "badbd2d532a182ee07ba90a1f403107572c63dba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkwNDg4Ng==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/265#discussion_r379904886", "bodyText": "This is probably a little bit nit-picky, but do we actually need to set max on every tick?", "author": "AndreasGB", "createdAt": "2020-02-16T13:51:05Z", "path": "app/src/main/java/org/jellyfin/androidtv/playback/nextup/NextUpButtons.kt", "diffHunk": "@@ -0,0 +1,66 @@\n+package org.jellyfin.androidtv.playback.nextup\n+\n+import android.content.Context\n+import android.os.CountDownTimer\n+import android.util.AttributeSet\n+import android.view.View\n+import android.widget.FrameLayout\n+import kotlinx.android.synthetic.main.fragment_next_up_buttons.view.*\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.TvApp\n+\n+class NextUpButtons(context: Context, attrs: AttributeSet? = null, defStyleAttr: Int = 0, defStyle: Int = 0) : FrameLayout(context, attrs, defStyleAttr, defStyle) {\n+\tconstructor(context: Context, attrs: AttributeSet) : this(context, attrs, 0, 0)\n+\n+\tprivate var countdownTimer: CountDownTimer? = null\n+\tprivate val view = View.inflate(context, R.layout.fragment_next_up_buttons, null)\n+\n+\tinit {\n+\t\taddView(view)\n+\t\tview.fragment_next_up_buttons_play_next.apply {\n+\t\t\t// Stop timer when unfocused\n+\t\t\tsetOnFocusChangeListener { _, focused -> if (!focused) stopTimer() }\n+\n+\t\t\t// Add initial focus\n+\t\t\trequestFocus()\n+\t\t}\n+\t}\n+\n+\tfun startTimer() {\n+\t\tval duration = TvApp.getApplication().userPreferences.nextUpTimeout.toLong()\n+\n+\t\t// Cancel current timer if one is already set\n+\t\tcountdownTimer?.cancel()\n+\n+\t\t// Create timer\n+\t\tcountdownTimer = object : CountDownTimer(duration, 1) {\n+\t\t\toverride fun onTick(millisUntilFinished: Long) {\n+\t\t\t\tfragment_next_up_buttons_play_next_progress.max = duration.toInt()", "originalCommit": "badbd2d532a182ee07ba90a1f403107572c63dba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkwNjQyMA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/265#discussion_r379906420", "bodyText": "So it says \"every tick\" but it won't actually call it every tick. It only calls the onTick function when it is able to. It's entirely based on the system performance.", "author": "nielsvanvelzen", "createdAt": "2020-02-16T14:15:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkwNDg4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkwNTM5MQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/265#discussion_r379905391", "bodyText": "We could also reset the progressbar here, looks a bit strange when it's hanging halfway there", "author": "AndreasGB", "createdAt": "2020-02-16T13:58:41Z", "path": "app/src/main/java/org/jellyfin/androidtv/playback/nextup/NextUpButtons.kt", "diffHunk": "@@ -0,0 +1,66 @@\n+package org.jellyfin.androidtv.playback.nextup\n+\n+import android.content.Context\n+import android.os.CountDownTimer\n+import android.util.AttributeSet\n+import android.view.View\n+import android.widget.FrameLayout\n+import kotlinx.android.synthetic.main.fragment_next_up_buttons.view.*\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.TvApp\n+\n+class NextUpButtons(context: Context, attrs: AttributeSet? = null, defStyleAttr: Int = 0, defStyle: Int = 0) : FrameLayout(context, attrs, defStyleAttr, defStyle) {\n+\tconstructor(context: Context, attrs: AttributeSet) : this(context, attrs, 0, 0)\n+\n+\tprivate var countdownTimer: CountDownTimer? = null\n+\tprivate val view = View.inflate(context, R.layout.fragment_next_up_buttons, null)\n+\n+\tinit {\n+\t\taddView(view)\n+\t\tview.fragment_next_up_buttons_play_next.apply {\n+\t\t\t// Stop timer when unfocused\n+\t\t\tsetOnFocusChangeListener { _, focused -> if (!focused) stopTimer() }\n+\n+\t\t\t// Add initial focus\n+\t\t\trequestFocus()\n+\t\t}\n+\t}\n+\n+\tfun startTimer() {\n+\t\tval duration = TvApp.getApplication().userPreferences.nextUpTimeout.toLong()\n+\n+\t\t// Cancel current timer if one is already set\n+\t\tcountdownTimer?.cancel()\n+\n+\t\t// Create timer\n+\t\tcountdownTimer = object : CountDownTimer(duration, 1) {\n+\t\t\toverride fun onTick(millisUntilFinished: Long) {\n+\t\t\t\tfragment_next_up_buttons_play_next_progress.max = duration.toInt()\n+\t\t\t\tfragment_next_up_buttons_play_next_progress.progress = (duration - millisUntilFinished).toInt()\n+\t\t\t}\n+\n+\t\t\toverride fun onFinish() {\n+\t\t\t\t// Perform a click so the event handler will activate\n+\t\t\t\tview.fragment_next_up_buttons_play_next.performClick()\n+\t\t\t}\n+\t\t}.start()\n+\t}\n+\n+\tfun stopTimer() {\n+\t\tcountdownTimer?.cancel()", "originalCommit": "badbd2d532a182ee07ba90a1f403107572c63dba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c7bb1a9aaaa975f565b966f4f44a482313da3669", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/c7bb1a9aaaa975f565b966f4f44a482313da3669", "message": "Review changes", "committedDate": "2020-02-16T14:33:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ3MzQ3NA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/265#discussion_r380473474", "bodyText": "Should we assign these color values to resources to allow for theming in the future?", "author": "thornbill", "createdAt": "2020-02-18T06:24:24Z", "path": "app/src/main/res/drawable/button_default_highlight.xml", "diffHunk": "@@ -0,0 +1,6 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<shape xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    android:shape=\"rectangle\">\n+    <corners android:radius=\"3dp\" />\n+    <solid android:color=\"#E6CCCCCC\" />", "originalCommit": "c7bb1a9aaaa975f565b966f4f44a482313da3669", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUxOTY4Mg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/265#discussion_r380519682", "bodyText": "Good idea, I will do that so we're 0.1% closer to a hotdog theme.", "author": "nielsvanvelzen", "createdAt": "2020-02-18T08:28:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ3MzQ3NA=="}], "type": "inlineReview"}, {"oid": "fb3d08baf03c31482b3b6cec5ece0299232ce1da", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/fb3d08baf03c31482b3b6cec5ece0299232ce1da", "message": "Move colors to colors.xml", "committedDate": "2020-02-18T08:43:23Z", "type": "commit"}, {"oid": "d412757272ad72ae4f0d727d97c6a5fdea3b4fd9", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/d412757272ad72ae4f0d727d97c6a5fdea3b4fd9", "message": "Increase padding to prevent overscan issues", "committedDate": "2020-02-18T21:08:04Z", "type": "commit"}]}