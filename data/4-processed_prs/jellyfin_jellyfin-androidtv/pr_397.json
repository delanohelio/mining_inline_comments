{"pr_number": 397, "pr_title": "External trailers \ud83c\udfac 2", "pr_createdAt": "2020-03-13T11:25:47Z", "pr_url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjIyMzU4OA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r392223588", "bodyText": "This name is looooong", "author": "nielsvanvelzen", "createdAt": "2020-03-13T13:22:50Z", "path": "app/src/main/java/org/jellyfin/androidtv/model/trailers/lifter/FirstMatchMultiExternalTrailerLifter.kt", "diffHunk": "@@ -0,0 +1,31 @@\n+package org.jellyfin.androidtv.model.trailers.lifter\n+\n+import org.jellyfin.androidtv.model.trailers.external.ExternalTrailer\n+import org.jellyfin.apiclient.model.entities.MediaUrl\n+import java.util.*\n+\n+class FirstMatchMultiExternalTrailerLifter : ExternalTrailerLifter() {", "originalCommit": "2553c16bd3a3b642278e1f0cbbf7d71174f70cc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE3ODgzOA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r401178838", "bodyText": "When a class (or function for that matter) gets multiple parameters the code might look a bit messy. A way to prevent this is by putting each parameter on it's own line:\nclass YouTubeTrailerPresenter(\n\tprivate val context: Context,\n\tprivate val imageHeight: Int,\n\tprivate val safeBrandingCompliance: Boolean\n) : Presenter(), IItemClickListener {", "author": "nielsvanvelzen", "createdAt": "2020-03-31T20:01:16Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/trailers/YouTubeTrailerPresenter.kt", "diffHunk": "@@ -0,0 +1,78 @@\n+package org.jellyfin.androidtv.details.trailers\n+\n+import android.content.Context\n+import android.content.Intent\n+import android.net.Uri\n+import android.util.Log\n+import android.view.ViewGroup\n+import android.widget.ImageView\n+import android.widget.Toast\n+import androidx.appcompat.view.ContextThemeWrapper\n+import androidx.leanback.widget.Presenter\n+import com.bumptech.glide.Glide\n+import com.bumptech.glide.load.resource.drawable.GlideDrawable\n+import com.bumptech.glide.request.RequestListener\n+import com.bumptech.glide.request.target.Target\n+import kotlinx.android.synthetic.main.multi_badge_image_card_view.view.*\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.base.IItemClickListener\n+import org.jellyfin.androidtv.model.trailers.external.YouTubeTrailer\n+import org.jellyfin.androidtv.ui.MultiBadgeImageCardView\n+import org.jellyfin.androidtv.util.ImageUtils\n+\n+class YouTubeTrailerPresenter(private val context: Context, private val imageHeight: Int, private val safeBrandingCompliance: Boolean) : Presenter(), IItemClickListener {", "originalCommit": "3e7e9a6a96fd2157f964fa9fe5f930ea7f3742e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE3OTkyMg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r401179922", "bodyText": "IIRC you can use .get() instead of the listener when using a coroutine (GlobalScope.launch thingy...) If you want to catch the errors just use try {} catch {}", "author": "nielsvanvelzen", "createdAt": "2020-03-31T20:03:15Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/trailers/YouTubeTrailerPresenter.kt", "diffHunk": "@@ -30,11 +39,29 @@ class YouTubeTrailerPresenter(private val context: Context, private val imageHei\n \t\t\tcontentText = context.getString(R.string.brand_youtube)\n \t\t}\n \n-\t\t// TODO: Kick off loading of thumbnail here\n-\t}\n+\t\tif (!safeBrandingCompliance) {\n+\t\t\tGlide.with(context).load(trailer.thumbnailURL).listener(object : RequestListener<String, GlideDrawable> {", "originalCommit": "3e7e9a6a96fd2157f964fa9fe5f930ea7f3742e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE4MjEzNw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r401182137", "bodyText": "Formatting looks weird for this whole statement", "author": "nielsvanvelzen", "createdAt": "2020-03-31T20:07:06Z", "path": "app/src/test/java/org/jellyfin/androidtv/model/trailers/lifter/YouTubeLifterUnsupportedURLsTest.kt", "diffHunk": "@@ -0,0 +1,38 @@\n+package org.jellyfin.androidtv.model.trailers.lifter\n+\n+import org.jellyfin.apiclient.model.entities.MediaUrl\n+import org.junit.Assert\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+import org.junit.runners.Parameterized\n+\n+\n+@RunWith(Parameterized::class)\n+class YouTubeLifterUnsupportedURLsTest(private val testURL: String) {\n+\tprivate val lifter = YouTubeExternalTrailerLifter()\n+\n+\t@Test\n+\tfun shouldIgnore() {\n+\t\tAssert.assertEquals(", "originalCommit": "3e7e9a6a96fd2157f964fa9fe5f930ea7f3742e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE4MjkyMQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r401182921", "bodyText": "I'm not really sure what this regex does, strip subdomains?", "author": "nielsvanvelzen", "createdAt": "2020-03-31T20:08:27Z", "path": "app/src/main/java/org/jellyfin/androidtv/model/trailers/lifter/ExternalTrailerLifter.kt", "diffHunk": "@@ -1,15 +1,28 @@\n package org.jellyfin.androidtv.model.trailers.lifter\n \n-import android.net.Uri\n import org.jellyfin.androidtv.model.trailers.external.ExternalTrailer\n import org.jellyfin.apiclient.model.entities.MediaUrl\n+import java.net.MalformedURLException\n+import java.net.URL\n \n abstract class ExternalTrailerLifter {\n \tprivate val domainRegex = Regex(\"\"\"^(.*\\.|)(.+\\...+)$\"\"\")", "originalCommit": "3e7e9a6a96fd2157f964fa9fe5f930ea7f3742e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI2NDU2OA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r401264568", "bodyText": "That was the idea. Should I write test cases for it as well?", "author": "AndreasGB", "createdAt": "2020-03-31T23:02:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE4MjkyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTQxNzY4Nw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r401417687", "bodyText": "You can probably do it without the regex", "author": "nielsvanvelzen", "createdAt": "2020-04-01T07:46:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE4MjkyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNTIwMw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r403405203", "bodyText": "Got rid of it", "author": "AndreasGB", "createdAt": "2020-04-04T01:29:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE4MjkyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE4MzIzMA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r401183230", "bodyText": "I've once read that the URI class is preferred above URL because URL will make DNS queries but I can't find a proper source for it right now.", "author": "nielsvanvelzen", "createdAt": "2020-03-31T20:09:02Z", "path": "app/src/main/java/org/jellyfin/androidtv/model/trailers/lifter/ExternalTrailerLifter.kt", "diffHunk": "@@ -1,15 +1,28 @@\n package org.jellyfin.androidtv.model.trailers.lifter\n \n-import android.net.Uri\n import org.jellyfin.androidtv.model.trailers.external.ExternalTrailer\n import org.jellyfin.apiclient.model.entities.MediaUrl\n+import java.net.MalformedURLException\n+import java.net.URL\n \n abstract class ExternalTrailerLifter {\n \tprivate val domainRegex = Regex(\"\"\"^(.*\\.|)(.+\\...+)$\"\"\")\n \n-\tprotected fun getDomain(uri: Uri): String? = uri.host?.let { host -> domainRegex.find(host)?.groups?.get(2)?.value }\n+\tprotected fun getDomain(url: URL): String? {\n+\t\treturn url.host?.let { host -> domainRegex.find(host)?.groups?.get(2)?.value }", "originalCommit": "3e7e9a6a96fd2157f964fa9fe5f930ea7f3742e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI1OTM2Mw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r401259363", "bodyText": "That would be really unexpected, but idk. Maybe I should try to wireshark the emulator.", "author": "AndreasGB", "createdAt": "2020-03-31T22:47:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE4MzIzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTQxODU4MQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r401418581", "bodyText": "Using the Android URI class will give you some additional methods like getting a query parameter too (to replace the v=xxx regex):\nhttps://developer.android.com/reference/android/net/Uri", "author": "nielsvanvelzen", "createdAt": "2020-04-01T07:48:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE4MzIzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE4NDY5Nw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r401184697", "bodyText": "An YouTube id is always 11 characters so you can make the regex more strict", "author": "nielsvanvelzen", "createdAt": "2020-03-31T20:11:39Z", "path": "app/src/main/java/org/jellyfin/androidtv/model/trailers/lifter/YouTubeExternalTrailerLifter.kt", "diffHunk": "@@ -1,21 +1,58 @@\n package org.jellyfin.androidtv.model.trailers.lifter\n \n-import android.net.Uri\n+import android.util.Log\n import org.jellyfin.androidtv.model.trailers.external.YouTubeTrailer\n import org.jellyfin.apiclient.model.entities.MediaUrl\n+import java.net.URL\n \n class YouTubeExternalTrailerLifter : ExternalTrailerLifter() {\n+\tprivate val LOG_TAG = \"YouTubeLifter\"\n+\n \tprivate val youtubeDomains = arrayListOf(\"youtube.com\", \"youtu.be\")\n \n-\tprivate fun isYoutubeUrl(uri: Uri) = youtubeDomains.contains(getDomain(uri))\n-\tprivate fun isYoutubeUrl(url: MediaUrl) = isYoutubeUrl(Uri.parse(url.url))\n+\tprivate fun isYoutubeUrl(url: URL) = youtubeDomains.contains(getDomain(url))\n+\n+\tprivate val videoParameterRegex = Regex(\"v=([a-zA-Z0-9]+)\")", "originalCommit": "3e7e9a6a96fd2157f964fa9fe5f930ea7f3742e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE4NTAyOA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r401185028", "bodyText": "I'd say use the last 11 characters from the path in the case a url looks like youtu.be/sample/[id]", "author": "nielsvanvelzen", "createdAt": "2020-03-31T20:12:15Z", "path": "app/src/main/java/org/jellyfin/androidtv/model/trailers/lifter/YouTubeExternalTrailerLifter.kt", "diffHunk": "@@ -1,21 +1,58 @@\n package org.jellyfin.androidtv.model.trailers.lifter\n \n-import android.net.Uri\n+import android.util.Log\n import org.jellyfin.androidtv.model.trailers.external.YouTubeTrailer\n import org.jellyfin.apiclient.model.entities.MediaUrl\n+import java.net.URL\n \n class YouTubeExternalTrailerLifter : ExternalTrailerLifter() {\n+\tprivate val LOG_TAG = \"YouTubeLifter\"\n+\n \tprivate val youtubeDomains = arrayListOf(\"youtube.com\", \"youtu.be\")\n \n-\tprivate fun isYoutubeUrl(uri: Uri) = youtubeDomains.contains(getDomain(uri))\n-\tprivate fun isYoutubeUrl(url: MediaUrl) = isYoutubeUrl(Uri.parse(url.url))\n+\tprivate fun isYoutubeUrl(url: URL) = youtubeDomains.contains(getDomain(url))\n+\n+\tprivate val videoParameterRegex = Regex(\"v=([a-zA-Z0-9]+)\")\n \n \toverride fun canLift(url: MediaUrl): Boolean {\n-\t\treturn isYoutubeUrl(url)\n+\t\tval converted = mediaUrlToUrl(url)\n+\t\treturn converted != null && isYoutubeUrl(converted)\n \t}\n \n-\toverride fun lift(url: MediaUrl): YouTubeTrailer {\n-\t\treturn YouTubeTrailer(url.name, url.url, \"\")\n+\toverride fun lift(url: MediaUrl): YouTubeTrailer? {\n+\t\tif (!canLift(url)) {\n+\t\t\t Log.e(LOG_TAG, \"URL ${url.url} is not supported\")\n+\t\t\treturn null\n+\t\t}\n+\n+\t\tval convertedURL = mediaUrlToUrl(url)!!\n+\n+\t\tval videoKey = when (getDomain(convertedURL)!!) {\n+\t\t\t\"youtube.com\" -> {\n+\t\t\t\tval matchGroups = videoParameterRegex.find(convertedURL.query)?.groups\n+\t\t\t\tif (matchGroups == null || matchGroups.size != 2) {\n+\t\t\t\t\tLog.e(LOG_TAG, \"URL $convertedURL is not supported\")\n+\t\t\t\t\treturn null\n+\t\t\t\t} else {\n+\t\t\t\t\tmatchGroups[1]!!.value\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t\t\"youtu.be\" -> {\n+\t\t\t\tconvertedURL.path.subSequence(1, convertedURL.path.length)", "originalCommit": "3e7e9a6a96fd2157f964fa9fe5f930ea7f3742e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9041c2117e990c1d2a609397588bb712b650700d", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/9041c2117e990c1d2a609397588bb712b650700d", "message": "Initial Structure of external trailer handling", "committedDate": "2020-04-05T15:36:40Z", "type": "commit"}, {"oid": "139dc711d11cf45d87845ba7a5b63a0e648c0b30", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/139dc711d11cf45d87845ba7a5b63a0e648c0b30", "message": "Initial Tests for YouTubeExternalTrailerLifter URL acceptance", "committedDate": "2020-04-05T15:36:40Z", "type": "commit"}, {"oid": "758f8a56e066136cac2dea940ff5943c89cacf9e", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/758f8a56e066136cac2dea940ff5943c89cacf9e", "message": "Implemented lifting of YouTube Trailers", "committedDate": "2020-04-05T15:36:40Z", "type": "commit"}, {"oid": "5ca1cc26403b78e1e12a7d8ddae00558655c3043", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/5ca1cc26403b78e1e12a7d8ddae00558655c3043", "message": "Finish presentation of YouTube Trailers", "committedDate": "2020-04-05T15:36:40Z", "type": "commit"}, {"oid": "b06ed534bdc18db413127e81bef2065814a40950", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/b06ed534bdc18db413127e81bef2065814a40950", "message": "Address feedback and refactor a bit", "committedDate": "2020-04-05T15:36:40Z", "type": "commit"}, {"oid": "4fd47b52862b1d25973eea8b54866320d2f68ae2", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/4fd47b52862b1d25973eea8b54866320d2f68ae2", "message": "Implement generic external trailer handling", "committedDate": "2020-04-05T15:36:41Z", "type": "commit"}, {"oid": "5681c9b56abb3d939d5b609fee3606c88d648838", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/5681c9b56abb3d939d5b609fee3606c88d648838", "message": "Branding compliance for external trailers", "committedDate": "2020-04-05T15:36:41Z", "type": "commit"}, {"oid": "b153f02239f74801aa23c3e1d415b7389d0b9533", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/b153f02239f74801aa23c3e1d415b7389d0b9533", "message": "Refactor external trailer handling", "committedDate": "2020-04-05T15:36:41Z", "type": "commit"}, {"oid": "b153f02239f74801aa23c3e1d415b7389d0b9533", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/b153f02239f74801aa23c3e1d415b7389d0b9533", "message": "Refactor external trailer handling", "committedDate": "2020-04-05T15:36:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYwMjEyMg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r404602122", "bodyText": "This catch statement should probably only catch MalformedURLException. Additional logging here might be nice to have.", "author": "nielsvanvelzen", "createdAt": "2020-04-07T07:42:55Z", "path": "app/src/main/java/org/jellyfin/androidtv/model/trailers/lifter/BaseTrailerLifter.kt", "diffHunk": "@@ -0,0 +1,21 @@\n+package org.jellyfin.androidtv.model.trailers.lifter\n+\n+import org.jellyfin.androidtv.model.trailers.external.ExternalTrailer\n+import org.jellyfin.apiclient.model.entities.MediaUrl\n+import java.net.MalformedURLException\n+import java.net.URL\n+\n+abstract class BaseTrailerLifter {\n+\tprotected fun mediaUrlToUrl(mediaUrl: MediaUrl) = try {\n+\t\tURL(mediaUrl.url)\n+\t} catch (ex: MalformedURLException) {\n+\t\ttry {\n+\t\t\tURL(\"https://\" + mediaUrl.url)\n+\t\t} catch (ex: Exception) {", "originalCommit": "b153f02239f74801aa23c3e1d415b7389d0b9533", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYwMzE2Mg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r404603162", "bodyText": "Alignment of these parameters looks off, probably because context is not on it's own line.", "author": "nielsvanvelzen", "createdAt": "2020-04-07T07:44:42Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/trailers/YouTubeTrailerPresenter.kt", "diffHunk": "@@ -0,0 +1,31 @@\n+package org.jellyfin.androidtv.details.trailers\n+\n+import android.content.Context\n+import android.view.ViewGroup\n+import androidx.appcompat.view.ContextThemeWrapper\n+import com.bumptech.glide.Glide\n+import kotlinx.android.synthetic.main.multi_badge_image_card_view.view.*\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.model.trailers.external.YouTubeTrailer\n+import org.jellyfin.androidtv.ui.MultiBadgeImageCardView\n+\n+class YouTubeTrailerPresenter(private val context: Context,", "originalCommit": "b153f02239f74801aa23c3e1d415b7389d0b9533", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYwMzc3Nw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r404603777", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \toverride val description\n          \n          \n            \n            \t\tget() = context.getString(R.string.domain_youtube)\n          \n          \n            \n            \toverride val description = context.getString(R.string.domain_youtube)", "author": "nielsvanvelzen", "createdAt": "2020-04-07T07:45:48Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/trailers/YouTubeTrailerPresenter.kt", "diffHunk": "@@ -0,0 +1,31 @@\n+package org.jellyfin.androidtv.details.trailers\n+\n+import android.content.Context\n+import android.view.ViewGroup\n+import androidx.appcompat.view.ContextThemeWrapper\n+import com.bumptech.glide.Glide\n+import kotlinx.android.synthetic.main.multi_badge_image_card_view.view.*\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.model.trailers.external.YouTubeTrailer\n+import org.jellyfin.androidtv.ui.MultiBadgeImageCardView\n+\n+class YouTubeTrailerPresenter(private val context: Context,\n+\t\t\t\t\t\t\t  imageHeight: Int\n+) : ExternalTrailerPresenter(context, imageHeight) {\n+\n+\toverride val description\n+\t\tget() = context.getString(R.string.domain_youtube)", "originalCommit": "b153f02239f74801aa23c3e1d415b7389d0b9533", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYwOTk3MA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r404609970", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tprotected open val thumbnail\n          \n          \n            \n            \t\tget() = context.getDrawable(R.drawable.tile_chapter)\n          \n          \n            \n            \tprotected open val thumbnail = context.getDrawable(R.drawable.tile_chapter)", "author": "nielsvanvelzen", "createdAt": "2020-04-07T07:56:24Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/trailers/ExternalTrailerPresenter.kt", "diffHunk": "@@ -0,0 +1,55 @@\n+package org.jellyfin.androidtv.details.trailers\n+\n+import android.content.Context\n+import android.content.Intent\n+import android.net.Uri\n+import android.view.ViewGroup\n+import android.widget.Toast\n+import androidx.appcompat.view.ContextThemeWrapper\n+import androidx.leanback.widget.Presenter\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.base.IItemClickListener\n+import org.jellyfin.androidtv.model.trailers.external.ExternalTrailer\n+import org.jellyfin.androidtv.ui.MultiBadgeImageCardView\n+import org.jellyfin.androidtv.util.ImageUtils\n+\n+open class ExternalTrailerPresenter(private val context: Context, private val imageHeight: Int) : Presenter(), IItemClickListener {\n+\tprotected open val thumbnail\n+\t\tget() = context.getDrawable(R.drawable.tile_chapter)", "originalCommit": "b153f02239f74801aa23c3e1d415b7389d0b9533", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYxMDIwMA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r404610200", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tprotected open val description: String?\n          \n          \n            \n            \t\tget() = null\n          \n          \n            \n            \tprotected open val description: String? = null", "author": "nielsvanvelzen", "createdAt": "2020-04-07T07:56:47Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/trailers/ExternalTrailerPresenter.kt", "diffHunk": "@@ -0,0 +1,55 @@\n+package org.jellyfin.androidtv.details.trailers\n+\n+import android.content.Context\n+import android.content.Intent\n+import android.net.Uri\n+import android.view.ViewGroup\n+import android.widget.Toast\n+import androidx.appcompat.view.ContextThemeWrapper\n+import androidx.leanback.widget.Presenter\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.base.IItemClickListener\n+import org.jellyfin.androidtv.model.trailers.external.ExternalTrailer\n+import org.jellyfin.androidtv.ui.MultiBadgeImageCardView\n+import org.jellyfin.androidtv.util.ImageUtils\n+\n+open class ExternalTrailerPresenter(private val context: Context, private val imageHeight: Int) : Presenter(), IItemClickListener {\n+\tprotected open val thumbnail\n+\t\tget() = context.getDrawable(R.drawable.tile_chapter)\n+\n+\tprotected open val description: String?\n+\t\tget() = null", "originalCommit": "b153f02239f74801aa23c3e1d415b7389d0b9533", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYxMTI1Mg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r404611252", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \toverride fun onUnbindViewHolder(viewHolder: ViewHolder) {\n          \n          \n            \n            \t\t// do nothing\n          \n          \n            \n            \t}", "author": "nielsvanvelzen", "createdAt": "2020-04-07T07:58:29Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/trailers/ExternalTrailerPresenter.kt", "diffHunk": "@@ -0,0 +1,55 @@\n+package org.jellyfin.androidtv.details.trailers\n+\n+import android.content.Context\n+import android.content.Intent\n+import android.net.Uri\n+import android.view.ViewGroup\n+import android.widget.Toast\n+import androidx.appcompat.view.ContextThemeWrapper\n+import androidx.leanback.widget.Presenter\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.base.IItemClickListener\n+import org.jellyfin.androidtv.model.trailers.external.ExternalTrailer\n+import org.jellyfin.androidtv.ui.MultiBadgeImageCardView\n+import org.jellyfin.androidtv.util.ImageUtils\n+\n+open class ExternalTrailerPresenter(private val context: Context, private val imageHeight: Int) : Presenter(), IItemClickListener {\n+\tprotected open val thumbnail\n+\t\tget() = context.getDrawable(R.drawable.tile_chapter)\n+\n+\tprotected open val description: String?\n+\t\tget() = null\n+\n+\toverride fun onCreateViewHolder(parent: ViewGroup?): ViewHolder {\n+\t\treturn ViewHolder(MultiBadgeImageCardView(ContextThemeWrapper(parent!!.context, R.style.MarqueeImageCardViewTheme)))\n+\t}\n+\n+\toverride fun onBindViewHolder(viewHolder: ViewHolder, item: Any) {\n+\t\tval trailer = item as ExternalTrailer\n+\n+\t\t(viewHolder.view as MultiBadgeImageCardView).apply {\n+\t\t\tisFocusable = true\n+\t\t\tisFocusableInTouchMode = true\n+\t\t\tsetMainImageDimensions((ImageUtils.ASPECT_RATIO_16_9 * imageHeight).toInt(), imageHeight)\n+\t\t\tmainImageDrawable = thumbnail\n+\t\t\ttitleText = trailer.name\n+\t\t\tcontentText = description\n+\t\t}\n+\t}\n+\n+\toverride fun onUnbindViewHolder(viewHolder: ViewHolder) {\n+\t\t// do nothing\n+\t}", "originalCommit": "b153f02239f74801aa23c3e1d415b7389d0b9533", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY4OTA1OA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r404689058", "bodyText": "This has to be implemented as it is an abstract function", "author": "AndreasGB", "createdAt": "2020-04-07T10:02:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYxMTI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY5ODA3Mg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/397#discussion_r404698072", "bodyText": "Right, I wasn't 100% sure about it", "author": "nielsvanvelzen", "createdAt": "2020-04-07T10:18:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYxMTI1Mg=="}], "type": "inlineReview"}, {"oid": "def07859f523f7279066741a850af319ceb3b6d7", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/def07859f523f7279066741a850af319ceb3b6d7", "message": "Address code review", "committedDate": "2020-04-07T10:32:35Z", "type": "commit"}, {"oid": "def07859f523f7279066741a850af319ceb3b6d7", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/def07859f523f7279066741a850af319ceb3b6d7", "message": "Address code review", "committedDate": "2020-04-07T10:32:35Z", "type": "forcePushed"}]}