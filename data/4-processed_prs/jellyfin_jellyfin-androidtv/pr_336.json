{"pr_number": 336, "pr_title": "Implement basic badges", "pr_createdAt": "2020-02-13T14:49:40Z", "pr_url": "https://github.com/jellyfin/jellyfin-androidtv/pull/336", "timeline": [{"oid": "37bf364da8a1600562d8ebf6ead8fd72f0a6e063", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/37bf364da8a1600562d8ebf6ead8fd72f0a6e063", "message": "Implement basic watched badge", "committedDate": "2020-02-13T14:45:12Z", "type": "commit"}, {"oid": "5b66041fb29119356b093e304e4ee174e66810dc", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/5b66041fb29119356b093e304e4ee174e66810dc", "message": "Don't include font-padding on badge counter", "committedDate": "2020-02-13T16:07:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODk2NDMxMg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/336#discussion_r378964312", "bodyText": "The text alignment doesn't do anything because the view is as wide as the text", "author": "nielsvanvelzen", "createdAt": "2020-02-13T16:15:43Z", "path": "app/src/main/res/layout/badge_watched.xml", "diffHunk": "@@ -0,0 +1,52 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    xmlns:tools=\"http://schemas.android.com/tools\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"match_parent\"\n+    android:orientation=\"vertical\"\n+    android:textAlignment=\"center\"\n+    tools:layout_height=\"32dp\"\n+    tools:layout_width=\"32dp\">\n+\n+    <ImageView\n+        android:id=\"@+id/badge_background\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"match_parent\"\n+        android:src=\"@drawable/circle_accent\"\n+        android:visibility=\"gone\"\n+        app:layout_constraintBottom_toBottomOf=\"parent\"\n+        app:layout_constraintLeft_toLeftOf=\"parent\"\n+        app:layout_constraintRight_toRightOf=\"parent\"\n+        app:layout_constraintTop_toTopOf=\"parent\"\n+        tools:visibility=\"visible\"/>\n+\n+    <TextView\n+        android:id=\"@+id/badge_counter\"\n+        android:layout_width=\"wrap_content\"\n+        android:layout_height=\"wrap_content\"\n+        android:foregroundGravity=\"center\"\n+        android:gravity=\"center\"\n+        android:textAlignment=\"center\"", "originalCommit": "5b66041fb29119356b093e304e4ee174e66810dc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODk2NDQ3Nw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/336#discussion_r378964477", "bodyText": "Doesn't do much", "author": "nielsvanvelzen", "createdAt": "2020-02-13T16:15:57Z", "path": "app/src/main/res/layout/badge_watched.xml", "diffHunk": "@@ -0,0 +1,52 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    xmlns:tools=\"http://schemas.android.com/tools\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"match_parent\"\n+    android:orientation=\"vertical\"\n+    android:textAlignment=\"center\"\n+    tools:layout_height=\"32dp\"\n+    tools:layout_width=\"32dp\">\n+\n+    <ImageView\n+        android:id=\"@+id/badge_background\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"match_parent\"\n+        android:src=\"@drawable/circle_accent\"\n+        android:visibility=\"gone\"\n+        app:layout_constraintBottom_toBottomOf=\"parent\"\n+        app:layout_constraintLeft_toLeftOf=\"parent\"\n+        app:layout_constraintRight_toRightOf=\"parent\"\n+        app:layout_constraintTop_toTopOf=\"parent\"\n+        tools:visibility=\"visible\"/>\n+\n+    <TextView\n+        android:id=\"@+id/badge_counter\"\n+        android:layout_width=\"wrap_content\"\n+        android:layout_height=\"wrap_content\"\n+        android:foregroundGravity=\"center\"", "originalCommit": "5b66041fb29119356b093e304e4ee174e66810dc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODk2NTAyMA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/336#discussion_r378965020", "bodyText": "Because everything is literally stacked on top of each other it might be better to use a FrameLayout. Makes rendering a bit faster too.", "author": "nielsvanvelzen", "createdAt": "2020-02-13T16:16:52Z", "path": "app/src/main/res/layout/badge_watched.xml", "diffHunk": "@@ -0,0 +1,52 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"", "originalCommit": "5b66041fb29119356b093e304e4ee174e66810dc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODk2NTgyMQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/336#discussion_r378965821", "bodyText": "This function accepts a nullable but when called always supplies a non-null item.", "author": "nielsvanvelzen", "createdAt": "2020-02-13T16:18:07Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/WatchedBadge.kt", "diffHunk": "@@ -0,0 +1,62 @@\n+package org.jellyfin.androidtv.ui\n+\n+import android.content.Context\n+import android.view.LayoutInflater\n+import android.view.View\n+import androidx.constraintlayout.widget.ConstraintLayout\n+import kotlinx.android.synthetic.main.badge_watched.view.*\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.model.itemtypes.PlayableItem\n+\n+class WatchedBadge(context: Context) : ConstraintLayout(context) {\n+\tprivate var item: PlayableItem? = null\n+\n+\tprivate val changeListener: () -> Unit = {\n+\t\tsetItemData(item)\n+\t}\n+\n+\tinit {\n+\t\tval inflater = LayoutInflater.from(context)\n+\t\tinflater.inflate(R.layout.badge_watched, this)\n+\t}\n+\n+\tconstructor(context: Context, item: PlayableItem) : this(context) {\n+\t\tthis.item = item\n+\t\tsetItemData(item)\n+\t}\n+\n+\tfun setWatched() {\n+\t\tbadge_background.visibility = View.VISIBLE\n+\t\tbadge_watched_tick.visibility = View.VISIBLE\n+\t\tbadge_counter.visibility = View.GONE\n+\t}\n+\n+\tfun setRemainingCount(count: Int) {\n+\t\tbadge_background.visibility = View.VISIBLE\n+\t\tbadge_watched_tick.visibility = View.GONE\n+\t\tbadge_counter.visibility = View.VISIBLE\n+\t\tbadge_counter.text = count.toString()\n+\t}\n+\n+\tfun clear() {\n+\t\tbadge_background.visibility = View.GONE\n+\t\tbadge_watched_tick.visibility = View.GONE\n+\t\tbadge_counter.visibility = View.GONE\n+\t}\n+\n+\tprivate fun setItemData(item: PlayableItem?) {", "originalCommit": "5b66041fb29119356b093e304e4ee174e66810dc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODk2Njg0MQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/336#discussion_r378966841", "bodyText": "Might be a bit late but i'd swap the parameter so you specify the location first and the content second", "author": "nielsvanvelzen", "createdAt": "2020-02-13T16:19:49Z", "path": "app/src/main/java/org/jellyfin/androidtv/details/ItemPosterPresenter.kt", "diffHunk": "@@ -42,6 +44,9 @@ class ItemPosterPresenter(private val context: Context) : Presenter(), IItemClic\n \t\t\tisFocusableInTouchMode = true\n \t\t\tsetMainImageDimensions(100.dp, 150.dp)\n \t\t\tmainImageDrawable = TvApp.getApplication().getDrawableCompat(R.drawable.tile_port_video)\n+\n+\t\t\tif (baseItem is PlayableItem)\n+\t\t\t\tsetBadge(WatchedBadge(context, baseItem), MultiBadgeImageCardView.BadgeLocation.TOP_RIGHT)", "originalCommit": "5b66041fb29119356b093e304e4ee174e66810dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODk3MzU3Ng==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/336#discussion_r378973576", "bodyText": "I think the current order is more \"readable\", like set badge watched badge to the top right, but that isn't a strong preference.", "author": "AndreasGB", "createdAt": "2020-02-13T16:30:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODk2Njg0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTAxOTI3MA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/336#discussion_r379019270", "bodyText": "It's funny because I think it's more readable if you say \"At the top right, I want to show the watched badge\". It's not a big issue so you can leave it.", "author": "nielsvanvelzen", "createdAt": "2020-02-13T17:47:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODk2Njg0MQ=="}], "type": "inlineReview"}, {"oid": "f552ecb412adef166bbbaa20a46da52c95a76a04", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/f552ecb412adef166bbbaa20a46da52c95a76a04", "message": "Refactoring WatchedBadge and associated layout", "committedDate": "2020-02-13T16:35:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTAyMTM2Mg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/336#discussion_r379021362", "bodyText": "If you specify the primary constructor as (context: Context, private var item: PlayableItem? = null) it will be a class property with a value of null by default.", "author": "nielsvanvelzen", "createdAt": "2020-02-13T17:51:36Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/WatchedBadge.kt", "diffHunk": "@@ -0,0 +1,62 @@\n+package org.jellyfin.androidtv.ui\n+\n+import android.content.Context\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.widget.FrameLayout\n+import kotlinx.android.synthetic.main.badge_watched.view.*\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.model.itemtypes.PlayableItem\n+\n+class WatchedBadge(context: Context) : FrameLayout(context) {", "originalCommit": "f552ecb412adef166bbbaa20a46da52c95a76a04", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTAyMTUxNg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/336#discussion_r379021516", "bodyText": "item?.let(::setItemData)", "author": "nielsvanvelzen", "createdAt": "2020-02-13T17:51:51Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/WatchedBadge.kt", "diffHunk": "@@ -0,0 +1,62 @@\n+package org.jellyfin.androidtv.ui\n+\n+import android.content.Context\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.widget.FrameLayout\n+import kotlinx.android.synthetic.main.badge_watched.view.*\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.model.itemtypes.PlayableItem\n+\n+class WatchedBadge(context: Context) : FrameLayout(context) {\n+\tprivate var item: PlayableItem? = null\n+\n+\tprivate val changeListener: () -> Unit = {\n+\t\tif (item != null) {", "originalCommit": "f552ecb412adef166bbbaa20a46da52c95a76a04", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTAyMjEwMw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/336#discussion_r379022103", "bodyText": "You can add a line here like item?.let(::setItemData) to update if you go for the primary constructor change. Could remove the secondary constructor entirely in that case.", "author": "nielsvanvelzen", "createdAt": "2020-02-13T17:52:59Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/WatchedBadge.kt", "diffHunk": "@@ -0,0 +1,62 @@\n+package org.jellyfin.androidtv.ui\n+\n+import android.content.Context\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.widget.FrameLayout\n+import kotlinx.android.synthetic.main.badge_watched.view.*\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.model.itemtypes.PlayableItem\n+\n+class WatchedBadge(context: Context) : FrameLayout(context) {\n+\tprivate var item: PlayableItem? = null\n+\n+\tprivate val changeListener: () -> Unit = {\n+\t\tif (item != null) {\n+\t\t\tsetItemData(item!!)\n+\t\t}\n+\t}\n+\n+\tinit {\n+\t\tval inflater = LayoutInflater.from(context)\n+\t\tinflater.inflate(R.layout.badge_watched, this)", "originalCommit": "f552ecb412adef166bbbaa20a46da52c95a76a04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA0MDYzNw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/336#discussion_r379040637", "bodyText": "We still need one which takes only context as tools allegedly require them, but flipping them is a good idea.", "author": "AndreasGB", "createdAt": "2020-02-13T18:28:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTAyMjEwMw=="}], "type": "inlineReview"}, {"oid": "8e9b85a734b53a2a590b13c1e1a5b398eb3160e2", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/8e9b85a734b53a2a590b13c1e1a5b398eb3160e2", "message": "Flip parameter order of MultiBadgeImageCardView.setBadge(...)", "committedDate": "2020-02-13T18:20:17Z", "type": "commit"}, {"oid": "8abd6e886afb7b200a1377f5d342950be55c4692", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/8abd6e886afb7b200a1377f5d342950be55c4692", "message": "Refactor WatchedBadge", "committedDate": "2020-02-13T18:29:21Z", "type": "commit"}, {"oid": "6372394e6ac80f347f3b78421a452370e01c0eca", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/6372394e6ac80f347f3b78421a452370e01c0eca", "message": "Implement Favorite Badge", "committedDate": "2020-02-13T19:23:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA3MTE3NA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/336#discussion_r379071174", "bodyText": "This constructor shouldn't be necessary because  the item parameter has a default value", "author": "nielsvanvelzen", "createdAt": "2020-02-13T19:27:12Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/FavoriteBadge.kt", "diffHunk": "@@ -0,0 +1,34 @@\n+package org.jellyfin.androidtv.ui\n+\n+import android.content.Context\n+import android.view.View\n+import android.widget.ImageView\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.model.itemtypes.BaseItem\n+\n+class FavoriteBadge(context: Context, val item: BaseItem? = null) : ImageView(context) {\n+\tprivate val changeListener: () -> Unit = {\n+\t\titem?.let(::setItemData)\n+\t}\n+\n+\tinit {\n+\t\tsetImageDrawable(context.getDrawable(R.drawable.ic_heart_red))\n+\t\titem?.let(::setItemData)\n+\t}\n+\n+\tconstructor(context: Context) : this(context, null)", "originalCommit": "6372394e6ac80f347f3b78421a452370e01c0eca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA3MTM4NA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/336#discussion_r379071384", "bodyText": "This constructor shouldn't be necessary because the item parameter has a default value", "author": "nielsvanvelzen", "createdAt": "2020-02-13T19:27:37Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/WatchedBadge.kt", "diffHunk": "@@ -0,0 +1,57 @@\n+package org.jellyfin.androidtv.ui\n+\n+import android.content.Context\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.widget.FrameLayout\n+import kotlinx.android.synthetic.main.badge_watched.view.*\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.model.itemtypes.PlayableItem\n+\n+\n+class WatchedBadge(context: Context, val item: PlayableItem? = null) : FrameLayout(context) {\n+\tprivate val changeListener: () -> Unit = {\n+\t\titem?.let(::setItemData)\n+\t}\n+\n+\tinit {\n+\t\tval inflater = LayoutInflater.from(context)\n+\t\tinflater.inflate(R.layout.badge_watched, this)\n+\t\titem?.let(::setItemData)\n+\t}\n+\n+\tconstructor(context: Context) : this(context, null)", "originalCommit": "6372394e6ac80f347f3b78421a452370e01c0eca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA3MTkzOQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/336#discussion_r379071939", "bodyText": "I don't think this would happen fast but if the count is higher than 99 we should probably display 99+ so the text won't overflow.", "author": "nielsvanvelzen", "createdAt": "2020-02-13T19:28:33Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/WatchedBadge.kt", "diffHunk": "@@ -0,0 +1,57 @@\n+package org.jellyfin.androidtv.ui\n+\n+import android.content.Context\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.widget.FrameLayout\n+import kotlinx.android.synthetic.main.badge_watched.view.*\n+import org.jellyfin.androidtv.R\n+import org.jellyfin.androidtv.model.itemtypes.PlayableItem\n+\n+\n+class WatchedBadge(context: Context, val item: PlayableItem? = null) : FrameLayout(context) {\n+\tprivate val changeListener: () -> Unit = {\n+\t\titem?.let(::setItemData)\n+\t}\n+\n+\tinit {\n+\t\tval inflater = LayoutInflater.from(context)\n+\t\tinflater.inflate(R.layout.badge_watched, this)\n+\t\titem?.let(::setItemData)\n+\t}\n+\n+\tconstructor(context: Context) : this(context, null)\n+\n+\tfun setWatched() {\n+\t\tbadge_background.visibility = View.VISIBLE\n+\t\tbadge_watched_tick.visibility = View.VISIBLE\n+\t\tbadge_counter.visibility = View.GONE\n+\t}\n+\n+\tfun setRemainingCount(count: Int) {", "originalCommit": "6372394e6ac80f347f3b78421a452370e01c0eca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2f5d96909b150a789c021089b7622114ac8dae44", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/2f5d96909b150a789c021089b7622114ac8dae44", "message": "Watched badge now shows 99+ if it is given a count over 99", "committedDate": "2020-02-13T19:36:27Z", "type": "commit"}, {"oid": "a90702f739379bacc2ed7046a0a7b95f3cddcab2", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/a90702f739379bacc2ed7046a0a7b95f3cddcab2", "message": "FavoriteBadge now subclasses AppCompatImageView instead of ImageView", "committedDate": "2020-02-13T19:40:40Z", "type": "commit"}]}