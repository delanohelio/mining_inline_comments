{"pr_number": 267, "pr_title": "Search enhancements", "pr_createdAt": "2020-01-19T18:20:38Z", "pr_url": "https://github.com/jellyfin/jellyfin-androidtv/pull/267", "timeline": [{"oid": "2588e7f1f8afecdaaa0b3fad5eae1d989ae75905", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/2588e7f1f8afecdaaa0b3fad5eae1d989ae75905", "message": "make categories in search always show in the same order and split Series + Episodes", "committedDate": "2020-01-19T18:17:59Z", "type": "commit"}, {"oid": "65708a5fc5ec3471f079cfe71b1f1aed41ab2ae1", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/65708a5fc5ec3471f079cfe71b1f1aed41ab2ae1", "message": "cleanup", "committedDate": "2020-01-19T18:19:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODY0NzAwOA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/267#discussion_r368647008", "bodyText": "Java uses lowerCamelCase so this method should be named addToParentIfResultsReceived.", "author": "nielsvanvelzen", "createdAt": "2020-01-20T16:52:41Z", "path": "app/src/main/java/org/jellyfin/androidtv/itemhandling/ItemRowAdapter.java", "diffHunk": "@@ -861,24 +861,29 @@ public void onResponse(SearchHintResult response) {\n                     }\n                     totalItems = response.getTotalRecordCount();\n                     setItemsLoaded(itemsLoaded + i);\n-                    if (itemsLoaded > 0 && mParent != null) {\n-                        mParent.add(mRow);\n-                    }\n                 }\n \n                 currentlyRetrieving = false;\n+                notifyRetrieveFinished();\n             }\n \n             @Override\n             public void onError(Exception exception) {\n                 TvApp.getApplication().getLogger().ErrorException(\"Error retrieving search results\", exception);\n                 Utils.showToast(TvApp.getApplication(), exception.getLocalizedMessage());\n                 currentlyRetrieving = false;\n+                notifyRetrieveFinished();\n             }\n         });\n \n     }\n \n+    public void AddToParentIfResultsReceived() {", "originalCommit": "65708a5fc5ec3471f079cfe71b1f1aed41ab2ae1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODY4NjMyNg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/267#discussion_r368686326", "bodyText": "ah yes, makes sense. As a C# guy I didn't even notice ;)", "author": "Froghut", "createdAt": "2020-01-20T18:47:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODY0NzAwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODY0NzU1NA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/267#discussion_r368647554", "bodyText": "Should be retrieveSearchResult", "author": "nielsvanvelzen", "createdAt": "2020-01-20T16:53:53Z", "path": "app/src/main/java/org/jellyfin/androidtv/search/SearchRunnable.java", "diffHunk": "@@ -28,69 +33,94 @@ public SearchRunnable(Context context, ArrayObjectAdapter adapter, boolean music\n         this.context = context;\n         this.mRowsAdapter = adapter;\n         this.musicOnly = musicOnly;\n+        this.searchItemRows = new ArrayList<>();\n     }\n \n     @Override\n     public void run() {\n         mRowsAdapter.clear();\n+        searchItemRows.clear();\n+        searchesReceived = 0;\n \n         if (!musicOnly) {\n             //Get search results by type\n-            SearchQuery people = getSearchQuery(new String[] {\"Person\",\"People\"});\n-            ItemRowAdapter peopleAdapter = new ItemRowAdapter(people, new CardPresenter(), mRowsAdapter);\n-            ListRow peopleRow = new ListRow(new HeaderItem(context.getString(R.string.lbl_people)), peopleAdapter);\n-            peopleAdapter.setRow(peopleRow);\n-            peopleAdapter.Retrieve();\n-\n             SearchQuery movies = getSearchQuery(new String[] {\"Movie\", \"BoxSet\"});\n             ItemRowAdapter movieAdapter = new ItemRowAdapter(movies, new CardPresenter(), mRowsAdapter);\n             ListRow movieRow = new ListRow(new HeaderItem(context.getString(R.string.lbl_movies)), movieAdapter);\n             movieAdapter.setRow(movieRow);\n-            movieAdapter.Retrieve();\n+            RetrieveSearchResult(movieAdapter);\n+\n+            SearchQuery tvSeries = getSearchQuery(new String[] {\"Series\"});\n+            ItemRowAdapter tvSeriesAdapter = new ItemRowAdapter(tvSeries, new CardPresenter(), mRowsAdapter);\n+            ListRow tvSeriesRow = new ListRow(new HeaderItem(context.getString(R.string.lbl_series)), tvSeriesAdapter);\n+            tvSeriesAdapter.setRow(tvSeriesRow);\n+            RetrieveSearchResult(tvSeriesAdapter);\n \n-            SearchQuery tv = getSearchQuery(new String[] {\"Series\",\"Episode\"});\n+            SearchQuery tv = getSearchQuery(new String[] {\"Episode\"});\n             ItemRowAdapter tvAdapter = new ItemRowAdapter(tv, new CardPresenter(), mRowsAdapter);\n-            ListRow tvRow = new ListRow(new HeaderItem(context.getString(R.string.lbl_tv)), tvAdapter);\n+            ListRow tvRow = new ListRow(new HeaderItem(context.getString(R.string.lbl_episodes)), tvAdapter);\n             tvAdapter.setRow(tvRow);\n-            tvAdapter.Retrieve();\n+            RetrieveSearchResult(tvAdapter);\n+\n+            SearchQuery people = getSearchQuery(new String[] {\"Person\",\"People\"});\n+            ItemRowAdapter peopleAdapter = new ItemRowAdapter(people, new CardPresenter(), mRowsAdapter);\n+            ListRow peopleRow = new ListRow(new HeaderItem(context.getString(R.string.lbl_people)), peopleAdapter);\n+            peopleAdapter.setRow(peopleRow);\n+            RetrieveSearchResult(peopleAdapter);\n \n             SearchQuery videos = getSearchQuery(new String[] {\"Video\"});\n             ItemRowAdapter videoAdapter = new ItemRowAdapter(videos, new CardPresenter(), mRowsAdapter);\n             ListRow videoRow = new ListRow(new HeaderItem(context.getString(R.string.lbl_videos)), videoAdapter);\n             videoAdapter.setRow(videoRow);\n-            videoAdapter.Retrieve();\n+            RetrieveSearchResult(videoAdapter);\n \n             SearchQuery recordings = getSearchQuery(new String[] {\"Recording\"});\n             ItemRowAdapter recordingAdapter = new ItemRowAdapter(recordings, new CardPresenter(), mRowsAdapter);\n             ListRow recordingRow = new ListRow(new HeaderItem(context.getString(R.string.lbl_recordings)), recordingAdapter);\n             recordingAdapter.setRow(recordingRow);\n-            recordingAdapter.Retrieve();\n+            RetrieveSearchResult(recordingAdapter);\n \n             SearchQuery programs = getSearchQuery(new String[] {\"Program\"});\n             ItemRowAdapter programAdapter = new ItemRowAdapter(programs, new CardPresenter(), mRowsAdapter);\n             ListRow programRow = new ListRow(new HeaderItem(context.getString(R.string.lbl_programs)), programAdapter);\n             programAdapter.setRow(programRow);\n-            programAdapter.Retrieve();\n+            RetrieveSearchResult(programAdapter);\n         }\n \n         SearchQuery artists = getSearchQuery(new String[] {\"MusicArtist\"});\n         ItemRowAdapter artistAdapter = new ItemRowAdapter(artists, new CardPresenter(), mRowsAdapter);\n         ListRow artistRow = new ListRow(new HeaderItem(context.getString(R.string.lbl_artists)), artistAdapter);\n         artistAdapter.setRow(artistRow);\n-        artistAdapter.Retrieve();\n+        RetrieveSearchResult(artistAdapter);\n \n         SearchQuery albums = getSearchQuery(new String[] {\"MusicAlbum\"});\n         ItemRowAdapter albumAdapter = new ItemRowAdapter(albums, new CardPresenter(), mRowsAdapter);\n         ListRow albumRow = new ListRow(new HeaderItem(context.getString(R.string.lbl_albums)), albumAdapter);\n         albumAdapter.setRow(albumRow);\n-        albumAdapter.Retrieve();\n+        RetrieveSearchResult(albumAdapter);\n \n         SearchQuery songs = getSearchQuery(new String[] {\"Audio\"});\n         ItemRowAdapter songAdapter = new ItemRowAdapter(songs, new CardPresenter(), mRowsAdapter);\n         ListRow songRow = new ListRow(new HeaderItem(context.getString(R.string.lbl_songs)), songAdapter);\n         songAdapter.setRow(songRow);\n-        songAdapter.Retrieve();\n+        RetrieveSearchResult(songAdapter);\n+\n+    }\n \n+    private void RetrieveSearchResult(ItemRowAdapter itemRow) {", "originalCommit": "65708a5fc5ec3471f079cfe71b1f1aed41ab2ae1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6d46bc108428be54acf46e80d0cd934ac3081e96", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/6d46bc108428be54acf46e80d0cd934ac3081e96", "message": "fix naming", "committedDate": "2020-01-20T18:47:35Z", "type": "commit"}]}