{"pr_number": 145, "pr_title": "support kie long polling&discovery / remove spring-fox ui", "pr_createdAt": "2020-03-02T07:37:34Z", "pr_url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/145", "timeline": [{"oid": "34ce79f41fb19d0b290d809965945a28240e9717", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/34ce79f41fb19d0b290d809965945a28240e9717", "message": "support kie long polling / remove spring-fox ui", "committedDate": "2020-03-02T07:33:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIzNDc5Mg==", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/145#discussion_r386234792", "bodyText": "\u9ed8\u8ba450s\u6709\u70b9\u957f\uff0c\u9002\u5f53\u5e94\u8be5\u8ba9\u51fa\u94fe\u63a5\uff0c30s\u5427\uff0c\u8fd9\u4e2a\u94fe\u63a5kie server\u7684\u8d85\u65f6\u5e94\u5f53\u6ce8\u610f\uff0c\u5fc5\u987b\u662f\u6709\u5173\u8054\u7684\uff0ckie\u7684\u8d85\u65f6\u65f6\u95f4\u5fc5\u987b\u5927\u4e8ewait\u65f6\u95f4\uff0c\u68c0\u67e5\u4e0b\u3002\n\u7b2c\u4e8c\u70b9\uff0c\u5982\u679cwait\u65f6\u95f4\u662f30s\uff0c\u5f88\u53ef\u80fdserver\u94fe\u63a5\u88ab\u6cbe\u6ee1\u4e86\uff0c\u90a3\u4e48\u4e00\u4e2a\u5ba2\u6237\u7aef\u91ca\u653e\u7684\u5b9e\u8df5\u4e5f\u662f30s\uff0c\u8fd9\u6837\u6ca1\u62a2\u5230\u8fde\u63a5\u7684\uff0c\u5728\u4e0b\u4e00\u6b21\u8d77\u7801\u80fd\u62a2\u5230\u3002\u4e3a\u4e86\u4fdd\u8bc1\u53ef\u9760\u6027\uff0c\u8d85\u65f6\u65f6\u95f4\u81f3\u5c11\u5e94\u5f53\u662f\u81f3\u5c11\u662fwait\u7684\u4e24\u500d\uff0c\u592a\u53c8\u4e0d\u5b9c\u8fc7\u9ad8\uff0c\u5efa\u8bae90s", "author": "tianxiaoliang", "createdAt": "2020-03-02T07:41:57Z", "path": "spring-cloud-huawei-config/src/main/java/com/huaweicloud/config/ServiceCombConfigProperties.java", "diffHunk": "@@ -131,6 +131,17 @@ public void setServerType(String serverType) {\n \n     private int waitTime = 10 * 1000;\n \n+    //unit s\n+    private int longPollingWait = 50;", "originalCommit": "34ce79f41fb19d0b290d809965945a28240e9717", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjgzNjAwOQ==", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/145#discussion_r392836009", "bodyText": "90s\u6307\u7684\u662f spring\u5ba2\u6237\u7aef\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\u8fd8\u662f\uff0ckie server\u7684\u8fde\u63a5\u6c60\u6ee1\u7b49\u5f85\u65f6\u95f4", "author": "GuoYL123", "createdAt": "2020-03-16T07:52:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIzNDc5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ2Mzk4OQ==", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/145#discussion_r393463989", "bodyText": "socketTimeOut \u8bbe\u7f6e50s", "author": "GuoYL123", "createdAt": "2020-03-17T06:17:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIzNDc5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIzNTMxNA==", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/145#discussion_r386235314", "bodyText": "longPollingWait  \u53ef\u4ee5\u65e0\u9700\u4e00\u884c\u6ce8\u91ca\uff0c\u53ea\u9700\u8981\u6539\u540d\u4e3aPollingWaitTimeInSeconds", "author": "tianxiaoliang", "createdAt": "2020-03-02T07:43:35Z", "path": "spring-cloud-huawei-config/src/main/java/com/huaweicloud/config/ServiceCombConfigProperties.java", "diffHunk": "@@ -131,6 +131,17 @@ public void setServerType(String serverType) {\n \n     private int waitTime = 10 * 1000;\n \n+    //unit s\n+    private int longPollingWait = 50;", "originalCommit": "34ce79f41fb19d0b290d809965945a28240e9717", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "eb016a314d30d64b154b9f90047fc35e962fbabe", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/eb016a314d30d64b154b9f90047fc35e962fbabe", "message": "modify as comment / auto discovery kie", "committedDate": "2020-03-12T08:40:32Z", "type": "forcePushed"}, {"oid": "2636735bd4e51181d105ceb40ed6f2d21eb5f48b", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/2636735bd4e51181d105ceb40ed6f2d21eb5f48b", "message": "modify as comment / auto discovery kie", "committedDate": "2020-03-12T09:34:56Z", "type": "commit"}, {"oid": "2636735bd4e51181d105ceb40ed6f2d21eb5f48b", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/2636735bd4e51181d105ceb40ed6f2d21eb5f48b", "message": "modify as comment / auto discovery kie", "committedDate": "2020-03-12T09:34:56Z", "type": "forcePushed"}, {"oid": "4fcad0420fb75d3410c0101e1c0ce55bcfcbf1c5", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/4fcad0420fb75d3410c0101e1c0ce55bcfcbf1c5", "message": "disable auto discovery kie", "committedDate": "2020-03-16T03:57:24Z", "type": "commit"}, {"oid": "d7ce3eb91aa0d6617a47a688626993d710e757e6", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/d7ce3eb91aa0d6617a47a688626993d710e757e6", "message": "long polling", "committedDate": "2020-03-16T14:23:11Z", "type": "forcePushed"}, {"oid": "5d1950fef9c2cfbe33397939cf5807cd7ba13bc5", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/5d1950fef9c2cfbe33397939cf5807cd7ba13bc5", "message": "long polling", "committedDate": "2020-03-16T14:25:31Z", "type": "forcePushed"}, {"oid": "047b6f4c7956f5f80f7c02e6e2f94d52a6a3290f", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/047b6f4c7956f5f80f7c02e6e2f94d52a6a3290f", "message": "long polling", "committedDate": "2020-03-17T01:05:02Z", "type": "forcePushed"}, {"oid": "198d01d27b52635186cced17d8cf0593464d7f8e", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/198d01d27b52635186cced17d8cf0593464d7f8e", "message": "long polling", "committedDate": "2020-03-17T01:35:32Z", "type": "forcePushed"}, {"oid": "57e3f39daaf2beb38472a8f85748648ef4d9f4fa", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/57e3f39daaf2beb38472a8f85748648ef4d9f4fa", "message": "long polling", "committedDate": "2020-03-17T04:01:58Z", "type": "commit"}, {"oid": "57e3f39daaf2beb38472a8f85748648ef4d9f4fa", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/57e3f39daaf2beb38472a8f85748648ef4d9f4fa", "message": "long polling", "committedDate": "2020-03-17T04:01:58Z", "type": "forcePushed"}, {"oid": "2e1ec7c13b965b59f37cb30cbdc79968c0c6aa49", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/2e1ec7c13b965b59f37cb30cbdc79968c0c6aa49", "message": "enable long polling", "committedDate": "2020-03-17T06:40:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDgyMTczOQ==", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/145#discussion_r394821739", "bodyText": "Maybe this code can added later, do not put unused code here, and create a task for this. For each version of sch, must notice the versions of suppoted kie.", "author": "liubao68", "createdAt": "2020-03-19T06:55:05Z", "path": "spring-cloud-huawei-config/src/main/java/com/huaweicloud/config/client/ServiceCombConfigClient.java", "diffHunk": "@@ -150,10 +157,14 @@ public ServiceCombConfigClient(String urls, HttpTransport httpTransport) {\n    * @throws RemoteOperationException\n    */\n   public Map<String, String> loadFromKie(ServiceCombConfigProperties serviceCombConfigProperties,\n-      String project)\n+      String project, boolean isWatch)\n       throws RemoteOperationException {\n     Response response = null;\n     Map<String, String> result = new HashMap<>();\n+    //todo : wait for kie support discovery", "originalCommit": "2e1ec7c13b965b59f37cb30cbdc79968c0c6aa49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQxMzU4NQ==", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/145#discussion_r395413585", "bodyText": "I\u2018ve delete the code , but I save the interface for next pr.", "author": "GuoYL123", "createdAt": "2020-03-20T02:24:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDgyMTczOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDgzMzE4MQ==", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/145#discussion_r394833181", "bodyText": "\u8fd9\u4e2atrue \u548cfalse\u53c2\u6570\u4e0d\u6613\u8bfb\uff0c\u5c01\u88c5\u4e3a\u4e0d\u540c\u65b9\u6cd5\u540d\u533a\u5206\u5c31\u884c\u4e86", "author": "tianxiaoliang", "createdAt": "2020-03-19T07:28:46Z", "path": "spring-cloud-huawei-config/src/main/java/com/huaweicloud/config/client/ServiceCombConfigClient.java", "diffHunk": "@@ -76,10 +78,15 @@ public ServiceCombConfigClient(String urls, HttpTransport httpTransport) {\n     project = project != null && !project.isEmpty() ? project : ConfigConstants.DEFAULT_PROJECT;\n     if (!StringUtils.isEmpty(serviceCombConfigProperties.getServerType())\n         && serviceCombConfigProperties.getServerType().equals(\"kie\")) {\n+      //\u4e0a\u4f20\u672c\u5730\u914d\u7f6e\n       if (!isupdatedConfig.get() && updateToKie(serviceCombConfigProperties)) {\n         isupdatedConfig.compareAndSet(false, true);\n       }\n-      return loadFromKie(serviceCombConfigProperties, project);\n+      if (serviceCombConfigProperties.getEnableLongPolling()) {\n+        return loadFromKie(serviceCombConfigProperties, project, true);\n+      } else {\n+        return loadFromKie(serviceCombConfigProperties, project, false);", "originalCommit": "2e1ec7c13b965b59f37cb30cbdc79968c0c6aa49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQxMTkwNg==", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/145#discussion_r395411906", "bodyText": "\u5c01\u88c5\u4e0d\u540c\u65b9\u6cd5\u53ef\u80fd\u4f1a\u4ea7\u751f\u91cd\u590d\u4ee3\u7801", "author": "GuoYL123", "createdAt": "2020-03-20T02:14:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDgzMzE4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDgzMzMwMQ==", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/145#discussion_r394833301", "bodyText": "\u5220\u6389\u6ce8\u91ca\u4ee3\u7801", "author": "tianxiaoliang", "createdAt": "2020-03-19T07:29:07Z", "path": "spring-cloud-huawei-config/src/main/java/com/huaweicloud/config/client/ServiceCombConfigClient.java", "diffHunk": "@@ -150,10 +157,14 @@ public ServiceCombConfigClient(String urls, HttpTransport httpTransport) {\n    * @throws RemoteOperationException\n    */\n   public Map<String, String> loadFromKie(ServiceCombConfigProperties serviceCombConfigProperties,\n-      String project)\n+      String project, boolean isWatch)\n       throws RemoteOperationException {\n     Response response = null;\n     Map<String, String> result = new HashMap<>();\n+    //todo : wait for kie support discovery\n+//    if (configCenterConfig.isEmpty()) {\n+//      autoDisvoceryKie();", "originalCommit": "2e1ec7c13b965b59f37cb30cbdc79968c0c6aa49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQxMzYyMA==", "url": "https://github.com/huaweicloud/spring-cloud-huawei/pull/145#discussion_r395413620", "bodyText": "done", "author": "GuoYL123", "createdAt": "2020-03-20T02:24:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDgzMzMwMQ=="}], "type": "inlineReview"}, {"oid": "d21930c20b0a307bc28878f74b02a61d3e8c1bd0", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/d21930c20b0a307bc28878f74b02a61d3e8c1bd0", "message": "delete useless code", "committedDate": "2020-03-20T02:23:18Z", "type": "commit"}, {"oid": "ae84d698dede380fdcd21730f2e2cd95c4b4eab6", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/ae84d698dede380fdcd21730f2e2cd95c4b4eab6", "message": "chang label env to environment", "committedDate": "2020-03-24T01:51:27Z", "type": "commit"}, {"oid": "ae84d698dede380fdcd21730f2e2cd95c4b4eab6", "url": "https://github.com/huaweicloud/spring-cloud-huawei/commit/ae84d698dede380fdcd21730f2e2cd95c4b4eab6", "message": "chang label env to environment", "committedDate": "2020-03-24T01:51:27Z", "type": "forcePushed"}]}