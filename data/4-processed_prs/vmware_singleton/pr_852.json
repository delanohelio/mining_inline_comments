{"pr_number": 852, "pr_title": "remove the l10n  locale list match validate  ", "pr_createdAt": "2020-11-02T05:10:12Z", "pr_url": "https://github.com/vmware/singleton/pull/852", "timeline": [{"oid": "64e84d301d379cf2490a9a2f2862ca84d03aed20", "url": "https://github.com/vmware/singleton/commit/64e84d301d379cf2490a9a2f2862ca84d03aed20", "message": "add the locale validate switch", "committedDate": "2020-11-02T04:58:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgxMTcyOA==", "url": "https://github.com/vmware/singleton/pull/852#discussion_r515811728", "bodyText": "Is it possible to use sourceLocales directly without adding a new parameter: sourceLocalesStr?", "author": "chaoq0318", "createdAt": "2020-11-02T08:38:22Z", "path": "g11n-ws/vip-manager-l10n/src/main/java/com/vmware/l10n/conf/CollectSourceValidationInterceptor.java", "diffHunk": "@@ -31,11 +31,13 @@\n \t\n \tprivate static Logger LOGGER = LoggerFactory.getLogger(CollectSourceValidationInterceptor.class);\n \t\n-\tpublic CollectSourceValidationInterceptor(List<String> sourceLocales, Map<String, List<String>> allowListMap) {\n+\tpublic CollectSourceValidationInterceptor(List<String> sourceLocales, Map<String, List<String>> allowListMap, String sourceLocalesStr) {", "originalCommit": "64e84d301d379cf2490a9a2f2862ca84d03aed20", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQxMDEyMw==", "url": "https://github.com/vmware/singleton/pull/852#discussion_r516410123", "bodyText": "done", "author": "tigershi", "createdAt": "2020-11-03T03:27:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgxMTcyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyMTMyOQ==", "url": "https://github.com/vmware/singleton/pull/852#discussion_r515821329", "bodyText": "Need to know the purposes of sourceLocales and sourceLocaleStr.", "author": "Xiaochao8", "createdAt": "2020-11-02T08:56:08Z", "path": "g11n-ws/vip-manager-l10n/src/main/java/com/vmware/l10n/conf/CollectSourceValidationInterceptor.java", "diffHunk": "@@ -31,11 +31,13 @@\n \t\n \tprivate static Logger LOGGER = LoggerFactory.getLogger(CollectSourceValidationInterceptor.class);\n \t\n-\tpublic CollectSourceValidationInterceptor(List<String> sourceLocales, Map<String, List<String>> allowListMap) {\n+\tpublic CollectSourceValidationInterceptor(List<String> sourceLocales, Map<String, List<String>> allowListMap, String sourceLocalesStr) {\n \t\tthis.sourceLocales = sourceLocales;\n \t\tthis.allowList = allowListMap;\n+\t\tthis.sourceLocalesStr = sourceLocalesStr;", "originalCommit": "64e84d301d379cf2490a9a2f2862ca84d03aed20", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM5NTQ3Mg==", "url": "https://github.com/vmware/singleton/pull/852#discussion_r516395472", "bodyText": "sourceLocales use validate the collect resource  locale\uff0c sourceLocaleStr use response String when validate false", "author": "tigershi", "createdAt": "2020-11-03T02:20:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyMTMyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyMTgxOQ==", "url": "https://github.com/vmware/singleton/pull/852#discussion_r515821819", "bodyText": "It's strange to use argument of index 0 to judge.", "author": "Xiaochao8", "createdAt": "2020-11-02T08:57:03Z", "path": "g11n-ws/vip-manager-l10n/src/main/java/com/vmware/l10n/conf/CollectSourceValidationInterceptor.java", "diffHunk": "@@ -181,8 +183,9 @@ private static void validateLocale(HttpServletRequest request, List<String> sour\n \t\t}\n \t\tif (!RegExpValidatorUtils.IsLetterAndNumberAndValidchar(locale)) {\n \t\t\tthrow new VIPAPIException(ValidationMsg.LOCALE_NOT_VALIDE);\n-\t\t}else if (!sourceLocales2.contains(locale)) {\n-\t\t\tthrow new VIPAPIException(ValidationMsg.LOCALE_NOT_VALIDE);\n+\t\t}\n+\t\tif (!sourceLocales2.get(0).equals(ConstantsKeys.FALSE) && !sourceLocales2.contains(locale)) {", "originalCommit": "64e84d301d379cf2490a9a2f2862ca84d03aed20", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQxMDc1Nw==", "url": "https://github.com/vmware/singleton/pull/852#discussion_r516410757", "bodyText": "the list interface not support get first method", "author": "tigershi", "createdAt": "2020-11-03T03:30:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyMTgxOQ=="}], "type": "inlineReview"}, {"oid": "7de2712a402353de9f7a2a8e84e37f5527e1cd99", "url": "https://github.com/vmware/singleton/commit/7de2712a402353de9f7a2a8e84e37f5527e1cd99", "message": "fixed the comment", "committedDate": "2020-11-03T03:28:14Z", "type": "commit"}, {"oid": "b8241a0fdb29905e784d61408f3e219533014c38", "url": "https://github.com/vmware/singleton/commit/b8241a0fdb29905e784d61408f3e219533014c38", "message": "fixed the comment", "committedDate": "2020-11-03T03:33:14Z", "type": "commit"}, {"oid": "d5344713898379b29cf0599792e805545e5158ef", "url": "https://github.com/vmware/singleton/commit/d5344713898379b29cf0599792e805545e5158ef", "message": "Merge branch 'master' into master", "committedDate": "2020-11-03T03:35:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ0MDg0OA==", "url": "https://github.com/vmware/singleton/pull/852#discussion_r516440848", "bodyText": "Maybe we can use StringUtils.join directly, such as\nreturn StringUtils.join(sourceLocaleList, ConstantsChar.COMMA + ConstantsChar.SPACING);", "author": "chaoq0318", "createdAt": "2020-11-03T05:57:48Z", "path": "g11n-ws/vip-manager-l10n/src/main/java/com/vmware/l10n/conf/CollectSourceValidationInterceptor.java", "diffHunk": "@@ -181,11 +182,24 @@ private static void validateLocale(HttpServletRequest request, List<String> sour\n \t\t}\n \t\tif (!RegExpValidatorUtils.IsLetterAndNumberAndValidchar(locale)) {\n \t\t\tthrow new VIPAPIException(ValidationMsg.LOCALE_NOT_VALIDE);\n-\t\t}else if (!sourceLocales2.contains(locale)) {\n-\t\t\tthrow new VIPAPIException(ValidationMsg.LOCALE_NOT_VALIDE);\n+\t\t}\n+\t\tif (!sourceLocales2.get(0).equals(ConstantsKeys.FALSE) && !sourceLocales2.contains(locale)) {\n+\t\t\tthrow new VIPAPIException(String.format(ValidationMsg.LOCALENAME_ONLY_SUPPORTED, getSourceSupportLocales(sourceLocales2)));\n \t\t}\n \t}\n \n+\tprivate static String getSourceSupportLocales(List<String> sourceLocaleList) {\n+\t\tif(sourceLocaleList == null || sourceLocaleList.size() == 0) {\n+\t\t\treturn \"\";\n+\t\t}\n+\t\tStringBuilder sb = new StringBuilder();", "originalCommit": "d5344713898379b29cf0599792e805545e5158ef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ1NTU5MA==", "url": "https://github.com/vmware/singleton/pull/852#discussion_r516455590", "bodyText": "What locale?", "author": "Xiaochao8", "createdAt": "2020-11-03T06:55:20Z", "path": "g11n-ws/vip-common/src/main/java/com/vmware/vip/common/constants/ValidationMsg.java", "diffHunk": "@@ -26,4 +26,5 @@\n \tpublic final static String PATTERN_NOT_VALIDE = \"Incorrect pattern(only allows letter)\";\n \tpublic final static String PRODUCTNAME_NOT_SUPPORTED = \"The product '%s' is NOT supported yet!\";\n \tpublic final static String LOCALENAME_NOT_SUPPORTED = \"The locale '%s' is NOT supported yet!\";\n+\tpublic final static String LOCALENAME_ONLY_SUPPORTED = \"The locale only support( '%s' )!\";", "originalCommit": "d5344713898379b29cf0599792e805545e5158ef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ1ODQyOA==", "url": "https://github.com/vmware/singleton/pull/852#discussion_r516458428", "bodyText": "If sourceLocales2 is empty, don't need to verify the locale. Is this more reasonable?", "author": "Xiaochao8", "createdAt": "2020-11-03T07:05:15Z", "path": "g11n-ws/vip-manager-l10n/src/main/java/com/vmware/l10n/conf/CollectSourceValidationInterceptor.java", "diffHunk": "@@ -181,11 +182,24 @@ private static void validateLocale(HttpServletRequest request, List<String> sour\n \t\t}\n \t\tif (!RegExpValidatorUtils.IsLetterAndNumberAndValidchar(locale)) {\n \t\t\tthrow new VIPAPIException(ValidationMsg.LOCALE_NOT_VALIDE);\n-\t\t}else if (!sourceLocales2.contains(locale)) {\n-\t\t\tthrow new VIPAPIException(ValidationMsg.LOCALE_NOT_VALIDE);\n+\t\t}\n+\t\tif (!sourceLocales2.get(0).equals(ConstantsKeys.FALSE) && !sourceLocales2.contains(locale)) {", "originalCommit": "d5344713898379b29cf0599792e805545e5158ef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ1OTU3NQ==", "url": "https://github.com/vmware/singleton/pull/852#discussion_r516459575", "bodyText": "To improve performance, it's better to prepare the supported locale string when application starts up.", "author": "Xiaochao8", "createdAt": "2020-11-03T07:08:57Z", "path": "g11n-ws/vip-manager-l10n/src/main/java/com/vmware/l10n/conf/CollectSourceValidationInterceptor.java", "diffHunk": "@@ -181,11 +182,24 @@ private static void validateLocale(HttpServletRequest request, List<String> sour\n \t\t}\n \t\tif (!RegExpValidatorUtils.IsLetterAndNumberAndValidchar(locale)) {\n \t\t\tthrow new VIPAPIException(ValidationMsg.LOCALE_NOT_VALIDE);\n-\t\t}else if (!sourceLocales2.contains(locale)) {\n-\t\t\tthrow new VIPAPIException(ValidationMsg.LOCALE_NOT_VALIDE);\n+\t\t}\n+\t\tif (!sourceLocales2.get(0).equals(ConstantsKeys.FALSE) && !sourceLocales2.contains(locale)) {\n+\t\t\tthrow new VIPAPIException(String.format(ValidationMsg.LOCALENAME_ONLY_SUPPORTED, getSourceSupportLocales(sourceLocales2)));\n \t\t}\n \t}\n \n+\tprivate static String getSourceSupportLocales(List<String> sourceLocaleList) {", "originalCommit": "d5344713898379b29cf0599792e805545e5158ef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0938d1ff13c20add1be66e44dd893b817324a4f8", "url": "https://github.com/vmware/singleton/commit/0938d1ff13c20add1be66e44dd893b817324a4f8", "message": "remove source collectiong locale list validate", "committedDate": "2020-11-03T07:40:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ3NTA3OQ==", "url": "https://github.com/vmware/singleton/pull/852#discussion_r516475079", "bodyText": "Is this used?", "author": "chaoq0318", "createdAt": "2020-11-03T07:52:32Z", "path": "g11n-ws/vip-manager-l10n/src/main/java/com/vmware/l10n/conf/CollectSourceValidationInterceptor.java", "diffHunk": "@@ -19,6 +19,7 @@\n \n import com.fasterxml.jackson.databind.ObjectMapper;\n import com.vmware.vip.api.rest.APIParamName;\n+import com.vmware.vip.common.constants.ConstantsChar;", "originalCommit": "0938d1ff13c20add1be66e44dd893b817324a4f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU0MDg0OA==", "url": "https://github.com/vmware/singleton/pull/852#discussion_r516540848", "bodyText": "yes", "author": "tigershi", "createdAt": "2020-11-03T09:51:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ3NTA3OQ=="}], "type": "inlineReview"}]}