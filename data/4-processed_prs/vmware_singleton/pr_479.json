{"pr_number": 479, "pr_title": "[JsClient] Support downloading both translations and patterns by only\u2026", "pr_createdAt": "2020-03-25T13:17:23Z", "pr_url": "https://github.com/vmware/singleton/pull/479", "timeline": [{"oid": "5ab62d7f6bf98b1ee784ac17786e85667e3c1a7f", "url": "https://github.com/vmware/singleton/commit/5ab62d7f6bf98b1ee784ac17786e85667e3c1a7f", "message": "[JsClient] Support downloading both translations and patterns by only one request to Singleton Service", "committedDate": "2020-03-27T00:08:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTIzMzQ3OQ==", "url": "https://github.com/vmware/singleton/pull/479#discussion_r409233479", "bodyText": "Logically, translation and pattern data validation should not be nested.", "author": "wangyi-e", "createdAt": "2020-04-16T01:50:32Z", "path": "src/services/core.service.ts", "diffHunk": "@@ -184,6 +198,35 @@ export class CoreService {\n             }).catch((err: any) => { this.logger.error('Load translations failed.', err.message); });\n     }\n \n+    public loadTranslationsAndPattern(language: string, region: string): Promise<any> | Promise<any>[] {\n+        const cachePattern = this.cacheManager.lookforPattern(language, region);\n+        if (typeof cachePattern !== 'undefined') {\n+            const cacheTranslation = this.cacheManager.lookforTranslationByComponent(this.config.component, language);\n+            if (typeof cacheTranslation === 'undefined') {\n+                return Promise.resolve({\n+                    components: [cacheTranslation],\n+                    pattern: cachePattern\n+                });\n+            }\n+        }\n+\n+        const url = this.getI18nResourceUrl(language, region);\n+        const promise = this.coreLoader.getI18nResource(url, this.httpOptions);\n+        return promise.then(\n+            (result: any) => {\n+                const translations = this.resParser.getTranslations(result);\n+                if (translations) {", "originalCommit": "cf7764c94ca6206c3153473878b857133d26be9f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTIzNTM2OQ==", "url": "https://github.com/vmware/singleton/pull/479#discussion_r409235369", "bodyText": "If this data can be checked in advance to keep loadTranslationsAndPattern clean.\nThe translation and pattern data validation should not be nested.", "author": "wangyi-e", "createdAt": "2020-04-16T01:57:19Z", "path": "src/services/core.service.ts", "diffHunk": "@@ -184,6 +198,35 @@ export class CoreService {\n             }).catch((err: any) => { this.logger.error('Load translations failed.', err.message); });\n     }\n \n+    public loadTranslationsAndPattern(language: string, region: string): Promise<any> | Promise<any>[] {\n+        const cachePattern = this.cacheManager.lookforPattern(language, region);\n+        if (typeof cachePattern !== 'undefined') {\n+            const cacheTranslation = this.cacheManager.lookforTranslationByComponent(this.config.component, language);\n+            if (typeof cacheTranslation === 'undefined') {\n+                return Promise.resolve({\n+                    components: [cacheTranslation],\n+                    pattern: cachePattern\n+                });\n+            }\n+        }", "originalCommit": "cf7764c94ca6206c3153473878b857133d26be9f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDY5Mjk2Nw==", "url": "https://github.com/vmware/singleton/pull/479#discussion_r410692967", "bodyText": "Alreay modifed", "author": "songjiang320", "createdAt": "2020-04-18T12:40:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTIzNTM2OQ=="}], "type": "inlineReview"}, {"oid": "6a94f4bdd4790596bc796918d6aac5ac76bd71e7", "url": "https://github.com/vmware/singleton/commit/6a94f4bdd4790596bc796918d6aac5ac76bd71e7", "message": "Fix smoke test issue due to uri space in &region=${region}", "committedDate": "2020-04-18T12:29:15Z", "type": "commit"}, {"oid": "1d500d2cb7347220d99f7395b1f736526d03d422", "url": "https://github.com/vmware/singleton/commit/1d500d2cb7347220d99f7395b1f736526d03d422", "message": "When plural message falls back to 'en', the Number formatting in it will follow Region pattern", "committedDate": "2020-04-23T01:58:36Z", "type": "commit"}]}