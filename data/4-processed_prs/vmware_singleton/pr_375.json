{"pr_number": 375, "pr_title": "[REQUIREMENT] Support more formatting options for language list API", "pr_createdAt": "2020-02-11T08:37:42Z", "pr_url": "https://github.com/vmware/singleton/pull/375", "timeline": [{"oid": "35792a3d466e0e0dac0e7717c1d4ef8d979d2b28", "url": "https://github.com/vmware/singleton/commit/35792a3d466e0e0dac0e7717c1d4ef8d979d2b28", "message": "fix issue:https://github.com/vmware/singleton/issues/361", "committedDate": "2020-02-11T08:28:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY0ODYyMQ==", "url": "https://github.com/vmware/singleton/pull/375#discussion_r378648621", "bodyText": "The parameter 'language' here means 'displayName', right?\nTo distinguish \u2019displayLanguage\u2018 and 'displayName', I think changing 'language' to 'displayName' is more readable.\nPlease also check all the variable names above, if there is any make others misunderstanding.", "author": "huihuiw01", "createdAt": "2020-02-13T04:44:27Z", "path": "g11n-ws/modules/md-service-i18n-l2/src/main/java/com/vmware/i18n/l2/service/locale/LocaleService.java", "diffHunk": "@@ -106,15 +113,52 @@ public String getLocaleFromName(String locale) {\n \t\tlanguagesMap = (Map<String, String>) jsonMap.get(LANGUAGE_STR);\n \n \t\tfor (String language : languageList) {\n+\t\t\tMap<String, String> displayNameMap = getDisplayNameMap(language, languagesParser, languagesMap.get(language));\n \t\t\tlanguage = LocaleUtils.normalizeToLanguageTag(language);\n \t\t\tdto = new DisplayLanguageDTO();\n \t\t\tdto.setDisplayName(languagesMap.get(language) == null ? \"\" : languagesMap.get(language));\n+\t\t\tdto.setDisplayName_sentenceBeginning(StringUtils.isEmpty(displayNameMap.get(DISPLAY_NAME_SENTENCE_BEGINNING)) ? dto.getDisplayName() : displayNameMap.get(DISPLAY_NAME_SENTENCE_BEGINNING));\n+\t\t\tdto.setDisplayName_uiListOrMenu(StringUtils.isEmpty(displayNameMap.get(DISPLAY_NAME_UI_LIST)) ? dto.getDisplayName() : displayNameMap.get(DISPLAY_NAME_UI_LIST));\n+\t\t\tdto.setDisplayName_standalone(StringUtils.isEmpty(displayNameMap.get(DISPLAY_NAME_STANDALONE)) ? dto.getDisplayName() : displayNameMap.get(DISPLAY_NAME_STANDALONE));\n \t\t\tdto.setLanguageTag(language);\n \t\t\tdtoList.add(dto);\n \t\t}\n \t\treturn dtoList;\n \t}\n \n+\tprivate Map<String, String> getDisplayNameMap(String language, LanguagesFileParser languagesParser, String displayName) {\n+\t\tMap<String, Object> tmpContext = languagesParser.getContextTransforms(language);\n+\t\tMap<String, String> displayNameMap = new HashMap<>();\n+\t\tdisplayNameMap.put(DISPLAY_NAME_UI_LIST, \"\");\n+\t\tdisplayNameMap.put(DISPLAY_NAME_STANDALONE, \"\");\n+\t\tdisplayNameMap.put(DISPLAY_NAME_SENTENCE_BEGINNING, tittleCase(displayName));\n+\t\tif (tmpContext != null && tmpContext.get(CONTEXT_TRANSFORMS) != null) {\n+\t\t\tMap<String, Map<String, String>> contextTransformMap = (Map<String, Map<String, String>>) tmpContext.get(CONTEXT_TRANSFORMS);\n+\t\t\tif (contextTransformMap != null && contextTransformMap.get(LANGUAGE_STR) != null) {\n+\t\t\t\tMap<String, String> languageMap = contextTransformMap.get(LANGUAGE_STR);\n+\t\t\t\tif (languageMap.get(STAND_ALONE) != null) {\n+\t\t\t\t\tdisplayNameMap.put(DISPLAY_NAME_STANDALONE, languageMap.get(STAND_ALONE).equals(NO_CHANGES) ? displayName : tittleCase(displayName));\n+\t\t\t\t}\n+\t\t\t\tif (languageMap.get(UI_LIST_OR_MENU) != null) {\n+\t\t\t\t\tdisplayNameMap.put(DISPLAY_NAME_UI_LIST, languageMap.get(UI_LIST_OR_MENU).equals(NO_CHANGES) ? displayName : tittleCase(displayName));\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t\treturn displayNameMap;\n+\t}\n+\n+\tprivate String tittleCase(String language) {", "originalCommit": "35792a3d466e0e0dac0e7717c1d4ef8d979d2b28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzOTQxOA==", "url": "https://github.com/vmware/singleton/pull/375#discussion_r379239418", "bodyText": "fixed", "author": "chaoq0318", "createdAt": "2020-02-14T03:51:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY0ODYyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY0OTE2MQ==", "url": "https://github.com/vmware/singleton/pull/375#discussion_r378649161", "bodyText": "The parameter 'language' here means 'supportedLanguage', right?\nTo distinguish \u2019supportedLanguage\u2018 and 'displayLanguage', I think changing 'language' to 'displayLanguage' is more readable.", "author": "huihuiw01", "createdAt": "2020-02-13T04:46:44Z", "path": "g11n-ws/modules/md-service-i18n-l2/src/main/java/com/vmware/i18n/l2/service/locale/LocaleService.java", "diffHunk": "@@ -106,15 +113,52 @@ public String getLocaleFromName(String locale) {\n \t\tlanguagesMap = (Map<String, String>) jsonMap.get(LANGUAGE_STR);\n \n \t\tfor (String language : languageList) {\n+\t\t\tMap<String, String> displayNameMap = getDisplayNameMap(language, languagesParser, languagesMap.get(language));\n \t\t\tlanguage = LocaleUtils.normalizeToLanguageTag(language);\n \t\t\tdto = new DisplayLanguageDTO();\n \t\t\tdto.setDisplayName(languagesMap.get(language) == null ? \"\" : languagesMap.get(language));\n+\t\t\tdto.setDisplayName_sentenceBeginning(StringUtils.isEmpty(displayNameMap.get(DISPLAY_NAME_SENTENCE_BEGINNING)) ? dto.getDisplayName() : displayNameMap.get(DISPLAY_NAME_SENTENCE_BEGINNING));\n+\t\t\tdto.setDisplayName_uiListOrMenu(StringUtils.isEmpty(displayNameMap.get(DISPLAY_NAME_UI_LIST)) ? dto.getDisplayName() : displayNameMap.get(DISPLAY_NAME_UI_LIST));\n+\t\t\tdto.setDisplayName_standalone(StringUtils.isEmpty(displayNameMap.get(DISPLAY_NAME_STANDALONE)) ? dto.getDisplayName() : displayNameMap.get(DISPLAY_NAME_STANDALONE));\n \t\t\tdto.setLanguageTag(language);\n \t\t\tdtoList.add(dto);\n \t\t}\n \t\treturn dtoList;\n \t}\n \n+\tprivate Map<String, String> getDisplayNameMap(String language, LanguagesFileParser languagesParser, String displayName) {", "originalCommit": "35792a3d466e0e0dac0e7717c1d4ef8d979d2b28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzOTQ0OA==", "url": "https://github.com/vmware/singleton/pull/375#discussion_r379239448", "bodyText": "fixed", "author": "chaoq0318", "createdAt": "2020-02-14T03:51:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY0OTE2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY1MDQ4OQ==", "url": "https://github.com/vmware/singleton/pull/375#discussion_r378650489", "bodyText": "Here if 'displayLanguage' is not empty, we should get contextTransform data according to it; if empty should get data according to supported language.", "author": "huihuiw01", "createdAt": "2020-02-13T04:53:31Z", "path": "g11n-ws/modules/md-service-i18n-l2/src/main/java/com/vmware/i18n/l2/service/locale/LocaleService.java", "diffHunk": "@@ -106,15 +113,52 @@ public String getLocaleFromName(String locale) {\n \t\tlanguagesMap = (Map<String, String>) jsonMap.get(LANGUAGE_STR);\n \n \t\tfor (String language : languageList) {\n+\t\t\tMap<String, String> displayNameMap = getDisplayNameMap(language, languagesParser, languagesMap.get(language));\n \t\t\tlanguage = LocaleUtils.normalizeToLanguageTag(language);\n \t\t\tdto = new DisplayLanguageDTO();\n \t\t\tdto.setDisplayName(languagesMap.get(language) == null ? \"\" : languagesMap.get(language));\n+\t\t\tdto.setDisplayName_sentenceBeginning(StringUtils.isEmpty(displayNameMap.get(DISPLAY_NAME_SENTENCE_BEGINNING)) ? dto.getDisplayName() : displayNameMap.get(DISPLAY_NAME_SENTENCE_BEGINNING));\n+\t\t\tdto.setDisplayName_uiListOrMenu(StringUtils.isEmpty(displayNameMap.get(DISPLAY_NAME_UI_LIST)) ? dto.getDisplayName() : displayNameMap.get(DISPLAY_NAME_UI_LIST));\n+\t\t\tdto.setDisplayName_standalone(StringUtils.isEmpty(displayNameMap.get(DISPLAY_NAME_STANDALONE)) ? dto.getDisplayName() : displayNameMap.get(DISPLAY_NAME_STANDALONE));\n \t\t\tdto.setLanguageTag(language);\n \t\t\tdtoList.add(dto);\n \t\t}\n \t\treturn dtoList;\n \t}\n \n+\tprivate Map<String, String> getDisplayNameMap(String language, LanguagesFileParser languagesParser, String displayName) {\n+\t\tMap<String, Object> tmpContext = languagesParser.getContextTransforms(language);", "originalCommit": "35792a3d466e0e0dac0e7717c1d4ef8d979d2b28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzOTQ5Mw==", "url": "https://github.com/vmware/singleton/pull/375#discussion_r379239493", "bodyText": "fixed", "author": "chaoq0318", "createdAt": "2020-02-14T03:51:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY1MDQ4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY3NDg1MA==", "url": "https://github.com/vmware/singleton/pull/375#discussion_r378674850", "bodyText": "It's not reasonable to put contextTransform data in localedata folder, since it not only contains locale context data, but also other context data, such as that for date. So I think put it into a parallel folder with 'localedata' is better.", "author": "huihuiw01", "createdAt": "2020-02-13T06:38:27Z", "path": "g11n-ws/tools/tool-cldr-extractor/src/main/java/com/vmware/i18n/common/CLDRConstants.java", "diffHunk": "@@ -47,6 +50,7 @@\n \tpublic static final String ALL_CATEGORIES = \"dates,numbers,plurals,measurements,currencies,dateFields\";\n \tpublic static final String LOCALE_TERRITORIES_PATH = \"cldr/localedata/{0}/territories.json\";\n \tpublic static final String LOCALE_LANGUAGES_PATH = \"cldr/localedata/{0}/languages.json\";\n+\tpublic static final String CONTEXT_TRANSFORM_PATH = \"cldr/localedata/{0}/contextTransforms.json\";", "originalCommit": "35792a3d466e0e0dac0e7717c1d4ef8d979d2b28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzOTU0Mw==", "url": "https://github.com/vmware/singleton/pull/375#discussion_r379239543", "bodyText": "fixed", "author": "chaoq0318", "createdAt": "2020-02-14T03:52:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY3NDg1MA=="}], "type": "inlineReview"}, {"oid": "06e19f40cc597f82eb2db6305ac8a549692fc7eb", "url": "https://github.com/vmware/singleton/commit/06e19f40cc597f82eb2db6305ac8a549692fc7eb", "message": "fix comments:Here if displayLanguage is not empty, we should get contextTransform data according to it; if empty should get data according to supported language.", "committedDate": "2020-02-14T03:44:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTk3MTA4Ng==", "url": "https://github.com/vmware/singleton/pull/375#discussion_r379971086", "bodyText": "I think change the folder name from 'contextTransforms' to 'misc' is better, since currently we only use contextTransforms data, but there are other data in misc, if we need extract those data, we can't put them in contextTransforms floder, need create new folder, so I suggest we keep the same with cldr data structure.", "author": "huihuiw01", "createdAt": "2020-02-17T03:20:28Z", "path": "g11n-ws/tools/tool-cldr-extractor/src/main/java/com/vmware/i18n/common/CLDRConstants.java", "diffHunk": "@@ -50,7 +52,7 @@\n \tpublic static final String ALL_CATEGORIES = \"dates,numbers,plurals,measurements,currencies,dateFields\";\n \tpublic static final String LOCALE_TERRITORIES_PATH = \"cldr/localedata/{0}/territories.json\";\n \tpublic static final String LOCALE_LANGUAGES_PATH = \"cldr/localedata/{0}/languages.json\";\n-\tpublic static final String CONTEXT_TRANSFORM_PATH = \"cldr/localedata/{0}/contextTransforms.json\";\n+\tpublic static final String CONTEXT_TRANSFORM_PATH = \"cldr/contextTransforms/{0}/contextTransforms.json\";", "originalCommit": "06e19f40cc597f82eb2db6305ac8a549692fc7eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA0MjU1OQ==", "url": "https://github.com/vmware/singleton/pull/375#discussion_r380042559", "bodyText": "fixed", "author": "chaoq0318", "createdAt": "2020-02-17T08:36:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTk3MTA4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTk3NDQ4NQ==", "url": "https://github.com/vmware/singleton/pull/375#discussion_r379974485", "bodyText": "Same reason as above, contextTransforms data not only contains data for localedata, but also contains data for others, so put this method in LocaleDataUtils class may not reasonable, I suggest put it into a new class MiscUtils.", "author": "huihuiw01", "createdAt": "2020-02-17T03:43:49Z", "path": "g11n-ws/tools/tool-cldr-extractor/src/main/java/com/vmware/i18n/utils/LocaleDataUtils.java", "diffHunk": "@@ -279,4 +276,47 @@ public static void localesExtract() {\n \t\tlogger.info(\"Extract cldr locales data complete!\");\n \t}\n \n+\tpublic static void contextTransformsExtract() {", "originalCommit": "06e19f40cc597f82eb2db6305ac8a549692fc7eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA0MjY4Nw==", "url": "https://github.com/vmware/singleton/pull/375#discussion_r380042687", "bodyText": "fixed", "author": "chaoq0318", "createdAt": "2020-02-17T08:37:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTk3NDQ4NQ=="}], "type": "inlineReview"}, {"oid": "aa6f5d615a0434adb3eea931231d8eb54006d178", "url": "https://github.com/vmware/singleton/commit/aa6f5d615a0434adb3eea931231d8eb54006d178", "message": "fix comments:change the folder name from contextTransforms to misc", "committedDate": "2020-02-17T08:33:59Z", "type": "commit"}, {"oid": "27b6a477fbb797e5134557011b1fcd73960f8ba2", "url": "https://github.com/vmware/singleton/commit/27b6a477fbb797e5134557011b1fcd73960f8ba2", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-02-17T08:36:02Z", "type": "commit"}, {"oid": "75d6a2e849a11b1864303ab616e3005826b1f2fe", "url": "https://github.com/vmware/singleton/commit/75d6a2e849a11b1864303ab616e3005826b1f2fe", "message": "Merge branch 'master' into master", "committedDate": "2020-02-28T02:06:20Z", "type": "commit"}]}