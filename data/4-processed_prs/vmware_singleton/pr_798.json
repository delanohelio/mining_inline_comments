{"pr_number": 798, "pr_title": "Fix sonar errors upgrading sonar JDK to 11", "pr_createdAt": "2020-09-22T03:57:56Z", "pr_url": "https://github.com/vmware/singleton/pull/798", "timeline": [{"oid": "199f84190efc4c0e356c152cf553260577843b25", "url": "https://github.com/vmware/singleton/commit/199f84190efc4c0e356c152cf553260577843b25", "message": "Fix sonar errors upgrading sonar JDK to 11", "committedDate": "2020-09-21T11:27:09Z", "type": "commit"}, {"oid": "12b95211e41e330a164cbd165390412bbc587a74", "url": "https://github.com/vmware/singleton/commit/12b95211e41e330a164cbd165390412bbc587a74", "message": "Continue a", "committedDate": "2020-09-22T04:02:50Z", "type": "commit"}, {"oid": "e0ba9afb890e6c5ff274a02df10d07e46d79f5b4", "url": "https://github.com/vmware/singleton/commit/e0ba9afb890e6c5ff274a02df10d07e46d79f5b4", "message": "Revert .travis.yml", "committedDate": "2020-09-22T05:17:21Z", "type": "commit"}, {"oid": "5ad50cd1836aef18c701f42d905a3de9f7e725a1", "url": "https://github.com/vmware/singleton/commit/5ad50cd1836aef18c701f42d905a3de9f7e725a1", "message": "Merge remote-tracking branch 'remotes/upstream/g11n-java-client-0.4.2' into 0.4.2-sonar-jdk11", "committedDate": "2020-09-22T07:37:07Z", "type": "commit"}, {"oid": "f1f1c70e90aba3af53d570c5b4aa8aff046b655c", "url": "https://github.com/vmware/singleton/commit/f1f1c70e90aba3af53d570c5b4aa8aff046b655c", "message": "Revert some unnecessary changes", "committedDate": "2020-09-22T07:51:36Z", "type": "commit"}, {"oid": "062d952504881c176706f455de078afe8a95e81b", "url": "https://github.com/vmware/singleton/commit/062d952504881c176706f455de078afe8a95e81b", "message": "Merge remote-tracking branch 'remotes/upstream/g11n-java-client-0.4.2' into 0.4.2-sonar-jdk11", "committedDate": "2020-09-24T13:25:50Z", "type": "commit"}, {"oid": "d7c692b59ef7c5d9ab0efcb1637a087ebee126cb", "url": "https://github.com/vmware/singleton/commit/d7c692b59ef7c5d9ab0efcb1637a087ebee126cb", "message": "Update build.gradle", "committedDate": "2020-09-24T15:29:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY5NDY0Nw==", "url": "https://github.com/vmware/singleton/pull/798#discussion_r494694647", "bodyText": "Can these be removed?", "author": "chaoq0318", "createdAt": "2020-09-25T01:20:50Z", "path": "src/test/java/com/vmware/vip/i18n/LocaleTest.java", "diffHunk": "@@ -105,127 +105,127 @@ public void testGetDisplayNamesByLanguage() throws ParseException {\n         Assert.assertNotNull(resp);\n         localeI18n.getDisplayLanguagesList(\"zh_Hans\");// get data from cache\n     }\n-\n-    @Test\n-    public void testThreadLocale() throws InterruptedException {\n-        Locale localeZhCN = new Locale(\"zh\", \"CN\");\n-        Locale localeZhTW = new Locale(\"zh\", \"TW\");\n-        Locale localeKoKR = new Locale(\"ko\", \"KR\");\n-        Locale localeDeDE = new Locale(\"de\", \"DE\");\n-\n-        LocaleUtility.setLocale(LocaleUtility.defaultLocale);\n-        // cp. check the default locale isn't zh-Hans.\n-        Assert.assertNotEquals(\"Error! Default locale is: \" + locale, localeZhCN, LocaleUtility.getLocale());\n-\n-        // Set locale in current thread\n-        LocaleUtility.setLocale(localeZhCN);\n-\n-        // cp1. check the locale is saved successfully.\n-        Assert.assertEquals(\"Error! Locale isn't set successfully.\", localeZhCN, LocaleUtility.getLocale());\n-\n-        // Create a new sub-thread, and read its initial locale\n-        t = 11;\n-        new Thread(subThreadOne).start();\n-\n-        // cp2. check the locale of sub-thread is same as parent thread\n-        lock.lock();\n-        try {\n-            while (t != 0)\n-                con.await();\n-            Assert.assertEquals(\"Didn't inherit successfully\", LocaleUtility.getLocale(), locale);\n-\n-            // Change locale in sub-thread,\n-            locale = localeZhTW;\n-            t = 12;\n-            con.signal();\n-        } finally {\n-            lock.unlock();\n-        }\n-\n-        // cp3. check parent locale doesn't change\n-        lock.lock();\n-        try {\n-            while (t != 0)\n-                con.await();\n-            Assert.assertEquals(\"Child interfere parent!\", localeZhCN, LocaleUtility.getLocale());\n-\n-            // Change locale in parent thread,\n-            LocaleUtility.setLocale(localeKoKR);\n-            t = 11;\n-            con.signal();\n-        } finally {\n-            lock.unlock();\n-        }\n-\n-        // cp4. check sub-thread locale doesn't change\n-        lock.lock();\n-        try {\n-            while (t != 0)\n-                con.await();\n-            Assert.assertEquals(\"Parent interfere child!\", localeZhTW, locale);\n-        } finally {\n-            lock.unlock();\n-        }\n-\n-        // Launch another sub-thread, change locale in this sub-thread\n-        t = 22;\n-        locale = localeDeDE;\n-        new Thread(subThreadTwo).start();\n-\n-        // cp5. Check first sub-thread locale doesn't change\n-        lock.lock();\n-        try {\n-            while (t != 0)\n-                con.await();\n-            Assert.assertEquals(\"Child interfere child!\", localeZhTW, locale);\n-        } finally {\n-            lock.unlock();\n-        }\n-    }\n-\n-    private Locale    locale       = null;\n-    private Lock      lock         = new ReentrantLock(true);\n-    private Condition con          = lock.newCondition();\n-    private int       t            = 1;\n-\n-    private Runnable  subThreadOne = () -> {\n-                                       while (true) {\n-                                           lock.lock();\n-                                           try {\n-                                               while (!(t >= 10 && t < 20))\n-                                                   con.await();\n-                                               if (t == 11) {\n-                                                   locale = LocaleUtility.getLocale();\n-                                               } else if (t == 12) {\n-                                                   LocaleUtility.setLocale(locale);\n-                                               }\n-                                               t = 0;\n-                                               con.signal();\n-                                           } catch (InterruptedException e) {\n-                                               e.printStackTrace();\n-                                           } finally {\n-                                               lock.unlock();\n-                                           }\n-                                       }\n-\n-                                   };\n-\n-    private Runnable  subThreadTwo = () -> {\n-                                       lock.lock();\n-                                       try {\n-                                           while (!(t >= 20 && t < 30))\n-                                               con.await();\n-                                           if (t == 21) {\n-                                               locale = LocaleUtility.getLocale();\n-                                           } else if (t == 22) {\n-                                               LocaleUtility.setLocale(locale);\n-                                           }\n-                                           t = 11;\n-                                           con.signalAll();\n-                                       } catch (InterruptedException e) {\n-                                           e.printStackTrace();\n-                                       } finally {\n-                                           lock.unlock();\n-                                       }\n-                                   };\n+    \n+//    @Test", "originalCommit": "d7c692b59ef7c5d9ab0efcb1637a087ebee126cb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDcwMjgxOA==", "url": "https://github.com/vmware/singleton/pull/798#discussion_r494702818", "bodyText": "Removed", "author": "Xiaochao8", "createdAt": "2020-09-25T01:54:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY5NDY0Nw=="}], "type": "inlineReview"}, {"oid": "372aefc6264dd0a9a3214676326da83d9871733c", "url": "https://github.com/vmware/singleton/commit/372aefc6264dd0a9a3214676326da83d9871733c", "message": "Remove commented code", "committedDate": "2020-09-25T01:52:55Z", "type": "commit"}, {"oid": "12893454685ea2f8855b0d1c55c44a1a1a9e2851", "url": "https://github.com/vmware/singleton/commit/12893454685ea2f8855b0d1c55c44a1a1a9e2851", "message": "Merge remote-tracking branch 'remotes/Xiaochao8/g11n-java-client-0.4.2-jdk11' into 0.4.2-sonar-jdk11", "committedDate": "2020-09-25T01:53:32Z", "type": "commit"}]}