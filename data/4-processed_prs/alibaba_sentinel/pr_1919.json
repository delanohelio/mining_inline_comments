{"pr_number": 1919, "pr_title": "Support setting flush interval of the metric log via SentinelConfig property", "pr_createdAt": "2020-12-19T09:02:07Z", "pr_url": "https://github.com/alibaba/Sentinel/pull/1919", "timeline": [{"oid": "9d427e560176dfa18da20e0b49e89ac95c7abf50", "url": "https://github.com/alibaba/Sentinel/commit/9d427e560176dfa18da20e0b49e89ac95c7abf50", "message": "Support setting flush interval of the metric log via SentinelConfig property", "committedDate": "2020-12-19T08:54:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTIzMDQyMQ==", "url": "https://github.com/alibaba/Sentinel/pull/1919#discussion_r549230421", "bodyText": "Can we add a metricLogFlushIntervalSec() method in SentinelConfig to resolve the metric flushing interval, and leverage the method here?", "author": "sczyh30", "createdAt": "2020-12-28T06:26:59Z", "path": "sentinel-core/src/main/java/com/alibaba/csp/sentinel/slots/block/flow/FlowRuleManager.java", "diffHunk": "@@ -61,9 +62,42 @@\n     static {\n         flowRules.set(Collections.<String, List<FlowRule>>emptyMap());\n         currentProperty.addListener(LISTENER);\n-        SCHEDULER.scheduleAtFixedRate(new MetricTimerListener(), 0, 1, TimeUnit.SECONDS);\n+        startMetricTimerListener();\n     }\n-\n+    \n+    /**\n+     * <p> Start the MetricTimerListener\n+     * <ol>\n+     *     <li>if the {@link SentinelConfig#METRIC_FLUSH_INTERVAL} more than 0,\n+     * the timer will run with the {@link SentinelConfig#METRIC_FLUSH_INTERVAL} as the rate </li>.\n+     *      <li>if the {@link SentinelConfig#METRIC_FLUSH_INTERVAL} less than 0(include) or value is not valid,\n+     * then means the timer will not be started </li>\n+     * <ol></p>\n+     */\n+    private static void startMetricTimerListener() {\n+        long flushInterval;\n+        String flushIntervalStr = SentinelConfig.getConfig(SentinelConfig.METRIC_FLUSH_INTERVAL);", "originalCommit": "9d427e560176dfa18da20e0b49e89ac95c7abf50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTIzMjQ1NQ==", "url": "https://github.com/alibaba/Sentinel/pull/1919#discussion_r549232455", "bodyText": "@sczyh30 yes, that is more reasonable to put the time valid code into entrance. I will change the code later.", "author": "brotherlu-xcq", "createdAt": "2020-12-28T06:38:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTIzMDQyMQ=="}], "type": "inlineReview"}, {"oid": "88b3db91c63e0d01c2bb9fe0e5592ad86d85d2b5", "url": "https://github.com/alibaba/Sentinel/commit/88b3db91c63e0d01c2bb9fe0e5592ad86d85d2b5", "message": "move the metric flush interval time valid code to SentinelConfig", "committedDate": "2020-12-28T07:28:43Z", "type": "commit"}, {"oid": "69f8894a5634911b6d09faa3e22e5f1fca779c70", "url": "https://github.com/alibaba/Sentinel/commit/69f8894a5634911b6d09faa3e22e5f1fca779c70", "message": "remove constant the prefix in SentinelConfig", "committedDate": "2020-12-28T07:30:04Z", "type": "commit"}]}