{"pr_number": 1678, "pr_title": "add webflux HandlerFunction test cases", "pr_createdAt": "2020-08-19T07:28:08Z", "pr_url": "https://github.com/alibaba/Sentinel/pull/1678", "timeline": [{"oid": "7c60ade8e229120ede88ee62849e60d81f39c84d", "url": "https://github.com/alibaba/Sentinel/commit/7c60ade8e229120ede88ee62849e60d81f39c84d", "message": "add webflux HandlerFunction test cases", "committedDate": "2020-08-19T07:24:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAyODMwMg==", "url": "https://github.com/alibaba/Sentinel/pull/1678#discussion_r476028302", "bodyText": "I don't think this url is configured by  the routerFunction way.\nyes, the test case works fine, but it can not prove the adaptor works well with routerFunction.", "author": "lawulu", "createdAt": "2020-08-25T01:12:25Z", "path": "sentinel-adapter/sentinel-spring-webflux-adapter/src/test/java/com/alibaba/csp/sentinel/adapter/spring/webflux/SentinelWebFluxIntegrationTest.java", "diffHunk": "@@ -71,6 +71,30 @@ public void testWebFluxFilterBasic() throws Exception {\n         assertEquals(1, cn.passQps(), 0.01);\n     }\n \n+    @Test\n+    public void testWebFluxRouterFunction() throws Exception {\n+\n+        String url = \"/router/hello\";", "originalCommit": "7c60ade8e229120ede88ee62849e60d81f39c84d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjA0MTg3NQ==", "url": "https://github.com/alibaba/Sentinel/pull/1678#discussion_r476041875", "bodyText": "PRs are welcomed if there are any unresolved problems.", "author": "sczyh30", "createdAt": "2020-08-25T01:33:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAyODMwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE5MDg5NA==", "url": "https://github.com/alibaba/Sentinel/pull/1678#discussion_r476190894", "bodyText": "Do you mean run a server like this?@lawulu\nHttpHandler httpHandler = RouterFunctions.toHttpHandler(route);\nHttpServlet servlet = new ServletHttpHandlerAdapter(httpHandler);\nTomcat server = new Tomcat();\nContext rootContext = server.addContext(\"\",\n  System.getProperty(\"java.io.tmpdir\"));\nTomcat.addServlet(rootContext, \"servlet\", servlet);  \nrootContext.addServletMapping(\"/\", \"servlet\");\ntomcatServer.start();", "author": "liqiangz", "createdAt": "2020-08-25T05:43:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAyODMwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIwNzIxNg==", "url": "https://github.com/alibaba/Sentinel/pull/1678#discussion_r477207216", "bodyText": "No\uff0cyou can refer to https://docs.spring.io/spring-framework/docs/5.0.0.BUILD-SNAPSHOT/spring-framework-reference/html/web-reactive.html\nThere is an example:\nRouterFunction<ServerResponse> helloWorldRoute = RouterFunctions.route(RequestPredicates.path(\"/hello-world\"), request -> Response.ok().body(fromObject(\"Hello World\"))); \nIn this way, the  filter based on WebFilter does not work. Users should use HandlerFilterFunction instead.\nUnfortunately, there is no ready solution\u3002 @liqiangz", "author": "lawulu", "createdAt": "2020-08-26T10:45:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAyODMwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIxMTY0MQ==", "url": "https://github.com/alibaba/Sentinel/pull/1678#discussion_r477211641", "bodyText": "Could you please provide a demo for this?", "author": "sczyh30", "createdAt": "2020-08-26T10:54:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAyODMwMg=="}], "type": "inlineReview"}]}