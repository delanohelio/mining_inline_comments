{"pr_number": 1825, "pr_title": "[Adapter] Support motan RPC", "pr_createdAt": "2020-10-27T17:27:31Z", "pr_url": "https://github.com/alibaba/Sentinel/pull/1825", "timeline": [{"oid": "d0a1640eedb89846c1a7170a521a8841fcaab96a", "url": "https://github.com/alibaba/Sentinel/commit/d0a1640eedb89846c1a7170a521a8841fcaab96a", "message": "1\u3001support motan rpc\n2\u3001the design is reference dubbo", "committedDate": "2020-10-27T17:17:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyMDIwNw==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519120207", "bodyText": "This filter doesn't seem to work, is the key = MotanConstants.NODE_TYPE_REFERER missing?\nlike SentinelMotanConsumerFilter.", "author": "cdfive", "createdAt": "2020-11-07T06:02:20Z", "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/MotanAppContextFilter.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.filter.Filter;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+import com.weibo.api.motan.rpc.Response;\n+import com.weibo.api.motan.rpc.RpcContext;\n+\n+import java.util.Map;\n+\n+/**\n+ * program: sentinel-parent\n+ * description: ${description}\n+ * author: zxn\n+ * create: 2020-10-28 00:28\n+ **/\n+@SpiMeta(name = \"motanAppContext\")\n+@Activation(sequence = 2)\n+public class MotanAppContextFilter implements Filter {", "originalCommit": "d0a1640eedb89846c1a7170a521a8841fcaab96a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE4NjM3Mg==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519186372", "bodyText": "yes\uff0c I forget to add it", "author": "zhangxn8", "createdAt": "2020-11-07T15:05:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyMDIwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyMTQ5MA==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519121490", "bodyText": "It is suggested to add a space to the right of =, like key = MotanConstants.NODE_TYPE_REFERER, for better format.\nBesides, create date can be removed to unified with other files.", "author": "cdfive", "createdAt": "2020-11-07T06:07:27Z", "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/SentinelMotanConsumerFilter.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.alibaba.csp.sentinel.*;\n+import com.alibaba.csp.sentinel.adapter.motan.config.MotanAdapterGlobalConfig;\n+import com.alibaba.csp.sentinel.log.RecordLog;\n+import com.alibaba.csp.sentinel.slots.block.BlockException;\n+import com.weibo.api.motan.common.MotanConstants;\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.exception.MotanAbstractException;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+import com.weibo.api.motan.rpc.Response;\n+\n+/**\n+ * program: sentinel-parent\n+ * description: ${description}\n+ * author: zxn\n+ * create: 2020-10-28 00:41\n+ **/\n+@Activation(key =MotanConstants.NODE_TYPE_REFERER)\n+@SpiMeta(name = \"sentinelMotanConsumer\")\n+public class SentinelMotanConsumerFilter extends BaseMotanSentinelFilter {", "originalCommit": "d0a1640eedb89846c1a7170a521a8841fcaab96a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyMTkxNw==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519121917", "bodyText": "Should it use MotanAdapterGlobalConfig#getMotanProviderPrefix() here?", "author": "cdfive", "createdAt": "2020-11-07T06:09:10Z", "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/SentinelMotanProviderFilter.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.alibaba.csp.sentinel.*;\n+import com.alibaba.csp.sentinel.adapter.motan.config.MotanAdapterGlobalConfig;\n+import com.alibaba.csp.sentinel.context.ContextUtil;\n+import com.alibaba.csp.sentinel.log.RecordLog;\n+import com.alibaba.csp.sentinel.slots.block.BlockException;\n+import com.weibo.api.motan.common.MotanConstants;\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.exception.MotanAbstractException;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+import com.weibo.api.motan.rpc.Response;\n+\n+/**\n+ * program: sentinel-parent\n+ * description: ${description}\n+ * author: zxn\n+ * create: 2020-10-28 00:44\n+ **/\n+@Activation(key =MotanConstants.NODE_TYPE_SERVICE)\n+@SpiMeta(name = \"sentinelMotanProvider\")\n+public class SentinelMotanProviderFilter extends BaseMotanSentinelFilter {\n+\n+    public SentinelMotanProviderFilter(){\n+        RecordLog.info(\"Sentinel motan provider filter initialized\");\n+    }\n+\n+    @Override\n+    String getMethodName(Caller<?> caller, Request request, String prefix) {\n+        return MotanUtils.getMethodResourceName(caller, request, prefix);\n+    }\n+\n+    @Override\n+    String getInterfaceName(Caller<?> caller, String prefix) {\n+        return MotanUtils.getInterfaceName(caller, prefix);\n+    }\n+\n+    @Override\n+    public Response filter(Caller<?> caller, Request request) {\n+        Entry interfaceEntry = null;\n+        Entry methodEntry = null;\n+        String prefix = \"\";", "originalCommit": "d0a1640eedb89846c1a7170a521a8841fcaab96a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyMjUwMg==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519122502", "bodyText": "The origin is \"\", which doesn't use the application of consumer,  refer to MotanAppContextFilter.", "author": "cdfive", "createdAt": "2020-11-07T06:11:18Z", "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/SentinelMotanProviderFilter.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.alibaba.csp.sentinel.*;\n+import com.alibaba.csp.sentinel.adapter.motan.config.MotanAdapterGlobalConfig;\n+import com.alibaba.csp.sentinel.context.ContextUtil;\n+import com.alibaba.csp.sentinel.log.RecordLog;\n+import com.alibaba.csp.sentinel.slots.block.BlockException;\n+import com.weibo.api.motan.common.MotanConstants;\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.exception.MotanAbstractException;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+import com.weibo.api.motan.rpc.Response;\n+\n+/**\n+ * program: sentinel-parent\n+ * description: ${description}\n+ * author: zxn\n+ * create: 2020-10-28 00:44\n+ **/\n+@Activation(key =MotanConstants.NODE_TYPE_SERVICE)\n+@SpiMeta(name = \"sentinelMotanProvider\")\n+public class SentinelMotanProviderFilter extends BaseMotanSentinelFilter {\n+\n+    public SentinelMotanProviderFilter(){\n+        RecordLog.info(\"Sentinel motan provider filter initialized\");\n+    }\n+\n+    @Override\n+    String getMethodName(Caller<?> caller, Request request, String prefix) {\n+        return MotanUtils.getMethodResourceName(caller, request, prefix);\n+    }\n+\n+    @Override\n+    String getInterfaceName(Caller<?> caller, String prefix) {\n+        return MotanUtils.getInterfaceName(caller, prefix);\n+    }\n+\n+    @Override\n+    public Response filter(Caller<?> caller, Request request) {\n+        Entry interfaceEntry = null;\n+        Entry methodEntry = null;\n+        String prefix = \"\";\n+        String interfaceResourceName = getInterfaceName(caller, prefix);\n+        String methodResourceName = getMethodName(caller, request, prefix);\n+        try {\n+            ContextUtil.enter(methodResourceName, \"\");", "originalCommit": "d0a1640eedb89846c1a7170a521a8841fcaab96a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE4NzQ1OQ==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519187459", "bodyText": "Thank you , is good idea", "author": "zhangxn8", "createdAt": "2020-11-07T15:17:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyMjUwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyMzEzNA==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519123134", "bodyText": "${motan.version} is better.", "author": "cdfive", "createdAt": "2020-11-07T06:12:53Z", "path": "sentinel-demo/sentinel-demo-motan/pom.xml", "diffHunk": "@@ -0,0 +1,72 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <parent>\n+        <artifactId>sentinel-demo</artifactId>\n+        <groupId>com.alibaba.csp</groupId>\n+        <version>1.8.1-SNAPSHOT</version>\n+    </parent>\n+    <modelVersion>4.0.0</modelVersion>\n+    <artifactId>sentinel-demo-motan</artifactId>\n+\n+    <properties>\n+        <motan.version>1.1.8</motan.version>\n+    </properties>\n+\n+    <dependencies>\n+        <dependency>\n+            <groupId>com.alibaba.csp</groupId>\n+            <artifactId>sentinel-motan-adapter</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.alibaba.csp</groupId>\n+            <artifactId>sentinel-transport-simple-http</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.weibo</groupId>\n+            <artifactId>motan-core</artifactId>\n+            <version>1.1.8</version>\n+            <scope>compile</scope>\n+        </dependency>", "originalCommit": "d0a1640eedb89846c1a7170a521a8841fcaab96a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyMzkwMg==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519123902", "bodyText": "Two netty dependency, can motan-transport-netty be removed?", "author": "cdfive", "createdAt": "2020-11-07T06:14:35Z", "path": "sentinel-demo/sentinel-demo-motan/pom.xml", "diffHunk": "@@ -0,0 +1,72 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <parent>\n+        <artifactId>sentinel-demo</artifactId>\n+        <groupId>com.alibaba.csp</groupId>\n+        <version>1.8.1-SNAPSHOT</version>\n+    </parent>\n+    <modelVersion>4.0.0</modelVersion>\n+    <artifactId>sentinel-demo-motan</artifactId>\n+\n+    <properties>\n+        <motan.version>1.1.8</motan.version>\n+    </properties>\n+\n+    <dependencies>\n+        <dependency>\n+            <groupId>com.alibaba.csp</groupId>\n+            <artifactId>sentinel-motan-adapter</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.alibaba.csp</groupId>\n+            <artifactId>sentinel-transport-simple-http</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.weibo</groupId>\n+            <artifactId>motan-core</artifactId>\n+            <version>1.1.8</version>\n+            <scope>compile</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.weibo</groupId>\n+            <artifactId>motan-transport-netty4</artifactId>\n+            <version>${motan.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.weibo</groupId>\n+            <artifactId>motan-transport-netty</artifactId>\n+            <version>${motan.version}</version>\n+        </dependency>", "originalCommit": "d0a1640eedb89846c1a7170a521a8841fcaab96a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE4NzM2NA==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519187364", "bodyText": "When I  was testing have problem so add two netty,  I have remove one at present", "author": "zhangxn8", "createdAt": "2020-11-07T15:16:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyMzkwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyNjQzMg==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519126432", "bodyText": "Since the flow rule is inited, here will throw BlockException, suggest to catch it and print the message to console.\nBigger loop times such as 5000, we can observe with dashboard UI more conveniently.", "author": "cdfive", "createdAt": "2020-11-07T06:20:20Z", "path": "sentinel-demo/sentinel-demo-motan/src/main/java/com/alibaba/csp/sentinel/demo/motan/SentinelMotanConsumerService.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package com.alibaba.csp.sentinel.demo.motan;\n+\n+import com.alibaba.csp.sentinel.demo.motan.service.MotanDemoService;\n+import com.alibaba.csp.sentinel.slots.block.RuleConstant;\n+import com.alibaba.csp.sentinel.slots.block.flow.FlowRule;\n+import com.alibaba.csp.sentinel.slots.block.flow.FlowRuleManager;\n+import com.weibo.api.motan.config.ProtocolConfig;\n+import com.weibo.api.motan.config.RefererConfig;\n+import com.weibo.api.motan.config.RegistryConfig;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * program: sentinel-parent\n+ * description: ${description}\n+ * author: zxn\n+ * create: 2020-10-28 00:57\n+ **/\n+public class SentinelMotanConsumerService {\n+\n+    private static final String INTERFACE_RES_KEY = MotanDemoService.class.getName();\n+    private static final String RES_KEY = INTERFACE_RES_KEY + \":hello(java.lang.String)\";\n+\n+    public static void main(String[] args) {\n+        RefererConfig<MotanDemoService> motanDemoServiceReferer = new RefererConfig<MotanDemoService>();\n+        // \u8bbe\u7f6e\u63a5\u53e3\u53ca\u5b9e\u73b0\u7c7b\n+        motanDemoServiceReferer.setInterface(MotanDemoService.class);\n+        // \u914d\u7f6e\u670d\u52a1\u7684group\u4ee5\u53ca\u7248\u672c\u53f7\n+        motanDemoServiceReferer.setGroup(\"motan-demo-rpc\");\n+        motanDemoServiceReferer.setVersion(\"1.0\");\n+        motanDemoServiceReferer.setRequestTimeout(100000);\n+\n+        // \u914d\u7f6e\u6ce8\u518c\u4e2d\u5fc3\u76f4\u8fde\u8c03\u7528\n+        RegistryConfig registry = new RegistryConfig();\n+\n+        //use direct registry\n+        registry.setRegProtocol(\"direct\");\n+        registry.setAddress(\"127.0.0.1:8002\");\n+\n+        // use ZooKeeper: 2181  or consul:8500 registry\n+//        registry.setRegProtocol(\"consul\");\n+//        registry.setAddress(\"127.0.0.1:8500\");\n+        motanDemoServiceReferer.setRegistry(registry);\n+\n+        // \u914d\u7f6eRPC\u534f\u8bae\n+        ProtocolConfig protocol = new ProtocolConfig();\n+        protocol.setId(\"motan\");\n+        protocol.setName(\"motan\");\n+        motanDemoServiceReferer.setProtocol(protocol);\n+        motanDemoServiceReferer.setDirectUrl(\"localhost:8002\");  // \u6ce8\u518c\u4e2d\u5fc3\u76f4\u8fde\u8c03\u7528\u9700\u6dfb\u52a0\u6b64\u914d\u7f6e\n+\n+        initFlowRule(5, false);\n+\n+        // \u4f7f\u7528\u670d\u52a1\n+        MotanDemoService service = motanDemoServiceReferer.getRef();\n+        for (int i = 0 ;i< 20 ;i++) {\n+            System.out.println(service.hello(\"motan\"));\n+        }", "originalCommit": "d0a1640eedb89846c1a7170a521a8841fcaab96a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyODE3Mg==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519128172", "bodyText": "attachment.getOrDefault use JDK1.8, should it be configured in the pom.xml", "author": "cdfive", "createdAt": "2020-11-07T06:24:11Z", "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/MotanAppContextFilter.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.filter.Filter;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+import com.weibo.api.motan.rpc.Response;\n+import com.weibo.api.motan.rpc.RpcContext;\n+\n+import java.util.Map;\n+\n+/**\n+ * program: sentinel-parent\n+ * description: ${description}\n+ * author: zxn\n+ * create: 2020-10-28 00:28\n+ **/\n+@SpiMeta(name = \"motanAppContext\")\n+@Activation(sequence = 2)\n+public class MotanAppContextFilter implements Filter {\n+\n+    @Override\n+    public Response filter(Caller<?> caller, Request request) {\n+        if (request != null){\n+            Map<String, String> attachment = request.getAttachments();\n+            RpcContext.getContext().setRpcAttachment(\"application\", attachment.getOrDefault(\"application\", \"motan\"));", "originalCommit": "d0a1640eedb89846c1a7170a521a8841fcaab96a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4b06d028c44025df7a5c55556b5faf08e1e302f5", "url": "https://github.com/alibaba/Sentinel/commit/4b06d028c44025df7a5c55556b5faf08e1e302f5", "message": "modify by code reviews", "committedDate": "2020-11-07T14:56:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTM5NjgxNw==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519396817", "bodyText": "ContextUtil.enter(methodResourceName, \"\");  The second parameter is used to identify the caller, refer to SentinelDubboProviderFilter, which get the caller name by DubboUtils#getApplication.\nIt seems that MotanAppContextFilter can be removed, since without it , we can also get the caller application from attachments, by calling request.getAttachments().get(\"application\").", "author": "cdfive", "createdAt": "2020-11-08T13:18:45Z", "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/SentinelMotanProviderFilter.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.alibaba.csp.sentinel.*;\n+import com.alibaba.csp.sentinel.adapter.motan.config.MotanAdapterGlobalConfig;\n+import com.alibaba.csp.sentinel.context.ContextUtil;\n+import com.alibaba.csp.sentinel.log.RecordLog;\n+import com.alibaba.csp.sentinel.slots.block.BlockException;\n+import com.weibo.api.motan.common.MotanConstants;\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.exception.MotanAbstractException;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+import com.weibo.api.motan.rpc.Response;\n+\n+/**\n+ * program: sentinel-parent\n+ * description: provider filter\n+ * author: zhangxn8\n+ **/\n+@Activation(key =MotanConstants.NODE_TYPE_SERVICE)\n+@SpiMeta(name = MotanAdapterGlobalConfig.SENTINEL_MOTAN_PROVIDER)\n+public class SentinelMotanProviderFilter extends BaseMotanSentinelFilter {\n+\n+    public SentinelMotanProviderFilter(){\n+        RecordLog.info(\"Sentinel motan provider filter initialized\");\n+    }\n+\n+    @Override\n+    String getMethodName(Caller<?> caller, Request request, String prefix) {\n+        return MotanUtils.getMethodResourceName(caller, request, prefix);\n+    }\n+\n+    @Override\n+    String getInterfaceName(Caller<?> caller, String prefix) {\n+        return MotanUtils.getInterfaceName(caller, prefix);\n+    }\n+\n+    @Override\n+    public Response filter(Caller<?> caller, Request request) {\n+        Entry interfaceEntry = null;\n+        Entry methodEntry = null;\n+        String prefix = MotanAdapterGlobalConfig.getMotanProviderPrefix();\n+        String interfaceResourceName = getInterfaceName(caller, prefix);\n+        String methodResourceName = getMethodName(caller, request, prefix);\n+        try {\n+            ContextUtil.enter(methodResourceName, \"\");\n+            interfaceEntry = SphU.entry(interfaceResourceName, ResourceTypeConstants.COMMON_RPC, EntryType.IN);\n+            methodEntry = SphU.entry(methodResourceName, ResourceTypeConstants.COMMON_RPC, EntryType.IN,\n+                    request.getArguments());\n+            Response result = caller.call(request);", "originalCommit": "4b06d028c44025df7a5c55556b5faf08e1e302f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQxMzg0OQ==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519413849", "bodyText": "OK, Thank you", "author": "zhangxn8", "createdAt": "2020-11-08T14:24:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTM5NjgxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTM5NzA4Mg==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519397082", "bodyText": "Format the line will be better.", "author": "cdfive", "createdAt": "2020-11-08T13:19:50Z", "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/SentinelMotanProviderFilter.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.alibaba.csp.sentinel.*;\n+import com.alibaba.csp.sentinel.adapter.motan.config.MotanAdapterGlobalConfig;\n+import com.alibaba.csp.sentinel.context.ContextUtil;\n+import com.alibaba.csp.sentinel.log.RecordLog;\n+import com.alibaba.csp.sentinel.slots.block.BlockException;\n+import com.weibo.api.motan.common.MotanConstants;\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.exception.MotanAbstractException;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+import com.weibo.api.motan.rpc.Response;\n+\n+/**\n+ * program: sentinel-parent\n+ * description: provider filter\n+ * author: zhangxn8\n+ **/\n+@Activation(key =MotanConstants.NODE_TYPE_SERVICE)", "originalCommit": "4b06d028c44025df7a5c55556b5faf08e1e302f5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTM5NzU2Mg==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519397562", "bodyText": "Class comment could be corresponding or just removed.", "author": "cdfive", "createdAt": "2020-11-08T13:21:39Z", "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/SentinelMotanProviderFilter.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.alibaba.csp.sentinel.*;\n+import com.alibaba.csp.sentinel.adapter.motan.config.MotanAdapterGlobalConfig;\n+import com.alibaba.csp.sentinel.context.ContextUtil;\n+import com.alibaba.csp.sentinel.log.RecordLog;\n+import com.alibaba.csp.sentinel.slots.block.BlockException;\n+import com.weibo.api.motan.common.MotanConstants;\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.exception.MotanAbstractException;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+import com.weibo.api.motan.rpc.Response;\n+\n+/**\n+ * program: sentinel-parent", "originalCommit": "4b06d028c44025df7a5c55556b5faf08e1e302f5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "66b97aa4e092b1e725f2abc133eee86b3fa22944", "url": "https://github.com/alibaba/Sentinel/commit/66b97aa4e092b1e725f2abc133eee86b3fa22944", "message": "1\u3001remove  MotanAppContextFilter\n2\u3001format comment", "committedDate": "2020-11-08T14:22:20Z", "type": "commit"}, {"oid": "aa713e503190337511254aa0089914c4ad07d7d1", "url": "https://github.com/alibaba/Sentinel/commit/aa713e503190337511254aa0089914c4ad07d7d1", "message": "1\u3001format comment", "committedDate": "2020-11-08T14:27:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI0MTE3Mg==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r520241172", "bodyText": "Could you please prepend the license header here?", "author": "sczyh30", "createdAt": "2020-11-10T02:13:30Z", "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/BaseMotanSentinelFilter.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.alibaba.csp.sentinel.adapter.motan;", "originalCommit": "aa713e503190337511254aa0089914c4ad07d7d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYzMjUwNw==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r520632507", "bodyText": "what lisence, I didn't see it in other files", "author": "zhangxn8", "createdAt": "2020-11-10T15:04:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI0MTE3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDY0MzczNg==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r520643736", "bodyText": "Do you help me to add this?", "author": "zhangxn8", "createdAt": "2020-11-10T15:18:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI0MTE3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI2MTU4NQ==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r521261585", "bodyText": "Refer to\ncom.alibaba.csp.sentinel.context.Context\ncom.alibaba.csp.sentinel.adapter.dubbo.SentinelDubboProviderFilter and other classes.\nadd lisence header at the top of class file:\n/*\n * Copyright 1999-2020 Alibaba Group Holding Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage xxx;\n...", "author": "cdfive", "createdAt": "2020-11-11T10:28:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI0MTE3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM5NjgyMA==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r521396820", "bodyText": "ok  thank you", "author": "zhangxn8", "createdAt": "2020-11-11T14:30:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI0MTE3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI0MTM1Ng==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r520241356", "bodyText": "Could you please replace it with the standard javadoc format here? (@author xxx)", "author": "sczyh30", "createdAt": "2020-11-10T02:14:07Z", "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/BaseMotanSentinelFilter.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.alibaba.csp.sentinel.adapter.motan.config.MotanAdapterGlobalConfig;\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.filter.Filter;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+\n+/**\n+ * author: zhangxn8", "originalCommit": "aa713e503190337511254aa0089914c4ad07d7d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYwMjk2OA==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r520602968", "bodyText": "ok thank you", "author": "zhangxn8", "createdAt": "2020-11-10T14:27:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI0MTM1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI0MTg2MQ==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r520241861", "bodyText": "Why this class is needed? Actually the implementation of the two methods is in MotanUtils.", "author": "sczyh30", "createdAt": "2020-11-10T02:15:41Z", "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/BaseMotanSentinelFilter.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.alibaba.csp.sentinel.adapter.motan.config.MotanAdapterGlobalConfig;\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.filter.Filter;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+\n+/**\n+ * author: zhangxn8\n+ */\n+@SpiMeta(name = MotanAdapterGlobalConfig.BASE_SENTINEL_MOTAN_FILTER)\n+@Activation(sequence = 1)\n+public abstract class BaseMotanSentinelFilter implements Filter {", "originalCommit": "aa713e503190337511254aa0089914c4ad07d7d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYwMjY5Ng==", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r520602696", "bodyText": "ok,  I also think is have a little redundance", "author": "zhangxn8", "createdAt": "2020-11-10T14:26:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI0MTg2MQ=="}], "type": "inlineReview"}, {"oid": "6b0eac6e97a755ee341bd89fdc4f354310d714a3", "url": "https://github.com/alibaba/Sentinel/commit/6b0eac6e97a755ee341bd89fdc4f354310d714a3", "message": "1\u3001Remove BaseMotanSentinelFilter use motanutils get resource\n2\u3001format comment", "committedDate": "2020-11-10T15:15:58Z", "type": "commit"}, {"oid": "7d6d30c02b6e74cfea7cffc1619d2c93f1ccef04", "url": "https://github.com/alibaba/Sentinel/commit/7d6d30c02b6e74cfea7cffc1619d2c93f1ccef04", "message": "add licenses", "committedDate": "2020-11-11T14:24:55Z", "type": "commit"}]}