{"pr_number": 1353, "pr_title": "Fixes exit context when request is blocked in springwebmvc adaptor", "pr_createdAt": "2020-03-22T03:35:54Z", "pr_url": "https://github.com/alibaba/Sentinel/pull/1353", "timeline": [{"oid": "e8b297839cf7ed58515ee590a33488ba0e6a5a47", "url": "https://github.com/alibaba/Sentinel/commit/e8b297839cf7ed58515ee590a33488ba0e6a5a47", "message": "Add \"web-context-unify\" configuration to support \"chain\" relation flow strategy in Spring webmvc adapter.", "committedDate": "2020-03-09T16:10:25Z", "type": "commit"}, {"oid": "43ecd462fbd9f137a4364db35f5c931d32fd6793", "url": "https://github.com/alibaba/Sentinel/commit/43ecd462fbd9f137a4364db35f5c931d32fd6793", "message": "Merge remote-tracking branch 'Sentinel/master'\n\n# Conflicts:\n#\tsentinel-adapter/sentinel-spring-webmvc-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/spring/webmvc/config/SentinelWebMvcConfig.java\n#\tsentinel-demo/sentinel-demo-spring-webmvc/src/main/java/com/alibaba/csp/sentinel/demo/spring/webmvc/config/InterceptorConfig.java", "committedDate": "2020-03-14T14:35:44Z", "type": "commit"}, {"oid": "f2286e0b1a706ee0fff40e073af8e9a68f1aac75", "url": "https://github.com/alibaba/Sentinel/commit/f2286e0b1a706ee0fff40e073af8e9a68f1aac75", "message": "Merge remote-tracking branch 'Sentinel/master'", "committedDate": "2020-03-18T14:56:39Z", "type": "commit"}, {"oid": "1fbb10750c5c9e63b4b4978d71e65c1385cade33", "url": "https://github.com/alibaba/Sentinel/commit/1fbb10750c5c9e63b4b4978d71e65c1385cade33", "message": "Merge remote-tracking branch 'Sentinel/master'", "committedDate": "2020-03-22T02:56:46Z", "type": "commit"}, {"oid": "65ff6761162a6473a8cede311c1a2216f469be66", "url": "https://github.com/alibaba/Sentinel/commit/65ff6761162a6473a8cede311c1a2216f469be66", "message": "Exit context if request is blocked and improve test case.", "committedDate": "2020-03-22T03:20:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIyOTY1OA==", "url": "https://github.com/alibaba/Sentinel/pull/1353#discussion_r396229658", "bodyText": "Maybe a try-catch here is better? Users may need the context in the block handler.", "author": "sczyh30", "createdAt": "2020-03-23T06:11:26Z", "path": "sentinel-adapter/sentinel-spring-webmvc-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/spring/webmvc/AbstractSentinelInterceptor.java", "diffHunk": "@@ -67,6 +67,7 @@ public boolean preHandle(HttpServletRequest request, HttpServletResponse respons\n             }\n             return true;\n         } catch (BlockException e) {\n+            ContextUtil.exit();", "originalCommit": "65ff6761162a6473a8cede311c1a2216f469be66", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjI1MTYzMw==", "url": "https://github.com/alibaba/Sentinel/pull/1353#discussion_r396251633", "bodyText": "Good idea, change to try-finally, which makes same effect as catch the Exeception of handleBlockException method and rethrow it, and it's suitable and concise here, please check.", "author": "cdfive", "createdAt": "2020-03-23T07:26:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIyOTY1OA=="}], "type": "inlineReview"}, {"oid": "84dfe5e72f2c07af85787825b041d66b7b4a433c", "url": "https://github.com/alibaba/Sentinel/commit/84dfe5e72f2c07af85787825b041d66b7b4a433c", "message": "Using try finally block, since user may need the context in the block handler", "committedDate": "2020-03-23T07:08:28Z", "type": "commit"}]}