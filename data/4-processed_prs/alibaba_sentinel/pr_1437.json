{"pr_number": 1437, "pr_title": "Update resolving logic of project name and polish SentinelConfig", "pr_createdAt": "2020-04-26T13:56:52Z", "pr_url": "https://github.com/alibaba/Sentinel/pull/1437", "timeline": [{"oid": "85354a30acb97d36d279695ce59cadf70718cbd5", "url": "https://github.com/alibaba/Sentinel/commit/85354a30acb97d36d279695ce59cadf70718cbd5", "message": "Update resolving logic of project name and polish SentinelConfig\n\nSigned-off-by: Eric Zhao <sczyh16@gmail.com>", "committedDate": "2020-04-26T13:53:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU0NDMxOQ==", "url": "https://github.com/alibaba/Sentinel/pull/1437#discussion_r415544319", "bodyText": "Hhh, so now the max RT is 5000, and not the classic value 4900?", "author": "cdfive", "createdAt": "2020-04-27T06:29:15Z", "path": "sentinel-core/src/main/java/com/alibaba/csp/sentinel/config/SentinelConfig.java", "diffHunk": "@@ -42,37 +42,33 @@\n     public static final int APP_TYPE_COMMON = 0;\n \n     private static final Map<String, String> props = new ConcurrentHashMap<>();\n+\n     private static int appType = APP_TYPE_COMMON;\n+    private static String appName = \"\";\n \n-    public static final String APP_TYPE = \"csp.sentinel.app.type\";\n+    public static final String PROJECT_NAME_PROP_KEY = \"project.name\";\n+    public static final String APP_NAME_PROP_KEY = \"csp.sentinel.app.name\";\n+    public static final String APP_TYPE_PROP_KEY = \"csp.sentinel.app.type\";\n     public static final String CHARSET = \"csp.sentinel.charset\";\n     public static final String SINGLE_METRIC_FILE_SIZE = \"csp.sentinel.metric.file.single.size\";\n     public static final String TOTAL_METRIC_FILE_COUNT = \"csp.sentinel.metric.file.total.count\";\n     public static final String COLD_FACTOR = \"csp.sentinel.flow.cold.factor\";\n     public static final String STATISTIC_MAX_RT = \"csp.sentinel.statistic.max.rt\";\n     public static final String SPI_CLASSLOADER = \"csp.sentinel.spi.classloader\";\n \n-    static final String DEFAULT_CHARSET = \"UTF-8\";\n-    static final long DEFAULT_SINGLE_METRIC_FILE_SIZE = 1024 * 1024 * 50;\n-    static final int DEFAULT_TOTAL_METRIC_FILE_COUNT = 6;\n-    static final int DEFAULT_COLD_FACTOR = 3;\n-\n-    private static String appName = \"\";\n-    public static final String APP_NAME = \"project.name\";\n-    public static final String SUN_JAVA_COMMAND = \"sun.java.command\";\n-    private static final String JAR_SUFFIX_LOWER = \".jar\";\n-    private static final String JAR_SUFFIX_UPPER = \".JAR\";\n-\n-    public static final int DEFAULT_STATISTIC_MAX_RT = 4900;\n+    public static final String DEFAULT_CHARSET = \"UTF-8\";\n+    public static final long DEFAULT_SINGLE_METRIC_FILE_SIZE = 1024 * 1024 * 50;\n+    public static final int DEFAULT_TOTAL_METRIC_FILE_COUNT = 6;\n+    public static final int DEFAULT_COLD_FACTOR = 3;\n+    public static final int DEFAULT_STATISTIC_MAX_RT = 5000;", "originalCommit": "85354a30acb97d36d279695ce59cadf70718cbd5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU1MzY1NQ==", "url": "https://github.com/alibaba/Sentinel/pull/1437#discussion_r415553655", "bodyText": "The magic 4900 often makes users confusing, so I've changed it to 5000. The attribute might be deprecated in future versions.", "author": "sczyh30", "createdAt": "2020-04-27T06:48:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU0NDMxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU1MDY0NQ==", "url": "https://github.com/alibaba/Sentinel/pull/1437#discussion_r415550645", "bodyText": "The log info doesn't has prefix [SentinelConfig] like Line#71, and Line#71 move to inside resolveAppType method looks better. It's okay I think and we can do optimize them in the future.", "author": "cdfive", "createdAt": "2020-04-27T06:42:30Z", "path": "sentinel-core/src/main/java/com/alibaba/csp/sentinel/config/SentinelConfig.java", "diffHunk": "@@ -242,32 +237,54 @@ public static int statisticMaxRt() {\n      * </li>\n      * </ol>\n      */\n-    public static void resolveAppName() {\n-\n-        if (props.get(APP_NAME) != null) {\n-            appName = props.get(APP_NAME);\n+    private static void resolveAppName() {\n+        // Priority: system env -> csp.sentinel.app.name -> project.name -> main class (or jar) name\n+        String envKey = toEnvKey(APP_NAME_PROP_KEY);\n+        String n = System.getenv(envKey);\n+        if (!StringUtil.isBlank(n)) {\n+            appName = n;\n+            RecordLog.info(\"App name resolved from system env {}: {}\", envKey, appName);", "originalCommit": "85354a30acb97d36d279695ce59cadf70718cbd5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU1MzA5Mg==", "url": "https://github.com/alibaba/Sentinel/pull/1437#discussion_r415553092", "bodyText": "The log info doesn't has prefix [SentinelConfig] like Line#71\n\nActually prefix is not strictly required if the log content is concrete enough :)\n\nLine#71 move to inside resolveAppType method looks better. It's okay I think and we can do optimize them in the future.\n\nGood idea. We may improve this later.", "author": "sczyh30", "createdAt": "2020-04-27T06:47:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU1MDY0NQ=="}], "type": "inlineReview"}]}