{"pr_number": 557, "pr_title": "Oc 1073 esm 165 documentation", "pr_createdAt": "2020-10-29T13:47:13Z", "pr_url": "https://github.com/opfab/operatorfabric-core/pull/557", "timeline": [{"oid": "b3f272c363ab989e03f7019dc9de35fe0a056e7b", "url": "https://github.com/opfab/operatorfabric-core/commit/b3f272c363ab989e03f7019dc9de35fe0a056e7b", "message": "Added inital Kafka documentation", "committedDate": "2020-10-28T13:11:56Z", "type": "commit"}, {"oid": "b18bde1fa3ac2ca7434ed15e7f28c1436e3152cb", "url": "https://github.com/opfab/operatorfabric-core/commit/b18bde1fa3ac2ca7434ed15e7f28c1436e3152cb", "message": "Fixed unsupported asciidoc feature", "committedDate": "2020-10-28T13:18:35Z", "type": "commit"}, {"oid": "ecb251c5f8bbc7260617d4f5bbe11e5d50072dac", "url": "https://github.com/opfab/operatorfabric-core/commit/ecb251c5f8bbc7260617d4f5bbe11e5d50072dac", "message": "More documentation", "committedDate": "2020-10-28T13:56:41Z", "type": "commit"}, {"oid": "7587804925811fe9bc2a630147e9a3d8448a115a", "url": "https://github.com/opfab/operatorfabric-core/commit/7587804925811fe9bc2a630147e9a3d8448a115a", "message": "Added response cards doc", "committedDate": "2020-10-28T14:17:50Z", "type": "commit"}, {"oid": "ec8971e4c29badeba3ee957b70ed4f099e1593db", "url": "https://github.com/opfab/operatorfabric-core/commit/ec8971e4c29badeba3ee957b70ed4f099e1593db", "message": "Updated example card", "committedDate": "2020-10-28T14:59:02Z", "type": "commit"}, {"oid": "15209c20fa12ba49e4f18d771500ed9eda1669ff", "url": "https://github.com/opfab/operatorfabric-core/commit/15209c20fa12ba49e4f18d771500ed9eda1669ff", "message": "More documentation", "committedDate": "2020-10-29T13:36:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc5NjgxMA==", "url": "https://github.com/opfab/operatorfabric-core/pull/557#discussion_r515796810", "bodyText": "Er is ook een default topic naam. Het enige wat je hoeft te doen om Kafka te enabelen is de property spring.kafka.consumer.group_id een waarde te geven. Hier kan je een willekeurige naam opgeven", "author": "sadema", "createdAt": "2020-11-02T08:07:43Z", "path": "src/docs/asciidoc/deployment/configuration/configuration.adoc", "diffHunk": "@@ -136,3 +141,23 @@ db.archivedCards.createIndex( { \"publishDate\": 1 }, { expireAfterSeconds: 864000\n IMPORTANT: You cannot use createIndex() to change the value of expireAfterSeconds of an existing index.\n Instead use the link:https://docs.mongodb.com/manual/reference/command/collMod/#dbcmd.collMod[collMod] database command in conjunction with the index collection flag. Otherwise, to\n change the value of the option of an existing index, you must drop the index first and recreate.\n+\n+== OperatorFabric Kafka configuration\n+\n+Next to publishing cards to OperatorFabric using the REST API, OperatorFabric also supports publishing cards via a Kafka Topic. In the default configuration Kafka is disabled.\n+To enable Kafka you need to set the topic name for which the Kafka consumer can consume messages. You can do this", "originalCommit": "15209c20fa12ba49e4f18d771500ed9eda1669ff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTkwMDEyMA==", "url": "https://github.com/opfab/operatorfabric-core/pull/557#discussion_r515900120", "bodyText": "Yep. Foutje..", "author": "JeroenGommans", "createdAt": "2020-11-02T11:10:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc5NjgxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgwMTMwMA==", "url": "https://github.com/opfab/operatorfabric-core/pull/557#discussion_r515801300", "bodyText": "Er wordt uitgegaan van dat de brokers draaien op PLAINTEXT://127.0.0.1:9092 en dat er een schema registry draait op http://127.0.0.1:8081", "author": "sadema", "createdAt": "2020-11-02T08:17:43Z", "path": "src/docs/asciidoc/dev_env/kafka.adoc", "diffHunk": "@@ -0,0 +1,112 @@\n+// Copyright (c) 2018-2020 RTE (http://www.rte-france.com)\n+// See AUTHORS.txt\n+// This document is subject to the terms of the Creative Commons Attribution 4.0 International license.\n+// If a copy of the license was not distributed with this\n+// file, You can obtain one at https://creativecommons.org/licenses/by/4.0/.\n+// SPDX-License-Identifier: CC-BY-4.0\n+\n+:kafka_schema: https://docs.confluent.io/current/schema-registry/index.html\n+:confluent: https://www.confluent.io/\n+:spring_kafka_doc: https://docs.spring.io/spring-kafka/reference/html/\n+\n+= Kafka Implementation\n+\n+Next to publishing cards to OperatorFabric using the REST API, OperatorFabric also supports publishing cards via a Kafka Topic. In the default configuration Kafka is disabled.\n+\n+\n+== Enabling Kafka\n+\n+To enable Kafka support you need to set the `kafka.consumer.group_id property` in the cards-publication yml file:\n+[source,yaml]\n+----\n+  kafka:\n+    consumer:\n+      group-id: opfab-command\n+----\n+\n+Alternatively you can set the group id in the `config/docker/kafka-env.properties` file:\n+[source, shell]\n+----\n+SPRING_KAFKA_CONSUMER_GROUP_ID=opfab-command\n+----\n+", "originalCommit": "15209c20fa12ba49e4f18d771500ed9eda1669ff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk0NTk3MA==", "url": "https://github.com/opfab/operatorfabric-core/pull/557#discussion_r515945970", "bodyText": "Check!. Heb nu ook spring.kafka.producer.bootstrap-servers  meegenomen in de settings.", "author": "JeroenGommans", "createdAt": "2020-11-02T12:44:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgwMTMwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgwMjc1MQ==", "url": "https://github.com/opfab/operatorfabric-core/pull/557#discussion_r515802751", "bodyText": "Ik zou hier alleen zeggen hoe je de deserizalizer configureert wanneer je geen schemaregistry wilt gebruiken", "author": "sadema", "createdAt": "2020-11-02T08:20:44Z", "path": "src/docs/asciidoc/dev_env/kafka.adoc", "diffHunk": "@@ -0,0 +1,112 @@\n+// Copyright (c) 2018-2020 RTE (http://www.rte-france.com)\n+// See AUTHORS.txt\n+// This document is subject to the terms of the Creative Commons Attribution 4.0 International license.\n+// If a copy of the license was not distributed with this\n+// file, You can obtain one at https://creativecommons.org/licenses/by/4.0/.\n+// SPDX-License-Identifier: CC-BY-4.0\n+\n+:kafka_schema: https://docs.confluent.io/current/schema-registry/index.html\n+:confluent: https://www.confluent.io/\n+:spring_kafka_doc: https://docs.spring.io/spring-kafka/reference/html/\n+\n+= Kafka Implementation\n+\n+Next to publishing cards to OperatorFabric using the REST API, OperatorFabric also supports publishing cards via a Kafka Topic. In the default configuration Kafka is disabled.\n+\n+\n+== Enabling Kafka\n+\n+To enable Kafka support you need to set the `kafka.consumer.group_id property` in the cards-publication yml file:\n+[source,yaml]\n+----\n+  kafka:\n+    consumer:\n+      group-id: opfab-command\n+----\n+\n+Alternatively you can set the group id in the `config/docker/kafka-env.properties` file:\n+[source, shell]\n+----\n+SPRING_KAFKA_CONSUMER_GROUP_ID=opfab-command\n+----\n+\n+Make sure you also set the registry to either an empty string (`\"\"`) or to the server providing the schema registry service.\n+See link:{kafka_schema}[Schema management] for detailed information on using and benefits of a schema registry.\n+\n+== OperatorFabric Kafka source code\n+== Listener / deserializer\n+Most of the OperatorFabric Kafka implementation can be found at\n+\n+`org.lfenergy.operatorfabric.cards.publication.kafka`:: for\n+the implementation of the deserializers and mapping of Kafka topics to OperatorFabric cards and\n+`org.lfenergy.operatorfabric.autoconfigure.kafka` ::\n+for the various Kafka configuration options.\n+\n+=== Kafka OperatorFabric AVRO schema\n+The AVRO schema, the byte format in which messages are transffered using Kafka topics, can be found at `client/src/main/avro`.\n+Message are wrapped in a the CardCommand object before being sent to a Kafka topic.\n+This object is an almost one-to-one mapping of the OperatorFabric card, see also <<card_structure>>. The exceptions are  `Process` and\n+`Process Instance Identifier`, which are moved to the top-level CardCommand.\n+\n+\n+== Configure Kafka\n+=== Setting a new deserializer\n+By default, OperatorFabric uses the  `io.confluent.kafka.serializers.KafkaAvroDeserializer` from link:{confluent}[Confluent]. However, you can write your own\n+deserializer. An example deserializer, which ignores the schema registry, is included.", "originalCommit": "15209c20fa12ba49e4f18d771500ed9eda1669ff", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "86a1323d0e446802ac249c1b2c7caa81c61f5884", "url": "https://github.com/opfab/operatorfabric-core/commit/86a1323d0e446802ac249c1b2c7caa81c61f5884", "message": "Updates after comments from Sjoerd", "committedDate": "2020-11-02T12:56:30Z", "type": "commit"}]}