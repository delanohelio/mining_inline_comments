{"pr_number": 520, "pr_title": "[OC-1126] Add field userRecipients and groupRecipients when posting a card", "pr_createdAt": "2020-10-12T10:37:46Z", "pr_url": "https://github.com/opfab/operatorfabric-core/pull/520", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM1MDIzMA==", "url": "https://github.com/opfab/operatorfabric-core/pull/520#discussion_r503350230", "bodyText": "not \"will be\" but  \"is deprecated\"", "author": "freddidierRTE", "createdAt": "2020-10-12T14:52:25Z", "path": "src/docs/asciidoc/reference_doc/card_examples.adoc", "diffHunk": "@@ -124,31 +115,32 @@ If this card need to be viewed by a user who is not in the `TSO1` group, it's po\n definition of the recipient. If the `tso2-operator` needs to see also this card, the recipient definition could be(the following code details only the recipient part):\n \n ....\n-\"recipient\":{ \n-\t\"type\":\"UNION\",\n-\t\"recipients\":[\n-\t\t{ \"type\": \"GROUP\", \"identity\":\"TSO1\"},\n-\t\t{ \"type\": \"USER\", \"identity\":\"tso2-operator\"}\n-\t\t]\n-\t}\n+\"groupRecipients\": [\"TSO1\"],\n+\"userRecipients\": [\"tso2-operator\"]\n ....\n \n+\n So here, all the users of the `TSO1` group will receive the `INFORMATION` as should the `tos2-operator` user.\n \n Another example, if a card is destined to the operators of `TSO1` and `TSO2` and needs to be also seen by the `admin`, the recipient configuration looks like:\n \n ....\n-\"recipient\":{\"type\":\"UNION\",\n-\t\"recipients\":[\n-\t\t{\"type\":\"GROUP\",\"identity\":\"TSO1\"},\n-\t\t{\"type\":\"GROUP\",\"identity\":\"TSO2\"},\n-\t\t{\"type\":\"USER\",\"identity\":\"admin\"}\n-\t\t]\n-\t}\n+\"groupRecipients\": [\"TSO1\", \"TSO2\"],\n+\"userRecipients\": [\"admin\"]\n ....\n \n \n+There is and alternative way to declare recipients of card, this syntax is more complex and will be deprecated:", "originalCommit": "fe803915f6ad351b996e74838df7c2223c6fcded", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM2MDM0Mw==", "url": "https://github.com/opfab/operatorfabric-core/pull/520#discussion_r503360343", "bodyText": "Change the warning text to :\n\"Use of recipient field is deprecated. Please use usersRecipients and groupsRecipients fields (See documentation)\"", "author": "freddidierRTE", "createdAt": "2020-10-12T15:08:25Z", "path": "services/core/cards-publication/src/main/java/org/lfenergy/operatorfabric/cards/publication/services/RecipientProcessor.java", "diffHunk": "@@ -38,8 +41,21 @@\n      * @return computed recipient that were affected to card\n      */\n     public ComputedRecipient processAll(CardPublicationData card) {\n-        Recipient recipient = card.getRecipient();\n-        ComputedRecipient computedRecipient = processAll(recipient);\n+        ComputedRecipient computedRecipient;\n+        if ((card.getUserRecipients() != null && !card.getUserRecipients().isEmpty())\n+                        || (card.getGroupRecipients() != null && !card.getGroupRecipients().isEmpty())) {\n+            ComputedRecipient.BuilderEncapsulator result = ComputedRecipient.encapsulatedBuilder();\n+            ComputedRecipient.ComputedRecipientBuilder builder = result.builder();\n+\n+            builder.users(card.getUserRecipients() == null ? Collections.emptyList() : card.getUserRecipients());\n+            builder.groups(card.getGroupRecipients() == null ? Collections.emptyList() : card.getGroupRecipients());\n+            computedRecipient = builder.build();\n+        } else {\n+            log.warn(\"Using deprecated recipient field\");", "originalCommit": "fe803915f6ad351b996e74838df7c2223c6fcded", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fab44f882dede33eee44bd76ad9aebb9c137f1ff", "url": "https://github.com/opfab/operatorfabric-core/commit/fab44f882dede33eee44bd76ad9aebb9c137f1ff", "message": "[OC-1126] Add field userRecipients and groupRecipients when posting a card", "committedDate": "2020-10-13T09:26:21Z", "type": "forcePushed"}, {"oid": "13d069062811914a8bc52ce8bcfe8fbf982407db", "url": "https://github.com/opfab/operatorfabric-core/commit/13d069062811914a8bc52ce8bcfe8fbf982407db", "message": "[OC-1126] Add field userRecipients and groupRecipients when posting a card", "committedDate": "2020-10-13T12:49:16Z", "type": "commit"}, {"oid": "13d069062811914a8bc52ce8bcfe8fbf982407db", "url": "https://github.com/opfab/operatorfabric-core/commit/13d069062811914a8bc52ce8bcfe8fbf982407db", "message": "[OC-1126] Add field userRecipients and groupRecipients when posting a card", "committedDate": "2020-10-13T12:49:16Z", "type": "forcePushed"}]}