{"pr_number": 467, "pr_title": "[OC-1025] : complete users admin module", "pr_createdAt": "2020-09-10T15:58:36Z", "pr_url": "https://github.com/opfab/operatorfabric-core/pull/467", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk4MjAwOQ==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r486982009", "bodyText": "We have in import three llib : ngx-bootstrap / bootstrap / ng_bootstrap do we nedd the three ?\nhttps://stackoverflow.com/questions/43758400/what-is-the-difference-between-ng-bootstrap-and-ngx-bootstrap", "author": "freddidierRTE", "createdAt": "2020-09-11T11:25:43Z", "path": "ui/main/package.json", "diffHunk": "@@ -38,17 +38,19 @@\n     \"@types/jwt-decode\": \"^2.2.1\",\n     \"angular-oauth2-oidc\": \"^8.0.4\",\n     \"angularx-flatpickr\": \"^6.3.1\",\n-    \"bootstrap\": \"^4.5.0\",\n+    \"bootstrap\": \"^4.5.2\",\n     \"core-js\": \"^2.6.3\",\n     \"flatpickr\": \"^4.6.3\",\n     \"guid-typescript\": \"^1.0.9\",\n     \"handlebars\": \"^4.7.6\",\n     \"jwt-decode\": \"^2.2.0\",\n-    \"lodash\": \"^4.17.15\",\n+    \"lodash\": \"^4.17.20\",\n     \"moment\": \"^2.26.0\",\n     \"moment-timezone\": \"^0.5.31\",\n     \"ng-event-source\": \"^1.0.14\",\n+    \"ng2-table\": \"^1.3.2\",\n     \"ngrx-router\": \"^2.0.1\",\n+    \"ngx-bootstrap\": \"^5.6.1\",", "originalCommit": "fd5baf91ca21acbb123ba878bf2c84c8f2f9dad4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDkxNTg5Nw==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r490915897", "bodyText": "ngx-bootstrap is required for pagination use, ng-bootstra is also used , should we analyse this in seperate task ?", "author": "bendaoudmba", "createdAt": "2020-09-18T12:31:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk4MjAwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk4NDQyNQ==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r486984425", "bodyText": "Do we the rooting module as we have no specific root ?", "author": "freddidierRTE", "createdAt": "2020-09-11T11:30:56Z", "path": "ui/main/src/app/modules/admin/admin-rooting.module.ts", "diffHunk": "@@ -0,0 +1,44 @@\n+/* Copyright (c) 2018-2020, RTE (http://www.rte-france.com)\n+ * See AUTHORS.txt\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ * SPDX-License-Identifier: MPL-2.0\n+ * This file is part of the OperatorFabric project.\n+ */\n+\n+\n+\n+import {NgModule} from '@angular/core';\n+import {RouterModule, Routes} from '@angular/router';\n+import { AdminComponent } from './admin.component';\n+import { OfUsersTableComponent } from './components/ngtable/users/ofuserstable.component';\n+import { OfGroupsTableComponent } from './components/ngtable/groups/of-groups-table/of-groups-table.component';\n+import { OfEntitiesTableComponent } from './components/ngtable/entities/of-entities-table/of-entities-table.component';\n+\n+const routes: Routes = [\n+    {\n+        path: '**',\n+        component: AdminComponent\n+          //  ,children: [\n+          //    {\n+          //               path: 'users',\n+          //               component: AdminComponent,\n+          //    },\n+          //    {\n+          //               path: 'groups',\n+          //               component: AdminComponent,\n+          //    },\n+          //   // {\n+          //   //             path: 'entities',\n+          //   //             component: AdminComponent,\n+          //   //  }\n+        // ]\n+    }\n+];\n+\n+@NgModule({\n+    imports: [RouterModule.forChild(routes)],\n+    exports: [RouterModule]\n+})\n+export class AdminRoutingModule { }", "originalCommit": "fd5baf91ca21acbb123ba878bf2c84c8f2f9dad4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDgxODEyMw==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r490818123", "bodyText": "for the moment, we have only /admin==>AdminComponent, but the module should evolve to have more rooting rule in the future", "author": "bendaoudmba", "createdAt": "2020-09-18T09:23:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk4NDQyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk4NjkzMw==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r486986933", "bodyText": "Remove this unused variable", "author": "freddidierRTE", "createdAt": "2020-09-11T11:36:32Z", "path": "ui/main/src/app/services/authentication/authentication.service.ts", "diffHunk": "@@ -61,6 +63,7 @@ export class AuthenticationService {\n     private mode: string;\n     private authModeHandler: AuthenticationModeHandler;\n     private implicitConf = implicitAuthenticationConfigFallback;\n+    private authenticatedUser: User;", "originalCommit": "fd5baf91ca21acbb123ba878bf2c84c8f2f9dad4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk4ODU1OQ==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r486988559", "bodyText": "groupService unused , remove it", "author": "freddidierRTE", "createdAt": "2020-09-11T11:40:17Z", "path": "ui/main/src/app/services/user.service.ts", "diffHunk": "@@ -8,59 +8,87 @@\n  */\n \n \n-import {Injectable} from '@angular/core';\n-import {environment} from '@env/environment';\n-import {Observable,Subject} from 'rxjs';\n-import {Entity, User} from '@ofModel/user.model';\n-import {UserWithPerimeters} from '@ofModel/userWithPerimeters.model';\n-import {HttpClient} from '@angular/common/http';\n-import {takeUntil} from 'rxjs/operators';\n+import { Injectable } from '@angular/core';\n+import { environment } from '@env/environment';\n+import { Observable, Subject } from 'rxjs';\n+import { Entity, User } from '@ofModel/user.model';\n+import { UserWithPerimeters } from '@ofModel/userWithPerimeters.model';\n+import { HttpClient } from '@angular/common/http';\n+import { takeUntil } from 'rxjs/operators';\n+import { CrudService } from \"./crud-service\";\n+import { GroupsService } from './groups.service';\n \n @Injectable()\n-export class UserService {\n-\n-    readonly userUrl: string;\n-    private _userWithPerimeters: UserWithPerimeters;\n-    private ngUnsubscribe = new Subject<void>();\n-\n-    /**\n-     * @constructor\n-     * @param httpClient - Angular build-in\n-     */\n-    constructor(private httpClient: HttpClient) {\n-        this.userUrl = `${environment.urls.users}`;\n-    }\n-\n-    askUserApplicationRegistered(user: string): Observable<User> {\n-        return this.httpClient.get<User>(`${this.userUrl}/users/${user}`);\n-    }\n-\n-    askCreateUser(userData: User): Observable<User> {\n-        return this.httpClient.put<User>(`${this.userUrl}/users/${userData.login}`, userData);\n-    }\n-\n-    currentUserWithPerimeters(): Observable<UserWithPerimeters> {\n-        return this.httpClient.get<UserWithPerimeters>(`${this.userUrl}/CurrentUserWithPerimeters`);\n-    }\n-\n-    queryAllEntities(): Observable<Entity[]> {\n-        const url = `${this.userUrl}/entities`;\n-        return this.httpClient.get<Entity[]>(url);\n-\n-    }\n-    public loadUserWithPerimetersData(): void {\n-        this.currentUserWithPerimeters()\n-            .pipe(takeUntil(this.ngUnsubscribe))\n-            .subscribe(\n-                (userWithPerimeters) => {\n-                    if (userWithPerimeters) {\n-                        this._userWithPerimeters = userWithPerimeters;\n-                    }\n-                }, (error) => console.error(new Date().toISOString(), 'an error occurred', error)\n-            );\n-    }\n-\n-    public getCurrentUserWithPerimeters(): UserWithPerimeters {\n-        return this._userWithPerimeters;\n-    }\n+export class UserService implements CrudService {\n+  readonly userUrl: string;\n+  private _userWithPerimeters: UserWithPerimeters;\n+  private ngUnsubscribe = new Subject<void>();\n+\n+  /**\n+   * @constructor\n+   * @param httpClient - Angular build-in\n+   */\n+  constructor(private httpClient: HttpClient, private groupsService: GroupsService) {", "originalCommit": "fd5baf91ca21acbb123ba878bf2c84c8f2f9dad4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDgxODI0OQ==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r490818249", "bodyText": "done", "author": "bendaoudmba", "createdAt": "2020-09-18T09:23:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk4ODU1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk5MTUzNA==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r486991534", "bodyText": "Would it be possible to use rxjs observable instead of promise to be coherent with the rest of the code ?", "author": "freddidierRTE", "createdAt": "2020-09-11T11:46:42Z", "path": "ui/main/src/app/modules/admin/services/login-validator.service.ts", "diffHunk": "@@ -0,0 +1,26 @@\n+import { Injectable } from '@angular/core';\n+import { UserService } from '@ofServices/user.service';\n+import { AbstractControl, ValidationErrors } from '@angular/forms';\n+import { User } from '@ofModel/user.model';\n+\n+@Injectable({\n+  providedIn: 'root'\n+})\n+export class LoginValidatorService {\n+\n+  constructor(\n+    private userService: UserService) {\n+  }\n+\n+  isLoginAvailable(control: AbstractControl): Promise<ValidationErrors> | null {\n+    return new Promise((resolve, reject) => {\n+      this.userService.getAll().subscribe((response) => {\n+        if (response.filter(user => user.login === control.value).length > 0) {\n+          resolve({ shouldbeUnique: true });\n+        } else {\n+          resolve(null);\n+        }", "originalCommit": "fd5baf91ca21acbb123ba878bf2c84c8f2f9dad4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgwNTU4Mw==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r487805583", "bodyText": "use of promise.resolve method is necessary", "author": "bendaoudmba", "createdAt": "2020-09-14T10:19:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk5MTUzNA=="}], "type": "inlineReview"}, {"oid": "60c2621d2056476f510a3dac94d42979617a1ad4", "url": "https://github.com/opfab/operatorfabric-core/commit/60c2621d2056476f510a3dac94d42979617a1ad4", "message": "[OC-1025] : complete admin module", "committedDate": "2020-09-16T20:52:08Z", "type": "forcePushed"}, {"oid": "6d79c2918cd71907e0e5ce5b419d5d67baad734d", "url": "https://github.com/opfab/operatorfabric-core/commit/6d79c2918cd71907e0e5ce5b419d5d67baad734d", "message": "[OC-1025] : complete users admin module", "committedDate": "2020-09-16T20:54:13Z", "type": "forcePushed"}, {"oid": "0865c7e164572d2fbe571e7cc767f6fac09787bf", "url": "https://github.com/opfab/operatorfabric-core/commit/0865c7e164572d2fbe571e7cc767f6fac09787bf", "message": "[OC-1025] : complete users admin module", "committedDate": "2020-09-18T12:34:25Z", "type": "forcePushed"}, {"oid": "96a220bc71b1746d3aa32b1bed1777e49654f26c", "url": "https://github.com/opfab/operatorfabric-core/commit/96a220bc71b1746d3aa32b1bed1777e49654f26c", "message": "[OC-1025] : complete users admin module", "committedDate": "2020-09-18T12:44:13Z", "type": "forcePushed"}, {"oid": "f90f2223680a80eb204ec8210a69242638c165ac", "url": "https://github.com/opfab/operatorfabric-core/commit/f90f2223680a80eb204ec8210a69242638c165ac", "message": "[OC-1025] : complete users admin module", "committedDate": "2020-09-21T12:16:47Z", "type": "forcePushed"}, {"oid": "6858b852cb952031cc9dcd0e647ae1b102489944", "url": "https://github.com/opfab/operatorfabric-core/commit/6858b852cb952031cc9dcd0e647ae1b102489944", "message": "[OC-1025] : complete users admin module", "committedDate": "2020-09-21T13:25:25Z", "type": "forcePushed"}, {"oid": "972c3167f2114afc2a9a5a8f00546a6e2222e5ba", "url": "https://github.com/opfab/operatorfabric-core/commit/972c3167f2114afc2a9a5a8f00546a6e2222e5ba", "message": "[OC-1025] : complete users admin module", "committedDate": "2020-09-28T15:48:21Z", "type": "forcePushed"}, {"oid": "090c20b0ea4a1b58f46ee7c298758f1720d44ce6", "url": "https://github.com/opfab/operatorfabric-core/commit/090c20b0ea4a1b58f46ee7c298758f1720d44ce6", "message": "[OC-1025] : complete users admin module", "committedDate": "2020-09-28T16:18:56Z", "type": "forcePushed"}, {"oid": "eb021f9baab5146d5fa0d4b35f215e7e44b1d30c", "url": "https://github.com/opfab/operatorfabric-core/commit/eb021f9baab5146d5fa0d4b35f215e7e44b1d30c", "message": "[OC-1025] : complete users admin module", "committedDate": "2020-09-29T08:36:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY3OTg1NA==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r496679854", "bodyText": "Abandonner et pas Abondonner", "author": "freddidierRTE", "createdAt": "2020-09-29T12:35:37Z", "path": "ui/main/src/assets/i18n/fr.json", "diffHunk": "@@ -184,5 +185,53 @@\n       \"ack\": \"Acquitter et fermer\",\n       \"unack\": \"Annuler l'acquitement\"\n     }\n+  },\n+  \"admin\": {\n+    \"input\": {\n+      \"user\": {\n+        \"login\": \"Identifiant\",\n+        \"lastname\": \"Nom\",\n+        \"firstname\": \"Pr\u00e9nom\",\n+        \"groups\": \"Groupes\",\n+        \"entities\": \"Entiti\u00e9s\",\n+        \"add\": \"Ajouter un nouveau utilisateur\",\n+        \"edit\": \"Editer\",\n+        \"delete\": \"Supprimer\",\n+        \"save\": \"Sauvegarder les changements\",\n+        \"close\": \"Fermer\",\n+        \"cancel\": \"Abondonner\",", "originalCommit": "eb021f9baab5146d5fa0d4b35f215e7e44b1d30c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY4NDY5OA==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r496684698", "bodyText": "Why adding this dependence compat-cat , i do not see the use in the code . I remove it and it has no impact", "author": "freddidierRTE", "createdAt": "2020-09-29T12:42:45Z", "path": "ui/main/package.json", "diffHunk": "@@ -94,6 +96,7 @@\n     \"ts-mockito\": \"^2.6.1\",\n     \"ts-node\": \"~7.0.0\",\n     \"tslint\": \"~5.11.0\",\n-    \"typescript\": \"~3.5.3\"\n+    \"typescript\": \"~3.5.3\",\n+    \"@babel/compat-data\": \"~7.8.0\"", "originalCommit": "eb021f9baab5146d5fa0d4b35f215e7e44b1d30c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY4OTEzMQ==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r496689131", "bodyText": "! this.configService.getConfigValue('admin.hidden') and not  this.configService.getConfigValue('admin.hidden')\nOtherwise the admin menu is showed when admin.hidden=true\n---> Add this parameter in documentation : src/docs/asciidoc/deployment/configuration/web-ui_configuration.adoc\nin chapter ui properties", "author": "freddidierRTE", "createdAt": "2020-09-29T12:49:46Z", "path": "ui/main/src/app/components/navbar/navbar.component.ts", "diffHunk": "@@ -8,151 +8,157 @@\n  */\n \n \n-import {Component, OnInit} from '@angular/core';\n-import {navigationRoutes} from '../../app-routing.module';\n-import {Store} from '@ngrx/store';\n-import {TryToLogOut} from '@ofActions/authentication.actions';\n-import {AppState} from '@ofStore/index';\n-import {selectCurrentUrl} from '@ofSelectors/router.selectors';\n-import {LoadMenu} from '@ofActions/menu.actions';\n-import {selectMenuStateMenu} from '@ofSelectors/menu.selectors';\n-import {BehaviorSubject, Observable} from 'rxjs';\n-import {Menu} from '@ofModel/processes.model';\n-import {tap} from 'rxjs/operators';\n+import { Component, OnInit } from '@angular/core';\n+import { navigationRoutes } from '../../app-routing.module';\n+import { Store } from '@ngrx/store';\n+import { TryToLogOut } from '@ofActions/authentication.actions';\n+import { AppState } from '@ofStore/index';\n+import { selectCurrentUrl } from '@ofSelectors/router.selectors';\n+import { LoadMenu } from '@ofActions/menu.actions';\n+import { selectMenuStateMenu } from '@ofSelectors/menu.selectors';\n+import { BehaviorSubject, Observable } from 'rxjs';\n+import { Menu } from '@ofModel/processes.model';\n+import { tap } from 'rxjs/operators';\n import * as _ from 'lodash';\n-import {GlobalStyleService} from '@ofServices/global-style.service';\n-import {Route} from '@angular/router';\n-import {ConfigService} from '@ofServices/config.service';\n-import {QueryAllProcesses} from '@ofActions/process.action';\n-import {QueryAllEntities} from \"@ofActions/user.actions\";\n+import { GlobalStyleService } from '@ofServices/global-style.service';\n+import { Route } from '@angular/router';\n+import { ConfigService } from '@ofServices/config.service';\n+import { QueryAllProcesses } from '@ofActions/process.action';\n+import { UserService } from '@ofServices/user.service';\n+import { QueryAllEntities } from '@ofActions/user.actions';\n \n @Component({\n-    selector: 'of-navbar',\n-    templateUrl: './navbar.component.html',\n-    styleUrls: ['./navbar.component.scss']\n+  selector: 'of-navbar',\n+  templateUrl: './navbar.component.html',\n+  styleUrls: ['./navbar.component.scss']\n })\n export class NavbarComponent implements OnInit {\n-    private static nightMode: BehaviorSubject<boolean>;\n-\n-    navbarCollapsed = true;\n-    navigationRoutes: Route[];\n-    currentPath: string[];\n-    private _businessconfigMenus: Observable<Menu[]>;\n-    expandedMenu: boolean[] = [];\n-    expandedUserMenu = false;\n-\n-    customLogo: string;\n-    height: number;\n-    width: number;\n-    limitSize: boolean;\n-\n-    nightDayMode = false;\n+  private static nightMode: BehaviorSubject<boolean>;\n+\n+  navbarCollapsed = true;\n+  navigationRoutes: Route[];\n+  currentPath: string[];\n+  private _businessconfigMenus: Observable<Menu[]>;\n+  expandedMenu: boolean[] = [];\n+  expandedUserMenu = false;\n+\n+  customLogo: string;\n+  height: number;\n+  width: number;\n+  limitSize: boolean;\n+  displayAdmin: boolean;\n+  nightDayMode = false;\n+\n+  constructor(private store: Store<AppState>, private globalStyleService: GlobalStyleService, private configService: ConfigService\n+    , private userService: UserService) {\n+\n+  }\n+\n+  ngOnInit() {\n+\n+    this.store.select(selectCurrentUrl).subscribe(url => {\n+      if (url) {\n+        this.currentPath = url.split('/');\n+      }\n+    });\n+    this._businessconfigMenus = this.store.select(selectMenuStateMenu)\n+      .pipe(tap(menus => {\n+        this.expandedMenu = new Array<boolean>(menus.length);\n+        _.fill(this.expandedMenu, false);\n+      }));\n+    this.store.dispatch(new LoadMenu());\n+    this.store.dispatch(new QueryAllProcesses());\n+    this.store.dispatch(new QueryAllEntities());\n+\n+\n+    const logo = this.configService.getConfigValue('logo.base64');\n+    if (!!logo) {\n+      this.customLogo = `data:image/svg+xml;base64,${logo}`;\n+    }\n+    const logo_height = this.configService.getConfigValue('logo.height');\n+    if (!!logo_height) {\n+      this.height = logo_height;\n+    }\n \n-    constructor(private store: Store<AppState>, private globalStyleService: GlobalStyleService, private  configService: ConfigService) {\n+    const logo_width = this.configService.getConfigValue('logo.width');\n+    if (!!logo_width) {\n+      this.width = logo_width;\n     }\n \n-    ngOnInit() {\n-        this.store.select(selectCurrentUrl).subscribe(url => {\n-            if (url) {\n-                this.currentPath = url.split('/');\n-            }\n-        });\n-        this._businessconfigMenus = this.store.select(selectMenuStateMenu)\n-            .pipe(tap(menus => {\n-                this.expandedMenu = new Array<boolean>(menus.length);\n-                _.fill(this.expandedMenu, false);\n-            }));\n-        this.store.dispatch(new LoadMenu());\n-        this.store.dispatch(new QueryAllProcesses());\n-        this.store.dispatch(new QueryAllEntities());\n-\n-\n-        const logo = this.configService.getConfigValue('logo.base64');\n-        if (!!logo) {\n-            this.customLogo = `data:image/svg+xml;base64,${logo}`;\n-        }\n-        const logo_height = this.configService.getConfigValue('logo.height');\n-        if (!!logo_height) {\n-            this.height = logo_height;\n-        }\n+    const logo_limitSize = this.configService.getConfigValue('logo.limitSize');\n+    this.limitSize = (logo_limitSize === true);\n \n-        const logo_width = this.configService.getConfigValue('logo.width');\n-        if (!!logo_width) {\n-            this.width = logo_width;\n-        }\n \n-        const logo_limitSize = this.configService.getConfigValue('logo.limitSize');\n-        this.limitSize = (logo_limitSize === true);\n-\n-\n-        const settings = this.configService.getConfigValue('settings');\n-        if (settings) {\n-            if (settings.nightDayMode) {\n-                this.nightDayMode = <boolean>settings.nightDayMode;\n-            }\n-            if (!this.nightDayMode) {\n-                if (settings.styleWhenNightDayModeDesactivated) {\n-                    this.globalStyleService.setStyle(settings.styleWhenNightDayModeDesactivated);\n-                }\n-            } else {\n-                this.loadNightModeFromLocalStorage();\n-            }\n+    const settings = this.configService.getConfigValue('settings');\n+    if (settings) {\n+      if (settings.nightDayMode) {\n+        this.nightDayMode = <boolean>settings.nightDayMode;\n+      }\n+      if (!this.nightDayMode) {\n+        if (settings.styleWhenNightDayModeDesactivated) {\n+          this.globalStyleService.setStyle(settings.styleWhenNightDayModeDesactivated);\n         }\n-\n-        const hiddenMenus = this.configService.getConfigValue('navbar.hidden', []);\n-        this.navigationRoutes = navigationRoutes.filter(route => !hiddenMenus.includes(route.path));\n+      } else {\n+        this.loadNightModeFromLocalStorage();\n+      }\n     }\n \n-    logOut() {\n-        this.store.dispatch(new TryToLogOut());\n-    }\n+    const hiddenMenus = this.configService.getConfigValue('navbar.hidden', []);\n+    this.navigationRoutes = navigationRoutes.filter(route => !hiddenMenus.includes(route.path));\n+    this.displayAdmin = this.userService.isCurrentUserAdmin() && this.configService.getConfigValue('admin.hidden');", "originalCommit": "eb021f9baab5146d5fa0d4b35f215e7e44b1d30c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgzODE2NA==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r496838164", "bodyText": "done", "author": "bendaoudmba", "createdAt": "2020-09-29T15:50:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY4OTEzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY5NjIwMQ==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r496696201", "bodyText": "remove this log", "author": "freddidierRTE", "createdAt": "2020-09-29T13:00:10Z", "path": "ui/main/src/app/modules/admin/components/ngtable/users/ofuserstable.component.ts", "diffHunk": "@@ -0,0 +1,148 @@\n+import { Component, OnInit } from '@angular/core';\n+import { UserService } from '@ofServices/user.service';\n+import { EditUsermodalComponent } from '../../editmodal/users/editusermodal.component';\n+import { DataTableShareService } from '../../../services/data.service';\n+import { OfTableComponent } from '../oftable/oftable.component';\n+import { NgbModal } from '@ng-bootstrap/ng-bootstrap';\n+import { TranslateService } from '@ngx-translate/core';\n+import { ConfirmationDialogService } from 'app/modules/admin/services/confirmation-dialog.service';\n+import { AppState } from '@ofStore/index';\n+import { Store } from '@ngrx/store';\n+\n+\n+@Component({\n+  selector: 'of-users-table',\n+  templateUrl: './ofuserstable.component.html'\n+})\n+export class OfUsersTableComponent extends OfTableComponent implements OnInit {\n+\n+  addLabel: string;\n+  lineLabel: string;\n+  filterAll: any;\n+\n+  constructor(\n+    protected crudService: UserService,\n+    protected modalService: NgbModal,\n+    protected dataService: DataTableShareService,\n+    protected translate: TranslateService,\n+    private confirmationDialogService: ConfirmationDialogService,\n+    protected store: Store<AppState>\n+  ) {\n+\n+    super(modalService, dataService, store);\n+    this.crudService = crudService;\n+    this.config.sorting = { columns: this.columns };\n+    this.getLocale().subscribe(locale => {\n+      console.log(locale);", "originalCommit": "eb021f9baab5146d5fa0d4b35f215e7e44b1d30c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg0MDc0Mw==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r496840743", "bodyText": "done", "author": "bendaoudmba", "createdAt": "2020-09-29T15:52:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY5NjIwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY5NjMwNg==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r496696306", "bodyText": "remove this log", "author": "freddidierRTE", "createdAt": "2020-09-29T13:00:21Z", "path": "ui/main/src/app/modules/admin/components/ngtable/users/ofuserstable.component.ts", "diffHunk": "@@ -0,0 +1,148 @@\n+import { Component, OnInit } from '@angular/core';\n+import { UserService } from '@ofServices/user.service';\n+import { EditUsermodalComponent } from '../../editmodal/users/editusermodal.component';\n+import { DataTableShareService } from '../../../services/data.service';\n+import { OfTableComponent } from '../oftable/oftable.component';\n+import { NgbModal } from '@ng-bootstrap/ng-bootstrap';\n+import { TranslateService } from '@ngx-translate/core';\n+import { ConfirmationDialogService } from 'app/modules/admin/services/confirmation-dialog.service';\n+import { AppState } from '@ofStore/index';\n+import { Store } from '@ngrx/store';\n+\n+\n+@Component({\n+  selector: 'of-users-table',\n+  templateUrl: './ofuserstable.component.html'\n+})\n+export class OfUsersTableComponent extends OfTableComponent implements OnInit {\n+\n+  addLabel: string;\n+  lineLabel: string;\n+  filterAll: any;\n+\n+  constructor(\n+    protected crudService: UserService,\n+    protected modalService: NgbModal,\n+    protected dataService: DataTableShareService,\n+    protected translate: TranslateService,\n+    private confirmationDialogService: ConfirmationDialogService,\n+    protected store: Store<AppState>\n+  ) {\n+\n+    super(modalService, dataService, store);\n+    this.crudService = crudService;\n+    this.config.sorting = { columns: this.columns };\n+    this.getLocale().subscribe(locale => {\n+      console.log(locale);\n+      this.translate.use(locale);\n+      this.translate.get(['admin.input.user.login', 'admin.input.user.firstname', 'admin.input.user.lastname',\n+        'admin.input.user.groups', 'admin.input.user.entities', 'admin.input.user.edit', 'admin.input.user.delete',\n+        'admin.pagination.firstText', 'admin.pagination.lastText', 'admin.pagination.nextText', 'admin.pagination.prevText'\n+        , 'admin.input.user.add', 'admin.input.lines', 'admin.input.user.filter' , 'admin.input.user.filterAll'])\n+        .subscribe(translations => {\n+          console.log(this.translate.currentLang);", "originalCommit": "eb021f9baab5146d5fa0d4b35f215e7e44b1d30c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg0MDg3MA==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r496840870", "bodyText": "done", "author": "bendaoudmba", "createdAt": "2020-09-29T15:53:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY5NjMwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY5NzI2MA==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r496697260", "bodyText": "Remove this log", "author": "freddidierRTE", "createdAt": "2020-09-29T13:01:48Z", "path": "ui/main/src/app/services/user.service.ts", "diffHunk": "@@ -75,12 +99,23 @@ export class UserService implements CrudService {\n         (userWithPerimeters) => {\n           if (userWithPerimeters) {\n             this._userWithPerimeters = userWithPerimeters;\n+            console.log(this._userWithPerimeters);", "originalCommit": "eb021f9baab5146d5fa0d4b35f215e7e44b1d30c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg0MTAyNQ==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r496841025", "bodyText": "done", "author": "bendaoudmba", "createdAt": "2020-09-29T15:53:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY5NzI2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY5NzkzNg==", "url": "https://github.com/opfab/operatorfabric-core/pull/467#discussion_r496697936", "bodyText": "add error information in this log", "author": "freddidierRTE", "createdAt": "2020-09-29T13:02:49Z", "path": "ui/main/src/app/modules/admin/components/ngtable/users/ofuserstable.component.ts", "diffHunk": "@@ -0,0 +1,148 @@\n+import { Component, OnInit } from '@angular/core';\n+import { UserService } from '@ofServices/user.service';\n+import { EditUsermodalComponent } from '../../editmodal/users/editusermodal.component';\n+import { DataTableShareService } from '../../../services/data.service';\n+import { OfTableComponent } from '../oftable/oftable.component';\n+import { NgbModal } from '@ng-bootstrap/ng-bootstrap';\n+import { TranslateService } from '@ngx-translate/core';\n+import { ConfirmationDialogService } from 'app/modules/admin/services/confirmation-dialog.service';\n+import { AppState } from '@ofStore/index';\n+import { Store } from '@ngrx/store';\n+\n+\n+@Component({\n+  selector: 'of-users-table',\n+  templateUrl: './ofuserstable.component.html'\n+})\n+export class OfUsersTableComponent extends OfTableComponent implements OnInit {\n+\n+  addLabel: string;\n+  lineLabel: string;\n+  filterAll: any;\n+\n+  constructor(\n+    protected crudService: UserService,\n+    protected modalService: NgbModal,\n+    protected dataService: DataTableShareService,\n+    protected translate: TranslateService,\n+    private confirmationDialogService: ConfirmationDialogService,\n+    protected store: Store<AppState>\n+  ) {\n+\n+    super(modalService, dataService, store);\n+    this.crudService = crudService;\n+    this.config.sorting = { columns: this.columns };\n+    this.getLocale().subscribe(locale => {\n+      console.log(locale);\n+      this.translate.use(locale);\n+      this.translate.get(['admin.input.user.login', 'admin.input.user.firstname', 'admin.input.user.lastname',\n+        'admin.input.user.groups', 'admin.input.user.entities', 'admin.input.user.edit', 'admin.input.user.delete',\n+        'admin.pagination.firstText', 'admin.pagination.lastText', 'admin.pagination.nextText', 'admin.pagination.prevText'\n+        , 'admin.input.user.add', 'admin.input.lines', 'admin.input.user.filter' , 'admin.input.user.filterAll'])\n+        .subscribe(translations => {\n+          console.log(this.translate.currentLang);\n+          this.columns = [\n+            {\n+              title: translations['admin.input.user.login'],\n+              name: 'login',\n+              filtering: {\n+                filterString: '', placeholder: translations['admin.input.user.filter'] +\n+                  translations['admin.input.user.login']\n+              },\n+            },\n+            {\n+              title: translations['admin.input.user.firstname'],\n+              name: 'firstName',\n+              filtering: {\n+                filterString: '', placeholder: translations['admin.input.user.filter'] +\n+                  translations['admin.input.user.firstname']\n+              },\n+            },\n+            {\n+              title: translations['admin.input.user.lastname'],\n+              name: 'lastName',\n+              filtering: {\n+                filterString: '', placeholder: translations['admin.input.user.filter'] +\n+                  translations['admin.input.user.lastname']\n+              },\n+            },\n+            {\n+              title: translations['admin.input.user.groups'],\n+              name: 'groups',\n+              filtering: {\n+                filterString: '', placeholder: translations['admin.input.user.filter'] +\n+                  translations['admin.input.user.groups']\n+              },\n+            },\n+            {\n+              title: translations['admin.input.user.entities'],\n+              name: 'entities',\n+              filtering: {\n+                filterString: '', placeholder: translations['admin.input.user.filter'] +\n+                  translations['admin.input.user.entities']\n+              },\n+            },\n+            {\n+              title: translations['admin.input.user.edit'],\n+              name: 'edit'\n+            },\n+            {\n+              title: translations['admin.input.user.delete'],\n+              name: 'delete'\n+            }\n+          ];\n+          this.firstText = translations['admin.pagination.firstText'];\n+          this.lastText = translations['admin.pagination.lastText'];\n+          this.nextText = translations['admin.pagination.nextText'];\n+          this.prevText = translations['admin.pagination.prevText'];\n+          this.addLabel = translations['admin.input.user.add'];\n+          this.lineLabel = translations['admin.input.lines'];\n+          this.filterAll = translations['admin.input.user.filterAll'];\n+\n+        });\n+    });\n+  }\n+\n+\n+  onCellClick(data: any): any {\n+    const column = data.column;\n+    if (column === 'edit') {\n+      const modalRef = this.modalService.open(EditUsermodalComponent);\n+      modalRef.componentInstance.user = data['row'];\n+    }\n+    if (column === 'delete') {\n+      this.openDeleteConfirmationDialog(data.row);\n+    }\n+  }\n+\n+  openDeleteConfirmationDialog(row: any) {\n+    this.confirmationDialogService.confirm(\n+      this.translate.instant('admin.input.user.confirm'),\n+      this.translate.instant('admin.input.delete') + ' ' + row.login + '?',\n+      'OK',\n+      this.translate.instant('admin.input.user.cancel')\n+    ).then((confirmed) => {\n+      if (confirmed) {\n+        this.deleteItem(row);\n+      }\n+    }).catch(() => console.log('error)'));", "originalCommit": "eb021f9baab5146d5fa0d4b35f215e7e44b1d30c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "94ae36379412dd4bb8e061aa497c845286001f6c", "url": "https://github.com/opfab/operatorfabric-core/commit/94ae36379412dd4bb8e061aa497c845286001f6c", "message": "[OC-1025] : complete users admin module", "committedDate": "2020-09-30T07:55:07Z", "type": "forcePushed"}, {"oid": "704158c59cd40fbd5db1e7e72e3a0297fac1a766", "url": "https://github.com/opfab/operatorfabric-core/commit/704158c59cd40fbd5db1e7e72e3a0297fac1a766", "message": "[OC-1025] : complete users admin module", "committedDate": "2020-09-30T08:36:25Z", "type": "forcePushed"}, {"oid": "2484c71554c899a3c9e70f2935011c382fe9390e", "url": "https://github.com/opfab/operatorfabric-core/commit/2484c71554c899a3c9e70f2935011c382fe9390e", "message": "[OC-1025] : complete users admin module", "committedDate": "2020-10-01T15:20:45Z", "type": "commit"}, {"oid": "2484c71554c899a3c9e70f2935011c382fe9390e", "url": "https://github.com/opfab/operatorfabric-core/commit/2484c71554c899a3c9e70f2935011c382fe9390e", "message": "[OC-1025] : complete users admin module", "committedDate": "2020-10-01T15:20:45Z", "type": "forcePushed"}, {"oid": "6576431c39796184df886f33256631676e17bb28", "url": "https://github.com/opfab/operatorfabric-core/commit/6576431c39796184df886f33256631676e17bb28", "message": "[OC-1025] Remove use of external font", "committedDate": "2020-10-02T07:43:04Z", "type": "commit"}]}