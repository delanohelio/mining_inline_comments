{"pr_number": 4276, "pr_title": "Use ContextCompat methods.", "pr_createdAt": "2020-09-13T13:51:17Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/4276", "timeline": [{"oid": "14d89f98b1cd1dfba2788e90893c0bb3fe7bdeb0", "url": "https://github.com/TeamNewPipe/NewPipe/commit/14d89f98b1cd1dfba2788e90893c0bb3fe7bdeb0", "message": "Use ContextCompat.startForegroundService().", "committedDate": "2020-09-13T14:05:03Z", "type": "forcePushed"}, {"oid": "f0925034993490c6a8baaf9ce215fa1cc71a441b", "url": "https://github.com/TeamNewPipe/NewPipe/commit/f0925034993490c6a8baaf9ce215fa1cc71a441b", "message": "Use ContextCompat.startForegroundService().", "committedDate": "2020-09-13T14:13:24Z", "type": "forcePushed"}, {"oid": "34da1bdee91900e3b3e175705d19a03527cdc386", "url": "https://github.com/TeamNewPipe/NewPipe/commit/34da1bdee91900e3b3e175705d19a03527cdc386", "message": "Combine initNotificationChannel() and setUpUpdateNotificationChannel() into a single method.", "committedDate": "2020-09-16T14:32:23Z", "type": "forcePushed"}, {"oid": "811c790b0b49d749b0351b2786dbbba7a8fa50dd", "url": "https://github.com/TeamNewPipe/NewPipe/commit/811c790b0b49d749b0351b2786dbbba7a8fa50dd", "message": "Combine initNotificationChannel() and setUpUpdateNotificationChannel() into a single method.", "committedDate": "2020-09-21T02:50:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE3NjczMQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4276#discussion_r492176731", "bodyText": "Not ContextCompat here?", "author": "Redirion", "createdAt": "2020-09-21T16:03:42Z", "path": "app/src/main/java/org/schabi/newpipe/util/DeviceUtils.java", "diffHunk": "@@ -32,15 +31,14 @@ public static boolean isTv(final Context context) {\n         final PackageManager pm = App.getApp().getPackageManager();\n \n         // from doc: https://developer.android.com/training/tv/start/hardware.html#runtime-check\n-        boolean isTv = ((UiModeManager) context.getSystemService(UI_MODE_SERVICE))\n+        boolean isTv = ContextCompat.getSystemService(context, UiModeManager.class)\n                 .getCurrentModeType() == Configuration.UI_MODE_TYPE_TELEVISION\n                 || pm.hasSystemFeature(AMAZON_FEATURE_FIRE_TV)\n                 || pm.hasSystemFeature(PackageManager.FEATURE_TELEVISION);\n \n         // from https://stackoverflow.com/a/58932366\n         if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {\n-            final boolean isBatteryAbsent\n-                    = ((BatteryManager) context.getSystemService(BATTERY_SERVICE))\n+            final boolean isBatteryAbsent = context.getSystemService(BatteryManager.class)", "originalCommit": "811c790b0b49d749b0351b2786dbbba7a8fa50dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI1ODY2Nw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4276#discussion_r494258667", "bodyText": "It isn't needed, as Context's getSystemService(Class) method is available on Android Marshmallow and higher.", "author": "Isira-Seneviratne", "createdAt": "2020-09-24T12:03:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE3NjczMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI2NTYwNQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4276#discussion_r494265605", "bodyText": "Sorry, I don't understand. Don't you always need to call context.getSystemService(Class).", "author": "Stypox", "createdAt": "2020-09-24T12:15:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE3NjczMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc0MTIyNQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4276#discussion_r494741225", "bodyText": "ContextCompat.getSystemService() actually calls Context.getSystemService(Class) on Android Marshmallow and higher, and calls Context.getSystemService(String) on lower versions.", "author": "Isira-Seneviratne", "createdAt": "2020-09-25T04:31:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE3NjczMQ=="}], "type": "inlineReview"}, {"oid": "9d2f0a7d6346e41473f320e2e8cabb13afd1f64f", "url": "https://github.com/TeamNewPipe/NewPipe/commit/9d2f0a7d6346e41473f320e2e8cabb13afd1f64f", "message": "Combine initNotificationChannel() and setUpUpdateNotificationChannel() into a single method.", "committedDate": "2020-09-28T03:17:15Z", "type": "forcePushed"}, {"oid": "4ea6aa69b2c0223ca75fdae72d07bb34ad07a493", "url": "https://github.com/TeamNewPipe/NewPipe/commit/4ea6aa69b2c0223ca75fdae72d07bb34ad07a493", "message": "Combine initNotificationChannel() and setUpUpdateNotificationChannel() into a single method.", "committedDate": "2020-09-29T23:21:16Z", "type": "forcePushed"}, {"oid": "05ef697b72d8b50527cfd47cfc56bdb90a01edc6", "url": "https://github.com/TeamNewPipe/NewPipe/commit/05ef697b72d8b50527cfd47cfc56bdb90a01edc6", "message": "Combine initNotificationChannel() and setUpUpdateNotificationChannel() into a single method.", "committedDate": "2020-10-04T02:53:13Z", "type": "forcePushed"}, {"oid": "e3d1f750b15b6855a8cc39f9236e2c7129f06154", "url": "https://github.com/TeamNewPipe/NewPipe/commit/e3d1f750b15b6855a8cc39f9236e2c7129f06154", "message": "Combine initNotificationChannel() and setUpUpdateNotificationChannel() into a single method.", "committedDate": "2020-10-05T13:04:00Z", "type": "forcePushed"}, {"oid": "61ae65a4a92575487ce2f8ca65ba1d2e89c34a74", "url": "https://github.com/TeamNewPipe/NewPipe/commit/61ae65a4a92575487ce2f8ca65ba1d2e89c34a74", "message": "Combine initNotificationChannel() and setUpUpdateNotificationChannel() into a single method.", "committedDate": "2020-10-07T00:18:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc0MjIwOA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4276#discussion_r500742208", "bodyText": "Why getApplicationContext()? Isn't context already enough, like the line below?", "author": "Stypox", "createdAt": "2020-10-07T05:15:31Z", "path": "app/src/main/java/org/schabi/newpipe/player/helper/LockManager.java", "diffHunk": "@@ -18,10 +17,9 @@\n     private WifiManager.WifiLock wifiLock;\n \n     public LockManager(final Context context) {\n-        powerManager = ((PowerManager) context.getApplicationContext()\n-                .getSystemService(POWER_SERVICE));\n-        wifiManager = ((WifiManager) context.getApplicationContext()\n-                .getSystemService(WIFI_SERVICE));\n+        powerManager = ContextCompat.getSystemService(context.getApplicationContext(),", "originalCommit": "61ae65a4a92575487ce2f8ca65ba1d2e89c34a74", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc0NDYwOA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4276#discussion_r500744608", "bodyText": "The documentation for WifiManager states:\n\"On releases before Build.VERSION_CODES.N, this object should only be obtained from an Context#getApplicationContext(), and not from any other derived context to avoid memory leaks within the calling process.\"", "author": "Isira-Seneviratne", "createdAt": "2020-10-07T05:24:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc0MjIwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc0MzQ1Ng==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4276#discussion_r500743456", "bodyText": "Instead of adding this line to the lint suppressions, just split it in half", "author": "Stypox", "createdAt": "2020-10-07T05:20:14Z", "path": "app/src/main/java/org/schabi/newpipe/App.java", "diffHunk": "@@ -219,49 +219,30 @@ protected void initACRA() {\n         }\n     }\n \n-    public void initNotificationChannel() {\n+    private void initNotificationChannels() {\n         if (Build.VERSION.SDK_INT < Build.VERSION_CODES.O) {\n             return;\n         }\n \n-        final String id = getString(R.string.notification_channel_id);\n-        final CharSequence name = getString(R.string.notification_channel_name);\n-        final String description = getString(R.string.notification_channel_description);\n+        String id = getString(R.string.notification_channel_id);\n+        String name = getString(R.string.notification_channel_name);\n+        String description = getString(R.string.notification_channel_description);\n \n         // Keep this below DEFAULT to avoid making noise on every notification update\n         final int importance = NotificationManager.IMPORTANCE_LOW;\n \n-        final NotificationChannel mChannel = new NotificationChannel(id, name, importance);\n-        mChannel.setDescription(description);\n+        final NotificationChannel mainChannel = new NotificationChannel(id, name, importance);\n+        mainChannel.setDescription(description);\n \n-        final NotificationManager mNotificationManager =\n-                (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE);\n-        mNotificationManager.createNotificationChannel(mChannel);\n+        id = getString(R.string.app_update_notification_channel_id);\n+        name = getString(R.string.app_update_notification_channel_name);\n+        description = getString(R.string.app_update_notification_channel_description);\n \n-        setUpUpdateNotificationChannel(importance);\n-    }\n+        final NotificationChannel appUpdateChannel = new NotificationChannel(id, name, importance);\n+        appUpdateChannel.setDescription(description);\n \n-    /**\n-     * Set up notification channel for app update.\n-     *\n-     * @param importance\n-     */\n-    @TargetApi(Build.VERSION_CODES.O)\n-    private void setUpUpdateNotificationChannel(final int importance) {\n-        final String appUpdateId\n-                = getString(R.string.app_update_notification_channel_id);\n-        final CharSequence appUpdateName\n-                = getString(R.string.app_update_notification_channel_name);\n-        final String appUpdateDescription\n-                = getString(R.string.app_update_notification_channel_description);\n-\n-        final NotificationChannel appUpdateChannel\n-                = new NotificationChannel(appUpdateId, appUpdateName, importance);\n-        appUpdateChannel.setDescription(appUpdateDescription);\n-\n-        final NotificationManager appUpdateNotificationManager\n-                = (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE);\n-        appUpdateNotificationManager.createNotificationChannel(appUpdateChannel);\n+        final NotificationManager notificationManager = getSystemService(NotificationManager.class);\n+        notificationManager.createNotificationChannels(Arrays.asList(mainChannel, appUpdateChannel));", "originalCommit": "61ae65a4a92575487ce2f8ca65ba1d2e89c34a74", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc0MzYyOA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4276#discussion_r500743628", "bodyText": "So remove this\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n              <suppress checks=\"LineLength\"\n          \n          \n            \n                  files=\"App.java\"\n          \n          \n            \n                  lines=\"245\"/>", "author": "Stypox", "createdAt": "2020-10-07T05:20:54Z", "path": "checkstyle-suppressions.xml", "diffHunk": "@@ -13,7 +13,11 @@\n \n   <suppress checks=\"FinalParameters\"\n       files=\"ListHelper.java\"\n-      lines=\"280,312\"/>\n+      lines=\"282,314\"/>\n+\n+  <suppress checks=\"LineLength\"\n+      files=\"App.java\"\n+      lines=\"245\"/>", "originalCommit": "61ae65a4a92575487ce2f8ca65ba1d2e89c34a74", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "53e8e9f23a9adb9f80e3828723761d603a6e4339", "url": "https://github.com/TeamNewPipe/NewPipe/commit/53e8e9f23a9adb9f80e3828723761d603a6e4339", "message": "Combine initNotificationChannel() and setUpUpdateNotificationChannel() into a single method.", "committedDate": "2020-10-07T05:32:57Z", "type": "forcePushed"}, {"oid": "58b720b004485172f82762063b1754fe9d063ae6", "url": "https://github.com/TeamNewPipe/NewPipe/commit/58b720b004485172f82762063b1754fe9d063ae6", "message": "Use ContextCompat.getSystemService() and the Context.getSystemService() extension function.", "committedDate": "2020-10-09T03:22:05Z", "type": "commit"}, {"oid": "c4084c4f97b9fb1d4f40a268d4faf3f2486ae891", "url": "https://github.com/TeamNewPipe/NewPipe/commit/c4084c4f97b9fb1d4f40a268d4faf3f2486ae891", "message": "Use ContextCompat.startForegroundService().", "committedDate": "2020-10-09T03:22:05Z", "type": "commit"}, {"oid": "f55381d689f3702ae084f3813cc286a65fd79aeb", "url": "https://github.com/TeamNewPipe/NewPipe/commit/f55381d689f3702ae084f3813cc286a65fd79aeb", "message": "Combine initNotificationChannel() and setUpUpdateNotificationChannel() into a single method.", "committedDate": "2020-10-09T03:22:05Z", "type": "commit"}, {"oid": "f55381d689f3702ae084f3813cc286a65fd79aeb", "url": "https://github.com/TeamNewPipe/NewPipe/commit/f55381d689f3702ae084f3813cc286a65fd79aeb", "message": "Combine initNotificationChannel() and setUpUpdateNotificationChannel() into a single method.", "committedDate": "2020-10-09T03:22:05Z", "type": "forcePushed"}]}