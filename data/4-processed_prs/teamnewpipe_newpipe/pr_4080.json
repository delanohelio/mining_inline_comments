{"pr_number": 4080, "pr_title": "Reduced CPU usage when playing a video by 7-10%", "pr_createdAt": "2020-08-05T10:40:01Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/4080", "timeline": [{"oid": "d7574973e97fa7a3a21aa59967311f6091941830", "url": "https://github.com/TeamNewPipe/NewPipe/commit/d7574973e97fa7a3a21aa59967311f6091941830", "message": "Reduced CPU usage when playing a video by 7-10%", "committedDate": "2020-08-05T09:46:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTYzNjYyMA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4080#discussion_r465636620", "bodyText": "I prefer line breaks at a logical place, i.e. start the next line at \"otherwise\". That's not really an issue though (so don't waste time changing it unless you happen to need to change something else in this PR as well). I'll take an actual look at the code later today (in like 2 hours).", "author": "wb9688", "createdAt": "2020-08-05T10:45:22Z", "path": "app/src/main/java/org/schabi/newpipe/fragments/detail/VideoDetailFragment.java", "diffHunk": "@@ -1771,8 +1770,17 @@ private void showPlaybackProgress(final long progress, final long duration) {\n         final int progressSeconds = (int) TimeUnit.MILLISECONDS.toSeconds(progress);\n         final int durationSeconds = (int) TimeUnit.MILLISECONDS.toSeconds(duration);\n         positionView.setMax(durationSeconds);\n-        positionView.setProgressAnimated(progressSeconds);\n-        detailPositionView.setText(Localization.getDurationString(progressSeconds));\n+        // If there is no player inside fragment use animation, otherwise don't because\n+        // it affects CPU", "originalCommit": "d7574973e97fa7a3a21aa59967311f6091941830", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTgzMjMxMg==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4080#discussion_r465832312", "bodyText": "So I took a look, but I don't understand in what case there would be no player in the fragment. I also think we shouldn't update the progress in the player when the controls aren't being shown.", "author": "wb9688", "createdAt": "2020-08-05T15:58:01Z", "path": "app/src/main/java/org/schabi/newpipe/fragments/detail/VideoDetailFragment.java", "diffHunk": "@@ -1771,8 +1770,17 @@ private void showPlaybackProgress(final long progress, final long duration) {\n         final int progressSeconds = (int) TimeUnit.MILLISECONDS.toSeconds(progress);\n         final int durationSeconds = (int) TimeUnit.MILLISECONDS.toSeconds(duration);\n         positionView.setMax(durationSeconds);\n-        positionView.setProgressAnimated(progressSeconds);\n-        detailPositionView.setText(Localization.getDurationString(progressSeconds));\n+        // If there is no player inside fragment use animation, otherwise don't because", "originalCommit": "d7574973e97fa7a3a21aa59967311f6091941830", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI5MTQzNA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4080#discussion_r466291434", "bodyText": "Start playing video in fragment, press popup button, voil\u00e0 - player is not in fragment and this progress bar still shows current position.\nAnother situation: play video, close it via notification. Same thing.\nSame with background playback. So this red progress bar at the bottom of thumbnail and it should be in sync with playback position from player.", "author": "avently", "createdAt": "2020-08-06T09:39:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTgzMjMxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA5NTkzOQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4080#discussion_r471095939", "bodyText": "Ah, I didn't think of that, but why would we still want an animation in those cases?", "author": "wb9688", "createdAt": "2020-08-16T10:35:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTgzMjMxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA5ODc2OA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4080#discussion_r471098768", "bodyText": "It is how it worked before me. And I think it looks cool. Open a video that you watched before and stopped on 50% of total duration. You'll see an animation. Isn't it cool?\nWhy do you want to remove it?", "author": "avently", "createdAt": "2020-08-16T11:04:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTgzMjMxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTEzNjczOQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4080#discussion_r471136739", "bodyText": "Ah, yes, that's cool, but won't this mean the additional CPU usage will still be there for e.g. the background player?\nSorry for the misunderstandings", "author": "wb9688", "createdAt": "2020-08-16T17:19:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTgzMjMxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE1MDkzNQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4080#discussion_r471150935", "bodyText": "Made better logic in this place. Now it's smart:)", "author": "avently", "createdAt": "2020-08-16T19:49:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTgzMjMxMg=="}], "type": "inlineReview"}, {"oid": "aed1687a45749b73386e0e79d0452396960893d9", "url": "https://github.com/TeamNewPipe/NewPipe/commit/aed1687a45749b73386e0e79d0452396960893d9", "message": "Improved an animation logic", "committedDate": "2020-08-16T19:44:27Z", "type": "commit"}]}