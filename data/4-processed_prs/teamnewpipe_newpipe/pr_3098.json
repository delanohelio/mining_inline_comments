{"pr_number": 3098, "pr_title": "Multiple localization fixes", "pr_createdAt": "2020-02-15T11:44:42Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/3098", "timeline": [{"oid": "f089cd027ebe1dc6088e3d7427e9d1c78352a815", "url": "https://github.com/TeamNewPipe/NewPipe/commit/f089cd027ebe1dc6088e3d7427e9d1c78352a815", "message": "Multiple localization fixes\n\nWith the extractor PR, fixes title & description shown in the wrong language.\nFixed views / spectators counts possibly in the wrong language\nFixed live spectators not showing full count on detail page\nFixed LIVE shown on players, it shows translated instead\n\nFixed Videos string in search / three dots not available in Weblate\n(because it was videos, but there already was a plural string named videos, in Weblate)\n\nSubscriber count is always giving the short count.\nWe can't get exact number since this YouTube update: https://support.google.com/youtube/thread/6543166\nBut only short count (B, M, k), so showing full number, eg for 1.9M: 1,900,000, is wrong because the number could be 1,923,490 or 1,897,789\u2026\n\nAdded a \u00ab sytem default \u00bb option to content language and country language selector.\nIt's the one selected by default (not en-GB anymore then), and correspond to the\nlanguage of the system / country of the system\nBy system I mean phone, tablet, TV\u2026\n\nFixed russian showing - before time ago (eg 19hrs ago)\nThis is a workaround fix, I opened an issue on prettytime library repo.\n\nFixed russian plurals:\nother was used instead of many for videos and subscribers\n\nFixed seek_duration english only", "committedDate": "2020-02-15T11:40:23Z", "type": "commit"}, {"oid": "ea54520e0b9b1b66a33f2503c50120ca31e3e7a5", "url": "https://github.com/TeamNewPipe/NewPipe/commit/ea54520e0b9b1b66a33f2503c50120ca31e3e7a5", "message": "Merge branch 'dev' into localisation", "committedDate": "2020-02-15T13:14:33Z", "type": "commit"}, {"oid": "5b541cc9fb4b784ffd7a99e583356d70c8966c9c", "url": "https://github.com/TeamNewPipe/NewPipe/commit/5b541cc9fb4b784ffd7a99e583356d70c8966c9c", "message": "resolve merge conflicts", "committedDate": "2020-02-15T13:53:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTgzMzE3Ng==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r379833176", "bodyText": "Please add a comment above that you initialize the seek duration list", "author": "TobiGr", "createdAt": "2020-02-15T14:00:27Z", "path": "app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java", "diffHunk": "@@ -21,6 +21,16 @@\n     public void onCreate(@Nullable Bundle savedInstanceState) {\n         super.onCreate(savedInstanceState);\n \n+        String[] durationsDescriptions = getResources().getStringArray(R.array.seek_duration_description);", "originalCommit": "ea54520e0b9b1b66a33f2503c50120ca31e3e7a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkxOTgzNQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r379919835", "bodyText": "done", "author": "B0pol", "createdAt": "2020-02-16T17:37:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTgzMzE3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTgzMzI1OA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r379833258", "bodyText": "This constant should be in a key", "author": "TobiGr", "createdAt": "2020-02-15T14:01:44Z", "path": "app/src/main/java/org/schabi/newpipe/util/Localization.java", "diffHunk": "@@ -84,13 +84,19 @@ public static String concatenateStrings(final List<String> strings) {\n         final String contentLanguage = PreferenceManager\n                 .getDefaultSharedPreferences(context)\n                 .getString(context.getString(R.string.content_language_key), context.getString(R.string.default_language_value));\n+        if (contentLanguage.equals(\"system\")) {", "originalCommit": "ea54520e0b9b1b66a33f2503c50120ca31e3e7a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTgzMzI3MQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r379833271", "bodyText": "See above", "author": "TobiGr", "createdAt": "2020-02-15T14:02:01Z", "path": "app/src/main/java/org/schabi/newpipe/util/Localization.java", "diffHunk": "@@ -84,13 +84,19 @@ public static String concatenateStrings(final List<String> strings) {\n         final String contentLanguage = PreferenceManager\n                 .getDefaultSharedPreferences(context)\n                 .getString(context.getString(R.string.content_language_key), context.getString(R.string.default_language_value));\n+        if (contentLanguage.equals(\"system\")) {\n+            return org.schabi.newpipe.extractor.localization.Localization.fromLocale(Locale.getDefault());\n+        }\n         return org.schabi.newpipe.extractor.localization.Localization.fromLocalizationCode(contentLanguage);\n     }\n \n     public static ContentCountry getPreferredContentCountry(final Context context) {\n         final String contentCountry = PreferenceManager\n                 .getDefaultSharedPreferences(context)\n                 .getString(context.getString(R.string.content_country_key), context.getString(R.string.default_country_value));\n+        if (contentCountry.equals(\"system\")) {", "originalCommit": "ea54520e0b9b1b66a33f2503c50120ca31e3e7a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTgzMzQyMA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r379833420", "bodyText": "see above", "author": "TobiGr", "createdAt": "2020-02-15T14:05:05Z", "path": "app/src/main/java/org/schabi/newpipe/util/Localization.java", "diffHunk": "@@ -226,8 +233,8 @@ private static void changeAppLanguage(Locale loc, Resources res) {\n     }\n \n     public static Locale getAppLocale(Context context) {\n-        SharedPreferences prefs = androidx.preference.PreferenceManager.getDefaultSharedPreferences(context);\n-        String lang = prefs.getString(\"app_language_key\", \"en\");\n+        SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(context);\n+        String lang = prefs.getString(context.getString(R.string.app_language_key), \"en\");\n         Locale loc;\n         if (lang.equals(\"system\")) {", "originalCommit": "ea54520e0b9b1b66a33f2503c50120ca31e3e7a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzMzU1Mg==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r379933552", "bodyText": "Since this function is exactly the same as shortSubscriberCount, wouldn't it be better to rename shortSubscriberCount  to localizeSubscriberCount? The output of the function is a normal (i.e. with no attributes about size) output, since it can't be considered small when comparing it to the normal output if the normal output does not exist ;-)\nNote: removed s from subscribers", "author": "Stypox", "createdAt": "2020-02-16T21:08:58Z", "path": "app/src/main/java/org/schabi/newpipe/util/Localization.java", "diffHunk": "@@ -132,14 +137,14 @@ public static String localizeViewCount(Context context, long viewCount) {\n         return getQuantity(context, R.plurals.views, R.string.no_views, viewCount, localizeNumber(context, viewCount));\n     }\n \n-    public static String localizeSubscribersCount(Context context, long subscriberCount) {", "originalCommit": "b5be78505b0bc69b674d9c372fd042b25017fcfc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzNDQzMg==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r379934432", "bodyText": "In the first commit\nSubscriber count is always giving the short count.\nWe can't get exact number since this YouTube update: https://support.google.com/youtube/thread/6543166\nBut only short count (B, M, k), so showing full number, eg for 1.9M: 1,900,000, is wrong because the number could be 1,923,490 or 1,897,789\u2026\n\nI sticked to this class \u00abconvention\u00bb\nshortSOMETHINGcount is giving the number with the abbreviation at the end (eg 5000000-> 5M in English US)\nlocalizeSOMETHINGcount is formatting the number (eg 5 million is 5,000,000 in English US but 5 000 000\u00a0in French).\nSo no, this is not the same. 5,000,000 != 5M.\nFor the s, I followed localizeViewCount (not views count)\nThen I don't really understand your comment. Can you re-explain please?", "author": "B0pol", "createdAt": "2020-02-16T21:23:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzMzU1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzNDkzNg==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r379934936", "bodyText": "Oh, my fault, I misunderstood something, this is good \ud83d\ude05", "author": "Stypox", "createdAt": "2020-02-16T21:30:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzMzU1Mg=="}], "type": "inlineReview"}, {"oid": "e62e34fd5cef0a265946b99bbb3e020ea6dbf39a", "url": "https://github.com/TeamNewPipe/NewPipe/commit/e62e34fd5cef0a265946b99bbb3e020ea6dbf39a", "message": "created default_localization_key", "committedDate": "2020-02-16T21:41:32Z", "type": "commit"}, {"oid": "e62e34fd5cef0a265946b99bbb3e020ea6dbf39a", "url": "https://github.com/TeamNewPipe/NewPipe/commit/e62e34fd5cef0a265946b99bbb3e020ea6dbf39a", "message": "created default_localization_key", "committedDate": "2020-02-16T21:41:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzODcxMQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r379938711", "bodyText": "This is not a proper value for seconds, it should be using plurals.\nTo save yet another translation string, maybe we can use a format like \"Seconds: %s\", or even just the number.", "author": "mauriciocolli", "createdAt": "2020-02-16T22:21:17Z", "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -594,4 +592,5 @@\n     <string name=\"choose_instance_prompt\">Choose an instance</string>\n     <string name=\"app_language_title\">App language</string>\n     <string name=\"systems_language\">System default</string>\n+    <string name=\"dynamic_seek_duration_description\">%s seconds</string>", "originalCommit": "e62e34fd5cef0a265946b99bbb3e020ea6dbf39a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzOTIzMg==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r379939232", "bodyText": "It's always plural: 5, 10, 15, 20, 25 seconds are all plurals.\nI disagree with only number, the result would be \nBut 5 what? Seconds, minutes, years? With only number, the user don't know.\nAnd I also disagree with Seconds: %s, to me with Fast forward / rewind seek duration it feels weird, it don't feel like a sentence. If you watch the rest of the menus, and list preferences, the title and entries stays natural, like a sentence.", "author": "B0pol", "createdAt": "2020-02-16T22:29:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzODcxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzOTcwNw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r379939707", "bodyText": "Well I agree with the mauricio. Some numbers might need special treatment in some languages.", "author": "TobiGr", "createdAt": "2020-02-16T22:36:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzODcxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzOTc0NQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r379939745", "bodyText": "It's always plural: 5, 10, 15, 20, 25 seconds are all plurals.\n\nSome languages have different forms depending on the quantity.\n\nI disagree with only number, the result would be\nBut 5 what? Seconds, minutes, years? With only number, the user don't know.\n\nTrue, the caption of the option would have to include the unit nonetheless.", "author": "mauriciocolli", "createdAt": "2020-02-16T22:36:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzODcxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA1OTg1NA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r380059854", "bodyText": "I used plural string and included few, many, other as zero, one and two will never be used.\nHandled the crash if the string is translated.\nAnd about giving only number or Seconds: %s, I think %s seconds is better.", "author": "B0pol", "createdAt": "2020-02-17T09:13:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzODcxMQ=="}], "type": "inlineReview"}, {"oid": "09d36a5dbc596e403d41d7f27ed69bf7c3c14151", "url": "https://github.com/TeamNewPipe/NewPipe/commit/09d36a5dbc596e403d41d7f27ed69bf7c3c14151", "message": "Merge branch 'dev' into localisation", "committedDate": "2020-02-17T08:27:03Z", "type": "commit"}, {"oid": "54f71c623a03af80dd9c27fd160d7e87fefca0dc", "url": "https://github.com/TeamNewPipe/NewPipe/commit/54f71c623a03af80dd9c27fd160d7e87fefca0dc", "message": "use plural string for dynamic_seek_duration_description", "committedDate": "2020-02-17T09:12:08Z", "type": "commit"}, {"oid": "54f71c623a03af80dd9c27fd160d7e87fefca0dc", "url": "https://github.com/TeamNewPipe/NewPipe/commit/54f71c623a03af80dd9c27fd160d7e87fefca0dc", "message": "use plural string for dynamic_seek_duration_description", "committedDate": "2020-02-17T09:12:08Z", "type": "forcePushed"}, {"oid": "55d17b556a4bc88c6c0e5e4a8f8d1c0f7a4a05f1", "url": "https://github.com/TeamNewPipe/NewPipe/commit/55d17b556a4bc88c6c0e5e4a8f8d1c0f7a4a05f1", "message": "added all the .iml files in gitignore, not only app.iml\n\nif somehow your module name isn't app, it will create a module-name.iml file, and isn't needed", "committedDate": "2020-02-17T09:18:20Z", "type": "commit"}, {"oid": "9912ee8199e188bf0660fda1f6f67ea9a67936db", "url": "https://github.com/TeamNewPipe/NewPipe/commit/9912ee8199e188bf0660fda1f6f67ea9a67936db", "message": "give info if content language is system on crash", "committedDate": "2020-02-18T17:35:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDgzMDE0Mw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r380830143", "bodyText": "Three questions:\n\nWhy is getContentLangString giving content country?\nShouldn't we build a localization and return its toString, with both content Language and content country?\nShould I use Locale.getDefault().toString() or another one from them (thanks stackoverflow) (I guess it will depend of the two answers above).\n\nLocale.getDefault().getLanguage()       ---> en      \nLocale.getDefault().getISO3Language()   ---> eng \nLocale.getDefault().getCountry()        ---> US \nLocale.getDefault().getISO3Country()    ---> USA \nLocale.getDefault().getDisplayCountry() ---> United States \nLocale.getDefault().getDisplayName()    ---> English (United States) \nLocale.getDefault().toString()          ---> en_US\nLocale.getDefault().getDisplayLanguage()---> English\nLocale.getDefault().toLanguageTag()     ---> en-US", "author": "B0pol", "createdAt": "2020-02-18T17:40:58Z", "path": "app/src/main/java/org/schabi/newpipe/report/ErrorActivity.java", "diffHunk": "@@ -377,8 +378,12 @@ private String getUserActionString(UserAction userAction) {\n     }\n \n     private String getContentLangString() {", "originalCommit": "9912ee8199e188bf0660fda1f6f67ea9a67936db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg0MTc5NQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r380841795", "bodyText": "That's a mistake. I already fixed it while working on #1816. However, I didn't push the changes. I'll rebase that branch and push it an Friday or Saturday. There was one thing which kept me from creating a PR though: I added extended debugging which allows one to get the documents which could not be parsed and attend them to the crash report. As a result the crash reports could easily be 1BM and more. Copying and pasting them into the a GitHub app or the browser caused serious lagging on my phone. So it might be better to store the documents in a .zip file and ask the user to upload it. I didn't have time to implement this.\nI added a content country field, too. I guess the best thing is to only print the codes which are stored in the app settings.\nShould be this. Locale.getDefault().toString()          ---> en_US", "author": "TobiGr", "createdAt": "2020-02-18T18:02:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDgzMDE0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMzODE4Ng==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r381338186", "bodyText": "This is now irrelevant because there is *.iml\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            app.iml", "author": "Stypox", "createdAt": "2020-02-19T14:48:04Z", "path": "app/.gitignore", "diffHunk": "@@ -1,3 +1,4 @@\n .gitignore\n /build\n app.iml", "originalCommit": "9912ee8199e188bf0660fda1f6f67ea9a67936db", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "316871714ac5ff548465884f68e944ed663b410e", "url": "https://github.com/TeamNewPipe/NewPipe/commit/316871714ac5ff548465884f68e944ed663b410e", "message": "Update app/.gitignore\n\nCo-Authored-By: Stypox <stypox@pm.me>", "committedDate": "2020-02-19T16:40:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0NTM2NQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r382145365", "bodyText": "Can you test whether \"other\" is enough here?\nres.getQuantityString(R.plurals.dynamic_seek_duration_description, currentDurationValue) should pick the correct one when \"few\" or \"many\" is needed by localization.", "author": "TobiGr", "createdAt": "2020-02-20T17:23:39Z", "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -594,4 +592,10 @@\n     <string name=\"choose_instance_prompt\">Choose an instance</string>\n     <string name=\"app_language_title\">App language</string>\n     <string name=\"systems_language\">System default</string>\n+    <string name=\"dynamic_seek_duration_description\">%s seconds</string>\n+    <plurals name=\"dynamic_seek_duration_description\">\n+        <item quantity=\"few\">%s seconds</item>\n+        <item quantity=\"many\">%s seconds</item>\n+        <item quantity=\"other\">%s seconds</item>\n+    </plurals>", "originalCommit": "316871714ac5ff548465884f68e944ed663b410e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE1MDc5NA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r382150794", "bodyText": "Yes, it is enough for English. However, I put all three because I don't know if Weblate will create if I didn't put them for the source string, will it?", "author": "B0pol", "createdAt": "2020-02-20T17:33:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0NTM2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE1OTk1Nw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r382159957", "bodyText": "Yes, weblate knows which language has supports the quantities.", "author": "TobiGr", "createdAt": "2020-02-20T17:51:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0NTM2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE2MjI1MQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3098#discussion_r382162251", "bodyText": "ok, done", "author": "B0pol", "createdAt": "2020-02-20T17:55:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0NTM2NQ=="}], "type": "inlineReview"}, {"oid": "9f9b53c067f65859d2b9519a37e99420ad04b296", "url": "https://github.com/TeamNewPipe/NewPipe/commit/9f9b53c067f65859d2b9519a37e99420ad04b296", "message": "remove unecessary \u00abfew\u00bb and \u00abmany\u00bb for plural string in english", "committedDate": "2020-02-20T17:55:22Z", "type": "commit"}, {"oid": "5680b7c4777039e23acc73f22c0c800b874f1bbb", "url": "https://github.com/TeamNewPipe/NewPipe/commit/5680b7c4777039e23acc73f22c0c800b874f1bbb", "message": "Merge branch 'dev' into localisation", "committedDate": "2020-02-21T13:34:40Z", "type": "commit"}]}