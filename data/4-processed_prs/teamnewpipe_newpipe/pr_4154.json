{"pr_number": 4154, "pr_title": "Prevent jumping of the player and wrong padding on devices with cutout", "pr_createdAt": "2020-08-17T17:26:16Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/4154", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY3NDA4Ng==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4154#discussion_r471674086", "bodyText": "That looks like it should be in DeviceUtils.", "author": "TobiGr", "createdAt": "2020-08-17T18:16:40Z", "path": "app/src/main/java/org/schabi/newpipe/player/VideoPlayerImpl.java", "diffHunk": "@@ -1565,6 +1571,20 @@ private int getStatusBarHeight() {\n         return statusBarHeight;\n     }\n \n+    /*\n+    * Compares current status bar height with default status bar height in Android and decides,\n+    * does the device has cutout or not\n+    * */\n+    private boolean hasCutout(final float statusBarHeight) {\n+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {\n+            final DisplayMetrics metrics = getRootView().getResources().getDisplayMetrics();\n+            final float defaultStatusBarHeight = TypedValue.applyDimension(\n+                    TypedValue.COMPLEX_UNIT_DIP, 25, metrics);\n+            return statusBarHeight > defaultStatusBarHeight;\n+        }\n+        return false;\n+    }\n+", "originalCommit": "fe90638897ea9dd1573f39797996594359176859", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE4MzI3MQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4154#discussion_r483183271", "bodyText": "Force-pushed (which was a bad idea but anyway) a commit with a new place for this code", "author": "avently", "createdAt": "2020-09-03T18:42:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY3NDA4Ng=="}], "type": "inlineReview"}, {"oid": "8030312924400d73084acb6bc0a7c1874c0e8e56", "url": "https://github.com/TeamNewPipe/NewPipe/commit/8030312924400d73084acb6bc0a7c1874c0e8e56", "message": "Prevent jumping of the player on devices with cutout", "committedDate": "2020-09-03T12:48:17Z", "type": "commit"}, {"oid": "e833d415e322eb83c65d2f8e9085f35d2ace2dc0", "url": "https://github.com/TeamNewPipe/NewPipe/commit/e833d415e322eb83c65d2f8e9085f35d2ace2dc0", "message": "Fixed wrong padding on devices with cutout on vertical videos", "committedDate": "2020-09-03T12:48:17Z", "type": "commit"}, {"oid": "b8a35e9e4aae29800739a1d2dd470e97e5327df3", "url": "https://github.com/TeamNewPipe/NewPipe/commit/b8a35e9e4aae29800739a1d2dd470e97e5327df3", "message": "Moved device-specific code into DeviceUtils", "committedDate": "2020-09-03T12:48:17Z", "type": "commit"}, {"oid": "b8a35e9e4aae29800739a1d2dd470e97e5327df3", "url": "https://github.com/TeamNewPipe/NewPipe/commit/b8a35e9e4aae29800739a1d2dd470e97e5327df3", "message": "Moved device-specific code into DeviceUtils", "committedDate": "2020-09-03T12:48:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyODA5MA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4154#discussion_r483328090", "bodyText": "Change to the following and it fixes landscape too.\n        // Prevent jumping of the player on devices with cutout\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {\n            if (isLandscape()) {\n                activity.getWindow().getAttributes().layoutInDisplayCutoutMode =\n                        WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES;\n            } else {\n                activity.getWindow().getAttributes().layoutInDisplayCutoutMode =\n                        WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_NEVER;\n            }\n        }", "author": "blackbox87", "createdAt": "2020-09-04T00:55:52Z", "path": "app/src/main/java/org/schabi/newpipe/fragments/detail/VideoDetailFragment.java", "diffHunk": "@@ -1995,6 +2000,11 @@ private void hideSystemUi() {\n             return;\n         }\n \n+        // Prevent jumping of the player on devices with cutout\n+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {\n+            activity.getWindow().getAttributes().layoutInDisplayCutoutMode =\n+                    WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_NEVER;\n+        }", "originalCommit": "b8a35e9e4aae29800739a1d2dd470e97e5327df3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM0NTc2OA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4154#discussion_r483345768", "bodyText": "I can do this but in this case a title and a description will be hidden under possible cutout from top right corner (in landscape orientation it will be in top left corner). I'm not sure about how much devices have such cutout but it's not an ideal choice anyway.", "author": "avently", "createdAt": "2020-09-04T02:07:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyODA5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM1Mzk2NA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4154#discussion_r483353964", "bodyText": "That's actually a separate issue that's caused by the status bar height (and navbar height?) not being accounted for while viewing a video in landscape. So I'm currently trying to work out the best way to center the controls.", "author": "blackbox87", "createdAt": "2020-09-04T02:41:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyODA5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM3MTYwMw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4154#discussion_r483371603", "bodyText": "Good to know that someone cares about it. Not only landscape mode has the problem with the centering but vertical videos too.", "author": "avently", "createdAt": "2020-09-04T03:58:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyODA5MA=="}], "type": "inlineReview"}]}