{"pr_number": 3133, "pr_title": "Change app id based on current git branch", "pr_createdAt": "2020-02-23T09:04:10Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/3133", "timeline": [{"oid": "a3bce7f7caf14f034fd550870bcbeaf5d04dee5e", "url": "https://github.com/TeamNewPipe/NewPipe/commit/a3bce7f7caf14f034fd550870bcbeaf5d04dee5e", "message": "Change app id based on current git branch\n\nThis enables to install multiple builds from different branches at once", "committedDate": "2020-02-23T08:46:42Z", "type": "commit"}, {"oid": "d46cd265f5f695d67fe1f25d26bc745a2d47d503", "url": "https://github.com/TeamNewPipe/NewPipe/commit/d46cd265f5f695d67fe1f25d26bc745a2d47d503", "message": "Merge branch 'dev' into gradle-app-id-suffix", "committedDate": "2020-02-23T09:04:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk4NzEyOA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3133#discussion_r382987128", "bodyText": "Uh, won't it add .debug and \" Debug\" to master? Because if I'm wide awake, with || workingBranch == \"master\" master is true on this if block, and has .debug suffix, and NewPipe Debug as name.\nHave you tried to apply your changes in the master branch and launch the app, to see what happens?", "author": "B0pol", "createdAt": "2020-02-23T09:27:38Z", "path": "app/build.gradle", "diffHunk": "@@ -28,7 +29,15 @@ android {\n         debug {\n             multiDexEnabled true\n             debuggable true\n-            applicationIdSuffix \".debug\"\n+\n+            def workingBranch = \"git rev-parse --abbrev-ref HEAD\".execute().text.trim()\n+            if (workingBranch.isEmpty() || workingBranch == \"master\" || workingBranch == \"dev\") {\n+                applicationIdSuffix \".debug\"\n+                resValue \"string\", \"app_name\", \"NewPipe Debug\"", "originalCommit": "d46cd265f5f695d67fe1f25d26bc745a2d47d503", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk4ODYxMw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3133#discussion_r382988613", "bodyText": "The branch name is independent from the build type. So we can have a release build on any branch and a debug build on the master branch. Gradle has no idea whether the current branch is a development branch or not, so it can't do decisions based on that.\nSo it is ok for a debug build on master branch to have .debug at the end", "author": "Stypox", "createdAt": "2020-02-23T09:48:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk4NzEyOA=="}], "type": "inlineReview"}, {"oid": "030e5ab894ed576e9e63332c6b08cdda090eade6", "url": "https://github.com/TeamNewPipe/NewPipe/commit/030e5ab894ed576e9e63332c6b08cdda090eade6", "message": "Add comment to gradle", "committedDate": "2020-02-23T19:56:56Z", "type": "commit"}, {"oid": "3434ff4d45bea55ca43fcaecf5bc71323cdeab0b", "url": "https://github.com/TeamNewPipe/NewPipe/commit/3434ff4d45bea55ca43fcaecf5bc71323cdeab0b", "message": "Merge branch 'gradle-app-id-suffix' of github.com:Stypox/NewPipe into gradle-app-id-suffix", "committedDate": "2020-02-23T19:57:50Z", "type": "commit"}, {"oid": "92f4010e8ee16f0ebebad91e9d217fa20e2e0418", "url": "https://github.com/TeamNewPipe/NewPipe/commit/92f4010e8ee16f0ebebad91e9d217fa20e2e0418", "message": "Add more checks to prevent build failures in gradle branch suffix\n\n- Add function `getGitWorkingBranch` that returns the current working branch, and \"\" if it could not be determined (either because git is not installed or because the directory is not a git repo).\n- Make sure normalizedWorkingBranch is not empty (leading to an invalid app id terminating with `.`)\n- Make normalizedWorkingBranch lowercase\n- Add comments", "committedDate": "2020-03-02T19:50:35Z", "type": "commit"}]}