{"pr_number": 5067, "pr_title": "Add a workaround for a possible null offset ID.", "pr_createdAt": "2020-12-02T04:15:26Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/5067", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTE5MTI1Mg==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/5067#discussion_r535191252", "bodyText": "Don't make a private method public for the sake of testing.\nInstead you should test the methods thats using the private method or extract the method into it's own class (not 100% sure on the second part myself yet)\nIn this case i would write tests for public static String relativeTime(final OffsetDateTime offsetDateTime). If done this way you will provide the value of having regression test for when the workaround is removed. Because currently your tests will need to be removed, when the workaround ist removed.", "author": "XiangRongLin", "createdAt": "2020-12-03T12:34:41Z", "path": "app/src/main/java/org/schabi/newpipe/util/Localization.java", "diffHunk": "@@ -328,7 +328,7 @@ public static String relativeTime(final Calendar calendarTime) {\n     // This method is a modified version of GregorianCalendar.from(ZonedDateTime).\n     // Math.addExact() and Math.multiplyExact() are desugared even though lint displays a warning.\n     @SuppressWarnings(\"NewApi\")\n-    private static GregorianCalendar fromUTC(final OffsetDateTime offsetDateTime) {\n+    public static GregorianCalendar fromUTC(final OffsetDateTime offsetDateTime) {", "originalCommit": "eeee9ef08661774018fd32e302646fca24bdff8d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTc0OTEzMQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/5067#discussion_r535749131", "bodyText": "I tried creating an instrumented test, but attempting to run it results in an error message saying that the test class cannot be found.", "author": "Isira-Seneviratne", "createdAt": "2020-12-04T00:35:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTE5MTI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg2MzAzMA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/5067#discussion_r535863030", "bodyText": "I'll open an pr to your branch tonight/tomorrow with what i mean. Maybe i missed something, that makes what i mean not possible.", "author": "XiangRongLin", "createdAt": "2020-12-04T06:19:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTE5MTI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk5ODU2Ng==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/5067#discussion_r535998566", "bodyText": "No, I get that you want to test Localization.relativeTime() directly, but I can't run the instrumented test, so I tested PrettyTime manually.", "author": "Isira-Seneviratne", "createdAt": "2020-12-04T10:31:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTE5MTI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI1MTc2OA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/5067#discussion_r536251768", "bodyText": "Ok, now i understand why you need an instrumented test. The dependency are direcly accessed and not injected. This would need some major refactoring, which can be done in another PR.", "author": "XiangRongLin", "createdAt": "2020-12-04T17:16:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTE5MTI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ0MzcwNg==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/5067#discussion_r536443706", "bodyText": "I created a PR with Dagger, so I could add a commit for DI with Localization there.", "author": "Isira-Seneviratne", "createdAt": "2020-12-04T23:30:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTE5MTI1Mg=="}], "type": "inlineReview"}, {"oid": "6c7a2165e64fda9ac576451771be2bc4f7bd5af6", "url": "https://github.com/TeamNewPipe/NewPipe/commit/6c7a2165e64fda9ac576451771be2bc4f7bd5af6", "message": "Add a workaround for a possible null offset ID.", "committedDate": "2020-12-02T04:09:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI1MzQ0MQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/5067#discussion_r536253441", "bodyText": "The tests are not covering the bug that you fixed. I can change back this line and your tests still pass successfully\nnvm, i realised my mistake.", "author": "XiangRongLin", "createdAt": "2020-12-04T17:19:44Z", "path": "app/src/main/java/org/schabi/newpipe/util/Localization.java", "diffHunk": "@@ -314,13 +318,33 @@ private static void initPrettyTime(final Context context) {\n     }\n \n     public static String relativeTime(final OffsetDateTime offsetDateTime) {\n-        return relativeTime(GregorianCalendar.from(offsetDateTime.toZonedDateTime()));\n+        return relativeTime(fromUTC(offsetDateTime));", "originalCommit": "c14e9ab349fd8070cf5aee31110ab881eb79a3c5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6bd01ead8b5050ef1e6b44749a6ac288a2cd323e", "url": "https://github.com/TeamNewPipe/NewPipe/commit/6bd01ead8b5050ef1e6b44749a6ac288a2cd323e", "message": "Add a workaround for a possible null offset ID.", "committedDate": "2020-12-10T09:21:38Z", "type": "forcePushed"}, {"oid": "b9138bcc60bbacfde090e9737a41ac520822c284", "url": "https://github.com/TeamNewPipe/NewPipe/commit/b9138bcc60bbacfde090e9737a41ac520822c284", "message": "Add a workaround for a possible null offset ID.", "committedDate": "2020-12-10T09:22:55Z", "type": "forcePushed"}, {"oid": "ca30c7a1b075eae6c9c47170097b1fd4aced2842", "url": "https://github.com/TeamNewPipe/NewPipe/commit/ca30c7a1b075eae6c9c47170097b1fd4aced2842", "message": "Add a workaround for a possible null offset ID.", "committedDate": "2020-12-10T09:38:58Z", "type": "forcePushed"}, {"oid": "c0d6c8aeb37490d8a0274c33e5b1557842147342", "url": "https://github.com/TeamNewPipe/NewPipe/commit/c0d6c8aeb37490d8a0274c33e5b1557842147342", "message": "Add a workaround for a possible null offset ID.", "committedDate": "2020-12-10T09:53:30Z", "type": "commit"}, {"oid": "c0d6c8aeb37490d8a0274c33e5b1557842147342", "url": "https://github.com/TeamNewPipe/NewPipe/commit/c0d6c8aeb37490d8a0274c33e5b1557842147342", "message": "Add a workaround for a possible null offset ID.", "committedDate": "2020-12-10T09:53:30Z", "type": "forcePushed"}]}