{"pr_number": 4345, "pr_title": "Fix PlaylistAppendDialog showing when no local playlists exist", "pr_createdAt": "2020-09-28T22:58:20Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/4345", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQyOTgwNA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4345#discussion_r496429804", "bodyText": "Maybe use different names here, like onPlaylistFound", "author": "Stypox", "createdAt": "2020-09-29T05:39:51Z", "path": "app/src/main/java/org/schabi/newpipe/local/dialog/PlaylistAppendDialog.java", "diffHunk": "@@ -38,6 +40,27 @@\n \n     private CompositeDisposable playlistDisposables = new CompositeDisposable();\n \n+    public static Disposable checkPlaylists(\n+            final Context context, final Invoker onSuccess, final Invoker onFailed", "originalCommit": "6a7a83cb9a66924cf0829f706007b5552bff3c89", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQzMDY5NQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4345#discussion_r496430695", "bodyText": "You can just use a Runnable instead", "author": "Stypox", "createdAt": "2020-09-29T05:42:45Z", "path": "app/src/main/java/org/schabi/newpipe/local/dialog/PlaylistAppendDialog.java", "diffHunk": "@@ -38,6 +40,27 @@\n \n     private CompositeDisposable playlistDisposables = new CompositeDisposable();\n \n+    public static Disposable checkPlaylists(\n+            final Context context, final Invoker onSuccess, final Invoker onFailed\n+    ) {\n+        final LocalPlaylistManager playlistManager =\n+                new LocalPlaylistManager(NewPipeDatabase.getInstance(context));\n+\n+        return playlistManager.hasPlaylists()\n+                .observeOn(AndroidSchedulers.mainThread())\n+                .subscribe(hasPlaylists -> {\n+                    if (hasPlaylists) {\n+                        onSuccess.invoke();\n+                    } else {\n+                        onFailed.invoke();\n+                    }\n+                });\n+    }\n+\n+    public interface Invoker {", "originalCommit": "6a7a83cb9a66924cf0829f706007b5552bff3c89", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQzMTQ2OA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4345#discussion_r496431468", "bodyText": "Should't this return a Single? Is it impossible for the database getCount to return a Single? I might be wrong", "author": "Stypox", "createdAt": "2020-09-29T05:45:21Z", "path": "app/src/main/java/org/schabi/newpipe/local/playlist/LocalPlaylistManager.java", "diffHunk": "@@ -126,4 +126,10 @@ public String getPlaylistThumbnail(final long playlistId) {\n                 }).subscribeOn(Schedulers.io());\n     }\n \n+    public Maybe<Boolean> hasPlaylists() {", "originalCommit": "6a7a83cb9a66924cf0829f706007b5552bff3c89", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYzMjI1OQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4345#discussion_r496632259", "bodyText": "I've tried Single (.single(0L) on Flowable) but the subscribe-block won't be called (I logged it).", "author": "vkay94", "createdAt": "2020-09-29T11:09:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQzMTQ2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQzMjM2OQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4345#discussion_r496432369", "bodyText": "Maybe extract this code to a function so that it can be reused above", "author": "Stypox", "createdAt": "2020-09-29T05:48:26Z", "path": "app/src/main/java/org/schabi/newpipe/util/StreamDialogEntry.java", "diffHunk": "@@ -40,8 +41,14 @@\n \n     append_playlist(R.string.append_playlist, (fragment, item) -> {\n         if (fragment.getFragmentManager() != null) {\n-            PlaylistAppendDialog.fromStreamInfoItems(Collections.singletonList(item))\n-                    .show(fragment.getFragmentManager(), \"StreamDialogEntry@append_playlist\");\n+            final PlaylistAppendDialog d = PlaylistAppendDialog\n+                    .fromStreamInfoItems(Collections.singletonList(item));", "originalCommit": "6a7a83cb9a66924cf0829f706007b5552bff3c89", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYzODQ4Mw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4345#discussion_r496638483", "bodyText": "I'm not sure what you mean by \"extract\" in this context. Probably a wrapper for the check- and show-logic? Something like one signature:\nstatic Disposable safeShow(context, fm, tag, <input>)\nwhere input is either StreamInfo or List<StreamInfoItem> or List<PlayQueueItem> (by overriding).", "author": "vkay94", "createdAt": "2020-09-29T11:21:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQzMjM2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY1MTkwNA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4345#discussion_r496651904", "bodyText": "Oh, sorry, since the two blocks of code actually do different things you can ignore this suggestion", "author": "Stypox", "createdAt": "2020-09-29T11:46:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQzMjM2OQ=="}], "type": "inlineReview"}, {"oid": "2680d41a3dff08aa5505da4aec0f67ff3f4155c8", "url": "https://github.com/TeamNewPipe/NewPipe/commit/2680d41a3dff08aa5505da4aec0f67ff3f4155c8", "message": "Fix PlaylistAppendDialog showing when no local playlists exist", "committedDate": "2020-10-23T07:44:26Z", "type": "commit"}, {"oid": "32a142bf79351272c56e745b3a1f2052a0e5679b", "url": "https://github.com/TeamNewPipe/NewPipe/commit/32a142bf79351272c56e745b3a1f2052a0e5679b", "message": "Fix PlaylistAppendDialog: Renamed method and replaced with Runnable", "committedDate": "2020-10-23T07:44:26Z", "type": "commit"}, {"oid": "32a142bf79351272c56e745b3a1f2052a0e5679b", "url": "https://github.com/TeamNewPipe/NewPipe/commit/32a142bf79351272c56e745b3a1f2052a0e5679b", "message": "Fix PlaylistAppendDialog: Renamed method and replaced with Runnable", "committedDate": "2020-10-23T07:44:26Z", "type": "forcePushed"}]}