{"pr_number": 3471, "pr_title": "Display search suggestion: did you mean & showing result for", "pr_createdAt": "2020-04-22T16:30:54Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/3471", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE0ODc2Nw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3471#discussion_r413148767", "bodyText": "Why? We pretty much never use tools:text, and \"Did you mean: z101bara\" is of course bs, as \"z101bara\" is the incorrect search query, which it would obviously never suggest.", "author": "wb9688", "createdAt": "2020-04-22T16:51:02Z", "path": "app/src/main/res/layout/fragment_search.xml", "diffHunk": "@@ -6,13 +6,46 @@\n     android:layout_width=\"match_parent\"\n     android:layout_height=\"match_parent\">\n \n+    <LinearLayout\n+        android:id=\"@+id/correct_suggestion_panel\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_alignTop=\"@id/error_panel\"\n+        android:layout_marginTop=\"0dp\"\n+        android:orientation=\"horizontal\">\n+\n+        <TextView\n+            android:id=\"@+id/correct_suggestion_helper_text\"\n+            android:layout_width=\"wrap_content\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_marginStart=\"10dp\"\n+            android:layout_marginTop=\"10dp\"\n+            android:layout_marginBottom=\"10dp\"\n+            android:textSize=\"@dimen/search_suggestion_helper_text_size\"\n+            android:textStyle=\"normal\"\n+            tools:text=\"@string/did_you_mean\" />\n+\n+        <TextView\n+            android:id=\"@+id/correct_suggestion_text\"\n+            android:layout_width=\"0dp\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_gravity=\"center_vertical\"\n+            android:layout_marginStart=\"5dp\"\n+            android:layout_weight=\"1\"\n+            android:textColor=\"@color/background_title_color\"\n+            android:textSize=\"@dimen/search_suggestion_text_size\"\n+            android:textStyle=\"bold|italic\"\n+            tools:text=\"z101bara\" />", "originalCommit": "3fd872ca54fb9107cfbb764cb120c3e53fffb56c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE2MDU2Nw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3471#discussion_r413160567", "bodyText": "Haha, I know it's BS, it was written for the sake of preview in the Android Studio designer. Would you like me to remove it?", "author": "Royosef", "createdAt": "2020-04-22T17:07:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE0ODc2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE3NjQyNQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3471#discussion_r413176425", "bodyText": "If you're going to put something there, do something that's not BS such as \"newpipe\"", "author": "wb9688", "createdAt": "2020-04-22T17:29:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE0ODc2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE0OTEyNw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3471#discussion_r413149127", "bodyText": "What did you base the text size on?", "author": "wb9688", "createdAt": "2020-04-22T16:51:32Z", "path": "app/src/main/res/values/dimens.xml", "diffHunk": "@@ -112,4 +112,7 @@\n     <dimen name=\"feed_group_carousel_top_bottom_margin\">2dp</dimen>\n     <dimen name=\"feed_group_carousel_between_items_margin\">4dp</dimen>\n \n+    <dimen name=\"search_suggestion_text_size\">16sp</dimen>\n+    <dimen name=\"search_suggestion_helper_text_size\">14sp</dimen>", "originalCommit": "3fd872ca54fb9107cfbb764cb120c3e53fffb56c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE2MjYzMQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3471#discussion_r413162631", "bodyText": "Nothing specific, I tried some numbers until it was looking good.", "author": "Royosef", "createdAt": "2020-04-22T17:10:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE0OTEyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE1MjYyOQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3471#discussion_r413152629", "bodyText": "you shouldn't do like that, format using %s or %1$s: some languages could be like:\nnewpipe: mean you did or\nnewpipe showing results for. (not all languages are like English).", "author": "B0pol", "createdAt": "2020-04-22T16:56:20Z", "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -646,4 +646,6 @@\n     <string name=\"feed_use_dedicated_fetch_method_disable_button\">Disable fast mode</string>\n     <string name=\"feed_use_dedicated_fetch_method_help_text\">Do you think feed loading is too slow? If so, try enabling fast loading (you can change it in settings or by pressing the button below).\\n\\nNewPipe offers two feed loading strategies:\\n\u2022 Fetching the whole subscription channel, which is slow but complete.\\n\u2022 Using a dedicated service endpoint, which is fast but usually not complete.\\n\\nThe difference between the two is that the fast one usually lacks some information, like the item\\'s duration or type (can\\'t distinguish between live videos and normal ones) and it may return less items.\\n\\nYouTube is an example of a service that offers this fast method with its RSS feed.\\n\\nSo the choice boils down to what you prefer: speed or precise information.</string>\n     <string name=\"content_not_supported\">This content is not yet supported by NewPipe.\\n\\nIt will hopefully be supported in a future version.</string>\n+    <string name=\"search_showing_result_for\">Showing results for</string>\n+    <string name=\"search_did_you_mean\">Did you mean:</string>", "originalCommit": "3fd872ca54fb9107cfbb764cb120c3e53fffb56c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE1NTAzMQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3471#discussion_r413155031", "bodyText": "That's true indeed, however how will you do the differently styled suggestion then?", "author": "wb9688", "createdAt": "2020-04-22T16:59:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE1MjYyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE3MTU1NQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3471#discussion_r413171555", "bodyText": "Yeah, but I think this would happen specifically in languages that are RTL (like Hebrew or Arabic), and in this case I assume the whole layout is mirrored to RTL (and at least for Hebrew and Arabic, I know this is the way it's supposed to be).", "author": "Royosef", "createdAt": "2020-04-22T17:22:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE1MjYyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE4MzY0OA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3471#discussion_r413183648", "bodyText": "@wb9688\n\nUsing Markwon, a markdown library we already use for PeerTube descriptions, and surround the word in with ** (bold in markdown), like: Showing results for **%1$s**. See VideoDetailFragment#prepareDescription() for an usage. It's the easiest solution.\nUsing spannable, see https://stackoverflow.com/questions/20936901/combining-spannable-with-string-format . But it seems harder, and not better.\n\n@Royosef It's false, go in Settings -> Content -> App language, pick Arabic, the second language (actually the first after system default), you'll see nothing is changed except text. As it's two different TextViews, it won't work as you think, and that's why you need to format.\nBy the way, you have to remove this string\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <string name=\"search_did_you_mean\">Did you mean:</string>\n          \n      \n    \n    \n  \n\nUse or edit the already existing did_you_mean string, it's unused.", "author": "B0pol", "createdAt": "2020-04-22T17:38:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE1MjYyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzIwNDM3NA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3471#discussion_r413204374", "bodyText": "@B0pol: Not really a good idea, as you could have service return weird characters that would make the formatting weird. In this case I'd probably choose for just having e.g. Did you mean \"%s\"? and Showing results for \"%s\" with normal formatting.", "author": "wb9688", "createdAt": "2020-04-22T18:07:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE1MjYyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzIyNjI1Nw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3471#discussion_r413226257", "bodyText": "So, @B0pol, are you cool with a plain string format?", "author": "Royosef", "createdAt": "2020-04-22T18:38:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE1MjYyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI0NjcxNg==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3471#discussion_r413246716", "bodyText": "I don't see how something like that could happen. But yes", "author": "B0pol", "createdAt": "2020-04-22T19:07:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE1MjYyOQ=="}], "type": "inlineReview"}, {"oid": "cb4da912f243f693e55a73748aa30d02401c984a", "url": "https://github.com/TeamNewPipe/NewPipe/commit/cb4da912f243f693e55a73748aa30d02401c984a", "message": "fix(PR-review): use string format & remove redundant strings\n\n* Merge correct_suggestion_text and search_suggestion_helper_text_size to one with string format\n* Remove redundant string search_showing_result_for and use already defined did_you_mean", "committedDate": "2020-05-12T07:46:12Z", "type": "forcePushed"}, {"oid": "7714b8ef609a89eaf3721143d3a7641da28e3497", "url": "https://github.com/TeamNewPipe/NewPipe/commit/7714b8ef609a89eaf3721143d3a7641da28e3497", "message": "fix(PR-review): use string format & remove redundant strings\n\n* Merge correct_suggestion_text and search_suggestion_helper_text_size to one with string format\n* Remove redundant string search_showing_result_for and use already defined did_you_mean", "committedDate": "2020-05-12T07:52:20Z", "type": "forcePushed"}, {"oid": "8403ca93ce20ce91f81008a3b0a47fcfaa457f73", "url": "https://github.com/TeamNewPipe/NewPipe/commit/8403ca93ce20ce91f81008a3b0a47fcfaa457f73", "message": "fix(search-suggestions-not-working-on-resume)\n\n* add searchSuggestionString, isCorrectedSearch fields to state and load onResume", "committedDate": "2020-06-14T08:01:02Z", "type": "forcePushed"}, {"oid": "5c8d1bf68bb7be127b7d745b71a94c5a2ee60be1", "url": "https://github.com/TeamNewPipe/NewPipe/commit/5c8d1bf68bb7be127b7d745b71a94c5a2ee60be1", "message": "fix(search-suggestions-not-working-on-resume)\n\n* add searchSuggestionString, isCorrectedSearch fields to state and load onResume", "committedDate": "2020-06-14T08:06:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI3MzU0Ng==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3471#discussion_r440273546", "bodyText": "handleSearchSuggestion already checks if (!TextUtils.isEmpty(searchSuggestionString))", "author": "B0pol", "createdAt": "2020-06-15T15:48:19Z", "path": "app/src/main/java/org/schabi/newpipe/fragments/list/search/SearchFragment.java", "diffHunk": "@@ -257,6 +266,10 @@ public void onResume() {\n             }\n         }\n \n+        if (!TextUtils.isEmpty(searchSuggestionString)) {\n+            handleSearchSuggestion(searchSuggestionString, isCorrectedSearch);", "originalCommit": "5c8d1bf68bb7be127b7d745b71a94c5a2ee60be1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI3MzU5Mg==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3471#discussion_r440273592", "bodyText": "why do you save it after calling handleSearchSuggestion()? here you call result.getSearchSuggestion() and result.isCorrectedSearch() twice.", "author": "B0pol", "createdAt": "2020-06-15T15:48:24Z", "path": "app/src/main/java/org/schabi/newpipe/fragments/list/search/SearchFragment.java", "diffHunk": "@@ -961,6 +981,10 @@ public void handleResult(@NonNull final SearchInfo result) {\n                     NewPipe.getNameOfService(serviceId), searchString, 0);\n         }\n \n+        handleSearchSuggestion(result.getSearchSuggestion(), result.isCorrectedSearch());\n+\n+        searchSuggestionString = result.getSearchSuggestion();\n+        isCorrectedSearch = result.isCorrectedSearch();", "originalCommit": "5c8d1bf68bb7be127b7d745b71a94c5a2ee60be1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwOTc3Ng==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3471#discussion_r449809776", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        android:textSize=\"@dimen/search_suggestion_text_size\" />\n          \n          \n            \n                        android:textSize=\"@dimen/search_suggestion_text_size\"\n          \n          \n            \n                        tools:text=\"Showing results for lorem ipsum dolor sit amet consectetur adipisci elit\" />", "author": "Stypox", "createdAt": "2020-07-04T22:19:25Z", "path": "app/src/main/res/layout/fragment_search.xml", "diffHunk": "@@ -6,13 +6,34 @@\n     android:layout_width=\"match_parent\"\n     android:layout_height=\"match_parent\">\n \n+    <LinearLayout\n+        android:id=\"@+id/correct_suggestion_panel\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_alignTop=\"@id/error_panel\"\n+        android:layout_marginTop=\"0dp\"\n+        android:orientation=\"horizontal\">\n+\n+        <TextView\n+            android:id=\"@+id/correct_suggestion_text\"\n+            android:layout_width=\"0dp\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_marginStart=\"10dp\"\n+            android:layout_marginTop=\"10dp\"\n+            android:layout_marginBottom=\"10dp\"\n+            android:layout_weight=\"1\"\n+            android:textColor=\"@color/background_title_color\"\n+            android:textSize=\"@dimen/search_suggestion_text_size\" />", "originalCommit": "fc7189341fa8ac08a2d1730185b1caeac524e46f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwOTgwNw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3471#discussion_r449809807", "bodyText": "Why nesting inside a linearlayout?", "author": "Stypox", "createdAt": "2020-07-04T22:20:07Z", "path": "app/src/main/res/layout/fragment_search.xml", "diffHunk": "@@ -6,13 +6,34 @@\n     android:layout_width=\"match_parent\"\n     android:layout_height=\"match_parent\">\n \n+    <LinearLayout", "originalCommit": "fc7189341fa8ac08a2d1730185b1caeac524e46f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cce44a1a2a8709e5eac77dc446c7cb23a3674146", "url": "https://github.com/TeamNewPipe/NewPipe/commit/cce44a1a2a8709e5eac77dc446c7cb23a3674146", "message": "Replace search query without searching on suggestion panel long click", "committedDate": "2020-07-04T22:46:02Z", "type": "forcePushed"}, {"oid": "a1b6746627e9dac3a0b8ac2a1319701b65a3dc82", "url": "https://github.com/TeamNewPipe/NewPipe/commit/a1b6746627e9dac3a0b8ac2a1319701b65a3dc82", "message": "Replace search query without searching on suggestion panel long click", "committedDate": "2020-07-04T22:49:38Z", "type": "forcePushed"}, {"oid": "cce99046c82bba0820ade4eaeda6fef60d212669", "url": "https://github.com/TeamNewPipe/NewPipe/commit/cce99046c82bba0820ade4eaeda6fef60d212669", "message": "Replace search query without searching on suggestion panel long click", "committedDate": "2020-07-05T19:57:13Z", "type": "forcePushed"}, {"oid": "4194ac2226a35aefc2df3fca33dbf635059b88e2", "url": "https://github.com/TeamNewPipe/NewPipe/commit/4194ac2226a35aefc2df3fca33dbf635059b88e2", "message": "Display search suggestion: did you mean & showing result for", "committedDate": "2020-07-05T20:01:35Z", "type": "commit"}, {"oid": "0711650ff8c7827bdfee8d0b6b5fcb24b412903d", "url": "https://github.com/TeamNewPipe/NewPipe/commit/0711650ff8c7827bdfee8d0b6b5fcb24b412903d", "message": "Fix search suggestions not working on resume\n\n* add searchSuggestionString, isCorrectedSearch fields to state and load onResume", "committedDate": "2020-07-05T20:01:35Z", "type": "commit"}, {"oid": "ccd82fb8b8dccddafa47a176d969a5eeee8297a2", "url": "https://github.com/TeamNewPipe/NewPipe/commit/ccd82fb8b8dccddafa47a176d969a5eeee8297a2", "message": "Improve search suggestion code", "committedDate": "2020-07-05T20:01:35Z", "type": "commit"}, {"oid": "20e828be514bcafe7eab21ad520a2d814c0c2770", "url": "https://github.com/TeamNewPipe/NewPipe/commit/20e828be514bcafe7eab21ad520a2d814c0c2770", "message": "Improve suggestion panel", "committedDate": "2020-07-05T20:01:35Z", "type": "commit"}, {"oid": "13a0d1de70b664bc1548845268f2689d912ae303", "url": "https://github.com/TeamNewPipe/NewPipe/commit/13a0d1de70b664bc1548845268f2689d912ae303", "message": "Replace search query without searching on suggestion panel long click", "committedDate": "2020-07-05T20:01:35Z", "type": "commit"}, {"oid": "13a0d1de70b664bc1548845268f2689d912ae303", "url": "https://github.com/TeamNewPipe/NewPipe/commit/13a0d1de70b664bc1548845268f2689d912ae303", "message": "Replace search query without searching on suggestion panel long click", "committedDate": "2020-07-05T20:01:35Z", "type": "forcePushed"}, {"oid": "b96d1714b50728bdde81eff125174ba220d697e9", "url": "https://github.com/TeamNewPipe/NewPipe/commit/b96d1714b50728bdde81eff125174ba220d697e9", "message": "Highlight search suggestion", "committedDate": "2020-07-07T18:23:41Z", "type": "commit"}, {"oid": "b96d1714b50728bdde81eff125174ba220d697e9", "url": "https://github.com/TeamNewPipe/NewPipe/commit/b96d1714b50728bdde81eff125174ba220d697e9", "message": "Highlight search suggestion", "committedDate": "2020-07-07T18:23:41Z", "type": "forcePushed"}]}