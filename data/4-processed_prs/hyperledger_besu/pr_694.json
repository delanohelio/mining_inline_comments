{"pr_number": 694, "pr_title": "[EIP-1559] Step 7 - Check transaction format for send raw transaction", "pr_createdAt": "2020-04-09T15:35:38Z", "pr_url": "https://github.com/hyperledger/besu/pull/694", "timeline": [{"oid": "ba37fd0efcba2de4ea34c979060ff361a1fe9798", "url": "https://github.com/hyperledger/besu/commit/ba37fd0efcba2de4ea34c979060ff361a1fe9798", "message": "Added changelog entries for PR:\n- https://github.com/hyperledger/besu/pull/430\n- https://github.com/hyperledger/besu/pull/440\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-03-12T09:09:40Z", "type": "commit"}, {"oid": "872f9cc4e93b90829961ebe6e599c51af43c95a7", "url": "https://github.com/hyperledger/besu/commit/872f9cc4e93b90829961ebe6e599c51af43c95a7", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>\n\n# Conflicts:\n#\tCHANGELOG.md", "committedDate": "2020-03-13T08:25:43Z", "type": "commit"}, {"oid": "e417b30e90cb0b33940adb1bee6a9dc8953c4abd", "url": "https://github.com/hyperledger/besu/commit/e417b30e90cb0b33940adb1bee6a9dc8953c4abd", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-03-16T09:10:11Z", "type": "commit"}, {"oid": "a2fb831c87dae221c92a9f9ec7705500717f1e77", "url": "https://github.com/hyperledger/besu/commit/a2fb831c87dae221c92a9f9ec7705500717f1e77", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-03-17T09:17:25Z", "type": "commit"}, {"oid": "c07ed7de515e1e25ea22ef38b59bf8337086812e", "url": "https://github.com/hyperledger/besu/commit/c07ed7de515e1e25ea22ef38b59bf8337086812e", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-03-17T15:26:18Z", "type": "commit"}, {"oid": "1c1e22fe5a81e6a748b338a2ebedaaa53a00f04d", "url": "https://github.com/hyperledger/besu/commit/1c1e22fe5a81e6a748b338a2ebedaaa53a00f04d", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-03-18T08:29:25Z", "type": "commit"}, {"oid": "ee10a2590d8e23b95a40c946a2927730714c4793", "url": "https://github.com/hyperledger/besu/commit/ee10a2590d8e23b95a40c946a2927730714c4793", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-03-19T16:27:54Z", "type": "commit"}, {"oid": "40cd31d7b48aab7b285524661ac17168c0d38467", "url": "https://github.com/hyperledger/besu/commit/40cd31d7b48aab7b285524661ac17168c0d38467", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-03-23T10:35:38Z", "type": "commit"}, {"oid": "e96c01a8ca248ded2aa4f22a6f56d9119cabebf2", "url": "https://github.com/hyperledger/besu/commit/e96c01a8ca248ded2aa4f22a6f56d9119cabebf2", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-03-25T08:04:10Z", "type": "commit"}, {"oid": "2c782ba4617a68e42def01737bdc6950ff7f9f53", "url": "https://github.com/hyperledger/besu/commit/2c782ba4617a68e42def01737bdc6950ff7f9f53", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-03-31T09:26:18Z", "type": "commit"}, {"oid": "8b7f62d00c53ed1e8de940bffc675fad31825ba2", "url": "https://github.com/hyperledger/besu/commit/8b7f62d00c53ed1e8de940bffc675fad31825ba2", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-02T11:50:21Z", "type": "commit"}, {"oid": "ce2a4c9a0d600f1309fc1a6e3be8c3d04c0e543a", "url": "https://github.com/hyperledger/besu/commit/ce2a4c9a0d600f1309fc1a6e3be8c3d04c0e543a", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-03T08:45:52Z", "type": "commit"}, {"oid": "97fc9b5900c05a3f4c18183e1b861fd86b6152b6", "url": "https://github.com/hyperledger/besu/commit/97fc9b5900c05a3f4c18183e1b861fd86b6152b6", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-06T10:50:47Z", "type": "commit"}, {"oid": "95947ab35e9145c5f788bb98ad1068a3db7a4895", "url": "https://github.com/hyperledger/besu/commit/95947ab35e9145c5f788bb98ad1068a3db7a4895", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-06T12:24:48Z", "type": "commit"}, {"oid": "63cc0286ffd370cf8e82ede9066b2bd473536ce1", "url": "https://github.com/hyperledger/besu/commit/63cc0286ffd370cf8e82ede9066b2bd473536ce1", "message": "Merge branch 'master' of https://github.com/hyperledger/besu", "committedDate": "2020-04-07T11:27:43Z", "type": "commit"}, {"oid": "6c836959d7bf7da960ebe4e063016f1f191e1467", "url": "https://github.com/hyperledger/besu/commit/6c836959d7bf7da960ebe4e063016f1f191e1467", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-09T07:57:49Z", "type": "commit"}, {"oid": "f9ff23076dd7eded030cc3edb315086c67d6ce70", "url": "https://github.com/hyperledger/besu/commit/f9ff23076dd7eded030cc3edb315086c67d6ce70", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-09T11:17:24Z", "type": "commit"}, {"oid": "60df7f8825f51f3c6b89274c59cec13ea8ce37fd", "url": "https://github.com/hyperledger/besu/commit/60df7f8825f51f3c6b89274c59cec13ea8ce37fd", "message": "Check transaction format for send raw transaction\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-09T15:25:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI5ODQ0NA==", "url": "https://github.com/hyperledger/besu/pull/694#discussion_r406298444", "bodyText": "This feels like it should be in MainnetTransactionValidator instead, with two new constructor args.  If we get a third format we can go to an enum set or bitfield.  As part of validate(final Transaction transaction) we check the valid types against the booleans or enum set/bitfield.  Perhaps we need to define two forks for testing, EIP1559 and EIP1559Only", "author": "shemnon", "createdAt": "2020-04-09T15:43:09Z", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/fees/EIP1559.java", "diffHunk": "@@ -76,6 +79,23 @@ public long getForkBlock() {\n     return initialForkBlknum;\n   }\n \n+  public boolean isValid(final Transaction transaction, final LongSupplier blockNumberSupplier) {", "originalCommit": "60df7f8825f51f3c6b89274c59cec13ea8ce37fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMzNDM1Mw==", "url": "https://github.com/hyperledger/besu/pull/694#discussion_r406334353", "bodyText": "Done", "author": "abdelhamidbakhta", "createdAt": "2020-04-09T16:40:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI5ODQ0NA=="}], "type": "inlineReview"}, {"oid": "5c322f1b670347b389848ab7c325ce7e43a6876e", "url": "https://github.com/hyperledger/besu/commit/5c322f1b670347b389848ab7c325ce7e43a6876e", "message": "Merge remote-tracking branch 'upstream/master' into eip1559-step7\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-09T16:02:22Z", "type": "commit"}, {"oid": "ee56b8c0703b94a3e0beeb0de8a228d1998becea", "url": "https://github.com/hyperledger/besu/commit/ee56b8c0703b94a3e0beeb0de8a228d1998becea", "message": "Address PR comments\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-09T16:40:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMzNzgzOA==", "url": "https://github.com/hyperledger/besu/pull/694#discussion_r406337838", "bodyText": "I don't think we need any of this logic in the RPC stub. MainnetTransacitonValidator should be catching it when we try and addLocalTransaction.  The RPC stub should have no knowledge of the internals of the block chain.", "author": "shemnon", "createdAt": "2020-04-09T16:46:26Z", "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/methods/EthSendRawTransaction.java", "diffHunk": "@@ -99,4 +114,26 @@ private Transaction decodeRawTransaction(final String hash)\n       throw new InvalidJsonRpcRequestException(\"Invalid raw transaction hex\", e);\n     }\n   }\n+\n+  private Transaction checkEIP1559(final Transaction transaction)", "originalCommit": "ee56b8c0703b94a3e0beeb0de8a228d1998becea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjM0NTE2MA==", "url": "https://github.com/hyperledger/besu/pull/694#discussion_r406345160", "bodyText": "Ok done.", "author": "abdelhamidbakhta", "createdAt": "2020-04-09T16:58:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMzNzgzOA=="}], "type": "inlineReview"}, {"oid": "e68cc2980a5078936e80231958ce5dd8c2fac289", "url": "https://github.com/hyperledger/besu/commit/e68cc2980a5078936e80231958ce5dd8c2fac289", "message": "Address PR comments\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-09T16:59:40Z", "type": "commit"}, {"oid": "db1d528ab341f2d1189a04197f1eed5ee959b47b", "url": "https://github.com/hyperledger/besu/commit/db1d528ab341f2d1189a04197f1eed5ee959b47b", "message": "Merge remote-tracking branch 'upstream/master' into eip1559-step7\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-09T16:59:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjM4MjMzOA==", "url": "https://github.com/hyperledger/besu/pull/694#discussion_r406382338", "bodyText": "This can be removed.", "author": "shemnon", "createdAt": "2020-04-09T18:04:15Z", "path": "ethereum/api/src/test/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/methods/EthSendRawTransactionTest.java", "diffHunk": "@@ -42,7 +43,7 @@\n   private static final String VALID_TRANSACTION =\n       \"0xf86d0485174876e800830222e0945aae326516b4f8fe08074b7e972e40a713048d62880de0b6b3a7640000801ba05d4e7998757264daab67df2ce6f7e7a0ae36910778a406ca73898c9899a32b9ea0674700d5c3d1d27f2e6b4469957dfd1a1c49bf92383d80717afc84eb05695d5b\";\n   @Mock private TransactionPool transactionPool;\n-\n+  @Mock private BlockchainQueries blockchainQueries;", "originalCommit": "db1d528ab341f2d1189a04197f1eed5ee959b47b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYzMDU4Nw==", "url": "https://github.com/hyperledger/besu/pull/694#discussion_r406630587", "bodyText": "Done", "author": "abdelhamidbakhta", "createdAt": "2020-04-10T06:59:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjM4MjMzOA=="}], "type": "inlineReview"}, {"oid": "64fa9a4630af44044bdfdf0c30109588af23270f", "url": "https://github.com/hyperledger/besu/commit/64fa9a4630af44044bdfdf0c30109588af23270f", "message": "remove EthSendRawTransactionTest.blokchainQueries field\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-10T06:58:53Z", "type": "commit"}]}