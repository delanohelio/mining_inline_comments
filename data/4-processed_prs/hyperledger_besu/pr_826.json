{"pr_number": 826, "pr_title": "recognize from and to block parameters in eth subscribe", "pr_createdAt": "2020-05-01T01:43:13Z", "pr_url": "https://github.com/hyperledger/besu/pull/826", "timeline": [{"oid": "e014c5cebf579ff678e9c61de5b507440b7e2472", "url": "https://github.com/hyperledger/besu/commit/e014c5cebf579ff678e9c61de5b507440b7e2472", "message": "recognize from and to block parameters in eth subscribe\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>", "committedDate": "2020-05-01T01:34:21Z", "type": "commit"}, {"oid": "f944ba84a178f1c5138f425bdb7f3a698a283ada", "url": "https://github.com/hyperledger/besu/commit/f944ba84a178f1c5138f425bdb7f3a698a283ada", "message": "Merge remote-tracking branch 'upstream/master' into ws-failure", "committedDate": "2020-05-01T01:47:18Z", "type": "commit"}, {"oid": "f53766824afb3fc542fde198ad05fc09992a3b9d", "url": "https://github.com/hyperledger/besu/commit/f53766824afb3fc542fde198ad05fc09992a3b9d", "message": "mainly argument validation and test fixes\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>", "committedDate": "2020-05-01T17:30:13Z", "type": "commit"}, {"oid": "95cfe6aaa3d73aa2fd8cf5a19f8b09ecc64d9bb1", "url": "https://github.com/hyperledger/besu/commit/95cfe6aaa3d73aa2fd8cf5a19f8b09ecc64d9bb1", "message": "add eth new filter test\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>", "committedDate": "2020-05-01T17:32:41Z", "type": "commit"}, {"oid": "8d2e8b54a387ca68323b2615baed5de88664e9b1", "url": "https://github.com/hyperledger/besu/commit/8d2e8b54a387ca68323b2615baed5de88664e9b1", "message": "remove test\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>", "committedDate": "2020-05-01T17:33:18Z", "type": "commit"}, {"oid": "5b7fb38f1fad84262be038f9bbce750cb667c54a", "url": "https://github.com/hyperledger/besu/commit/5b7fb38f1fad84262be038f9bbce750cb667c54a", "message": "typo\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>", "committedDate": "2020-05-01T17:34:45Z", "type": "commit"}, {"oid": "80031a8250324dd67bc35a55ba03480b90797418", "url": "https://github.com/hyperledger/besu/commit/80031a8250324dd67bc35a55ba03480b90797418", "message": "reinstate test\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>", "committedDate": "2020-05-01T17:37:18Z", "type": "commit"}, {"oid": "91eb33a82d72eec16c2cd76580abf9f66cd2c915", "url": "https://github.com/hyperledger/besu/commit/91eb33a82d72eec16c2cd76580abf9f66cd2c915", "message": "use static BlockParams\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>", "committedDate": "2020-05-01T17:44:23Z", "type": "commit"}, {"oid": "34cd770853862ac391941ac33978770e8cdea55a", "url": "https://github.com/hyperledger/besu/commit/34cd770853862ac391941ac33978770e8cdea55a", "message": "test FilterParameter invalidity\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>", "committedDate": "2020-05-01T18:40:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE3MzczMA==", "url": "https://github.com/hyperledger/besu/pull/826#discussion_r419173730", "bodyText": "I think we should update this to be the headBlockNumber as well. This seems to be the \"default\" for Geth APIs. And probably update the PrivGetLogs as well.\nI'm happy to do this in another PR is you don't wanna mix up with the other changes! :)\nhttps://github.com/ethereum/wiki/wiki/JSON-RPC#eth_getlogs", "author": "lucassaldanha", "createdAt": "2020-05-03T23:18:57Z", "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/methods/EthGetLogs.java", "diffHunk": "@@ -41,30 +43,26 @@ public String getName() {\n   @Override\n   public JsonRpcResponse response(final JsonRpcRequestContext requestContext) {\n     final FilterParameter filter = requestContext.getRequiredParameter(0, FilterParameter.class);\n-    final LogsQuery query =\n-        new LogsQuery.Builder().addresses(filter.getAddresses()).topics(filter.getTopics()).build();\n \n-    if (isValid(filter)) {\n+    if (!filter.isValid()) {\n       return new JsonRpcErrorResponse(\n           requestContext.getRequest().getId(), JsonRpcError.INVALID_PARAMS);\n     }\n-    if (filter.getBlockhash() != null) {\n-      return new JsonRpcSuccessResponse(\n-          requestContext.getRequest().getId(),\n-          new LogsResult(blockchain.matchingLogs(filter.getBlockhash(), query)));\n-    }\n \n-    final long fromBlockNumber = filter.getFromBlock().getNumber().orElse(0);\n-    final long toBlockNumber = filter.getToBlock().getNumber().orElse(blockchain.headBlockNumber());\n+    final List<LogWithMetadata> matchingLogs =\n+        filter\n+            .getBlockHash()\n+            .map(blockHash -> blockchain.matchingLogs(blockHash, filter.getLogsQuery()))\n+            .orElseGet(\n+                () -> {\n+                  final long fromBlockNumber = filter.getFromBlock().getNumber().orElse(0);", "originalCommit": "34cd770853862ac391941ac33978770e8cdea55a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "30f749659d43bf5f5c3f030f586acff97cdf4762", "url": "https://github.com/hyperledger/besu/commit/30f749659d43bf5f5c3f030f586acff97cdf4762", "message": "Merge branch 'master' into ws-failure", "committedDate": "2020-05-03T23:20:49Z", "type": "commit"}]}