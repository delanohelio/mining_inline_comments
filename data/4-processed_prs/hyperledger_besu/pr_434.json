{"pr_number": 434, "pr_title": "Implement Phoenix EVM and Protocol Upgrades", "pr_createdAt": "2020-02-28T18:12:25Z", "pr_url": "https://github.com/hyperledger/besu/pull/434", "timeline": [{"oid": "d5e5c35191bf172845fa54cc9da0b5b6d6493f7a", "url": "https://github.com/hyperledger/besu/commit/d5e5c35191bf172845fa54cc9da0b5b6d6493f7a", "message": "remove code related to aztlan fork.\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-02-28T17:45:15Z", "type": "commit"}, {"oid": "a5d8e9b9d5fa0c3a3da46e4cb8b40b6eaee6d974", "url": "https://github.com/hyperledger/besu/commit/a5d8e9b9d5fa0c3a3da46e4cb8b40b6eaee6d974", "message": "added genesis config option for Phoenix block\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-02-28T17:59:13Z", "type": "commit"}, {"oid": "aef8bbd2d3be135918c3f0fc48916b91cb37e944", "url": "https://github.com/hyperledger/besu/commit/aef8bbd2d3be135918c3f0fc48916b91cb37e944", "message": "implement phoenix protocol spec definition\n\nImplement Phoenix EVM and protocol upgrades as per ECIP-1088\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-02-28T18:08:16Z", "type": "commit"}, {"oid": "88f68b508cc58e990f1d3d0f059ce30a7dd715cb", "url": "https://github.com/hyperledger/besu/commit/88f68b508cc58e990f1d3d0f059ce30a7dd715cb", "message": "Merge branch 'master' into ed/etc_phoenix_update", "committedDate": "2020-03-03T15:03:21Z", "type": "commit"}, {"oid": "49e112c4a0ac46003b1c9b9f24cb7ce8ec5162fa", "url": "https://github.com/hyperledger/besu/commit/49e112c4a0ac46003b1c9b9f24cb7ce8ec5162fa", "message": " p2p/config: update mordor classic discovery nodes (#29)\n\nSigned-off-by: /raw PONG _GHMoaCXLT <58883403+q9f@users.noreply.github.com>", "committedDate": "2020-03-03T16:43:58Z", "type": "commit"}, {"oid": "489c359cd49ad87053b5eebc6bb7423e1e4d728e", "url": "https://github.com/hyperledger/besu/commit/489c359cd49ad87053b5eebc6bb7423e1e4d728e", "message": "Merge branch 'master' into ed/etc_phoenix_update", "committedDate": "2020-03-03T17:30:41Z", "type": "commit"}, {"oid": "b06f5a04f304cf165e24a2fa28b6790200b33a6b", "url": "https://github.com/hyperledger/besu/commit/b06f5a04f304cf165e24a2fa28b6790200b33a6b", "message": "Merge branch 'master' into ed/etc_phoenix_update", "committedDate": "2020-03-05T15:58:51Z", "type": "commit"}, {"oid": "8d75e8b0b3ca7ecfff423ed4509e1e24f596097f", "url": "https://github.com/hyperledger/besu/commit/8d75e8b0b3ca7ecfff423ed4509e1e24f596097f", "message": "Merge branch 'master' into ed/etc_phoenix_update", "committedDate": "2020-03-05T22:17:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY3NjcwOQ==", "url": "https://github.com/hyperledger/besu/pull/434#discussion_r388676709", "bodyText": "This appears to be identical to the definition already inherited from Atlantis. Am I missing something, should something have changed or is this just not required?", "author": "ajsutton", "createdAt": "2020-03-06T02:02:49Z", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/ClassicProtocolSpecs.java", "diffHunk": "@@ -149,19 +149,29 @@\n         .name(\"Agharta\");\n   }\n \n-  public static ProtocolSpecBuilder<Void> aztlanDefinition(\n+  public static ProtocolSpecBuilder<Void> phoenixDefinition(\n       final Optional<BigInteger> chainId,\n       final OptionalInt configContractSizeLimit,\n       final OptionalInt configStackSizeLimit,\n       final boolean enableRevertReason) {\n+    final int contractSizeLimit =\n+        configContractSizeLimit.orElse(MainnetProtocolSpecs.SPURIOUS_DRAGON_CONTRACT_SIZE_LIMIT);\n     return aghartaDefinition(\n             chainId, configContractSizeLimit, configStackSizeLimit, enableRevertReason)\n-        .gasCalculator(AztlanGasCalculator::new)\n+        .gasCalculator(IstanbulGasCalculator::new)\n         .evmBuilder(\n             gasCalculator ->\n-                MainnetEvmRegistries.aztlan(gasCalculator, chainId.orElse(BigInteger.ZERO)))\n+                MainnetEvmRegistries.istanbul(gasCalculator, chainId.orElse(BigInteger.ZERO)))\n         .precompileContractRegistryBuilder(MainnetPrecompiledContractRegistries::istanbul)\n-        .name(\"Aztlan\");\n+        .contractCreationProcessorBuilder(\n+            (gasCalculator, evm) ->\n+                new MainnetContractCreationProcessor(\n+                    gasCalculator,\n+                    evm,\n+                    true,\n+                    Collections.singletonList(MaxCodeSizeRule.of(contractSizeLimit)),\n+                    1))", "originalCommit": "8d75e8b0b3ca7ecfff423ed4509e1e24f596097f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY4MzM0Nw==", "url": "https://github.com/hyperledger/besu/pull/434#discussion_r388683347", "bodyText": "This is indeed the same as Atlantis. If this isn't specified here, will it automatically use the previous one defined?", "author": "lucassaldanha", "createdAt": "2020-03-06T02:29:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY3NjcwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY4Mzk4MQ==", "url": "https://github.com/hyperledger/besu/pull/434#discussion_r388683981", "bodyText": "Yes.  You should only need to specify the changes between each milestone.  So the only time you'd have two milestones with the same declaration is if something changed and then changed back (you'd have to override the changed version back to the original).", "author": "ajsutton", "createdAt": "2020-03-06T02:32:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY3NjcwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk0ODU4OA==", "url": "https://github.com/hyperledger/besu/pull/434#discussion_r388948588", "bodyText": "Ok, this makes sense, I didn't think in was required, but I was following the pattern in MainnetProtocolSpec where contractCreationProcessBuilder is defined for SpuriouDragon then with the same definition for Istanbul without any changes is between.  I wasn't sure why that was done, but I followed that pattern.  I'll remove it from Phoenix since it has already been defined.", "author": "edwardmack", "createdAt": "2020-03-06T14:54:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY3NjcwOQ=="}], "type": "inlineReview"}, {"oid": "ed2c3b822ae040a6dd63152190ffdec7f37aaaca", "url": "https://github.com/hyperledger/besu/commit/ed2c3b822ae040a6dd63152190ffdec7f37aaaca", "message": "Merge branch 'master' into ed/etc_phoenix_update", "committedDate": "2020-03-06T14:33:55Z", "type": "commit"}, {"oid": "c4803ebf98a0d908326384888bab640d26ec6320", "url": "https://github.com/hyperledger/besu/commit/c4803ebf98a0d908326384888bab640d26ec6320", "message": "remove unnecessary contractCreationProcessorBuilder\n\nremove unnecessary contractCreationProcessorBuilder from Phoenix\nClassicProtocolSpec.\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-03-06T14:56:27Z", "type": "commit"}, {"oid": "081c35ea39456bde9b171f0a82b6dafc06664c85", "url": "https://github.com/hyperledger/besu/commit/081c35ea39456bde9b171f0a82b6dafc06664c85", "message": "Merge branch 'master' into ed/etc_phoenix_update", "committedDate": "2020-03-09T13:28:51Z", "type": "commit"}]}