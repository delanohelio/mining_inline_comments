{"pr_number": 753, "pr_title": "Added private filter acceptance tests", "pr_createdAt": "2020-04-21T02:55:19Z", "pr_url": "https://github.com/hyperledger/besu/pull/753", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkxNDg5NQ==", "url": "https://github.com/hyperledger/besu/pull/753#discussion_r411914895", "bodyText": "We should think about this again. Is it OK that we are NOT returning all the information that we have in the PrivateTransactionReceipts? E.g. the logs do not contain the privateFrom and privateFor/privacyGroupID.\nAND I'm not sure about the TransactionIndex that is contained in our results/logs, because they are not the index of the PMT, but they contain 0 for the first PMT of the privacy group in the block, 1 for the second PMT and so on.", "author": "pinges", "createdAt": "2020-04-21T06:46:38Z", "path": "acceptance-tests/dsl/src/main/java/org/hyperledger/besu/tests/acceptance/dsl/transaction/privacy/PrivacyRequestFactory.java", "diffHunk": "@@ -395,6 +397,40 @@ public PrivxCreatePrivacyGroupResponse privxCreatePrivacyGroup(\n         \"priv_getLogs\", Arrays.asList(privacyGroupId, filterParameter), web3jService, EthLog.class);\n   }\n \n+  public Request<?, EthFilter> privNewFilter(\n+      final String privacyGroupId, final LogFilterJsonParameter filterParameter) {\n+    return new Request<>(\n+        \"priv_newFilter\",\n+        Arrays.asList(privacyGroupId, filterParameter),\n+        web3jService,\n+        EthFilter.class);\n+  }\n+\n+  public Request<?, EthUninstallFilter> privUninstallFilter(\n+      final String privacyGroupId, final String filterId) {\n+    return new Request<>(\n+        \"priv_uninstallFilter\",\n+        Arrays.asList(privacyGroupId, filterId),\n+        web3jService,\n+        EthUninstallFilter.class);\n+  }\n+\n+  public Request<?, EthLog> privGetFilterLogs(final String privacyGroupId, final String filterId) {\n+\n+    return new Request<>(\n+        \"priv_getFilterLogs\", Arrays.asList(privacyGroupId, filterId), web3jService, EthLog.class);", "originalCommit": "6db71f1fcfc75a238d4179db79728a20528c30c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjAxNTIyNA==", "url": "https://github.com/hyperledger/besu/pull/753#discussion_r412015224", "bodyText": "When users are dealing with logs, they are interested inthe outcome of the smart contracts. The privateFrom doesn\u2019t matter.\nAnd they know the privacy group id \u2019cause they need it to subscribe to the logs in the first place.", "author": "lucassaldanha", "createdAt": "2020-04-21T09:13:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkxNDg5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjAxNTI3Mg==", "url": "https://github.com/hyperledger/besu/pull/753#discussion_r412015272", "bodyText": "The transaction index is a good point though. We should consider using the PMT index", "author": "lucassaldanha", "createdAt": "2020-04-21T09:13:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkxNDg5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjAxNTUyMA==", "url": "https://github.com/hyperledger/besu/pull/753#discussion_r412015520", "bodyText": "But this isn't part of this PR. We should do it in a separate one :)", "author": "lucassaldanha", "createdAt": "2020-04-21T09:14:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkxNDg5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjAxODY2Mg==", "url": "https://github.com/hyperledger/besu/pull/753#discussion_r412018662", "bodyText": "I have raised #756", "author": "lucassaldanha", "createdAt": "2020-04-21T09:18:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkxNDg5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkxNTI0NQ==", "url": "https://github.com/hyperledger/besu/pull/753#discussion_r411915245", "bodyText": "s.a.", "author": "pinges", "createdAt": "2020-04-21T06:47:20Z", "path": "acceptance-tests/dsl/src/main/java/org/hyperledger/besu/tests/acceptance/dsl/transaction/privacy/PrivacyRequestFactory.java", "diffHunk": "@@ -395,6 +397,40 @@ public PrivxCreatePrivacyGroupResponse privxCreatePrivacyGroup(\n         \"priv_getLogs\", Arrays.asList(privacyGroupId, filterParameter), web3jService, EthLog.class);\n   }\n \n+  public Request<?, EthFilter> privNewFilter(\n+      final String privacyGroupId, final LogFilterJsonParameter filterParameter) {\n+    return new Request<>(\n+        \"priv_newFilter\",\n+        Arrays.asList(privacyGroupId, filterParameter),\n+        web3jService,\n+        EthFilter.class);\n+  }\n+\n+  public Request<?, EthUninstallFilter> privUninstallFilter(\n+      final String privacyGroupId, final String filterId) {\n+    return new Request<>(\n+        \"priv_uninstallFilter\",\n+        Arrays.asList(privacyGroupId, filterId),\n+        web3jService,\n+        EthUninstallFilter.class);\n+  }\n+\n+  public Request<?, EthLog> privGetFilterLogs(final String privacyGroupId, final String filterId) {\n+\n+    return new Request<>(\n+        \"priv_getFilterLogs\", Arrays.asList(privacyGroupId, filterId), web3jService, EthLog.class);\n+  }\n+\n+  public Request<?, EthLog> privGetFilterChanges(\n+      final String privacyGroupId, final String filterId) {\n+\n+    return new Request<>(\n+        \"priv_getFilterChanges\",\n+        Arrays.asList(privacyGroupId, filterId),\n+        web3jService,\n+        EthLog.class);", "originalCommit": "6db71f1fcfc75a238d4179db79728a20528c30c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkxNTc3MQ==", "url": "https://github.com/hyperledger/besu/pull/753#discussion_r411915771", "bodyText": "s.a.", "author": "pinges", "createdAt": "2020-04-21T06:48:20Z", "path": "acceptance-tests/dsl/src/main/java/org/hyperledger/besu/tests/acceptance/dsl/transaction/privacy/filter/PrivGetFilterChangesTransaction.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.tests.acceptance.dsl.transaction.privacy.filter;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.hyperledger.besu.tests.acceptance.dsl.transaction.NodeRequests;\n+import org.hyperledger.besu.tests.acceptance.dsl.transaction.Transaction;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import org.web3j.protocol.core.methods.response.EthLog;\n+import org.web3j.protocol.core.methods.response.EthLog.LogResult;\n+\n+@SuppressWarnings(\"rawtypes\")\n+public class PrivGetFilterChangesTransaction implements Transaction<List<LogResult>> {\n+\n+  private final String privacyGroupId;\n+  private final String filterId;\n+\n+  public PrivGetFilterChangesTransaction(final String privacyGroupId, final String filterId) {\n+    this.privacyGroupId = privacyGroupId;\n+    this.filterId = filterId;\n+  }\n+\n+  @Override\n+  public List<LogResult> execute(final NodeRequests node) {", "originalCommit": "6db71f1fcfc75a238d4179db79728a20528c30c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkxNjE4Nw==", "url": "https://github.com/hyperledger/besu/pull/753#discussion_r411916187", "bodyText": "s.a.", "author": "pinges", "createdAt": "2020-04-21T06:49:01Z", "path": "acceptance-tests/dsl/src/main/java/org/hyperledger/besu/tests/acceptance/dsl/transaction/privacy/filter/PrivGetFilterLogsTransaction.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.tests.acceptance.dsl.transaction.privacy.filter;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.hyperledger.besu.tests.acceptance.dsl.transaction.NodeRequests;\n+import org.hyperledger.besu.tests.acceptance.dsl.transaction.Transaction;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import org.web3j.protocol.core.methods.response.EthLog;\n+import org.web3j.protocol.core.methods.response.EthLog.LogResult;\n+\n+@SuppressWarnings(\"rawtypes\")\n+public class PrivGetFilterLogsTransaction implements Transaction<List<LogResult>> {\n+\n+  private final String privacyGroupId;\n+  private final String filterId;\n+\n+  public PrivGetFilterLogsTransaction(final String privacyGroupId, final String filterId) {\n+    this.privacyGroupId = privacyGroupId;\n+    this.filterId = filterId;\n+  }\n+\n+  @Override\n+  public List<LogResult> execute(final NodeRequests node) {", "originalCommit": "6db71f1fcfc75a238d4179db79728a20528c30c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "34aa069c65aee35b9addce5c7e6e46bbc3be593e", "url": "https://github.com/hyperledger/besu/commit/34aa069c65aee35b9addce5c7e6e46bbc3be593e", "message": "Added private filter acceptance tests\n\nSigned-off-by: Lucas Saldanha <lucas.saldanha@consensys.net>", "committedDate": "2020-04-21T09:53:08Z", "type": "commit"}, {"oid": "34aa069c65aee35b9addce5c7e6e46bbc3be593e", "url": "https://github.com/hyperledger/besu/commit/34aa069c65aee35b9addce5c7e6e46bbc3be593e", "message": "Added private filter acceptance tests\n\nSigned-off-by: Lucas Saldanha <lucas.saldanha@consensys.net>", "committedDate": "2020-04-21T09:53:08Z", "type": "forcePushed"}, {"oid": "824adeebab42033c300e212c871d3cd144da688b", "url": "https://github.com/hyperledger/besu/commit/824adeebab42033c300e212c871d3cd144da688b", "message": "Merge branch 'master' into priv_filters_at", "committedDate": "2020-04-21T23:29:38Z", "type": "commit"}]}