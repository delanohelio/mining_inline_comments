{"pr_number": 1292, "pr_title": "[Issue 1278] Rework static peer discovery handling", "pr_createdAt": "2020-08-11T02:53:19Z", "pr_url": "https://github.com/hyperledger/besu/pull/1292", "timeline": [{"oid": "aadb7deb2c411ad777943a32ab502706389b330f", "url": "https://github.com/hyperledger/besu/commit/aadb7deb2c411ad777943a32ab502706389b330f", "message": "Add factory method to construct DiscoveryPeer from generic peer\n\nSigned-off-by: Meredith Baxter <meredith.baxter@consensys.net>", "committedDate": "2020-08-11T02:44:44Z", "type": "commit"}, {"oid": "b257df5c1dd37dc9d4fe53e3c0bd7551b93f3c9f", "url": "https://github.com/hyperledger/besu/commit/b257df5c1dd37dc9d4fe53e3c0bd7551b93f3c9f", "message": "Add peer to discovery table more safely\n\nSigned-off-by: Meredith Baxter <meredith.baxter@consensys.net>", "committedDate": "2020-08-11T02:44:44Z", "type": "commit"}, {"oid": "5747f92163ad4a5585354c34841ce2e218b7ad12", "url": "https://github.com/hyperledger/besu/commit/5747f92163ad4a5585354c34841ce2e218b7ad12", "message": "Move static peer handling out of discovery controller\n\nSigned-off-by: Meredith Baxter <meredith.baxter@consensys.net>", "committedDate": "2020-08-11T02:44:45Z", "type": "commit"}, {"oid": "054a162ac94231cd4321b88f127bbfd1e917e38f", "url": "https://github.com/hyperledger/besu/commit/054a162ac94231cd4321b88f127bbfd1e917e38f", "message": "Make PeerDiscoveryAgent.bond more generic, add tests\n\nSigned-off-by: Meredith Baxter <meredith.baxter@consensys.net>", "committedDate": "2020-08-11T02:44:45Z", "type": "commit"}, {"oid": "35436d777a1eec5bb3d8522a350c5c5a3f06a376", "url": "https://github.com/hyperledger/besu/commit/35436d777a1eec5bb3d8522a350c5c5a3f06a376", "message": "Move static peer bonding logic to P2PNetwork\n\nSigned-off-by: Meredith Baxter <meredith.baxter@consensys.net>", "committedDate": "2020-08-11T02:44:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMwNTQ4NA==", "url": "https://github.com/hyperledger/besu/pull/1292#discussion_r468305484", "bodyText": "Does this mean that we require discovery to be enabled on peers that we want to add using static-nodes.json file or AddPeer API? Because I feel like most uses that are statically mapping their peers might not have discovery enabled (and might not want to).", "author": "lucassaldanha", "createdAt": "2020-08-11T03:29:35Z", "path": "ethereum/p2p/src/main/java/org/hyperledger/besu/ethereum/p2p/network/DefaultP2PNetwork.java", "diffHunk": "@@ -265,6 +265,7 @@ public void awaitStop() {\n   @Override\n   public boolean addMaintainConnectionPeer(final Peer peer) {\n     final boolean wasAdded = maintainedPeers.add(peer);\n+    peerDiscoveryAgent.bond(peer);", "originalCommit": "35436d777a1eec5bb3d8522a350c5c5a3f06a376", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODYyOTE4Ng==", "url": "https://github.com/hyperledger/besu/pull/1292#discussion_r468629186", "bodyText": "No - we try to create a DiscoveryPeer to initiate bonding with.  The DiscoveryPeer.from helper will only return a peer if discovery appears to be enabled.  The bonding process consists of sending a PING to that peer, and waiting for a response.  Only if the peer is running discovery and responds do we add the peer to our table.  If the peer doesn't respond, we'll retry a few times and then stop.\nUsers can explicitly indicate that discovery is disabled by supplying enode urls with discport=0, which will cause us to skip the bonding attempt.", "author": "mbaxter", "createdAt": "2020-08-11T14:33:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMwNTQ4NA=="}], "type": "inlineReview"}, {"oid": "1b0ad2ddede7126d15675afbfbc4e6788b98ab97", "url": "https://github.com/hyperledger/besu/commit/1b0ad2ddede7126d15675afbfbc4e6788b98ab97", "message": "Merge branch 'master' into issue-1278/rework-static-peer-discovery-handling", "committedDate": "2020-08-11T17:07:07Z", "type": "commit"}, {"oid": "49b2568775bc22e6a00923d3338acb2d7a4a08c8", "url": "https://github.com/hyperledger/besu/commit/49b2568775bc22e6a00923d3338acb2d7a4a08c8", "message": "Merge branch 'master' into issue-1278/rework-static-peer-discovery-handling", "committedDate": "2020-08-11T17:26:32Z", "type": "commit"}]}