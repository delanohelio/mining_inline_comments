{"pr_number": 618, "pr_title": "Move IBFT To using injectable crypto", "pr_createdAt": "2020-03-31T11:46:21Z", "pr_url": "https://github.com/hyperledger/besu/pull/618", "timeline": [{"oid": "16e970196585795f3de8eff3a5c3c1f3d84d540f", "url": "https://github.com/hyperledger/besu/commit/16e970196585795f3de8eff3a5c3c1f3d84d540f", "message": "Renamed to NodeKeys\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>", "committedDate": "2020-04-03T01:12:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4MzMyMA==", "url": "https://github.com/hyperledger/besu/pull/618#discussion_r402683320", "bodyText": "should variable name be nodeKey ??", "author": "usmansaleem", "createdAt": "2020-04-03T01:13:56Z", "path": "besu/src/main/java/org/hyperledger/besu/controller/CliqueQueryPluginServiceFactory.java", "diffHunk": "@@ -26,19 +26,18 @@\n public class CliqueQueryPluginServiceFactory implements PluginServiceFactory {\n \n   private final Blockchain blockchain;\n-  private final KeyPair localNodeKeypair;\n+  private final NodeKey cryptoOps;", "originalCommit": "16e970196585795f3de8eff3a5c3c1f3d84d540f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY5MDczNw==", "url": "https://github.com/hyperledger/besu/pull/618#discussion_r402690737", "bodyText": "oh bugger", "author": "rain-on", "createdAt": "2020-04-03T01:42:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4MzMyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4NDc2Nw==", "url": "https://github.com/hyperledger/besu/pull/618#discussion_r402684767", "bodyText": "nit: extra pair of brackets not required.", "author": "usmansaleem", "createdAt": "2020-04-03T01:19:29Z", "path": "consensus/ibft/src/test/java/org/hyperledger/besu/consensus/ibft/IbftHelpersTest.java", "diffHunk": "@@ -138,7 +140,8 @@ public void latestPreparedCertificateIsExtractedFromRoundChangeCertificate() {\n   @Test\n   public void allRoundChangeHaveNoPreparedReturnsEmptyOptional() {\n     final KeyPair proposerKey = KeyPair.generate();\n-    final MessageFactory proposerMessageFactory = new MessageFactory(proposerKey);\n+    final MessageFactory proposerMessageFactory =\n+        new MessageFactory(new BouncyCastleNodeKey((proposerKey)));", "originalCommit": "16e970196585795f3de8eff3a5c3c1f3d84d540f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4NjA5Mg==", "url": "https://github.com/hyperledger/besu/pull/618#discussion_r402686092", "bodyText": "Same as Uzi's comment above, this should NodeKey", "author": "jframe", "createdAt": "2020-04-03T01:24:29Z", "path": "besu/src/main/java/org/hyperledger/besu/controller/CliqueQueryPluginServiceFactory.java", "diffHunk": "@@ -26,19 +26,18 @@\n public class CliqueQueryPluginServiceFactory implements PluginServiceFactory {\n \n   private final Blockchain blockchain;\n-  private final KeyPair localNodeKeypair;\n+  private final NodeKey cryptoOps;\n \n-  public CliqueQueryPluginServiceFactory(\n-      final Blockchain blockchain, final KeyPair localNodeKeypair) {\n+  public CliqueQueryPluginServiceFactory(final Blockchain blockchain, final NodeKey cryptoOps) {\n     this.blockchain = blockchain;\n-    this.localNodeKeypair = localNodeKeypair;\n+    this.cryptoOps = cryptoOps;", "originalCommit": "16e970196585795f3de8eff3a5c3c1f3d84d540f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4OTEwMA==", "url": "https://github.com/hyperledger/besu/pull/618#discussion_r402689100", "bodyText": "Is this PR for Clique as well as IBFT?", "author": "jframe", "createdAt": "2020-04-03T01:36:02Z", "path": "besu/src/main/java/org/hyperledger/besu/controller/CliqueBesuControllerBuilder.java", "diffHunk": "@@ -46,6 +47,7 @@\n import org.apache.logging.log4j.Logger;\n \n public class CliqueBesuControllerBuilder extends BesuControllerBuilder<CliqueContext> {", "originalCommit": "16e970196585795f3de8eff3a5c3c1f3d84d540f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY5Mzk3Ng==", "url": "https://github.com/hyperledger/besu/pull/618#discussion_r402693976", "bodyText": "Ah - had to include this here as the Metrics plugin work was affected by the change", "author": "rain-on", "createdAt": "2020-04-03T01:54:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4OTEwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY5MDk1OQ==", "url": "https://github.com/hyperledger/besu/pull/618#discussion_r402690959", "bodyText": "Since the pattern new BouncyCastleNodeKey(KeyPair.generate()) is used so often, perhaps a static generate method on BouncyCastleNodeKey would clean test code a bit", "author": "jframe", "createdAt": "2020-04-03T01:43:06Z", "path": "consensus/ibft/src/test/java/org/hyperledger/besu/consensus/ibft/validation/SignedDataValidatorTest.java", "diffHunk": "@@ -47,9 +48,12 @@\n   private final KeyPair proposerKey = KeyPair.generate();", "originalCommit": "16e970196585795f3de8eff3a5c3c1f3d84d540f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d2bc350daa746c5a0de4b7f6b9480e7c65648e4c", "url": "https://github.com/hyperledger/besu/commit/d2bc350daa746c5a0de4b7f6b9480e7c65648e4c", "message": "Move IBFT To using cryptoOps\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>", "committedDate": "2020-04-03T02:10:04Z", "type": "commit"}, {"oid": "d2bc350daa746c5a0de4b7f6b9480e7c65648e4c", "url": "https://github.com/hyperledger/besu/commit/d2bc350daa746c5a0de4b7f6b9480e7c65648e4c", "message": "Move IBFT To using cryptoOps\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>", "committedDate": "2020-04-03T02:10:04Z", "type": "forcePushed"}, {"oid": "a4bb5f08a63ccbfb603a62e6d7969936a4f56275", "url": "https://github.com/hyperledger/besu/commit/a4bb5f08a63ccbfb603a62e6d7969936a4f56275", "message": "cleaning up the test code\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>", "committedDate": "2020-04-03T02:32:02Z", "type": "commit"}, {"oid": "15cc340442ebf38cd877f9455e46a3f769a140f2", "url": "https://github.com/hyperledger/besu/commit/15cc340442ebf38cd877f9455e46a3f769a140f2", "message": "post review\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>", "committedDate": "2020-04-03T03:15:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjcyMDM1NQ==", "url": "https://github.com/hyperledger/besu/pull/618#discussion_r402720355", "bodyText": "nit: newKeyPair -> newNodeKey", "author": "jframe", "createdAt": "2020-04-03T03:42:29Z", "path": "consensus/ibft/src/integration-test/java/org/hyperledger/besu/consensus/ibft/support/NetworkLayout.java", "diffHunk": "@@ -53,7 +54,7 @@ public static NetworkLayout createNetworkLayout(\n     final TreeMap<Address, NodeParams> addressKeyMap = new TreeMap<>();\n \n     for (int i = 0; i < validatorCount; i++) {\n-      final KeyPair newKeyPair = KeyPair.generate();\n+      final NodeKey newKeyPair = BouncyCastleNodeKey.generate();", "originalCommit": "15cc340442ebf38cd877f9455e46a3f769a140f2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjcyMTEzMQ==", "url": "https://github.com/hyperledger/besu/pull/618#discussion_r402721131", "bodyText": "Could just use the NodeKey.generate here to then use do nodeKey.getPublicKey() to get the address for NodeParams", "author": "jframe", "createdAt": "2020-04-03T03:45:48Z", "path": "consensus/ibft/src/integration-test/java/org/hyperledger/besu/consensus/ibft/tests/SpuriousBehaviourTest.java", "diffHunk": "@@ -100,12 +100,14 @@ public void messageWithIllegalMessageCodeAreDiscardedAndDoNotPreventOngoingIbftO\n   public void nonValidatorsCannotTriggerResponses() {\n     final KeyPair nonValidatorKeys = KeyPair.generate();", "originalCommit": "15cc340442ebf38cd877f9455e46a3f769a140f2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjcyNTU1NA==", "url": "https://github.com/hyperledger/besu/pull/618#discussion_r402725554", "bodyText": "nit: getNodeKey instead of getnodeKey keeping the java beans conventions.", "author": "usmansaleem", "createdAt": "2020-04-03T04:06:31Z", "path": "consensus/ibft/src/integration-test/java/org/hyperledger/besu/consensus/ibft/support/NodeParams.java", "diffHunk": "@@ -14,23 +14,23 @@\n  */\n package org.hyperledger.besu.consensus.ibft.support;\n \n-import org.hyperledger.besu.crypto.SECP256K1.KeyPair;\n+import org.hyperledger.besu.crypto.NodeKey;\n import org.hyperledger.besu.ethereum.core.Address;\n \n public class NodeParams {\n   private final Address address;\n-  private final KeyPair nodeKeys;\n+  private final NodeKey nodeKey;\n \n-  public NodeParams(final Address address, final KeyPair nodeKeys) {\n+  public NodeParams(final Address address, final NodeKey nodeKey) {\n     this.address = address;\n-    this.nodeKeys = nodeKeys;\n+    this.nodeKey = nodeKey;\n   }\n \n   public Address getAddress() {\n     return address;\n   }\n \n-  public KeyPair getNodeKeyPair() {\n-    return nodeKeys;\n+  public NodeKey getnodeKey() {", "originalCommit": "15cc340442ebf38cd877f9455e46a3f769a140f2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMxMjUwMQ==", "url": "https://github.com/hyperledger/besu/pull/618#discussion_r403312501", "bodyText": "done", "author": "rain-on", "createdAt": "2020-04-03T20:32:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjcyNTU1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjcyNjMwOQ==", "url": "https://github.com/hyperledger/besu/pull/618#discussion_r402726309", "bodyText": "getNodeKey", "author": "usmansaleem", "createdAt": "2020-04-03T04:09:54Z", "path": "consensus/ibft/src/main/java/org/hyperledger/besu/consensus/ibft/statemachine/IbftFinalState.java", "diffHunk": "@@ -74,8 +74,8 @@ public int getQuorum() {\n     return voteTallyCache.getVoteTallyAtHead().getValidators();\n   }\n \n-  public KeyPair getNodeKeys() {\n-    return nodeKeys;\n+  public NodeKey getnodeKey() {", "originalCommit": "15cc340442ebf38cd877f9455e46a3f769a140f2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMxMjc3MQ==", "url": "https://github.com/hyperledger/besu/pull/618#discussion_r403312771", "bodyText": "done", "author": "rain-on", "createdAt": "2020-04-03T20:32:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjcyNjMwOQ=="}], "type": "inlineReview"}, {"oid": "7a1bff23f69fba291574c2a749a4493660782233", "url": "https://github.com/hyperledger/besu/commit/7a1bff23f69fba291574c2a749a4493660782233", "message": "Reworked ibftquery testing\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>", "committedDate": "2020-04-03T05:32:48Z", "type": "commit"}, {"oid": "7a1bff23f69fba291574c2a749a4493660782233", "url": "https://github.com/hyperledger/besu/commit/7a1bff23f69fba291574c2a749a4493660782233", "message": "Reworked ibftquery testing\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>", "committedDate": "2020-04-03T05:32:48Z", "type": "forcePushed"}, {"oid": "27fa94e2d47ac8002fd2a2584b39fb8492457514", "url": "https://github.com/hyperledger/besu/commit/27fa94e2d47ac8002fd2a2584b39fb8492457514", "message": "fix spotless\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>", "committedDate": "2020-04-03T05:41:14Z", "type": "commit"}, {"oid": "3476f5d9fc4e43875131a4b0c9234709043a0690", "url": "https://github.com/hyperledger/besu/commit/3476f5d9fc4e43875131a4b0c9234709043a0690", "message": "More renames\n\nAnd merge master\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>", "committedDate": "2020-04-03T08:32:27Z", "type": "commit"}, {"oid": "3476f5d9fc4e43875131a4b0c9234709043a0690", "url": "https://github.com/hyperledger/besu/commit/3476f5d9fc4e43875131a4b0c9234709043a0690", "message": "More renames\n\nAnd merge master\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>", "committedDate": "2020-04-03T08:32:27Z", "type": "forcePushed"}, {"oid": "e4d87571370cbb7191a2152203a7ec3756a1a13b", "url": "https://github.com/hyperledger/besu/commit/e4d87571370cbb7191a2152203a7ec3756a1a13b", "message": "Merge remote-tracking branch 'upstream/master' into crypto_ops\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>", "committedDate": "2020-04-03T20:26:45Z", "type": "commit"}, {"oid": "9ad72c2fa0b726dedbf32afb856fb3c4c0907211", "url": "https://github.com/hyperledger/besu/commit/9ad72c2fa0b726dedbf32afb856fb3c4c0907211", "message": "fix spotless\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>", "committedDate": "2020-04-03T20:29:14Z", "type": "commit"}, {"oid": "2a90c9ffd58adfacf1bf6e28192dbcd466b8de4a", "url": "https://github.com/hyperledger/besu/commit/2a90c9ffd58adfacf1bf6e28192dbcd466b8de4a", "message": "rename to getNodeKey\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>", "committedDate": "2020-04-03T20:32:19Z", "type": "commit"}, {"oid": "f8bbeb136d4670d8efafc8f4fa7924010c952773", "url": "https://github.com/hyperledger/besu/commit/f8bbeb136d4670d8efafc8f4fa7924010c952773", "message": "Merge branch 'master' into crypto_ops", "committedDate": "2020-04-07T00:34:58Z", "type": "commit"}]}