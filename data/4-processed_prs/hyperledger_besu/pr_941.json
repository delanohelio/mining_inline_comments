{"pr_number": 941, "pr_title": "Update EIP-2315 implementation (enter only via jumpsub)", "pr_createdAt": "2020-05-18T15:09:38Z", "pr_url": "https://github.com/hyperledger/besu/pull/941", "timeline": [{"oid": "63353b80cf2507c843ff26b0070c34e5a0e124ad", "url": "https://github.com/hyperledger/besu/commit/63353b80cf2507c843ff26b0070c34e5a0e124ad", "message": "implement last version of EIP-2315 (enter only via jumpsub)\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-05-18T14:45:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzMzOTk3OA==", "url": "https://github.com/hyperledger/besu/pull/941#discussion_r427339978", "bodyText": "(optional) Gas.ZERO", "author": "RatanRSur", "createdAt": "2020-05-19T14:20:53Z", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/BerlinGasCalculator.java", "diffHunk": "@@ -18,7 +18,7 @@\n \n public class BerlinGasCalculator extends IstanbulGasCalculator {\n \n-  private static final Gas BEGIN_SUB_GAS_COST = Gas.of(1);\n+  private static final Gas BEGIN_SUB_GAS_COST = Gas.of(0);", "originalCommit": "63353b80cf2507c843ff26b0070c34e5a0e124ad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM3MDQxNg==", "url": "https://github.com/hyperledger/besu/pull/941#discussion_r427370416", "bodyText": "Done", "author": "matkt", "createdAt": "2020-05-19T14:57:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzMzOTk3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM0NTkxMA==", "url": "https://github.com/hyperledger/besu/pull/941#discussion_r427345910", "bodyText": "same as above", "author": "RatanRSur", "createdAt": "2020-05-19T14:27:26Z", "path": "ethereum/core/src/test/java/org/hyperledger/besu/ethereum/vm/operations/BeginSubOperationTest.java", "diffHunk": "@@ -42,7 +43,7 @@\n   private static final GasCalculator gasCalculator = new BerlinGasCalculator();\n \n   private static final int CURRENT_PC = 1;\n-  private static final Gas BEGIN_SUB_GAS_COST = Gas.of(1);\n+  private static final Gas BEGIN_SUB_GAS_COST = Gas.of(0);", "originalCommit": "63353b80cf2507c843ff26b0070c34e5a0e124ad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM3MDUyOA==", "url": "https://github.com/hyperledger/besu/pull/941#discussion_r427370528", "bodyText": "Done", "author": "matkt", "createdAt": "2020-05-19T14:57:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM0NTkxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM0ODAyMg==", "url": "https://github.com/hyperledger/besu/pull/941#discussion_r427348022", "bodyText": "I guess this is a comment for another PR but why do we have the ReturnStack parameterized by size? The size of it is fixed in the EIP, yes? So we shouldn't expose that detail to the caller.", "author": "RatanRSur", "createdAt": "2020-05-19T14:29:57Z", "path": "ethereum/core/src/test/java/org/hyperledger/besu/ethereum/vm/operations/BeginSubOperationTest.java", "diffHunk": "@@ -85,17 +86,16 @@ public void shouldCalculateGasPrice() {\n   }\n \n   @Test\n-  public void shouldNotConsumeStackItem() {\n+  public void shouldHaltWithOutOfGasWhenBeginSubIsExecuted() {\n     final BeginSubOperation operation = new BeginSubOperation(gasCalculator);\n     final MessageFrame frame =\n         createMessageFrameBuilder(Gas.of(1))\n-            .pushStackItem(Bytes32.fromHexString(\"0xFF\"))\n-            .code(new Code(Bytes.fromHexString(\"0x6004b300b2b7\")))\n+            .pushStackItem(Bytes32.fromHexString(\"0x04\"))\n+            .code(new Code(Bytes.fromHexString(\"0x610400b2\")))\n             .returnStack(new ReturnStack(MessageFrame.DEFAULT_MAX_RETURN_STACK_SIZE))", "originalCommit": "63353b80cf2507c843ff26b0070c34e5a0e124ad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM2NjY3Mw==", "url": "https://github.com/hyperledger/besu/pull/941#discussion_r427366673", "bodyText": "yes you're right I always make this call new ReturnStack (MessageFrame.DEFAULT_MAX_RETURN_STACK_SIZE)  I will set this value on the ReturnStack object. I will do another PR to fix that", "author": "matkt", "createdAt": "2020-05-19T14:53:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM0ODAyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM2ODMwMw==", "url": "https://github.com/hyperledger/besu/pull/941#discussion_r427368303", "bodyText": "Cool, then you can model it as a singleton class with a static ReturnStack, and private constructor.", "author": "RatanRSur", "createdAt": "2020-05-19T14:55:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM0ODAyMg=="}], "type": "inlineReview"}, {"oid": "ded691632071b9619c3451eef021f4a647a71783", "url": "https://github.com/hyperledger/besu/commit/ded691632071b9619c3451eef021f4a647a71783", "message": "fix review issues\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-05-19T14:55:50Z", "type": "commit"}, {"oid": "05425f813dd25331f3a711c18a1afa2276211935", "url": "https://github.com/hyperledger/besu/commit/05425f813dd25331f3a711c18a1afa2276211935", "message": "Merge branch 'master' into feature/eip2315-prevent-walking-into-subroutine", "committedDate": "2020-05-19T20:53:56Z", "type": "commit"}, {"oid": "fc0d867376fbc58fa68973de3de5e92a3777a032", "url": "https://github.com/hyperledger/besu/commit/fc0d867376fbc58fa68973de3de5e92a3777a032", "message": "update EIP2315 change beginsub gas cost\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-05-26T09:22:54Z", "type": "commit"}, {"oid": "e26df2cc0910989472215fcd72fcdab70739f27a", "url": "https://github.com/hyperledger/besu/commit/e26df2cc0910989472215fcd72fcdab70739f27a", "message": "merge master\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-05-26T09:24:57Z", "type": "commit"}, {"oid": "960b9d9b9eb97c5020e5eeeecd103c5cfee74279", "url": "https://github.com/hyperledger/besu/commit/960b9d9b9eb97c5020e5eeeecd103c5cfee74279", "message": "fix review issues and update eip implementation\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-05-26T10:23:58Z", "type": "commit"}, {"oid": "032daa26d1c86b37f4225c00b6ad0304442b4350", "url": "https://github.com/hyperledger/besu/commit/032daa26d1c86b37f4225c00b6ad0304442b4350", "message": "Merge commit 'upstream/master' into feature/eip2315-prevent-walking-into-subroutine\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-05-26T14:41:07Z", "type": "commit"}]}