{"pr_number": 945, "pr_title": "Updated SimpleNodePermissioning smart contract to relax enodeURL matc\u2026", "pr_createdAt": "2020-05-19T03:09:38Z", "pr_url": "https://github.com/hyperledger/besu/pull/945", "timeline": [{"oid": "9ca48c93f7689bbb0cc214f2889a4124f1e52da9", "url": "https://github.com/hyperledger/besu/commit/9ca48c93f7689bbb0cc214f2889a4124f1e52da9", "message": "Updated SimpleNodePermissioning smart contract to relax enodeURL matching to exclude the p2p port.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-05-19T03:06:40Z", "type": "commit"}, {"oid": "7ff61a41bd9e68f6adc6e124dc905ef25d323ebe", "url": "https://github.com/hyperledger/besu/commit/7ff61a41bd9e68f6adc6e124dc905ef25d323ebe", "message": "Updated truffle test and added readme for updating smart contracts.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-05-19T03:28:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzAwOTQwMg==", "url": "https://github.com/hyperledger/besu/pull/945#discussion_r427009402", "bodyText": "can we keep a test for generating different keys - eg change the host value instead of port", "author": "macfarla", "createdAt": "2020-05-19T03:30:05Z", "path": "acceptance-tests/tests/simple-permissioning-smart-contract/test/test-node-permissioning.js", "diffHunk": "@@ -19,12 +19,9 @@ contract('Permissioning: Nodes', () => {\n   });\n \n   it('Should compute key', async () => {\n-    let key1 = await proxy.computeKey(node1High, node1Low, node1Host, node1Port);\n-    let key2 = await proxy.computeKey(node1High, node1Low, node1Host, node1Port);\n+    let key1 = await proxy.computeKey(node1High, node1Low, node1Host);\n+    let key2 = await proxy.computeKey(node1High, node1Low, node1Host);\n     assert.equal(key1, key2, \"computed keys should be the same\");\n-\n-    let key3 = await proxy.computeKey(node1High, node1Low, node1Host, node2Port);\n-    assert(key3 != key2, \"keys for different ports should be different\");", "originalCommit": "7ff61a41bd9e68f6adc6e124dc905ef25d323ebe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzAxNTgyNg==", "url": "https://github.com/hyperledger/besu/pull/945#discussion_r427015826", "bodyText": "Good idea.", "author": "mark-terry", "createdAt": "2020-05-19T03:55:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzAwOTQwMg=="}], "type": "inlineReview"}, {"oid": "b66d95490b98b0db0816b2b2f594c1ef7dd01546", "url": "https://github.com/hyperledger/besu/commit/b66d95490b98b0db0816b2b2f594c1ef7dd01546", "message": "Added another key validation test.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-05-19T03:44:42Z", "type": "commit"}, {"oid": "66f18538dd09513bdc6f0ac05e7f52fb4267908f", "url": "https://github.com/hyperledger/besu/commit/66f18538dd09513bdc6f0ac05e7f52fb4267908f", "message": "Updated formatted bytecode.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-05-19T03:55:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzAxOTc4Nw==", "url": "https://github.com/hyperledger/besu/pull/945#discussion_r427019787", "bodyText": "should we say to turn optimisation on since it makes the bytecode quite different?", "author": "macfarla", "createdAt": "2020-05-19T04:13:39Z", "path": "acceptance-tests/tests/simple-permissioning-smart-contract/README.md", "diffHunk": "@@ -123,3 +123,15 @@ Compiling ./contracts/SimplePermissioning.sol...\n \n   10 passing (1s)\n ```\n+\n+##Permissioning Contract Updating Steps\n+Should these contracts require updating, please ensure that the compiled bytecode in the Permissioning acceptance tests genesis file has been updated with the new bytecode.\n+\n+One simple update procedure is as follows:\n+1. Load existing contract in [Remix IDE](https://remix.ethereum.org/).\n+2. Enable the _\"SOLIDITY COMPILER\"_ plugin.\n+3. Make required changes.", "originalCommit": "66f18538dd09513bdc6f0ac05e7f52fb4267908f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI2MTA4Mw==", "url": "https://github.com/hyperledger/besu/pull/945#discussion_r427261083", "bodyText": "Actually, we should turn off optimisation because it's for production contracts any may cause debugging issues: https://remix.readthedocs.io/en/stable/settings_tab.html", "author": "mark-terry", "createdAt": "2020-05-19T12:26:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzAxOTc4Nw=="}], "type": "inlineReview"}, {"oid": "90f093e2a029681c1418c912c6bd946f9783b8db", "url": "https://github.com/hyperledger/besu/commit/90f093e2a029681c1418c912c6bd946f9783b8db", "message": "PR fixes.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-05-19T12:33:11Z", "type": "commit"}, {"oid": "284b45c19098c8d7045cebbd62170c1cd1b1600a", "url": "https://github.com/hyperledger/besu/commit/284b45c19098c8d7045cebbd62170c1cd1b1600a", "message": "Merge branch 'master' into 907-contract-update", "committedDate": "2020-05-19T23:10:09Z", "type": "commit"}, {"oid": "be86317567515b579bdade225318936398aa14f3", "url": "https://github.com/hyperledger/besu/commit/be86317567515b579bdade225318936398aa14f3", "message": "Merge branch 'master' into 907-contract-update", "committedDate": "2020-05-19T23:14:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY5NDQ2Nw==", "url": "https://github.com/hyperledger/besu/pull/945#discussion_r427694467", "bodyText": "when I run through the steps I get different bytecode (although same length).", "author": "macfarla", "createdAt": "2020-05-20T01:42:07Z", "path": "acceptance-tests/tests/src/test/resources/permissioning/simple_permissioning_genesis.json", "diffHunk": "@@ -34,7 +34,7 @@\n     \"0x0000000000000000000000000000000000009999\": {\n       \"comment\": \"Simple node permissioning smart contract\",\n       \"balance\": \"0\",\n-      \"code\": \"608060405260043610610067576000357c01000000000000000000000000000000000000000000000000000000009004806312eef3631461006c5780633600f60d146100f45780633620b1df1461016457806378a402d514610228578063aab2f5eb14610311575b600080fd5b34801561007857600080fd5b506100da6004803603608081101561008f57600080fd5b81019080803590602001909291908035906020019092919080356fffffffffffffffffffffffffffffffff19169060200190929190803561ffff169060200190929190505050610381565b604051808215151515815260200191505060405180910390f35b34801561010057600080fd5b506101626004803603608081101561011757600080fd5b81019080803590602001909291908035906020019092919080356fffffffffffffffffffffffffffffffff19169060200190929190803561ffff169060200190929190505050610467565b005b34801561017057600080fd5b50610212600480360361010081101561018857600080fd5b81019080803590602001909291908035906020019092919080356fffffffffffffffffffffffffffffffff19169060200190929190803561ffff169060200190929190803590602001909291908035906020019092919080356fffffffffffffffffffffffffffffffff19169060200190929190803561ffff1690602001909291905050506105a9565b6040518082815260200191505060405180910390f35b34801561023457600080fd5b506102966004803603608081101561024b57600080fd5b81019080803590602001909291908035906020019092919080356fffffffffffffffffffffffffffffffff19169060200190929190803561ffff16906020019092919050505061062e565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156102d65780820151818401526020810190506102bb565b50505050905090810190601f1680156103035780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561031d57600080fd5b5061037f6004803603608081101561033457600080fd5b81019080803590602001909291908035906020019092919080356fffffffffffffffffffffffffffffffff19169060200190929190803561ffff1690602001909291905050506106a0565b005b600060606103918686868661062e565b9050600080826040518082805190602001908083835b6020831015156103cc57805182526020820191506020810190506020830392506103a7565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902090506000700100000000000000000000000000000000028160020160009054906101000a9004700100000000000000000000000000000000026fffffffffffffffffffffffffffffffff1916111561045c5760019250505061045f565b50505b949350505050565b61046f6107ff565b608060405190810160405280868152602001858152602001846fffffffffffffffffffffffffffffffff191681526020018361ffff16815250905060606104b88686868661062e565b9050816000826040518082805190602001908083835b6020831015156104f357805182526020820191506020810190506020830392506104ce565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600082015181600001556020820151816001015560408201518160020160006101000a8154816fffffffffffffffffffffffffffffffff02191690837001000000000000000000000000000000009004021790555060608201518160020160106101000a81548161ffff021916908361ffff160217905550905050505050505050565b60006105b789898989610381565b80156105cb57506105ca85858585610381565b5b156105fb577fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff6001029050610622565b7f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff60010290505b98975050505050505050565b60608484848460405160200180858152602001848152602001836fffffffffffffffffffffffffffffffff19166fffffffffffffffffffffffffffffffff191681526020018261ffff1661ffff1681526020019450505050506040516020818303038152906040529050949350505050565b60606106ae8585858561062e565b90506106b86107ff565b60806040519081016040528060006001028152602001600060010281526020016000700100000000000000000000000000000000026fffffffffffffffffffffffffffffffff19168152602001600061ffff168152509050806000836040518082805190602001908083835b6020831015156107495780518252602082019150602081019050602083039250610724565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600082015181600001556020820151816001015560408201518160020160006101000a8154816fffffffffffffffffffffffffffffffff02191690837001000000000000000000000000000000009004021790555060608201518160020160106101000a81548161ffff021916908361ffff160217905550905050505050505050565b608060405190810160405280600080191681526020016000801916815260200160006fffffffffffffffffffffffffffffffff19168152602001600061ffff168152509056fea165627a7a72305820c18b04628b7fa30a0188fb4ede3466f5d013b403793835501df6055a155b9c420029\",\n+      \"code\": \"608060405234801561001057600080fd5b50600436106100575760003560e01c806312eef3631461005c5780633600f60d146100d75780633620b1df1461013a5780639b7ca65c146101f1578063aab2f5eb146102bf575b600080fd5b6100bd6004803603608081101561007257600080fd5b81019080803590602001909291908035906020019092919080356fffffffffffffffffffffffffffffffff19169060200190929190803561ffff169060200190929190505050610322565b604051808215151515815260200191505060405180910390f35b610138600480360360808110156100ed57600080fd5b81019080803590602001909291908035906020019092919080356fffffffffffffffffffffffffffffffff19169060200190929190803561ffff1690602001909291905050506103e5565b005b6101db600480360361010081101561015157600080fd5b81019080803590602001909291908035906020019092919080356fffffffffffffffffffffffffffffffff19169060200190929190803561ffff169060200190929190803590602001909291908035906020019092919080356fffffffffffffffffffffffffffffffff19169060200190929190803561ffff169060200190929190505050610512565b6040518082815260200191505060405180910390f35b6102446004803603606081101561020757600080fd5b81019080803590602001909291908035906020019092919080356fffffffffffffffffffffffffffffffff19169060200190929190505050610597565b6040518080602001828103825283818151815260200191508051906020019080838360005b83811015610284578082015181840152602081019050610269565b50505050905090810190601f1680156102b15780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b610320600480360360808110156102d557600080fd5b81019080803590602001909291908035906020019092919080356fffffffffffffffffffffffffffffffff19169060200190929190803561ffff1690602001909291905050506105f8565b005b60006060610331868686610597565b9050600080826040518082805190602001908083835b6020831061036a5780518252602082019150602081019050602083039250610347565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390209050600060801b8160020160009054906101000a900460801b6fffffffffffffffffffffffffffffffff191611156103da576001925050506103dd565b50505b949350505050565b6103ed610730565b6040518060800160405280868152602001858152602001846fffffffffffffffffffffffffffffffff191681526020018361ffff1681525090506060610434868686610597565b9050816000826040518082805190602001908083835b6020831061046d578051825260208201915060208101905060208303925061044a565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600082015181600001556020820151816001015560408201518160020160006101000a8154816fffffffffffffffffffffffffffffffff021916908360801c021790555060608201518160020160106101000a81548161ffff021916908361ffff160217905550905050505050505050565b600061052089898989610322565b8015610534575061053385858585610322565b5b15610564577fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff60001b905061058b565b7f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff60001b90505b98975050505050505050565b606083838360405160200180848152602001838152602001826fffffffffffffffffffffffffffffffff19166fffffffffffffffffffffffffffffffff19168152602001935050505060405160208183030381529060405290509392505050565b6060610605858585610597565b905061060f610730565b60405180608001604052806000801b81526020016000801b8152602001600060801b6fffffffffffffffffffffffffffffffff19168152602001600061ffff168152509050806000836040518082805190602001908083835b6020831061068b5780518252602082019150602081019050602083039250610668565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600082015181600001556020820151816001015560408201518160020160006101000a8154816fffffffffffffffffffffffffffffffff021916908360801c021790555060608201518160020160106101000a81548161ffff021916908361ffff160217905550905050505050505050565b6040518060800160405280600080191681526020016000801916815260200160006fffffffffffffffffffffffffffffffff19168152602001600061ffff168152509056fea265627a7a72315820c75d434bbb0c9d4ddeddeebe0af1f6a1ba5e70a72a5cfb7a7629a2fc63005c1964736f6c63430005110032\",", "originalCommit": "be86317567515b579bdade225318936398aa14f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc0NDY3MA==", "url": "https://github.com/hyperledger/besu/pull/945#discussion_r427744670", "bodyText": "Could be due to different compiler version.", "author": "lucassaldanha", "createdAt": "2020-05-20T05:10:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY5NDQ2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY5NjA4Nw==", "url": "https://github.com/hyperledger/besu/pull/945#discussion_r427696087", "bodyText": "these tests pass for me running on ganache", "author": "macfarla", "createdAt": "2020-05-20T01:48:15Z", "path": "acceptance-tests/tests/simple-permissioning-smart-contract/test/test-node-permissioning.js", "diffHunk": "@@ -19,12 +19,12 @@ contract('Permissioning: Nodes', () => {\n   });\n \n   it('Should compute key', async () => {\n-    let key1 = await proxy.computeKey(node1High, node1Low, node1Host, node1Port);\n-    let key2 = await proxy.computeKey(node1High, node1Low, node1Host, node1Port);\n+    let key1 = await proxy.computeKey(node1High, node1Low, node1Host);\n+    let key2 = await proxy.computeKey(node1High, node1Low, node1Host);\n     assert.equal(key1, key2, \"computed keys should be the same\");\n \n-    let key3 = await proxy.computeKey(node1High, node1Low, node1Host, node2Port);\n-    assert(key3 != key2, \"keys for different ports should be different\");\n+    let key3 = await proxy.computeKey(node2High, node2Low, node2Host);\n+    assert(key3 != key2, \"computed keys for different nodes should be different\");", "originalCommit": "be86317567515b579bdade225318936398aa14f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6797da59c9a3f234b93755431478e06c90ee352c", "url": "https://github.com/hyperledger/besu/commit/6797da59c9a3f234b93755431478e06c90ee352c", "message": "Merge branch 'master' into 907-contract-update", "committedDate": "2020-05-20T10:57:12Z", "type": "commit"}]}