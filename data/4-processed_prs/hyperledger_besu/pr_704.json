{"pr_number": 704, "pr_title": "Separate recId calc from signing", "pr_createdAt": "2020-04-14T06:13:33Z", "pr_url": "https://github.com/hyperledger/besu/pull/704", "timeline": [{"oid": "94c90f5cfd28b7fd9751e9300b3a8d30853ae1c3", "url": "https://github.com/hyperledger/besu/commit/94c90f5cfd28b7fd9751e9300b3a8d30853ae1c3", "message": "Separate recId calc from signing\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>", "committedDate": "2020-04-14T06:10:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg5ODA5MQ==", "url": "https://github.com/hyperledger/besu/pull/704#discussion_r407898091", "bodyText": "DataHash shouldn't be needed here", "author": "jframe", "createdAt": "2020-04-14T06:36:17Z", "path": "crypto/src/main/java/org/hyperledger/besu/crypto/SECP256K1.java", "diffHunk": "@@ -187,9 +187,17 @@ public static Signature sign(final Bytes32 dataHash, final KeyPair keyPair) {\n     signer.init(true, privKey);\n \n     final BigInteger[] components = signer.generateSignature(dataHash.toArrayUnsafe());\n-    final BigInteger r = components[0];\n-    BigInteger s = components[1];\n \n+    return normaliseSignature(components[0], components[1], keyPair.getPublicKey(), dataHash);\n+  }\n+\n+  public static Signature normaliseSignature(\n+      final BigInteger nativeR,\n+      final BigInteger nativeS,\n+      final PublicKey publicKey,\n+      final Bytes32 dataHash) {", "originalCommit": "94c90f5cfd28b7fd9751e9300b3a8d30853ae1c3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg5ODgwNw==", "url": "https://github.com/hyperledger/besu/pull/704#discussion_r407898807", "bodyText": "its used to ensure the foward-backward signature works (line 221)", "author": "rain-on", "createdAt": "2020-04-14T06:38:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg5ODA5MQ=="}], "type": "inlineReview"}, {"oid": "07e8e9729ec80618efca44b6706a41419a6ea786", "url": "https://github.com/hyperledger/besu/commit/07e8e9729ec80618efca44b6706a41419a6ea786", "message": "Merge branch 'master' into tweak_sig", "committedDate": "2020-04-15T02:49:45Z", "type": "commit"}]}