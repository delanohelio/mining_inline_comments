{"pr_number": 574, "pr_title": "Fix: ensure that node is displayed if recorded", "pr_createdAt": "2020-03-25T12:18:27Z", "pr_url": "https://github.com/hyperledger/besu/pull/574", "timeline": [{"oid": "ad7a796f4449c81782ec3533ef2fce8a3338c2ab", "url": "https://github.com/hyperledger/besu/commit/ad7a796f4449c81782ec3533ef2fce8a3338c2ab", "message": "Fix: ensure that node is displayed if recorded\n\n(Only affects usage of runBesuAsProcess=false)\n\nSigned-off-by: Horacio Mijail Anton Quiles <hmijail@gmail.com>", "committedDate": "2020-03-25T12:09:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI0MTg4MQ==", "url": "https://github.com/hyperledger/besu/pull/574#discussion_r398241881", "bodyText": "What the side affect of this change, need a regex applied on log line strikes me as unusual", "author": "CjHare", "createdAt": "2020-03-25T23:59:37Z", "path": "acceptance-tests/tests/src/test/resources/log4j2.xml", "diffHunk": "@@ -5,7 +5,10 @@\n   </Properties>\n   <Appenders>\n     <Console name=\"Console\" target=\"SYSTEM_OUT\">\n-      <PatternLayout pattern=\"%X{test} | %d{HH:mm:ss.SSS} | %t | %-5level | %c{1} | %msg%n\" />\n+      <PatternLayout>\n+        <pattern>%X{test} | %X{node} | %d{HH:mm:ss.SSS} | %t | %-5level | %c{1} | %msg%n</pattern>\n+        <replace regex=\"\\|  \\| \" replacement=\"| \"/>", "originalCommit": "ad7a796f4449c81782ec3533ef2fce8a3338c2ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI4MjEwNA==", "url": "https://github.com/hyperledger/besu/pull/574#discussion_r398282104", "bodyText": "The regex replacement is just to have cleaner log lines.\nIf no node information exists at the time of the logging, 2 separators | would appear together, like in the first line of these 2:\nshouldNotDisplayDisabledServices |  | 21:38:17.681 | Test worker | INFO  | Cluster | Starting node nodeB (id = 372a...bafb)\nshouldNotDisplayDisabledServices | nodeB | 21:38:17.685 | Test worker | INFO  | RocksDBKeyValueStorageFactory | No existing database detected at /var/folders/fg/txwyt5v92fncr6n02trmjwv40000gs/T/acctest2010709804941575271. Using version 1\n\nThe replacement removes the duplicate separator in that case:\nshouldNotDisplayDisabledServices | 21:38:17.681 | Test worker | INFO  | Cluster | Starting node nodeB (id = 372a...bafb)\nshouldNotDisplayDisabledServices | nodeB | 21:38:17.685 | Test worker | INFO  | RocksDBKeyValueStorageFactory | No existing database detected at /var/folders/fg/txwyt5v92fncr6n02trmjwv40000gs/T/acctest2010709804941575271. Using version 1\n\nPersonally I even prefer having the explicit empty field between the 2 separators, but I am trying to be extra-clean for upstream.", "author": "hmijail", "createdAt": "2020-03-26T02:27:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI0MTg4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI4NzMyOQ==", "url": "https://github.com/hyperledger/besu/pull/574#discussion_r398287329", "bodyText": "That seems like an unfortunate design choice you're covering up by altering the output.\n\nIf no node information exists at the time of the logging,\n\nWhy is there no node information with this logging? Perhaps different appender is a more appropriate choice, given different context/states?", "author": "CjHare", "createdAt": "2020-03-26T02:47:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI0MTg4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM0OTE3MQ==", "url": "https://github.com/hyperledger/besu/pull/574#discussion_r398349171", "bodyText": "That seems like an unfortunate design choice you're covering up by altering the output.\n\nFirst of all I would note the empty/default/arbitrary initial content in other fields, like the thread name %t. IMO, having an empty field is clearer than having default filler.\nBut of course a trivial solution here is to add a default node name. \"Null\"?\n\nWhy is there no node information with this logging?\n\nThe acceptance test itself doesn't run in a node, so it has no node information. The node information is added to the ThreadContextMap the moment the ThreadBesuNodeRunner starts a new node.\n\nPerhaps different appender is a more appropriate choice, given different context/states?\n\nThat was easy in the process runner scenario; I don't see how that could be done for the thread runner scenario.\nAFAICT, the inheritable ThreadContextMap was purposefully made to do this kind of thing.", "author": "hmijail", "createdAt": "2020-03-26T06:51:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI0MTg4MQ=="}], "type": "inlineReview"}, {"oid": "4a4e172ae460e35c7abe3937669038c9580d75ff", "url": "https://github.com/hyperledger/besu/commit/4a4e172ae460e35c7abe3937669038c9580d75ff", "message": "Merge branch 'master' into show-nodes-for-thread-runners", "committedDate": "2020-03-26T02:28:54Z", "type": "commit"}, {"oid": "c0dcc438c8cb223dc1e9c2b10d9a8a69221fe565", "url": "https://github.com/hyperledger/besu/commit/c0dcc438c8cb223dc1e9c2b10d9a8a69221fe565", "message": "Merge branch 'master' into show-nodes-for-thread-runners", "committedDate": "2020-04-01T01:03:42Z", "type": "commit"}, {"oid": "2b13059f32ad6176f77732e034ef1adc75762515", "url": "https://github.com/hyperledger/besu/commit/2b13059f32ad6176f77732e034ef1adc75762515", "message": "Merge branch 'master' into show-nodes-for-thread-runners", "committedDate": "2020-04-01T04:52:35Z", "type": "commit"}]}