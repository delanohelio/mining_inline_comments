{"pr_number": 1185, "pr_title": "Add Integration Test for debug_traceTransaction", "pr_createdAt": "2020-07-01T19:00:41Z", "pr_url": "https://github.com/hyperledger/besu/pull/1185", "timeline": [{"oid": "dad8dae8bd6601bfe0d3f620036ffdc2f657b702", "url": "https://github.com/hyperledger/besu/commit/dad8dae8bd6601bfe0d3f620036ffdc2f657b702", "message": "#1066 Switched to use unprefixed hex strings for memory and stack values\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-06-26T13:37:13Z", "type": "commit"}, {"oid": "01430e770da93ea19171e1a9683daec7c10677f4", "url": "https://github.com/hyperledger/besu/commit/01430e770da93ea19171e1a9683daec7c10677f4", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-06-26T16:53:26Z", "type": "commit"}, {"oid": "aac3bd6d4d5c6f16a4ef1e8c1cf7fb3fd8346b7d", "url": "https://github.com/hyperledger/besu/commit/aac3bd6d4d5c6f16a4ef1e8c1cf7fb3fd8346b7d", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-06-30T17:04:49Z", "type": "commit"}, {"oid": "17aa301cff4a1192efb3a0d3e53e05995dafa744", "url": "https://github.com/hyperledger/besu/commit/17aa301cff4a1192efb3a0d3e53e05995dafa744", "message": "Disable flaky tests per Ben Burns(Yeti) request\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-06-30T20:58:04Z", "type": "commit"}, {"oid": "4a987ae3bd51de708b0f230a26b56785142ec06f", "url": "https://github.com/hyperledger/besu/commit/4a987ae3bd51de708b0f230a26b56785142ec06f", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-06-30T23:43:03Z", "type": "commit"}, {"oid": "520d3172fad19bb6ff7055c44b6ddce524ee8bce", "url": "https://github.com/hyperledger/besu/commit/520d3172fad19bb6ff7055c44b6ddce524ee8bce", "message": "Revert last commit and enable ignored tests.\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-06-30T23:45:44Z", "type": "commit"}, {"oid": "8c518d9906acce09587f42eb19ca19d57179fd64", "url": "https://github.com/hyperledger/besu/commit/8c518d9906acce09587f42eb19ca19d57179fd64", "message": "Merge branch 'master' of github.com:hyperledger/besu into TKT-1164", "committedDate": "2020-07-01T18:50:20Z", "type": "commit"}, {"oid": "277b1457827bea0efa0497cff6175483502e916d", "url": "https://github.com/hyperledger/besu/commit/277b1457827bea0efa0497cff6175483502e916d", "message": "#1164 - Added test for DebugTraceTransaction\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-07-01T18:52:57Z", "type": "commit"}, {"oid": "3e3ffe5d50226d1b01b4fe682ead08af876273f1", "url": "https://github.com/hyperledger/besu/commit/3e3ffe5d50226d1b01b4fe682ead08af876273f1", "message": "#1164 - Formatting\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-07-01T18:54:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY4MTU3Ng==", "url": "https://github.com/hyperledger/besu/pull/1185#discussion_r448681576", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                assertThat(debugTraceTransactionResult.getStructLogs().size()).isEqualTo(106);\n          \n          \n            \n                assertThat(debugTraceTransactionResult.getStructLogs()).hasSize(106);", "author": "shemnon", "createdAt": "2020-07-02T00:21:28Z", "path": "ethereum/api/src/integration-test/java/org/hyperledger/besu/ethereum/api/jsonrpc/methods/DebugTraceTransactionIntegrationTest.java", "diffHunk": "@@ -0,0 +1,96 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.api.jsonrpc.methods;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.hyperledger.besu.ethereum.api.jsonrpc.BlockchainImporter;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.JsonRpcTestMethodsFactory;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.JsonRpcRequest;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.JsonRpcRequestContext;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.JsonRpcMethod;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcResponseType;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcSuccessResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.DebugTraceTransactionResult;\n+import org.hyperledger.besu.ethereum.core.Hash;\n+import org.hyperledger.besu.testutil.BlockTestUtil;\n+\n+import java.util.Map;\n+\n+import com.google.common.base.Charsets;\n+import com.google.common.io.Resources;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+public class DebugTraceTransactionIntegrationTest {\n+  private static final String DEBUG_TRACE_TRANSACTION = \"debug_traceTransaction\";\n+  private static JsonRpcTestMethodsFactory blockchain;\n+  private JsonRpcMethod method;\n+\n+  @BeforeClass\n+  public static void setUpOnce() throws Exception {\n+    final String genesisJson =\n+        Resources.toString(BlockTestUtil.getTestGenesisUrl(), Charsets.UTF_8);\n+\n+    blockchain =\n+        new JsonRpcTestMethodsFactory(\n+            new BlockchainImporter(BlockTestUtil.getTestBlockchainUrl(), genesisJson));\n+  }\n+\n+  @Before\n+  public void setUp() {\n+    final Map<String, JsonRpcMethod> methods = blockchain.methods();\n+    method = methods.get(DEBUG_TRACE_TRANSACTION);\n+  }\n+\n+  @Test\n+  public void debugTraceTransactionSuccessTest() {\n+    final Map<String, Boolean> map = Map.of(\"disableStorage\", true);\n+    final Object[] params =\n+        new Object[] {\n+          Hash.fromHexString(\"0xcef53f2311d7c80e9086d661e69ac11a5f3d081e28e02a9ba9b66749407ac310\"),\n+          map\n+        };\n+    final JsonRpcRequestContext request =\n+        new JsonRpcRequestContext(new JsonRpcRequest(\"2.0\", DEBUG_TRACE_TRANSACTION, params));\n+\n+    final JsonRpcResponse response = method.response(request);\n+    assertThat(response.getType()).isEqualTo(JsonRpcResponseType.SUCCESS);\n+    DebugTraceTransactionResult debugTraceTransactionResult =\n+        (DebugTraceTransactionResult) ((JsonRpcSuccessResponse) response).getResult();\n+    assertThat(debugTraceTransactionResult.getGas()).isEqualTo(23705L);\n+    assertThat(debugTraceTransactionResult.getReturnValue()).isEmpty();\n+    assertThat(debugTraceTransactionResult.failed()).isFalse();\n+    assertThat(debugTraceTransactionResult.getStructLogs().size()).isEqualTo(106);", "originalCommit": "3e3ffe5d50226d1b01b4fe682ead08af876273f1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4ae4397e2f728c077f19c95ffa70a62b0e9337b1", "url": "https://github.com/hyperledger/besu/commit/4ae4397e2f728c077f19c95ffa70a62b0e9337b1", "message": "Merge branch 'master' into TKT-1164", "committedDate": "2020-07-06T15:31:48Z", "type": "commit"}, {"oid": "d842b7e14fc2ee6a54ac83e604d3afd260c1323e", "url": "https://github.com/hyperledger/besu/commit/d842b7e14fc2ee6a54ac83e604d3afd260c1323e", "message": "#1164 - added full JSON tests.\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-07-06T18:08:38Z", "type": "commit"}, {"oid": "fb5648d312274e256a9fe1bdb213dd340eeccd12", "url": "https://github.com/hyperledger/besu/commit/fb5648d312274e256a9fe1bdb213dd340eeccd12", "message": "Merge branch 'master' into TKT-1164", "committedDate": "2020-07-06T18:09:48Z", "type": "commit"}]}