{"pr_number": 386, "pr_title": "More trace fixes", "pr_createdAt": "2020-02-11T17:56:17Z", "pr_url": "https://github.com/hyperledger/besu/pull/386", "timeline": [{"oid": "9d7396d0d979c07367d1ef5025d3f981e5c255fb", "url": "https://github.com/hyperledger/besu/commit/9d7396d0d979c07367d1ef5025d3f981e5c255fb", "message": "More trace fixes\n\n* pop flat trace context when handling halts\n* Better detection of precompiled and non-executed contracts\n* correct from address when calling in init code\n* fix some exotic nesting cases\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>", "committedDate": "2020-02-11T17:51:32Z", "type": "commit"}, {"oid": "d8069f97d4b896aacdbb0b1838d3d042d70f2a30", "url": "https://github.com/hyperledger/besu/commit/d8069f97d4b896aacdbb0b1838d3d042d70f2a30", "message": "findbugz\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>", "committedDate": "2020-02-11T18:00:16Z", "type": "commit"}, {"oid": "1d469f8eaeb53967c267d493c55e96ece376d9a6", "url": "https://github.com/hyperledger/besu/commit/1d469f8eaeb53967c267d493c55e96ece376d9a6", "message": "moar fixes\n\n* init code 2 deep call correct from\n* correct cost on a non-call\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>", "committedDate": "2020-02-11T20:51:12Z", "type": "commit"}, {"oid": "e23994d94b1cf84e2530c5a0ca178418552ca680", "url": "https://github.com/hyperledger/besu/commit/e23994d94b1cf84e2530c5a0ca178418552ca680", "message": "errorprone\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>", "committedDate": "2020-02-11T21:57:16Z", "type": "commit"}, {"oid": "67b5ada537a359b3363eb8c5d3cb88c10b18fbb4", "url": "https://github.com/hyperledger/besu/commit/67b5ada537a359b3363eb8c5d3cb88c10b18fbb4", "message": "changelog and notes\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>", "committedDate": "2020-02-12T00:01:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAwMzM4Mw==", "url": "https://github.com/hyperledger/besu/pull/386#discussion_r378003383", "bodyText": "Suggest \"using\" instead of \"via\". Also, what do you mean by \"philosophical differences\"? Perhaps just \"differences\" and leave it at that?", "author": "grantnoble", "createdAt": "2020-02-12T01:59:57Z", "path": "CHANGELOG.md", "diffHunk": "@@ -1,5 +1,13 @@\n # Changelog\n \n+## 1.4 RC \n+\n+### Additions and Improvements \n+\n+- New`trace_replayBlockTransactions` JSON-RPC API\n+\n+This can be enabled via the `--rpc-http-api TRACE` CLI flag.  There are some philosophical differences between Besu and other implementations that are outlined in the `[trace_rpc_apis.md](./docs/trace_rpc_apis.md)` documentation.", "originalCommit": "67b5ada537a359b3363eb8c5d3cb88c10b18fbb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNDQ5MA==", "url": "https://github.com/hyperledger/besu/pull/386#discussion_r378034490", "bodyText": "There are two ways to view the correctness of the memory for a return call, as seen lower.  I wanted to qualify why we are different.", "author": "shemnon", "createdAt": "2020-02-12T04:22:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAwMzM4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNTAyNA==", "url": "https://github.com/hyperledger/besu/pull/386#discussion_r378035024", "bodyText": "Fair enough.", "author": "grantnoble", "createdAt": "2020-02-12T04:25:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAwMzM4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAwMzU0Mw==", "url": "https://github.com/hyperledger/besu/pull/386#discussion_r378003543", "bodyText": "\"have been\" -> \"were\" or \"are\"", "author": "grantnoble", "createdAt": "2020-02-12T02:00:42Z", "path": "docs/trace_rpc_apis.md", "diffHunk": "@@ -0,0 +1,37 @@\n+# Trace RPC API nodes\n+\n+This document outlines major differences for `trace_replayBlockTransactions` \n+compared to other implementations.\n+\n+## `stateDiff` \n+\n+No major differences have been observed in the `stateDiff` field.", "originalCommit": "67b5ada537a359b3363eb8c5d3cb88c10b18fbb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNTc0MQ==", "url": "https://github.com/hyperledger/besu/pull/386#discussion_r378035741", "bodyText": "done", "author": "shemnon", "createdAt": "2020-02-12T04:29:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAwMzU0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAwMzcyOQ==", "url": "https://github.com/hyperledger/besu/pull/386#discussion_r378003729", "bodyText": "\"will report\" -> \"reports\"", "author": "grantnoble", "createdAt": "2020-02-12T02:01:23Z", "path": "docs/trace_rpc_apis.md", "diffHunk": "@@ -0,0 +1,37 @@\n+# Trace RPC API nodes\n+\n+This document outlines major differences for `trace_replayBlockTransactions` \n+compared to other implementations.\n+\n+## `stateDiff` \n+\n+No major differences have been observed in the `stateDiff` field.\n+\n+## `trace`\n+\n+Besu will report `gasUsed` after applying the effects of gas refunds.  Future", "originalCommit": "67b5ada537a359b3363eb8c5d3cb88c10b18fbb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAwNDAxMQ==", "url": "https://github.com/hyperledger/besu/pull/386#discussion_r378004011", "bodyText": "\"may\" -> \"might\"", "author": "grantnoble", "createdAt": "2020-02-12T02:02:09Z", "path": "docs/trace_rpc_apis.md", "diffHunk": "@@ -0,0 +1,37 @@\n+# Trace RPC API nodes\n+\n+This document outlines major differences for `trace_replayBlockTransactions` \n+compared to other implementations.\n+\n+## `stateDiff` \n+\n+No major differences have been observed in the `stateDiff` field.\n+\n+## `trace`\n+\n+Besu will report `gasUsed` after applying the effects of gas refunds.  Future\n+implementations of Besu may track gas refunds separately.", "originalCommit": "67b5ada537a359b3363eb8c5d3cb88c10b18fbb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNTc1OA==", "url": "https://github.com/hyperledger/besu/pull/386#discussion_r378035758", "bodyText": "done", "author": "shemnon", "createdAt": "2020-02-12T04:29:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAwNDAxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAwNDE3OA==", "url": "https://github.com/hyperledger/besu/pull/386#discussion_r378004178", "bodyText": "\"will only report\" -> \"only reports\"", "author": "grantnoble", "createdAt": "2020-02-12T02:02:54Z", "path": "docs/trace_rpc_apis.md", "diffHunk": "@@ -0,0 +1,37 @@\n+# Trace RPC API nodes\n+\n+This document outlines major differences for `trace_replayBlockTransactions` \n+compared to other implementations.\n+\n+## `stateDiff` \n+\n+No major differences have been observed in the `stateDiff` field.\n+\n+## `trace`\n+\n+Besu will report `gasUsed` after applying the effects of gas refunds.  Future\n+implementations of Besu may track gas refunds separately.\n+\n+## `vmTrace`\n+\n+### Returned Memory from Calls\n+\n+In the `vmTrace` `ope.ex.mem` fields Besu will only report actual data returned", "originalCommit": "67b5ada537a359b3363eb8c5d3cb88c10b18fbb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAwNDQyNA==", "url": "https://github.com/hyperledger/besu/pull/386#discussion_r378004424", "bodyText": "Perhaps \"Note two major differences:\"", "author": "grantnoble", "createdAt": "2020-02-12T02:03:57Z", "path": "docs/trace_rpc_apis.md", "diffHunk": "@@ -0,0 +1,37 @@\n+# Trace RPC API nodes\n+\n+This document outlines major differences for `trace_replayBlockTransactions` \n+compared to other implementations.\n+\n+## `stateDiff` \n+\n+No major differences have been observed in the `stateDiff` field.\n+\n+## `trace`\n+\n+Besu will report `gasUsed` after applying the effects of gas refunds.  Future\n+implementations of Besu may track gas refunds separately.\n+\n+## `vmTrace`\n+\n+### Returned Memory from Calls\n+\n+In the `vmTrace` `ope.ex.mem` fields Besu will only report actual data returned\n+fron a `RETURN` opcode.  Other implementations return the contents of the \n+reserved output space for the call operations.  Two major differences will be ", "originalCommit": "67b5ada537a359b3363eb8c5d3cb88c10b18fbb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNTc3Mg==", "url": "https://github.com/hyperledger/besu/pull/386#discussion_r378035772", "bodyText": "done", "author": "shemnon", "createdAt": "2020-02-12T04:29:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAwNDQyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAwNDU2Mg==", "url": "https://github.com/hyperledger/besu/pull/386#discussion_r378004562", "bodyText": "\"will report\" -> \"reports\"", "author": "grantnoble", "createdAt": "2020-02-12T02:04:34Z", "path": "docs/trace_rpc_apis.md", "diffHunk": "@@ -0,0 +1,37 @@\n+# Trace RPC API nodes\n+\n+This document outlines major differences for `trace_replayBlockTransactions` \n+compared to other implementations.\n+\n+## `stateDiff` \n+\n+No major differences have been observed in the `stateDiff` field.\n+\n+## `trace`\n+\n+Besu will report `gasUsed` after applying the effects of gas refunds.  Future\n+implementations of Besu may track gas refunds separately.\n+\n+## `vmTrace`\n+\n+### Returned Memory from Calls\n+\n+In the `vmTrace` `ope.ex.mem` fields Besu will only report actual data returned\n+fron a `RETURN` opcode.  Other implementations return the contents of the \n+reserved output space for the call operations.  Two major differences will be \n+noted:\n+\n+1. Besu will report null when a call operation ends because of a `STOP`, `HALT`,", "originalCommit": "67b5ada537a359b3363eb8c5d3cb88c10b18fbb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAwNDc2OQ==", "url": "https://github.com/hyperledger/besu/pull/386#discussion_r378004769", "bodyText": "\"will be reported\" -> \"is reported\"", "author": "grantnoble", "createdAt": "2020-02-12T02:05:34Z", "path": "docs/trace_rpc_apis.md", "diffHunk": "@@ -0,0 +1,37 @@\n+# Trace RPC API nodes\n+\n+This document outlines major differences for `trace_replayBlockTransactions` \n+compared to other implementations.\n+\n+## `stateDiff` \n+\n+No major differences have been observed in the `stateDiff` field.\n+\n+## `trace`\n+\n+Besu will report `gasUsed` after applying the effects of gas refunds.  Future\n+implementations of Besu may track gas refunds separately.\n+\n+## `vmTrace`\n+\n+### Returned Memory from Calls\n+\n+In the `vmTrace` `ope.ex.mem` fields Besu will only report actual data returned\n+fron a `RETURN` opcode.  Other implementations return the contents of the \n+reserved output space for the call operations.  Two major differences will be \n+noted:\n+\n+1. Besu will report null when a call operation ends because of a `STOP`, `HALT`,\n+   `REVERT`, running out of instructions, or any exceptional halts.\n+2. When a `RETURN` operation returns data of a different length than the space\n+   reserved by the call only the data passed to the `RETURN` operation will be ", "originalCommit": "67b5ada537a359b3363eb8c5d3cb88c10b18fbb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNTc5OQ==", "url": "https://github.com/hyperledger/besu/pull/386#discussion_r378035799", "bodyText": "done", "author": "shemnon", "createdAt": "2020-02-12T04:29:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAwNDc2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAwNTM2Mg==", "url": "https://github.com/hyperledger/besu/pull/386#discussion_r378005362", "bodyText": "No quotes around cost?", "author": "grantnoble", "createdAt": "2020-02-12T02:08:11Z", "path": "docs/trace_rpc_apis.md", "diffHunk": "@@ -0,0 +1,37 @@\n+# Trace RPC API nodes\n+\n+This document outlines major differences for `trace_replayBlockTransactions` \n+compared to other implementations.\n+\n+## `stateDiff` \n+\n+No major differences have been observed in the `stateDiff` field.\n+\n+## `trace`\n+\n+Besu will report `gasUsed` after applying the effects of gas refunds.  Future\n+implementations of Besu may track gas refunds separately.\n+\n+## `vmTrace`\n+\n+### Returned Memory from Calls\n+\n+In the `vmTrace` `ope.ex.mem` fields Besu will only report actual data returned\n+fron a `RETURN` opcode.  Other implementations return the contents of the \n+reserved output space for the call operations.  Two major differences will be \n+noted:\n+\n+1. Besu will report null when a call operation ends because of a `STOP`, `HALT`,\n+   `REVERT`, running out of instructions, or any exceptional halts.\n+2. When a `RETURN` operation returns data of a different length than the space\n+   reserved by the call only the data passed to the `RETURN` operation will be \n+   reported.  Other implementations will include pre-existing memory data or \n+   trim the returned data.\n+\n+### Precompiled contracts calls\n+\n+Besu reports only the actual cost of the precompiled contract call in the \n+`\"cost\"` field. ", "originalCommit": "67b5ada537a359b3363eb8c5d3cb88c10b18fbb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e7506312c1edb906064204f41bbe67e4dc8637e9", "url": "https://github.com/hyperledger/besu/commit/e7506312c1edb906064204f41bbe67e4dc8637e9", "message": "editing revisions\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>", "committedDate": "2020-02-12T04:25:54Z", "type": "commit"}, {"oid": "6f07a2fbf5c33584f3189f9ae1f20da70b336e74", "url": "https://github.com/hyperledger/besu/commit/6f07a2fbf5c33584f3189f9ae1f20da70b336e74", "message": "editing revisions\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>", "committedDate": "2020-02-12T04:42:13Z", "type": "commit"}, {"oid": "54b16c8d2844c82b7d662dfbb336e95abfedeaaf", "url": "https://github.com/hyperledger/besu/commit/54b16c8d2844c82b7d662dfbb336e95abfedeaaf", "message": "style\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>", "committedDate": "2020-02-12T16:14:33Z", "type": "commit"}, {"oid": "7a05453245030fee129b307dbbdf842f410c4bdf", "url": "https://github.com/hyperledger/besu/commit/7a05453245030fee129b307dbbdf842f410c4bdf", "message": "Merge branch 'master' into tracevm", "committedDate": "2020-02-12T17:14:22Z", "type": "commit"}]}