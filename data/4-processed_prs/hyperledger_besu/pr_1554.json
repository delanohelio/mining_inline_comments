{"pr_number": 1554, "pr_title": "Added zero gasPrice validation for Quorum compatibility mode.", "pr_createdAt": "2020-11-12T03:44:00Z", "pr_url": "https://github.com/hyperledger/besu/pull/1554", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQ5Mzg1Ng==", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r522493856", "bodyText": "s/Compat/Compatible", "author": "macfarla", "createdAt": "2020-11-12T23:11:41Z", "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -1406,6 +1406,7 @@ private void issueOptionWarnings() {\n \n   private BesuCommand configure() throws Exception {\n     checkPortClash();\n+    checkQuorumCompatConfig();", "originalCommit": "836ce5f75cebd5a34ca2d63d13717690276b418e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjUwNzIxMw==", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r522507213", "bodyText": "Quorum typo", "author": "macfarla", "createdAt": "2020-11-12T23:39:16Z", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/MainnetTransactionValidator.java", "diffHunk": "@@ -94,6 +99,12 @@ public MainnetTransactionValidator(\n       return signatureResult;\n     }\n \n+    if (quorumCompatibilityMode && !transaction.getGasPrice().isZero()) {\n+      return ValidationResult.invalid(\n+          TransactionInvalidReason.GAS_PRICE_MUST_BE_ZERO,\n+          \"gasPrice must be set to zero on a Quroum compatible network\");", "originalCommit": "836ce5f75cebd5a34ca2d63d13717690276b418e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjU0OTMyMA==", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r522549320", "bodyText": "It's needs to be GoQuorum as well (I feel your pain on misspelling Quorum however - Nico has caught a bunch of those typos from me in the GoQuorum docs) -> Quorum now includes Hyperledger Besu.", "author": "MadelineMurray", "createdAt": "2020-11-13T01:21:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjUwNzIxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjUwODA0Ng==", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r522508046", "bodyText": "here we're calling it Quorum interop. TransactionValidator has \"Quorum compatible\". I don't have strong feelings but should be consistent.", "author": "macfarla", "createdAt": "2020-11-12T23:41:41Z", "path": "besu/src/test/java/org/hyperledger/besu/cli/BesuCommandTest.java", "diffHunk": "@@ -3789,4 +3791,29 @@ public void assertThatAllPortsSpecifiedSucceeds() {\n         \"--miner-stratum-port=15\");\n     assertThat(commandErrorOutput.toString()).isEmpty();\n   }\n+\n+  @Test\n+  public void quorumInteropEnabledFailsWithoutGasPriceSet() throws IOException {\n+    final Path genesisFile = createFakeGenesisFile(GENESIS_QUORUM_INTEROP_ENABLED);\n+    parseCommand(\"--genesis-file\", genesisFile.toString());\n+    assertThat(commandErrorOutput.toString())\n+        .contains(\n+            \"--min-gas-price must be set to zero if Quorum interop is enabled in the genesis config.\");", "originalCommit": "836ce5f75cebd5a34ca2d63d13717690276b418e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjU0OTUxNg==", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r522549516", "bodyText": "No strong feelings either.  If you need a tie break, I'd choose \"GoQuorum compatible\"", "author": "MadelineMurray", "createdAt": "2020-11-13T01:22:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjUwODA0Ng=="}], "type": "inlineReview"}, {"oid": "4bafafaf28a23fa4ea57b117198ee8b6d4ec780c", "url": "https://github.com/hyperledger/besu/commit/4bafafaf28a23fa4ea57b117198ee8b6d4ec780c", "message": "Added zero gasPrice validation for Quorum compatibility mode.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-11-15T13:37:25Z", "type": "commit"}, {"oid": "5eaf1e9512b8595a60b1722767770d9a0abdb50f", "url": "https://github.com/hyperledger/besu/commit/5eaf1e9512b8595a60b1722767770d9a0abdb50f", "message": "Added Quorum interop genesis/config check.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-11-15T13:39:21Z", "type": "commit"}, {"oid": "b897ead4f5440a566c2b4e285ec38a95d1fba133", "url": "https://github.com/hyperledger/besu/commit/b897ead4f5440a566c2b4e285ec38a95d1fba133", "message": "Test name fix.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-11-15T13:39:21Z", "type": "commit"}, {"oid": "fce3e5ab50eb1a2a2a4220a922f87d2525dc716a", "url": "https://github.com/hyperledger/besu/commit/fce3e5ab50eb1a2a2a4220a922f87d2525dc716a", "message": "PR fixes - renames.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-11-15T13:39:54Z", "type": "commit"}, {"oid": "c1ed77f1bd24b1c5911047f00873b4e317821a22", "url": "https://github.com/hyperledger/besu/commit/c1ed77f1bd24b1c5911047f00873b4e317821a22", "message": "PR fixes - RPC response improvement + tests.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-11-15T13:39:54Z", "type": "commit"}, {"oid": "c1ed77f1bd24b1c5911047f00873b4e317821a22", "url": "https://github.com/hyperledger/besu/commit/c1ed77f1bd24b1c5911047f00873b4e317821a22", "message": "PR fixes - RPC response improvement + tests.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-11-15T13:39:54Z", "type": "forcePushed"}, {"oid": "b1e399d4f7d78fc935507f82bca5ac147e6f462c", "url": "https://github.com/hyperledger/besu/commit/b1e399d4f7d78fc935507f82bca5ac147e6f462c", "message": "Merge fix.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-11-15T13:50:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgzMzI0OQ==", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r523833249", "bodyText": "should this be isGoQuorum()", "author": "macfarla", "createdAt": "2020-11-15T23:49:59Z", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/difficulty/fixed/FixedDifficultyProtocolSchedule.java", "diffHunk": "@@ -30,7 +30,8 @@ public static ProtocolSchedule create(\n             config,\n             builder -> builder.difficultyCalculator(FixedDifficultyCalculators.calculator(config)),\n             privacyParameters,\n-            isMetadataEnabled)\n+            isMetadataEnabled,\n+            config.isQuorum())", "originalCommit": "b1e399d4f7d78fc935507f82bca5ac147e6f462c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgzMzI4Ng==", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r523833286", "bodyText": "goQuorumCompatibilityMode", "author": "macfarla", "createdAt": "2020-11-15T23:50:20Z", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/MainnetTransactionValidator.java", "diffHunk": "@@ -48,18 +48,21 @@\n   private Optional<TransactionFilter> transactionFilter = Optional.empty();\n   private final Optional<EIP1559> maybeEip1559;\n   private final AcceptedTransactionTypes acceptedTransactionTypes;\n+  private final boolean quorumCompatibilityMode;", "originalCommit": "b1e399d4f7d78fc935507f82bca5ac147e6f462c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgzMzM0NQ==", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r523833345", "bodyText": "GoQuorum", "author": "macfarla", "createdAt": "2020-11-15T23:50:48Z", "path": "ethereum/core/src/test/java/org/hyperledger/besu/ethereum/mainnet/MainnetTransactionValidatorTest.java", "diffHunk": "@@ -60,6 +61,8 @@\n           .chainId(Optional.of(BigInteger.ONE))\n           .createTransaction(senderKeys);\n \n+  private final boolean defaultQuorumCompatibilityMode = false;", "originalCommit": "b1e399d4f7d78fc935507f82bca5ac147e6f462c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgzMzM4Mg==", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r523833382", "bodyText": "goQuorum", "author": "macfarla", "createdAt": "2020-11-15T23:51:11Z", "path": "ethereum/core/src/test/java/org/hyperledger/besu/ethereum/mainnet/MainnetTransactionValidatorTest.java", "diffHunk": "@@ -332,6 +355,36 @@ public void shouldAcceptValidEIP1559() {\n     ExperimentalEIPs.eip1559Enabled = false;\n   }\n \n+  @Test\n+  public void quorumCompatibilityModeRejectNonZeroGasPrice() {", "originalCommit": "b1e399d4f7d78fc935507f82bca5ac147e6f462c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fd760dfa62295fae11be6e08cbe1d50e2b38a954", "url": "https://github.com/hyperledger/besu/commit/fd760dfa62295fae11be6e08cbe1d50e2b38a954", "message": "PR fixes.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-11-16T02:45:20Z", "type": "commit"}]}