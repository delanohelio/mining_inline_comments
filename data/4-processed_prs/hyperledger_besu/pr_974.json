{"pr_number": 974, "pr_title": "feat: FastSync now stops on failure instead of falling back to FullSync", "pr_createdAt": "2020-05-24T17:14:12Z", "pr_url": "https://github.com/hyperledger/besu/pull/974", "timeline": [{"oid": "8306abbb7a0662e5d32cf8e836be9a294c8883ae", "url": "https://github.com/hyperledger/besu/commit/8306abbb7a0662e5d32cf8e836be9a294c8883ae", "message": "feat: FastSync now stops on failure instead of falling back to FullSync\n\nSigned-off-by: Alexandre PARIS-VERGNE <alexpv14@gmail.com>", "committedDate": "2020-05-24T17:09:30Z", "type": "commit"}, {"oid": "36a78e8f70610986a28cb39affa7177f09e47a23", "url": "https://github.com/hyperledger/besu/commit/36a78e8f70610986a28cb39affa7177f09e47a23", "message": "Merge branch 'master' into feature/683-fast-sync-falls-back-to-full-sync-on-fastsyncexception", "committedDate": "2020-05-27T07:37:28Z", "type": "commit"}, {"oid": "751d72367e9223b2023077e2dc3686c889f05096", "url": "https://github.com/hyperledger/besu/commit/751d72367e9223b2023077e2dc3686c889f05096", "message": "feat: exiting on FastSync failed\n\nSigned-off-by: Alexandre PARIS-VERGNE <alexpv14@gmail.com>", "committedDate": "2020-05-27T07:45:36Z", "type": "commit"}, {"oid": "4ff1912792fadf9323f99f377f4c09e8e63fe999", "url": "https://github.com/hyperledger/besu/commit/4ff1912792fadf9323f99f377f4c09e8e63fe999", "message": "feat: FastSync continues on FullSync when no errors happened\n\nSigned-off-by: Alexandre PARIS-VERGNE <alexpv14@gmail.com>", "committedDate": "2020-05-27T16:29:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAwODQ2OA==", "url": "https://github.com/hyperledger/besu/pull/974#discussion_r434008468", "bodyText": "We have a stop method here, we should probably be calling that instead of just exiting. There could be important resources to close or cleanup nicely now or in the future.", "author": "RatanRSur", "createdAt": "2020-06-02T16:21:43Z", "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/sync/DefaultSynchronizer.java", "diffHunk": "@@ -126,7 +126,16 @@ public void start() {\n       LOG.info(\"Starting synchronizer.\");\n       blockPropagationManager.start();\n       if (fastSyncDownloader.isPresent()) {\n-        fastSyncDownloader.get().start().whenComplete(this::handleFastSyncResult);\n+        fastSyncDownloader\n+            .get()\n+            .start()\n+            .whenComplete(this::handleFastSyncResult)\n+            .exceptionally(\n+                ex -> {\n+                  System.exit(0);\n+                  return null;", "originalCommit": "4ff1912792fadf9323f99f377f4c09e8e63fe999", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEwNTcxMw==", "url": "https://github.com/hyperledger/besu/pull/974#discussion_r434105713", "bodyText": "I think when we call System.exit the shutdown hook will get invoked (which stops everything cleanly), but worth double-checking.", "author": "mbaxter", "createdAt": "2020-06-02T18:53:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAwODQ2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDczMTc4OQ==", "url": "https://github.com/hyperledger/besu/pull/974#discussion_r434731789", "bodyText": "As you may see, the stop method is correctly triggered when the System.exit is called.", "author": "br0tchain", "createdAt": "2020-06-03T17:21:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAwODQ2OA=="}], "type": "inlineReview"}, {"oid": "f09b8e48f7f69dbbccde626872f62e2d9c7788fb", "url": "https://github.com/hyperledger/besu/commit/f09b8e48f7f69dbbccde626872f62e2d9c7788fb", "message": "Merge branch 'master' into feature/683-fast-sync-falls-back-to-full-sync-on-fastsyncexception", "committedDate": "2020-06-03T16:38:58Z", "type": "commit"}, {"oid": "436e43366326d6ecbcc4a387041d2934cba36d7b", "url": "https://github.com/hyperledger/besu/commit/436e43366326d6ecbcc4a387041d2934cba36d7b", "message": "feat: add log on exiting FastSync process\n\nSigned-off-by: Alexandre PARIS-VERGNE <alexpv14@gmail.com>", "committedDate": "2020-06-04T11:44:43Z", "type": "commit"}, {"oid": "2aa8e623c6e14f83b34507e71892d64c00855547", "url": "https://github.com/hyperledger/besu/commit/2aa8e623c6e14f83b34507e71892d64c00855547", "message": "Merge branch 'master' into feature/683-fast-sync-falls-back-to-full-sync-on-fastsyncexception", "committedDate": "2020-06-04T16:52:59Z", "type": "commit"}]}