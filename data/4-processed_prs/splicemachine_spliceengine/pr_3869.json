{"pr_number": 3869, "pr_title": "DB-9760 Make temporary tables local to their sessions", "pr_createdAt": "2020-07-20T16:18:40Z", "pr_url": "https://github.com/splicemachine/spliceengine/pull/3869", "timeline": [{"oid": "7c51095f4ba09111b4eada3156ce4be4c10f1fe2", "url": "https://github.com/splicemachine/spliceengine/commit/7c51095f4ba09111b4eada3156ce4be4c10f1fe2", "message": "DB-9760 Make temporary tables local to their sessions", "committedDate": "2020-07-20T23:12:56Z", "type": "forcePushed"}, {"oid": "9b10842d89126273d5d2d0eae46939cb8dfb81ed", "url": "https://github.com/splicemachine/spliceengine/commit/9b10842d89126273d5d2d0eae46939cb8dfb81ed", "message": "DB-9760 Make temporary tables local to their sessions", "committedDate": "2020-07-21T09:29:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg1NjU4OA==", "url": "https://github.com/splicemachine/spliceengine/pull/3869#discussion_r471856588", "bodyText": "Remove this?", "author": "jyuanca", "createdAt": "2020-08-18T01:09:23Z", "path": "db-engine/src/main/java/com/splicemachine/db/impl/sql/compile/CreateIndexNode.java", "diffHunk": "@@ -59,7 +57,7 @@\n {\n \tboolean\t\t\t\tunique;\n \tboolean\t\t\t\tuniqueWithDuplicateNulls;\n-\tDataDictionary\t\tdd = null;\n+//\tDataDictionary\t\tdd = null;\n \tProperties\t\t\tproperties;", "originalCommit": "9b10842d89126273d5d2d0eae46939cb8dfb81ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY5MDY5Ng==", "url": "https://github.com/splicemachine/spliceengine/pull/3869#discussion_r474690696", "bodyText": "Done.", "author": "ascend1", "createdAt": "2020-08-21T13:19:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg1NjU4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg1NjY2NA==", "url": "https://github.com/splicemachine/spliceengine/pull/3869#discussion_r471856664", "bodyText": "Same here", "author": "jyuanca", "createdAt": "2020-08-18T01:09:43Z", "path": "db-engine/src/main/java/com/splicemachine/db/impl/sql/compile/CreateIndexNode.java", "diffHunk": "@@ -292,9 +297,9 @@ public ConstantAction\tmakeConstantAction() throws StandardException\n \t{\n \t\tSchemaDescriptor\t\tsd = getSchemaDescriptor();\n \n-\t\tint columnCount = columnNames.length;\n+//\t\tint columnCount = columnNames.length;\n \t\tint approxLength = 0;\n-\t\tboolean index_has_long_column = false;\n+//\t\tboolean index_has_long_column = false;\n ", "originalCommit": "9b10842d89126273d5d2d0eae46939cb8dfb81ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY5MTEwMQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3869#discussion_r474691101", "bodyText": "Done.", "author": "ascend1", "createdAt": "2020-08-21T13:19:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg1NjY2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkwMDcwMg==", "url": "https://github.com/splicemachine/spliceengine/pull/3869#discussion_r471900702", "bodyText": "Session schema is for storing global temporary tables.\nhttp://db.apache.org/derby/docs/10.0/manuals/reference/sqlj33.html\nHowever, it seems we never implement global temporary tables correctly. We may want to file a Jira and fix it.", "author": "jyuanca", "createdAt": "2020-08-18T04:03:51Z", "path": "db-engine/src/main/java/com/splicemachine/db/impl/sql/compile/QueryTreeNode.java", "diffHunk": "@@ -1408,13 +1424,20 @@ protected final TableDescriptor getTableDescriptor(String tableName,\n         if(schema.getUUID()==null)\n             return null;\n \n+        //If not in session schema, look for local temporary table first.\n+        //If tables is not under SESSION schema, don't get it from LCC. Table version is not set there.", "originalCommit": "9b10842d89126273d5d2d0eae46939cb8dfb81ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY5NDA1Nw==", "url": "https://github.com/splicemachine/spliceengine/pull/3869#discussion_r474694057", "bodyText": "Yes, I had a discussion with Gene and Carol about this issue, and they think we should keep the current temporary tables implementation (not in SESSION schema) for now. This renders many places in derby useless since referencesSessionSchema() doesn't work for temporary tables. And it's the main reason that I introduce a new \"referencesTemporaryTables()\".", "author": "ascend1", "createdAt": "2020-08-21T13:24:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkwMDcwMg=="}], "type": "inlineReview"}, {"oid": "a7bb26dbcb9bc02ba2a10d8846083892a1012eeb", "url": "https://github.com/splicemachine/spliceengine/commit/a7bb26dbcb9bc02ba2a10d8846083892a1012eeb", "message": "DB-9760 Address comments", "committedDate": "2020-08-21T13:42:31Z", "type": "forcePushed"}, {"oid": "66c676e435459fd9a9e43be92eaae91deafff981", "url": "https://github.com/splicemachine/spliceengine/commit/66c676e435459fd9a9e43be92eaae91deafff981", "message": "DB-9760 Make temporary tables local to their sessions", "committedDate": "2020-08-25T13:18:07Z", "type": "commit"}, {"oid": "bd881e2ffec2a8f4c2915e18b989fd15e2f65ff8", "url": "https://github.com/splicemachine/spliceengine/commit/bd881e2ffec2a8f4c2915e18b989fd15e2f65ff8", "message": "DB-9760 Address comments", "committedDate": "2020-08-25T13:18:07Z", "type": "commit"}, {"oid": "5377cf04dbe5ee201b03f4a5bf5d986bf4e1d3b8", "url": "https://github.com/splicemachine/spliceengine/commit/5377cf04dbe5ee201b03f4a5bf5d986bf4e1d3b8", "message": "DB-9760 Fix SpotBugs", "committedDate": "2020-08-25T13:35:43Z", "type": "commit"}, {"oid": "5377cf04dbe5ee201b03f4a5bf5d986bf4e1d3b8", "url": "https://github.com/splicemachine/spliceengine/commit/5377cf04dbe5ee201b03f4a5bf5d986bf4e1d3b8", "message": "DB-9760 Fix SpotBugs", "committedDate": "2020-08-25T13:35:43Z", "type": "forcePushed"}, {"oid": "1b58251a06a63731e7d1241b7405c4671387ac02", "url": "https://github.com/splicemachine/spliceengine/commit/1b58251a06a63731e7d1241b7405c4671387ac02", "message": "Merge branch 'master' into DB-9760", "committedDate": "2020-09-09T14:09:51Z", "type": "commit"}, {"oid": "48c041520ea001c74236dec86737d79924881211", "url": "https://github.com/splicemachine/spliceengine/commit/48c041520ea001c74236dec86737d79924881211", "message": "Merge branch 'master' into DB-9760", "committedDate": "2020-09-15T10:14:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY0NTk4OQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3869#discussion_r492645989", "bodyText": "setValid() ?", "author": "martinrupp", "createdAt": "2020-09-22T10:59:36Z", "path": "db-engine/src/main/java/com/splicemachine/db/impl/sql/GenericPreparedStatement.java", "diffHunk": "@@ -905,7 +905,9 @@ public void completeCompile(StatementNode qt) throws StandardException {\n                 updateMode = cursorInfo.updateMode;\n             }\n         }\n-        isValid = true;\n+        synchronized (this) {\n+            isValid = true;\n+        }", "originalCommit": "48c041520ea001c74236dec86737d79924881211", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY5NTM3NA==", "url": "https://github.com/splicemachine/spliceengine/pull/3869#discussion_r493695374", "bodyText": "Second that.", "author": "OlegMazurov", "createdAt": "2020-09-23T15:40:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY0NTk4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDEyOTcwMg==", "url": "https://github.com/splicemachine/spliceengine/pull/3869#discussion_r494129702", "bodyText": "Done.", "author": "ascend1", "createdAt": "2020-09-24T08:23:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY0NTk4OQ=="}], "type": "inlineReview"}, {"oid": "fc2f814ce0cc8ede4089aa1beedb7e754b87eaf6", "url": "https://github.com/splicemachine/spliceengine/commit/fc2f814ce0cc8ede4089aa1beedb7e754b87eaf6", "message": "Merge branch 'master' into DB-9760", "committedDate": "2020-09-22T17:18:33Z", "type": "commit"}, {"oid": "f0b87efdd38309df1be9a58732648ee9e4b9f730", "url": "https://github.com/splicemachine/spliceengine/commit/f0b87efdd38309df1be9a58732648ee9e4b9f730", "message": "DB-9760 Fix new SpotBugs after merging latest head", "committedDate": "2020-09-22T18:55:12Z", "type": "commit"}, {"oid": "47e6e56b01a9a55cb521becdd524f7a70a9518b2", "url": "https://github.com/splicemachine/spliceengine/commit/47e6e56b01a9a55cb521becdd524f7a70a9518b2", "message": "Merge branch 'master' into DB-9760", "committedDate": "2020-09-23T09:00:16Z", "type": "commit"}, {"oid": "a6c9946193a35ce7faf3392567334b92326b33c3", "url": "https://github.com/splicemachine/spliceengine/commit/a6c9946193a35ce7faf3392567334b92326b33c3", "message": "DB-9760 Address comment", "committedDate": "2020-09-24T08:23:05Z", "type": "commit"}]}