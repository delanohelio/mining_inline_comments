{"pr_number": 3836, "pr_title": "DB-9853 Low watermark for transactions should never be MAX_VALUE", "pr_createdAt": "2020-07-15T17:06:44Z", "pr_url": "https://github.com/splicemachine/spliceengine/pull/3836", "timeline": [{"oid": "e6554606bf6b8141d2cbfa91dcc097b7d3ee22c6", "url": "https://github.com/splicemachine/spliceengine/commit/e6554606bf6b8141d2cbfa91dcc097b7d3ee22c6", "message": "DB-9853 Low watermark for transactions should never be MAX_VALUE", "committedDate": "2020-07-15T17:03:12Z", "type": "commit"}, {"oid": "28b49fb1e20b1cdcedbf6a84f7a35bc47d85eba7", "url": "https://github.com/splicemachine/spliceengine/commit/28b49fb1e20b1cdcedbf6a84f7a35bc47d85eba7", "message": "DB-9853 Address comments", "committedDate": "2020-07-16T09:35:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI5MjkyOQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3836#discussion_r456292929", "bodyText": "fetchTimestamp can never bee Long.MAX_VALUE? Or do we assume then we can't fix this here anyhow?", "author": "martinrupp", "createdAt": "2020-07-17T08:19:12Z", "path": "hbase_storage/src/main/java/com/splicemachine/hbase/TransactionsWatcher.java", "diffHunk": "@@ -48,14 +48,19 @@\n         if (isRestoreMode) return;\n \n         long fetchTimestamp = SIDriver.driver().getTimestampSource().currentTimestamp();\n-        long oldestActiveTransaction = fetchOldestActiveTransaction();\n-        if (oldestActiveTransaction == Long.MAX_VALUE) {\n-            lowWatermarkTransaction.set(fetchTimestamp);\n-        } else {\n-            lowWatermarkTransaction.set(oldestActiveTransaction);\n-        }\n-        if (LOG.isDebugEnabled()) {\n-            LOG.debug(String.format(\"lowWatermarkTransaction set: %d\", lowWatermarkTransaction.get()));\n+        try {\n+            long oldestActiveTransaction = fetchOldestActiveTransaction();\n+            if (oldestActiveTransaction == Long.MAX_VALUE) {\n+                lowWatermarkTransaction.set(fetchTimestamp);", "originalCommit": "28b49fb1e20b1cdcedbf6a84f7a35bc47d85eba7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjUwODg2Nw==", "url": "https://github.com/splicemachine/spliceengine/pull/3836#discussion_r456508867", "bodyText": "I don't think that fetchTimestamp can ever reach MAX_VALUE, otherwise, our monotonically increasing timestamp would be broken. @dgomezferro, do you agree?", "author": "arnaud-splice", "createdAt": "2020-07-17T15:18:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI5MjkyOQ=="}], "type": "inlineReview"}]}