{"pr_number": 3654, "pr_title": "DB-9624 Ensure sqlshell.sh works on Windows", "pr_createdAt": "2020-06-05T17:46:47Z", "pr_url": "https://github.com/splicemachine/spliceengine/pull/3654", "timeline": [{"oid": "c8a6312cd656214f2f3fb374fd3da0c00be5cace", "url": "https://github.com/splicemachine/spliceengine/commit/c8a6312cd656214f2f3fb374fd3da0c00be5cace", "message": "DB-9624 sqlshell.cmd for Windows.", "committedDate": "2020-06-02T11:27:45Z", "type": "commit"}, {"oid": "7643d0598c4e5ae7dccc23fb9e5f1c8d234518f0", "url": "https://github.com/splicemachine/spliceengine/commit/7643d0598c4e5ae7dccc23fb9e5f1c8d234518f0", "message": "Add winsqlshell.\n\n- winsqlshell.cmd provides the same functionality of sqlshell on\n  PowerShell and Cmd.\n- Currently it is packaged along with sqlshell.sh. i.e. it is included\n  in the Maven profile sqlshell.", "committedDate": "2020-06-05T17:36:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA3NjMyNQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3654#discussion_r436076325", "bodyText": "I don't think we should include winsqlshell.cmd into Cloudera parcel.", "author": "OlegMazurov", "createdAt": "2020-06-05T17:56:56Z", "path": "assembly/pom.xml", "diffHunk": "@@ -240,6 +240,9 @@\n                                         <copy todir=\"target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin\">\n                                             <fileset dir=\"common/src/main/resources/bin\" includes=\"sqlshell.sh\"/>\n                                         </copy>\n+                                        <copy todir=\"target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin\">", "originalCommit": "7643d0598c4e5ae7dccc23fb9e5f1c8d234518f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA3OTM1Mw==", "url": "https://github.com/splicemachine/spliceengine/pull/3654#discussion_r436079353", "bodyText": "You're right, I thought we would ship it with all supported deliverables, but this is incorrect, we will just add it to the sqlshell profile. Thank you for the hint.", "author": "hatyo", "createdAt": "2020-06-05T18:02:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA3NjMyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA3NjU1Ng==", "url": "https://github.com/splicemachine/spliceengine/pull/3654#discussion_r436076556", "bodyText": "ditto for RPM", "author": "OlegMazurov", "createdAt": "2020-06-05T17:57:17Z", "path": "assembly/pom.xml", "diffHunk": "@@ -644,6 +647,9 @@\n                                                 <source>\n                                                     <location>common/src/main/resources/bin/sqlshell.sh</location>\n                                                 </source>\n+                                                <source>", "originalCommit": "7643d0598c4e5ae7dccc23fb9e5f1c8d234518f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA3OTkxOQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3654#discussion_r436079919", "bodyText": "ok :)", "author": "hatyo", "createdAt": "2020-06-05T18:03:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA3NjU1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA3Nzk0Nw==", "url": "https://github.com/splicemachine/spliceengine/pull/3654#discussion_r436077947", "bodyText": "ditto", "author": "OlegMazurov", "createdAt": "2020-06-05T17:59:46Z", "path": "assembly/pom.xml", "diffHunk": "@@ -1188,6 +1194,9 @@\n                                                 <source>\n                                                     <location>common/src/main/resources/bin/sqlshell.sh</location>\n                                                 </source>\n+                                                <source>", "originalCommit": "7643d0598c4e5ae7dccc23fb9e5f1c8d234518f0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA4MDE5MA==", "url": "https://github.com/splicemachine/spliceengine/pull/3654#discussion_r436080190", "bodyText": "See comment regarding sqshell.sh below.", "author": "OlegMazurov", "createdAt": "2020-06-05T18:04:24Z", "path": "GETTING-STARTED.md", "diffHunk": "@@ -66,3 +66,7 @@ This will compile everything and start the database.\n Then to connect to the database:\n \n `./sqlshell.sh`\n+\n+Or if you are on Windows:\n+\n+`call sqlshell.cmd`", "originalCommit": "7643d0598c4e5ae7dccc23fb9e5f1c8d234518f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA4NDA4OA==", "url": "https://github.com/splicemachine/spliceengine/pull/3654#discussion_r436084088", "bodyText": "ok", "author": "hatyo", "createdAt": "2020-06-05T18:10:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA4MDE5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA4MDI5MQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3654#discussion_r436080291", "bodyText": "That would be a Splice developer sqlshell on Windows. Only there are no Splice developers on Windows.\nI think this file should be removed for now.", "author": "OlegMazurov", "createdAt": "2020-06-05T18:04:35Z", "path": "sqlshell.cmd", "diffHunk": "@@ -0,0 +1,14 @@\n+@echo off\r", "originalCommit": "7643d0598c4e5ae7dccc23fb9e5f1c8d234518f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA4MTM0NQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3654#discussion_r436081345", "bodyText": "You're right, I will remove it (and revert the comment in GETTING-STARTED.md", "author": "hatyo", "createdAt": "2020-06-05T18:06:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA4MDI5MQ=="}], "type": "inlineReview"}, {"oid": "df6dfdd0b9bbb7328787046cebe110eede9d1325", "url": "https://github.com/splicemachine/spliceengine/commit/df6dfdd0b9bbb7328787046cebe110eede9d1325", "message": "Addressed comments.", "committedDate": "2020-06-05T18:21:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIwNDEzMA==", "url": "https://github.com/splicemachine/spliceengine/pull/3654#discussion_r436204130", "bodyText": "needed?", "author": "martinrupp", "createdAt": "2020-06-05T23:21:53Z", "path": "assembly/common/src/main/resources/bin/winsqlshell.cmd", "diffHunk": "@@ -0,0 +1,280 @@\n+@ECHO OFF\r\n+\r\n+SETLOCAL\r\n+\r\n+REM defaults\r\n+SET \"URL=\"\r\n+SET HOST=\"localhost\"\r\n+SET PORT=\"1527\"\r\n+SET USER=\"splice\"\r\n+SET QUOTE=0\r\n+SET PASS=\"admin\"\r\n+SET SECURE=0\r\n+SET \"PRINCIPAL=\"\r\n+SET \"KEYTAB=\"\r\n+SET PROMPT=0\r\n+SET WIDTH=128\r\n+SET \"SCRIPT=\"\r\n+SET \"OUTPUT=\"\r\n+SET QUIET=0\r\n+SET \"HOSTARG=\"\r\n+SET \"PORTARG=\"\r\n+SET \"USERARG=\"\r\n+SET \"PASSARG=\"\r\n+SET SCRIPT_DIR=\"%~dp0\"\r\n+SET SCRIPT_NAME=%~n0%~x0\r\n+\r\n+REM read user arguments\r\n+:loop\r\n+IF NOT [%1] == [] (\r\n+  IF \"%1\" == \"-U\" (\r\n+    SET URL=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-h\" (\r\n+    SET HOSTARG=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-p\" (\r\n+    SET PORTARG=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-u\" (\r\n+    SET USERARG=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-Q\" (\r\n+    SET QUOTE=1\r\n+    SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-s\" (\r\n+    SET PASSARG=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-P\" (\r\n+    SET PROMPT=1\r\n+    SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-S\" (\r\n+    SET SECURE=1\r\n+    SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-k\" (\r\n+    SET PRINCIPAL=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-K\" (\r\n+    SET KEYTAB=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-w\" (\r\n+    SET WIDTH=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-f\" (\r\n+    SET SCRIPT=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-o\" (\r\n+    SET OUTPUT=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-q\" (\r\n+    SET QUIET=1\r\n+    SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE (\r\n+    REM error, print help and exit\r\n+    CALL :help\r\n+    EXIT /B 1\r\n+  )\r\n+)\r\n+\r\n+REM validate the options\r\n+IF NOT [%URL%] == [] (\r\n+  IF NOT [%HOSTARG%] == [] (\r\n+    ECHO Error: you cannot supply both a URL and the -h host option\r\n+    EXIT /B 1\r\n+  ) ELSE IF NOT [%PORTARG%] == [] (\r\n+    ECHO Error: you cannot supply both a URL and the -p port option\r\n+    EXIT /B 1\r\n+  ) ELSE IF NOT [%USERARG%] == [] (\r\n+    ECHO Error: you cannot supply both a URL and the -u user option\r\n+    EXIT /B 1\r\n+  ) ELSE IF NOT [%PASSARG%] == [] (\r\n+    ECHO Error: you cannot supply both a URL and the -s password option\r\n+    EXIT /B 1\r\n+  ) ELSE IF %SECURE% neq 0 (\r\n+    ECHO Error: you cannot supply both a URL and the -S ssl flag\r\n+    EXIT /B 1\r\n+  ) ELSE IF NOT [%PRINCIPAL%] == [] (\r\n+    ECHO Error: you cannot supply both a URL and the -k principal option\r\n+    EXIT /B 1\r\n+  ) ELSE IF NOT [%KEYTAB%] == [] (\r\n+    ECHO Error: you cannot supply both a URL and the -K keytab option\r\n+    EXIT /B 1\r\n+  )\r\n+)\r\n+\r\n+REM TODO: check password and passarg and prompt\r\n+\r\n+REM check for jdk1.8 and exit if not found\r\n+SET JAVA_EXEC=java\r\n+java -version 1>nul 2>nul || (\r\n+   IF NOT DEFINED JAVA_HOME (\r\n+     ECHO no java found. %SCRIPT_NAME% requires java.\r\n+     REM error, print help and exit\r\n+     CALL :help\r\n+     EXIT /B 1\r\n+   ) ELSE (\r\n+     SET JAVA_EXEC=\"%JAVA_HOME%\\bin\\java\"\r\n+   )\r\n+)\r\n+FOR /f tokens^=2-5^ delims^=.-_^\" %%j IN ('java -fullversion 2^>^&1') DO @set \"JVER=%%j%%k\"\r\n+IF %JVER% LSS 18 (\r\n+   ECHO Error: java is older than 1.8. %SCRIPT_NAME% requires java 1.8\r\n+   REM error, print help and exit\r\n+   CALL :help\r\n+   EXIT /B 1\r\n+)\r\n+\r\n+REM set splice lib dir, for Windows we assume it is always local\r\n+\r\n+set SCRIPT_DIR=%SCRIPT_DIR:\"=%\r\n+SET SPLICE_LIB_DIR=%SCRIPT_DIR%lib\r\n+echo SPLICE_LIB_DIR=%SPLICE_LIB_DIR%\r", "originalCommit": "df6dfdd0b9bbb7328787046cebe110eede9d1325", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjYzNjAyMA==", "url": "https://github.com/splicemachine/spliceengine/pull/3654#discussion_r436636020", "bodyText": "First two lines are needed, last echo can be removed. I removed it.", "author": "hatyo", "createdAt": "2020-06-08T11:47:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIwNDEzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIwNDMwNw==", "url": "https://github.com/splicemachine/spliceengine/pull/3654#discussion_r436204307", "bodyText": "this is returning and then printing ECHO %* again, resulting e.g. in\nsplice> exit;\n-h srv131 -u bla -s password\n\nat the end.", "author": "martinrupp", "createdAt": "2020-06-05T23:22:42Z", "path": "assembly/common/src/main/resources/bin/winsqlshell.cmd", "diffHunk": "@@ -0,0 +1,280 @@\n+@ECHO OFF\r\n+\r\n+SETLOCAL\r\n+\r\n+REM defaults\r\n+SET \"URL=\"\r\n+SET HOST=\"localhost\"\r\n+SET PORT=\"1527\"\r\n+SET USER=\"splice\"\r\n+SET QUOTE=0\r\n+SET PASS=\"admin\"\r\n+SET SECURE=0\r\n+SET \"PRINCIPAL=\"\r\n+SET \"KEYTAB=\"\r\n+SET PROMPT=0\r\n+SET WIDTH=128\r\n+SET \"SCRIPT=\"\r\n+SET \"OUTPUT=\"\r\n+SET QUIET=0\r\n+SET \"HOSTARG=\"\r\n+SET \"PORTARG=\"\r\n+SET \"USERARG=\"\r\n+SET \"PASSARG=\"\r\n+SET SCRIPT_DIR=\"%~dp0\"\r\n+SET SCRIPT_NAME=%~n0%~x0\r\n+\r\n+REM read user arguments\r\n+:loop\r\n+IF NOT [%1] == [] (\r\n+  IF \"%1\" == \"-U\" (\r\n+    SET URL=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-h\" (\r\n+    SET HOSTARG=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-p\" (\r\n+    SET PORTARG=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-u\" (\r\n+    SET USERARG=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-Q\" (\r\n+    SET QUOTE=1\r\n+    SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-s\" (\r\n+    SET PASSARG=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-P\" (\r\n+    SET PROMPT=1\r\n+    SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-S\" (\r\n+    SET SECURE=1\r\n+    SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-k\" (\r\n+    SET PRINCIPAL=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-K\" (\r\n+    SET KEYTAB=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-w\" (\r\n+    SET WIDTH=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-f\" (\r\n+    SET SCRIPT=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-o\" (\r\n+    SET OUTPUT=%2\r\n+    SHIFT & SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE IF \"%1\" == \"-q\" (\r\n+    SET QUIET=1\r\n+    SHIFT\r\n+    GOTO :loop\r\n+  ) ELSE (\r\n+    REM error, print help and exit\r\n+    CALL :help\r\n+    EXIT /B 1\r\n+  )\r\n+)\r\n+\r\n+REM validate the options\r\n+IF NOT [%URL%] == [] (\r\n+  IF NOT [%HOSTARG%] == [] (\r\n+    ECHO Error: you cannot supply both a URL and the -h host option\r\n+    EXIT /B 1\r\n+  ) ELSE IF NOT [%PORTARG%] == [] (\r\n+    ECHO Error: you cannot supply both a URL and the -p port option\r\n+    EXIT /B 1\r\n+  ) ELSE IF NOT [%USERARG%] == [] (\r\n+    ECHO Error: you cannot supply both a URL and the -u user option\r\n+    EXIT /B 1\r\n+  ) ELSE IF NOT [%PASSARG%] == [] (\r\n+    ECHO Error: you cannot supply both a URL and the -s password option\r\n+    EXIT /B 1\r\n+  ) ELSE IF %SECURE% neq 0 (\r\n+    ECHO Error: you cannot supply both a URL and the -S ssl flag\r\n+    EXIT /B 1\r\n+  ) ELSE IF NOT [%PRINCIPAL%] == [] (\r\n+    ECHO Error: you cannot supply both a URL and the -k principal option\r\n+    EXIT /B 1\r\n+  ) ELSE IF NOT [%KEYTAB%] == [] (\r\n+    ECHO Error: you cannot supply both a URL and the -K keytab option\r\n+    EXIT /B 1\r\n+  )\r\n+)\r\n+\r\n+REM TODO: check password and passarg and prompt\r\n+\r\n+REM check for jdk1.8 and exit if not found\r\n+SET JAVA_EXEC=java\r\n+java -version 1>nul 2>nul || (\r\n+   IF NOT DEFINED JAVA_HOME (\r\n+     ECHO no java found. %SCRIPT_NAME% requires java.\r\n+     REM error, print help and exit\r\n+     CALL :help\r\n+     EXIT /B 1\r\n+   ) ELSE (\r\n+     SET JAVA_EXEC=\"%JAVA_HOME%\\bin\\java\"\r\n+   )\r\n+)\r\n+FOR /f tokens^=2-5^ delims^=.-_^\" %%j IN ('java -fullversion 2^>^&1') DO @set \"JVER=%%j%%k\"\r\n+IF %JVER% LSS 18 (\r\n+   ECHO Error: java is older than 1.8. %SCRIPT_NAME% requires java 1.8\r\n+   REM error, print help and exit\r\n+   CALL :help\r\n+   EXIT /B 1\r\n+)\r\n+\r\n+REM set splice lib dir, for Windows we assume it is always local\r\n+\r\n+set SCRIPT_DIR=%SCRIPT_DIR:\"=%\r\n+SET SPLICE_LIB_DIR=%SCRIPT_DIR%lib\r\n+echo SPLICE_LIB_DIR=%SPLICE_LIB_DIR%\r\n+\r\n+REM check if all the tools needed to connect are found\r\n+IF NOT EXIST \"%SPLICE_LIB_DIR%\" (\r\n+    ECHO Error: the dependency directory at %SPLICE_LIB_DIR% cannot be found or created.\r\n+    REM error, print help and exit\r\n+    CALL :help\r\n+    EXIT /B 1\r\n+)\r\n+\r\n+IF NOT EXIST \"%SPLICE_LIB_DIR%\\db-client*.jar\" (\r\n+    ECHO Error: the db-client tool required to connect cannot be found or created.\r\n+    REM error, print help and exit\r\n+    CALL :help\r\n+    EXIT /B 1\r\n+)\r\n+IF NOT EXIST \"%SPLICE_LIB_DIR%\\db-tools*.jar\" (\r\n+    ECHO Error: the db-tools required to connect cannot be found or created.\r\n+    REM error, print help and exit\r\n+    CALL :help\r\n+    EXIT /B 1\r\n+)\r\n+\r\n+SET CLASSPATH=\"%SPLICE_LIB_DIR%/*;\";\r\n+\r\n+IF NOT [%HOSTARG%] == [] (\r\n+   SET HOST=%HOSTARG%\r\n+)\r\n+IF NOT [%PORTARG%] == [] (\r\n+   SET PORT=%PORTARG%\r\n+)\r\n+IF NOT [%USERARG%] == [] (\r\n+   SET USER=%USERARG%\r\n+)\r\n+\r\n+REM prompt securely for user password\r\n+IF %PROMPT% EQU 1 (\r\n+    REM use PowerShell to read password securely.\r\n+    REM source: https://stackoverflow.com/a/20343074/337194\r\n+    powershell -Command \"$pword = read-host 'Enter password ' -AsSecureString ; $BSTR=[System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($pword) ; [System.Runtime.InteropServices.Marshal]::PtrToStringAuto($BSTR)\" > .tmp.txt\r\n+    SET /p PASS=<.tmp.txt & del .tmp.txt\r\n+) ELSE IF NOT [%PASSARG%] == [] (\r\n+   SET PASS=\"%PASSARG%\"\r\n+)\r\n+\r\n+REM Setup IJ_SYS_ARGS based on input options\r\n+SET GEN_SYS_ARGS=-Djava.awt.headless^=true\r\n+SET IJ_SYS_ARGS=-Djdbc.drivers^=com.splicemachine.db.jdbc.ClientDriver\r\n+\r\n+REM add width via ij.maximumDisplayWidth\r\n+IF %WIDTH% NEQ 128 (\r\n+   SET IJ_SYS_ARGS=%IJ_SYS_ARGS% -Dij.maximumDisplayWidth=%WIDTH%\r\n+)\r\n+\r\n+IF NOT [%OUTPUT%] == [] (\r\n+   REM figure out if OUTPUT directory exists\r\n+   CALL :dir_from_path OUTPATH !OUTPUT!\r\n+   IF NOT EXIST \"%OUTPATH%\" (\r\n+     ECHO Error: you specified a non-existant directory for output %OUTPUT%\r\n+     EXIT /B 1\r\n+   )\r\n+   SET IJ_SYS_ARGS=%IJ_SYS_ARGS% -Dij.outfile^=%OUTPUT%\r\n+)\r\n+\r\n+IF NOT [%URL%] == [] (\r\n+    SET IJ_SYS_ARGS=%IJ_SYS_ARGS% -Dij.connection.splice^=%URL%\r\n+) ELSE (\r\n+    REM Add optional URL parameters\r\n+    SET SSL=\"\"\r\n+    SET KERBEROS=\"\"\r\n+    IF %SECURE% EQU 1 (\r\n+        SET SSL=\";ssl=basic\"\r\n+    )\r\n+    IF NOT [%PRINCIPAL%] == [] (\r\n+        SET KERBEROS=;principal^=%PRINCIPAL%\r\n+        IF NOT [%KEYTAB%] == [] (\r\n+            SET KERBEROS=%KERBEROS%;keytab^=%KEYTAB%\r\n+        )\r\n+    )\r\n+    SET IJ_SYS_ARGS=%IJ_SYS_ARGS% -Dij.connection.splice^=jdbc:splice://%HOST%:%PORT%/splicedb%SSL%%KERBEROS%\r\n+\r\n+    SET JAVA_TOOL_OPTIONS=-Dij.user^=%USER% -Dij.password^=%PASS%\r\n+    IF %QUOTE% EQU 1 (\r\n+        SET JAVA_TOOL_OPTIONS=-Dij.user^='\"%USER%\"' -Dij.password^=%PASS%\r\n+    )\r\n+)\r\n+\r\n+IF NOT [%CLIENT_SSL_KEYSTORE%] == [] (\r\n+    SET SSL_ARGS=-Djavax.net.ssl.keyStore^=%CLIENT_SSL_KEYSTORE% ^\r\n+    -Djavax.net.ssl.keyStorePassword^=%CLIENT_SSL_KEYSTOREPASSWD% ^\r\n+    -Djavax.net.ssl.trustStore^=%CLIENT_SSL_TRUSTSTORE% ^\r\n+    -Djavax.net.ssl.trustStore.ssl.trustStorePassword^=%CLIENT_SSL_TRUSTSTOREPASSWD%\r\n+)\r\n+\r\n+call :message Running Splice Machine SQL shell\r\n+call :message For help%: \"splice> help;\"\r\n+REM todo: catch stderr messages and filter out Picked up JAVA_TOOL_OPTIONS   2>nul\r\n+java -classpath %CLASSPATH% %GEN_SYS_ARGS% %SSL_ARGS% %IJ_SYS_ARGS% com.splicemachine.db.tools.ij %SCRIPT% 2>nul\r\n+\r\n+CALL :eof\r\n+\r", "originalCommit": "df6dfdd0b9bbb7328787046cebe110eede9d1325", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjYzNjEzMA==", "url": "https://github.com/splicemachine/spliceengine/pull/3654#discussion_r436636130", "bodyText": "Right, thanks, fixed it.", "author": "hatyo", "createdAt": "2020-06-08T11:48:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIwNDMwNw=="}], "type": "inlineReview"}, {"oid": "3b618c280e1368bd87f9cbdfe97de762b6783edb", "url": "https://github.com/splicemachine/spliceengine/commit/3b618c280e1368bd87f9cbdfe97de762b6783edb", "message": "Addressed further comments.", "committedDate": "2020-06-08T11:53:42Z", "type": "commit"}]}