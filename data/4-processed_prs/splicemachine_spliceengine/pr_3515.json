{"pr_number": 3515, "pr_title": "DB-8846 changes in CDH-installation.md: Java Configuration Options for HBase Master", "pr_createdAt": "2020-05-04T15:58:22Z", "pr_url": "https://github.com/splicemachine/spliceengine/pull/3515", "timeline": [{"oid": "6a708b85f1394ac9599afc6120e349f6a65b79bf", "url": "https://github.com/splicemachine/spliceengine/commit/6a708b85f1394ac9599afc6120e349f6a65b79bf", "message": "DB-8846 classpath has to be added both for olapServer AND spark.executor.extraClassPath\n\nalso changed\n\n/opt/cloudera/parcels/SPARK2/lib/spark2/jars/\n->\n/opt/cloudera/parcels/CDH/lib/spark/jars/", "committedDate": "2020-05-08T07:54:20Z", "type": "forcePushed"}, {"oid": "0872ac272ccd070698eb7f4147e8da1e84fd9e80", "url": "https://github.com/splicemachine/spliceengine/commit/0872ac272ccd070698eb7f4147e8da1e84fd9e80", "message": "DB-8846 classpath has to be added both for olapServer AND spark.executor.extraClassPath\n\nalso changed\n\n/opt/cloudera/parcels/SPARK2/lib/spark2/jars/\n->\n/opt/cloudera/parcels/CDH/lib/spark/jars/", "committedDate": "2020-05-11T13:42:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI0MjgwMQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3515#discussion_r424242801", "bodyText": "-Dsplice.spark.master=yarn\n\nThis looks good but it's missing the deploy-mode, I would explicitly list it even though the default is client: -Dsplice.spark.submit.deployMode=client", "author": "dgomezferro", "createdAt": "2020-05-13T07:55:04Z", "path": "platforms/cdh6.3.0/docs/CDH-installation.md", "diffHunk": "@@ -550,13 +550,13 @@ com.splicemachine.hbase.BackupEndpointObserver</code>\n 4. Set the value of Java Configuration Options for HBase Master\n \n    ```\n-    -XX:MaxPermSize=512M -XX:+HeapDumpOnOutOfMemoryError -XX:MaxDirectMemorySize=2g -XX:+AlwaysPreTouch -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=70 -XX:+CMSParallelRemarkEnabled -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.port=10101 -Dsplice.spark.enabled=true -Dsplice.spark.app.name=SpliceMachine -Dsplice.spark.master=yarn-client -Dsplice.spark.logConf=true -Dsplice.spark.yarn.maxAppAttempts=1 -Dsplice.spark.driver.maxResultSize=2g -Dsplice.spark.driver.cores=2 -Dsplice.spark.yarn.am.memory=1g -Dsplice.spark.dynamicAllocation.enabled=true -Dsplice.spark.dynamicAllocation.executorIdleTimeout=120 -Dsplice.spark.dynamicAllocation.cachedExecutorIdleTimeout=120 -Dsplice.spark.dynamicAllocation.minExecutors=4 -Dsplice.spark.dynamicAllocation.maxExecutors=12 -Dsplice.spark.io.compression.lz4.blockSize=32k -Dsplice.spark.kryo.referenceTracking=false -Dsplice.spark.kryo.registrator=com.splicemachine.derby.impl.SpliceSparkKryoRegistrator -Dsplice.spark.kryoserializer.buffer.max=512m -Dsplice.spark.kryoserializer.buffer=4m -Dsplice.spark.locality.wait=0 -Dsplice.spark.memory.fraction=0.5 -Dsplice.spark.scheduler.mode=FAIR -Dsplice.spark.serializer=org.apache.spark.serializer.KryoSerializer -Dsplice.spark.shuffle.compress=false -Dsplice.spark.shuffle.file.buffer=128k -Dsplice.spark.shuffle.service.enabled=true  -Dsplice.spark.yarn.am.extraLibraryPath=/opt/cloudera/parcels/CDH/lib/hadoop/lib/native -Dsplice.spark.yarn.am.waitTime=10s -Dsplice.spark.yarn.executor.memoryOverhead=8192 -Dsplice.spark.driver.extraJavaOptions=-Dlog4j.configuration=file:/etc/spark/conf/log4j.properties -Dsplice.spark.driver.extraLibraryPath=/opt/cloudera/parcels/CDH/lib/hadoop/lib/native -Dsplice.spark.driver.extraClassPath=/opt/cloudera/parcels/CDH/lib/hbase/conf:/opt/cloudera/parcels/CDH/jars/htrace-core-3.1.0-incubating.jar -Dsplice.spark.executor.extraLibraryPath=/opt/cloudera/parcels/CDH/lib/hbase/conf:/opt/cloudera/parcels/CDH/lib/hadoop/lib/native -Dsplice.olapServer.classpath=/opt/cloudera/parcels/CDH/lib/hive/lib/* -Dsplice.spark.executor.extraClassPath=/opt/cloudera/parcels/CDH/lib/hbase/conf:/opt/cloudera/parcels/SPLICEMACHINE/lib/*:/opt/cloudera/parcels/SPARK2/lib/spark2/jars/*:/opt/cloudera/parcels/CDH/lib/hbase/lib/* -Dsplice.spark.executor.extraLibraryPath=/opt/cloudera/parcels/CDH/lib/hadoop/lib/native -Dsplice.spark.ui.retainedJobs=100 -Dsplice.spark.ui.retainedStages=100 -Dsplice.spark.worker.ui.retainedExecutors=100 -Dsplice.spark.worker.ui.retainedDrivers=100 -Dsplice.spark.streaming.ui.retainedBatches=100 -Dsplice.spark.executor.cores=10 -Dsplice.spark.executor.memory=24g -Dspark.compaction.reserved.slots=4  -Dsplice.spark.local.dir=/tmp -Dsplice.spark.yarn.jars=/opt/cloudera/parcels/SPARK2/lib/spark2/jars/* -Dsplice.spark.sql.shuffle.partitions=900 -Dsplice.spark.reducer.maxSizeInFlight=512m -Dsplice.spark.maxRemoteBlockSizeFetchToMem=105000000\n+   -XX:+HeapDumpOnOutOfMemoryError -XX:MaxDirectMemorySize=2g -XX:+AlwaysPreTouch -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=70 -XX:+CMSParallelRemarkEnabled -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.port=10101 -Dsplice.spark.enabled=true -Dsplice.spark.app.name=SpliceMachine -Dsplice.spark.master=yarn -Dsplice.spark.logConf=true -Dsplice.spark.yarn.maxAppAttempts=1 -Dsplice.spark.driver.maxResultSize=2g -Dsplice.spark.driver.cores=2 -Dsplice.spark.yarn.am.memory=1g -Dsplice.spark.dynamicAllocation.enabled=true -Dsplice.spark.dynamicAllocation.executorIdleTimeout=120 -Dsplice.spark.dynamicAllocation.cachedExecutorIdleTimeout=120 -Dsplice.spark.dynamicAllocation.minExecutors=4 -Dsplice.spark.dynamicAllocation.maxExecutors=12 -Dsplice.spark.io.compression.lz4.blockSize=32k -Dsplice.spark.kryo.referenceTracking=false -Dsplice.spark.kryo.registrator=com.splicemachine.derby.impl.SpliceSparkKryoRegistrator -Dsplice.spark.kryoserializer.buffer.max=512m -Dsplice.spark.kryoserializer.buffer=4m -Dsplice.spark.locality.wait=0 -Dsplice.spark.memory.fraction=0.5 -Dsplice.spark.scheduler.mode=FAIR -Dsplice.spark.serializer=org.apache.spark.serializer.KryoSerializer -Dsplice.spark.shuffle.compress=false -Dsplice.spark.shuffle.file.buffer=128k -Dsplice.spark.shuffle.service.enabled=true  -Dsplice.spark.yarn.am.extraLibraryPath=/opt/cloudera/parcels/CDH/lib/hadoop/lib/native -Dsplice.spark.yarn.am.waitTime=10s -Dsplice.spark.yarn.executor.memoryOverhead=8192 -Dsplice.spark.driver.extraJavaOptions=-Dlog4j.configuration=file:/etc/spark/conf/log4j.properties -Dsplice.spark.driver.extraLibraryPath=/opt/cloudera/parcels/CDH/lib/hadoop/lib/native -Dsplice.spark.driver.extraClassPath=/opt/cloudera/parcels/CDH/lib/hbase/conf:/opt/cloudera/parcels/CDH/jars/htrace-core-3.1.0-incubating.jar -Dsplice.spark.executor.extraLibraryPath=/opt/cloudera/parcels/CDH/lib/hbase/conf:/opt/cloudera/parcels/CDH/lib/hadoop/lib/native -Dsplice.olapServer.classpath=/opt/cloudera/parcels/CDH/lib/hive/lib/* -Dsplice.spark.executor.extraClassPath=/opt/cloudera/parcels/CDH/lib/hbase/conf:/opt/cloudera/parcels/SPLICEMACHINE/lib/*:/opt/cloudera/parcels/CDH/lib/spark/jars/*:/opt/cloudera/parcels/CDH/lib/hbase/lib/*:/opt/cloudera/parcels/CDH/lib/hive/lib/* -Dsplice.spark.executor.extraLibraryPath=/opt/cloudera/parcels/CDH/lib/hadoop/lib/native -Dsplice.spark.ui.retainedJobs=100 -Dsplice.spark.ui.retainedStages=100 -Dsplice.spark.worker.ui.retainedExecutors=100 -Dsplice.spark.worker.ui.retainedDrivers=100 -Dsplice.spark.streaming.ui.retainedBatches=100 -Dsplice.spark.executor.cores=10 -Dsplice.spark.executor.memory=24g -Dspark.compaction.reserved.slots=4  -Dsplice.spark.local.dir=/tmp -Dsplice.spark.yarn.jars=/opt/cloudera/parcels/CDH/lib/spark/jars/* -Dsplice.spark.sql.shuffle.partitions=900 -Dsplice.spark.reducer.maxSizeInFlight=512m -Dsplice.spark.maxRemoteBlockSizeFetchToMem=105000000", "originalCommit": "0872ac272ccd070698eb7f4147e8da1e84fd9e80", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc3NzQ4OA==", "url": "https://github.com/splicemachine/spliceengine/pull/3515#discussion_r424777488", "bodyText": "Please remove -Dsplice.spark.shuffle.compress=false", "author": "jyuanca", "createdAt": "2020-05-13T22:57:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI0MjgwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc3OTAxOA==", "url": "https://github.com/splicemachine/spliceengine/pull/3515#discussion_r424779018", "bodyText": "Why -Dsplice.olapServer.classpath=/opt/cloudera/parcels/CDH/lib/hive/lib/*?", "author": "jyuanca", "createdAt": "2020-05-13T23:01:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI0MjgwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU4NDIxOQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3515#discussion_r426584219", "bodyText": "-Dsplice.spark.master=yarn\n\nThis looks good but it's missing the deploy-mode, I would explicitly list it even though the default is client: -Dsplice.spark.submit.deployMode=client\n\ndone\n\nPlease remove -Dsplice.spark.shuffle.compress=false\n\ndone\n\nWhy -Dsplice.olapServer.classpath=/opt/cloudera/parcels/CDH/lib/hive/lib/*\n\ni don't know about this one, this was already done like that before, and is also used e.g. on srv131", "author": "martinrupp", "createdAt": "2020-05-18T12:21:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI0MjgwMQ=="}], "type": "inlineReview"}, {"oid": "51deb35a0bdd78d60b37453a00cd5f4421053b7e", "url": "https://github.com/splicemachine/spliceengine/commit/51deb35a0bdd78d60b37453a00cd5f4421053b7e", "message": "DB-8846 changes in CDH-installation.md: Java Configuration Options for HBase Master\n\n- classpath has to be added both for olapServer AND spark.executor.extraClassPath\n- added -Dsplice.spark.submit.deployMode=client\n- removed -Dsplice.spark.shuffle.compress=false\n- -Dsplice.spark.master=yarn-client -> -Dsplice.spark.master=yarn\n- changed\n\n/opt/cloudera/parcels/SPARK2/lib/spark2/jars/\n->\n/opt/cloudera/parcels/CDH/lib/spark/jars/", "committedDate": "2020-05-18T10:26:01Z", "type": "forcePushed"}, {"oid": "8ec70a4cc278a9d5bdbcf7ce65762d465de55292", "url": "https://github.com/splicemachine/spliceengine/commit/8ec70a4cc278a9d5bdbcf7ce65762d465de55292", "message": "DB-8846 changes in CDH-installation.md: Java Configuration Options for HBase Master\n\n- classpath has to be added both for olapServer AND spark.executor.extraClassPath\n- added -Dsplice.spark.submit.deployMode=client\n- removed -Dsplice.spark.shuffle.compress=false\n- -Dsplice.spark.master=yarn-client -> -Dsplice.spark.master=yarn\n- changed\n\n/opt/cloudera/parcels/SPARK2/lib/spark2/jars/\n->\n/opt/cloudera/parcels/CDH/lib/spark/jars/", "committedDate": "2020-06-15T15:22:32Z", "type": "forcePushed"}, {"oid": "a07045e6067b07ad024621aca1b3b91a3be2fef3", "url": "https://github.com/splicemachine/spliceengine/commit/a07045e6067b07ad024621aca1b3b91a3be2fef3", "message": "DB-8846 changes in CDH-installation.md: Java Configuration Options for HBase Master\n\n- classpath has to be added both for olapServer AND spark.executor.extraClassPath\n- added -Dsplice.spark.submit.deployMode=client\n- removed -Dsplice.spark.shuffle.compress=false\n- -Dsplice.spark.master=yarn-client -> -Dsplice.spark.master=yarn\n- changed\n\n/opt/cloudera/parcels/SPARK2/lib/spark2/jars/\n->\n/opt/cloudera/parcels/CDH/lib/spark/jars/", "committedDate": "2020-06-15T15:22:49Z", "type": "forcePushed"}, {"oid": "a6fafaa45e30ea472104c57ecdd02e7365980edd", "url": "https://github.com/splicemachine/spliceengine/commit/a6fafaa45e30ea472104c57ecdd02e7365980edd", "message": "DB-8846 changes in CDH-installation.md: Java Configuration Options for HBase Master\n\n- classpath has to be added both for olapServer AND spark.executor.extraClassPath\n- added -Dsplice.spark.submit.deployMode=client\n- removed -Dsplice.spark.shuffle.compress=false\n- -Dsplice.spark.master=yarn-client -> -Dsplice.spark.master=yarn\n- changed\n\n/opt/cloudera/parcels/SPARK2/lib/spark2/jars/\n->\n/opt/cloudera/parcels/CDH/lib/spark/jars/", "committedDate": "2020-06-29T15:11:21Z", "type": "commit"}, {"oid": "a6fafaa45e30ea472104c57ecdd02e7365980edd", "url": "https://github.com/splicemachine/spliceengine/commit/a6fafaa45e30ea472104c57ecdd02e7365980edd", "message": "DB-8846 changes in CDH-installation.md: Java Configuration Options for HBase Master\n\n- classpath has to be added both for olapServer AND spark.executor.extraClassPath\n- added -Dsplice.spark.submit.deployMode=client\n- removed -Dsplice.spark.shuffle.compress=false\n- -Dsplice.spark.master=yarn-client -> -Dsplice.spark.master=yarn\n- changed\n\n/opt/cloudera/parcels/SPARK2/lib/spark2/jars/\n->\n/opt/cloudera/parcels/CDH/lib/spark/jars/", "committedDate": "2020-06-29T15:11:21Z", "type": "forcePushed"}]}