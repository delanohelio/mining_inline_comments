{"pr_number": 4123, "pr_title": "DB-10139 Migrate Jenkins Env", "pr_createdAt": "2020-09-15T09:06:43Z", "pr_url": "https://github.com/splicemachine/spliceengine/pull/4123", "timeline": [{"oid": "a0cae91af43e6a647245d23fd4a8d373dd68c865", "url": "https://github.com/splicemachine/spliceengine/commit/a0cae91af43e6a647245d23fd4a8d373dd68c865", "message": "DB-10218 Migrate standalone jenkinsfile", "committedDate": "2020-09-15T08:50:39Z", "type": "commit"}, {"oid": "8f731132dca6bf4c3032a00ab4ea103ed9fc93f2", "url": "https://github.com/splicemachine/spliceengine/commit/8f731132dca6bf4c3032a00ab4ea103ed9fc93f2", "message": "DB-10141 Migrate spliceengine-core jobs", "committedDate": "2020-09-15T08:55:43Z", "type": "commit"}, {"oid": "90ca40b1f3d9039633af01f32a80845232d3db8b", "url": "https://github.com/splicemachine/spliceengine/commit/90ca40b1f3d9039633af01f32a80845232d3db8b", "message": "DB-10219 Migrate spliceengine-branch job", "committedDate": "2020-09-15T09:05:08Z", "type": "commit"}, {"oid": "f58acad1104067c3e141a9209868b3bcf630390d", "url": "https://github.com/splicemachine/spliceengine/commit/f58acad1104067c3e141a9209868b3bcf630390d", "message": "DB-10217 Migrate spliceengine-PR", "committedDate": "2020-09-15T09:22:15Z", "type": "commit"}, {"oid": "3b1981fbfe6c65ac4f314664833e5dedc6704e62", "url": "https://github.com/splicemachine/spliceengine/commit/3b1981fbfe6c65ac4f314664833e5dedc6704e62", "message": "Update PR Jenkinsfile", "committedDate": "2020-09-16T10:39:46Z", "type": "commit"}, {"oid": "86025d569d7f14c7be40fe3958a33d2be2da1432", "url": "https://github.com/splicemachine/spliceengine/commit/86025d569d7f14c7be40fe3958a33d2be2da1432", "message": "Update parsing method", "committedDate": "2020-09-22T08:36:27Z", "type": "commit"}, {"oid": "780cfb2725326a790296191777c0e5e9777b4aa7", "url": "https://github.com/splicemachine/spliceengine/commit/780cfb2725326a790296191777c0e5e9777b4aa7", "message": "Merge branch 'DB-10139' of https://github.com/splicemachine/spliceengine into DB-10139", "committedDate": "2020-09-22T08:39:05Z", "type": "commit"}, {"oid": "69fcc414f5e3165ffe10ed9d6c4269b588dae317", "url": "https://github.com/splicemachine/spliceengine/commit/69fcc414f5e3165ffe10ed9d6c4269b588dae317", "message": "Update Jenkinsfile", "committedDate": "2020-12-03T11:44:42Z", "type": "commit"}, {"oid": "575eef22d4fd24612a39c4d53cee9f54d6e98e6c", "url": "https://github.com/splicemachine/spliceengine/commit/575eef22d4fd24612a39c4d53cee9f54d6e98e6c", "message": "Update Jenkinsfile", "committedDate": "2020-12-03T11:47:21Z", "type": "commit"}, {"oid": "b366a3b8a0528eed688b53dcaf8399c6535b37b8", "url": "https://github.com/splicemachine/spliceengine/commit/b366a3b8a0528eed688b53dcaf8399c6535b37b8", "message": "Update Jenkinsfile", "committedDate": "2020-12-03T11:48:41Z", "type": "commit"}, {"oid": "d5098ea17444a19b93e7cf75db8cc1d16ae3aa6d", "url": "https://github.com/splicemachine/spliceengine/commit/d5098ea17444a19b93e7cf75db8cc1d16ae3aa6d", "message": "Update Jenkinsfile", "committedDate": "2020-12-03T12:10:15Z", "type": "commit"}, {"oid": "8b149e4f27f0227004214a284790ed99358e57f7", "url": "https://github.com/splicemachine/spliceengine/commit/8b149e4f27f0227004214a284790ed99358e57f7", "message": "Update Jenkinsfile", "committedDate": "2020-12-03T12:12:16Z", "type": "commit"}, {"oid": "c300e2e7d65296407c741ef6b492c2d3ebda6292", "url": "https://github.com/splicemachine/spliceengine/commit/c300e2e7d65296407c741ef6b492c2d3ebda6292", "message": "Update pipelines", "committedDate": "2020-12-04T09:52:22Z", "type": "commit"}, {"oid": "fad5643e1324904ff8316414b3b3f48b248062a7", "url": "https://github.com/splicemachine/spliceengine/commit/fad5643e1324904ff8316414b3b3f48b248062a7", "message": "Update pipelines", "committedDate": "2020-12-04T09:52:44Z", "type": "commit"}, {"oid": "5df7204c3b1eeaf1e0660d6a54edf907ad368919", "url": "https://github.com/splicemachine/spliceengine/commit/5df7204c3b1eeaf1e0660d6a54edf907ad368919", "message": "Add slack integration", "committedDate": "2020-12-04T11:51:16Z", "type": "commit"}, {"oid": "575689dd7b796790acccb718351b8cd1b9f8e467", "url": "https://github.com/splicemachine/spliceengine/commit/575689dd7b796790acccb718351b8cd1b9f8e467", "message": "Update pipelines", "committedDate": "2020-12-04T11:55:22Z", "type": "commit"}, {"oid": "8836ae7fc48c2a873208b7ab7a8c0c1aec0f1b0e", "url": "https://github.com/splicemachine/spliceengine/commit/8836ae7fc48c2a873208b7ab7a8c0c1aec0f1b0e", "message": "Update pipelines", "committedDate": "2020-12-04T11:58:33Z", "type": "commit"}, {"oid": "4a4a2f0eaaa473496946b253f042a368dc720f78", "url": "https://github.com/splicemachine/spliceengine/commit/4a4a2f0eaaa473496946b253f042a368dc720f78", "message": "Update pipelines", "committedDate": "2020-12-04T12:00:34Z", "type": "commit"}, {"oid": "995cd8dea903d94079be2da4d205cba87abbae96", "url": "https://github.com/splicemachine/spliceengine/commit/995cd8dea903d94079be2da4d205cba87abbae96", "message": "Update pipelines", "committedDate": "2020-12-04T12:06:37Z", "type": "commit"}, {"oid": "53a7eee6578f9adecb015bfa630369ac7ebc5e40", "url": "https://github.com/splicemachine/spliceengine/commit/53a7eee6578f9adecb015bfa630369ac7ebc5e40", "message": "Fix quoting", "committedDate": "2020-12-04T19:12:39Z", "type": "commit"}, {"oid": "d7275cbc7afacbbbf1f27d2978bca793a6a6d949", "url": "https://github.com/splicemachine/spliceengine/commit/d7275cbc7afacbbbf1f27d2978bca793a6a6d949", "message": "Update pipelines", "committedDate": "2020-12-04T19:21:37Z", "type": "commit"}, {"oid": "686e440cfc3e9870ed0beac228c385d2bdc6cbde", "url": "https://github.com/splicemachine/spliceengine/commit/686e440cfc3e9870ed0beac228c385d2bdc6cbde", "message": "Update pipelines", "committedDate": "2020-12-04T19:24:50Z", "type": "commit"}, {"oid": "34fdea730bdfe25f2f5d6e0c76a701a1c23d1002", "url": "https://github.com/splicemachine/spliceengine/commit/34fdea730bdfe25f2f5d6e0c76a701a1c23d1002", "message": "Update Jenkinsfile", "committedDate": "2020-12-08T16:44:59Z", "type": "commit"}, {"oid": "597f5be40008ecd54b3bbd596dbc5a85880849dd", "url": "https://github.com/splicemachine/spliceengine/commit/597f5be40008ecd54b3bbd596dbc5a85880849dd", "message": "Update template", "committedDate": "2020-12-09T11:27:36Z", "type": "commit"}, {"oid": "c8b1f6fa46e5400861743da418ff891eaaf17037", "url": "https://github.com/splicemachine/spliceengine/commit/c8b1f6fa46e5400861743da418ff891eaaf17037", "message": "Merge branch 'DB-10139' of https://github.com/splicemachine/spliceengine into DB-10139", "committedDate": "2020-12-09T11:29:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIzNjExMw==", "url": "https://github.com/splicemachine/spliceengine/pull/4123#discussion_r543236113", "bodyText": "duplicated?", "author": "dgomezferro", "createdAt": "2020-12-15T10:44:33Z", "path": "pipelines/spliceengine-PR/Jenkinsfile", "diffHunk": "@@ -0,0 +1,118 @@\n+@Library('jenkins-shared-library')_\n+\n+properties([\n+    parameters([\n+        stringParam(\n+         defaultValue: \"${ghprbPullId}\",\n+         description: 'Pull ID',\n+         name: 'pr_id'\n+       )\n+    ]),\n+])\n+\n+node('spliceengine'){\n+    def artifact_values  = [\n+        [$class: 'VaultSecret', path: \"secret/aws/jenkins/colo_jenkins\", secretValues: [\n+            [$class: 'VaultSecretValue', envVar: 'ARTIFACT_USER', vaultKey: 'user'],\n+            [$class: 'VaultSecretValue', envVar: 'ARTIFACT_PASSWORD', vaultKey: 'pass']]]\n+    ]\n+    try{\n+        stage('Prep Node') {\n+                sh \"\"\"\n+                wget http://download.oracle.com/otn-pub/java/jdk/8u121-b13/e9e7ea248e2c4826b92b3f075a80e441/jdk-8u121-linux-x64.rpm; sudo yum localinstall jdk-8u121-linux-x64.rpm\n+                sudo yum install curl epel-release git wget nmap rlwrap patch openssh-server openssh-clients openssh ntp nscd nc ftp -y\n+                sudo sed -i '/requiretty/ s/^/#/' /etc/sudoers\n+                sudo service nscd start  && sudo service ntpd start  && sudo service sshd start\n+                wget https://downloads.apache.org/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gz -P /tmp \n+                sudo tar xf /tmp/apache-maven-3.6.3-bin.tar.gz -C /opt\n+                sudo ln -sfn /opt/apache-maven-3.6.3 /opt/maven\n+                wget https://archive.apache.org/dist/ant/binaries/apache-ant-1.9.9-bin.tar.gz -P /tmp\n+                sudo tar xf /tmp/apache-ant-1.9.9-bin.tar.gz -C /opt\n+                sudo ln -sfn /opt/apache-ant-1.9.9 /opt/ant\n+                \"\"\"\n+        } \n+        stage('Checkout') {\n+                // Get some code from a GitHub repository\n+                checkout([  \n+                    $class: 'GitSCM', \n+                    branches: [[name: \"\"\"refs/heads/${ghprbSourceBranch}\"\"\"]], \n+                    doGenerateSubmoduleConfigurations: false, \n+                    extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'spliceengine-ee']], \n+                    submoduleCfg: [], \n+                    userRemoteConfigs: [[credentialsId: '88647ede-744a-444b-8c08-8313cc137944', url: 'https://github.com/splicemachine/spliceengine-ee.git']]\n+                ])\n+                checkout([  \n+                    $class: 'GitSCM', \n+                    branches: [[name: \"\"\"refs/heads/${ghprbSourceBranch}\"\"\"]], \n+                    doGenerateSubmoduleConfigurations: false, \n+                    extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'spliceengine']], \n+                    submoduleCfg: [], \n+                    userRemoteConfigs: [[credentialsId: '88647ede-744a-444b-8c08-8313cc137944', url: 'https://github.com/splicemachine/spliceengine.git']]\n+                ])\n+        }\n+        stage(\"Build/Test\"){\n+            // Run Maven on a Unix agent.\n+            wrap([$class: 'VaultBuildWrapper', vaultSecrets: artifact_values]) {\n+                dir('spliceengine'){\n+                    sh \"\"\"\n+                    export platform=\\$(echo \"$ghprbCommentBody\" | cut -d \"@\" -f2)\n+                    export shortbranch=\"\\$(echo ${ghprbSourceBranch} | awk -F/ '{print \\$NF}')\"\n+                    echo \"Git branch ${ghprbSourceBranch} short name is \\${shortbranch}\"\n+                    export srcver=\"\\$(mvn org.apache.maven.plugins:maven-help-plugin:2.1.1:evaluate -Dexpression=project.version 2>&1 | egrep -v '(^\\\\[|Download(ed|ing):)' | grep '^[0-9]' | head -1)\"\n+                    echo \"Maven project version is \\${srcver}\"\n+                    export newsrcver=\"\\${srcver}-${BUILD_NUMBER}-\\${shortbranch}\"\n+                    echo \"New Maven version is \\${newsrcver}\"\n+                    echo \"Using Maven versions plugin and in-line sed to set version to \\${newsrcver}\" \n+                    mvn versions:set -DnewVersion=\"\\${newsrcver}\" -Pcore,\\${platform},ee -l /dev/null\n+                    mvn versions:commit\n+                    echo \"Saving branch and version info to branch.env\"\n+                    echo \"export shortbranch=\\${shortbranch}\" > branch.env\n+                    echo \"export srcver=\\${srcver}\" >> branch.env\n+                    echo \"export newsrcver=\\${newsrcver}\" >> branch.env\n+                    echo \"\\${newsrcver}\" > version.txt\n+                    mvn -B -e --fail-at-end clean -DskipTests\n+                    cp pipelines/template/settings.xml ~/.m2/settings.xml\n+                    sed  -i \"s/REPLACE_USER/$ARTIFACT_USER/\" ~/.m2/settings.xml\n+                    sed  -i \"s/REPLACE_PASS/$ARTIFACT_PASSWORD/\" ~/.m2/settings.xml\n+\n+                    if [[ \"\\$platform\" =~ ^mem ]] ; then\n+                        profiles=\"core,mem\"\n+                    elif [[ \"\\$platform\" =~ ^cdh ]] ; then\n+                        profiles=\"core,ee,parcel,\\$platform\"\n+                    elif [[ \"\\$platform\" =~ ^hdp ]] ; then\n+                        profiles=\"core,ee,hdp_service,\\$platform\"\n+                    elif [[ \"\\$platform\" =~ ^hdp ]] ; then\n+                        profiles=\"core,ee,hdp_service,\\$platform\"", "originalCommit": "c8b1f6fa46e5400861743da418ff891eaaf17037", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}