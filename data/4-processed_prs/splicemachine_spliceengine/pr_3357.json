{"pr_number": 3357, "pr_title": "DB-9272 enable testcases in SparkExplainIT", "pr_createdAt": "2020-03-27T22:13:04Z", "pr_url": "https://github.com/splicemachine/spliceengine/pull/3357", "timeline": [{"oid": "55b54d7b27fab05aa4ab76609774deb0cc6b162a", "url": "https://github.com/splicemachine/spliceengine/commit/55b54d7b27fab05aa4ab76609774deb0cc6b162a", "message": "DB-9272 enable testcases in SparkExplainIT", "committedDate": "2020-03-27T22:10:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ3Mjg3MQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3357#discussion_r400472871", "bodyText": "This category makes the IT ineligible for remote mode. Is it justified? If yes, please update remote_it/pom.xml.", "author": "OlegMazurov", "createdAt": "2020-03-30T20:27:38Z", "path": "splice_machine/src/test/java/com/splicemachine/derby/impl/sql/execute/operations/SparkExplainIT.java", "diffHunk": "@@ -34,6 +36,7 @@\n import static com.splicemachine.test_tools.Rows.row;\n import static com.splicemachine.test_tools.Rows.rows;\n \n+@Category(HBaseTest.class)", "originalCommit": "55b54d7b27fab05aa4ab76609774deb0cc6b162a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI3MzQzNg==", "url": "https://github.com/splicemachine/spliceengine/pull/3357#discussion_r401273436", "bodyText": "Thanks @OlegMazurov The reason I put this test in the HBaseTest category is to prevent it from running on the mem profile. There are two reasons: 1) sparkexplain under mem profile does not really return spark explain, it returns the control execution plan. 2) the plan from control path is a bit different from the spark plan.\nHowever, I don't intend to make the IT ineligible for remote mode. Is there a way that I can make it eligible for remote test but still not triggered for mem profile?", "author": "yxia92", "createdAt": "2020-03-31T23:30:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ3Mjg3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI5MzI5OA==", "url": "https://github.com/splicemachine/spliceengine/pull/3357#discussion_r401293298", "bodyText": "I was wrong assuming that the category brings dependencies on HBase. I don't think we should exclude the test from remote_it.", "author": "OlegMazurov", "createdAt": "2020-04-01T00:40:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ3Mjg3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI5NDQ2Ng==", "url": "https://github.com/splicemachine/spliceengine/pull/3357#discussion_r401294466", "bodyText": "ResultSet is AutoCloseable. You can use try-with-resources here.", "author": "OlegMazurov", "createdAt": "2020-04-01T00:44:36Z", "path": "splice_machine/src/test/java/com/splicemachine/derby/test/framework/SpliceUnitTest.java", "diffHunk": "@@ -290,9 +290,28 @@ protected void rowContainsQuery(int level, String query, String contains, Splice\n \n \n     protected void queryDoesNotContainString(String query, String notContains,SpliceWatcher methodWatcher) throws Exception {\n-        ResultSet resultSet = methodWatcher.executeQuery(query);\n-        while (resultSet.next())\n-            Assert.assertFalse(\"failed query: \" + query + \" -> \" + resultSet.getString(1), resultSet.getString(1).contains(notContains));\n+        queryDoesNotContainString(query,new String[] {notContains}, methodWatcher, false);\n+    }\n+\n+    protected void queryDoesNotContainString(String query, String[] notContains,SpliceWatcher methodWatcher, boolean caseInsensitive) throws Exception {\n+        ResultSet rs = null;\n+        try {\n+            rs = methodWatcher.executeQuery(query);", "originalCommit": "55b54d7b27fab05aa4ab76609774deb0cc6b162a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}