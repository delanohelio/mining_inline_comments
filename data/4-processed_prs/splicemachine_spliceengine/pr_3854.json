{"pr_number": 3854, "pr_title": "DB-9847 Spark 3.0 Configure upgraded maven dependencies", "pr_createdAt": "2020-07-17T15:17:53Z", "pr_url": "https://github.com/splicemachine/spliceengine/pull/3854", "timeline": [{"oid": "3be4d9ac7f3f6fac8f9ec1761c6e419df473f718", "url": "https://github.com/splicemachine/spliceengine/commit/3be4d9ac7f3f6fac8f9ec1761c6e419df473f718", "message": "DB-9847 Spark 3.0 Configure upgraded maven dependencies", "committedDate": "2020-07-17T09:10:55Z", "type": "commit"}, {"oid": "598cc9363dbf1da2b0149ccb763ebb3a199f9287", "url": "https://github.com/splicemachine/spliceengine/commit/598cc9363dbf1da2b0149ccb763ebb3a199f9287", "message": "DB-9847 Scala versions", "committedDate": "2020-07-17T10:04:25Z", "type": "commit"}, {"oid": "fe51eb867eb09a8e79a8f76e1f8680a2e12367bd", "url": "https://github.com/splicemachine/spliceengine/commit/fe51eb867eb09a8e79a8f76e1f8680a2e12367bd", "message": "DB-9847 spark 3.0 test profile added", "committedDate": "2020-07-17T11:17:28Z", "type": "commit"}, {"oid": "2cba42cee6018132860088d85ef28baed3a3a1cd", "url": "https://github.com/splicemachine/spliceengine/commit/2cba42cee6018132860088d85ef28baed3a3a1cd", "message": "Merge branch 'master' into DB-9847", "committedDate": "2020-07-27T09:11:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxMzI1Mw==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r461013253", "bodyText": "yarn-client is deprecated in Spark 2.0+, no need to keep it.\nspark.submit.deployMode may need to be explicitly specified.", "author": "OlegMazurov", "createdAt": "2020-07-27T16:25:17Z", "path": "platform_it/pom.xml", "diffHunk": "@@ -1002,7 +1002,7 @@\n                                 <argument>-Dsplice.spark.kryoserializer.buffer=4m</argument>\n                                 <argument>-Dsplice.spark.locality.wait=60s</argument>\n                                 <argument>-Dsplice.spark.logConf=true</argument>\n-                                <argument>-Dsplice.spark.master=yarn-client</argument>\n+                                <argument>-Dsplice.spark.master=${splice.spark.master}</argument>", "originalCommit": "2cba42cee6018132860088d85ef28baed3a3a1cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ5NzMwNw==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r461497307", "bodyText": "splice.spark.master is set to 'yarn', added splice.spark.submit.deployMode=client", "author": "ipraznik-splice", "createdAt": "2020-07-28T11:03:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxMzI1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTcxODExMg==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r461718112", "bodyText": "Do the same for the spliceFastSSL profile", "author": "OlegMazurov", "createdAt": "2020-07-28T16:35:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxMzI1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODU2MDczNQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r468560735", "bodyText": "Sorry, did not notice second occurrence, fixed.", "author": "ipraznik-splice", "createdAt": "2020-08-11T13:01:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxMzI1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxNTI0Ng==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r461015246", "bodyText": "Splice explicitly uses org.xerial.snappy (in addition to Hadoop's internal version). Why is this dependency needed?", "author": "OlegMazurov", "createdAt": "2020-07-27T16:28:21Z", "path": "hbase_sql/pom.xml", "diffHunk": "@@ -148,7 +148,12 @@\n             <artifactId>guava</artifactId>\n             <scope>provided</scope>\n         </dependency>\n-\n+        <dependency>\n+            <groupId>org.iq80.snappy</groupId>", "originalCommit": "2cba42cee6018132860088d85ef28baed3a3a1cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ0NDE3MA==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r461444170", "bodyText": "org.iq80.snappy.Snappy is still used in hbase_sql/com.splicemachine.orc.stream.OrcInputStream. Before spark3 it was found via spark-hive_2.11:jar:2.4.0-cdh6.3.0 -> hive-exec:jar:2.1.1-cdh6.3.0.\nLooks like there is only one class with this dependency. Should I replace it by org.xerial.snappy.Snappy?", "author": "ipraznik-splice", "createdAt": "2020-07-28T09:24:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxNTI0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTcxMDE0MA==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r461710140", "bodyText": "Use com.splicemachine.compression.SpliceSnappy from spliceengine/utilities. It's based on org.xerial.snappy.", "author": "OlegMazurov", "createdAt": "2020-07-28T16:22:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxNTI0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODU2MDk2MQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r468560961", "bodyText": "Done", "author": "ipraznik-splice", "createdAt": "2020-08-11T13:01:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxNTI0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxNzEwNg==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r461017106", "bodyText": "Since many modules have this dependency, it should be added to  in the topmost pom.xml", "author": "OlegMazurov", "createdAt": "2020-07-27T16:31:19Z", "path": "scala_util/pom.xml", "diffHunk": "@@ -66,13 +66,13 @@\n         <dependency>\n             <groupId>org.scalatest</groupId>\n             <artifactId>scalatest_${scala.binary.version}</artifactId>\n-            <version>2.2.4</version>\n+            <version>${scalatest.version}</version>", "originalCommit": "2cba42cee6018132860088d85ef28baed3a3a1cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ5NzQ5Mw==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r461497493", "bodyText": "moved version to the parent pom", "author": "ipraznik-splice", "createdAt": "2020-07-28T11:03:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxNzEwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxODM1Nw==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r461018357", "bodyText": "This is an unwanted dependency. We provide it as part of Splice. Do we really need to upgrade it for Spark 3.0? (I'd rather eliminate it)", "author": "OlegMazurov", "createdAt": "2020-07-27T16:33:19Z", "path": "hbase_sql/pom.xml", "diffHunk": "@@ -90,7 +90,7 @@\n         <dependency>\n             <groupId>com.typesafe.akka</groupId>\n             <artifactId>akka-remote_${scala.binary.version}</artifactId>\n-            <version>2.4.8</version>\n+            <version>${akka.version}</version>", "originalCommit": "2cba42cee6018132860088d85ef28baed3a3a1cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ4MjIxNQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r461482215", "bodyText": "It's used in hbase_sql/com.splicemachine.olap.OlapJobStatus\nimport akka.remote.FailureDetector; import akka.remote.FailureDetector$; import akka.remote.PhiAccrualFailureDetector;\nshould it be refactored somehow?", "author": "ipraznik-splice", "createdAt": "2020-07-28T10:32:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxODM1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTcyMTM0Nw==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r461721347", "bodyText": "We should not bring a dependency on akka just because we want to use PhiAccrualFailureDetector.\nRefactoring it goes beyond the scope of this JIRA.\nElevating this dependency to the parent pom.xml creates a perception of its legitimacy. I would leave it confined to hbase_sql/pom.xml as is (no version upgrade to avoid potential unwanted transitive dependencies).", "author": "OlegMazurov", "createdAt": "2020-07-28T16:40:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxODM1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzkxOTgwMQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r467919801", "bodyText": "I should upgrade the version, as there is no 2.4.8 with scala 2.12. The closest version with 2.12 support was 2.4.12. I can directly update the version in hbase_sql/pom.xml, without the parent change.", "author": "ipraznik-splice", "createdAt": "2020-08-10T13:54:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxODM1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODEwNDEwMQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r468104101", "bodyText": "That's the way to do it for now (hopefully, 2.4.12 does not bring new transitive dependencies)", "author": "OlegMazurov", "createdAt": "2020-08-10T18:42:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxODM1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODU2MTAzNg==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r468561036", "bodyText": "Done", "author": "ipraznik-splice", "createdAt": "2020-08-11T13:01:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxODM1Nw=="}], "type": "inlineReview"}, {"oid": "d07e9bfb56f43a7788c1b9e383cbbf04a1ea8af0", "url": "https://github.com/splicemachine/spliceengine/commit/d07e9bfb56f43a7788c1b9e383cbbf04a1ea8af0", "message": "DB-9847 splice.spark.master is set to yarn, as yarn-client deprecated. org.scalatest version is moved to parent pom", "committedDate": "2020-07-28T11:01:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY0NzI5Nw==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r464647297", "bodyText": "Probably not a blocker, but is it better to use the lastest scala version 2.12.12 or are there reasons to stay on 2.12.10 ?", "author": "jpanko1", "createdAt": "2020-08-03T20:34:13Z", "path": "pom.xml", "diffHunk": "@@ -945,6 +954,48 @@\n                 <module>assembly</module>\n             </modules>\n         </profile>\n+        <profile>\n+            <id>spark_3.0</id>\n+            <activation>\n+                <property>\n+                    <name>env</name>\n+                    <value>spark_3.0</value>\n+                </property>\n+            </activation>\n+            <properties>\n+                <cdh.parcel.version>6.3.0</cdh.parcel.version>\n+                <envClassifier>spark_3.0</envClassifier>\n+                <envHbase>hbase2.1.4</envHbase>\n+                <hadoop.version>3.0.0-cdh6.3.0</hadoop.version>\n+                <hbase.version>2.1.0-cdh6.3.0</hbase.version>\n+                <hive.version>2.1.1-cdh6.3.0</hive.version>\n+                <zookeeper.version>3.4.5-cdh6.3.0</zookeeper.version>\n+                <scala.binary.version>2.12</scala.binary.version>\n+                <scala.version>2.12.10</scala.version>", "originalCommit": "d07e9bfb56f43a7788c1b9e383cbbf04a1ea8af0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzkyNDE5Ng==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r467924196", "bodyText": "I took 2.12.10 as spark3 has this version in the dependencies list, but should be compatible with 2.12.12. Will upgrade.", "author": "ipraznik-splice", "createdAt": "2020-08-10T14:00:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY0NzI5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODU2MTMwNw==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r468561307", "bodyText": "Upgraded to 2.12.12 in the configuration", "author": "ipraznik-splice", "createdAt": "2020-08-11T13:02:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY0NzI5Nw=="}], "type": "inlineReview"}, {"oid": "2bff7af0a21a64738e6a18e9458b35a690645358", "url": "https://github.com/splicemachine/spliceengine/commit/2bff7af0a21a64738e6a18e9458b35a690645358", "message": "Merge branch 'master' into DB-9847", "committedDate": "2020-08-11T08:55:10Z", "type": "commit"}, {"oid": "9ca67e813b64c2ac7cb7a96142f60ab8b8eb2218", "url": "https://github.com/splicemachine/spliceengine/commit/9ca67e813b64c2ac7cb7a96142f60ab8b8eb2218", "message": "splice.spark.master splice.spark.submit.deployMode added to spliceFastSSL", "committedDate": "2020-08-11T09:18:07Z", "type": "commit"}, {"oid": "c6cfc6c6755e215af59a7e79c654b597825fdf54", "url": "https://github.com/splicemachine/spliceengine/commit/c6cfc6c6755e215af59a7e79c654b597825fdf54", "message": "DB-9847 PR org.iq80.snappy replaced by SpliceSnappy", "committedDate": "2020-08-11T11:09:02Z", "type": "commit"}, {"oid": "c92ce48b2ac16248d7f73f79d6c08458c3634b28", "url": "https://github.com/splicemachine/spliceengine/commit/c92ce48b2ac16248d7f73f79d6c08458c3634b28", "message": "DB-9847 PR akka version is kept only in hbase_sql/pom.xml, scala version is upgraded to 2.12.12", "committedDate": "2020-08-11T11:29:58Z", "type": "commit"}, {"oid": "c6470136ddf4e3bebf2d37b62e88c08b2f96b47b", "url": "https://github.com/splicemachine/spliceengine/commit/c6470136ddf4e3bebf2d37b62e88c08b2f96b47b", "message": "DB-9847 dbaas3.0 profile is added", "committedDate": "2020-08-17T10:48:32Z", "type": "commit"}, {"oid": "1433a06074f66cd621f2e64f52225a14c5a92d00", "url": "https://github.com/splicemachine/spliceengine/commit/1433a06074f66cd621f2e64f52225a14c5a92d00", "message": "DB-9847 test profile spark_3.0 is removed", "committedDate": "2020-08-17T16:50:47Z", "type": "commit"}, {"oid": "78ef272c8c3a86b32f99fd124d791bae299d766e", "url": "https://github.com/splicemachine/spliceengine/commit/78ef272c8c3a86b32f99fd124d791bae299d766e", "message": "DB-9847 envClassifier is set to 'cdh6.3.0' in dbaas3.0 profile", "committedDate": "2020-08-18T13:00:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjMyMjYwMQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r472322601", "bodyText": "We can't reuse envClassifier in this profile. All platform dependent modules (hbase_sql, hbase_storage, etc.) will be built with the same version from two different profiles: cdh6.3.0 and dbaas3.0. There will be only one version in Maven repository at any particular time. Which one will depend on which profile was built last.", "author": "OlegMazurov", "createdAt": "2020-08-18T16:24:10Z", "path": "pom.xml", "diffHunk": "@@ -983,6 +991,47 @@\n                 <module>assembly</module>\n             </modules>\n         </profile>\n+        <profile>\n+            <id>dbaas3.0</id>\n+            <activation>\n+                <property>\n+                    <name>env</name>\n+                    <value>dbaas3.0</value>\n+                </property>\n+            </activation>\n+            <properties>\n+                <cdh.parcel.version>6.3.2</cdh.parcel.version>\n+                <envClassifier>cdh6.3.0</envClassifier>", "originalCommit": "78ef272c8c3a86b32f99fd124d791bae299d766e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjM1NDc4MA==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r472354780", "bodyText": "A new subdirectory assembly/dbaas3.0 is also needed for the new profile/envClassifier", "author": "OlegMazurov", "createdAt": "2020-08-18T17:14:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjMyMjYwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkyMDMxOQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3854#discussion_r472920319", "bodyText": "Done", "author": "ipraznik-splice", "createdAt": "2020-08-19T10:17:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjMyMjYwMQ=="}], "type": "inlineReview"}, {"oid": "6ff8016c861063d46f7c7cf74775118601c7aed3", "url": "https://github.com/splicemachine/spliceengine/commit/6ff8016c861063d46f7c7cf74775118601c7aed3", "message": "envClassifier is set to 'dbaas3.0' in dbaas3.0 profile", "committedDate": "2020-08-19T10:10:08Z", "type": "commit"}]}