{"pr_number": 927, "pr_title": "Replace DynatraceMeterRegistry to JMXmeterRegistry", "pr_createdAt": "2020-08-11T15:45:05Z", "pr_url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/927", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA3NTIzOQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/927#discussion_r469075239", "bodyText": "Replace the tabs with spaces.", "author": "nictas", "createdAt": "2020-08-12T07:56:55Z", "path": "pom.xml", "diffHunk": "@@ -310,10 +310,10 @@\n                 <version>${snakeyaml.version}</version>\n             </dependency>\n             <dependency>\n-                <groupId>io.micrometer</groupId>", "originalCommit": "edc956a3cc9505c2a8c3e45da3cab9193de067f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA4Mzk1Ng==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/927#discussion_r469083956", "bodyText": "Done", "author": "boyan-velinov", "createdAt": "2020-08-12T08:13:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA3NTIzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA3NTY5NA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/927#discussion_r469075694", "bodyText": "Do we need this now?", "author": "nictas", "createdAt": "2020-08-12T07:57:47Z", "path": "multiapps-controller-web/src/main/java/org/cloudfoundry/multiapps/controller/web/configuration/MicrometerConfiguration.java", "diffHunk": "@@ -76,42 +49,20 @@ public Duration step() {\n                 return Duration.ofSeconds(stepInSeconds);\n             }\n \n-            @Override\n-            public int batchSize() {\n-                if (batchSize == null) {\n-                    return DynatraceConfig.super.batchSize();\n-                }\n-                return batchSize;\n-            }\n-\n             @Override\n             @Nullable\n             public String get(String k) {\n                 return null;\n             }\n         };\n-        DynatraceMeterRegistry registry = new DynatraceMeterRegistry(dynatraceConfig, Clock.SYSTEM);\n+        JmxMeterRegistry registry = new JmxMeterRegistry(jmxConfig, Clock.SYSTEM);\n         registry.config()\n                 .meterFilter(MeterFilter.acceptNameStartsWith(CLIENT_CONNECTIONS_METRICS_PREFIX))\n                 .meterFilter(MeterFilter.deny());\n         Metrics.globalRegistry.add(registry);\n         return registry;\n     }\n \n-    private String getDynatraceToken(DynatraceServiceInfo serviceInfo) {\n-        if(serviceInfo == null) {\n-            return null;\n-        }\n-        return serviceInfo.getMicrometerToken();\n-    }\n-\n-    private String getDynatraceUrl(DynatraceServiceInfo serviceInfo) {\n-        if (serviceInfo == null) {\n-            return null;\n-        }\n-        return serviceInfo.getMicrometerUrl();\n-    }\n-\n     private DynatraceServiceInfo getDynatraceServiceInfo() {", "originalCommit": "edc956a3cc9505c2a8c3e45da3cab9193de067f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA5Mzk5OA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/927#discussion_r469093998", "bodyText": "It is not mandatory to check if DynatraceServiceInfo exists before registering JmxMeterRegistry.\nHowever, it we check that we can optimize the things as not registering the registry at all.\nIn this way we will avoid unecesarry preparation of our own metrics and send them to micrometer", "author": "boyan-velinov", "createdAt": "2020-08-12T08:29:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA3NTY5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA3NTgyOA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/927#discussion_r469075828", "bodyText": "This should no longer be needed, right?", "author": "nictas", "createdAt": "2020-08-12T07:58:03Z", "path": "multiapps-controller-web/src/main/java/org/cloudfoundry/multiapps/controller/web/configuration/MicrometerConfiguration.java", "diffHunk": "@@ -32,41 +32,14 @@\n \n     @Inject\n     @Bean\n-    public DynatraceMeterRegistry dynatraceMeterRegistry(ApplicationConfiguration appConfig) {\n+    public JmxMeterRegistry jmxMeterRegistry(ApplicationConfiguration appConfig) {\n         DynatraceServiceInfo serviceInfo = getDynatraceServiceInfo();", "originalCommit": "edc956a3cc9505c2a8c3e45da3cab9193de067f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA4MjUzMg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/927#discussion_r469082532", "bodyText": "DynatraceMeterRegistry  is removed. ReactorNetty use directly Metrics.globalRegistry that propagates meters in all registered registries.", "author": "boyan-velinov", "createdAt": "2020-08-12T08:10:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA3NTgyOA=="}], "type": "inlineReview"}, {"oid": "296b756253f2d63b0a2e471ee097317a78b8ed8a", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/296b756253f2d63b0a2e471ee097317a78b8ed8a", "message": "Replace DynatraceMeterRegistry to JMXmeterRegistry\n\nJira: LMCROSSITXSADEPLOY-2178", "committedDate": "2020-08-12T09:10:02Z", "type": "forcePushed"}, {"oid": "fa550d011949f564cd65a979694008823ed5ae0d", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/fa550d011949f564cd65a979694008823ed5ae0d", "message": "Replace DynatraceMeterRegistry to JMXmeterRegistry\n\nJira: LMCROSSITXSADEPLOY-2178", "committedDate": "2020-08-12T15:13:59Z", "type": "commit"}, {"oid": "fa550d011949f564cd65a979694008823ed5ae0d", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/fa550d011949f564cd65a979694008823ed5ae0d", "message": "Replace DynatraceMeterRegistry to JMXmeterRegistry\n\nJira: LMCROSSITXSADEPLOY-2178", "committedDate": "2020-08-12T15:13:59Z", "type": "forcePushed"}]}