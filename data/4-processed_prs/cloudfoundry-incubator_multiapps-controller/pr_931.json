{"pr_number": 931, "pr_title": "Change response to 404 for requests with non UUID space ID", "pr_createdAt": "2020-08-14T12:01:53Z", "pr_url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/931", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYwMzgwNQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/931#discussion_r470603805", "bodyText": "This is not the right place for this catch. As it is now, it would catch all IllegalArgumentExceptions, whereas you only want to catch the one that may occur when parsing the space GUID. For example, it would also catch an exception coming from the following line:\nUUID userGuid = UUID.fromString(userInfo.getId());\n\nIf this were to happen, the user would receive 404 Not Found, whereas the appropriate status code would be either 400 Bad Request, 401 Unauthorized or 403 Forbidden.\nAnd this is just an example. In the future, we may add more code to the checkPermissions method, and it may also throw IllegalArgumentExceptions.\nFurthermore, when reading this code, it's impossible to know why the try block would even throw such exceptions. You have to actually go inside the checkPermissions method to figure out what's going on, and this is never a good sign. When reading a method, a person should be able to figure out why things are the way they are, without having to dig into the lower levels of abstraction.", "author": "nictas", "createdAt": "2020-08-14T12:50:38Z", "path": "multiapps-controller-web/src/main/java/org/cloudfoundry/multiapps/controller/web/security/AuthorizationChecker.java", "diffHunk": "@@ -69,6 +70,8 @@ public void ensureUserIsAuthorized(HttpServletRequest request, UserInfo userInfo\n                 String message = MessageFormat.format(Messages.UNAUTHORISED_OPERATION_SPACE_ID, action, spaceGuid);\n                 failWithForbiddenStatus(message);\n             }\n+        } catch (IllegalArgumentException e) {", "originalCommit": "401ade01c3957d5804869462654163137b0eddcd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7158db5cd01679c61730a95b84cbe18c9076483d", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/7158db5cd01679c61730a95b84cbe18c9076483d", "message": "Change response to 404 for requests with non UUID space ID", "committedDate": "2020-08-14T13:39:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTMwNzM1Ng==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/931#discussion_r471307356", "bodyText": "I would suggest extracting these lines of code in separate method, because try-catch blocks are extremely ugly.\nConsider something like the following example:\nprivate UUID convertToUUID(String spaceId) { // you may come with better name\n    try {\n            return UUID.fromString(spaceId);\n     } catch (IllegalArgumentException e) {\n            throw new NotFoundException(e.getMessage(), e); // this exception will propagate in case it is thrown\n     }\n}", "author": "radoslav-d", "createdAt": "2020-08-17T08:00:14Z", "path": "multiapps-controller-web/src/main/java/org/cloudfoundry/multiapps/controller/web/security/AuthorizationChecker.java", "diffHunk": "@@ -94,8 +95,12 @@ boolean checkPermissions(UserInfo userInfo, String spaceId, boolean readOnly) {\n         if (hasAdminScope(userInfo)) {\n             return true;\n         }\n-\n-        UUID spaceGuid = UUID.fromString(spaceId);\n+        UUID spaceGuid = null;\n+        try {\n+            spaceGuid = UUID.fromString(spaceId);\n+        } catch (IllegalArgumentException e) {\n+            throw new NotFoundException(e.getMessage(), e);\n+        }", "originalCommit": "7158db5cd01679c61730a95b84cbe18c9076483d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTMwOTA3MA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/931#discussion_r471309070", "bodyText": "Better replace \"foobar\" with something like \"non-uuid-space-id\". Currently when I look at this method call, I am not sure what \"foobar\" stands for and I need to see the actual method to verify that the second param is spaceId.", "author": "radoslav-d", "createdAt": "2020-08-17T08:03:42Z", "path": "multiapps-controller-web/src/test/java/org/cloudfoundry/multiapps/controller/web/security/AuthorizationCheckerTest.java", "diffHunk": "@@ -158,6 +161,13 @@ public void testSpaceDevelopersCacheNegativeResult() {\n                .getSpaceDevelopers(Mockito.eq(UUID.fromString(THIRD_SPACE_ID)));\n     }\n \n+    @Test\n+    void testCheckPermissionsWithNonUUIDSpaceIDString() {\n+        setUpMocks(true, true, null);\n+\n+        assertThrows(NotFoundException.class, () -> authorizationChecker.checkPermissions(userInfo, \"foobar\", true));", "originalCommit": "7158db5cd01679c61730a95b84cbe18c9076483d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6b230d62dae2e44907eca0b82f3e4be7eb89dfca", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/6b230d62dae2e44907eca0b82f3e4be7eb89dfca", "message": "Change response to 404 for requests with non UUID space ID", "committedDate": "2020-08-17T08:45:14Z", "type": "forcePushed"}, {"oid": "bf95aaeda0600ee7cd41e8e3df13b86172416ccd", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/bf95aaeda0600ee7cd41e8e3df13b86172416ccd", "message": "Change response to 404 for requests with non UUID space ID", "committedDate": "2020-08-18T10:03:35Z", "type": "commit"}, {"oid": "bf95aaeda0600ee7cd41e8e3df13b86172416ccd", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/bf95aaeda0600ee7cd41e8e3df13b86172416ccd", "message": "Change response to 404 for requests with non UUID space ID", "committedDate": "2020-08-18T10:03:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA3NTM4MQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/931#discussion_r472075381", "bodyText": "Why public is removed?", "author": "boyan-velinov", "createdAt": "2020-08-18T10:24:28Z", "path": "multiapps-controller-web/src/test/java/org/cloudfoundry/multiapps/controller/web/security/AuthorizationCheckerTest.java", "diffHunk": "@@ -59,8 +62,8 @@\n     private AuthorizationChecker authorizationChecker;\n \n     @BeforeEach\n-    public void setUp() {\n-        MockitoAnnotations.initMocks(this);\n+    void setUp() {", "originalCommit": "bf95aaeda0600ee7cd41e8e3df13b86172416ccd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f1b123fcabec022df04c385295f35237c64c3a29", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/f1b123fcabec022df04c385295f35237c64c3a29", "message": "Merge branch 'master' into non-uuid", "committedDate": "2020-08-18T10:39:32Z", "type": "commit"}]}