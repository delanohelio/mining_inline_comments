{"pr_number": 760, "pr_title": "Sunny's PoC for process abortion", "pr_createdAt": "2020-02-13T10:58:55Z", "pr_url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/760", "timeline": [{"oid": "43d3837fb41ce62da8f9b068f571a7b9e0ce57a2", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/43d3837fb41ce62da8f9b068f571a7b9e0ce57a2", "message": "Sunny's PoC for process abortion", "committedDate": "2020-02-13T11:02:28Z", "type": "forcePushed"}, {"oid": "ae6db3d849ec40d717ff191e348249df3bd2ade0", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/ae6db3d849ec40d717ff191e348249df3bd2ade0", "message": "Sunny's PoC for process abortion", "committedDate": "2020-02-18T15:58:55Z", "type": "forcePushed"}, {"oid": "cb9127bf9ad41914794f4785d1e13bf2c2d15cfc", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/cb9127bf9ad41914794f4785d1e13bf2c2d15cfc", "message": "Sunny's PoC for process abortion", "committedDate": "2020-02-18T16:05:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEzMzYzMA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/760#discussion_r381133630", "bodyText": "\"id\" should be capitalized.", "author": "nictas", "createdAt": "2020-02-19T08:15:25Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Messages.java", "diffHunk": "@@ -203,6 +203,8 @@\n     public static final String CREATE_SUPPORT_TICKET_TO_DS_COMPONENT = \"If you think the problem is in the deployment process, please create a support ticket to {0} component \\\"{1}\\\".\";\r\n     public static final String CREATE_SUPPORT_TICKET_TO_SERVICE_BROKER_COMPONENT = \"If you think the problem is in the service broker, please create a support ticket to {0} component \\\"{1}\\\".\";\r\n     public static final String CREATE_SUPPORT_TICKET_TO_CC_COMPONENT = \"If you think the problem is in the controller, please create a support ticket to {0} component \\\"{1}\\\".\";\r\n+    public static final String DELETING_OPERATION_WITH_ID = \"Deleting operation with id \\\"{0}\\\"\";\r", "originalCommit": "cb9127bf9ad41914794f4785d1e13bf2c2d15cfc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEzMzkwNg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/760#discussion_r381133906", "bodyText": "This comment is not necessary.", "author": "nictas", "createdAt": "2020-02-19T08:16:07Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/flowable/AbortProcessAction.java", "diffHunk": "@@ -5,31 +5,42 @@\n import javax.inject.Inject;\n import javax.inject.Named;\n \n-import com.sap.cloud.lm.sl.cf.core.model.HistoricOperationEvent;\n+import com.sap.cloud.lm.sl.cf.core.model.HistoricOperationEvent.EventType;\n+import com.sap.cloud.lm.sl.cf.core.persistence.service.OperationService;\n import com.sap.cloud.lm.sl.cf.process.util.HistoricOperationEventPersister;\n-import com.sap.cloud.lm.sl.cf.web.api.model.Operation;\n+import com.sap.cloud.lm.sl.cf.process.util.ProcessConflictPreventer;\n \n @Named\n public class AbortProcessAction extends ProcessAction {\n \n     public static final String ACTION_ID_ABORT = \"abort\";\n-    private final HistoricOperationEventPersister historicOperationEventPersister;\n+\n+    private HistoricOperationEventPersister historicEventPersister;\n+    private OperationService operationService;\n \n     @Inject\n     public AbortProcessAction(FlowableFacade flowableFacade, List<AdditionalProcessAction> additionalProcessActions,\n-                              HistoricOperationEventPersister historicOperationEventPersister) {\n+                              HistoricOperationEventPersister historicEventPersister, OperationService operationService) {\n         super(flowableFacade, additionalProcessActions);\n-        this.historicOperationEventPersister = historicOperationEventPersister;\n+        this.historicEventPersister = historicEventPersister;\n+        this.operationService = operationService;\n     }\n \n     @Override\n     public void executeActualProcessAction(String user, String superProcessInstanceId) {\n-        historicOperationEventPersister.add(superProcessInstanceId, HistoricOperationEvent.EventType.ABORTED);\n-        if (flowableFacade.isProcessInstanceSuspended(superProcessInstanceId)) {\n-            flowableFacade.activateProcessInstance(superProcessInstanceId);\n-        }\n-        // TODO: The Delete Reason won't be indispensable anymore and should be deleted after this version is stable.\n-        flowableFacade.deleteProcessInstance(superProcessInstanceId, Operation.State.ABORTED.name());\n+        flowableFacade.setAbortVariable(superProcessInstanceId);\n+        // Release the lock for the operation", "originalCommit": "cb9127bf9ad41914794f4785d1e13bf2c2d15cfc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1a6c05da99c12925378dee813b423c4c46d0367a", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/1a6c05da99c12925378dee813b423c4c46d0367a", "message": "Delete processes as part of CleanupJob", "committedDate": "2020-02-19T08:43:46Z", "type": "commit"}, {"oid": "1a6c05da99c12925378dee813b423c4c46d0367a", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/1a6c05da99c12925378dee813b423c4c46d0367a", "message": "Delete processes as part of CleanupJob", "committedDate": "2020-02-19T08:43:46Z", "type": "forcePushed"}]}