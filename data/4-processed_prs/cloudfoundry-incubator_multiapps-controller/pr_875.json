{"pr_number": 875, "pr_title": "Fix application color detector", "pr_createdAt": "2020-06-10T09:52:32Z", "pr_url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/875", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODAwNjE1NQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/875#discussion_r438006155", "bodyText": "Change to Thrown when there is no result. Don't use this method if it's possible for this query to match nothing.", "author": "nictas", "createdAt": "2020-06-10T09:57:52Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/persistence/query/Query.java", "diffHunk": "@@ -3,14 +3,21 @@\n import java.util.List;\n \n import javax.persistence.NoResultException;\n+import javax.persistence.NonUniqueResultException;\n \n public interface Query<R, T extends Query<?, ?>> {\n \n     T limitOnSelect(int limit);\n \n     T offsetOnSelect(int offset);\n \n-    R singleResult() throws NoResultException;\n+    /**\n+     * @return the result\n+     * @throws NoResultException Thrown when there is no result. Do not use singleResult() method in case you can expect no result", "originalCommit": "c6f74499df3e262df555dc5bd6a4e2a247630a97", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODAwODg2NQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/875#discussion_r438008865", "bodyText": "Change to Thrown when there are multiple results. If you want to get the first of these, use {@code limitOnSelect(1).list()} instead.", "author": "nictas", "createdAt": "2020-06-10T10:02:27Z", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/persistence/query/Query.java", "diffHunk": "@@ -3,14 +3,21 @@\n import java.util.List;\n \n import javax.persistence.NoResultException;\n+import javax.persistence.NonUniqueResultException;\n \n public interface Query<R, T extends Query<?, ?>> {\n \n     T limitOnSelect(int limit);\n \n     T offsetOnSelect(int offset);\n \n-    R singleResult() throws NoResultException;\n+    /**\n+     * @return the result\n+     * @throws NoResultException Thrown when there is no result. Do not use singleResult() method in case you can expect no result\n+     * @throws NonUniqueResultException Thrown when there is multiple results. If you would like to get single result only, you can use", "originalCommit": "c6f74499df3e262df555dc5bd6a4e2a247630a97", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODAwOTM1MA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/875#discussion_r438009350", "bodyText": "Rename to previousProcessId.", "author": "nictas", "createdAt": "2020-06-10T10:03:23Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/ApplicationColorDetector.java", "diffHunk": "@@ -58,12 +57,11 @@ public ApplicationColor detectLiveApplicationColor(DeployedMta deployedMta, Stri\n                       .getState() != Operation.State.ABORTED) {\n             return olderApplicationColor;\n         }\n-        String xs2BlueGreenDeployHistoricProcessInstanceId = flowableFacade.findHistoricProcessInstanceIdByProcessDefinitionKey(operations.get(0)\n-                                                                                                                                          .getProcessId(),\n-                                                                                                                                Constants.BLUE_GREEN_DEPLOY_SERVICE_ID);\n+        String processIdOfPreviousProcess = operations.get(0)", "originalCommit": "c6f74499df3e262df555dc5bd6a4e2a247630a97", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODAxMzUwOQ==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/875#discussion_r438013509", "bodyText": "endedAt can be hardcoded to ZonedDateTime.now. I don't foresee anyone wanting to pass some different value.", "author": "nictas", "createdAt": "2020-06-10T10:11:02Z", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/ProcessConflictPreventer.java", "diffHunk": "@@ -66,13 +67,15 @@ private void validateNoConflictingOperationsExist(String mtaId, String spaceId)\n                                .list();\n     }\n \n-    public void releaseLock(String processInstanceId) {", "originalCommit": "c6f74499df3e262df555dc5bd6a4e2a247630a97", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODAxNjMzNw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/875#discussion_r438016337", "bodyText": "If someone decide to use releaseLock method for different purpose and don't want to set final state, he can pass null and you won't have final state but you will have endedAt field already set.", "author": "theghost5800", "createdAt": "2020-06-10T10:16:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODAxMzUwOQ=="}], "type": "inlineReview"}, {"oid": "3a305b0689a59625f3d8cfd6df111b1b2b20dc4f", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/3a305b0689a59625f3d8cfd6df111b1b2b20dc4f", "message": "Add javadoc for singleResult method", "committedDate": "2020-06-10T10:24:31Z", "type": "commit"}, {"oid": "1acbace393b2d45760bc1813a1b8bea21a16cd2e", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/1acbace393b2d45760bc1813a1b8bea21a16cd2e", "message": "Use containsAll method to compare lists", "committedDate": "2020-06-10T10:24:39Z", "type": "commit"}, {"oid": "7e8edc5631b228bedf9f59e6c63fdccd2cb31b0f", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/7e8edc5631b228bedf9f59e6c63fdccd2cb31b0f", "message": "Fix detection of old blue-green processes\n\nDo not search for sub processes because blue-green process is already\nparent process, set final+endedAt state in operation table when process\nis aborted\n\nJIRA:LMCROSSITXSADEPLOY-2097", "committedDate": "2020-06-10T10:24:39Z", "type": "commit"}, {"oid": "c38f6b03a79171043e59a69c2416408e5445981c", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/c38f6b03a79171043e59a69c2416408e5445981c", "message": "Refactoring", "committedDate": "2020-06-10T11:15:51Z", "type": "commit"}, {"oid": "c38f6b03a79171043e59a69c2416408e5445981c", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/c38f6b03a79171043e59a69c2416408e5445981c", "message": "Refactoring", "committedDate": "2020-06-10T11:15:51Z", "type": "forcePushed"}]}