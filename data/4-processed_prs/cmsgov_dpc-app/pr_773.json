{"pr_number": 773, "pr_title": "DPC-1295: In prod_sbx automatically approve organization for API use", "pr_createdAt": "2020-04-28T14:20:25Z", "pr_url": "https://github.com/CMSgov/dpc-app/pull/773", "timeline": [{"oid": "31f054f04908f279380e9fd549420afe2695eff9", "url": "https://github.com/CMSgov/dpc-app/commit/31f054f04908f279380e9fd549420afe2695eff9", "message": "In prod-sbx, redirect after create org to enable org in api", "committedDate": "2020-04-27T17:58:19Z", "type": "commit"}, {"oid": "33b9c040174d9ba94533f48c52f7dfc0798a92d2", "url": "https://github.com/CMSgov/dpc-app/commit/33b9c040174d9ba94533f48c52f7dfc0798a92d2", "message": "Updated Gemfile & registered organization errors", "committedDate": "2020-04-28T13:58:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY1NDM3NQ==", "url": "https://github.com/CMSgov/dpc-app/pull/773#discussion_r416654375", "bodyText": "Literal 'Cannot find organization' appeared as a condition.", "author": "codeclimate", "createdAt": "2020-04-28T14:22:16Z", "path": "dpc-web/app/models/registered_organization.rb", "diffHunk": "@@ -84,7 +90,9 @@ def delete_api_organization\n       return\n     end\n \n-    errors.add(:base, \"couldn't be deleted from #{api_env} API: #{api_response}\")\n+    action = 'deleted'\n+    msg = api_repsponse.include? 'Cannot find organization' ? 'Cannot find organization' : api_response", "originalCommit": "33b9c040174d9ba94533f48c52f7dfc0798a92d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY1NDM3Ng==", "url": "https://github.com/CMSgov/dpc-app/pull/773#discussion_r416654376", "bodyText": "Use double pipes || instead.", "author": "codeclimate", "createdAt": "2020-04-28T14:22:16Z", "path": "dpc-web/app/models/registered_organization.rb", "diffHunk": "@@ -84,7 +90,9 @@ def delete_api_organization\n       return\n     end\n \n-    errors.add(:base, \"couldn't be deleted from #{api_env} API: #{api_response}\")\n+    action = 'deleted'\n+    msg = api_repsponse.include? 'Cannot find organization' ? 'Cannot find organization' : api_response", "originalCommit": "33b9c040174d9ba94533f48c52f7dfc0798a92d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY1NDM4Mg==", "url": "https://github.com/CMSgov/dpc-app/pull/773#discussion_r416654382", "bodyText": "Trailing whitespace detected.", "author": "codeclimate", "createdAt": "2020-04-28T14:22:17Z", "path": "dpc-web/app/controllers/internal/organizations_controller.rb", "diffHunk": "@@ -84,6 +86,10 @@ def destroy\n \n     private\n \n+    def prod_sbx?\n+      ENV['DEPLOY_ENV'] == 'prod-sbx'\n+    end\n+  ", "originalCommit": "33b9c040174d9ba94533f48c52f7dfc0798a92d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY1NDM4Ng==", "url": "https://github.com/CMSgov/dpc-app/pull/773#discussion_r416654386", "bodyText": "Line is too long. [131/120]", "author": "codeclimate", "createdAt": "2020-04-28T14:22:17Z", "path": "dpc-web/app/controllers/internal/organizations_controller.rb", "diffHunk": "@@ -42,6 +42,8 @@ def create\n         flash[:notice] = 'Organization created.'\n         if params[:from_user].present?\n           redirect_to edit_internal_user_path(params[:from_user], user_organization_ids: @organization.id)\n+        elsif prod_sbx?\n+          redirect_to new_internal_organization_registered_organization_path(organization_id: @organization.id, api_env: 'sandbox')", "originalCommit": "33b9c040174d9ba94533f48c52f7dfc0798a92d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d4aed87ffe91176e47f29eba794f94ca2fa4966d", "url": "https://github.com/CMSgov/dpc-app/commit/d4aed87ffe91176e47f29eba794f94ca2fa4966d", "message": "Code Climate fixes", "committedDate": "2020-04-28T14:50:11Z", "type": "commit"}, {"oid": "e5db7659aa5e0d2f80b18346c0cbdbcd5d0d71b0", "url": "https://github.com/CMSgov/dpc-app/commit/e5db7659aa5e0d2f80b18346c0cbdbcd5d0d71b0", "message": "Fix tests", "committedDate": "2020-04-28T15:57:19Z", "type": "commit"}, {"oid": "848d05a6ae6962f8daf69ab3c6b5539159a57f8a", "url": "https://github.com/CMSgov/dpc-app/commit/848d05a6ae6962f8daf69ab3c6b5539159a57f8a", "message": "Code Climate fix", "committedDate": "2020-04-28T16:01:41Z", "type": "commit"}, {"oid": "c7361c6bd6736d29de31732168d84419479157d8", "url": "https://github.com/CMSgov/dpc-app/commit/c7361c6bd6736d29de31732168d84419479157d8", "message": "Reorder create conditionals", "committedDate": "2020-04-28T16:48:51Z", "type": "commit"}, {"oid": "8ee3dfe23b43f449b99dd9565ae649d97c9dd643", "url": "https://github.com/CMSgov/dpc-app/commit/8ee3dfe23b43f449b99dd9565ae649d97c9dd643", "message": "Merge branch 'master' into nzonnenberg/dpc-1295-auto-api-prod-sbx", "committedDate": "2020-04-29T15:21:44Z", "type": "commit"}, {"oid": "0691dc229b84865eafaee5d42428304ab2084570", "url": "https://github.com/CMSgov/dpc-app/commit/0691dc229b84865eafaee5d42428304ab2084570", "message": "Merge branch 'master' into nzonnenberg/dpc-1295-auto-api-prod-sbx", "committedDate": "2020-04-29T18:05:16Z", "type": "commit"}]}