{"pr_number": 745, "pr_title": "DPC-1277: Change external user email to account verification.", "pr_createdAt": "2020-04-13T13:26:06Z", "pr_url": "https://github.com/CMSgov/dpc-app/pull/745", "timeline": [{"oid": "217b4c4a3de609f01100377125735a5b8b1cabef", "url": "https://github.com/CMSgov/dpc-app/commit/217b4c4a3de609f01100377125735a5b8b1cabef", "message": "Confirmation functionality added.", "committedDate": "2020-04-10T13:35:35Z", "type": "commit"}, {"oid": "4912371688f15594901d798ba49ba115bbf7f59b", "url": "https://github.com/CMSgov/dpc-app/commit/4912371688f15594901d798ba49ba115bbf7f59b", "message": "Resend confirmation instructions page styling", "committedDate": "2020-04-10T14:24:41Z", "type": "commit"}, {"oid": "ce6a62af1f8a9ad1a9efa2df1cdcbe2b7b5e325e", "url": "https://github.com/CMSgov/dpc-app/commit/ce6a62af1f8a9ad1a9efa2df1cdcbe2b7b5e325e", "message": "Emails all share same layout", "committedDate": "2020-04-10T15:37:34Z", "type": "commit"}, {"oid": "18bfd27a78e1c1b45821127cb97cc87e7e8bcd51", "url": "https://github.com/CMSgov/dpc-app/commit/18bfd27a78e1c1b45821127cb97cc87e7e8bcd51", "message": "Email styling", "committedDate": "2020-04-10T16:57:13Z", "type": "commit"}, {"oid": "0087a5482cf5e1db1e31c7f78ef08e38a5a25f40", "url": "https://github.com/CMSgov/dpc-app/commit/0087a5482cf5e1db1e31c7f78ef08e38a5a25f40", "message": "Tests confirm user account verification", "committedDate": "2020-04-10T20:39:47Z", "type": "commit"}, {"oid": "a1af60fbb7703287f300546ceeae59cf5ed7450f", "url": "https://github.com/CMSgov/dpc-app/commit/a1af60fbb7703287f300546ceeae59cf5ed7450f", "message": "Code climate fixes", "committedDate": "2020-04-13T13:30:00Z", "type": "commit"}, {"oid": "c2591a0e67f0314f7d2ff2c523702da27240a698", "url": "https://github.com/CMSgov/dpc-app/commit/c2591a0e67f0314f7d2ff2c523702da27240a698", "message": "Code climate fixes", "committedDate": "2020-04-13T13:31:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUwODI3Mw==", "url": "https://github.com/CMSgov/dpc-app/pull/745#discussion_r412508273", "bodyText": "I believe that if last_email is not present the test will fail on line 36 unless you add :aggregate_failures", "author": "SMLuthi", "createdAt": "2020-04-21T21:35:49Z", "path": "dpc-web/spec/features/registration/new_user_signs_up_for_account_spec.rb", "diffHunk": "@@ -24,15 +26,30 @@\n       select 'New York', from: :user_state\n       fill_in :user_zip, with: '10033'\n       check :user_agree_to_terms\n-\n+  \n       click_on('Sign up')\n+    end\n+\n+    scenario 'user is sent a confirmation email with confirmation token' do\n+      :confirmation_token.should_not be_nil\n+\n+      ctoken = last_email.body.match(/confirmation_token=\\w*/)\n+\n+      expect(last_email).to be_present", "originalCommit": "c2591a0e67f0314f7d2ff2c523702da27240a698", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzgzNTExOA==", "url": "https://github.com/CMSgov/dpc-app/pull/745#discussion_r413835118", "bodyText": "It does pass without :aggregate_failures, is this something you anticipate to fail sometimes?", "author": "Sun-Mountain", "createdAt": "2020-04-23T14:18:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUwODI3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg5NTE4OA==", "url": "https://github.com/CMSgov/dpc-app/pull/745#discussion_r413895188", "bodyText": "I meant more in terms of if something were to change that would result in last_email to not be present. The test would error out on line 36 instead of propagating to line 38 were the expect block would throw an error. Either I would switch the two lines or, if last_email will always be present, I would just remove line 38.", "author": "SMLuthi", "createdAt": "2020-04-23T15:26:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUwODI3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkxOTE1NQ==", "url": "https://github.com/CMSgov/dpc-app/pull/745#discussion_r413919155", "bodyText": "If we remove last_email line would we still require :aggregate_failures?", "author": "Sun-Mountain", "createdAt": "2020-04-23T15:56:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUwODI3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkxOTY5OQ==", "url": "https://github.com/CMSgov/dpc-app/pull/745#discussion_r413919699", "bodyText": "Also it seems I still can't request you to review a PR or your approval doesn't mean I can merge the PR.", "author": "Sun-Mountain", "createdAt": "2020-04-23T15:57:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUwODI3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk2MjQ3NA==", "url": "https://github.com/CMSgov/dpc-app/pull/745#discussion_r413962474", "bodyText": "No, if the last_email check is removed we probably wouldn't require :aggregate_failures anymore. However, its not a bad practice to include that in any specs that have multiple expect blocks that check different things (i.e. a test that populates multiple entities). That way if a test fails, it will show ALL the exceptions... and it can be easier to deduce and issue.", "author": "SMLuthi", "createdAt": "2020-04-23T16:53:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUwODI3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk2Mjc2OQ==", "url": "https://github.com/CMSgov/dpc-app/pull/745#discussion_r413962769", "bodyText": "And yea, I requested write access a little bit ago so hopefully that will be approved soon, sorry!", "author": "SMLuthi", "createdAt": "2020-04-23T16:54:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUwODI3Mw=="}], "type": "inlineReview"}, {"oid": "0ed258d968e240d4efe72c18a24cb474aa3600f5", "url": "https://github.com/CMSgov/dpc-app/commit/0ed258d968e240d4efe72c18a24cb474aa3600f5", "message": "Added aggregate_failures to spec", "committedDate": "2020-04-23T14:21:05Z", "type": "commit"}, {"oid": "da51e70adcdd045013c90c5dc100eb8666d8d6b9", "url": "https://github.com/CMSgov/dpc-app/commit/da51e70adcdd045013c90c5dc100eb8666d8d6b9", "message": "Removed check for last_email", "committedDate": "2020-04-23T17:30:14Z", "type": "commit"}, {"oid": "d4aaf85ad401af97de88e809902f16df94378706", "url": "https://github.com/CMSgov/dpc-app/commit/d4aaf85ad401af97de88e809902f16df94378706", "message": "Merge branch 'master' into nzonnenberg/dpc-1277-email-verification", "committedDate": "2020-04-23T17:46:46Z", "type": "commit"}, {"oid": "4687c020a73ea91664ff585fcb12202997deabb0", "url": "https://github.com/CMSgov/dpc-app/commit/4687c020a73ea91664ff585fcb12202997deabb0", "message": "Merge branch 'master' into nzonnenberg/dpc-1277-email-verification", "committedDate": "2020-04-23T18:21:59Z", "type": "commit"}]}