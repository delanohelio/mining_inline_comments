{"pr_number": 1041, "pr_title": "DPC-19: Fix error to save updated registered org if missing required field", "pr_createdAt": "2020-09-14T14:05:56Z", "pr_url": "https://github.com/CMSgov/dpc-app/pull/1041", "timeline": [{"oid": "281bd5c841f56caa399a542c539dec09b1d4fd12", "url": "https://github.com/CMSgov/dpc-app/commit/281bd5c841f56caa399a542c539dec09b1d4fd12", "message": "Init", "committedDate": "2020-09-11T13:16:58Z", "type": "commit"}, {"oid": "ae7933c7b8c9ed6af3ef798f7b2c64fccc53a324", "url": "https://github.com/CMSgov/dpc-app/commit/ae7933c7b8c9ed6af3ef798f7b2c64fccc53a324", "message": "NPI required to save organization information", "committedDate": "2020-09-11T20:07:09Z", "type": "commit"}, {"oid": "ad7d3a2ef0b2b9dab1f30cf73048c1bb448cf036", "url": "https://github.com/CMSgov/dpc-app/commit/ad7d3a2ef0b2b9dab1f30cf73048c1bb448cf036", "message": "Test progress", "committedDate": "2020-09-14T14:05:26Z", "type": "commit"}, {"oid": "38edcc0f762d090fe9a21d206bf0603b2ad5b733", "url": "https://github.com/CMSgov/dpc-app/commit/38edcc0f762d090fe9a21d206bf0603b2ad5b733", "message": "Test for enabled org NPI", "committedDate": "2020-09-14T14:45:56Z", "type": "commit"}, {"oid": "9f712a0736a157b5cd2627fe5ed1a82b4c92962e", "url": "https://github.com/CMSgov/dpc-app/commit/9f712a0736a157b5cd2627fe5ed1a82b4c92962e", "message": "Refactor enable_or_disable", "committedDate": "2020-09-14T14:50:23Z", "type": "commit"}, {"oid": "5d3e09bf87e36ccdeb003462a3627fc4e3539d39", "url": "https://github.com/CMSgov/dpc-app/commit/5d3e09bf87e36ccdeb003462a3627fc4e3539d39", "message": "Test fix", "committedDate": "2020-09-14T14:55:48Z", "type": "commit"}, {"oid": "806cf20bff2629237e5f58d36747682fe948323a", "url": "https://github.com/CMSgov/dpc-app/commit/806cf20bff2629237e5f58d36747682fe948323a", "message": "Move page_redirect out of conditional", "committedDate": "2020-09-14T14:57:34Z", "type": "commit"}, {"oid": "c60e4f2677d5fbfcfad43ab2ea40762f632c18c6", "url": "https://github.com/CMSgov/dpc-app/commit/c60e4f2677d5fbfcfad43ab2ea40762f632c18c6", "message": "Merge branch 'master' into nz/dpc-19-reg-org-req-fields", "committedDate": "2020-09-14T15:12:06Z", "type": "commit"}, {"oid": "3f53ae7d7a54f12ba24006b07dbe17239c778829", "url": "https://github.com/CMSgov/dpc-app/commit/3f53ae7d7a54f12ba24006b07dbe17239c778829", "message": "Merge branch 'master' into nz/dpc-19-reg-org-req-fields", "committedDate": "2020-09-14T16:30:08Z", "type": "commit"}, {"oid": "87b2175c118650429f19d991875c11db280de42f", "url": "https://github.com/CMSgov/dpc-app/commit/87b2175c118650429f19d991875c11db280de42f", "message": "Merge branch 'master' into nz/dpc-19-reg-org-req-fields", "committedDate": "2020-09-14T18:33:47Z", "type": "commit"}, {"oid": "dfb5b76f76b26848f4009917702d2cec2de07d2b", "url": "https://github.com/CMSgov/dpc-app/commit/dfb5b76f76b26848f4009917702d2cec2de07d2b", "message": "Merge branch 'master' into nz/dpc-19-reg-org-req-fields", "committedDate": "2020-09-15T18:39:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk1NzAyNw==", "url": "https://github.com/CMSgov/dpc-app/pull/1041#discussion_r488957027", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    flash[:alert] = 'Enabled organization require an NPI.'\n          \n          \n            \n                    flash[:alert] = 'Enabled organizations require an NPI.'", "author": "dhgreene", "createdAt": "2020-09-15T20:35:07Z", "path": "dpc-web/app/controllers/internal/organizations_controller.rb", "diffHunk": "@@ -65,7 +65,10 @@ def edit\n     def update\n       @organization = Organization.find id_param\n \n-      if @organization.update organization_params\n+      if organization_enabled?(@organization) && npi_blank?\n+        flash[:alert] = 'Enabled organization require an NPI.'", "originalCommit": "dfb5b76f76b26848f4009917702d2cec2de07d2b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk2MzIyNw==", "url": "https://github.com/CMSgov/dpc-app/pull/1041#discussion_r488963227", "bodyText": "This works, but I wonder if you could use rails require to enforce the parameter.\n    def organization_params\n      params.require(:organization).permit(\n        :name, :organization_type, :num_providers, :npi, :vendor,\n        address_attributes: %i[id street street_2 city state zip address_use address_type]\n      ).tap do |org_params|\n        org_params.require(:npi)\n      end\n    end\n\nThat may just force an error automatically", "author": "SMLuthi", "createdAt": "2020-09-15T20:47:00Z", "path": "dpc-web/app/controllers/internal/organizations_controller.rb", "diffHunk": "@@ -119,6 +122,16 @@ def delete_user_from_org\n       end\n     end\n \n+    def npi_blank?", "originalCommit": "dfb5b76f76b26848f4009917702d2cec2de07d2b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQwODczMA==", "url": "https://github.com/CMSgov/dpc-app/pull/1041#discussion_r489408730", "bodyText": "Can you also specify an error this way?\nThe reason I went with this method was so I could throw flash[:alert] = 'Enabled organization require an NPI.'", "author": "Sun-Mountain", "createdAt": "2020-09-16T12:47:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk2MzIyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQxMTQwNg==", "url": "https://github.com/CMSgov/dpc-app/pull/1041#discussion_r489411406", "bodyText": "Also this requires an npi on creation, which we may not know immediately.", "author": "Sun-Mountain", "createdAt": "2020-09-16T12:51:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk2MzIyNw=="}], "type": "inlineReview"}, {"oid": "50232888947d90aba1e034c47b161da17b7f8a0b", "url": "https://github.com/CMSgov/dpc-app/commit/50232888947d90aba1e034c47b161da17b7f8a0b", "message": "Update dpc-web/app/controllers/internal/organizations_controller.rb\n\nCo-authored-by: dhgreene <dhgreene@gmail.com>", "committedDate": "2020-09-16T12:04:42Z", "type": "commit"}, {"oid": "e06e53216e45d91669a09bc16dfc31915f6019dc", "url": "https://github.com/CMSgov/dpc-app/commit/e06e53216e45d91669a09bc16dfc31915f6019dc", "message": "Merge branch 'master' into nz/dpc-19-reg-org-req-fields", "committedDate": "2020-09-16T12:51:45Z", "type": "commit"}, {"oid": "e30ff11e8cb86c6da337c9f6b910d061bc6a677d", "url": "https://github.com/CMSgov/dpc-app/commit/e30ff11e8cb86c6da337c9f6b910d061bc6a677d", "message": "Merge branch 'master' into nz/dpc-19-reg-org-req-fields", "committedDate": "2020-09-16T14:07:51Z", "type": "commit"}, {"oid": "6ca2b94fd30383b511e474cc7ab5c0fad3505b1a", "url": "https://github.com/CMSgov/dpc-app/commit/6ca2b94fd30383b511e474cc7ab5c0fad3505b1a", "message": "Merge branch 'master' into nz/dpc-19-reg-org-req-fields", "committedDate": "2020-09-16T14:25:58Z", "type": "commit"}]}