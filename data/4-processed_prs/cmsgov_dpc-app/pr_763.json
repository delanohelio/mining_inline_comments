{"pr_number": 763, "pr_title": "DPC-1282 organization id validation", "pr_createdAt": "2020-04-22T14:12:51Z", "pr_url": "https://github.com/CMSgov/dpc-app/pull/763", "timeline": [{"oid": "4328a645c33572a0a1c23bd645cd62f1cb21356b", "url": "https://github.com/CMSgov/dpc-app/commit/4328a645c33572a0a1c23bd645cd62f1cb21356b", "message": "organization id validation", "committedDate": "2020-04-22T01:24:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA2OTcyNQ==", "url": "https://github.com/CMSgov/dpc-app/pull/763#discussion_r413069725", "bodyText": "Is there a reasonable length validation (min < identifier.length() < max) for this?", "author": "dhgreene", "createdAt": "2020-04-22T15:11:49Z", "path": "dpc-common/src/main/java/gov/cms/dpc/common/hibernate/validator/OrganizationIdValidator.java", "diffHunk": "@@ -0,0 +1,32 @@\n+package gov.cms.dpc.common.hibernate.validator;\n+\n+import gov.cms.dpc.common.annotations.OrganizationId;\n+import org.apache.commons.lang3.StringUtils;\n+import org.apache.commons.validator.routines.checkdigit.LuhnCheckDigit;\n+\n+import javax.validation.ConstraintValidator;\n+import javax.validation.ConstraintValidatorContext;\n+\n+public class OrganizationIdValidator implements ConstraintValidator<OrganizationId, String> {\n+\n+    public static final String VALIDATION_MESSAGE = \"Invalid Organization ID format\";\n+    private static final String CARD_ISSUER_IDENTIFIER = \"80840\";\n+\n+    @Override\n+    public void initialize(OrganizationId organizationId) {\n+        //not used\n+    }\n+\n+    @Override\n+    public boolean isValid(String s, ConstraintValidatorContext constraintValidatorContext) {\n+        if (!allDigits(s)) {\n+            return false;\n+        }\n+        String identifier = CARD_ISSUER_IDENTIFIER + s;\n+        return LuhnCheckDigit.LUHN_CHECK_DIGIT.isValid(identifier);", "originalCommit": "4328a645c33572a0a1c23bd645cd62f1cb21356b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA4MTU4MA==", "url": "https://github.com/CMSgov/dpc-app/pull/763#discussion_r413081580", "bodyText": "yep @dhgreene, here:\nhttps://github.com/CMSgov/dpc-app/blob/DPC-1282-organization-id-validation/dpc-common/src/main/java/gov/cms/dpc/common/annotations/OrganizationId.java#L17", "author": "MrBilnon", "createdAt": "2020-04-22T15:26:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA2OTcyNQ=="}], "type": "inlineReview"}, {"oid": "0ca50a6d1a09ebd82432df57cedb1a5ca8d057cf", "url": "https://github.com/CMSgov/dpc-app/commit/0ca50a6d1a09ebd82432df57cedb1a5ca8d057cf", "message": "change validator to only look at npi ids", "committedDate": "2020-04-22T22:24:28Z", "type": "commit"}, {"oid": "8c979c4f3ec67a1238b9429a5955430e1c8dd7b3", "url": "https://github.com/CMSgov/dpc-app/commit/8c979c4f3ec67a1238b9429a5955430e1c8dd7b3", "message": "update tests for new organization id (not database id) validation", "committedDate": "2020-04-22T22:25:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM4MjM2Ng==", "url": "https://github.com/CMSgov/dpc-app/pull/763#discussion_r413382366", "bodyText": "Method registerOrganization has 5 arguments (exceeds 4 allowed). Consider refactoring.", "author": "codeclimate", "createdAt": "2020-04-22T22:43:25Z", "path": "dpc-common/src/main/java/gov/cms/dpc/fhir/helpers/FHIRHelpers.java", "diffHunk": "@@ -41,7 +41,7 @@\n      * @return - {@link String} Access token generated for the {@link Organization}\n      * @throws IOException - Throws if HTTP client fails\n      */\n-    public static String registerOrganization(IGenericClient client, IParser parser, String organizationID, String adminURL) throws IOException {\n+    public static String registerOrganization(IGenericClient client, IParser parser, String organizationID, String organizationNPI, String adminURL) throws IOException {", "originalCommit": "8c979c4f3ec67a1238b9429a5955430e1c8dd7b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "01b6ae97635d9c266c9dfc02799a429acddbc5c7", "url": "https://github.com/CMSgov/dpc-app/commit/01b6ae97635d9c266c9dfc02799a429acddbc5c7", "message": "Merge branch 'master' into DPC-1282-organization-id-validation", "committedDate": "2020-04-22T23:04:35Z", "type": "commit"}, {"oid": "4214f95810ead4276f78aa13afd036eefef10e7a", "url": "https://github.com/CMSgov/dpc-app/commit/4214f95810ead4276f78aa13afd036eefef10e7a", "message": "separate out npi validation from OrganizationIdValidator to separate utility class so npi validation can be used in other places", "committedDate": "2020-04-23T04:08:11Z", "type": "commit"}, {"oid": "3a2a423221725cb088e7555bd72eb8e9949a4f08", "url": "https://github.com/CMSgov/dpc-app/commit/3a2a423221725cb088e7555bd72eb8e9949a4f08", "message": "Merge remote-tracking branch 'origin/DPC-1282-organization-id-validation' into DPC-1282-organization-id-validation", "committedDate": "2020-04-23T04:08:17Z", "type": "commit"}, {"oid": "34f4164041deef691b777f8d6bfbe1c3a3fde756", "url": "https://github.com/CMSgov/dpc-app/commit/34f4164041deef691b777f8d6bfbe1c3a3fde756", "message": "add more test cases for different starting numbers", "committedDate": "2020-04-27T19:04:26Z", "type": "commit"}, {"oid": "28dae358b9a1b1dbed39d47eb6122238963b493d", "url": "https://github.com/CMSgov/dpc-app/commit/28dae358b9a1b1dbed39d47eb6122238963b493d", "message": "add npi validation to practitioners and update test (#766)", "committedDate": "2020-04-27T20:55:10Z", "type": "commit"}, {"oid": "e91f7b25d308cb97d8c72c30b163d277827f670b", "url": "https://github.com/CMSgov/dpc-app/commit/e91f7b25d308cb97d8c72c30b163d277827f670b", "message": "Merge branch 'master' into DPC-1282-organization-id-validation", "committedDate": "2020-04-27T20:55:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE1Mzk5Nw==", "url": "https://github.com/CMSgov/dpc-app/pull/763#discussion_r416153997", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "author": "codeclimate", "createdAt": "2020-04-27T21:15:30Z", "path": "dpc-common/src/main/java/gov/cms/dpc/common/annotations/NPI.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package gov.cms.dpc.common.annotations;", "originalCommit": "e91f7b25d308cb97d8c72c30b163d277827f670b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE1NDAwMQ==", "url": "https://github.com/CMSgov/dpc-app/pull/763#discussion_r416154001", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "author": "codeclimate", "createdAt": "2020-04-27T21:15:30Z", "path": "dpc-common/src/main/java/gov/cms/dpc/common/annotations/OrganizationId.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package gov.cms.dpc.common.annotations;", "originalCommit": "e91f7b25d308cb97d8c72c30b163d277827f670b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2121e76905c68b62eeafe56a9b0ebcf8531d36f4", "url": "https://github.com/CMSgov/dpc-app/commit/2121e76905c68b62eeafe56a9b0ebcf8531d36f4", "message": "Merge branch 'master' into DPC-1282-organization-id-validation\n\n# Conflicts:\n#\tdpc-common/pom.xml\n#\tdpc-common/src/main/java/gov/cms/dpc/common/entities/OrganizationEntity.java", "committedDate": "2020-04-29T18:54:38Z", "type": "commit"}, {"oid": "d79ae6047992886603329c7ee42e88a5ed1aaf3b", "url": "https://github.com/CMSgov/dpc-app/commit/d79ae6047992886603329c7ee42e88a5ed1aaf3b", "message": "Merge remote-tracking branch 'origin/DPC-1282-organization-id-validation' into DPC-1282-organization-id-validation\n\n# Conflicts:\n#\tdpc-common/src/main/java/gov/cms/dpc/common/entities/ProviderEntity.java", "committedDate": "2020-04-29T19:49:44Z", "type": "commit"}, {"oid": "e1ea1846ae4e35fcd7025501ad5f05ba213566be", "url": "https://github.com/CMSgov/dpc-app/commit/e1ea1846ae4e35fcd7025501ad5f05ba213566be", "message": "Merge branch 'master' into DPC-1282-organization-id-validation", "committedDate": "2020-04-30T21:54:26Z", "type": "commit"}, {"oid": "2fb4123aa66e1a2973066c179ea6b69d68ba0086", "url": "https://github.com/CMSgov/dpc-app/commit/2fb4123aa66e1a2973066c179ea6b69d68ba0086", "message": "Merge branch 'master' into DPC-1282-organization-id-validation", "committedDate": "2020-05-18T14:27:28Z", "type": "commit"}, {"oid": "f9da92cc133fe575da1d060e907e786da3994e93", "url": "https://github.com/CMSgov/dpc-app/commit/f9da92cc133fe575da1d060e907e786da3994e93", "message": "Merge remote-tracking branch 'origin/master' into DPC-1282-organization-id-validation", "committedDate": "2020-05-18T15:31:56Z", "type": "commit"}, {"oid": "546ef56bb16f120f539ef8b928e7b5b5fd48b53c", "url": "https://github.com/CMSgov/dpc-app/commit/546ef56bb16f120f539ef8b928e7b5b5fd48b53c", "message": "fix test", "committedDate": "2020-05-18T15:58:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc0NDQ1OQ==", "url": "https://github.com/CMSgov/dpc-app/pull/763#discussion_r426744459", "bodyText": "Similar blocks of code found in 3 locations. Consider refactoring.", "author": "codeclimate", "createdAt": "2020-05-18T16:17:41Z", "path": "dpc-common/src/main/java/gov/cms/dpc/common/annotations/NPI.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package gov.cms.dpc.common.annotations;", "originalCommit": "546ef56bb16f120f539ef8b928e7b5b5fd48b53c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc0NDQ2MQ==", "url": "https://github.com/CMSgov/dpc-app/pull/763#discussion_r426744461", "bodyText": "Similar blocks of code found in 3 locations. Consider refactoring.", "author": "codeclimate", "createdAt": "2020-05-18T16:17:41Z", "path": "dpc-common/src/main/java/gov/cms/dpc/common/annotations/OrganizationId.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package gov.cms.dpc.common.annotations;", "originalCommit": "546ef56bb16f120f539ef8b928e7b5b5fd48b53c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}