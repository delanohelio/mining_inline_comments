{"pr_number": 1089, "pr_title": "DPC 726 bypass lookback for predefined organizations", "pr_createdAt": "2020-10-15T15:51:05Z", "pr_url": "https://github.com/CMSgov/dpc-app/pull/1089", "timeline": [{"oid": "658f95030130a7f93a66ae559b4e99a046119ee2", "url": "https://github.com/CMSgov/dpc-app/commit/658f95030130a7f93a66ae559b4e99a046119ee2", "message": "Disabled lookback for smoketest orgs", "committedDate": "2020-10-12T06:57:13Z", "type": "commit"}, {"oid": "0cb52f29b686dba931633f5f5e4756407a0035df", "url": "https://github.com/CMSgov/dpc-app/commit/0cb52f29b686dba931633f5f5e4756407a0035df", "message": "Fixed app configs", "committedDate": "2020-10-12T20:01:35Z", "type": "commit"}, {"oid": "154ded0543662586e2b391560dc55feb2cde77c1", "url": "https://github.com/CMSgov/dpc-app/commit/154ded0543662586e2b391560dc55feb2cde77c1", "message": "Merge branch 'master' into sg/DPC-725-bypass-lookback-during-smoke-testing", "committedDate": "2020-10-12T20:12:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTY1MzY5NA==", "url": "https://github.com/CMSgov/dpc-app/pull/1089#discussion_r505653694", "bodyText": "Method runAndMonitorExportJob has 6 arguments (exceeds 4 allowed). Consider refactoring.", "author": "codeclimate", "createdAt": "2020-10-15T15:52:11Z", "path": "dpc-smoketest/src/main/java/gov/cms/dpc/testing/smoketests/SmokeTest.java", "diffHunk": "@@ -221,18 +204,20 @@ public SampleResult runTest(JavaSamplerContext javaSamplerContext) {\n             patientSample.sampleEnd();\n             smokeTestResult.addSubResult(patientSample);\n         }\n+        return patientReferences;\n+    }\n \n \n-        // Upload the roster bundle\n+    private void uploadRosterBundle(JavaSamplerContext samplerContext, Bundle providerBundle, IGenericClient exportClient, Map<String,Reference> patientReferences){\n         logger.debug(\"Uploading roster\");\n         try {\n-            ClientUtils.createAndUploadRosters(javaSamplerContext.getParameter(\"seed-file\"), providerBundle, exportClient, UUID.fromString(organizationID), patientReferences);\n+            ClientUtils.createAndUploadRosters(samplerContext.getParameter(\"seed-file\"), providerBundle, exportClient, UUID.fromString(organizationID), patientReferences);\n         } catch (Exception e) {\n             throw new IllegalStateException(\"Cannot upload roster\", e);\n         }\n+    }\n \n-        // Run the job\n-        // Create a custom http client to use for monitoring the non-FHIR export request\n+    private void runAndMonitorExportJob(SampleResult smokeTestResult, String hostParam, String clientToken, Pair<UUID, PrivateKey> keyTuple, IGenericClient exportClient, List<String> providerNPIs){", "originalCommit": "154ded0543662586e2b391560dc55feb2cde77c1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "76ec6cf32f8b91213b1b3bef9fb1f2ffe3fdec0e", "url": "https://github.com/CMSgov/dpc-app/commit/76ec6cf32f8b91213b1b3bef9fb1f2ffe3fdec0e", "message": "Fixed NPE in mock blueButton Client", "committedDate": "2020-10-15T16:08:44Z", "type": "commit"}, {"oid": "bdb58c5d1287cd9212740929ad94dcc6fa4218e4", "url": "https://github.com/CMSgov/dpc-app/commit/bdb58c5d1287cd9212740929ad94dcc6fa4218e4", "message": "Reverted smoke test changes.", "committedDate": "2020-10-15T17:13:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk1NzQyNw==", "url": "https://github.com/CMSgov/dpc-app/pull/1089#discussion_r507957427", "bodyText": "are we guaranteed to always have an org ID on the job?", "author": "jonfulk", "createdAt": "2020-10-19T18:02:20Z", "path": "dpc-aggregation/src/main/java/gov/cms/dpc/aggregation/engine/JobBatchProcessor.java", "diffHunk": "@@ -59,15 +59,22 @@ public JobBatchProcessor(BlueButtonClient bbclient, FhirContext fhirContext, Met\n      * @return A list of batch files {@link JobQueueBatchFile}\n      */\n     public List<JobQueueBatchFile> processJobBatchPartial(UUID aggregatorID, IJobQueue queue, JobQueueBatch job, String patientID) {\n-        List<LookBackAnswer> answers = getAnswers(job, patientID);\n+    Flowable<Resource> flowable;\n+    if(isLookBackExempt(job.getOrgID())){", "originalCommit": "bdb58c5d1287cd9212740929ad94dcc6fa4218e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAxNjUwMw==", "url": "https://github.com/CMSgov/dpc-app/pull/1089#discussion_r508016503", "bodyText": "@jonfulk I want to say yes because the orgId in the table has a nullable = false constraint", "author": "MrBilnon", "createdAt": "2020-10-19T19:41:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk1NzQyNw=="}], "type": "inlineReview"}, {"oid": "4f9c32d15f2655da00b3f42c94ae73c4c8a02e23", "url": "https://github.com/CMSgov/dpc-app/commit/4f9c32d15f2655da00b3f42c94ae73c4c8a02e23", "message": "Merge branch 'master' into sg/DPC-726-bypass-lookback-during-smoke-testing", "committedDate": "2020-10-19T23:28:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg0NDc2OQ==", "url": "https://github.com/CMSgov/dpc-app/pull/1089#discussion_r508844769", "bodyText": "Just checking but aren't the UUIDs for the orgs in the smoke test generated randomly?  I might be missing where you are hard coding these values.", "author": "MrBilnon", "createdAt": "2020-10-20T21:16:30Z", "path": "dpc-aggregation/src/main/resources/application.conf", "diffHunk": "@@ -29,6 +29,8 @@ dpc.aggregation {\n   # The number of months to look back for a claim\n   lookBackMonths = 18\n   lookBackMonths = ${?LOOK_BACK_MONTHS}\n+  lookBackExemptOrgs = [\"0ab352f1-2bf1-44c4-aa7a-3004a1ffef12\",\"69c0d4d4-9c07-4fa8-9053-e10fb1608b48\",\"c7f5247b-4c41-478c-84eb-a6e801bdb145\"]", "originalCommit": "4f9c32d15f2655da00b3f42c94ae73c4c8a02e23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM0MTk1OQ==", "url": "https://github.com/CMSgov/dpc-app/pull/1089#discussion_r509341959", "bodyText": "Sorry, this PR only covers adding the mechanism for bypassing lookback based on configured org Ids, I will update the PR description to reflect that.", "author": "MrMorie", "createdAt": "2020-10-21T14:34:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg0NDc2OQ=="}], "type": "inlineReview"}, {"oid": "349d3a2301334497d1323e1ae6e5273d47ed9fa2", "url": "https://github.com/CMSgov/dpc-app/commit/349d3a2301334497d1323e1ae6e5273d47ed9fa2", "message": "Merge branch 'master' into sg/DPC-726-bypass-lookback-during-smoke-testing", "committedDate": "2020-10-21T14:46:17Z", "type": "commit"}, {"oid": "856cd570559a3e17ef9c9061fd221e63266047e5", "url": "https://github.com/CMSgov/dpc-app/commit/856cd570559a3e17ef9c9061fd221e63266047e5", "message": "Merge branch 'master' into sg/DPC-726-bypass-lookback-during-smoke-testing", "committedDate": "2020-10-21T17:43:33Z", "type": "commit"}, {"oid": "808e89d510a2f979626786a3f1a44937dad71ce3", "url": "https://github.com/CMSgov/dpc-app/commit/808e89d510a2f979626786a3f1a44937dad71ce3", "message": "Merge branch 'master' into sg/DPC-726-bypass-lookback-during-smoke-testing", "committedDate": "2020-10-23T03:20:06Z", "type": "commit"}]}