{"pr_number": 914, "pr_title": "DPC-318 & 520: disable an API env for an organization but not delete all their data from the API.", "pr_createdAt": "2020-07-17T14:01:38Z", "pr_url": "https://github.com/CMSgov/dpc-app/pull/914", "timeline": [{"oid": "443d933dab3e74b93ec94c88fa2a885af4469894", "url": "https://github.com/CMSgov/dpc-app/commit/443d933dab3e74b93ec94c88fa2a885af4469894", "message": "Init", "committedDate": "2020-07-09T16:22:30Z", "type": "commit"}, {"oid": "0a41c81e4b184b8bc8a20b8ae98ec44698748f19", "url": "https://github.com/CMSgov/dpc-app/commit/0a41c81e4b184b8bc8a20b8ae98ec44698748f19", "message": "Removed sandbox_id methods", "committedDate": "2020-07-09T16:43:15Z", "type": "commit"}, {"oid": "ce25229d59128c7babf1ecfedbfef940978a95fa", "url": "https://github.com/CMSgov/dpc-app/commit/ce25229d59128c7babf1ecfedbfef940978a95fa", "message": "rake tasks", "committedDate": "2020-07-09T16:43:32Z", "type": "commit"}, {"oid": "9cad794b7aa4f6272598785e7f2482297ef68cb4", "url": "https://github.com/CMSgov/dpc-app/commit/9cad794b7aa4f6272598785e7f2482297ef68cb4", "message": "Remove external identifier from spec tests", "committedDate": "2020-07-09T16:57:47Z", "type": "commit"}, {"oid": "9ec33a36a5e6cd1590821a098a8aa330b94d5200", "url": "https://github.com/CMSgov/dpc-app/commit/9ec33a36a5e6cd1590821a098a8aa330b94d5200", "message": "spec test fix", "committedDate": "2020-07-09T17:44:32Z", "type": "commit"}, {"oid": "f0c0c17da6748c78edd03634990df22e5aff042a", "url": "https://github.com/CMSgov/dpc-app/commit/f0c0c17da6748c78edd03634990df22e5aff042a", "message": "spec tests fixed", "committedDate": "2020-07-09T18:01:34Z", "type": "commit"}, {"oid": "d81068f48a8ea73ed871422a4228b9a2a398ae20", "url": "https://github.com/CMSgov/dpc-app/commit/d81068f48a8ea73ed871422a4228b9a2a398ae20", "message": "remove sandbox_id column", "committedDate": "2020-07-09T18:16:03Z", "type": "commit"}, {"oid": "32d482d2819c20a3da2a7fe33dc418da0aef0eb0", "url": "https://github.com/CMSgov/dpc-app/commit/32d482d2819c20a3da2a7fe33dc418da0aef0eb0", "message": "Enable and disable functionality added\n\nEnabled column added to registered organization table\nenable_or_disable route added", "committedDate": "2020-07-16T12:35:49Z", "type": "commit"}, {"oid": "5fdb5585c74dd7496b7a238e0759cbf199151d94", "url": "https://github.com/CMSgov/dpc-app/commit/5fdb5585c74dd7496b7a238e0759cbf199151d94", "message": "Update views", "committedDate": "2020-07-16T14:05:34Z", "type": "commit"}, {"oid": "de0720560210849f053424415f612001a4e7e117", "url": "https://github.com/CMSgov/dpc-app/commit/de0720560210849f053424415f612001a4e7e117", "message": "remove delete org in api function", "committedDate": "2020-07-16T14:07:23Z", "type": "commit"}, {"oid": "0b8d70a7893c257826428c3e79d6d38798425234", "url": "https://github.com/CMSgov/dpc-app/commit/0b8d70a7893c257826428c3e79d6d38798425234", "message": "Remove delete api organization tests", "committedDate": "2020-07-16T17:35:51Z", "type": "commit"}, {"oid": "5010cc25adaf06b173ee3ee53ba73226e6de2c67", "url": "https://github.com/CMSgov/dpc-app/commit/5010cc25adaf06b173ee3ee53ba73226e6de2c67", "message": "merge branch dpc 505", "committedDate": "2020-07-16T17:36:33Z", "type": "commit"}, {"oid": "1a64d0deee2d1a14e45d6e0ab54557b496a4cac0", "url": "https://github.com/CMSgov/dpc-app/commit/1a64d0deee2d1a14e45d6e0ab54557b496a4cac0", "message": "schema", "committedDate": "2020-07-16T17:37:32Z", "type": "commit"}, {"oid": "0813e41e7f5a814c945c0d757cd3b9654b182ec1", "url": "https://github.com/CMSgov/dpc-app/commit/0813e41e7f5a814c945c0d757cd3b9654b182ec1", "message": "Spec progress", "committedDate": "2020-07-16T18:56:28Z", "type": "commit"}, {"oid": "a8eb4aca492eab378ab626fb2b9777f8d9c10fd9", "url": "https://github.com/CMSgov/dpc-app/commit/a8eb4aca492eab378ab626fb2b9777f8d9c10fd9", "message": "Tests finished", "committedDate": "2020-07-16T20:40:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ2MjQ2OQ==", "url": "https://github.com/CMSgov/dpc-app/pull/914#discussion_r456462469", "bodyText": "Line is too long. [131/120]", "author": "codeclimate", "createdAt": "2020-07-17T14:02:50Z", "path": "dpc-web/app/models/organization.rb", "diffHunk": "@@ -25,9 +25,9 @@ class Organization < ApplicationRecord\n \n   scope :provider, -> { where.not(organization_type: ORGANIZATION_TYPES['health_it_vendor']) }\n \n-  scope :is_registered, -> { where('id IN(SELECT DISTINCT(organization_id) FROM registered_organizations)') }\n+  scope :is_registered, -> { where('id IN(SELECT DISTINCT(organization_id) FROM registered_organizations WHERE enabled IS true)') }", "originalCommit": "a8eb4aca492eab378ab626fb2b9777f8d9c10fd9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ2MjQ3Mw==", "url": "https://github.com/CMSgov/dpc-app/pull/914#discussion_r456462473", "bodyText": "Line is too long. [139/120]", "author": "codeclimate", "createdAt": "2020-07-17T14:02:50Z", "path": "dpc-web/app/models/organization.rb", "diffHunk": "@@ -25,9 +25,9 @@ class Organization < ApplicationRecord\n \n   scope :provider, -> { where.not(organization_type: ORGANIZATION_TYPES['health_it_vendor']) }\n \n-  scope :is_registered, -> { where('id IN(SELECT DISTINCT(organization_id) FROM registered_organizations)') }\n+  scope :is_registered, -> { where('id IN(SELECT DISTINCT(organization_id) FROM registered_organizations WHERE enabled IS true)') }\n \n-  scope :is_not_registered, -> { where('id NOT IN(SELECT DISTINCT(organization_id) FROM registered_organizations)') }\n+  scope :is_not_registered, -> { where('id IN(SELECT DISTINCT(organization_id) FROM registered_organizations WHERE enabled IS NOT true)') }", "originalCommit": "a8eb4aca492eab378ab626fb2b9777f8d9c10fd9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ2MjQ3OQ==", "url": "https://github.com/CMSgov/dpc-app/pull/914#discussion_r456462479", "bodyText": "Inconsistent indentation detected.", "author": "codeclimate", "createdAt": "2020-07-17T14:02:50Z", "path": "dpc-web/app/controllers/internal/registered_organizations_controller.rb", "diffHunk": "@@ -60,6 +61,25 @@ def destroy\n       redirect_to internal_organization_path(@organization)\n     end\n \n+    def enable_or_disable\n+      @organization = Organization.find(org_id_param)\n+      @reg_org = @organization.registered_organization\n+\n+      if @reg_org.enabled == true\n+        @reg_org.enabled = false\n+        @reg_org.save\n+\n+        flash[:notice] = 'API access disabled.'\n+        redirect_to internal_organization_path(@organization)\n+      else @reg_org.enabled == false\n+        @reg_org.enabled = true", "originalCommit": "a8eb4aca492eab378ab626fb2b9777f8d9c10fd9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ2MjQ4Mg==", "url": "https://github.com/CMSgov/dpc-app/pull/914#discussion_r456462482", "bodyText": "Inconsistent indentation detected.", "author": "codeclimate", "createdAt": "2020-07-17T14:02:50Z", "path": "dpc-web/app/controllers/internal/registered_organizations_controller.rb", "diffHunk": "@@ -60,6 +61,25 @@ def destroy\n       redirect_to internal_organization_path(@organization)\n     end\n \n+    def enable_or_disable\n+      @organization = Organization.find(org_id_param)\n+      @reg_org = @organization.registered_organization\n+\n+      if @reg_org.enabled == true\n+        @reg_org.enabled = false\n+        @reg_org.save\n+\n+        flash[:notice] = 'API access disabled.'\n+        redirect_to internal_organization_path(@organization)\n+      else @reg_org.enabled == false\n+        @reg_org.enabled = true\n+        @reg_org.save", "originalCommit": "a8eb4aca492eab378ab626fb2b9777f8d9c10fd9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ2MjQ4Nw==", "url": "https://github.com/CMSgov/dpc-app/pull/914#discussion_r456462487", "bodyText": "Inconsistent indentation detected.", "author": "codeclimate", "createdAt": "2020-07-17T14:02:50Z", "path": "dpc-web/app/controllers/internal/registered_organizations_controller.rb", "diffHunk": "@@ -60,6 +61,25 @@ def destroy\n       redirect_to internal_organization_path(@organization)\n     end\n \n+    def enable_or_disable\n+      @organization = Organization.find(org_id_param)\n+      @reg_org = @organization.registered_organization\n+\n+      if @reg_org.enabled == true\n+        @reg_org.enabled = false\n+        @reg_org.save\n+\n+        flash[:notice] = 'API access disabled.'\n+        redirect_to internal_organization_path(@organization)\n+      else @reg_org.enabled == false\n+        @reg_org.enabled = true\n+        @reg_org.save\n+\n+        flash[:notice] = 'API access enabled.'", "originalCommit": "a8eb4aca492eab378ab626fb2b9777f8d9c10fd9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ab5e246baf2474be29d35398d9b0cd522d020bca", "url": "https://github.com/CMSgov/dpc-app/commit/ab5e246baf2474be29d35398d9b0cd522d020bca", "message": "Remove API columns from organization", "committedDate": "2020-07-17T14:04:33Z", "type": "commit"}, {"oid": "2211abcbd1abfdeec944564f6842b535570efcff", "url": "https://github.com/CMSgov/dpc-app/commit/2211abcbd1abfdeec944564f6842b535570efcff", "message": "Merge branch 'master' into nicole/dpc-318-enable-disable", "committedDate": "2020-07-17T14:05:42Z", "type": "commit"}, {"oid": "1c2a5b95552e676cee19119e73934e479921ae43", "url": "https://github.com/CMSgov/dpc-app/commit/1c2a5b95552e676cee19119e73934e479921ae43", "message": "Code climate fixes", "committedDate": "2020-07-17T14:26:24Z", "type": "commit"}, {"oid": "f844f46c54a3772592176103b014a05e8aef75b7", "url": "https://github.com/CMSgov/dpc-app/commit/f844f46c54a3772592176103b014a05e8aef75b7", "message": "Merge branch 'nicole/dpc-318-enable-disable' of github.com:CMSgov/dpc-app into nicole/dpc-318-enable-disable", "committedDate": "2020-07-17T14:26:32Z", "type": "commit"}, {"oid": "7c22460ff5b712a0aea7333ff4adb4fccc9e8a53", "url": "https://github.com/CMSgov/dpc-app/commit/7c22460ff5b712a0aea7333ff4adb4fccc9e8a53", "message": "Fix org controller code climate", "committedDate": "2020-07-17T14:29:55Z", "type": "commit"}, {"oid": "a0f4588c734e4821d066419bca2dfbd787dec8fc", "url": "https://github.com/CMSgov/dpc-app/commit/a0f4588c734e4821d066419bca2dfbd787dec8fc", "message": "External users cannot add public keys/create client tokens unless org enabled", "committedDate": "2020-07-17T19:29:55Z", "type": "commit"}, {"oid": "72be31dcda1a09da24afa199fb0cc7403ca99d37", "url": "https://github.com/CMSgov/dpc-app/commit/72be31dcda1a09da24afa199fb0cc7403ca99d37", "message": "Merge branch 'master' into nicole/dpc-318-enable-disable", "committedDate": "2020-07-20T12:12:17Z", "type": "commit"}, {"oid": "b1d73dd0e44044eefc1043b595c05ddb44cc76ae", "url": "https://github.com/CMSgov/dpc-app/commit/b1d73dd0e44044eefc1043b595c05ddb44cc76ae", "message": "remove migration", "committedDate": "2020-07-20T13:48:58Z", "type": "commit"}, {"oid": "cd4476a3c9a9fe22074965b178f549122915d404", "url": "https://github.com/CMSgov/dpc-app/commit/cd4476a3c9a9fe22074965b178f549122915d404", "message": "Update migration", "committedDate": "2020-07-20T17:27:40Z", "type": "commit"}, {"oid": "3438465cd233c193cb877987a539e70d314ded99", "url": "https://github.com/CMSgov/dpc-app/commit/3438465cd233c193cb877987a539e70d314ded99", "message": "Migration update: default enabled to true", "committedDate": "2020-07-20T17:49:42Z", "type": "commit"}, {"oid": "957f73992f3c09557218ee3311c0455450198d59", "url": "https://github.com/CMSgov/dpc-app/commit/957f73992f3c09557218ee3311c0455450198d59", "message": "Registered Enabled update", "committedDate": "2020-07-20T19:48:16Z", "type": "commit"}, {"oid": "40f24197b7c880337dacbcea798a4973d07da16c", "url": "https://github.com/CMSgov/dpc-app/commit/40f24197b7c880337dacbcea798a4973d07da16c", "message": "Final migration", "committedDate": "2020-07-20T19:51:38Z", "type": "commit"}, {"oid": "945b4941d6a711553967aa9ccfaf971198b7456f", "url": "https://github.com/CMSgov/dpc-app/commit/945b4941d6a711553967aa9ccfaf971198b7456f", "message": "Final final migration", "committedDate": "2020-07-20T20:51:35Z", "type": "commit"}, {"oid": "e4feb170b06dcb4956aa132b8dfff4126b5f2f1f", "url": "https://github.com/CMSgov/dpc-app/commit/e4feb170b06dcb4956aa132b8dfff4126b5f2f1f", "message": "Merge branch 'master' into nicole/dpc-318-enable-disable", "committedDate": "2020-07-21T13:23:02Z", "type": "commit"}]}