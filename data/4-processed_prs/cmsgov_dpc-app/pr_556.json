{"pr_number": 556, "pr_title": "DPC-248: Enable distributed tracing", "pr_createdAt": "2020-01-22T20:57:17Z", "pr_url": "https://github.com/CMSgov/dpc-app/pull/556", "timeline": [{"oid": "04ca5c7573d2a4aca9b077f85483f797e29aa961", "url": "https://github.com/CMSgov/dpc-app/commit/04ca5c7573d2a4aca9b077f85483f797e29aa961", "message": "DPC-248: Enable distributed tracing\n\nUpdate the newrelic.yml file to enable distributed tracing.", "committedDate": "2020-01-22T16:15:28Z", "type": "commit"}, {"oid": "ebcc9f6e5bd76011603fd22090435152a3816341", "url": "https://github.com/CMSgov/dpc-app/commit/ebcc9f6e5bd76011603fd22090435152a3816341", "message": "DPC-248: Disable cross app tracing and enable trace logging\n\nTry to make things more verbose, as well as disable cross application tracing", "committedDate": "2020-01-22T18:00:24Z", "type": "commit"}, {"oid": "2108a1c376f12b4eec6d9d4de7e1c48a1d0b999f", "url": "https://github.com/CMSgov/dpc-app/commit/2108a1c376f12b4eec6d9d4de7e1c48a1d0b999f", "message": "DPC-248: Debug logging only for http headers", "committedDate": "2020-01-22T19:01:28Z", "type": "commit"}, {"oid": "6a689cdc84098d3619fb97b17580c199cecbba32", "url": "https://github.com/CMSgov/dpc-app/commit/6a689cdc84098d3619fb97b17580c199cecbba32", "message": "DPC-248: Temporarily disable circuit breakers.", "committedDate": "2020-01-22T19:02:06Z", "type": "commit"}, {"oid": "83cad6b932f6675adabbfd88ff87e8d6148d1d2c", "url": "https://github.com/CMSgov/dpc-app/commit/83cad6b932f6675adabbfd88ff87e8d6148d1d2c", "message": "DPC-248: Enable distributed tracing for website.\n\nRe-enable circuit breaker, but increase the GC limit to so that it doesn't die on us.", "committedDate": "2020-01-22T20:41:54Z", "type": "commit"}, {"oid": "1e8ebce0db09739ac86abc6dbb481b12dd7a4790", "url": "https://github.com/CMSgov/dpc-app/commit/1e8ebce0db09739ac86abc6dbb481b12dd7a4790", "message": "DPC-248: Add manual trace transaction to aggregation service\n\nUpdated the aggregation engine to manually trace aggregation jobs.\n\nNot sure which level of granularity we need right now, but this should be a good start.", "committedDate": "2020-01-22T20:55:53Z", "type": "commit"}, {"oid": "78ed8070c09aed79187dd2313add1fc548116b75", "url": "https://github.com/CMSgov/dpc-app/commit/78ed8070c09aed79187dd2313add1fc548116b75", "message": "Merge branch 'master' into nickrobison/DPC-248-distributed-tracing", "committedDate": "2020-01-23T12:57:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE0ODg5OQ==", "url": "https://github.com/CMSgov/dpc-app/pull/556#discussion_r370148899", "bodyText": "Is this duplicative of the dependency defined above it? I see this definition lacks the version attribute.", "author": "rnagle", "createdAt": "2020-01-23T14:28:39Z", "path": "dpc-aggregation/pom.xml", "diffHunk": "@@ -120,6 +120,11 @@\n             <version>${newrelic.agent.version}</version>\n             <type>${newrelic.agent.type}</type>\n         </dependency>\n+        <dependency>", "originalCommit": "78ed8070c09aed79187dd2313add1fc548116b75", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIxOTYzNQ==", "url": "https://github.com/CMSgov/dpc-app/pull/556#discussion_r370219635", "bodyText": "It's not, we need to specify the API as a compile time dependency, otherwise the Tracing annotation isn't found, as the ZIP file is only available at runtime.", "author": "nickrobison-usds", "createdAt": "2020-01-23T16:23:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE0ODg5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE1MzMzOA==", "url": "https://github.com/CMSgov/dpc-app/pull/556#discussion_r370153338", "bodyText": "Curious -- how did you arrive at this threshold? Wondering how overhead of tracing will interact with the ASG scaling policies. No objection, no blocker here, just thinking out loud.", "author": "rnagle", "createdAt": "2020-01-23T14:36:10Z", "path": "src/main/resources/newrelic.yml", "diffHunk": "@@ -9,6 +9,8 @@ common: &default_settings\n   log_limit_in_kbytes: 0\n   log_daily: false\n   log_file_name: STDOUT\n+  circuit_breaker:\n+    gc_cpu_threshold: 30", "originalCommit": "78ed8070c09aed79187dd2313add1fc548116b75", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIyMjk4OQ==", "url": "https://github.com/CMSgov/dpc-app/pull/556#discussion_r370222989", "bodyText": "In the new relic log files, on dev, the circuit breaker was tripping at 22% GC CPU usage, so I bumped it to 30 to avoid disabling it entirely. I don't think it will interact with the ASG policies as this simply disables tracing at a much lower limit than what would trigger an auto-scale. My goal was to set it at a low threshold and then monitor for any additional tripping. Does that make sense?", "author": "nickrobison-usds", "createdAt": "2020-01-23T16:28:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE1MzMzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI0MTIyNQ==", "url": "https://github.com/CMSgov/dpc-app/pull/556#discussion_r370241225", "bodyText": "Definitely. \ud83d\udc4d", "author": "rnagle", "createdAt": "2020-01-23T17:00:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE1MzMzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE1NDU5OA==", "url": "https://github.com/CMSgov/dpc-app/pull/556#discussion_r370154598", "bodyText": "How necessary is this? Have you checked that this does not inadvertently result in logging of sensitive information?", "author": "rnagle", "createdAt": "2020-01-23T14:38:16Z", "path": "src/main/resources/server.conf", "diffHunk": "@@ -53,6 +53,7 @@ logging {\n   }]\n   loggers = {\n     \"liquibase\" = WARN\n+      \"org.apache.http.headers\" = DEBUG", "originalCommit": "78ed8070c09aed79187dd2313add1fc548116b75", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f98b697001398ed85a7e9293f7619dd46afacec2", "url": "https://github.com/CMSgov/dpc-app/commit/f98b697001398ed85a7e9293f7619dd46afacec2", "message": "DPC-248: Remove debug logging of HTTP headers\n\nIn order to avoid leaking PII into the logs, I'm removing the debug header output. We may want to re-enable this in the future, in order to get some additional visibility into the intra-DPC service traffic.", "committedDate": "2020-01-23T16:27:46Z", "type": "commit"}, {"oid": "2787640d2f2c4c3ec1fd629528b7f26ad1c44de7", "url": "https://github.com/CMSgov/dpc-app/commit/2787640d2f2c4c3ec1fd629528b7f26ad1c44de7", "message": "Merge branch 'master' into nickrobison/DPC-248-distributed-tracing", "committedDate": "2020-01-23T16:27:54Z", "type": "commit"}]}