{"pr_number": 954, "pr_title": "DPC-234: Delete client tokens from web app", "pr_createdAt": "2020-08-05T16:32:19Z", "pr_url": "https://github.com/CMSgov/dpc-app/pull/954", "timeline": [{"oid": "874713465428f1cdeb253bbb5cc2a4f97b5acbe0", "url": "https://github.com/CMSgov/dpc-app/commit/874713465428f1cdeb253bbb5cc2a4f97b5acbe0", "message": "Init", "committedDate": "2020-08-03T15:04:12Z", "type": "commit"}, {"oid": "83df8b6796737391604fdae50367eb408c38870e", "url": "https://github.com/CMSgov/dpc-app/commit/83df8b6796737391604fdae50367eb408c38870e", "message": "Client token delete function complete", "committedDate": "2020-08-03T19:17:09Z", "type": "commit"}, {"oid": "b805e9eb523d509ba3015b5048ddda82334fe339", "url": "https://github.com/CMSgov/dpc-app/commit/b805e9eb523d509ba3015b5048ddda82334fe339", "message": "Styling progress", "committedDate": "2020-08-04T14:35:02Z", "type": "commit"}, {"oid": "8f5dfbab3c467b5c0967c7e4b12c936cdff8293a", "url": "https://github.com/CMSgov/dpc-app/commit/8f5dfbab3c467b5c0967c7e4b12c936cdff8293a", "message": "Styling progress", "committedDate": "2020-08-04T15:14:26Z", "type": "commit"}, {"oid": "589109d8f66e65fe0f740a046aba23c1c10561a6", "url": "https://github.com/CMSgov/dpc-app/commit/589109d8f66e65fe0f740a046aba23c1c10561a6", "message": "Styling progress", "committedDate": "2020-08-04T19:41:46Z", "type": "commit"}, {"oid": "ee3c64b06c2a54d864664752488fc540362e0c47", "url": "https://github.com/CMSgov/dpc-app/commit/ee3c64b06c2a54d864664752488fc540362e0c47", "message": "Up arrow", "committedDate": "2020-08-04T19:42:16Z", "type": "commit"}, {"oid": "80af66ec53fcb2830ec3c41f80f9b96f0244c16e", "url": "https://github.com/CMSgov/dpc-app/commit/80af66ec53fcb2830ec3c41f80f9b96f0244c16e", "message": "Styling progress", "committedDate": "2020-08-04T19:59:24Z", "type": "commit"}, {"oid": "2450fb80bf9814f2ada5f44aff56aa364484340b", "url": "https://github.com/CMSgov/dpc-app/commit/2450fb80bf9814f2ada5f44aff56aa364484340b", "message": "Styling fix/progress", "committedDate": "2020-08-05T13:57:22Z", "type": "commit"}, {"oid": "31f7cb1153f384079f6d896c77eb2083bbfc787c", "url": "https://github.com/CMSgov/dpc-app/commit/31f7cb1153f384079f6d896c77eb2083bbfc787c", "message": "Rever styling", "committedDate": "2020-08-05T14:11:59Z", "type": "commit"}, {"oid": "6882f9a3097b3364824a6a181bd0ec34f5380de1", "url": "https://github.com/CMSgov/dpc-app/commit/6882f9a3097b3364824a6a181bd0ec34f5380de1", "message": "Reverting", "committedDate": "2020-08-05T14:12:59Z", "type": "commit"}, {"oid": "219954e9336e69c36e0f407a10f4c57ec20d160b", "url": "https://github.com/CMSgov/dpc-app/commit/219954e9336e69c36e0f407a10f4c57ec20d160b", "message": "Styling progress after revert", "committedDate": "2020-08-05T14:29:42Z", "type": "commit"}, {"oid": "3574c10b7eaaba459b737a58cca9195897e1a87b", "url": "https://github.com/CMSgov/dpc-app/commit/3574c10b7eaaba459b737a58cca9195897e1a87b", "message": "Cancel button functionality", "committedDate": "2020-08-05T15:09:46Z", "type": "commit"}, {"oid": "23fa06ded8d8c6c49cb53910d8da0ff9001cbbcf", "url": "https://github.com/CMSgov/dpc-app/commit/23fa06ded8d8c6c49cb53910d8da0ff9001cbbcf", "message": "Styling fin", "committedDate": "2020-08-05T16:24:48Z", "type": "commit"}, {"oid": "402a7710dbe3e15262aedd3540ab895e51c10e6d", "url": "https://github.com/CMSgov/dpc-app/commit/402a7710dbe3e15262aedd3540ab895e51c10e6d", "message": "Collapse delete button", "committedDate": "2020-08-05T16:25:33Z", "type": "commit"}, {"oid": "2b57a94218f7ce9823d361c402dc82827109e1dc", "url": "https://github.com/CMSgov/dpc-app/commit/2b57a94218f7ce9823d361c402dc82827109e1dc", "message": "Remove spec", "committedDate": "2020-08-05T16:31:24Z", "type": "commit"}, {"oid": "359faf0c8bdf5bc33c45f0fd0bebcff7f7ba8158", "url": "https://github.com/CMSgov/dpc-app/commit/359faf0c8bdf5bc33c45f0fd0bebcff7f7ba8158", "message": "Merge branch 'master' into nicole/dpc-234-delete-tokens", "committedDate": "2020-08-05T16:33:46Z", "type": "commit"}, {"oid": "fa36ad2c7e6663d31fffdedbafcb56a271bb720c", "url": "https://github.com/CMSgov/dpc-app/commit/fa36ad2c7e6663d31fffdedbafcb56a271bb720c", "message": "Code climate", "committedDate": "2020-08-05T16:37:13Z", "type": "commit"}, {"oid": "d4aa556b8cc7522b74feb91a000e6c1cc79ee900", "url": "https://github.com/CMSgov/dpc-app/commit/d4aa556b8cc7522b74feb91a000e6c1cc79ee900", "message": "Merge branch 'nicole/dpc-234-delete-tokens' of github.com:CMSgov/dpc-app into nicole/dpc-234-delete-tokens", "committedDate": "2020-08-05T16:37:19Z", "type": "commit"}, {"oid": "22e44c02d50dc8e73c3e438a8d935186003ca242", "url": "https://github.com/CMSgov/dpc-app/commit/22e44c02d50dc8e73c3e438a8d935186003ca242", "message": "Delete angle-arrow-up.svg", "committedDate": "2020-08-05T16:39:23Z", "type": "commit"}, {"oid": "a633d0ee00d4efdf9e5b78a0700d6d7b2356d18e", "url": "https://github.com/CMSgov/dpc-app/commit/a633d0ee00d4efdf9e5b78a0700d6d7b2356d18e", "message": "Small fix", "committedDate": "2020-08-05T17:23:42Z", "type": "commit"}, {"oid": "db83f70d9399b305a659f574226bfdcf37d996fb", "url": "https://github.com/CMSgov/dpc-app/commit/db83f70d9399b305a659f574226bfdcf37d996fb", "message": "Merging", "committedDate": "2020-08-05T17:24:12Z", "type": "commit"}, {"oid": "9d5208c49c52fe83b8d8fa80498d4c9ca2f1653c", "url": "https://github.com/CMSgov/dpc-app/commit/9d5208c49c52fe83b8d8fa80498d4c9ca2f1653c", "message": "Code Climate", "committedDate": "2020-08-05T17:29:56Z", "type": "commit"}, {"oid": "2cd42e9976683c0c885bf6c38bba16e705bfc505", "url": "https://github.com/CMSgov/dpc-app/commit/2cd42e9976683c0c885bf6c38bba16e705bfc505", "message": "Merge branch 'master' into nicole/dpc-234-delete-tokens", "committedDate": "2020-08-06T12:30:11Z", "type": "commit"}, {"oid": "0e0fae80e2c594695608c64f3d73945bb5445820", "url": "https://github.com/CMSgov/dpc-app/commit/0e0fae80e2c594695608c64f3d73945bb5445820", "message": "Password gui quick fix", "committedDate": "2020-08-06T12:58:07Z", "type": "commit"}, {"oid": "90dcb1255c831f9712d6509561c548f94783e691", "url": "https://github.com/CMSgov/dpc-app/commit/90dcb1255c831f9712d6509561c548f94783e691", "message": "Test", "committedDate": "2020-08-12T20:07:22Z", "type": "commit"}, {"oid": "65f208b863f19776977a0d5d9d752e5e4e733842", "url": "https://github.com/CMSgov/dpc-app/commit/65f208b863f19776977a0d5d9d752e5e4e733842", "message": "Changed successful token deletion response from 200 to 204.", "committedDate": "2020-08-12T22:17:23Z", "type": "commit"}, {"oid": "9f0be82af5d06be2ea7fa83e7c6d225605a5b9b5", "url": "https://github.com/CMSgov/dpc-app/commit/9f0be82af5d06be2ea7fa83e7c6d225605a5b9b5", "message": "Merge branch 'master' into sg/DPC-588-update-token-delete-response", "committedDate": "2020-08-12T23:07:44Z", "type": "commit"}, {"oid": "a9dc6777461febdad3b5d76c3523df36d7e6cd7e", "url": "https://github.com/CMSgov/dpc-app/commit/a9dc6777461febdad3b5d76c3523df36d7e6cd7e", "message": "Merge branch 'master' into nicole/dpc-234-delete-tokens", "committedDate": "2020-08-13T12:54:49Z", "type": "commit"}, {"oid": "2fd4832cc2257e077a41b469a0665ff640d58dfc", "url": "https://github.com/CMSgov/dpc-app/commit/2fd4832cc2257e077a41b469a0665ff640d58dfc", "message": "Merge branch 'nicole/dpc-234-delete-tokens' of github.com:CMSgov/dpc-app into nicole/dpc-234-delete-tokens", "committedDate": "2020-08-13T13:51:53Z", "type": "commit"}, {"oid": "1fbd6739bec0875981ca3849a309c92efb7dc629", "url": "https://github.com/CMSgov/dpc-app/commit/1fbd6739bec0875981ca3849a309c92efb7dc629", "message": "Merge branch 'sg/DPC-588-update-token-delete-response' into nicole/dpc-234-delete-tokens", "committedDate": "2020-08-13T13:52:02Z", "type": "commit"}, {"oid": "d79f49c1242677560ff0ee01581c7f4c4bc63181", "url": "https://github.com/CMSgov/dpc-app/commit/d79f49c1242677560ff0ee01581c7f4c4bc63181", "message": "Merge branch 'master' into nicole/dpc-234-delete-tokens", "committedDate": "2020-08-13T13:52:39Z", "type": "commit"}, {"oid": "53973d4407b070ff9d4291f71b5c5dd122a16021", "url": "https://github.com/CMSgov/dpc-app/commit/53973d4407b070ff9d4291f71b5c5dd122a16021", "message": "Merge branch 'nicole/dpc-234-delete-tokens' of github.com:CMSgov/dpc-app into nicole/dpc-234-delete-tokens", "committedDate": "2020-08-13T13:52:47Z", "type": "commit"}, {"oid": "0644313ef60129ba4dc2b0d22d0d4fecf84b2a9b", "url": "https://github.com/CMSgov/dpc-app/commit/0644313ef60129ba4dc2b0d22d0d4fecf84b2a9b", "message": "Test revert", "committedDate": "2020-08-13T13:53:27Z", "type": "commit"}, {"oid": "2acb5e0e83e69e33097a36f939e2f99b7d1fdc70", "url": "https://github.com/CMSgov/dpc-app/commit/2acb5e0e83e69e33097a36f939e2f99b7d1fdc70", "message": "Update to accept new API repsonse for deleted token\n\nUpdate app to look for and accept 204 successful response for deleting token", "committedDate": "2020-08-13T15:35:57Z", "type": "commit"}, {"oid": "956bdd3d825d3a063dd13e4830c886d2690f09bb", "url": "https://github.com/CMSgov/dpc-app/commit/956bdd3d825d3a063dd13e4830c886d2690f09bb", "message": "Test work", "committedDate": "2020-08-13T17:50:21Z", "type": "commit"}, {"oid": "f5c6c170f2f900bcb4b37a59b15eac83d37bf24c", "url": "https://github.com/CMSgov/dpc-app/commit/f5c6c170f2f900bcb4b37a59b15eac83d37bf24c", "message": "Fix response_successful check in api client", "committedDate": "2020-08-13T18:25:44Z", "type": "commit"}, {"oid": "25d56161efc29403f80e3032dead4be8b9c2eaf1", "url": "https://github.com/CMSgov/dpc-app/commit/25d56161efc29403f80e3032dead4be8b9c2eaf1", "message": "revert test changes", "committedDate": "2020-08-13T18:25:56Z", "type": "commit"}, {"oid": "f64296c6a909eb4e93630aebd5e52ebd118c19c9", "url": "https://github.com/CMSgov/dpc-app/commit/f64296c6a909eb4e93630aebd5e52ebd118c19c9", "message": "Merge branch 'master' into nicole/dpc-234-delete-tokens", "committedDate": "2020-08-13T18:36:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE3ODg5Mw==", "url": "https://github.com/CMSgov/dpc-app/pull/954#discussion_r470178893", "bodyText": "Good.  Better would be to allow anything in the 20x range--201 and 202 are likely to be used, for instance.", "author": "dhgreene", "createdAt": "2020-08-13T18:57:26Z", "path": "dpc-web/app/services/api_client.rb", "diffHunk": "@@ -71,7 +77,7 @@ def get_public_keys(reg_org_api_id)\n   end\n \n   def response_successful?\n-    @response_status == 200\n+    [200, 204].include? @response_status", "originalCommit": "f64296c6a909eb4e93630aebd5e52ebd118c19c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE3OTk5NA==", "url": "https://github.com/CMSgov/dpc-app/pull/954#discussion_r470179994", "bodyText": "@SMLuthi", "author": "Sun-Mountain", "createdAt": "2020-08-13T18:59:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE3ODg5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI4NDI3OQ==", "url": "https://github.com/CMSgov/dpc-app/pull/954#discussion_r470284279", "bodyText": "@dhgreene @Sun-Mountain in that case we can do something like (200..299).include? @response_status which checks over a range", "author": "SMLuthi", "createdAt": "2020-08-13T22:30:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE3ODg5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE3OTQzMg==", "url": "https://github.com/CMSgov/dpc-app/pull/954#discussion_r470179432", "bodyText": "Does this need to be a call to response_successful? instead?", "author": "dhgreene", "createdAt": "2020-08-13T18:58:16Z", "path": "dpc-web/app/services/api_client.rb", "diffHunk": "@@ -97,9 +103,18 @@ def golden_macaroon\n   end\n \n   def parsed_response(response)\n+    return self if response.body.nil? && @response_status == 204", "originalCommit": "f64296c6a909eb4e93630aebd5e52ebd118c19c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "81137faaf1551ec5fe4edb4a2ffe0d9e3cc9dd4c", "url": "https://github.com/CMSgov/dpc-app/commit/81137faaf1551ec5fe4edb4a2ffe0d9e3cc9dd4c", "message": "Change nil to blank call for checking response body", "committedDate": "2020-08-13T19:22:10Z", "type": "commit"}, {"oid": "95b7e8cbd9992c81c8c4fc5a788bd3ea99b3355e", "url": "https://github.com/CMSgov/dpc-app/commit/95b7e8cbd9992c81c8c4fc5a788bd3ea99b3355e", "message": "Merge branch 'nicole/dpc-234-delete-tokens' of github.com:CMSgov/dpc-app into nicole/dpc-234-delete-tokens", "committedDate": "2020-08-13T19:22:26Z", "type": "commit"}, {"oid": "112c2e331f94d284b6593afca2eabf8eeb91d968", "url": "https://github.com/CMSgov/dpc-app/commit/112c2e331f94d284b6593afca2eabf8eeb91d968", "message": "Merging", "committedDate": "2020-08-14T14:43:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY4MzAyMA==", "url": "https://github.com/CMSgov/dpc-app/pull/954#discussion_r470683020", "bodyText": "Use Range#cover? instead of Range#include?.", "author": "codeclimate", "createdAt": "2020-08-14T15:07:21Z", "path": "dpc-web/app/services/api_client.rb", "diffHunk": "@@ -71,7 +77,7 @@ def get_public_keys(reg_org_api_id)\n   end\n \n   def response_successful?\n-    @response_status == 200\n+    (200...299).include? @response_status", "originalCommit": "112c2e331f94d284b6593afca2eabf8eeb91d968", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cb449b6c111c4fcf81036e1ae70f142635f406de", "url": "https://github.com/CMSgov/dpc-app/commit/cb449b6c111c4fcf81036e1ae70f142635f406de", "message": "Test fix", "committedDate": "2020-08-14T16:49:06Z", "type": "commit"}, {"oid": "3083720a01d89083969df7daa5066bd33d5bc45b", "url": "https://github.com/CMSgov/dpc-app/commit/3083720a01d89083969df7daa5066bd33d5bc45b", "message": "Code Climate Check", "committedDate": "2020-08-14T16:54:40Z", "type": "commit"}, {"oid": "41eb097a4fa577808a2de260bb95832d100684e0", "url": "https://github.com/CMSgov/dpc-app/commit/41eb097a4fa577808a2de260bb95832d100684e0", "message": "Merge branch 'master' into nicole/dpc-234-delete-tokens", "committedDate": "2020-08-14T16:55:31Z", "type": "commit"}, {"oid": "f3e3c00ebc3c39ce9c3617774634fe4619a013da", "url": "https://github.com/CMSgov/dpc-app/commit/f3e3c00ebc3c39ce9c3617774634fe4619a013da", "message": "Merge branch 'master' into nicole/dpc-234-delete-tokens", "committedDate": "2020-08-14T17:39:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc3MDM5Ng==", "url": "https://github.com/CMSgov/dpc-app/pull/954#discussion_r470770396", "bodyText": "Would this be a little cleaner?\nreturn render_error 'Label required.' unless params_present?\n\nif manager.create_client_token(label: params[:label])\n  @client_token = manager.client_token\n  render :show\n\nrender_error 'Client token could not be created.'", "author": "SMLuthi", "createdAt": "2020-08-14T17:53:24Z", "path": "dpc-web/app/controllers/client_tokens_controller.rb", "diffHunk": "@@ -6,42 +6,60 @@ class ClientTokensController < ApplicationController\n   rescue_from ActiveRecord::RecordNotFound, with: :unauthorized\n \n   def new\n-    @organization = current_user.organizations.find(params[:organization_id])\n+    @organization = current_user.organizations.find(org_id)\n   end\n \n   def create\n     @organization = current_user.organizations.find(params[:organization_id])\n \n     reg_org = @organization.registered_organization\n     manager = ClientTokenManager.new(registered_organization: reg_org)\n-    if missing_params\n-      render_error 'Label required.'\n-    elsif manager.create_client_token(label: params[:label])\n+\n+    if params_present? && manager.create_client_token(label: params[:label])", "originalCommit": "f3e3c00ebc3c39ce9c3617774634fe4619a013da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc3OTEyNg==", "url": "https://github.com/CMSgov/dpc-app/pull/954#discussion_r470779126", "bodyText": "The tests did not like that >_>", "author": "Sun-Mountain", "createdAt": "2020-08-14T18:11:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc3MDM5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc5MzMxNw==", "url": "https://github.com/CMSgov/dpc-app/pull/954#discussion_r470793317", "bodyText": "Hm, that shouldnt happen. I wonder if the render_errors arent being hit correctly in the way you defined them.", "author": "SMLuthi", "createdAt": "2020-08-14T18:29:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc3MDM5Ng=="}], "type": "inlineReview"}]}