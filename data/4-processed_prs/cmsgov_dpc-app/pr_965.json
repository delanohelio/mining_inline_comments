{"pr_number": 965, "pr_title": "DPC-592: Fix rails app bug from password update", "pr_createdAt": "2020-08-10T15:47:18Z", "pr_url": "https://github.com/CMSgov/dpc-app/pull/965", "timeline": [{"oid": "90186ed641f8496525124d29b8c30adbe173f3f6", "url": "https://github.com/CMSgov/dpc-app/commit/90186ed641f8496525124d29b8c30adbe173f3f6", "message": "Revert \"DPC-109: Signup Password Policy for DPC (#926)\"\n\nThis reverts commit fc5d84b4665b85307590ac2df3fd67840e4186fa.", "committedDate": "2020-08-10T15:19:15Z", "type": "commit"}, {"oid": "b6a0b4b51eb390e74a253110274424a7a4664d29", "url": "https://github.com/CMSgov/dpc-app/commit/b6a0b4b51eb390e74a253110274424a7a4664d29", "message": "Fix registrations accordion", "committedDate": "2020-08-10T15:35:17Z", "type": "commit"}, {"oid": "d2786388c4e07b526a655b38cb3cad2a2d63ffc7", "url": "https://github.com/CMSgov/dpc-app/commit/d2786388c4e07b526a655b38cb3cad2a2d63ffc7", "message": "Init", "committedDate": "2020-08-10T15:45:46Z", "type": "commit"}, {"oid": "374b2dbc748fb8a580e1fa7a979810b2add3f5e6", "url": "https://github.com/CMSgov/dpc-app/commit/374b2dbc748fb8a580e1fa7a979810b2add3f5e6", "message": "Devise security gem added", "committedDate": "2020-08-10T16:12:01Z", "type": "commit"}, {"oid": "c68760a276676598d04cb1b700353a7c4670b293", "url": "https://github.com/CMSgov/dpc-app/commit/c68760a276676598d04cb1b700353a7c4670b293", "message": "Devise security set up", "committedDate": "2020-08-10T16:24:55Z", "type": "commit"}, {"oid": "2de9854867289457d5bb7f6c8c4ce919f1e4450a", "url": "https://github.com/CMSgov/dpc-app/commit/2de9854867289457d5bb7f6c8c4ce919f1e4450a", "message": "Updating user spec", "committedDate": "2020-08-10T17:54:13Z", "type": "commit"}, {"oid": "0d09a4eeba935453408cae632371dc6586700588", "url": "https://github.com/CMSgov/dpc-app/commit/0d09a4eeba935453408cae632371dc6586700588", "message": "User managment spec fixed", "committedDate": "2020-08-10T17:56:26Z", "type": "commit"}, {"oid": "9640028b740be493ffc44013ebbb912ddb235bb9", "url": "https://github.com/CMSgov/dpc-app/commit/9640028b740be493ffc44013ebbb912ddb235bb9", "message": "Javascript complete", "committedDate": "2020-08-10T19:11:31Z", "type": "commit"}, {"oid": "7ad1b959cdf086cc1861475c53d9f501abd0582c", "url": "https://github.com/CMSgov/dpc-app/commit/7ad1b959cdf086cc1861475c53d9f501abd0582c", "message": "GUI", "committedDate": "2020-08-10T19:15:21Z", "type": "commit"}, {"oid": "699dc0a5766cb707bd827b4fb8cad5fbc26d301f", "url": "https://github.com/CMSgov/dpc-app/commit/699dc0a5766cb707bd827b4fb8cad5fbc26d301f", "message": "GUI fin", "committedDate": "2020-08-10T19:32:14Z", "type": "commit"}, {"oid": "1ed26d4ebc395c9b55a7427c93fba8654f07343c", "url": "https://github.com/CMSgov/dpc-app/commit/1ed26d4ebc395c9b55a7427c93fba8654f07343c", "message": "Migrations", "committedDate": "2020-08-10T19:34:58Z", "type": "commit"}, {"oid": "951a1c984339063a989e8dc45a0e321cfdf32a25", "url": "https://github.com/CMSgov/dpc-app/commit/951a1c984339063a989e8dc45a0e321cfdf32a25", "message": "Migrations", "committedDate": "2020-08-10T19:35:48Z", "type": "commit"}, {"oid": "9c6b7d3ebd78005ee47d71491d0514a7a5cb3850", "url": "https://github.com/CMSgov/dpc-app/commit/9c6b7d3ebd78005ee47d71491d0514a7a5cb3850", "message": "Migration update", "committedDate": "2020-08-10T20:55:14Z", "type": "commit"}, {"oid": "3121e9868e0f2dcdd036634929e8bd8e848dbe14", "url": "https://github.com/CMSgov/dpc-app/commit/3121e9868e0f2dcdd036634929e8bd8e848dbe14", "message": "Update migrations", "committedDate": "2020-08-11T12:59:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTI2OTU4Nw==", "url": "https://github.com/CMSgov/dpc-app/pull/965#discussion_r469269587", "bodyText": "Having already tested for a missing parameter, should we remove the if/elsif here?", "author": "dhgreene", "createdAt": "2020-08-12T13:43:57Z", "path": "dpc-web/app/controllers/client_tokens_controller.rb", "diffHunk": "@@ -11,9 +11,11 @@ def new\n \n   def create\n     @organization = current_user.organizations.find(params[:organization_id])\n+    return render_error('Must have a label.') if missing_params\n \n     reg_org = @organization.registered_organization\n     manager = ClientTokenManager.new(registered_organization: reg_org)\n+\n     if missing_params", "originalCommit": "3121e9868e0f2dcdd036634929e8bd8e848dbe14", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTI3MTU0Mw==", "url": "https://github.com/CMSgov/dpc-app/pull/965#discussion_r469271543", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return redirect_to internal_organization_path(@organization)\n          \n          \n            \n                    redirect_to internal_organization_path(@organization)", "author": "dhgreene", "createdAt": "2020-08-12T13:46:45Z", "path": "dpc-web/app/controllers/internal/organizations_controller.rb", "diffHunk": "@@ -87,26 +89,33 @@ def add_or_delete\n       @organization = Organization.find(params[:organization_id])\n       @user = user_identify\n \n-      add_delete(params)\n+      if params[:_method] == 'add'\n+        add_user_to_org\n+      elsif params[:_method] == 'delete'\n+        delete_user_from_org\n+      else\n+        return redirect_to internal_organization_path(@organization)", "originalCommit": "3121e9868e0f2dcdd036634929e8bd8e848dbe14", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTI3NTYyMA==", "url": "https://github.com/CMSgov/dpc-app/pull/965#discussion_r469275620", "bodyText": "Just double-checking: I don't see @organizations used directly by the view or partial.  What breaks if we don't have this line?", "author": "dhgreene", "createdAt": "2020-08-12T13:52:25Z", "path": "dpc-web/app/controllers/internal/users_controller.rb", "diffHunk": "@@ -28,6 +28,7 @@ def update\n         flash[:notice] = 'User successfully updated.'\n         redirect_to internal_user_url(@user)\n       else\n+        @organizations = Organization.all", "originalCommit": "3121e9868e0f2dcdd036634929e8bd8e848dbe14", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTI4NjEyNQ==", "url": "https://github.com/CMSgov/dpc-app/pull/965#discussion_r469286125", "bodyText": "It's in the partial _org_search.html.erb with There are <%= @organizations.count %> organizations available.\nIf I delete the line in the controller, I can replace it with Organization.all.", "author": "Sun-Mountain", "createdAt": "2020-08-12T14:06:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTI3NTYyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTI3NjYxMg==", "url": "https://github.com/CMSgov/dpc-app/pull/965#discussion_r469276612", "bodyText": "The comment no longer seems true . . .", "author": "dhgreene", "createdAt": "2020-08-12T13:53:45Z", "path": "dpc-web/config/initializers/devise-security.rb", "diffHunk": "@@ -9,15 +9,15 @@\n \n   # Need 1 char of A-Z, a-z and 0-9\n   config.password_complexity = { digit: 1, lower: 1, symbol: 1, upper: 1 }\n-  \n-  # How many passwords to keep in archives\n+\n+  # How many passwords to keep in archive\n   config.password_archiving_count = 12\n-  \n+\n   # Deny old passwords (true, false, number_of_old_passwords_to_check)\n   # Examples:\n   # config.deny_old_passwords = false # allow old passwords\n   # config.deny_old_passwords = true # will deny all the old passwords\n-  config.deny_old_passwords = 12 # will deny new passwords that matches with the last 12 passwords\n+  config.deny_old_passwords = 12 # will deny new passwords that matches with the last 3 passwords", "originalCommit": "3121e9868e0f2dcdd036634929e8bd8e848dbe14", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c4af1769a27fd36ffc65f6e25254a18d93690c77", "url": "https://github.com/CMSgov/dpc-app/commit/c4af1769a27fd36ffc65f6e25254a18d93690c77", "message": "Review notes", "committedDate": "2020-08-12T14:19:14Z", "type": "commit"}, {"oid": "d6e316d40600e502010b3920049c0085cff1573b", "url": "https://github.com/CMSgov/dpc-app/commit/d6e316d40600e502010b3920049c0085cff1573b", "message": "Merge branch 'master' into nicole/dpc-592-bisect", "committedDate": "2020-08-12T14:19:58Z", "type": "commit"}, {"oid": "6b9176c1d4567bb06355535d8ed5458fc879e5a2", "url": "https://github.com/CMSgov/dpc-app/commit/6b9176c1d4567bb06355535d8ed5458fc879e5a2", "message": "Merge branch 'master' into nicole/dpc-592-bisect", "committedDate": "2020-08-12T18:57:52Z", "type": "commit"}]}