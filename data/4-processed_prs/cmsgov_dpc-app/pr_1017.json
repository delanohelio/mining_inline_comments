{"pr_number": 1017, "pr_title": "DPC-503 fix: html validator to allow `&`", "pr_createdAt": "2020-08-31T20:10:34Z", "pr_url": "https://github.com/CMSgov/dpc-app/pull/1017", "timeline": [{"oid": "fa7c5b4abe9c180ee62c09fe2cd9f5c9c5d3c5ff", "url": "https://github.com/CMSgov/dpc-app/commit/fa7c5b4abe9c180ee62c09fe2cd9f5c9c5d3c5ff", "message": "DPC-503: fix html validator to allow `&`\n\nWhen a name or address contained `&`, it was\nfailing validation due to a check to ensure that there\nis no HTML in the form data. This fix ignores such `&`\ncharacters.", "committedDate": "2020-08-31T19:58:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM5MDEwMA==", "url": "https://github.com/CMSgov/dpc-app/pull/1017#discussion_r480390100", "bodyText": "Would it make more sense to replace with \" and \"?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String s1 = s.replaceAll(\"(\\\\s&\\\\s)\", \"   \");\n          \n          \n            \n                    String s1 = s.replaceAll(\"(\\\\s&\\\\s)\", \" and \");", "author": "dhgreene", "createdAt": "2020-08-31T20:47:36Z", "path": "dpc-common/src/main/java/gov/cms/dpc/common/hibernate/validator/NoHtmlValidator.java", "diffHunk": "@@ -23,7 +23,9 @@ public boolean isValid(String s, ConstraintValidatorContext constraintValidatorC\n         if (StringUtils.isBlank(s)) {\n             return true;\n         }\n-        String safe = Jsoup.clean(s, \"\", Whitelist.none(), new Document.OutputSettings().prettyPrint(false));\n-        return safe.equals(s);\n+        // Ignore `&` in names and addresses\n+        String s1 = s.replaceAll(\"(\\\\s&\\\\s)\", \"   \");", "originalCommit": "fa7c5b4abe9c180ee62c09fe2cd9f5c9c5d3c5ff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM5MjQxOA==", "url": "https://github.com/CMSgov/dpc-app/pull/1017#discussion_r480392418", "bodyText": "Would it make more sense to replace with \" and \"?\n\nI considered this but thought it might be best to maintain the same character length. No one is actually going to see the modified string since the validator just returns a boolean, so I don't think the replacement matters much. I did go back and forth on it for a bit, though. I'm open to changing it.", "author": "jonfulk", "createdAt": "2020-08-31T20:52:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM5MDEwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDU0OTA3MQ==", "url": "https://github.com/CMSgov/dpc-app/pull/1017#discussion_r480549071", "bodyText": "I think you can just change the Whitelist object to whitelist ampersand.", "author": "MrBilnon", "createdAt": "2020-09-01T01:25:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM5MDEwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDU3Mzk4NQ==", "url": "https://github.com/CMSgov/dpc-app/pull/1017#discussion_r480573985", "bodyText": "@whuang85 i tried that, as i mentioned in the description, but the Whitelist object seems to be made for whitelisting HTML tags and not random strings or regular expressions. I would prefer to use the whitelist object if you can help me figure out how to do that.", "author": "jonfulk", "createdAt": "2020-09-01T01:48:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM5MDEwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDcwNzcyMg==", "url": "https://github.com/CMSgov/dpc-app/pull/1017#discussion_r480707722", "bodyText": "@jonfulk oops, didn't read the description and yea it looks like it's not possible", "author": "MrBilnon", "createdAt": "2020-09-01T03:34:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM5MDEwMA=="}], "type": "inlineReview"}, {"oid": "eac85b6bdcb6fbcad159d94c81883e4152c52ab5", "url": "https://github.com/CMSgov/dpc-app/commit/eac85b6bdcb6fbcad159d94c81883e4152c52ab5", "message": "Merge branch 'master' into jkf/dpc-503-allow-amp", "committedDate": "2020-08-31T22:30:21Z", "type": "commit"}, {"oid": "d401ef0a8fc7ae2b06c5bb146907e5f823cfc083", "url": "https://github.com/CMSgov/dpc-app/commit/d401ef0a8fc7ae2b06c5bb146907e5f823cfc083", "message": "Merge branch 'master' into jkf/dpc-503-allow-amp", "committedDate": "2020-09-03T15:46:06Z", "type": "commit"}]}