{"pr_number": 3495, "pr_title": "Fixes #3464, App posts deletion request notifications ({{subst:idw}}) on the wrong user's talk page", "pr_createdAt": "2020-03-11T18:35:32Z", "pr_url": "https://github.com/commons-app/apps-android-commons/pull/3495", "timeline": [{"oid": "1c5101d33089ae1dff1e4e1a20f58248a810be0e", "url": "https://github.com/commons-app/apps-android-commons/commit/1c5101d33089ae1dff1e4e1a20f58248a810be0e", "message": "Fixed #3464: App posts deletion request notifications ({{subst:idw}}) on the wrong user's talk page", "committedDate": "2020-03-11T14:18:58Z", "type": "commit"}, {"oid": "f648851ee143b1255efc636d67a0e43ebf7b5106", "url": "https://github.com/commons-app/apps-android-commons/commit/f648851ee143b1255efc636d67a0e43ebf7b5106", "message": "Merge remote-tracking branch 'remotes/upstream/master' into fix-3464", "committedDate": "2020-03-11T18:06:43Z", "type": "commit"}, {"oid": "28792d2820d7b93deb4cc45173c4c903b919d2b1", "url": "https://github.com/commons-app/apps-android-commons/commit/28792d2820d7b93deb4cc45173c4c903b919d2b1", "message": "Fixed DeleteHelperTest.kt", "committedDate": "2020-03-11T19:08:06Z", "type": "commit"}, {"oid": "23245a8f34b1575c3a8f5a2d2491f7d27c38a1a7", "url": "https://github.com/commons-app/apps-android-commons/commit/23245a8f34b1575c3a8f5a2d2491f7d27c38a1a7", "message": "Fixed DeleteHelper tests and null-pointer exception", "committedDate": "2020-03-11T20:04:24Z", "type": "commit"}, {"oid": "3d3263102d7cea23781391c6da626b7eabdd7bf5", "url": "https://github.com/commons-app/apps-android-commons/commit/3d3263102d7cea23781391c6da626b7eabdd7bf5", "message": "Modified DeleteHelper makeDeletion() test", "committedDate": "2020-03-11T20:40:06Z", "type": "commit"}, {"oid": "dfd3bbaf910e76a12a5af94e06a416020ec7509a", "url": "https://github.com/commons-app/apps-android-commons/commit/dfd3bbaf910e76a12a5af94e06a416020ec7509a", "message": "Reverted unintentionally modified Project.xml", "committedDate": "2020-03-12T08:22:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ3NzIwOQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3495#discussion_r391477209", "bodyText": "If the creator name is null, I think it is better to raise an exception as\nthrow new RuntimeException(\"Failed to nominate for deletion\"); instead of appending edits to the page of \"https://commons.wikimedia.org/wiki/User_talk:page does not exist\". So please raise the exception instead of filling the null string with \"page not exist\"", "author": "neslihanturan", "createdAt": "2020-03-12T08:56:26Z", "path": "app/src/main/java/fr/free/nrw/commons/delete/DeleteHelper.java", "diffHunk": "@@ -111,7 +114,7 @@ public DeleteHelper(NotificationHelper notificationHelper,\n                     throw new RuntimeException(\"Failed to nominate for deletion\");\n                 }).flatMap(result -> {\n                     if (result) {\n-                        return pageEditClient.appendEdit(\"User_Talk:\" + username, userPageString + \"\\n\", summary);\n+                        return pageEditClient.appendEdit(\"User_Talk:\" + creatorName, userPageString + \"\\n\", summary);", "originalCommit": "dfd3bbaf910e76a12a5af94e06a416020ec7509a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ3NzQ1Nw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3495#discussion_r391477457", "bodyText": "Please remove this instead of comment out:)", "author": "neslihanturan", "createdAt": "2020-03-12T08:56:54Z", "path": "app/src/test/kotlin/fr/free/nrw/commons/delete/DeleteHelperTest.kt", "diffHunk": "@@ -14,7 +16,7 @@ import org.mockito.InjectMocks\n import org.mockito.Mock\n import org.mockito.Mockito.`when`\n import org.mockito.MockitoAnnotations\n-import org.wikipedia.AppAdapter\n+//import org.wikipedia.AppAdapter", "originalCommit": "dfd3bbaf910e76a12a5af94e06a416020ec7509a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ3NzYxMQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3495#discussion_r391477611", "bodyText": "This tests should be updated after the acual code changed", "author": "neslihanturan", "createdAt": "2020-03-12T08:57:15Z", "path": "app/src/test/kotlin/fr/free/nrw/commons/delete/DeleteHelperTest.kt", "diffHunk": "@@ -65,9 +67,13 @@ class DeleteHelperTest {\n         `when`(media?.displayTitle).thenReturn(\"Test file\")\n         media?.filename=\"Test file.jpg\"\n \n+        val creatorName = \"Creator\";\n+        `when`(media?.getCreator()).thenReturn(\"$creatorName (page does not exist)\")\n+", "originalCommit": "dfd3bbaf910e76a12a5af94e06a416020ec7509a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "59059b53dc86102bfbb8d3fa628deb28fd5ab57e", "url": "https://github.com/commons-app/apps-android-commons/commit/59059b53dc86102bfbb8d3fa628deb28fd5ab57e", "message": "Raising exception when nominating for deletion with empty creator name", "committedDate": "2020-03-12T11:07:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYyNDkzMw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3495#discussion_r391624933", "bodyText": "We use braces even if it is single line statement:)", "author": "neslihanturan", "createdAt": "2020-03-12T13:37:18Z", "path": "app/src/main/java/fr/free/nrw/commons/delete/DeleteHelper.java", "diffHunk": "@@ -98,6 +98,11 @@ public DeleteHelper(NotificationHelper notificationHelper,\n         String userPageString = \"\\n{{subst:idw|\" + media.getFilename() +\n                 \"}} ~~~~\";\n \n+        String creator = media.getCreator();\n+        if (creator == null || creator.isEmpty())", "originalCommit": "59059b53dc86102bfbb8d3fa628deb28fd5ab57e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYyNjU1OA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3495#discussion_r391626558", "bodyText": "I assume this variable can be deleted now", "author": "neslihanturan", "createdAt": "2020-03-12T13:39:58Z", "path": "app/src/test/kotlin/fr/free/nrw/commons/delete/DeleteHelperTest.kt", "diffHunk": "@@ -65,9 +66,14 @@ class DeleteHelperTest {\n         `when`(media?.displayTitle).thenReturn(\"Test file\")\n         media?.filename=\"Test file.jpg\"\n \n+        val creatorName = \"Creator\"\n+        val noPageSuffix = \" (page does not exist)\"", "originalCommit": "59059b53dc86102bfbb8d3fa628deb28fd5ab57e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYyODAwMQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3495#discussion_r391628001", "bodyText": "And related parts of test should be updated", "author": "neslihanturan", "createdAt": "2020-03-12T13:42:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYyNjU1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY2MDI2NA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3495#discussion_r391660264", "bodyText": "Thanks for your help @neslihanturan :)\nI'm new to tests, sorry. Why those variables should be deleted? I added them to make it clear  that creator name can consist of two parts: name itself and suffix \"page does not exist\" if user hasn't created page yet. And the suffix should be stripped from the string in order to post correct notification to creator, which I check with verify(pageEditClient)?.appendEdit(eq(\"User_Talk:$creatorName\"), ArgumentMatchers.anyString(), ArgumentMatchers.anyString())", "author": "VitalyVPinchuk", "createdAt": "2020-03-12T14:29:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYyNjU1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY3NjQyMA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3495#discussion_r391676420", "bodyText": "noPageSuffix is only used in one place, we use variables to give a clearer meaning to some data or to reuse some data.\nYou can keep creatorName", "author": "macgills", "createdAt": "2020-03-12T14:52:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYyNjU1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTc4NjAzOA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3495#discussion_r391786038", "bodyText": "Okay, thanks", "author": "VitalyVPinchuk", "createdAt": "2020-03-12T17:40:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYyNjU1OA=="}], "type": "inlineReview"}, {"oid": "fd5313eab14ca063b59303c09db8549484fe07c5", "url": "https://github.com/commons-app/apps-android-commons/commit/fd5313eab14ca063b59303c09db8549484fe07c5", "message": "Fixed code style", "committedDate": "2020-03-12T14:34:09Z", "type": "commit"}, {"oid": "9e2698474fda854140db82dc75f538ba050cfa80", "url": "https://github.com/commons-app/apps-android-commons/commit/9e2698474fda854140db82dc75f538ba050cfa80", "message": "Fixed code style", "committedDate": "2020-03-12T17:42:56Z", "type": "commit"}]}