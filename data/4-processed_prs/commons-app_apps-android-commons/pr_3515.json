{"pr_number": 3515, "pr_title": "Fixes #3359 Duplicate Photos in Contributions Page", "pr_createdAt": "2020-03-14T11:26:31Z", "pr_url": "https://github.com/commons-app/apps-android-commons/pull/3515", "timeline": [{"oid": "20af16f758d2a0c629524a8e0a2a1f947c08061d", "url": "https://github.com/commons-app/apps-android-commons/commit/20af16f758d2a0c629524a8e0a2a1f947c08061d", "message": "Fixes #3359\n* Cache thumb url & imageUrl in local db\n* Use Fresco's ImageRequest to show images in ContributionViewHolder[this was the issue, we should have always used this to show the image]\n* Deleted DisplayableContribution (not needed anymore)\n* Exposed abstract function in ContributionDao to updateContribution", "committedDate": "2020-03-14T11:19:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkwMDM3Ng==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r392900376", "bodyText": "why was this added?", "author": "macgills", "createdAt": "2020-03-16T10:00:28Z", "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionsFragment.java", "diffHunk": "@@ -77,6 +79,8 @@\n     @Inject OkHttpJsonApiClient okHttpJsonApiClient;\n     @Inject CampaignsPresenter presenter;\n     @Inject LocationServiceManager locationManager;\n+    @Inject", "originalCommit": "20af16f758d2a0c629524a8e0a2a1f947c08061d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkwMDkxOQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r392900919", "bodyText": "Yes, I should remove it, the presenter is doing the job", "author": "ashishkumar468", "createdAt": "2020-03-16T10:01:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkwMDM3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkwMTAzNg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r392901036", "bodyText": "This is now default visibility?", "author": "macgills", "createdAt": "2020-03-16T10:01:40Z", "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -41,32 +33,33 @@\n     @BindView(R.id.contributionProgress) ProgressBar progressView;\n     @BindView(R.id.failed_image_options) LinearLayout failedImageOptions;\n \n-    @Inject\n-    MediaDataExtractor mediaDataExtractor;\n-\n-    @Inject\n-    @Named(\"thumbnail-cache\")\n-    LruCache<String, String> thumbnailCache;\n-\n-    private DisplayableContribution contribution;\n-    private CompositeDisposable compositeDisposable = new CompositeDisposable();\n-    private int position;\n+    int position;", "originalCommit": "20af16f758d2a0c629524a8e0a2a1f947c08061d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkwMTQ0Ng==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r392901446", "bodyText": "My bad, it should be private, I deleted it and re-added it, forgot to add the access-specifier", "author": "ashishkumar468", "createdAt": "2020-03-16T10:02:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkwMTAzNg=="}], "type": "inlineReview"}, {"oid": "ad5980c6586b025f2b4378ef01cde5b44dd62755", "url": "https://github.com/commons-app/apps-android-commons/commit/ad5980c6586b025f2b4378ef01cde5b44dd62755", "message": "* Make position private in ContributionViewHolder\n* Remove MediaDataExtractor from ContributionsFragment", "committedDate": "2020-03-16T10:04:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYyOTU0MA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393629540", "bodyText": "this should probably be else", "author": "macgills", "createdAt": "2020-03-17T12:03:49Z", "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -41,32 +33,33 @@\n     @BindView(R.id.contributionProgress) ProgressBar progressView;\n     @BindView(R.id.failed_image_options) LinearLayout failedImageOptions;\n \n-    @Inject\n-    MediaDataExtractor mediaDataExtractor;\n-\n-    @Inject\n-    @Named(\"thumbnail-cache\")\n-    LruCache<String, String> thumbnailCache;\n-\n-    private DisplayableContribution contribution;\n-    private CompositeDisposable compositeDisposable = new CompositeDisposable();\n     private int position;\n+    private Contribution contribution;\n \n     ContributionViewHolder(View parent, Callback callback) {\n         super(parent);\n         ButterKnife.bind(this, parent);\n         this.callback=callback;\n     }\n \n-    public void init(int position, DisplayableContribution contribution) {\n-        ApplicationlessInjection.getInstance(itemView.getContext())\n-                .getCommonsApplicationComponent().inject(this);\n+    public void init(int position, Contribution contribution) {\n+        this.contribution=contribution;\n         this.position=position;\n-        this.contribution = contribution;\n-        fetchAndDisplayThumbnail(contribution);\n+        String imageSource = contribution.thumbUrl;\n+        if (TextUtils.isEmpty(imageSource)) {\n+            imageSource =\n+                contribution.getLocalUri() != null ? contribution.getLocalUri().toString()\n+                    : null;\n+        }\n+        if (!TextUtils.isEmpty(imageSource)) {", "originalCommit": "ad5980c6586b025f2b4378ef01cde5b44dd62755", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYzMDY4Nw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393630687", "bodyText": "oh nope, I am wrong nvm", "author": "macgills", "createdAt": "2020-03-17T12:05:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYyOTU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYzMjcwNQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393632705", "bodyText": "to make this easier to read I would suggest not immediately assigning to imageSource, maybe a method String imageSource = chooseImageSource(contribution.thumbUrl, contribution.getLocalUri())", "author": "macgills", "createdAt": "2020-03-17T12:10:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYyOTU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYzMzA1OA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393633058", "bodyText": "Sounds good, will make the changes", "author": "ashishkumar468", "createdAt": "2020-03-17T12:10:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYyOTU0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYzNDc1Mg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393634752", "bodyText": ".setProgressiveRenderingEnabled(true).setProgressiveRenderingEnabled(true) so nice you said it twice", "author": "macgills", "createdAt": "2020-03-17T12:14:05Z", "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -41,32 +33,33 @@\n     @BindView(R.id.contributionProgress) ProgressBar progressView;\n     @BindView(R.id.failed_image_options) LinearLayout failedImageOptions;\n \n-    @Inject\n-    MediaDataExtractor mediaDataExtractor;\n-\n-    @Inject\n-    @Named(\"thumbnail-cache\")\n-    LruCache<String, String> thumbnailCache;\n-\n-    private DisplayableContribution contribution;\n-    private CompositeDisposable compositeDisposable = new CompositeDisposable();\n     private int position;\n+    private Contribution contribution;\n \n     ContributionViewHolder(View parent, Callback callback) {\n         super(parent);\n         ButterKnife.bind(this, parent);\n         this.callback=callback;\n     }\n \n-    public void init(int position, DisplayableContribution contribution) {\n-        ApplicationlessInjection.getInstance(itemView.getContext())\n-                .getCommonsApplicationComponent().inject(this);\n+    public void init(int position, Contribution contribution) {\n+        this.contribution=contribution;\n         this.position=position;\n-        this.contribution = contribution;\n-        fetchAndDisplayThumbnail(contribution);\n+        String imageSource = contribution.thumbUrl;\n+        if (TextUtils.isEmpty(imageSource)) {\n+            imageSource =\n+                contribution.getLocalUri() != null ? contribution.getLocalUri().toString()\n+                    : null;\n+        }\n+        if (!TextUtils.isEmpty(imageSource)) {\n+            final ImageRequest imageRequest =\n+                ImageRequestBuilder.newBuilderWithSource(Uri.parse(imageSource)).setProgressiveRenderingEnabled(true).setProgressiveRenderingEnabled(true)", "originalCommit": "ad5980c6586b025f2b4378ef01cde5b44dd62755", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c7e042c19cb7c27745a38e9583f9466863da325a", "url": "https://github.com/commons-app/apps-android-commons/commit/c7e042c19cb7c27745a38e9583f9466863da325a", "message": "* Show placeholder image for Contributions while the image loads\n* setHasStableId's ContributionsAdapter", "committedDate": "2020-03-17T13:47:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY5NDY2MA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393694660", "bodyText": "default visibility", "author": "macgills", "createdAt": "2020-03-17T13:53:02Z", "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -35,25 +39,35 @@\n \n     private int position;\n     private Contribution contribution;\n+    Random random =new Random();", "originalCommit": "c7e042c19cb7c27745a38e9583f9466863da325a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY5NDgyOA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393694828", "bodyText": "not spaced to codestyle either", "author": "macgills", "createdAt": "2020-03-17T13:53:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY5NDY2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY5NTYzNw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393695637", "bodyText": "Done, stupid of me to miss these", "author": "ashishkumar468", "createdAt": "2020-03-17T13:54:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY5NDY2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyMzM5OA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393723398", "bodyText": "happens to the best of us, ctral+alt+shift+l will expose the reformat dialog so you can select vcs changed text, don't think it'll work now tho", "author": "macgills", "createdAt": "2020-03-17T14:32:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY5NDY2MA=="}], "type": "inlineReview"}, {"oid": "0da2def128d77924e613349b0ff391598a6904a1", "url": "https://github.com/commons-app/apps-android-commons/commit/0da2def128d77924e613349b0ff391598a6904a1", "message": "make Random variable private in ContributionViewHolder", "committedDate": "2020-03-17T13:54:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY5NjU1Mg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393696552", "bodyText": "don't do this, return the value when it is correct, you don't need a variable this can all collapse into a ternary if you so choose", "author": "macgills", "createdAt": "2020-03-17T13:55:41Z", "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -96,6 +110,25 @@ public void init(int position, Contribution contribution) {\n         }\n     }\n \n+    /**\n+     * Returns the image source for the image view, first preference is given to thumbUrl if that is\n+     * null, moves to local uri and if both are null return null\n+     *\n+     * @param thumbUrl\n+     * @param localUri\n+     * @return\n+     */\n+    @Nullable\n+    private String chooseImageSource(String thumbUrl, Uri localUri) {\n+        String imageSource = thumbUrl;", "originalCommit": "c7e042c19cb7c27745a38e9583f9466863da325a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY5ODc2Mg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393698762", "bodyText": "Done", "author": "ashishkumar468", "createdAt": "2020-03-17T13:58:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY5NjU1Mg=="}], "type": "inlineReview"}, {"oid": "1f306c4c77c0fc2183d46e7954a57c22112867e9", "url": "https://github.com/commons-app/apps-android-commons/commit/1f306c4c77c0fc2183d46e7954a57c22112867e9", "message": "replace local variable-if-with ternary operator in ContributionViewHolder", "committedDate": "2020-03-17T13:58:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwMDQwOA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393700408", "bodyText": "I am a huge nitpicker, I apologise.\nFor these scenarios I generally put each value that is returned on its own line\ncondition ? value :\n  condition ? value :\n    value\n\nfeel free to ignore", "author": "macgills", "createdAt": "2020-03-17T14:01:18Z", "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -120,13 +120,8 @@ public void init(int position, Contribution contribution) {\n      */\n     @Nullable\n     private String chooseImageSource(String thumbUrl, Uri localUri) {\n-        String imageSource = thumbUrl;\n-        if (TextUtils.isEmpty(imageSource)) {\n-            imageSource =\n-                localUri != null ? localUri.toString()\n-                    : null;\n-        }\n-        return imageSource;\n+        return !TextUtils.isEmpty(thumbUrl) ? thumbUrl : (localUri != null ? localUri.toString()", "originalCommit": "1f306c4c77c0fc2183d46e7954a57c22112867e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwMjE4MA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393702180", "bodyText": "Fair point, added :)", "author": "ashishkumar468", "createdAt": "2020-03-17T14:03:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwMDQwOA=="}], "type": "inlineReview"}, {"oid": "b40c559580b42dcec63eab8f27c4a3210ef61f4d", "url": "https://github.com/commons-app/apps-android-commons/commit/b40c559580b42dcec63eab8f27c4a3210ef61f4d", "message": "Fix indentation/formatting of ternary operator in ContributionViewHolder", "committedDate": "2020-03-17T14:03:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwMjgwMw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393702803", "bodyText": "Do we need a cache? was there performance issues in your testing?\nI don't think ColorDrawables are that expensive but android can always surprise ya.", "author": "macgills", "createdAt": "2020-03-17T14:04:37Z", "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -41,32 +37,43 @@\n     @BindView(R.id.contributionProgress) ProgressBar progressView;\n     @BindView(R.id.failed_image_options) LinearLayout failedImageOptions;\n \n-    @Inject\n-    MediaDataExtractor mediaDataExtractor;\n-\n-    @Inject\n-    @Named(\"thumbnail-cache\")\n-    LruCache<String, String> thumbnailCache;\n-\n-    private DisplayableContribution contribution;\n-    private CompositeDisposable compositeDisposable = new CompositeDisposable();\n     private int position;\n+    private Contribution contribution;\n+    private Random random =new Random();\n+    private HashMap<Integer,ColorDrawable> drawablesCache=new HashMap();\n \n     ContributionViewHolder(View parent, Callback callback) {\n         super(parent);\n         ButterKnife.bind(this, parent);\n         this.callback=callback;\n+        populateDrawableCache();\n+    }\n+    \n+    /**\n+     * Cache's the drawables to be shown as image placeholders\n+     */\n+    private void populateDrawableCache() {", "originalCommit": "1f306c4c77c0fc2183d46e7954a57c22112867e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwMzgzNA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393703834", "bodyText": "I did not see a performance issue to be honest but creating new Drawables in onBind, imagine it for 1000 contributions, I thought cache should be okay, anyway this one won't harm, its a small one with 5 entries", "author": "ashishkumar468", "createdAt": "2020-03-17T14:06:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwMjgwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwNTk4Mg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393705982", "bodyText": "I am pretty sure android already creates thousands of ColorDrawables,  whenever you set the color of a view.\nIt is not like this is a bitmap, I think this might be over-engineering", "author": "macgills", "createdAt": "2020-03-17T14:09:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwMjgwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwNjUxNw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393706517", "bodyText": "Can say that, but do you really think caching like 5 drawables would harm? And I would not compare with how android would manage thousands of drawables, I am sure they would have released objects when not needed", "author": "ashishkumar468", "createdAt": "2020-03-17T14:09:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwMjgwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwODU2Mw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393708563", "bodyText": "I think it is unnecessary, If we were to go around doing unnecessary things that do no harm then the code would be littered and the intention that much harder to read.\nSolving problems that exist is plenty hard, no need to invent ones that don't exist.", "author": "macgills", "createdAt": "2020-03-17T14:12:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwMjgwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcxMTE4MA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393711180", "bodyText": "I doubt this hinders the readability, I am okay to remove this, I just don't see a point like this should be the reason. Anyways if you anyways insist so much, I will do it.", "author": "ashishkumar468", "createdAt": "2020-03-17T14:16:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwMjgwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcxMzU1OA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393713558", "bodyText": "It hinders the readability, it adds an extra mental burden to the reader and if someone was to come along and see this cache implemented they would rightly assume these are expensive objects and great care must be used when handling them.\nThe best code is written with the backspace key.", "author": "macgills", "createdAt": "2020-03-17T14:19:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwMjgwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcxNTkwMg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393715902", "bodyText": "Done :)", "author": "ashishkumar468", "createdAt": "2020-03-17T14:22:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwMjgwMw=="}], "type": "inlineReview"}, {"oid": "627ac9151799a76aba5e2c1f115b9a0dd35bb4eb", "url": "https://github.com/commons-app/apps-android-commons/commit/627ac9151799a76aba5e2c1f115b9a0dd35bb4eb", "message": "I might revert this commit[I have reasons]", "committedDate": "2020-03-17T14:18:18Z", "type": "commit"}, {"oid": "f00ab4f20da4da8f563f2f00f7d4d1d3af775c5e", "url": "https://github.com/commons-app/apps-android-commons/commit/f00ab4f20da4da8f563f2f00f7d4d1d3af775c5e", "message": "Create in-memory drawables in CVH's onBind, caches are bad, add mental overhead", "committedDate": "2020-03-17T14:22:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczNjMwMQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393736301", "bodyText": "formatting in this file is still not correct, no space around operators", "author": "macgills", "createdAt": "2020-03-17T14:50:16Z", "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -41,32 +37,32 @@\n     @BindView(R.id.contributionProgress) ProgressBar progressView;\n     @BindView(R.id.failed_image_options) LinearLayout failedImageOptions;\n \n-    @Inject\n-    MediaDataExtractor mediaDataExtractor;\n-\n-    @Inject\n-    @Named(\"thumbnail-cache\")\n-    LruCache<String, String> thumbnailCache;\n-\n-    private DisplayableContribution contribution;\n-    private CompositeDisposable compositeDisposable = new CompositeDisposable();\n     private int position;\n+    private Contribution contribution;\n+    private Random random =new Random();", "originalCommit": "f00ab4f20da4da8f563f2f00f7d4d1d3af775c5e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczNzAwNw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393737007", "bodyText": "also you can remove the brackets here", "author": "macgills", "createdAt": "2020-03-17T14:51:10Z", "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -104,40 +100,18 @@ public void init(int position, DisplayableContribution contribution) {\n     }\n \n     /**\n-     * This method fetches the thumbnail url from file name\n-     * If the thumbnail url is present in cache, then it is used otherwise API call is made to fetch the thumbnail\n-     * This can be removed once #2904 is in place and contribution contains all metadata beforehand\n-     * @param contribution\n+     * Returns the image source for the image view, first preference is given to thumbUrl if that is\n+     * null, moves to local uri and if both are null return null\n+     *\n+     * @param thumbUrl\n+     * @param localUri\n+     * @return\n      */\n-    private void fetchAndDisplayThumbnail(DisplayableContribution contribution) {\n-        String keyForLRUCache = contribution.getFilename();\n-        String cacheUrl = thumbnailCache.get(keyForLRUCache);\n-        if (!StringUtils.isBlank(cacheUrl)) {\n-            imageView.setImageURI(cacheUrl);\n-            return;\n-        }\n-\n-        imageView.setBackground(null);\n-        if ((contribution.getState() != Contribution.STATE_COMPLETED) && FileUtils.fileExists(\n-                contribution.getLocalUri())) {\n-            imageView.setImageURI(contribution.getLocalUri());\n-        } else {\n-            Timber.d(\"Fetching thumbnail for %s\", contribution.getFilename());\n-            Disposable disposable = mediaDataExtractor\n-                    .getMediaFromFileName(contribution.getFilename())\n-                    .subscribeOn(Schedulers.io())\n-                    .observeOn(AndroidSchedulers.mainThread())\n-                    .subscribe(media -> {\n-                        thumbnailCache.put(keyForLRUCache, media.getThumbUrl());\n-                        imageView.setImageURI(media.getThumbUrl());\n-                    });\n-            compositeDisposable.add(disposable);\n-        }\n-\n-    }\n-\n-    public void clear() {\n-        compositeDisposable.clear();\n+    @Nullable\n+    private String chooseImageSource(String thumbUrl, Uri localUri) {\n+        return !TextUtils.isEmpty(thumbUrl) ? thumbUrl :\n+            (localUri != null ? localUri.toString() :", "originalCommit": "f00ab4f20da4da8f563f2f00f7d4d1d3af775c5e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczODY5Mg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393738692", "bodyText": "View recycling is kind of the point of a Recyclerview. I am very hesitant to approve this.", "author": "macgills", "createdAt": "2020-03-17T14:53:32Z", "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionsListFragment.java", "diffHunk": "@@ -108,6 +109,7 @@ private void initRecyclerView() {\n         }\n \n         rvContributionsList.setAdapter(adapter);\n+        rvContributionsList.setItemViewCacheSize(0);", "originalCommit": "f00ab4f20da4da8f563f2f00f7d4d1d3af775c5e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczOTY3Ng==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393739676", "bodyText": "Yes yes, of course I was gonna revert this commit(if you see the commit message), just added this to see if this would solve Nes's issue so that we can create a separate issue to discuss how to improve performance", "author": "ashishkumar468", "createdAt": "2020-03-17T14:54:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczODY5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0MDExNg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393740116", "bodyText": "Although this does not entirely nullify the recycler view's job", "author": "ashishkumar468", "createdAt": "2020-03-17T14:55:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczODY5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0MjI5Mg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393742292", "bodyText": "No but it is in the name", "author": "macgills", "createdAt": "2020-03-17T14:58:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczODY5Mg=="}], "type": "inlineReview"}, {"oid": "34a5dca6742848d1dd4e66023c90df50b3914480", "url": "https://github.com/commons-app/apps-android-commons/commit/34a5dca6742848d1dd4e66023c90df50b3914480", "message": "Revert \"I might revert this commit[I have reasons]\"\n\nThis reverts commit 627ac9151799a76aba5e2c1f115b9a0dd35bb4eb.", "committedDate": "2020-03-18T08:17:35Z", "type": "commit"}, {"oid": "895c5c727b6ec9de13e41718b80b32db0c64ac4f", "url": "https://github.com/commons-app/apps-android-commons/commit/895c5c727b6ec9de13e41718b80b32db0c64ac4f", "message": "minor formatting changes, reverted 627ac9151799a76aba5e2c1f115b9a0dd35bb4eb", "committedDate": "2020-03-18T08:19:34Z", "type": "commit"}, {"oid": "ae6f8cc894dcc1a30b8658e80027f10720e8848c", "url": "https://github.com/commons-app/apps-android-commons/commit/ae6f8cc894dcc1a30b8658e80027f10720e8848c", "message": "uh-oh missed semicolon, java", "committedDate": "2020-03-18T08:21:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIxMDk1NQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r394210955", "bodyText": "this isn't formatted", "author": "macgills", "createdAt": "2020-03-18T09:32:29Z", "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -41,32 +37,32 @@\n     @BindView(R.id.contributionProgress) ProgressBar progressView;\n     @BindView(R.id.failed_image_options) LinearLayout failedImageOptions;\n \n-    @Inject\n-    MediaDataExtractor mediaDataExtractor;\n-\n-    @Inject\n-    @Named(\"thumbnail-cache\")\n-    LruCache<String, String> thumbnailCache;\n-\n-    private DisplayableContribution contribution;\n-    private CompositeDisposable compositeDisposable = new CompositeDisposable();\n     private int position;\n+    private Contribution contribution;\n+    private Random random = new Random();\n \n     ContributionViewHolder(View parent, Callback callback) {\n         super(parent);\n         ButterKnife.bind(this, parent);\n         this.callback=callback;\n     }\n \n-    public void init(int position, DisplayableContribution contribution) {\n-        ApplicationlessInjection.getInstance(itemView.getContext())\n-                .getCommonsApplicationComponent().inject(this);\n+    public void init(int position, Contribution contribution) {\n+        this.contribution=contribution;", "originalCommit": "ae6f8cc894dcc1a30b8658e80027f10720e8848c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ab53d8aa002cc331cfd6ebea31f1ee476e9cefe1", "url": "https://github.com/commons-app/apps-android-commons/commit/ab53d8aa002cc331cfd6ebea31f1ee476e9cefe1", "message": "minor formatting changes", "committedDate": "2020-03-18T09:48:02Z", "type": "commit"}]}