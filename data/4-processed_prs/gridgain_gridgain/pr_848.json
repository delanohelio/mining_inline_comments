{"pr_number": 848, "pr_title": "GG-27017 Fixed availability of \"Add user\" action.", "pr_createdAt": "2020-01-14T11:57:58Z", "pr_url": "https://github.com/gridgain/gridgain/pull/848", "timeline": [{"oid": "acaea2da5164b76f348438779cb4788898f7eacd", "url": "https://github.com/gridgain/gridgain/commit/acaea2da5164b76f348438779cb4788898f7eacd", "message": "GG-27017 Fixed availability of \"Add user\" action.", "committedDate": "2020-01-14T11:55:39Z", "type": "commit"}, {"oid": "1de08e74af7b8a46e023d4c318c6366a62816c11", "url": "https://github.com/gridgain/gridgain/commit/1de08e74af7b8a46e023d4c318c6366a62816c11", "message": "GG-27017 Small fixes.", "committedDate": "2020-01-14T13:22:52Z", "type": "commit"}, {"oid": "1ddaa49eed97cbf5a67eb583c6035021c9b1aed8", "url": "https://github.com/gridgain/gridgain/commit/1ddaa49eed97cbf5a67eb583c6035021c9b1aed8", "message": "GG-27017 Small fixes.", "committedDate": "2020-01-15T07:19:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc2MTc1Mw==", "url": "https://github.com/gridgain/gridgain/pull/848#discussion_r366761753", "bodyText": "await t.expect(excluded === actionSelector.withText(actionLbl).exists).notOk();", "author": "MaxLosevskoy", "createdAt": "2020-01-15T09:09:31Z", "path": "modules/web-console/e2e/testcafe/fixtures/admin/assume-identity.js", "diffHunk": "@@ -20,9 +20,39 @@ import * as admin from '../../page-models/pageAdminListOfRegisteredUsers';\n import {pageProfile as profile} from '../../page-models/pageProfile';\n import * as notifications from '../../components/permanentNotifications';\n import {userMenu} from '../../components/userMenu';\n+import { Selector } from 'testcafe';\n+import { successNotification } from '../../components/notifications';\n+import {confirmation} from '../../components/confirmation'\n \n const regularUser = createRegularUser();\n \n+const _checkListOfActions = async(t, actions, excluded) => {\n+    const actionSelector = Selector('.dropdown-menu a');\n+\n+    for (let i = 0; i < actions.length; i++) {\n+        const actionLbl = actions[i];\n+\n+        if (excluded)\n+            await t.expect(actionSelector.withText(actionLbl).exists).notOk();\n+        else\n+            await t.expect(actionSelector.withText(actionLbl).exists).ok();", "originalCommit": "1ddaa49eed97cbf5a67eb583c6035021c9b1aed8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc3MTU1MA==", "url": "https://github.com/gridgain/gridgain/pull/848#discussion_r366771550", "bodyText": "TestCafe-specific promises don't work like that.\nThis should at least work:\nawait t.expect(actionSelector.withText(actionLbl).exists).eql(excluded);", "author": "Klaster1", "createdAt": "2020-01-15T09:30:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc2MTc1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxNjg1Ng==", "url": "https://github.com/gridgain/gridgain/pull/848#discussion_r366816856", "bodyText": "Changed check of action list.", "author": "vsisko", "createdAt": "2020-01-15T11:04:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc2MTc1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc2NzgxOA==", "url": "https://github.com/gridgain/gridgain/pull/848#discussion_r366767818", "bodyText": "There's no validation that admin permissions were granted/revoked - alert does not guarantee that", "author": "MaxLosevskoy", "createdAt": "2020-01-15T09:22:29Z", "path": "modules/web-console/e2e/testcafe/fixtures/admin/assume-identity.js", "diffHunk": "@@ -61,3 +91,82 @@ test('Become user', async(t) => {\n         // See https://ggsystems.atlassian.net/browse/GG-24068\n         .expect(userMenu.menuItem.withText('Admin panel').count).eql(1);\n });\n+\n+test(\"Action availability\", async(t) => {\n+    const _changeUserSelection = async(userName) => {\n+        await t.click(admin.userNameCell.withText(userName))\n+            .hover(admin.usersTable.actionsButton);\n+    };\n+\n+    await t.navigateTo(resolveUrl('/settings/admin'))\n+        .hover(admin.usersTable.actionsButton);\n+\n+    await _checkActionSet(t, true, true);\n+\n+    await admin.usersTable.performAction('Add user');\n+\n+    const createUserDialog = Selector('.modal-dialog');\n+\n+    await t.expect(createUserDialog.find('.modal-header').withText('Create User').exists).ok()\n+        .click(createUserDialog.find('button').withText('Cancel'))\n+        .hover(admin.usersTable.actionsButton);\n+\n+    await _checkActionSet(t, true, true);\n+\n+    await _changeUserSelection('John Doe');\n+\n+    await _checkActionSet(t, true, false);\n+\n+    await _changeUserSelection('John Doe');\n+\n+    await _checkActionSet(t, true, true);\n+\n+    await _changeUserSelection('User Name');\n+\n+    await _checkActionSet(t, false, false);\n+\n+    await _changeUserSelection('User Name');\n+\n+    await _checkActionSet(t, true, true);\n+\n+    await _changeUserSelection('User Name');\n+\n+    await admin.usersTable.performAction('Revoke admin');\n+\n+    await t.expect(successNotification.withText('Admin rights was successfully revoked for user: \"User Name\"').exists).ok();\n+\n+    await admin.usersTable.performAction('Grant admin');\n+\n+    await t.expect(successNotification.withText('Admin rights was successfully granted for user: \"User Name\"').exists).ok();", "originalCommit": "1ddaa49eed97cbf5a67eb583c6035021c9b1aed8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxNzA2MQ==", "url": "https://github.com/gridgain/gridgain/pull/848#discussion_r366817061", "bodyText": "Added check of admin status change.", "author": "vsisko", "createdAt": "2020-01-15T11:04:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc2NzgxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc2ODUyMg==", "url": "https://github.com/gridgain/gridgain/pull/848#discussion_r366768522", "bodyText": "We assert that modal is displayed but we don't assert the content of the modal", "author": "MaxLosevskoy", "createdAt": "2020-01-15T09:24:02Z", "path": "modules/web-console/e2e/testcafe/fixtures/admin/assume-identity.js", "diffHunk": "@@ -61,3 +91,82 @@ test('Become user', async(t) => {\n         // See https://ggsystems.atlassian.net/browse/GG-24068\n         .expect(userMenu.menuItem.withText('Admin panel').count).eql(1);\n });\n+\n+test(\"Action availability\", async(t) => {\n+    const _changeUserSelection = async(userName) => {\n+        await t.click(admin.userNameCell.withText(userName))\n+            .hover(admin.usersTable.actionsButton);\n+    };\n+\n+    await t.navigateTo(resolveUrl('/settings/admin'))\n+        .hover(admin.usersTable.actionsButton);\n+\n+    await _checkActionSet(t, true, true);\n+\n+    await admin.usersTable.performAction('Add user');\n+\n+    const createUserDialog = Selector('.modal-dialog');\n+\n+    await t.expect(createUserDialog.find('.modal-header').withText('Create User').exists).ok()\n+        .click(createUserDialog.find('button').withText('Cancel'))\n+        .hover(admin.usersTable.actionsButton);\n+\n+    await _checkActionSet(t, true, true);\n+\n+    await _changeUserSelection('John Doe');\n+\n+    await _checkActionSet(t, true, false);\n+\n+    await _changeUserSelection('John Doe');\n+\n+    await _checkActionSet(t, true, true);\n+\n+    await _changeUserSelection('User Name');\n+\n+    await _checkActionSet(t, false, false);\n+\n+    await _changeUserSelection('User Name');\n+\n+    await _checkActionSet(t, true, true);\n+\n+    await _changeUserSelection('User Name');\n+\n+    await admin.usersTable.performAction('Revoke admin');\n+\n+    await t.expect(successNotification.withText('Admin rights was successfully revoked for user: \"User Name\"').exists).ok();\n+\n+    await admin.usersTable.performAction('Grant admin');\n+\n+    await t.expect(successNotification.withText('Admin rights was successfully granted for user: \"User Name\"').exists).ok();\n+});\n+\n+test(\"Remove user\", async(t) => {\n+    await t.navigateTo(resolveUrl('/settings/admin'))\n+        .click(admin.userNameCell.withText('User Name'));\n+\n+    await admin.usersTable.performAction('Remove user');\n+\n+    await t.expect(confirmation.body.exists).ok();", "originalCommit": "1ddaa49eed97cbf5a67eb583c6035021c9b1aed8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc3MzA3OQ==", "url": "https://github.com/gridgain/gridgain/pull/848#discussion_r366773079", "bodyText": "Agree with @MaxLosevskoy, I'd at least asset the confirmation text.", "author": "Klaster1", "createdAt": "2020-01-15T09:33:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc2ODUyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxODMxOQ==", "url": "https://github.com/gridgain/gridgain/pull/848#discussion_r366818319", "bodyText": "Added check of confirm dialog message.", "author": "vsisko", "createdAt": "2020-01-15T11:07:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc2ODUyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgyMDE1NA==", "url": "https://github.com/gridgain/gridgain/pull/848#discussion_r366820154", "bodyText": "Looks good to me.", "author": "Klaster1", "createdAt": "2020-01-15T11:12:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc2ODUyMg=="}], "type": "inlineReview"}, {"oid": "af74448a2591dcd43b4fb463a64ccc3a4b371d64", "url": "https://github.com/gridgain/gridgain/commit/af74448a2591dcd43b4fb463a64ccc3a4b371d64", "message": "GG-27017 Small fixes.", "committedDate": "2020-01-15T11:02:10Z", "type": "commit"}]}