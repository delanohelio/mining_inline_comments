{"pr_number": 1247, "pr_title": "GG-29772", "pr_createdAt": "2020-06-17T15:55:19Z", "pr_url": "https://github.com/gridgain/gridgain/pull/1247", "timeline": [{"oid": "d25c2aa5fe698fdc9ef7ab61ea759bb78d54571c", "url": "https://github.com/gridgain/gridgain/commit/d25c2aa5fe698fdc9ef7ab61ea759bb78d54571c", "message": "GG-29772 Change JMX SQLGlobalMemoryQuota and SQLQueryMemoryQuota to numeric type", "committedDate": "2020-06-10T23:01:34Z", "type": "commit"}, {"oid": "fe2cdaadb826a5283e4c4bf3484cee429478078e", "url": "https://github.com/gridgain/gridgain/commit/fe2cdaadb826a5283e4c4bf3484cee429478078e", "message": "GG-29772 add getSqlQueryMemoryUsage -- how much memory sql engine occupies currently.", "committedDate": "2020-06-11T14:47:20Z", "type": "commit"}, {"oid": "7cf52d2b0c2890487957f372c1578ae795d80134", "url": "https://github.com/gridgain/gridgain/commit/7cf52d2b0c2890487957f372c1578ae795d80134", "message": "GG-29772 remove unnecessary logging statements.", "committedDate": "2020-06-17T15:54:05Z", "type": "commit"}, {"oid": "224b8b90ac4ef7991deb1a06fb87e3b658e9a3e4", "url": "https://github.com/gridgain/gridgain/commit/224b8b90ac4ef7991deb1a06fb87e3b658e9a3e4", "message": "GG-29772 remove unnecessary imports.", "committedDate": "2020-06-18T15:04:54Z", "type": "commit"}, {"oid": "f4e89e5a47c223eac62d162e9d0673cfbb06aee7", "url": "https://github.com/gridgain/gridgain/commit/f4e89e5a47c223eac62d162e9d0673cfbb06aee7", "message": "GG-29772 add JMX SQLGlobalMemoryQuotaBytes and SQLQueryMemoryQuotaBytes to return corresponding attributes as long values.", "committedDate": "2020-07-01T18:17:41Z", "type": "commit"}, {"oid": "f7a4b3eeace0a50cfa486a33130af369d4e342c5", "url": "https://github.com/gridgain/gridgain/commit/f7a4b3eeace0a50cfa486a33130af369d4e342c5", "message": "GG-29772 add JMX SQLGlobalMemoryQuotaBytes and SQLQueryMemoryQuotaBytes to return corresponding attributes as long values.", "committedDate": "2020-07-02T19:01:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI1NTA3Mg==", "url": "https://github.com/gridgain/gridgain/pull/1247#discussion_r449255072", "bodyText": "I don't think parseLong will work here. The quota strings can have multiple formats - see SqlConfiguration::setSqlGlobalMemoryQuota javadoc. Same for query quota.", "author": "slukyano", "createdAt": "2020-07-02T20:39:06Z", "path": "modules/indexing/src/main/java/org/apache/ignite/internal/mxbean/SqlQueryMXBeanImpl.java", "diffHunk": "@@ -73,6 +73,11 @@ public SqlQueryMXBeanImpl(GridKernalContext ctx) {\n         h2idx.longRunningQueries().setResultSetSizeThresholdMultiplier(rsSizeThresholdMultiplier);\n     }\n \n+    /** {@inheritDoc} */\n+    @Override public Long getSqlGlobalMemoryQuotaBytes() {\n+        return Long.parseLong(h2idx.memoryManager().getGlobalQuota());", "originalCommit": "f7a4b3eeace0a50cfa486a33130af369d4e342c5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI1NTUwNg==", "url": "https://github.com/gridgain/gridgain/pull/1247#discussion_r449255506", "bodyText": "Need to either drop a comma before but here or add a comma in the global quota method.", "author": "slukyano", "createdAt": "2020-07-02T20:40:11Z", "path": "modules/indexing/src/main/java/org/apache/ignite/internal/mxbean/SqlQueryMXBean.java", "diffHunk": "@@ -144,6 +155,18 @@\n         \"For example:  '1000', '10M', '100k', '1G', '70%'\")\n     void setSqlGlobalMemoryQuota(String size);\n \n+\n+    /**\n+     * Gets global query quota.\n+     *\n+     * @return Global query quota as a long.\n+     */\n+    @MXBeanDescription(\"Global SQL query memory pool size or SQL query memory quota is\" +\n+        \" an upper bound for the heap memory part which might be occupied by the SQL query execution engine. \" +\n+        \"This quota is shared among all simultaneously running queries, hence it be easily consumed by the single \" +\n+        \"heavy analytics query. Same as SqlQueryMemoryQuota, but with a Long return type.\")", "originalCommit": "f7a4b3eeace0a50cfa486a33130af369d4e342c5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "510e3e40465cd91e3c3646362f92f52d336e457a", "url": "https://github.com/gridgain/gridgain/commit/510e3e40465cd91e3c3646362f92f52d336e457a", "message": "GG-29772 add JMX SQLGlobalMemoryQuotaBytes and SQLQueryMemoryQuotaBytes to return corresponding attributes as long values.", "committedDate": "2020-07-06T20:27:44Z", "type": "commit"}, {"oid": "a7be2a984772faf817366b315223172121d640a0", "url": "https://github.com/gridgain/gridgain/commit/a7be2a984772faf817366b315223172121d640a0", "message": "GG-29772 add test for SqlQueryMXBeanImpl JMX attributes", "committedDate": "2020-07-09T19:12:44Z", "type": "commit"}, {"oid": "1ebbf1c2da1b9bc0029f38d284c7949eca3263d1", "url": "https://github.com/gridgain/gridgain/commit/1ebbf1c2da1b9bc0029f38d284c7949eca3263d1", "message": "GG-29772 add JMX SQLGlobalMemoryQuotaBytes, SQLQueryMemoryQuotaBytes to return corresponding attributes as long values.\nChange SQLGlobalMemoryQuota and SQLQueryMemoryQuota to display in mb/gb instead of showing the actual bytes.", "committedDate": "2020-08-11T20:27:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA3NzIxMw==", "url": "https://github.com/gridgain/gridgain/pull/1247#discussion_r469077213", "bodyText": "We already have an integer value of the quota, right? So we probably don't need parseBytes.\nMay change the memoryManager().getGlobalQuota() to return long instead of String? It is internal and doesn't seem to be used anywhere else, so we can change it easily.", "author": "slukyano", "createdAt": "2020-08-12T08:00:33Z", "path": "modules/indexing/src/main/java/org/apache/ignite/internal/mxbean/SqlQueryMXBeanImpl.java", "diffHunk": "@@ -73,19 +74,30 @@ public SqlQueryMXBeanImpl(GridKernalContext ctx) {\n         h2idx.longRunningQueries().setResultSetSizeThresholdMultiplier(rsSizeThresholdMultiplier);\n     }\n \n+    /** {@inheritDoc} */\n+    @Override public Long getSqlGlobalMemoryQuotaBytes() {\n+        return U.parseBytes(h2idx.memoryManager().getGlobalQuota());", "originalCommit": "1ebbf1c2da1b9bc0029f38d284c7949eca3263d1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5f5faa18942b3555c56fbe80ed43c0934580f263", "url": "https://github.com/gridgain/gridgain/commit/5f5faa18942b3555c56fbe80ed43c0934580f263", "message": "GG-29772 add JMX SQLGlobalMemoryQuotaBytes, SQLQueryMemoryQuotaBytes to return corresponding attributes as long values.\nChange SQLGlobalMemoryQuota and SQLQueryMemoryQuota to display in mb/gb instead of showing the actual bytes.", "committedDate": "2020-08-12T19:29:30Z", "type": "commit"}]}