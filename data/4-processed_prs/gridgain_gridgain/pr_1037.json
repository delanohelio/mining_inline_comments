{"pr_number": 1037, "pr_title": "GG-27289: SQLRowCount implemented for SELECT queries", "pr_createdAt": "2020-04-07T01:04:33Z", "pr_url": "https://github.com/gridgain/gridgain/pull/1037", "timeline": [{"oid": "7909346537e8d60b1580713af1ed4681e6664917", "url": "https://github.com/gridgain/gridgain/commit/7909346537e8d60b1580713af1ed4681e6664917", "message": "GG-27289: SQLRowCount implemented for SELECT queries", "committedDate": "2020-04-07T01:02:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg3MTk2NQ==", "url": "https://github.com/gridgain/gridgain/pull/1037#discussion_r404871965", "bodyText": "I'm definitely not an expert here, but why do we need a cycle with 200 loops?\nIs it supposed to be 1000/123?", "author": "ashapkin", "createdAt": "2020-04-07T14:52:07Z", "path": "modules/platforms/cpp/odbc-test/src/queries_test.cpp", "diffHunk": "@@ -1667,7 +1667,41 @@ BOOST_AUTO_TEST_CASE(TestAffectedRows)\n     if (!SQL_SUCCEEDED(ret))\n         BOOST_FAIL(GetOdbcErrorMessage(SQL_HANDLE_STMT, stmt));\n \n-    BOOST_CHECK_EQUAL(affected, 0);\n+    BOOST_CHECK_EQUAL(affected, 1024);\n+}\n+\n+BOOST_AUTO_TEST_CASE(TestAffectedRowsOnSelect)\n+{\n+    Connect(\"DRIVER={Apache Ignite};ADDRESS=127.0.0.1:11110;SCHEMA=cache;PAGE_SIZE=123\");\n+\n+    const int recordsNum = 1000;\n+\n+    // Inserting values.\n+    InsertTestStrings(recordsNum);\n+\n+    // Just selecting everything to make sure everything is OK\n+    SQLCHAR selectReq[] = \"SELECT _key, strField FROM TestType ORDER BY _key\";\n+\n+    SQLRETURN ret = SQLExecDirect(stmt, selectReq, sizeof(selectReq));\n+\n+    if (!SQL_SUCCEEDED(ret))\n+        BOOST_FAIL(GetOdbcErrorMessage(SQL_HANDLE_STMT, stmt));\n+\n+    for (int i = 0; i < 200; ++i)", "originalCommit": "7909346537e8d60b1580713af1ed4681e6664917", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIwMTE4MA==", "url": "https://github.com/gridgain/gridgain/pull/1037#discussion_r405201180", "bodyText": "123 is the number of records which transferred by a single network request-response and thus stay cached in driver. But records still fetched one by one by application. I've intentionally made number of fetches more than page size (to be sure paging is working properly with this feature), but less than the whole result set.", "author": "isapego", "createdAt": "2020-04-08T01:08:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg3MTk2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg4NDcyOQ==", "url": "https://github.com/gridgain/gridgain/pull/1037#discussion_r404884729", "bodyText": "Just in case: different connections could yield different results for the same query.", "author": "ashapkin", "createdAt": "2020-04-07T15:07:42Z", "path": "modules/platforms/cpp/odbc/src/query/data_query.cpp", "diffHunk": "@@ -181,7 +181,11 @@ namespace ignite\n             int64_t DataQuery::AffectedRows() const\n             {\n                 int64_t affected = rowsAffectedIdx < rowsAffected.size() ? rowsAffected[rowsAffectedIdx] : 0;\n-                return affected < 0 ? 0 : affected;\n+\n+                if (affected >= 0)\n+                    return affected;\n+\n+                return connection.GetConfiguration().GetPageSize();", "originalCommit": "7909346537e8d60b1580713af1ed4681e6664917", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIwMDA0NQ==", "url": "https://github.com/gridgain/gridgain/pull/1037#discussion_r405200045", "bodyText": "This is an expected behavior. Also, this is not a query, this is API call.", "author": "isapego", "createdAt": "2020-04-08T01:03:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg4NDcyOQ=="}], "type": "inlineReview"}]}