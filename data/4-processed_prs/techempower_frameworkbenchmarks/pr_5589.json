{"pr_number": 5589, "pr_title": "micro optimizations/upgraded fat-free code, optimized nginx settings", "pr_createdAt": "2020-04-08T19:07:39Z", "pr_url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/5589", "timeline": [{"oid": "c4a0a5ab26e91bd156be378ed232d4a0ba803fef", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/c4a0a5ab26e91bd156be378ed232d4a0ba803fef", "message": "micro optimizations to fat-free code, upgraded fat-free, and optimized nginx settings", "committedDate": "2020-04-08T19:05:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjUxNjI0Ng==", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/5589#discussion_r406516246", "bodyText": "That change will be detrimental.\nIt's the number of keealive connections to the php-fpm, per worker processes (1 per cpu core).\n28 cores * 120 = 3,360 keepalive connections.\nphp-fpm only have 1.024 children processes.", "author": "joanhey", "createdAt": "2020-04-09T22:40:42Z", "path": "frameworks/PHP/fat-free/deploy/nginx.conf", "diffHunk": "@@ -42,7 +45,7 @@ http {\n \n     upstream fastcgi_backend {\n         server unix:/var/run/php/php7.3-fpm.sock;\n-        keepalive 40;\n+        keepalive 120;", "originalCommit": "c4a0a5ab26e91bd156be378ed232d4a0ba803fef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjUxNzk1NA==", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/5589#discussion_r406517954", "bodyText": "@joanhey That could be true. I was testing it on my machine and it may be biased towards my machine than on another. I just noticed performance increased when I bumped this number up (but too much and performance sank again).", "author": "n0nag0n", "createdAt": "2020-04-09T22:46:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjUxNjI0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc0MDk2Mg==", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/5589#discussion_r406740962", "bodyText": "Without persistent db connections will have less than 1K req/s.", "author": "joanhey", "createdAt": "2020-04-10T12:44:00Z", "path": "frameworks/PHP/fat-free/index.php", "diffHunk": "@@ -1,36 +1,36 @@\n <?php\n // drop startup errors\n-if (function_exists('error_clear_last'))\n-    error_clear_last();\n+// if (function_exists('error_clear_last'))\n+//     error_clear_last();\n    \n-error_reporting(0);\n+// error_reporting(0);\n \n /** @var Base $f3 */\n $f3=require('src/base.php');\n \n error_reporting(-1);\n \n-$f3->set('DEBUG',2);\n+$f3->set('DEBUG',0);\n $f3->set('HIGHLIGHT',false);\n $f3->set('CACHE','folder=tmp/cache/');\n $f3->set('UI','ui/');\n $f3->set('ONERROR',function($f3){\n     echo $f3->get('ERROR.code').': '.$f3->get('ERROR.text').\"\\n\".$f3->get('ERROR.trace');\n });\n \n-$f3->set('DBS',array('mysql:host=tfb-database;port=3306;dbname=hello_world','benchmarkdbuser','benchmarkdbpass',[PDO::ATTR_PERSISTENT => true]));\n+$f3->set('DBS',array('mysql:host=tfb-database;port=3306;dbname=hello_world','benchmarkdbuser','benchmarkdbpass'));", "originalCommit": "c4a0a5ab26e91bd156be378ed232d4a0ba803fef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjgyODcxMQ==", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/5589#discussion_r406828711", "bodyText": "we can leave that, but it's actually not being used in the rest of the file. The other parts of the file explicitly declare persistent connections. I was just cleaning it up.", "author": "n0nag0n", "createdAt": "2020-04-10T16:14:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc0MDk2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk5NDU4NQ==", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/5589#discussion_r406994585", "bodyText": "DRY and delete it in the other parts.\nAlso use variadic to simplify the code.", "author": "joanhey", "createdAt": "2020-04-11T00:43:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc0MDk2Mg=="}], "type": "inlineReview"}, {"oid": "6dd6e86d54ead93c06a1ed907c7fde12e07e0ec4", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/6dd6e86d54ead93c06a1ed907c7fde12e07e0ec4", "message": "fat-free, fat-free-raw: reverted nginx, converted fortune to raw and orm", "committedDate": "2020-04-13T17:52:32Z", "type": "commit"}]}