{"pr_number": 5867, "pr_title": "\ud83d\udc26[FSharp] Falco - Update benchmark for Falco to v2.0.0", "pr_createdAt": "2020-07-13T14:51:40Z", "pr_url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/5867", "timeline": [{"oid": "bc4205cf92be26d684595789decff08ae7994f27", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/bc4205cf92be26d684595789decff08ae7994f27", "message": "Merge pull request #1 from TechEmpower/master\n\nrebase 2020-07-02", "committedDate": "2020-07-02T15:34:15Z", "type": "commit"}, {"oid": "4edee9d4626aea6c1772f94f387614cf5f935576", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/4edee9d4626aea6c1772f94f387614cf5f935576", "message": "falco v1.2.3", "committedDate": "2020-07-02T18:45:16Z", "type": "commit"}, {"oid": "0d945e0b955339b11f9e6d83141b2172087bcb68", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/0d945e0b955339b11f9e6d83141b2172087bcb68", "message": "Server header, removed meta tag from head", "committedDate": "2020-07-02T18:59:14Z", "type": "commit"}, {"oid": "91303d6b4c02ae25b7b2701b2e64265976296e9d", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/91303d6b4c02ae25b7b2701b2e64265976296e9d", "message": "inline json message to meet spec", "committedDate": "2020-07-02T19:18:15Z", "type": "commit"}, {"oid": "2fb1fcb1a6f86b81267b076ef4908063978d834e", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/2fb1fcb1a6f86b81267b076ef4908063978d834e", "message": "Merge pull request #2 from TechEmpower/master\n\nrebase", "committedDate": "2020-07-13T13:55:07Z", "type": "commit"}, {"oid": "7c5bb02cfd526fab0ad36e4a67cb3990f0b2606a", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/7c5bb02cfd526fab0ad36e4a67cb3990f0b2606a", "message": "[FSharp] - Falco upgraded to v2.0.0", "committedDate": "2020-07-13T14:50:33Z", "type": "commit"}, {"oid": "692ebb139993ffe19b9e0c5e7865a2802b273e83", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/692ebb139993ffe19b9e0c5e7865a2802b273e83", "message": "static mapper for datareader", "committedDate": "2020-07-13T15:02:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc4MzI2Mg==", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/5867#discussion_r453783262", "bodyText": "Can you explain how this works? It doesn't look to me like this would be instantiating and serializing a new object on every request. It looks like it's doing it once and the route /json is just getting this constant value.", "author": "nbrady-techempower", "createdAt": "2020-07-13T16:40:36Z", "path": "frameworks/FSharp/falco/src/App/Value.fs", "diffHunk": "@@ -3,14 +3,12 @@\n open Falco \n \n type JsonOutputModel = { message : string }\n-    \n-module Controller =\n-    let defaultMsg = \"Hello, World!\"\n \n-    let handleJson : HttpHandler =\n-        fun next ctx ->\n-            let json = { message = defaultMsg }\n-            (jsonOut json) next ctx\n+let defaultMsg = \"Hello, World!\"\n+\n+let handleJson : HttpHandler =\n+    { message = defaultMsg }\n+    |> Response.ofJson", "originalCommit": "692ebb139993ffe19b9e0c5e7865a2802b273e83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDAxMTIzNw==", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/5867#discussion_r454011237", "bodyText": "Great question. It does look like a static value. But the HttpContext is thread through it implicitly, so it is recomputed each request. You can see it being transformed into a RequestDelegate here.", "author": "pimbrouwers", "createdAt": "2020-07-13T23:41:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc4MzI2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDAyNTQxOA==", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/5867#discussion_r454025418", "bodyText": "@pimbrouwers That doesn't appear to be working the way you say. To prove this out, I've changed the handleJson HttpHandler to the following:\nlet handleJson : HttpHandler =\n    {\n        message =  System.DateTime.Now.ToLongTimeString()\n    }\n    |> Response.ofJson\nStarting the server in debug mode ./tfb --mode debug --test falco and hitting the following endpoint over the course of a few minutes:\ncurl http://localhost:8080/json\n{\"message\":\"00:13:40\"}\n{\"message\":\"00:13:40\"}\n{\"message\":\"00:13:40\"}\n\nOf course, I would expect to see a new system date on every request.", "author": "nbrady-techempower", "createdAt": "2020-07-14T00:29:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc4MzI2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDI3MTYwMg==", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/5867#discussion_r454271602", "bodyText": "Fascinating!  I wouldn't have expected a partially applied function to behave this way. Will update this PR today!", "author": "pimbrouwers", "createdAt": "2020-07-14T10:53:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc4MzI2Mg=="}], "type": "inlineReview"}, {"oid": "80f050e1f9e795e89c80d7b359bfe3e94d51d0d3", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/80f050e1f9e795e89c80d7b359bfe3e94d51d0d3", "message": "json closure for recomputation", "committedDate": "2020-07-14T11:25:28Z", "type": "commit"}, {"oid": "8550413acf8e955cb3346c1e3df35416094eef2d", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/8550413acf8e955cb3346c1e3df35416094eef2d", "message": "fortune feature reorg", "committedDate": "2020-07-14T11:26:16Z", "type": "commit"}]}