{"pr_number": 5427, "pr_title": "Update lithium. Tune the number of SQL connections.", "pr_createdAt": "2020-01-23T14:41:14Z", "pr_url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/5427", "timeline": [{"oid": "f28f8b83e8d88e0439876974893c3fa80948f733", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/f28f8b83e8d88e0439876974893c3fa80948f733", "message": "Update lithium. Tune the number of SQL connections.", "committedDate": "2020-01-23T14:57:10Z", "type": "commit"}, {"oid": "f933b528aff2c0bf0ea05404b9dd2b3271b262e6", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/f933b528aff2c0bf0ea05404b9dd2b3271b262e6", "message": "Fix compilation.", "committedDate": "2020-01-23T15:13:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIwNzM5OA==", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/pull/5427#discussion_r370207398", "bodyText": "Looks like I missed this before\n1 + rand() % 9999 -> 1 to 9999\nCould you update to 1 + rand() % 10000", "author": "nbrady-techempower", "createdAt": "2020-01-23T16:02:20Z", "path": "frameworks/C++/lithium/lithium.cc", "diffHunk": "@@ -89,49 +100,51 @@ int main(int argc, char* argv[]) {\n   };\n \n   my_api.get(\"/updates\") = [&](http_request& request, http_response& response) {\n+    set_max_sql_connections_per_thread(2);\n     std::string N_str = request.get_parameters(s::N = std::optional<std::string>()).N.value_or(\"1\");\n     int N = atoi(N_str.c_str());\n     N = std::max(1, std::min(N, 500));\n+    std::vector<decltype(random_numbers.all_fields())> numbers(N);\n \n-     \n-    auto c = random_numbers.connect(request.yield);\n-    auto& raw_c = c.backend_connection();\n+    {     \n+      auto c = random_numbers.connect(request.yield);\n+      auto& raw_c = c.backend_connection();\n \n-    std::vector<decltype(random_numbers.all_fields())> numbers(N);\n-    \n+      \n #if TFB_MYSQL\n-    raw_c(\"START TRANSACTION\");\n+      raw_c(\"START TRANSACTION\");\n #endif\n-    for (int i = 0; i < N; i++)\n-    {\n-      numbers[i] = c.find_one(s::id = 1 + rand() % 9999).value();\n-      numbers[i].randomNumber = 1 + rand() % 9999;\n-    }\n+      for (int i = 0; i < N; i++)\n+      {\n+        numbers[i] = c.find_one(s::id = 1 + rand() % 9999).value();\n+        numbers[i].randomNumber = 1 + rand() % 9999;", "originalCommit": "f933b528aff2c0bf0ea05404b9dd2b3271b262e6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5965f4cdc306646b68b158c18a8ce34193d2a7ab", "url": "https://github.com/TechEmpower/FrameworkBenchmarks/commit/5965f4cdc306646b68b158c18a8ce34193d2a7ab", "message": "Lithium: 9999 -> 10000", "committedDate": "2020-01-23T18:11:34Z", "type": "commit"}]}