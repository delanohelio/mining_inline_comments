{"pr_number": 983, "pr_title": "Vsam integration tests", "pr_createdAt": "2020-12-08T13:26:53Z", "pr_url": "https://github.com/zowe/api-layer/pull/983", "timeline": [{"oid": "98ca533410a3addc7d1e87e37d35de9f03e3384d", "url": "https://github.com/zowe/api-layer/commit/98ca533410a3addc7d1e87e37d35de9f03e3384d", "message": "refactor of vsam classes\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-12-08T13:25:23Z", "type": "commit"}, {"oid": "013bb8e64673c83ba33a0d0dc358f5eed83c515d", "url": "https://github.com/zowe/api-layer/commit/013bb8e64673c83ba33a0d0dc358f5eed83c515d", "message": "fix\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-12-08T13:36:41Z", "type": "commit"}, {"oid": "192fc3217b46ab371626eeb7c4c6378481e0414c", "url": "https://github.com/zowe/api-layer/commit/192fc3217b46ab371626eeb7c4c6378481e0414c", "message": "retry\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-12-09T09:21:16Z", "type": "commit"}, {"oid": "0c68afe55ac858a074c3066b2b74f36b63a20e4a", "url": "https://github.com/zowe/api-layer/commit/0c68afe55ac858a074c3066b2b74f36b63a20e4a", "message": "add aop\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-12-09T10:54:16Z", "type": "commit"}, {"oid": "3802dfaf1bbb79eb1b68145727ee4c81eb8acf6d", "url": "https://github.com/zowe/api-layer/commit/3802dfaf1bbb79eb1b68145727ee4c81eb8acf6d", "message": "working serial integration tests\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-12-10T13:23:40Z", "type": "commit"}, {"oid": "944c681eb0a8901d750f0e995cec78855bd09f98", "url": "https://github.com/zowe/api-layer/commit/944c681eb0a8901d750f0e995cec78855bd09f98", "message": "cleanup\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-12-10T14:55:05Z", "type": "commit"}, {"oid": "e3c3ef89e6348d03b27326ab9ff24035549efd3a", "url": "https://github.com/zowe/api-layer/commit/e3c3ef89e6348d03b27326ab9ff24035549efd3a", "message": "Merge branch 'master' into rip/GH863/concurrent-zfile-usage-merge", "committedDate": "2020-12-10T14:56:13Z", "type": "commit"}, {"oid": "bcc1889a2fbef1c08b75420737a1089fcf44e83a", "url": "https://github.com/zowe/api-layer/commit/bcc1889a2fbef1c08b75420737a1089fcf44e83a", "message": "fix nullpointer\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-12-10T15:12:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc4MTgxMA==", "url": "https://github.com/zowe/api-layer/pull/983#discussion_r540781810", "bodyText": "Maybe add a comment if it is intentionally empty?", "author": "balhar-jakub", "createdAt": "2020-12-11T08:45:06Z", "path": "caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamFile.java", "diffHunk": "@@ -17,31 +17,59 @@\n import org.zowe.apiml.zfile.*;\n \n import java.io.Closeable;\n+import java.io.UnsupportedEncodingException;\n+import java.util.*;\n import java.util.regex.Pattern;\n \n /**\n  * ZFile wrapper providing convenience methods and implementing Closeable interface\n- *\n- * Creates a proxy of com.ibm.jzos.ZFileException and wraps it's methods\n- *\n+ * This class is intended for serialized access to VSAM file.\n+ * Concurrency is to be handled by retrying.\n+ * Creates a proxy of com.ibm.jzos.ZFileException and provides high level methods for CRUD operations\n  */\n \n @Slf4j\n-public class VsamFile implements Closeable, ZFile {\n+public class VsamFile implements Closeable {\n \n     private ZFile zfile;\n     private VsamConfig vsamConfig;\n-    private String options = \"ab+,type=record\";\n+    private final VsamConfig.VsamOptions options;\n+\n+    public static final String VSAM_RECORD_ERROR_MESSAGE = \"VsamRecordException occured: {}\";\n+    public static final String RECORD_FOUND_MESSAGE = \"Record found: {}\";\n+    public static final String UNSUPPORTED_ENCODING_MESSAGE = \"Unsupported encoding: {}\";\n+\n     private static final Pattern REGEX_CORRECT_FILENAME = Pattern.compile(\"^\\\\/\\\\/\\\\'.*'\");\n \n-    public VsamFile(VsamConfig config) {\n+    public VsamFile(VsamConfig config, VsamConfig.VsamOptions options) {\n+        this(config, options, false);\n+    }\n+\n+    public VsamFile(VsamConfig config, VsamConfig.VsamOptions options, boolean performWarmup) {\n         if (config == null) {\n             throw new IllegalArgumentException(\"Cannot create VsamFile with null configuration\");\n         }\n+\n         this.vsamConfig = config;\n+        this.options = options;\n+        log.info(\"VsamFile::new with parameters: {}, Vsam options: {}\", this.vsamConfig, this.options);\n+\n+        if (!REGEX_CORRECT_FILENAME.matcher(vsamConfig.getFileName()).find()) {\n+            throw new IllegalArgumentException(\"VsamFile name does not conform to //'VSAM.DATASET.NAME' pattern\");\n+        }\n+\n         try {\n             this.zfile = openZfile();\n-        } catch (ZFileException e) {\n+\n+            if (performWarmup) {\n+                log.info(\"Warming up VSAM file\");\n+                warmUpVsamFile();\n+            } else {\n+", "originalCommit": "bcc1889a2fbef1c08b75420737a1089fcf44e83a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc5MzY2Mw==", "url": "https://github.com/zowe/api-layer/pull/983#discussion_r540793663", "bodyText": "good catch, I removed it", "author": "jandadav", "createdAt": "2020-12-11T09:05:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc4MTgxMA=="}], "type": "inlineReview"}, {"oid": "f307af284e2dd3237e1dba602e249469b18a47b8", "url": "https://github.com/zowe/api-layer/commit/f307af284e2dd3237e1dba602e249469b18a47b8", "message": "remove redundant else and sonar\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-12-11T09:04:43Z", "type": "commit"}, {"oid": "bd647aea2f1c66434231d7d4fa7dda4329874161", "url": "https://github.com/zowe/api-layer/commit/bd647aea2f1c66434231d7d4fa7dda4329874161", "message": "disable js coverage\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-12-11T09:14:55Z", "type": "commit"}, {"oid": "6ab9949807f66f7585d90f7eb919d9de46fccd3a", "url": "https://github.com/zowe/api-layer/commit/6ab9949807f66f7585d90f7eb919d9de46fccd3a", "message": "Add mock zosmf users\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-12-11T09:45:12Z", "type": "commit"}, {"oid": "f753c2d163327db184806091f0e8b74d5b5bcae8", "url": "https://github.com/zowe/api-layer/commit/f753c2d163327db184806091f0e8b74d5b5bcae8", "message": "jenkinsfile error fix\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-12-11T09:50:09Z", "type": "commit"}, {"oid": "ea7269d038f44c8f9424156e0c3811588d18768e", "url": "https://github.com/zowe/api-layer/commit/ea7269d038f44c8f9424156e0c3811588d18768e", "message": "jenkinsfile disable archiving UI test resutlts\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-12-11T10:05:41Z", "type": "commit"}, {"oid": "e4fbe8a33609db316c2d1bcea8d2922ebf41ef2d", "url": "https://github.com/zowe/api-layer/commit/e4fbe8a33609db316c2d1bcea8d2922ebf41ef2d", "message": "jenkinsfile disable archiving UI test resutlts\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-12-11T10:18:53Z", "type": "commit"}, {"oid": "a0daec76dbb8f9737db649bd813f7a8ec2c379fd", "url": "https://github.com/zowe/api-layer/commit/a0daec76dbb8f9737db649bd813f7a8ec2c379fd", "message": "Merge branch 'master' into rip/GH863/concurrent-zfile-usage-merge", "committedDate": "2020-12-11T12:10:05Z", "type": "commit"}, {"oid": "ffb6d423b01fe28fc6e0bdfa4ced6fbb6ad4964c", "url": "https://github.com/zowe/api-layer/commit/ffb6d423b01fe28fc6e0bdfa4ced6fbb6ad4964c", "message": "reintroduce js coverage\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-12-11T12:11:22Z", "type": "commit"}]}