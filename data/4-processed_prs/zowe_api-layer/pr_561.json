{"pr_number": 561, "pr_title": "Endpoints to get public keys for JWT verification (z/OSMF and Zowe)", "pr_createdAt": "2020-03-17T17:14:44Z", "pr_url": "https://github.com/zowe/api-layer/pull/561", "timeline": [{"oid": "e7ce6dc3c72750559a20405acaaaf397f9142858", "url": "https://github.com/zowe/api-layer/commit/e7ce6dc3c72750559a20405acaaaf397f9142858", "message": "endpoints to get public keys for JWT verification (z/OSMF and Zowe)\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>", "committedDate": "2020-03-17T17:10:22Z", "type": "commit"}, {"oid": "8c8be049d8919a50623823c7f0c6c39d8ba57010", "url": "https://github.com/zowe/api-layer/commit/8c8be049d8919a50623823c7f0c6c39d8ba57010", "message": "Merge branch 'master' into protectors/publicKeysEndpoints", "committedDate": "2020-03-17T17:15:54Z", "type": "commit"}, {"oid": "a8920b2c08481f4016c3dec396c8d53490aa8ed4", "url": "https://github.com/zowe/api-layer/commit/a8920b2c08481f4016c3dec396c8d53490aa8ed4", "message": "swagger to new endpoints\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>", "committedDate": "2020-03-18T14:53:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM1NDE3Mw==", "url": "https://github.com/zowe/api-layer/pull/561#discussion_r394354173", "bodyText": "When you are using @RestController there is no need to mention @ResponseBody\n@Target(ElementType.TYPE)\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Controller\n@ResponseBody\npublic @interface RestController {", "author": "ilkinabdullayev", "createdAt": "2020-03-18T13:42:20Z", "path": "gateway-service/src/main/java/org/zowe/apiml/gateway/controllers/AuthController.java", "diffHunk": "@@ -56,4 +66,26 @@ public void distributeInvalidate(HttpServletRequest request, HttpServletResponse\n         response.setStatus(distributed ? SC_OK : SC_NO_CONTENT);\n     }\n \n+    @GetMapping(path = \"/keys/public/all\")", "originalCommit": "8c8be049d8919a50623823c7f0c6c39d8ba57010", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM1ODU0NQ==", "url": "https://github.com/zowe/api-layer/pull/561#discussion_r394358545", "bodyText": "may I ask why long path?", "author": "ilkinabdullayev", "createdAt": "2020-03-18T13:48:43Z", "path": "gateway-service/src/main/java/org/zowe/apiml/gateway/controllers/AuthController.java", "diffHunk": "@@ -9,29 +9,39 @@\n  */\n package org.zowe.apiml.gateway.controllers;\n \n-import lombok.AllArgsConstructor;\n-import org.springframework.web.bind.annotation.DeleteMapping;\n-import org.springframework.web.bind.annotation.GetMapping;\n-import org.springframework.web.bind.annotation.RequestMapping;\n-import org.springframework.web.bind.annotation.RestController;\n+import com.nimbusds.jose.jwk.JWK;\n+import com.nimbusds.jose.jwk.JWKSet;\n+import lombok.RequiredArgsConstructor;\n+import net.minidev.json.JSONObject;\n+import org.springframework.web.bind.annotation.*;\n import org.zowe.apiml.gateway.security.service.AuthenticationService;\n+import org.zowe.apiml.gateway.security.service.JwtSecurityInitializer;\n+import org.zowe.apiml.gateway.security.service.zosmf.ZosmfServiceFacade;\n \n import javax.servlet.http.HttpServletRequest;\n import javax.servlet.http.HttpServletResponse;\n+import java.util.LinkedList;\n+import java.util.List;\n \n import static org.apache.http.HttpStatus.*;\n \n /**\n  * Controller offer method to control security. It can contains method for user and also method for calling services\n  * by gateway to distribute state of authentication between nodes.\n  */\n-@AllArgsConstructor\n+@RequiredArgsConstructor\n @RestController\n @RequestMapping(\"/auth\")\n public class AuthController {\n \n+    @org.springframework.beans.factory.annotation.Value(\"${apiml.security.zosmf.useJwtToken:true}\")", "originalCommit": "8c8be049d8919a50623823c7f0c6c39d8ba57010", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMwMDMwNw==", "url": "https://github.com/zowe/api-layer/pull/561#discussion_r396300307", "bodyText": "because here is a conflict between @value annotation  in Lombok and Spring", "author": "pj892031", "createdAt": "2020-03-23T09:07:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM1ODU0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI1NDQzNA==", "url": "https://github.com/zowe/api-layer/pull/561#discussion_r397254434", "bodyText": "i tried it is working well\n@Value(\"${apiml.security.zosmf.useJwtToken:true}\")", "author": "ilkinabdullayev", "createdAt": "2020-03-24T15:43:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM1ODU0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM3MTk0Mg==", "url": "https://github.com/zowe/api-layer/pull/561#discussion_r394371942", "bodyText": "May I ask why you prefer inheritance to test class, you can simply test by creating Setter method for useZosmfJwtToken. So basically this field has protected access level only for test?", "author": "ilkinabdullayev", "createdAt": "2020-03-18T14:07:17Z", "path": "gateway-service/src/main/java/org/zowe/apiml/gateway/controllers/AuthController.java", "diffHunk": "@@ -9,29 +9,39 @@\n  */\n package org.zowe.apiml.gateway.controllers;\n \n-import lombok.AllArgsConstructor;\n-import org.springframework.web.bind.annotation.DeleteMapping;\n-import org.springframework.web.bind.annotation.GetMapping;\n-import org.springframework.web.bind.annotation.RequestMapping;\n-import org.springframework.web.bind.annotation.RestController;\n+import com.nimbusds.jose.jwk.JWK;\n+import com.nimbusds.jose.jwk.JWKSet;\n+import lombok.RequiredArgsConstructor;\n+import net.minidev.json.JSONObject;\n+import org.springframework.web.bind.annotation.*;\n import org.zowe.apiml.gateway.security.service.AuthenticationService;\n+import org.zowe.apiml.gateway.security.service.JwtSecurityInitializer;\n+import org.zowe.apiml.gateway.security.service.zosmf.ZosmfServiceFacade;\n \n import javax.servlet.http.HttpServletRequest;\n import javax.servlet.http.HttpServletResponse;\n+import java.util.LinkedList;\n+import java.util.List;\n \n import static org.apache.http.HttpStatus.*;\n \n /**\n  * Controller offer method to control security. It can contains method for user and also method for calling services\n  * by gateway to distribute state of authentication between nodes.\n  */\n-@AllArgsConstructor\n+@RequiredArgsConstructor\n @RestController\n @RequestMapping(\"/auth\")\n public class AuthController {\n \n+    @org.springframework.beans.factory.annotation.Value(\"${apiml.security.zosmf.useJwtToken:true}\")\n+    protected boolean useZosmfJwtToken;", "originalCommit": "8c8be049d8919a50623823c7f0c6c39d8ba57010", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMwMDc3MQ==", "url": "https://github.com/zowe/api-layer/pull/561#discussion_r396300771", "bodyText": "I thought about more changes, then there was only this setter, i changed it in the last commit", "author": "pj892031", "createdAt": "2020-03-23T09:07:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM3MTk0Mg=="}], "type": "inlineReview"}, {"oid": "6e133532f76725b2b4b6e2ed086f9d83d47152a3", "url": "https://github.com/zowe/api-layer/commit/6e133532f76725b2b4b6e2ed086f9d83d47152a3", "message": "Merge branch 'master' into protectors/publicKeysEndpoints", "committedDate": "2020-03-20T07:29:56Z", "type": "commit"}, {"oid": "040aa34c44fe82fcc161939dd798382dc7886104", "url": "https://github.com/zowe/api-layer/commit/040aa34c44fe82fcc161939dd798382dc7886104", "message": "Merge branch 'master' into protectors/publicKeysEndpoints", "committedDate": "2020-03-23T09:09:56Z", "type": "commit"}, {"oid": "19046ea32228a4a9406d284599709c07c34a0c55", "url": "https://github.com/zowe/api-layer/commit/19046ea32228a4a9406d284599709c07c34a0c55", "message": "use path /api/v1/gateway on AuthController and CacheController, reviews improvements, add missing response codes\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>", "committedDate": "2020-03-23T10:19:24Z", "type": "commit"}, {"oid": "6ca79e3de9ef1b9a08b2abde40d236ed49795475", "url": "https://github.com/zowe/api-layer/commit/6ca79e3de9ef1b9a08b2abde40d236ed49795475", "message": "fix integration tests\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>", "committedDate": "2020-03-23T12:27:37Z", "type": "commit"}, {"oid": "165bdca4b027c1d7f925d3510f5a582528702fd1", "url": "https://github.com/zowe/api-layer/commit/165bdca4b027c1d7f925d3510f5a582528702fd1", "message": "fix path of api-doc\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>", "committedDate": "2020-03-23T13:32:19Z", "type": "commit"}, {"oid": "a0d0ea6cf6be395e1c6e979f2a969ae8c38444a6", "url": "https://github.com/zowe/api-layer/commit/a0d0ea6cf6be395e1c6e979f2a969ae8c38444a6", "message": "fix missing routing of Gateway in API Catalog\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>", "committedDate": "2020-03-23T17:02:07Z", "type": "commit"}, {"oid": "a2d998c6746301a1e679ee11835a666cb8c5132a", "url": "https://github.com/zowe/api-layer/commit/a2d998c6746301a1e679ee11835a666cb8c5132a", "message": "attempt to fix long and long url in Gateway, should fix integration tests\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>", "committedDate": "2020-03-24T14:53:02Z", "type": "commit"}, {"oid": "0051b7fce6e59241bc0dacd048b1bc96a72a8e2f", "url": "https://github.com/zowe/api-layer/commit/0051b7fce6e59241bc0dacd048b1bc96a72a8e2f", "message": "easy using of annotation @Value\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>", "committedDate": "2020-03-24T17:09:08Z", "type": "commit"}, {"oid": "a9cf2010a20415040a786babf0cf489dbaae109b", "url": "https://github.com/zowe/api-layer/commit/a9cf2010a20415040a786babf0cf489dbaae109b", "message": "fix openAPI for catalog (remove duplicity of gateway path)\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>", "committedDate": "2020-03-25T16:28:15Z", "type": "commit"}, {"oid": "a9cf2010a20415040a786babf0cf489dbaae109b", "url": "https://github.com/zowe/api-layer/commit/a9cf2010a20415040a786babf0cf489dbaae109b", "message": "fix openAPI for catalog (remove duplicity of gateway path)\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>", "committedDate": "2020-03-25T16:28:15Z", "type": "forcePushed"}, {"oid": "7e896fcc591ac09f7dd388208b7760cd052b9ed1", "url": "https://github.com/zowe/api-layer/commit/7e896fcc591ac09f7dd388208b7760cd052b9ed1", "message": "Merge branch 'master' into protectors/publicKeysEndpoints", "committedDate": "2020-03-26T17:54:39Z", "type": "commit"}, {"oid": "b6bfbabf040e059ea5f2ef7b6b6b1bcb543eac8c", "url": "https://github.com/zowe/api-layer/commit/b6bfbabf040e059ea5f2ef7b6b6b1bcb543eac8c", "message": "Merge branch 'master' into protectors/publicKeysEndpoints", "committedDate": "2020-03-27T13:51:16Z", "type": "commit"}, {"oid": "4a44be1aab1eb6833be20a6e121ab6c604d1e3fd", "url": "https://github.com/zowe/api-layer/commit/4a44be1aab1eb6833be20a6e121ab6c604d1e3fd", "message": "Merge branch 'master' into protectors/publicKeysEndpoints", "committedDate": "2020-03-31T08:50:23Z", "type": "commit"}, {"oid": "d1a9b2ed7744cc19f3529fa5c143aebe18d5dc1b", "url": "https://github.com/zowe/api-layer/commit/d1a9b2ed7744cc19f3529fa5c143aebe18d5dc1b", "message": "Merge branch 'master' into protectors/publicKeysEndpoints", "committedDate": "2020-04-09T09:16:21Z", "type": "commit"}, {"oid": "5119f8cbcbd3e9b37b1edf7862f9f45f639abdf3", "url": "https://github.com/zowe/api-layer/commit/5119f8cbcbd3e9b37b1edf7862f9f45f639abdf3", "message": "consolidate URL to same style (same like VersionController)\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>", "committedDate": "2020-04-09T10:15:15Z", "type": "commit"}, {"oid": "16d7d20d77cdd2890bc14bcc2ea6daa2fd1e8d91", "url": "https://github.com/zowe/api-layer/commit/16d7d20d77cdd2890bc14bcc2ea6daa2fd1e8d91", "message": "Merge branch 'master' into protectors/publicKeysEndpoints", "committedDate": "2020-04-09T13:12:08Z", "type": "commit"}, {"oid": "8e6cbdc5bacca2c2cd0a44a52e203cd0f1644570", "url": "https://github.com/zowe/api-layer/commit/8e6cbdc5bacca2c2cd0a44a52e203cd0f1644570", "message": "Explain NOSONAR usage\n\nSigned-off-by: Petr Plavjanik <petr.plavjanik@broadcom.com>", "committedDate": "2020-04-09T17:23:33Z", "type": "commit"}, {"oid": "6d7e7cbe7edf9ba7c111f61e2cf0a475415ad35b", "url": "https://github.com/zowe/api-layer/commit/6d7e7cbe7edf9ba7c111f61e2cf0a475415ad35b", "message": "fix certificate validation for all endpoints\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>", "committedDate": "2020-04-09T20:44:23Z", "type": "commit"}, {"oid": "efe5fe6fd5d31227875951e36d80ca6d56735e22", "url": "https://github.com/zowe/api-layer/commit/efe5fe6fd5d31227875951e36d80ca6d56735e22", "message": "Deduplicate subjectPrincipalRegex value\n\nSigned-off-by: Petr Plavjanik <petr.plavjanik@broadcom.com>", "committedDate": "2020-04-10T05:58:44Z", "type": "commit"}, {"oid": "8818224d9f84ad8fd149e3ca40f98f3e13973346", "url": "https://github.com/zowe/api-layer/commit/8818224d9f84ad8fd149e3ca40f98f3e13973346", "message": "Merge branch 'master' into protectors/publicKeysEndpoints", "committedDate": "2020-04-14T09:26:31Z", "type": "commit"}]}