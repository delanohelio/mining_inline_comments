{"pr_number": 201, "pr_title": "[MOB-1221] Sample app for Inbox customizations", "pr_createdAt": "2020-02-24T01:22:58Z", "pr_url": "https://github.com/Iterable/iterable-android-sdk/pull/201", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzEwMjUwNg==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/201#discussion_r383102506", "bodyText": "Too good!!!", "author": "Ayyanchira", "createdAt": "2020-02-24T06:41:45Z", "path": "sample-apps/inbox-customization/app/src/main/java/com/iterable/inbox_customization/util/DataManager.kt", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.iterable.inbox_customization.util\n+\n+import android.content.Context\n+import android.os.StrictMode\n+import com.iterable.iterableapi.IterableApi\n+import com.iterable.iterableapi.IterableInternal\n+import okhttp3.mockwebserver.MockResponse\n+import okhttp3.mockwebserver.MockWebServer\n+import okio.Buffer\n+import okio.source\n+\n+class DataManager {\n+    var context: Context? = null\n+    val server = MockWebServer()\n+    val serverUrl: String\n+    val dispatcher = PathBasedStaticDispatcher()\n+\n+    init {\n+        // Required for `server.url(\"\")` to work on main thread without throwing an exception\n+        // DO NOT USE THIS in production. This is for demo purposes only.\n+        StrictMode.setThreadPolicy(StrictMode.ThreadPolicy.Builder().permitAll().build())\n+\n+        server.dispatcher = dispatcher\n+        serverUrl = server.url(\"\").toString()\n+    }\n+\n+    fun initializeIterableApi(context: Context) {\n+        this.context = context\n+        initHttpMocks()\n+        IterableApi.overrideURLEndpointPath(serverUrl)\n+        IterableApi.initialize(context, \"apiKey\")\n+        IterableApi.getInstance().setEmail(\"user@example.com\")\n+        loadData(\"simple-inbox-messages.json\")\n+    }\n+\n+    fun initHttpMocks() {\n+        loadFileMock(\"mocha.png\")\n+        loadFileMock(\"black-coffee.png\")\n+        loadFileMock(\"cappuccino.png\")\n+        loadFileMock(\"latte.png\")\n+    }\n+\n+    fun loadFileMock(imageName: String) {\n+        val buffer = Buffer()\n+        context!!.resources.assets.open(imageName).source().use {\n+            buffer.writeAll(it)\n+        }\n+        dispatcher.setResponse(\"/$imageName\", MockResponse().setBody(buffer))\n+    }\n+\n+    companion object {\n+        val instance = DataManager()\n+\n+        fun initializeIterableApi(context: Context) {\n+            instance.initializeIterableApi(context)\n+        }\n+\n+        fun loadData(resourceName: String) {\n+            val body = getAssetString(resourceName).replace(\"https://somewhere.com/\", instance.serverUrl)\n+            instance.dispatcher.setResponse(\"/inApp/getMessages\", MockResponse().setBody(body))\n+            IterableInternal.syncInApp()", "originalCommit": "54061f00a8e319b1c1295c5438b349786a7c2baf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzExMTk1MQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/201#discussion_r383111951", "bodyText": "\ud83d\udc4c", "author": "Ayyanchira", "createdAt": "2020-02-24T07:27:37Z", "path": "sample-apps/inbox-customization/app/src/main/java/com/iterable/inbox_customization/customizations/MultipleCellTypes.kt", "diffHunk": "@@ -0,0 +1,63 @@\n+package com.iterable.inbox_customization.customizations\n+\n+import android.os.Bundle\n+import android.text.format.DateUtils\n+import android.view.View\n+import com.iterable.inbox_customization.MainFragment\n+import com.iterable.inbox_customization.R\n+import com.iterable.inbox_customization.util.DataManager\n+import com.iterable.inbox_customization.util.SingleFragmentActivity\n+import com.iterable.iterableapi.IterableInAppMessage\n+import com.iterable.iterableapi.ui.inbox.IterableInboxAdapter\n+import com.iterable.iterableapi.ui.inbox.IterableInboxAdapterExtension\n+import com.iterable.iterableapi.ui.inbox.IterableInboxFragment\n+import java.util.*\n+\n+fun MainFragment.onInboxWithMultipleCellTypesClicked() {\n+    DataManager.loadData(\"inbox-with-multiple-cell-types-messages.json\")\n+    val intent = SingleFragmentActivity.createIntentWithFragment(\n+        activity!!,\n+        MultipleCellTypesInboxFragment::class.java\n+    )\n+    startActivity(intent)\n+}\n+\n+class MultipleCellTypesInboxFragment : IterableInboxFragment(),\n+    IterableInboxAdapterExtension<Nothing> {\n+\n+    val ITEM_TYPE_DEFAULT = 0\n+    val ITEM_TYPE_LIGHT = 1\n+    val ITEM_TYPE_DARK = 2\n+\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        setAdapterExtension(this)\n+    }\n+\n+    override fun getItemViewType(message: IterableInAppMessage): Int {\n+        return when (message.customPayload.optString(\"messageType\")) {\n+            \"light\" -> ITEM_TYPE_LIGHT\n+            \"dark\" -> ITEM_TYPE_DARK\n+            else -> ITEM_TYPE_DEFAULT\n+        }\n+    }\n+", "originalCommit": "54061f00a8e319b1c1295c5438b349786a7c2baf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzEyNzQyMg==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/201#discussion_r383127422", "bodyText": "\ud83d\udc4c", "author": "Ayyanchira", "createdAt": "2020-02-24T08:23:35Z", "path": "sample-apps/inbox-customization/app/src/main/java/com/iterable/inbox_customization/util/PathBasedStaticDispatcher.kt", "diffHunk": "@@ -0,0 +1,42 @@\n+package com.iterable.inbox_customization.util\n+\n+import okhttp3.mockwebserver.Dispatcher\n+import okhttp3.mockwebserver.MockResponse\n+import okhttp3.mockwebserver.RecordedRequest\n+import java.util.*\n+\n+class PathBasedStaticDispatcher : Dispatcher() {", "originalCommit": "54061f00a8e319b1c1295c5438b349786a7c2baf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a6d28d348d4b18e2103253626d1fabb91dcb35a5", "url": "https://github.com/Iterable/iterable-android-sdk/commit/a6d28d348d4b18e2103253626d1fabb91dcb35a5", "message": "Sample app for Inbox customizations", "committedDate": "2020-02-24T20:35:42Z", "type": "forcePushed"}, {"oid": "55186a24ab5e1e168d7ee66d7c06d6e73a580a25", "url": "https://github.com/Iterable/iterable-android-sdk/commit/55186a24ab5e1e168d7ee66d7c06d6e73a580a25", "message": "Sample app for Inbox customizations", "committedDate": "2020-02-24T20:44:49Z", "type": "commit"}, {"oid": "55186a24ab5e1e168d7ee66d7c06d6e73a580a25", "url": "https://github.com/Iterable/iterable-android-sdk/commit/55186a24ab5e1e168d7ee66d7c06d6e73a580a25", "message": "Sample app for Inbox customizations", "committedDate": "2020-02-24T20:44:49Z", "type": "forcePushed"}]}