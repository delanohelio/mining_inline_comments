{"pr_number": 184, "pr_title": "[MOB-1003] Inbox Customization", "pr_createdAt": "2020-01-24T00:20:39Z", "pr_url": "https://github.com/Iterable/iterable-android-sdk/pull/184", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg1NzIxNQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/184#discussion_r370857215", "bodyText": "filter.filter is very confusing.", "author": "Ayyanchira", "createdAt": "2020-01-24T21:47:50Z", "path": "iterableapi-ui/src/main/java/com/iterable/iterableapi/ui/inbox/IterableInboxAdapter.java", "diffHunk": "@@ -178,8 +193,16 @@ public int hashCode() {\n     private List<InboxRow> inboxRowListFromInboxMessages(List<IterableInAppMessage> messages) {\n         ArrayList<InboxRow> inboxRows = new ArrayList<>(messages.size());\n         for (IterableInAppMessage message : messages) {\n-            inboxRows.add(new InboxRow(message));\n+            if (filter.filter(message)) {", "originalCommit": "5c86cdb3e81b1848d1161b4399a1aecec0f6a024", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2MzU2OA==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/184#discussion_r370863568", "bodyText": "Just a thought : A filter applies per message while a comparator is something which needs to be set only once for entire set of messages.\nHow would it look like if we then pass the comparator to IterableInboxFragment and not have interface approach there? may be like this.setComparator(comparator)?", "author": "Ayyanchira", "createdAt": "2020-01-24T22:06:04Z", "path": "iterableapi-ui/src/main/java/com/iterable/iterableapi/ui/inbox/IterableInboxAdapter.java", "diffHunk": "@@ -178,8 +193,16 @@ public int hashCode() {\n     private List<InboxRow> inboxRowListFromInboxMessages(List<IterableInAppMessage> messages) {\n         ArrayList<InboxRow> inboxRows = new ArrayList<>(messages.size());\n         for (IterableInAppMessage message : messages) {\n-            inboxRows.add(new InboxRow(message));\n+            if (filter.filter(message)) {\n+                inboxRows.add(new InboxRow(message));\n+            }\n         }\n+        Collections.sort(inboxRows, new Comparator<InboxRow>() {\n+            @Override\n+            public int compare(InboxRow o1, InboxRow o2) {\n+                return comparator.compare(o1.message, o2.message);", "originalCommit": "5c86cdb3e81b1848d1161b4399a1aecec0f6a024", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQzNzA0MA==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/184#discussion_r371437040", "bodyText": "Does Android support @FunctionalInterface?", "author": "tapashmajumder", "createdAt": "2020-01-27T19:29:12Z", "path": "iterableapi-ui/src/main/java/com/iterable/iterableapi/ui/inbox/IterableInboxFilter.java", "diffHunk": "@@ -0,0 +1,9 @@\n+package com.iterable.iterableapi.ui.inbox;\n+\n+import android.support.annotation.NonNull;\n+\n+import com.iterable.iterableapi.IterableInAppMessage;\n+\n+public interface IterableInboxFilter {", "originalCommit": "5c86cdb3e81b1848d1161b4399a1aecec0f6a024", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ0MjcwOQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/184#discussion_r371442709", "bodyText": "Beginning with API 24, and our minimum API level is 15...", "author": "vbabenkoru", "createdAt": "2020-01-27T19:40:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQzNzA0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ0MDI1MQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/184#discussion_r371440251", "bodyText": "Just curious. Not a comment. This seems to be too verbose. Does Android support lambda expressions.", "author": "tapashmajumder", "createdAt": "2020-01-27T19:35:29Z", "path": "iterableapi-ui/src/main/java/com/iterable/iterableapi/ui/inbox/IterableInboxAdapter.java", "diffHunk": "@@ -178,8 +193,16 @@ public int hashCode() {\n     private List<InboxRow> inboxRowListFromInboxMessages(List<IterableInAppMessage> messages) {\n         ArrayList<InboxRow> inboxRows = new ArrayList<>(messages.size());\n         for (IterableInAppMessage message : messages) {\n-            inboxRows.add(new InboxRow(message));\n+            if (filter.filter(message)) {\n+                inboxRows.add(new InboxRow(message));\n+            }\n         }\n+        Collections.sort(inboxRows, new Comparator<InboxRow>() {", "originalCommit": "5c86cdb3e81b1848d1161b4399a1aecec0f6a024", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ0MTk3Mw==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/184#discussion_r371441973", "bodyText": "It does support lambda expressions if using java > 8.0 or Kotlin.", "author": "Ayyanchira", "createdAt": "2020-01-27T19:38:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ0MDI1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ0MjIzNw==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/184#discussion_r371442237", "bodyText": "It does or it does not, depending on the version of the build tools. Android runtime is still considered Java 6, so you have to use a desugaring compiler to transform Java 8 lambdas into Java 6 constructs. It'd be an easy 'yes' if this were a mobile app, but for a library I'm not exactly sure if we can use lambdas safely.", "author": "vbabenkoru", "createdAt": "2020-01-27T19:39:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ0MDI1MQ=="}], "type": "inlineReview"}, {"oid": "d205c8f680c468eb8d7433d108b2b672c8e2fbd6", "url": "https://github.com/Iterable/iterable-android-sdk/commit/d205c8f680c468eb8d7433d108b2b672c8e2fbd6", "message": "Add an adapter extension, comparator and filter to customize Inbox", "committedDate": "2020-01-29T20:39:59Z", "type": "forcePushed"}, {"oid": "23eaf1cf7cc20616736af73002d0a8b0def197ca", "url": "https://github.com/Iterable/iterable-android-sdk/commit/23eaf1cf7cc20616736af73002d0a8b0def197ca", "message": "Add an adapter extension, comparator and filter to customize Inbox", "committedDate": "2020-01-30T00:18:55Z", "type": "forcePushed"}, {"oid": "b0921c06e5dea38b817bd5d96ee5a7002203842b", "url": "https://github.com/Iterable/iterable-android-sdk/commit/b0921c06e5dea38b817bd5d96ee5a7002203842b", "message": "Add an adapter extension, comparator and filter to customize Inbox", "committedDate": "2020-01-30T00:43:56Z", "type": "commit"}, {"oid": "b0921c06e5dea38b817bd5d96ee5a7002203842b", "url": "https://github.com/Iterable/iterable-android-sdk/commit/b0921c06e5dea38b817bd5d96ee5a7002203842b", "message": "Add an adapter extension, comparator and filter to customize Inbox", "committedDate": "2020-01-30T00:43:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzExNjQ1MA==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/184#discussion_r373116450", "bodyText": "Not sure, but will there be scenario where adaptor values need to be changed without destroying it?", "author": "Ayyanchira", "createdAt": "2020-01-30T18:26:03Z", "path": "iterableapi-ui/src/main/java/com/iterable/iterableapi/ui/inbox/IterableInboxAdapter.java", "diffHunk": "@@ -19,21 +19,28 @@\n \n import java.text.DateFormat;\n import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.Comparator;\n import java.util.Date;\n import java.util.List;\n \n public class IterableInboxAdapter extends RecyclerView.Adapter<IterableInboxAdapter.ViewHolder> {\n \n     private static final String TAG = \"IterableInboxAdapter\";\n-    private final @LayoutRes int itemLayoutId;\n+\n+    private final @NonNull OnListInteractionListener listener;\n+    private final @NonNull IterableInboxAdapterExtension extension;\n+    private final @NonNull IterableInboxComparator comparator;\n+    private final @NonNull IterableInboxFilter filter;", "originalCommit": "b0921c06e5dea38b817bd5d96ee5a7002203842b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEzOTg1Ng==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/184#discussion_r373139856", "bodyText": "There shouldn't be. Since the Fragment can be destroyed and created again with just arguments, we should limit what can be modified on the Adapter or the Fragment I think..", "author": "vbabenkoru", "createdAt": "2020-01-30T19:11:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzExNjQ1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE2OTYxOQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/184#discussion_r373169619", "bodyText": "I\u2019m actually thinking about making these setters protected so they can only be called from a subclass..", "author": "vbabenkoru", "createdAt": "2020-01-30T20:12:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzExNjQ1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE5NTMwMg==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/184#discussion_r373195302", "bodyText": "That sounds good \ud83d\udc4d", "author": "Ayyanchira", "createdAt": "2020-01-30T21:10:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzExNjQ1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEzMjA5NQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/184#discussion_r373132095", "bodyText": "Now I second on moving to Kotlin \ud83d\ude01", "author": "Ayyanchira", "createdAt": "2020-01-30T18:57:03Z", "path": "iterableapi-ui/src/main/java/com/iterable/iterableapi/ui/inbox/IterableInboxAdapter.java", "diffHunk": "@@ -44,28 +51,50 @@ public void onClick(View v) {\n         }\n     };\n \n+    @Override\n+    public int getItemViewType(int position) {\n+        return extension.getItemViewType(inboxItems.get(position).message);\n+    }\n+\n     @NonNull\n     @Override\n     public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {\n-        View view = LayoutInflater.from(parent.getContext()).inflate(itemLayoutId, parent, false);\n-        return new ViewHolder(view);\n+        View view = LayoutInflater.from(parent.getContext()).inflate(extension.getLayoutForViewType(viewType), parent, false);\n+        return new ViewHolder(view, extension.createViewHolderExtension(view, viewType));\n     }\n \n     @Override\n     public void onBindViewHolder(@NonNull ViewHolder holder, int position) {\n         InboxRow inboxRow = inboxItems.get(position);\n         IterableInAppMessage.InboxMetadata inboxMetadata = inboxRow.inboxMetadata;\n-        holder.title.setText(inboxMetadata.title);\n-        holder.subtitle.setText(inboxMetadata.subtitle);\n-        BitmapLoader.loadBitmap(holder.icon, Uri.parse(inboxMetadata.icon));\n-        if (inboxRow.isRead) {\n-            holder.unreadIndicator.setVisibility(View.INVISIBLE);\n-        } else {\n-            holder.unreadIndicator.setVisibility(View.VISIBLE);\n+\n+        if (holder.title != null) {\n+            holder.title.setText(inboxMetadata.title);\n+        }\n+\n+        if (holder.subtitle != null) {\n+            holder.subtitle.setText(inboxMetadata.subtitle);\n         }\n-        holder.date.setText(formatDate(inboxRow.createdAt));\n+\n+        if (holder.icon != null) {\n+            BitmapLoader.loadBitmap(holder.icon, Uri.parse(inboxMetadata.icon));\n+        }\n+\n+        if (holder.unreadIndicator != null) {\n+            if (inboxRow.isRead) {\n+                holder.unreadIndicator.setVisibility(View.INVISIBLE);\n+            } else {\n+                holder.unreadIndicator.setVisibility(View.VISIBLE);\n+            }\n+        }\n+\n+        if (holder.date != null) {\n+            holder.date.setText(formatDate(inboxRow.createdAt));\n+        }", "originalCommit": "b0921c06e5dea38b817bd5d96ee5a7002203842b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEzOTM4Mw==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/184#discussion_r373139383", "bodyText": "haha", "author": "vbabenkoru", "createdAt": "2020-01-30T19:10:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEzMjA5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE2NDQxMg==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/184#discussion_r373164412", "bodyText": "message2 compareTo message1 can help us get rid of the minus(-) prefix", "author": "Ayyanchira", "createdAt": "2020-01-30T20:00:52Z", "path": "iterableapi-ui/src/main/java/com/iterable/iterableapi/ui/inbox/IterableInboxFragment.java", "diffHunk": "@@ -148,35 +193,65 @@ public void onListItemTapped(IterableInAppMessage message) {\n     }\n \n     @Override\n-    public void onListItemDeleted(IterableInAppMessage message, IterableInAppDeleteActionType source) {\n+    public void onListItemDeleted(@NonNull IterableInAppMessage message, @NonNull IterableInAppDeleteActionType source) {\n         IterableApi.getInstance().getInAppManager().removeMessage(message, source, IterableInAppLocation.INBOX);\n     }\n \n     @Override\n-    public void onListItemImpressionStarted(IterableInAppMessage message) {\n+    public void onListItemImpressionStarted(@NonNull IterableInAppMessage message) {\n         sessionManager.onMessageImpressionStarted(message);\n     }\n \n     @Override\n-    public void onListItemImpressionEnded(IterableInAppMessage message) {\n+    public void onListItemImpressionEnded(@NonNull IterableInAppMessage message) {\n         sessionManager.onMessageImpressionEnded(message);\n     }\n \n-    public InboxMode getInboxMode() {\n-        return inboxMode;\n+    /**\n+     * Default implementation of the adapter extension. Does nothing other than returning\n+     * the value of {@link IterableInboxFragment#itemLayoutId} for the view layout\n+     */\n+    private class DefaultAdapterExtension implements IterableInboxAdapterExtension<Object> {\n+        @Override\n+        public int getItemViewType(@NonNull IterableInAppMessage message) {\n+            return 0;\n+        }\n+\n+        @Override\n+        public int getLayoutForViewType(int viewType) {\n+            return itemLayoutId;\n+        }\n+\n+        @Nullable\n+        @Override\n+        public Object createViewHolderExtension(@NonNull View view, int viewType) {\n+            return null;\n+        }\n+\n+        @Override\n+        public void onBindViewHolder(@NonNull IterableInboxAdapter.ViewHolder viewHolder, @Nullable Object holderExtension, @NonNull IterableInAppMessage message) {\n+\n+        }\n     }\n \n-    public void setInboxMode(InboxMode inboxMode) {\n-        this.inboxMode = inboxMode;\n+    /**\n+     * Default implementation of the comparator: descending by creation date\n+     */\n+    private static class DefaultInboxComparator implements IterableInboxComparator {\n+        @Override\n+        public int compare(@NonNull IterableInAppMessage message1, @NonNull IterableInAppMessage message2) {\n+            return -message1.getCreatedAt().compareTo(message2.getCreatedAt());", "originalCommit": "b0921c06e5dea38b817bd5d96ee5a7002203842b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE2OTA1Mg==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/184#discussion_r373169052", "bodyText": "This is intentional. I never remember whether comparator should compare o1 with o2 or vice versa, but the negative sign informs that we\u2019re reversing the order.", "author": "vbabenkoru", "createdAt": "2020-01-30T20:11:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE2NDQxMg=="}], "type": "inlineReview"}]}