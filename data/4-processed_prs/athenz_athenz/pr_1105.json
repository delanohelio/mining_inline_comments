{"pr_number": 1105, "pr_title": "support adding groups as role members", "pr_createdAt": "2020-09-04T17:18:24Z", "pr_url": "https://github.com/AthenZ/athenz/pull/1105", "timeline": [{"oid": "2cf7e42addedf3940956b5873f87394a61a38f33", "url": "https://github.com/AthenZ/athenz/commit/2cf7e42addedf3940956b5873f87394a61a38f33", "message": "support adding groups as role members", "committedDate": "2020-09-04T17:14:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5NjM5NQ==", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483796395", "bodyText": "Do we need to add principalType in \"*Membership\" structs as well?", "author": "abvaidya", "createdAt": "2020-09-04T18:54:45Z", "path": "core/zms/src/main/rdl/Group.tdl", "diffHunk": "@@ -25,11 +25,12 @@ type GroupMember Struct {\n     ResourceName requestPrincipal (optional); //pending members only - name of the principal requesting the change\n     Timestamp reviewLastNotifiedTime (optional); //for pending membership requests, time when last notification was sent (for file store)\n     Int32 systemDisabled (optional); //user disabled by system based on configured group setting\n+    Int32 principalType (optional); //server use only - principal type: user or service\n }\n \n //The representation for a group membership.\n type GroupMembership Struct {", "originalCommit": "2cf7e42addedf3940956b5873f87394a61a38f33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwOTcwNg==", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483809706", "bodyText": "in the next PR when we add support for membership we'll probably add those. this pr only handles putRole operations", "author": "havetisyan", "createdAt": "2020-09-04T19:28:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5NjM5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5NzA0NA==", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483797044", "bodyText": "It might be helpful to document in tdl which number represents which type. e.g. user=0, service=1 etc", "author": "abvaidya", "createdAt": "2020-09-04T18:56:20Z", "path": "core/zms/src/main/rdl/Role.tdl", "diffHunk": "@@ -30,6 +30,7 @@ type RoleMember Struct {\n     ResourceName requestPrincipal (optional); //pending members only - name of the principal requesting the change\n     Timestamp reviewLastNotifiedTime (optional); //for pending membership requests, time when last notification was sent (for file store)\n     Int32 systemDisabled (optional); //user disabled by system based on configured role setting\n+    Int32 principalType (optional); //server use only - principal type: user, group, or service", "originalCommit": "2cf7e42addedf3940956b5873f87394a61a38f33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgxMzczMg==", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483813732", "bodyText": "sure", "author": "havetisyan", "createdAt": "2020-09-04T19:39:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5NzA0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNDcxMw==", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483804713", "bodyText": "This method is always going to return true, so does it make sense to just remove it?", "author": "abvaidya", "createdAt": "2020-09-04T19:16:13Z", "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/ZMSImpl.java", "diffHunk": "@@ -3566,7 +3617,7 @@ String enforcedUserAuthorityFilter(final String roleUserAuthorityFilter, final S\n     }\n \n     boolean shouldValidateRoleMembers(final String userAuthorityFilter) {\n-        return validateUserRoleMembers || validateServiceRoleMembers || userAuthorityFilter != null;\n+        return validateGroupRoleMembers || validateUserRoleMembers || validateServiceRoleMembers || userAuthorityFilter != null;", "originalCommit": "2cf7e42addedf3940956b5873f87394a61a38f33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNzEyNw==", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483807127", "bodyText": "I see all references are removed?", "author": "abvaidya", "createdAt": "2020-09-04T19:22:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNDcxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwOTk3Mg==", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483809972", "bodyText": "eventually yes, it will be removed. I've removed in a couple of place already. once other functionality is added, it will slowly be removed", "author": "havetisyan", "createdAt": "2020-09-04T19:29:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNDcxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgxNTA5OQ==", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483815099", "bodyText": "ok, looks like it got cleaned up in all place, so I'll remove it in this PR as well.", "author": "havetisyan", "createdAt": "2020-09-04T19:43:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNDcxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNjQ2Mw==", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483806463", "bodyText": "instead of looping over again, can we set the principal type which adding them to \"normalizedGroupMembers\" above?", "author": "abvaidya", "createdAt": "2020-09-04T19:20:27Z", "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/ZMSImpl.java", "diffHunk": "@@ -8043,6 +8095,13 @@ void normalizeGroupMembers(Group group) {\n                 addNormalizedGroupMember(normalizedMembers, member);\n             }\n         }\n+\n+        // go through each member and set the principal type\n+\n+        for (GroupMember member : normalizedMembers.values()) {", "originalCommit": "2cf7e42addedf3940956b5873f87394a61a38f33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgxMTg1Mw==", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483811853", "bodyText": "sure, we'll just need to add some logic to skip duplicates and don't waste lookup operations.", "author": "havetisyan", "createdAt": "2020-09-04T19:34:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNjQ2Mw=="}], "type": "inlineReview"}, {"oid": "7923fd9b518f1e915bc08e5e821eb1eef16ee359", "url": "https://github.com/AthenZ/athenz/commit/7923fd9b518f1e915bc08e5e821eb1eef16ee359", "message": "address review comments", "committedDate": "2020-09-04T19:53:13Z", "type": "commit"}]}