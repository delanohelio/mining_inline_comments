{"pr_number": 1076, "pr_title": "use embedded mysql server for unit tests", "pr_createdAt": "2020-08-05T22:40:21Z", "pr_url": "https://github.com/AthenZ/athenz/pull/1076", "timeline": [{"oid": "9d9520e0b79e53db875b3d80998e8ad6676db06a", "url": "https://github.com/AthenZ/athenz/commit/9d9520e0b79e53db875b3d80998e8ad6676db06a", "message": "use embedded mysql server for unit tests", "committedDate": "2020-08-05T22:39:53Z", "type": "commit"}, {"oid": "fc9e190215ba71021da01acda50d6ad344745570", "url": "https://github.com/AthenZ/athenz/commit/fc9e190215ba71021da01acda50d6ad344745570", "message": "adding schema copy for now in the resources folder", "committedDate": "2020-08-05T23:13:53Z", "type": "commit"}, {"oid": "7060ed0fb16ee3c6dfb8935981667d63a0b32bad", "url": "https://github.com/AthenZ/athenz/commit/7060ed0fb16ee3c6dfb8935981667d63a0b32bad", "message": "notify on the day of expiry as well", "committedDate": "2020-08-06T00:12:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQ4MjEzMA==", "url": "https://github.com/AthenZ/athenz/pull/1076#discussion_r466482130", "bodyText": "I assumed that this was removed because it is already covered in testProcessExpiredPendingMembers.\nBut in testProcessExpiredPendingMembers there's no assertions. The test just runs processExpiredPendingMembers and doesn't verify that the members were expired", "author": "OferLevi85", "createdAt": "2020-08-06T15:08:04Z", "path": "servers/zms/src/test/java/com/yahoo/athenz/zms/DBServiceTest.java", "diffHunk": "@@ -5170,15 +5190,6 @@ public void testGetExpiredPendingDomainRoleMembers() {\n         Role role = zms.dbService.getRole(domainName, roleName, false, false, true);\n         assertEquals(role.getRoleMembers().size(), 4);\n \n-        // now let's expire our entries\n-", "originalCommit": "7060ed0fb16ee3c6dfb8935981667d63a0b32bad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQ4ODYxNg==", "url": "https://github.com/AthenZ/athenz/pull/1076#discussion_r466488616", "bodyText": "It was removed since it can't be tested with a real database. The test used the file connection where we forced the request time to be whatever we wanted (in this case we predated back 31 days). with the jdbc, the request is set when you insert the object and defaults to current time. So we can't expire anything. So while the actual lines are covered by other mock tests, the real test will not be possible with MySQL DB.", "author": "havetisyan", "createdAt": "2020-08-06T15:17:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQ4MjEzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQ5MTA0Mw==", "url": "https://github.com/AthenZ/athenz/pull/1076#discussion_r466491043", "bodyText": "Is this file different from the original zms_server.sql? If it isn't that means we will need to remember updating this file whenever we update the original.\nCan we reference the original file instead of copying it to the test directory?", "author": "OferLevi85", "createdAt": "2020-08-06T15:21:08Z", "path": "servers/zms/src/test/resources/schema/zms_server.sql", "diffHunk": "@@ -0,0 +1,357 @@\n+-- MySQL Script generated by MySQL Workbench\n+-- Tue Jun 30 12:33:10 2020\n+-- Model: New Model    Version: 1.0\n+-- MySQL Workbench Forward Engineering", "originalCommit": "7060ed0fb16ee3c6dfb8935981667d63a0b32bad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQ5NjQ3Mg==", "url": "https://github.com/AthenZ/athenz/pull/1076#discussion_r466496472", "bodyText": "It's the same file for now. remembering part is not a concern since if you write unit tests and forget to update the sql file, your tests are going to fail anyway. but the library is based around resources and I have to review their actual code to see how I can specify a relative path (which might be different depending what. class we're calling this from??).", "author": "havetisyan", "createdAt": "2020-08-06T15:28:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQ5MTA0Mw=="}], "type": "inlineReview"}]}