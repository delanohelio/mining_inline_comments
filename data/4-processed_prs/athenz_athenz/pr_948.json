{"pr_number": 948, "pr_title": "Add new NotificationTask - RoleMemberReviewNotificationTask", "pr_createdAt": "2020-04-25T08:59:24Z", "pr_url": "https://github.com/AthenZ/athenz/pull/948", "timeline": [{"oid": "e7d324b225e89cb286a9dd51fe835eb9b741449f", "url": "https://github.com/AthenZ/athenz/commit/e7d324b225e89cb286a9dd51fe835eb9b741449f", "message": "Add new NotificationTask - RoleMemberReviewNotificationTask\n1. New notification implemented without required DB changes.\nDB changes will be implemented in a future commit\n2. reviewReminder field was added to rdl structs RoleMember, MemberRole and Membership. reviewLastNotifiedTime was added to RoleMember.", "committedDate": "2020-04-26T03:53:43Z", "type": "forcePushed"}, {"oid": "0535d9c6e7e1a4fb831b6a9806e5ddb38c406f97", "url": "https://github.com/AthenZ/athenz/commit/0535d9c6e7e1a4fb831b6a9806e5ddb38c406f97", "message": "Add new NotificationTask - RoleMemberReviewNotificationTask\n1. New notification implemented without required DB changes.\nDB changes will be implemented in a future commit\n2. reviewReminder field was added to rdl structs RoleMember, MemberRole and Membership. reviewLastNotifiedTime was added to RoleMember.", "committedDate": "2020-04-26T13:57:15Z", "type": "forcePushed"}, {"oid": "1fe77c9100b03b154fbce7d7ea4653ad424dc1e5", "url": "https://github.com/AthenZ/athenz/commit/1fe77c9100b03b154fbce7d7ea4653ad424dc1e5", "message": "Add new NotificationTask - RoleMemberReviewNotificationTask\n1. New notification implemented without required DB changes.\nDB changes will be implemented in a future commit\n2. reviewReminder field was added to rdl structs RoleMember, MemberRole and Membership. reviewLastNotifiedTime was added to RoleMember.", "committedDate": "2020-04-27T08:37:25Z", "type": "forcePushed"}, {"oid": "2b1eb581d428478c0e261355fe04eb59cb1e9d94", "url": "https://github.com/AthenZ/athenz/commit/2b1eb581d428478c0e261355fe04eb59cb1e9d94", "message": "Add new NotificationTask - RoleMemberReviewNotificationTask\n1. New notification implemented without required DB changes.\nDB changes will be implemented in a future commit\n2. reviewReminder field was added to rdl structs RoleMember, MemberRole and Membership. reviewLastNotifiedTime was added to RoleMember.", "committedDate": "2020-04-27T09:09:24Z", "type": "forcePushed"}, {"oid": "df735d7a588569f2c0e83503ae21bb813591a458", "url": "https://github.com/AthenZ/athenz/commit/df735d7a588569f2c0e83503ae21bb813591a458", "message": "Add new NotificationTask - RoleMemberReviewNotificationTask\n1. New notification implemented without required DB changes.\nDB changes will be implemented in a future commit\n2. reviewReminder field was added to rdl structs RoleMember, MemberRole and Membership.", "committedDate": "2020-04-27T10:19:15Z", "type": "forcePushed"}, {"oid": "3e61655d92f58312b8f98a8e4ad58fa49995e2c6", "url": "https://github.com/AthenZ/athenz/commit/3e61655d92f58312b8f98a8e4ad58fa49995e2c6", "message": "Add new NotificationTask - RoleMemberReviewNotificationTask\n1. New notification implemented without required DB changes.\nDB changes will be implemented in a future commit\n2. reviewReminder field was added to rdl structs RoleMember, MemberRole and Membership.", "committedDate": "2020-04-27T10:45:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTczMzcxMg==", "url": "https://github.com/AthenZ/athenz/pull/948#discussion_r415733712", "bodyText": "have left ServerCommon.properties in common even tough this file contains notification specific attributes.\nI will move these attributes to files in zms / zts on a separate pull request.", "author": "OferLevi85", "createdAt": "2020-04-27T11:30:21Z", "path": "libs/java/server_common/src/main/resources/messages/ServerCommon.properties", "diffHunk": "@@ -10,3 +10,9 @@ athenz.notification.email.principal.expiry.body.entry=<tr><td class=\"cv\">{0}</td\n \n athenz.notification.email.unrefreshed.certs.subject=Athenz Unrefreshed Certificates Notification\n athenz.notification.email.unrefreshed.certs.body.entry=<tr><td class=\"cv\">{0}</td><td class=\"cv\">{1}</td><td class=\"cv\">{2}</td><td class=\"cv\">{3}</td><td class=\"cv\">{4}</td><td class=\"cv\">{5}</td></tr>", "originalCommit": "3e61655d92f58312b8f98a8e4ad58fa49995e2c6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTczNDMyMw==", "url": "https://github.com/AthenZ/athenz/pull/948#discussion_r415734323", "bodyText": "DB is implemented in PR 951", "author": "OferLevi85", "createdAt": "2020-04-27T11:31:23Z", "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/DBService.java", "diffHunk": "@@ -4226,6 +4226,11 @@ DomainRoleMembership getPendingDomainRoleMembers(final String principal) {\n         return null;\n     }\n \n+    public Map<String, DomainRoleMember> getReviewMembers() {", "originalCommit": "3e61655d92f58312b8f98a8e4ad58fa49995e2c6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9f42c1f87abe2747026d4ba27326509716d69691", "url": "https://github.com/AthenZ/athenz/commit/9f42c1f87abe2747026d4ba27326509716d69691", "message": "Add new NotificationTask - RoleMemberReviewNotificationTask\n1. New notification implemented without required DB changes.\nDB changes will be implemented in a future commit\n2. reviewReminder field was added to rdl structs RoleMember, MemberRole and Membership.", "committedDate": "2020-04-27T11:37:42Z", "type": "forcePushed"}, {"oid": "d62341996fc6b081f9fada165d5d3e9cea85c7d3", "url": "https://github.com/AthenZ/athenz/commit/d62341996fc6b081f9fada165d5d3e9cea85c7d3", "message": "Add new NotificationTask - RoleMemberReviewNotificationTask\n1. New notification implemented without required DB changes.\nDB changes will be implemented in a future commit\n2. reviewReminder field was added to rdl structs RoleMember, MemberRole and Membership.", "committedDate": "2020-04-27T21:56:50Z", "type": "forcePushed"}, {"oid": "d21f2f869198c10d380905428c8755a76ee7bc87", "url": "https://github.com/AthenZ/athenz/commit/d21f2f869198c10d380905428c8755a76ee7bc87", "message": "Add new NotificationTask - RoleMemberReviewNotificationTask\n1. New notification implemented without required DB changes.\nDB changes will be implemented in a future commit\n2. reviewReminder field was added to rdl structs RoleMember, MemberRole and Membership.", "committedDate": "2020-04-27T22:03:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODA5MDE3Mw==", "url": "https://github.com/AthenZ/athenz/pull/948#discussion_r418090173", "bodyText": "A better description would be: \"Periodic Review Reminder\"\nthis feature is not really about expiration. it's just about reviewing members without expiring anyone.", "author": "havetisyan", "createdAt": "2020-04-30T15:19:47Z", "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/notification/RoleMemberReviewNotificationTask.java", "diffHunk": "@@ -0,0 +1,159 @@\n+/*\n+ *  Copyright 2020 Verizon Media\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package com.yahoo.athenz.zms.notification;\n+\n+import com.yahoo.athenz.common.server.notification.*;\n+import com.yahoo.athenz.zms.DBService;\n+import com.yahoo.athenz.zms.DomainRoleMember;\n+import com.yahoo.athenz.zms.MemberRole;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import static com.yahoo.athenz.common.server.notification.NotificationServiceConstants.*;\n+\n+public class RoleMemberReviewNotificationTask implements NotificationTask {\n+    private final DBService dbService;\n+    private final RoleMemberNotificationCommon roleMemberNotificationCommon;\n+    private static final Logger LOGGER = LoggerFactory.getLogger(RoleMemberReviewNotificationTask.class);\n+    private final static String DESCRIPTION = \"Review before expiration reminder\";", "originalCommit": "d21f2f869198c10d380905428c8755a76ee7bc87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODA5MTM4Mw==", "url": "https://github.com/AthenZ/athenz/pull/948#discussion_r418091383", "bodyText": "we should remove EXPIRATION from this reminder. The user will get those separately so let's not combine and possibly confuse the users.", "author": "havetisyan", "createdAt": "2020-04-30T15:21:27Z", "path": "servers/zms/src/main/resources/messages/domain-member-review.html", "diffHunk": "@@ -0,0 +1,36 @@\n+<!DOCTYPE html>\n+<html lang=\"en\" dir=\"ltr\">\n+<head>\n+    <meta charset=\"utf-8\">\n+    <title></title>\n+    <style></style>\n+</head>\n+<body style=\"margin: 0; background: rgba(231, 232, 231, 1.0);\">\n+<div class=\"athenz-wrapper\">\n+    <div class=\"mbrapproval\">\n+        <div class=\"logo\">\n+            <img src=\"cid:logo\" class=\"athenzlogowhite\" alt=\"Athenz logo\"/>\n+        </div>\n+        <div class=\"hdr\">Domain Membership Review Details</div>\n+        <div class=\"bt\">You have one or more principals in your Athenz domain <b>{0}</b> whose review date will pass soon:</div>\n+        <hr>\n+        <table id=\"t02\">\n+            <thead>\n+            <tr>\n+                <th class=\"ch\">MEMBER</th>\n+                <th class=\"ch\">ROLE</th>\n+                <th class=\"ch\">EXPIRATION</th>", "originalCommit": "d21f2f869198c10d380905428c8755a76ee7bc87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODA5MjU3NA==", "url": "https://github.com/AthenZ/athenz/pull/948#discussion_r418092574", "bodyText": "We should remove any references to expiration.", "author": "havetisyan", "createdAt": "2020-04-30T15:23:06Z", "path": "servers/zms/src/main/resources/messages/domain-member-review.html", "diffHunk": "@@ -0,0 +1,36 @@\n+<!DOCTYPE html>\n+<html lang=\"en\" dir=\"ltr\">\n+<head>\n+    <meta charset=\"utf-8\">\n+    <title></title>\n+    <style></style>\n+</head>\n+<body style=\"margin: 0; background: rgba(231, 232, 231, 1.0);\">\n+<div class=\"athenz-wrapper\">\n+    <div class=\"mbrapproval\">\n+        <div class=\"logo\">\n+            <img src=\"cid:logo\" class=\"athenzlogowhite\" alt=\"Athenz logo\"/>\n+        </div>\n+        <div class=\"hdr\">Domain Membership Review Details</div>\n+        <div class=\"bt\">You have one or more principals in your Athenz domain <b>{0}</b> whose review date will pass soon:</div>\n+        <hr>\n+        <table id=\"t02\">\n+            <thead>\n+            <tr>\n+                <th class=\"ch\">MEMBER</th>\n+                <th class=\"ch\">ROLE</th>\n+                <th class=\"ch\">EXPIRATION</th>\n+                <th class=\"ch\">REVIEW</th>\n+            </tr>\n+            </thead>\n+            <tbody></tbody>\n+        </table>\n+        <hr>\n+        <div class=\"bt\"><br>Please review this list and, if necessary, login to <a href=\"{1}/domain/{0}/role\">Athenz UI</a> to extend their expiration and review dates.</div>", "originalCommit": "d21f2f869198c10d380905428c8755a76ee7bc87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODA5NTExMw==", "url": "https://github.com/AthenZ/athenz/pull/948#discussion_r418095113", "bodyText": "it should say - \"You are required to review your {0} principal's membership in the listed roles:\"", "author": "havetisyan", "createdAt": "2020-04-30T15:26:38Z", "path": "servers/zms/src/main/resources/messages/principal-review.html", "diffHunk": "@@ -0,0 +1,36 @@\n+<!DOCTYPE html>\n+<html lang=\"en\" dir=\"ltr\">\n+<head>\n+    <meta charset=\"utf-8\">\n+    <title></title>\n+    <style></style>\n+</head>\n+<body style=\"margin: 0; background: rgba(231, 232, 231, 1.0);\">\n+<div class=\"athenz-wrapper\">\n+    <div class=\"mbrapproval\">\n+        <div class=\"logo\">\n+            <img src=\"cid:logo\" class=\"athenzlogowhite\" alt=\"Athenz logo\"/>\n+        </div>\n+        <div class=\"hdr\">Principal Review Details</div>\n+        <div class=\"bt\">Review date for principal <b>{0}</b> in the following roles will expire soon:</div>", "originalCommit": "d21f2f869198c10d380905428c8755a76ee7bc87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODA5NTU1Nw==", "url": "https://github.com/AthenZ/athenz/pull/948#discussion_r418095557", "bodyText": "let's remove the \"those expiration\" part from the message.", "author": "havetisyan", "createdAt": "2020-04-30T15:27:13Z", "path": "servers/zms/src/main/resources/messages/principal-review.html", "diffHunk": "@@ -0,0 +1,36 @@\n+<!DOCTYPE html>\n+<html lang=\"en\" dir=\"ltr\">\n+<head>\n+    <meta charset=\"utf-8\">\n+    <title></title>\n+    <style></style>\n+</head>\n+<body style=\"margin: 0; background: rgba(231, 232, 231, 1.0);\">\n+<div class=\"athenz-wrapper\">\n+    <div class=\"mbrapproval\">\n+        <div class=\"logo\">\n+            <img src=\"cid:logo\" class=\"athenzlogowhite\" alt=\"Athenz logo\"/>\n+        </div>\n+        <div class=\"hdr\">Principal Review Details</div>\n+        <div class=\"bt\">Review date for principal <b>{0}</b> in the following roles will expire soon:</div>\n+        <hr>\n+        <table id=\"t03\">\n+            <thead>\n+            <tr>\n+                <th class=\"ch\">DOMAIN</th>\n+                <th class=\"ch\">ROLE</th>\n+                <th class=\"ch\">EXPIRATION</th>\n+                <th class=\"ch\">REVIEW</th>\n+            </tr>\n+            </thead>\n+            <tbody></tbody>\n+        </table>\n+        <hr>\n+        <div class=\"bt\"><br>Please review this list and, if necessary, follow up with their respective domain administrators to extend those expiration and review dates.</div>", "originalCommit": "d21f2f869198c10d380905428c8755a76ee7bc87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODA5NTcyMQ==", "url": "https://github.com/AthenZ/athenz/pull/948#discussion_r418095721", "bodyText": "let's remove this expiration line as well.", "author": "havetisyan", "createdAt": "2020-04-30T15:27:25Z", "path": "servers/zms/src/main/resources/messages/principal-review.html", "diffHunk": "@@ -0,0 +1,36 @@\n+<!DOCTYPE html>\n+<html lang=\"en\" dir=\"ltr\">\n+<head>\n+    <meta charset=\"utf-8\">\n+    <title></title>\n+    <style></style>\n+</head>\n+<body style=\"margin: 0; background: rgba(231, 232, 231, 1.0);\">\n+<div class=\"athenz-wrapper\">\n+    <div class=\"mbrapproval\">\n+        <div class=\"logo\">\n+            <img src=\"cid:logo\" class=\"athenzlogowhite\" alt=\"Athenz logo\"/>\n+        </div>\n+        <div class=\"hdr\">Principal Review Details</div>\n+        <div class=\"bt\">Review date for principal <b>{0}</b> in the following roles will expire soon:</div>\n+        <hr>\n+        <table id=\"t03\">\n+            <thead>\n+            <tr>\n+                <th class=\"ch\">DOMAIN</th>\n+                <th class=\"ch\">ROLE</th>\n+                <th class=\"ch\">EXPIRATION</th>", "originalCommit": "d21f2f869198c10d380905428c8755a76ee7bc87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1c7f98dbd708fa6b493ba30a7b99ce33383cd295", "url": "https://github.com/AthenZ/athenz/commit/1c7f98dbd708fa6b493ba30a7b99ce33383cd295", "message": "Add new NotificationTask - RoleMemberReviewNotificationTask\n1. New notification implemented without required DB changes.\nDB changes will be implemented in a future commit\n2. reviewReminder field was added to rdl structs RoleMember, MemberRole and Membership.", "committedDate": "2020-05-03T07:16:29Z", "type": "commit"}, {"oid": "1c7f98dbd708fa6b493ba30a7b99ce33383cd295", "url": "https://github.com/AthenZ/athenz/commit/1c7f98dbd708fa6b493ba30a7b99ce33383cd295", "message": "Add new NotificationTask - RoleMemberReviewNotificationTask\n1. New notification implemented without required DB changes.\nDB changes will be implemented in a future commit\n2. reviewReminder field was added to rdl structs RoleMember, MemberRole and Membership.", "committedDate": "2020-05-03T07:16:29Z", "type": "forcePushed"}]}