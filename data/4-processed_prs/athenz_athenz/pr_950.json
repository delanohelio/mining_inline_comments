{"pr_number": 950, "pr_title": "modify using localtime for retrieving modified domains", "pr_createdAt": "2020-04-27T06:41:14Z", "pr_url": "https://github.com/AthenZ/athenz/pull/950", "timeline": [{"oid": "78988c88bc957ee190dc8402cd1d9c889cf3d631", "url": "https://github.com/AthenZ/athenz/commit/78988c88bc957ee190dc8402cd1d9c889cf3d631", "message": "modify using localtime for retrieving modified domains", "committedDate": "2020-04-27T06:58:48Z", "type": "commit"}, {"oid": "78988c88bc957ee190dc8402cd1d9c889cf3d631", "url": "https://github.com/AthenZ/athenz/commit/78988c88bc957ee190dc8402cd1d9c889cf3d631", "message": "modify using localtime for retrieving modified domains", "committedDate": "2020-04-27T06:58:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk1MTcyMg==", "url": "https://github.com/AthenZ/athenz/pull/950#discussion_r415951722", "bodyText": "this becomes a wasted operation if the command itself does not the calendar instance. please retain the original behavior where the calendar is obtained only when its needed.", "author": "havetisyan", "createdAt": "2020-04-27T16:14:23Z", "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/store/jdbc/JDBCConnection.java", "diffHunk": "@@ -648,6 +649,8 @@ public boolean deleteDomain(String domainName) {\n     PreparedStatement prepareDomainScanStatement(String prefix, long modifiedSince)\n             throws SQLException {\n         \n+        Calendar cal = getCalendarInstance();", "originalCommit": "78988c88bc957ee190dc8402cd1d9c889cf3d631", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk1MjM4NA==", "url": "https://github.com/AthenZ/athenz/pull/950#discussion_r415952384", "bodyText": "we should not fetch the property and parse it every time. this should be a static member of the class  so we only do it once and never again.", "author": "havetisyan", "createdAt": "2020-04-27T16:15:14Z", "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/store/jdbc/JDBCConnection.java", "diffHunk": "@@ -666,13 +668,27 @@ PreparedStatement prepareDomainScanStatement(String prefix, long modifiedSince)\n             }\n         } else if (modifiedSince != 0) {\n             ps = con.prepareStatement(SQL_LIST_DOMAIN_MODIFIED);\n-            Calendar cal = Calendar.getInstance(TimeZone.getTimeZone(\"GMT\"));\n             ps.setTimestamp(1, new java.sql.Timestamp(modifiedSince), cal);\n         } else {\n             ps = con.prepareStatement(SQL_LIST_DOMAIN);\n         }\n         return ps;\n     }\n+\n+    Calendar getCalendarInstance() {\n+\n+        Boolean useLocalTimeZone = Boolean.parseBoolean(", "originalCommit": "78988c88bc957ee190dc8402cd1d9c889cf3d631", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8a2db8f8407c21e706048594e827d2f2ddeaa6d4", "url": "https://github.com/AthenZ/athenz/commit/8a2db8f8407c21e706048594e827d2f2ddeaa6d4", "message": "fix", "committedDate": "2020-04-27T17:42:24Z", "type": "commit"}, {"oid": "8a2db8f8407c21e706048594e827d2f2ddeaa6d4", "url": "https://github.com/AthenZ/athenz/commit/8a2db8f8407c21e706048594e827d2f2ddeaa6d4", "message": "fix", "committedDate": "2020-04-27T17:42:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjA4MDcxNQ==", "url": "https://github.com/AthenZ/athenz/pull/950#discussion_r416080715", "bodyText": "let's move this code how it was before. as I mentioned in my earlier comment we don't need a calendar object if we're just doing a list domain operation.", "author": "havetisyan", "createdAt": "2020-04-27T19:15:14Z", "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/store/jdbc/JDBCConnection.java", "diffHunk": "@@ -647,7 +650,9 @@ public boolean deleteDomain(String domainName) {\n \n     PreparedStatement prepareDomainScanStatement(String prefix, long modifiedSince)\n             throws SQLException {\n-        \n+\n+        Calendar cal = Calendar.getInstance(TimeZone.getTimeZone(MYSQL_SERVER_TIMEZONE));", "originalCommit": "8a2db8f8407c21e706048594e827d2f2ddeaa6d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjA4MDkwMA==", "url": "https://github.com/AthenZ/athenz/pull/950#discussion_r416080900", "bodyText": "please update this setting to reflect the new name.", "author": "havetisyan", "createdAt": "2020-04-27T19:15:33Z", "path": "servers/zms/conf/zms.properties", "diffHunk": "@@ -415,3 +415,7 @@ athenz.zms.read_only_mode=false\n # needs to contact most likely a server (e.g. mysql instance)\n # running in a different region.\n #athenz.zms.master_copy_for_signed_domains=false\n+\n+# Boolean value specifying whether using the server's timezone or GMT\n+# at retriving modified domains from DB\n+#athenz.zms.use_local_timezone_in_domain_scan=false", "originalCommit": "8a2db8f8407c21e706048594e827d2f2ddeaa6d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a91ecbeb8aef368bb45197aa05bee070fecb4649", "url": "https://github.com/AthenZ/athenz/commit/a91ecbeb8aef368bb45197aa05bee070fecb4649", "message": "fix", "committedDate": "2020-04-28T04:40:57Z", "type": "commit"}]}