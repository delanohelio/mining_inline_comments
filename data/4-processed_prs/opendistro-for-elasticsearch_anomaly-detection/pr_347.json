{"pr_number": 347, "pr_title": "backport change: filter out exceptions which should not be counted in failure stats", "pr_createdAt": "2020-12-29T20:25:57Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/347", "timeline": [{"oid": "e29fcfdf6108a98d33ebd7b697544b95717508e8", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/e29fcfdf6108a98d33ebd7b697544b95717508e8", "message": "filter out exceptions which should not be counted in failure stats", "committedDate": "2020-12-29T11:35:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg1NDI2MQ==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/347#discussion_r549854261", "bodyText": "Do we have tests for HC detectors?", "author": "kaituo", "createdAt": "2020-12-29T21:21:18Z", "path": "src/test/java/com/amazon/opendistroforelasticsearch/ad/transport/AnomalyResultTransportActionTests.java", "diffHunk": "@@ -0,0 +1,174 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.ad.transport;\n+\n+import static com.amazon.opendistroforelasticsearch.ad.TestHelpers.randomQuery;\n+\n+import java.io.IOException;\n+import java.time.Instant;\n+import java.time.temporal.ChronoUnit;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.elasticsearch.action.get.GetResponse;\n+import org.elasticsearch.common.io.stream.NotSerializableExceptionWrapper;\n+import org.elasticsearch.search.aggregations.AggregationBuilder;\n+import org.elasticsearch.test.rest.ESRestTestCase;\n+import org.junit.Before;\n+\n+import com.amazon.opendistroforelasticsearch.ad.ADIntegTestCase;\n+import com.amazon.opendistroforelasticsearch.ad.TestHelpers;\n+import com.amazon.opendistroforelasticsearch.ad.common.exception.AnomalyDetectionException;\n+import com.amazon.opendistroforelasticsearch.ad.model.AnomalyDetector;\n+import com.amazon.opendistroforelasticsearch.ad.model.Feature;\n+import com.amazon.opendistroforelasticsearch.ad.model.IntervalTimeConfiguration;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+\n+public class AnomalyResultTransportActionTests extends ADIntegTestCase {\n+    private String testIndex;\n+    private Instant testDataTimeStamp;\n+    private long start;\n+    private long end;\n+\n+    @Override\n+    @Before\n+    public void setUp() throws Exception {\n+        super.setUp();\n+        testIndex = \"test_data\";\n+        testDataTimeStamp = Instant.now();\n+        start = testDataTimeStamp.minus(10, ChronoUnit.MINUTES).toEpochMilli();\n+        end = testDataTimeStamp.plus(10, ChronoUnit.MINUTES).toEpochMilli();\n+        ingestTestData();\n+    }\n+\n+    private void ingestTestData() throws IOException {\n+        String mappings = \"{\\\"properties\\\":{\\\"timestamp\\\":{\\\"type\\\":\\\"date\\\",\\\"format\\\":\\\"strict_date_time||epoch_millis\\\"},\"", "originalCommit": "e29fcfdf6108a98d33ebd7b697544b95717508e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg1OTM0Mw==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/347#discussion_r549859343", "bodyText": "Tested both single entity and HC detectors on test cluster. But not include HC detectors IT cases. Will send out another PR to add HC detector IT cases.", "author": "ylwu-amzn", "createdAt": "2020-12-29T21:41:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg1NDI2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg3NjA1Nw==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/347#discussion_r549876057", "bodyText": "Add more IT cases for HC detectors in this PR #348, will backport once the PR approved.", "author": "ylwu-amzn", "createdAt": "2020-12-29T22:37:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg1NDI2MQ=="}], "type": "inlineReview"}]}