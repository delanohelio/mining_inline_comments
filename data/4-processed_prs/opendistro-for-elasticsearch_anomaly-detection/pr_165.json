{"pr_number": 165, "pr_title": "Run tests on docker if docker image exists", "pr_createdAt": "2020-06-19T21:26:50Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/165", "timeline": [{"oid": "898fa28a9420cd87c31621ca9169f00bdce60996", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/898fa28a9420cd87c31621ca9169f00bdce60996", "message": "Run docker tests  if docker image exists\n\nPreviously, CI ran into issues when the docker image was not out yet after a version upgrade. This PR fixes it by using an environment variable to track whether the docker image exists or not.\n\nThis PR also removes test-workflow.yml since CI.yml can cover its functionality.\n\nTesting done:\n1. Verified in github docker tests skip if no docker image exists.", "committedDate": "2020-06-19T21:39:02Z", "type": "commit"}, {"oid": "898fa28a9420cd87c31621ca9169f00bdce60996", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/898fa28a9420cd87c31621ca9169f00bdce60996", "message": "Run docker tests  if docker image exists\n\nPreviously, CI ran into issues when the docker image was not out yet after a version upgrade. This PR fixes it by using an environment variable to track whether the docker image exists or not.\n\nThis PR also removes test-workflow.yml since CI.yml can cover its functionality.\n\nTesting done:\n1. Verified in github docker tests skip if no docker image exists.", "committedDate": "2020-06-19T21:39:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA4NzUwNA==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/165#discussion_r443087504", "bodyText": "if it is false, will the CI workflow fail?", "author": "yizheliu-amazon", "createdAt": "2020-06-20T01:01:23Z", "path": ".github/workflows/CI.yml", "diffHunk": "@@ -48,15 +52,20 @@ jobs:\n             echo \"RUN /usr/share/elasticsearch/bin/elasticsearch-plugin install --batch file:/tmp/opendistro-anomaly-detection-$plugin_version.zip\" >> Dockerfile\n \n             docker build -t odfe-ad:test .\n+            echo \"::set-env name=imagePresent::true\"\n+          else\n+            echo \"::set-env name=imagePresent::false\"", "originalCommit": "898fa28a9420cd87c31621ca9169f00bdce60996", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA4ODY3Ng==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/165#discussion_r443088676", "bodyText": "no, it won't.  See the workflow ran as part of the PR.", "author": "kaituo", "createdAt": "2020-06-20T01:16:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA4NzUwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA4OTQ3OQ==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/165#discussion_r443089479", "bodyText": "hmmm, should we fail workflow if docker image doesn't exist? It is a dependency to the workflow. If any PR comes when docker image is not there, we may miss the unit test as protection here.", "author": "yizheliu-amazon", "createdAt": "2020-06-20T01:26:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA4NzUwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA4OTkwOA==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/165#discussion_r443089908", "bodyText": "unit tests still runs.  Only docker related tests won't run.", "author": "kaituo", "createdAt": "2020-06-20T01:31:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA4NzUwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA5MTY2Ng==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/165#discussion_r443091666", "bodyText": "I see. IT won't run if docker is missing. Will it be a concern if PR which may break IT gets merged, but not caught in CI given docker is missing?", "author": "yizheliu-amazon", "createdAt": "2020-06-20T01:55:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA4NzUwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA5MTc5OA==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/165#discussion_r443091798", "bodyText": "IT runs as well. Just won't run in a docker environment.", "author": "kaituo", "createdAt": "2020-06-20T01:57:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA4NzUwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA5MTg1NA==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/165#discussion_r443091854", "bodyText": "okay.", "author": "yizheliu-amazon", "createdAt": "2020-06-20T01:58:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA4NzUwNA=="}], "type": "inlineReview"}]}