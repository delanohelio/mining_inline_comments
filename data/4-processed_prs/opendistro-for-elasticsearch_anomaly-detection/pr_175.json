{"pr_number": 175, "pr_title": "Add dyanmic setting for memory threshold", "pr_createdAt": "2020-06-24T17:44:48Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/175", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE2NDk4NA==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/175#discussion_r445164984", "bodyText": "minor. why not add maxvalue?", "author": "wnbts", "createdAt": "2020-06-24T20:52:35Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/settings/AnomalyDetectorSettings.java", "diffHunk": "@@ -163,7 +163,8 @@ private AnomalyDetectorSettings() {}\n \n     public static final double DESIRED_MODEL_SIZE_PERCENTAGE = 0.0002;\n \n-    public static final double MODEL_MAX_SIZE_PERCENTAGE = 0.1;\n+    public static final Setting<Double> MODEL_MAX_SIZE_PERCENTAGE = Setting\n+        .doubleSetting(\"opendistro.anomaly_detection.model_max_size_percent\", 0.1, 0, Setting.Property.NodeScope, Setting.Property.Dynamic);", "originalCommit": "dffdf3207668778f21f86916ae9d87247cedf26a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzEwMzYyMg==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/175#discussion_r447103622", "bodyText": "added 0.7 as max", "author": "kaituo", "createdAt": "2020-06-29T16:35:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE2NDk4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE2NjY0OA==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/175#discussion_r445166648", "bodyText": "why not do this at plugin configuration to reduce unnecessary dependencies only used once?", "author": "wnbts", "createdAt": "2020-06-24T20:55:50Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/ml/ModelManager.java", "diffHunk": "@@ -197,6 +200,9 @@ public ModelManager(\n         this.forests = new ConcurrentHashMap<>();\n         this.thresholds = new ConcurrentHashMap<>();\n         this.shingleSize = shingleSize;\n+\n+        this.modelMaxSizePercentage = MODEL_MAX_SIZE_PERCENTAGE.get(settings);", "originalCommit": "dffdf3207668778f21f86916ae9d87247cedf26a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzEzOTYwNA==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/175#discussion_r447139604", "bodyText": "good idea.  Changed.", "author": "kaituo", "createdAt": "2020-06-29T17:36:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE2NjY0OA=="}], "type": "inlineReview"}, {"oid": "337779b3c5e391d76e6da2e280ddf44a0d4313ac", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/337779b3c5e391d76e6da2e280ddf44a0d4313ac", "message": "Add dyanmic setting for memory threshold\n\nWe have the following two memory threshold:\n* a detector's model size per node cannot exceed 10% of heap memory\n* the total model size per node cannot exceed 10% of heap memory.\nIf users use the ES cluster mainly for anomaly detection, they should be able to increase the memory for AD.This PR makes the threshold dynamically adjustable via the setting opendistro.anomaly_detection.model_max_size_percent.\n\nTesting done:\n* Manually verified I can dynamically adjust the memory threshold setting. \u00a0", "committedDate": "2020-06-29T17:59:16Z", "type": "commit"}, {"oid": "b02ca222bea716c4745f6da14408a8bc03c9815a", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/b02ca222bea716c4745f6da14408a8bc03c9815a", "message": "Move modelMaxSizePercentage's value source to plugin configuration", "committedDate": "2020-06-29T17:59:16Z", "type": "commit"}, {"oid": "b02ca222bea716c4745f6da14408a8bc03c9815a", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/b02ca222bea716c4745f6da14408a8bc03c9815a", "message": "Move modelMaxSizePercentage's value source to plugin configuration", "committedDate": "2020-06-29T17:59:16Z", "type": "forcePushed"}]}