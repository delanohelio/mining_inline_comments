{"pr_number": 87, "pr_title": "AD opendistro 1.6 support", "pr_createdAt": "2020-04-14T07:37:43Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/87", "timeline": [{"oid": "67945bd622c6d7badaa82994be4510f29f667138", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/67945bd622c6d7badaa82994be4510f29f667138", "message": "odfe 1.6 AD support", "committedDate": "2020-04-10T19:26:55Z", "type": "commit"}, {"oid": "f6dd325607729c8b51b445e4e8c0b10f655f0798", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/f6dd325607729c8b51b445e4e8c0b10f655f0798", "message": "odfe 1.6 AD support", "committedDate": "2020-04-13T18:25:30Z", "type": "commit"}, {"oid": "468e40ffe0dcfe1a7146a551ee98d1d56c8d87fc", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/468e40ffe0dcfe1a7146a551ee98d1d56c8d87fc", "message": "odfe 1.6 AD support", "committedDate": "2020-04-14T07:18:16Z", "type": "commit"}, {"oid": "48f5cd6690c49f6236c2082094154b8eb1ba59c9", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/48f5cd6690c49f6236c2082094154b8eb1ba59c9", "message": "odfe 1.6 AD support", "committedDate": "2020-04-14T07:36:55Z", "type": "commit"}, {"oid": "176f94389b180b68a7a1cbaea41d7da9a4881f6b", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/176f94389b180b68a7a1cbaea41d7da9a4881f6b", "message": "Merge branch 'development' into dev-vam", "committedDate": "2020-04-14T17:51:33Z", "type": "commit"}, {"oid": "0fdcfb1871512da0ffabb8fab54e4af0aebc74e1", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/0fdcfb1871512da0ffabb8fab54e4af0aebc74e1", "message": "fix action to pick up java 13", "committedDate": "2020-04-14T19:18:37Z", "type": "commit"}, {"oid": "7f84e12f6f8d39f4bf709ca2670be6e25b418405", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/7f84e12f6f8d39f4bf709ca2670be6e25b418405", "message": "Merge branch 'dev-vam' of github.com:vamshin/anomaly-detection into dev-vam", "committedDate": "2020-04-14T19:19:29Z", "type": "commit"}, {"oid": "e9d4a460a3371ffd4a66330fc55e2d9492db546b", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/e9d4a460a3371ffd4a66330fc55e2d9492db546b", "message": "fix spotless issues", "committedDate": "2020-04-14T19:28:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU0OTkxOA==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/87#discussion_r408549918", "bodyText": "After removing these lines, can we build on both windows and Linux?", "author": "kaituo", "createdAt": "2020-04-15T02:49:32Z", "path": "build.gradle", "diffHunk": "@@ -42,13 +43,8 @@ repositories {\n }\n \n ext {\n-    opendistroVersion = '1.4.0'\n+    opendistroVersion = '1.6.0'\n     isSnapshot = \"true\" == System.getProperty(\"build.snapshot\", \"true\")\n-    if (System.properties['os.name'].toLowerCase().contains('windows')) {", "originalCommit": "e9d4a460a3371ffd4a66330fc55e2d9492db546b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU4MDIwMQ==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/87#discussion_r408580201", "bodyText": "Previously we were installing using setupCommand where we used absolute path for file which was different for windows.  Now we just need to pass filetree .\nExample:-\nplugin(fileTree(\"src/test/resources/job-scheduler\").getSingleFile())", "author": "vamshin", "createdAt": "2020-04-15T04:54:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU0OTkxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTAyMzEzMQ==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/87#discussion_r409023131", "bodyText": "great", "author": "kaituo", "createdAt": "2020-04-15T17:46:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU0OTkxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU0OTk5Ng==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/87#discussion_r408549996", "bodyText": "Why do we remove the following, which is used to start and stop a multi-node cluster?", "author": "kaituo", "createdAt": "2020-04-15T02:49:47Z", "path": "build.gradle", "diffHunk": "@@ -120,80 +119,6 @@ thirdPartyAudit.enabled = false\n // See package README.md for details on using these tasks.\n def _numNodes = findProperty('numNodes') as Integer ?: 1\n \n-def getSeedHosts = { int num ->", "originalCommit": "e9d4a460a3371ffd4a66330fc55e2d9492db546b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU3MzEwNA==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/87#discussion_r408573104", "bodyText": "I think this was added to to provide hack to install job scheduler plugin on the test clusters.   With ES 7.5 onwards Elasticsearch provided a way to install dependent plugins on test cluster.\nNow we do not need it. To run multi node cluster, we need to use\n./gradlew run -PnumNodes=<numberOfNodesYouWant>", "author": "vamshin", "createdAt": "2020-04-15T04:25:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU0OTk5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTAyNTc4OA==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/87#discussion_r409025788", "bodyText": "Good to know.  Could you keep runSingleNode and stopMultiNode (line 165~196 in the old version) so that I can start node one by one and kill all nodes?  Need them for fault tolerance tests.", "author": "kaituo", "createdAt": "2020-04-15T17:51:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU0OTk5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkwMDM1Nw==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/87#discussion_r409900357", "bodyText": "Created issue to add this back #90", "author": "vamshin", "createdAt": "2020-04-16T23:10:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU0OTk5Ng=="}], "type": "inlineReview"}, {"oid": "40cc15b0f88323a8c63611e8f5f41f847f526d3e", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/40cc15b0f88323a8c63611e8f5f41f847f526d3e", "message": "Updated README.md\n\nUpdated README.md to reflect changes to run multi node cluster", "committedDate": "2020-04-15T04:24:28Z", "type": "commit"}, {"oid": "7fcb93d366649baaeb8f752110498bc8102c7f4c", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/7fcb93d366649baaeb8f752110498bc8102c7f4c", "message": "removed unused variables", "committedDate": "2020-04-15T04:29:59Z", "type": "commit"}, {"oid": "b541442f788a0842f50966f9fa9c2f3f081575dd", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/b541442f788a0842f50966f9fa9c2f3f081575dd", "message": "commit e5b6ce5f47590e9c451c02a2b81d1c40a5f2b6d6\nAuthor: Kaituo Li <kaituo@amazon.com>\nDate:   Wed Apr 15 15:45:13 2020 -0700\n\n    Add state and error to profile API (#84)\n\n    * Add state and error to profile API\n\n    We want to make it easy for customers and oncalls to identify a detector\u2019s state and error if any. This PR adds such information to our new profile API.\n\n    We expect three kinds of states:\n    -Disabled: if get ad job api says the job is disabled;\n    -Init: if anomaly score after the last update time of the detector is larger than 0\n    -Running: if neither of the above applies and no exceptions.\n\n    Error is populated if error of the latest anomaly result is not empty.\n\n    Testing done:\n    -manual testing during a detector\u2019s life cycle: not created, created but not started, started, during initialization, after initialization, stopped, restarted\n    -added unit tests to cover above scenario\n\ncommit 0c3305000ffe6e61c7c2104314a555e69d060023\nAuthor: Kaituo Li <kaituo@amazon.com>\nDate:   Tue Apr 14 11:52:20 2020 -0700\n\n    Use callbacks and bug fix (#83)\n\n    * Use callbacks and bug fix\n\n    This PR includes the following changes:\n\n    1. remove classes that are not needed in jacocoExclusions since we have enough coverage for those classes.\n    2. Use ClientUtil instead of Elasticsearch\u2019s client in AD job runner\n    3. Use one function to get the number of partitioned forests. Previously, we have redundant code in both ModelManager and ADStateManager.\n    4. Change ADStateManager.getAnomalyDetector to use callback.\n    5. Change AnomalyResultTransportAction to use callback to get features.\n    6. Add in AnomalyResultTransportAction to handle the case where all features have been disabled, and users' index does not exist.\n    7. Change get RCF and threshold result methods to use callback and add exception handling of IndexNotFoundException due to the change. Previously, getting RCF and threshold result methods won\u2019t throw IndexNotFoundException.\n    8. Remove unused fields in StopDetectorTransportAction and AnomalyResultTransportAction\n    9. Unwrap EsRejectedExecutionException as it can be nested inside RemoteTransportException. Previously, we would not recognize EsRejectedExecutionException and thus miss anomaly results write retrying.\n    10. Add error in anomaly result schema.11. Fix broken tests due to my changes.\n\n    Testing done:\n    1. unit/integration tests pass\n    2. do end-to-end testing and make sure my fix achieves the purpose\u00a0\n       * timeout issue is gone\u00a0\n       * when all features have been disabled or index does not exist, we will retry a few more times and disable AD jobs.", "committedDate": "2020-04-16T19:08:32Z", "type": "commit"}, {"oid": "92094ea32498367b08cbd5bac585e3f09d5cd803", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/92094ea32498367b08cbd5bac585e3f09d5cd803", "message": "Merge branch 'dev-vam' of github.com:vamshin/anomaly-detection into dev-vam", "committedDate": "2020-04-16T22:08:32Z", "type": "commit"}]}