{"pr_number": 296, "pr_title": "Fix edge case where entities found for preview is empty", "pr_createdAt": "2020-10-27T06:17:32Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/296", "timeline": [{"oid": "3a06ebbf88cfc47f605e74563b30b440c32beed0", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/3a06ebbf88cfc47f605e74563b30b440c32beed0", "message": "Fix edge case where entities found for preview is emtpy", "committedDate": "2020-10-27T06:16:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ0NTg3Mg==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/296#discussion_r512445872", "bodyText": "Should we return empty results or some failure like this https://github.com/opendistro-for-elasticsearch/anomaly-detection/blob/master/src/main/java/com/amazon/opendistroforelasticsearch/ad/feature/FeatureManager.java#L525", "author": "ylwu-amzn", "createdAt": "2020-10-27T06:37:02Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/AnomalyDetectorRunner.java", "diffHunk": "@@ -72,6 +72,9 @@ public void executeDetector(AnomalyDetector detector, Instant startTime, Instant\n         if (categoryField != null && !categoryField.isEmpty()) {\n             featureManager.getPreviewEntities(detector, startTime.toEpochMilli(), endTime.toEpochMilli(), ActionListener.wrap(entities -> {\n \n+                if (entities == null || entities.isEmpty()) {\n+                    listener.onResponse(Collections.emptyList());", "originalCommit": "3a06ebbf88cfc47f605e74563b30b440c32beed0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ1MTYzOA==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/296#discussion_r512451638", "bodyText": "Such failure will be caught and empty result is still returned instead in onFailure()\nI think it is okay to just return empty result", "author": "yizheliu-amazon", "createdAt": "2020-10-27T06:53:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ0NTg3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk1ODkyNg==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/296#discussion_r512958926", "bodyText": "Could you tell me why it would end up calling onFailure?  listener is the rest channel.", "author": "kaituo", "createdAt": "2020-10-27T19:12:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ0NTg3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzExNTcxNw==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/296#discussion_r513115717", "bodyText": "If entities is empty, code execution won't go into the for loop below, and listener has no chance to call onFailure or onResponse", "author": "yizheliu-amazon", "createdAt": "2020-10-28T00:50:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ0NTg3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzcxMDE1NQ==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/296#discussion_r513710155", "bodyText": "I feel it is better to return some failure and show that on kibana than return empty result.  Customers may wonder why it returns nothing.", "author": "kaituo", "createdAt": "2020-10-28T19:35:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ0NTg3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzgzMTI4Ng==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/296#discussion_r513831286", "bodyText": "if empty list is returned, existing Kibana will show corresponding message.", "author": "yizheliu-amazon", "createdAt": "2020-10-28T23:59:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ0NTg3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzgzNTMyMw==", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/296#discussion_r513835323", "bodyText": "Can you add a comment explaining why we want to return empty responses instead of errors?  It helps code readability.", "author": "kaituo", "createdAt": "2020-10-29T00:13:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ0NTg3Mg=="}], "type": "inlineReview"}, {"oid": "3dc93764ceefe2b73a37220f8831f8bf4ad9aab2", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/3dc93764ceefe2b73a37220f8831f8bf4ad9aab2", "message": "Add TODO to further improve reponse of Preview API and error handling on Front-end", "committedDate": "2020-10-29T00:38:42Z", "type": "commit"}]}