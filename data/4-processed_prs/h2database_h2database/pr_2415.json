{"pr_number": 2415, "pr_title": "Use safe custom UUID deserialization", "pr_createdAt": "2020-01-26T06:40:57Z", "pr_url": "https://github.com/h2database/h2database/pull/2415", "timeline": [{"oid": "a533c0f0d4209459a9def1427f5115abfed7e745", "url": "https://github.com/h2database/h2database/commit/a533c0f0d4209459a9def1427f5115abfed7e745", "message": "Remove short-lived conversions from JAVA_OBJECT to ENUM and GEOMETRY", "committedDate": "2020-01-26T06:29:25Z", "type": "commit"}, {"oid": "e2d996baa6fc1a0eefb1525695f5f82c14baf331", "url": "https://github.com/h2database/h2database/commit/e2d996baa6fc1a0eefb1525695f5f82c14baf331", "message": "Use safe custom UUID deserialization", "committedDate": "2020-01-26T06:30:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk4ODM3Mg==", "url": "https://github.com/h2database/h2database/pull/2415#discussion_r370988372", "bodyText": "if\nsetObject(foo, enum or geometry, Types.OTHER)\nno longer works, that is an API change, and will quite likely break some client code", "author": "grandinj", "createdAt": "2020-01-26T10:31:11Z", "path": "h2/src/test/org/h2/test/jdbc/TestResultSet.java", "diffHunk": "@@ -1949,13 +1949,7 @@ private void testEnum() throws SQLException {\n         prep.setObject(2, \"D\", Types.VARCHAR);\n         prep.executeUpdate();\n         prep.setInt(1, 5);\n-        prep.setObject(2, \"E\", Types.OTHER);\n-        prep.executeUpdate();\n-        prep.setInt(1, 6);\n-        prep.setObject(2, 5, Types.OTHER);\n-        prep.executeUpdate();\n-        prep.setInt(1, 7);\n-        prep.setObject(2, 6, Types.INTEGER);\n+        prep.setObject(2, 4, Types.INTEGER);", "originalCommit": "a533c0f0d4209459a9def1427f5115abfed7e745", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk4ODk3MQ==", "url": "https://github.com/h2database/h2database/pull/2415#discussion_r370988971", "bodyText": "I introduced such support in e41b444 and that change isn't related in any way with the original issue about ENUM.\nOn the other hand, the Types.OTHER should not be the same as Types.JAVA_OBJECT. setObject() with Types.OTHER should not be mapped to ValueJavaObject like it currently does. OTHER is just a placeholder for database-specific data types. It isn't needed since JDBC 4.2, because in 4.2 database can provide own data types.\nPerhaps H2 should not create ValueJavaObject for Types.OTHER if more specific data type can be determined from the passed value.", "author": "katzyn", "createdAt": "2020-01-26T10:41:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk4ODM3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk4OTc2Mw==", "url": "https://github.com/h2database/h2database/pull/2415#discussion_r370989763", "bodyText": "Let's continue this discussion in #2416.", "author": "katzyn", "createdAt": "2020-01-26T10:56:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk4ODM3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk5ODE4NA==", "url": "https://github.com/h2database/h2database/pull/2415#discussion_r370998184", "bodyText": "I restored support of Types.OTHER for GEOMETRY columns.", "author": "katzyn", "createdAt": "2020-01-26T13:19:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk4ODM3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk4ODQ1MA==", "url": "https://github.com/h2database/h2database/pull/2415#discussion_r370988450", "bodyText": "best to document the reason for this, something like\n\"to avoid a security hole with a malicously crafted serialised object\"", "author": "grandinj", "createdAt": "2020-01-26T10:32:54Z", "path": "h2/src/main/org/h2/util/JdbcUtils.java", "diffHunk": "@@ -415,6 +421,25 @@ public static Object deserialize(byte[] data, JavaObjectSerializer javaObjectSer\n         }\n     }\n \n+    /**\n+     * De-serialize the byte array to a UUID object.", "originalCommit": "e2d996baa6fc1a0eefb1525695f5f82c14baf331", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2bcbf49f6e8ffcce125c01bee8f8f7b0c4906170", "url": "https://github.com/h2database/h2database/commit/2bcbf49f6e8ffcce125c01bee8f8f7b0c4906170", "message": "Add some javadoc", "committedDate": "2020-01-26T11:04:17Z", "type": "commit"}, {"oid": "6cff5529e897cf414ca9d58d698798e34e870930", "url": "https://github.com/h2database/h2database/commit/6cff5529e897cf414ca9d58d698798e34e870930", "message": "Restore test and correct OTHER / JAVA_OBJECT mappings", "committedDate": "2020-01-26T12:08:13Z", "type": "commit"}, {"oid": "6cff5529e897cf414ca9d58d698798e34e870930", "url": "https://github.com/h2database/h2database/commit/6cff5529e897cf414ca9d58d698798e34e870930", "message": "Restore test and correct OTHER / JAVA_OBJECT mappings", "committedDate": "2020-01-26T12:08:13Z", "type": "forcePushed"}]}