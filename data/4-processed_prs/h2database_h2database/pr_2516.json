{"pr_number": 2516, "pr_title": "SHUTDOWN IMMEDIATELY should be a normal shut down", "pr_createdAt": "2020-03-18T11:54:01Z", "pr_url": "https://github.com/h2database/h2database/pull/2516", "timeline": [{"oid": "ab22dbc6c54846349188779b0cc4348838b6131f", "url": "https://github.com/h2database/h2database/commit/ab22dbc6c54846349188779b0cc4348838b6131f", "message": "fix too aggressive removal info collection", "committedDate": "2020-03-17T04:05:10Z", "type": "commit"}, {"oid": "f0dfad3a5992d9f5b14cc99e20701180d12be555", "url": "https://github.com/h2database/h2database/commit/f0dfad3a5992d9f5b14cc99e20701180d12be555", "message": "fix TestAutoSever in big mode", "committedDate": "2020-03-18T03:43:25Z", "type": "commit"}, {"oid": "c2a5587a1a28404096565004474f52d095176f99", "url": "https://github.com/h2database/h2database/commit/c2a5587a1a28404096565004474f52d095176f99", "message": "fix for #2507 SHUTDOWN IMMEDIATELY", "committedDate": "2020-03-18T03:43:50Z", "type": "commit"}, {"oid": "d55b6e29e9eb3444d6705b099748096c11845056", "url": "https://github.com/h2database/h2database/commit/d55b6e29e9eb3444d6705b099748096c11845056", "message": "do not test for exceptions on Connection.close() after shut down", "committedDate": "2020-03-18T04:22:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMyODE4NQ==", "url": "https://github.com/h2database/h2database/pull/2516#discussion_r394328185", "bodyText": "It looks like indentation is too large here and below.", "author": "katzyn", "createdAt": "2020-03-18T13:01:59Z", "path": "h2/src/test/org/h2/test/server/TestAutoServer.java", "diffHunk": "@@ -72,42 +72,40 @@ private void testAutoServer(boolean port) throws Exception {\n             url += \";AUTO_SERVER_PORT=11111\";\n         }\n         String user = getUser(), password = getPassword();\n-        Connection connServer = getConnection(url + \";OPEN_NEW=TRUE\",\n-                user, password);\n-\n-        int i = ITERATIONS;\n-        for (; i > 0; i--) {\n-            Thread.sleep(100);\n-            SortedProperties prop = SortedProperties.loadProperties(\n-                    getBaseDir() + \"/\" + getTestName() + \".lock.db\");\n-            String key = prop.getProperty(\"id\");\n-            String server = prop.getProperty(\"server\");\n-            if (server != null) {\n-                String u2 = url.substring(url.indexOf(';'));\n-                u2 = \"jdbc:h2:tcp://\" + server + \"/\" + key + u2;\n-                Connection conn = DriverManager.getConnection(u2, user, password);\n-                conn.close();\n-                int gotPort = Integer.parseInt(server.substring(server.lastIndexOf(':') + 1));\n-                if (port) {\n-                    assertEquals(11111, gotPort);\n+        Connection connServer = getConnection(url + \";OPEN_NEW=TRUE\", user, password);\n+            int i = ITERATIONS;", "originalCommit": "d55b6e29e9eb3444d6705b099748096c11845056", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM0NjU0Nw==", "url": "https://github.com/h2database/h2database/pull/2516#discussion_r394346547", "bodyText": "It meant to be try-with-resorce", "author": "andreitokar", "createdAt": "2020-03-18T13:30:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMyODE4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMzNDQ0NA==", "url": "https://github.com/h2database/h2database/pull/2516#discussion_r394334444", "bodyText": "Such line wrapping looks weird, it's better to place compactMode == 0 on the same line with && conditions to group all operands of logical AND together and have logical OR operands on different lines.\nIndentation of line 481 has one extra space character, build script will complain about it.", "author": "katzyn", "createdAt": "2020-03-18T13:12:13Z", "path": "h2/src/main/org/h2/pagestore/PageStore.java", "diffHunk": "@@ -477,7 +477,8 @@ public synchronized void compact(int compactMode) {\n             return;\n         }\n         if (SysProperties.MODIFY_ON_WRITE && readMode &&\n-                compactMode == 0) {\n+                compactMode == 0 ||\n+                 compactMode == CommandInterface.SHUTDOWN_IMMEDIATELY) {", "originalCommit": "d55b6e29e9eb3444d6705b099748096c11845056", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "75ae22f25c389fd93c6a5afa9c5fe1403dfda2c1", "url": "https://github.com/h2database/h2database/commit/75ae22f25c389fd93c6a5afa9c5fe1403dfda2c1", "message": "indentation fix", "committedDate": "2020-03-18T13:24:34Z", "type": "commit"}]}