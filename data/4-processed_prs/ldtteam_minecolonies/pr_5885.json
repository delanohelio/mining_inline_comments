{"pr_number": 5885, "pr_title": "Adding split networking.", "pr_createdAt": "2020-10-06T10:09:13Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/5885", "timeline": [{"oid": "c7447c1e62a231646a49910031779d0c3b725a0a", "url": "https://github.com/ldtteam/minecolonies/commit/c7447c1e62a231646a49910031779d0c3b725a0a", "message": "Adding split networking.", "committedDate": "2020-10-06T10:07:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE2NDczMg==", "url": "https://github.com/ldtteam/minecolonies/pull/5885#discussion_r500164732", "bodyText": "move to start of method", "author": "Nightenom", "createdAt": "2020-10-06T10:20:05Z", "path": "src/main/java/com/minecolonies/coremod/network/NetworkChannel.java", "diffHunk": "@@ -353,6 +389,53 @@ public void sendToTrackingEntityAndSelf(final IMessage msg, final Entity entity)\n      */\n     public void sendToTrackingChunk(final IMessage msg, final Chunk chunk)\n     {\n-        rawChannel.send(PacketDistributor.TRACKING_CHUNK.with(() -> chunk), msg);\n+        handleSplitting(msg, s -> rawChannel.send(PacketDistributor.TRACKING_CHUNK.with(() -> chunk), s));\n+    }\n+\n+    private void handleSplitting(final IMessage msg, final Consumer<IMessage> splitMessageConsumer) {\n+        final ByteBuf buffer = Unpooled.buffer();\n+        final PacketBuffer innerPacketBuffer = new PacketBuffer(buffer);\n+        msg.toBytes(innerPacketBuffer);\n+        final byte[] data = new byte[buffer.capacity()];\n+        buffer.getBytes(0, data);\n+        buffer.release();\n+\n+        int max_packet_size = 943718; //This is 90% of max packet size.\n+        int currentIndex = 0;\n+        int packetIndex = 0;\n+        int comId = messageCounter.getAndIncrement();\n+        while(currentIndex < data.length) {\n+            final byte[] subPacketData = Arrays.copyOfRange(data, currentIndex, currentIndex+max_packet_size);\n+            final int messageId = this.messageTypeToIdMap.getOrDefault(msg.getClass(), -1);", "originalCommit": "c7447c1e62a231646a49910031779d0c3b725a0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "dfd8394e05e2493c8169fdf2b5c3540b8a952844", "url": "https://github.com/ldtteam/minecolonies/commit/dfd8394e05e2493c8169fdf2b5c3540b8a952844", "message": "Add commenting and formatting.", "committedDate": "2020-10-06T11:07:46Z", "type": "commit"}, {"oid": "31b263b2b1a4b5a4d2691ceac469a7f6c7f113c7", "url": "https://github.com/ldtteam/minecolonies/commit/31b263b2b1a4b5a4d2691ceac469a7f6c7f113c7", "message": "Fix some bugs due to me not actually calling and invoking the right methods for handling byte arrays and buffers.", "committedDate": "2020-10-06T12:23:12Z", "type": "commit"}]}