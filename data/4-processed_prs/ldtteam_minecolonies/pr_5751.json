{"pr_number": 5751, "pr_title": "Add colony event log to Town Hall", "pr_createdAt": "2020-09-09T16:31:24Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/5751", "timeline": [{"oid": "a64a910c11c82599405351c2a3d1a91d7d511fed", "url": "https://github.com/ldtteam/minecolonies/commit/a64a910c11c82599405351c2a3d1a91d7d511fed", "message": "Initial Partial implementation\n\n * Add citizen spawn IColonyEvents\n * Add IColonyEvent handling to Town Hall Gui", "committedDate": "2020-09-07T08:31:15Z", "type": "commit"}, {"oid": "bbbce56bb7ad50900425c173ff9baa0d74d00cb5", "url": "https://github.com/ldtteam/minecolonies/commit/bbbce56bb7ad50900425c173ff9baa0d74d00cb5", "message": "Change colony log to new IColonyEventDescription instead of IColonyEvent\n\n * Add citizen death event\n * Fix some issues\n * undo like half the changes of the last commit\n * The base systems should work now", "committedDate": "2020-09-07T18:35:16Z", "type": "commit"}, {"oid": "ccae376b6be03ae901d704645a472207096a185d", "url": "https://github.com/ldtteam/minecolonies/commit/ccae376b6be03ae901d704645a472207096a185d", "message": "Add building events(not fully implemented)\n\n * replace all tabs with spaces everywhere in the source code.\n * fix death message formatting", "committedDate": "2020-09-09T11:21:34Z", "type": "commit"}, {"oid": "8ea6fe115e972af42271c32124b5cf807d61cb46", "url": "https://github.com/ldtteam/minecolonies/commit/8ea6fe115e972af42271c32124b5cf807d61cb46", "message": "Merge remote-tracking branch 'origin/version/1.15' into\nfeature/colony_event_log", "committedDate": "2020-09-09T11:31:02Z", "type": "commit"}, {"oid": "07abfe01e1cde2f67d60e4689a7a38bb867b8322", "url": "https://github.com/ldtteam/minecolonies/commit/07abfe01e1cde2f67d60e4689a7a38bb867b8322", "message": "Seems like this class got merged in some strange way\n\nThis should fix it.", "committedDate": "2020-09-09T11:43:38Z", "type": "commit"}, {"oid": "d790aa4ed47826df7e07ae78d99ddfa60f03d413", "url": "https://github.com/ldtteam/minecolonies/commit/d790aa4ed47826df7e07ae78d99ddfa60f03d413", "message": "Add CitizenGrownUpEvent\n\nalso make CitizenDiedEvent a subclass of AbstractCitizenEvent(formerly\nAbstractCitizenSpawnEvent)", "committedDate": "2020-09-09T16:22:00Z", "type": "commit"}, {"oid": "7303c7ce043e2d0b835c44a77f276db41be59ea3", "url": "https://github.com/ldtteam/minecolonies/commit/7303c7ce043e2d0b835c44a77f276db41be59ea3", "message": "formatting", "committedDate": "2020-09-09T16:25:20Z", "type": "commit"}, {"oid": "4e176e8bc3615ea3128070db1bd2455707b9203f", "url": "https://github.com/ldtteam/minecolonies/commit/4e176e8bc3615ea3128070db1bd2455707b9203f", "message": "formatting", "committedDate": "2020-09-09T16:37:24Z", "type": "commit"}, {"oid": "3b5cdbb2cebad24ea49e657d3c649912ffb908f9", "url": "https://github.com/ldtteam/minecolonies/commit/3b5cdbb2cebad24ea49e657d3c649912ffb908f9", "message": "Merge branch 'version/1.15' into feature/colony_event_log", "committedDate": "2020-09-09T16:39:01Z", "type": "commit"}, {"oid": "71a13ce391fbfd950bdb1aa60b7c30b5e74acfe4", "url": "https://github.com/ldtteam/minecolonies/commit/71a13ce391fbfd950bdb1aa60b7c30b5e74acfe4", "message": "Add a button switching between colony and permission events\n\nAlso group some more of the town hall lang entries together, but its\nstill not nearly all of them.", "committedDate": "2020-09-09T19:33:19Z", "type": "commit"}, {"oid": "24789c8397da55187e3c65338286f6e03633f7ea", "url": "https://github.com/ldtteam/minecolonies/commit/24789c8397da55187e3c65338286f6e03633f7ea", "message": "Improve building name shown in colony event log\n\nalso undo a formatting change in TranslationConstants", "committedDate": "2020-09-10T10:03:13Z", "type": "commit"}, {"oid": "2163b0f521282d0e54ee1e9007014b11e7b00416", "url": "https://github.com/ldtteam/minecolonies/commit/2163b0f521282d0e54ee1e9007014b11e7b00416", "message": "improve translation constants\n\n * Move the townhall gui translation keys from WindowTownHall to\nTranslationConstants\n * add NonNls annotation to raid name TranslationConstants\n * make some formatting more consistent", "committedDate": "2020-09-10T10:17:50Z", "type": "commit"}, {"oid": "3ee91299ba565258250ae78d2e893e362d15e050", "url": "https://github.com/ldtteam/minecolonies/commit/3ee91299ba565258250ae78d2e893e362d15e050", "message": "remove todo for a better way to detect upgrading\n\ncast work order to WorkOrderBuild instead of WorkOrderBuildBuilding", "committedDate": "2020-09-10T16:15:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ3NjMyNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486476327", "bodyText": "Something here seems off", "author": "Raycoms", "createdAt": "2020-09-10T16:27:09Z", "path": "src/main/java/com/minecolonies/coremod/colony/colonyEvents/citizenEvents/CitizenBornEvent.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package com.minecolonies.coremod.colony.colonyEvents.citizenEvents;\n+\n+import org.jetbrains.annotations.NotNull;\n+\n+import com.minecolonies.api.util.constant.Constants;\n+\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.network.PacketBuffer;\n+import net.minecraft.util.ResourceLocation;\n+", "originalCommit": "3ee91299ba565258250ae78d2e893e362d15e050", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ3NzU0MA==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486477540", "bodyText": "why? its just three imports and an empty line before the class description.", "author": "ToMe25", "createdAt": "2020-09-10T16:29:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ3NjMyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ3NjQzNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486476437", "bodyText": "also here", "author": "Raycoms", "createdAt": "2020-09-10T16:27:19Z", "path": "src/main/java/com/minecolonies/coremod/colony/colonyEvents/citizenEvents/CitizenGrownUpEvent.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package com.minecolonies.coremod.colony.colonyEvents.citizenEvents;\n+\n+import org.jetbrains.annotations.NotNull;\n+\n+import com.minecolonies.api.util.constant.Constants;", "originalCommit": "3ee91299ba565258250ae78d2e893e362d15e050", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ3Nzk0Mw==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486477943", "bodyText": "do you mean the empty line?\nif yes, thats how eclipse formats imports, i can remove it if you want.", "author": "ToMe25", "createdAt": "2020-09-10T16:29:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ3NjQzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ4NTg0Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486485846", "bodyText": "nvm, it was a github problem", "author": "Raycoms", "createdAt": "2020-09-10T16:42:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ3NjQzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ3NzAyMg==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486477022", "bodyText": "I feel like those things would fit better into the constructor of the event instead of manually setting pos and name.", "author": "Raycoms", "createdAt": "2020-09-10T16:28:16Z", "path": "src/main/java/com/minecolonies/coremod/colony/managers/CitizenManager.java", "diffHunk": "@@ -295,6 +297,11 @@ private ICitizenData spawnCitizenOnPosition(\n         entity.setPosition(spawnPoint.getX() + HALF_BLOCK, spawnPoint.getY() + SLIGHTLY_UP, spawnPoint.getZ() + HALF_BLOCK);\n         world.addEntity(entity);\n \n+        AbstractCitizenEvent spawnEvent = citizenData.isChild() ? new CitizenBornEvent() : new CitizenSpawnedEvent();\n+        spawnEvent.setEventPos(spawnPoint);\n+        spawnEvent.setCitizenName(citizenData.getName());\n+        colony.getEventManager().addEventDescription(spawnEvent);", "originalCommit": "3ee91299ba565258250ae78d2e893e362d15e050", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ3OTk3Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486479976", "bodyText": "thats a relic from a changed implementation, i thought i changed it, but seems like i didn't.", "author": "ToMe25", "createdAt": "2020-09-10T16:32:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ3NzAyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUwOTYwMA==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486509600", "bodyText": "This time i really changed that, and not just planned to do it xD", "author": "ToMe25", "createdAt": "2020-09-10T17:22:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ3NzAyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUxMDA4Mw==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486510083", "bodyText": "\ud83d\udc4d xD", "author": "Raycoms", "createdAt": "2020-09-10T17:22:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ3NzAyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ4NjExMQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486486111", "bodyText": "formatting here is off", "author": "Raycoms", "createdAt": "2020-09-10T16:42:46Z", "path": "src/main/java/com/minecolonies/coremod/colony/managers/EventManager.java", "diffHunk": "@@ -81,6 +87,16 @@ public void addEvent(final IColonyEvent colonyEvent)\n         colony.markDirty();\n     }\n \n+    @Override\n+    public void addEventDescription(IColonyEventDescription colonyEventDescription) {", "originalCommit": "3ee91299ba565258250ae78d2e893e362d15e050", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUwOTM4OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486509389", "bodyText": "fixed.", "author": "ToMe25", "createdAt": "2020-09-10T17:21:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ4NjExMQ=="}], "type": "inlineReview"}, {"oid": "396304fca94b8c27e191a270a92c6a4d32544e55", "url": "https://github.com/ldtteam/minecolonies/commit/396304fca94b8c27e191a270a92c6a4d32544e55", "message": "Some fixes\n\n * fix event log overlapping with gui border\n * move some value initialization to constructors", "committedDate": "2020-09-10T17:21:25Z", "type": "commit"}, {"oid": "0a7dfe510e53dfa423ec1a9e2aac4bc4079ec7ba", "url": "https://github.com/ldtteam/minecolonies/commit/0a7dfe510e53dfa423ec1a9e2aac4bc4079ec7ba", "message": "Merge branch 'version/1.15' into feature/colony_event_log", "committedDate": "2020-09-11T09:37:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkxOTE3OA==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486919178", "bodyText": "this is also used for entity respawning, which would trigger the event again", "author": "someaddons", "createdAt": "2020-09-11T09:40:31Z", "path": "src/main/java/com/minecolonies/coremod/colony/managers/CitizenManager.java", "diffHunk": "@@ -295,6 +297,9 @@ private ICitizenData spawnCitizenOnPosition(\n         entity.setPosition(spawnPoint.getX() + HALF_BLOCK, spawnPoint.getY() + SLIGHTLY_UP, spawnPoint.getZ() + HALF_BLOCK);\n         world.addEntity(entity);\n \n+        colony.getEventManager().addEventDescription(citizenData.isChild() ? new CitizenBornEvent(spawnPoint, citizenData.getName()) :\n+              new CitizenSpawnedEvent(spawnPoint, citizenData.getName()));", "originalCommit": "0a7dfe510e53dfa423ec1a9e2aac4bc4079ec7ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkyNDE1OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486924159", "bodyText": "\"entity respawning\" as in loading the world again, or recalling, or...?", "author": "ToMe25", "createdAt": "2020-09-11T09:45:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkxOTE3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkyNTA2Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486925067", "bodyText": "loading the world no, but if its missing or gets recalled to respawn etc, minecraft sometimes looses the entities and we need to respawn them", "author": "someaddons", "createdAt": "2020-09-11T09:46:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkxOTE3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkzMjA2Mg==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486932062", "bodyText": "if the citizen goes missing, does citizenData.getEntity() return null, or an invalid entity?", "author": "ToMe25", "createdAt": "2020-09-11T09:53:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkxOTE3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkzNTU2MA==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486935560", "bodyText": "could be either", "author": "someaddons", "createdAt": "2020-09-11T09:57:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkxOTE3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkzOTI4OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486939289", "bodyText": "BuildingHome has the child spawn, and the RecruitmentInteraction has the visitors", "author": "someaddons", "createdAt": "2020-09-11T10:00:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkxOTE3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk3OTg3NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486979875", "bodyText": "so the only solution is to move the event handling to the classes requesting the citizen spawn instead of the spawn handler?", "author": "ToMe25", "createdAt": "2020-09-11T11:20:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkxOTE3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk4MTg3NA==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486981874", "bodyText": "well spawning is only the entity, not the citizen itself. Entities are exchangeable/get lost, citizenData is the actualy citizen", "author": "someaddons", "createdAt": "2020-09-11T11:25:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkxOTE3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk4MjY5Mw==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486982693", "bodyText": "wait, does that mean i can handle that in the CitizenData constructor?", "author": "ToMe25", "createdAt": "2020-09-11T11:27:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkxOTE3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk4MzM5NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486983395", "bodyText": "no thats called upon loading too :D", "author": "someaddons", "createdAt": "2020-09-11T11:28:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkxOTE3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk4MzgzMQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486983831", "bodyText": "once the crash is fixed i will look more into this.", "author": "ToMe25", "createdAt": "2020-09-11T11:29:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkxOTE3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIwMjU1NA==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487202554", "bodyText": "seems like the recent citizen loading changes cause world loading to sometimes cause a citizen spawned event, but not always.", "author": "ToMe25", "createdAt": "2020-09-11T17:58:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkxOTE3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg4NDE4NA==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487884184", "bodyText": "I hope this should be completely done now.\nI tested it some time and it seems to fully work.", "author": "ToMe25", "createdAt": "2020-09-14T12:47:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkxOTE3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkyMDk1OA==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486920958", "bodyText": "ColonyEvents are quite different from event descriptions, those are ongoing timed events for a colony like a pirate raid. I don't think that the event descriptions belong into here at all, better move them to their own file.", "author": "someaddons", "createdAt": "2020-09-11T09:42:23Z", "path": "src/main/java/com/minecolonies/coremod/colony/managers/EventManager.java", "diffHunk": "@@ -53,6 +59,11 @@\n      */\n     private final Map<Integer, IColonyEvent> events = new HashMap<>();\n \n+    /**\n+     * The event descriptions of this colony.\n+     */\n+    private final LinkedList<IColonyEventDescription> eventDescs = new LinkedList<>();\n+", "originalCommit": "0a7dfe510e53dfa423ec1a9e2aac4bc4079ec7ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkyNTQyMA==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486925420", "bodyText": "I have them here, because that way i can reuse code from the EventManager, but i can move them to their own class.", "author": "ToMe25", "createdAt": "2020-09-11T09:46:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkyMDk1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkyOTE5MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r486929191", "bodyText": "ye make the own manager for it, like ColonyHistoricEventManager or os", "author": "someaddons", "createdAt": "2020-09-11T09:50:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkyMDk1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEyMjk1Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487122957", "bodyText": "Maybe call it ColonyLogManager?", "author": "Raycoms", "createdAt": "2020-09-11T15:30:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkyMDk1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEyMzAyMw==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487123023", "bodyText": "it's kinda a log", "author": "Raycoms", "createdAt": "2020-09-11T15:30:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkyMDk1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEyNTMwMw==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487125303", "bodyText": "I called it EventDescriptionManager, but i want to test it before pushing it, and i can't do that because of the crash.", "author": "ToMe25", "createdAt": "2020-09-11T15:34:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkyMDk1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIwMjE5NA==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487202194", "bodyText": "this should be done now.", "author": "ToMe25", "createdAt": "2020-09-11T17:57:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkyMDk1OA=="}], "type": "inlineReview"}, {"oid": "a1ba5698bb7f24bbca803711ef54361bfebb5e8b", "url": "https://github.com/ldtteam/minecolonies/commit/a1ba5698bb7f24bbca803711ef54361bfebb5e8b", "message": "Merge branch 'version/1.15' into feature/colony_event_log", "committedDate": "2020-09-11T17:47:17Z", "type": "commit"}, {"oid": "80fa887c08d2ad99f449b07cf09db12da8fde6aa", "url": "https://github.com/ldtteam/minecolonies/commit/80fa887c08d2ad99f449b07cf09db12da8fde6aa", "message": "Move event description handling to its own class", "committedDate": "2020-09-11T17:57:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3MTU3OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487771579", "bodyText": "Please rename the methods in this interface to be more accurate.\nAka getBuildingName instead of getBuilding", "author": "OrionDevelopment", "createdAt": "2020-09-14T09:22:11Z", "path": "src/api/java/com/minecolonies/api/colony/colonyEvents/descriptions/IBuildingEventDescription.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package com.minecolonies.api.colony.colonyEvents.descriptions;\n+\n+/**\n+ * Event description for building events.\n+ */\n+public interface IBuildingEventDescription extends IColonyEventDescription", "originalCommit": "80fa887c08d2ad99f449b07cf09db12da8fde6aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg4Mzc0OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487883749", "bodyText": "done.", "author": "ToMe25", "createdAt": "2020-09-14T12:46:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3MTU3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3MTk4OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487771989", "bodyText": "extends INBTSerializable<CompoundNBT> should be used here instead of the custom methods.", "author": "OrionDevelopment", "createdAt": "2020-09-14T09:22:54Z", "path": "src/api/java/com/minecolonies/api/colony/colonyEvents/descriptions/IColonyEventDescription.java", "diffHunk": "@@ -0,0 +1,79 @@\n+package com.minecolonies.api.colony.colonyEvents.descriptions;\n+\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.network.PacketBuffer;\n+import net.minecraft.util.ResourceLocation;\n+import net.minecraft.util.math.BlockPos;\n+\n+/**\n+ * Description for an event that happened in the colony.\n+ */\n+public interface IColonyEventDescription", "originalCommit": "80fa887c08d2ad99f449b07cf09db12da8fde6aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg4MzcxNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487883717", "bodyText": "done.", "author": "ToMe25", "createdAt": "2020-09-14T12:46:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3MTk4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkwMDE5Mw==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487900193", "bodyText": "This is now also done for IColonyEvent.", "author": "ToMe25", "createdAt": "2020-09-14T13:11:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3MTk4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3MjE0Mg==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487772142", "bodyText": "Use the NBTTagConstantsClass", "author": "OrionDevelopment", "createdAt": "2020-09-14T09:23:12Z", "path": "src/api/java/com/minecolonies/api/colony/colonyEvents/descriptions/NBTTags.java", "diffHunk": "@@ -0,0 +1,13 @@\n+package com.minecolonies.api.colony.colonyEvents.descriptions;\n+\n+/**\n+ * NBT tags used in colony events.\n+ */\n+public abstract class NBTTags", "originalCommit": "80fa887c08d2ad99f449b07cf09db12da8fde6aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc5NDE3OA==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487794178", "bodyText": "ok, i did it like this because that is how IColonyEvent handles its tags.", "author": "ToMe25", "createdAt": "2020-09-14T10:00:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3MjE0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgxMTEzMg==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487811132", "bodyText": "Then fix that too \ud83d\ude04", "author": "OrionDevelopment", "createdAt": "2020-09-14T10:30:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3MjE0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg4MzY3Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487883676", "bodyText": "done.", "author": "ToMe25", "createdAt": "2020-09-14T12:46:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3MjE0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3MjYxNQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487772615", "bodyText": "Rework this class so that it does not expose the inner function callbacks.", "author": "OrionDevelopment", "createdAt": "2020-09-14T09:24:00Z", "path": "src/api/java/com/minecolonies/api/colony/colonyEvents/registry/ColonyEventDescriptionTypeRegistryEntry.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package com.minecolonies.api.colony.colonyEvents.registry;\n+\n+import com.minecolonies.api.colony.colonyEvents.descriptions.IColonyEventDescription;\n+import com.minecolonies.api.util.Log;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.network.PacketBuffer;\n+import net.minecraft.util.ResourceLocation;\n+import net.minecraftforge.registries.ForgeRegistryEntry;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.function.Function;\n+\n+/**\n+ * This is the colonies event registry entry class, used for registering any colony related events. Takes a function of colony, nbt to create the right event object.\n+ */\n+public class ColonyEventDescriptionTypeRegistryEntry extends ForgeRegistryEntry<ColonyEventDescriptionTypeRegistryEntry>", "originalCommit": "80fa887c08d2ad99f449b07cf09db12da8fde6aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc5NTQ5OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487795499", "bodyText": "This is how its handled for IColonyEvents tho, does it really have to change?", "author": "ToMe25", "createdAt": "2020-09-14T10:02:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3MjYxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgxMTQxNg==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487811416", "bodyText": "Yes.\nThe functions are inner information that is not supposed to be exposed to the external world.\nPlease fix this in IColonyEvent as well.", "author": "OrionDevelopment", "createdAt": "2020-09-14T10:30:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3MjYxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg4MzYwMQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487883601", "bodyText": "done.", "author": "ToMe25", "createdAt": "2020-09-14T12:46:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3MjYxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3MzAyNg==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487773026", "bodyText": "Again missing the INBTSerializable<CompoundNBT> instead of using the custom methods.", "author": "OrionDevelopment", "createdAt": "2020-09-14T09:24:41Z", "path": "src/api/java/com/minecolonies/api/colony/managers/interfaces/IEventDescriptionManager.java", "diffHunk": "@@ -0,0 +1,42 @@\n+package com.minecolonies.api.colony.managers.interfaces;\n+\n+import com.minecolonies.api.colony.colonyEvents.descriptions.IColonyEventDescription;\n+\n+import net.minecraft.nbt.CompoundNBT;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.List;\n+\n+/**\n+ * Interface for the event description manager, the event description manager deals the colony event log events.\n+ */\n+public interface IEventDescriptionManager", "originalCommit": "80fa887c08d2ad99f449b07cf09db12da8fde6aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg4MzU1Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487883556", "bodyText": "done.", "author": "ToMe25", "createdAt": "2020-09-14T12:46:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3MzAyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3MzU3MA==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487773570", "bodyText": "What happened here?", "author": "OrionDevelopment", "createdAt": "2020-09-14T09:25:28Z", "path": "src/main/java/com/minecolonies/apiimp/CommonMinecoloniesAPIImpl.java", "diffHunk": "@@ -38,20 +39,21 @@\n \n public class CommonMinecoloniesAPIImpl implements IMinecoloniesAPI\n {\n-    private final  IColonyManager                                  colonyManager          = new ColonyManager();\n-    private final  ICitizenDataManager                             citizenDataManager     = new CitizenDataManager();\n-    private final  IMobAIRegistry                                  mobAIRegistry          = new MobAIRegistry();\n-    private final  IPathNavigateRegistry                           pathNavigateRegistry   = new PathNavigateRegistry();\n-    private        IForgeRegistry<BuildingEntry>                   buildingRegistry;\n-    private final  IBuildingDataManager                            buildingDataManager    = new BuildingDataManager();\n-    private final  IJobDataManager                                 jobDataManager         = new JobDataManager();\n-    private final  IGuardTypeDataManager                           guardTypeDataManager   = new com.minecolonies.coremod.colony.buildings.registry.GuardTypeDataManager();\n-    private        IForgeRegistry<JobEntry>                        jobRegistry;\n-    private        IForgeRegistry<GuardType>                       guardTypeRegistry;\n-    private        IForgeRegistry<InteractionResponseHandlerEntry> interactionHandlerRegistry;\n-    private final  IInteractionResponseHandlerDataManager          interactionDataManager = new InteractionResponseHandlerManager();\n-    private        IForgeRegistry<ColonyEventTypeRegistryEntry>    colonyEventRegistry;\n-    private static IGlobalResearchTree                             globalResearchTree     = new GlobalResearchTree();\n+    private final  IColonyManager                                          colonyManager          = new ColonyManager();\n+    private final  ICitizenDataManager                                     citizenDataManager     = new CitizenDataManager();\n+    private final  IMobAIRegistry                                          mobAIRegistry          = new MobAIRegistry();\n+    private final  IPathNavigateRegistry                                   pathNavigateRegistry   = new PathNavigateRegistry();\n+    private        IForgeRegistry<BuildingEntry>                           buildingRegistry;\n+    private final  IBuildingDataManager                                    buildingDataManager    = new BuildingDataManager();\n+    private final  IJobDataManager                                         jobDataManager         = new JobDataManager();\n+    private final  IGuardTypeDataManager                                   guardTypeDataManager   = new com.minecolonies.coremod.colony.buildings.registry.GuardTypeDataManager();\n+    private        IForgeRegistry<JobEntry>                                jobRegistry;\n+    private        IForgeRegistry<GuardType>                               guardTypeRegistry;\n+    private        IForgeRegistry<InteractionResponseHandlerEntry>         interactionHandlerRegistry;\n+    private final  IInteractionResponseHandlerDataManager                  interactionDataManager = new InteractionResponseHandlerManager();\n+    private        IForgeRegistry<ColonyEventTypeRegistryEntry>            colonyEventRegistry;\n+    private        IForgeRegistry<ColonyEventDescriptionTypeRegistryEntry> colonyEventDescriptionRegistry;\n+    private static IGlobalResearchTree                                     globalResearchTree     = new GlobalResearchTree();", "originalCommit": "80fa887c08d2ad99f449b07cf09db12da8fde6aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc5MzY0Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487793647", "bodyText": "formatting changes happened here, there were spaces to make all the names start at the same point, and since the new one has a longer type i moved all the var names.", "author": "ToMe25", "createdAt": "2020-09-14T09:59:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3MzU3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgxMTQ2NA==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487811464", "bodyText": "Okey", "author": "OrionDevelopment", "createdAt": "2020-09-14T10:30:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3MzU3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3Njk2Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487776967", "bodyText": "Yeah you will need to modify this.\nThis call location is less then appropriate.\nFind the code that actually triggers the birth and fire it from there.", "author": "OrionDevelopment", "createdAt": "2020-09-14T09:31:20Z", "path": "src/main/java/com/minecolonies/coremod/colony/managers/CitizenManager.java", "diffHunk": "@@ -282,6 +284,9 @@ private ICitizenData spawnCitizenOnPosition(\n         entity.setPosition(spawnPoint.getX() + HALF_BLOCK, spawnPoint.getY() + SLIGHTLY_UP, spawnPoint.getZ() + HALF_BLOCK);\n         world.addEntity(entity);\n \n+        colony.getEventDescriptionManager().addEventDescription(citizenData.isChild() ? new CitizenBornEvent(spawnPoint, citizenData.getName()) :", "originalCommit": "80fa887c08d2ad99f449b07cf09db12da8fde6aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc5Mjc3Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487792776", "bodyText": "Addons already told me this, i will fix this once i continue working on this pr later today.", "author": "ToMe25", "createdAt": "2020-09-14T09:57:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3Njk2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg4MzUxNQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5751#discussion_r487883515", "bodyText": "done.", "author": "ToMe25", "createdAt": "2020-09-14T12:46:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3Njk2Nw=="}], "type": "inlineReview"}, {"oid": "e42192e2f869547c7d9bedd8ac1a3e7d0c2b9979", "url": "https://github.com/ldtteam/minecolonies/commit/e42192e2f869547c7d9bedd8ac1a3e7d0c2b9979", "message": "Merge branch 'version/1.15' into feature/colony_event_log", "committedDate": "2020-09-14T09:57:00Z", "type": "commit"}, {"oid": "6cc6ddb3c12228e9243062211bbb867050d7277d", "url": "https://github.com/ldtteam/minecolonies/commit/6cc6ddb3c12228e9243062211bbb867050d7277d", "message": "add a missing param annotation", "committedDate": "2020-09-14T10:03:58Z", "type": "commit"}, {"oid": "09147a80c0bc6fbc555738f11db572fc248b4e80", "url": "https://github.com/ldtteam/minecolonies/commit/09147a80c0bc6fbc555738f11db572fc248b4e80", "message": "Fix citizen event descriptions getting created on world loading\n\n * Also merege NBTTags class into NbtTagConstants\n * make visitor spawns cause new VisitorSpawnedEvents instead of\nCitizenSpawnedEvents\n * make IColonyEventDescription and IEventDescriptionManager extend\nINBTSerializable\n * don't expose deserialization function in ColonyEventTypeRegistryEntry\nand ColonyEventDescriptionTypeRegistryEntry", "committedDate": "2020-09-14T12:46:06Z", "type": "commit"}, {"oid": "d1f0593afb20359513ac38bbc53552ef6b824224", "url": "https://github.com/ldtteam/minecolonies/commit/d1f0593afb20359513ac38bbc53552ef6b824224", "message": "Merge branch 'version/1.15' into feature/colony_event_log", "committedDate": "2020-09-14T12:46:25Z", "type": "commit"}, {"oid": "45eb5e4899210513889769666f23205d0c342339", "url": "https://github.com/ldtteam/minecolonies/commit/45eb5e4899210513889769666f23205d0c342339", "message": "Fix EventDescriptionManager serialization\n\n * Also fix a comment in VisitorSpawnedEvent\n * also make IColonyEvent implement INBTServializable", "committedDate": "2020-09-14T13:11:10Z", "type": "commit"}, {"oid": "dd7e3acb114aaadfb5f9825c711bed58480289cd", "url": "https://github.com/ldtteam/minecolonies/commit/dd7e3acb114aaadfb5f9825c711bed58480289cd", "message": "Fix some formatting", "committedDate": "2020-09-14T16:10:48Z", "type": "commit"}, {"oid": "63627c97ab4ae9988a8ea1bd9c602b54c76a8ca2", "url": "https://github.com/ldtteam/minecolonies/commit/63627c97ab4ae9988a8ea1bd9c602b54c76a8ca2", "message": "Merge branch 'version/1.15' into feature/colony_event_log", "committedDate": "2020-09-14T16:12:30Z", "type": "commit"}]}