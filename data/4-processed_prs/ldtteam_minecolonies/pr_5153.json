{"pr_number": 5153, "pr_title": "Feature/vikings", "pr_createdAt": "2020-06-04T14:54:02Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/5153", "timeline": [{"oid": "0c112bd2bd47ba6a4966f37648c4d4bba16dff7e", "url": "https://github.com/ldtteam/minecolonies/commit/0c112bd2bd47ba6a4966f37648c4d4bba16dff7e", "message": "Add icons", "committedDate": "2020-05-29T17:25:57Z", "type": "commit"}, {"oid": "c1e4e10b05383450624c8ee8d58a05bc84394004", "url": "https://github.com/ldtteam/minecolonies/commit/c1e4e10b05383450624c8ee8d58a05bc84394004", "message": "Vikings preparations", "committedDate": "2020-05-29T18:28:33Z", "type": "commit"}, {"oid": "ac3004a92bc1453c325333eea06b3943995404ae", "url": "https://github.com/ldtteam/minecolonies/commit/ac3004a92bc1453c325333eea06b3943995404ae", "message": "initial setup 1", "committedDate": "2020-05-29T19:40:34Z", "type": "commit"}, {"oid": "a197413dabe40f887bffd663d0ffdba9c505f424", "url": "https://github.com/ldtteam/minecolonies/commit/a197413dabe40f887bffd663d0ffdba9c505f424", "message": "Stage 2 of viking raid", "committedDate": "2020-05-30T18:53:37Z", "type": "commit"}, {"oid": "9520a7cdc1392c1a06bccceed9f025d77e9736eb", "url": "https://github.com/ldtteam/minecolonies/commit/9520a7cdc1392c1a06bccceed9f025d77e9736eb", "message": "alter dump counters", "committedDate": "2020-05-30T18:53:50Z", "type": "commit"}, {"oid": "2baaa602d5e69e16f974a3dfab83a2b72bb4329c", "url": "https://github.com/ldtteam/minecolonies/commit/2baaa602d5e69e16f974a3dfab83a2b72bb4329c", "message": "fix #5115", "committedDate": "2020-05-31T10:46:26Z", "type": "commit"}, {"oid": "e4721d2d65908ce1266ca945da9f2a00777f5c54", "url": "https://github.com/ldtteam/minecolonies/commit/e4721d2d65908ce1266ca945da9f2a00777f5c54", "message": "Vikings part 3", "committedDate": "2020-05-31T16:26:45Z", "type": "commit"}, {"oid": "693555d61be32ca66e9b2a40d403c684d9064ef3", "url": "https://github.com/ldtteam/minecolonies/commit/693555d61be32ca66e9b2a40d403c684d9064ef3", "message": "Finish ship handling", "committedDate": "2020-06-01T15:28:56Z", "type": "commit"}, {"oid": "e548aaedbc55f7dda5ee786121fe1c42aa8e6406", "url": "https://github.com/ldtteam/minecolonies/commit/e548aaedbc55f7dda5ee786121fe1c42aa8e6406", "message": "Merge branch 'version/1.15' into feature/vikings", "committedDate": "2020-06-02T10:37:52Z", "type": "commit"}, {"oid": "2c0429c241c0552d3bbf1279bf2a437afa63d6eb", "url": "https://github.com/ldtteam/minecolonies/commit/2c0429c241c0552d3bbf1279bf2a437afa63d6eb", "message": "merge raiders fix", "committedDate": "2020-06-02T10:38:54Z", "type": "commit"}, {"oid": "7c186c33b423e19901c20572c20cf13f1eaf501c", "url": "https://github.com/ldtteam/minecolonies/commit/7c186c33b423e19901c20572c20cf13f1eaf501c", "message": "fix this up", "committedDate": "2020-06-02T13:20:24Z", "type": "commit"}, {"oid": "53ae226f9d7452acc9a875cbfd60825360958afc", "url": "https://github.com/ldtteam/minecolonies/commit/53ae226f9d7452acc9a875cbfd60825360958afc", "message": "fix enchanter GUI issue and healer stuck", "committedDate": "2020-06-02T14:49:28Z", "type": "commit"}, {"oid": "725852ab9c4c7b91a2683b869750bcb21cbbcf32", "url": "https://github.com/ldtteam/minecolonies/commit/725852ab9c4c7b91a2683b869750bcb21cbbcf32", "message": "Merge branch 'version/1.15' into feature/vikings", "committedDate": "2020-06-04T14:36:19Z", "type": "commit"}, {"oid": "450a959a0093b5c372ef72f7ad73579b16a1c6d6", "url": "https://github.com/ldtteam/minecolonies/commit/450a959a0093b5c372ef72f7ad73579b16a1c6d6", "message": "fix models and minor cleanup", "committedDate": "2020-06-04T14:59:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM1NDA5MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435354091", "bodyText": "constants for all the NBT Tags please :D", "author": "someaddons", "createdAt": "2020-06-04T15:36:19Z", "path": "src/main/java/com/minecolonies/coremod/util/CreativeRaiderStructureHandler.java", "diffHunk": "@@ -0,0 +1,152 @@\n+package com.minecolonies.coremod.util;\n+\n+import com.ldtteam.structures.blueprints.v1.Blueprint;\n+import com.ldtteam.structurize.api.util.Log;\n+import com.ldtteam.structurize.blocks.interfaces.IBlueprintDataProvider;\n+import com.ldtteam.structurize.management.Manager;\n+import com.ldtteam.structurize.placement.StructurePlacer;\n+import com.ldtteam.structurize.placement.structure.CreativeStructureHandler;\n+import com.ldtteam.structurize.placement.structure.IStructureHandler;\n+import com.ldtteam.structurize.util.BlockInfo;\n+import com.ldtteam.structurize.util.PlacementSettings;\n+import com.ldtteam.structurize.util.TickedWorldOperation;\n+import com.minecolonies.api.colony.colonyEvents.IColonyRaidEvent;\n+import com.minecolonies.api.util.BlockPosUtil;\n+import com.minecolonies.coremod.colony.colonyEvents.raidEvents.pirateEvent.ShipBasedRaiderUtils;\n+import net.minecraft.block.Blocks;\n+import net.minecraft.entity.player.ServerPlayerEntity;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.tileentity.TileEntity;\n+import net.minecraft.util.Mirror;\n+import net.minecraft.util.Rotation;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.World;\n+import org.jetbrains.annotations.NotNull;\n+import org.jetbrains.annotations.Nullable;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+\n+import static com.ldtteam.structurize.blocks.interfaces.IBlueprintDataProvider.TAG_BLUEPRINTDATA;\n+\n+/**\n+ * Raider specific creative structure handler.\n+ * Will correctly place spawners\n+ */\n+public final class CreativeRaiderStructureHandler extends CreativeStructureHandler\n+{\n+    /**\n+     * Map for the spawner positions.\n+     */\n+    private Map<BlockPos, List<String>> map;\n+\n+    /**\n+     * The raid event associated to this.\n+     */\n+    private IColonyRaidEvent event;\n+\n+    /**\n+     * The colony id.\n+     */\n+    private int colonyId;\n+\n+    /**\n+     * The minecolonies specific creative structure placer.\n+     * @param world the world.\n+     * @param pos the pos it is placed at.\n+     * @param structureName the name of the structure.\n+     * @param settings the placement settings.\n+     * @param fancyPlacement if fancy or complete.\n+     * @param event the raid event.\n+     * @param colonyId the colony id.\n+     */\n+    public CreativeRaiderStructureHandler(final World world, final BlockPos pos, final String structureName, final PlacementSettings settings, final boolean fancyPlacement, final IColonyRaidEvent event, final int colonyId)\n+    {\n+        super(world, pos, structureName, settings, fancyPlacement);\n+        getBluePrint().rotateWithMirror(settings.getRotation(), settings.getMirror(), world);\n+\n+        this.event = event;\n+        this.colonyId = colonyId;\n+        final BlockInfo info = getBluePrint().getBlockInfoAsMap().getOrDefault(getBluePrint().getPrimaryBlockOffset(), null);\n+        if (info.getTileEntityData() != null)\n+        {\n+            final CompoundNBT teData = getBluePrint().getTileEntityData(pos, getBluePrint().getPrimaryBlockOffset());\n+            if (teData != null && teData.contains(TAG_BLUEPRINTDATA))\n+            {\n+                final TileEntity entity = TileEntity.create(info.getTileEntityData());\n+                if (entity instanceof IBlueprintDataProvider)\n+                {\n+                    entity.setPos(pos);\n+                    this.map = ((IBlueprintDataProvider) entity).getWorldTagPosMap();\n+                }\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public void triggerSuccess(final BlockPos pos, final List<ItemStack> list, final boolean placement)\n+    {\n+        super.triggerSuccess(pos, list, placement);\n+        final BlockPos worldPos = getProgressPosInWorld(pos);\n+        if (getWorld().getBlockState(worldPos).getBlock() == Blocks.GOLD_BLOCK)\n+        {\n+            final List<String> tags = map.getOrDefault(worldPos, Collections.emptyList());\n+            for (final String tag: tags)\n+            {\n+                switch (tag)\n+                {\n+                    case \"normal\":", "originalCommit": "450a959a0093b5c372ef72f7ad73579b16a1c6d6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM1NTUzMA==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435355530", "bodyText": "javadoc", "author": "someaddons", "createdAt": "2020-06-04T15:37:43Z", "path": "src/api/java/com/minecolonies/api/entity/mobs/egyptians/IMeleeMummyEntity.java", "diffHunk": "@@ -1,7 +1,6 @@\n package com.minecolonies.api.entity.mobs.egyptians;\n \n import com.minecolonies.api.entity.mobs.IMeleeMobEntity;\n-import com.minecolonies.api.entity.mobs.pirates.IPirateEntity;\n \n public interface IMeleeMummyEntity extends IEgyptianEntity, IMeleeMobEntity", "originalCommit": "450a959a0093b5c372ef72f7ad73579b16a1c6d6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM1NTk5NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435355995", "bodyText": "javadoc", "author": "someaddons", "createdAt": "2020-06-04T15:38:10Z", "path": "src/api/java/com/minecolonies/api/entity/mobs/vikings/IArcherNorsemenEntity.java", "diffHunk": "@@ -0,0 +1,8 @@\n+package com.minecolonies.api.entity.mobs.vikings;\n+\n+import com.minecolonies.api.entity.mobs.IArcherMobEntity;\n+\n+public interface IArcherNorsemenEntity extends IVikingEntity, IArcherMobEntity", "originalCommit": "450a959a0093b5c372ef72f7ad73579b16a1c6d6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM1NjI1Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435356256", "bodyText": "javadoc", "author": "someaddons", "createdAt": "2020-06-04T15:38:24Z", "path": "src/api/java/com/minecolonies/api/entity/mobs/vikings/IMeleeNorsemenEntity.java", "diffHunk": "@@ -0,0 +1,10 @@\n+package com.minecolonies.api.entity.mobs.vikings;\n+\n+import com.minecolonies.api.entity.mobs.IMeleeMobEntity;\n+import com.minecolonies.api.entity.mobs.egyptians.IEgyptianEntity;\n+import com.minecolonies.api.entity.mobs.pirates.IPirateEntity;\n+\n+public interface IMeleeNorsemenEntity extends IVikingEntity, IMeleeMobEntity", "originalCommit": "450a959a0093b5c372ef72f7ad73579b16a1c6d6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM1NjM5NA==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435356394", "bodyText": "javadoc", "author": "someaddons", "createdAt": "2020-06-04T15:38:32Z", "path": "src/api/java/com/minecolonies/api/entity/mobs/vikings/INorsemenChiefEntity.java", "diffHunk": "@@ -0,0 +1,8 @@\n+package com.minecolonies.api.entity.mobs.vikings;\n+\n+import com.minecolonies.api.entity.mobs.IChiefMobEntity;\n+\n+public interface INorsemenChiefEntity extends IVikingEntity, IChiefMobEntity", "originalCommit": "450a959a0093b5c372ef72f7ad73579b16a1c6d6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM1NjUwNQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435356505", "bodyText": "javadoc", "author": "someaddons", "createdAt": "2020-06-04T15:38:39Z", "path": "src/api/java/com/minecolonies/api/entity/mobs/vikings/IVikingEntity.java", "diffHunk": "@@ -0,0 +1,11 @@\n+package com.minecolonies.api.entity.mobs.vikings;\n+\n+import net.minecraft.command.ICommandSource;\n+import net.minecraft.entity.monster.IMob;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraftforge.common.capabilities.ICapabilitySerializable;\n+\n+public interface IVikingEntity extends IMob, ICommandSource, ICapabilitySerializable<CompoundNBT>", "originalCommit": "450a959a0093b5c372ef72f7ad73579b16a1c6d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM1NzEyOA==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435357128", "bodyText": "ICommandSource, ICapabilitySerializable whatfor does it use those?", "author": "someaddons", "createdAt": "2020-06-04T15:39:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM1NjUwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ4ODc5OA==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435488798", "bodyText": "I don't recall, all of our entities main interfaces got those", "author": "Raycoms", "createdAt": "2020-06-04T19:07:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM1NjUwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM1ODM1MA==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435358350", "bodyText": "not sure why you're making the items for them, spawn items arent working for raiders anyways :D", "author": "someaddons", "createdAt": "2020-06-04T15:40:29Z", "path": "src/main/java/com/minecolonies/apiimp/initializer/ModItemsInitializer.java", "diffHunk": "@@ -115,6 +115,10 @@ public static void init(final IForgeRegistry<Item> registry)\n         registry.register(new SpawnEggItem(ModEntities.ARCHERMUMMY, PRIMARY_COLOR_EG, SECONDARY_COLOR_EG, (new Item.Properties()).group(ModCreativeTabs.MINECOLONIES)).setRegistryName(\"mummyarcheregg\"));\n         registry.register(new SpawnEggItem(ModEntities.PHARAO, PRIMARY_COLOR_EG, SECONDARY_COLOR_EG, (new Item.Properties()).group(ModCreativeTabs.MINECOLONIES)).setRegistryName(\"pharaoegg\"));\n \n+        registry.register(new SpawnEggItem(ModEntities.SHIELDMAIDEN, PRIMARY_COLOR_EG, SECONDARY_COLOR_EG, (new Item.Properties()).group(ModCreativeTabs.MINECOLONIES)).setRegistryName(\"shieldmaidenegg\"));", "originalCommit": "450a959a0093b5c372ef72f7ad73579b16a1c6d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ4ODkwMQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435488901", "bodyText": "I use them to debug things, I turn off the AI and use those.", "author": "Raycoms", "createdAt": "2020-06-04T19:08:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM1ODM1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ5MDY5MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435490691", "bodyText": "oh lol :D", "author": "someaddons", "createdAt": "2020-06-04T19:11:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM1ODM1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM2MDkzMA==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435360930", "bodyText": "what is the difference between those two textures? could maybe use that as name instead of var1 var2", "author": "someaddons", "createdAt": "2020-06-04T15:44:02Z", "path": "src/main/java/com/minecolonies/coremod/client/render/mobs/norsemen/RendererArcherNorsemen.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package com.minecolonies.coremod.client.render.mobs.norsemen;\n+\n+import com.minecolonies.api.entity.mobs.vikings.AbstractEntityNorsemen;\n+import com.minecolonies.coremod.client.model.raiders.ModelArcherNorsemen;\n+import net.minecraft.client.renderer.entity.EntityRendererManager;\n+import net.minecraft.entity.MobEntity;\n+import net.minecraft.util.ResourceLocation;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Renderer used for archer amazons.\n+ */\n+public class RendererArcherNorsemen extends AbstractRendererNorsemen\n+{\n+    /**\n+     * Texture of the entity.\n+     */\n+    private static final ResourceLocation TEXTURE1 = new ResourceLocation(\"minecolonies:textures/entity/raiders/norsemen_archer1.png\");\n+    private static final ResourceLocation TEXTURE2 = new ResourceLocation(\"minecolonies:textures/entity/raiders/norsemen_archer2.png\");", "originalCommit": "450a959a0093b5c372ef72f7ad73579b16a1c6d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ4OTA5MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435489091", "bodyText": "it's just a small variance to make it look more interesting.", "author": "Raycoms", "createdAt": "2020-06-04T19:08:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM2MDkzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM3OTk5MA==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435379990", "bodyText": "I just had nerfed it down to 1 captain, sure you want to buff it up again? :D", "author": "someaddons", "createdAt": "2020-06-04T16:12:05Z", "path": "src/main/java/com/minecolonies/coremod/colony/colonyEvents/raidEvents/pirateEvent/ShipSize.java", "diffHunk": "@@ -1,42 +1,33 @@\n package com.minecolonies.coremod.colony.colonyEvents.raidEvents.pirateEvent;\n \n import com.minecolonies.api.util.constant.ColonyConstants;\n-import net.minecraft.entity.EntityType;\n-\n-import static com.minecolonies.api.entity.ModEntities.*;\n \n /**\n  * Enum for ship sizes.\n  */\n public enum ShipSize\n {\n-    SMALL(ColonyConstants.SMALL_HORDE_SIZE, ColonyConstants.SMALL_PIRATE_SHIP, ColonyConstants.SMALL_HORDE_MESSAGE_ID, 1, PIRATE, PIRATE),\n+    SMALL(ColonyConstants.SMALL_HORDE_SIZE, ColonyConstants.SMALL_SHIP, ColonyConstants.SMALL_HORDE_MESSAGE_ID, 2, 2, 0, 0),\n     MEDIUM(ColonyConstants.MEDIUM_HORDE_SIZE,\n-      ColonyConstants.MEDIUM_PIRATE_SHIP,\n+      ColonyConstants.MEDIUM_SHIP,\n       ColonyConstants.MEDIUM_HORDE_MESSAGE_ID,\n-      3,\n-      PIRATE,\n-      ARCHERPIRATE,\n-      CHIEFPIRATE),\n+      4,\n+      1, 1, 1),\n     BIG(ColonyConstants.BIG_HORDE_SIZE,\n-      ColonyConstants.BIG_PIRATE_SHIP,\n+      ColonyConstants.BIG_SHIP,\n       ColonyConstants.BIG_HORDE_MESSAGE_ID,\n       11,\n-      PIRATE,\n-      PIRATE,\n-      ARCHERPIRATE,\n-      ARCHERPIRATE,\n-      CHIEFPIRATE);\n+      2, 2, 2);", "originalCommit": "450a959a0093b5c372ef72f7ad73579b16a1c6d6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM4MDk0NA==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435380944", "bodyText": "increased from 2 normal to 2 normal 2 archers, think 1 normal 1 archer fits best", "author": "someaddons", "createdAt": "2020-06-04T16:13:38Z", "path": "src/main/java/com/minecolonies/coremod/colony/colonyEvents/raidEvents/pirateEvent/ShipSize.java", "diffHunk": "@@ -1,42 +1,33 @@\n package com.minecolonies.coremod.colony.colonyEvents.raidEvents.pirateEvent;\n \n import com.minecolonies.api.util.constant.ColonyConstants;\n-import net.minecraft.entity.EntityType;\n-\n-import static com.minecolonies.api.entity.ModEntities.*;\n \n /**\n  * Enum for ship sizes.\n  */\n public enum ShipSize\n {\n-    SMALL(ColonyConstants.SMALL_HORDE_SIZE, ColonyConstants.SMALL_PIRATE_SHIP, ColonyConstants.SMALL_HORDE_MESSAGE_ID, 1, PIRATE, PIRATE),\n+    SMALL(ColonyConstants.SMALL_HORDE_SIZE, ColonyConstants.SMALL_SHIP, ColonyConstants.SMALL_HORDE_MESSAGE_ID, 2, 2, 0, 0),", "originalCommit": "450a959a0093b5c372ef72f7ad73579b16a1c6d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ0MjQxMQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435442411", "bodyText": "the first 2 is for the number of spawners", "author": "Raycoms", "createdAt": "2020-06-04T17:54:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM4MDk0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ0NDk3Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435444976", "bodyText": "you're right nvm^^", "author": "someaddons", "createdAt": "2020-06-04T17:58:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM4MDk0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM4MTkyOA==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435381928", "bodyText": "medium ship now has 4 spawners?", "author": "someaddons", "createdAt": "2020-06-04T16:15:13Z", "path": "src/main/java/com/minecolonies/coremod/colony/colonyEvents/raidEvents/pirateEvent/ShipSize.java", "diffHunk": "@@ -1,42 +1,33 @@\n package com.minecolonies.coremod.colony.colonyEvents.raidEvents.pirateEvent;\n \n import com.minecolonies.api.util.constant.ColonyConstants;\n-import net.minecraft.entity.EntityType;\n-\n-import static com.minecolonies.api.entity.ModEntities.*;\n \n /**\n  * Enum for ship sizes.\n  */\n public enum ShipSize\n {\n-    SMALL(ColonyConstants.SMALL_HORDE_SIZE, ColonyConstants.SMALL_PIRATE_SHIP, ColonyConstants.SMALL_HORDE_MESSAGE_ID, 1, PIRATE, PIRATE),\n+    SMALL(ColonyConstants.SMALL_HORDE_SIZE, ColonyConstants.SMALL_SHIP, ColonyConstants.SMALL_HORDE_MESSAGE_ID, 2, 2, 0, 0),\n     MEDIUM(ColonyConstants.MEDIUM_HORDE_SIZE,\n-      ColonyConstants.MEDIUM_PIRATE_SHIP,\n+      ColonyConstants.MEDIUM_SHIP,\n       ColonyConstants.MEDIUM_HORDE_MESSAGE_ID,\n-      3,\n-      PIRATE,\n-      ARCHERPIRATE,\n-      CHIEFPIRATE),\n+      4,", "originalCommit": "450a959a0093b5c372ef72f7ad73579b16a1c6d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ0MjY2OA==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435442668", "bodyText": "No, 6, good point", "author": "Raycoms", "createdAt": "2020-06-04T17:54:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM4MTkyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ0MjkzNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435442937", "bodyText": "6? It was 3 originally :D", "author": "someaddons", "createdAt": "2020-06-04T17:54:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM4MTkyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ0Njg0Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435446847", "bodyText": "Gotta double check then, Carlsanor switched those things up =D", "author": "Raycoms", "createdAt": "2020-06-04T18:01:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM4MTkyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM4MzE4Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435383187", "bodyText": "isnt the anchor structure.getPrimaryBlockOffset()?", "author": "someaddons", "createdAt": "2020-06-04T16:17:13Z", "path": "src/main/java/com/minecolonies/coremod/colony/managers/EventStructureManager.java", "diffHunk": "@@ -87,28 +94,55 @@ public boolean spawnTemporaryStructure(\n \n         final World world = colony.getWorld();\n \n-        final String backupPath = Structures.SCHEMATICS_PREFIX + STRUCTURE_BACKUP_FOLDER + colony.getID() + colony.getDimension() + targetSpawnPoint.down(3);\n-        final BlockPos zeroPos = targetSpawnPoint.subtract(structure.getPrimaryBlockOffset());\n+        int y = 3;\n+\n+        final BlockInfo info = structure.getBlockInfoAsMap().getOrDefault(structure.getPrimaryBlockOffset(), null);\n+        if (info.getTileEntityData() != null)\n+        {\n+            final CompoundNBT teData = structure.getTileEntityData(targetSpawnPoint, structure.getPrimaryBlockOffset());\n+            if (teData != null && teData.contains(TAG_BLUEPRINTDATA))\n+            {\n+                final TileEntity entity = TileEntity.create(info.getTileEntityData());\n+                if (entity instanceof IBlueprintDataProvider)\n+                {\n+                    for (final Map.Entry<BlockPos, List<String>> entry : ((IBlueprintDataProvider) entity).getPositionedTags().entrySet())\n+                    {\n+                        if (entry.getValue().contains(\"groundlevel\"))\n+                        {\n+                            y = entry.getKey().getY();\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n+        final BlockPos spawnPos = targetSpawnPoint.add(0, -y ,0);\n+\n+        final BlockPos zeroPos = targetSpawnPoint.subtract(structure.getPrimaryBlockOffset()).add(0, -y, 0);\n+        final BlockPos cornerPos = new BlockPos(zeroPos.getX() + structure.getSizeX() - 1, zeroPos.getY() + structure.getSizeY(), zeroPos.getZ() + structure.getSizeZ() - 1);\n+\n+        final BlockPos anchor = new BlockPos(zeroPos.getX() + structure.getSizeX()/2, zeroPos.getY(), zeroPos.getZ() + structure.getSizeZ()/2);", "originalCommit": "450a959a0093b5c372ef72f7ad73579b16a1c6d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ0MzA4MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435443081", "bodyText": "But we don't have the structure there yet. This is the scanned area in the world anchor.", "author": "Raycoms", "createdAt": "2020-06-04T17:55:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM4MzE4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ0NDMxMQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435444311", "bodyText": "ah I see", "author": "someaddons", "createdAt": "2020-06-04T17:57:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM4MzE4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM4NzMwOA==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435387308", "bodyText": "how come we're saving now the schematic's middle position as spawnpoint instead of the spawnpoint?", "author": "someaddons", "createdAt": "2020-06-04T16:23:38Z", "path": "src/main/java/com/minecolonies/coremod/colony/managers/EventStructureManager.java", "diffHunk": "@@ -87,28 +94,55 @@ public boolean spawnTemporaryStructure(\n \n         final World world = colony.getWorld();\n \n-        final String backupPath = Structures.SCHEMATICS_PREFIX + STRUCTURE_BACKUP_FOLDER + colony.getID() + colony.getDimension() + targetSpawnPoint.down(3);\n-        final BlockPos zeroPos = targetSpawnPoint.subtract(structure.getPrimaryBlockOffset());\n+        int y = 3;\n+\n+        final BlockInfo info = structure.getBlockInfoAsMap().getOrDefault(structure.getPrimaryBlockOffset(), null);\n+        if (info.getTileEntityData() != null)\n+        {\n+            final CompoundNBT teData = structure.getTileEntityData(targetSpawnPoint, structure.getPrimaryBlockOffset());\n+            if (teData != null && teData.contains(TAG_BLUEPRINTDATA))\n+            {\n+                final TileEntity entity = TileEntity.create(info.getTileEntityData());\n+                if (entity instanceof IBlueprintDataProvider)\n+                {\n+                    for (final Map.Entry<BlockPos, List<String>> entry : ((IBlueprintDataProvider) entity).getPositionedTags().entrySet())\n+                    {\n+                        if (entry.getValue().contains(\"groundlevel\"))\n+                        {\n+                            y = entry.getKey().getY();\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n+        final BlockPos spawnPos = targetSpawnPoint.add(0, -y ,0);\n+\n+        final BlockPos zeroPos = targetSpawnPoint.subtract(structure.getPrimaryBlockOffset()).add(0, -y, 0);\n+        final BlockPos cornerPos = new BlockPos(zeroPos.getX() + structure.getSizeX() - 1, zeroPos.getY() + structure.getSizeY(), zeroPos.getZ() + structure.getSizeZ() - 1);\n+\n+        final BlockPos anchor = new BlockPos(zeroPos.getX() + structure.getSizeX()/2, zeroPos.getY(), zeroPos.getZ() + structure.getSizeZ()/2);\n+\n+        final String backupPath = Structures.SCHEMATICS_PREFIX + STRUCTURE_BACKUP_FOLDER + colony.getID() + colony.getDimension() + anchor;\n \n         if (!ItemScanTool.saveStructureOnServer(world,\n           zeroPos,\n-          new BlockPos(zeroPos.getX() + structure.getSizeX() - 1, zeroPos.getY() + structure.getSizeY(), zeroPos.getZ() + structure.getSizeZ() - 1),\n+          cornerPos,\n           backupPath,\n           false))\n         {\n             // No structure spawn if we didnt successfully save the surroundings before\n             Log.getLogger().info(\"Failed to save schematics for event\");\n             return false;\n         }\n+        backupSchematics.put(anchor, eventID);", "originalCommit": "450a959a0093b5c372ef72f7ad73579b16a1c6d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ0MzI2Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435443266", "bodyText": "because that is what is used by the scan tool code.", "author": "Raycoms", "createdAt": "2020-06-04T17:55:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM4NzMwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ0NDA2NA==", "url": "https://github.com/ldtteam/minecolonies/pull/5153#discussion_r435444064", "bodyText": "ok", "author": "someaddons", "createdAt": "2020-06-04T17:56:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM4NzMwOA=="}], "type": "inlineReview"}, {"oid": "9873df1d775d0958967bbd5c9177ce7b3d30c923", "url": "https://github.com/ldtteam/minecolonies/commit/9873df1d775d0958967bbd5c9177ce7b3d30c923", "message": "fix", "committedDate": "2020-06-04T18:43:57Z", "type": "commit"}, {"oid": "4c88c28aeeeba0f8d21e9417b409ee52cd5ea54c", "url": "https://github.com/ldtteam/minecolonies/commit/4c88c28aeeeba0f8d21e9417b409ee52cd5ea54c", "message": "adjust some things", "committedDate": "2020-06-04T19:06:15Z", "type": "commit"}, {"oid": "59617e96b03e84ff13bd671b2f261f40aaf6f61c", "url": "https://github.com/ldtteam/minecolonies/commit/59617e96b03e84ff13bd671b2f261f40aaf6f61c", "message": "adjust spawners", "committedDate": "2020-06-04T19:07:14Z", "type": "commit"}, {"oid": "b8c7a6f881deea2c9d50d3530bf83ba027799fd5", "url": "https://github.com/ldtteam/minecolonies/commit/b8c7a6f881deea2c9d50d3530bf83ba027799fd5", "message": "fix", "committedDate": "2020-06-05T14:16:33Z", "type": "commit"}, {"oid": "94ee5d0912cf52fc5db772610c498852bddef264", "url": "https://github.com/ldtteam/minecolonies/commit/94ee5d0912cf52fc5db772610c498852bddef264", "message": "fix", "committedDate": "2020-06-05T14:17:05Z", "type": "commit"}]}