{"pr_number": 5939, "pr_title": "Feature/building rework 0.1", "pr_createdAt": "2020-10-17T12:35:11Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/5939", "timeline": [{"oid": "ffbd61103da9d34644b4a6ba4a503480a35c9a41", "url": "https://github.com/ldtteam/minecolonies/commit/ffbd61103da9d34644b4a6ba4a503480a35c9a41", "message": "Add notnulls", "committedDate": "2020-10-11T16:43:59Z", "type": "commit"}, {"oid": "a70f8f3f724a9493da2c0932a020cbc1dca84542", "url": "https://github.com/ldtteam/minecolonies/commit/a70f8f3f724a9493da2c0932a020cbc1dca84542", "message": "Initital part of building rework", "committedDate": "2020-10-11T18:32:14Z", "type": "commit"}, {"oid": "86ce6bc7c253de26797910ada2884fb1faaa87c6", "url": "https://github.com/ldtteam/minecolonies/commit/86ce6bc7c253de26797910ada2884fb1faaa87c6", "message": "awaiting resolver hotfix", "committedDate": "2020-10-12T11:40:34Z", "type": "commit"}, {"oid": "5bae85a4975c3e6f5150855473d813820fd9f6e6", "url": "https://github.com/ldtteam/minecolonies/commit/5bae85a4975c3e6f5150855473d813820fd9f6e6", "message": "Merge branch 'version/1.15' into feature/building-rework-0.1", "committedDate": "2020-10-12T11:50:27Z", "type": "commit"}, {"oid": "4522d688d2ce2bb790a846dbf260aca1dfc4a73c", "url": "https://github.com/ldtteam/minecolonies/commit/4522d688d2ce2bb790a846dbf260aca1dfc4a73c", "message": "Merge branch 'version/1.15' into feature/building-rework-0.1", "committedDate": "2020-10-13T14:01:19Z", "type": "commit"}, {"oid": "d3de6f3791179207c433fc28154f7e9294dfafcf", "url": "https://github.com/ldtteam/minecolonies/commit/d3de6f3791179207c433fc28154f7e9294dfafcf", "message": "adjust home an dtavern", "committedDate": "2020-10-14T21:40:42Z", "type": "commit"}, {"oid": "997e8239bfb71b9fcf8b9b0b4b792f1c646a6fc4", "url": "https://github.com/ldtteam/minecolonies/commit/997e8239bfb71b9fcf8b9b0b4b792f1c646a6fc4", "message": "Merge branch 'version/1.15' into feature/building-rework-0.1", "committedDate": "2020-10-17T10:28:43Z", "type": "commit"}, {"oid": "a61fef35f455363fce6dcc166f4cfa28f3e1f867", "url": "https://github.com/ldtteam/minecolonies/commit/a61fef35f455363fce6dcc166f4cfa28f3e1f867", "message": "adjust inhabitants calculation", "committedDate": "2020-10-17T11:03:14Z", "type": "commit"}, {"oid": "8eb755525abeac0e5fc78bb37d23157501590a29", "url": "https://github.com/ldtteam/minecolonies/commit/8eb755525abeac0e5fc78bb37d23157501590a29", "message": "improvements", "committedDate": "2020-10-17T12:30:34Z", "type": "commit"}, {"oid": "62945d6b0ddb17fab16e863ec60e4371891001a6", "url": "https://github.com/ldtteam/minecolonies/commit/62945d6b0ddb17fab16e863ec60e4371891001a6", "message": "add doc", "committedDate": "2020-10-17T12:44:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk0OTc4Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r506949787", "bodyText": "How is this going to work when we have multiple modules that need to participate in the view? For instance, Crafter (job queue) and Smelter (Fuel)", "author": "Mekle001", "createdAt": "2020-10-17T14:40:26Z", "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutTavern.java", "diffHunk": "@@ -8,19 +8,21 @@\n import com.minecolonies.api.colony.ICitizenDataView;\n import com.minecolonies.api.util.constant.Constants;\n import com.minecolonies.coremod.Network;\n-import com.minecolonies.coremod.colony.buildings.workerbuildings.BuildingHome;\n-import com.minecolonies.coremod.colony.buildings.workerbuildings.BuildingTavern;\n+import com.minecolonies.coremod.colony.buildings.modules.TavernBuildingModule;\n+import com.minecolonies.coremod.colony.buildings.views.LivingBuildingView;\n+import com.minecolonies.coremod.network.messages.server.colony.building.RecallCitizenHutMessage;\n import com.minecolonies.coremod.network.messages.server.colony.building.home.AssignUnassignMessage;\n import net.minecraft.client.Minecraft;\n import org.jetbrains.annotations.NotNull;\n \n import static com.minecolonies.api.util.constant.TranslationConstants.COM_MINECOLONIES_COREMOD_GUI_HOME_ASSIGN;\n import static com.minecolonies.api.util.constant.TranslationConstants.COM_MINECOLONIES_COREMOD_GUI_WORKERHUTS_LEVEL_0;\n+import static com.minecolonies.api.util.constant.WindowConstants.BUTTON_RECALL;\n \n /**\n  * Window for the tavern\n  */\n-public class WindowHutTavern extends AbstractWindowBuilding<BuildingTavern.View>\n+public class WindowHutTavern extends AbstractWindowBuilding<TavernBuildingModule.View>", "originalCommit": "62945d6b0ddb17fab16e863ec60e4371891001a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk1MTM2NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r506951365", "bodyText": "Yeah, I commented that in the description. That is the next PR I want to make. This one was getting too big already.", "author": "Raycoms", "createdAt": "2020-10-17T14:58:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk0OTc4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk3NTg1NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r506975855", "bodyText": "Fair enough.", "author": "Mekle001", "createdAt": "2020-10-17T19:27:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk0OTc4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk1MDI2Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r506950267", "bodyText": "How do you see modules working together here? Specifically, the restaurant has two citizens with very different jobs. I expect that will be two modules, each with one citizen assigned. Is it First one wins? or do we expect a priority, and thus support promotion? If the cook dies, does the assistant cook become the cook?", "author": "Mekle001", "createdAt": "2020-10-17T14:45:51Z", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuilding.java", "diffHunk": "@@ -343,6 +397,65 @@ public void onDestroyed()\n \n         ChunkDataHelper.claimColonyChunks(colony, false, this.getID(), getClaimRadius(getBuildingLevel()));\n         ConstructionTapeHelper.removeConstructionTape(getCorners(), world);\n+\n+        for (final IBuildingModule module : modules.values())\n+        {\n+            module.onDestroyed();\n+        }\n+    }\n+\n+    @Override\n+    public void removeCitizen(final ICitizenData citizen)\n+    {\n+        for (final IBuildingModule module : modules.values())\n+        {\n+            module.removeCitizen(citizen);\n+        }\n+        super.removeCitizen(citizen);\n+    }\n+\n+    @Override\n+    public boolean assignCitizen(final ICitizenData citizen)", "originalCommit": "62945d6b0ddb17fab16e863ec60e4371891001a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk1MTUxNQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r506951515", "bodyText": "For now, It would be by addition order (so first cook than assistant, if cook dies, assistant stays assistant and new worker will become cook). However, yes, there is room for additional functionality in the future here.", "author": "Raycoms", "createdAt": "2020-10-17T15:00:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk1MDI2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk1MDYxMg==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r506950612", "bodyText": "Should this be part of LivingBuildingModule, or separate? Do you expect LivingBuildingModule to be used for towers and training facilities? If so, this then creates the potential to mix the two assignment types.", "author": "Mekle001", "createdAt": "2020-10-17T14:50:08Z", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/modules/LivingBuildingModule.java", "diffHunk": "@@ -385,21 +362,15 @@ private void inheritLastName(@NotNull final ICitizenData child, final String par\n         child.setName(combinedName.toString().trim());\n     }\n \n-    @Override\n-    public int getMaxInhabitants()\n-    {\n-        return getBuildingLevel();\n-    }\n-\n     /**\n      * Looks for a homeless citizen to add to the current building Calls. {@link #assignCitizen(ICitizenData)}\n      */\n     private void addHomelessCitizens()", "originalCommit": "62945d6b0ddb17fab16e863ec60e4371891001a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk1MTY1NA==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r506951654", "bodyText": "These places could override this module and create a SpecializedLivingBuildingModule that they will add for example.", "author": "Raycoms", "createdAt": "2020-10-17T15:01:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk1MDYxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk3NTg5Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r506975897", "bodyText": "Ok, while that sends us partway down the inheritance path again, it's small enough that seems reasonable.", "author": "Mekle001", "createdAt": "2020-10-17T19:28:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk1MDYxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY1ODg2MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r507658861", "bodyText": "This class is weird AF.\nThis is just an empty class which literally makes no sense.\nIf you want this to be the default behaviour for those empty methods for a module, then make it the default implementation of the method in the interface not in this weird abstract class.", "author": "OrionDevelopment", "createdAt": "2020-10-19T11:03:18Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/AbstractBuildingModule.java", "diffHunk": "@@ -0,0 +1,139 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import com.minecolonies.api.colony.ICitizenData;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import net.minecraft.block.BlockState;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.network.PacketBuffer;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.World;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Abstract class for all modules. Has base methods for all the necessary methods that have to be called from the building.\n+ */\n+public abstract class AbstractBuildingModule implements IBuildingModule", "originalCommit": "62945d6b0ddb17fab16e863ec60e4371891001a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY2NjYxNQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r507666615", "bodyText": "Yeah, true, I forgot I can set the empty methods as defaults in the interface.", "author": "Raycoms", "createdAt": "2020-10-19T11:18:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY1ODg2MQ=="}], "type": "inlineReview"}, {"oid": "29dae3d849609438d880a7a5eb3f9c8c25e09d24", "url": "https://github.com/ldtteam/minecolonies/commit/29dae3d849609438d880a7a5eb3f9c8c25e09d24", "message": "Merge branch 'version/1.15' into feature/building-rework-0.1", "committedDate": "2020-10-25T10:36:03Z", "type": "commit"}, {"oid": "737aa22fae027fc03a2d1a39c1379c0c1e417ae6", "url": "https://github.com/ldtteam/minecolonies/commit/737aa22fae027fc03a2d1a39c1379c0c1e417ae6", "message": "Adjust building module handling.", "committedDate": "2020-10-25T13:09:41Z", "type": "commit"}, {"oid": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "url": "https://github.com/ldtteam/minecolonies/commit/87fff8bbaafe1196b6f90870a2217f00327c13d3", "message": "remove not necessary method hook", "committedDate": "2020-10-25T15:12:17Z", "type": "commit"}, {"oid": "b0fb2c438649c668badb1dc13928f33cedf3cc84", "url": "https://github.com/ldtteam/minecolonies/commit/b0fb2c438649c668badb1dc13928f33cedf3cc84", "message": "Fix #5988", "committedDate": "2020-10-25T18:58:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0NDg4Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513244886", "bodyText": "No, this should be Class<? extends IBuildingModule> or what ever the root interface for a module is.", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:04:30Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/IBuilding.java", "diffHunk": "@@ -32,6 +34,27 @@\n \n public interface IBuilding extends IBuildingContainer, IRequestResolverProvider, IRequester\n {\n+    /**\n+     * Check if the building has a particular module.\n+     * @param clazz the module of the class to check.\n+     * @return true if so.\n+     */\n+    boolean hasModule(final Class<? extends AbstractBuildingModule> clazz);", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0NDk1NA==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513244954", "bodyText": "See above", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:04:38Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/IBuilding.java", "diffHunk": "@@ -32,6 +34,27 @@\n \n public interface IBuilding extends IBuildingContainer, IRequestResolverProvider, IRequester\n {\n+    /**\n+     * Check if the building has a particular module.\n+     * @param clazz the module of the class to check.\n+     * @return true if so.\n+     */\n+    boolean hasModule(final Class<? extends AbstractBuildingModule> clazz);\n+\n+    /**\n+     * Get the module with a particular class.\n+     * @param clazz the modules class.\n+     * @return the module or null of not existant.\n+     */\n+    @Nullable\n+    IBuildingModule getModule(Class<? extends AbstractBuildingModule> clazz);", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0NTAwNg==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513245006", "bodyText": "See above", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:04:44Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/IBuilding.java", "diffHunk": "@@ -32,6 +34,27 @@\n \n public interface IBuilding extends IBuildingContainer, IRequestResolverProvider, IRequester\n {\n+    /**\n+     * Check if the building has a particular module.\n+     * @param clazz the module of the class to check.\n+     * @return true if so.\n+     */\n+    boolean hasModule(final Class<? extends AbstractBuildingModule> clazz);\n+\n+    /**\n+     * Get the module with a particular class.\n+     * @param clazz the modules class.\n+     * @return the module or null of not existant.\n+     */\n+    @Nullable\n+    IBuildingModule getModule(Class<? extends AbstractBuildingModule> clazz);\n+\n+    /**\n+     * Register a specific module to the building.\n+     * @param module the module to register.\n+     */\n+    void registerModule(@NotNull final AbstractBuildingModule module);", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0NTYzMQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513245631", "bodyText": "You might want to consider firing an event here somehow.\nThis to allow external APIs to inject modules. It does not need to be implemented here yet, just a comment to mark it as a TODO somehow should suffice for this PR.", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:05:58Z", "path": "src/api/java/com/minecolonies/api/blocks/AbstractBlockHut.java", "diffHunk": "@@ -330,4 +332,10 @@ public boolean needsResearch()\n     {\n         return needsResearch;\n     }\n+\n+    @Override\n+    public void registerBuildingModules(final IBuilding building)\n+    {\n+", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0NTgwNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513245807", "bodyText": "Needs to extends IBuildingModule else this makes no sense.", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:06:20Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IAssignsCitizen.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import com.minecolonies.api.colony.ICitizenData;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Interface for all modules that need special assignment handling.\n+ */\n+public interface IAssignsCitizen", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0NjAyNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513246027", "bodyText": "Formatting is of here. Remove the not needed empty lines.", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:06:46Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IBuildingModule.java", "diffHunk": "@@ -0,0 +1,109 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.network.PacketBuffer;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Interface describing the different modules.\n+ */\n+public interface IBuildingModule\n+{\n+    /**\n+     * Deserialize the module.\n+     * @param compound the nbt compound.\n+     */\n+    default void deserializeNBT(CompoundNBT compound)\n+    {\n+", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0NjI5OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513246299", "bodyText": "Make this extend NBTSerializable or whatever the name of the vanilla interface is, and do not declare your own custom methods.", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:07:18Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IBuildingModule.java", "diffHunk": "@@ -0,0 +1,109 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.network.PacketBuffer;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Interface describing the different modules.\n+ */\n+public interface IBuildingModule", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI2MzYxOA==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513263618", "bodyText": "The method signature we use is slightly different than NBTSerializable, so not possible", "author": "Raycoms", "createdAt": "2020-10-28T08:38:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0NjI5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0NjQyNg==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513246426", "bodyText": "Remove this method, see interface declaration comment.", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:07:34Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IBuildingModule.java", "diffHunk": "@@ -0,0 +1,109 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.network.PacketBuffer;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Interface describing the different modules.\n+ */\n+public interface IBuildingModule\n+{\n+    /**\n+     * Deserialize the module.\n+     * @param compound the nbt compound.\n+     */\n+    default void deserializeNBT(CompoundNBT compound)", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0NjUyMQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513246521", "bodyText": "Remove this method, see interface declaration comment", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:07:45Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IBuildingModule.java", "diffHunk": "@@ -0,0 +1,109 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.network.PacketBuffer;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Interface describing the different modules.\n+ */\n+public interface IBuildingModule\n+{\n+    /**\n+     * Deserialize the module.\n+     * @param compound the nbt compound.\n+     */\n+    default void deserializeNBT(CompoundNBT compound)\n+    {\n+\n+    }\n+\n+    /**\n+     * Serialize the module from a compound.\n+     * @param compound the compound.\n+     */\n+    default void serializeNBT(final CompoundNBT compound)", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0NzI3Mw==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513247273", "bodyText": "We should declare a standard interface for serialization to and from PacketBuffer and treat it in the same way vanilla treats NBT with its NBTSerializable interface. Aka create an empty instance and then call deserialize on it.\nI am pretty sure this interface was added when we added the PacketBuffer specific serialization for the RS.\nThis also makes it so that Views are not needed for modules, which is a huge improvement in maintainability.", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:09:16Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IBuildingModule.java", "diffHunk": "@@ -0,0 +1,109 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.network.PacketBuffer;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Interface describing the different modules.\n+ */\n+public interface IBuildingModule\n+{\n+    /**\n+     * Deserialize the module.\n+     * @param compound the nbt compound.\n+     */\n+    default void deserializeNBT(CompoundNBT compound)\n+    {\n+\n+    }\n+\n+    /**\n+     * Serialize the module from a compound.\n+     * @param compound the compound.\n+     */\n+    default void serializeNBT(final CompoundNBT compound)\n+    {\n+\n+    }\n+\n+    /**\n+     * Serialization method to send the module data to the client side.\n+     * @param buf the buffer to write it to.\n+     */\n+    default void serializeToView(PacketBuffer buf)", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI2NDM2Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513264366", "bodyText": "As I wrote above, views will be a part of modules. In a way that allows us to build nice GUIs from multiple module Views", "author": "Raycoms", "createdAt": "2020-10-28T08:39:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0NzI3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0NzYxMA==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513247610", "bodyText": "Again this has no bearing on a default module.\nMove to a seperate interface.", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:09:53Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IBuildingModule.java", "diffHunk": "@@ -0,0 +1,109 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.network.PacketBuffer;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Interface describing the different modules.\n+ */\n+public interface IBuildingModule\n+{\n+    /**\n+     * Deserialize the module.\n+     * @param compound the nbt compound.\n+     */\n+    default void deserializeNBT(CompoundNBT compound)\n+    {\n+\n+    }\n+\n+    /**\n+     * Serialize the module from a compound.\n+     * @param compound the compound.\n+     */\n+    default void serializeNBT(final CompoundNBT compound)\n+    {\n+\n+    }\n+\n+    /**\n+     * Serialization method to send the module data to the client side.\n+     * @param buf the buffer to write it to.\n+     */\n+    default void serializeToView(PacketBuffer buf)\n+    {\n+\n+    }\n+\n+    /**\n+     * On destruction hook of the building, calling into the modules.\n+     */\n+    default void onDestroyed()\n+    {\n+\n+    }\n+\n+    /**\n+     * Colony tick hook.\n+     * @param colony the colony the tick is invoked from.\n+     */\n+    default void onColonyTick(@NotNull IColony colony)\n+    {\n+\n+    }\n+\n+    /**\n+     * Upgrade complete module hook.\n+     * @param newLevel the new level.\n+     */\n+    default void onUpgradeComplete(int newLevel)\n+    {\n+\n+    }\n+\n+    /**\n+     * On building move hook for modules.\n+     * @param oldBuilding the building that is going to be moved.\n+     */\n+    default void onBuildingMove(IBuilding oldBuilding)\n+    {\n+\n+    }\n+\n+    /**\n+     * Specific wakeup hook in modules.\n+     */\n+    default void onWakeUp()", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0Nzc5MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513247791", "bodyText": "Again this has no bearing being on a default module. Some modules do not tick and as such do not need this.", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:10:14Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IBuildingModule.java", "diffHunk": "@@ -0,0 +1,109 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.network.PacketBuffer;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Interface describing the different modules.\n+ */\n+public interface IBuildingModule\n+{\n+    /**\n+     * Deserialize the module.\n+     * @param compound the nbt compound.\n+     */\n+    default void deserializeNBT(CompoundNBT compound)\n+    {\n+\n+    }\n+\n+    /**\n+     * Serialize the module from a compound.\n+     * @param compound the compound.\n+     */\n+    default void serializeNBT(final CompoundNBT compound)\n+    {\n+\n+    }\n+\n+    /**\n+     * Serialization method to send the module data to the client side.\n+     * @param buf the buffer to write it to.\n+     */\n+    default void serializeToView(PacketBuffer buf)\n+    {\n+\n+    }\n+\n+    /**\n+     * On destruction hook of the building, calling into the modules.\n+     */\n+    default void onDestroyed()\n+    {\n+\n+    }\n+\n+    /**\n+     * Colony tick hook.\n+     * @param colony the colony the tick is invoked from.\n+     */\n+    default void onColonyTick(@NotNull IColony colony)", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0ODExMw==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513248113", "bodyText": "Again see other methods in this class.\nThe base module spec should only specific the bare minimum to classify itself as a module.", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:10:51Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IBuildingModule.java", "diffHunk": "@@ -0,0 +1,109 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.network.PacketBuffer;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Interface describing the different modules.\n+ */\n+public interface IBuildingModule\n+{\n+    /**\n+     * Deserialize the module.\n+     * @param compound the nbt compound.\n+     */\n+    default void deserializeNBT(CompoundNBT compound)\n+    {\n+\n+    }\n+\n+    /**\n+     * Serialize the module from a compound.\n+     * @param compound the compound.\n+     */\n+    default void serializeNBT(final CompoundNBT compound)\n+    {\n+\n+    }\n+\n+    /**\n+     * Serialization method to send the module data to the client side.\n+     * @param buf the buffer to write it to.\n+     */\n+    default void serializeToView(PacketBuffer buf)\n+    {\n+\n+    }\n+\n+    /**\n+     * On destruction hook of the building, calling into the modules.\n+     */\n+    default void onDestroyed()\n+    {\n+\n+    }\n+\n+    /**\n+     * Colony tick hook.\n+     * @param colony the colony the tick is invoked from.\n+     */\n+    default void onColonyTick(@NotNull IColony colony)\n+    {\n+\n+    }\n+\n+    /**\n+     * Upgrade complete module hook.\n+     * @param newLevel the new level.\n+     */\n+    default void onUpgradeComplete(int newLevel)\n+    {\n+\n+    }\n+\n+    /**\n+     * On building move hook for modules.\n+     * @param oldBuilding the building that is going to be moved.\n+     */\n+    default void onBuildingMove(IBuilding oldBuilding)\n+    {\n+\n+    }\n+\n+    /**\n+     * Specific wakeup hook in modules.\n+     */\n+    default void onWakeUp()\n+    {\n+\n+    }\n+\n+    /**\n+     * On player entering hook.\n+     * @param player the player that entered the building.\n+     */\n+    default void onPlayerEnterBuilding(PlayerEntity player)", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0ODQwNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513248407", "bodyText": "Move to a seperate interface not related to modules, called IHasDirtyState or something.", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:11:20Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IBuildingModule.java", "diffHunk": "@@ -0,0 +1,109 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.network.PacketBuffer;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Interface describing the different modules.\n+ */\n+public interface IBuildingModule\n+{\n+    /**\n+     * Deserialize the module.\n+     * @param compound the nbt compound.\n+     */\n+    default void deserializeNBT(CompoundNBT compound)\n+    {\n+\n+    }\n+\n+    /**\n+     * Serialize the module from a compound.\n+     * @param compound the compound.\n+     */\n+    default void serializeNBT(final CompoundNBT compound)\n+    {\n+\n+    }\n+\n+    /**\n+     * Serialization method to send the module data to the client side.\n+     * @param buf the buffer to write it to.\n+     */\n+    default void serializeToView(PacketBuffer buf)\n+    {\n+\n+    }\n+\n+    /**\n+     * On destruction hook of the building, calling into the modules.\n+     */\n+    default void onDestroyed()\n+    {\n+\n+    }\n+\n+    /**\n+     * Colony tick hook.\n+     * @param colony the colony the tick is invoked from.\n+     */\n+    default void onColonyTick(@NotNull IColony colony)\n+    {\n+\n+    }\n+\n+    /**\n+     * Upgrade complete module hook.\n+     * @param newLevel the new level.\n+     */\n+    default void onUpgradeComplete(int newLevel)\n+    {\n+\n+    }\n+\n+    /**\n+     * On building move hook for modules.\n+     * @param oldBuilding the building that is going to be moved.\n+     */\n+    default void onBuildingMove(IBuilding oldBuilding)\n+    {\n+\n+    }\n+\n+    /**\n+     * Specific wakeup hook in modules.\n+     */\n+    default void onWakeUp()\n+    {\n+\n+    }\n+\n+    /**\n+     * On player entering hook.\n+     * @param player the player that entered the building.\n+     */\n+    default void onPlayerEnterBuilding(PlayerEntity player)\n+    {\n+\n+    }\n+\n+    /**\n+     * Specific dirty marking of modules (separate from building dirty).\n+     */\n+    void markDirty();", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0ODY0Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513248647", "bodyText": "We should not limit this to just blocks, adapt the javadoc.", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:11:48Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IBuildingModuleProvider.java", "diffHunk": "@@ -0,0 +1,15 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+\n+/**\n+ * Blocks providing building modules.", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0OTAzNA==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513249034", "bodyText": "Javadoc completely misleading. And the name is wrong: IDefinesCoreBuildingStatsModule is more accurate.", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:12:32Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IDefinesBuildingModule.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+/**\n+ * Interface describing the different modules.\n+ */\n+public interface IDefinesBuildingModule", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0OTE4Mg==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513249182", "bodyText": "Nope.\nThis is up to the module.\nEither make both methods have a default value or none.", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:12:52Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IDefinesBuildingModule.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+/**\n+ * Interface describing the different modules.\n+ */\n+public interface IDefinesBuildingModule\n+{\n+    /**\n+     * Get the max building level a module allows.\n+     * By default this is 5.\n+     * @return the max level.\n+     */\n+    default int getMaxBuildingLevel()", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI2MjIxNQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513262215", "bodyText": "It's because maxBuildinglevel = 5 applies to 99% of our buildings. But the number of workers/inhabitants varies greatly. So it makes sense to have a default here but not in the other.", "author": "Raycoms", "createdAt": "2020-10-28T08:35:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0OTE4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0OTI1NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513249255", "bodyText": "See other method in this interface.", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:13:00Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IDefinesBuildingModule.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+/**\n+ * Interface describing the different modules.\n+ */\n+public interface IDefinesBuildingModule\n+{\n+    /**\n+     * Get the max building level a module allows.\n+     * By default this is 5.\n+     * @return the max level.\n+     */\n+    default int getMaxBuildingLevel()\n+    {\n+        return 5;\n+    }\n+\n+    /**\n+     * Get the max number of inhabitants this module allows.\n+     * @return the modules max number of assigned citizens.\n+     */\n+    int getMaxInhabitants();", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0OTc3Mw==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513249773", "bodyText": "This clearly states remove in 1.16 why was this removed in a PR that targets 1.15", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:14:00Z", "path": "src/api/java/com/minecolonies/api/compatibility/CompatibilityManager.java", "diffHunk": "@@ -283,15 +283,7 @@ public boolean isPlantable(final ItemStack itemStack)\n             }\n \n             String[] split = string.split(\":\");\n-            //todo, this is backwards compatibility, remove in 1.16", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI1MDUxMQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513250511", "bodyText": "This really really really feels like a code smell in my opinion. The building instance really should not care what building it is representing, neither should the modules which are inside it.", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:15:21Z", "path": "src/main/java/com/minecolonies/apiimp/initializer/ModBuildingsInitializer.java", "diffHunk": "@@ -137,8 +140,8 @@ public static void init(final RegistryEvent.Register<BuildingEntry> event)\n \n         ModBuildings.home = new BuildingEntry.Builder()\n                               .setBuildingBlock(ModBlocks.blockHutHome)\n-                              .setBuildingProducer(BuildingHome::new)\n-                              .setBuildingViewProducer(() -> BuildingHome.View::new)\n+                              .setBuildingProducer((colony, blockPos) -> new DefaultBuildingInstance(colony, blockPos, \"citizen\", ModBuildings.home))", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI2MzE5MA==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513263190", "bodyText": "The building instance absolutely does need it. Necessary for the schematics etc", "author": "Raycoms", "createdAt": "2020-10-28T08:37:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI1MDUxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI1MDU5Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r513250597", "bodyText": "See above.", "author": "OrionDevelopment", "createdAt": "2020-10-28T08:15:29Z", "path": "src/main/java/com/minecolonies/apiimp/initializer/ModBuildingsInitializer.java", "diffHunk": "@@ -298,8 +301,8 @@ public static void init(final RegistryEvent.Register<BuildingEntry> event)\n \n         ModBuildings.tavern = new BuildingEntry.Builder()\n                                 .setBuildingBlock(ModBlocks.blockHutTavern)\n-                                .setBuildingProducer(BuildingTavern::new)\n-                                .setBuildingViewProducer(() -> BuildingTavern.View::new)\n+                                .setBuildingProducer((colony, blockPos) -> new DefaultBuildingInstance(colony, blockPos, \"tavern\", ModBuildings.tavern))", "originalCommit": "87fff8bbaafe1196b6f90870a2217f00327c13d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c2cce6ecd78a10087cff276918209510ac327f08", "url": "https://github.com/ldtteam/minecolonies/commit/c2cce6ecd78a10087cff276918209510ac327f08", "message": "some adjustments", "committedDate": "2020-10-28T21:31:40Z", "type": "commit"}, {"oid": "4c22e4bdd882fa2d8784e71251208fd8d9e26b43", "url": "https://github.com/ldtteam/minecolonies/commit/4c22e4bdd882fa2d8784e71251208fd8d9e26b43", "message": "Merge branch 'version/1.15' into feature/building-rework-0.1", "committedDate": "2020-11-07T09:17:35Z", "type": "commit"}, {"oid": "429b37af6c4bbff3e01b3ea97a0c911c27c9644e", "url": "https://github.com/ldtteam/minecolonies/commit/429b37af6c4bbff3e01b3ea97a0c911c27c9644e", "message": "Fix review", "committedDate": "2020-11-07T09:28:21Z", "type": "commit"}, {"oid": "b7fdc80363def42ee2049f1025f725f73e7c17cb", "url": "https://github.com/ldtteam/minecolonies/commit/b7fdc80363def42ee2049f1025f725f73e7c17cb", "message": "more adjustments", "committedDate": "2020-11-07T09:52:39Z", "type": "commit"}, {"oid": "c46750c76edf1da5514c452a3dc2078ae510d60e", "url": "https://github.com/ldtteam/minecolonies/commit/c46750c76edf1da5514c452a3dc2078ae510d60e", "message": "setup", "committedDate": "2020-11-07T10:13:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE2NDEwMA==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519164100", "bodyText": "So I thought about this a bit.\nI agree that these are indeed the core stats.\nBut I think we can flush out the API a bit here.\nHit me up on Discord we jump in voice and I will explain what my thoughts here were how we can make this a bit more precise.", "author": "OrionDevelopment", "createdAt": "2020-11-07T10:48:05Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IDefinesCoreBuildingStatsModule.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+/**\n+ * Interface describing core building stats.\n+ * The first core stats module that is found in the building will define the values.\n+ */\n+public interface IDefinesCoreBuildingStatsModule extends IBuildingModule\n+{\n+    /**\n+     * Get the max building level a module allows.\n+     * By default this is 5.\n+     * @return the max level.\n+     */\n+    default int getMaxBuildingLevel()\n+    {\n+        return 5;\n+    }\n+\n+    /**\n+     * Get the max number of inhabitants this module allows.\n+     * @return the modules max number of assigned citizens.\n+     */\n+    int getMaxInhabitants();", "originalCommit": "c46750c76edf1da5514c452a3dc2078ae510d60e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE2NDEzOQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519164139", "bodyText": "Rename to IModuleWithExternalBlocks", "author": "OrionDevelopment", "createdAt": "2020-11-07T10:48:42Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IRegistersBlockModule.java", "diffHunk": "@@ -0,0 +1,20 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import net.minecraft.block.BlockState;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.World;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Module type to register specific blocks to a building (beds, workstations, etc).\n+ */\n+public interface IRegistersBlockModule extends IBuildingModule", "originalCommit": "c46750c76edf1da5514c452a3dc2078ae510d60e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE2NDE1NA==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519164154", "bodyText": "Rename to onBlockBuildInBuilding", "author": "OrionDevelopment", "createdAt": "2020-11-07T10:48:59Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IRegistersBlockModule.java", "diffHunk": "@@ -0,0 +1,20 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import net.minecraft.block.BlockState;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.World;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Module type to register specific blocks to a building (beds, workstations, etc).\n+ */\n+public interface IRegistersBlockModule extends IBuildingModule\n+{\n+    /**\n+     * Attempt to register a specific block at a specific module.\n+     * @param blockState the state.\n+     * @param pos the position.\n+     * @param world the world.\n+     */\n+    void registerBlockPosition(@NotNull BlockState blockState, @NotNull BlockPos pos, @NotNull World world);", "originalCommit": "c46750c76edf1da5514c452a3dc2078ae510d60e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE2NDI0MA==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519164240", "bodyText": "You should add a method that returns all Blocks registered to this module.\nSomething like getRegisteredPositions or getRegisteredBlocks(final IBlockReader world)", "author": "OrionDevelopment", "createdAt": "2020-11-07T10:49:45Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IRegistersBlockModule.java", "diffHunk": "@@ -0,0 +1,20 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import net.minecraft.block.BlockState;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.World;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Module type to register specific blocks to a building (beds, workstations, etc).\n+ */\n+public interface IRegistersBlockModule extends IBuildingModule\n+{\n+    /**\n+     * Attempt to register a specific block at a specific module.\n+     * @param blockState the state.\n+     * @param pos the position.\n+     * @param world the world.\n+     */\n+    void registerBlockPosition(@NotNull BlockState blockState, @NotNull BlockPos pos, @NotNull World world);\n+}", "originalCommit": "c46750c76edf1da5514c452a3dc2078ae510d60e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE2NDkzMA==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519164930", "bodyText": "I thought about this, but each building holds the blocks differently for different purposes and sometimes even different sets of blocks. I don't think we need a getter that returns ALL of them", "author": "Raycoms", "createdAt": "2020-11-07T10:57:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE2NDI0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE2NDMxNg==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519164316", "bodyText": "Rename to: IModuleWithData.\nAlso extend the existing interface.", "author": "OrionDevelopment", "createdAt": "2020-11-07T10:50:21Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IStoresDataModule.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.network.PacketBuffer;\n+\n+/**\n+ * Interface for all building modules that store additional data.\n+ */\n+public interface IStoresDataModule extends IBuildingModule", "originalCommit": "c46750c76edf1da5514c452a3dc2078ae510d60e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "64f757153e9d7c55895aa6ce980fc2fbff29d62f", "url": "https://github.com/ldtteam/minecolonies/commit/64f757153e9d7c55895aa6ce980fc2fbff29d62f", "message": "setup refactoring", "committedDate": "2020-11-08T09:22:24Z", "type": "commit"}, {"oid": "c5742b34edf80a4e6935ea68ed17d2a78ee1c4d5", "url": "https://github.com/ldtteam/minecolonies/commit/c5742b34edf80a4e6935ea68ed17d2a78ee1c4d5", "message": "commit", "committedDate": "2020-11-08T09:22:31Z", "type": "commit"}, {"oid": "9597b4625c414873b3ccca6427de245e1a1d2ef4", "url": "https://github.com/ldtteam/minecolonies/commit/9597b4625c414873b3ccca6427de245e1a1d2ef4", "message": "Adjust supplyng", "committedDate": "2020-11-08T15:35:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0MzU1OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519443559", "bodyText": "getRegisteredBlocks()", "author": "OrionDevelopment", "createdAt": "2020-11-08T15:59:08Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IModuleWithExternalBlocks.java", "diffHunk": "@@ -5,16 +5,24 @@\n import net.minecraft.world.World;\n import org.jetbrains.annotations.NotNull;\n \n+import java.util.List;\n+\n /**\n  * Module type to register specific blocks to a building (beds, workstations, etc).\n  */\n-public interface IRegistersBlockModule extends IBuildingModule\n+public interface IModuleWithExternalBlocks extends IBuildingModule\n {\n     /**\n      * Attempt to register a specific block at a specific module.\n      * @param blockState the state.\n      * @param pos the position.\n      * @param world the world.\n      */\n-    void registerBlockPosition(@NotNull BlockState blockState, @NotNull BlockPos pos, @NotNull World world);\n+    void onBlockPlacedInBuilding(@NotNull BlockState blockState, @NotNull BlockPos pos, @NotNull World world);\n+\n+    /**\n+     * Get the list of registered blocks.\n+     * @return the list of positions of the blocks.\n+     */\n+    List<BlockPos> getRegisterBlocks();", "originalCommit": "9597b4625c414873b3ccca6427de245e1a1d2ef4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0MzY3Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519443676", "bodyText": "Not the version shown in the LDTTeam Discord.\nSo question, is this intended?", "author": "OrionDevelopment", "createdAt": "2020-11-08T15:59:46Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/stat/IStat.java", "diffHunk": "@@ -0,0 +1,17 @@\n+package com.minecolonies.api.colony.buildings.modules.stat;\n+\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * A specific stat.\n+ */\n+@FunctionalInterface\n+public interface IStat<N extends Number>", "originalCommit": "9597b4625c414873b3ccca6427de245e1a1d2ef4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2MTE4Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519461186", "bodyText": "yeah, I played around a bit with it and I think this one was the one that is the easiest to handle. The other ones were a bit more complex which made the code more difficult to maintain", "author": "Raycoms", "createdAt": "2020-11-08T18:36:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0MzY3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2MzA2Mg==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519463062", "bodyText": "what is that class even for? why do we turn int returns into complex objects which require unboxing?", "author": "someaddons", "createdAt": "2020-11-08T18:54:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0MzY3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2NDA4NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519464085", "bodyText": "Allows us to define how certain return values might be combined (If one module returns 5 max citizens and another one also 5, should they be added, replaced, math.max? This allows us to do this more generically", "author": "Raycoms", "createdAt": "2020-11-08T19:04:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0MzY3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2NDQ3Mw==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519464473", "bodyText": "hm I don't think we should combine return values of different modules, those usually then also have a different meaning", "author": "someaddons", "createdAt": "2020-11-08T19:07:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0MzY3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2NTMzNg==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519465336", "bodyText": "It makes sense in some cases: Allowing assignment of workers for example (each module allows to add one worker for example, someone could add a new module to a building with an additional worker). I could imagine many different use cases for combining values.", "author": "Raycoms", "createdAt": "2020-11-08T19:15:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0MzY3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0Mzg0OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519443849", "bodyText": "You can make this a set instead of a list to make logics a bit easier.", "author": "OrionDevelopment", "createdAt": "2020-11-08T16:01:25Z", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/modules/BedHandlingModule.java", "diffHunk": "@@ -0,0 +1,115 @@\n+package com.minecolonies.coremod.colony.buildings.modules;\n+\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import com.minecolonies.api.colony.buildings.modules.*;\n+import net.minecraft.block.BedBlock;\n+import net.minecraft.block.BlockState;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.nbt.ListNBT;\n+import net.minecraft.nbt.NBTUtil;\n+import net.minecraft.state.properties.BedPart;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.World;\n+import net.minecraftforge.common.util.Constants;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.*;\n+\n+import static com.minecolonies.api.util.constant.NbtTagConstants.TAG_BEDS;\n+\n+/**\n+ * The class of the citizen hut.\n+ */\n+public class BedHandlingModule extends AbstractBuildingModule implements IModuleWithExternalBlocks, IModuleWithData, IBuildingEventsModule\n+{\n+    /**\n+     * List of all beds.\n+     */\n+    @NotNull\n+    private final List<BlockPos> bedList = new ArrayList<>();", "originalCommit": "9597b4625c414873b3ccca6427de245e1a1d2ef4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0NDIyNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519444227", "bodyText": "Seeing this structure makes my stumach crinch a bit.\nI think we should add something like this to the building:\npublic Optional<T extends IModule> <T> getModule(Class<T> moduleClass)\nOn which we can then to chaining with things like .map(IModuleWithExternalBlocks::getRegisteredBlocks).orElse(Collections.emptyList())", "author": "OrionDevelopment", "createdAt": "2020-11-08T16:04:34Z", "path": "src/main/java/com/minecolonies/coremod/entity/ai/minimal/EntityAISleep.java", "diffHunk": "@@ -214,9 +215,9 @@ private void findBedAndTryToSleep()\n             {\n                 final IBuilding hut = colony.getBuildingManager().getBuilding(citizen.getHomePosition());\n                 List<BlockPos> bedList = new ArrayList<>();\n-                if (hut.hasModule(LivingBuildingModule.class))\n+                if (hut.hasModule(BedHandlingModule.class))", "originalCommit": "9597b4625c414873b3ccca6427de245e1a1d2ef4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0NTcyMg==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519445722", "bodyText": "I thin inhabitants belong to assignments, as you cant have inhabitants without assignments", "author": "someaddons", "createdAt": "2020-11-08T16:16:58Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IDefinesCoreBuildingStatsModule.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import com.minecolonies.api.colony.buildings.modules.stat.IStat;\n+\n+/**\n+ * Interface describing core building stats.\n+ * The first core stats module that is found in the building will define the values.\n+ */\n+public interface IDefinesCoreBuildingStatsModule extends IBuildingModule\n+{\n+    /**\n+     * Get the max building level a module allows.\n+     * By default this is 5.\n+     * @return the max level.\n+     */\n+    default IStat<Integer> getMaxBuildingLevel()\n+    {\n+        return (prev) -> prev == 0 ? 5 : prev;\n+    }\n+\n+    /**\n+     * Get the max number of inhabitants this module allows.\n+     * @return the modules max number of assigned citizens.\n+     */\n+    IStat<Integer> getMaxInhabitants();", "originalCommit": "9597b4625c414873b3ccca6427de245e1a1d2ef4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2MzY5Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519463696", "bodyText": "true", "author": "Raycoms", "createdAt": "2020-11-08T19:00:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0NTcyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2MzkwMA==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519463900", "bodyText": "The problem is that the tavern and home building use the same assigning module (as will many worker modules) but the actually max check is in the core module.", "author": "Raycoms", "createdAt": "2020-11-08T19:02:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0NTcyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2NDAyNA==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519464024", "bodyText": "could just move both into the assign one?", "author": "someaddons", "createdAt": "2020-11-08T19:03:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0NTcyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2NDM0Mg==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519464342", "bodyText": "No, that would meddle with the entire system. Both buildings use different basis for the max (tavern is max 4, home is max 5 and 1 per building level).", "author": "Raycoms", "createdAt": "2020-11-08T19:06:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0NTcyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI1MTM4Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r521251386", "bodyText": "I am going to argue that we should release that inhabitants <-> assigning logic in the near future.\nWe should add modules which allow assigning workers with specific jobs to a building. But the count should be up to the player in a certain degree.\nAka it should be possible to have 1 cook and 6 helpers or\n2 cooks and 1 helper.\nWe should envision some kind of slot like mechanism where certain assignments of jobs use more slots, and where this method returns the amount of slots available.", "author": "OrionDevelopment", "createdAt": "2020-11-11T10:10:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0NTcyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI5NzYyNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r521297627", "bodyText": "the way I see it is that we get specialized assignment modules, e.g. one for the Worker(s) where you can assign X workers, one for Living where you can have X ppl live in. And as I see that both of them would required a max you can put into the slots", "author": "someaddons", "createdAt": "2020-11-11T11:37:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0NTcyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMzNjE3Mg==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r521336172", "bodyText": "I don't see this as anything urgent though. There are 10 more urgent things on my list before sth like that.", "author": "Raycoms", "createdAt": "2020-11-11T12:50:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0NTcyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM1NTU4Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r521355586", "bodyText": "no you need to flesh this out before just merging it, else we end up with you using it in 10 places and needing a big refactor after. Not saying you need to make worker/living modules now, but put a getMaxAssignees into the Assignment base module and just remove the getMaxinhabitants here. As far as I see this there is no reason at all for this interface to exist.", "author": "someaddons", "createdAt": "2020-11-11T13:25:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0NTcyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM2MzE5MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r521363191", "bodyText": "For the time being, I was happy with how the system is currently defined, having this here centrally. A few examples of problems with assignment based method:\nAll buildings where people sleep and work have two assignment modules, one living, one working. So each would return 5 even though the max should be 5 building based, not module based.\nSame thing for other methods. So this method is here to stay. If anything, we'd have a second method in the assignment with a getModuleMax()", "author": "Raycoms", "createdAt": "2020-11-11T13:38:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0NTcyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0NTc5Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519445797", "bodyText": "need a more descriptive name for this, do we need this at all? afaik building levels are tied to schematics", "author": "someaddons", "createdAt": "2020-11-08T16:17:45Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IDefinesCoreBuildingStatsModule.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import com.minecolonies.api.colony.buildings.modules.stat.IStat;\n+\n+/**\n+ * Interface describing core building stats.\n+ * The first core stats module that is found in the building will define the values.\n+ */\n+public interface IDefinesCoreBuildingStatsModule extends IBuildingModule", "originalCommit": "9597b4625c414873b3ccca6427de245e1a1d2ef4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2MjE2NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519462165", "bodyText": "Regarding this. We had the discussion a while back once to actually have the building check on the schematics to determine it's max level. But that'd be out of the scope of the PR, so I'd like to keep it for now here. I can add a todo here though.", "author": "Raycoms", "createdAt": "2020-11-08T18:46:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0NTc5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2NDE0OA==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519464148", "bodyText": "I actually thought we'd keep the data which is core for a building, like schematic,level and such in the actual building object itself, as thats required and not modular", "author": "someaddons", "createdAt": "2020-11-08T19:04:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0NTc5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2NDI3NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519464275", "bodyText": "I moved the building level there now, yes", "author": "Raycoms", "createdAt": "2020-11-08T19:05:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0NTc5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0NTg3Mg==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519445872", "bodyText": "ISerializeableModule?", "author": "someaddons", "createdAt": "2020-11-08T16:18:42Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/IModuleWithData.java", "diffHunk": "@@ -0,0 +1,35 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.network.PacketBuffer;\n+\n+/**\n+ * Interface for all building modules that store additional data.\n+ */\n+public interface IModuleWithData extends IBuildingModule", "originalCommit": "9597b4625c414873b3ccca6427de245e1a1d2ef4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2MTcxNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519461717", "bodyText": "IPersistentModule I think is better, ye", "author": "Raycoms", "createdAt": "2020-11-08T18:41:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ0NTg3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ1NDY4Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519454686", "bodyText": "this class is kinda duplicated with IHasDirty, use either or?", "author": "someaddons", "createdAt": "2020-11-08T17:34:23Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/modules/AbstractBuildingModule.java", "diffHunk": "@@ -0,0 +1,46 @@\n+package com.minecolonies.api.colony.buildings.modules;\n+\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+\n+/**\n+ * Abstract class for all modules. Has base methods for all the necessary methods that have to be called from the building.\n+ */\n+public abstract class AbstractBuildingModule implements IBuildingModule\n+{", "originalCommit": "9597b4625c414873b3ccca6427de245e1a1d2ef4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2MTQ2MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r519461461", "bodyText": "No this one is the implementation of IHasDirty, so this one actually tracks the boolean", "author": "Raycoms", "createdAt": "2020-11-08T18:39:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ1NDY4Ng=="}], "type": "inlineReview"}, {"oid": "1c34e297296f9c4b2f1782ebd31493d49b73a524", "url": "https://github.com/ldtteam/minecolonies/commit/1c34e297296f9c4b2f1782ebd31493d49b73a524", "message": "fix some review comments", "committedDate": "2020-11-08T18:54:30Z", "type": "commit"}, {"oid": "76c9f7aeb165580004504eddcd1c416bbcd1b746", "url": "https://github.com/ldtteam/minecolonies/commit/76c9f7aeb165580004504eddcd1c416bbcd1b746", "message": "adjust remaining comments", "committedDate": "2020-11-08T19:04:20Z", "type": "commit"}, {"oid": "8efe944bf34d12677e85f4252da4079097d13629", "url": "https://github.com/ldtteam/minecolonies/commit/8efe944bf34d12677e85f4252da4079097d13629", "message": "fix imports", "committedDate": "2020-11-08T19:04:58Z", "type": "commit"}, {"oid": "3880ef67b40213db6ea52b1a89bfc4357a77ccb0", "url": "https://github.com/ldtteam/minecolonies/commit/3880ef67b40213db6ea52b1a89bfc4357a77ccb0", "message": "fix bug", "committedDate": "2020-11-08T19:52:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0OTE0Mg==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r521249142", "bodyText": "I do not think this method should be in the API.\nAs stated before: building modules should be immutable once the building is constructed.\nSo I do not see a reason to have a registerModule method.", "author": "OrionDevelopment", "createdAt": "2020-11-11T10:06:48Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/IBuilding.java", "diffHunk": "@@ -32,6 +33,27 @@\n \n public interface IBuilding extends IBuildingContainer, IRequestResolverProvider, IRequester\n {\n+    /**\n+     * Check if the building has a particular module.\n+     * @param clazz the module of the class to check.\n+     * @return true if so.\n+     */\n+    boolean hasModule(final Class<? extends IBuildingModule> clazz);\n+\n+    /**\n+     * Get the module with a particular class.\n+     * @param clazz the modules class.\n+     * @return the module or null of not existant.\n+     */\n+    @Nullable\n+    <T extends IBuildingModule> T getModule(Class<T> clazz);\n+\n+    /**\n+     * Register a specific module to the building.\n+     * @param module the module to register.\n+     */\n+    void registerModule(@NotNull final IBuildingModule module);", "originalCommit": "3880ef67b40213db6ea52b1a89bfc4357a77ccb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI5NTc0NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r521295745", "bodyText": "Because we handle IBuilding everywhere. As an alternative we could set up sth like \"you can't add modules after the initial setup\" with a throw or so.", "author": "Raycoms", "createdAt": "2020-11-11T11:33:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0OTE0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI5NjU4MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r521296581", "bodyText": "But we should have this in IBuilding such that we don't have to give out the AbstractBuilding or so", "author": "Raycoms", "createdAt": "2020-11-11T11:34:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0OTE0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI5NjYyOA==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r521296628", "bodyText": "hm this reminds me a bit on the cook, which through upgrading a building gets added new functionality in terms of the assistant, so might need it since buildings can change through upgrades", "author": "someaddons", "createdAt": "2020-11-11T11:34:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0OTE0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMwMzYwMA==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r521303600", "bodyText": "In that case the building would get the module form the beginning, but the module wouldn't \"work\" unless the necessary conditions are met.", "author": "Raycoms", "createdAt": "2020-11-11T11:49:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0OTE0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMyMTQ1NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r521321455", "bodyText": "@Raycoms you should build the list of modules. When the building instance is constructed..,....\nFor example somewhere in the building type or something.\nThe building should never have this.", "author": "OrionDevelopment", "createdAt": "2020-11-11T12:24:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0OTE0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMzODIzNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r521338237", "bodyText": "We do this on building instantiation. But we give the building as a hook to register modules on. I don't see a problem with that.", "author": "Raycoms", "createdAt": "2020-11-11T12:54:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0OTE0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM0NzU3MA==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r521347570", "bodyText": "I can add to the javadoc: Must be called during building instantiation.", "author": "Raycoms", "createdAt": "2020-11-11T13:11:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0OTE0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0OTgzMg==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r521249832", "bodyText": "I do not like nullables.\nIt can cause weird issues.\nUse an optional here, which forces people to think about what todo when the module is not available in the expected building automatically.", "author": "OrionDevelopment", "createdAt": "2020-11-11T10:07:58Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/IBuilding.java", "diffHunk": "@@ -32,6 +33,27 @@\n \n public interface IBuilding extends IBuildingContainer, IRequestResolverProvider, IRequester\n {\n+    /**\n+     * Check if the building has a particular module.\n+     * @param clazz the module of the class to check.\n+     * @return true if so.\n+     */\n+    boolean hasModule(final Class<? extends IBuildingModule> clazz);\n+\n+    /**\n+     * Get the module with a particular class.\n+     * @param clazz the modules class.\n+     * @return the module or null of not existant.\n+     */\n+    @Nullable\n+    <T extends IBuildingModule> T getModule(Class<T> clazz);", "originalCommit": "3880ef67b40213db6ea52b1a89bfc4357a77ccb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI1MDEwNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5939#discussion_r521250107", "bodyText": "Might additionally collapse the hasModule into this method when switched to the optional.\nComputationally it is identical.", "author": "OrionDevelopment", "createdAt": "2020-11-11T10:08:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0OTgzMg=="}], "type": "inlineReview"}, {"oid": "4aaf694a6e259c5d712b8aa789ef604de1189451", "url": "https://github.com/ldtteam/minecolonies/commit/4aaf694a6e259c5d712b8aa789ef604de1189451", "message": "optional", "committedDate": "2020-11-11T11:46:59Z", "type": "commit"}, {"oid": "ebdc303629649a2f347d716f2f176a469a17188b", "url": "https://github.com/ldtteam/minecolonies/commit/ebdc303629649a2f347d716f2f176a469a17188b", "message": "remove IAffectsWalkingSpeed", "committedDate": "2020-11-11T13:40:53Z", "type": "commit"}, {"oid": "1a9b8e3dc5580235342330cbd86ea06a83ed956d", "url": "https://github.com/ldtteam/minecolonies/commit/1a9b8e3dc5580235342330cbd86ea06a83ed956d", "message": "Merge branch 'version/1.15' into feature/building-rework-0.1", "committedDate": "2020-11-11T13:41:17Z", "type": "commit"}, {"oid": "a3a024c7798d86f9dbab6e93fa68048556962b0c", "url": "https://github.com/ldtteam/minecolonies/commit/a3a024c7798d86f9dbab6e93fa68048556962b0c", "message": "this time sam is unreasonable", "committedDate": "2020-11-11T15:08:30Z", "type": "commit"}]}