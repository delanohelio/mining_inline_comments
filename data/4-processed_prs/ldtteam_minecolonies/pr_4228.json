{"pr_number": 4228, "pr_title": "Fix citizen limit calculation", "pr_createdAt": "2020-01-11T22:00:48Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/4228", "timeline": [{"oid": "65713b23bd68121fd04a4899015afbdc4a0ad950", "url": "https://github.com/ldtteam/minecolonies/commit/65713b23bd68121fd04a4899015afbdc4a0ad950", "message": "Fix citizen limit calculation.\nNow Calculates on building upgrade/destruction.\nRecalculates after colony load, instead of reading old values.\nRecruitment of additional guards over the citizen hut limit now works.\nLevel 0 guard-buildings no longer count towards the limit.", "committedDate": "2020-01-11T21:58:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU0NDYyOQ==", "url": "https://github.com/ldtteam/minecolonies/pull/4228#discussion_r365544629", "bodyText": "our RackInventory class already has that overwrite, onContentsChanged was overwritten twice on accident", "author": "someaddons", "createdAt": "2020-01-11T22:09:55Z", "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -340,15 +340,7 @@ public void read(final CompoundNBT compound)\n             size = compound.getInt(TAG_SIZE);\n             if (size > 0)\n             {\n-                inventory = new RackInventory(DEFAULT_SIZE + size * SLOT_PER_LINE)\n-                {\n-                    @Override\n-                    protected void onContentsChanged(final int slot)\n-                    {\n-                        updateItemStorage();\n-                        super.onContentsChanged(slot);\n-                    }\n-                };\n+                inventory = new RackInventory(DEFAULT_SIZE + size * SLOT_PER_LINE);", "originalCommit": "65713b23bd68121fd04a4899015afbdc4a0ad950", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU0NTAyMg==", "url": "https://github.com/ldtteam/minecolonies/pull/4228#discussion_r365545022", "bodyText": "ohh", "author": "Raycoms", "createdAt": "2020-01-11T22:18:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU0NDYyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYzNzEyOQ==", "url": "https://github.com/ldtteam/minecolonies/pull/4228#discussion_r365637129", "bodyText": "Was just checking that, glad to hear", "author": "Asherslab", "createdAt": "2020-01-13T03:14:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU0NDYyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU0NjYyMQ==", "url": "https://github.com/ldtteam/minecolonies/pull/4228#discussion_r365546621", "bodyText": "Shouldn't we then recalc after read?", "author": "Raycoms", "createdAt": "2020-01-11T23:02:58Z", "path": "src/main/java/com/minecolonies/coremod/colony/managers/CitizenManager.java", "diffHunk": "@@ -92,9 +92,6 @@ public CitizenManager(final Colony colony)\n     @Override\n     public void read(@NotNull final CompoundNBT compound)\n     {\n-        maxCitizens = compound.getInt(TAG_MAX_CITIZENS);\n-        potentialMaxCitizens = compound.getInt(TAG_POTENTIAL_MAX_CITIZENS);", "originalCommit": "65713b23bd68121fd04a4899015afbdc4a0ad950", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU0Njk5OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/4228#discussion_r365546999", "bodyText": "ye but we need the buildings to be loaded for that calculation, thats why it is added after the building manager read in the colony", "author": "someaddons", "createdAt": "2020-01-11T23:13:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU0NjYyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU0NzAzOA==", "url": "https://github.com/ldtteam/minecolonies/pull/4228#discussion_r365547038", "bodyText": "ahkk", "author": "Raycoms", "createdAt": "2020-01-11T23:15:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU0NjYyMQ=="}], "type": "inlineReview"}, {"oid": "efb066de0ccda4993cceecd4d791796ecc4a10cb", "url": "https://github.com/ldtteam/minecolonies/commit/efb066de0ccda4993cceecd4d791796ecc4a10cb", "message": "Add missing calculation case & make it global for future use.", "committedDate": "2020-01-13T22:09:02Z", "type": "commit"}]}