{"pr_number": 5127, "pr_title": "Add beekeeper", "pr_createdAt": "2020-05-31T21:26:42Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/5127", "timeline": [{"oid": "4bb5f6763a0cc4c4c27135526596e119c5560619", "url": "https://github.com/ldtteam/minecolonies/commit/4bb5f6763a0cc4c4c27135526596e119c5560619", "message": "Initial beekeeper commit\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-05-31T21:24:40Z", "type": "commit"}, {"oid": "4686a54b61fa7e91f9cf7d9fee45faeb3cec7fd6", "url": "https://github.com/ldtteam/minecolonies/commit/4686a54b61fa7e91f9cf7d9fee45faeb3cec7fd6", "message": "add more beekeeper classes\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-05-31T23:21:22Z", "type": "commit"}, {"oid": "56e0335a3d4de4d1777aa918ea7006296c23c785", "url": "https://github.com/ldtteam/minecolonies/commit/56e0335a3d4de4d1777aa918ea7006296c23c785", "message": "start on ai\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-05-31T23:58:08Z", "type": "commit"}, {"oid": "b1b2be0fc4d92ffc344197da32a3ef51661783fe", "url": "https://github.com/ldtteam/minecolonies/commit/b1b2be0fc4d92ffc344197da32a3ef51661783fe", "message": "Merge branch 'version/1.15' into feature/beekeeper", "committedDate": "2020-06-01T13:50:40Z", "type": "commit"}, {"oid": "158db0cbba93278d7b8f5c1df8ad5f349671e2b1", "url": "https://github.com/ldtteam/minecolonies/commit/158db0cbba93278d7b8f5c1df8ad5f349671e2b1", "message": "implement beekeeper ai\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-01T16:35:56Z", "type": "commit"}, {"oid": "b1f86fac8f435d562d6b75f022e8203548865ea1", "url": "https://github.com/ldtteam/minecolonies/commit/b1f86fac8f435d562d6b75f022e8203548865ea1", "message": "add window\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-01T17:35:53Z", "type": "commit"}, {"oid": "3237621caee22269033392e22ef03607f2ef1b77", "url": "https://github.com/ldtteam/minecolonies/commit/3237621caee22269033392e22ef03607f2ef1b77", "message": "Merge branch 'version/1.15' into feature/beekeeper", "committedDate": "2020-06-01T20:59:35Z", "type": "commit"}, {"oid": "90845375e519b8f3bca581575abca256b680ed1c", "url": "https://github.com/ldtteam/minecolonies/commit/90845375e519b8f3bca581575abca256b680ed1c", "message": "Merge branch 'version/1.15' into feature/beekeeper", "committedDate": "2020-06-02T21:31:20Z", "type": "commit"}, {"oid": "f6388ed32ace6f3f0355237e00f9b46b0ff8f3f9", "url": "https://github.com/ldtteam/minecolonies/commit/f6388ed32ace6f3f0355237e00f9b46b0ff8f3f9", "message": "finish (missing:\n- translations\n- scepter texture\n- schematics\n- hut recipe)\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-05T20:43:59Z", "type": "commit"}, {"oid": "62541ab47b5d0ee011154944550261875425438b", "url": "https://github.com/ldtteam/minecolonies/commit/62541ab47b5d0ee011154944550261875425438b", "message": "Merge branch 'version/1.15' into feature/beekeeper", "committedDate": "2020-06-05T20:49:25Z", "type": "commit"}, {"oid": "917ec15959d0369ab576b03a2f7f65ed104cbdef", "url": "https://github.com/ldtteam/minecolonies/commit/917ec15959d0369ab576b03a2f7f65ed104cbdef", "message": "run datagen\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-06T11:57:58Z", "type": "commit"}, {"oid": "c81f86374448e1f90440a5670bcbc4031509efa2", "url": "https://github.com/ldtteam/minecolonies/commit/c81f86374448e1f90440a5670bcbc4031509efa2", "message": "add recipe\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-06T21:43:47Z", "type": "commit"}, {"oid": "73a4ceaef41ea52e9f202697ba1edd79118ed24b", "url": "https://github.com/ldtteam/minecolonies/commit/73a4ceaef41ea52e9f202697ba1edd79118ed24b", "message": "add scepter texture\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-07T20:35:46Z", "type": "commit"}, {"oid": "0e03c86a2294a30fe25029ff3b9263bb0e00f4b5", "url": "https://github.com/ldtteam/minecolonies/commit/0e03c86a2294a30fe25029ff3b9263bb0e00f4b5", "message": "Merge branch 'version/1.15' into feature/beekeeper", "committedDate": "2020-06-07T20:36:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwNjgyNQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436406825", "bodyText": "Wrong jdoc", "author": "Raycoms", "createdAt": "2020-06-07T22:14:58Z", "path": "src/api/java/com/minecolonies/api/entity/ai/statemachine/states/AIWorkerState.java", "diffHunk": "@@ -533,7 +533,12 @@\n      */\n     PLANTATION_FARM(true),\n \n-    PLANTATION_PLANT(true);\n+    PLANTATION_PLANT(true),\n+\n+    /*\n+### Plantation related ###\n+     */\n+    BEEKEEPER_HARVEST(true);", "originalCommit": "0e03c86a2294a30fe25029ff3b9263bb0e00f4b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ4OTE4NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436489185", "bodyText": "oops", "author": "Minecraftschurli", "createdAt": "2020-06-08T06:53:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwNjgyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwNjg3Mg==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436406872", "bodyText": "formatting is off", "author": "Raycoms", "createdAt": "2020-06-07T22:15:42Z", "path": "src/main/java/com/minecolonies/coremod/blocks/huts/BlockHutBeekeeper.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package com.minecolonies.coremod.blocks.huts;\n+\n+import com.minecolonies.api.blocks.AbstractBlockHut;\n+import com.minecolonies.api.colony.buildings.ModBuildings;\n+import com.minecolonies.api.colony.buildings.registry.BuildingEntry;\n+\n+public class BlockHutBeekeeper extends AbstractBlockHut<BlockHutBeekeeper> {", "originalCommit": "0e03c86a2294a30fe25029ff3b9263bb0e00f4b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwNjkzMg==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436406932", "bodyText": "NBTtag constant class please", "author": "Raycoms", "createdAt": "2020-06-07T22:16:38Z", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/workerbuildings/BuildingBeekeeper.java", "diffHunk": "@@ -0,0 +1,258 @@\n+package com.minecolonies.coremod.colony.buildings.workerbuildings;\n+\n+import com.ldtteam.blockout.views.Window;\n+import com.minecolonies.api.colony.ICitizenData;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.IColonyManager;\n+import com.minecolonies.api.colony.IColonyView;\n+import com.minecolonies.api.colony.buildings.ModBuildings;\n+import com.minecolonies.api.colony.buildings.registry.BuildingEntry;\n+import com.minecolonies.api.colony.jobs.IJob;\n+import com.minecolonies.api.colony.requestsystem.token.IToken;\n+import com.minecolonies.api.crafting.IRecipeStorage;\n+import com.minecolonies.api.entity.citizen.Skill;\n+import com.minecolonies.api.util.NBTUtils;\n+import com.minecolonies.coremod.Network;\n+import com.minecolonies.coremod.client.gui.WindowHutBeekeeper;\n+import com.minecolonies.coremod.colony.buildings.AbstractBuildingWorker;\n+import com.minecolonies.coremod.colony.jobs.JobBeekeeper;\n+import com.minecolonies.coremod.network.messages.server.colony.building.beekeeper.BeekeeperSetHarvestHoneycombsMessage;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.item.Items;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.nbt.NBTUtil;\n+import net.minecraft.network.PacketBuffer;\n+import net.minecraft.util.Tuple;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraftforge.common.util.Constants;\n+import org.jetbrains.annotations.NotNull;\n+import org.jetbrains.annotations.Nullable;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import static com.minecolonies.api.util.constant.BuildingConstants.CONST_DEFAULT_MAX_BUILDING_LEVEL;\n+\n+public class BuildingBeekeeper extends AbstractBuildingWorker\n+{\n+    /**\n+     * Description of the job executed in the hut.\n+     */\n+    private static final String BEEKEEPER = \"beekeeper\";\n+\n+    private static final String TAG_HIVES              = \"hives\";", "originalCommit": "0e03c86a2294a30fe25029ff3b9263bb0e00f4b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwNjk0OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436406949", "bodyText": "jdoc missing", "author": "Raycoms", "createdAt": "2020-06-07T22:16:47Z", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/workerbuildings/BuildingBeekeeper.java", "diffHunk": "@@ -0,0 +1,258 @@\n+package com.minecolonies.coremod.colony.buildings.workerbuildings;\n+\n+import com.ldtteam.blockout.views.Window;\n+import com.minecolonies.api.colony.ICitizenData;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.IColonyManager;\n+import com.minecolonies.api.colony.IColonyView;\n+import com.minecolonies.api.colony.buildings.ModBuildings;\n+import com.minecolonies.api.colony.buildings.registry.BuildingEntry;\n+import com.minecolonies.api.colony.jobs.IJob;\n+import com.minecolonies.api.colony.requestsystem.token.IToken;\n+import com.minecolonies.api.crafting.IRecipeStorage;\n+import com.minecolonies.api.entity.citizen.Skill;\n+import com.minecolonies.api.util.NBTUtils;\n+import com.minecolonies.coremod.Network;\n+import com.minecolonies.coremod.client.gui.WindowHutBeekeeper;\n+import com.minecolonies.coremod.colony.buildings.AbstractBuildingWorker;\n+import com.minecolonies.coremod.colony.jobs.JobBeekeeper;\n+import com.minecolonies.coremod.network.messages.server.colony.building.beekeeper.BeekeeperSetHarvestHoneycombsMessage;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.item.Items;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.nbt.NBTUtil;\n+import net.minecraft.network.PacketBuffer;\n+import net.minecraft.util.Tuple;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraftforge.common.util.Constants;\n+import org.jetbrains.annotations.NotNull;\n+import org.jetbrains.annotations.Nullable;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import static com.minecolonies.api.util.constant.BuildingConstants.CONST_DEFAULT_MAX_BUILDING_LEVEL;\n+\n+public class BuildingBeekeeper extends AbstractBuildingWorker\n+{\n+    /**\n+     * Description of the job executed in the hut.\n+     */\n+    private static final String BEEKEEPER = \"beekeeper\";\n+\n+    private static final String TAG_HIVES              = \"hives\";\n+    private static final String TAG_HARVEST_HONEYCOMBS = \"harvest_honeycombs\";\n+\n+    /**\n+     * List of hives.\n+     */\n+    private Set<BlockPos> hives             = new HashSet<>();\n+    private boolean       harvestHoneycombs = true;", "originalCommit": "0e03c86a2294a30fe25029ff3b9263bb0e00f4b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwNzAwNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436407007", "bodyText": "I don't think the worker needs any recipes", "author": "Raycoms", "createdAt": "2020-06-07T22:17:35Z", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/workerbuildings/BuildingBeekeeper.java", "diffHunk": "@@ -0,0 +1,258 @@\n+package com.minecolonies.coremod.colony.buildings.workerbuildings;\n+\n+import com.ldtteam.blockout.views.Window;\n+import com.minecolonies.api.colony.ICitizenData;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.IColonyManager;\n+import com.minecolonies.api.colony.IColonyView;\n+import com.minecolonies.api.colony.buildings.ModBuildings;\n+import com.minecolonies.api.colony.buildings.registry.BuildingEntry;\n+import com.minecolonies.api.colony.jobs.IJob;\n+import com.minecolonies.api.colony.requestsystem.token.IToken;\n+import com.minecolonies.api.crafting.IRecipeStorage;\n+import com.minecolonies.api.entity.citizen.Skill;\n+import com.minecolonies.api.util.NBTUtils;\n+import com.minecolonies.coremod.Network;\n+import com.minecolonies.coremod.client.gui.WindowHutBeekeeper;\n+import com.minecolonies.coremod.colony.buildings.AbstractBuildingWorker;\n+import com.minecolonies.coremod.colony.jobs.JobBeekeeper;\n+import com.minecolonies.coremod.network.messages.server.colony.building.beekeeper.BeekeeperSetHarvestHoneycombsMessage;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.item.Items;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.nbt.NBTUtil;\n+import net.minecraft.network.PacketBuffer;\n+import net.minecraft.util.Tuple;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraftforge.common.util.Constants;\n+import org.jetbrains.annotations.NotNull;\n+import org.jetbrains.annotations.Nullable;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import static com.minecolonies.api.util.constant.BuildingConstants.CONST_DEFAULT_MAX_BUILDING_LEVEL;\n+\n+public class BuildingBeekeeper extends AbstractBuildingWorker\n+{\n+    /**\n+     * Description of the job executed in the hut.\n+     */\n+    private static final String BEEKEEPER = \"beekeeper\";\n+\n+    private static final String TAG_HIVES              = \"hives\";\n+    private static final String TAG_HARVEST_HONEYCOMBS = \"harvest_honeycombs\";\n+\n+    /**\n+     * List of hives.\n+     */\n+    private Set<BlockPos> hives             = new HashSet<>();\n+    private boolean       harvestHoneycombs = true;\n+\n+    /**\n+     * The abstract constructor of the building.\n+     *\n+     * @param c the colony\n+     * @param l the position\n+     */\n+    public BuildingBeekeeper(@NotNull IColony c, BlockPos l)\n+    {\n+        super(c, l);\n+        keepX.put(stack -> Items.SHEARS == stack.getItem(), new Tuple<>(1, true));\n+        keepX.put(stack -> Items.GLASS_BOTTLE == stack.getItem(), new Tuple<>(4, true));\n+    }\n+\n+    /**\n+     * The abstract method which creates a job for the building.\n+     *\n+     * @param citizen the citizen to take the job.\n+     * @return the Job.\n+     */\n+    @NotNull\n+    @Override\n+    public IJob createJob(ICitizenData citizen)\n+    {\n+        return new JobBeekeeper(citizen);\n+    }\n+\n+    /**\n+     * The abstract method which returns the name of the job.\n+     *\n+     * @return the job name.\n+     */\n+    @NotNull\n+    @Override\n+    public String getJobName()\n+    {\n+        return BEEKEEPER;\n+    }\n+\n+    /**\n+     * Primary skill getter.\n+     *\n+     * @return the primary skill.\n+     */\n+    @NotNull\n+    @Override\n+    public Skill getPrimarySkill()\n+    {\n+        return Skill.Stamina; //TODO\n+    }\n+\n+    /**\n+     * Secondary skill getter.\n+     *\n+     * @return the secondary skill.\n+     */\n+    @NotNull\n+    @Override\n+    public Skill getSecondarySkill()\n+    {\n+        return Skill.Focus; //TODO\n+    }\n+\n+    @Override\n+    public BuildingEntry getBuildingRegistryEntry()\n+    {\n+        return ModBuildings.beekeeper;\n+    }\n+\n+    /**\n+     * Children must return the name of their structure.\n+     *\n+     * @return StructureProxy name.\n+     */\n+    @Override\n+    public String getSchematicName()\n+    {\n+        return BEEKEEPER;\n+    }\n+\n+    /**\n+     * Children must return their max building level.\n+     *\n+     * @return Max building level.\n+     */\n+    @Override\n+    public int getMaxBuildingLevel()\n+    {\n+        return CONST_DEFAULT_MAX_BUILDING_LEVEL;\n+    }\n+\n+    @Override\n+    public void deserializeNBT(CompoundNBT compound)\n+    {\n+        super.deserializeNBT(compound);\n+        NBTUtils.streamCompound(compound.getList(TAG_HIVES, Constants.NBT.TAG_COMPOUND))\n+          .map(NBTUtil::readBlockPos)\n+          .forEach(this.hives::add);\n+        this.harvestHoneycombs = compound.getBoolean(TAG_HARVEST_HONEYCOMBS);\n+    }\n+\n+    @Override\n+    public CompoundNBT serializeNBT()\n+    {\n+        final CompoundNBT nbt = super.serializeNBT();\n+        nbt.put(TAG_HIVES, this.hives.stream().map(NBTUtil::writeBlockPos).collect(NBTUtils.toListNBT()));\n+        nbt.putBoolean(TAG_HARVEST_HONEYCOMBS, this.harvestHoneycombs);\n+        return nbt;\n+    }\n+\n+    @Override", "originalCommit": "0e03c86a2294a30fe25029ff3b9263bb0e00f4b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwNzAzNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436407037", "bodyText": "@OverRide for overriden methods, else javadoc", "author": "Raycoms", "createdAt": "2020-06-07T22:18:01Z", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/workerbuildings/BuildingBeekeeper.java", "diffHunk": "@@ -0,0 +1,258 @@\n+package com.minecolonies.coremod.colony.buildings.workerbuildings;\n+\n+import com.ldtteam.blockout.views.Window;\n+import com.minecolonies.api.colony.ICitizenData;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.IColonyManager;\n+import com.minecolonies.api.colony.IColonyView;\n+import com.minecolonies.api.colony.buildings.ModBuildings;\n+import com.minecolonies.api.colony.buildings.registry.BuildingEntry;\n+import com.minecolonies.api.colony.jobs.IJob;\n+import com.minecolonies.api.colony.requestsystem.token.IToken;\n+import com.minecolonies.api.crafting.IRecipeStorage;\n+import com.minecolonies.api.entity.citizen.Skill;\n+import com.minecolonies.api.util.NBTUtils;\n+import com.minecolonies.coremod.Network;\n+import com.minecolonies.coremod.client.gui.WindowHutBeekeeper;\n+import com.minecolonies.coremod.colony.buildings.AbstractBuildingWorker;\n+import com.minecolonies.coremod.colony.jobs.JobBeekeeper;\n+import com.minecolonies.coremod.network.messages.server.colony.building.beekeeper.BeekeeperSetHarvestHoneycombsMessage;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.item.Items;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.nbt.NBTUtil;\n+import net.minecraft.network.PacketBuffer;\n+import net.minecraft.util.Tuple;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraftforge.common.util.Constants;\n+import org.jetbrains.annotations.NotNull;\n+import org.jetbrains.annotations.Nullable;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import static com.minecolonies.api.util.constant.BuildingConstants.CONST_DEFAULT_MAX_BUILDING_LEVEL;\n+\n+public class BuildingBeekeeper extends AbstractBuildingWorker\n+{\n+    /**\n+     * Description of the job executed in the hut.\n+     */\n+    private static final String BEEKEEPER = \"beekeeper\";\n+\n+    private static final String TAG_HIVES              = \"hives\";\n+    private static final String TAG_HARVEST_HONEYCOMBS = \"harvest_honeycombs\";\n+\n+    /**\n+     * List of hives.\n+     */\n+    private Set<BlockPos> hives             = new HashSet<>();\n+    private boolean       harvestHoneycombs = true;\n+\n+    /**\n+     * The abstract constructor of the building.\n+     *\n+     * @param c the colony\n+     * @param l the position\n+     */\n+    public BuildingBeekeeper(@NotNull IColony c, BlockPos l)\n+    {\n+        super(c, l);\n+        keepX.put(stack -> Items.SHEARS == stack.getItem(), new Tuple<>(1, true));\n+        keepX.put(stack -> Items.GLASS_BOTTLE == stack.getItem(), new Tuple<>(4, true));\n+    }\n+\n+    /**\n+     * The abstract method which creates a job for the building.\n+     *\n+     * @param citizen the citizen to take the job.\n+     * @return the Job.\n+     */\n+    @NotNull\n+    @Override\n+    public IJob createJob(ICitizenData citizen)\n+    {\n+        return new JobBeekeeper(citizen);\n+    }\n+\n+    /**\n+     * The abstract method which returns the name of the job.\n+     *\n+     * @return the job name.\n+     */\n+    @NotNull\n+    @Override\n+    public String getJobName()\n+    {\n+        return BEEKEEPER;\n+    }\n+\n+    /**\n+     * Primary skill getter.\n+     *\n+     * @return the primary skill.\n+     */\n+    @NotNull\n+    @Override\n+    public Skill getPrimarySkill()\n+    {\n+        return Skill.Stamina; //TODO\n+    }\n+\n+    /**\n+     * Secondary skill getter.\n+     *\n+     * @return the secondary skill.\n+     */\n+    @NotNull\n+    @Override\n+    public Skill getSecondarySkill()\n+    {\n+        return Skill.Focus; //TODO\n+    }\n+\n+    @Override\n+    public BuildingEntry getBuildingRegistryEntry()\n+    {\n+        return ModBuildings.beekeeper;\n+    }\n+\n+    /**\n+     * Children must return the name of their structure.\n+     *\n+     * @return StructureProxy name.\n+     */\n+    @Override\n+    public String getSchematicName()\n+    {\n+        return BEEKEEPER;\n+    }\n+\n+    /**\n+     * Children must return their max building level.\n+     *\n+     * @return Max building level.\n+     */\n+    @Override\n+    public int getMaxBuildingLevel()\n+    {\n+        return CONST_DEFAULT_MAX_BUILDING_LEVEL;\n+    }\n+\n+    @Override\n+    public void deserializeNBT(CompoundNBT compound)\n+    {\n+        super.deserializeNBT(compound);\n+        NBTUtils.streamCompound(compound.getList(TAG_HIVES, Constants.NBT.TAG_COMPOUND))\n+          .map(NBTUtil::readBlockPos)\n+          .forEach(this.hives::add);\n+        this.harvestHoneycombs = compound.getBoolean(TAG_HARVEST_HONEYCOMBS);\n+    }\n+\n+    @Override\n+    public CompoundNBT serializeNBT()\n+    {\n+        final CompoundNBT nbt = super.serializeNBT();\n+        nbt.put(TAG_HIVES, this.hives.stream().map(NBTUtil::writeBlockPos).collect(NBTUtils.toListNBT()));\n+        nbt.putBoolean(TAG_HARVEST_HONEYCOMBS, this.harvestHoneycombs);\n+        return nbt;\n+    }\n+\n+    @Override\n+    public boolean canRecipeBeAdded(IToken token)\n+    {\n+        if (!super.canRecipeBeAdded(token))\n+        {\n+            return false;\n+        }\n+\n+        final IRecipeStorage storage = IColonyManager.getInstance().getRecipeManager().getRecipes().get(token);\n+        if (storage == null)\n+        {\n+            return false;\n+        }\n+\n+        return storage.getInput()\n+                 .stream()\n+                 .map(ItemStack::getItem)\n+                 .anyMatch(item -> item == Items.HONEYCOMB || item == Items.HONEY_BOTTLE) ||\n+                storage.getPrimaryOutput().getItem() == Items.HONEY_BOTTLE ||\n+                storage.getPrimaryOutput().getItem() == Items.HONEYCOMB;\n+    }\n+\n+    @Override\n+    public void serializeToView(@NotNull final PacketBuffer buf)\n+    {\n+        super.serializeToView(buf);\n+        buf.writeBoolean(harvestHoneycombs);\n+    }\n+\n+    public Set<BlockPos> getHives()", "originalCommit": "0e03c86a2294a30fe25029ff3b9263bb0e00f4b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwNzA2MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436407061", "bodyText": "not needed if empty", "author": "Raycoms", "createdAt": "2020-06-07T22:18:25Z", "path": "src/main/java/com/minecolonies/coremod/colony/jobs/JobBeekeeper.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package com.minecolonies.coremod.colony.jobs;\n+\n+import com.minecolonies.api.colony.ICitizenData;\n+import com.minecolonies.api.colony.jobs.ModJobs;\n+import com.minecolonies.api.colony.jobs.registry.JobEntry;\n+import com.minecolonies.coremod.entity.ai.basic.AbstractAISkeleton;\n+import com.minecolonies.coremod.entity.ai.citizen.beekeeper.EntityAIWorkBeekeeper;\n+import net.minecraft.nbt.INBT;\n+\n+public class JobBeekeeper extends AbstractJob\n+{\n+    /**\n+     * Initialize citizen data.\n+     *\n+     * @param entity the citizen data.\n+     */\n+    public JobBeekeeper(ICitizenData entity)\n+    {\n+        super(entity);\n+    }\n+\n+    /**\n+     * The {@link JobEntry} for this job.\n+     *\n+     * @return The {@link JobEntry}.\n+     */\n+    @Override\n+    public JobEntry getJobRegistryEntry()\n+    {\n+        return ModJobs.beekeeper;\n+    }\n+\n+    /**\n+     * Return a Localization textContent for the Job.\n+     *\n+     * @return localization textContent String.\n+     */\n+    @Override\n+    public String getName()\n+    {\n+        return \"com.minecolonies.coremod.job.Beekeeper\";\n+    }\n+\n+    /**\n+     * Generate your AI class to register.\n+     * <p>\n+     * Suppressing Sonar Rule squid:S1452 This rule does \"Generic wildcard types should not be used in return parameters\"\n+     * But in this case the rule does not apply because\n+     * We are fine with all AbstractJob implementations and need generics only for java\n+     *\n+     * @return your personal AI instance.\n+     */\n+    @Override\n+    public AbstractAISkeleton generateAI()\n+    {\n+        return new EntityAIWorkBeekeeper(this);\n+    }\n+\n+    @Override", "originalCommit": "0e03c86a2294a30fe25029ff3b9263bb0e00f4b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0MDk4OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436740989", "bodyText": "You should remove the entire deserializeMethod", "author": "Raycoms", "createdAt": "2020-06-08T14:12:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwNzA2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwNzEyMA==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436407120", "bodyText": "jdoc", "author": "Raycoms", "createdAt": "2020-06-07T22:19:21Z", "path": "src/main/java/com/minecolonies/coremod/network/messages/server/colony/building/beekeeper/BeekeeperScepterMessage.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package com.minecolonies.coremod.network.messages.server.colony.building.beekeeper;\n+\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.buildings.views.IBuildingView;\n+import com.minecolonies.api.items.ModItems;\n+import com.minecolonies.api.util.BlockPosUtil;\n+import com.minecolonies.coremod.colony.buildings.workerbuildings.BuildingBeekeeper;\n+import com.minecolonies.coremod.network.messages.server.AbstractBuildingServerMessage;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.network.PacketBuffer;\n+import net.minecraftforge.fml.network.NetworkEvent;\n+\n+import static com.minecolonies.api.util.constant.NbtTagConstants.TAG_ID;\n+import static com.minecolonies.api.util.constant.NbtTagConstants.TAG_POS;\n+\n+/**\n+ * Message to set the lumberjack scepter in the player inventory.", "originalCommit": "0e03c86a2294a30fe25029ff3b9263bb0e00f4b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwNzE0Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436407147", "bodyText": "jdoc", "author": "Raycoms", "createdAt": "2020-06-07T22:19:40Z", "path": "src/main/java/com/minecolonies/coremod/network/messages/server/colony/building/beekeeper/BeekeeperSetHarvestHoneycombsMessage.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package com.minecolonies.coremod.network.messages.server.colony.building.beekeeper;\n+\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.network.IMessage;\n+import com.minecolonies.coremod.colony.buildings.workerbuildings.BuildingBeekeeper;\n+import com.minecolonies.coremod.colony.buildings.workerbuildings.BuildingCowboy;\n+import com.minecolonies.coremod.network.messages.server.AbstractBuildingServerMessage;\n+import net.minecraft.network.PacketBuffer;\n+import net.minecraftforge.fml.network.NetworkEvent;\n+\n+public class BeekeeperSetHarvestHoneycombsMessage extends AbstractBuildingServerMessage<BuildingBeekeeper>\n+{\n+    private boolean harvestHoneycombs;", "originalCommit": "0e03c86a2294a30fe25029ff3b9263bb0e00f4b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwNzIzNg==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436407236", "bodyText": "Should probably be pass and not fail.", "author": "Raycoms", "createdAt": "2020-06-07T22:20:32Z", "path": "src/main/java/com/minecolonies/coremod/items/ItemScepterBeekeeper.java", "diffHunk": "@@ -0,0 +1,116 @@\n+package com.minecolonies.coremod.items;\n+\n+import com.ldtteam.structurize.util.LanguageHandler;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.IColonyManager;\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import com.minecolonies.api.util.BlockPosUtil;\n+import com.minecolonies.api.util.NBTUtils;\n+import com.minecolonies.api.util.constant.Constants;\n+import com.minecolonies.coremod.colony.buildings.workerbuildings.BuildingBeekeeper;\n+import net.minecraft.block.BeehiveBlock;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.item.ItemUseContext;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.nbt.NBTUtil;\n+import net.minecraft.util.ActionResultType;\n+import net.minecraft.util.math.BlockPos;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.Collection;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import static com.minecolonies.api.util.constant.NbtTagConstants.TAG_ID;\n+import static com.minecolonies.api.util.constant.NbtTagConstants.TAG_POS;\n+\n+/**\n+ * Beekeeper Scepter Item class. Used to give tasks to Beekeeper.\n+ */\n+public class ItemScepterBeekeeper extends AbstractItemMinecolonies\n+{\n+    private static final String NBT_HIVE_POS = Constants.MOD_ID + \":\" + \"hives\";\n+\n+    /**\n+     * BeekeeperScepter constructor. Sets max stack to 1, like other tools.\n+     * @param properties the properties.\n+     */\n+    public ItemScepterBeekeeper(final Properties properties)\n+    {\n+        super(\"scepterbeekeeper\", properties.maxStackSize(1));\n+    }\n+\n+    @Override\n+    public ActionResultType onItemUse(final ItemUseContext useContext)\n+    {\n+        // if server world, do nothing\n+        if (useContext.getWorld().isRemote)\n+        {\n+            return ActionResultType.FAIL;", "originalCommit": "0e03c86a2294a30fe25029ff3b9263bb0e00f4b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ5MDU0Mg==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436490542", "bodyText": "it's copied from lumberjack so I thought this is right", "author": "Minecraftschurli", "createdAt": "2020-06-08T06:57:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwNzIzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjUwMTQ5Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436501496", "bodyText": "Ah, then you can keep it. There it works fine.", "author": "Raycoms", "createdAt": "2020-06-08T07:24:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwNzIzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwNzMwMg==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436407302", "bodyText": "Might be easier to save them directly in the building each time already.", "author": "Raycoms", "createdAt": "2020-06-07T22:21:24Z", "path": "src/main/java/com/minecolonies/coremod/items/ItemScepterBeekeeper.java", "diffHunk": "@@ -0,0 +1,116 @@\n+package com.minecolonies.coremod.items;\n+\n+import com.ldtteam.structurize.util.LanguageHandler;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.IColonyManager;\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import com.minecolonies.api.util.BlockPosUtil;\n+import com.minecolonies.api.util.NBTUtils;\n+import com.minecolonies.api.util.constant.Constants;\n+import com.minecolonies.coremod.colony.buildings.workerbuildings.BuildingBeekeeper;\n+import net.minecraft.block.BeehiveBlock;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.item.ItemUseContext;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.nbt.NBTUtil;\n+import net.minecraft.util.ActionResultType;\n+import net.minecraft.util.math.BlockPos;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.Collection;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import static com.minecolonies.api.util.constant.NbtTagConstants.TAG_ID;\n+import static com.minecolonies.api.util.constant.NbtTagConstants.TAG_POS;\n+\n+/**\n+ * Beekeeper Scepter Item class. Used to give tasks to Beekeeper.\n+ */\n+public class ItemScepterBeekeeper extends AbstractItemMinecolonies\n+{\n+    private static final String NBT_HIVE_POS = Constants.MOD_ID + \":\" + \"hives\";\n+\n+    /**\n+     * BeekeeperScepter constructor. Sets max stack to 1, like other tools.\n+     * @param properties the properties.\n+     */\n+    public ItemScepterBeekeeper(final Properties properties)\n+    {\n+        super(\"scepterbeekeeper\", properties.maxStackSize(1));\n+    }\n+\n+    @Override\n+    public ActionResultType onItemUse(final ItemUseContext useContext)\n+    {\n+        // if server world, do nothing\n+        if (useContext.getWorld().isRemote)\n+        {\n+            return ActionResultType.FAIL;\n+        }\n+\n+        final ItemStack scepter = useContext.getPlayer().getHeldItem(useContext.getHand());\n+        final CompoundNBT compound = scepter.getOrCreateTag();\n+\n+        final IColony colony = IColonyManager.getInstance().getColonyByWorld(compound.getInt(TAG_ID), useContext.getWorld());\n+        final BlockPos hutPos = BlockPosUtil.read(compound, TAG_POS);\n+        final IBuilding hut = colony.getBuildingManager().getBuilding(hutPos);\n+        final BuildingBeekeeper building = (BuildingBeekeeper) hut;\n+\n+        if (useContext.getWorld().getBlockState(useContext.getPos()).getBlock() instanceof BeehiveBlock)\n+        {\n+\n+            final Collection<BlockPos> positions = readPositions(compound);\n+\n+            final BlockPos pos = useContext.getPos();\n+            if (positions.contains(pos))\n+            {\n+                LanguageHandler.sendPlayerMessage(useContext.getPlayer(), \"item.minecolonies.scepterbeekeeper.removehive\");\n+                positions.remove(pos);\n+            }\n+            else\n+            {\n+                if (positions.size() < building.getMaximumHives())\n+                {\n+                    LanguageHandler.sendPlayerMessage(useContext.getPlayer(), \"item.minecolonies.scepterbeekeeper.addhive\");\n+                    positions.add(pos);\n+                }\n+                else\n+                {\n+                    LanguageHandler.sendPlayerMessage(useContext.getPlayer(), \"item.minecolonies.scepterbeekeeper.maxhives\");\n+                    save(useContext.getPlayer(), building, compound);\n+                }\n+            }\n+            writePositions(positions, compound);\n+        }\n+        else\n+        {\n+            save(useContext.getPlayer(), building, compound);\n+        }\n+\n+        return super.onItemUse(useContext);", "originalCommit": "0e03c86a2294a30fe25029ff3b9263bb0e00f4b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwNzMzMA==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436407330", "bodyText": "That would also save you from writing positions in the item", "author": "Raycoms", "createdAt": "2020-06-07T22:21:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwNzMwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjUwNTQzMw==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436505433", "bodyText": "yea that's way better (was thinking too complicated when I did it)", "author": "Minecraftschurli", "createdAt": "2020-06-08T07:33:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwNzMwMg=="}], "type": "inlineReview"}, {"oid": "dc61959eadd8194b9064201f18b5975c3d9d72ce", "url": "https://github.com/ldtteam/minecolonies/commit/dc61959eadd8194b9064201f18b5975c3d9d72ce", "message": "add changes requested by Raycoms\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-08T07:28:58Z", "type": "commit"}, {"oid": "c8c36671400162107e7656b87190eae3f336501e", "url": "https://github.com/ldtteam/minecolonies/commit/c8c36671400162107e7656b87190eae3f336501e", "message": "fix merge conflict for class ModBlocks\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-08T07:40:01Z", "type": "commit"}, {"oid": "85385b690d92b038dbf45562eefacc717818b92c", "url": "https://github.com/ldtteam/minecolonies/commit/85385b690d92b038dbf45562eefacc717818b92c", "message": "remove test schematics\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-08T08:03:36Z", "type": "commit"}, {"oid": "775933ba259a0de58fee8c4126918d48554d94d0", "url": "https://github.com/ldtteam/minecolonies/commit/775933ba259a0de58fee8c4126918d48554d94d0", "message": "fix blockHutArchery being used twice in getHuts\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-08T08:05:37Z", "type": "commit"}, {"oid": "8792a238385e153b0da333ec8dd66949d4cda9f3", "url": "https://github.com/ldtteam/minecolonies/commit/8792a238385e153b0da333ec8dd66949d4cda9f3", "message": "Merge branch 'version/1.15' into feature/beekeeper", "committedDate": "2020-06-08T08:23:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjczODc0Mg==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436738742", "bodyText": "formatting slightly off", "author": "Raycoms", "createdAt": "2020-06-08T14:10:17Z", "path": "src/main/java/com/minecolonies/coremod/blocks/huts/BlockHutBeekeeper.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.minecolonies.coremod.blocks.huts;\n+\n+import com.minecolonies.api.blocks.AbstractBlockHut;\n+import com.minecolonies.api.colony.buildings.ModBuildings;\n+import com.minecolonies.api.colony.buildings.registry.BuildingEntry;\n+\n+public class BlockHutBeekeeper extends AbstractBlockHut<BlockHutBeekeeper>\n+{\n+    /**\n+     * Method to return the name of the block.\n+     *\n+     * @return Name of the block.\n+     */\n+    @Override\n+    public String getName() {", "originalCommit": "8792a238385e153b0da333ec8dd66949d4cda9f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjczODkxMw==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436738913", "bodyText": "jdoc", "author": "Raycoms", "createdAt": "2020-06-08T14:10:24Z", "path": "src/main/java/com/minecolonies/coremod/blocks/huts/BlockHutBeekeeper.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.minecolonies.coremod.blocks.huts;\n+\n+import com.minecolonies.api.blocks.AbstractBlockHut;\n+import com.minecolonies.api.colony.buildings.ModBuildings;\n+import com.minecolonies.api.colony.buildings.registry.BuildingEntry;\n+\n+public class BlockHutBeekeeper extends AbstractBlockHut<BlockHutBeekeeper>", "originalCommit": "8792a238385e153b0da333ec8dd66949d4cda9f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0MDEwNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436740107", "bodyText": "Dexterity -> primary\nAdaptability -> Secondary\nWere planned for this worker", "author": "Raycoms", "createdAt": "2020-06-08T14:11:32Z", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/workerbuildings/BuildingBeekeeper.java", "diffHunk": "@@ -0,0 +1,259 @@\n+package com.minecolonies.coremod.colony.buildings.workerbuildings;\n+\n+import com.ldtteam.blockout.views.Window;\n+import com.minecolonies.api.colony.ICitizenData;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.IColonyView;\n+import com.minecolonies.api.colony.buildings.ModBuildings;\n+import com.minecolonies.api.colony.buildings.registry.BuildingEntry;\n+import com.minecolonies.api.colony.jobs.IJob;\n+import com.minecolonies.api.entity.citizen.Skill;\n+import com.minecolonies.api.util.NBTUtils;\n+import com.minecolonies.api.util.constant.NbtTagConstants;\n+import com.minecolonies.coremod.Network;\n+import com.minecolonies.coremod.client.gui.WindowHutBeekeeper;\n+import com.minecolonies.coremod.colony.buildings.AbstractBuildingWorker;\n+import com.minecolonies.coremod.colony.jobs.JobBeekeeper;\n+import com.minecolonies.coremod.network.messages.server.colony.building.beekeeper.BeekeeperSetHarvestHoneycombsMessage;\n+import net.minecraft.item.Items;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.nbt.NBTUtil;\n+import net.minecraft.network.PacketBuffer;\n+import net.minecraft.util.Tuple;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraftforge.common.util.Constants;\n+import org.jetbrains.annotations.NotNull;\n+import org.jetbrains.annotations.Nullable;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import static com.minecolonies.api.util.constant.BuildingConstants.CONST_DEFAULT_MAX_BUILDING_LEVEL;\n+\n+public class BuildingBeekeeper extends AbstractBuildingWorker\n+{\n+    /**\n+     * Description of the job executed in the hut.\n+     */\n+    private static final String BEEKEEPER = \"beekeeper\";\n+\n+    /**\n+     * List of hives.\n+     */\n+    private Set<BlockPos> hives = new HashSet<>();\n+\n+    /**\n+     * Wether the beekeeper should harvest honeycombs or honey bottles\n+     */\n+    private boolean harvestHoneycombs = true;\n+\n+    /**\n+     * The abstract constructor of the building.\n+     *\n+     * @param c the colony\n+     * @param l the position\n+     */\n+    public BuildingBeekeeper(@NotNull final IColony c, final BlockPos l)\n+    {\n+        super(c, l);\n+        keepX.put(stack -> Items.SHEARS == stack.getItem(), new Tuple<>(1, true));\n+        keepX.put(stack -> Items.GLASS_BOTTLE == stack.getItem(), new Tuple<>(4, true));\n+    }\n+\n+    /**\n+     * The abstract method which creates a job for the building.\n+     *\n+     * @param citizen the citizen to take the job.\n+     * @return the Job.\n+     */\n+    @NotNull\n+    @Override\n+    public IJob createJob(final ICitizenData citizen)\n+    {\n+        return new JobBeekeeper(citizen);\n+    }\n+\n+    /**\n+     * The abstract method which returns the name of the job.\n+     *\n+     * @return the job name.\n+     */\n+    @NotNull\n+    @Override\n+    public String getJobName()\n+    {\n+        return BEEKEEPER;\n+    }\n+\n+    /**\n+     * Primary skill getter.\n+     *\n+     * @return the primary skill.\n+     */\n+    @NotNull\n+    @Override\n+    public Skill getPrimarySkill()\n+    {\n+        return Skill.Stamina; //TODO", "originalCommit": "8792a238385e153b0da333ec8dd66949d4cda9f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0MjYwNQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436742605", "bodyText": "ok (that's why I put the todo there)", "author": "Minecraftschurli", "createdAt": "2020-06-08T14:14:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0MDEwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0MDUwNQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436740505", "bodyText": "jdoc", "author": "Raycoms", "createdAt": "2020-06-08T14:11:54Z", "path": "src/main/java/com/minecolonies/coremod/colony/jobs/JobBeekeeper.java", "diffHunk": "@@ -0,0 +1,60 @@\n+package com.minecolonies.coremod.colony.jobs;\n+\n+import com.minecolonies.api.colony.ICitizenData;\n+import com.minecolonies.api.colony.jobs.ModJobs;\n+import com.minecolonies.api.colony.jobs.registry.JobEntry;\n+import com.minecolonies.coremod.entity.ai.basic.AbstractAISkeleton;\n+import com.minecolonies.coremod.entity.ai.citizen.beekeeper.EntityAIWorkBeekeeper;\n+import net.minecraft.nbt.INBT;\n+\n+public class JobBeekeeper extends AbstractJob", "originalCommit": "8792a238385e153b0da333ec8dd66949d4cda9f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0MjQ2MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436742461", "bodyText": "That is quite the creative way to make a tag based request. Although I'm unsure we shouldn't create just a TagBased request type new instead of doing it the hacky way.", "author": "Raycoms", "createdAt": "2020-06-08T14:14:33Z", "path": "src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAIBasic.java", "diffHunk": "@@ -1495,6 +1499,40 @@ public boolean checkIfRequestForItemExistOrCreateAsynch(@NotNull final ItemStack\n         return false;\n     }\n \n+    /**\n+     * Check if a tag has been requested already or is in the inventory. If not in the inventory and not requested already, create request\n+     *\n+     * @param tag the requested tag.\n+     * @return true if in the inventory, else false.\n+     */\n+    public boolean checkIfRequestForTagExistOrCreateAsynch(@NotNull final Tag<Item> tag, final int count, final String description)\n+    {\n+        if (InventoryUtils.hasItemInItemHandler(worker.getInventoryCitizen(), s -> s.getItem().isIn(tag) && s.getCount() >= count))\n+        {\n+            return true;\n+        }\n+\n+        if (InventoryUtils.getItemCountInProvider(getOwnBuilding(),\n+                itemStack -> itemStack.getItem().isIn(tag)) >= count &&\n+                InventoryUtils.transferXOfFirstSlotInProviderWithIntoNextFreeSlotInItemHandler(\n+                        getOwnBuilding(), itemStack -> itemStack.getItem().isIn(tag),\n+                        count,\n+                        worker.getInventoryCitizen()))\n+        {\n+            return true;\n+        }\n+\n+        final List<ItemStack> stacks = tag.getAllElements().stream().map(itemIn -> new ItemStack(itemIn, count)).collect(Collectors.toList());", "originalCommit": "8792a238385e153b0da333ec8dd66949d4cda9f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0MzE1OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436743159", "bodyText": "I don't like the code style of this. We should have a setter for this on the building instead of getting a mutable list and add them by reference.", "author": "Raycoms", "createdAt": "2020-06-08T14:15:32Z", "path": "src/main/java/com/minecolonies/coremod/items/ItemScepterBeekeeper.java", "diffHunk": "@@ -0,0 +1,88 @@\n+package com.minecolonies.coremod.items;\n+\n+import com.ldtteam.structurize.util.LanguageHandler;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.IColonyManager;\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import com.minecolonies.api.util.BlockPosUtil;\n+import com.minecolonies.coremod.colony.buildings.workerbuildings.BuildingBeekeeper;\n+import net.minecraft.block.BeehiveBlock;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.item.ItemUseContext;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.util.ActionResultType;\n+import net.minecraft.util.math.BlockPos;\n+\n+import java.util.Collection;\n+\n+import static com.minecolonies.api.util.constant.NbtTagConstants.TAG_ID;\n+import static com.minecolonies.api.util.constant.NbtTagConstants.TAG_POS;\n+\n+/**\n+ * Beekeeper Scepter Item class. Used to give tasks to Beekeeper.\n+ */\n+public class ItemScepterBeekeeper extends AbstractItemMinecolonies\n+{\n+    /**\n+     * BeekeeperScepter constructor. Sets max stack to 1, like other tools.\n+     *\n+     * @param properties the properties.\n+     */\n+    public ItemScepterBeekeeper(final Properties properties)\n+    {\n+        super(\"scepterbeekeeper\", properties.maxStackSize(1));\n+    }\n+\n+    @Override\n+    public ActionResultType onItemUse(final ItemUseContext useContext)\n+    {\n+        // if server world, do nothing\n+        if (useContext.getWorld().isRemote)\n+        {\n+            return ActionResultType.FAIL;\n+        }\n+\n+        final PlayerEntity player = useContext.getPlayer();\n+\n+        final ItemStack scepter = useContext.getPlayer().getHeldItem(useContext.getHand());\n+        final CompoundNBT compound = scepter.getOrCreateTag();\n+\n+        final IColony colony = IColonyManager.getInstance().getColonyByWorld(compound.getInt(TAG_ID), useContext.getWorld());\n+        final BlockPos hutPos = BlockPosUtil.read(compound, TAG_POS);\n+        final IBuilding hut = colony.getBuildingManager().getBuilding(hutPos);\n+        final BuildingBeekeeper building = (BuildingBeekeeper) hut;\n+\n+        if (useContext.getWorld().getBlockState(useContext.getPos()).getBlock() instanceof BeehiveBlock)\n+        {\n+\n+            final Collection<BlockPos> positions = building.getHives();", "originalCommit": "8792a238385e153b0da333ec8dd66949d4cda9f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0NTM2MA==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436745360", "bodyText": "you mean add and remove proxy methods?", "author": "Minecraftschurli", "createdAt": "2020-06-08T14:18:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0MzE1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg5MDQ2Mw==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436890463", "bodyText": "yes", "author": "Raycoms", "createdAt": "2020-06-08T17:56:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0MzE1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0NDQwNA==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436744404", "bodyText": "private, jdoc, and better name", "author": "Raycoms", "createdAt": "2020-06-08T14:17:19Z", "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/beekeeper/EntityAIWorkBeekeeper.java", "diffHunk": "@@ -0,0 +1,460 @@\n+package com.minecolonies.coremod.entity.ai.citizen.beekeeper;\n+\n+import com.minecolonies.api.entity.ai.statemachine.AITarget;\n+import com.minecolonies.api.entity.ai.statemachine.states.IAIState;\n+import com.minecolonies.api.util.InventoryUtils;\n+import com.minecolonies.api.util.ItemStackUtils;\n+import com.minecolonies.api.util.constant.ToolType;\n+import com.minecolonies.api.util.constant.TranslationConstants;\n+import com.minecolonies.coremod.colony.buildings.workerbuildings.BuildingBeekeeper;\n+import com.minecolonies.coremod.colony.jobs.JobBeekeeper;\n+import com.minecolonies.coremod.entity.ai.basic.AbstractEntityAIInteract;\n+import net.minecraft.entity.passive.AnimalEntity;\n+import net.minecraft.entity.passive.BeeEntity;\n+import net.minecraft.item.Item;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.item.Items;\n+import net.minecraft.state.properties.BlockStateProperties;\n+import net.minecraft.tags.ItemTags;\n+import net.minecraft.tileentity.BeehiveTileEntity;\n+import net.minecraft.util.Hand;\n+import net.minecraft.util.math.AxisAlignedBB;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.util.text.TranslationTextComponent;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.*;\n+import java.util.stream.Collectors;\n+\n+import static com.minecolonies.api.entity.ai.statemachine.states.AIWorkerState.*;\n+import static com.minecolonies.api.util.constant.Constants.TICKS_SECOND;\n+import static com.minecolonies.api.util.constant.ToolLevelConstants.TOOL_LEVEL_WOOD_OR_GOLD;\n+import static com.minecolonies.api.util.constant.TranslationConstants.COM_MINECOLONIES_COREMOD_STATUS_BEEKEEPER_HARVESTING;\n+import static com.minecolonies.api.util.constant.TranslationConstants.FLOWERS;\n+\n+public class EntityAIWorkBeekeeper extends AbstractEntityAIInteract<JobBeekeeper>\n+{\n+    /**\n+     * Amount of animals needed to bread.\n+     */\n+    private static final int NUM_OF_ANIMALS_TO_BREED = 2;\n+    private static final int BEES_PER_LEVEL          = 3;\n+\n+    /**\n+     * Experience given per beehive harvested.\n+     */\n+    private static final double EXP_PER_HARVEST = 5.0;\n+\n+    /**\n+     * Distance two animals need to be inside to breed.\n+     */\n+    private static final int DISTANCE_TO_BREED = 10;\n+\n+    /**\n+     * Distance around a hive wher bees wander.\n+     */\n+    private static final int HIVE_BEE_RADIUS = 22;\n+\n+    /**\n+     * Delays used to setDelay()\n+     */\n+    private static final int DECIDING_DELAY   = 40;\n+    private static final int NO_ANIMALS_DELAY = 100;\n+    private static final int BREEDING_DELAY   = 40;\n+\n+    /**\n+     * Creates the abstract part of the AI. Always use this constructor!\n+     *\n+     * @param job the job to fulfill\n+     */\n+    public EntityAIWorkBeekeeper(@NotNull JobBeekeeper job)\n+    {\n+        super(job);\n+        super.registerTargets(\n+          new AITarget(IDLE, START_WORKING, 1),\n+          new AITarget(START_WORKING, this::startWorkingAtOwnBuilding, TICKS_SECOND),\n+          new AITarget(PREPARING, this::prepareForHerding, 1),\n+          new AITarget(DECIDE, this::decideWhatToDo, 1),\n+          new AITarget(HERDER_BREED, this::breedAnimals, 1),\n+          new AITarget(BEEKEEPER_HARVEST, this::harvestHoney, TICKS_SECOND)\n+        );\n+    }\n+\n+    public boolean maxAnimals(final List<BeeEntity> allAnimals)", "originalCommit": "8792a238385e153b0da333ec8dd66949d4cda9f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0NDk1NA==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436744954", "bodyText": "Possibly, when there are a bunch of glass bottles and flowers in the inventory they shouldn't request", "author": "Raycoms", "createdAt": "2020-06-08T14:18:05Z", "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/beekeeper/EntityAIWorkBeekeeper.java", "diffHunk": "@@ -0,0 +1,460 @@\n+package com.minecolonies.coremod.entity.ai.citizen.beekeeper;\n+\n+import com.minecolonies.api.entity.ai.statemachine.AITarget;\n+import com.minecolonies.api.entity.ai.statemachine.states.IAIState;\n+import com.minecolonies.api.util.InventoryUtils;\n+import com.minecolonies.api.util.ItemStackUtils;\n+import com.minecolonies.api.util.constant.ToolType;\n+import com.minecolonies.api.util.constant.TranslationConstants;\n+import com.minecolonies.coremod.colony.buildings.workerbuildings.BuildingBeekeeper;\n+import com.minecolonies.coremod.colony.jobs.JobBeekeeper;\n+import com.minecolonies.coremod.entity.ai.basic.AbstractEntityAIInteract;\n+import net.minecraft.entity.passive.AnimalEntity;\n+import net.minecraft.entity.passive.BeeEntity;\n+import net.minecraft.item.Item;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.item.Items;\n+import net.minecraft.state.properties.BlockStateProperties;\n+import net.minecraft.tags.ItemTags;\n+import net.minecraft.tileentity.BeehiveTileEntity;\n+import net.minecraft.util.Hand;\n+import net.minecraft.util.math.AxisAlignedBB;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.util.text.TranslationTextComponent;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.*;\n+import java.util.stream.Collectors;\n+\n+import static com.minecolonies.api.entity.ai.statemachine.states.AIWorkerState.*;\n+import static com.minecolonies.api.util.constant.Constants.TICKS_SECOND;\n+import static com.minecolonies.api.util.constant.ToolLevelConstants.TOOL_LEVEL_WOOD_OR_GOLD;\n+import static com.minecolonies.api.util.constant.TranslationConstants.COM_MINECOLONIES_COREMOD_STATUS_BEEKEEPER_HARVESTING;\n+import static com.minecolonies.api.util.constant.TranslationConstants.FLOWERS;\n+\n+public class EntityAIWorkBeekeeper extends AbstractEntityAIInteract<JobBeekeeper>\n+{\n+    /**\n+     * Amount of animals needed to bread.\n+     */\n+    private static final int NUM_OF_ANIMALS_TO_BREED = 2;\n+    private static final int BEES_PER_LEVEL          = 3;\n+\n+    /**\n+     * Experience given per beehive harvested.\n+     */\n+    private static final double EXP_PER_HARVEST = 5.0;\n+\n+    /**\n+     * Distance two animals need to be inside to breed.\n+     */\n+    private static final int DISTANCE_TO_BREED = 10;\n+\n+    /**\n+     * Distance around a hive wher bees wander.\n+     */\n+    private static final int HIVE_BEE_RADIUS = 22;\n+\n+    /**\n+     * Delays used to setDelay()\n+     */\n+    private static final int DECIDING_DELAY   = 40;\n+    private static final int NO_ANIMALS_DELAY = 100;\n+    private static final int BREEDING_DELAY   = 40;\n+\n+    /**\n+     * Creates the abstract part of the AI. Always use this constructor!\n+     *\n+     * @param job the job to fulfill\n+     */\n+    public EntityAIWorkBeekeeper(@NotNull JobBeekeeper job)\n+    {\n+        super(job);\n+        super.registerTargets(\n+          new AITarget(IDLE, START_WORKING, 1),\n+          new AITarget(START_WORKING, this::startWorkingAtOwnBuilding, TICKS_SECOND),\n+          new AITarget(PREPARING, this::prepareForHerding, 1),\n+          new AITarget(DECIDE, this::decideWhatToDo, 1),\n+          new AITarget(HERDER_BREED, this::breedAnimals, 1),\n+          new AITarget(BEEKEEPER_HARVEST, this::harvestHoney, TICKS_SECOND)\n+        );\n+    }\n+\n+    public boolean maxAnimals(final List<BeeEntity> allAnimals)\n+    {\n+        if (getOwnBuilding() != null)\n+        {\n+            final int numOfBeesInHive = getOwnBuilding(BuildingBeekeeper.class)\n+                                          .getHives()\n+                                          .stream()\n+                                          .map(world::getTileEntity)\n+                                          .filter(Objects::nonNull)\n+                                          .map(BeehiveTileEntity.class::cast)\n+                                          .mapToInt(BeehiveTileEntity::func_226971_j_)\n+                                          .sum();\n+            final int numOfAnimals = allAnimals.size();\n+            final int maxAnimals = getOwnBuilding().getBuildingLevel() * BEES_PER_LEVEL;\n+\n+            return (numOfAnimals + numOfBeesInHive) > maxAnimals;\n+        }\n+        return true;\n+    }\n+\n+    /**\n+     * Prepares the beekeeper for herding\n+     *\n+     * @return The next {@link IAIState}.\n+     */\n+    private IAIState prepareForHerding()\n+    {\n+        setDelay(DECIDING_DELAY);\n+        if (getOwnBuilding(BuildingBeekeeper.class).shouldHarvestHoneycombs())\n+        {\n+            if (checkForToolOrWeapon(ToolType.SHEARS))\n+            {\n+                return getState();\n+            }\n+        }\n+\n+        checkIfRequestForItemExistOrCreateAsynch(new ItemStack(Items.GLASS_BOTTLE));", "originalCommit": "8792a238385e153b0da333ec8dd66949d4cda9f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0OTM5Mw==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436749393", "bodyText": "I think checkIfRequestForItemExistOrCreateAsynch does already check the inventory", "author": "Minecraftschurli", "createdAt": "2020-06-08T14:24:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0NDk1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc1MDAwMQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436750001", "bodyText": "from checkIfRequestForItemExistOrCreateAsynch jdoc\n\nCheck if a stack has been requested already or is in the inventory. If not in the inventory and not requested already, create request", "author": "Minecraftschurli", "createdAt": "2020-06-08T14:25:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0NDk1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg5MDM1NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436890355", "bodyText": "ah okay", "author": "Raycoms", "createdAt": "2020-06-08T17:55:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0NDk1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0NTc5OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436745799", "bodyText": "Should probably set an interaction here, if they can't find bees within a time they gotta tell the player about this.", "author": "Raycoms", "createdAt": "2020-06-08T14:19:23Z", "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/beekeeper/EntityAIWorkBeekeeper.java", "diffHunk": "@@ -0,0 +1,460 @@\n+package com.minecolonies.coremod.entity.ai.citizen.beekeeper;\n+\n+import com.minecolonies.api.entity.ai.statemachine.AITarget;\n+import com.minecolonies.api.entity.ai.statemachine.states.IAIState;\n+import com.minecolonies.api.util.InventoryUtils;\n+import com.minecolonies.api.util.ItemStackUtils;\n+import com.minecolonies.api.util.constant.ToolType;\n+import com.minecolonies.api.util.constant.TranslationConstants;\n+import com.minecolonies.coremod.colony.buildings.workerbuildings.BuildingBeekeeper;\n+import com.minecolonies.coremod.colony.jobs.JobBeekeeper;\n+import com.minecolonies.coremod.entity.ai.basic.AbstractEntityAIInteract;\n+import net.minecraft.entity.passive.AnimalEntity;\n+import net.minecraft.entity.passive.BeeEntity;\n+import net.minecraft.item.Item;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.item.Items;\n+import net.minecraft.state.properties.BlockStateProperties;\n+import net.minecraft.tags.ItemTags;\n+import net.minecraft.tileentity.BeehiveTileEntity;\n+import net.minecraft.util.Hand;\n+import net.minecraft.util.math.AxisAlignedBB;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.util.text.TranslationTextComponent;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.*;\n+import java.util.stream.Collectors;\n+\n+import static com.minecolonies.api.entity.ai.statemachine.states.AIWorkerState.*;\n+import static com.minecolonies.api.util.constant.Constants.TICKS_SECOND;\n+import static com.minecolonies.api.util.constant.ToolLevelConstants.TOOL_LEVEL_WOOD_OR_GOLD;\n+import static com.minecolonies.api.util.constant.TranslationConstants.COM_MINECOLONIES_COREMOD_STATUS_BEEKEEPER_HARVESTING;\n+import static com.minecolonies.api.util.constant.TranslationConstants.FLOWERS;\n+\n+public class EntityAIWorkBeekeeper extends AbstractEntityAIInteract<JobBeekeeper>\n+{\n+    /**\n+     * Amount of animals needed to bread.\n+     */\n+    private static final int NUM_OF_ANIMALS_TO_BREED = 2;\n+    private static final int BEES_PER_LEVEL          = 3;\n+\n+    /**\n+     * Experience given per beehive harvested.\n+     */\n+    private static final double EXP_PER_HARVEST = 5.0;\n+\n+    /**\n+     * Distance two animals need to be inside to breed.\n+     */\n+    private static final int DISTANCE_TO_BREED = 10;\n+\n+    /**\n+     * Distance around a hive wher bees wander.\n+     */\n+    private static final int HIVE_BEE_RADIUS = 22;\n+\n+    /**\n+     * Delays used to setDelay()\n+     */\n+    private static final int DECIDING_DELAY   = 40;\n+    private static final int NO_ANIMALS_DELAY = 100;\n+    private static final int BREEDING_DELAY   = 40;\n+\n+    /**\n+     * Creates the abstract part of the AI. Always use this constructor!\n+     *\n+     * @param job the job to fulfill\n+     */\n+    public EntityAIWorkBeekeeper(@NotNull JobBeekeeper job)\n+    {\n+        super(job);\n+        super.registerTargets(\n+          new AITarget(IDLE, START_WORKING, 1),\n+          new AITarget(START_WORKING, this::startWorkingAtOwnBuilding, TICKS_SECOND),\n+          new AITarget(PREPARING, this::prepareForHerding, 1),\n+          new AITarget(DECIDE, this::decideWhatToDo, 1),\n+          new AITarget(HERDER_BREED, this::breedAnimals, 1),\n+          new AITarget(BEEKEEPER_HARVEST, this::harvestHoney, TICKS_SECOND)\n+        );\n+    }\n+\n+    public boolean maxAnimals(final List<BeeEntity> allAnimals)\n+    {\n+        if (getOwnBuilding() != null)\n+        {\n+            final int numOfBeesInHive = getOwnBuilding(BuildingBeekeeper.class)\n+                                          .getHives()\n+                                          .stream()\n+                                          .map(world::getTileEntity)\n+                                          .filter(Objects::nonNull)\n+                                          .map(BeehiveTileEntity.class::cast)\n+                                          .mapToInt(BeehiveTileEntity::func_226971_j_)\n+                                          .sum();\n+            final int numOfAnimals = allAnimals.size();\n+            final int maxAnimals = getOwnBuilding().getBuildingLevel() * BEES_PER_LEVEL;\n+\n+            return (numOfAnimals + numOfBeesInHive) > maxAnimals;\n+        }\n+        return true;\n+    }\n+\n+    /**\n+     * Prepares the beekeeper for herding\n+     *\n+     * @return The next {@link IAIState}.\n+     */\n+    private IAIState prepareForHerding()\n+    {\n+        setDelay(DECIDING_DELAY);\n+        if (getOwnBuilding(BuildingBeekeeper.class).shouldHarvestHoneycombs())\n+        {\n+            if (checkForToolOrWeapon(ToolType.SHEARS))\n+            {\n+                return getState();\n+            }\n+        }\n+\n+        checkIfRequestForItemExistOrCreateAsynch(new ItemStack(Items.GLASS_BOTTLE));\n+        checkIfRequestForTagExistOrCreateAsynch(ItemTags.field_226159_I_, 16, FLOWERS);\n+\n+        return DECIDE;\n+    }\n+\n+    /**\n+     * Redirects the beekeeper to their building.\n+     *\n+     * @return The next {@link IAIState}.\n+     */\n+    private IAIState startWorkingAtOwnBuilding()\n+    {\n+        worker.getCitizenStatusHandler().setLatestStatus(new TranslationTextComponent(TranslationConstants.COM_MINECOLONIES_COREMOD_STATUS_WORKER_GOINGTOHUT));\n+        if (walkToBuilding())\n+        {\n+            return getState();\n+        }\n+        return PREPARING;\n+    }\n+\n+    /**\n+     * Decides what job the beekeeper should switch to, breeding or harvesting.\n+     *\n+     * @return The next {@link IAIState} the beekeeper should switch to, after executing this method.\n+     */\n+    private IAIState decideWhatToDo()\n+    {\n+        setDelay(DECIDING_DELAY);\n+\n+        final Optional<BlockPos> hive = getOwnBuilding(BuildingBeekeeper.class)\n+                                          .getHives()\n+                                          .stream()\n+                                          .filter(pos -> BeehiveTileEntity.func_226964_a_(world.getBlockState(pos)) >= 5)\n+                                          .findFirst();\n+        if (hive.isPresent())\n+        {\n+            return BEEKEEPER_HARVEST;\n+        }\n+\n+        final List<BeeEntity> bees = new ArrayList<>(searchForAnimals());\n+\n+        if (bees.isEmpty())", "originalCommit": "8792a238385e153b0da333ec8dd66949d4cda9f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc1MTg2NA==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r436751864", "bodyText": "how should I implement this? with a counter variable?", "author": "Minecraftschurli", "createdAt": "2020-06-08T14:27:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0NTc5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIxMDk0NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r443210945", "bodyText": "Better probably if hive is empty. Then add the interaction.", "author": "Raycoms", "createdAt": "2020-06-21T11:40:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0NTc5OQ=="}], "type": "inlineReview"}, {"oid": "62ec0a3672bfc82dc578268f6b6d373630f32e50", "url": "https://github.com/ldtteam/minecolonies/commit/62ec0a3672bfc82dc578268f6b6d373630f32e50", "message": "continue adding requested changes\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-08T14:28:53Z", "type": "commit"}, {"oid": "6f8785b1b9a306b673d8084e86b56d7a48191f4a", "url": "https://github.com/ldtteam/minecolonies/commit/6f8785b1b9a306b673d8084e86b56d7a48191f4a", "message": "fix errors that resulted from upstream changes\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-08T14:35:38Z", "type": "commit"}, {"oid": "18504c84b42822bd4ac7ff88100628b5249de137", "url": "https://github.com/ldtteam/minecolonies/commit/18504c84b42822bd4ac7ff88100628b5249de137", "message": "add proxy methods for adding/removing hives/nests to/from the beekeeper\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-08T21:39:10Z", "type": "commit"}, {"oid": "e719a23fe96e1bd506a37dcbc53d2c061d54abec", "url": "https://github.com/ldtteam/minecolonies/commit/e719a23fe96e1bd506a37dcbc53d2c061d54abec", "message": "Merge branch 'version/1.15' into feature/beekeeper", "committedDate": "2020-06-09T08:29:33Z", "type": "commit"}, {"oid": "31a8a4c03377061cb7dedb7fb12531de9a5f0aec", "url": "https://github.com/ldtteam/minecolonies/commit/31a8a4c03377061cb7dedb7fb12531de9a5f0aec", "message": "Div text (#5175)\n\nSome minor fixes\r\nAdd full diversity textures to minecolonies entities", "committedDate": "2020-06-16T16:22:26Z", "type": "commit"}, {"oid": "3658aa190a442de2a6c91ae67f257b1faabbea76", "url": "https://github.com/ldtteam/minecolonies/commit/3658aa190a442de2a6c91ae67f257b1faabbea76", "message": "Feature/recipe tags (#5058)\n\nIntroduces a system for adding and excluding recipes based on datapack tags", "committedDate": "2020-06-16T16:22:27Z", "type": "commit"}, {"oid": "36518b9fc0f9505fc925835e7c15908e3715ca1b", "url": "https://github.com/ldtteam/minecolonies/commit/36518b9fc0f9505fc925835e7c15908e3715ca1b", "message": "Schematics115 (#5189)\n\nSchematic Deco Fixes", "committedDate": "2020-06-16T16:22:28Z", "type": "commit"}, {"oid": "fb08677fd140175423ab5e0190e16a96ac98f8cb", "url": "https://github.com/ldtteam/minecolonies/commit/fb08677fd140175423ab5e0190e16a96ac98f8cb", "message": "Removes fulfill and cancel from clipboard detail view (#5180)\n\nRemoves fulfill from clipboard detail view", "committedDate": "2020-06-16T16:22:28Z", "type": "commit"}, {"oid": "1de448a0a3a39ac02b267437bc4a3350f5864a69", "url": "https://github.com/ldtteam/minecolonies/commit/1de448a0a3a39ac02b267437bc4a3350f5864a69", "message": "Improve spawner in raids, improve ticks (#5199)\n\nTracks spawner position in raid event and regularly checks them\r\nAlso now uses the O(1) methods of racks better for the minimum stock ticks.", "committedDate": "2020-06-16T16:22:29Z", "type": "commit"}, {"oid": "4aa22818dedfd0d6879110362f384d2acd8233e2", "url": "https://github.com/ldtteam/minecolonies/commit/4aa22818dedfd0d6879110362f384d2acd8233e2", "message": "Add Stonebrick slabs and stairs to the list of path blocks. (#5219)\n\nAdd Stone Brick slabs and stairs to the list of path blocks.\r\nThis makes them prefer walking on them, and get a speed boost.", "committedDate": "2020-06-16T16:22:30Z", "type": "commit"}, {"oid": "ab954ecc730e444df29f5047f4dc38f4f1aea9a6", "url": "https://github.com/ldtteam/minecolonies/commit/ab954ecc730e444df29f5047f4dc38f4f1aea9a6", "message": "add a Tag based request (#5185)\n\nthis PR adds a Tag based request as proposed by @Raycoms in #5127", "committedDate": "2020-06-16T16:22:30Z", "type": "commit"}, {"oid": "c1cd04ea5b101434a1c0e1d210e32fe1c4acbe89", "url": "https://github.com/ldtteam/minecolonies/commit/c1cd04ea5b101434a1c0e1d210e32fe1c4acbe89", "message": "implement beekeeper ai\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-16T16:36:25Z", "type": "commit"}, {"oid": "ef23d1025eb997f4894c5b4b45bce7ef182d68e5", "url": "https://github.com/ldtteam/minecolonies/commit/ef23d1025eb997f4894c5b4b45bce7ef182d68e5", "message": "transition to tag requests\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-16T16:38:18Z", "type": "commit"}, {"oid": "8b66e3056b88f7fb3a0e2fd95617a213dd2e0290", "url": "https://github.com/ldtteam/minecolonies/commit/8b66e3056b88f7fb3a0e2fd95617a213dd2e0290", "message": "implement skill based features\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-16T16:38:20Z", "type": "commit"}, {"oid": "d4f58fc9fbf9c714e3db9f5d44142258da2934b5", "url": "https://github.com/ldtteam/minecolonies/commit/d4f58fc9fbf9c714e3db9f5d44142258da2934b5", "message": "add EntityAIWorkBeekeeper jdoc\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-16T16:44:15Z", "type": "commit"}, {"oid": "cf28a4d9b727d033231515d2ee7a2a2e8cdddd73", "url": "https://github.com/ldtteam/minecolonies/commit/cf28a4d9b727d033231515d2ee7a2a2e8cdddd73", "message": "Merge remote-tracking branch 'upstream/version/1.15' into feature/beekeeper\n\n# Conflicts:\n#\tbuild.properties\n#\tsrc/api/java/com/minecolonies/api/blocks/ModBlocks.java\n#\tsrc/api/java/com/minecolonies/api/colony/buildings/ModBuildings.java\n#\tsrc/api/java/com/minecolonies/api/colony/jobs/ModJobs.java\n#\tsrc/api/java/com/minecolonies/api/util/constant/NbtTagConstants.java\n#\tsrc/main/generated/resources/assets/minecolonies/sounds.json\n#\tsrc/main/java/com/minecolonies/apiimp/initializer/ModBlocksInitializer.java\n#\tsrc/main/java/com/minecolonies/apiimp/initializer/ModBuildingsInitializer.java\n#\tsrc/main/java/com/minecolonies/apiimp/initializer/ModJobsInitializer.java\n#\tsrc/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingCrafter.java\n#\tsrc/main/resources/META-INF/mods.toml\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/archery2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/archery3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/archery4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/archery5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/baker1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/baker2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/baker3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/baker4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/baker5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/barracks1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/barracks2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/barracks3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/barracks4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/barracks5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/barrackstower3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/blacksmith1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/blacksmith2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/blacksmith3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/blacksmith4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/blacksmith5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/builder1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/builder2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/builder3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/builder4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/builder5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/chickenherder1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/chickenherder2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/chickenherder3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/chickenherder4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/chickenherder5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/citizen1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/citizen2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/citizen3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/citizen4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/citizen5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/composter1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/composter2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/composter3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/composter4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/cook1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/cook2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/cook3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/cook4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/cook5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/cowboy1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/cowboy2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/cowboy3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/cowboy4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/cowboy5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/crusher1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/crusher2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/crusher3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/crusher4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/deliveryman1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/deliveryman2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/deliveryman3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/deliveryman4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/deliveryman5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/dyer1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/dyer2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/dyer3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/enchanter1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/enchanter2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/enchanter3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/enchanter4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/enchanter5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/farmer1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/farmer2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/farmer3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/farmer4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/farmer5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/fisherman1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/fisherman2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/fisherman3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/fisherman4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/fisherman5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/fletcher1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/fletcher2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/fletcher3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/florist1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/florist2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/florist3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/florist4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/florist5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/glassblower1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/glassblower4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/guardtower1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/guardtower2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/guardtower3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/guardtower4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/guardtower5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/hospital1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/hospital2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/library1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/library2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/library4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/library5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/lumberjack1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/lumberjack2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/lumberjack3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/lumberjack4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/mechanic1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/mechanic2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/mechanic5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/miner1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/miner2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/miner3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/miner4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/miner5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/plantation1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/plantation2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/plantation3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/plantation4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/plantation5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/sawmill1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/sawmill2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/sawmill3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/sawmill4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/sawmill5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/school2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/school3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/shepherd1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/shepherd2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/shepherd3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/sifter1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/sifter2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/sifter3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/sifter4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/smeltery2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/smeltery3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/smeltery4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/smeltery5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/stonemason1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/stonemason5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/stonesmeltery1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/stonesmeltery2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/stonesmeltery3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/stonesmeltery4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/swineherder1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/swineherder2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/tavern1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/tavern2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/tavern3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/university1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/university2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/university3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/university4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/university5.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/warehouse1.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/warehouse2.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/warehouse3.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/warehouse4.blueprint\n#\tsrc/main/resources/assets/minecolonies/schematics/wooden/warehouse5.blueprint\n#\tsrc/main/resources/assets/minecolonies/textures/entity/citizen/default/citizenmale1_a.png\n#\tsrc/main/resources/assets/minecolonies/textures/entity/citizen/default/citizenmale1_b.png\n#\tsrc/main/resources/assets/minecolonies/textures/entity/citizen/default/citizenmale1_d.png", "committedDate": "2020-06-21T11:29:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIxMDYxNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r443210617", "bodyText": "you should be able to simplify this one here now.", "author": "Raycoms", "createdAt": "2020-06-21T11:36:08Z", "path": "src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAIBasic.java", "diffHunk": "@@ -1505,6 +1507,39 @@ public boolean checkIfRequestForItemExistOrCreateAsynch(@NotNull final ItemStack\n         return false;\n     }\n \n+    /**\n+     * Check if a tag has been requested already or is in the inventory. If not in the inventory and not requested already, create request\n+     *\n+     * @param tag the requested tag.\n+     * @return true if in the inventory, else false.\n+     */\n+    public boolean checkIfRequestForTagExistOrCreateAsynch(@NotNull final Tag<Item> tag, final int count)", "originalCommit": "cf28a4d9b727d033231515d2ee7a2a2e8cdddd73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIxNTg4MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r443215881", "bodyText": "it already is", "author": "Minecraftschurli", "createdAt": "2020-06-21T12:41:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIxMDYxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIxMDg3MA==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r443210870", "bodyText": "= ?", "author": "Raycoms", "createdAt": "2020-06-21T11:39:27Z", "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/beekeeper/EntityAIWorkBeekeeper.java", "diffHunk": "@@ -0,0 +1,496 @@\n+package com.minecolonies.coremod.entity.ai.citizen.beekeeper;\n+\n+import com.minecolonies.api.entity.ai.statemachine.AITarget;\n+import com.minecolonies.api.entity.ai.statemachine.states.IAIState;\n+import com.minecolonies.api.util.InventoryUtils;\n+import com.minecolonies.api.util.ItemStackUtils;\n+import com.minecolonies.api.util.constant.ToolType;\n+import com.minecolonies.api.util.constant.TranslationConstants;\n+import com.minecolonies.coremod.colony.buildings.workerbuildings.BuildingBeekeeper;\n+import com.minecolonies.coremod.colony.jobs.JobBeekeeper;\n+import com.minecolonies.coremod.entity.ai.basic.AbstractEntityAIInteract;\n+import net.minecraft.entity.Entity;\n+import net.minecraft.entity.passive.AnimalEntity;\n+import net.minecraft.entity.passive.BeeEntity;\n+import net.minecraft.item.Item;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.item.Items;\n+import net.minecraft.state.properties.BlockStateProperties;\n+import net.minecraft.tags.ItemTags;\n+import net.minecraft.tileentity.BeehiveTileEntity;\n+import net.minecraft.util.Hand;\n+import net.minecraft.util.math.AxisAlignedBB;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.util.text.TranslationTextComponent;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.*;\n+import java.util.stream.Collectors;\n+\n+import static com.minecolonies.api.entity.ai.statemachine.states.AIWorkerState.*;\n+import static com.minecolonies.api.util.constant.Constants.TICKS_SECOND;\n+import static com.minecolonies.api.util.constant.ToolLevelConstants.TOOL_LEVEL_WOOD_OR_GOLD;\n+import static com.minecolonies.api.util.constant.TranslationConstants.COM_MINECOLONIES_COREMOD_STATUS_BEEKEEPER_HARVESTING;\n+\n+/**\n+ * Beekeeper AI class.\n+ */\n+public class EntityAIWorkBeekeeper extends AbstractEntityAIInteract<JobBeekeeper, BuildingBeekeeper>\n+{\n+    /**\n+     * Amount of animals needed to bread.\n+     */\n+    private static final int NUM_OF_ANIMALS_TO_BREED = 2;\n+    private static final int BEES_PER_LEVEL          = 3;\n+\n+    /**\n+     * Experience given per beehive harvested.\n+     */\n+    private static final double EXP_PER_HARVEST = 5.0;\n+\n+    /**\n+     * Distance two animals need to be inside to breed.\n+     */\n+    private static final int DISTANCE_TO_BREED = 10;\n+\n+    /**\n+     * Distance around a hive wher bees wander.\n+     */\n+    private static final int HIVE_BEE_RADIUS = 22;\n+\n+    /**\n+     * Delays used to setDelay()\n+     */\n+    private static final int DECIDING_DELAY   = 40;\n+    private static final int NO_ANIMALS_DELAY = 100;\n+    private static final int BREEDING_DELAY   = 40;\n+\n+    /**\n+     * Creates the abstract part of the AI. Always use this constructor!\n+     *\n+     * @param job the job to fulfill\n+     */\n+    public EntityAIWorkBeekeeper(@NotNull JobBeekeeper job)\n+    {\n+        super(job);\n+        super.registerTargets(\n+          new AITarget(IDLE, START_WORKING, 1),\n+          new AITarget(START_WORKING, this::startWorkingAtOwnBuilding, TICKS_SECOND),\n+          new AITarget(PREPARING, this::prepareForHerding, 1),\n+          new AITarget(DECIDE, this::decideWhatToDo, 1),\n+          new AITarget(HERDER_BREED, this::breedAnimals, 1),\n+          new AITarget(BEEKEEPER_HARVEST, this::harvestHoney, TICKS_SECOND)\n+        );\n+    }\n+\n+    /**\n+     * Checks the beehives/beenests and their surroundings if the maximum number of bees is reached\n+     *\n+     * @param allBees all bees in the area around the beehives/beenests\n+     * @return true if the maximum nuber of bees is reached els false\n+     */\n+    private boolean hasMaxAnimals(final List<BeeEntity> allBees)\n+    {\n+        if (getOwnBuilding() != null)\n+        {\n+            final int numOfBeesInHive = getOwnBuilding()\n+                                          .getHives()\n+                                          .stream()\n+                                          .map(world::getTileEntity)\n+                                          .filter(Objects::nonNull)\n+                                          .map(BeehiveTileEntity.class::cast)\n+                                          .mapToInt(BeehiveTileEntity::getBeeCount)\n+                                          .sum();\n+            final int numOfAnimals = allBees.size();\n+            final int maxAnimals = getOwnBuilding().getBuildingLevel() * BEES_PER_LEVEL;\n+\n+            return (numOfAnimals + numOfBeesInHive) > maxAnimals;", "originalCommit": "cf28a4d9b727d033231515d2ee7a2a2e8cdddd73", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIxOTM0MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r443219341", "bodyText": "You can here filter it by TagRequest instead of Deliverable already, that's what I meant", "author": "Raycoms", "createdAt": "2020-06-21T13:25:40Z", "path": "src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAIBasic.java", "diffHunk": "@@ -1505,6 +1507,39 @@ public boolean checkIfRequestForItemExistOrCreateAsynch(@NotNull final ItemStack\n         return false;\n     }\n \n+    /**\n+     * Check if a tag has been requested already or is in the inventory. If not in the inventory and not requested already, create request\n+     *\n+     * @param tag the requested tag.\n+     * @return true if in the inventory, else false.\n+     */\n+    public boolean checkIfRequestForTagExistOrCreateAsynch(@NotNull final Tag<Item> tag, final int count)\n+    {\n+        if (InventoryUtils.hasItemInItemHandler(worker.getInventoryCitizen(), stack -> stack.getItem().isIn(tag) && stack.getCount() >= count))\n+        {\n+            return true;\n+        }\n+\n+        if (InventoryUtils.getItemCountInProvider(getOwnBuilding(),\n+          itemStack -> itemStack.getItem().isIn(tag)) >= count &&\n+              InventoryUtils.transferXOfFirstSlotInProviderWithIntoNextFreeSlotInItemHandler(\n+                getOwnBuilding(), itemStack -> itemStack.getItem().isIn(tag),\n+                        count,\n+                        worker.getInventoryCitizen()))\n+        {\n+            return true;\n+        }\n+\n+        if (getOwnBuilding().getOpenRequestsOfTypeFiltered(worker.getCitizenData(), TypeConstants.DELIVERABLE,", "originalCommit": "cf28a4d9b727d033231515d2ee7a2a2e8cdddd73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIxOTkxNQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r443219915", "bodyText": "So I should create a new entry in TypeConstants", "author": "Minecraftschurli", "createdAt": "2020-06-21T13:33:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIxOTM0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyMDYzOQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r443220639", "bodyText": "yes", "author": "Raycoms", "createdAt": "2020-06-21T13:41:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIxOTM0MQ=="}], "type": "inlineReview"}, {"oid": "4c4bea2ac5db36d8dfe7020066cc6d7530d64a4d", "url": "https://github.com/ldtteam/minecolonies/commit/4c4bea2ac5db36d8dfe7020066cc6d7530d64a4d", "message": "implement changes requested by @Raycoms\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-21T13:46:45Z", "type": "commit"}, {"oid": "5589914b0726f2213db3d8d8ea4e5cb078f6325d", "url": "https://github.com/ldtteam/minecolonies/commit/5589914b0726f2213db3d8d8ea4e5cb078f6325d", "message": "add interaction if the beekeeper has no bees as suggested by @Raycoms\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-21T14:47:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NjQ2Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r443246467", "bodyText": "simplify this to a getHives().isEmpty() on the building, that way you don't use expensive area checks or accidentally load chunks. Let the AI do the checking", "author": "someaddons", "createdAt": "2020-06-21T18:51:50Z", "path": "src/main/java/com/minecolonies/apiimp/initializer/InteractionValidatorInitializer.java", "diffHunk": "@@ -177,6 +180,18 @@ public static void init()\n         InteractionValidatorRegistry.registerStandardPredicate(new TranslationTextComponent(BAKER_HAS_NO_FURNACES_MESSAGE),\n           citizen -> citizen.getWorkBuilding() instanceof BuildingBaker && ((BuildingBaker) citizen.getWorkBuilding()).getFurnaces().isEmpty());\n \n+        InteractionValidatorRegistry.registerStandardPredicate(new TranslationTextComponent(NO_BEES),\n+          citizen -> citizen.getWorkBuilding() instanceof BuildingBeekeeper &&\n+                       EntityAIWorkBeekeeper.searchForAnimals(citizen.getColony().getWorld(), (BuildingBeekeeper) citizen.getWorkBuilding()).isEmpty() &&", "originalCommit": "5589914b0726f2213db3d8d8ea4e5cb078f6325d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0Nzg0MA==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r443247840", "bodyText": "well but then the interaction doesn't check the bees outside the hive", "author": "Minecraftschurli", "createdAt": "2020-06-21T19:06:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NjQ2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0ODEwMg==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r443248102", "bodyText": "isnt that fine? like do there have to be bees outside", "author": "someaddons", "createdAt": "2020-06-21T19:10:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NjQ2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0ODI1Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r443248256", "bodyText": "well this is to tell the player that the beekeeper has no bees but if there are bees around the hive they are there so players would see it as a bug", "author": "Minecraftschurli", "createdAt": "2020-06-21T19:12:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NjQ2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0ODU5Mw==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r443248593", "bodyText": "doesnt this also happen when the bee's happen to be inside the hives?", "author": "someaddons", "createdAt": "2020-06-21T19:16:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NjQ2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0OTIwMA==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r443249200", "bodyText": "no that's what the other part is for\n((BuildingBeekeeper) citizen.getWorkBuilding())\n                         .getHives()\n                         .stream()\n                         .map(citizen.getColony().getWorld()::getTileEntity)\n                         .filter(tileEntity -> tileEntity instanceof BeehiveTileEntity)\n                         .map(tileEntity -> (BeehiveTileEntity) tileEntity)\n                         .mapToInt(BeehiveTileEntity::getBeeCount)\n                         .sum() <= 0)", "author": "Minecraftschurli", "createdAt": "2020-06-21T19:24:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NjQ2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0OTc3MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r443249771", "bodyText": "only the hives is fine. About the bees the players can't do anything what matters is if there are no hives marked with the tool", "author": "Raycoms", "createdAt": "2020-06-21T19:32:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NjQ2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI1MDEzNQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5127#discussion_r443250135", "bodyText": "ok so change it from being no bees to no hives", "author": "Minecraftschurli", "createdAt": "2020-06-21T19:35:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NjQ2Nw=="}], "type": "inlineReview"}, {"oid": "f823b9ed7cbc840e90fbc20749d1d64c9050c8ff", "url": "https://github.com/ldtteam/minecolonies/commit/f823b9ed7cbc840e90fbc20749d1d64c9050c8ff", "message": "split interaction for the beekeeper into has no bees and has no hives\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-21T20:39:56Z", "type": "commit"}, {"oid": "e61f1554ce697940c5ec6954727f1b99c73243d9", "url": "https://github.com/ldtteam/minecolonies/commit/e61f1554ce697940c5ec6954727f1b99c73243d9", "message": "add jdoc\n\nSigned-off-by: Minecraftschurli <minecraftschurli@gmail.com>", "committedDate": "2020-06-21T21:47:20Z", "type": "commit"}, {"oid": "a2c7c2500964d7ee119f008a9968e87ce47fdbf7", "url": "https://github.com/ldtteam/minecolonies/commit/a2c7c2500964d7ee119f008a9968e87ce47fdbf7", "message": "Merge remote-tracking branch 'upstream/version/1.15' into feature/beekeeper\n\n# Conflicts:\n#\tsrc/api/java/com/minecolonies/api/util/constant/TranslationConstants.java", "committedDate": "2020-06-22T11:21:42Z", "type": "commit"}]}