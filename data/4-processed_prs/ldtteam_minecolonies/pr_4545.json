{"pr_number": 4545, "pr_title": "Stash #2121", "pr_createdAt": "2020-04-01T00:45:37Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/4545", "timeline": [{"oid": "135da011e962de18864533903ca9bff9b1d92186", "url": "https://github.com/ldtteam/minecolonies/commit/135da011e962de18864533903ca9bff9b1d92186", "message": "Stash is added\n\nThis commit contains the logic behind the worker hut, the block and the TileEntity.\nI've created a TileEntity as I've found no pratical way to change the `inventory` from `AbstractTileEntityRack` for all instances of Stash. This obviously can be changed if a better way comes up. For now, it's a protected field and has no way to be re-assigned, so this is what I came up.", "committedDate": "2020-04-01T00:21:31Z", "type": "commit"}, {"oid": "28a2bcf420223470a9be595ed4bc0f976152f6dd", "url": "https://github.com/ldtteam/minecolonies/commit/28a2bcf420223470a9be595ed4bc0f976152f6dd", "message": "GUI Work is totally temporary\n\nThe GUI is totally temporary for now, I just copied from other buildings. Also, I only managed to set the correct values when opened by using the `onOpened` event method, although it's not used anywhere else.", "committedDate": "2020-04-01T00:23:15Z", "type": "commit"}, {"oid": "f3a776b039f7a8085876ba0844548da73f739ebf", "url": "https://github.com/ldtteam/minecolonies/commit/f3a776b039f7a8085876ba0844548da73f739ebf", "message": "Texture and Model are temporary\n\nI've just copied the PostBox for now, as I don't have a model for it yet.", "committedDate": "2020-04-01T00:24:29Z", "type": "commit"}, {"oid": "ab602811ddcac95728b80e52eb53b390c3f77d11", "url": "https://github.com/ldtteam/minecolonies/commit/ab602811ddcac95728b80e52eb53b390c3f77d11", "message": "Recipe is temporary as well\n\nI thought of making it a double chest worth actually, but prolly 27 slots fits better the style.", "committedDate": "2020-04-01T00:25:51Z", "type": "commit"}, {"oid": "116b9bd6a88226b5b848ef96ef3a815bcca4dc49", "url": "https://github.com/ldtteam/minecolonies/commit/116b9bd6a88226b5b848ef96ef3a815bcca4dc49", "message": "Changes to existing files to support the Stash\n\nRegistering the Block, as well as the Stash Building, the GUI element and the TileEntity, as well as allowing to change priority on the Network messages.\nAlso, no lang files were edited, and the GUI needs a proper translation for Stash", "committedDate": "2020-04-01T00:28:08Z", "type": "commit"}, {"oid": "d51891eba358978a41ced90ec23453bcdc6b4d51", "url": "https://github.com/ldtteam/minecolonies/commit/d51891eba358978a41ced90ec23453bcdc6b4d51", "message": "Typo on my part\n\nWas just testing stuff", "committedDate": "2020-04-01T01:55:28Z", "type": "commit"}, {"oid": "91a6de4b790e8f62b1a554cc6096fb7b9c315880", "url": "https://github.com/ldtteam/minecolonies/commit/91a6de4b790e8f62b1a554cc6096fb7b9c315880", "message": "Merge branch 'version/1.15' into version/1.15", "committedDate": "2020-04-01T07:34:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTQxMjEzMg==", "url": "https://github.com/ldtteam/minecolonies/pull/4545#discussion_r401412132", "bodyText": "Can you format those to our code style and add javadoc?", "author": "Raycoms", "createdAt": "2020-04-01T07:36:19Z", "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityStash.java", "diffHunk": "@@ -0,0 +1,61 @@\n+package com.minecolonies.api.tileentities;\n+\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import com.minecolonies.api.colony.buildings.IBuildingContainer;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.tileentity.TileEntityType;\n+import org.jetbrains.annotations.NotNull;\n+\n+import javax.annotation.Nonnull;\n+\n+import static com.minecolonies.api.util.constant.BuildingConstants.MAX_PRIO;\n+import static com.minecolonies.api.util.constant.Constants.DEFAULT_SIZE;\n+\n+/**\n+ * Class which handles the tileEntity of our colonyBuildings.\n+ */\n+\n+public class TileEntityStash extends TileEntityColonyBuilding\n+{\n+\n+    public TileEntityStash(final TileEntityType type)\n+    {\n+        super(type);\n+        inventory = new NotifyingRackInventory(DEFAULT_SIZE);\n+    }\n+\n+    public TileEntityStash()\n+    {\n+        super(MinecoloniesTileEntities.STASH);\n+        inventory = new NotifyingRackInventory(DEFAULT_SIZE);\n+    }\n+\n+    private void buildingInventoryChanged(boolean isEmpty) {", "originalCommit": "91a6de4b790e8f62b1a554cc6096fb7b9c315880", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTQxMzA4NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/4545#discussion_r401413085", "bodyText": "I would probably not have it have a GUI at all. Only the inventory GUI should be enough.", "author": "Raycoms", "createdAt": "2020-04-01T07:37:57Z", "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowStash.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package com.minecolonies.coremod.client.gui;\n+\n+import com.ldtteam.blockout.Pane;\n+import com.ldtteam.blockout.controls.*;\n+import com.ldtteam.blockout.views.ScrollingList;\n+import com.ldtteam.structurize.util.LanguageHandler;\n+import com.minecolonies.api.colony.IColonyManager;\n+import com.minecolonies.api.util.Log;\n+import com.minecolonies.api.util.constant.Constants;\n+import com.minecolonies.coremod.Network;\n+import com.minecolonies.coremod.colony.buildings.views.AbstractBuildingView;\n+import com.minecolonies.coremod.network.messages.ChangeDeliveryPriorityMessage;\n+import com.minecolonies.coremod.network.messages.ChangeDeliveryPriorityStateMessage;\n+import com.minecolonies.coremod.network.messages.OpenInventoryMessage;\n+import com.minecolonies.coremod.network.messages.PostBoxRequestMessage;\n+import net.minecraft.item.ItemStack;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.function.Predicate;\n+import java.util.stream.Collectors;\n+\n+import static com.minecolonies.api.util.constant.WindowConstants.*;\n+\n+/**\n+ * Window for the replace block GUI.\n+ */\n+public class WindowStash extends AbstractWindowSkeleton implements ButtonHandler", "originalCommit": "91a6de4b790e8f62b1a554cc6096fb7b9c315880", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d44739d6cfd1b99227740e8ab9a0eb3a3512cb34", "url": "https://github.com/ldtteam/minecolonies/commit/d44739d6cfd1b99227740e8ab9a0eb3a3512cb34", "message": "New model\n\nDerived from PostBox. I thought it would be better than to just re-use the same model", "committedDate": "2020-04-01T18:03:32Z", "type": "commit"}, {"oid": "17a6d76582a9c32580236cdc322977c34851f130", "url": "https://github.com/ldtteam/minecolonies/commit/17a6d76582a9c32580236cdc322977c34851f130", "message": "Removed the GUI\n\nIt only uses empty files to go around the checks from Validate.notNull, thus using a dummy empty view.", "committedDate": "2020-04-01T18:06:10Z", "type": "commit"}, {"oid": "e3cd258fc61fedbd16856cef861c373b134f4478", "url": "https://github.com/ldtteam/minecolonies/commit/e3cd258fc61fedbd16856cef861c373b134f4478", "message": "Update on block model's bounding box\n\nDefault 1 block size instead of a custom size.", "committedDate": "2020-04-01T18:07:06Z", "type": "commit"}, {"oid": "2b59569270880135c29c9c61dc6d7d0c223e2d8b", "url": "https://github.com/ldtteam/minecolonies/commit/2b59569270880135c29c9c61dc6d7d0c223e2d8b", "message": "Updated the logic to let the DeliveryMan reset the priority", "committedDate": "2020-04-01T18:07:21Z", "type": "commit"}, {"oid": "e08ce9a979c00b00a986c7131b03a8e02c26d1a2", "url": "https://github.com/ldtteam/minecolonies/commit/e08ce9a979c00b00a986c7131b03a8e02c26d1a2", "message": "Added the Stash to the ignore along with PostBox\n\nBut it's still not working when placing.", "committedDate": "2020-04-01T18:07:46Z", "type": "commit"}, {"oid": "e1191f57952a69839d70b23b535ed95209ef3e20", "url": "https://github.com/ldtteam/minecolonies/commit/e1191f57952a69839d70b23b535ed95209ef3e20", "message": "Merge branch 'version/1.15' of https://github.com/Shirkit/minecolonies into version/1.15", "committedDate": "2020-04-01T18:08:00Z", "type": "commit"}, {"oid": "d80ee97964c1ec384f2bbb192321340a86fad404", "url": "https://github.com/ldtteam/minecolonies/commit/d80ee97964c1ec384f2bbb192321340a86fad404", "message": "Javadocs", "committedDate": "2020-04-01T18:15:55Z", "type": "commit"}, {"oid": "6d55ecfc38a9d026c0b087d5a50b1c8d7bced84a", "url": "https://github.com/ldtteam/minecolonies/commit/6d55ecfc38a9d026c0b087d5a50b1c8d7bced84a", "message": "Formatting using CheckStyle plugin", "committedDate": "2020-04-01T18:24:02Z", "type": "commit"}, {"oid": "ae51b206bb4ac73b272b8bffa4a363b2a1599547", "url": "https://github.com/ldtteam/minecolonies/commit/ae51b206bb4ac73b272b8bffa4a363b2a1599547", "message": "Merge branch 'version/1.15' into version/1.15", "committedDate": "2020-04-01T18:27:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg0MTg5Mw==", "url": "https://github.com/ldtteam/minecolonies/pull/4545#discussion_r401841893", "bodyText": "else on other line", "author": "Raycoms", "createdAt": "2020-04-01T19:01:38Z", "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityStash.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package com.minecolonies.api.tileentities;\n+\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import com.minecolonies.api.colony.buildings.IBuildingContainer;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.tileentity.TileEntityType;\n+import org.jetbrains.annotations.NotNull;\n+\n+import javax.annotation.Nonnull;\n+\n+import static com.minecolonies.api.util.constant.BuildingConstants.MAX_PRIO;\n+import static com.minecolonies.api.util.constant.Constants.DEFAULT_SIZE;\n+\n+/**\n+ * Class which handles the tileEntity for the Stash block.\n+ */\n+\n+public class TileEntityStash extends TileEntityColonyBuilding\n+{\n+\n+    public TileEntityStash(final TileEntityType type)\n+    {\n+        super(type);\n+        inventory = new NotifyingRackInventory(DEFAULT_SIZE);\n+    }\n+\n+    public TileEntityStash()\n+    {\n+        super(MinecoloniesTileEntities.STASH);\n+        inventory = new NotifyingRackInventory(DEFAULT_SIZE);\n+    }\n+\n+    /**\n+     * Called when the inventory of the tileEntity it holds it's changed\n+     *\n+     * @param isEmpty\n+     */\n+    private void buildingInventoryChanged(boolean isEmpty)\n+    {\n+        IBuildingContainer building = getBuilding();\n+        if (!isEmpty && building != null && !building.isPriorityStatic())\n+        {\n+            if (building instanceof IBuilding)\n+            {\n+                IBuilding iBuilding = (IBuilding) building;\n+                if (!iBuilding.isBeingGathered())\n+                {\n+                    iBuilding.alterPickUpPriority(MAX_PRIO);\n+                }\n+            } else", "originalCommit": "ae51b206bb4ac73b272b8bffa4a363b2a1599547", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg1MjQ4MA==", "url": "https://github.com/ldtteam/minecolonies/pull/4545#discussion_r401852480", "bodyText": "Sorry, I thought I had the auto-formatter fixed this. I'm fixing this manually.", "author": "Shirkit", "createdAt": "2020-04-01T19:20:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg0MTg5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg0MjI0Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/4545#discussion_r401842246", "bodyText": "why do we need a different handling for IBuilding here? isn't it always an IBuilding or never?", "author": "Raycoms", "createdAt": "2020-04-01T19:02:15Z", "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityStash.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package com.minecolonies.api.tileentities;\n+\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import com.minecolonies.api.colony.buildings.IBuildingContainer;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.tileentity.TileEntityType;\n+import org.jetbrains.annotations.NotNull;\n+\n+import javax.annotation.Nonnull;\n+\n+import static com.minecolonies.api.util.constant.BuildingConstants.MAX_PRIO;\n+import static com.minecolonies.api.util.constant.Constants.DEFAULT_SIZE;\n+\n+/**\n+ * Class which handles the tileEntity for the Stash block.\n+ */\n+\n+public class TileEntityStash extends TileEntityColonyBuilding\n+{\n+\n+    public TileEntityStash(final TileEntityType type)\n+    {\n+        super(type);\n+        inventory = new NotifyingRackInventory(DEFAULT_SIZE);\n+    }\n+\n+    public TileEntityStash()\n+    {\n+        super(MinecoloniesTileEntities.STASH);\n+        inventory = new NotifyingRackInventory(DEFAULT_SIZE);\n+    }\n+\n+    /**\n+     * Called when the inventory of the tileEntity it holds it's changed\n+     *\n+     * @param isEmpty\n+     */\n+    private void buildingInventoryChanged(boolean isEmpty)\n+    {\n+        IBuildingContainer building = getBuilding();\n+        if (!isEmpty && building != null && !building.isPriorityStatic())\n+        {\n+            if (building instanceof IBuilding)", "originalCommit": "ae51b206bb4ac73b272b8bffa4a363b2a1599547", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg1MzY3MA==", "url": "https://github.com/ldtteam/minecolonies/pull/4545#discussion_r401853670", "bodyText": "It should be always an instance of IBuilding, but as so far as I've looked, I haven't read the full project to see if it could be reset somehow, that's why I left the check there. Removing it.", "author": "Shirkit", "createdAt": "2020-04-01T19:23:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg0MjI0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg1OTIxNw==", "url": "https://github.com/ldtteam/minecolonies/pull/4545#discussion_r401859217", "bodyText": "To be fair, I would replace the building != null check with that instanceof check.", "author": "Raycoms", "createdAt": "2020-04-01T19:32:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg0MjI0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg0NDM0Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/4545#discussion_r401844347", "bodyText": "I know this is a bit out of the scope of this PR. But maybe you're up to it. Maybe it makes sense to extract what Stash and PostBox need from AbstractBuilding into a separate abstract super class and have Stash and PostBox extend those.\nSo that we don't need the \"!(building instanceof PostBox) && !(building instanceof Stash)\" checks in a row, that might be cleaner.\nOr at least an IRSComponent interface that both Stash and PostBox implement and we check only if !instanceof IRSComponent", "author": "Raycoms", "createdAt": "2020-04-01T19:06:02Z", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/workerbuildings/Stash.java", "diffHunk": "@@ -0,0 +1,61 @@\n+package com.minecolonies.coremod.colony.buildings.workerbuildings;\n+\n+import com.google.common.collect.ImmutableCollection;\n+import com.google.common.collect.ImmutableList;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.IColonyView;\n+import com.minecolonies.api.colony.buildings.ModBuildings;\n+import com.minecolonies.api.colony.buildings.registry.BuildingEntry;\n+import com.minecolonies.api.colony.requestsystem.resolver.IRequestResolver;\n+import com.minecolonies.coremod.colony.buildings.AbstractBuilding;\n+import com.minecolonies.coremod.colony.buildings.views.AbstractBuildingView;\n+import net.minecraft.util.math.BlockPos;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Class used to manage the stash building block.\n+ */\n+public class Stash extends AbstractBuilding\n+{", "originalCommit": "ae51b206bb4ac73b272b8bffa4a363b2a1599547", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg1ODIyOQ==", "url": "https://github.com/ldtteam/minecolonies/pull/4545#discussion_r401858229", "bodyText": "I thought about that as well, but I figured it was a bit out of scope of the PR. Also, it wouldn't need an extraction only from AbsctractBuilding, but the whole hierarchy, as there's a lot things there that isn't needed whatsoever. And I actually thought of, maybe, letting Stash and PostBox be also built along with an schematic? I think it's a whole project on it's on right there, and being new to the project (and to Minecraft modding), I'm not confident enough to pull drastic changes such as these.\nBut the idea of the interface is actually good. The IRSComponent you thought would be just an empty interface?", "author": "Shirkit", "createdAt": "2020-04-01T19:31:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg0NDM0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg1OTkyMg==", "url": "https://github.com/ldtteam/minecolonies/pull/4545#discussion_r401859922", "bodyText": "Yes, I agree. Yes it would just be an empty interface.", "author": "Raycoms", "createdAt": "2020-04-01T19:34:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg0NDM0Nw=="}], "type": "inlineReview"}, {"oid": "7df60a62957d84478000e62f9b822a8abcaf2713", "url": "https://github.com/ldtteam/minecolonies/commit/7df60a62957d84478000e62f9b822a8abcaf2713", "message": "Fixed model size while on inventory\n\nWas overflowing to next tile", "committedDate": "2020-04-01T19:17:35Z", "type": "commit"}, {"oid": "fc7e7ba2d1468fc8af75ec5c3c45a7b46aa8acad", "url": "https://github.com/ldtteam/minecolonies/commit/fc7e7ba2d1468fc8af75ec5c3c45a7b46aa8acad", "message": "Merge branch 'version/1.15' of https://github.com/Shirkit/minecolonies into version/1.15", "committedDate": "2020-04-01T19:17:47Z", "type": "commit"}, {"oid": "94d2371bc1c2402ff8886170e43cd395fa9818b5", "url": "https://github.com/ldtteam/minecolonies/commit/94d2371bc1c2402ff8886170e43cd395fa9818b5", "message": "It's always IBuilding, so we can cast directly\n\nAnd I always forget that we can cast null values without exceptions", "committedDate": "2020-04-01T19:26:39Z", "type": "commit"}, {"oid": "de73f8a1b4e46074fa4bb1f07dd45db121952b6f", "url": "https://github.com/ldtteam/minecolonies/commit/de73f8a1b4e46074fa4bb1f07dd45db121952b6f", "message": "Proper check and casting", "committedDate": "2020-04-01T19:37:13Z", "type": "commit"}, {"oid": "f1d3e94409e3c7203290dcadc92b98dc7d2ca230", "url": "https://github.com/ldtteam/minecolonies/commit/f1d3e94409e3c7203290dcadc92b98dc7d2ca230", "message": "Implemented IRSComponent", "committedDate": "2020-04-01T19:41:45Z", "type": "commit"}, {"oid": "2173866cc056b4edacedc2154749d77520af9f02", "url": "https://github.com/ldtteam/minecolonies/commit/2173866cc056b4edacedc2154749d77520af9f02", "message": "Added empty interface for non-schematic buildings", "committedDate": "2020-04-05T00:00:43Z", "type": "commit"}, {"oid": "66ff02617eb833f86898e470853a0a1b5de1c02c", "url": "https://github.com/ldtteam/minecolonies/commit/66ff02617eb833f86898e470853a0a1b5de1c02c", "message": "Merge branch 'version/1.15' into version/1.15", "committedDate": "2020-04-05T08:35:20Z", "type": "commit"}, {"oid": "0f61be53727b39248a39ece0871e8f8d288f9a5f", "url": "https://github.com/ldtteam/minecolonies/commit/0f61be53727b39248a39ece0871e8f8d288f9a5f", "message": "Merge branch 'version/1.15' into version/1.15", "committedDate": "2020-04-07T14:36:58Z", "type": "commit"}]}