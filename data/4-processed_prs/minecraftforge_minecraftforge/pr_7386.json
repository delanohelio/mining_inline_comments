{"pr_number": 7386, "pr_title": "Implement LivingConversionEvent event", "pr_createdAt": "2020-10-02T10:28:15Z", "pr_url": "https://github.com/MinecraftForge/MinecraftForge/pull/7386", "timeline": [{"oid": "13a7dee3352d86d07aeee70cd29b52c4440733a4", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/13a7dee3352d86d07aeee70cd29b52c4440733a4", "message": "Implement LivingConversionEvent event", "committedDate": "2020-10-02T10:08:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc3NzM2Mw==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7386#discussion_r498777363", "bodyText": "The base event should not be cancelable. Only make the needed events cancelable.", "author": "ChampionAsh5357", "createdAt": "2020-10-02T11:59:18Z", "path": "src/main/java/net/minecraftforge/event/entity/living/LivingConversionEvent.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package net.minecraftforge.event.entity.living;\n+\n+import net.minecraft.entity.EntityType;\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraftforge.eventbus.api.Cancelable;\n+\n+/**\n+ * LivingConversionEvent is triggered when an entity is trying\n+ * to replace itself with other entity\n+ *\n+ * This event is {@link Cancelable}\n+ * If cancelled, the replacement will not occur\n+ */\n+@Cancelable", "originalCommit": "13a7dee3352d86d07aeee70cd29b52c4440733a4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc4MzkxOQ==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7386#discussion_r498783919", "bodyText": "None of these seem to do anything.", "author": "ChampionAsh5357", "createdAt": "2020-10-02T12:15:00Z", "path": "src/main/java/net/minecraftforge/event/entity/living/LivingConversionEvent.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package net.minecraftforge.event.entity.living;\n+\n+import net.minecraft.entity.EntityType;\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraftforge.eventbus.api.Cancelable;\n+\n+/**\n+ * LivingConversionEvent is triggered when an entity is trying\n+ * to replace itself with other entity\n+ *\n+ * This event is {@link Cancelable}\n+ * If cancelled, the replacement will not occur\n+ */\n+@Cancelable\n+public class LivingConversionEvent extends LivingEvent\n+{\n+    public LivingConversionEvent(LivingEntity entity)\n+    {\n+        super(entity);\n+    }\n+\n+    public static class Pre extends LivingConversionEvent\n+    {\n+        private EntityType<? extends LivingEntity> outcome;\n+\n+        public Pre(LivingEntity entity, EntityType<? extends LivingEntity> outcome)\n+        {\n+            super(entity);\n+            this.outcome = outcome;\n+        }\n+\n+        public EntityType<? extends LivingEntity> getOutcome()\n+        {\n+            return outcome;\n+        }\n+\n+        public void setOutcome(EntityType<? extends LivingEntity> outcome)\n+        {\n+            this.outcome = outcome;\n+        }", "originalCommit": "13a7dee3352d86d07aeee70cd29b52c4440733a4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc4NDE0NA==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7386#discussion_r498784144", "bodyText": "These also seem pointless.", "author": "ChampionAsh5357", "createdAt": "2020-10-02T12:15:26Z", "path": "src/main/java/net/minecraftforge/event/entity/living/LivingConversionEvent.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package net.minecraftforge.event.entity.living;\n+\n+import net.minecraft.entity.EntityType;\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraftforge.eventbus.api.Cancelable;\n+\n+/**\n+ * LivingConversionEvent is triggered when an entity is trying\n+ * to replace itself with other entity\n+ *\n+ * This event is {@link Cancelable}\n+ * If cancelled, the replacement will not occur\n+ */\n+@Cancelable\n+public class LivingConversionEvent extends LivingEvent\n+{\n+    public LivingConversionEvent(LivingEntity entity)\n+    {\n+        super(entity);\n+    }\n+\n+    public static class Pre extends LivingConversionEvent\n+    {\n+        private EntityType<? extends LivingEntity> outcome;\n+\n+        public Pre(LivingEntity entity, EntityType<? extends LivingEntity> outcome)\n+        {\n+            super(entity);\n+            this.outcome = outcome;\n+        }\n+\n+        public EntityType<? extends LivingEntity> getOutcome()\n+        {\n+            return outcome;\n+        }\n+\n+        public void setOutcome(EntityType<? extends LivingEntity> outcome)\n+        {\n+            this.outcome = outcome;\n+        }\n+    }\n+\n+    public static class Post extends LivingConversionEvent\n+    {\n+        private LivingEntity outcome;\n+\n+        public Post(LivingEntity entity, LivingEntity outcome)\n+        {\n+            super(entity);\n+            this.outcome = outcome;\n+        }\n+\n+        public LivingEntity getOutcome()\n+        {\n+            return outcome;\n+        }\n+\n+        public void setOutcome(LivingEntity outcome)\n+        {\n+            this.outcome = outcome;\n+        }", "originalCommit": "13a7dee3352d86d07aeee70cd29b52c4440733a4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc4NDk0NQ==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7386#discussion_r498784945", "bodyText": "Add Forge license for header.", "author": "ChampionAsh5357", "createdAt": "2020-10-02T12:17:16Z", "path": "src/main/java/net/minecraftforge/event/entity/living/LivingConversionEvent.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package net.minecraftforge.event.entity.living;", "originalCommit": "13a7dee3352d86d07aeee70cd29b52c4440733a4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc4NDk4NQ==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7386#discussion_r498784985", "bodyText": "Add Forge license for header.", "author": "ChampionAsh5357", "createdAt": "2020-10-02T12:17:20Z", "path": "src/test/java/net/minecraftforge/debug/entity/living/LivingConversionEventTest.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package net.minecraftforge.debug.entity.living;", "originalCommit": "13a7dee3352d86d07aeee70cd29b52c4440733a4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5c3c2fea6cecbcf9ea98e1092fb1319cae3c174a", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/5c3c2fea6cecbcf9ea98e1092fb1319cae3c174a", "message": "Added Forge licence, remove unused setters", "committedDate": "2020-10-03T03:05:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc4MjU4OA==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7386#discussion_r500782588", "bodyText": "Please add javadoc to this entry.", "author": "OrionDevelopment", "createdAt": "2020-10-07T07:05:46Z", "path": "src/main/java/net/minecraftforge/event/entity/living/LivingConversionEvent.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Minecraft Forge\n+ * Copyright (c) 2016-2020.\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.minecraftforge.event.entity.living;\n+\n+import net.minecraft.entity.EntityType;\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraftforge.eventbus.api.Cancelable;\n+\n+public class LivingConversionEvent extends LivingEvent\n+{\n+    public LivingConversionEvent(LivingEntity entity)\n+    {\n+        super(entity);\n+    }\n+\n+    /**\n+     * LivingConversionEvent.Pre is triggered when an entity is trying\n+     * to replace itself with another entity\n+     *\n+     * This event is {@link Cancelable}\n+     * If cancelled, the replacement will not occur\n+     */\n+    @Cancelable\n+    public static class Pre extends LivingConversionEvent\n+    {\n+        private final EntityType<? extends LivingEntity> outcome;\n+\n+        public Pre(LivingEntity entity, EntityType<? extends LivingEntity> outcome)\n+        {\n+            super(entity);\n+            this.outcome = outcome;\n+        }\n+\n+        public EntityType<? extends LivingEntity> getOutcome()", "originalCommit": "5c3c2fea6cecbcf9ea98e1092fb1319cae3c174a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc4MjY4OA==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7386#discussion_r500782688", "bodyText": "Please add javadoc to this entry.", "author": "OrionDevelopment", "createdAt": "2020-10-07T07:06:00Z", "path": "src/main/java/net/minecraftforge/event/entity/living/LivingConversionEvent.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Minecraft Forge\n+ * Copyright (c) 2016-2020.\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.minecraftforge.event.entity.living;\n+\n+import net.minecraft.entity.EntityType;\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraftforge.eventbus.api.Cancelable;\n+\n+public class LivingConversionEvent extends LivingEvent\n+{\n+    public LivingConversionEvent(LivingEntity entity)\n+    {\n+        super(entity);\n+    }\n+\n+    /**\n+     * LivingConversionEvent.Pre is triggered when an entity is trying\n+     * to replace itself with another entity\n+     *\n+     * This event is {@link Cancelable}\n+     * If cancelled, the replacement will not occur\n+     */\n+    @Cancelable\n+    public static class Pre extends LivingConversionEvent\n+    {\n+        private final EntityType<? extends LivingEntity> outcome;\n+\n+        public Pre(LivingEntity entity, EntityType<? extends LivingEntity> outcome)\n+        {\n+            super(entity);\n+            this.outcome = outcome;\n+        }\n+\n+        public EntityType<? extends LivingEntity> getOutcome()\n+        {\n+            return outcome;\n+        }\n+    }\n+\n+    /**\n+     * LivingConversionEvent.Post is triggered when an entity is replacing\n+     * itself with another entity\n+     */\n+    public static class Post extends LivingConversionEvent\n+    {\n+        private final LivingEntity outcome;\n+\n+        public Post(LivingEntity entity, LivingEntity outcome)\n+        {\n+            super(entity);\n+            this.outcome = outcome;\n+        }\n+\n+        public LivingEntity getOutcome()", "originalCommit": "5c3c2fea6cecbcf9ea98e1092fb1319cae3c174a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "31386332f96c9a97446662cfe0d312995c5656af", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/31386332f96c9a97446662cfe0d312995c5656af", "message": "Update the javadoc of getters", "committedDate": "2020-10-07T07:58:46Z", "type": "commit"}, {"oid": "b3e4c9fdbb0c622f342a7ba6d123af95ac16e15d", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/b3e4c9fdbb0c622f342a7ba6d123af95ac16e15d", "message": "Merge branch '1.16.x' into living-conversion-event", "committedDate": "2020-10-16T00:23:10Z", "type": "commit"}, {"oid": "13a25245d13b36ff3cf62f60d5aee9128c7641f0", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/13a25245d13b36ff3cf62f60d5aee9128c7641f0", "message": "Merge remote-tracking branch 'upstream/1.16.x' into living-conversion-event", "committedDate": "2020-11-10T21:23:04Z", "type": "commit"}, {"oid": "148a29cf19d0f0bc66efe9f42e6f19ad4de593a2", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/148a29cf19d0f0bc66efe9f42e6f19ad4de593a2", "message": "Added new conversion trigger\n\nVillager -> Witch", "committedDate": "2020-11-10T21:43:49Z", "type": "commit"}, {"oid": "917ab2a77cee0f8e63c52cbd4fc451bf3baf7cc3", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/917ab2a77cee0f8e63c52cbd4fc451bf3baf7cc3", "message": "Added new conversion trigger\n\nVillager -> Zombie Villager", "committedDate": "2020-11-10T21:52:51Z", "type": "commit"}, {"oid": "a8af7395212ebc11654b6519d983b73e12cdef57", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/a8af7395212ebc11654b6519d983b73e12cdef57", "message": "Added new conversion triggers\n\nPig -> Zombified Piglin", "committedDate": "2020-11-10T21:59:05Z", "type": "commit"}, {"oid": "fe7ea936f4db6fa015308948fcecec8d698f5ad2", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/fe7ea936f4db6fa015308948fcecec8d698f5ad2", "message": "Move post conversion of zombie from MobEntity to ZombieEntity", "committedDate": "2020-11-10T22:12:14Z", "type": "commit"}, {"oid": "2d7d6acfd2ec88e66e00685282a424cbec07fcfc", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/2d7d6acfd2ec88e66e00685282a424cbec07fcfc", "message": "Added new conversion trigger\n\nHoglin -> Zoglin", "committedDate": "2020-11-10T22:42:58Z", "type": "commit"}, {"oid": "18f4480e1b9330cfa2155e30f7ad0c3b7df9965b", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/18f4480e1b9330cfa2155e30f7ad0c3b7df9965b", "message": "Updated javadoc for entity timers", "committedDate": "2020-11-11T20:19:10Z", "type": "commit"}, {"oid": "c3e6eca051354f0f0533271e3058db80dacdd3d2", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/c3e6eca051354f0f0533271e3058db80dacdd3d2", "message": "Make it so it allows users to change the conversion timer", "committedDate": "2020-11-20T23:06:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg3OTcyMA==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7386#discussion_r536879720", "bodyText": "Something is broken here.. did you edit this file by hand? The field should of been mapped to the srg name. I mean.. it's fixed in the first part of the line, but the lamba is broken...", "author": "LexManos", "createdAt": "2020-12-05T19:39:51Z", "path": "patches/minecraft/net/minecraft/entity/monster/ZombieEntity.java.patch", "diffHunk": "@@ -1,23 +1,24 @@\n --- a/net/minecraft/entity/monster/ZombieEntity.java\n +++ b/net/minecraft/entity/monster/ZombieEntity.java\n-@@ -186,7 +186,7 @@\n+@@ -186,7 +186,8 @@\n        if (!this.field_70170_p.field_72995_K && this.func_70089_S() && !this.func_175446_cd()) {\n           if (this.func_204706_dD()) {\n              --this.field_204708_bE;\n -            if (this.field_204708_bE < 0) {\n-+            if (this.field_204708_bE < 0 && net.minecraftforge.event.ForgeEventFactory.canLivingConvert(this, EntityType.field_200725_aD)) {\n++\n++            if (this.field_204708_bE < 0 && net.minecraftforge.event.ForgeEventFactory.canLivingConvert(this, EntityType.field_200725_aD, (timer) -> this.drownedConversionTime = timer)) {", "originalCommit": "c3e6eca051354f0f0533271e3058db80dacdd3d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg4MDU0OQ==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7386#discussion_r536880549", "bodyText": "Same here...", "author": "LexManos", "createdAt": "2020-12-05T19:44:55Z", "path": "patches/minecraft/net/minecraft/entity/monster/ZombieVillagerEntity.java.patch", "diffHunk": "@@ -1,14 +1,15 @@\n --- a/net/minecraft/entity/monster/ZombieVillagerEntity.java\n +++ b/net/minecraft/entity/monster/ZombieVillagerEntity.java\n-@@ -117,6 +117,7 @@\n+@@ -116,7 +116,7 @@\n+       if (!this.field_70170_p.field_72995_K && this.func_70089_S() && this.func_82230_o()) {\n           int i = this.func_190735_dq();\n           this.field_82234_d -= i;\n-          if (this.field_82234_d <= 0) {\n-+            if (!net.minecraftforge.event.ForgeEventFactory.canLivingConvert(this, EntityType.field_200756_av)) return;\n+-         if (this.field_82234_d <= 0) {\n++         if (this.field_82234_d <= 0 && net.minecraftforge.event.ForgeEventFactory.canLivingConvert(this, EntityType.field_200756_av, (timer) -> this.conversionTime = timer)) {", "originalCommit": "c3e6eca051354f0f0533271e3058db80dacdd3d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg4MDU5Nw==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7386#discussion_r536880597", "bodyText": "This one obfed correctly", "author": "LexManos", "createdAt": "2020-12-05T19:45:10Z", "path": "patches/minecraft/net/minecraft/entity/monster/piglin/AbstractPiglinEntity.java.patch", "diffHunk": "@@ -1,14 +1,15 @@\n --- a/net/minecraft/entity/monster/piglin/AbstractPiglinEntity.java\n +++ b/net/minecraft/entity/monster/piglin/AbstractPiglinEntity.java\n-@@ -84,6 +84,7 @@\n+@@ -83,7 +83,7 @@\n+          this.field_242334_c = 0;\n        }\n  \n-       if (this.field_242334_c > 300) {\n-+         if (!net.minecraftforge.event.ForgeEventFactory.canLivingConvert(this, EntityType.field_233592_ba_)) return;\n+-      if (this.field_242334_c > 300) {\n++      if (this.field_242334_c > 300 && net.minecraftforge.event.ForgeEventFactory.canLivingConvert(this, EntityType.field_233592_ba_, (timer) -> this.field_242334_c = timer)) {\n           this.func_241848_eP();", "originalCommit": "c3e6eca051354f0f0533271e3058db80dacdd3d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "17fd9051ef3caee9ab53c7ce1e96baf21f912464", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/17fd9051ef3caee9ab53c7ce1e96baf21f912464", "message": "Fixed obfuscation issues", "committedDate": "2020-12-21T09:58:45Z", "type": "commit"}, {"oid": "511a53451bede0aef23575547bd285132b64164c", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/511a53451bede0aef23575547bd285132b64164c", "message": "Merge branch '1.16.x' into living-conversion-event", "committedDate": "2020-12-21T10:01:59Z", "type": "commit"}, {"oid": "ee97ec57269b7bee87e40764579315210019c0d8", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/ee97ec57269b7bee87e40764579315210019c0d8", "message": "Merge branch '1.16.x' into living-conversion-event", "committedDate": "2020-12-28T20:00:27Z", "type": "commit"}]}