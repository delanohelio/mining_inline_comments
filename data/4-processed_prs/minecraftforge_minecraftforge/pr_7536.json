{"pr_number": 7536, "pr_title": "Override invalidateCaps instead of remove for vanilla TE capability invalidation", "pr_createdAt": "2020-12-06T18:31:01Z", "pr_url": "https://github.com/MinecraftForge/MinecraftForge/pull/7536", "timeline": [{"oid": "f88738f9c23b09026a53d9f0039bda6aaf928c5a", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/f88738f9c23b09026a53d9f0039bda6aaf928c5a", "message": "Properly invalidate patched in vanilla TE caps in invalidateCaps instead of remove so that they get invalidated on chunk unload", "committedDate": "2020-12-06T18:27:56Z", "type": "commit"}, {"oid": "f8664903bfd96c2c32e6f91986e3dd6563412260", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/f8664903bfd96c2c32e6f91986e3dd6563412260", "message": "Fix access levels, and also switch entity capability invalidation over to using invalidateCaps as it is called at the correct time, and then if we ever add more places entities invalidate their caps in the future they will properly get called and not be forgotten", "committedDate": "2020-12-06T18:59:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY3ODIyNA==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7536#discussion_r537678224", "bodyText": "Why was the keepData check removed here?", "author": "OrionDevelopment", "createdAt": "2020-12-07T17:12:40Z", "path": "patches/minecraft/net/minecraft/entity/LivingEntity.java.patch", "diffHunk": "@@ -531,12 +531,10 @@\n +   }\n +\n +   @Override\n-+   public void remove(boolean keepData) {\n-+      super.remove(keepData);\n-+      if (!keepData) {\n-+         for (int x = 0; x < handlers.length; x++)\n-+            handlers[x].invalidate();\n-+      }\n++   protected void invalidateCaps() {\n++      super.invalidateCaps();", "originalCommit": "f8664903bfd96c2c32e6f91986e3dd6563412260", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY4MjM1Nw==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7536#discussion_r537682357", "bodyText": "invalidateCaps for Entities is called from Entity#remove when keepData is false. This extra check got removed as invalidateCaps only will be called when it should be invalidated.", "author": "pupnewfster", "createdAt": "2020-12-07T17:18:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY3ODIyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY3ODQxNQ==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7536#discussion_r537678415", "bodyText": "Again why was this check removed?", "author": "OrionDevelopment", "createdAt": "2020-12-07T17:12:55Z", "path": "patches/minecraft/net/minecraft/entity/item/minecart/ContainerMinecartEntity.java.patch", "diffHunk": "@@ -20,11 +20,10 @@\n  \n -      super.func_70106_y();\n +      super.remove(keepData);\n-+      if (!keepData) itemHandler.invalidate();", "originalCommit": "f8664903bfd96c2c32e6f91986e3dd6563412260", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY3ODYyOA==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7536#discussion_r537678628", "bodyText": "Again removes the keepData check", "author": "OrionDevelopment", "createdAt": "2020-12-07T17:13:13Z", "path": "patches/minecraft/net/minecraft/entity/passive/horse/AbstractHorseEntity.java.patch", "diffHunk": "@@ -43,9 +43,9 @@\n +   }\n +\n +   @Override\n-+   public void remove(boolean keepData) {\n-+      super.remove(keepData);\n-+      if (!keepData && itemHandler != null) {\n++   protected void invalidateCaps() {\n++      super.invalidateCaps();\n++      if (itemHandler != null) {", "originalCommit": "f8664903bfd96c2c32e6f91986e3dd6563412260", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzcwNjMwMg==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7536#discussion_r537706302", "bodyText": "This annotation can just be removed. It was Nullable to override the vanilla's package level ones. Back before the cap optional rewrite.", "author": "LexManos", "createdAt": "2020-12-07T17:51:40Z", "path": "patches/minecraft/net/minecraft/tileentity/LockableTileEntity.java.patch", "diffHunk": "@@ -10,16 +10,16 @@\n +      return new net.minecraftforge.items.wrapper.InvWrapper(this);\n +   }\n +\n-+   @javax.annotation.Nullable\n++   @javax.annotation.Nonnull", "originalCommit": "f8664903bfd96c2c32e6f91986e3dd6563412260", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9b8ffc5e9fe5d063baf69b3796a110b732bfcf10", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/9b8ffc5e9fe5d063baf69b3796a110b732bfcf10", "message": "Remove unneeded annotation", "committedDate": "2020-12-07T17:54:40Z", "type": "commit"}]}