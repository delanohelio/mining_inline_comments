{"pr_number": 4876, "pr_title": "QACI-406 fixed tck websockets", "pr_createdAt": "2020-09-07T17:02:39Z", "pr_url": "https://github.com/payara/Payara/pull/4876", "timeline": [{"oid": "882141ae5a3f79f930862f90837bfdf8ba26fc98", "url": "https://github.com/payara/Payara/commit/882141ae5a3f79f930862f90837bfdf8ba26fc98", "message": "QACI-406 Changed ordering of JVM options to be same in all domain.xml files\n\n- files significantly differ, should be compared and reviewed soon", "committedDate": "2020-09-07T15:45:37Z", "type": "commit"}, {"oid": "1ce43b4188dae48552ab455d4fa96130dd3ac63f", "url": "https://github.com/payara/Payara/commit/1ce43b4188dae48552ab455d4fa96130dd3ac63f", "message": "QACI-406 Using same bootclasspath set in all domain.xml files", "committedDate": "2020-09-07T15:46:43Z", "type": "commit"}, {"oid": "5939186a6db18ee9c53db624f6d52606ca142ef8", "url": "https://github.com/payara/Payara/commit/5939186a6db18ee9c53db624f6d52606ca142ef8", "message": "QACI-406 grizzly-npn-bootstrap 1.9.payara-p1 was never used\n\n- Added explanation of how it works and what to care about\n- removed 1.9.payara-p1 from dependencies\n- grizzly-npn-bootstrap is used only for old JDK8 versions, new JDK8 distros\n  already contain JSSE implementation supporting ALPN, so no bootstrap is needed\n- changed the property so it directly says what dependency it affects", "committedDate": "2020-09-07T15:52:24Z", "type": "commit"}, {"oid": "4bf113035356ff82c4e19602df6395026ebd0792", "url": "https://github.com/payara/Payara/commit/4bf113035356ff82c4e19602df6395026ebd0792", "message": "QACI-406 Upgraded Tyrus from 1.15 to 1.17\n\n- supports TLS1.3\n- still loses critical exceptions (server may hang) if Error occurs\n  in forked thread\n- bugfixes", "committedDate": "2020-09-07T15:54:50Z", "type": "commit"}, {"oid": "262279917e21352117607692b9605fb8d4d081e6", "url": "https://github.com/payara/Payara/commit/262279917e21352117607692b9605fb8d4d081e6", "message": "QACI-406 ServerLogTest enabled again", "committedDate": "2020-09-07T15:55:17Z", "type": "commit"}, {"oid": "98fb18176e6b5cb02c8254d08d06ce1d16b49204", "url": "https://github.com/payara/Payara/commit/98fb18176e6b5cb02c8254d08d06ce1d16b49204", "message": "QACI-406 Using released version of grizzly 2.4.4.payara-p4", "committedDate": "2020-09-07T16:41:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ3MTA1Ng==", "url": "https://github.com/payara/Payara/pull/4876#discussion_r486471056", "bodyText": "What's being changed here and why?", "author": "MattGill98", "createdAt": "2020-09-10T16:19:06Z", "path": "appserver/admin/gf_template/src/main/resources/config/domain.xml", "diffHunk": "@@ -205,20 +205,22 @@\n                 <jvm-options>[9|]--add-opens=java.naming/javax.naming.spi=ALL-UNNAMED</jvm-options>\n                 <jvm-options>[9|]--add-opens=java.rmi/sun.rmi.transport=ALL-UNNAMED</jvm-options>\n                 <jvm-options>[9|]--add-opens=java.logging/java.util.logging=ALL-UNNAMED</jvm-options>\n-                <jvm-options>-Djava.awt.headless=true</jvm-options>\n-                <jvm-options>-Djdk.corba.allowOutputStreamSubclass=true</jvm-options>\n-                <jvm-options>-Djavax.xml.accessExternalSchema=all</jvm-options>\n-                <jvm-options>-Djavax.management.builder.initial=com.sun.enterprise.v3.admin.AppServerMBeanServerBuilder</jvm-options>\n+                <jvm-options>-Xmx512m</jvm-options>\n+                <jvm-options>-XX:NewRatio=2</jvm-options>", "originalCommit": "98fb18176e6b5cb02c8254d08d06ce1d16b49204", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk3NDU5NA==", "url": "https://github.com/payara/Payara/pull/4876#discussion_r486974594", "bodyText": "Maintainability: Only ordering changed in this block.", "author": "dmatej", "createdAt": "2020-09-11T11:08:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ3MTA1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk3NDA0MQ==", "url": "https://github.com/payara/Payara/pull/4876#discussion_r486974041", "bodyText": "Maintainability: Only ordering changed in this block.", "author": "dmatej", "createdAt": "2020-09-11T11:07:22Z", "path": "appserver/admin/gf_template/src/main/resources/config/domain.xml", "diffHunk": "@@ -430,19 +429,20 @@\n                 <jvm-options>[9|]--add-opens=java.naming/javax.naming.spi=ALL-UNNAMED</jvm-options>\n                 <jvm-options>[9|]--add-opens=java.rmi/sun.rmi.transport=ALL-UNNAMED</jvm-options>\n                 <jvm-options>[9|]--add-opens=java.logging/java.util.logging=ALL-UNNAMED</jvm-options>\n-                <jvm-options>-Djava.awt.headless=true</jvm-options>", "originalCommit": "98fb18176e6b5cb02c8254d08d06ce1d16b49204", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk3NTE0NQ==", "url": "https://github.com/payara/Payara/pull/4876#discussion_r486975145", "bodyText": "Maintainability: Only ordering changed in this block.", "author": "dmatej", "createdAt": "2020-09-11T11:09:49Z", "path": "appserver/admin/gf_template_web/src/main/resources/config/domain.xml", "diffHunk": "@@ -200,20 +200,22 @@\n         <jvm-options>[9|]--add-opens=java.naming/javax.naming.spi=ALL-UNNAMED</jvm-options>\n         <jvm-options>[9|]--add-opens=java.rmi/sun.rmi.transport=ALL-UNNAMED</jvm-options>\n         <jvm-options>[9|]--add-opens=java.logging/java.util.logging=ALL-UNNAMED</jvm-options>\n-        <jvm-options>-Djava.awt.headless=true</jvm-options>", "originalCommit": "98fb18176e6b5cb02c8254d08d06ce1d16b49204", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk3NzI3Mw==", "url": "https://github.com/payara/Payara/pull/4876#discussion_r486977273", "bodyText": "Maintainability: Only ordering changed in this block", "author": "dmatej", "createdAt": "2020-09-11T11:14:52Z", "path": "appserver/admin/gf_template_web/src/main/resources/config/domain.xml", "diffHunk": "@@ -420,19 +419,20 @@\n         <jvm-options>[9|]--add-opens=java.naming/javax.naming.spi=ALL-UNNAMED</jvm-options>\n         <jvm-options>[9|]--add-opens=java.rmi/sun.rmi.transport=ALL-UNNAMED</jvm-options>\n         <jvm-options>[9|]--add-opens=java.logging/java.util.logging=ALL-UNNAMED</jvm-options>\n-        <jvm-options>-Djava.awt.headless=true</jvm-options>\n-        <jvm-options>-Djdk.corba.allowOutputStreamSubclass=true</jvm-options>\n+        <jvm-options>-Xmx512m</jvm-options>\n+        <jvm-options>-XX:NewRatio=2</jvm-options>\n         <jvm-options>-XX:+UnlockDiagnosticVMOptions</jvm-options>\n-        <jvm-options>-Djava.security.policy=${com.sun.aas.instanceRoot}/config/server.policy</jvm-options>\n+        <jvm-options>-Dcom.sun.enterprise.config.config_environment_factory_class=com.sun.enterprise.config.serverbeans.AppserverConfigEnvironmentFactory</jvm-options>\n+        <jvm-options>-Djava.awt.headless=true</jvm-options>\n         <jvm-options>-Djava.security.auth.login.config=${com.sun.aas.instanceRoot}/config/login.conf</jvm-options>\n+        <jvm-options>-Djava.security.policy=${com.sun.aas.instanceRoot}/config/server.policy</jvm-options>\n         <jvm-options>-Dcom.sun.enterprise.security.httpsOutboundKeyAlias=s1as</jvm-options>\n         <jvm-options>-Djavax.net.ssl.keyStore=${com.sun.aas.instanceRoot}/config/keystore.jks</jvm-options>\n         <jvm-options>-Djavax.net.ssl.trustStore=${com.sun.aas.instanceRoot}/config/cacerts.jks</jvm-options>\n-             <jvm-options>-Djdbc.drivers=org.h2.Driver</jvm-options>\n+        <jvm-options>-Djdbc.drivers=org.h2.Driver</jvm-options>\n+        <jvm-options>-Djdk.corba.allowOutputStreamSubclass=true</jvm-options>\n+        <jvm-options>-Djdk.tls.rejectClientInitiatedRenegotiation=true</jvm-options>", "originalCommit": "98fb18176e6b5cb02c8254d08d06ce1d16b49204", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk3ODA1Mg==", "url": "https://github.com/payara/Payara/pull/4876#discussion_r486978052", "bodyText": "Maintainability: Only ordering changed in this block", "author": "dmatej", "createdAt": "2020-09-11T11:16:32Z", "path": "appserver/admin/production_domain_template/src/main/resources/config/domain.xml", "diffHunk": "@@ -188,31 +188,31 @@\n         <jvm-options>-XX:+UseG1GC</jvm-options>\n         <jvm-options>-XX:+UseStringDeduplication</jvm-options>\n         <jvm-options>-XX:MaxGCPauseMillis=500</jvm-options>\n-        <jvm-options>-XX:MetaspaceSize=256m</jvm-options>\n         <jvm-options>-XX:MaxMetaspaceSize=2g</jvm-options>", "originalCommit": "98fb18176e6b5cb02c8254d08d06ce1d16b49204", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk3ODI5OA==", "url": "https://github.com/payara/Payara/pull/4876#discussion_r486978298", "bodyText": "Maintainability: Only ordering changed in this block", "author": "dmatej", "createdAt": "2020-09-11T11:17:01Z", "path": "appserver/admin/production_domain_template/src/main/resources/config/domain.xml", "diffHunk": "@@ -395,30 +395,30 @@\n         <jvm-options>-XX:+UseG1GC</jvm-options>\n         <jvm-options>-XX:+UseStringDeduplication</jvm-options>\n         <jvm-options>-XX:MaxGCPauseMillis=500</jvm-options>\n-        <jvm-options>-XX:MetaspaceSize=256m</jvm-options>", "originalCommit": "98fb18176e6b5cb02c8254d08d06ce1d16b49204", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk3ODUyNA==", "url": "https://github.com/payara/Payara/pull/4876#discussion_r486978524", "bodyText": "Maintainability: Only ordering changed in this block", "author": "dmatej", "createdAt": "2020-09-11T11:17:35Z", "path": "appserver/admin/production_domain_template_web/src/main/resources/config/domain.xml", "diffHunk": "@@ -206,36 +206,36 @@\n         <jvm-options>[9|]--add-opens=java.naming/javax.naming.spi=ALL-UNNAMED</jvm-options>\n         <jvm-options>[9|]--add-opens=java.rmi/sun.rmi.transport=ALL-UNNAMED</jvm-options>\n         <jvm-options>[9|]--add-opens=java.logging/java.util.logging=ALL-UNNAMED</jvm-options>\n+        <jvm-options>-Xmx2g</jvm-options>\n+        <jvm-options>-Xms2g</jvm-options>\n         <jvm-options>-XX:+UseG1GC</jvm-options>\n         <jvm-options>-XX:+UseStringDeduplication</jvm-options>", "originalCommit": "98fb18176e6b5cb02c8254d08d06ce1d16b49204", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk3ODgxMg==", "url": "https://github.com/payara/Payara/pull/4876#discussion_r486978812", "bodyText": "Maintainability: Only ordering changed in this block", "author": "dmatej", "createdAt": "2020-09-11T11:18:21Z", "path": "appserver/admin/production_domain_template_web/src/main/resources/config/domain.xml", "diffHunk": "@@ -401,40 +401,40 @@\n         <jvm-options>[9|]--add-opens=java.base/java.util=ALL-UNNAMED</jvm-options>\n         <jvm-options>[9|]--add-opens=java.base/sun.nio.ch=ALL-UNNAMED</jvm-options>\n         <jvm-options>[9|]--add-opens=java.management/sun.management=ALL-UNNAMED</jvm-options>\n-        <jvm-options>[9|]--add-opens=java.naming/javax.naming.spi=ALL-UNNAMED</jvm-options>", "originalCommit": "98fb18176e6b5cb02c8254d08d06ce1d16b49204", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk3OTM5NA==", "url": "https://github.com/payara/Payara/pull/4876#discussion_r486979394", "bodyText": "Except ordering here I changed also filter from 1.8.0u500 to 1.8.0u250 just as it is in other domain.xml files and added non-api.", "author": "dmatej", "createdAt": "2020-09-11T11:19:45Z", "path": "appserver/extras/embedded/all/src/main/resources/config/domain.xml", "diffHunk": "@@ -234,18 +234,19 @@\n                 -->\n                 <jvm-options>-Dfelix.fileinstall.disableConfigSave=false</jvm-options>\n                 <!-- End of OSGi bundle configurations -->\n-                <jvm-options>-XX:NewRatio=2</jvm-options>\n                 <!-- Woodstox property needed to pass StAX TCK -->\n                 <jvm-options>-Dcom.ctc.wstx.returnNullForDefaultNamespace=true</jvm-options>\n-                <jvm-options>-Djdk.tls.rejectClientInitiatedRenegotiation=true</jvm-options>\n-                <jvm-options>-Dorg.jboss.weld.serialization.beanIdentifierIndexOptimization=false</jvm-options>\n                 <jvm-options>-Dorg.glassfish.grizzly.DEFAULT_MEMORY_MANAGER=org.glassfish.grizzly.memory.HeapMemoryManager</jvm-options>\n                 <jvm-options>-Dorg.glassfish.grizzly.nio.DefaultSelectorHandler.force-selector-spin-detection=true</jvm-options>\n-                <!-- Grizzly NPN Jar version -->\n+                <jvm-options>-Dorg.jboss.weld.serialization.beanIdentifierIndexOptimization=false</jvm-options>\n+                <jvm-options>[|8]-Djava.endorsed.dirs=${com.sun.aas.installRoot}/modules/endorsed${path.separator}${com.sun.aas.installRoot}/lib/endorsed</jvm-options>\n+                <jvm-options>[|8]-Djava.ext.dirs=${com.sun.aas.javaRoot}/lib/ext${path.separator}${com.sun.aas.javaRoot}/jre/lib/ext${path.separator}${com.sun.aas.instanceRoot}/lib/ext</jvm-options>\n+                <!-- Grizzly NPN Bootstrap compatible with used JDK version -->\n                 <jvm-options>[1.8.0|1.8.0u120]-Xbootclasspath/p:${com.sun.aas.installRoot}/lib/grizzly-npn-bootstrap-1.6.jar</jvm-options>\n                 <jvm-options>[1.8.0u121|1.8.0u160]-Xbootclasspath/p:${com.sun.aas.installRoot}/lib/grizzly-npn-bootstrap-1.7.jar</jvm-options>\n                 <jvm-options>[1.8.0u161|1.8.0u190]-Xbootclasspath/p:${com.sun.aas.installRoot}/lib/grizzly-npn-bootstrap-1.8.jar</jvm-options>\n-                <jvm-options>[1.8.0u191|1.8.0u500]-Xbootclasspath/p:${com.sun.aas.installRoot}/lib/grizzly-npn-bootstrap-1.8.1.jar</jvm-options>", "originalCommit": "98fb18176e6b5cb02c8254d08d06ce1d16b49204", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk3OTk5OQ==", "url": "https://github.com/payara/Payara/pull/4876#discussion_r486979999", "bodyText": "Except ordering here I changed also filter from 1.8.0u500 to 1.8.0u250 just as it is in other domain.xml files and added non-api.", "author": "dmatej", "createdAt": "2020-09-11T11:21:06Z", "path": "appserver/extras/embedded/web/src/main/resources/config/domain.xml", "diffHunk": "@@ -227,18 +227,19 @@\n                 -->\n                 <jvm-options>-Dfelix.fileinstall.disableConfigSave=false</jvm-options>\n                 <!-- End of OSGi bundle configurations -->\n-                <jvm-options>-XX:NewRatio=2</jvm-options>\n                 <!-- Woodstox property needed to pass StAX TCK -->\n                 <jvm-options>-Dcom.ctc.wstx.returnNullForDefaultNamespace=true</jvm-options>\n-                <jvm-options>-Djdk.tls.rejectClientInitiatedRenegotiation=true</jvm-options>\n                 <jvm-options>-Dorg.jboss.weld.serialization.beanIdentifierIndexOptimization=false</jvm-options>\n                 <jvm-options>-Dorg.glassfish.grizzly.DEFAULT_MEMORY_MANAGER=org.glassfish.grizzly.memory.HeapMemoryManager</jvm-options>\n                 <jvm-options>-Dorg.glassfish.grizzly.nio.DefaultSelectorHandler.force-selector-spin-detection=true</jvm-options>\n-                <!-- Grizzly NPN Jar version -->\n+                <jvm-options>[|8]-Djava.endorsed.dirs=${com.sun.aas.installRoot}/modules/endorsed${path.separator}${com.sun.aas.installRoot}/lib/endorsed</jvm-options>\n+                <jvm-options>[|8]-Djava.ext.dirs=${com.sun.aas.javaRoot}/lib/ext${path.separator}${com.sun.aas.javaRoot}/jre/lib/ext${path.separator}${com.sun.aas.instanceRoot}/lib/ext</jvm-options>\n+                <!-- Grizzly NPN Bootstrap compatible with used JDK version -->\n                 <jvm-options>[1.8.0|1.8.0u120]-Xbootclasspath/p:${com.sun.aas.installRoot}/lib/grizzly-npn-bootstrap-1.6.jar</jvm-options>\n                 <jvm-options>[1.8.0u121|1.8.0u160]-Xbootclasspath/p:${com.sun.aas.installRoot}/lib/grizzly-npn-bootstrap-1.7.jar</jvm-options>\n                 <jvm-options>[1.8.0u161|1.8.0u190]-Xbootclasspath/p:${com.sun.aas.installRoot}/lib/grizzly-npn-bootstrap-1.8.jar</jvm-options>\n-                <jvm-options>[1.8.0u191|1.8.0u500]-Xbootclasspath/p:${com.sun.aas.installRoot}/lib/grizzly-npn-bootstrap-1.8.1.jar</jvm-options>", "originalCommit": "98fb18176e6b5cb02c8254d08d06ce1d16b49204", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk4MDU3Ng==", "url": "https://github.com/payara/Payara/pull/4876#discussion_r486980576", "bodyText": "Just the ordering to be same as in other domain.xml files", "author": "dmatej", "createdAt": "2020-09-11T11:22:27Z", "path": "nucleus/admin/template/src/main/resources/config/domain.xml", "diffHunk": "@@ -311,18 +311,19 @@\n          <diagnostic-service/>\n          <java-config debug-options=\"-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=${JAVA_DEBUGGER_PORT}\" system-classpath=\"\" classpath-suffix=\"\">\n              <jvm-options>-server</jvm-options>\n-             <jvm-options>-Djava.awt.headless=true</jvm-options>", "originalCommit": "98fb18176e6b5cb02c8254d08d06ce1d16b49204", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}