{"pr_number": 4836, "pr_title": "QACI-195 Add MP TCKs to PR tests", "pr_createdAt": "2020-08-14T10:57:12Z", "pr_url": "https://github.com/payara/Payara/pull/4836", "timeline": [{"oid": "0bd784e4f44014212c9df0100e336011b4a3538a", "url": "https://github.com/payara/Payara/commit/0bd784e4f44014212c9df0100e336011b4a3538a", "message": "Add MP TCKs to PR tests", "committedDate": "2020-06-14T17:25:33Z", "type": "commit"}, {"oid": "36a17a69cab350a0eae245cc8465bd92c7bd9ba4", "url": "https://github.com/payara/Payara/commit/36a17a69cab350a0eae245cc8465bd92c7bd9ba4", "message": "Update Jenkinsfile\n\nCo-authored-by: Alan <alan.roth@payara.fish>", "committedDate": "2020-06-25T14:41:02Z", "type": "commit"}, {"oid": "7e532a2e4a7ca7a975561134a21e661cc2b7683d", "url": "https://github.com/payara/Payara/commit/7e532a2e4a7ca7a975561134a21e661cc2b7683d", "message": "remove redundant profile", "committedDate": "2020-06-25T14:44:16Z", "type": "commit"}, {"oid": "712b71228410ecd43f0708083d70aecaec0aec10", "url": "https://github.com/payara/Payara/commit/712b71228410ecd43f0708083d70aecaec0aec10", "message": "Added required variables and move test near the top", "committedDate": "2020-06-26T09:34:06Z", "type": "commit"}, {"oid": "dd86ca19280d570228a237f25e6f67a923b905b1", "url": "https://github.com/payara/Payara/commit/dd86ca19280d570228a237f25e6f67a923b905b1", "message": "Remove JenkinsFile-Microprofile, not used", "committedDate": "2020-06-26T09:37:37Z", "type": "commit"}, {"oid": "36e294a68d6ed2a3188b6c526865724599f3b7f7", "url": "https://github.com/payara/Payara/commit/36e294a68d6ed2a3188b6c526865724599f3b7f7", "message": "Merge pull request #10 from AlanRoth/add-mp-tcks\n\nQACI-195 Add MP TCKs to PR tests", "committedDate": "2020-06-26T13:01:05Z", "type": "commit"}, {"oid": "9ac58df2c758e6a273106781a5b878b976a7c82c", "url": "https://github.com/payara/Payara/commit/9ac58df2c758e6a273106781a5b878b976a7c82c", "message": "Removed expired certificates", "committedDate": "2020-06-30T07:56:26Z", "type": "commit"}, {"oid": "2b6afbc24c3c1bc8088b60dd0457a0bad51023de", "url": "https://github.com/payara/Payara/commit/2b6afbc24c3c1bc8088b60dd0457a0bad51023de", "message": "Merge pull request #27 from MarkWareham/add-mp-tcks\n\nMerge pull request #10 from AlanRoth/add-mp-tcks", "committedDate": "2020-06-30T12:29:00Z", "type": "commit"}, {"oid": "413d65a47e40abad43175b5df291154a3a8a807d", "url": "https://github.com/payara/Payara/commit/413d65a47e40abad43175b5df291154a3a8a807d", "message": "Merge pull request #28 from AlanRoth/expired-certs\n\nExpired certs", "committedDate": "2020-06-30T12:33:12Z", "type": "commit"}, {"oid": "78f320e87a2405358eda687752cbfa368bec5384", "url": "https://github.com/payara/Payara/commit/78f320e87a2405358eda687752cbfa368bec5384", "message": "Add capital variable to env in pipeline\n\nWorkaround for case sensitivity bug in jenkins", "committedDate": "2020-07-02T08:16:55Z", "type": "commit"}, {"oid": "455b44dbf87c992f48f4706258ec080f041dea9d", "url": "https://github.com/payara/Payara/commit/455b44dbf87c992f48f4706258ec080f041dea9d", "message": "Export variables before mptck are ran", "committedDate": "2020-07-03T10:56:57Z", "type": "commit"}, {"oid": "c5bd572b5993879f52fdc739c9c2e84d1f9c9df6", "url": "https://github.com/payara/Payara/commit/c5bd572b5993879f52fdc739c9c2e84d1f9c9df6", "message": "removed redundant property in env var in pipeline", "committedDate": "2020-07-07T10:55:32Z", "type": "commit"}, {"oid": "78479e2bdea065268a96c14b678bf0117036047f", "url": "https://github.com/payara/Payara/commit/78479e2bdea065268a96c14b678bf0117036047f", "message": "Run MPTCKs with Payara-Managed", "committedDate": "2020-07-09T10:45:22Z", "type": "commit"}, {"oid": "ae50d90277ca36059bccbde2af6a47ccd8ce301d", "url": "https://github.com/payara/Payara/commit/ae50d90277ca36059bccbde2af6a47ccd8ce301d", "message": "Merge branch 'add-mp-tcks' of https://github.com/AlanRoth/Payara into add-mp-tcks", "committedDate": "2020-07-09T10:46:10Z", "type": "commit"}, {"oid": "9c3297eaf188b521eac17830982357dd67b45e70", "url": "https://github.com/payara/Payara/commit/9c3297eaf188b521eac17830982357dd67b45e70", "message": "Merge pull request #29 from payara/master\n\nsync branch with master", "committedDate": "2020-07-14T10:06:20Z", "type": "commit"}, {"oid": "851c97f07f60c883891af952a08c6c5c56b3702e", "url": "https://github.com/payara/Payara/commit/851c97f07f60c883891af952a08c6c5c56b3702e", "message": "Mptck only jenkinsfile", "committedDate": "2020-07-14T10:37:34Z", "type": "commit"}, {"oid": "c2adf29b80943411a7eb0a4b4e98fa13eb29bebf", "url": "https://github.com/payara/Payara/commit/c2adf29b80943411a7eb0a4b4e98fa13eb29bebf", "message": "Quick build", "committedDate": "2020-07-14T11:15:29Z", "type": "commit"}, {"oid": "265cd6c1b1a3964a5edcc60df5e0b8213e7df186", "url": "https://github.com/payara/Payara/commit/265cd6c1b1a3964a5edcc60df5e0b8213e7df186", "message": "Added skips", "committedDate": "2020-07-14T11:27:41Z", "type": "commit"}, {"oid": "377c96e8dfd5d9b2c19a78c1ea6e1eb1a342020e", "url": "https://github.com/payara/Payara/commit/377c96e8dfd5d9b2c19a78c1ea6e1eb1a342020e", "message": "removed redundant profiles", "committedDate": "2020-07-14T12:19:51Z", "type": "commit"}, {"oid": "f1f79375e2316dbab44b9500ceede55a734672d8", "url": "https://github.com/payara/Payara/commit/f1f79375e2316dbab44b9500ceede55a734672d8", "message": "Remove post always stage", "committedDate": "2020-07-14T12:20:57Z", "type": "commit"}, {"oid": "ced7fa8b5980109fabea0d6a75650772d68b5288", "url": "https://github.com/payara/Payara/commit/ced7fa8b5980109fabea0d6a75650772d68b5288", "message": "Merge branch 'add-mp-tcks' of https://github.com/AlanRoth/payara into add-mp-tcks", "committedDate": "2020-08-14T10:30:09Z", "type": "commit"}, {"oid": "77dc9c8e2375223b4f9d1d309255eac896f2ffb6", "url": "https://github.com/payara/Payara/commit/77dc9c8e2375223b4f9d1d309255eac896f2ffb6", "message": "Removed testing file", "committedDate": "2020-08-14T10:47:24Z", "type": "commit"}, {"oid": "e856c4fac604db9b613e669566fc3b11a544f145", "url": "https://github.com/payara/Payara/commit/e856c4fac604db9b613e669566fc3b11a544f145", "message": "Teardown domain after MPTCKs", "committedDate": "2020-08-14T12:59:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYwNzkyNA==", "url": "https://github.com/payara/Payara/pull/4836#discussion_r470607924", "bodyText": "I note you are running managed profile. Why would this stage need the stage \"Setup for MP TCK Runners\" ?", "author": "MarkWareham", "createdAt": "2020-08-14T12:59:14Z", "path": "Jenkinsfile", "diffHunk": "@@ -99,6 +101,37 @@ pipeline {\n                }\n             }\n         }\n+        stage('Checkout MP TCK Runners') {\n+            steps{\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checking out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                checkout changelog: false, poll: false, scm: [$class: 'GitSCM',\n+                    branches: [[name: \"*/master\"]],\n+                    userRemoteConfigs: [[url: \"https://github.com/payara/MicroProfile-TCK-Runners.git\"]]]\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checked out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+            }\n+        }\n+        stage('Setup for MP TCK Runners') {\n+            steps {\n+                makeDomain()\n+            }\n+        }\n+        stage('Run MP TCK Tests') {\n+            steps {\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Running test  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                sh \"\"\"mvn -B -V -ff -e clean verify \\\n+                -Djavax.net.ssl.trustStore=${env.JAVA_HOME}/jre/lib/security/cacerts \\\n+                -Djavax.xml.accessExternalSchema=all -Dpayara.version=${pom.version} \\\n+                -Dpayara_domain=${DOMAIN_NAME} -Duse.cnHost=true \\\n+                -Dsurefire.rerunFailingTestsCount=2 -Ppayara-server-managed,payara5\"\"\"", "originalCommit": "77dc9c8e2375223b4f9d1d309255eac896f2ffb6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYxNDkzMA==", "url": "https://github.com/payara/Payara/pull/4836#discussion_r470614930", "bodyText": "True", "author": "AlanRoth", "createdAt": "2020-08-14T13:12:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYwNzkyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYwOTQ2MA==", "url": "https://github.com/payara/Payara/pull/4836#discussion_r470609460", "bodyText": "Would be nicer to only zip the logs on failure, otherwise you're just using disk space", "author": "MarkWareham", "createdAt": "2020-08-14T13:02:13Z", "path": "Jenkinsfile", "diffHunk": "@@ -99,6 +101,37 @@ pipeline {\n                }\n             }\n         }\n+        stage('Checkout MP TCK Runners') {\n+            steps{\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checking out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                checkout changelog: false, poll: false, scm: [$class: 'GitSCM',\n+                    branches: [[name: \"*/master\"]],\n+                    userRemoteConfigs: [[url: \"https://github.com/payara/MicroProfile-TCK-Runners.git\"]]]\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checked out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+            }\n+        }\n+        stage('Setup for MP TCK Runners') {\n+            steps {\n+                makeDomain()\n+            }\n+        }\n+        stage('Run MP TCK Tests') {\n+            steps {\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Running test  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                sh \"\"\"mvn -B -V -ff -e clean verify \\\n+                -Djavax.net.ssl.trustStore=${env.JAVA_HOME}/jre/lib/security/cacerts \\\n+                -Djavax.xml.accessExternalSchema=all -Dpayara.version=${pom.version} \\\n+                -Dpayara_domain=${DOMAIN_NAME} -Duse.cnHost=true \\\n+                -Dsurefire.rerunFailingTestsCount=2 -Ppayara-server-managed,payara5\"\"\"\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Ran test  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+            }\n+            post {\n+                always {\n+                    zip archive: true, dir: \"appserver/distributions/payara/target/stage/payara5/glassfish/domains/${DOMAIN_NAME}/logs\", glob: 'server.*', zipFile: 'mp-tck-log.zip'", "originalCommit": "77dc9c8e2375223b4f9d1d309255eac896f2ffb6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYxNTY4Mw==", "url": "https://github.com/payara/Payara/pull/4836#discussion_r470615683", "bodyText": "I think that'll need a refactor on every other stage then aswell", "author": "AlanRoth", "createdAt": "2020-08-14T13:14:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYwOTQ2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY0ODI0Ng==", "url": "https://github.com/payara/Payara/pull/4836#discussion_r470648246", "bodyText": "Problem I found is that the always stage will run before success stage, meaning the logs will get deleted in the teardown and it'll fail trying to find the logs in the success stage", "author": "AlanRoth", "createdAt": "2020-08-14T14:12:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYwOTQ2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY1NDMwNg==", "url": "https://github.com/payara/Payara/pull/4836#discussion_r470654306", "bodyText": "Cleanup stage to the rescue", "author": "AlanRoth", "createdAt": "2020-08-14T14:22:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYwOTQ2MA=="}], "type": "inlineReview"}, {"oid": "382c12e2f5e32ea9d6cf7c04c67d895b6d7a7b4f", "url": "https://github.com/payara/Payara/commit/382c12e2f5e32ea9d6cf7c04c67d895b6d7a7b4f", "message": "Save logs only on success, no domain setup for managed profile", "committedDate": "2020-08-14T13:22:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY0MzAwNg==", "url": "https://github.com/payara/Payara/pull/4836#discussion_r470643006", "bodyText": "We always want to collect the junit results", "author": "MarkWareham", "createdAt": "2020-08-14T14:03:03Z", "path": "Jenkinsfile", "diffHunk": "@@ -73,11 +75,13 @@ pipeline {\n                 echo '*#*#*#*#*#*#*#*#*#*#*#*#  Ran test  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n             }\n             post {\n-                always {\n+                success {\n                     zip archive: true, dir: \"appserver/distributions/payara/target/stage/payara5/glassfish/domains/${DOMAIN_NAME}/logs\", glob: 'server.*', zipFile: 'quicklook-log.zip'\n-                    teardownDomain()\n                     junit '**/target/surefire-reports/*.xml'", "originalCommit": "382c12e2f5e32ea9d6cf7c04c67d895b6d7a7b4f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "07c5f24618caff7b0f7be1180ceb088ced8e7377", "url": "https://github.com/payara/Payara/commit/07c5f24618caff7b0f7be1180ceb088ced8e7377", "message": "Always save junit and teardown domain in cleanup stage", "committedDate": "2020-08-14T14:20:01Z", "type": "commit"}, {"oid": "7a959b530ed0945ca1153f1cecdd0169e32387cd", "url": "https://github.com/payara/Payara/commit/7a959b530ed0945ca1153f1cecdd0169e32387cd", "message": "typo", "committedDate": "2020-08-14T14:23:35Z", "type": "commit"}, {"oid": "83d8856d99ca9ed6d0ab9b2470342f5f1dab9764", "url": "https://github.com/payara/Payara/commit/83d8856d99ca9ed6d0ab9b2470342f5f1dab9764", "message": "Save logs on failure", "committedDate": "2020-08-14T14:33:27Z", "type": "commit"}, {"oid": "2534788622f347cc423a178fc8985b311bd93b88", "url": "https://github.com/payara/Payara/commit/2534788622f347cc423a178fc8985b311bd93b88", "message": "Typo", "committedDate": "2020-08-17T08:11:03Z", "type": "commit"}]}