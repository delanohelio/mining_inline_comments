{"pr_number": 3228, "pr_title": "Created ExprDropsOfBlock to get the drops of a block", "pr_createdAt": "2020-07-26T19:48:17Z", "pr_url": "https://github.com/SkriptLang/Skript/pull/3228", "timeline": [{"oid": "0e32bcd16853d1b8b052ce86d091805f75ebf3c3", "url": "https://github.com/SkriptLang/Skript/commit/0e32bcd16853d1b8b052ce86d091805f75ebf3c3", "message": "Created ExprDropsOfBlock to get the drops of a block", "committedDate": "2020-07-26T19:34:27Z", "type": "commit"}, {"oid": "82dc6eee0c2799649ecd43184cd6a01a851e252e", "url": "https://github.com/SkriptLang/Skript/commit/82dc6eee0c2799649ecd43184cd6a01a851e252e", "message": "Added SkriptDocs and a fall back in case people used 'as %entity%' when that didn't exist", "committedDate": "2020-07-26T19:45:05Z", "type": "commit"}, {"oid": "c6c4935076c83a0fd8cff5bd6ae0bd71ef5ea234", "url": "https://github.com/SkriptLang/Skript/commit/c6c4935076c83a0fd8cff5bd6ae0bd71ef5ea234", "message": "Removed said fallback and added a check to see their version in the init method", "committedDate": "2020-07-26T19:47:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwMzA1OQ==", "url": "https://github.com/SkriptLang/Skript/pull/3228#discussion_r460903059", "bodyText": "use ItemType, not ItemStack. Also, it should support multiple blocks", "author": "FranKusmiruk", "createdAt": "2020-07-27T13:49:13Z", "path": "src/main/java/ch/njol/skript/expressions/ExprDropsOfBlock.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.block.Block;\n+import org.bukkit.entity.Entity;\n+import org.bukkit.event.Event;\n+import org.bukkit.inventory.ItemStack;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser.ParseResult;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.log.ErrorQuality;\n+import ch.njol.util.Kleenean;\n+\n+@Name(\"Drops Of Block\")\n+@Description(\"A list of the items that will drop when a block is broken. Note that 'as %entity%' only works on minecraft 1.15+.\")\n+@Examples({\"on break of block:\",\n+\t\"\\tgive drops of block using player's tool to player\"})\n+@Since(\"INSERT VERSION\")\n+public class ExprDropsOfBlock extends SimpleExpression<ItemStack> {\n+\t\n+\tstatic {\n+\t\tSkript.registerExpression(ExprDropsOfBlock.class, ItemStack.class, ExpressionType.COMBINED, \"drops of %block% [(using|with) %-itemstack% [(1\u00a6as %-entity%)]]\", \"%block%'s drops [(using|with) %-itemstack% [(1\u00a6as %-entity%)]]\");", "originalCommit": "c6c4935076c83a0fd8cff5bd6ae0bd71ef5ea234", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwODE0Mw==", "url": "https://github.com/SkriptLang/Skript/pull/3228#discussion_r460908143", "bodyText": "Why should I do that?", "author": "DeltaRays", "createdAt": "2020-07-27T13:56:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwMzA1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkxNjUyOQ==", "url": "https://github.com/SkriptLang/Skript/pull/3228#discussion_r460916529", "bodyText": "It's rather complex to explain here but basically, Skript only passes around itemtypes, not itemstacks and even if it may make this specific case a bit more complex, it's better for expressions to encourage the usage of ItemType so that addon developers don't start passing ItemStacks around and generating weird behaviour in some expressions.", "author": "FranKusmiruk", "createdAt": "2020-07-27T14:08:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwMzA1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkxODUyMg==", "url": "https://github.com/SkriptLang/Skript/pull/3228#discussion_r460918522", "bodyText": "\ud83d\udc4d okay I'll add that afterwards, thanks", "author": "DeltaRays", "createdAt": "2020-07-27T14:10:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwMzA1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzNDUzNQ==", "url": "https://github.com/SkriptLang/Skript/pull/3228#discussion_r460934535", "bodyText": "You could also split this into multiple lines", "author": "Nicofisi", "createdAt": "2020-07-27T14:32:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwMzA1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk0NjMxMQ==", "url": "https://github.com/SkriptLang/Skript/pull/3228#discussion_r460946311", "bodyText": "How would I implement it?\nWould I do something along the lines of\n\t\t\t\tList<ItemStack> stacks = (List<ItemStack>) block.getDrops(item.getRandom());\n\t\t\t\tint size = stacks.size();\n\t\t\t\tItemType[] result = new ItemType[size];\n\t\t\t\tfor (int i = 0; i < size; i++) {\n\t\t\t\t\tresult[i] = new ItemType(stacks.get(i));\n\t\t\t\t}\n\t\t\t\treturn result;", "author": "DeltaRays", "createdAt": "2020-07-27T14:48:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwMzA1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk0NzI3Mg==", "url": "https://github.com/SkriptLang/Skript/pull/3228#discussion_r460947272", "bodyText": "Yeah, that should do", "author": "FranKusmiruk", "createdAt": "2020-07-27T14:49:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwMzA1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwNDAzOQ==", "url": "https://github.com/SkriptLang/Skript/pull/3228#discussion_r460904039", "bodyText": "We tend to directly not register the pattern in those cases, not sure if this is better though", "author": "FranKusmiruk", "createdAt": "2020-07-27T13:50:35Z", "path": "src/main/java/ch/njol/skript/expressions/ExprDropsOfBlock.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.block.Block;\n+import org.bukkit.entity.Entity;\n+import org.bukkit.event.Event;\n+import org.bukkit.inventory.ItemStack;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser.ParseResult;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.log.ErrorQuality;\n+import ch.njol.util.Kleenean;\n+\n+@Name(\"Drops Of Block\")\n+@Description(\"A list of the items that will drop when a block is broken. Note that 'as %entity%' only works on minecraft 1.15+.\")\n+@Examples({\"on break of block:\",\n+\t\"\\tgive drops of block using player's tool to player\"})\n+@Since(\"INSERT VERSION\")\n+public class ExprDropsOfBlock extends SimpleExpression<ItemStack> {\n+\t\n+\tstatic {\n+\t\tSkript.registerExpression(ExprDropsOfBlock.class, ItemStack.class, ExpressionType.COMBINED, \"drops of %block% [(using|with) %-itemstack% [(1\u00a6as %-entity%)]]\", \"%block%'s drops [(using|with) %-itemstack% [(1\u00a6as %-entity%)]]\");\n+\t}\n+\t\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<Block> block;\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<ItemStack> item;\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<Entity> entity;\n+\t\n+\t@Override\n+\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, ParseResult parseResult) {\n+\t\tblock = (Expression<Block>) exprs[0];\n+\t\titem = (Expression<ItemStack>) exprs[1];\n+\t\tif (!Skript.methodExists(Block.class, \"getDrops\", ItemStack.class, Entity.class) && parseResult.mark == 1) {", "originalCommit": "c6c4935076c83a0fd8cff5bd6ae0bd71ef5ea234", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwNzg1NA==", "url": "https://github.com/SkriptLang/Skript/pull/3228#discussion_r460907854", "bodyText": "I'd leave it like this as it can still be used, just without the entity", "author": "DeltaRays", "createdAt": "2020-07-27T13:55:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwNDAzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwODgwNg==", "url": "https://github.com/SkriptLang/Skript/pull/3228#discussion_r460908806", "bodyText": "I mean, not registering the pattern in the versions it does not work. But I believe we can leave it like this since it'll be less confusing to users.", "author": "FranKusmiruk", "createdAt": "2020-07-27T13:57:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwNDAzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkxMDI0MQ==", "url": "https://github.com/SkriptLang/Skript/pull/3228#discussion_r460910241", "bodyText": "\ud83d\udc4d", "author": "DeltaRays", "createdAt": "2020-07-27T13:59:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwNDAzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE5Nzc4MQ==", "url": "https://github.com/SkriptLang/Skript/pull/3228#discussion_r496197781", "bodyText": "can you please cache the result of the methodExists calls?", "author": "Pikachu920", "createdAt": "2020-09-28T19:58:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwNDAzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjIwMDI3MQ==", "url": "https://github.com/SkriptLang/Skript/pull/3228#discussion_r496200271", "bodyText": "can\u2019t believe I missed that \ud83d\ude14\ud83d\ude14", "author": "APickledWalrus", "createdAt": "2020-09-28T20:02:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwNDAzOQ=="}], "type": "inlineReview"}, {"oid": "d091d34260052e70e2914c7e9ccb3335419b10b8", "url": "https://github.com/SkriptLang/Skript/commit/d091d34260052e70e2914c7e9ccb3335419b10b8", "message": "Merge branch 'master' into ExprDropsOfBlock", "committedDate": "2020-07-27T13:56:28Z", "type": "commit"}, {"oid": "338c0d17f5a01770ba8a651c048a5c15f4748984", "url": "https://github.com/SkriptLang/Skript/commit/338c0d17f5a01770ba8a651c048a5c15f4748984", "message": "Used ArrayList's instead of Arrays, updated everything to use itemtypes, and supported getting drops of multiple blocks", "committedDate": "2020-07-27T16:17:18Z", "type": "commit"}, {"oid": "4c1af7de9d1884b626465a7391f934e7fa8b2a94", "url": "https://github.com/SkriptLang/Skript/commit/4c1af7de9d1884b626465a7391f934e7fa8b2a94", "message": "Merge branch 'master' into ExprDropsOfBlock", "committedDate": "2020-07-28T07:04:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzIyNjQ5Mg==", "url": "https://github.com/SkriptLang/Skript/pull/3228#discussion_r463226492", "bodyText": "Can you put each pattern on it's own line?", "author": "APickledWalrus", "createdAt": "2020-07-30T19:37:33Z", "path": "src/main/java/ch/njol/skript/expressions/ExprDropsOfBlock.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import java.util.ArrayList;\n+\n+import org.bukkit.block.Block;\n+import org.bukkit.entity.Entity;\n+import org.bukkit.event.Event;\n+import org.bukkit.inventory.ItemStack;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.aliases.ItemType;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser.ParseResult;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.log.ErrorQuality;\n+import ch.njol.util.Kleenean;\n+\n+@Name(\"Drops Of Block\")\n+@Description(\"A list of the items that will drop when a block is broken. Note that 'as %entity%' only works on minecraft 1.15+.\")\n+@Examples({\"on break of block:\",\n+\t\"\\tgive drops of block using player's tool to player\"})\n+@Since(\"INSERT VERSION\")\n+public class ExprDropsOfBlock extends SimpleExpression<ItemType> {\n+\t\n+\tstatic {\n+\t\tSkript.registerExpression(ExprDropsOfBlock.class, ItemType.class, ExpressionType.COMBINED, \"drops of %blocks% [(using|with) %-itemtype% [(1\u00a6as %-entity%)]]\", \"%blocks%'s drops [(using|with) %-itemtype% [(1\u00a6as %-entity%)]]\");", "originalCommit": "4c1af7de9d1884b626465a7391f934e7fa8b2a94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzIyODQ4OA==", "url": "https://github.com/SkriptLang/Skript/pull/3228#discussion_r463228488", "bodyText": "The 'as %entity%' note would probably be better in the RequiredPlugins annotation", "author": "APickledWalrus", "createdAt": "2020-07-30T19:41:33Z", "path": "src/main/java/ch/njol/skript/expressions/ExprDropsOfBlock.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import java.util.ArrayList;\n+\n+import org.bukkit.block.Block;\n+import org.bukkit.entity.Entity;\n+import org.bukkit.event.Event;\n+import org.bukkit.inventory.ItemStack;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.aliases.ItemType;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser.ParseResult;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.log.ErrorQuality;\n+import ch.njol.util.Kleenean;\n+\n+@Name(\"Drops Of Block\")\n+@Description(\"A list of the items that will drop when a block is broken. Note that 'as %entity%' only works on minecraft 1.15+.\")", "originalCommit": "4c1af7de9d1884b626465a7391f934e7fa8b2a94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzIyODkxNg==", "url": "https://github.com/SkriptLang/Skript/pull/3228#discussion_r463228916", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\tSkript.error(\"'as %entity%' can only be used on minecraft 1.15+.\", ErrorQuality.SEMANTIC_ERROR);\n          \n          \n            \n            \t\t\tSkript.error(\"Getting the drops of a block as an entity is only possible on Minecraft 1.15+.\", ErrorQuality.SEMANTIC_ERROR);", "author": "APickledWalrus", "createdAt": "2020-07-30T19:42:24Z", "path": "src/main/java/ch/njol/skript/expressions/ExprDropsOfBlock.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import java.util.ArrayList;\n+\n+import org.bukkit.block.Block;\n+import org.bukkit.entity.Entity;\n+import org.bukkit.event.Event;\n+import org.bukkit.inventory.ItemStack;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.aliases.ItemType;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser.ParseResult;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.log.ErrorQuality;\n+import ch.njol.util.Kleenean;\n+\n+@Name(\"Drops Of Block\")\n+@Description(\"A list of the items that will drop when a block is broken. Note that 'as %entity%' only works on minecraft 1.15+.\")\n+@Examples({\"on break of block:\",\n+\t\"\\tgive drops of block using player's tool to player\"})\n+@Since(\"INSERT VERSION\")\n+public class ExprDropsOfBlock extends SimpleExpression<ItemType> {\n+\t\n+\tstatic {\n+\t\tSkript.registerExpression(ExprDropsOfBlock.class, ItemType.class, ExpressionType.COMBINED, \"drops of %blocks% [(using|with) %-itemtype% [(1\u00a6as %-entity%)]]\", \"%blocks%'s drops [(using|with) %-itemtype% [(1\u00a6as %-entity%)]]\");\n+\t}\n+\t\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<Block> block;\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<ItemType> item;\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<Entity> entity;\n+\t\n+\t@Override\n+\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, ParseResult parseResult) {\n+\t\tblock = (Expression<Block>) exprs[0];\n+\t\titem = (Expression<ItemType>) exprs[1];\n+\t\tif (!Skript.methodExists(Block.class, \"getDrops\", ItemStack.class, Entity.class) && parseResult.mark == 1) {\n+\t\t\tSkript.error(\"'as %entity%' can only be used on minecraft 1.15+.\", ErrorQuality.SEMANTIC_ERROR);", "originalCommit": "4c1af7de9d1884b626465a7391f934e7fa8b2a94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzIzMDc1MA==", "url": "https://github.com/SkriptLang/Skript/pull/3228#discussion_r463230750", "bodyText": "Could you add the using %itemtype% and as %entity% to this?", "author": "APickledWalrus", "createdAt": "2020-07-30T19:46:01Z", "path": "src/main/java/ch/njol/skript/expressions/ExprDropsOfBlock.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import java.util.ArrayList;\n+\n+import org.bukkit.block.Block;\n+import org.bukkit.entity.Entity;\n+import org.bukkit.event.Event;\n+import org.bukkit.inventory.ItemStack;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.aliases.ItemType;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser.ParseResult;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.log.ErrorQuality;\n+import ch.njol.util.Kleenean;\n+\n+@Name(\"Drops Of Block\")\n+@Description(\"A list of the items that will drop when a block is broken. Note that 'as %entity%' only works on minecraft 1.15+.\")\n+@Examples({\"on break of block:\",\n+\t\"\\tgive drops of block using player's tool to player\"})\n+@Since(\"INSERT VERSION\")\n+public class ExprDropsOfBlock extends SimpleExpression<ItemType> {\n+\t\n+\tstatic {\n+\t\tSkript.registerExpression(ExprDropsOfBlock.class, ItemType.class, ExpressionType.COMBINED, \"drops of %blocks% [(using|with) %-itemtype% [(1\u00a6as %-entity%)]]\", \"%blocks%'s drops [(using|with) %-itemtype% [(1\u00a6as %-entity%)]]\");\n+\t}\n+\t\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<Block> block;\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<ItemType> item;\n+\t@SuppressWarnings(\"null\")\n+\tprivate Expression<Entity> entity;\n+\t\n+\t@Override\n+\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, ParseResult parseResult) {\n+\t\tblock = (Expression<Block>) exprs[0];\n+\t\titem = (Expression<ItemType>) exprs[1];\n+\t\tif (!Skript.methodExists(Block.class, \"getDrops\", ItemStack.class, Entity.class) && parseResult.mark == 1) {\n+\t\t\tSkript.error(\"'as %entity%' can only be used on minecraft 1.15+.\", ErrorQuality.SEMANTIC_ERROR);\n+\t\t\treturn false;\n+\t\t}\n+\t\tentity = (Expression<Entity>) exprs[2];\n+\t\treturn true;\n+\t}\n+\t\n+\t@Nullable\n+\t@Override\n+\t@SuppressWarnings(\"null\")\n+\tprotected ItemType[] get(Event e) {\n+\t\t@Nullable\n+\t\tBlock[] blocks = this.block.getArray(e);\n+\t\tif (block != null) {\n+\t\t\tif (this.item == null) {\n+\t\t\t\tArrayList<ItemType> list = new ArrayList<>();\n+\t\t\t\tfor (Block block : blocks) {\n+\t\t\t\t\tItemStack[] drops = block.getDrops().toArray(new ItemStack[0]);\n+\t\t\t\t\tfor (ItemStack drop : drops) {\n+\t\t\t\t\t\tlist.add(new ItemType(drop));\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\treturn list.toArray(new ItemType[0]);\n+\t\t\t} else if (this.entity != null) {\n+\t\t\t\tItemType item = this.item.getSingle(e);\n+\t\t\t\tEntity entity = this.entity.getSingle(e);\n+\t\t\t\tArrayList<ItemType> list = new ArrayList<>();\n+\t\t\t\tfor (Block block : blocks) {\n+\t\t\t\t\tItemStack[] drops = block.getDrops(item.getRandom(), entity).toArray(new ItemStack[0]);\n+\t\t\t\t\tfor (ItemStack drop : drops) {\n+\t\t\t\t\t\tlist.add(new ItemType(drop));\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\treturn list.toArray(new ItemType[0]);\n+\t\t\t} else {\n+\t\t\t\tItemType item = this.item.getSingle(e);\n+\t\t\t\tArrayList<ItemType> list = new ArrayList<>();\n+\t\t\t\tfor (Block block : blocks) {\n+\t\t\t\t\tItemStack[] drops = block.getDrops(item.getRandom()).toArray(new ItemStack[0]);\n+\t\t\t\t\tfor (ItemStack drop : drops) {\n+\t\t\t\t\t\tlist.add(new ItemType(drop));\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\treturn list.toArray(new ItemType[0]);\n+\t\t\t}\n+\t\t}\n+\t\treturn null;\n+\t}\n+\t\n+\t@Override\n+\tpublic boolean isSingle() {\n+\t\treturn false;\n+\t}\n+\t\n+\t@Override\n+\tpublic Class<? extends ItemType> getReturnType() {\n+\t\treturn ItemType.class;\n+\t}\n+\t\n+\t@Override\n+\tpublic String toString(@Nullable Event e, boolean debug) {\n+\t\treturn \"drops of \" + block.toString(e, debug);", "originalCommit": "4c1af7de9d1884b626465a7391f934e7fa8b2a94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "15e7f8ac0ff83456f626f7e7340f02ab471fb455", "url": "https://github.com/SkriptLang/Skript/commit/15e7f8ac0ff83456f626f7e7340f02ab471fb455", "message": "Merge branch 'master' into ExprDropsOfBlock", "committedDate": "2020-07-30T22:12:21Z", "type": "commit"}, {"oid": "787531a5ef758cf1b905d8a9a5d5eae9293dfb6f", "url": "https://github.com/SkriptLang/Skript/commit/787531a5ef758cf1b905d8a9a5d5eae9293dfb6f", "message": "Fixed everything", "committedDate": "2020-07-30T22:13:50Z", "type": "commit"}, {"oid": "6d4926e43d754569cce9ac0fb1e85f4ca29c17e0", "url": "https://github.com/SkriptLang/Skript/commit/6d4926e43d754569cce9ac0fb1e85f4ca29c17e0", "message": "Merge remote-tracking branch 'origin/ExprDropsOfBlock' into ExprDropsOfBlock", "committedDate": "2020-07-30T22:14:04Z", "type": "commit"}, {"oid": "d77bbe1b31103d9153ec117d52a79e567af59d8c", "url": "https://github.com/SkriptLang/Skript/commit/d77bbe1b31103d9153ec117d52a79e567af59d8c", "message": "Merge branch 'master' into ExprDropsOfBlock", "committedDate": "2020-08-02T16:16:39Z", "type": "commit"}, {"oid": "26050ee9b67cb3b814957f0df0ec501cdad56f0d", "url": "https://github.com/SkriptLang/Skript/commit/26050ee9b67cb3b814957f0df0ec501cdad56f0d", "message": "Merge branch 'master' into ExprDropsOfBlock", "committedDate": "2020-09-08T18:18:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ4MTUxMg==", "url": "https://github.com/SkriptLang/Skript/pull/3228#discussion_r495481512", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\"drops of %blocks% [(using|with) %-itemtype% [(1\u00a6as %-entity%)]]\",\n          \n          \n            \n            \t\t\t\"(all of the|all the|all) drops of %blocks% [(using|with) %-itemtype% [(1\u00a6as %-entity%)]]\",", "author": "APickledWalrus", "createdAt": "2020-09-26T18:13:42Z", "path": "src/main/java/ch/njol/skript/expressions/ExprDropsOfBlock.java", "diffHunk": "@@ -0,0 +1,134 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import java.util.ArrayList;\n+\n+import org.bukkit.block.Block;\n+import org.bukkit.entity.Entity;\n+import org.bukkit.event.Event;\n+import org.bukkit.inventory.ItemStack;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.aliases.ItemType;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.RequiredPlugins;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser.ParseResult;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.log.ErrorQuality;\n+import ch.njol.util.Kleenean;\n+\n+@Name(\"Drops Of Block\")\n+@Description(\"A list of the items that will drop when a block is broken.\")\n+@RequiredPlugins(\"Minecraft 1.15+ ('as %entity%')\")\n+@Examples({\"on break of block:\",\n+\t\"\\tgive drops of block using player's tool to player\"})\n+@Since(\"INSERT VERSION\")\n+public class ExprDropsOfBlock extends SimpleExpression<ItemType> {\n+\t\n+\tstatic {\n+\t\tSkript.registerExpression(ExprDropsOfBlock.class, ItemType.class, ExpressionType.COMBINED,\n+\t\t\t\"drops of %blocks% [(using|with) %-itemtype% [(1\u00a6as %-entity%)]]\",", "originalCommit": "26050ee9b67cb3b814957f0df0ec501cdad56f0d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "61be4cd52087c4ffff402f46308416e59310e081", "url": "https://github.com/SkriptLang/Skript/commit/61be4cd52087c4ffff402f46308416e59310e081", "message": "Merge branch 'master' into ExprDropsOfBlock", "committedDate": "2020-09-26T18:31:44Z", "type": "commit"}, {"oid": "d547283e0566f6368b058e77632d8e70ad036c3b", "url": "https://github.com/SkriptLang/Skript/commit/d547283e0566f6368b058e77632d8e70ad036c3b", "message": "Updated the pattern", "committedDate": "2020-09-26T18:51:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUwMjcxMg==", "url": "https://github.com/SkriptLang/Skript/pull/3228#discussion_r495502712", "bodyText": "My suggestion was flawed - sorry about that!\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\"[(all|all [of] the)] drops of %blocks% [(using|with) %-itemtype% [(1\u00a6as %-entity%)]]\",\n          \n          \n            \n            \t\t\t\"[(all|the|all [of] the)] drops of %blocks% [(using|with) %-itemtype% [(1\u00a6as %-entity%)]]\",", "author": "APickledWalrus", "createdAt": "2020-09-26T22:43:04Z", "path": "src/main/java/ch/njol/skript/expressions/ExprDropsOfBlock.java", "diffHunk": "@@ -0,0 +1,134 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import java.util.ArrayList;\n+\n+import org.bukkit.block.Block;\n+import org.bukkit.entity.Entity;\n+import org.bukkit.event.Event;\n+import org.bukkit.inventory.ItemStack;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.aliases.ItemType;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.RequiredPlugins;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser.ParseResult;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.log.ErrorQuality;\n+import ch.njol.util.Kleenean;\n+\n+@Name(\"Drops Of Block\")\n+@Description(\"A list of the items that will drop when a block is broken.\")\n+@RequiredPlugins(\"Minecraft 1.15+ ('as %entity%')\")\n+@Examples({\"on break of block:\",\n+\t\"\\tgive drops of block using player's tool to player\"})\n+@Since(\"INSERT VERSION\")\n+public class ExprDropsOfBlock extends SimpleExpression<ItemType> {\n+\t\n+\tstatic {\n+\t\tSkript.registerExpression(ExprDropsOfBlock.class, ItemType.class, ExpressionType.COMBINED,\n+\t\t\t\"[(all|all [of] the)] drops of %blocks% [(using|with) %-itemtype% [(1\u00a6as %-entity%)]]\",", "originalCommit": "d547283e0566f6368b058e77632d8e70ad036c3b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6ec2e368cf5a914775b9cedbc023eeaa9b32786f", "url": "https://github.com/SkriptLang/Skript/commit/6ec2e368cf5a914775b9cedbc023eeaa9b32786f", "message": "Update src/main/java/ch/njol/skript/expressions/ExprDropsOfBlock.java\n\nCo-authored-by: APickledWalrus <apickledwalrus@gmail.com>", "committedDate": "2020-09-27T04:35:13Z", "type": "commit"}, {"oid": "0c9eb2e7b3f463a2d14ddcdf39122bc5deb7d744", "url": "https://github.com/SkriptLang/Skript/commit/0c9eb2e7b3f463a2d14ddcdf39122bc5deb7d744", "message": "Quick fix from phone", "committedDate": "2020-09-28T20:37:57Z", "type": "commit"}, {"oid": "e2d24957289433db4a9355cd3afb6980251044ea", "url": "https://github.com/SkriptLang/Skript/commit/e2d24957289433db4a9355cd3afb6980251044ea", "message": "Merge branch 'master' into ExprDropsOfBlock", "committedDate": "2020-10-05T06:46:02Z", "type": "commit"}, {"oid": "bf50fbf74fa9151c406ed03853720cde97928289", "url": "https://github.com/SkriptLang/Skript/commit/bf50fbf74fa9151c406ed03853720cde97928289", "message": "Merge branch 'master' into ExprDropsOfBlock", "committedDate": "2020-10-05T15:45:16Z", "type": "commit"}, {"oid": "f7fb63f1d175f7b03ce653ea570993d7ea6af746", "url": "https://github.com/SkriptLang/Skript/commit/f7fb63f1d175f7b03ce653ea570993d7ea6af746", "message": "Updated license", "committedDate": "2020-10-05T15:50:42Z", "type": "commit"}, {"oid": "8b23778bc87bce6717ca821b57b65c06f863fa5e", "url": "https://github.com/SkriptLang/Skript/commit/8b23778bc87bce6717ca821b57b65c06f863fa5e", "message": "Broken files commit", "committedDate": "2020-10-05T15:51:56Z", "type": "commit"}, {"oid": "07db4fbf909fd903f6f1f5efc313046998c93331", "url": "https://github.com/SkriptLang/Skript/commit/07db4fbf909fd903f6f1f5efc313046998c93331", "message": "Merge remote-tracking branch 'origin/ExprDropsOfBlock' into ExprDropsOfBlock", "committedDate": "2020-10-05T15:52:10Z", "type": "commit"}, {"oid": "810cb890dbe774c3559b5e6ddebeb72b07455311", "url": "https://github.com/SkriptLang/Skript/commit/810cb890dbe774c3559b5e6ddebeb72b07455311", "message": "Merge branch 'master' into ExprDropsOfBlock", "committedDate": "2020-10-06T22:28:21Z", "type": "commit"}, {"oid": "291039a93f726f6706a92e15130edc0ad5d56eb5", "url": "https://github.com/SkriptLang/Skript/commit/291039a93f726f6706a92e15130edc0ad5d56eb5", "message": "Merge branch 'dev-2.5' into ExprDropsOfBlock", "committedDate": "2020-10-06T22:28:53Z", "type": "commit"}, {"oid": "7173f87a6aa51d6aba8b3ff773475aad6fa2447f", "url": "https://github.com/SkriptLang/Skript/commit/7173f87a6aa51d6aba8b3ff773475aad6fa2447f", "message": "Merge branch 'dev-2.5' into ExprDropsOfBlock", "committedDate": "2020-10-06T22:31:40Z", "type": "commit"}]}