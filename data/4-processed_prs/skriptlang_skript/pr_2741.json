{"pr_number": 2741, "pr_title": "EffBan - add an optional time span to temp ban a player", "pr_createdAt": "2020-01-03T10:43:14Z", "pr_url": "https://github.com/SkriptLang/Skript/pull/2741", "timeline": [{"oid": "a5c65fd4cbc3b6fed03fa049820ba699fe73ffd0", "url": "https://github.com/SkriptLang/Skript/commit/a5c65fd4cbc3b6fed03fa049820ba699fe73ffd0", "message": "EffBan - add an optional time span to temp ban a player", "committedDate": "2020-01-03T10:41:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjkxMDg4NQ==", "url": "https://github.com/SkriptLang/Skript/pull/2741#discussion_r362910885", "bodyText": "getSingle may be null, so it's not safe to call getMS right away", "author": "Pikachu920", "createdAt": "2020-01-03T18:24:23Z", "path": "src/main/java/ch/njol/skript/effects/EffBan.java", "diffHunk": "@@ -73,15 +76,17 @@\n \tpublic boolean init(final Expression<?>[] exprs, final int matchedPattern, final Kleenean isDelayed, final ParseResult parseResult) {\r\n \t\tplayers = exprs[0];\r\n \t\treason = exprs.length > 1 ? (Expression<String>) exprs[1] : null;\r\n+\t\texpires = exprs.length > 1 ? (Expression<Timespan>) exprs[2] : null;\r\n \t\tban = matchedPattern % 2 == 0;\r\n \t\tipBan = matchedPattern >= 2;\r\n \t\treturn true;\r\n \t}\r\n \t\r\n+\t@SuppressWarnings(\"null\")\r\n \t@Override\r\n \tprotected void execute(final Event e) {\r\n \t\tfinal String reason = this.reason != null ? this.reason.getSingle(e) : null; // don't check for null, just ignore an invalid reason\r\n-\t\tfinal Date expires = null;\r\n+\t\tfinal Date expires = this.expires != null ? new Date(System.currentTimeMillis() + this.expires.getSingle(e).getMilliSeconds()) : null;\r", "originalCommit": "a5c65fd4cbc3b6fed03fa049820ba699fe73ffd0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjkzMjQ5NA==", "url": "https://github.com/SkriptLang/Skript/pull/2741#discussion_r362932494", "bodyText": "Arg Skript ... I tell ya! haha! I was trying to keep this as neat and tidy as possible, but nope. Ill do a quick little fix for this, hope it doesn't get too messy.\nEDIT:\nFixed.", "author": "ShaneBeee", "createdAt": "2020-01-03T19:31:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjkxMDg4NQ=="}], "type": "inlineReview"}, {"oid": "13f94e693bfb3b160f7501fb0d5d01a4887795bf", "url": "https://github.com/SkriptLang/Skript/commit/13f94e693bfb3b160f7501fb0d5d01a4887795bf", "message": "EffBan - Prevent null from timespan", "committedDate": "2020-01-03T19:37:24Z", "type": "commit"}, {"oid": "22f1b688a34e58cd935997c9b06bc6fefb447083", "url": "https://github.com/SkriptLang/Skript/commit/22f1b688a34e58cd935997c9b06bc6fefb447083", "message": "Revert \"EffBan - Prevent null from timespan\"\n\nThis reverts commit 13f94e69", "committedDate": "2020-01-03T19:38:45Z", "type": "commit"}, {"oid": "7545b4f071bf62eeb0af5f363a8ed3a66914132c", "url": "https://github.com/SkriptLang/Skript/commit/7545b4f071bf62eeb0af5f363a8ed3a66914132c", "message": "EffBan - Prevent null from timespan", "committedDate": "2020-01-03T19:39:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0MjY5NA==", "url": "https://github.com/SkriptLang/Skript/pull/2741#discussion_r364442694", "bodyText": "is it really a good idea to permaban people if the timespan happened to be not set?", "author": "Pikachu920", "createdAt": "2020-01-08T21:05:35Z", "path": "src/main/java/ch/njol/skript/effects/EffBan.java", "diffHunk": "@@ -73,15 +76,18 @@\n \tpublic boolean init(final Expression<?>[] exprs, final int matchedPattern, final Kleenean isDelayed, final ParseResult parseResult) {\r\n \t\tplayers = exprs[0];\r\n \t\treason = exprs.length > 1 ? (Expression<String>) exprs[1] : null;\r\n+\t\texpires = exprs.length > 1 ? (Expression<Timespan>) exprs[2] : null;\r\n \t\tban = matchedPattern % 2 == 0;\r\n \t\tipBan = matchedPattern >= 2;\r\n \t\treturn true;\r\n \t}\r\n \t\r\n+\t@SuppressWarnings(\"null\")\r\n \t@Override\r\n \tprotected void execute(final Event e) {\r\n \t\tfinal String reason = this.reason != null ? this.reason.getSingle(e) : null; // don't check for null, just ignore an invalid reason\r\n-\t\tfinal Date expires = null;\r\n+\t\tTimespan ts = this.expires != null ? this.expires.getSingle(e) : null;\r\n+\t\tfinal Date expires = ts != null ? new Date(System.currentTimeMillis() + ts.getMilliSeconds()) : null;\r", "originalCommit": "7545b4f071bf62eeb0af5f363a8ed3a66914132c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0NjAyMQ==", "url": "https://github.com/SkriptLang/Skript/pull/2741#discussion_r364446021", "bodyText": "I mean, in all fairness that is up to the Skripter to decide how they want to ban. If they don't choose a timespan then they know its going to be permanent.", "author": "ShaneBeee", "createdAt": "2020-01-08T21:14:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0MjY5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ1NTY2NQ==", "url": "https://github.com/SkriptLang/Skript/pull/2741#discussion_r364455665", "bodyText": "yeah but with this ban player for {_null var} is a permaban", "author": "Pikachu920", "createdAt": "2020-01-08T21:38:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0MjY5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ4MzA3MQ==", "url": "https://github.com/SkriptLang/Skript/pull/2741#discussion_r364483071", "bodyText": "Ah good point. Do you have a suggestion for a better way around this?", "author": "ShaneBeee", "createdAt": "2020-01-08T22:51:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0MjY5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDc3MTExMA==", "url": "https://github.com/SkriptLang/Skript/pull/2741#discussion_r364771110", "bodyText": "just return like other effects do? i feel like it's slightly better to not ban them rather than perma them but i'm not sure... at least it'd be consistent", "author": "Pikachu920", "createdAt": "2020-01-09T14:35:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0MjY5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDc3MTQxMw==", "url": "https://github.com/SkriptLang/Skript/pull/2741#discussion_r364771413", "bodyText": "alternatively we can implement dice using armor stands and force the banned players to roll them in order to determine how long they get banned for.\ni like that idea", "author": "Pikachu920", "createdAt": "2020-01-09T14:36:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0MjY5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg2MDY5MA==", "url": "https://github.com/SkriptLang/Skript/pull/2741#discussion_r364860690", "bodyText": "alternatively we can implement dice using armor stands and force the banned players to roll them in order to determine how long they get banned for.\ni like that idea\n\nhahahahaha, OMG.\n\njust return like other effects do? i feel like it's slightly better to not ban them rather than perma them but i'm not sure... at least it'd be consistent\n\nsounds good. Ill start working on that.\nMy only fear here though is what if said var is null, and you THINK You are banning a player, then you aren't actually banning them. Do you think people will complain \"But I banned them and they aren't banned?!?\"\nMaybe send a console warning/error?", "author": "ShaneBeee", "createdAt": "2020-01-09T17:12:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0MjY5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTA2MDE0MA==", "url": "https://github.com/SkriptLang/Skript/pull/2741#discussion_r365060140", "bodyText": "Ok I added a check for the time span equaling null. Im also throwing a small error to the console to let them know they were not successfully banned.\nIm 50/50 on the error, due to the fact that many server owners/staff don't actually look at the console and this message may be useless.\nWhat is your input on that? If you think I should remove it, I can remove it.", "author": "ShaneBeee", "createdAt": "2020-01-10T03:31:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0MjY5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ1NDU3Nw==", "url": "https://github.com/SkriptLang/Skript/pull/2741#discussion_r365454577", "bodyText": "Generally, errors written to console are not very useful. We should instead update the documentation to indicate what happens if ban length is not given. That, or permaban the players; I assume that most server owners have some way for players to appeal bans.", "author": "bensku", "createdAt": "2020-01-10T22:24:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0MjY5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ1NTMwMA==", "url": "https://github.com/SkriptLang/Skript/pull/2741#discussion_r365455300", "bodyText": "Ok, I will definitely remove the message.\nIm more in favour of perma banning the player vs no ban at all, so I will revery back to that.", "author": "ShaneBeee", "createdAt": "2020-01-10T22:27:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0MjY5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ1NjQyMQ==", "url": "https://github.com/SkriptLang/Skript/pull/2741#discussion_r365456421", "bodyText": "Ok, I have applied said changes.", "author": "ShaneBeee", "createdAt": "2020-01-10T22:31:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0MjY5NA=="}], "type": "inlineReview"}, {"oid": "3911d0e79874b913681be8afad3d902fa260efae", "url": "https://github.com/SkriptLang/Skript/commit/3911d0e79874b913681be8afad3d902fa260efae", "message": "EffBan - prevent perma banning if timespan = null", "committedDate": "2020-01-10T03:29:57Z", "type": "commit"}, {"oid": "f7e9148dc84f9471e995986c1bd116f7b70f351e", "url": "https://github.com/SkriptLang/Skript/commit/f7e9148dc84f9471e995986c1bd116f7b70f351e", "message": "EffBan - removed error message, revert back to perm ban if timespan = null, updated description to let users know of this", "committedDate": "2020-01-10T22:30:45Z", "type": "commit"}]}