{"pr_number": 645, "pr_title": "CXF-8222 OIDC Refresh Response: ID Token iat Claim MUST represent the time that the new ID Token is issued", "pr_createdAt": "2020-03-01T17:38:02Z", "pr_url": "https://github.com/apache/cxf/pull/645", "timeline": [{"oid": "7c8cb04907c491dd84a85ac1e81e1a9ee67c0320", "url": "https://github.com/apache/cxf/commit/7c8cb04907c491dd84a85ac1e81e1a9ee67c0320", "message": "CXF-8222 OIDC Refresh Response: ID Token iat Claim MUST represent the\ntime that the new ID Token is issued", "committedDate": "2020-03-01T17:31:37Z", "type": "commit"}, {"oid": "963470dfe8dcca8f5daf0e0105d0643b8aecea66", "url": "https://github.com/apache/cxf/commit/963470dfe8dcca8f5daf0e0105d0643b8aecea66", "message": "Merge remote-tracking branch 'cxf/master' into CXF-8222", "committedDate": "2020-03-02T07:56:15Z", "type": "commit"}, {"oid": "d5636943e92e3f3012b8b784a8cf15971156b641", "url": "https://github.com/apache/cxf/commit/d5636943e92e3f3012b8b784a8cf15971156b641", "message": "adjust test", "committedDate": "2020-03-02T07:57:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM3MjczNg==", "url": "https://github.com/apache/cxf/pull/645#discussion_r386372736", "bodyText": "Could you explain the logic here? Why set issued at / expiry only if st.getResponseType() is null?", "author": "coheigea", "createdAt": "2020-03-02T12:49:26Z", "path": "rt/rs/security/sso/oidc/src/main/java/org/apache/cxf/rs/security/oidc/idp/IdTokenResponseFilter.java", "diffHunk": "@@ -78,7 +78,12 @@ private String getProcessedIdToken(ServerAccessToken st) {\n                 idToken.setAudience(st.getClient().getClientId());\n                 idToken.setAuthorizedParty(st.getClient().getClientId());\n                 // if this token was refreshed then the cloned IDToken might need to have its\n-                // issuedAt and expiry time properties adjusted if it proves to be necessary\n+                // issuedAt and expiry time properties adjusted\n+                if (null == st.getResponseType()) {\n+                    final Long iat = st.getIssuedAt();\n+                    idToken.setExpiryTime(iat + (idToken.getExpiryTime() - idToken.getIssuedAt()));\n+                    idToken.setIssuedAt(iat);\n+                }", "originalCommit": "d5636943e92e3f3012b8b784a8cf15971156b641", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM3NjYyMw==", "url": "https://github.com/apache/cxf/pull/645#discussion_r386376623", "bodyText": "st.getResponseType() == null in case of request with param grant_type=refresh_token", "author": "amarkevich", "createdAt": "2020-03-02T12:57:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM3MjczNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE3NTgzNQ==", "url": "https://github.com/apache/cxf/pull/645#discussion_r387175835", "bodyText": "Is there a way instead we can tell that grant_type=refresh_token was used in the call?", "author": "coheigea", "createdAt": "2020-03-03T17:24:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM3MjczNg=="}], "type": "inlineReview"}, {"oid": "934cb96848468e05b6ec829182b03624b6bee9b5", "url": "https://github.com/apache/cxf/commit/934cb96848468e05b6ec829182b03624b6bee9b5", "message": "Merge remote-tracking branch 'origin/master' into CXF-8222", "committedDate": "2020-03-05T12:50:29Z", "type": "commit"}, {"oid": "0286e8bc16e39054a02ceeadf67b3733e48e1fbb", "url": "https://github.com/apache/cxf/commit/0286e8bc16e39054a02ceeadf67b3733e48e1fbb", "message": "set \"refresh_token\" grantType in RefreshTokenGrantHandler", "committedDate": "2020-03-05T18:53:57Z", "type": "commit"}]}