{"pr_number": 641, "pr_title": "Prevent RMI registry rebind", "pr_createdAt": "2020-02-17T12:14:17Z", "pr_url": "https://github.com/apache/cxf/pull/641", "timeline": [{"oid": "625a34b30db995c842959aa55c2c42f0c9c1e0b5", "url": "https://github.com/apache/cxf/commit/625a34b30db995c842959aa55c2c42f0c9c1e0b5", "message": "Prevent registry rebind", "committedDate": "2020-02-14T11:29:51Z", "type": "commit"}, {"oid": "71bb6d696fce4615356d8b48343771327c2d795f", "url": "https://github.com/apache/cxf/commit/71bb6d696fce4615356d8b48343771327c2d795f", "message": "Merge remote-tracking branch 'apache/master' into rmi-reg", "committedDate": "2020-02-14T11:44:41Z", "type": "commit"}, {"oid": "19713a7681db1dae7073d2ab0e0fde1a0dd2b70f", "url": "https://github.com/apache/cxf/commit/19713a7681db1dae7073d2ab0e0fde1a0dd2b70f", "message": "Add the RMI server when not running threaded", "committedDate": "2020-02-17T11:57:15Z", "type": "commit"}, {"oid": "57b744a5a9d33cc7831bbe310e1b068672ae83f1", "url": "https://github.com/apache/cxf/commit/57b744a5a9d33cc7831bbe310e1b068672ae83f1", "message": "Merge remote-tracking branch 'apache/master' into rmi-reg", "committedDate": "2020-02-17T12:12:26Z", "type": "commit"}, {"oid": "e502467138d4bc96a4b05c74e3308ee6f821cd52", "url": "https://github.com/apache/cxf/commit/e502467138d4bc96a4b05c74e3308ee6f821cd52", "message": "Update MBServerConnectorFactory.java", "committedDate": "2020-02-18T15:49:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDgyMDUyMA==", "url": "https://github.com/apache/cxf/pull/641#discussion_r380820520", "bodyText": "I'm just wondering what happens if we define a URL that doesn't end with jmxrmi....shouldn't we take the lookup name from the serviceUrl?", "author": "coheigea", "createdAt": "2020-02-18T17:23:24Z", "path": "rt/management/src/main/java/org/apache/cxf/management/jmx/MBServerConnectorFactory.java", "diffHunk": "@@ -169,18 +174,71 @@ public void run() {\n         } else {\n              // Start the connector server in the same thread.\n             connectorServer.start();\n+            remoteServerStub = rmiServer.toStub();\n         }\n \n         if (LOG.isLoggable(Level.INFO)) {\n             LOG.info(\"JMX connector server started: \" + connectorServer);\n         }\n     }\n \n+    static int getRegistryPort(final String url) {\n+        int serverStart = url.indexOf(\"/jndi/rmi://\");\n+        final String serverPart = url.substring(serverStart + 12);\n+        int portStart = serverPart.indexOf(':') + 1;\n+\n+        int portEnd;\n+        int port = 0;\n+        if (portStart > 0) {\n+            portEnd = indexNotOfNumber(serverPart, portStart);\n+            if (portEnd > portStart) {\n+                final String portString = serverPart.substring(portStart, portEnd);\n+                port = Integer.parseInt(portString);\n+            }\n+        }\n+        return port;\n+    }\n+\n     public void destroy() throws IOException {\n         connectorServer.stop();\n         if (LOG.isLoggable(Level.INFO)) {\n             LOG.info(\"JMX connector server stopped: \" + connectorServer);\n         }\n     }\n \n+    /*\n+     * Better to use the internal API than re-invent the wheel.\n+     */\n+    @SuppressWarnings(\"restriction\")\n+    private class JmxRegistry extends sun.rmi.registry.RegistryImpl {\n+        static final String LOOKUP_NAME = \"jmxrmi\";", "originalCommit": "e502467138d4bc96a4b05c74e3308ee6f821cd52", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDgyODY0Mg==", "url": "https://github.com/apache/cxf/pull/641#discussion_r380828642", "bodyText": "Good point. Let's see if we can do that in a smarter way.", "author": "jgallimore", "createdAt": "2020-02-18T17:38:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDgyMDUyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkxNDA3NA==", "url": "https://github.com/apache/cxf/pull/641#discussion_r380914074", "bodyText": "Hopefully done in the latest commit.", "author": "jgallimore", "createdAt": "2020-02-18T20:22:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDgyMDUyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTI0MTU2MA==", "url": "https://github.com/apache/cxf/pull/641#discussion_r381241560", "bodyText": "Looks good thanks", "author": "coheigea", "createdAt": "2020-02-19T11:45:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDgyMDUyMA=="}], "type": "inlineReview"}, {"oid": "14c6283ea57c5670c26552e63ed98420c6f9e3f0", "url": "https://github.com/apache/cxf/commit/14c6283ea57c5670c26552e63ed98420c6f9e3f0", "message": "Add compiler option for Java 11. Will look to see if there's a way to avoid the use of sun.rmi.registry altogether", "committedDate": "2020-02-18T17:27:17Z", "type": "commit"}, {"oid": "9c386fa25063baeefbb83d4792ab742bc604a5c9", "url": "https://github.com/apache/cxf/commit/9c386fa25063baeefbb83d4792ab742bc604a5c9", "message": "Merge branch 'rmi-reg' of github.com:jgallimore/cxf into rmi-reg", "committedDate": "2020-02-18T17:28:10Z", "type": "commit"}, {"oid": "6497cbe9da35a6e747330fdd5b675b4f6e1ba45d", "url": "https://github.com/apache/cxf/commit/6497cbe9da35a6e747330fdd5b675b4f6e1ba45d", "message": "Identify the lookup name from the JMX URL", "committedDate": "2020-02-18T20:18:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMzNjY5Mw==", "url": "https://github.com/apache/cxf/pull/641#discussion_r381336693", "bodyText": "Could we make this protected? And add a test for it?", "author": "coheigea", "createdAt": "2020-02-19T14:45:46Z", "path": "rt/management/src/main/java/org/apache/cxf/management/jmx/MBServerConnectorFactory.java", "diffHunk": "@@ -169,18 +176,85 @@ public void run() {\n         } else {\n              // Start the connector server in the same thread.\n             connectorServer.start();\n+            remoteServerStub = rmiServer.toStub();\n         }\n \n         if (LOG.isLoggable(Level.INFO)) {\n             LOG.info(\"JMX connector server started: \" + connectorServer);\n         }\n     }\n \n+    static int getRegistryPort(final String url) {\n+        int serverStart = url.indexOf(\"/jndi/rmi://\");\n+        final String serverPart = url.substring(serverStart + 12);\n+        int portStart = serverPart.indexOf(':') + 1;\n+\n+        int portEnd;\n+        int port = 0;\n+        if (portStart > 0) {\n+            portEnd = indexNotOfNumber(serverPart, portStart);\n+            if (portEnd > portStart) {\n+                final String portString = serverPart.substring(portStart, portEnd);\n+                port = Integer.parseInt(portString);\n+            }\n+        }\n+        return port;\n+    }\n+\n+    public static String getBindingName(final JMXServiceURL jmxServiceURL) {", "originalCommit": "6497cbe9da35a6e747330fdd5b675b4f6e1ba45d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "96d2a1962ff8483c622b8efbd526408a825fb9a5", "url": "https://github.com/apache/cxf/commit/96d2a1962ff8483c622b8efbd526408a825fb9a5", "message": "Adding unit test for getBindingName()", "committedDate": "2020-02-19T15:38:16Z", "type": "commit"}, {"oid": "e010f835853c5a2a1f9c4628cf1ffac546d6f3f0", "url": "https://github.com/apache/cxf/commit/e010f835853c5a2a1f9c4628cf1ffac546d6f3f0", "message": "Merge remote-tracking branch 'apache/master' into rmi-reg", "committedDate": "2020-02-19T16:41:55Z", "type": "commit"}, {"oid": "aa5f56c2028466580710f4e5877363aa5c23c246", "url": "https://github.com/apache/cxf/commit/aa5f56c2028466580710f4e5877363aa5c23c246", "message": "Re-instating test removed by mistake", "committedDate": "2020-02-20T08:22:00Z", "type": "commit"}]}