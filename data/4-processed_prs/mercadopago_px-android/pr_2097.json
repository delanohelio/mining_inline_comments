{"pr_number": 2097, "pr_title": "[feature] ifpe congrats", "pr_createdAt": "2020-04-02T23:46:55Z", "pr_url": "https://github.com/mercadopago/px-android/pull/2097", "timeline": [{"oid": "ba72c2bf0e7980174a92259bfbcef4adc154cf67", "url": "https://github.com/mercadopago/px-android/commit/ba72c2bf0e7980174a92259bfbcef4adc154cf67", "message": "* Added top text box and view receipt components", "committedDate": "2020-04-02T23:49:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY2MDc0MA==", "url": "https://github.com/mercadopago/px-android/pull/2097#discussion_r402660740", "bodyText": "El true lo voy a cambiar cuando tenga armado el callback de kyc, por ahora lo dejo hardcodeado", "author": "cgaggino", "createdAt": "2020-04-02T23:52:32Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/CongratsRepositoryImpl.kt", "diffHunk": "@@ -53,23 +53,27 @@ class CongratsRepositoryImpl(private val congratsService: CongratsService,\n     private suspend fun getPaymentReward(payment: IPaymentDescriptor, paymentResult: PaymentResult) =\n         try {\n             val joinedPaymentIds = TextUtil.join(payment.paymentIds)\n+            val joinedPaymentMethodsIds = paymentResult.paymentDataList\n+                .joinToString(TextUtil.CSV_DELIMITER) { p -> (p.paymentMethod.id) }\n             val campaignId = paymentResult.paymentData.campaign?.run { id } ?: \"\"\n-            val response = congratsService.getPaymentReward(BuildConfig.API_ENVIRONMENT, locale, privateKey,\n-                    joinedPaymentIds, platform, campaignId, flow).await()\n+            val response = congratsService.getCongrats(BuildConfig.API_ENVIRONMENT, locale, privateKey,\n+                joinedPaymentIds, platform, campaignId, true, joinedPaymentMethodsIds, flow).await()", "originalCommit": "ba72c2bf0e7980174a92259bfbcef4adc154cf67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY2MTMxNQ==", "url": "https://github.com/mercadopago/px-android/pull/2097#discussion_r402661315", "bodyText": "Por ahora uso este callback, pensaba en cambiarle el nombre a onClickDeepLinkButton pero me di cuenta que la implementaci\u00f3n hace un track de showAllDiscounts, quizas los tracks podrian estar dentro de la vista y no en el presenter? o armo otro callback que igual al de showAllDiscounts pero con otro track", "author": "cgaggino", "createdAt": "2020-04-02T23:54:27Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/view/PaymentResultBody.java", "diffHunk": "@@ -171,6 +181,20 @@ private void renderMethods(@NonNull final Model model) {\n         }\n     }\n \n+    private void renderViewReceipt(@Nullable final Action viewReceiptAction, final Listener listener) {\n+        final MeliButton viewReceiptButton = findViewById(R.id.view_receipt_action);\n+        final String target = viewReceiptAction != null ? viewReceiptAction.getTarget() : null;\n+        if (TextUtil.isNotEmpty(target) && isMPInstalled(getContext().getPackageManager())) {\n+            viewReceiptButton\n+                .setBackground(ContextCompat.getDrawable(getContext(), R.drawable.px_quiet_button_selector));\n+            viewReceiptButton.setText(viewReceiptAction.getLabel());\n+            viewReceiptButton.setOnClickListener(\n+                v -> listener.onClickShowAllDiscounts(target));", "originalCommit": "ba72c2bf0e7980174a92259bfbcef4adc154cf67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzAyODE3Mg==", "url": "https://github.com/mercadopago/px-android/pull/2097#discussion_r403028172", "bodyText": "por que usamos el .run aca? No podemos hacer campaign?.id?", "author": "jorGonzalez291292", "createdAt": "2020-04-03T14:03:13Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/CongratsRepositoryImpl.kt", "diffHunk": "@@ -53,23 +53,27 @@ class CongratsRepositoryImpl(private val congratsService: CongratsService,\n     private suspend fun getPaymentReward(payment: IPaymentDescriptor, paymentResult: PaymentResult) =\n         try {\n             val joinedPaymentIds = TextUtil.join(payment.paymentIds)\n+            val joinedPaymentMethodsIds = paymentResult.paymentDataList\n+                .joinToString(TextUtil.CSV_DELIMITER) { p -> (p.paymentMethod.id) }\n             val campaignId = paymentResult.paymentData.campaign?.run { id } ?: \"\"", "originalCommit": "ba72c2bf0e7980174a92259bfbcef4adc154cf67", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc3NTk5OQ==", "url": "https://github.com/mercadopago/px-android/pull/2097#discussion_r403775999", "bodyText": "mm no s\u00e9 la motivaci\u00f3n del que escribi\u00f3 eso, entiendo que si hiciera lo que vos decis quedaria null y no vacio, a priori.", "author": "cgaggino", "createdAt": "2020-04-05T23:56:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzAyODE3Mg=="}], "type": "inlineReview"}, {"oid": "b6bd047bfb0e84c17d02d50252381aff925cc0ab", "url": "https://github.com/mercadopago/px-android/commit/b6bd047bfb0e84c17d02d50252381aff925cc0ab", "message": "* Added top text box and view receipt components", "committedDate": "2020-04-05T23:43:57Z", "type": "commit"}, {"oid": "b6bd047bfb0e84c17d02d50252381aff925cc0ab", "url": "https://github.com/mercadopago/px-android/commit/b6bd047bfb0e84c17d02d50252381aff925cc0ab", "message": "* Added top text box and view receipt components", "committedDate": "2020-04-05T23:43:57Z", "type": "forcePushed"}]}