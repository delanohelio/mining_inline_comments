{"pr_number": 2184, "pr_title": "[Feature] experiment installments row", "pr_createdAt": "2020-06-10T15:48:55Z", "pr_url": "https://github.com/mercadopago/px-android/pull/2184", "timeline": [{"oid": "07a2af0d73de13962881625c0eeeec2bef93850d", "url": "https://github.com/mercadopago/px-android/commit/07a2af0d73de13962881625c0eeeec2bef93850d", "message": "init pulse view", "committedDate": "2020-05-27T23:49:03Z", "type": "commit"}, {"oid": "6151c9f5ad5d92e254401218246b4f1bc3b9bd0a", "url": "https://github.com/mercadopago/px-android/commit/6151c9f5ad5d92e254401218246b4f1bc3b9bd0a", "message": "circle arrow added", "committedDate": "2020-05-29T14:41:00Z", "type": "commit"}, {"oid": "68fb74d4e70c0d6b17e9bdfdf5e76f7fe0412409", "url": "https://github.com/mercadopago/px-android/commit/68fb74d4e70c0d6b17e9bdfdf5e76f7fe0412409", "message": "background added by android version", "committedDate": "2020-05-29T19:55:31Z", "type": "commit"}, {"oid": "91483d54cef575ee053008f8424d68bb5166297e", "url": "https://github.com/mercadopago/px-android/commit/91483d54cef575ee053008f8424d68bb5166297e", "message": "pulse animation", "committedDate": "2020-06-04T19:50:50Z", "type": "commit"}, {"oid": "2bcd0a0ffed9271130830406b20f5a21e94431b4", "url": "https://github.com/mercadopago/px-android/commit/2bcd0a0ffed9271130830406b20f5a21e94431b4", "message": "version resources added", "committedDate": "2020-06-04T19:51:27Z", "type": "commit"}, {"oid": "c5dd2a226d1872e6a15cb5ef46631d8dee682c28", "url": "https://github.com/mercadopago/px-android/commit/c5dd2a226d1872e6a15cb5ef46631d8dee682c28", "message": "refactor badge experiment", "committedDate": "2020-06-09T18:39:03Z", "type": "commit"}, {"oid": "5fcb6bc063756ec39bb4d45496889d4d0cbd3d62", "url": "https://github.com/mercadopago/px-android/commit/5fcb6bc063756ec39bb4d45496889d4d0cbd3d62", "message": "refactor experiment helper", "committedDate": "2020-06-09T18:43:21Z", "type": "commit"}, {"oid": "0734e96b4484ca718159130974729fbb50b8b8c2", "url": "https://github.com/mercadopago/px-android/commit/0734e96b4484ca718159130974729fbb50b8b8c2", "message": "has_interest_free and has_reimbursement extra_info added", "committedDate": "2020-06-10T14:35:45Z", "type": "commit"}, {"oid": "fab416a4533eefad54afb6354a97c4d654304677", "url": "https://github.com/mercadopago/px-android/commit/fab416a4533eefad54afb6354a97c4d654304677", "message": "unused classes are removed", "committedDate": "2020-06-10T14:42:48Z", "type": "commit"}, {"oid": "27b9c1c80b6bce64c4a95a2a3e9b115ad7988fdf", "url": "https://github.com/mercadopago/px-android/commit/27b9c1c80b6bce64c4a95a2a3e9b115ad7988fdf", "message": "refactor payment method descriptor", "committedDate": "2020-06-10T15:05:26Z", "type": "commit"}, {"oid": "67f7e80ead082734933f75742209a248434f1eef", "url": "https://github.com/mercadopago/px-android/commit/67f7e80ead082734933f75742209a248434f1eef", "message": "revert changes", "committedDate": "2020-06-10T15:08:50Z", "type": "commit"}, {"oid": "2b2313f486af761e4866df799921abd4ec388939", "url": "https://github.com/mercadopago/px-android/commit/2b2313f486af761e4866df799921abd4ec388939", "message": "refactor checkout service", "committedDate": "2020-06-10T15:32:42Z", "type": "commit"}, {"oid": "952a69c9516de6384d1cf7bda652b2d7faaef19a", "url": "https://github.com/mercadopago/px-android/commit/952a69c9516de6384d1cf7bda652b2d7faaef19a", "message": "resources removed", "committedDate": "2020-06-10T15:43:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIzNjk2Mw==", "url": "https://github.com/mercadopago/px-android/pull/2184#discussion_r438236963", "bodyText": "el presenter no deberia devolver cosas a la vista, quizas deba haber algun mecanismo de ida y vuelta onda\npresenter.onConfiguringViews()\ny en el presenter\nonConfiguringViews(){\nexperiments.add(getExperiment(1))\nexperiments.add(getExperiment(2))\nview.configurePaymentMethodHeader(experiments)\n}", "author": "cgaggino", "createdAt": "2020-06-10T16:01:29Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/express/ExpressPaymentFragment.java", "diffHunk": "@@ -206,6 +208,8 @@ public void onViewCreated(@NonNull final View view, @Nullable final Bundle saved\n             renderMode = (PaymentMethodFragmentAdapter.RenderMode) savedInstanceState.getSerializable(EXTRA_RENDER_MODE);\n             presenter.recoverFromBundle(savedInstanceState);\n         }\n+        paymentMethodHeaderView.configureBadgeExperiments(presenter.getExperiment(BadgeVariant.INSTANCE));\n+        paymentMethodHeaderView.configurePulseExperiments(presenter.getExperiment(PulseVariant.INSTANCE));", "originalCommit": "952a69c9516de6384d1cf7bda652b2d7faaef19a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI0NzE5Mg==", "url": "https://github.com/mercadopago/px-android/pull/2184#discussion_r438247192", "bodyText": "Dale, lo cambio", "author": "jorGonzalez291292", "createdAt": "2020-06-10T16:14:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIzNjk2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI1NzIxMA==", "url": "https://github.com/mercadopago/px-android/pull/2184#discussion_r438257210", "bodyText": "por que el model actualiza la vista? creo que har\u00eda directamente el\nViewUtils.resetDrawableBackgroundColor(rightText);", "author": "cgaggino", "createdAt": "2020-06-10T16:29:48Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/view/PaymentMethodDescriptorView.java", "diffHunk": "@@ -45,6 +50,12 @@ public void update(@NonNull final Model model) {\n         model.updateRightSpannable(rightSpannableBuilder, leftText);\n         rightText.setText(rightSpannableBuilder);\n         setContentDescription(TextUtil.EMPTY);\n+        model.updateDrawableBackground(rightText);", "originalCommit": "952a69c9516de6384d1cf7bda652b2d7faaef19a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI2NTY0Ng==", "url": "https://github.com/mercadopago/px-android/pull/2184#discussion_r438265646", "bodyText": "ah\u00ed vi que depende del tipo del modelo", "author": "cgaggino", "createdAt": "2020-06-10T16:43:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI1NzIxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI2MTI2MA==", "url": "https://github.com/mercadopago/px-android/pull/2184#discussion_r438261260", "bodyText": "Queda medio raro a nivel firma,\nEl metodo se llama configurePulse... y recibe un variantType que puede ser cualquier cosa y configura un pulse si no es Default\nYo lo que har\u00eda es que la vista reciba una lista de experimentos a configurar, la recorra y en base a los types de esos experimentos haga algo y si no, no haga nada", "author": "cgaggino", "createdAt": "2020-06-10T16:36:14Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/view/PaymentMethodHeaderView.java", "diffHunk": "@@ -77,11 +84,27 @@ public void setListener(final Listener listener) {\n                 } else {\n                     arrow.startAnimation(rotateUp);\n                     listener.onDescriptorViewClicked();\n+                    if (pulse != null) {\n+                        pulse.stopRippleAnimation();\n+                    }\n                 }\n             }\n         });\n     }\n \n+    public void configureBadgeExperiments(@NonNull final VariantType variantType) {\n+        titlePager.setExperimentVariant(variantType);\n+    }\n+\n+    public void configurePulseExperiments(@NonNull final VariantType variantType) {\n+        ExperimentHelper.INSTANCE.applyExperimentViewBy(experimentContainer, variantType);", "originalCommit": "952a69c9516de6384d1cf7bda652b2d7faaef19a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc0MDIwMg==", "url": "https://github.com/mercadopago/px-android/pull/2184#discussion_r438740202", "bodyText": "Cambiado", "author": "jorGonzalez291292", "createdAt": "2020-06-11T12:17:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI2MTI2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI2MzEyMw==", "url": "https://github.com/mercadopago/px-android/pull/2184#discussion_r438263123", "bodyText": "No entiendo el comment de pulse, badge si se llama solo para badge por lo que veo? podria llamarse configureExperiment para mantener consistencia, no?", "author": "cgaggino", "createdAt": "2020-06-10T16:39:19Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/view/TitlePager.java", "diffHunk": "@@ -33,6 +34,13 @@ private void init(final Context context) {\n         inflate(context, R.layout.px_view_title_pager, this);\n     }\n \n+    // pulse, badge\n+    public void setExperimentVariant(VariantType variantType) {", "originalCommit": "952a69c9516de6384d1cf7bda652b2d7faaef19a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI2OTA0Nw==", "url": "https://github.com/mercadopago/px-android/pull/2184#discussion_r438269047", "bodyText": "La verdad no recuerdo el por que de ese comment. Lo saco.", "author": "jorGonzalez291292", "createdAt": "2020-06-10T16:49:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI2MzEyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI2ODc2Ng==", "url": "https://github.com/mercadopago/px-android/pull/2184#discussion_r438268766", "bodyText": "Yo no pondria esto, como que estamos modificando el modelo por el experiment, el modelo tiene internamente el payerCostSelected, podemos hacer esa validaci\u00f3n ahi adentro en vez de agregar el boolean. De todas formas de quedar as\u00ed lo haria mas abstracto, tipo justamente un boolean de \"installmentSelected: true|false\" en el modelo", "author": "cgaggino", "createdAt": "2020-06-10T16:48:47Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/express/slider/TitlePagerAdapter.java", "diffHunk": "@@ -64,6 +64,9 @@ private void refreshData(final int currentIndex, final int payerCostSelected,\n         }\n \n         final PaymentMethodDescriptorView.Model currentModel = data.get(currentIndex);\n+        if (payerCostSelected != NO_SELECTED) {\n+            currentModel.showBadgeExperiment(false);", "originalCommit": "952a69c9516de6384d1cf7bda652b2d7faaef19a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODczODQ1OA==", "url": "https://github.com/mercadopago/px-android/pull/2184#discussion_r438738458", "bodyText": "Cambiado", "author": "jorGonzalez291292", "createdAt": "2020-06-11T12:13:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI2ODc2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI3MDA2Nw==", "url": "https://github.com/mercadopago/px-android/pull/2184#discussion_r438270067", "bodyText": "Hermoso, recordemos que lo que es obligatorio en un builder deber\u00eda ir en el contructor", "author": "cgaggino", "createdAt": "2020-06-10T16:50:56Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/tracking/internal/mapper/FromExpressMetadataToAvailableMethods.java", "diffHunk": "@@ -23,20 +24,42 @@ public FromExpressMetadataToAvailableMethods(@NonNull final Set<String> cardsWit\n \n     @Override\n     public AvailableMethod map(@NonNull final ExpressMetadata expressMetadata) {\n+        boolean hasInterestFree = false;\n+        boolean hasReimbursement = false;\n+        final BenefitsMetadata benefits = expressMetadata.getBenefits();\n+\n+        if (benefits != null) {\n+            hasInterestFree = benefits.getInterestFree() != null;\n+            hasReimbursement = benefits.getReimbursement() != null;\n+        }\n+\n+        final AvailableMethod.Builder builder = new AvailableMethod.Builder()", "originalCommit": "952a69c9516de6384d1cf7bda652b2d7faaef19a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgxNDg4Mg==", "url": "https://github.com/mercadopago/px-android/pull/2184#discussion_r438814882", "bodyText": "Cambiado", "author": "jorGonzalez291292", "createdAt": "2020-06-11T14:09:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI3MDA2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI3MTI3MQ==", "url": "https://github.com/mercadopago/px-android/pull/2184#discussion_r438271271", "bodyText": "esto no qued\u00f3 de mas?", "author": "cgaggino", "createdAt": "2020-06-10T16:52:57Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/tracking/internal/model/CardExtraExpress.java", "diffHunk": "@@ -11,20 +11,24 @@\n public final class CardExtraExpress extends CardExtraInfo {\n \n     private final boolean hasSplit;\n+    private final boolean hasInterestFree;", "originalCommit": "952a69c9516de6384d1cf7bda652b2d7faaef19a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQ4MTIxMw==", "url": "https://github.com/mercadopago/px-android/pull/2184#discussion_r438481213", "bodyText": "Lo usamos en la linea 21", "author": "jorGonzalez291292", "createdAt": "2020-06-11T00:40:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI3MTI3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODkyODAzNg==", "url": "https://github.com/mercadopago/px-android/pull/2184#discussion_r438928036", "bodyText": "No qued\u00f3 en todos los extrainfo con el builder?", "author": "cgaggino", "createdAt": "2020-06-11T16:47:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI3MTI3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI3Mzg0Mg==", "url": "https://github.com/mercadopago/px-android/pull/2184#discussion_r438273842", "bodyText": "medio raro un metodo que llame a otro metodo directamente y nada mas, quizas lo de applyExperimentViewInParent puede estar hecho directamente ac\u00e1, no?", "author": "cgaggino", "createdAt": "2020-06-10T16:57:21Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/view/experiments/ExperimentHelper.kt", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.mercadopago.android.px.internal.view.experiments\n+\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import com.mercadopago.android.px.internal.experiments.VariantType\n+import com.mercadopago.android.px.model.internal.Experiment\n+\n+object ExperimentHelper {\n+\n+    fun getVariantFrom(variantType: VariantType.Variant, experiments: List<Experiment>?): VariantType {\n+\n+        if (experiments != null) {\n+            for (experiment in experiments) {\n+                val variantName = experiment.variant.name\n+                if (variantType.isExperiment(experiment.name) && variantType.isVariant(variantName)) {\n+                    return if (variantType.isDefault(variantName)) variantType.getDefaultVariant() else variantType\n+                }\n+            }\n+        }\n+        return variantType.getDefaultVariant()\n+    }\n+\n+    fun <T: View?> applyExperimentViewBy(root: ViewGroup, variantType: VariantType) = applyExperimentViewInParent<T>(root, variantType.getVariantResource())", "originalCommit": "952a69c9516de6384d1cf7bda652b2d7faaef19a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a6c65c8321c2c1205ec750c91d2ce9d84bfca859", "url": "https://github.com/mercadopago/px-android/commit/a6c65c8321c2c1205ec750c91d2ce9d84bfca859", "message": "refactor variant type, variant handler added", "committedDate": "2020-06-11T00:00:53Z", "type": "commit"}, {"oid": "b025db908098966d537777904ea23b1cfc7872e3", "url": "https://github.com/mercadopago/px-android/commit/b025db908098966d537777904ea23b1cfc7872e3", "message": "vector drawable support added", "committedDate": "2020-06-11T00:35:32Z", "type": "commit"}, {"oid": "3ce3fa2af3930b9f3012e1509675d1bc0d72f2de", "url": "https://github.com/mercadopago/px-android/commit/3ce3fa2af3930b9f3012e1509675d1bc0d72f2de", "message": "resolve test", "committedDate": "2020-06-11T00:56:16Z", "type": "commit"}, {"oid": "8a68f2fe31aac994839c134762bb5927bbeca303", "url": "https://github.com/mercadopago/px-android/commit/8a68f2fe31aac994839c134762bb5927bbeca303", "message": "refactoring methods", "committedDate": "2020-06-11T12:16:26Z", "type": "commit"}, {"oid": "8a82a0b8a19d58f321b3c1a32bb6c5f5af50799a", "url": "https://github.com/mercadopago/px-android/commit/8a82a0b8a19d58f321b3c1a32bb6c5f5af50799a", "message": "srcCompat added for pulse image view", "committedDate": "2020-06-11T13:56:19Z", "type": "commit"}, {"oid": "29118e85479f2e2d7f9297c85f57e1bc684e562e", "url": "https://github.com/mercadopago/px-android/commit/29118e85479f2e2d7f9297c85f57e1bc684e562e", "message": "refactor availableMethod builder", "committedDate": "2020-06-11T14:08:36Z", "type": "commit"}, {"oid": "8013cd0b63e192b8206bdaf7c628a43c69f09c67", "url": "https://github.com/mercadopago/px-android/commit/8013cd0b63e192b8206bdaf7c628a43c69f09c67", "message": "vector consumer credits refactor", "committedDate": "2020-06-11T14:31:03Z", "type": "commit"}, {"oid": "fcca2874e0790682698305841f6eb657dc8ea8a8", "url": "https://github.com/mercadopago/px-android/commit/fcca2874e0790682698305841f6eb657dc8ea8a8", "message": "refactor CardExtraExpress, resolve test", "committedDate": "2020-06-11T17:13:39Z", "type": "commit"}]}