{"pr_number": 2083, "pr_title": "[feature] ifpe modals", "pr_createdAt": "2020-03-25T11:08:25Z", "pr_url": "https://github.com/mercadopago/px-android/pull/2083", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc5NDk2Ng==", "url": "https://github.com/mercadopago/px-android/pull/2083#discussion_r397794966", "bodyText": "Pareciera que no hace falta tantos types, pero en realidad el de add new card deberia hacer otra cosa (ir directamente a card form) en comparaci\u00f3n a los otros dos, ademas falta otro action que es el de PAY_WITHOUT_SPLIT que tendria la l\u00f3gica tambien de desactivar el split", "author": "cgaggino", "createdAt": "2020-03-25T11:49:21Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/express/ExpressPaymentPresenter.java", "diffHunk": "@@ -421,6 +446,18 @@ public void requireCurrentConfiguration(@NonNull PayButton.OnReadyForPaymentCall\n         callback.call(currentPaymentConfiguration, confirmTrackerData);\n     }\n \n+    @Override\n+    public void handleGenericDialogAction(@NonNull @GenericDialog.ActionType final String type) {\n+        switch (type) {\n+        case GenericDialog.ActionType.PAY_WITH_OTHER_METHOD:\n+        case GenericDialog.ActionType.PAY_WITH_OFFLINE_METHOD:\n+        case GenericDialog.ActionType.ADD_NEW_CARD:", "originalCommit": "e505311992409661102a94b37d57695bd31dfe5a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc5MzU3Mg==", "url": "https://github.com/mercadopago/px-android/pull/2083#discussion_r397793572", "bodyText": "Ac\u00e1, en ves de llamar siempre a view, podr\u00edas usar la standard function with().\nEj:\nwith(view) {\nval image = findViewById<ImageView>(R.id.px_dialog_generic_image)\n}", "author": "jorGonzalez291292", "createdAt": "2020-03-25T11:46:34Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/generic_modal/GenericDialog.kt", "diffHunk": "@@ -0,0 +1,125 @@\n+package com.mercadopago.android.px.internal.features.generic_modal\n+\n+import android.content.Context\n+import android.os.Bundle\n+import android.support.annotation.StringDef\n+import android.support.v4.app.FragmentManager\n+import android.support.v4.content.ContextCompat\n+import android.view.View\n+import android.widget.Button\n+import android.widget.ImageView\n+import com.mercadolibre.android.ui.widgets.MeliDialog\n+import com.mercadopago.android.px.R\n+import com.mercadopago.android.px.internal.extensions.isNotNullNorEmpty\n+import com.mercadopago.android.px.internal.util.PicassoLoader\n+import com.mercadopago.android.px.internal.util.ViewUtils\n+import com.mercadopago.android.px.internal.view.OnSingleClickListener\n+\n+class GenericDialog : MeliDialog() {\n+\n+    private lateinit var item: GenericDialogItem\n+    private var listener: Listener? = null\n+\n+    override fun onAttach(context: Context) {\n+        super.onAttach(context)\n+\n+        this.item = arguments?.getParcelable(ARG_GENERIC_DIALOG_ITEM)!!\n+\n+        listener = when {\n+            targetFragment is Listener -> {\n+                targetFragment as Listener\n+            }\n+            parentFragment is Listener -> {\n+                parentFragment as Listener\n+            }\n+            context is Listener -> {\n+                context\n+            }\n+            else -> {\n+                throw IllegalStateException(\"Parent of ${javaClass.simpleName} \" +\n+                    \"should implement ${Listener::class.java.simpleName}\")\n+            }\n+        }\n+    }\n+\n+    override fun onDetach() {\n+        listener = null\n+        super.onDetach()\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+\n+        val image = view.findViewById<ImageView>(R.id.px_dialog_generic_image)", "originalCommit": "e505311992409661102a94b37d57695bd31dfe5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg0MjM2OQ==", "url": "https://github.com/mercadopago/px-android/pull/2083#discussion_r397842369", "bodyText": "Estaba un poco esceptico de ponerlo porque no me copa mucho anidar tanto with apply let, complica un poco la lectura a simple vista y seguir los contextos, pero me ahorra el checkeo de null de context ya que el context dentro de la view es non null\nDeberiamos tener algun lineamiento igual de cuando es demasiado anidamiento, a veces es mejor tener c\u00f3digo mas legible que conciso", "author": "cgaggino", "createdAt": "2020-03-25T13:14:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc5MzU3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc5NTY0OQ==", "url": "https://github.com/mercadopago/px-android/pull/2083#discussion_r397795649", "bodyText": "Podr\u00edamos tener extension functions para esto.\nEj:\ninternal fun <T : View> T.gone() {\n    visibility = View.GONE\n}\n\ninternal fun <T : View> T.visible() {\n    visibility = View.VISIBLE\n}\n\ninternal fun <T : View> T.invisible() {\n    visibility = View.INVISIBLE\n}", "author": "jorGonzalez291292", "createdAt": "2020-03-25T11:50:46Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/generic_modal/GenericDialog.kt", "diffHunk": "@@ -0,0 +1,125 @@\n+package com.mercadopago.android.px.internal.features.generic_modal\n+\n+import android.content.Context\n+import android.os.Bundle\n+import android.support.annotation.StringDef\n+import android.support.v4.app.FragmentManager\n+import android.support.v4.content.ContextCompat\n+import android.view.View\n+import android.widget.Button\n+import android.widget.ImageView\n+import com.mercadolibre.android.ui.widgets.MeliDialog\n+import com.mercadopago.android.px.R\n+import com.mercadopago.android.px.internal.extensions.isNotNullNorEmpty\n+import com.mercadopago.android.px.internal.util.PicassoLoader\n+import com.mercadopago.android.px.internal.util.ViewUtils\n+import com.mercadopago.android.px.internal.view.OnSingleClickListener\n+\n+class GenericDialog : MeliDialog() {\n+\n+    private lateinit var item: GenericDialogItem\n+    private var listener: Listener? = null\n+\n+    override fun onAttach(context: Context) {\n+        super.onAttach(context)\n+\n+        this.item = arguments?.getParcelable(ARG_GENERIC_DIALOG_ITEM)!!\n+\n+        listener = when {\n+            targetFragment is Listener -> {\n+                targetFragment as Listener\n+            }\n+            parentFragment is Listener -> {\n+                parentFragment as Listener\n+            }\n+            context is Listener -> {\n+                context\n+            }\n+            else -> {\n+                throw IllegalStateException(\"Parent of ${javaClass.simpleName} \" +\n+                    \"should implement ${Listener::class.java.simpleName}\")\n+            }\n+        }\n+    }\n+\n+    override fun onDetach() {\n+        listener = null\n+        super.onDetach()\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+\n+        val image = view.findViewById<ImageView>(R.id.px_dialog_generic_image)\n+        item.imageUrl?.let { url -> PicassoLoader.getPicasso().load(url).into(image) }\n+            ?: image.apply { visibility = View.GONE }\n+\n+        loadButton(view.findViewById(R.id.px_dialog_generic_button_main), item.mainAction)\n+        view.findViewById<Button>(R.id.px_dialog_generic_button_secondary).apply {\n+            loadButton(this, item.secondaryAction)\n+            background = ContextCompat.getDrawable(context, R.drawable.px_quiet_button_selector)\n+        }\n+\n+        context?.let {\n+            ViewUtils.loadOrGone(item.title.get(it), view.findViewById(R.id.px_dialog_generic_text_title))\n+            ViewUtils.loadOrGone(item.description.get(it), view.findViewById(R.id.px_dialog_generic_text_description))\n+        } ?: dismiss()\n+    }\n+\n+    private fun loadButton(button: Button, actionable: Actionable?) {\n+        actionable?.let {\n+            button.text = it.label\n+            button.setOnClickListener(object : OnSingleClickListener() {\n+                override fun onSingleClick(v: View?) {\n+                    dismiss()\n+                    listener?.apply {\n+                        val action = if (it.deepLink.isNotNullNorEmpty()) {\n+                            Action.DeepLinkAction(it.deepLink!!)\n+                        } else {\n+                            Action.CustomAction(it.action!!)\n+                        }\n+                        onAction(action)\n+                    }\n+                }\n+            })\n+        } ?: button.apply { visibility = View.GONE }", "originalCommit": "e505311992409661102a94b37d57695bd31dfe5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgzMjk0OQ==", "url": "https://github.com/mercadopago/px-android/pull/2083#discussion_r397832949", "bodyText": "De una, ahi los creo", "author": "cgaggino", "createdAt": "2020-03-25T12:59:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc5NTY0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc5NzQ0NA==", "url": "https://github.com/mercadopago/px-android/pull/2083#discussion_r397797444", "bodyText": "En otros data class estas usando simplemente KParcelable. No podemos usarlo ac\u00e1 tmb?", "author": "jorGonzalez291292", "createdAt": "2020-03-25T11:53:50Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/viewmodel/TextLocalized.kt", "diffHunk": "@@ -0,0 +1,45 @@\n+package com.mercadopago.android.px.internal.viewmodel\n+\n+import android.content.Context\n+import android.os.Parcel\n+import android.os.Parcelable\n+import android.support.annotation.StringRes\n+import com.mercadopago.android.px.internal.extensions.isNotNullNorEmpty\n+import com.mercadopago.android.px.internal.util.textformatter.SpannableFormatter\n+import com.mercadopago.android.px.model.internal.Text\n+\n+data class TextLocalized(private val text: Text?, @StringRes private val stringRes: Int) : ILocalizedCharSequence, Parcelable {", "originalCommit": "e505311992409661102a94b37d57695bd31dfe5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgzMjI1NQ==", "url": "https://github.com/mercadopago/px-android/pull/2083#discussion_r397832255", "bodyText": "Totalmente, fue algo que hice en el medio del desarrollo y me colgue de pasarlo en algunos casos, como este.\nTe pareci\u00f3 bien el ParcelableUtils?", "author": "cgaggino", "createdAt": "2020-03-25T12:57:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc5NzQ0NA=="}], "type": "inlineReview"}, {"oid": "f0f9034fc4dfe32025ad163e19e441bf2561d321", "url": "https://github.com/mercadopago/px-android/commit/f0f9034fc4dfe32025ad163e19e441bf2561d321", "message": "* First implementation of generic modals and custom actions", "committedDate": "2020-03-25T14:31:41Z", "type": "forcePushed"}, {"oid": "e2a8750e00416518f1ef99ff21ae7a2eec152d88", "url": "https://github.com/mercadopago/px-android/commit/e2a8750e00416518f1ef99ff21ae7a2eec152d88", "message": "* First implementation of generic modals and custom actions", "committedDate": "2020-03-26T14:05:37Z", "type": "commit"}, {"oid": "e2a8750e00416518f1ef99ff21ae7a2eec152d88", "url": "https://github.com/mercadopago/px-android/commit/e2a8750e00416518f1ef99ff21ae7a2eec152d88", "message": "* First implementation of generic modals and custom actions", "committedDate": "2020-03-26T14:05:37Z", "type": "forcePushed"}]}