{"pr_number": 2166, "pr_title": "Add Firewall Documentation", "pr_createdAt": "2020-12-17T23:21:00Z", "pr_url": "https://github.com/opencast/opencast/pull/2166", "timeline": [{"oid": "e603455ecd2c10b1e771cadb8e4f14ca705d7b83", "url": "https://github.com/opencast/opencast/commit/e603455ecd2c10b1e771cadb8e4f14ca705d7b83", "message": "Add Firewall Documentation\n\nThis patch adds a simple overview of network communication in an\nOpencast cluster and suggests two simple configurations.", "committedDate": "2020-12-18T11:10:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDIyMTEzMg==", "url": "https://github.com/opencast/opencast/pull/2166#discussion_r554221132", "bodyText": "Elasticsearch", "author": "gregorydlogan", "createdAt": "2021-01-08T22:09:16Z", "path": "docs/guides/admin/docs/configuration/firewall.md", "diffHunk": "@@ -0,0 +1,83 @@\n+Firewall\n+========\n+\n+Opencast relies on a lot of network communication and although not strictly necessary,\n+it usually makes sense to configure a firewall for additional protection\n+\n+This describes a lot of the communication happening between servers in the most common use cases.\n+In certain set-ups and with certain types of integrations, these may deviate slightly.\n+\n+General rules are:\n+\n+- Users communicate with Opencast via HTTP(S)\n+- Capture agents communicate with Opencast via HTTP(S). All communication is established by the agent.\n+- Opencast nodes communicate among each other via HTTP(S)\n+- Often Elasticsaecrh and ActiveMQ are run on the admin node since most communication then happens on the server", "originalCommit": "e603455ecd2c10b1e771cadb8e4f14ca705d7b83", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDIyMTYxNg==", "url": "https://github.com/opencast/opencast/pull/2166#discussion_r554221616", "bodyText": "network storage access perhaps?  Something to make it clear that something like NFS is required.", "author": "gregorydlogan", "createdAt": "2021-01-08T22:10:43Z", "path": "docs/guides/admin/docs/configuration/firewall.md", "diffHunk": "@@ -0,0 +1,83 @@\n+Firewall\n+========\n+\n+Opencast relies on a lot of network communication and although not strictly necessary,\n+it usually makes sense to configure a firewall for additional protection\n+\n+This describes a lot of the communication happening between servers in the most common use cases.\n+In certain set-ups and with certain types of integrations, these may deviate slightly.\n+\n+General rules are:\n+\n+- Users communicate with Opencast via HTTP(S)\n+- Capture agents communicate with Opencast via HTTP(S). All communication is established by the agent.\n+- Opencast nodes communicate among each other via HTTP(S)\n+- Often Elasticsaecrh and ActiveMQ are run on the admin node since most communication then happens on the server\n+    - The admin node communicates with Elasticsaecrh exclusively\n+    - Some messages are sent to ActiveMQ from other nodes\n+- All servers should get storage access", "originalCommit": "e603455ecd2c10b1e771cadb8e4f14ca705d7b83", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDIyMjA2Ng==", "url": "https://github.com/opencast/opencast/pull/2166#discussion_r554222066", "bodyText": "Allow all nodes access to the storage infrastructure ?\nI get that you're deliberately excluding other services (cf SSH), but I can see how people might be confused here if we don't mention it.", "author": "gregorydlogan", "createdAt": "2021-01-08T22:12:03Z", "path": "docs/guides/admin/docs/configuration/firewall.md", "diffHunk": "@@ -0,0 +1,83 @@\n+Firewall\n+========\n+\n+Opencast relies on a lot of network communication and although not strictly necessary,\n+it usually makes sense to configure a firewall for additional protection\n+\n+This describes a lot of the communication happening between servers in the most common use cases.\n+In certain set-ups and with certain types of integrations, these may deviate slightly.\n+\n+General rules are:\n+\n+- Users communicate with Opencast via HTTP(S)\n+- Capture agents communicate with Opencast via HTTP(S). All communication is established by the agent.\n+- Opencast nodes communicate among each other via HTTP(S)\n+- Often Elasticsaecrh and ActiveMQ are run on the admin node since most communication then happens on the server\n+    - The admin node communicates with Elasticsaecrh exclusively\n+    - Some messages are sent to ActiveMQ from other nodes\n+- All servers should get storage access\n+- All Opencast nodes need database access\n+\n+A visual representation of the communication within a three-node cluster will look like this:\n+\n+```graphviz dot network.png\n+digraph G {\n+  user[label = \"User\"];\n+  activemq[label = \"ActiveMQ\"];\n+  oc1[label = \"Opencast Admin\"];\n+  oc2[label = \"Opencast Worker\"];\n+  oc3[label = \"Opencast Presentation\"];\n+  db[label = \"Database\"];\n+  es[label = \"Elasticsearch\"];\n+  storage[label = \"Storage\"];\n+  ca[label = \"Capture Agent\"];\n+\n+  user -> oc1 [label = \"80, 443\"];\n+  user -> oc2 [style = \"dashed\", label = \"80\u00b9, 443\u00b9\"];\n+  user -> oc3 [label = \"80, 443\"];\n+  oc1 -> oc2 [dir = \"both\", label = \"80, 443\"];\n+  oc2 -> oc3 [dir = \"both\", label = \"80, 443\"];\n+  oc3 -> oc1 [dir = \"both\", label = \"80, 443\"];\n+  oc1 -> db [label = \"3306\u00b2\"];\n+  oc2 -> db [label = \"3306\u00b2\"];\n+  oc3 -> db [label = \"3306\u00b2\"];\n+  oc1 -> activemq [label = \"61616\"];\n+  oc2 -> activemq [label = \"61616\"];\n+  oc3 -> activemq [label = \"61616\"];\n+  oc1 -> es[label = \"9300\"];\n+  oc1 -> storage;\n+  oc2 -> storage;\n+  oc3 -> storage;\n+  ca -> oc1[label = \"80, 443\"];\n+}\n+```\n+\n+Notes:\n+\n+- _The numbers in the diagram describe TCP ports_\n+- _\u00b9) Communication between users and workers if often not necessary_\n+- _\u00b2) If you use a database other than MariaDB, the port may differ_\n+\n+\n+Suggested Firewall Configurations\n+---------------------------------\n+\n+Note that none of these instructions take additional services like SSH into account.\n+They are focused just on what Opencast needs for communication.\n+\n+\n+### Simple\n+\n+For a very simple configuration catching most of the important attack vectors, implement the following firewall rules:\n+\n+1. Allow HTTP and HTTPS to all Opencast nodes from the outside\n+2. Allow all TCP communication within the cluster\n+\n+\n+### Complex\n+\n+If you want a more complex, stricter set of rules:\n+\n+1. Allow external HTTP and HTTPS communication to admin, presentation and possibly ingest\n+2. Allow all Opencast nodes to access ActiveMQ and the database\n+3. Allow the admin node to access Elasticsearch", "originalCommit": "e603455ecd2c10b1e771cadb8e4f14ca705d7b83", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDIyMjQzMA==", "url": "https://github.com/opencast/opencast/pull/2166#discussion_r554222430", "bodyText": "This is the only item with periods.  The lines in the diagram are already directional, maybe omit the last sentence.  Or add periods to all of them :)", "author": "gregorydlogan", "createdAt": "2021-01-08T22:13:11Z", "path": "docs/guides/admin/docs/configuration/firewall.md", "diffHunk": "@@ -0,0 +1,83 @@\n+Firewall\n+========\n+\n+Opencast relies on a lot of network communication and although not strictly necessary,\n+it usually makes sense to configure a firewall for additional protection\n+\n+This describes a lot of the communication happening between servers in the most common use cases.\n+In certain set-ups and with certain types of integrations, these may deviate slightly.\n+\n+General rules are:\n+\n+- Users communicate with Opencast via HTTP(S)\n+- Capture agents communicate with Opencast via HTTP(S). All communication is established by the agent.", "originalCommit": "e603455ecd2c10b1e771cadb8e4f14ca705d7b83", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0f9349beb21b06c2200866e93a85b758a0fef4be", "url": "https://github.com/opencast/opencast/commit/0f9349beb21b06c2200866e93a85b758a0fef4be", "message": "Add Firewall Documentation\n\nThis patch adds a simple overview of network communication in an\nOpencast cluster and suggests two simple configurations.", "committedDate": "2021-01-12T00:14:55Z", "type": "forcePushed"}, {"oid": "118d1a9c19cd1df532c3372459f87ac2138bb503", "url": "https://github.com/opencast/opencast/commit/118d1a9c19cd1df532c3372459f87ac2138bb503", "message": "Add Firewall Documentation\n\nThis patch adds a simple overview of network communication in an\nOpencast cluster and suggests two simple configurations.", "committedDate": "2021-01-12T14:29:03Z", "type": "commit"}, {"oid": "118d1a9c19cd1df532c3372459f87ac2138bb503", "url": "https://github.com/opencast/opencast/commit/118d1a9c19cd1df532c3372459f87ac2138bb503", "message": "Add Firewall Documentation\n\nThis patch adds a simple overview of network communication in an\nOpencast cluster and suggests two simple configurations.", "committedDate": "2021-01-12T14:29:03Z", "type": "forcePushed"}]}