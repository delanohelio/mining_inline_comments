{"pr_number": 1347, "pr_title": "LDAP Configuration", "pr_createdAt": "2020-01-10T21:23:53Z", "pr_url": "https://github.com/opencast/opencast/pull/1347", "timeline": [{"oid": "b4abe696322077881112b70771156908438d1244", "url": "https://github.com/opencast/opencast/commit/b4abe696322077881112b70771156908438d1244", "message": "LDAP Configuration\n\nThis patch simplifies the LDAP configuration by doing the long-discussed\nand anticipated move from the external, old and out-of-date LDAP sample\nsecurity configuration into the main security configuration file.\n\nIt also updates the LDAP configuration guide to reflect this move as\nwell as doing a general overhaul since it seemed like the guide still\ncontained relics from our wiki days.", "committedDate": "2020-01-10T21:18:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQ1MDU3MA==", "url": "https://github.com/opencast/opencast/pull/1347#discussion_r368450570", "bodyText": "The < ! - -  .....  - - - > Comment indicators needs to be changed to <!-- ..... --> because the previous generates a read error from Opencast.\nMaybe is because I had to uncomment some lines because this kind of file doesn't support nested comments. But anyways I think is more foolproof have all the comments not nested.", "author": "mliradelc", "createdAt": "2020-01-20T09:43:36Z", "path": "etc/security/mh_default_org.xml", "diffHunk": "@@ -507,6 +507,56 @@\n   </bean>\n   -->\n \n+  <!-- ################ -->\n+  <!-- # LDAP Support # -->\n+  <!-- ################ -->\n+\n+  <!--\n+  <bean id=\"contextSource\"\n+    class=\"org.springframework.security.ldap.DefaultSpringSecurityContextSource\">\n+    < ! - - URL of the LDAP server - - >\n+    <constructor-arg value=\"ldap://myldapserver:myport\" />\n+    < ! - - \"Distinguished name\" for the unprivileged user - - >\n+    < ! - - This user is merely to perform searches in the LDAP to find the users to login - - >\n+    <property name=\"userDn\" value=\"uid=user-id,dc=example,dc=com\" />\n+    < ! - - Password of the user above - - >\n+    <property name=\"password\" value=\"mypassword\" />\n+  </bean>\n+  -->\n+\n+  <!--\n+  <bean id=\"ldapAuthProvider\"\n+    class=\"org.springframework.security.ldap.authentication.LdapAuthenticationProvider\">\n+    <constructor-arg>\n+      <bean\n+        class=\"org.springframework.security.ldap.authentication.BindAuthenticator\">\n+        <constructor-arg ref=\"contextSource\" />\n+        <property name=\"userDnPatterns\">\n+          <list>\n+            < ! - - Dn patterns to search for valid users. Multiple \"<value>\" tags are allowed - - >\n+            <value>uid={0},dc=example,dc=com</value>\n+          </list>\n+        </property>\n+        < ! - - If your user IDs are not part of the user Dn's, you can use a search filter to find them - - >\n+        < ! - - This property can be used together with the \"userDnPatterns\" above - - >\n+        < ! - -\n+        <property name=\"userSearch\">\n+          <bean name=\"filterUserSearch\" class=\"org.springframework.security.ldap.search.FilterBasedLdapUserSearch\">\n+            < ! - - Base Dn from where the users will be searched for - - >\n+            <constructor-arg index=\"0\" value=\"ou=GroupName,dc=my-institution,dc=country\" />\n+            < ! - - Filter to located valid users. Use {0} as a placeholder for the login name - - >\n+            <constructor-arg index=\"1\" value=\"(uid={0})\" />\n+            <constructor-arg ref=\"contextSource\" />\n+          </bean>\n+        </property>\n+        - - >\n+      </bean>\n+    </constructor-arg>\n+    < ! - - Defines how the user attributes are converted to authorities (roles) - - >", "originalCommit": "b4abe696322077881112b70771156908438d1244", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg4Njk3Nw==", "url": "https://github.com/opencast/opencast/pull/1347#discussion_r368886977", "bodyText": "@lkiesow Please check my point with the comments, what do you think? Besides that detail is ok for me to merge.", "author": "mliradelc", "createdAt": "2020-01-21T09:21:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQ1MDU3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAxNDIwNg==", "url": "https://github.com/opencast/opencast/pull/1347#discussion_r369014206", "bodyText": "Unfortunately, we cannot just change that since you cannot use an XML comment within an XML comment. The notation of adding spaces \u2013 which need to be removed when removing the outer comment \u2013 is what the previous LDAP configuration was already using and I did not have a better idea than that:\n\n  \n    \n      opencast/etc/security/security_sample_ldap.xml-example\n    \n    \n        Lines 519 to 522\n      in\n      71480e1\n    \n    \n    \n    \n\n        \n          \n           < ! - - Base Dn from where the users will be searched for - - > \n        \n\n        \n          \n           <constructor-arg index=\"0\" value=\"ou=GroupName,dc=my-institution,dc=country\" /> \n        \n\n        \n          \n           < ! - - Filter to located valid users. Use {0} as a placeholder for the login name - - > \n        \n\n        \n          \n           <constructor-arg index=\"1\" value=\"(uid={0})\" />", "author": "lkiesow", "createdAt": "2020-01-21T13:57:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQ1MDU3MA=="}], "type": "inlineReview"}]}