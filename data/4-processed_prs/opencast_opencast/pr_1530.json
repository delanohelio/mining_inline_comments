{"pr_number": 1530, "pr_title": "REST Docs: Ingest: WF parameters, WFIID deprecated", "pr_createdAt": "2020-04-18T10:51:27Z", "pr_url": "https://github.com/opencast/opencast/pull/1530", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc1OTM0NQ==", "url": "https://github.com/opencast/opencast/pull/1530#discussion_r410759345", "bodyText": "\u2026retrieving all URL-referenced files\u2026\n\nI don't think that's true. Is it? URLs should just be referenced in the media package. They may be retrieved in some cases if a snapshot of the media package is created or if the assets are being used for processing. I would just leave that out.", "author": "lkiesow", "createdAt": "2020-04-18T22:17:41Z", "path": "modules/ingest-service-impl/src/main/java/org/opencastproject/ingest/endpoint/IngestRestService.java", "diffHunk": "@@ -1036,7 +1036,10 @@ private Response ingestZippedMediaPackage(HttpServletRequest request, String wdI\n   @POST\n   @Produces(MediaType.TEXT_HTML)\n   @Path(\"ingest/{wdID}\")\n-  @RestQuery(name = \"ingest\", description = \"Ingest the completed media package into the system, retrieving all URL-referenced files, and starting a specified workflow\",\n+  @RestQuery(name = \"ingest\",\n+             description = \"<p>Ingest the completed media package into the system, retrieving all URL-referenced files, and \"", "originalCommit": "61221d5654331c00f58d94f6d97b8fecb32792b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEwNTE2NQ==", "url": "https://github.com/opencast/opencast/pull/1530#discussion_r415105165", "bodyText": "You are essentially saying if the workflow referenced by wdID is not touching the elements, they won't be downloaded. Tested that and seems to be true. The IngestDownload WOH does that after the WF has been instantiated in the test output log below. Will correct that.\n(IngestServiceImpl:724) - Start adding track 326598d4-8f8f-4804-86d6-dc29c6db4ed0 from URL https://upload.wikimedia.org/wikipedia/commons/c/c0/Big_Buck_Bunny_4K.webm on mediapackage afb69cad-f363-4a2f-980b-82a5e517b25c\n(IngestServiceImpl:1668) - Adding element of type Track to mediapackage afb69cad-f363-4a2f-980b-82a5e517b25c\n(IngestServiceImpl:731) - Adding Tag:  to Element: 326598d4-8f8f-4804-86d6-dc29c6db4ed0\n(IngestServiceImpl:737) - Successful added track 326598d4-8f8f-4804-86d6-dc29c6db4ed0 on mediapackage afb69cad-f363-4a2f-980b-82a5e517b25c at URL https://opencast.example.com:8443/files/mediapackage/afb69cad-f363-4a2f-980b-82a5e517b25c/326598d4-8f8f-4804-86d6-dc29c6db4ed0/Big_Buck_Bunny_4K.webm\n(IngestServiceImpl:1170) - Starting a new workflow with ingested mediapackage afb69cad-f363-4a2f-980b-82a5e517b25c based on workflow definition '0-ng-schedule-and-upload-llz'\n(IngestServiceImpl:1547) - Ingested mediapackage afb69cad-f363-4a2f-980b-82a5e517b25c is processed using workflow template '0-ng-schedule-and-upload-llz', specified during ingest\n(IngestServiceImpl:1339) - No capture event found for id afb69cad-f363-4a2f-980b-82a5e517b25c\n(IngestServiceImpl:1189) - Starting new workflow with ingested mediapackage 'afb69cad-f363-4a2f-980b-82a5e517b25c' using the specified template '0-ng-schedule-and-upload-llz'\n(AbstractAssetManager:242) - Creating new version 0 of media package afb69cad-f363-4a2f-980b-82a5e517b25c\n(AssetManagerWithMessaging:211) - Send update message for snapshot afb69cad-f363-4a2f-980b-82a5e517b25c, 0 to ActiveMQ\n(WorkflowServiceImpl:807) - [>c67d5a04] Scheduling workflow 107380 for execution\n(ExportWorkflowPropertiesWOH:87) - Start exporting workflow properties for workflow Workflow {107380}\n(ImportWorkflowPropertiesWOH:97) - Cannot import workflow properties - no element with flavor 'processing/defaults' found in media package 'afb69cad-f363-4a2f-980b-82a5e517b25c'\n(ExportWorkflowPropertiesWOH:138) - Added properties from Workflow {107380} as Attachment with flavor processing/defaults\n(IncludeWorkflowOperationHandler:105) - Insert workflow partial-ingest into the current workflow instance\n(IngestDownloadWorkflowOperationHandler:154) - Skipping downloading already existing element https://opencast.example.com:8443/files/mediapackage/afb69cad-f363-4a2f-980b-82a5e517b25c/326598d4-8f8f-4804-86d6-dc29c6db4ed0/Big_Buck_Bunny_4K.webm\n(IngestDownloadWorkflowOperationHandler:186) - Downloaded the external element https://upload.wikimedia.org/wikipedia/commons/8/88/Big_Buck_Bunny_alt.webm\n(IngestDownloadWorkflowOperationHandler:154) - Skipping downloading already existing element https://opencast.example.com:8443/files/mediapackage/afb69cad-f363-4a2f-980b-82a5e517b25c/c00adf43-842a-4e5b-b6b4-687f5d39381a/dublincore.xml\n(IngestDownloadWorkflowOperationHandler:154) - Skipping downloading already existing element https://opencast.example.com:8443/files/mediapackage/afb69cad-f363-4a2f-980b-82a5e517b25c/f8dd407e-59e3-4e16-99c5-debe4ff3f679/processing_properties.xml\n(IngestDownloadWorkflowOperationHandler:226) - Unable to delete external URI https://upload.wikimedia.org/wikipedia/commons/8/88/Big_Buck_Bunny_alt.webm, no working file repository found\n(InspectWorkflowOperationHandler:152) - Inspecting track '326598d4-8f8f-4804-86d6-dc29c6db4ed0' of afb69cad-f363-4a2f-980b-82a5e517b25c\n(MediaInspectionServiceRemoteImpl:126) - Enriching https://opencast.example.com:8443/files/mediapackage/afb69cad-f363-4a2f-980b-82a5e517b25c/326598d4-8f8f-4804-86d6-dc29c6db4ed0/big_buck_bunny_4k.webm using a remote media inspection service\n(MediaInspectionServiceRemoteImpl:134) - Completing inspection of media file at https://opencast.example.com:8443/files/mediapackage/afb69cad-f363-4a2f-980b-82a5e517b25c/326598d4-8f8f-4804-86d6-dc29c6db4ed0/Big_Buck_Bunny_4K.webm using a remote media inspection service\n(InspectWorkflowOperationHandler:152) - Inspecting track '326578d4-8f8f-4804-86d6-dc2916db4ed0' of afb69cad-f363-4a2f-980b-82a5e517b25c\n(MediaInspectionServiceRemoteImpl:126) - Enriching https://opencast.example.com:8443/files/mediapackage/afb69cad-f363-4a2f-980b-82a5e517b25c/326578d4-8f8f-4804-86d6-dc2916db4ed0/big_buck_bunny_alt.webm using a remote media inspection service\n(MediaInspectionServiceRemoteImpl:134) - Completing inspection of media file at https://opencast.example.com:8443/files/mediapackage/afb69cad-f363-4a2f-980b-82a5e517b25c/326578d4-8f8f-4804-86d6-dc2916db4ed0/Big_Buck_Bunny_alt.webm using a remote media inspection service\n(SeriesWorkflowOperationHandler:196) - No series set, skip operation\n(TagWorkflowOperationHandler:92) - Retagging mediapackage elements\n(TagWorkflowOperationHandler:92) - Retagging mediapackage elements", "author": "Rillke", "createdAt": "2020-04-25T17:21:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc1OTM0NQ=="}], "type": "inlineReview"}, {"oid": "d1a565d4eba5f08573af48da53aca8337656f550", "url": "https://github.com/opencast/opencast/commit/d1a565d4eba5f08573af48da53aca8337656f550", "message": "REST Docs: Ingest: WF parameters, WFIID deprecated\n\n- This is about the ingest REST endpoint\n- Workflow parameters are supported. See IngestServiceImpl::ingest() where they are passed as properties\n- In docs.opencast they are referenced to as \"Workflow instance configuration\"\n- C.f. discussion on https://groups.google.com/a/opencast.org/d/msg/anwender/PgJQHlpAGUg/3OFx2LLKCwAJ\n- workflow instance ID is deprecated: IngestServiceImpl::ingest():\n  \"Resuming workflow {} with ingested mediapackage {} is deprecated, skip resuming and start new workflow\"\n- Ingest will not automatically download external URLs. The WF instance created may do.", "committedDate": "2020-04-25T17:36:33Z", "type": "commit"}, {"oid": "d1a565d4eba5f08573af48da53aca8337656f550", "url": "https://github.com/opencast/opencast/commit/d1a565d4eba5f08573af48da53aca8337656f550", "message": "REST Docs: Ingest: WF parameters, WFIID deprecated\n\n- This is about the ingest REST endpoint\n- Workflow parameters are supported. See IngestServiceImpl::ingest() where they are passed as properties\n- In docs.opencast they are referenced to as \"Workflow instance configuration\"\n- C.f. discussion on https://groups.google.com/a/opencast.org/d/msg/anwender/PgJQHlpAGUg/3OFx2LLKCwAJ\n- workflow instance ID is deprecated: IngestServiceImpl::ingest():\n  \"Resuming workflow {} with ingested mediapackage {} is deprecated, skip resuming and start new workflow\"\n- Ingest will not automatically download external URLs. The WF instance created may do.", "committedDate": "2020-04-25T17:36:33Z", "type": "forcePushed"}]}