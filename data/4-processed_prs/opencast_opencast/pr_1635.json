{"pr_number": 1635, "pr_title": "Admin UI embedding code", "pr_createdAt": "2020-06-09T17:30:05Z", "pr_url": "https://github.com/opencast/opencast/pull/1635", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg3MTcyMg==", "url": "https://github.com/opencast/opencast/pull/1635#discussion_r438871722", "bodyText": "isn't there a simpler way to get the engage URL? An user needs at least one of these roles (or a new role ROLE_UI_EVENTS_EMBEDDING_CODE) to access the api\n    <sec:intercept-url pattern=\"/api/info/organization/properties\" method=\"GET\" access=\"ROLE_ADMIN, ROLE_API\" />", "author": "hsssystems", "createdAt": "2020-06-11T15:29:17Z", "path": "modules/admin-ui-frontend/app/scripts/shared/partials/modals/embedding-code.html", "diffHunk": "@@ -0,0 +1,114 @@\n+<section ng-show=\"open\" ng-keyup=\"keyUp($event)\" tabindex=\"1\" class=\"modal modal-animation ng-hide\" id=\"embedding-code\">\n+  <header>\n+    <a class=\"fa fa-times close-modal\" ng-click=\"close()\"></a>\n+    <h2 translate=\"CONFIRMATIONS.ACTIONS.SHOW.EMBEDDING_CODE\"><!-- Confirm --></h2>\n+  </header>\n+\n+  <style>\n+  .embedSizeButton {\n+    display: inline-block;\n+    background-color: #466DC3;\n+    border: 5px solid #313135;\n+    border-radius: 10px;\n+    cursor: pointer;\n+    margin-right: 5px;\n+    vertical-align: middle;\n+    font-size: 14px;\n+    text-align: center;\n+    color: white;\n+  }\n+\n+  .embedSizeButtonSelected {\n+    border: 5px solid #FFE04F;\n+  }\n+\n+  .copyConfirm {\n+    display: inline-block;\n+    text-align: center;\n+    margin: 10px 0px 10px 0px;\n+    width: 100%;\n+    font-weight: bold;\n+    font-size: 1.1em;\n+    color: #466DC3;\n+  }\n+  </style>\n+\n+  <script>\n+    var engageUrl = \"<SERVER_URL>\";\n+\n+    $(document).ready(function() {\n+      var reply = $.ajax({\n+        url: \"/api/info/organization/properties\",", "originalCommit": "bc52e20052e7ba7a9345dc3ecaae697aa22c7e0f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg4Njc3NA==", "url": "https://github.com/opencast/opencast/pull/1635#discussion_r438886774", "bodyText": "Plus, /api does not necessarily exist on the same server.\nI'm not sure if the information is in the admin interface endpoints, you should get it from /info/me.json though. The Media Molule link in the top right corner of the admin interface uses the same information, maybe take a look at where it gets the information from.", "author": "lkiesow", "createdAt": "2020-06-11T15:45:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg3MTcyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg3NDY4Mg==", "url": "https://github.com/opencast/opencast/pull/1635#discussion_r438874682", "bodyText": "We should display this only for users with related roles, something like the following\n<a ng-click=\"row.embeddingCode()\"\nclass=\"embeddingcode\"\ntitle=\"{{ 'EVENTS.EVENTS.TABLE.TOOLTIP.EMBEDDING_CODE' | translate }}\"\nwith-role=\"ROLE_UI_EVENTS_EMBEDDING_CODE\">\n</a>", "author": "hsssystems", "createdAt": "2020-06-11T15:32:12Z", "path": "modules/admin-ui-frontend/app/scripts/modules/events/partials/eventActionsCell.html", "diffHunk": "@@ -62,3 +62,9 @@\n    with-role=\"ROLE_UI_EVENTS_DETAILS_ASSETS_VIEW\">\n </a>\n \n+<a ng-click=\"row.embeddingCode()\"\n+   class=\"embeddingcode\"\n+   title=\"{{ 'EVENTS.EVENTS.TABLE.TOOLTIP.EMBEDDING_CODE' | translate }}\">", "originalCommit": "bc52e20052e7ba7a9345dc3ecaae697aa22c7e0f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg4NzUzOA==", "url": "https://github.com/opencast/opencast/pull/1635#discussion_r438887538", "bodyText": "This should be commented out by default.", "author": "lkiesow", "createdAt": "2020-06-11T15:46:40Z", "path": "etc/org.opencastproject.organization-mh_default_org.cfg", "diffHunk": "@@ -146,7 +146,7 @@ prop.org.opencastproject.admin.mediamodule.url=${prop.org.opencastproject.engage\n # Value: <a complete url with scheme and port>\n # Default: ${org.opencastproject.server.url}\n #\n-#prop.org.opencastproject.engage.ui.url=http://localhost:8080\n+prop.org.opencastproject.engage.ui.url=http://localhost:8080", "originalCommit": "bc52e20052e7ba7a9345dc3ecaae697aa22c7e0f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg4ODUyMg==", "url": "https://github.com/opencast/opencast/pull/1635#discussion_r438888522", "bodyText": "Avoid inline styles. Use the sass files in the admin interface.", "author": "lkiesow", "createdAt": "2020-06-11T15:47:48Z", "path": "modules/admin-ui-frontend/app/scripts/shared/partials/modals/embedding-code.html", "diffHunk": "@@ -0,0 +1,114 @@\n+<section ng-show=\"open\" ng-keyup=\"keyUp($event)\" tabindex=\"1\" class=\"modal modal-animation ng-hide\" id=\"embedding-code\">\n+  <header>\n+    <a class=\"fa fa-times close-modal\" ng-click=\"close()\"></a>\n+    <h2 translate=\"CONFIRMATIONS.ACTIONS.SHOW.EMBEDDING_CODE\"><!-- Confirm --></h2>\n+  </header>\n+\n+  <style>", "originalCommit": "bc52e20052e7ba7a9345dc3ecaae697aa22c7e0f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "601237c81b1f80fc9b83260374664ab884daa8bb", "url": "https://github.com/opencast/opencast/commit/601237c81b1f80fc9b83260374664ab884daa8bb", "message": "refs #4764 ADD Admin UI embedding code", "committedDate": "2020-06-15T15:48:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk3NDI4Nw==", "url": "https://github.com/opencast/opencast/pull/1635#discussion_r447974287", "bodyText": "Paella is the default, but not the guaranteed player.", "author": "gregorydlogan", "createdAt": "2020-06-30T20:57:17Z", "path": "modules/admin-ui-frontend/app/scripts/shared/partials/modals/embedding-code.html", "diffHunk": "@@ -0,0 +1,85 @@\n+<section ng-show=\"open\" ng-keyup=\"keyUp($event)\" tabindex=\"1\" class=\"modal modal-animation ng-hide\" id=\"embedding-code\">\n+  <header>\n+    <a class=\"fa fa-times close-modal\" ng-click=\"close()\"></a>\n+    <h2 translate=\"CONFIRMATIONS.ACTIONS.SHOW.EMBEDDING_CODE\"><!-- Confirm --></h2>\n+  </header>\n+\n+  <script>\n+    var engageUrl = \"<SERVER_URL>\";\n+\n+    $(document).ready(function() {\n+      var reply = $.ajax({\n+        url: \"/api/info/organization/properties/engageuiurl\",\n+        timeout: 3000,\n+        success: function(result) {\n+          engageUrl = result['org.opencastproject.engage.ui.url'];\n+          if (typeof engageUrl === \"undefined\") {\n+            engageUrl = \"<SERVER_URL>\";\n+          }\n+        }\n+      });\n+    });\n+\n+    var embs = $(\".embedSizeButton\");\n+    for (var i = 0; i < embs.length; i = i + 1) {\n+      var e = embs[i];\n+      e.onclick = function(event) {\n+        var value = event.target ? event.target.textContent : event.toElement.textContent;\n+        if (value) {\n+          var embedSizeButtons = $(\".embedSizeButton\");\n+          for (var j = 0; j < embedSizeButtons.length; j++) {\n+            if (embedSizeButtons[j].id == value) {\n+              embedSizeButtons[j].classList.add(\"embedSizeButtonSelected\");\n+            } else {\n+              embedSizeButtons[j].classList.remove(\"embedSizeButtonSelected\");\n+            }\n+          }\n+          var id = $(\"#id_video\").html();\n+          var url = engageUrl + \"/play/\" + id;\n+          var size = value.trim().split(\"x\");\n+          $(\"#social_embed-textarea\")[0].value = '<iframe allowfullscreen src=\"' + url + '\" style=\"border:0px #FFFFFF none;\" name=\"Paella Player\" scrolling=\"no\" frameborder=\"0\" marginheight=\"0px\" marginwidth=\"0px\" width=\"' + size[0] + '\" height=\"' + size[1] + '\"></iframe>';", "originalCommit": "601237c81b1f80fc9b83260374664ab884daa8bb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMyNjIxNg==", "url": "https://github.com/opencast/opencast/pull/1635#discussion_r448326216", "bodyText": "@gregorydlogan\nThank you for the review. The name attribute is now only Player instead of Paella Player. You mean that? The url doesn't change, right?", "author": "jchssystems", "createdAt": "2020-07-01T12:24:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk3NDI4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTY5NjY1Mw==", "url": "https://github.com/opencast/opencast/pull/1635#discussion_r451696653", "bodyText": "Correct, /play/ is a magic endpoint which does the redirection to the correct player.", "author": "gregorydlogan", "createdAt": "2020-07-08T17:05:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk3NDI4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk3NjU3Ng==", "url": "https://github.com/opencast/opencast/pull/1635#discussion_r447976576", "bodyText": "Being that this is in the external API it would require a new version.  Luckily, OC 9 already has that done, but it's something to keep in mind for next time.", "author": "gregorydlogan", "createdAt": "2020-06-30T21:01:31Z", "path": "modules/external-api/src/main/java/org/opencastproject/external/endpoint/BaseEndpoint.java", "diffHunk": "@@ -194,6 +194,27 @@ public Response getOrganizationProperties() {\n     return RestUtil.R.ok(MediaType.APPLICATION_JSON_TYPE, serializer.toJson(obj(props)));\n   }\n \n+  @GET", "originalCommit": "601237c81b1f80fc9b83260374664ab884daa8bb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMyNjczMQ==", "url": "https://github.com/opencast/opencast/pull/1635#discussion_r448326731", "bodyText": "Ok, thanks", "author": "jchssystems", "createdAt": "2020-07-01T12:25:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk3NjU3Ng=="}], "type": "inlineReview"}, {"oid": "cbf6b87b621dd0f841151e6a44319986f306bfbb", "url": "https://github.com/opencast/opencast/commit/cbf6b87b621dd0f841151e6a44319986f306bfbb", "message": "refs #4764 ADD Admin UI embedding code", "committedDate": "2020-07-01T11:36:59Z", "type": "commit"}, {"oid": "cbf6b87b621dd0f841151e6a44319986f306bfbb", "url": "https://github.com/opencast/opencast/commit/cbf6b87b621dd0f841151e6a44319986f306bfbb", "message": "refs #4764 ADD Admin UI embedding code", "committedDate": "2020-07-01T11:36:59Z", "type": "forcePushed"}]}