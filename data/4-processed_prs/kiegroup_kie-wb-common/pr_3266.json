{"pr_number": 3266, "pr_title": "DROOLS-5148: [DMN Designer] Copy/Paste is not working", "pr_createdAt": "2020-04-15T14:19:46Z", "pr_url": "https://github.com/kiegroup/kie-wb-common/pull/3266", "timeline": [{"oid": "f2ef495fa231aaaa4d7b4dfd84338475a2b23223", "url": "https://github.com/kiegroup/kie-wb-common/commit/f2ef495fa231aaaa4d7b4dfd84338475a2b23223", "message": "Introducing in Stunner a parent type to be used in the @Alternative", "committedDate": "2020-04-09T13:14:12Z", "type": "commit"}, {"oid": "b94e463d53d00b4249b9a625ff1c7bbb45932a1c", "url": "https://github.com/kiegroup/kie-wb-common/commit/b94e463d53d00b4249b9a625ff1c7bbb45932a1c", "message": "DMNDeepCloneProcess should be used, in DMN, in place of DeepCloneProcess by Stunner", "committedDate": "2020-04-09T13:15:14Z", "type": "commit"}, {"oid": "8423a2e3abd540efc17ded8712348cbbb2a1ec76", "url": "https://github.com/kiegroup/kie-wb-common/commit/8423a2e3abd540efc17ded8712348cbbb2a1ec76", "message": "DMN deep clone: supporting all DMN nodes, except for Decision", "committedDate": "2020-04-10T17:22:19Z", "type": "commit"}, {"oid": "a6e1c2b48f65161fce56aba66ba68212607be727", "url": "https://github.com/kiegroup/kie-wb-common/commit/a6e1c2b48f65161fce56aba66ba68212607be727", "message": "Implementing internal copy method", "committedDate": "2020-04-14T08:49:23Z", "type": "commit"}, {"oid": "f27050b990158bc82e51959adb226882095df259", "url": "https://github.com/kiegroup/kie-wb-common/commit/f27050b990158bc82e51959adb226882095df259", "message": "Implementing copy method", "committedDate": "2020-04-14T12:11:47Z", "type": "commit"}, {"oid": "a640fa4469e800e48ffed062b5e259851793c208", "url": "https://github.com/kiegroup/kie-wb-common/commit/a640fa4469e800e48ffed062b5e259851793c208", "message": "Adding copy as abstract method to be implemented in subclasses of Expression", "committedDate": "2020-04-14T12:12:48Z", "type": "commit"}, {"oid": "5074e9e14e7873efc397c7c21475a6a7922f05d9", "url": "https://github.com/kiegroup/kie-wb-common/commit/5074e9e14e7873efc397c7c21475a6a7922f05d9", "message": "Adding copy method to Property classes", "committedDate": "2020-04-15T09:05:35Z", "type": "commit"}, {"oid": "6c0590b1eedf996ef16ead3e52e3a7bdea114128", "url": "https://github.com/kiegroup/kie-wb-common/commit/6c0590b1eedf996ef16ead3e52e3a7bdea114128", "message": "All subclasses of Expression must implement the copy method", "committedDate": "2020-04-15T09:22:31Z", "type": "commit"}, {"oid": "8e95703cf6b2a30229c4bd534d3e77da2a48bf18", "url": "https://github.com/kiegroup/kie-wb-common/commit/8e95703cf6b2a30229c4bd534d3e77da2a48bf18", "message": "All models used by DMN nodes must implement the copy method", "committedDate": "2020-04-15T09:24:41Z", "type": "commit"}, {"oid": "4f7e243dcde8c9191ea2f4e5a40383794e4ecd07", "url": "https://github.com/kiegroup/kie-wb-common/commit/4f7e243dcde8c9191ea2f4e5a40383794e4ecd07", "message": "Implementing deep clone core process for DMN nodes", "committedDate": "2020-04-15T14:07:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg5MTUwMA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3266#discussion_r408891500", "bodyText": "Sorry, I could not resist looking.. the possible issue with enabling the alternative is that it will also affect BPMN.\nI suggest testing with Business Central.", "author": "manstis", "createdAt": "2020-04-15T14:35:37Z", "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/main/resources/META-INF/ErraiApp.properties", "diffHunk": "@@ -28,4 +28,5 @@\n # file, although it is rarely necessary. See the documentation at\n # https://docs.jboss.org/author/display/ERRAI/ErraiApp.properties\n # for details.\n+errai.ioc.enabled.alternatives=org.kie.workbench.common.dmn.client.commands.clone.DMNDeepCloneProcess", "originalCommit": "4f7e243dcde8c9191ea2f4e5a40383794e4ecd07", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTU1Nzg2OQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3266#discussion_r409557869", "bodyText": "@jomarko helped us in verifying that BPMN copy and paste still works as before.\nThank you for your suggestion @manstis", "author": "vpellegrino", "createdAt": "2020-04-16T13:32:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg5MTUwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTMwMDgyNw==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3266#discussion_r409300827", "bodyText": "Please implement unit tests for all added copy() methods.", "author": "jomarko", "createdAt": "2020-04-16T06:00:26Z", "path": "kie-wb-common-dmn/kie-wb-common-dmn-api/src/main/java/org/kie/workbench/common/dmn/api/definition/model/Binding.java", "diffHunk": "@@ -35,6 +36,13 @@\n     private InformationItem parameter;\n     private Expression expression;\n \n+    public Binding copy() {\n+        final Binding bindingCloned = new Binding();\n+        bindingCloned.parameter = parameter.copy();\n+        bindingCloned.expression = Optional.ofNullable(expression).map(Expression::copy).orElse(null);\n+        return bindingCloned;\n+    }", "originalCommit": "4f7e243dcde8c9191ea2f4e5a40383794e4ecd07", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTU1ODUzOA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3266#discussion_r409558538", "bodyText": "I have implemented unit tests for all added copy() methods.", "author": "vpellegrino", "createdAt": "2020-04-16T13:32:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTMwMDgyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTMwNDQ1NQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3266#discussion_r409304455", "bodyText": "Some classes just add new public copy method and some override abstract copy method. Just question if we can not  declare the abstract in DMNModelInstrumentedBase to achieve consistency in overriding?\nJust asking, haven't investigated limitations.", "author": "jomarko", "createdAt": "2020-04-16T06:10:49Z", "path": "kie-wb-common-dmn/kie-wb-common-dmn-api/src/main/java/org/kie/workbench/common/dmn/api/definition/model/ContextEntry.java", "diffHunk": "@@ -37,6 +38,13 @@\n     private InformationItem variable;\n     private Expression expression;\n \n+    public ContextEntry copy() {\n+        final ContextEntry clonedContextEntry = new ContextEntry();\n+        clonedContextEntry.variable = Optional.ofNullable(variable).map(InformationItem::copy).orElse(null);\n+        clonedContextEntry.expression = Optional.ofNullable(expression).map(Expression::copy).orElse(null);\n+        return clonedContextEntry;\n+    }", "originalCommit": "4f7e243dcde8c9191ea2f4e5a40383794e4ecd07", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTMyMDUyMQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3266#discussion_r409320521", "bodyText": "If you see commit history, there is a set of classes that are overriding Expression.copy abstract method, because of boxed expressions.\nIn other cases, the public copy method is enough for our purposes.", "author": "vpellegrino", "createdAt": "2020-04-16T06:50:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTMwNDQ1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTMwNTg2OA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3266#discussion_r409305868", "bodyText": "We should add javadoc, explaining deep copy is made.", "author": "jomarko", "createdAt": "2020-04-16T06:14:42Z", "path": "kie-wb-common-dmn/kie-wb-common-dmn-api/src/main/java/org/kie/workbench/common/dmn/api/definition/model/Expression.java", "diffHunk": "@@ -45,6 +45,8 @@ public Expression(final Id id,\n         this.typeRef = typeRef;\n     }\n \n+    public abstract Expression copy();", "originalCommit": "4f7e243dcde8c9191ea2f4e5a40383794e4ecd07", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTMyODM3Mg==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3266#discussion_r409328372", "bodyText": "This method only represents a contract for all subclasses of Expression.\nIts purpose is to exploit polymorphism when we deeply copy the Expression boxed inside the Decision\nI will add javadoc also to DMNDeepCloneProcess.clone to explain how deep copy is made", "author": "vpellegrino", "createdAt": "2020-04-16T07:08:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTMwNTg2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTMxMjAyNw==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3266#discussion_r409312027", "bodyText": "We miss test for second link:\nassertThat(cloned.getLinksHolder().getValue().getLinks())\n                .extracting(\"url\")\n                .containsExactly(FIRST_URL, SECOND_URL);\nLooking on whole class, could we please use both URLs in all tests (where applicable)?", "author": "jomarko", "createdAt": "2020-04-16T06:30:24Z", "path": "kie-wb-common-dmn/kie-wb-common-dmn-client/src/test/java/org/kie/workbench/common/dmn/client/commands/clone/DMNDeepCloneProcessTest.java", "diffHunk": "@@ -0,0 +1,257 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.workbench.common.dmn.client.commands.clone;\n+\n+import java.util.ArrayList;\n+import java.util.stream.Stream;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.workbench.common.dmn.api.definition.model.BusinessKnowledgeModel;\n+import org.kie.workbench.common.dmn.api.definition.model.Context;\n+import org.kie.workbench.common.dmn.api.definition.model.DRGElement;\n+import org.kie.workbench.common.dmn.api.definition.model.Decision;\n+import org.kie.workbench.common.dmn.api.definition.model.DecisionService;\n+import org.kie.workbench.common.dmn.api.definition.model.FunctionDefinition;\n+import org.kie.workbench.common.dmn.api.definition.model.InformationItemPrimary;\n+import org.kie.workbench.common.dmn.api.definition.model.InputData;\n+import org.kie.workbench.common.dmn.api.definition.model.KnowledgeSource;\n+import org.kie.workbench.common.dmn.api.property.background.BackgroundSet;\n+import org.kie.workbench.common.dmn.api.property.dimensions.DecisionServiceRectangleDimensionsSet;\n+import org.kie.workbench.common.dmn.api.property.dimensions.GeneralRectangleDimensionsSet;\n+import org.kie.workbench.common.dmn.api.property.dmn.AllowedAnswers;\n+import org.kie.workbench.common.dmn.api.property.dmn.DMNExternalLink;\n+import org.kie.workbench.common.dmn.api.property.dmn.DecisionServiceDividerLineY;\n+import org.kie.workbench.common.dmn.api.property.dmn.Description;\n+import org.kie.workbench.common.dmn.api.property.dmn.Id;\n+import org.kie.workbench.common.dmn.api.property.dmn.KnowledgeSourceType;\n+import org.kie.workbench.common.dmn.api.property.dmn.LocationURI;\n+import org.kie.workbench.common.dmn.api.property.dmn.Name;\n+import org.kie.workbench.common.dmn.api.property.dmn.QName;\n+import org.kie.workbench.common.dmn.api.property.dmn.Question;\n+import org.kie.workbench.common.dmn.api.property.dmn.types.BuiltInType;\n+import org.kie.workbench.common.dmn.api.property.font.FontSet;\n+import org.kie.workbench.common.stunner.core.definition.clone.AbstractCloneProcessTest;\n+import org.kie.workbench.common.stunner.core.util.ClassUtils;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.kie.workbench.common.dmn.api.definition.model.FunctionDefinition.Kind.JAVA;\n+\n+public class DMNDeepCloneProcessTest extends AbstractCloneProcessTest {\n+\n+    public static final String SOURCE_ID = \"source-id\";\n+    public static final String INPUT_DATA_NAME = \"input-data\";\n+    public static final String FIRST_URL = \"firstURL\";\n+    public static final String SECOND_URL = \"secondURL\";\n+    public static final String DECISION_SERVICE_NAME = \"decision-service\";\n+    public static final String KNOWLEDGE_SOURCE_NAME = \"knowledge-source\";\n+    public static final String FUNCTION_ID = \"function-id\";\n+    public static final String CONTEXT_ID = \"context-id\";\n+    public static final String BKM_SOURCE_NAME = \"bkm-source\";\n+    public static final String DECISION_SOURCE_NAME = \"decision-source\";\n+    public static final String QUESTION = \"question?\";\n+    public static final String ANSWER = \"answer\";\n+    private DMNDeepCloneProcess dmnDeepCloneProcess;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        super.setUp();\n+        dmnDeepCloneProcess = new DMNDeepCloneProcess(factoryManager, adapterManager, new ClassUtils());\n+    }\n+\n+    @Test\n+    public void testCloneWhenSourceIsInputData() {\n+        final InputData source = buildInputData();\n+        setLinks(source, FIRST_URL, SECOND_URL);\n+\n+        final InputData cloned = dmnDeepCloneProcess.clone(source, new InputData());\n+\n+        assertThat(cloned).isNotNull();\n+        assertThat(cloned.getId().getValue()).isNotEqualTo(SOURCE_ID);\n+        assertThat(cloned.getName().getValue()).isEqualTo(INPUT_DATA_NAME);\n+        assertThat(cloned.getVariable().getTypeRef()).isEqualTo(BuiltInType.STRING.asQName());\n+        assertThat(cloned.getLinksHolder().getValue().getLinks()).hasSize(2);\n+        assertThat(cloned.getLinksHolder().getValue().getLinks()).first().extracting(\"url\").isEqualTo(FIRST_URL);", "originalCommit": "4f7e243dcde8c9191ea2f4e5a40383794e4ecd07", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTMyMDc3OQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3266#discussion_r409320779", "bodyText": "ok, sure", "author": "vpellegrino", "createdAt": "2020-04-16T06:51:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTMxMjAyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTMxMzQ3Ng==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3266#discussion_r409313476", "bodyText": "Please add javadoc explaining purpose of this class", "author": "jomarko", "createdAt": "2020-04-16T06:34:06Z", "path": "kie-wb-common-stunner/kie-wb-common-stunner-core/kie-wb-common-stunner-commons/kie-wb-common-stunner-core-common/src/main/java/org/kie/workbench/common/stunner/core/definition/clone/IDeepCloneProcess.java", "diffHunk": "@@ -0,0 +1,21 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.workbench.common.stunner.core.definition.clone;\n+\n+public interface IDeepCloneProcess extends CloneProcess{", "originalCommit": "4f7e243dcde8c9191ea2f4e5a40383794e4ecd07", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0922aed35dc068a23084130e25f18fc7891fad2e", "url": "https://github.com/kiegroup/kie-wb-common/commit/0922aed35dc068a23084130e25f18fc7891fad2e", "message": "Mockito was not able to mock BindableTypeMock, because it was package private", "committedDate": "2020-04-16T07:50:32Z", "type": "commit"}, {"oid": "e46e79c4a252d3fc774105020d4306aa4cb3d393", "url": "https://github.com/kiegroup/kie-wb-common/commit/e46e79c4a252d3fc774105020d4306aa4cb3d393", "message": "Adding java doc for IDeepCloneProcess", "committedDate": "2020-04-16T08:06:06Z", "type": "commit"}, {"oid": "ec71bcdeef7d2b604bcd486af127cfb2a0317d49", "url": "https://github.com/kiegroup/kie-wb-common/commit/ec71bcdeef7d2b604bcd486af127cfb2a0317d49", "message": "Testing both links", "committedDate": "2020-04-16T08:17:56Z", "type": "commit"}, {"oid": "7dbe90aa35f295bf68626eef919b28d21cb46e8a", "url": "https://github.com/kiegroup/kie-wb-common/commit/7dbe90aa35f295bf68626eef919b28d21cb46e8a", "message": "Adding javadoc to explain better Expression and DMNDeepCloneProcess", "committedDate": "2020-04-16T08:30:48Z", "type": "commit"}, {"oid": "c4fc6382b403f5d3c26b4cdbf22bd4ddbda81491", "url": "https://github.com/kiegroup/kie-wb-common/commit/c4fc6382b403f5d3c26b4cdbf22bd4ddbda81491", "message": "Adding test to clone method", "committedDate": "2020-04-16T11:47:34Z", "type": "commit"}, {"oid": "06a82373718bc8ab1f93fdf3ddbd445ba6c99ab3", "url": "https://github.com/kiegroup/kie-wb-common/commit/06a82373718bc8ab1f93fdf3ddbd445ba6c99ab3", "message": "Adding test to clone method", "committedDate": "2020-04-16T12:44:43Z", "type": "commit"}, {"oid": "67754863963bc7e6fae301ce6a5c0d2b6269dae4", "url": "https://github.com/kiegroup/kie-wb-common/commit/67754863963bc7e6fae301ce6a5c0d2b6269dae4", "message": "Adding test to clone method", "committedDate": "2020-04-16T13:08:09Z", "type": "commit"}, {"oid": "3ce97f0e400ea4b827f57fb4fe3193493d5b52ef", "url": "https://github.com/kiegroup/kie-wb-common/commit/3ce97f0e400ea4b827f57fb4fe3193493d5b52ef", "message": "All constants in tests should be private", "committedDate": "2020-04-16T13:27:20Z", "type": "commit"}]}