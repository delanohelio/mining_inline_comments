{"pr_number": 3130, "pr_title": "RHPAM-2182 - Multiple Instance data input and output lack of Data Typ\u2026", "pr_createdAt": "2020-01-30T08:20:41Z", "pr_url": "https://github.com/kiegroup/kie-wb-common/pull/3130", "timeline": [{"oid": "c98be91c1089bfcd62190b3f41b4d103e91e996d", "url": "https://github.com/kiegroup/kie-wb-common/commit/c98be91c1089bfcd62190b3f41b4d103e91e996d", "message": "RHPAM-2182 - Multiple Instance data input and output lack of Data Type definition", "committedDate": "2020-01-30T08:18:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzMzA2MQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3130#discussion_r373033061", "bodyText": "maybe would resolut more readable to use Streams here, you can perform a map operation and finally collect into a Map type.. Anyway nothing major.", "author": "romartin", "createdAt": "2020-01-30T15:53:29Z", "path": "kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/main/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/multipleInstanceVariableEditor/MultipleInstanceVariableEditorPresenter.java", "diffHunk": "@@ -53,18 +89,97 @@ protected IsElement getView() {\n \n     @Override\n     public void setValue(String value) {\n-        super.setValue(value);\n-        view.setVariableName(value);\n+        super.value = value;\n+        Variable variable = Variable.deserialize(value, Variable.VariableType.INPUT, simpleDataTypes);\n+        view.setModel(variable);\n     }\n \n     @Override\n     public void setReadOnly(boolean readOnly) {\n         view.setReadOnly(readOnly);\n     }\n \n-    public void onVariableNameChange() {\n+    public void onVariableChange() {\n         String oldValue = value;\n-        value = view.getVariableName();\n+        value = view.getVariableName() + \":\" + view.getVariableType();\n         notifyChange(oldValue, value);\n     }\n+\n+    public Path getDiagramPath() {\n+        final Diagram diagram = sessionManager.getCurrentSession().getCanvasHandler().getDiagram();\n+        return diagram.getMetadata().getPath();\n+    }\n+\n+    public static Map<String, String> getMapDataTypeNamesToDisplayNames() {\n+        return mapDataTypeNamesToDisplayNames;\n+    }\n+\n+    private static Map<String, String> createMapForSimpleDataTypes() {\n+        Map<String, String> mapDataTypeNamesToDisplayNames = new HashMap<>();", "originalCommit": "c98be91c1089bfcd62190b3f41b4d103e91e996d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE5NDM0NQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3130#discussion_r373194345", "bodyText": "Applied, thank you!", "author": "hasys", "createdAt": "2020-01-30T21:08:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzMzA2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzMzUzOQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3130#discussion_r373033539", "bodyText": "same here, maybe using Streams may result more readable.", "author": "romartin", "createdAt": "2020-01-30T15:54:13Z", "path": "kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/main/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/multipleInstanceVariableEditor/MultipleInstanceVariableEditorPresenter.java", "diffHunk": "@@ -53,18 +89,97 @@ protected IsElement getView() {\n \n     @Override\n     public void setValue(String value) {\n-        super.setValue(value);\n-        view.setVariableName(value);\n+        super.value = value;\n+        Variable variable = Variable.deserialize(value, Variable.VariableType.INPUT, simpleDataTypes);\n+        view.setModel(variable);\n     }\n \n     @Override\n     public void setReadOnly(boolean readOnly) {\n         view.setReadOnly(readOnly);\n     }\n \n-    public void onVariableNameChange() {\n+    public void onVariableChange() {\n         String oldValue = value;\n-        value = view.getVariableName();\n+        value = view.getVariableName() + \":\" + view.getVariableType();\n         notifyChange(oldValue, value);\n     }\n+\n+    public Path getDiagramPath() {\n+        final Diagram diagram = sessionManager.getCurrentSession().getCanvasHandler().getDiagram();\n+        return diagram.getMetadata().getPath();\n+    }\n+\n+    public static Map<String, String> getMapDataTypeNamesToDisplayNames() {\n+        return mapDataTypeNamesToDisplayNames;\n+    }\n+\n+    private static Map<String, String> createMapForSimpleDataTypes() {\n+        Map<String, String> mapDataTypeNamesToDisplayNames = new HashMap<>();\n+        for (String simpleDataType : simpleDataTypes) {\n+            mapDataTypeNamesToDisplayNames.put(simpleDataType, simpleDataType);\n+        }\n+        return mapDataTypeNamesToDisplayNames;\n+    }\n+\n+    public static IThenable.ThenOnFulfilledCallbackFn<List<String>, Object> getListObjectThenOnFulfilledCallbackFn(List<String> simpleDataTypes, ListBoxValues dataTypeListBoxValues) {\n+        return serverDataTypes -> {\n+            List<String> mergedList = new ArrayList<>(simpleDataTypes);\n+\n+            for (String type : serverDataTypes) {", "originalCommit": "c98be91c1089bfcd62190b3f41b4d103e91e996d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE5NjAzNw==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3130#discussion_r373196037", "bodyText": "It modifies two different collections with data transformed same way, I think it's better to keep it in one cycle, than create two separate streams and calculate twice. Thanks!", "author": "hasys", "createdAt": "2020-01-30T21:12:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzMzUzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzNDg3MA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3130#discussion_r373034870", "bodyText": "I see lots of public (and some static) methods in this class, there are others below. Are those really necessary to be public? It's better using private by default, in case you need access from test, you can also use package protected access (no access modifier specified)", "author": "romartin", "createdAt": "2020-01-30T15:56:19Z", "path": "kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/main/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/multipleInstanceVariableEditor/MultipleInstanceVariableEditorPresenter.java", "diffHunk": "@@ -53,18 +89,97 @@ protected IsElement getView() {\n \n     @Override\n     public void setValue(String value) {\n-        super.setValue(value);\n-        view.setVariableName(value);\n+        super.value = value;\n+        Variable variable = Variable.deserialize(value, Variable.VariableType.INPUT, simpleDataTypes);\n+        view.setModel(variable);\n     }\n \n     @Override\n     public void setReadOnly(boolean readOnly) {\n         view.setReadOnly(readOnly);\n     }\n \n-    public void onVariableNameChange() {\n+    public void onVariableChange() {\n         String oldValue = value;\n-        value = view.getVariableName();\n+        value = view.getVariableName() + \":\" + view.getVariableType();\n         notifyChange(oldValue, value);\n     }\n+\n+    public Path getDiagramPath() {\n+        final Diagram diagram = sessionManager.getCurrentSession().getCanvasHandler().getDiagram();\n+        return diagram.getMetadata().getPath();\n+    }\n+\n+    public static Map<String, String> getMapDataTypeNamesToDisplayNames() {\n+        return mapDataTypeNamesToDisplayNames;\n+    }\n+\n+    private static Map<String, String> createMapForSimpleDataTypes() {\n+        Map<String, String> mapDataTypeNamesToDisplayNames = new HashMap<>();\n+        for (String simpleDataType : simpleDataTypes) {\n+            mapDataTypeNamesToDisplayNames.put(simpleDataType, simpleDataType);\n+        }\n+        return mapDataTypeNamesToDisplayNames;\n+    }\n+\n+    public static IThenable.ThenOnFulfilledCallbackFn<List<String>, Object> getListObjectThenOnFulfilledCallbackFn(List<String> simpleDataTypes, ListBoxValues dataTypeListBoxValues) {", "originalCommit": "c98be91c1089bfcd62190b3f41b4d103e91e996d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE5NDE1OA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3130#discussion_r373194158", "bodyText": "It is not only tests but also View, so I will make it package protected. Thank you!", "author": "hasys", "createdAt": "2020-01-30T21:08:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzNDg3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzNTg3MQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3130#discussion_r373035871", "bodyText": "is this clean up necessary? I would suggest not sharing variables across tests, so no need to clean up. The JVM will do that for you :)", "author": "romartin", "createdAt": "2020-01-30T15:57:52Z", "path": "kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/test/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/multipleInstanceVariableEditor/MultipleInstanceVariableEditorPresenterTest.java", "diffHunk": "@@ -65,8 +85,118 @@ public void testSetReadonlyFalse() {\n     public void testOnVariableNameChange() {\n         editor.setValue(\"oldValue\");\n         when(view.getVariableName()).thenReturn(\"newValue\");\n-        editor.onVariableNameChange();\n-        verifyValueChange(\"oldValue\", \"newValue\");\n+        when(view.getVariableType()).thenReturn(\"Float\");\n+        editor.onVariableChange();\n+        verifyValueChange(\"oldValue\", \"newValue:Float\");\n+    }\n+\n+    @Test\n+    public void testFirstIfExistsOrSecond() {\n+        String first;\n+        String second = \"some value\";\n+\n+        assertEquals(second, getFirstIfExistsOrSecond(null, second));\n+\n+        first = \"\";\n+        assertEquals(second, getFirstIfExistsOrSecond(first, second));\n+\n+        first = \"new value\";\n+        assertEquals(first, getFirstIfExistsOrSecond(first, second));\n+    }\n+\n+    @Test\n+    public void testFullListOfTypes() {\n+        List<String> testData = new ArrayList<>();\n+        testData.add(\"org.test.Person\");\n+        testData.add(\"java.util.List\");\n+\n+        getListObjectThenOnFulfilledCallbackFn(simpleDataTypes, new ListBoxValues(\"Custom\", \"Edit\", null)).onInvoke(testData);\n+\n+        assertEquals(\"org.test.Person\", getMapDataTypeNamesToDisplayNames().get(\"Person [org.test]\"));\n+        assertEquals(\"java.util.List\", getMapDataTypeNamesToDisplayNames().get(\"List [java.util]\"));\n+\n+        // Clean up\n+        getMapDataTypeNamesToDisplayNames().remove(\"Person [org.test]\");", "originalCommit": "c98be91c1089bfcd62190b3f41b4d103e91e996d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE5Njg4Nw==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3130#discussion_r373196887", "bodyText": "Done, thanks.", "author": "hasys", "createdAt": "2020-01-30T21:14:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzNTg3MQ=="}], "type": "inlineReview"}, {"oid": "af79b28125184295458c88ff3cab78123d2cf3a0", "url": "https://github.com/kiegroup/kie-wb-common/commit/af79b28125184295458c88ff3cab78123d2cf3a0", "message": "PR review and missing tests", "committedDate": "2020-01-30T23:12:51Z", "type": "commit"}, {"oid": "69265e9b8d40f35d8143bfa53657a5677a479f5f", "url": "https://github.com/kiegroup/kie-wb-common/commit/69265e9b8d40f35d8143bfa53657a5677a479f5f", "message": "More tests", "committedDate": "2020-01-31T02:20:52Z", "type": "commit"}]}