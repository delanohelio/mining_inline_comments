{"pr_number": 989, "pr_title": "Adding default proguard config to project repo, relocating from readme", "pr_createdAt": "2020-03-30T17:14:15Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/989", "timeline": [{"oid": "74a6c38ed3521f1f3bfdff09b822860748df1f70", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/74a6c38ed3521f1f3bfdff09b822860748df1f70", "message": "Adding default proguard config to project repo, relocating from readme", "committedDate": "2020-03-30T17:10:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM2MDA4OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/989#discussion_r400360089", "bodyText": "Do we still need this bit in README?", "author": "shahzaibj", "createdAt": "2020-03-30T17:17:56Z", "path": "README.md", "diffHunk": "@@ -205,45 +205,6 @@ if(account != null){\n ## ProGuard\n MSAL uses reflection and generic type information stored in `.class` files at runtime to support various persistence and serialization related functionalities. Accordingly, library support for minification and obfuscation is limited. For reliability, we recommend developers exclude the Microsoft package from ProGuard.", "originalCommit": "74a6c38ed3521f1f3bfdff09b822860748df1f70", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM3NzI4NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/989#discussion_r400377284", "bodyText": "Only if you (or others) think it provides useful information as to why the proguard config is the way it is.\nI have no strong feelings about including this if it's just noise", "author": "iambmelt", "createdAt": "2020-03-30T17:44:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM2MDA4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM4MjIwNQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/989#discussion_r400382205", "bodyText": "I think we should remove it (or at least remove the last statement) because it seems like we are still asking developers to exclude MSAL classes within their ProGaurd file, but I believe developers no longer need to that since we have included our own ProGaurd file, right?", "author": "shahzaibj", "createdAt": "2020-03-30T17:52:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM2MDA4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQwNjAxMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/989#discussion_r400406012", "bodyText": "Updated in 79d2152\nHow does that sound now?", "author": "iambmelt", "createdAt": "2020-03-30T18:31:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM2MDA4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQyMTM3NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/989#discussion_r400421374", "bodyText": "Yeah that sounds good!", "author": "shahzaibj", "createdAt": "2020-03-30T18:56:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM2MDA4OQ=="}], "type": "inlineReview"}, {"oid": "79d2152a68852c70c8cb7a4cf72dd6377d32524f", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/79d2152a68852c70c8cb7a4cf72dd6377d32524f", "message": "Refine readme", "committedDate": "2020-03-30T18:29:54Z", "type": "commit"}, {"oid": "c6d22b7932aa836a56ba210fa96d0f648353e011", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/c6d22b7932aa836a56ba210fa96d0f648353e011", "message": "Update submodule to latest", "committedDate": "2020-03-30T19:08:28Z", "type": "commit"}, {"oid": "6441ee7d2c9b0bcff6dc446846f3fb596442c9ac", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/6441ee7d2c9b0bcff6dc446846f3fb596442c9ac", "message": "Merge branch 'dev' into iambmelt/add-pg-config", "committedDate": "2020-03-30T20:28:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY2NTMwOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/989#discussion_r400665309", "bodyText": "It's not really the idea behind a Proguard configuration file to keep all files of the library. You're supposed to only keep classes that are accessed through JNI or reflection:\nhttps://developer.android.com/studio/build/shrink-code#keep-code\nOtherwise, it removes the purpose of shrinking and obfuscation.", "author": "guillaume-tgl", "createdAt": "2020-03-31T06:12:32Z", "path": "msal/proguard-rules.pro", "diffHunk": "@@ -15,3 +15,36 @@\n #-keepclassmembers class fqcn.of.javascript.interface.for.webview {\n #   public *;\n #}\n+\n+##---------------Begin: proguard configuration for MSAL  --------\n+-keep class com.microsoft.** { *; }", "originalCommit": "74a6c38ed3521f1f3bfdff09b822860748df1f70", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE5OTEwNw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/989#discussion_r401199107", "bodyText": "Sure - unfortunately I don't have the test resources to verify that all components in the com.microsoft.* namespace can be shrunk and still behave normally, as we have some dependencies in this namespace that are external to our team. A full test pass takes a few days and a few people\nMaybe at some point in the future this can be done in an exact way, but this is today's point-in-time approach", "author": "iambmelt", "createdAt": "2020-03-31T20:36:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY2NTMwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk2NDk3MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/989#discussion_r400964971", "bodyText": "In order for proguard/R8 to be able to pick up and use these default rules you have to reference your .pro file(s) from the build.gradle file. Specifying consumerProguardFiles for the release build type is what does this, see this example:\nhttps://github.com/JakeWharton/ThreeTenABP/pull/12/files#diff-91f078d04c55297c16043badd6a8b960R33-R38", "author": "joshfriend", "createdAt": "2020-03-31T14:36:35Z", "path": "README.md", "diffHunk": "@@ -203,46 +203,7 @@ if(account != null){\n ```\n \n ## ProGuard\n-MSAL uses reflection and generic type information stored in `.class` files at runtime to support various persistence and serialization related functionalities. Accordingly, library support for minification and obfuscation is limited. For reliability, we recommend developers exclude the Microsoft package from ProGuard.\n-\n-Preserve MSAL classes:\n-```\n--keep class com.microsoft.** { *; }\n-```\n-\n-Users of MSAL must manually add the ProGuard configuration for Gson and Nimbus, dependencies of this library. An example configuration for [Gson 2.8.5](https://github.com/google/gson/releases/tag/gson-parent-2.8.5) and [Nimbus JOSE + JWT](https://search.maven.org/artifact/com.nimbusds/nimbus-jose-jwt) can be found below. Developers are encouraged to consult the documentation of relevant dependencies for the most up-to-date ProGuard guidance.\n-\n-```\n-##---------------Begin: proguard configuration for Gson  ----------\n-# Gson uses generic type information stored in a class file when working with fields. Proguard\n-# removes such information by default, so configure it to keep all of it.\n--keepattributes Signature\n-\n-# For using GSON @Expose annotation\n--keepattributes *Annotation*\n-\n-# Gson specific classes\n--dontwarn sun.misc.**\n-#-keep class com.google.gson.stream.** { *; }\n-\n-# Application classes that will be serialized/deserialized over Gson\n--keep class com.google.gson.examples.android.model.** { <fields>; }\n-\n-# Prevent proguard from stripping interface information from TypeAdapter, TypeAdapterFactory,\n-# JsonSerializer, JsonDeserializer instances (so they can be used in @JsonAdapter)\n--keep class * implements com.google.gson.TypeAdapter\n--keep class * implements com.google.gson.TypeAdapterFactory\n--keep class * implements com.google.gson.JsonSerializer\n--keep class * implements com.google.gson.JsonDeserializer\n-\n-# Prevent R8 from leaving Data object members always null\n--keepclassmembers,allowobfuscation class * {\n-  @com.google.gson.annotations.SerializedName <fields>;\n-}\n-\n-##---------------Begin: proguard configuration for Nimbus  ----------\n--keep class com.nimbusds.** { *; }\n-```\n+MSAL uses reflection and generic type information stored in `.class` files at runtime to support various persistence and serialization related functionalities. Accordingly, library support for minification and obfuscation is limited. A default configuration is shipped with this library; please [file an issue](https://github.com/AzureAD/microsoft-authentication-library-for-android/issues/new/choose) if you find any issues.", "originalCommit": "6441ee7d2c9b0bcff6dc446846f3fb596442c9ac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk2NjY1OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/989#discussion_r400966659", "bodyText": "another example from the appcenter sdk: https://github.com/microsoft/appcenter-sdk-android/blob/f80899948cc9769cb4f4909e357bbef64c5ffc1e/sdk/build.gradle#L38", "author": "joshfriend", "createdAt": "2020-03-31T14:38:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk2NDk3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIxMjU1OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/989#discussion_r401212558", "bodyText": "Great -- I've incorporated this feedback in 7437a3f\nThanks for taking a look!", "author": "iambmelt", "createdAt": "2020-03-31T21:00:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk2NDk3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIyMDEwMQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/989#discussion_r401220101", "bodyText": "I'll leave this PR open until tomorrow before I merge it up -- if you have any other feedback happy to incorporate it", "author": "iambmelt", "createdAt": "2020-03-31T21:15:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk2NDk3MQ=="}], "type": "inlineReview"}, {"oid": "7437a3f552c020183d1070be30407c83b1b8c39c", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/7437a3f552c020183d1070be30407c83b1b8c39c", "message": "Updating gradle release type + renaming proguard rules file", "committedDate": "2020-03-31T20:58:53Z", "type": "commit"}]}