{"pr_number": 1044, "pr_title": "[Docs] Document Prompt Behavior with+/out Broker", "pr_createdAt": "2020-05-14T18:10:44Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1044", "timeline": [{"oid": "c1892c19a721f26bb3f048a44526ea140f1f3f9b", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/c1892c19a721f26bb3f048a44526ea140f1f3f9b", "message": "Create prompt_behavior.md", "committedDate": "2020-05-14T18:09:59Z", "type": "commit"}, {"oid": "4bea3dd872aee20436916d03ddc8897f961c2aa0", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/4bea3dd872aee20436916d03ddc8897f961c2aa0", "message": "Merge branch 'dev' into iambmelt/docs-prompt-behavior", "committedDate": "2020-05-14T18:11:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTMzODE5NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1044#discussion_r425338194", "bodyText": "File a bug", "author": "iambmelt", "createdAt": "2020-05-14T18:13:34Z", "path": "docs/prompt_behavior.md", "diffHunk": "@@ -0,0 +1,16 @@\n+# Android Prompt & PromptBehavior\n+\n+| Product | Prompt            | Embedded Behavior                                                                                                                                                                                                                                          | (Embedded) OpenId Prompt Equivalent                                                              | Sent to Broker?      | Broker Behavior                                                                                                                                                                                                                                                                                                        | (Broker) OpenId Prompt Equivalent                         |\n+|---------|-------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|\n+| ADAL    | `null`            | Equivalent to `Auto`                                                                                                                                                                                                                                       | (unsent)                                                                                         | N/A                  | Equivalent to `Auto`                                                                                                                                                                                                                                                                                                   | (unsent)                                                  |\n+| ADAL    | `Auto`            | Silent request is first attempted. If unsuccessful, switch to interactive.                                                                                                                                                                                 | (unsent)                                                                                         | Yes                  | Broker attempts silent request first. If `claimsChallenge` is provided, broker will skip AT in cache and use RT to acquire new tokens. If silent request fails, call will go interactive.                                                                                                                              | (unsent)                                                  |\n+| ADAL    | `Always`          | The user will be prompted for credentials even if cached tokens already exist.                                                                                                                                                                             | `login`                                                                                          | Yes, augmented       | Broker attempts silent request first. If `claimsChallenge` is provided, broker will skip AT in cache and use RT to acquire new tokens. If silent request fails, call will go interactive.                                                                                                                              | (unsent)                                                  |\n+| ADAL    | `REFRESH_SESSION` | Interactively reauthorizes the user. If cookies are available in WebView, the user will not be prompted for credentials and the UI will dismiss automatically.                                                                                             | `refresh_session`                                                                                | Yes, but unsupported | Unsupported by V2 endpoint                                                                                                                                                                                                                                                                                             | (unsent)                                                  |\n+| ADAL    | `FORCE_PROMPT`    | If no broker is installed, behaves equivalent to `Always`. If broker _is_ installed, a prompt for credentials will be shown.                                                                                                                               | `login`                                                                                          | Yes                  | Equivalent to `Always` in embedded flow.                                                                                                                                                                                                                                                                               | `login`                                                   |\n+| MSAL    | `null`            | Equivalent to `WHEN_REQUIRED`                                                                                                                                                                                                                              | (unsent)                                                                                         | N/A                  | Broker attempts silent request first. If `claimsChallenge` is provided, broker will skip AT in cache and use RT to acquire new tokens. If silent request fails, call will go interactive.                                                                                                                              | (unsent)                                                  |\n+| MSAL    | `SELECT_ACCOUNT`  | If `login_hint` is supplied, behaves as `null`/`WHEN_REQUIRED`; otherwise, sends query param `prompt=select_account` to `/authorize` endpoint. Shows a list of accounts the user can choose from to authorize.                                             | If `login_hint` is supplied, unsent <br/> If no `login_hint` is supplied, sends `select_account` | Yes                  | If `login_hint` is supplied, behaves as `null`/`WHEN_REQUIRED`; otherwise, `AccountChooserActivity` is shown. Account picker inside of ESTS/WebView is _never_ shown, as the user would have already pre-selected an account via `AccountChooserActivity`. If user selects '`Add Account`', no `prompt=login` is sent. | (unsent - account selection via `AccountChooserActivity`) |\n+| MSAL    | `LOGIN`           | Sends query param `prompt=login` to `/authorize` endpoint. The user will _always_ be prompted for credentials by the service.                                                                                                                              | `login`                                                                                          | Yes                  | Same as embedded flow.                                                                                                                                                                                                                                                                                                 | `login`                                                   |\n+| MSAL    | `CONSENT`         | Sends query param `prompt=consent` to `/authorize` endpoint. The user will be prompted to grant consent, even if it was previously granted before. `// TODO what happens for pre-authz apps?`                                                              | `consent`                                                                                        | Yes                  | BUG: User is not shown prompt for consent. <br/>Expected: User shown consent page                                                                                                                                                                                                                                      | `consent`                                                 |\n+| MSAL    | `WHEN_REQUIRED`   | If `login_hint` is supplied, no `prompt` query parameter will be sent to the `/authorize` endpoint. The user _may_ be preompted to login or grant consent as required by the service/application. If no `login_hint` is supplied, `prompt=select_account`. | If `login_hint` is supplied, unsent <br/> If no `login_hint` is supplied, sends `select_account` | N/A                  | Same as embedded flow                                                                                                                                                                                                                                                                                                  | (unsent - account selection via `AccountChooserActivity`) |\n+\n+>Note: `CONSENT` not implemented inside of broker with MSAL", "originalCommit": "4bea3dd872aee20436916d03ddc8897f961c2aa0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTMzODM5NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1044#discussion_r425338395", "bodyText": "Make table reflect desired behavior once bug is filed", "author": "iambmelt", "createdAt": "2020-05-14T18:13:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTMzODE5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM0NzkwNA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1044#discussion_r425347904", "bodyText": "Bug filed here:\nAzureAD/ad-accounts-for-android#1294\nContains link to VSO PBI", "author": "iambmelt", "createdAt": "2020-05-14T18:31:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTMzODE5NA=="}], "type": "inlineReview"}, {"oid": "aa77d4bd5f749b514b899c8f22d8954636932586", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/aa77d4bd5f749b514b899c8f22d8954636932586", "message": "Remove notes re: bugs (they have been filed, linked, and tracked)", "committedDate": "2020-05-14T18:33:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQyODk1Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1044#discussion_r425428953", "bodyText": "Got the update from PM team: PreAuthZ apps simply ignore this param", "author": "iambmelt", "createdAt": "2020-05-14T21:03:16Z", "path": "docs/prompt_behavior.md", "diffHunk": "@@ -0,0 +1,14 @@\n+# Android Prompt & PromptBehavior\n+\n+| Product | Prompt            | Embedded Behavior                                                                                                                                                                                                                                          | (Embedded) OpenId Prompt Equivalent                                                              | Sent to Broker?      | Broker Behavior                                                                                                                                                                                                                                                                                                        | (Broker) OpenId Prompt Equivalent                         |\n+|---------|-------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|\n+| ADAL    | `null`            | Equivalent to `Auto`                                                                                                                                                                                                                                       | (unsent)                                                                                         | N/A                  | Equivalent to `Auto`                                                                                                                                                                                                                                                                                                   | (unsent)                                                  |\n+| ADAL    | `Auto`            | Silent request is first attempted. If unsuccessful, switch to interactive.                                                                                                                                                                                 | (unsent)                                                                                         | Yes                  | Broker attempts silent request first. If `claimsChallenge` is provided, broker will skip AT in cache and use RT to acquire new tokens. If silent request fails, call will go interactive.                                                                                                                              | (unsent)                                                  |\n+| ADAL    | `Always`          | The user will be prompted for credentials even if cached tokens already exist.                                                                                                                                                                             | `login`                                                                                          | Yes, augmented       | Broker attempts silent request first. If `claimsChallenge` is provided, broker will skip AT in cache and use RT to acquire new tokens. If silent request fails, call will go interactive.                                                                                                                              | (unsent)                                                  |\n+| ADAL    | `REFRESH_SESSION` | Interactively reauthorizes the user. If cookies are available in WebView, the user will not be prompted for credentials and the UI will dismiss automatically.                                                                                             | `refresh_session`                                                                                | Yes, but unsupported | Unsupported by V2 endpoint                                                                                                                                                                                                                                                                                             | (unsent)                                                  |\n+| ADAL    | `FORCE_PROMPT`    | If no broker is installed, behaves equivalent to `Always`. If broker _is_ installed, a prompt for credentials will be shown.                                                                                                                               | `login`                                                                                          | Yes                  | Equivalent to `Always` in embedded flow.                                                                                                                                                                                                                                                                               | `login`                                                   |\n+| MSAL    | `null`            | Equivalent to `WHEN_REQUIRED`                                                                                                                                                                                                                              | (unsent)                                                                                         | N/A                  | Broker attempts silent request first. If `claimsChallenge` is provided, broker will skip AT in cache and use RT to acquire new tokens. If silent request fails, call will go interactive.                                                                                                                              | (unsent)                                                  |\n+| MSAL    | `SELECT_ACCOUNT`  | If `login_hint` is supplied, behaves as `null`/`WHEN_REQUIRED`; otherwise, sends query param `prompt=select_account` to `/authorize` endpoint. Shows a list of accounts the user can choose from to authorize.                                             | If `login_hint` is supplied, unsent <br/> If no `login_hint` is supplied, sends `select_account` | Yes                  | If `login_hint` is supplied, behaves as `null`/`WHEN_REQUIRED`; otherwise, `AccountChooserActivity` is shown. Account picker inside of ESTS/WebView is _never_ shown, as the user would have already pre-selected an account via `AccountChooserActivity`. If user selects '`Add Account`', no `prompt=login` is sent. | (unsent - account selection via `AccountChooserActivity`) |\n+| MSAL    | `LOGIN`           | Sends query param `prompt=login` to `/authorize` endpoint. The user will _always_ be prompted for credentials by the service.                                                                                                                              | `login`                                                                                          | Yes                  | Same as embedded flow.                                                                                                                                                                                                                                                                                                 | `login`                                                   |\n+| MSAL    | `CONSENT`         | Sends query param `prompt=consent` to `/authorize` endpoint. The user will be prompted to grant consent, even if it was previously granted before. `// TODO what happens for pre-authz apps?`                                                              | `consent`                                                                                        | Yes                  |  Sends query param `prompt=consent` to `/authorize` endpoint. The user will be prompted to grant consent, even if it was previously granted before.                                                                                                                                                                                                                                      | `consent`                                                 |", "originalCommit": "aa77d4bd5f749b514b899c8f22d8954636932586", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQzOTM5Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1044#discussion_r425439393", "bodyText": "Updated in d122373", "author": "iambmelt", "createdAt": "2020-05-14T21:24:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQyODk1Mw=="}], "type": "inlineReview"}, {"oid": "d12237313c27dc75f4c3b5a863113b49bcdd09f4", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/d12237313c27dc75f4c3b5a863113b49bcdd09f4", "message": "Update prompt_behavior.md", "committedDate": "2020-05-14T21:04:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk4OTY1MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1044#discussion_r425989651", "bodyText": "Probable typo: preompted -> prompted", "author": "MariusVolkhart", "createdAt": "2020-05-15T18:55:52Z", "path": "docs/prompt_behavior.md", "diffHunk": "@@ -0,0 +1,14 @@\n+# Android Prompt & PromptBehavior\n+\n+| Product | Prompt            | Embedded Behavior                                                                                                                                                                                                                                          | (Embedded) OpenId Prompt Equivalent                                                              | Sent to Broker?      | Broker Behavior                                                                                                                                                                                                                                                                                                        | (Broker) OpenId Prompt Equivalent                         |\n+|---------|-------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|\n+| ADAL    | `null`            | Equivalent to `Auto`                                                                                                                                                                                                                                       | (unsent)                                                                                         | N/A                  | Equivalent to `Auto`                                                                                                                                                                                                                                                                                                   | (unsent)                                                  |\n+| ADAL    | `Auto`            | Silent request is first attempted. If unsuccessful, switch to interactive.                                                                                                                                                                                 | (unsent)                                                                                         | Yes                  | Broker attempts silent request first. If `claimsChallenge` is provided, broker will skip AT in cache and use RT to acquire new tokens. If silent request fails, call will go interactive.                                                                                                                              | (unsent)                                                  |\n+| ADAL    | `Always`          | The user will be prompted for credentials even if cached tokens already exist.                                                                                                                                                                             | `login`                                                                                          | Yes, augmented       | Broker attempts silent request first. If `claimsChallenge` is provided, broker will skip AT in cache and use RT to acquire new tokens. If silent request fails, call will go interactive.                                                                                                                              | (unsent)                                                  |\n+| ADAL    | `REFRESH_SESSION` | Interactively reauthorizes the user. If cookies are available in WebView, the user will not be prompted for credentials and the UI will dismiss automatically.                                                                                             | `refresh_session`                                                                                | Yes, but unsupported | Unsupported by V2 endpoint                                                                                                                                                                                                                                                                                             | (unsent)                                                  |\n+| ADAL    | `FORCE_PROMPT`    | If no broker is installed, behaves equivalent to `Always`. If broker _is_ installed, a prompt for credentials will be shown.                                                                                                                               | `login`                                                                                          | Yes                  | Equivalent to `Always` in embedded flow.                                                                                                                                                                                                                                                                               | `login`                                                   |\n+| MSAL    | `null`            | Equivalent to `WHEN_REQUIRED`                                                                                                                                                                                                                              | (unsent)                                                                                         | N/A                  | Broker attempts silent request first. If `claimsChallenge` is provided, broker will skip AT in cache and use RT to acquire new tokens. If silent request fails, call will go interactive.                                                                                                                              | (unsent)                                                  |\n+| MSAL    | `SELECT_ACCOUNT`  | If `login_hint` is supplied, behaves as `null`/`WHEN_REQUIRED`; otherwise, sends query param `prompt=select_account` to `/authorize` endpoint. Shows a list of accounts the user can choose from to authorize.                                             | If `login_hint` is supplied, unsent <br/> If no `login_hint` is supplied, sends `select_account` | Yes                  | If `login_hint` is supplied, behaves as `null`/`WHEN_REQUIRED`; otherwise, `AccountChooserActivity` is shown. Account picker inside of ESTS/WebView is _never_ shown, as the user would have already pre-selected an account via `AccountChooserActivity`. If user selects '`Add Account`', no `prompt=login` is sent. | (unsent - account selection via `AccountChooserActivity`) |\n+| MSAL    | `LOGIN`           | Sends query param `prompt=login` to `/authorize` endpoint. The user will _always_ be prompted for credentials by the service.                                                                                                                              | `login`                                                                                          | Yes                  | Same as embedded flow.                                                                                                                                                                                                                                                                                                 | `login`                                                   |\n+| MSAL    | `CONSENT`         | Sends query param `prompt=consent` to `/authorize` endpoint. The user will be prompted to grant consent, even if it was previously granted before. This param will be ignored by 1P apps, as these apps are pre-consented via M365 TOC.                                                              | `consent`                                                                                        | Yes                  |  Sends query param `prompt=consent` to `/authorize` endpoint. The user will be prompted to grant consent, even if it was previously granted before.                                                                                                                                                                                                                                      | `consent`                                                 |\n+| MSAL    | `WHEN_REQUIRED`   | If `login_hint` is supplied, no `prompt` query parameter will be sent to the `/authorize` endpoint. The user _may_ be preompted to login or grant consent as required by the service/application. If no `login_hint` is supplied, `prompt=select_account`. | If `login_hint` is supplied, unsent <br/> If no `login_hint` is supplied, sends `select_account` | N/A                  | Same as embedded flow                                                                                                                                                                                                                                                                                                  | (unsent - account selection via `AccountChooserActivity`) |", "originalCommit": "d12237313c27dc75f4c3b5a863113b49bcdd09f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE4MTgyOA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1044#discussion_r426181828", "bodyText": "7c077ed", "author": "iambmelt", "createdAt": "2020-05-16T19:08:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk4OTY1MQ=="}], "type": "inlineReview"}, {"oid": "7c077ed43ce1e18448c640d159df28c248caeecf", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/7c077ed43ce1e18448c640d159df28c248caeecf", "message": "Fix spelling error", "committedDate": "2020-05-16T19:07:20Z", "type": "commit"}, {"oid": "51fc3027655b031e082e63c5c3bffa806fea1a6b", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/51fc3027655b031e082e63c5c3bffa806fea1a6b", "message": "Merge branch 'dev' into iambmelt/docs-prompt-behavior", "committedDate": "2020-05-16T19:24:01Z", "type": "commit"}]}