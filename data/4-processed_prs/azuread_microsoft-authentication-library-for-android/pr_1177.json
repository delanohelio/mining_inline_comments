{"pr_number": 1177, "pr_title": "Add MSAL Automation Flavors", "pr_createdAt": "2020-10-06T15:54:38Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1177", "timeline": [{"oid": "5d6c1d2feea457a0c9b32d43b23a417ef0a5c2cd", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/5d6c1d2feea457a0c9b32d43b23a417ef0a5c2cd", "message": "Add broker as flavor to msal automation app", "committedDate": "2020-10-03T02:42:57Z", "type": "commit"}, {"oid": "7e9872216510ea7679c8e2b01c640aebf9ebd3a9", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/7e9872216510ea7679c8e2b01c640aebf9ebd3a9", "message": "Refactor msal broker tests to use broker from flavor", "committedDate": "2020-10-03T02:43:18Z", "type": "commit"}, {"oid": "f32c293088b12714d71264796641feb652aaba39", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/f32c293088b12714d71264796641feb652aaba39", "message": "Refactor automation app flavor names", "committedDate": "2020-10-03T02:56:51Z", "type": "commit"}, {"oid": "7ad372d1e3af36444c2c4189a84768de387bef15", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/7ad372d1e3af36444c2c4189a84768de387bef15", "message": "Use broker instance variable when referencing broker", "committedDate": "2020-10-05T22:02:59Z", "type": "commit"}, {"oid": "86cb3083268004b376d93dcd39b1d614be566755", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/86cb3083268004b376d93dcd39b1d614be566755", "message": "Merge branch 'dev' into shahzaibj/automation-variants", "committedDate": "2020-10-06T19:22:33Z", "type": "commit"}, {"oid": "6f0b9581d98a85ac58fef46fc7b4509d5f95c95b", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/6f0b9581d98a85ac58fef46fc7b4509d5f95c95b", "message": "Update submodule", "committedDate": "2020-10-06T19:45:02Z", "type": "commit"}, {"oid": "95c14e0f403aa3589666e3a86c0467d91f07dd00", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/95c14e0f403aa3589666e3a86c0467d91f07dd00", "message": "Merge branch 'dev' into shahzaibj/automation-variants", "committedDate": "2020-10-07T16:19:04Z", "type": "commit"}, {"oid": "f2e68974b30c6010c77c4b6b8e3dff38d3733ecd", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/f2e68974b30c6010c77c4b6b8e3dff38d3733ecd", "message": "Update submodule", "committedDate": "2020-10-07T16:19:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE2MDEyNA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1177#discussion_r501160124", "bodyText": "How does this work? Does it matter what flavor/build the automation test app is built with?\nShould we use the signature hash of the APKs instead to see if the combination is valid?", "author": "rpdome", "createdAt": "2020-10-07T16:45:35Z", "path": "msalautomationapp/build.gradle", "diffHunk": "@@ -50,26 +50,60 @@ android {\n         }\n     }\n \n-    testBuildType = \"release\"\n+    testBuildType = \"debug\"\n \n     lintOptions {\n         abortOnError false\n     }\n \n-    flavorDimensions \"main\"\n+    flavorDimensions \"main\", \"broker\"\n \n     productFlavors {\n         local {\n+            dimension \"main\"\n             applicationIdSuffix \".local\"\n             versionNameSuffix \"-local\"\n             resValue(\"string\", \"application_name\", \"msal-local\")\n         }\n         dist {\n+            dimension \"main\"\n             // Keep .local because the redirect url we registered on the portal contains .local, not .dist\n             applicationIdSuffix \".local\"\n             versionNameSuffix \"-dist\"\n             resValue(\"string\", \"application_name\", \"msal-dist\")\n         }\n+\n+        BrokerMicrosoftAuthenticator {\n+            dimension \"broker\"\n+        }\n+\n+        BrokerCompanyPortal {\n+            dimension \"broker\"\n+        }\n+\n+        BrokerHost {\n+            dimension \"broker\"\n+        }\n+    }\n+\n+    variantFilter { variant ->\n+        def flavorName = variant.flavors*.name", "originalCommit": "f2e68974b30c6010c77c4b6b8e3dff38d3733ecd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE2Mzg3Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1177#discussion_r501163877", "bodyText": "All we are doing here is excluding specific build variants from gradle because such variants are just not supported under any circumstance. For instance, we don't support using Company Portal with a localDebug build of MSAL because MSAL will just not talk to it.", "author": "shahzaibj", "createdAt": "2020-10-07T16:51:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE2MDEyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE2NjUzOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1177#discussion_r501166539", "bodyText": "So we aren't checking here if a specific flavor of MSAL can work with a specific flavor of broker. All we are doing here is just excluding some variants that we don't support in the MSAL Automation App (at least as of today).", "author": "shahzaibj", "createdAt": "2020-10-07T16:55:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE2MDEyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE3NDA3OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1177#discussion_r501174078", "bodyText": "what I meant is that I can technically upload MSAL/Broker with any build/flavor and pick the 'right' build/flavor for the msalautomationapp, right?", "author": "rpdome", "createdAt": "2020-10-07T17:07:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE2MDEyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE3NTU4MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1177#discussion_r501175581", "bodyText": "Broker yes.....MSAL is selected by the build variant (local vs dist).\nSo yes technically you can select Broker flavor as BrokerHost and instead supply Authenticator app when running the automation. In that case the tests will fail because the tests will be looking for a BrokerHost apk and if they don't find it then they will fail.", "author": "shahzaibj", "createdAt": "2020-10-07T17:09:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE2MDEyNA=="}], "type": "inlineReview"}, {"oid": "a835579e1a341c244362aceb988d8b0093349e3b", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/a835579e1a341c244362aceb988d8b0093349e3b", "message": "Merge branch 'dev' into shahzaibj/automation-variants", "committedDate": "2020-10-08T22:19:27Z", "type": "commit"}, {"oid": "4e5a5dd0781f77f40256cdbfae2ca9b2ee7898f4", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/4e5a5dd0781f77f40256cdbfae2ca9b2ee7898f4", "message": "Use constants for broker/flavor names", "committedDate": "2020-10-08T22:40:35Z", "type": "commit"}]}