{"pr_number": 2103, "pr_title": "Subclass events to do visitor dispatch", "pr_createdAt": "2020-10-20T17:20:06Z", "pr_url": "https://github.com/aws/aws-sdk-java-v2/pull/2103", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODcxNDYyMg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2103#discussion_r508714622", "bodyText": "Uhhh I need to fix this!", "author": "dagnir", "createdAt": "2020-10-20T17:35:43Z", "path": "codegen/src/test/resources/software/amazon/awssdk/codegen/poet/model/eventone.java", "diffHunk": "@@ -164,7 +164,7 @@ public final void setFoo(String foo) {\n \n         @Override\n         public EventOne build() {\n-            return new EventOne(this);\n+            throw new UnsupportedOperationException();", "originalCommit": "7e254a8fe1d4ca0820721ea04f80615ca87d6027", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "aac901003e65a7fff437cb0bf172394729c2c26b", "url": "https://github.com/aws/aws-sdk-java-v2/commit/aac901003e65a7fff437cb0bf172394729c2c26b", "message": "Subclass events to do visitor dispatch\n\nGenerate events as discrete subclasses of the base shape class that take care\ndispatching to the correct visitor method.", "committedDate": "2020-10-20T21:17:10Z", "type": "forcePushed"}, {"oid": "35ddb8c51ed55a344872d9d6fb420f4fb5554130", "url": "https://github.com/aws/aws-sdk-java-v2/commit/35ddb8c51ed55a344872d9d6fb420f4fb5554130", "message": "Add customization for Transcribe AudioStream", "committedDate": "2020-10-21T22:34:31Z", "type": "forcePushed"}, {"oid": "ebd81f79382e44a9449c170494378546b49797e6", "url": "https://github.com/aws/aws-sdk-java-v2/commit/ebd81f79382e44a9449c170494378546b49797e6", "message": "Add builder methods to eventstream interface", "committedDate": "2020-10-22T23:29:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAyODQxMA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2103#discussion_r511028410", "bodyText": "Can we add sdk internal api annotation and javadocs?", "author": "zoewangg", "createdAt": "2020-10-23T17:19:50Z", "path": "codegen/src/test/resources/software/amazon/awssdk/codegen/poet/model/eventone.java", "diffHunk": "@@ -21,24 +21,24 @@\n /**\n  */\n @Generated(\"software.amazon.awssdk:codegen\")\n-public final class EventOne implements SdkPojo, Serializable, ToCopyableBuilder<EventOne.Builder, EventOne>, EventStream {\n+public class EventOne implements SdkPojo, Serializable, ToCopyableBuilder<EventOne.Builder, EventOne>, EventStream {", "originalCommit": "ebd81f79382e44a9449c170494378546b49797e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA2NzY3MQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2103#discussion_r511067671", "bodyText": "I don't think it would make sense to make these internal because they're used as the return type of static builder methods on the event stream interface. Also seems like it's possible that an event shape can be used in a non event stream context, like a member on a non eventstream structure.", "author": "dagnir", "createdAt": "2020-10-23T18:32:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAyODQxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAzMTI0Mg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2103#discussion_r511031242", "bodyText": "Hmm, not a big fan of the underscore in the end. Can we use something else? Or rename the base class to BaseEventOne?", "author": "zoewangg", "createdAt": "2020-10-23T17:25:17Z", "path": "codegen/src/test/resources/software/amazon/awssdk/codegen/poet/eventstream/eventone_.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package software.amazon.awssdk.services.jsonprotocoltests.model.eventstream;\n+\n+import software.amazon.awssdk.annotations.Generated;\n+import software.amazon.awssdk.annotations.SdkInternalApi;\n+import software.amazon.awssdk.services.jsonprotocoltests.model.EventOne;\n+import software.amazon.awssdk.services.jsonprotocoltests.model.EventStreamOperationResponseHandler;\n+\n+/**\n+ * A specialization of {@code software.amazon.awssdk.services.jsonprotocoltests.model.EventOne} that represents the\n+ * {@code EventStream#EventOne} event. Do not use this class directly. Instead, use the static builder methods on\n+ * {@link software.amazon.awssdk.services.jsonprotocoltests.model.EventStream}.\n+ */\n+@SdkInternalApi\n+@Generated(\"software.amazon.awssdk:codegen\")\n+public final class EventOne_ extends EventOne {", "originalCommit": "ebd81f79382e44a9449c170494378546b49797e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA2NTg0Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2103#discussion_r511065843", "bodyText": "Hmm have a suggestion for an alternative suffix/prefix?", "author": "dagnir", "createdAt": "2020-10-23T18:30:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAzMTI0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE3NjkwMw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2103#discussion_r511176903", "bodyText": "Settled on \"Default\" as a prefix", "author": "dagnir", "createdAt": "2020-10-23T22:10:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAzMTI0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA3NDU0OQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2103#discussion_r511074549", "bodyText": "Can we mark all methods that are not intended to be overridden final?", "author": "zoewangg", "createdAt": "2020-10-23T18:40:06Z", "path": "codegen/src/test/resources/software/amazon/awssdk/codegen/poet/model/eventone.java", "diffHunk": "@@ -21,24 +21,24 @@\n /**\n  */\n @Generated(\"software.amazon.awssdk:codegen\")\n-public final class EventOne implements SdkPojo, Serializable, ToCopyableBuilder<EventOne.Builder, EventOne>, EventStream {\n+public class EventOne implements SdkPojo, Serializable, ToCopyableBuilder<EventOne.Builder, EventOne>, EventStream {\n     private static final SdkField<String> FOO_FIELD = SdkField.<String> builder(MarshallingType.STRING).memberName(\"Foo\")\n-                                                                                                       .getter(getter(EventOne::foo)).setter(setter(Builder::foo))\n-                                                                                                       .traits(LocationTrait.builder().location(MarshallLocation.PAYLOAD).locationName(\"Foo\").build()).build();\n+            .getter(getter(EventOne::foo)).setter(setter(Builder::foo))\n+            .traits(LocationTrait.builder().location(MarshallLocation.PAYLOAD).locationName(\"Foo\").build()).build();\n \n     private static final List<SdkField<?>> SDK_FIELDS = Collections.unmodifiableList(Arrays.asList(FOO_FIELD));\n \n     private static final long serialVersionUID = 1L;\n \n     private final String foo;\n \n-    private EventOne(BuilderImpl builder) {\n+    protected EventOne(BuilderImpl builder) {\n         this.foo = builder.foo;\n     }\n \n     /**\n      * Returns the value of the Foo property for this object.\n-     *\n+     * \n      * @return The value of the Foo property for this object.\n      */\n     public String foo() {", "originalCommit": "ebd81f79382e44a9449c170494378546b49797e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE2MzkyNA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2103#discussion_r511163924", "bodyText": "Done", "author": "dagnir", "createdAt": "2020-10-23T21:30:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA3NDU0OQ=="}], "type": "inlineReview"}, {"oid": "0fe44d556e0a7b97795cc144683078666948f680", "url": "https://github.com/aws/aws-sdk-java-v2/commit/0fe44d556e0a7b97795cc144683078666948f680", "message": "Use \"Default\" prefix for event classes", "committedDate": "2020-10-23T21:36:05Z", "type": "forcePushed"}, {"oid": "8906af94f1227762d8fad05c03b99fc9113d9b64", "url": "https://github.com/aws/aws-sdk-java-v2/commit/8906af94f1227762d8fad05c03b99fc9113d9b64", "message": "Use \"Default\" prefix for event classes", "committedDate": "2020-10-23T22:09:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE3ODAxNA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2103#discussion_r511178014", "bodyText": "It'd nice if we can only add final to non-final model classes, but I guess it's not trivial to do so with the current implementation of the model codegen class spec.", "author": "zoewangg", "createdAt": "2020-10-23T22:14:19Z", "path": "codegen/src/test/resources/software/amazon/awssdk/codegen/poet/model/alltypesrequest.java", "diffHunk": "@@ -495,63 +495,63 @@ private AllTypesRequest(BuilderImpl builder) {\n \n     /**\n      * Returns the value of the StringMember property for this object.\n-     *\n+     * \n      * @return The value of the StringMember property for this object.\n      */\n-    public String stringMember() {\n+    public final String stringMember() {\n         return stringMember;\n     }\n \n     /**\n      * Returns the value of the IntegerMember property for this object.\n-     *\n+     * \n      * @return The value of the IntegerMember property for this object.\n      */\n-    public Integer integerMember() {\n+    public final Integer integerMember() {\n         return integerMember;\n     }\n \n     /**\n      * Returns the value of the BooleanMember property for this object.\n-     *\n+     * \n      * @return The value of the BooleanMember property for this object.\n      */\n-    public Boolean booleanMember() {\n+    public final Boolean booleanMember() {\n         return booleanMember;\n     }\n \n     /**\n      * Returns the value of the FloatMember property for this object.\n-     *\n+     * \n      * @return The value of the FloatMember property for this object.\n      */\n-    public Float floatMember() {\n+    public final Float floatMember() {\n         return floatMember;\n     }\n \n     /**\n      * Returns the value of the DoubleMember property for this object.\n-     *\n+     * \n      * @return The value of the DoubleMember property for this object.\n      */\n-    public Double doubleMember() {\n+    public final Double doubleMember() {", "originalCommit": "8906af94f1227762d8fad05c03b99fc9113d9b64", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTIwODUxMA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2103#discussion_r511208510", "bodyText": "Yeah special casing events would make AwsServieModel even more complicated. Since they're final classes we can always remove the final on the methods at a later time without breaking binary compatibility.", "author": "dagnir", "createdAt": "2020-10-24T00:21:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE3ODAxNA=="}], "type": "inlineReview"}, {"oid": "7023f9e0a6d563b9fe6752d46d897dc0c1c86d94", "url": "https://github.com/aws/aws-sdk-java-v2/commit/7023f9e0a6d563b9fe6752d46d897dc0c1c86d94", "message": "Subclass events to do visitor dispatch\n\nGenerate events as discrete subclasses of the base shape class that take care\ndispatching to the correct visitor method. The base shape is what we would\ngenerate as a normal model class for a non request/response shape today.\nHowever, because they need to be extended, they are no longer final; insteach\nany method that can be made final (such as property getters) is made final.\n\nThis commit also generates static builder methods on the event stream interface\nto make discovery and creation of events easier.", "committedDate": "2020-10-23T23:59:27Z", "type": "commit"}, {"oid": "7023f9e0a6d563b9fe6752d46d897dc0c1c86d94", "url": "https://github.com/aws/aws-sdk-java-v2/commit/7023f9e0a6d563b9fe6752d46d897dc0c1c86d94", "message": "Subclass events to do visitor dispatch\n\nGenerate events as discrete subclasses of the base shape class that take care\ndispatching to the correct visitor method. The base shape is what we would\ngenerate as a normal model class for a non request/response shape today.\nHowever, because they need to be extended, they are no longer final; insteach\nany method that can be made final (such as property getters) is made final.\n\nThis commit also generates static builder methods on the event stream interface\nto make discovery and creation of events easier.", "committedDate": "2020-10-23T23:59:27Z", "type": "forcePushed"}]}