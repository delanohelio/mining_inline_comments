{"pr_number": 1654, "pr_title": "Dynamodb-enhanced [preview]: Updates all operations with consumer sty\u2026", "pr_createdAt": "2020-02-17T20:57:45Z", "pr_url": "https://github.com/aws/aws-sdk-java-v2/pull/1654", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg5Njk2NA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380896964", "bodyText": "This looks like a good candidate for a utils class, and can be re-used in other classes that do a similar thing.", "author": "bmaizels", "createdAt": "2020-02-18T19:48:46Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/model/BatchGetItemEnhancedRequest.java", "diffHunk": "@@ -66,14 +62,18 @@ public int hashCode() {\n         return readBatches != null ? readBatches.hashCode() : 0;\n     }\n \n+    private static List<ReadBatch> getListIfExist(List<ReadBatch> readBatches) {", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTAxNjY5Ng==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r381016696", "bodyText": "Yes, good idea to reduce code duplication", "author": "cenedhryn", "createdAt": "2020-02-19T00:37:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg5Njk2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg5Nzc4OA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380897788", "bodyText": "Should this be generic and in utils?", "author": "bmaizels", "createdAt": "2020-02-18T19:50:04Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/model/BatchWriteItemEnhancedRequest.java", "diffHunk": "@@ -66,14 +62,18 @@ public int hashCode() {\n         return writeBatches != null ? writeBatches.hashCode() : 0;\n     }\n \n+    private static List<WriteBatch> getListIfExist(List<WriteBatch> writeBatches) {", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTAxNjcyOA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r381016728", "bodyText": "yes", "author": "cenedhryn", "createdAt": "2020-02-19T00:37:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg5Nzc4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwMDgwNA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380900804", "bodyText": "Could we make this generic and put it in utils?", "author": "bmaizels", "createdAt": "2020-02-18T19:55:49Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/model/TransactGetItemsEnhancedRequest.java", "diffHunk": "@@ -65,17 +64,34 @@ public int hashCode() {\n         return transactGetItems != null ? transactGetItems.hashCode() : 0;\n     }\n \n+    private List<TransactGetItem> getListIfExist(List<Supplier<TransactGetItem>> itemSupplierList) {\n+        if (itemSupplierList == null || itemSupplierList.isEmpty()) {\n+            return null;\n+        }\n+        return Collections.unmodifiableList(itemSupplierList.stream()\n+                                                            .map(Supplier::get)\n+                                                            .collect(Collectors.toList()));\n+    }", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTAxNjc4Ng==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r381016786", "bodyText": "yes", "author": "cenedhryn", "createdAt": "2020-02-19T00:37:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwMDgwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwMTAwNQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380901005", "bodyText": "I think our pattern is to have this call the other overloaded implementation of addGetItem rather than duplicate the code here.", "author": "bmaizels", "createdAt": "2020-02-18T19:56:14Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/model/TransactGetItemsEnhancedRequest.java", "diffHunk": "@@ -65,17 +64,34 @@ public int hashCode() {\n         return transactGetItems != null ? transactGetItems.hashCode() : 0;\n     }\n \n+    private List<TransactGetItem> getListIfExist(List<Supplier<TransactGetItem>> itemSupplierList) {\n+        if (itemSupplierList == null || itemSupplierList.isEmpty()) {\n+            return null;\n+        }\n+        return Collections.unmodifiableList(itemSupplierList.stream()\n+                                                            .map(Supplier::get)\n+                                                            .collect(Collectors.toList()));\n+    }\n+\n     public static final class Builder {\n         private List<Supplier<TransactGetItem>> itemSupplierList = new ArrayList<>();\n \n         private Builder() {\n         }\n \n-        public <T> Builder addGetItem(MappedTableResource<T> mappedTableResource, GetItemEnhancedRequest<T> request) {\n+        public <T> Builder addGetItem(MappedTableResource<T> mappedTableResource, GetItemEnhancedRequest request) {\n             itemSupplierList.add(() -> generateTransactWriteItem(mappedTableResource, GetItemOperation.create(request)));\n             return this;\n         }\n \n+        public <T> Builder addGetItem(MappedTableResource<T> mappedTableResource,\n+                                      Consumer<GetItemEnhancedRequest.Builder> requestConsumer) {\n+            GetItemEnhancedRequest.Builder builder = GetItemEnhancedRequest.builder();\n+            requestConsumer.accept(builder);\n+            itemSupplierList.add(() -> generateTransactWriteItem(mappedTableResource, GetItemOperation.create(builder.build())));\n+            return this;", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTAxNjg0Nw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r381016847", "bodyText": "yes, updating", "author": "cenedhryn", "createdAt": "2020-02-19T00:38:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwMTAwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwMTQxOQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380901419", "bodyText": "Could we generify and put in utils?", "author": "bmaizels", "createdAt": "2020-02-18T19:57:02Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/model/TransactWriteItemsEnhancedRequest.java", "diffHunk": "@@ -67,6 +66,15 @@ public int hashCode() {\n         return transactWriteItems != null ? transactWriteItems.hashCode() : 0;\n     }\n \n+    private List<TransactWriteItem> getListIfExist(List<Supplier<TransactWriteItem>> itemSupplierList) {\n+        if (itemSupplierList == null || itemSupplierList.isEmpty()) {\n+            return null;\n+        }\n+        return Collections.unmodifiableList(itemSupplierList.stream()\n+                                                            .map(Supplier::get)\n+                                                            .collect(Collectors.toList()));\n+    }", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwMTY5Mg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380901692", "bodyText": "Could we call the other overloaded method and not duplicate code here", "author": "bmaizels", "createdAt": "2020-02-18T19:57:34Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/model/TransactWriteItemsEnhancedRequest.java", "diffHunk": "@@ -78,21 +86,55 @@ private Builder() {\n             return this;\n         }\n \n-        public <T> Builder addDeleteItem(MappedTableResource<T> mappedTableResource, DeleteItemEnhancedRequest<T> request) {\n+        public <T> Builder addConditionCheck(MappedTableResource<T> mappedTableResource,\n+                                             Consumer<ConditionCheck.Builder> requestConsumer) {\n+            ConditionCheck.Builder builder = ConditionCheck.builder();\n+            requestConsumer.accept(builder);\n+            itemSupplierList.add(() -> generateTransactWriteItem(mappedTableResource, builder.build()));\n+            return this;\n+        }\n+\n+        public <T> Builder addDeleteItem(MappedTableResource<T> mappedTableResource, DeleteItemEnhancedRequest request) {\n             itemSupplierList.add(() -> generateTransactWriteItem(mappedTableResource, DeleteItemOperation.create(request)));\n             return this;\n         }\n \n+        public <T> Builder addDeleteItem(MappedTableResource<T> mappedTableResource,\n+                                      Consumer<DeleteItemEnhancedRequest.Builder> requestConsumer) {\n+            DeleteItemEnhancedRequest.Builder builder = DeleteItemEnhancedRequest.builder();\n+            requestConsumer.accept(builder);\n+            itemSupplierList.add(() -> generateTransactWriteItem(mappedTableResource,\n+                                                                 DeleteItemOperation.create(builder.build())));\n+            return this;", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwMTg1NQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380901855", "bodyText": "Could we call the other overloaded method and not duplicate code here", "author": "bmaizels", "createdAt": "2020-02-18T19:57:51Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/model/TransactWriteItemsEnhancedRequest.java", "diffHunk": "@@ -78,21 +86,55 @@ private Builder() {\n             return this;\n         }\n \n-        public <T> Builder addDeleteItem(MappedTableResource<T> mappedTableResource, DeleteItemEnhancedRequest<T> request) {\n+        public <T> Builder addConditionCheck(MappedTableResource<T> mappedTableResource,\n+                                             Consumer<ConditionCheck.Builder> requestConsumer) {\n+            ConditionCheck.Builder builder = ConditionCheck.builder();\n+            requestConsumer.accept(builder);\n+            itemSupplierList.add(() -> generateTransactWriteItem(mappedTableResource, builder.build()));", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwMjAwMA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380902000", "bodyText": "Could we call the other overloaded method and not duplicate code here", "author": "bmaizels", "createdAt": "2020-02-18T19:58:04Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/model/TransactWriteItemsEnhancedRequest.java", "diffHunk": "@@ -78,21 +86,55 @@ private Builder() {\n             return this;\n         }\n \n-        public <T> Builder addDeleteItem(MappedTableResource<T> mappedTableResource, DeleteItemEnhancedRequest<T> request) {\n+        public <T> Builder addConditionCheck(MappedTableResource<T> mappedTableResource,\n+                                             Consumer<ConditionCheck.Builder> requestConsumer) {\n+            ConditionCheck.Builder builder = ConditionCheck.builder();\n+            requestConsumer.accept(builder);\n+            itemSupplierList.add(() -> generateTransactWriteItem(mappedTableResource, builder.build()));\n+            return this;\n+        }\n+\n+        public <T> Builder addDeleteItem(MappedTableResource<T> mappedTableResource, DeleteItemEnhancedRequest request) {\n             itemSupplierList.add(() -> generateTransactWriteItem(mappedTableResource, DeleteItemOperation.create(request)));\n             return this;\n         }\n \n+        public <T> Builder addDeleteItem(MappedTableResource<T> mappedTableResource,\n+                                      Consumer<DeleteItemEnhancedRequest.Builder> requestConsumer) {\n+            DeleteItemEnhancedRequest.Builder builder = DeleteItemEnhancedRequest.builder();\n+            requestConsumer.accept(builder);\n+            itemSupplierList.add(() -> generateTransactWriteItem(mappedTableResource,\n+                                                                 DeleteItemOperation.create(builder.build())));\n+            return this;\n+        }\n+\n         public <T> Builder addPutItem(MappedTableResource<T> mappedTableResource, PutItemEnhancedRequest<T> request) {\n             itemSupplierList.add(() -> generateTransactWriteItem(mappedTableResource, PutItemOperation.create(request)));\n             return this;\n         }\n \n+        public <T> Builder addPutItem(MappedTableResource<T> mappedTableResource, Class<? extends T> itemClass,\n+                                      Consumer<PutItemEnhancedRequest.Builder<T>> requestConsumer) {\n+            PutItemEnhancedRequest.Builder<T> builder = PutItemEnhancedRequest.builder(itemClass);\n+            requestConsumer.accept(builder);\n+            itemSupplierList.add(() -> generateTransactWriteItem(mappedTableResource, PutItemOperation.create(builder.build())));\n+            return this;", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwMjEwMw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380902103", "bodyText": "Could we call the other overloaded method and not duplicate code here", "author": "bmaizels", "createdAt": "2020-02-18T19:58:15Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/model/TransactWriteItemsEnhancedRequest.java", "diffHunk": "@@ -78,21 +86,55 @@ private Builder() {\n             return this;\n         }\n \n-        public <T> Builder addDeleteItem(MappedTableResource<T> mappedTableResource, DeleteItemEnhancedRequest<T> request) {\n+        public <T> Builder addConditionCheck(MappedTableResource<T> mappedTableResource,\n+                                             Consumer<ConditionCheck.Builder> requestConsumer) {\n+            ConditionCheck.Builder builder = ConditionCheck.builder();\n+            requestConsumer.accept(builder);\n+            itemSupplierList.add(() -> generateTransactWriteItem(mappedTableResource, builder.build()));\n+            return this;\n+        }\n+\n+        public <T> Builder addDeleteItem(MappedTableResource<T> mappedTableResource, DeleteItemEnhancedRequest request) {\n             itemSupplierList.add(() -> generateTransactWriteItem(mappedTableResource, DeleteItemOperation.create(request)));\n             return this;\n         }\n \n+        public <T> Builder addDeleteItem(MappedTableResource<T> mappedTableResource,\n+                                      Consumer<DeleteItemEnhancedRequest.Builder> requestConsumer) {\n+            DeleteItemEnhancedRequest.Builder builder = DeleteItemEnhancedRequest.builder();\n+            requestConsumer.accept(builder);\n+            itemSupplierList.add(() -> generateTransactWriteItem(mappedTableResource,\n+                                                                 DeleteItemOperation.create(builder.build())));\n+            return this;\n+        }\n+\n         public <T> Builder addPutItem(MappedTableResource<T> mappedTableResource, PutItemEnhancedRequest<T> request) {\n             itemSupplierList.add(() -> generateTransactWriteItem(mappedTableResource, PutItemOperation.create(request)));\n             return this;\n         }\n \n+        public <T> Builder addPutItem(MappedTableResource<T> mappedTableResource, Class<? extends T> itemClass,\n+                                      Consumer<PutItemEnhancedRequest.Builder<T>> requestConsumer) {\n+            PutItemEnhancedRequest.Builder<T> builder = PutItemEnhancedRequest.builder(itemClass);\n+            requestConsumer.accept(builder);\n+            itemSupplierList.add(() -> generateTransactWriteItem(mappedTableResource, PutItemOperation.create(builder.build())));\n+            return this;\n+        }\n+\n         public <T> Builder addUpdateItem(MappedTableResource<T> mappedTableResource, UpdateItemEnhancedRequest<T> request) {\n             itemSupplierList.add(() -> generateTransactWriteItem(mappedTableResource, UpdateItemOperation.create(request)));\n             return this;\n         }\n \n+        public <T> Builder addUpdateItem(MappedTableResource<T> mappedTableResource, Class<? extends T> itemClass,\n+                                         Consumer<UpdateItemEnhancedRequest.Builder<T>> requestConsumer) {\n+            UpdateItemEnhancedRequest.Builder<T> builder = UpdateItemEnhancedRequest.builder(itemClass);\n+            requestConsumer.accept(builder);\n+            itemSupplierList.add(() -> generateTransactWriteItem(mappedTableResource,\n+                                                                 UpdateItemOperation.create(builder.build())));\n+            return this;", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwMjc3Ng==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380902776", "bodyText": "Can we generify and put in utils?", "author": "bmaizels", "createdAt": "2020-02-18T19:59:28Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/model/WriteBatch.java", "diffHunk": "@@ -82,36 +81,57 @@ public int hashCode() {\n     public interface Builder<T> {\n         Builder<T> mappedTableResource(MappedTableResource<T> mappedTableResource);\n \n-        Builder<T> addDeleteItem(DeleteItemEnhancedRequest<T> request);\n+        Builder<T> addDeleteItem(DeleteItemEnhancedRequest request);\n+\n+        Builder<T> addDeleteItem(Consumer<DeleteItemEnhancedRequest.Builder> requestConsumer);\n \n         Builder<T> addPutItem(PutItemEnhancedRequest<T> request);\n \n+        Builder<T> addPutItem(Consumer<PutItemEnhancedRequest.Builder<T>> requestConsumer);\n+\n         WriteBatch build();\n     }\n \n     private static final class BuilderImpl<T> implements Builder<T> {\n \n+        private Class<? extends T> itemClass;\n         private List<Supplier<WriteRequest>> itemSupplierList = new ArrayList<>();\n         private MappedTableResource<T> mappedTableResource;\n \n-        private BuilderImpl() {\n+        private BuilderImpl(Class<? extends T> itemClass) {\n+            this.itemClass = itemClass;\n         }\n \n         public Builder<T> mappedTableResource(MappedTableResource<T> mappedTableResource) {\n             this.mappedTableResource = mappedTableResource;\n             return this;\n         }\n \n-        public Builder<T> addDeleteItem(DeleteItemEnhancedRequest<T> request) {\n+        public Builder<T> addDeleteItem(DeleteItemEnhancedRequest request) {\n             itemSupplierList.add(() -> generateWriteRequest(() -> mappedTableResource, DeleteItemOperation.create(request)));\n             return this;\n         }\n \n+        public Builder<T> addDeleteItem(Consumer<DeleteItemEnhancedRequest.Builder> requestConsumer) {\n+            DeleteItemEnhancedRequest.Builder builder = DeleteItemEnhancedRequest.builder();\n+            requestConsumer.accept(builder);\n+            itemSupplierList.add(() -> generateWriteRequest(() -> mappedTableResource,\n+                                                            DeleteItemOperation.create(builder.build())));\n+            return this;\n+        }", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTAxOTEzNA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r381019134", "bodyText": "Think this comment belongs somewhere else.", "author": "cenedhryn", "createdAt": "2020-02-19T00:46:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwMjc3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwMzAxMQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380903011", "bodyText": "Could we call the other overloaded method and not duplicate code here", "author": "bmaizels", "createdAt": "2020-02-18T19:59:54Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/model/WriteBatch.java", "diffHunk": "@@ -82,36 +81,57 @@ public int hashCode() {\n     public interface Builder<T> {\n         Builder<T> mappedTableResource(MappedTableResource<T> mappedTableResource);\n \n-        Builder<T> addDeleteItem(DeleteItemEnhancedRequest<T> request);\n+        Builder<T> addDeleteItem(DeleteItemEnhancedRequest request);\n+\n+        Builder<T> addDeleteItem(Consumer<DeleteItemEnhancedRequest.Builder> requestConsumer);\n \n         Builder<T> addPutItem(PutItemEnhancedRequest<T> request);\n \n+        Builder<T> addPutItem(Consumer<PutItemEnhancedRequest.Builder<T>> requestConsumer);\n+\n         WriteBatch build();\n     }\n \n     private static final class BuilderImpl<T> implements Builder<T> {\n \n+        private Class<? extends T> itemClass;\n         private List<Supplier<WriteRequest>> itemSupplierList = new ArrayList<>();\n         private MappedTableResource<T> mappedTableResource;\n \n-        private BuilderImpl() {\n+        private BuilderImpl(Class<? extends T> itemClass) {\n+            this.itemClass = itemClass;\n         }\n \n         public Builder<T> mappedTableResource(MappedTableResource<T> mappedTableResource) {\n             this.mappedTableResource = mappedTableResource;\n             return this;\n         }\n \n-        public Builder<T> addDeleteItem(DeleteItemEnhancedRequest<T> request) {\n+        public Builder<T> addDeleteItem(DeleteItemEnhancedRequest request) {\n             itemSupplierList.add(() -> generateWriteRequest(() -> mappedTableResource, DeleteItemOperation.create(request)));\n             return this;\n         }\n \n+        public Builder<T> addDeleteItem(Consumer<DeleteItemEnhancedRequest.Builder> requestConsumer) {\n+            DeleteItemEnhancedRequest.Builder builder = DeleteItemEnhancedRequest.builder();\n+            requestConsumer.accept(builder);\n+            itemSupplierList.add(() -> generateWriteRequest(() -> mappedTableResource,\n+                                                            DeleteItemOperation.create(builder.build())));\n+            return this;", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTAxNzA4Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r381017083", "bodyText": "yes", "author": "cenedhryn", "createdAt": "2020-02-19T00:38:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwMzAxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwMzEwOQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380903109", "bodyText": "Could we call the other overloaded method and not duplicate code here", "author": "bmaizels", "createdAt": "2020-02-18T20:00:04Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/model/WriteBatch.java", "diffHunk": "@@ -82,36 +81,57 @@ public int hashCode() {\n     public interface Builder<T> {\n         Builder<T> mappedTableResource(MappedTableResource<T> mappedTableResource);\n \n-        Builder<T> addDeleteItem(DeleteItemEnhancedRequest<T> request);\n+        Builder<T> addDeleteItem(DeleteItemEnhancedRequest request);\n+\n+        Builder<T> addDeleteItem(Consumer<DeleteItemEnhancedRequest.Builder> requestConsumer);\n \n         Builder<T> addPutItem(PutItemEnhancedRequest<T> request);\n \n+        Builder<T> addPutItem(Consumer<PutItemEnhancedRequest.Builder<T>> requestConsumer);\n+\n         WriteBatch build();\n     }\n \n     private static final class BuilderImpl<T> implements Builder<T> {\n \n+        private Class<? extends T> itemClass;\n         private List<Supplier<WriteRequest>> itemSupplierList = new ArrayList<>();\n         private MappedTableResource<T> mappedTableResource;\n \n-        private BuilderImpl() {\n+        private BuilderImpl(Class<? extends T> itemClass) {\n+            this.itemClass = itemClass;\n         }\n \n         public Builder<T> mappedTableResource(MappedTableResource<T> mappedTableResource) {\n             this.mappedTableResource = mappedTableResource;\n             return this;\n         }\n \n-        public Builder<T> addDeleteItem(DeleteItemEnhancedRequest<T> request) {\n+        public Builder<T> addDeleteItem(DeleteItemEnhancedRequest request) {\n             itemSupplierList.add(() -> generateWriteRequest(() -> mappedTableResource, DeleteItemOperation.create(request)));\n             return this;\n         }\n \n+        public Builder<T> addDeleteItem(Consumer<DeleteItemEnhancedRequest.Builder> requestConsumer) {\n+            DeleteItemEnhancedRequest.Builder builder = DeleteItemEnhancedRequest.builder();\n+            requestConsumer.accept(builder);\n+            itemSupplierList.add(() -> generateWriteRequest(() -> mappedTableResource,\n+                                                            DeleteItemOperation.create(builder.build())));\n+            return this;\n+        }\n+\n         public Builder<T> addPutItem(PutItemEnhancedRequest<T> request) {\n             itemSupplierList.add(() -> generateWriteRequest(() -> mappedTableResource, PutItemOperation.create(request)));\n             return this;\n         }\n \n+        public Builder<T> addPutItem(Consumer<PutItemEnhancedRequest.Builder<T>> requestConsumer) {\n+            PutItemEnhancedRequest.Builder<T> builder = PutItemEnhancedRequest.builder(this.itemClass);\n+            requestConsumer.accept(builder);\n+            itemSupplierList.add(() -> generateWriteRequest(() -> mappedTableResource, PutItemOperation.create(builder.build())));\n+            return this;", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwMzIyMQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380903221", "bodyText": "Can we generify and put in utils", "author": "bmaizels", "createdAt": "2020-02-18T20:00:19Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/model/WriteBatch.java", "diffHunk": "@@ -123,4 +143,13 @@ private WriteRequest generateWriteRequest(Supplier<MappedTableResource<T>> mappe\n                                                   mappedTableResourceSupplier.get().mapperExtension());\n         }\n     }\n+\n+    private List<WriteRequest> getListIfExist(List<Supplier<WriteRequest>> itemSupplierList) {\n+        if (itemSupplierList == null || itemSupplierList.isEmpty()) {\n+            return null;\n+        }\n+        return Collections.unmodifiableList(itemSupplierList.stream()\n+                                                            .map(Supplier::get)\n+                                                            .collect(Collectors.toList()));\n+    }", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwNDU0MA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380904540", "bodyText": "My IDE is showing this method as not having coverage.", "author": "bmaizels", "createdAt": "2020-02-18T20:02:29Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/DynamoDbEnhancedAsyncClient.java", "diffHunk": "@@ -49,18 +50,35 @@\n         throw new UnsupportedOperationException();\n     }\n \n+    default SdkPublisher<BatchGetResultPage> batchGetItem(Consumer<BatchGetItemEnhancedRequest.Builder> requestConsumer) {\n+        throw new UnsupportedOperationException();\n+    }", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTAxNjI0OQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r381016249", "bodyText": "Mine too, missed that. Adding test coverage.", "author": "cenedhryn", "createdAt": "2020-02-19T00:35:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwNDU0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwNDYwOA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380904608", "bodyText": "My IDE is showing this method as not having coverage.", "author": "bmaizels", "createdAt": "2020-02-18T20:02:37Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/DynamoDbEnhancedAsyncClient.java", "diffHunk": "@@ -49,18 +50,35 @@\n         throw new UnsupportedOperationException();\n     }\n \n+    default SdkPublisher<BatchGetResultPage> batchGetItem(Consumer<BatchGetItemEnhancedRequest.Builder> requestConsumer) {\n+        throw new UnsupportedOperationException();\n+    }\n+\n     default CompletableFuture<BatchWriteResult> batchWriteItem(BatchWriteItemEnhancedRequest request) {\n         throw new UnsupportedOperationException();\n     }\n \n+    default CompletableFuture<BatchWriteResult> batchWriteItem(Consumer<BatchWriteItemEnhancedRequest.Builder> requestConsumer) {\n+        throw new UnsupportedOperationException();\n+    }", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTAxNjI5NQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r381016295", "bodyText": "fixed", "author": "cenedhryn", "createdAt": "2020-02-19T00:35:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwNDYwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwNDkzNA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380904934", "bodyText": "My IDE is showing this method as not having coverage.", "author": "bmaizels", "createdAt": "2020-02-18T20:03:19Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/DynamoDbEnhancedClient.java", "diffHunk": "@@ -48,18 +49,34 @@\n         throw new UnsupportedOperationException();\n     }\n \n+    default SdkIterable<BatchGetResultPage> batchGetItem(Consumer<BatchGetItemEnhancedRequest.Builder> requestConsumer) {\n+        throw new UnsupportedOperationException();\n+    }\n+\n     default BatchWriteResult batchWriteItem(BatchWriteItemEnhancedRequest request) {\n         throw new UnsupportedOperationException();\n     }\n \n+    default BatchWriteResult batchWriteItem(Consumer<BatchWriteItemEnhancedRequest.Builder> requestConsumer) {\n+        throw new UnsupportedOperationException();\n+    }", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTAxNjQ2OA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r381016468", "bodyText": "fixed", "author": "cenedhryn", "createdAt": "2020-02-19T00:36:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwNDkzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwNTcyMQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380905721", "bodyText": "This does not appear to be used. Can we remove it?", "author": "bmaizels", "createdAt": "2020-02-18T20:04:55Z", "path": "services-custom/dynamodb-enhanced/src/test/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/core/DefaultDynamoDbIndexTest.java", "diffHunk": "@@ -37,6 +38,9 @@\n     @Mock\n     private MapperExtension mockMapperExtension;\n \n+    @Mock\n+    private PaginatedIndexOperation<?,?,?,?> mockPaginatedOperation;\n+", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTAxNzYwMA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r381017600", "bodyText": "yes", "author": "cenedhryn", "createdAt": "2020-02-19T00:40:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwNTcyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwNzE0Mg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380907142", "bodyText": "I think we should be able to make basic assertions here beyond 'it didn't blow up'.", "author": "bmaizels", "createdAt": "2020-02-18T20:07:59Z", "path": "services-custom/dynamodb-enhanced/src/test/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/functionaltests/AsyncBasicCrudTest.java", "diffHunk": "@@ -228,6 +226,25 @@ public void deleteTable() {\n                                 .join();\n     }\n \n+    @Test\n+    public void getItemInterfaceToOperationSucceeds() {\n+        mappedTable.getItem(r -> r.key(Key.create(stringValue(\"id-value\"), stringValue(\"sort-value\")))).join();\n+        mappedTable.getItem(GetItemEnhancedRequest.builder()\n+                                                  .key(Key.create(stringValue(\"id-value\"), stringValue(\"sort-value\")))\n+                                                  .build()).join();\n+    }\n+\n+    @Test\n+    public void putItemInterfaceToOperationSucceeds() {\n+        Record record = new Record()\n+            .setId(\"id-value\")\n+            .setSort(\"sort-value\")\n+            .setAttribute(\"one\");\n+\n+        mappedTable.putItem(Record.class, r -> r.item(record)).join();\n+        mappedTable.putItem(PutItemEnhancedRequest.builder(Record.class).item(record).build()).join();\n+    }", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA2MzQwNg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r381063406", "bodyText": "I could not put my heart into the wiring tests after all and I removed them. All wiring combinations are still tested (no unused interface methods). We can always rethink later.", "author": "cenedhryn", "createdAt": "2020-02-19T03:47:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwNzE0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwNzY1MQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380907651", "bodyText": "I think we should be able to make basic assertions here beyond 'it didn't blow up'.", "author": "bmaizels", "createdAt": "2020-02-18T20:09:02Z", "path": "services-custom/dynamodb-enhanced/src/test/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/functionaltests/AsyncBasicCrudTest.java", "diffHunk": "@@ -376,11 +381,17 @@ public void putWithConditionThatFails() {\n                    .join();\n     }\n \n+    @Test\n+    public void deleteItemInterfaceToOperationSucceeds() {\n+        mappedTable.deleteItem(r -> r.key(Key.create(stringValue(\"id-value\"), stringValue(\"sort-value\")))).join();\n+        mappedTable.deleteItem(DeleteItemEnhancedRequest.builder()\n+                                                        .key(Key.create(stringValue(\"id-value\"), stringValue(\"sort-value\")))\n+                                                        .build()).join();\n+    }\n+", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwNzc1NQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380907755", "bodyText": "I think we should be able to make basic assertions here beyond 'it didn't blow up'.", "author": "bmaizels", "createdAt": "2020-02-18T20:09:12Z", "path": "services-custom/dynamodb-enhanced/src/test/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/functionaltests/AsyncBasicCrudTest.java", "diffHunk": "@@ -436,6 +451,17 @@ public void deleteWithConditionThatFails() {\n                                                .build()).join();\n     }\n \n+    @Test\n+    public void updateItemInterfaceToOperationSucceeds() {\n+        Record record = new Record()\n+            .setId(\"id-value\")\n+            .setSort(\"sort-value\")\n+            .setAttribute(\"one\");\n+\n+        mappedTable.updateItem(Record.class, r -> r.item(record)).join();\n+        mappedTable.updateItem(UpdateItemEnhancedRequest.builder(Record.class).item(record).build()).join();\n+    }\n+", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwOTA5NQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380909095", "bodyText": "Unused imports", "author": "bmaizels", "createdAt": "2020-02-18T20:11:41Z", "path": "services-custom/dynamodb-enhanced/src/test/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/functionaltests/AsyncIndexScanTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+/*\n+ * Copyright 2010-2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.extensions.dynamodb.mappingclient.functionaltests;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.empty;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.nullValue;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.AttributeValues.numberValue;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.AttributeValues.stringValue;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.AttributeTags.primaryPartitionKey;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.AttributeTags.primarySortKey;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.AttributeTags.secondaryPartitionKey;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.AttributeTags.secondarySortKey;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.Attributes.integerNumberAttribute;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.Attributes.stringAttribute;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+import java.util.stream.IntStream;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import software.amazon.awssdk.core.async.SdkPublisher;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.DynamoDbAsyncIndex;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.DynamoDbAsyncTable;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.DynamoDbEnhancedAsyncClient;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.DynamoDbEnhancedClient;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.DynamoDbIndex;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.DynamoDbTable;", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTAxOTI5NA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r381019294", "bodyText": "removed", "author": "cenedhryn", "createdAt": "2020-02-19T00:47:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwOTA5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwOTU2NQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380909565", "bodyText": "I think we're using this code in a bunch of places, can we refactor it into a base test class or util?", "author": "bmaizels", "createdAt": "2020-02-18T20:12:42Z", "path": "services-custom/dynamodb-enhanced/src/test/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/functionaltests/AsyncIndexScanTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+/*\n+ * Copyright 2010-2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.extensions.dynamodb.mappingclient.functionaltests;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.empty;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.nullValue;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.AttributeValues.numberValue;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.AttributeValues.stringValue;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.AttributeTags.primaryPartitionKey;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.AttributeTags.primarySortKey;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.AttributeTags.secondaryPartitionKey;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.AttributeTags.secondarySortKey;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.Attributes.integerNumberAttribute;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.Attributes.stringAttribute;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+import java.util.stream.IntStream;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import software.amazon.awssdk.core.async.SdkPublisher;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.DynamoDbAsyncIndex;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.DynamoDbAsyncTable;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.DynamoDbEnhancedAsyncClient;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.DynamoDbEnhancedClient;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.DynamoDbIndex;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.DynamoDbTable;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.Expression;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.Page;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.TableSchema;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.core.DefaultDynamoDbEnhancedAsyncClient;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.model.GlobalSecondaryIndex;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.model.ScanEnhancedRequest;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.StaticTableSchema;\n+import software.amazon.awssdk.services.dynamodb.model.AttributeValue;\n+import software.amazon.awssdk.services.dynamodb.model.DeleteTableRequest;\n+import software.amazon.awssdk.services.dynamodb.model.Projection;\n+import software.amazon.awssdk.services.dynamodb.model.ProjectionType;\n+\n+public class AsyncIndexScanTest extends LocalDynamoDbAsyncTestBase {\n+    private static class Record {\n+        private String id;\n+        private Integer sort;\n+        private Integer value;\n+        private String gsiId;\n+        private Integer gsiSort;\n+\n+        private String getId() {\n+            return id;\n+        }\n+\n+        private Record setId(String id) {\n+            this.id = id;\n+            return this;\n+        }\n+\n+        private Integer getSort() {\n+            return sort;\n+        }\n+\n+        private Record setSort(Integer sort) {\n+            this.sort = sort;\n+            return this;\n+        }\n+\n+        private Integer getValue() {\n+            return value;\n+        }\n+\n+        private Record setValue(Integer value) {\n+            this.value = value;\n+            return this;\n+        }\n+\n+        private String getGsiId() {\n+            return gsiId;\n+        }\n+\n+        private Record setGsiId(String gsiId) {\n+            this.gsiId = gsiId;\n+            return this;\n+        }\n+\n+        private Integer getGsiSort() {\n+            return gsiSort;\n+        }\n+\n+        private Record setGsiSort(Integer gsiSort) {\n+            this.gsiSort = gsiSort;\n+            return this;\n+        }\n+\n+        @Override\n+        public boolean equals(Object o) {\n+            if (this == o) return true;\n+            if (o == null || getClass() != o.getClass()) return false;\n+            Record record = (Record) o;\n+            return Objects.equals(id, record.id) &&\n+                   Objects.equals(sort, record.sort) &&\n+                   Objects.equals(value, record.value) &&\n+                   Objects.equals(gsiId, record.gsiId) &&\n+                   Objects.equals(gsiSort, record.gsiSort);\n+        }\n+\n+        @Override\n+        public int hashCode() {\n+            return Objects.hash(id, sort, value, gsiId, gsiSort);\n+        }\n+    }\n+\n+    private static final TableSchema<Record> TABLE_SCHEMA =\n+        StaticTableSchema.builder(Record.class)\n+                         .newItemSupplier(Record::new)\n+                         .attributes(\n+                             stringAttribute(\"id\", Record::getId, Record::setId).as(primaryPartitionKey()),\n+                             integerNumberAttribute(\"sort\", Record::getSort, Record::setSort).as(primarySortKey()),\n+                             integerNumberAttribute(\"value\", Record::getValue, Record::setValue),\n+                             stringAttribute(\"gsi_id\", Record::getGsiId, Record::setGsiId)\n+                                 .as(secondaryPartitionKey(\"gsi_keys_only\")),\n+                             integerNumberAttribute(\"gsi_sort\", Record::getGsiSort, Record::setGsiSort)\n+                                 .as(secondarySortKey(\"gsi_keys_only\")))\n+                         .build();\n+\n+    private static final List<Record> RECORDS =\n+        IntStream.range(0, 10)\n+                 .mapToObj(i -> new Record()\n+                     .setId(\"id-value\")\n+                     .setSort(i)\n+                     .setValue(i)\n+                     .setGsiId(\"gsi-id-value\")\n+                     .setGsiSort(i))\n+                 .collect(Collectors.toList());\n+\n+    private static final List<Record> KEYS_ONLY_RECORDS =\n+        RECORDS.stream()\n+               .map(record -> new Record()\n+                   .setId(record.id)\n+                   .setSort(record.sort)\n+                   .setGsiId(record.gsiId)\n+                   .setGsiSort(record.gsiSort))\n+               .collect(Collectors.toList());\n+\n+    private DynamoDbEnhancedAsyncClient enhancedAsyncClient =\n+        DefaultDynamoDbEnhancedAsyncClient.builder()\n+                                          .dynamoDbClient(getDynamoDbAsyncClient())\n+                                          .build();\n+\n+    private DynamoDbAsyncTable<Record> mappedTable = enhancedAsyncClient.table(getConcreteTableName(\"table-name\"), TABLE_SCHEMA);\n+    private DynamoDbAsyncIndex<Record> keysOnlyMappedIndex = mappedTable.index(\"gsi_keys_only\");\n+\n+    private void insertRecords() {\n+        RECORDS.forEach(record -> mappedTable.putItem(Record.class, r -> r.item(record)).join());\n+    }\n+\n+    private static <T> List<T> drainPublisher(SdkPublisher<T> publisher, int expectedNumberOfResults) {\n+        BufferingSubscriber<T> subscriber = new BufferingSubscriber<>();\n+        publisher.subscribe(subscriber);\n+        subscriber.waitForCompletion(1000L);\n+\n+        assertThat(subscriber.isCompleted(), is(true));\n+        assertThat(subscriber.bufferedError(), is(nullValue()));\n+        assertThat(subscriber.bufferedItems().size(), is(expectedNumberOfResults));\n+\n+        return subscriber.bufferedItems();\n+    }", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTAxOTM1OQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r381019359", "bodyText": "Yes", "author": "cenedhryn", "createdAt": "2020-02-19T00:47:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwOTU2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwOTc4Nw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380909787", "bodyText": "Why is this commented out?", "author": "bmaizels", "createdAt": "2020-02-18T20:13:09Z", "path": "services-custom/dynamodb-enhanced/src/test/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/functionaltests/AsyncIndexScanTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+/*\n+ * Copyright 2010-2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.extensions.dynamodb.mappingclient.functionaltests;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.empty;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.nullValue;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.AttributeValues.numberValue;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.AttributeValues.stringValue;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.AttributeTags.primaryPartitionKey;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.AttributeTags.primarySortKey;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.AttributeTags.secondaryPartitionKey;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.AttributeTags.secondarySortKey;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.Attributes.integerNumberAttribute;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.Attributes.stringAttribute;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+import java.util.stream.IntStream;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import software.amazon.awssdk.core.async.SdkPublisher;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.DynamoDbAsyncIndex;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.DynamoDbAsyncTable;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.DynamoDbEnhancedAsyncClient;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.DynamoDbEnhancedClient;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.DynamoDbIndex;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.DynamoDbTable;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.Expression;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.Page;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.TableSchema;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.core.DefaultDynamoDbEnhancedAsyncClient;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.model.GlobalSecondaryIndex;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.model.ScanEnhancedRequest;\n+import software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.StaticTableSchema;\n+import software.amazon.awssdk.services.dynamodb.model.AttributeValue;\n+import software.amazon.awssdk.services.dynamodb.model.DeleteTableRequest;\n+import software.amazon.awssdk.services.dynamodb.model.Projection;\n+import software.amazon.awssdk.services.dynamodb.model.ProjectionType;\n+\n+public class AsyncIndexScanTest extends LocalDynamoDbAsyncTestBase {\n+    private static class Record {\n+        private String id;\n+        private Integer sort;\n+        private Integer value;\n+        private String gsiId;\n+        private Integer gsiSort;\n+\n+        private String getId() {\n+            return id;\n+        }\n+\n+        private Record setId(String id) {\n+            this.id = id;\n+            return this;\n+        }\n+\n+        private Integer getSort() {\n+            return sort;\n+        }\n+\n+        private Record setSort(Integer sort) {\n+            this.sort = sort;\n+            return this;\n+        }\n+\n+        private Integer getValue() {\n+            return value;\n+        }\n+\n+        private Record setValue(Integer value) {\n+            this.value = value;\n+            return this;\n+        }\n+\n+        private String getGsiId() {\n+            return gsiId;\n+        }\n+\n+        private Record setGsiId(String gsiId) {\n+            this.gsiId = gsiId;\n+            return this;\n+        }\n+\n+        private Integer getGsiSort() {\n+            return gsiSort;\n+        }\n+\n+        private Record setGsiSort(Integer gsiSort) {\n+            this.gsiSort = gsiSort;\n+            return this;\n+        }\n+\n+        @Override\n+        public boolean equals(Object o) {\n+            if (this == o) return true;\n+            if (o == null || getClass() != o.getClass()) return false;\n+            Record record = (Record) o;\n+            return Objects.equals(id, record.id) &&\n+                   Objects.equals(sort, record.sort) &&\n+                   Objects.equals(value, record.value) &&\n+                   Objects.equals(gsiId, record.gsiId) &&\n+                   Objects.equals(gsiSort, record.gsiSort);\n+        }\n+\n+        @Override\n+        public int hashCode() {\n+            return Objects.hash(id, sort, value, gsiId, gsiSort);\n+        }\n+    }\n+\n+    private static final TableSchema<Record> TABLE_SCHEMA =\n+        StaticTableSchema.builder(Record.class)\n+                         .newItemSupplier(Record::new)\n+                         .attributes(\n+                             stringAttribute(\"id\", Record::getId, Record::setId).as(primaryPartitionKey()),\n+                             integerNumberAttribute(\"sort\", Record::getSort, Record::setSort).as(primarySortKey()),\n+                             integerNumberAttribute(\"value\", Record::getValue, Record::setValue),\n+                             stringAttribute(\"gsi_id\", Record::getGsiId, Record::setGsiId)\n+                                 .as(secondaryPartitionKey(\"gsi_keys_only\")),\n+                             integerNumberAttribute(\"gsi_sort\", Record::getGsiSort, Record::setGsiSort)\n+                                 .as(secondarySortKey(\"gsi_keys_only\")))\n+                         .build();\n+\n+    private static final List<Record> RECORDS =\n+        IntStream.range(0, 10)\n+                 .mapToObj(i -> new Record()\n+                     .setId(\"id-value\")\n+                     .setSort(i)\n+                     .setValue(i)\n+                     .setGsiId(\"gsi-id-value\")\n+                     .setGsiSort(i))\n+                 .collect(Collectors.toList());\n+\n+    private static final List<Record> KEYS_ONLY_RECORDS =\n+        RECORDS.stream()\n+               .map(record -> new Record()\n+                   .setId(record.id)\n+                   .setSort(record.sort)\n+                   .setGsiId(record.gsiId)\n+                   .setGsiSort(record.gsiSort))\n+               .collect(Collectors.toList());\n+\n+    private DynamoDbEnhancedAsyncClient enhancedAsyncClient =\n+        DefaultDynamoDbEnhancedAsyncClient.builder()\n+                                          .dynamoDbClient(getDynamoDbAsyncClient())\n+                                          .build();\n+\n+    private DynamoDbAsyncTable<Record> mappedTable = enhancedAsyncClient.table(getConcreteTableName(\"table-name\"), TABLE_SCHEMA);\n+    private DynamoDbAsyncIndex<Record> keysOnlyMappedIndex = mappedTable.index(\"gsi_keys_only\");\n+\n+    private void insertRecords() {\n+        RECORDS.forEach(record -> mappedTable.putItem(Record.class, r -> r.item(record)).join());\n+    }\n+\n+    private static <T> List<T> drainPublisher(SdkPublisher<T> publisher, int expectedNumberOfResults) {\n+        BufferingSubscriber<T> subscriber = new BufferingSubscriber<>();\n+        publisher.subscribe(subscriber);\n+        subscriber.waitForCompletion(1000L);\n+\n+        assertThat(subscriber.isCompleted(), is(true));\n+        assertThat(subscriber.bufferedError(), is(nullValue()));\n+        assertThat(subscriber.bufferedItems().size(), is(expectedNumberOfResults));\n+\n+        return subscriber.bufferedItems();\n+    }\n+\n+    @Before\n+    public void createTable() {\n+        mappedTable.createTable(r -> r.provisionedThroughput(getDefaultProvisionedThroughput())\n+                                      .globalSecondaryIndices(GlobalSecondaryIndex.create(\n+                                          \"gsi_keys_only\",\n+                                          Projection.builder().projectionType(ProjectionType.KEYS_ONLY).build(),\n+                                          getDefaultProvisionedThroughput()))).join();\n+    }\n+\n+    @After\n+    public void deleteTable() {\n+        getDynamoDbAsyncClient().deleteTable(DeleteTableRequest.builder()\n+                                                               .tableName(getConcreteTableName(\"table-name\"))\n+                                                               .build()).join();\n+    }\n+\n+    @Test\n+    public void scanAllRecordsDefaultSettings() {\n+        insertRecords();\n+\n+        SdkPublisher<Page<Record>> publisher = keysOnlyMappedIndex.scan(ScanEnhancedRequest.builder().build());\n+        List<Page<Record>> results = drainPublisher(publisher, 1);\n+        Page<Record> page = results.get(0);\n+\n+        assertThat(page.items(), is(KEYS_ONLY_RECORDS));\n+    //    assertThat(page.lastEvaluatedKey(), is(nullValue()));", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTAxOTY0NA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r381019644", "bodyText": "Probably left over from writing test, commented 'in'", "author": "cenedhryn", "createdAt": "2020-02-19T00:48:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwOTc4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkxMDQyOQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380910429", "bodyText": "I think we should be able to make basic assertions here beyond 'it didn't blow up'.", "author": "bmaizels", "createdAt": "2020-02-18T20:14:34Z", "path": "services-custom/dynamodb-enhanced/src/test/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/functionaltests/BasicCrudTest.java", "diffHunk": "@@ -222,6 +220,25 @@ public void deleteTable() {\n                                                           .build());\n     }\n \n+    @Test\n+    public void getItemInterfaceToOperationSucceeds() {\n+        mappedTable.getItem(r -> r.key(Key.create(stringValue(\"id-value\"), stringValue(\"sort-value\"))));\n+        mappedTable.getItem(GetItemEnhancedRequest.builder()\n+                                                  .key(Key.create(stringValue(\"id-value\"), stringValue(\"sort-value\")))\n+                                                  .build());\n+    }\n+\n+    @Test\n+    public void putItemInterfaceToOperationSucceeds() {\n+        Record record = new Record()\n+            .setId(\"id-value\")\n+            .setSort(\"sort-value\")\n+            .setAttribute(\"one\");\n+\n+        mappedTable.putItem(Record.class, r -> r.item(record));\n+        mappedTable.putItem(PutItemEnhancedRequest.builder(Record.class).item(record).build());\n+    }\n+", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkxMDYwOA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380910608", "bodyText": "I think we should be able to make basic assertions here beyond 'it didn't blow up'.", "author": "bmaizels", "createdAt": "2020-02-18T20:14:59Z", "path": "services-custom/dynamodb-enhanced/src/test/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/functionaltests/BasicCrudTest.java", "diffHunk": "@@ -360,10 +371,17 @@ public void putWithConditionThatFails() {\n                                                   .conditionExpression(conditionExpression).build());\n     }\n \n+    @Test\n+    public void deleteItemInterfaceToOperationSucceeds() {\n+        mappedTable.deleteItem(r -> r.key(Key.create(stringValue(\"id-value\"), stringValue(\"sort-value\"))));\n+        mappedTable.deleteItem(DeleteItemEnhancedRequest.builder()\n+                                                        .key(Key.create(stringValue(\"id-value\"), stringValue(\"sort-value\")))\n+                                                        .build());\n+    }\n+", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkxMDcyNA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380910724", "bodyText": "I think we should be able to make basic assertions here beyond 'it didn't blow up'.", "author": "bmaizels", "createdAt": "2020-02-18T20:15:13Z", "path": "services-custom/dynamodb-enhanced/src/test/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/functionaltests/BasicCrudTest.java", "diffHunk": "@@ -418,6 +436,17 @@ public void deleteWithConditionThatFails() {\n                                                .build());\n     }\n \n+    @Test\n+    public void updateItemInterfaceToOperationSucceeds() {\n+        Record record = new Record()\n+            .setId(\"id-value\")\n+            .setSort(\"sort-value\")\n+            .setAttribute(\"one\");\n+\n+        mappedTable.updateItem(Record.class, r -> r.item(record));\n+        mappedTable.updateItem(UpdateItemEnhancedRequest.builder(Record.class).item(record).build());\n+    }\n+", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkxMDk0MQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380910941", "bodyText": "Unused imports.", "author": "bmaizels", "createdAt": "2020-02-18T20:15:46Z", "path": "services-custom/dynamodb-enhanced/src/test/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/functionaltests/BasicQueryTest.java", "diffHunk": "@@ -25,6 +25,8 @@\n import static software.amazon.awssdk.extensions.dynamodb.mappingclient.model.QueryConditional.equalTo;\n import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.AttributeTags.primaryPartitionKey;\n import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.AttributeTags.primarySortKey;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.AttributeTags.secondaryPartitionKey;\n+import static software.amazon.awssdk.extensions.dynamodb.mappingclient.staticmapper.AttributeTags.secondarySortKey;", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTAxOTc3OQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r381019779", "bodyText": "ok", "author": "cenedhryn", "createdAt": "2020-02-19T00:48:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkxMDk0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkxNTc3MQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380915771", "bodyText": "I'm not sure I like this, speaking to Matt he said there is prior art for having an overloaded version of this that takes no arguments at all. So-called 'simple' method form.", "author": "bmaizels", "createdAt": "2020-02-18T20:26:20Z", "path": "services-custom/dynamodb-enhanced/README.md", "diffHunk": "@@ -80,66 +80,109 @@ values used are also completely arbitrary.\n  \n ### Common primitive operations\n These all strongly map to the primitive DynamoDB operations they are\n-named after. These examples are the most simple variants of each\n-operation possible. These commands can be customized by using the\n-builders provided for each command and offer most of the features\n-available in the low-level DynamoDB SDK client.\n+named after. The examples below are the most simple variants of each\n+operation possible, using the the two styles available for constructing\n+requests with either builder or consumers. These commands can be \n+customized by using the builders provided for each command and offer \n+most of the features available in the low-level DynamoDB SDK client.\n \n    ```java\n    // CreateTable\n-   customerTable.createTable(CreateTableEnhancedRequest.create());\n+   customerTable.createTable(() -> {});", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTAxMzM1OA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r381013358", "bodyText": "Adding a no-args method", "author": "cenedhryn", "createdAt": "2020-02-19T00:24:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkxNTc3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkxNjM2Nw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r380916367", "bodyText": "Can we do the 'simple method' implementation here with no arguments.", "author": "bmaizels", "createdAt": "2020-02-18T20:27:31Z", "path": "services-custom/dynamodb-enhanced/README.md", "diffHunk": "@@ -80,66 +80,109 @@ values used are also completely arbitrary.\n  \n ### Common primitive operations\n These all strongly map to the primitive DynamoDB operations they are\n-named after. These examples are the most simple variants of each\n-operation possible. These commands can be customized by using the\n-builders provided for each command and offer most of the features\n-available in the low-level DynamoDB SDK client.\n+named after. The examples below are the most simple variants of each\n+operation possible, using the the two styles available for constructing\n+requests with either builder or consumers. These commands can be \n+customized by using the builders provided for each command and offer \n+most of the features available in the low-level DynamoDB SDK client.\n \n    ```java\n    // CreateTable\n-   customerTable.createTable(CreateTableEnhancedRequest.create());\n+   customerTable.createTable(() -> {});\n+   customerTable.createTable(CreateTableEnhancedRequest.builder().build());\n    \n    // GetItem\n-   Customer customer = customerTable.getItem(GetItemEnhancedRequest.create(Key.create(stringValue(\"a123\"))));\n-   \n+   Customer customer = customerTable.getItem(r -> r.key(Key.create(stringValue(\"a123\"))));\n+   Customer customer = customerTable.getItem(GetItemEnhancedRequest.builder()\n+                                                                   .key(Key.create(stringValue(\"a123\")))\n+                                                                   .build()); \n    // UpdateItem\n-   Customer updatedCustomer = customerTable.updateItem(UpdateItemEnhancedRequest.create(customer));\n+   Customer updatedCustomer = customerTable.updateItem(Customer.class, r -> r.item(customer));\n+   Customer updatedCustomer = customerTable.updateItem(UpdateItemEnhancedRequest.builder(Customer.class)\n+                                                                                .item(customer)\n+                                                                                .build());\n    \n    // PutItem\n-   customerTable.putItem(PutItemEnhancedRequest.create(customer));\n+   customerTable.putItem(Customer.class, r -> r.item(customer));\n+   customerTable.putItem(PutItemEnhancedRequest.builder(Customer.class)\n+                                               .item(customer)\n+                                               .build());\n    \n    // DeleteItem\n-   Customer deletedCustomer = customerTable.deleteItem(DeleteItemEnhancedRequest.create(Key.create(stringValue(\"a123\"), numberValue(456))));\n+   Customer deletedCustomer = customerTable.deleteItem(r -> r.key(Key.create(stringValue(\"a123\"), numberValue(456))));\n+   Customer deletedCustomer = customerTable.deleteItem(DeleteItemEnhancedRequest.builder()\n+                                                                                     .key(Key.create(stringValue(\"a123\"), numberValue(456)))\n+                                                                                     .build());\n    \n    // Query\n-   Iterable<Page<Customer>> customers = customerTable.query(QueryEnhancedRequest.create(equalTo(Key.create(stringValue(\"a123\")))));\n-   \n+   Iterable<Page<Customer>> customers = customerTable.query(r -> r.queryConditional(equalTo(Key.create(stringValue(\"a123\")))));\n+   Iterable<Page<Customer>> customers = customerTable.query(QueryEnhancedRequest.builder()\n+                                                                                .queryConditional(equalTo(Key.create(stringValue(\"a123\"))))\n+                                                                                .build());\n    // Scan\n-   Iterable<Page<Customer>> customers = customerTable.scan(ScanEnhancedRequest.create());\n+   Iterable<Page<Customer>> customers = customerTable.scan(() -> {});", "originalCommit": "58a29cba77abd0112690e51bc38de127c6eb9c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTAxMzUzMg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r381013532", "bodyText": "Yes", "author": "cenedhryn", "createdAt": "2020-02-19T00:25:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkxNjM2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQyNzIwOA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r381427208", "bodyText": "Now it's generic and global we should rename this to be a little more specific to what it does, which is call each supplier and make a list of the results.", "author": "bmaizels", "createdAt": "2020-02-19T17:26:08Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/extensions/dynamodb/mappingclient/core/Utils.java", "diffHunk": "@@ -117,4 +119,13 @@ public static String cleanAttributeName(String key) {\n         return sortKeyValue.map(attributeValue -> Key.create(partitionKeyValue, attributeValue))\n                            .orElseGet(() -> Key.create(partitionKeyValue));\n     }\n+\n+    public static <T> List<T> getListIfExist(List<Supplier<T>> itemSupplierList) {", "originalCommit": "6c02a65b42b841a447e48110009b32d980e468ff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTcyMzc5NA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1654#discussion_r381723794", "bodyText": "yes, definitely. Updated.", "author": "cenedhryn", "createdAt": "2020-02-20T03:54:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQyNzIwOA=="}], "type": "inlineReview"}, {"oid": "7a8103448fe609ff122ca31a7aa188a9082849da", "url": "https://github.com/aws/aws-sdk-java-v2/commit/7a8103448fe609ff122ca31a7aa188a9082849da", "message": "Dynamodb-enhanced [preview]: Updates all operations with consumer style invocations", "committedDate": "2020-02-21T15:18:27Z", "type": "commit"}, {"oid": "7a8103448fe609ff122ca31a7aa188a9082849da", "url": "https://github.com/aws/aws-sdk-java-v2/commit/7a8103448fe609ff122ca31a7aa188a9082849da", "message": "Dynamodb-enhanced [preview]: Updates all operations with consumer style invocations", "committedDate": "2020-02-21T15:18:27Z", "type": "forcePushed"}, {"oid": "9b07f60305c53d508ef7e5034a65451d73c9498a", "url": "https://github.com/aws/aws-sdk-java-v2/commit/9b07f60305c53d508ef7e5034a65451d73c9498a", "message": "Merge branch 'master' into salande/ddbmapper-consumer-operations", "committedDate": "2020-02-21T15:22:01Z", "type": "commit"}]}