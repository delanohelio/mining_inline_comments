{"pr_number": 1608, "pr_title": "Add the ability to set trust managers for Apache, URLConnection, Netty", "pr_createdAt": "2020-01-22T23:29:59Z", "pr_url": "https://github.com/aws/aws-sdk-java-v2/pull/1608", "timeline": [{"oid": "d928feca5281d6cbedd0d9eff39f4bf9aa7a6cee", "url": "https://github.com/aws/aws-sdk-java-v2/commit/d928feca5281d6cbedd0d9eff39f4bf9aa7a6cee", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection", "committedDate": "2020-01-23T01:08:48Z", "type": "forcePushed"}, {"oid": "01c892019d474df15583ae0502544b5fe0462c91", "url": "https://github.com/aws/aws-sdk-java-v2/commit/01c892019d474df15583ae0502544b5fe0462c91", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty", "committedDate": "2020-01-23T02:00:45Z", "type": "forcePushed"}, {"oid": "ffaf4dbe00a8b36b8f4296d095b5f44172d07f94", "url": "https://github.com/aws/aws-sdk-java-v2/commit/ffaf4dbe00a8b36b8f4296d095b5f44172d07f94", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty", "committedDate": "2020-01-23T02:19:08Z", "type": "forcePushed"}, {"oid": "34b6f242cc6a25e21775572b4ad9bf84c812c746", "url": "https://github.com/aws/aws-sdk-java-v2/commit/34b6f242cc6a25e21775572b4ad9bf84c812c746", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider", "committedDate": "2020-01-23T20:25:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQxMzgzOA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1608#discussion_r370413838", "bodyText": "Not directly related to your change, but can you make static vs not static import consistent?", "author": "spfink", "createdAt": "2020-01-23T23:46:48Z", "path": "http-clients/netty-nio-client/src/main/java/software/amazon/awssdk/http/nio/netty/internal/NettyConfiguration.java", "diffHunk": "@@ -92,4 +89,12 @@ public boolean reapIdleConnections() {\n     public TlsKeyManagersProvider tlsKeyManagersProvider() {\n         return configuration.get(SdkHttpConfigurationOption.TLS_KEY_MANAGERS_PROVIDER);\n     }\n+\n+    public TlsTrustManagersProvider tlsTrustManagersProvider() {\n+        return configuration.get(SdkHttpConfigurationOption.TLS_TRUST_MANAGERS_PROVIDER);\n+    }\n+\n+    public boolean trustAllCertificates() {\n+        return configuration.get(TRUST_ALL_CERTIFICATES);", "originalCommit": "34b6f242cc6a25e21775572b4ad9bf84c812c746", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg3OTQ3Ng==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1608#discussion_r370879476", "bodyText": "Done", "author": "abrooksv", "createdAt": "2020-01-24T23:02:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQxMzgzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQxNDM3Nw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1608#discussion_r370414377", "bodyText": "Add validation here (and other clients) that both this and trust all can't both be set?", "author": "spfink", "createdAt": "2020-01-23T23:48:53Z", "path": "http-clients/apache-client/src/main/java/software/amazon/awssdk/http/apache/ApacheHttpClient.java", "diffHunk": "@@ -581,6 +599,10 @@ private HostnameVerifier getHostNameVerifier(AttributeMap standardOptions) {\n \n         private SSLContext getSslContext(AttributeMap standardOptions) {\n             TrustManager[] trustManagers = null;\n+            if (standardOptions.containsKey(SdkHttpConfigurationOption.TLS_TRUST_MANAGERS_PROVIDER)) {", "originalCommit": "34b6f242cc6a25e21775572b4ad9bf84c812c746", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg3OTQ4OA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1608#discussion_r370879488", "bodyText": "Done", "author": "abrooksv", "createdAt": "2020-01-24T23:02:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQxNDM3Nw=="}], "type": "inlineReview"}, {"oid": "2786879237c2548ad5a5a036225807140d939b28", "url": "https://github.com/aws/aws-sdk-java-v2/commit/2786879237c2548ad5a5a036225807140d939b28", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider", "committedDate": "2020-01-24T23:00:25Z", "type": "forcePushed"}, {"oid": "9a8f257f9e85dd2767af3fd1e369043ad1ce42e0", "url": "https://github.com/aws/aws-sdk-java-v2/commit/9a8f257f9e85dd2767af3fd1e369043ad1ce42e0", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider", "committedDate": "2020-01-24T23:16:41Z", "type": "forcePushed"}, {"oid": "19f531abdcf5eb6da5338a93f5ef83c53bab589c", "url": "https://github.com/aws/aws-sdk-java-v2/commit/19f531abdcf5eb6da5338a93f5ef83c53bab589c", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider", "committedDate": "2020-01-24T23:50:17Z", "type": "forcePushed"}, {"oid": "96460e2c008076f1929bcb14383dc3835589a6d8", "url": "https://github.com/aws/aws-sdk-java-v2/commit/96460e2c008076f1929bcb14383dc3835589a6d8", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider", "committedDate": "2020-01-30T20:12:07Z", "type": "forcePushed"}, {"oid": "137692e4e1059f4d48d880d76a3625d78feb96f0", "url": "https://github.com/aws/aws-sdk-java-v2/commit/137692e4e1059f4d48d880d76a3625d78feb96f0", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider", "committedDate": "2020-01-30T20:18:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYwNjgwMg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1608#discussion_r373606802", "bodyText": "This formatting is weird", "author": "spfink", "createdAt": "2020-01-31T17:55:28Z", "path": "http-clients/netty-nio-client/src/main/java/software/amazon/awssdk/http/nio/netty/NettyNioAsyncHttpClient.java", "diffHunk": "@@ -82,9 +73,13 @@\n \n     // Override connection idle timeout for Netty http client to reduce the frequency of \"server failed to complete the\n     // response error\". see https://github.com/aws/aws-sdk-java-v2/issues/1122\n+    // CHECKSTYLE:OFF - Lines are too long\n     private static final AttributeMap NETTY_HTTP_DEFAULTS = AttributeMap.builder()\n-                                                                        .put(CONNECTION_MAX_IDLE_TIMEOUT, Duration.ofSeconds(5))\n+                                                                        .put(\n+                                                                            SdkHttpConfigurationOption.CONNECTION_MAX_IDLE_TIMEOUT,", "originalCommit": "137692e4e1059f4d48d880d76a3625d78feb96f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYwODU3Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1608#discussion_r373608573", "bodyText": "Yaaa, normal format puts it past the line limit. Disable Checkstyle for this block?", "author": "abrooksv", "createdAt": "2020-01-31T17:59:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYwNjgwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYwODk0Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1608#discussion_r373608943", "bodyText": "New line AttributeMap.builder()?", "author": "spfink", "createdAt": "2020-01-31T18:00:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYwNjgwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYxMDU4NQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1608#discussion_r373610585", "bodyText": "Works for me!", "author": "abrooksv", "createdAt": "2020-01-31T18:04:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYwNjgwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYwODAwMQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1608#discussion_r373608001", "bodyText": "A TlsTrustManagerProvider can't be provided if TrustAllCertificates is also set", "author": "spfink", "createdAt": "2020-01-31T17:58:14Z", "path": "http-clients/apache-client/src/main/java/software/amazon/awssdk/http/apache/ApacheHttpClient.java", "diffHunk": "@@ -580,14 +590,22 @@ private HostnameVerifier getHostNameVerifier(AttributeMap standardOptions) {\n         }\n \n         private SSLContext getSslContext(AttributeMap standardOptions) {\n+            Validate.isTrue(standardOptions.get(SdkHttpConfigurationOption.TLS_TRUST_MANAGERS_PROVIDER) == null ||\n+                            !standardOptions.get(SdkHttpConfigurationOption.TRUST_ALL_CERTIFICATES),\n+                            \"The tlsTrustManagersProvider and trust all can't both be configured.\");", "originalCommit": "137692e4e1059f4d48d880d76a3625d78feb96f0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c852dd4a912760badcc44c6523f7fedd23051ebb", "url": "https://github.com/aws/aws-sdk-java-v2/commit/c852dd4a912760badcc44c6523f7fedd23051ebb", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider", "committedDate": "2020-01-31T18:07:05Z", "type": "commit"}, {"oid": "c852dd4a912760badcc44c6523f7fedd23051ebb", "url": "https://github.com/aws/aws-sdk-java-v2/commit/c852dd4a912760badcc44c6523f7fedd23051ebb", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider", "committedDate": "2020-01-31T18:07:05Z", "type": "forcePushed"}, {"oid": "f44fe412fd38a4fb16eaf5ee17ce31f98ca101c2", "url": "https://github.com/aws/aws-sdk-java-v2/commit/f44fe412fd38a4fb16eaf5ee17ce31f98ca101c2", "message": "Merge branch 'master' into trustManagers", "committedDate": "2020-02-06T17:31:07Z", "type": "commit"}, {"oid": "aa0f91efa11ffbcfbc11bbfa06fa850f30525a1a", "url": "https://github.com/aws/aws-sdk-java-v2/commit/aa0f91efa11ffbcfbc11bbfa06fa850f30525a1a", "message": "Merge branch 'master' into trustManagers", "committedDate": "2020-02-06T21:15:35Z", "type": "commit"}]}