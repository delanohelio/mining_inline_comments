{"pr_number": 1603, "pr_title": "Additional logging for GOAWAY", "pr_createdAt": "2020-01-21T20:26:46Z", "pr_url": "https://github.com/aws/aws-sdk-java-v2/pull/1603", "timeline": [{"oid": "3e56b888fc33386e63102d14568e4bf1713b9e1e", "url": "https://github.com/aws/aws-sdk-java-v2/commit/3e56b888fc33386e63102d14568e4bf1713b9e1e", "message": "Additional logging for GOAWAY\n\nShould help during debugging and troubleshooting.", "committedDate": "2020-01-21T20:25:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI3OTQ4Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1603#discussion_r369279483", "bodyText": "Still not sure if we should set it to warn as GOAWAY is not uncommon and retry normally should work. Using warn might raise unnecessary concerns.\nCan we add the message in the exception instead?", "author": "zoewangg", "createdAt": "2020-01-21T22:32:31Z", "path": "http-clients/netty-nio-client/src/main/java/software/amazon/awssdk/http/nio/netty/internal/http2/Http2MultiplexedChannelPool.java", "diffHunk": "@@ -316,7 +316,7 @@ private boolean acquireStreamOnInitializedConnection(MultiplexedChannelRecord ch\n     }\n \n     public void handleGoAway(Channel parentChannel, int lastStreamId, GoAwayException exception) {\n-        log.debug(() -> \"Received GOAWAY on \" + parentChannel + \" with lastStreamId of \" + lastStreamId);\n+        log.warn(() -> \"Received GOAWAY on \" + parentChannel + \" with lastStreamId of \" + lastStreamId);", "originalCommit": "3e56b888fc33386e63102d14568e4bf1713b9e1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI4NjQyNA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1603#discussion_r369286424", "bodyText": "Yeah looking at this again, I don't think it's necessary to increase the level here. The changes MultiplexedChannelRecord should be all we need", "author": "dagnir", "createdAt": "2020-01-21T22:50:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI3OTQ4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI4Njg4NA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1603#discussion_r369286884", "bodyText": "Same here. Can we add the message in the exception instead?", "author": "zoewangg", "createdAt": "2020-01-21T22:51:54Z", "path": "http-clients/netty-nio-client/src/main/java/software/amazon/awssdk/http/nio/netty/internal/http2/MultiplexedChannelRecord.java", "diffHunk": "@@ -81,7 +82,15 @@ boolean acquireStream(Promise<Channel> promise) {\n     private void acquireClaimedStream(Promise<Channel> promise) {\n         doInEventLoop(connection.eventLoop(), () -> {\n             if (state != RecordState.OPEN) {\n-                String message = \"Connection received GOAWAY or was closed while acquiring new stream.\";\n+                String message;\n+                // GOAWAY\n+                if (state == RecordState.CLOSED_TO_NEW) {\n+                    message = String.format(\"Connection %s received GOAWAY with Last Stream ID %d. Unable to open new \"\n+                                            + \"streams on this connection.\", connection, lastStreamId);\n+                } else {\n+                    message = String.format(\"Connection %s was closed while acquiring new stream.\", connection);\n+                }\n+                log.warn(() -> message);", "originalCommit": "3e56b888fc33386e63102d14568e4bf1713b9e1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI5Mjc4OA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1603#discussion_r369292788", "bodyText": "I would rather keep this here. This is the specific case we care about right, trying to create a stream on one that has received a GOAWAY. The message is added to the exception as well", "author": "dagnir", "createdAt": "2020-01-21T23:08:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI4Njg4NA=="}], "type": "inlineReview"}, {"oid": "a00309b8be1c6876c9af89945951c269d66ab137", "url": "https://github.com/aws/aws-sdk-java-v2/commit/a00309b8be1c6876c9af89945951c269d66ab137", "message": "Change back to DEBUG level", "committedDate": "2020-01-23T18:42:21Z", "type": "commit"}, {"oid": "9af709d6ea50a7306ada338e8cc275acb6bcc813", "url": "https://github.com/aws/aws-sdk-java-v2/commit/9af709d6ea50a7306ada338e8cc275acb6bcc813", "message": "Merge branch 'master' into go_away-logging", "committedDate": "2020-01-24T00:58:12Z", "type": "commit"}, {"oid": "14abef5f80a4943bf974e4ae512edb923c992066", "url": "https://github.com/aws/aws-sdk-java-v2/commit/14abef5f80a4943bf974e4ae512edb923c992066", "message": "Merge branch 'master' into go_away-logging", "committedDate": "2020-01-24T04:19:19Z", "type": "commit"}]}