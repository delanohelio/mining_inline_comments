{"pr_number": 1678, "pr_title": "Add support for maven lambda archetype", "pr_createdAt": "2020-02-28T20:16:51Z", "pr_url": "https://github.com/aws/aws-sdk-java-v2/pull/1678", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkyNjQ3NA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r385926474", "bodyText": "How do we pin this to the most recent version?", "author": "bmaizels", "createdAt": "2020-02-28T21:18:05Z", "path": "archetypes/archetype-lambda/src/main/resources/archetype-resources/pom.xml", "diffHunk": "@@ -0,0 +1,110 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  ~ Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+  ~\n+  ~ Licensed under the Apache License, Version 2.0 (the \"License\").\n+  ~ You may not use this file except in compliance with the License.\n+  ~ A copy of the License is located at\n+  ~\n+  ~  http://aws.amazon.com/apache2.0\n+  ~\n+  ~ or in the \"license\" file accompanying this file. This file is distributed\n+  ~ on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+  ~ express or implied. See the License for the specific language governing\n+  ~ permissions and limitations under the License.\n+  -->\n+\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <groupId>${groupId}</groupId>\n+    <artifactId>${artifactId}</artifactId>\n+    <version>${version}</version>\n+    <packaging>jar</packaging>\n+    <properties>\n+        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n+        <maven.compiler.source>1.8</maven.compiler.source>\n+        <maven.compiler.target>1.8</maven.compiler.target>\n+        <maven.shade.plugin.version>3.1.1</maven.shade.plugin.version>\n+        <maven.compiler.plugin.version>3.6.1</maven.compiler.plugin.version>\n+        <exec-maven-plugin.version>1.6.0</exec-maven-plugin.version>\n+        <aws.java.sdk.version>2.10.66</aws.java.sdk.version>", "originalCommit": "f922a397b7d9ef87f689bd0de4a4361c7051312c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk0NzcwOQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r385947709", "bodyText": "Yeah, I should use ${awsjavasdk.version}. I hardcoded the version for testing and forgot to change it back.", "author": "zoewangg", "createdAt": "2020-02-28T22:16:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkyNjQ3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkzMTI3OQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r385931279", "bodyText": "Maybe we want comments here so people know that they could/should tweak based on their needs (assuming we never make this parameters of the archtype)", "author": "bmaizels", "createdAt": "2020-02-28T21:30:18Z", "path": "archetypes/archetype-lambda/src/main/resources/archetype-resources/template.yaml", "diffHunk": "@@ -0,0 +1,11 @@\n+AWSTemplateFormatVersion: '2010-09-09'\n+Transform: AWS::Serverless-2016-10-31\n+Resources:\n+  ${handlerClassName}Function:\n+    Type: AWS::Serverless::Function\n+    Properties:\n+      Runtime: java8\n+      Handler: ${package}.${handlerClassName}::handleRequest\n+      Timeout: 60\n+      MemorySize: 512", "originalCommit": "f922a397b7d9ef87f689bd0de4a4361c7051312c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk0Nzc2NQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r385947765", "bodyText": "+1", "author": "zoewangg", "createdAt": "2020-02-28T22:16:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkzMTI3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkzMTQ3Nw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r385931477", "bodyText": "Ouch. Is this the only one?", "author": "bmaizels", "createdAt": "2020-02-28T21:30:51Z", "path": "archetypes/archetype-lambda/src/main/resources/global.vm", "diffHunk": "@@ -0,0 +1,26 @@\n+## global variables used by the project\n+#set( $symbol_pound = '#' )\n+#set( $symbol_dollar = '$' )\n+#set( $symbol_escape = '\\' )\n+## TODO: find a better way to handle this\n+#if( $service == 'dynamodb')\n+    #set ( $service = 'dynamoDb')\n+#end", "originalCommit": "f922a397b7d9ef87f689bd0de4a4361c7051312c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk0Nzk4Nw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r385947987", "bodyText": "No, this would not be the only one. I'll think about a better way to map serviceId -> serviceClientName", "author": "zoewangg", "createdAt": "2020-02-28T22:17:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkzMTQ3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUwMzE0MQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r397503141", "bodyText": "Can't think of an easy way to do it. Currently, the service module name is lower case derived from serviceId, and the client class name is camel case derived from service name.\nWe can probably write some scripts to search service-2.json files to map serviceId to serviceName, but that seems a bit overkill. I'm leaning towards just fixing the popular services here.", "author": "zoewangg", "createdAt": "2020-03-24T22:36:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkzMTQ3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkzMjMxNg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r385932316", "bodyText": "Ideally we'd have validation here, what if they typo the service?", "author": "bmaizels", "createdAt": "2020-02-28T21:33:06Z", "path": "archetypes/archetype-lambda/src/main/resources/META-INF/maven/archetype-metadata.xml", "diffHunk": "@@ -0,0 +1,40 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<archetype-descriptor xsi:schemaLocation=\"http://maven.apache.org/plugins/maven-archetype-plugin/archetype-descriptor/1.0.0 http://maven.apache.org/xsd/archetype-descriptor-1.0.0.xsd\" name=\"zoewanglambdatesting\"\n+    xmlns=\"http://maven.apache.org/plugins/maven-archetype-plugin/archetype-descriptor/1.0.0\"\n+    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n+  <fileSets>\n+    <fileSet filtered=\"true\" packaged=\"true\" encoding=\"UTF-8\">\n+      <directory>src/main/java</directory>\n+      <includes>\n+        <include>**/*.java</include>\n+      </includes>\n+    </fileSet>\n+    <fileSet filtered=\"true\" packaged=\"true\" encoding=\"UTF-8\">\n+      <directory>src/test/java</directory>\n+      <includes>\n+        <include>**/*.java</include>\n+      </includes>\n+    </fileSet>\n+    <fileSet filtered=\"true\" encoding=\"UTF-8\">\n+      <directory/>\n+      <includes>\n+        <include>.gitignore</include>\n+        <include>template.yaml</include>\n+      </includes>\n+    </fileSet>\n+  </fileSets>\n+  <requiredProperties>\n+    <requiredProperty key=\"handlerClassName\">\n+      <defaultValue>App</defaultValue>\n+    </requiredProperty>\n+    <requiredProperty key=\"service\">\n+    </requiredProperty>", "originalCommit": "f922a397b7d9ef87f689bd0de4a4361c7051312c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk0ODM2OQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r385948369", "bodyText": "That's a limitation for archetype; they only have regex validation, which is not sufficient. We can probably make it more clear on the documentation that this should be the serviceId.", "author": "zoewangg", "createdAt": "2020-02-28T22:18:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkzMjMxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkzMjY5NA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r385932694", "bodyText": "Might be worth mentioning sync vs async here", "author": "bmaizels", "createdAt": "2020-02-28T21:34:09Z", "path": "archetypes/archetype-lambda/README.md", "diffHunk": "@@ -0,0 +1,44 @@\n+# Maven Archetype for lambda function using AWS SDK for Java 2.x\n+\n+## Description\n+This is an Apache Maven Archetype to create a lambda function template using [AWS Java SDK 2.x][aws-java-sdk-v2]. The generated template\n+has the optimized configurations and follows the best practices to reduce start up time.\n+\n+## Usage\n+\n+You can use the following command to generate a project:\n+\n+```\n+mvn archetype:generate \\\n+  -DarchetypeGroupId=software.amazon.awssdk \\\n+  -DarchetypeArtifactId=lambda-archetypes \\\n+  -DarchetypeVersion=2.x\\\n+```\n+\n+To deploy the function, you can use [SAM CLI][sam-cli].\n+\n+```\n+sam deploy --guided\n+```\n+Please refer to [deploying lambda apps][deploying-lambda-apps] for more info.\n+\n+## Parameters\n+      \n+Parameter Name | Default Value | Description\n+---|---|---\n+`service` (required) | n/a | Specifies service client to be used in the lambda function. You can find the  eg: s3, dynamodb\n+`region` (required) | n/a | Specifies region to be set for the SDK client in the application\n+`groupId`(required) | n/a | Specifies the group ID of the project\n+`artifactId`(required) | n/a | Specifies the artifact ID of the project\n+`httpClient` | url-connection-client | Specifies which http client to be used by the SDK client, available options are `url-connection-client`, `apache-client`, `netty-nio-client`", "originalCommit": "f922a397b7d9ef87f689bd0de4a4361c7051312c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk0ODU1NQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r385948555", "bodyText": "Sure", "author": "zoewangg", "createdAt": "2020-02-28T22:18:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkzMjY5NA=="}], "type": "inlineReview"}, {"oid": "c4a10dd2b5c5fc4f34cd6d209b78b43607891717", "url": "https://github.com/aws/aws-sdk-java-v2/commit/c4a10dd2b5c5fc4f34cd6d209b78b43607891717", "message": "Add tests, improve docs and other changes", "committedDate": "2020-03-24T19:49:03Z", "type": "forcePushed"}, {"oid": "e85ff6b64bae02054cc6a47ad4e2419b5d6efd9f", "url": "https://github.com/aws/aws-sdk-java-v2/commit/e85ff6b64bae02054cc6a47ad4e2419b5d6efd9f", "message": "Add tests, improve docs and other changes", "committedDate": "2020-03-24T20:07:30Z", "type": "forcePushed"}, {"oid": "b272b3f3bd9785fe4bd982df9b80af028d7fa3e7", "url": "https://github.com/aws/aws-sdk-java-v2/commit/b272b3f3bd9785fe4bd982df9b80af028d7fa3e7", "message": "Add tests, improve docs and other changes", "committedDate": "2020-03-24T20:24:11Z", "type": "forcePushed"}, {"oid": "47165ca62890d5b9827c3007072bd29f4e22e723", "url": "https://github.com/aws/aws-sdk-java-v2/commit/47165ca62890d5b9827c3007072bd29f4e22e723", "message": "Add tests, improve docs and other changes", "committedDate": "2020-03-24T20:28:53Z", "type": "forcePushed"}, {"oid": "31a5b3a88a1ddc84e0031f48f326edaadda1fb1f", "url": "https://github.com/aws/aws-sdk-java-v2/commit/31a5b3a88a1ddc84e0031f48f326edaadda1fb1f", "message": "Add tests, improve docs and other changes", "committedDate": "2020-03-24T21:25:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MjQ2Ng==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398072466", "bodyText": "Can they just specify the module name (s3) and client name (S3Client) or something, so that we don't need to maintain a mapping?\nCan we also generate instructions for adding more services? Maybe in a comment or something?", "author": "millems", "createdAt": "2020-03-25T18:19:05Z", "path": "archetypes/archetype-lambda/README.md", "diffHunk": "@@ -0,0 +1,65 @@\n+# Maven Archetype for lambda function using AWS SDK for Java 2.x\n+\n+## Description\n+This is an Apache Maven Archetype to create a lambda function template using [AWS Java SDK 2.x][aws-java-sdk-v2]. The generated template\n+has the optimized configurations and follows the best practices to reduce start up time.\n+\n+## Usage\n+\n+You can use `mvn archetype:generate` to generate a project using this archetype. See [maven archetype usage guidance][maven-archetype-usage] for more information.\n+\n+- Interactive mode\n+\n+```\n+mvn archetype:generate \\\n+  -DarchetypeGroupId=software.amazon.awssdk \\\n+  -DarchetypeArtifactId=archetype-lambda \\\n+  -DarchetypeVersion=2.x\\\n+```\n+\n+- Batch mode\n+\n+```\n+mvn archetype:generate \\\n+    -DarchetypeGroupId=software.amazon.awssdk \\\n+    -DarchetypeArtifactId=archetype-lambda \\\n+    -DarchetypeVersion=2.x\\\n+    -DgroupId=com.test \\\n+    -DartifactId=sample-project \\\n+    -Dservice=s3  \\\n+    -Dregion=us-west-2 \\\n+    -DinteractiveMode=false \\\n+```\n+\n+### Parameters\n+      \n+Parameter Name | Default Value | Description\n+---|---|---\n+`service` (required) | n/a | Specifies the service client to be used in the lambda function, eg: s3, dynamodb. You can find available services [here][java-sdk-v2-services].", "originalCommit": "31a5b3a88a1ddc84e0031f48f326edaadda1fb1f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA5MzY3NA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398093674", "bodyText": "They'd need to know the exact sync/async client names and I feel like that's kind of against the purpose of quickly bootstrapping a project from a template.\nYeah, I can add some comments to explain how to add more services in the code.", "author": "zoewangg", "createdAt": "2020-03-25T18:52:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MjQ2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEwMDExMw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398100113", "bodyText": "Sure, we can always write a build-tool to generate them pretty easily in the future.\nCould we do a quick bash script to generate them for the currently-launched services? That shouldn't be too hard, if we're just hunting for things that extend SdkClient in each service module.", "author": "millems", "createdAt": "2020-03-25T19:03:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MjQ2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc2Mzg5Ng==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398763896", "bodyText": "Yeah, generated serviceMapping.vm   file that contains currently-launched services. I'll add the script in another PR to make it update the file automatically after every release.", "author": "zoewangg", "createdAt": "2020-03-26T17:37:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MjQ2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc2NzI5OA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398767298", "bodyText": "What if we added a build script to do it during the release, instead of having to do it after the release?", "author": "millems", "createdAt": "2020-03-26T17:42:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MjQ2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NjY1OQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398796659", "bodyText": "Yeah, I misspoke. We can update it during the release like how we update the changelog.", "author": "zoewangg", "createdAt": "2020-03-26T18:24:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MjQ2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5ODk2MA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398798960", "bodyText": "I misspoke too, I meant: can we write a build script, that as part of a mvn clean install generates the serviceMapping.vm used in this archetype?", "author": "millems", "createdAt": "2020-03-26T18:28:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MjQ2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5OTU3Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398799573", "bodyText": "Like, a maven plugin or build tool that does it as part of the build.", "author": "millems", "createdAt": "2020-03-26T18:29:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MjQ2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgwMzQxNw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398803417", "bodyText": "Yeah, I thought about it, but it'll take a really long time to build this specific module because it technically depends on all services. Release is probably fine because it builds all modules anyway but for development, if you are making changes in this module,  you'll have to wait for a long time for it to build.", "author": "zoewangg", "createdAt": "2020-03-26T18:35:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MjQ2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgxMjkyNQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398812925", "bodyText": "On second thought, it'll probably be easier to maintain if we keep the script within this module and build the file during build time.", "author": "zoewangg", "createdAt": "2020-03-26T18:50:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MjQ2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3NTM3OA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398075378", "bodyText": "In the future, we should consider showing them how to do true DI with dagger.", "author": "millems", "createdAt": "2020-03-25T18:23:34Z", "path": "archetypes/archetype-lambda/src/main/resources/archetype-resources/src/main/java/DependencyFactory.java", "diffHunk": "@@ -0,0 +1,27 @@\n+#parse ( \"global.vm\")\n+\n+package ${package};\n+\n+import software.amazon.awssdk.auth.credentials.EnvironmentVariableCredentialsProvider;\n+import software.amazon.awssdk.http.${httpClientPackageName};\n+import software.amazon.awssdk.regions.Region;\n+import software.amazon.awssdk.services.${servicePackage}.${serviceClientClassName};\n+\n+/**\n+ * The module containing all dependencies required by the {@link ${handlerClassName}}.\n+ */\n+public class DependencyFactory {\n+\n+    private DependencyFactory() {}\n+\n+    /**\n+     * @return an instance of ${serviceClientClassName}\n+     */\n+    public static ${serviceClientClassName} ${service}Client() {", "originalCommit": "31a5b3a88a1ddc84e0031f48f326edaadda1fb1f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4NjA3Ng==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398086076", "bodyText": "Yup. I thought about adding another parameter, something like di, which allows customers to switch between relatively lightweight DI such as dagger or guice or no DI at all.", "author": "zoewangg", "createdAt": "2020-03-25T18:40:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3NTM3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3OTY2Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398079663", "bodyText": "If we want to invest time, we could generate these mappings and upload them to maven for the archetype to use.", "author": "millems", "createdAt": "2020-03-25T18:30:11Z", "path": "archetypes/archetype-lambda/src/main/resources/global.vm", "diffHunk": "@@ -0,0 +1,29 @@\n+## global variables used by the project\n+#set( $symbol_pound = '#' )\n+#set( $symbol_dollar = '$' )\n+#set( $symbol_escape = '\\' )\n+## TODO: there is no easy way to map service module artifactId to the client name derived the service name\n+## As a workaround: mapping the common service here\n+#if( $service == 'dynamodb')\n+    #set ( $service = 'dynamoDb')\n+#end", "originalCommit": "31a5b3a88a1ddc84e0031f48f326edaadda1fb1f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4MDY0OA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398080648", "bodyText": "Do we include open SSL or other tweaks for netty?", "author": "millems", "createdAt": "2020-03-25T18:31:50Z", "path": "archetypes/archetype-lambda/src/test/resources/projects/nettyclient/reference/src/main/java/software/amazonaws/test/DependencyFactory.java", "diffHunk": "@@ -0,0 +1,26 @@\n+\n+package software.amazonaws.test;\n+\n+import software.amazon.awssdk.auth.credentials.EnvironmentVariableCredentialsProvider;\n+import software.amazon.awssdk.http.nio.netty.NettyNioAsyncHttpClient;\n+import software.amazon.awssdk.regions.Region;\n+import software.amazon.awssdk.services.kinesis.KinesisAsyncClient;\n+\n+/**\n+ * The module containing all dependencies required by the {@link MyNettyFunction}.\n+ */\n+public class DependencyFactory {\n+\n+    private DependencyFactory() {}\n+\n+    /**\n+     * @return an instance of KinesisAsyncClient\n+     */\n+    public static KinesisAsyncClient kinesisClient() {\n+        return KinesisAsyncClient.builder()\n+                       .credentialsProvider(EnvironmentVariableCredentialsProvider.create())\n+                       .region(Region.US_EAST_1)\n+                       .httpClientBuilder(NettyNioAsyncHttpClient.builder())", "originalCommit": "31a5b3a88a1ddc84e0031f48f326edaadda1fb1f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4ODU0Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398088543", "bodyText": "That would require another openssl dependency netty-tcnative though, and not all platforms support it. We can probably add a comment here to recommend using openssl if possible.", "author": "zoewangg", "createdAt": "2020-03-25T18:44:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4MDY0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA5MDg2NA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398090864", "bodyText": "But since it's on Lambda, we know the platform, right?", "author": "millems", "createdAt": "2020-03-25T18:48:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4MDY0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA5NDAzMQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398094031", "bodyText": "lol, good point. I'll give it a try", "author": "zoewangg", "createdAt": "2020-03-25T18:53:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4MDY0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE0MDAxNA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398140014", "bodyText": "Wow, the netty-tcnative-boringssl-static binding jar itself is 3MB...Certainly wouldn't help with cold start issue, but I guess it would improve overall latency a bit.\n5 concurrent s3Async#listBuckets calls with 1024MB mem:\n\nOpenssl Duration: 3767.44 ms, Init Duration: 1092.19 ms\nJDK: Duration: 3995.94 ms Init Duration: 1108.46 ms", "author": "zoewangg", "createdAt": "2020-03-25T20:14:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4MDY0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg4NTc3MQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398885771", "bodyText": "Ended up just adding netty-tcnative-boringssl-static dependency so that it'd use openssl if supported and fallback to jdk ssl provider otherwise.", "author": "zoewangg", "createdAt": "2020-03-26T20:55:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4MDY0OA=="}], "type": "inlineReview"}, {"oid": "3dc5e50c84e1646cd8bf8ec3e56c51faf531a3fe", "url": "https://github.com/aws/aws-sdk-java-v2/commit/3dc5e50c84e1646cd8bf8ec3e56c51faf531a3fe", "message": "generate service mapping vm file during build time", "committedDate": "2020-03-26T20:55:20Z", "type": "forcePushed"}, {"oid": "52ff67bf2862bbbc26250db108e912ea7046b600", "url": "https://github.com/aws/aws-sdk-java-v2/commit/52ff67bf2862bbbc26250db108e912ea7046b600", "message": "generate service mapping vm file during build time", "committedDate": "2020-03-26T20:56:42Z", "type": "forcePushed"}, {"oid": "1067b6ecf28826f5ba944d2aa72e260663b6eb4d", "url": "https://github.com/aws/aws-sdk-java-v2/commit/1067b6ecf28826f5ba944d2aa72e260663b6eb4d", "message": "generate service mapping vm file during build time", "committedDate": "2020-03-26T21:18:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkwNjA0OA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398906048", "bodyText": "How does this work for modules with multiple clients, e.g. dynamodb?", "author": "millems", "createdAt": "2020-03-26T21:33:11Z", "path": "archetypes/archetype-lambda/src/main/resources/map-service-to-client-prefix", "diffHunk": "@@ -0,0 +1,50 @@\n+#!/usr/bin/env python\n+\n+import json\n+import os\n+import string\n+\n+MAPPING_FILE_NAME = 'serviceMapping.vm'\n+RESOURCES_ROOT_DIR = os.path.join(os.path.dirname(os.path.abspath(__file__)))\n+ARCHETYPE_LAMBDA_ROOT_DIR = os.path.dirname(os.path.dirname(os.path.abspath(os.path.join(RESOURCES_ROOT_DIR, \"../\"))))\n+SERVICE_DIR = os.path.join(\n+    os.path.dirname(os.path.dirname(os.path.abspath(os.path.join(__file__, \"../../../../\")))),\n+    'services'\n+)\n+\n+def load_all_service_modules():\n+    service_mapping = {}\n+    for f in [f for f in os.listdir(SERVICE_DIR) if os.path.isdir(os.path.join(SERVICE_DIR, f)) & os.path.exists(os.path.join(SERVICE_DIR, f, 'target'))]:\n+        for s in [s for s in os.listdir(os.path.join(SERVICE_DIR, f, 'target', 'generated-sources/sdk/software/amazon/awssdk/services', f)) if s.endswith('AsyncClient.java') & s.startswith('Default')]:\n+            service_mapping[f] = find_client_prefix(s)\n+    return service_mapping\n+\n+def find_client_prefix(d):\n+    index = d.find('AsyncClient.java')\n+    return d[7:index]\n+\n+def write_to_vm_file(service_mapping):\n+    target = os.path.join(ARCHETYPE_LAMBDA_ROOT_DIR, 'target')\n+\n+    if not os.path.exists(target):\n+        os.mkdir(target)\n+\n+    target = os.path.join(ARCHETYPE_LAMBDA_ROOT_DIR, 'target', 'classes')\n+\n+    if not os.path.exists(target):\n+        os.mkdir(target)\n+\n+    filename = os.path.join(target, MAPPING_FILE_NAME)\n+\n+    with open(filename, 'w') as f:\n+        f.write('#set ( $serviceMapping =')\n+        f.write(json.dumps(service_mapping))\n+        f.write(')')\n+    return filename", "originalCommit": "1067b6ecf28826f5ba944d2aa72e260663b6eb4d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkxMjYzOQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398912639", "bodyText": "It only works with the top level client in those kind of modules, i.e., dynamodb and waf. :(\nI think it should be fine since there are only two broken clients dynamodbstream and wafregional and we can easily customize it.\nWe did specify in the README that the available service option can be found in https://github.com/aws/aws-sdk-java-v2/tree/master/services, so technically, wafregional and dynamodbstream are just not supported.", "author": "zoewangg", "createdAt": "2020-03-26T21:46:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkwNjA0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkxOTIxMA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398919210", "bodyText": "Sounds fine, as long as dynamodb doesn't generate a client for dynamodbstreams.", "author": "millems", "createdAt": "2020-03-26T22:01:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkwNjA0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkzNDkyMA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398934920", "bodyText": "Added customization for dynamodbstreams and wafregional and they should work now.", "author": "zoewangg", "createdAt": "2020-03-26T22:40:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkwNjA0OA=="}], "type": "inlineReview"}, {"oid": "4f1ab3032e4a07c35cd59ca4eebd5a9abb4e54e2", "url": "https://github.com/aws/aws-sdk-java-v2/commit/4f1ab3032e4a07c35cd59ca4eebd5a9abb4e54e2", "message": "Add support for maven lambda archetype", "committedDate": "2020-03-26T22:36:29Z", "type": "forcePushed"}, {"oid": "29cafa7734cd0ad5b0446ddfb83b14de1c6d62e8", "url": "https://github.com/aws/aws-sdk-java-v2/commit/29cafa7734cd0ad5b0446ddfb83b14de1c6d62e8", "message": "Add support for maven lambda archetype", "committedDate": "2020-03-26T23:25:14Z", "type": "commit"}, {"oid": "29cafa7734cd0ad5b0446ddfb83b14de1c6d62e8", "url": "https://github.com/aws/aws-sdk-java-v2/commit/29cafa7734cd0ad5b0446ddfb83b14de1c6d62e8", "message": "Add support for maven lambda archetype", "committedDate": "2020-03-26T23:25:14Z", "type": "forcePushed"}]}