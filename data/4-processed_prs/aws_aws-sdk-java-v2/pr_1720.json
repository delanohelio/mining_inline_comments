{"pr_number": 1720, "pr_title": "DDB Enhanced: Return flattened items in the response of scan and query", "pr_createdAt": "2020-03-17T17:00:01Z", "pr_url": "https://github.com/aws/aws-sdk-java-v2/pull/1720", "timeline": [{"oid": "766224b628bf10fab445b3b6695a0ebe7120a4e1", "url": "https://github.com/aws/aws-sdk-java-v2/commit/766224b628bf10fab445b3b6695a0ebe7120a4e1", "message": "Update javadocs", "committedDate": "2020-03-17T23:47:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxNDA0Nw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1720#discussion_r394514047", "bodyText": "Nit, indent", "author": "bmaizels", "createdAt": "2020-03-18T17:19:37Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/internal/operations/PaginatedIndexOperation.java", "diffHunk": "@@ -76,11 +77,11 @@\n      *                  operation. A null value here will result in no modifications.\n      * @return A high level result object as specified by the implementation of this operation.\n      */\n-    default SdkPublisher<ResultT> executeOnSecondaryIndexAsync(TableSchema<ItemT> tableSchema,\n-                                                               String tableName,\n-                                                               String indexName,\n-                                                               DynamoDbEnhancedClientExtension extension,\n-                                                               DynamoDbAsyncClient dynamoDbAsyncClient) {\n+    default SdkPublisher<Page<ItemT>> executeOnSecondaryIndexAsync(TableSchema<ItemT> tableSchema,\n+                                                            String tableName,\n+                                                            String indexName,\n+                                                            DynamoDbEnhancedClientExtension extension,\n+                                                            DynamoDbAsyncClient dynamoDbAsyncClient) {", "originalCommit": "766224b628bf10fab445b3b6695a0ebe7120a4e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxNzQ1OA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1720#discussion_r394517458", "bodyText": "I think there's a .items() missing?", "author": "bmaizels", "createdAt": "2020-03-18T17:24:49Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/DynamoDbAsyncTable.java", "diffHunk": "@@ -345,56 +345,61 @@\n      * further details and constraints.\n      * <p>\n      * Example:\n+     * <p>\n+     * 1) Subscribing to {@link Page}s\n+     * <pre>\n+     * {@code\n+     *\n+     * QueryConditional queryConditional = QueryConditional.keyEqualTo(Key.builder().partitionValue(\"id-value\").build());\n+     * PagePublisher<Page<MyItem>> publisher = mappedTable.query(QueryEnhancedRequest.builder()\n+     *                                                                              .queryConditional(queryConditional)\n+     *                                                                              .build());\n+     * publisher.subscribe(page -> page.items().forEach(item -> System.out.println(item)));\n+     * }\n+     * <p>\n+     * 2) Subscribing to items across all pages\n      * <pre>\n      * {@code\n      *\n      * QueryConditional queryConditional = QueryConditional.keyEqualTo(Key.builder().partitionValue(\"id-value\").build());\n-     * SdkPublisher<Page<MyItem>> publisher = mappedTable.query(QueryEnhancedRequest.builder()\n+     * PagePublisher<MyItem> publisher = mappedTable.query(QueryEnhancedRequest.builder()", "originalCommit": "766224b628bf10fab445b3b6695a0ebe7120a4e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU3MTMwOA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1720#discussion_r394571308", "bodyText": "Good catch. I wish there was a better way to automatically check the compiler errors in the code snippets from javadocs. I'll go over all code snippets.", "author": "zoewangg", "createdAt": "2020-03-18T18:55:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxNzQ1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxODc4MA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1720#discussion_r394518780", "bodyText": "Should we hint that there are more examples or ways to use this API documented here? This comment applies to all other instances where you've done the same.", "author": "bmaizels", "createdAt": "2020-03-18T17:26:50Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/DynamoDbAsyncTable.java", "diffHunk": "@@ -345,56 +345,61 @@\n      * further details and constraints.\n      * <p>\n      * Example:\n+     * <p>\n+     * 1) Subscribing to {@link Page}s\n+     * <pre>\n+     * {@code\n+     *\n+     * QueryConditional queryConditional = QueryConditional.keyEqualTo(Key.builder().partitionValue(\"id-value\").build());\n+     * PagePublisher<Page<MyItem>> publisher = mappedTable.query(QueryEnhancedRequest.builder()\n+     *                                                                              .queryConditional(queryConditional)\n+     *                                                                              .build());\n+     * publisher.subscribe(page -> page.items().forEach(item -> System.out.println(item)));\n+     * }\n+     * <p>\n+     * 2) Subscribing to items across all pages\n      * <pre>\n      * {@code\n      *\n      * QueryConditional queryConditional = QueryConditional.keyEqualTo(Key.builder().partitionValue(\"id-value\").build());\n-     * SdkPublisher<Page<MyItem>> publisher = mappedTable.query(QueryEnhancedRequest.builder()\n+     * PagePublisher<MyItem> publisher = mappedTable.query(QueryEnhancedRequest.builder()\n      *                                                                              .queryConditional(queryConditional)\n      *                                                                              .build());\n+     * publisher.subscribe(item -> System.out.println(item));\n      * }\n      * </pre>\n      *\n+     * @see DynamoDbAsyncClient#query\n      * @param request A {@link QueryEnhancedRequest} defining the query conditions and how\n      * to handle the results.\n-     * @return a publisher {@link SdkPublisher} with paginated results (see {@link Page}).\n+     * @return a publisher {@link PagePublisher} with paginated results (see {@link Page}).\n      */\n-    default SdkPublisher<Page<T>> query(QueryEnhancedRequest request) {\n+    default PagePublisher<T> query(QueryEnhancedRequest request) {\n         throw new UnsupportedOperationException();\n     }\n \n     /**\n      * Executes a query against the primary index of the table using a {@link QueryConditional} expression to retrieve a list of\n      * items matching the given conditions.\n      * <p>\n-     * The result is accessed through iterable pages (see {@link Page}) in an interactive way; each time a\n-     * result page is retrieved, a query call is made to DynamoDb to get those entries. If no matches are found,\n-     * the resulting iterator will contain an empty page. Results are sorted by sort key value in\n-     * ascending order by default; this behavior can be overridden in the {@link QueryEnhancedRequest}.\n-     * <p>\n-     * The additional configuration parameters that the enhanced client supports are defined\n-     * in the {@link QueryEnhancedRequest}.\n-     * <p>\n-     * This operation calls the low-level DynamoDB API Query operation. Consult the Query documentation for\n-     * further details and constraints.\n-     * <p>\n      * <b>Note:</b> This is a convenience method that creates an instance of the request builder avoiding the need to create one\n      * manually via {@link QueryEnhancedRequest#builder()}.\n      * <p>\n      * Example:\n      * <pre>\n      * {@code\n      *\n-     * SdkPublisher<Page<MyItem>> publisher =\n+     * PagePublisher<MyItem> publisher =\n      *     mappedTable.query(r -> r.queryConditional(QueryConditional.keyEqualTo(k -> k.partitionValue(\"id-value\"))));\n      * }\n      * </pre>\n      *\n+     * @see #query(QueryEnhancedRequest)", "originalCommit": "766224b628bf10fab445b3b6695a0ebe7120a4e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU5OTkwMA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1720#discussion_r394599900", "bodyText": "@see tag doesn't really render well with additional info - everything after it will show as a reference link.\nI can cross link all overloaded methods", "author": "zoewangg", "createdAt": "2020-03-18T19:49:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxODc4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUyMTAwOA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1720#discussion_r394521008", "bodyText": "Bad copy/paste, should be 2) Iterating through items", "author": "bmaizels", "createdAt": "2020-03-18T17:30:03Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/DynamoDbTable.java", "diffHunk": "@@ -499,72 +493,83 @@ default void putItem(T item) {\n     /**\n      * Scans the table and retrieves all items.\n      * <p>\n-     * The result is accessed through iterable pages (see {@link Page}) in an interactive way; each time a\n-     * result page is retrieved, a scan call is made to DynamoDb to get those entries. If no matches are found,\n+     * The result can be accessed either through iterable {@link Page}s or items across all pages directly. Each time a\n+     * result page is retrieved, a query call is made to DynamoDb to get those entries. If no matches are found,\n      * the resulting iterator will contain an empty page.\n      * <p>\n      * The additional configuration parameters that the enhanced client supports are defined\n      * in the {@link ScanEnhancedRequest}.\n      * <p>\n      * Example:\n+     * <p>\n+     * 1) Iterating through pages\n      * <pre>\n      * {@code\n      *\n-     * Iterator<Page<MyItem>> results = mappedTable.scan(ScanEnhancedRequest.builder().consistentRead(true).build());\n+     * PageIterable<MyItem> results = mappedTable.scan(ScanEnhancedRequest.builder().consistentRead(true).build());\n+     * results.stream().forEach(p -> p.items().forEach(item -> System.out.println(item)))\n      * }\n      * </pre>\n      *\n+     * <p>\n+     * 1) Iterating through pages\n+     * <pre>", "originalCommit": "766224b628bf10fab445b3b6695a0ebe7120a4e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b58569632513cbe37ce7a6c558b120f6795f2155", "url": "https://github.com/aws/aws-sdk-java-v2/commit/b58569632513cbe37ce7a6c558b120f6795f2155", "message": "remove unused ResultT generic type and update javadocs", "committedDate": "2020-03-18T20:17:50Z", "type": "forcePushed"}, {"oid": "c235e24af6bbb4eed2cf7d3c2ada407f3f49f5a3", "url": "https://github.com/aws/aws-sdk-java-v2/commit/c235e24af6bbb4eed2cf7d3c2ada407f3f49f5a3", "message": "remove unused ResultT generic type and update javadocs", "committedDate": "2020-03-18T20:20:59Z", "type": "forcePushed"}, {"oid": "8550b25750846008e411992219ce5e03aa576f3d", "url": "https://github.com/aws/aws-sdk-java-v2/commit/8550b25750846008e411992219ce5e03aa576f3d", "message": "Make query and scan return PageIterable that allows customers to iterate through items\n\nMake async query and scan return PagePublisher that allows customers to subscribe to items across all pages directly\n\nUpdate README", "committedDate": "2020-03-18T21:29:02Z", "type": "commit"}, {"oid": "8550b25750846008e411992219ce5e03aa576f3d", "url": "https://github.com/aws/aws-sdk-java-v2/commit/8550b25750846008e411992219ce5e03aa576f3d", "message": "Make query and scan return PageIterable that allows customers to iterate through items\n\nMake async query and scan return PagePublisher that allows customers to subscribe to items across all pages directly\n\nUpdate README", "committedDate": "2020-03-18T21:29:02Z", "type": "forcePushed"}]}