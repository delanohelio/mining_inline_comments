{"pr_number": 1947, "pr_title": "Update metrics docs", "pr_createdAt": "2020-07-08T17:31:32Z", "pr_url": "https://github.com/aws/aws-sdk-java-v2/pull/1947", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTc4NjUzOA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1947#discussion_r451786538", "bodyText": "Typo, \"of\"", "author": "Quanzzzz", "createdAt": "2020-07-08T19:47:50Z", "path": "docs/design/core/metrics/MetricsList.md", "diffHunk": "@@ -1,130 +1,61 @@\n-Here is the detailed list of metrics that SDK can collect. Each metric belongs to a category. If a category is enabled,\n-then all metrics belonging to that category will be collected by the SDK.\n-\n-## Category\n-\n-1) Default - All metrics under this category will be collected when the metrics are enabled\n-2) HttpClient - Additional information collected for http client. The metrics collected for each http client can vary\n-3) All - All metrics collected by the SDK comes under this category. This can be useful for debugging purposes.\n-\n-Note: When metrics feature is enabled, only the `Default` category metrics are collected. Other categories should be\n-explicitly enabled.\n-\n-## Information collected at application level (Category: Default)\n-\n-| Metric Name                    | Meter         | Description      |\n-| ------------------             | -----------   | ---------------- |\n-| RequestCount                   | Counter       | Total number of requests (successful and failed) made from your code to AWS services\n-| SuccessRequestCount            | Counter       | Total number of requests from your code to AWS services that resulted in a successful response\n-| FailedRequestCount             | Counter       | Total number of requests from your code to AWS services that resulted in a failure. This can be expanded later to categorize the failures into buckets (like ClientErrorCount, ServiceErrorCount, ConnectionErrorCount etc)\n-                  \n-## Information collected for each request (ApiCall) (Category: Default)\n-\n-| Metric Name                    | Meter         | Description      |\n-| ------------------             | -----------   | ---------------- |\n-| Service                        | ConstantGauge | Service ID of the AWS service that the API request is made against\n-| Api                            | ConstantGauge | The name of the AWS API the request is made to\n-| StreamingRequest               | ConstantGauge | True if the request has streaming payload\n-| StreamingResponse              | ConstantGauge | True if the response has streaming payload\n-| ApiCallStartTime               | Timer         | The start time of the request\n-| ApiCallEndTime                 | Timer         | The end time of the request\n-| ApiCallLatency                 | Timer         | The total time taken to finish a request (inclusive of all retries), ApiCallEndTime - ApiCallStartTime\n-| MarshallingLatency             | Timer         | The time taken to marshall the request\n-| ApiCallAttemptCount            | Counter       | Total number of attempts that were made by the service client to fulfill this request before succeeding or failing. (Value is 1 if there are no retries)\n-\n-Each ApiCall can have multiple attempts before the call succeed or fail. The following metrics are collected for each ApiCall Attempt.\n-\n-| Metric Name                    | Meter         | Description      |\n-| ------------------             | -----------   | ---------------- |\n-| ApiCallAttemptStartTime        | Timer         | The start time of each Api call attempt\n-| SigningLatency                 | Timer         | The time taken to sign the request in an Api Call Attempt\n-| HttpRequestRoundTripLatency    | Timer         | The time taken by the underlying http client to start the Api call attempt and return the response\n-| UnmarshallingLatency           | Timer         | The time taken to unmarshall the response (same metric for both successful and failed requests)\n-| ApiCallAttemptEndTime          | Timer         | The end time of a Api call attempt\n-| ApiCallAttemptLatency          | Timer         | The total time taken for an Api call attempt (exclusive of retries), ApiCallAttemptEndTime - ApiCallAttemptStartTime\n-| AwsRequestId                   | ConstantGauge      | The request Id for the request. Represented by `x-amz-request-id` header in response\n-| ExtendedRequestId              | ConstantGauge      | The extended request Id for the request. Represented by `x-amz-id-2` header in response\n-| HttpStatusCode                 | ConstantGauge      | The http status code returned in the response. Null if there is no response\n-| AwsException                   | ConstantGauge      | The Aws exception code returned by the service. This is included for each Api call attempt if the call results in a failure and caused by service\n-| SdkException                   | ConstantGauge      | The error name for any failure that is due to something other than an Aws exception. This is included for each API call attempt if the call results in a failure and is caused by something other than service\n-\n-For each attempt, the following http client metrics are collected:\n-\n-| Metric Name                    | Meter         | Description      |\n-| ------------------             | -----------   | ---------------- |\n-| HttpClientName                 | ConstantGauge      | Name of the underlying http client (Apache, Netty, UrlConnection)\n-| MaxConnections                 | Gauge         | Maximum number of connections allowed in the connection pool\n-| AvailableConnections           | Gauge         | The number of idle connections in the connection pool that are ready to serve a request\n-| LeasedConnections              | Gauge         | The number of connections in the connection pool that are busy serving requests\n-| PendingRequests                | Gauge         | The number of requests awaiting a free connection from the pool\n-\n-## Additional Information collected for each http client (Category: HttpClient)\n-\n-### ApacheHttpClient\n-HttpClientName - Apache\n-\n-No additional metrics available for apache client currently\n-\n-### UrlConnectionHttpClient\n-HttpClientName - UrlConnection\n-\n-No additional metrics available for url connection client currently\n-\n-### NettyNioAsyncHttpClient\n-HttpClientName - Netty\n-\n-| Metric Name                    |    Meter      |    Description   |\n-| ------------------             | -----------   | ---------------- |\n-| FailedConnectionClose          | Counter       | Number of times a connection close has failed\n-| FailedPoolAcquire              | Counter       | Number of times a request failed to acquire a connection\n-\n-For Http2 requests,\n-\n-| Metric Name                    |    Meter      |    Description   |\n-| ------------------             | -----------   | ---------------- |\n-| ConnectionId                   | ConstantGauge      | The identifier for a connection\n-| MaxStreamCount                 | Gauge         | Maximum number of streams allowed on the connection\n-| CurrentStreamCount             | Gauge         | Number of active streams on the connection\n-\n-\n-## Information collected for event stream requests (Category: Default)\n-\n-| Metric Name                    |    Meter      |    Description   |\n-| ------------------             | -----------   | ---------------- |\n-| RequestEventsReceivedCount     | Counter       | Number of events received from the client\n-| RequestEventsSentCount         | Counter       | Number of events sent to the service\n-| ResponseEventsReceivedCount    | Counter       | Number of events received from the service\n-| ResponseEventsDeliveredCount   | Counter       | Number of events delivered to the client\n-| RequestSubscriptionCreated     | Counter       | Number of request subscriptions created to deliver events from client to service (For event stream requests like startStreamTranscription API in Transcribe Streaming service)\n-| RequestSubscriptionCompleted   | Counter       | Number of request subscriptions completed \n-| RequestSubscriptionCanceled    | Counter       | Number of request subscriptions canceled \n-| ResponseSubscriptionCreated    | Counter       | Number of response subscriptions created to deliver events from service to client\n-| ResponseSubscriptionCompleted  | Counter       | Number of response subscriptions completed \n-| ResponseSubscriptionCanceled   | Counter       | Number of response subscriptions canceled \n-\n-\n-## FAQ\n-1) When is the end time calculated for async requests?  \n-   The end time is calculated when the future is completed (either successfully or exceptionally) as opposed to the time when future is returned from API\n-   \n-2) What errors are considered as throttling errors?\n-   The request was considered as throttled if one of the following conditions are met:\n-   1) The http status code is equal to: `429` or `503`\n-   2) The error code is equal to one of the following values:  \n-   SlowDown   \n-   SlowDownException  \n-   Throttling  \n-   ThrottlingException  \n-   Throttled  \n-   ThrottledException  \n-   ServiceUnavailable  \n-   ServiceUnavailableException  \n-   ServiceUnavailableError  \n-   ProvisionedThroughputExceededException  \n-   TooManyRequests  \n-   TooManyRequestsException  \n-   DescribeAttachmentLimitExceeded\n-\n-           \n-## References\n-1) [V1 Metrics Description](https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/metrics/package-summary.html)\n+# Collected Metrics\n+\n+ This document lists the metrics collected by various components of the SDK,\n+ namely the core libraries, and HTTP clients.\n+\n+ A note on collector path: The path is assuming a `MetricCollection` tree rooted at an API call.\n+\n+## Core Metrics\n+\n+The set of core metrics includes all metrics collected by the core components\n+of the SDK. This includes components like SDK service clients,\n+request/resposne marshallers and unmarshallers, and signers.\n+\n+All the in code constants associated with metric below can be found in the\n+[`software.amazon.awssdk.core.metrics.CoreMetric`](https://github.com/aws/aws-sdk-java-v2/blob/8c192e3b04892987bf0872f76ba4f65167f3a872/core/sdk-core/src/main/java/software/amazon/awssdk/core/metrics/CoreMetric.java#L24)\n+class within `sdk-core`.\n+\n+| Name                          | Type          | Description |\n+|-------------------------------|---------------|-------------|\n+| ServiceId                     | `String`      | The unique ID for the service. This is present for all API call metrics.|\n+| OperationName                 | `String`      | The name of the service operation being invoked. This is present for all API call metrics.|\n+| ApiCallDuration               | `Duration`    | The duration of the API call. This includes all call attempts made.|\n+| ApiCallSuccessful             | `Boolean`     | True if the API call succeeded, false otherwise. |\n+| BackoffDelayDuration          | `Duration`    | The duration of time that the SDK has waited before this API call attempt, based on the retry policy. |\n+| MarshallingDuration           | `Duration`    | The duration of time taken to marshall the SDK request to an HTTP request.|\n+| CredentialsFetchDuration      | `Duration`    | The duration of time taken to fetch signing credentials for the request.|\n+| SigningDuration               | `Duration`    | The duration fo time taken to sign the HTTP request.|", "originalCommit": "da2a9a014f8e9792129cab629857f6e77c0d3d64", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTc5Njg5Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1947#discussion_r451796893", "bodyText": "Fixed", "author": "dagnir", "createdAt": "2020-07-08T20:08:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTc4NjUzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTc4NzY2Mg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1947#discussion_r451787662", "bodyText": "The description is the same as the next line, are they the same thing?", "author": "Quanzzzz", "createdAt": "2020-07-08T19:50:04Z", "path": "docs/design/core/metrics/MetricsList.md", "diffHunk": "@@ -1,130 +1,61 @@\n-Here is the detailed list of metrics that SDK can collect. Each metric belongs to a category. If a category is enabled,\n-then all metrics belonging to that category will be collected by the SDK.\n-\n-## Category\n-\n-1) Default - All metrics under this category will be collected when the metrics are enabled\n-2) HttpClient - Additional information collected for http client. The metrics collected for each http client can vary\n-3) All - All metrics collected by the SDK comes under this category. This can be useful for debugging purposes.\n-\n-Note: When metrics feature is enabled, only the `Default` category metrics are collected. Other categories should be\n-explicitly enabled.\n-\n-## Information collected at application level (Category: Default)\n-\n-| Metric Name                    | Meter         | Description      |\n-| ------------------             | -----------   | ---------------- |\n-| RequestCount                   | Counter       | Total number of requests (successful and failed) made from your code to AWS services\n-| SuccessRequestCount            | Counter       | Total number of requests from your code to AWS services that resulted in a successful response\n-| FailedRequestCount             | Counter       | Total number of requests from your code to AWS services that resulted in a failure. This can be expanded later to categorize the failures into buckets (like ClientErrorCount, ServiceErrorCount, ConnectionErrorCount etc)\n-                  \n-## Information collected for each request (ApiCall) (Category: Default)\n-\n-| Metric Name                    | Meter         | Description      |\n-| ------------------             | -----------   | ---------------- |\n-| Service                        | ConstantGauge | Service ID of the AWS service that the API request is made against\n-| Api                            | ConstantGauge | The name of the AWS API the request is made to\n-| StreamingRequest               | ConstantGauge | True if the request has streaming payload\n-| StreamingResponse              | ConstantGauge | True if the response has streaming payload\n-| ApiCallStartTime               | Timer         | The start time of the request\n-| ApiCallEndTime                 | Timer         | The end time of the request\n-| ApiCallLatency                 | Timer         | The total time taken to finish a request (inclusive of all retries), ApiCallEndTime - ApiCallStartTime\n-| MarshallingLatency             | Timer         | The time taken to marshall the request\n-| ApiCallAttemptCount            | Counter       | Total number of attempts that were made by the service client to fulfill this request before succeeding or failing. (Value is 1 if there are no retries)\n-\n-Each ApiCall can have multiple attempts before the call succeed or fail. The following metrics are collected for each ApiCall Attempt.\n-\n-| Metric Name                    | Meter         | Description      |\n-| ------------------             | -----------   | ---------------- |\n-| ApiCallAttemptStartTime        | Timer         | The start time of each Api call attempt\n-| SigningLatency                 | Timer         | The time taken to sign the request in an Api Call Attempt\n-| HttpRequestRoundTripLatency    | Timer         | The time taken by the underlying http client to start the Api call attempt and return the response\n-| UnmarshallingLatency           | Timer         | The time taken to unmarshall the response (same metric for both successful and failed requests)\n-| ApiCallAttemptEndTime          | Timer         | The end time of a Api call attempt\n-| ApiCallAttemptLatency          | Timer         | The total time taken for an Api call attempt (exclusive of retries), ApiCallAttemptEndTime - ApiCallAttemptStartTime\n-| AwsRequestId                   | ConstantGauge      | The request Id for the request. Represented by `x-amz-request-id` header in response\n-| ExtendedRequestId              | ConstantGauge      | The extended request Id for the request. Represented by `x-amz-id-2` header in response\n-| HttpStatusCode                 | ConstantGauge      | The http status code returned in the response. Null if there is no response\n-| AwsException                   | ConstantGauge      | The Aws exception code returned by the service. This is included for each Api call attempt if the call results in a failure and caused by service\n-| SdkException                   | ConstantGauge      | The error name for any failure that is due to something other than an Aws exception. This is included for each API call attempt if the call results in a failure and is caused by something other than service\n-\n-For each attempt, the following http client metrics are collected:\n-\n-| Metric Name                    | Meter         | Description      |\n-| ------------------             | -----------   | ---------------- |\n-| HttpClientName                 | ConstantGauge      | Name of the underlying http client (Apache, Netty, UrlConnection)\n-| MaxConnections                 | Gauge         | Maximum number of connections allowed in the connection pool\n-| AvailableConnections           | Gauge         | The number of idle connections in the connection pool that are ready to serve a request\n-| LeasedConnections              | Gauge         | The number of connections in the connection pool that are busy serving requests\n-| PendingRequests                | Gauge         | The number of requests awaiting a free connection from the pool\n-\n-## Additional Information collected for each http client (Category: HttpClient)\n-\n-### ApacheHttpClient\n-HttpClientName - Apache\n-\n-No additional metrics available for apache client currently\n-\n-### UrlConnectionHttpClient\n-HttpClientName - UrlConnection\n-\n-No additional metrics available for url connection client currently\n-\n-### NettyNioAsyncHttpClient\n-HttpClientName - Netty\n-\n-| Metric Name                    |    Meter      |    Description   |\n-| ------------------             | -----------   | ---------------- |\n-| FailedConnectionClose          | Counter       | Number of times a connection close has failed\n-| FailedPoolAcquire              | Counter       | Number of times a request failed to acquire a connection\n-\n-For Http2 requests,\n-\n-| Metric Name                    |    Meter      |    Description   |\n-| ------------------             | -----------   | ---------------- |\n-| ConnectionId                   | ConstantGauge      | The identifier for a connection\n-| MaxStreamCount                 | Gauge         | Maximum number of streams allowed on the connection\n-| CurrentStreamCount             | Gauge         | Number of active streams on the connection\n-\n-\n-## Information collected for event stream requests (Category: Default)\n-\n-| Metric Name                    |    Meter      |    Description   |\n-| ------------------             | -----------   | ---------------- |\n-| RequestEventsReceivedCount     | Counter       | Number of events received from the client\n-| RequestEventsSentCount         | Counter       | Number of events sent to the service\n-| ResponseEventsReceivedCount    | Counter       | Number of events received from the service\n-| ResponseEventsDeliveredCount   | Counter       | Number of events delivered to the client\n-| RequestSubscriptionCreated     | Counter       | Number of request subscriptions created to deliver events from client to service (For event stream requests like startStreamTranscription API in Transcribe Streaming service)\n-| RequestSubscriptionCompleted   | Counter       | Number of request subscriptions completed \n-| RequestSubscriptionCanceled    | Counter       | Number of request subscriptions canceled \n-| ResponseSubscriptionCreated    | Counter       | Number of response subscriptions created to deliver events from service to client\n-| ResponseSubscriptionCompleted  | Counter       | Number of response subscriptions completed \n-| ResponseSubscriptionCanceled   | Counter       | Number of response subscriptions canceled \n-\n-\n-## FAQ\n-1) When is the end time calculated for async requests?  \n-   The end time is calculated when the future is completed (either successfully or exceptionally) as opposed to the time when future is returned from API\n-   \n-2) What errors are considered as throttling errors?\n-   The request was considered as throttled if one of the following conditions are met:\n-   1) The http status code is equal to: `429` or `503`\n-   2) The error code is equal to one of the following values:  \n-   SlowDown   \n-   SlowDownException  \n-   Throttling  \n-   ThrottlingException  \n-   Throttled  \n-   ThrottledException  \n-   ServiceUnavailable  \n-   ServiceUnavailableException  \n-   ServiceUnavailableError  \n-   ProvisionedThroughputExceededException  \n-   TooManyRequests  \n-   TooManyRequestsException  \n-   DescribeAttachmentLimitExceeded\n-\n-           \n-## References\n-1) [V1 Metrics Description](https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/metrics/package-summary.html)\n+# Collected Metrics\n+\n+ This document lists the metrics collected by various components of the SDK,\n+ namely the core libraries, and HTTP clients.\n+\n+ A note on collector path: The path is assuming a `MetricCollection` tree rooted at an API call.\n+\n+## Core Metrics\n+\n+The set of core metrics includes all metrics collected by the core components\n+of the SDK. This includes components like SDK service clients,\n+request/resposne marshallers and unmarshallers, and signers.\n+\n+All the in code constants associated with metric below can be found in the\n+[`software.amazon.awssdk.core.metrics.CoreMetric`](https://github.com/aws/aws-sdk-java-v2/blob/8c192e3b04892987bf0872f76ba4f65167f3a872/core/sdk-core/src/main/java/software/amazon/awssdk/core/metrics/CoreMetric.java#L24)\n+class within `sdk-core`.\n+\n+| Name                          | Type          | Description |\n+|-------------------------------|---------------|-------------|\n+| ServiceId                     | `String`      | The unique ID for the service. This is present for all API call metrics.|\n+| OperationName                 | `String`      | The name of the service operation being invoked. This is present for all API call metrics.|\n+| ApiCallDuration               | `Duration`    | The duration of the API call. This includes all call attempts made.|\n+| ApiCallSuccessful             | `Boolean`     | True if the API call succeeded, false otherwise. |\n+| BackoffDelayDuration          | `Duration`    | The duration of time that the SDK has waited before this API call attempt, based on the retry policy. |\n+| MarshallingDuration           | `Duration`    | The duration of time taken to marshall the SDK request to an HTTP request.|\n+| CredentialsFetchDuration      | `Duration`    | The duration of time taken to fetch signing credentials for the request.|\n+| SigningDuration               | `Duration`    | The duration fo time taken to sign the HTTP request.|\n+| HttpRequestRoundTripTime      | `Duration`    | The total time take to send a HTTP request and receive the response.|\n+| AwsRequestId                  | `String`      | The extended request ID of the service request.|", "originalCommit": "da2a9a014f8e9792129cab629857f6e77c0d3d64", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTc5NjgzNA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1947#discussion_r451796834", "bodyText": "Nice catch, fixed", "author": "dagnir", "createdAt": "2020-07-08T20:08:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTc4NzY2Mg=="}], "type": "inlineReview"}, {"oid": "adfd711f21f8202f53a45f17f8cb9d04505f9c1d", "url": "https://github.com/aws/aws-sdk-java-v2/commit/adfd711f21f8202f53a45f17f8cb9d04505f9c1d", "message": "Update metrics docs", "committedDate": "2020-07-08T20:07:37Z", "type": "forcePushed"}, {"oid": "9a69284c573d1c524d1d7d0908aa6459d8d2afac", "url": "https://github.com/aws/aws-sdk-java-v2/commit/9a69284c573d1c524d1d7d0908aa6459d8d2afac", "message": "Update metrics docs", "committedDate": "2020-07-08T20:09:21Z", "type": "commit"}, {"oid": "9a69284c573d1c524d1d7d0908aa6459d8d2afac", "url": "https://github.com/aws/aws-sdk-java-v2/commit/9a69284c573d1c524d1d7d0908aa6459d8d2afac", "message": "Update metrics docs", "committedDate": "2020-07-08T20:09:21Z", "type": "forcePushed"}, {"oid": "00d70a5f9bb2b052e80bc363c3a5c2e2be0ab648", "url": "https://github.com/aws/aws-sdk-java-v2/commit/00d70a5f9bb2b052e80bc363c3a5c2e2be0ab648", "message": "Merge branch 'master' into metrics-docs-update", "committedDate": "2020-07-08T20:37:17Z", "type": "commit"}, {"oid": "c989177dcfe9573c830994e335fa4c5f2fc32560", "url": "https://github.com/aws/aws-sdk-java-v2/commit/c989177dcfe9573c830994e335fa4c5f2fc32560", "message": "Merge branch 'master' into metrics-docs-update", "committedDate": "2020-07-08T21:02:35Z", "type": "commit"}]}