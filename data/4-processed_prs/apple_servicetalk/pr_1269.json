{"pr_number": 1269, "pr_title": "Github Actions CI Release Builds", "pr_createdAt": "2020-12-10T22:21:27Z", "pr_url": "https://github.com/apple/servicetalk/pull/1269", "timeline": [{"oid": "51a3802991d2a72c16d850f22075e5c0dbbaf2eb", "url": "https://github.com/apple/servicetalk/commit/51a3802991d2a72c16d850f22075e5c0dbbaf2eb", "message": "Github Actions CI Release Builds", "committedDate": "2020-12-10T22:20:28Z", "type": "commit"}, {"oid": "eddaf6fc6258288364e87d55e9029ecb7db0c27f", "url": "https://github.com/apple/servicetalk/commit/eddaf6fc6258288364e87d55e9029ecb7db0c27f", "message": "remove JDK 8 from test report label", "committedDate": "2020-12-10T22:32:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU0OTkyMg==", "url": "https://github.com/apple/servicetalk/pull/1269#discussion_r540549922", "bodyText": "for 3rd party actions is better to use a commit hash instead of a tag.\ntags are not immutable and a bad actor could change Action code, harvest secrets, etc..", "author": "jerrinot", "createdAt": "2020-12-10T22:39:21Z", "path": ".github/workflows/ci-release.yml", "diffHunk": "@@ -0,0 +1,43 @@\n+name: Release Builder\n+on:\n+  push:\n+    branches: [ main ]\n+    tags:\n+      - \"[0-9]+.[0-9]+.[0-9]+\"\n+jobs:\n+  build-jdk8:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Checkout Code\n+        uses: actions/checkout@v2\n+      - name: Check NO SNAPSHOT version suffix\n+        run: if [[ $(cat gradle.properties | grep version= | sed 's/^version=//') =~ .*-SNAPSHOT ]]; then exit 1; else exit 0; fi\n+      - name: Set up JDK 8\n+        uses: actions/setup-java@v1\n+        with:\n+          java-version: 8\n+      - name: Grant execute permission for gradlew\n+        run: chmod +x gradlew\n+      - name: Cache Gradle packages\n+        uses: actions/cache@v2\n+        with:\n+          path: |\n+            ~/.gradle/caches\n+            ~/.gradle/wrapper\n+          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle') }}\n+          restore-keys: ${{ runner.os }}-gradle\n+      - name: Build with Gradle\n+        env:\n+          ORG_GRADLE_PROJECT_signingKey: ${{ secrets.ORG_GRADLE_PROJECT_SIGNINGKEY }}\n+          ORG_GRADLE_PROJECT_signingPassword: ${{ secrets.ORG_GRADLE_PROJECT_SIGNINGPASSWORD }}\n+          SONATYPE_USER: ${{ secrets.SONATYPE_USER }}\n+          SONATYPE_TOKEN: ${{ secrets.SONATYPE_TOKEN }}\n+          CI: true\n+        run: ./gradlew --parallel --max-workers=4 -PreleaseBuild=true clean check && ./gradlew -PreleaseBuild=true publish\n+      - name: Publish Test Results\n+        if: ${{ always() }}\n+        uses: scacap/action-surefire-report@v1", "originalCommit": "eddaf6fc6258288364e87d55e9029ecb7db0c27f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU1NzQ5MQ==", "url": "https://github.com/apple/servicetalk/pull/1269#discussion_r540557491", "bodyText": "thank @jerrinot! I will submit a followup PR to address this and make it consistent for other actions as well.", "author": "Scottmitch", "createdAt": "2020-12-10T22:54:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU0OTkyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU2ODIwNg==", "url": "https://github.com/apple/servicetalk/pull/1269#discussion_r540568206", "bodyText": "#1271", "author": "Scottmitch", "createdAt": "2020-12-10T23:09:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU0OTkyMg=="}], "type": "inlineReview"}]}