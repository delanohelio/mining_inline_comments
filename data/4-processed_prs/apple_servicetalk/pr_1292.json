{"pr_number": 1292, "pr_title": "DefaultHttpCookiePair#parseCookiePair more strict overflow detection", "pr_createdAt": "2020-12-18T18:08:10Z", "pr_url": "https://github.com/apple/servicetalk/pull/1292", "timeline": [{"oid": "44b4b2f5d7445055c968c5c4cd375bd2be980eb8", "url": "https://github.com/apple/servicetalk/commit/44b4b2f5d7445055c968c5c4cd375bd2be980eb8", "message": "DefaultHttpCookiePair#parseCookiePair more strict overflow detection\n\nMotivation:\nDefaultHttpCookiePair#parseCookiePair doesn't check for overflow when\ncalculating the value starting index.\n\nModifications:\n- Check for overflow when calculating overflow index.\n\nResult:\nMore robust overflow detection in DefaultHttpCookiePair#parseCookiePair.", "committedDate": "2020-12-18T18:06:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjEyNjYyMw==", "url": "https://github.com/apple/servicetalk/pull/1292#discussion_r546126623", "bodyText": "While you are here, can you please make this method private?\nBtw, are the previous two parseCookiePair method have to be public? They currently used only by HeaderUtils, where HeaderUtils#parseCookiePair is also public. If any of these methods have to be public, can we consolidate them all in one place?", "author": "idelpivnitskiy", "createdAt": "2020-12-18T22:48:09Z", "path": "servicetalk-http-api/src/main/java/io/servicetalk/http/api/DefaultHttpCookiePair.java", "diffHunk": "@@ -87,7 +87,7 @@ public static HttpCookiePair parseCookiePair(final CharSequence sequence, int na\n \n     static HttpCookiePair parseCookiePair0(final CharSequence sequence, int nameStart, int nameLength, int valueEnd) {", "originalCommit": "44b4b2f5d7445055c968c5c4cd375bd2be980eb8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjEzMjcwOQ==", "url": "https://github.com/apple/servicetalk/pull/1292#discussion_r546132709", "bodyText": "While you are here, can you please make this method private?\n\ndone.\nI can make both of the parseCookiePair methods package private, they may have been used by the netty packages at some point during development. i'll do this as a followup PR.", "author": "Scottmitch", "createdAt": "2020-12-18T22:59:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjEyNjYyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjE0MzM1MQ==", "url": "https://github.com/apple/servicetalk/pull/1292#discussion_r546143351", "bodyText": "package private PR: #1296", "author": "Scottmitch", "createdAt": "2020-12-18T23:22:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjEyNjYyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjEyNzAyMA==", "url": "https://github.com/apple/servicetalk/pull/1292#discussion_r546127020", "bodyText": "valueStart is always > 0, bcz we do +1", "author": "idelpivnitskiy", "createdAt": "2020-12-18T22:49:28Z", "path": "servicetalk-http-api/src/main/java/io/servicetalk/http/api/DefaultHttpCookiePair.java", "diffHunk": "@@ -87,7 +87,7 @@ public static HttpCookiePair parseCookiePair(final CharSequence sequence, int na\n \n     static HttpCookiePair parseCookiePair0(final CharSequence sequence, int nameStart, int nameLength, int valueEnd) {\n         final int valueStart = nameStart + nameLength + 1;\n-        if (valueEnd - 1 < valueStart) {\n+        if (valueEnd <= valueStart || valueStart < 0) {", "originalCommit": "44b4b2f5d7445055c968c5c4cd375bd2be980eb8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjEyODY2MQ==", "url": "https://github.com/apple/servicetalk/pull/1292#discussion_r546128661", "bodyText": "Ignore the previous comment for now. Only if we validate each input param independently, it will make sense.", "author": "idelpivnitskiy", "createdAt": "2020-12-18T22:53:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjEyNzAyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjEyNzQ1Ng==", "url": "https://github.com/apple/servicetalk/pull/1292#discussion_r546127456", "bodyText": "This exception is a bit confusing and doesn't tell what was wrong with the arguments. Consider validating some passed params independently and thow if any of them are incorrect. For example, if nameStart < 0 or nameLength is not positive.", "author": "idelpivnitskiy", "createdAt": "2020-12-18T22:51:19Z", "path": "servicetalk-http-api/src/main/java/io/servicetalk/http/api/DefaultHttpCookiePair.java", "diffHunk": "@@ -87,7 +87,7 @@ public static HttpCookiePair parseCookiePair(final CharSequence sequence, int na\n \n     static HttpCookiePair parseCookiePair0(final CharSequence sequence, int nameStart, int nameLength, int valueEnd) {\n         final int valueStart = nameStart + nameLength + 1;\n-        if (valueEnd - 1 < valueStart) {\n+        if (valueEnd <= valueStart || valueStart < 0) {\n             throw new IllegalArgumentException(\"unexpected format of cookie pair, empty value\");", "originalCommit": "44b4b2f5d7445055c968c5c4cd375bd2be980eb8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjE0MTYyOA==", "url": "https://github.com/apple/servicetalk/pull/1292#discussion_r546141628", "bodyText": "I'll adjust the exception message to include more context.", "author": "Scottmitch", "createdAt": "2020-12-18T23:16:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjEyNzQ1Ng=="}], "type": "inlineReview"}, {"oid": "2ea45f11f536cfa78fa3b7ba22e1a29a0b9be059", "url": "https://github.com/apple/servicetalk/commit/2ea45f11f536cfa78fa3b7ba22e1a29a0b9be059", "message": "review comments", "committedDate": "2020-12-18T23:16:10Z", "type": "commit"}]}