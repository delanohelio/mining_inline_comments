{"pr_number": 1180, "pr_title": "Verify that all graceful closure use-cases also work with HTTP/2", "pr_createdAt": "2020-10-14T00:41:52Z", "pr_url": "https://github.com/apple/servicetalk/pull/1180", "timeline": [{"oid": "7abaa57e51a46c6bef4adee941147898fd484c24", "url": "https://github.com/apple/servicetalk/commit/7abaa57e51a46c6bef4adee941147898fd484c24", "message": "Verify that all graceful closure use-cases also work with HTTP/2\n\nMotivation:\n\n`GracefulConnectionClosureHandlingTest` provides a comprehensive testing\nfor graceful closure with HTTP/1. We need to make sure, the same cases\nwork correctly when users switch to HTTP/2.\n\nModifications:\n\n- Add `HttpProtocol` parameter for `GracefulConnectionClosureHandlingTest`;\n\nResult:\n\nAll use-cases of `GracefulConnectionClosureHandlingTest` are tested with\nHTTP/1.x and HTTP/2.", "committedDate": "2020-10-14T00:41:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTkxOTU3Ng==", "url": "https://github.com/apple/servicetalk/pull/1180#discussion_r505919576", "bodyText": "this is an unfortunate side effect of error handling being coupled to the close handler. we should consider a followup effort to preserve the exception.", "author": "Scottmitch", "createdAt": "2020-10-15T23:25:56Z", "path": "servicetalk-http-netty/src/test/java/io/servicetalk/http/netty/GracefulConnectionClosureHandlingTest.java", "diffHunk": "@@ -479,6 +497,10 @@ private void assertClosedChannelException(ThrowingRunnable runnable, CloseEvent\n         Exception e = assertThrows(ExecutionException.class, runnable);\n         Throwable cause = e.getCause();\n         assertThat(cause, instanceOf(ClosedChannelException.class));\n+        if (protocol == HTTP_2) {\n+            // HTTP/2 does not enhance ClosedChannelException with CloseEvent", "originalCommit": "7abaa57e51a46c6bef4adee941147898fd484c24", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}