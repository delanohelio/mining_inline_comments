{"pr_number": 1165, "pr_title": "Support half-closure for UnixDomainSockets", "pr_createdAt": "2020-10-02T18:11:39Z", "pr_url": "https://github.com/apple/servicetalk/pull/1165", "timeline": [{"oid": "18112d60a626750806dcdc273e61edc2f618cccb", "url": "https://github.com/apple/servicetalk/commit/18112d60a626750806dcdc273e61edc2f618cccb", "message": "Support half-closure for UnixDomainSockets\n\nMotivation:\n\n`CloseHandler.forPipelinedRequestResponse` enables half-closure only for\n`SocketChannelConfig`. `DomainSocketChannel` does not use this config.\nAs the result, half-closure does not work for UnixDomainSockets.\n\nModifications:\n\n- Use `ALLOW_HALF_CLOSURE` socket option to enable half-closure for the\n`Channel`;\n- Assert in `RequestResponseCloseHandler` that `Channel` implements\n`DuplexChannel` and also has `ALLOW_HALF_CLOSURE` socket option enabled;\n- Enhance `ConnectionCloseHeaderHandlingTest` to test the same scenarios\nfor `DomainSocketAddress`;\n- Move `newSocketAddress()` utility to `AddressUtils`;\n\nResult:\n\nHalf-closure is enabled for `DomainSocketChannel`.", "committedDate": "2020-10-02T18:04:58Z", "type": "commit"}, {"oid": "18fede06bf60ac2003fc2156d1debb6d18a163da", "url": "https://github.com/apple/servicetalk/commit/18fede06bf60ac2003fc2156d1debb6d18a163da", "message": "Temporary disable test cases that require \"discarding inbound\" instead of \"half-close inbound\"\n\nFor more information, see https://github.com/apple/servicetalk/issues/1154\n\"half-close inbound\" is harmful for UDS, bcz it breaks the pipe", "committedDate": "2020-10-02T19:56:54Z", "type": "commit"}, {"oid": "2ea245fec562b593518b0478b32d99caf22231d3", "url": "https://github.com/apple/servicetalk/commit/2ea245fec562b593518b0478b32d99caf22231d3", "message": "Fix RequestResponseCloseHandlerTest", "committedDate": "2020-10-02T21:37:45Z", "type": "commit"}, {"oid": "9791048b706aa23f5eb8c2d7ea72483ec78374f6", "url": "https://github.com/apple/servicetalk/commit/9791048b706aa23f5eb8c2d7ea72483ec78374f6", "message": "fix spotbugs warning", "committedDate": "2020-10-02T22:42:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA3ODMwOA==", "url": "https://github.com/apple/servicetalk/pull/1165#discussion_r499078308", "bodyText": "can we revert this portion now that we have the @Ignore?", "author": "Scottmitch", "createdAt": "2020-10-02T22:42:08Z", "path": "servicetalk-http-netty/src/test/java/io/servicetalk/http/netty/ConnectionCloseHeaderHandlingTest.java", "diffHunk": "@@ -338,14 +359,13 @@ public void serverCloseTwoPipelinedRequestsSentBeforeFirstResponse() throws Exce\n             assertResponsePayloadBody(response);\n \n             awaitConnectionClosed();\n-            // FIXME: temporary disable check for /second until https://github.com/apple/servicetalk/pull/1141", "originalCommit": "2ea245fec562b593518b0478b32d99caf22231d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA3ODM3MQ==", "url": "https://github.com/apple/servicetalk/pull/1165#discussion_r499078371", "bodyText": "(same comment below)", "author": "Scottmitch", "createdAt": "2020-10-02T22:42:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA3ODMwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5ODc0Ng==", "url": "https://github.com/apple/servicetalk/pull/1165#discussion_r499098746", "bodyText": "Originally, I thought only the last check is causing the issue. But actually, the response payload body for the first request may also fail.\nDecided to uncomment specific assertions and ignore the whole test instead until we have #1141.", "author": "idelpivnitskiy", "createdAt": "2020-10-03T00:42:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA3ODMwOA=="}], "type": "inlineReview"}]}