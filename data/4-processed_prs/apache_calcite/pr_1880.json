{"pr_number": 1880, "pr_title": "Make ubenchmark clases executable from IDEA", "pr_createdAt": "2020-03-27T10:45:15Z", "pr_url": "https://github.com/apache/calcite/pull/1880", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM1NjAyOQ==", "url": "https://github.com/apache/calcite/pull/1880#discussion_r399356029", "bodyText": "I merge the update to my local branch, I am afraid we should add one more to make it work.\nclasspath(File(buildDir, \"jmh-generated-sources\"))", "author": "neoremind", "createdAt": "2020-03-27T15:39:45Z", "path": "ubenchmark/build.gradle.kts", "diffHunk": "@@ -22,12 +22,29 @@ dependencies {\n     // Make jmhCompileClasspath resolvable\n     @Suppress(\"DEPRECATION\")\n     jmhCompileClasspath(platform(project(\":bom\")))\n-    jmh(project(\":core\"))\n-    jmh(project(\":linq4j\"))\n-    jmh(\"com.google.guava:guava\")\n-    jmh(\"org.codehaus.janino:commons-compiler\")\n-    jmh(\"org.openjdk.jmh:jmh-core\")\n-    jmh(\"org.openjdk.jmh:jmh-generator-annprocess\")\n+    jmhImplementation(project(\":core\"))\n+    jmhImplementation(project(\":linq4j\"))\n+    jmhImplementation(\"com.google.guava:guava\")\n+    jmhImplementation(\"org.codehaus.janino:commons-compiler\")\n+    jmhImplementation(\"org.openjdk.jmh:jmh-core\")\n+    jmhImplementation(\"org.openjdk.jmh:jmh-generator-annprocess\")\n }\n \n // See https://github.com/melix/jmh-gradle-plugin\n+// Unfortunately, current jmh-gradle-plugin does not allow to cusomize jmh parameters from the\n+// command line, so the workarounds are:\n+// a) Build and execute the jar itself: ./gradlew jmhJar && java -jar build/libs/calcite-...jar JMH_OPTIONS\n+// b) Execute benchmarks via .main() methods from IDE (you might want to activate \"power save mode\"\n+//    in the IDE to minimize the impact of the IDE itself on the benchmark results)\n+\n+tasks.withType<JavaExec>().configureEach {\n+    // Execution of .main methods from IDEA should re-generate benchmark classes if required\n+    dependsOn(\"jmhCompileGeneratedClasses\")\n+    doFirst {\n+        // At best jmh plugin should add the generated directories to the Gradle model, however,\n+        // currently it builds the jar only :-/\n+        // IntelliJ IDEA \"execute main method\" adds a JavaExec task, so we configure it\n+        classpath(File(buildDir, \"jmh-generated-classes\"))\n+        classpath(File(buildDir, \"jmh-generated-resources\"))", "originalCommit": "abb34080b0ea79917cb3a930baae52ae773c7acc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM1NzAzMA==", "url": "https://github.com/apache/calcite/pull/1880#discussion_r399357030", "bodyText": "Why is that?\nWhat is the error message otherwise?", "author": "vlsi", "createdAt": "2020-03-27T15:41:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM1NjAyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM2MTExNQ==", "url": "https://github.com/apache/calcite/pull/1880#discussion_r399361115", "bodyText": "Would you try creating a new test or renaming test method? Maybe you can reproduce the exception as below.\nSorry about the Chinese character. Literally, it means Error: Symbol not found\n/Users/xu/IdeaProjects/my-calcite/ubenchmark/build/jmh-generated-sources/org/apache/calcite/benchmarks/generated/ReflectiveVisitDispatcherTest_testReflectiveVisitorDispatcherInvokeInstanceCachingUseMethodHandle_jmhTest.java:78: \u9519\u8bef: \u627e\u4e0d\u5230\u7b26\u53f7\n                blackhole.consume(l_reflectivevisitdispatchertest0_G.testReflectiveVisitorDispatcherInvokeInstanceCachingUseMethodHandle());\n                                                                    ^\n  \u7b26\u53f7:   \u65b9\u6cd5 testReflectiveVisitorDispatcherInvokeInstanceCachingUseMethodHandle()\n  \u4f4d\u7f6e: \u7c7b\u578b\u4e3aReflectiveVisitDispatcherTest_jmhType\u7684\u53d8\u91cf l_reflectivevisitdispatchertest0_G", "author": "neoremind", "createdAt": "2020-03-27T15:47:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM1NjAyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYzMzYxOA==", "url": "https://github.com/apache/calcite/pull/1880#discussion_r399633618", "bodyText": "@vlsi I might mislead you, maybe that is my env problem. No rush to look into this, unless any one else comes into this trouble again.\nMy idea version is the latest community one.\nIntelliJ IDEA 2019.3.3 (Community Edition)\nBuild #IC-193.6494.35, built on February 11, 2020\nRuntime version: 11.0.5+10-b520.38 x86_64\nVM: OpenJDK 64-Bit Server VM by JetBrains s.r.o\nmacOS 10.12.6\nGC: ParNew, ConcurrentMarkSweep\nMemory: 1981M\nCores: 8\nRegistry: \nNon-Bundled Plugins: CheckStyle-IDEA, FindBugs-IDEA, Lombook Plugin, OdpsStudio, com.alibaba.p3c.smartfox, com.poratu.idea.plugins.tomcat, org.intellij.scala", "author": "neoremind", "createdAt": "2020-03-28T07:54:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM1NjAyOQ=="}], "type": "inlineReview"}, {"oid": "c9acc5bb03983915084557ac75afeb2866074d90", "url": "https://github.com/apache/calcite/commit/c9acc5bb03983915084557ac75afeb2866074d90", "message": "Make ubenchmark clases executable from IDEA", "committedDate": "2020-04-10T06:56:57Z", "type": "commit"}, {"oid": "c9acc5bb03983915084557ac75afeb2866074d90", "url": "https://github.com/apache/calcite/commit/c9acc5bb03983915084557ac75afeb2866074d90", "message": "Make ubenchmark clases executable from IDEA", "committedDate": "2020-04-10T06:56:57Z", "type": "forcePushed"}]}