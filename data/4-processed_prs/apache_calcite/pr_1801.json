{"pr_number": 1801, "pr_title": "[CALCITE-3791] HepPlanner does not clear metadata cache for the ancestors of discarded node when a transformation happens", "pr_createdAt": "2020-02-13T06:45:01Z", "pr_url": "https://github.com/apache/calcite/pull/1801", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODgzNDk3OQ==", "url": "https://github.com/apache/calcite/pull/1801#discussion_r378834979", "bodyText": "parents -> ancestors?", "author": "liyafan82", "createdAt": "2020-02-13T12:39:53Z", "path": "core/src/main/java/org/apache/calcite/plan/hep/HepPlanner.java", "diffHunk": "@@ -888,6 +890,28 @@ private void contractVertices(\n     }\n   }\n \n+  /**\n+   * Clears metadata cache for the RelNode and its parents.", "originalCommit": "99cad83687c39e088c953ef8a44c6ea4d4e78ea7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIxODY2NQ==", "url": "https://github.com/apache/calcite/pull/1801#discussion_r379218665", "bodyText": "Will do.", "author": "chunweilei", "createdAt": "2020-02-14T02:06:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODgzNDk3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODgzODUzMA==", "url": "https://github.com/apache/calcite/pull/1801#discussion_r378838530", "bodyText": "I am not sure what is the standard procedure of changing a public API.", "author": "liyafan82", "createdAt": "2020-02-13T12:47:30Z", "path": "core/src/main/java/org/apache/calcite/rel/metadata/RelMdUtil.java", "diffHunk": "@@ -943,9 +943,9 @@ private static boolean isNonNegative(Double result, boolean fail) {\n    * Removes cached metadata values for specified RelNode.\n    *\n    * @param rel RelNode whose cached metadata should be removed\n+   * @return true if cache for the provided RelNode was not empty\n    */\n-  public static void clearCache(RelNode rel) {\n-    rel.getCluster().getMetadataQuery().clearCache(rel);\n+  public static boolean clearCache(RelNode rel) {", "originalCommit": "99cad83687c39e088c953ef8a44c6ea4d4e78ea7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE4MTY0OA==", "url": "https://github.com/apache/calcite/pull/1801#discussion_r379181648", "bodyText": "I think void to boolean is fine.", "author": "hsyuan", "createdAt": "2020-02-13T23:44:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODgzODUzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIxODgwMQ==", "url": "https://github.com/apache/calcite/pull/1801#discussion_r379218801", "bodyText": "Agree with @hsyuan . It will not break anything.", "author": "chunweilei", "createdAt": "2020-02-14T02:07:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODgzODUzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIyMTU1Ng==", "url": "https://github.com/apache/calcite/pull/1801#discussion_r379221556", "bodyText": "Thanks a lot for your clarification.", "author": "liyafan82", "createdAt": "2020-02-14T02:20:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODgzODUzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ3MTQzNw==", "url": "https://github.com/apache/calcite/pull/1801#discussion_r379471437", "bodyText": "I'm wondering how to give a valid test, e.g. even though we clear the cache that should not do, the tests still passes.", "author": "danny0405", "createdAt": "2020-02-14T14:52:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODgzODUzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ3OTY1Mg==", "url": "https://github.com/apache/calcite/pull/1801#discussion_r379479652", "bodyText": "I tried to add a test case. But it is really difficult. We can see the problem is just there.", "author": "chunweilei", "createdAt": "2020-02-14T15:06:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODgzODUzMA=="}], "type": "inlineReview"}, {"oid": "b1e15d33783a38a8d896fe8203c68f61d5dbeca4", "url": "https://github.com/apache/calcite/commit/b1e15d33783a38a8d896fe8203c68f61d5dbeca4", "message": "[CALCITE-3791] HepPlanner does not clear metadata cache for the ancestors of discarded node when a transformation happens", "committedDate": "2020-02-14T08:11:53Z", "type": "commit"}, {"oid": "b1e15d33783a38a8d896fe8203c68f61d5dbeca4", "url": "https://github.com/apache/calcite/commit/b1e15d33783a38a8d896fe8203c68f61d5dbeca4", "message": "[CALCITE-3791] HepPlanner does not clear metadata cache for the ancestors of discarded node when a transformation happens", "committedDate": "2020-02-14T08:11:53Z", "type": "forcePushed"}]}