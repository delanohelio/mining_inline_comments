{"pr_number": 2143, "pr_title": "[CALCITE-4224] Add an method for RelNode to output its tree digest like RelOptUtil.toString (Jiatao Tao)", "pr_createdAt": "2020-09-09T03:39:53Z", "pr_url": "https://github.com/apache/calcite/pull/2143", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQzMTQzNA==", "url": "https://github.com/apache/calcite/pull/2143#discussion_r485431434", "bodyText": "The new method should have a javadoc", "author": "rubenada", "createdAt": "2020-09-09T08:27:49Z", "path": "core/src/main/java/org/apache/calcite/rel/RelNode.java", "diffHunk": "@@ -246,6 +246,8 @@ default String getDigest() {\n     return getRelDigest().toString();\n   }\n \n+  String getTreeDigest();", "originalCommit": "ba7e1465893f129ac1933aea539d4a295afa8216", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjEwMzg5NQ==", "url": "https://github.com/apache/calcite/pull/2143#discussion_r486103895", "bodyText": "Revised, really sorry for forgetting this.", "author": "Aaaaaaron", "createdAt": "2020-09-10T06:49:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQzMTQzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ0MjU3MA==", "url": "https://github.com/apache/calcite/pull/2143#discussion_r485442570", "bodyText": "This is what I meant that is not very neat; adding a new API in RelNode just for debugging purposes.\nNevertheless if we decide to go this way I think it would be better to use the following signature:\nString explain();\nGoing one step further we could make it a default method with an implementation similar to the one below:\ndefault String explain() {\n    StringWriter sw = new StringWriter();\n    RelWriter planWriter =\n        new RelWriterImpl(\n            new PrintWriter(sw), SqlExplainLevel.EXPPLAN_ATTRIBUTES, false);\n    explain(planWriter);\n    return sw.toString();\n}\n\nEven more we could deprecate/remove RelOptUtil#toString(RelNode) variants in favor of this one.", "author": "zabetak", "createdAt": "2020-09-09T08:44:22Z", "path": "core/src/main/java/org/apache/calcite/rel/RelNode.java", "diffHunk": "@@ -246,6 +246,8 @@ default String getDigest() {\n     return getRelDigest().toString();\n   }\n \n+  String getTreeDigest();", "originalCommit": "ba7e1465893f129ac1933aea539d4a295afa8216", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ1NzU1MQ==", "url": "https://github.com/apache/calcite/pull/2143#discussion_r485457551", "bodyText": "@zabetak +1\nI also think it makes sense to deprecate/remove RelOptUtil#toString(RelNode) since there is also a similar (more \"powerful\") method that covers that functionality: RelOptUtil#dumpPlan.\nWe could even consider to use it in the default implementation of the new method for the sake of code re-usability:\ndefault String explain() {\n    return RelOptUtil.dumpPlan(\"\", this, SqlExplainFormat.TEXT, SqlExplainLevel.EXPPLAN_ATTRIBUTES);\n}", "author": "rubenada", "createdAt": "2020-09-09T09:06:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ0MjU3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjEwNTE0MQ==", "url": "https://github.com/apache/calcite/pull/2143#discussion_r486105141", "bodyText": "Hi fellows\nI've updated my code, would you please take a look?\nHi @zabetak Julian commented in the JIRA: \"The implementation should continue to live in RelOptUtil or wherever\", so I just call RelOptUtil.toString directly.\nHi @rubenada \"RelOptUtil.dumpPlan(\"\", this, SqlExplainFormat.TEXT, SqlExplainLevel.EXPPLAN_ATTRIBUTES)\"'s output seems the same with RelOptUtil.toString.", "author": "Aaaaaaron", "createdAt": "2020-09-10T06:51:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ0MjU3MA=="}], "type": "inlineReview"}, {"oid": "9dc2a849def6027fc63039f057cb7585836d6fca", "url": "https://github.com/apache/calcite/commit/9dc2a849def6027fc63039f057cb7585836d6fca", "message": "[CALCITE-4224] Add a method for RelNode to output its relational expression string (Jiatao Tao)", "committedDate": "2020-09-10T06:37:44Z", "type": "forcePushed"}, {"oid": "3fe1a6bc49998e533e16645932cedc2db3ee90e5", "url": "https://github.com/apache/calcite/commit/3fe1a6bc49998e533e16645932cedc2db3ee90e5", "message": "[CALCITE-4224] Add a method for RelNode to output its relational expression string (Jiatao Tao)", "committedDate": "2020-09-11T02:38:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0ODIxMA==", "url": "https://github.com/apache/calcite/pull/2143#discussion_r486848210", "bodyText": "nitpicking: I think this new method should go together (e.g. right after) with void explain(RelWriter pw);\nAlso, since RelNode is an interface (and not an abstract class), IMHO javadoc should not say \"sub-classes\", but instead something along the lines: \"We recommend that classes implementing this interface do not override this method\"", "author": "rubenada", "createdAt": "2020-09-11T08:10:37Z", "path": "core/src/main/java/org/apache/calcite/rel/RelNode.java", "diffHunk": "@@ -232,6 +233,21 @@\n    */\n   RelNode onRegister(RelOptPlanner planner);\n \n+  /**\n+   * Returns a relational expression string of this {@code RelNode}.\n+   * The string returned is the same as\n+   * {@link RelOptUtil#toString(org.apache.calcite.rel.RelNode)}.\n+   *\n+   * This method is intended mainly for use while debugging in an IDE,\n+   * as a convenient short-hand for RelOptUtil.toString.\n+   * We recommend that sub-classes do not override this method.\n+   *\n+   * @return Relational expression string of this {@code RelNode}\n+   */\n+  default String explain() {", "originalCommit": "3fe1a6bc49998e533e16645932cedc2db3ee90e5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NzY4MA==", "url": "https://github.com/apache/calcite/pull/2143#discussion_r487387680", "bodyText": "@rubenada Thanks for your advice, indeed better!", "author": "Aaaaaaron", "createdAt": "2020-09-12T08:57:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0ODIxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4ODAwOQ==", "url": "https://github.com/apache/calcite/pull/2143#discussion_r487388009", "bodyText": "revised", "author": "Aaaaaaron", "createdAt": "2020-09-12T09:01:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0ODIxMA=="}], "type": "inlineReview"}, {"oid": "c49a509c5917bfdacda11c7ebb2375b80f54321d", "url": "https://github.com/apache/calcite/commit/c49a509c5917bfdacda11c7ebb2375b80f54321d", "message": "[CALCITE-4224] Add a method for RelNode to output its relational expression string (Jiatao Tao)", "committedDate": "2020-09-12T09:00:58Z", "type": "commit"}, {"oid": "c49a509c5917bfdacda11c7ebb2375b80f54321d", "url": "https://github.com/apache/calcite/commit/c49a509c5917bfdacda11c7ebb2375b80f54321d", "message": "[CALCITE-4224] Add a method for RelNode to output its relational expression string (Jiatao Tao)", "committedDate": "2020-09-12T09:00:58Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2ODEwMQ==", "url": "https://github.com/apache/calcite/pull/2143#discussion_r487468101", "bodyText": "What is the difference between using RelOptUtil.toString and RelOptUtil#dumpPlan here?", "author": "amaliujia", "createdAt": "2020-09-13T01:39:01Z", "path": "core/src/main/java/org/apache/calcite/rel/RelNode.java", "diffHunk": "@@ -222,6 +223,22 @@\n    */\n   void explain(RelWriter pw);\n \n+  /**\n+   * Returns a relational expression string of this {@code RelNode}.\n+   * The string returned is the same as\n+   * {@link RelOptUtil#toString(org.apache.calcite.rel.RelNode)}.\n+   *\n+   * This method is intended mainly for use while debugging in an IDE,\n+   * as a convenient short-hand for RelOptUtil.toString.\n+   * We recommend that classes implementing this interface\n+   * do not override this method.\n+   *\n+   * @return Relational expression string of this {@code RelNode}\n+   */\n+  default String explain() {\n+    return RelOptUtil.toString(this);", "originalCommit": "c49a509c5917bfdacda11c7ebb2375b80f54321d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYyMjIwNQ==", "url": "https://github.com/apache/calcite/pull/2143#discussion_r487622205", "bodyText": "RelOptUtil#dumpPlan can dump other formats like XML/JSON, we don't need this here.", "author": "Aaaaaaron", "createdAt": "2020-09-14T02:39:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2ODEwMQ=="}], "type": "inlineReview"}]}