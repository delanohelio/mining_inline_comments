{"pr_number": 1714, "pr_title": "[Calcite 3663] Support for TRIM function in BigQuery dialect", "pr_createdAt": "2020-01-02T07:55:28Z", "pr_url": "https://github.com/apache/calcite/pull/1714", "timeline": [{"oid": "371c648a93c874dd21d2670123eb560afd2aab0f", "url": "https://github.com/apache/calcite/commit/371c648a93c874dd21d2670123eb560afd2aab0f", "message": "Perform indentation for testcase and BQ", "committedDate": "2020-01-02T09:22:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU3OTIyNw==", "url": "https://github.com/apache/calcite/pull/1714#discussion_r362579227", "bodyText": "Also need to validate the second operand?", "author": "amaliujia", "createdAt": "2020-01-02T18:34:04Z", "path": "core/src/main/java/org/apache/calcite/sql/dialect/BigQuerySqlDialect.java", "diffHunk": "@@ -192,6 +197,37 @@ public BigQuerySqlDialect(SqlDialect.Context context) {\n     }\n   }\n \n+  /**\n+   * For usage of TRIM, LTRIM and RTRIM in BQ see\n+   * <a href=\"https://cloud.google.com/bigquery/docs/reference/standard-sql/functions-and-operators#trim\">\n+   *  BQ Trim Function</a>.\n+   */\n+  private void unparseTrim(SqlWriter writer, SqlCall call, int leftPrec,\n+      int rightPrec) {\n+    assert call.operand(0) instanceof SqlLiteral : call.operand(0);", "originalCommit": "371c648a93c874dd21d2670123eb560afd2aab0f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjg0NjQ1MA==", "url": "https://github.com/apache/calcite/pull/1714#discussion_r362846450", "bodyText": "Removed this assert as the operands type check is already done in SqlTrimFunction class", "author": "dhirenda-gautam", "createdAt": "2020-01-03T15:20:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU3OTIyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU4MDQzNw==", "url": "https://github.com/apache/calcite/pull/1714#discussion_r362580437", "bodyText": "As you can see there is a comment about this test case which is hive related. So you can also add comments for BQ.\nYou can either add another comment for BQ, or split this test case to hive and BQ and then add comments seperately.", "author": "amaliujia", "createdAt": "2020-01-02T18:37:46Z", "path": "core/src/test/java/org/apache/calcite/rel/rel2sql/RelToSqlConverterTest.java", "diffHunk": "@@ -958,36 +958,82 @@ private static String toSql(RelNode root, SqlDialect dialect) {\n    * <a href=\"https://issues.apache.org/jira/browse/CALCITE-3220\">[CALCITE-3220]\n    * HiveSqlDialect should transform the SQL-standard TRIM function to TRIM,\n    * LTRIM or RTRIM</a>. */\n-  @Test public void testHiveTrim() {\n+  @Test public void testHiveAndBqTrim() {", "originalCommit": "371c648a93c874dd21d2670123eb560afd2aab0f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgzNjg2MQ==", "url": "https://github.com/apache/calcite/pull/1714#discussion_r362836861", "bodyText": "Added the comment for the BQ test cases along with JIRA Id", "author": "dhirenda-gautam", "createdAt": "2020-01-03T14:55:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU4MDQzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5OTMwMg==", "url": "https://github.com/apache/calcite/pull/1714#discussion_r362699302", "bodyText": "This if logic is different with that of HiveSqlDialect. Could you add doc for it?", "author": "DonnyZone", "createdAt": "2020-01-03T03:38:26Z", "path": "core/src/main/java/org/apache/calcite/sql/dialect/BigQuerySqlDialect.java", "diffHunk": "@@ -192,6 +197,37 @@ public BigQuerySqlDialect(SqlDialect.Context context) {\n     }\n   }\n \n+  /**\n+   * For usage of TRIM, LTRIM and RTRIM in BQ see\n+   * <a href=\"https://cloud.google.com/bigquery/docs/reference/standard-sql/functions-and-operators#trim\">\n+   *  BQ Trim Function</a>.\n+   */\n+  private void unparseTrim(SqlWriter writer, SqlCall call, int leftPrec,\n+      int rightPrec) {\n+    assert call.operand(0) instanceof SqlLiteral : call.operand(0);\n+    final String operatorName;\n+    SqlLiteral trimFlag = call.operand(0);\n+    SqlLiteral valueToTrim = call.operand(1);\n+    switch (trimFlag.getValueAs(SqlTrimFunction.Flag.class)) {\n+    case LEADING:\n+      operatorName = \"LTRIM\";\n+      break;\n+    case TRAILING:\n+      operatorName = \"RTRIM\";\n+      break;\n+    default:\n+      operatorName = call.getOperator().getName();\n+      break;\n+    }\n+    final SqlWriter.Frame trimFrame = writer.startFunCall(operatorName);\n+    call.operand(2).unparse(writer, leftPrec, rightPrec);\n+    if (!valueToTrim.toValue().matches(\"\\\\s+\")) {", "originalCommit": "371c648a93c874dd21d2670123eb560afd2aab0f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgzNjkxNw==", "url": "https://github.com/apache/calcite/pull/1714#discussion_r362836917", "bodyText": "Added the doc which specify the purpose of the if block", "author": "dhirenda-gautam", "createdAt": "2020-01-03T14:55:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5OTMwMg=="}], "type": "inlineReview"}, {"oid": "294000ddbb5ad6560f23ea2f681b75a6b11723b4", "url": "https://github.com/apache/calcite/commit/294000ddbb5ad6560f23ea2f681b75a6b11723b4", "message": "Removed the assertion check and added the Doc for the trim handling with char", "committedDate": "2020-01-03T14:57:07Z", "type": "forcePushed"}, {"oid": "37341f2b59ae329b61dee0ce72f52a2a00c97319", "url": "https://github.com/apache/calcite/commit/37341f2b59ae329b61dee0ce72f52a2a00c97319", "message": "[Calcite 3663] Support for TRIM function in BigQuery", "committedDate": "2020-01-06T11:04:36Z", "type": "forcePushed"}, {"oid": "3235e6191fc105ba1b30afdbd3bde072f19899f7", "url": "https://github.com/apache/calcite/commit/3235e6191fc105ba1b30afdbd3bde072f19899f7", "message": "[CALCITE-3663] Support for TRIM function in BigQuery Dialect", "committedDate": "2020-01-07T05:37:32Z", "type": "forcePushed"}, {"oid": "f6b939dc91b1daadb366a6d8bebcdc743d156dc2", "url": "https://github.com/apache/calcite/commit/f6b939dc91b1daadb366a6d8bebcdc743d156dc2", "message": "[CALCITE-3663] Support for TRIM function in BigQuery Dialect", "committedDate": "2020-01-07T14:11:09Z", "type": "commit"}, {"oid": "f6b939dc91b1daadb366a6d8bebcdc743d156dc2", "url": "https://github.com/apache/calcite/commit/f6b939dc91b1daadb366a6d8bebcdc743d156dc2", "message": "[CALCITE-3663] Support for TRIM function in BigQuery Dialect", "committedDate": "2020-01-07T14:11:09Z", "type": "forcePushed"}]}