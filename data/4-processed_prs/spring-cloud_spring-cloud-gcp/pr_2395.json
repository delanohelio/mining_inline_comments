{"pr_number": 2395, "pr_title": "Updates GAE samples and juggles some plugin bits", "pr_createdAt": "2020-05-28T14:01:05Z", "pr_url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2395", "timeline": [{"oid": "5b637f8ff48a3abecf33a84e6b404c528d92da86", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/5b637f8ff48a3abecf33a84e6b404c528d92da86", "message": "samples: Updates GAE Flex samples to GAE Standard w Java 11", "committedDate": "2020-05-28T16:18:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA0NDg1OA==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2395#discussion_r432044858", "bodyText": "What was the reason for adding this? Was there a build issue or something?", "author": "dzou", "createdAt": "2020-05-28T18:42:46Z", "path": "spring-cloud-gcp-samples/spring-cloud-gcp-pubsub-stream-binder-functional-sample/spring-cloud-gcp-pubsub-stream-binder-functional-sample-test/pom.xml", "diffHunk": "@@ -48,5 +48,16 @@\n \n   </dependencies>\n \n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>org.springframework.boot</groupId>\n+        <artifactId>spring-boot-maven-plugin</artifactId>\n+        <configuration>\n+          <skip>true</skip>", "originalCommit": "5b637f8ff48a3abecf33a84e6b404c528d92da86", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA2NjM3Nw==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2395#discussion_r432066377", "bodyText": "Yeah - since this module only has a src/test folder, the spring-boot-maven-plugin complained it couldn't find a Main class.", "author": "ttomsu", "createdAt": "2020-05-28T19:22:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA0NDg1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA4Mzk1MA==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2395#discussion_r432083950", "bodyText": "Gotcha I see.", "author": "dzou", "createdAt": "2020-05-28T19:52:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA0NDg1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjEwNDA0NQ==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2395#discussion_r432104045", "bodyText": "I pulled this one level up, because I think that build error was caused by the JAR not looking right after being repackaged.", "author": "ttomsu", "createdAt": "2020-05-28T20:27:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA0NDg1OA=="}], "type": "inlineReview"}, {"oid": "7c79832f8b985621c746aab5ace1256d3df3d530", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/7c79832f8b985621c746aab5ace1256d3df3d530", "message": "samples: Updates GAE Flex samples to GAE Standard w Java 11", "committedDate": "2020-05-28T20:26:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI0NTQzMg==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2395#discussion_r432245432", "bodyText": "I believe this was necessary to skip publishing the module when the Spring Team runs mvn deploy. The default of the plugin is to not skip.", "author": "meltsufin", "createdAt": "2020-05-29T04:10:23Z", "path": "spring-cloud-gcp-samples/pom.xml", "diffHunk": "@@ -116,12 +117,20 @@\n \t</profiles>\n \n \t<build>\n+\t\t<pluginManagement>\n+\t\t\t<plugins>\n+\t\t\t\t<plugin>\n+\t\t\t\t\t<groupId>com.google.cloud.tools</groupId>\n+\t\t\t\t\t<artifactId>appengine-maven-plugin</artifactId>\n+\t\t\t\t\t<version>${app-engine-maven-plugin.version}</version>\n+\t\t\t\t</plugin>\n+\t\t\t</plugins>\n+\t\t</pluginManagement>\n \t\t<plugins>\n \t\t\t<plugin>\n-\t\t\t\t<artifactId>maven-deploy-plugin</artifactId>\n-\t\t\t\t<configuration>\n-\t\t\t\t\t<skip>true</skip>", "originalCommit": "7c79832f8b985621c746aab5ace1256d3df3d530", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ0NDI2OQ==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2395#discussion_r432444269", "bodyText": "I went looking for the deploy plugin up the chain of POMs - maybe I'm confused and it's just built-in? In that case, yes, I need to add this back in at the spring-cloud-gcp-samples/pom.xml, but I think then, it would cascade down and all the samples would not need it, correct?", "author": "ttomsu", "createdAt": "2020-05-29T12:18:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI0NTQzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjU3MzUzNg==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2395#discussion_r432573536", "bodyText": "It is built in, but I don't know about cascading.", "author": "meltsufin", "createdAt": "2020-05-29T15:45:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI0NTQzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI0NTYxNA==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2395#discussion_r432245614", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Deploy to Google AppEngine:\n          \n          \n            \n            Deploy to App Engine:", "author": "meltsufin", "createdAt": "2020-05-29T04:11:16Z", "path": "spring-cloud-gcp-samples/spring-cloud-gcp-logging-sample/README.adoc", "diffHunk": "@@ -25,9 +25,17 @@ $ curl --header \"x-cloud-trace-context: [Some-Trace-ID]\" localhost:8080/log\n To see the logged lines, navigate to the https://console.cloud.google.com/logs/viewer[Logging section of the Cloud Console].\n Select the `Global` resource and look under the `spring.log` channel to see the logged text.\n \n+=== Running on Google Cloud Platform\n+\n+Deploy to Google AppEngine:", "originalCommit": "7c79832f8b985621c746aab5ace1256d3df3d530", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI0NjQzNg==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2395#discussion_r432246436", "bodyText": "What's the purpose of clean here?\nAlso, why do we have to specify project and version? I thought those were optional.", "author": "meltsufin", "createdAt": "2020-05-29T04:15:02Z", "path": "spring-cloud-gcp-samples/spring-cloud-gcp-logging-sample/README.adoc", "diffHunk": "@@ -25,9 +25,17 @@ $ curl --header \"x-cloud-trace-context: [Some-Trace-ID]\" localhost:8080/log\n To see the logged lines, navigate to the https://console.cloud.google.com/logs/viewer[Logging section of the Cloud Console].\n Select the `Global` resource and look under the `spring.log` channel to see the logged text.\n \n+=== Running on Google Cloud Platform\n+\n+Deploy to Google AppEngine:\n+\n+----\n+$ mvn clean package appengine:deploy -Dapp.deploy.projectId=$PROJECT_ID -Dapp.deploy.version=$VERSION", "originalCommit": "7c79832f8b985621c746aab5ace1256d3df3d530", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ0NzI1Mg==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2395#discussion_r432447252", "bodyText": "clean wipes out anything prebuilt in the target folder - more just to ensure you're really deploying what you think you're deploying. It's not entirely necessary but doesn't hurt anything either.\nThe new 2.2.0 plugin requires both the project ID and version to be specified in the config or passed via -Dapp.deploy.[projectId | version] - you get errors without it. I figured it was easier to do this in the command line vs an instruction on setting it in the config.", "author": "ttomsu", "createdAt": "2020-05-29T12:23:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI0NjQzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI0NjY5OQ==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2395#discussion_r432246699", "bodyText": "Do we know for sure that the skip deploy configuration is inherited from the parent?\nWe really don't want to accidentally deploy samples to maven central.", "author": "meltsufin", "createdAt": "2020-05-29T04:16:13Z", "path": "spring-cloud-gcp-samples/spring-cloud-gcp-logging-sample/pom.xml", "diffHunk": "@@ -69,13 +69,6 @@\n             <plugin>\n                 <groupId>com.google.cloud.tools</groupId>\n                 <artifactId>appengine-maven-plugin</artifactId>\n-                <version>1.3.2</version>\n-            </plugin>\n-            <plugin>\n-                <artifactId>maven-deploy-plugin</artifactId>\n-                <configuration>\n-                    <skip>true</skip>", "originalCommit": "7c79832f8b985621c746aab5ace1256d3df3d530", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ0Nzc0Mw==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2395#discussion_r432447743", "bodyText": "No, I don't know for sure if this works as intended. Maven n00b here \ud83d\ude04", "author": "ttomsu", "createdAt": "2020-05-29T12:24:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI0NjY5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjU3NDU0MA==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2395#discussion_r432574540", "bodyText": "I'm as much a n00b as you are on this.  :)\nMaybe just run mvn deploy and see what happens?", "author": "meltsufin", "createdAt": "2020-05-29T15:46:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI0NjY5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI0Njk3MQ==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2395#discussion_r432246971", "bodyText": "Is this based on experimentation or some guidance somewhere?", "author": "meltsufin", "createdAt": "2020-05-29T04:17:21Z", "path": "spring-cloud-gcp-samples/spring-cloud-gcp-logging-sample/src/main/appengine/app.yaml", "diffHunk": "@@ -1,9 +1,5 @@\n-runtime: java\n-env: flex\n+runtime: java11\n+instance_class: F1\n \n-handlers:\n-- url: /.*\n-  script: this field is required, but ignored\n-\n-manual_scaling:\n-  instances: 1\n+env_variables:\n+  JAVA_TOOL_OPTIONS: \"-XX:MaxRAM=256m -XX:ActiveProcessorCount=2 -Xmx32m\"", "originalCommit": "7c79832f8b985621c746aab5ace1256d3df3d530", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ0ODI1NQ==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2395#discussion_r432448255", "bodyText": "Lifted unapologetically from https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/appengine-java11/springboot-helloworld/src/main/appengine/app.yaml#L21", "author": "ttomsu", "createdAt": "2020-05-29T12:25:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI0Njk3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI0NzUyMg==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2395#discussion_r432247522", "bodyText": "What's the effect of this skip configuration on Spring Boot Maven plugin?", "author": "meltsufin", "createdAt": "2020-05-29T04:20:04Z", "path": "spring-cloud-gcp-samples/spring-cloud-gcp-pubsub-stream-binder-functional-sample/pom.xml", "diffHunk": "@@ -32,4 +32,16 @@\n     </dependencies>\n   </dependencyManagement>\n \n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>org.springframework.boot</groupId>\n+        <artifactId>spring-boot-maven-plugin</artifactId>\n+        <configuration>\n+          <skip>true</skip>", "originalCommit": "7c79832f8b985621c746aab5ace1256d3df3d530", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ1MTMyOA==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2395#discussion_r432451328", "bodyText": "This sample is a bit funky - the -sink and -source modules are supposed to be independent, so in theory, they should have been able to be repackaged just fine.\nHowever, the third module (-sample-test) only contains tests. The test imports both the -sink and -source modules as libraries, which (apparently) don't play well with the Boot repackaging goal.\nSo, at first I only disabled spring-boot-maven-plugin on the -sample-test, and it mvn compiled, but failed at runtime with a ClassNotFound exception from one of the other modules (or a related exception, I don't remember exactly). To workout the failing test, I just disabled it on the whole thing.", "author": "ttomsu", "createdAt": "2020-05-29T12:32:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI0NzUyMg=="}], "type": "inlineReview"}, {"oid": "33560dc0576b681a4bbb3c7d184371286affe272", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/33560dc0576b681a4bbb3c7d184371286affe272", "message": "plugins: Pulls spring-boot plugin into samples parent pom, updates GAE plugin version", "committedDate": "2020-06-03T13:36:34Z", "type": "commit"}, {"oid": "6b2fcd5eea2e05c9a3255917f9fb22c38f690738", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/6b2fcd5eea2e05c9a3255917f9fb22c38f690738", "message": "samples: Updates GAE Flex samples to GAE Standard w Java 11", "committedDate": "2020-06-03T13:36:48Z", "type": "commit"}, {"oid": "6b2fcd5eea2e05c9a3255917f9fb22c38f690738", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/6b2fcd5eea2e05c9a3255917f9fb22c38f690738", "message": "samples: Updates GAE Flex samples to GAE Standard w Java 11", "committedDate": "2020-06-03T13:36:48Z", "type": "forcePushed"}, {"oid": "8ad6fcc582ffe53e6202cb1a8e11c3d73ce90f1c", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/8ad6fcc582ffe53e6202cb1a8e11c3d73ce90f1c", "message": "Apply suggestions from code review\n\nCo-authored-by: Mike Eltsufin <meltsufin@google.com>", "committedDate": "2020-06-03T13:42:37Z", "type": "commit"}]}