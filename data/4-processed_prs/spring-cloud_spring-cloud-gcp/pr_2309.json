{"pr_number": 2309, "pr_title": "update bom and document emulator usage", "pr_createdAt": "2020-04-09T00:20:06Z", "pr_url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2309", "timeline": [{"oid": "5e02b929aa14a9f27362539520bad1699135bea6", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/5e02b929aa14a9f27362539520bad1699135bea6", "message": "update bom and document emulator usage", "committedDate": "2020-04-09T00:17:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIxNzY5Mw==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2309#discussion_r406217693", "bodyText": "I don't know if we need to repeat all of the steps here because it's likely they will change.\nYou can say, once you followed the instructions and created the emulator configuration, activate it...", "author": "meltsufin", "createdAt": "2020-04-09T13:49:10Z", "path": "spring-cloud-gcp-samples/spring-cloud-gcp-data-spanner-sample/README.adoc", "diffHunk": "@@ -8,6 +8,38 @@ Data Cloud Spanner module link:../../spring-cloud-gcp-starters/spring-cloud-gcp-\n \n . Create a new Cloud Spanner instance named \"spring-demo\".\n The example application will create the database and tables if they do not already exist.\n+\n+You can use https://cloud.google.com/spanner/docs/emulator[Cloud Spanner emulator] to run the sample locally.\n+To install the Cloud Spanner emulator:\n+\n+Install the Google Cloud SDK.", "originalCommit": "5e02b929aa14a9f27362539520bad1699135bea6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI2MjIwNw==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2309#discussion_r406262207", "bodyText": "If you want, maybe one way to avoid duplication would be to link to the subsections of the emulator docs in your list of steps, like:\nInstructions for using the Cloud Spanner Emulator:\n\n\nFollow the steps to install and start the Spanner Emulator\n\n\nCreate and update the emulator configuration\n....\n\n\netc.", "author": "dzou", "createdAt": "2020-04-09T14:51:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIxNzY5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIxODA5Mg==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2309#discussion_r406218092", "bodyText": "Isn't there also another step:\nexport SPANNER_EMULATOR_HOST=localhost:9010", "author": "meltsufin", "createdAt": "2020-04-09T13:49:48Z", "path": "spring-cloud-gcp-samples/spring-cloud-gcp-data-spanner-sample/README.adoc", "diffHunk": "@@ -8,6 +8,38 @@ Data Cloud Spanner module link:../../spring-cloud-gcp-starters/spring-cloud-gcp-\n \n . Create a new Cloud Spanner instance named \"spring-demo\".\n The example application will create the database and tables if they do not already exist.\n+\n+You can use https://cloud.google.com/spanner/docs/emulator[Cloud Spanner emulator] to run the sample locally.\n+To install the Cloud Spanner emulator:\n+\n+Install the Google Cloud SDK.\n+\n+For Windows and MacOS users, the emulator requires Docker to be installed on your system and available on the system path.\n+\n+Update your gcloud command-line tool installation to get the latest features:\n+----\n+gcloud components update beta\n+----\n+\n+Start the emulator\n+----\n+$ gcloud beta emulators spanner start\n+----\n+\n+Create the emulator config\n+----\n+$ gcloud config configurations create emulator\n+$ gcloud config set auth/disable_credentials true\n+$ gcloud config set project your-project-id\n+$ gcloud config set api_endpoint_overrides/spanner http://localhost:9020/\n+----\n+\n+Switch to emulator config and create the instance with gcloud\n+----\n+$ gcloud config configurations activate emulator\n+$ gcloud spanner instances create spring-demo --config=emulator-config --description=\"Test Instance\" --nodes=1\n+----", "originalCommit": "5e02b929aa14a9f27362539520bad1699135bea6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ2MTQ1MA==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2309#discussion_r406461450", "bodyText": "It's in the emulator doc.", "author": "dmitry-s", "createdAt": "2020-04-09T20:34:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIxODA5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ2MTc2MA==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2309#discussion_r406461760", "bodyText": "But I'll add it here anyway to remind users that it needs to be set.", "author": "dmitry-s", "createdAt": "2020-04-09T20:35:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIxODA5Mg=="}], "type": "inlineReview"}, {"oid": "484e119ff767b7b237e6bd96c8890cbdf770a960", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/484e119ff767b7b237e6bd96c8890cbdf770a960", "message": "update bom and document emulator usage", "committedDate": "2020-04-09T20:33:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc2OTEyNw==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2309#discussion_r406769127", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Remember that you need to set the SPANNER_EMULATOR_HOST environment variable to use the emulator:\n          \n          \n            \n            Remember that you need to set the `SPANNER_EMULATOR_HOST` environment variable to use the emulator:", "author": "meltsufin", "createdAt": "2020-04-10T13:57:30Z", "path": "docs/src/main/asciidoc/spanner.adoc", "diffHunk": "@@ -1413,7 +1413,25 @@ Database administrative operations, such as creating tables using `SpannerDataba\n \n If you would like to configure every aspect of each connection (such as pool size and retry settings), you can supply a bean for `Supplier<DatabaseClient>`.\n \n-=== Sample\n \n+=== Cloud Spanner Emulator\n+\n+The https://cloud.google.com/sdk[Cloud SDK] provides a local, in-memory emulator for Cloud Spanner, which you can use to develop and test your application. As the emulator stores data only in memory, it will not persist data across runs. It is intended to help you use Cloud Spanner for local development and testing, not for production deployments.\n+\n+In order to set up and start the emulator, you can follow https://cloud.google.com/spanner/docs/emulator[these steps].\n+\n+This command can be used to create Cloud Spanner instances:\n+\n+----\n+$ gcloud spanner instances create <instance-name> --config=emulator-config --description=\"<description>\" --nodes=1\n+----\n+\n+Remember that you need to set the SPANNER_EMULATOR_HOST environment variable to use the emulator:", "originalCommit": "484e119ff767b7b237e6bd96c8890cbdf770a960", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc2OTkxNQ==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2309#discussion_r406769915", "bodyText": "Add a section here === Running on GCP and below === Running locally using emulator", "author": "meltsufin", "createdAt": "2020-04-10T13:59:20Z", "path": "spring-cloud-gcp-samples/spring-cloud-gcp-data-spanner-sample/README.adoc", "diffHunk": "@@ -8,6 +8,20 @@ Data Cloud Spanner module link:../../spring-cloud-gcp-starters/spring-cloud-gcp-\n ", "originalCommit": "484e119ff767b7b237e6bd96c8890cbdf770a960", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc3MDEwMA==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2309#discussion_r406770100", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Note that you need to set the SPANNER_EMULATOR_HOST environment variable to use the emulator.\n          \n          \n            \n            Note that you need to set the `SPANNER_EMULATOR_HOST` environment variable to use the emulator.", "author": "meltsufin", "createdAt": "2020-04-10T13:59:46Z", "path": "spring-cloud-gcp-samples/spring-cloud-gcp-data-spanner-sample/README.adoc", "diffHunk": "@@ -8,6 +8,20 @@ Data Cloud Spanner module link:../../spring-cloud-gcp-starters/spring-cloud-gcp-\n \n . Create a new Cloud Spanner instance named \"spring-demo\".\n The example application will create the database and tables if they do not already exist.\n+\n+If you would like to run the sample locally using Cloud Spanner emulator, please follow https://cloud.google.com/spanner/docs/emulator[this steps] to set up and start the emulator.\n+\n+After that, you would need to create an instance using this command:\n+----\n+$ gcloud spanner instances create spring-demo --config=emulator-config --description=\"Test Instance\" --nodes=1\n+----\n+\n+Note that you need to set the SPANNER_EMULATOR_HOST environment variable to use the emulator.", "originalCommit": "484e119ff767b7b237e6bd96c8890cbdf770a960", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc3MDc0Ng==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2309#discussion_r406770746", "bodyText": "The credentials stuff should go under running on GCP section", "author": "meltsufin", "createdAt": "2020-04-10T14:01:25Z", "path": "spring-cloud-gcp-samples/spring-cloud-gcp-data-spanner-sample/README.adoc", "diffHunk": "@@ -8,6 +8,20 @@ Data Cloud Spanner module link:../../spring-cloud-gcp-starters/spring-cloud-gcp-\n \n . Create a new Cloud Spanner instance named \"spring-demo\".\n The example application will create the database and tables if they do not already exist.\n+\n+If you would like to run the sample locally using Cloud Spanner emulator, please follow https://cloud.google.com/spanner/docs/emulator[this steps] to set up and start the emulator.\n+\n+After that, you would need to create an instance using this command:\n+----\n+$ gcloud spanner instances create spring-demo --config=emulator-config --description=\"Test Instance\" --nodes=1\n+----\n+\n+Note that you need to set the SPANNER_EMULATOR_HOST environment variable to use the emulator.\n+\n+----\n+$ export SPANNER_EMULATOR_HOST=localhost:9010\n+----\n+\n [start=2]\n . https://cloud.google.com/sdk/gcloud/reference/auth/application-default/login[If you are authenticated in the Cloud SDK], your credentials will be automatically found by the Spring", "originalCommit": "484e119ff767b7b237e6bd96c8890cbdf770a960", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d7c1c09e255e30355409ea924f51af6503350cef", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/d7c1c09e255e30355409ea924f51af6503350cef", "message": "Update docs/src/main/asciidoc/spanner.adoc\n\nCo-Authored-By: Mike Eltsufin <meltsufin@google.com>", "committedDate": "2020-04-10T22:37:37Z", "type": "commit"}, {"oid": "62b6ff5b4017c8824fd8deee61ddbf0b57f64c45", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/62b6ff5b4017c8824fd8deee61ddbf0b57f64c45", "message": "Apply suggestions from code review\n\nCo-Authored-By: Mike Eltsufin <meltsufin@google.com>", "committedDate": "2020-04-10T22:38:10Z", "type": "commit"}, {"oid": "d8c121aaa20e90b6cc80beeedf21f46cd92ea568", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/d8c121aaa20e90b6cc80beeedf21f46cd92ea568", "message": "Merge branch 'master' of github.com:spring-cloud/spring-cloud-gcp into spanner-emulator", "committedDate": "2020-04-10T22:46:55Z", "type": "commit"}, {"oid": "4a324250b9b3ca3945dfe775522dcdb84d89ed0f", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/4a324250b9b3ca3945dfe775522dcdb84d89ed0f", "message": "Merge branch 'spanner-emulator' of github.com:spring-cloud/spring-cloud-gcp into spanner-emulator", "committedDate": "2020-04-10T22:47:34Z", "type": "commit"}, {"oid": "6dfe554350a6d499668b023314f9832b73d88c8c", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/6dfe554350a6d499668b023314f9832b73d88c8c", "message": "update bom and document emulator usage", "committedDate": "2020-04-10T22:50:25Z", "type": "commit"}]}