{"pr_number": 448, "pr_title": "Added Support for Listing Downloaded Offline Areas", "pr_createdAt": "2020-04-16T17:15:59Z", "pr_url": "https://github.com/google/ground-android/pull/448", "timeline": [{"oid": "81d04beb3daf1bc4910b0607537364818aa298ce", "url": "https://github.com/google/ground-android/commit/81d04beb3daf1bc4910b0607537364818aa298ce", "message": "Fix bug in toArea LatLngBounds call\n\nPreviously, we instantiated a new LatLngBounds instance using the latlng\nvalues in the wrong position; this led to a bug when attempting to\nconvert OfflineAreaEntites back to Areas. This change fixes that issue.\n\nSee https://developers.google.com/android/reference/com/google/android/gms/maps/model/LatLngBounds\nfor more info.", "committedDate": "2020-04-16T16:52:39Z", "type": "commit"}, {"oid": "9fd50e15026a08470b0e44f81bd563d6d5b21e4f", "url": "https://github.com/google/ground-android/commit/9fd50e15026a08470b0e44f81bd563d6d5b21e4f", "message": "Fetch offline areas as a Single instead of a Flowable\n\nSince we only ever (so far) need to render the complete list of offline\nareas in the db, and we don't need to convert the rx type to livedata\nusing from publisher, for now it makes more sense to emit the entire\nlist of areas as a Single (this is consistent with other implementations\nin the codebase).", "committedDate": "2020-04-16T16:54:33Z", "type": "commit"}, {"oid": "d6bd84437f42a61fe9810523fee294a60bd784c2", "url": "https://github.com/google/ground-android/commit/d6bd84437f42a61fe9810523fee294a60bd784c2", "message": "Add a method for retrieving all offline areas from the local datastore\n\nWe need this method to list current offline areas and allow the user to\nmanage or delete them.", "committedDate": "2020-04-16T16:57:06Z", "type": "commit"}, {"oid": "65b96a04674a23a6aebfac3a034f5e1274e2ed58", "url": "https://github.com/google/ground-android/commit/65b96a04674a23a6aebfac3a034f5e1274e2ed58", "message": "Render lists of downloaded offline areas in the offline area ui\n\nEventually, we want to give users control to manage their downloaded\noffline areas. This commit is the first step in toward that\nfunctionality; it lists the current offline areas in the offline area\nui. I've also enabled viewbinding since butterknife is deprecated\n(see issue #418)", "committedDate": "2020-04-16T17:00:27Z", "type": "commit"}, {"oid": "2aceb5f0ca0a23b4934a04d3f1da1668c674da9c", "url": "https://github.com/google/ground-android/commit/2aceb5f0ca0a23b4934a04d3f1da1668c674da9c", "message": "Update offline area list layout\n\nThe previous sizing resulted in fairly preposterous heights.", "committedDate": "2020-04-16T17:53:56Z", "type": "commit"}, {"oid": "1eee4d78ce6a51646db36c523ada644ed47644ac", "url": "https://github.com/google/ground-android/commit/1eee4d78ce6a51646db36c523ada644ed47644ac", "message": "Use get instead of iterator in Adapter.", "committedDate": "2020-04-16T17:54:23Z", "type": "commit"}, {"oid": "3479040ca6048b7c334db5150e3d2601ef90b090", "url": "https://github.com/google/ground-android/commit/3479040ca6048b7c334db5150e3d2601ef90b090", "message": "Remove a redundant call to notifyDataSetChanged", "committedDate": "2020-04-16T17:54:43Z", "type": "commit"}, {"oid": "ef9da7e38a358646c934f96858234ae857cc7250", "url": "https://github.com/google/ground-android/commit/ef9da7e38a358646c934f96858234ae857cc7250", "message": "Use Flowable instead of Single in findAll methods for OfflineAreas\n\nThis ensures we can dynamically update UIs etc. as soon as a new element\nis added to the table, contrarily, Single, does not update after its\ninitial completion.", "committedDate": "2020-04-17T17:02:03Z", "type": "commit"}, {"oid": "47830ec2022b25eb1a669144d7a6035895b70917", "url": "https://github.com/google/ground-android/commit/47830ec2022b25eb1a669144d7a6035895b70917", "message": "Update OfflineArea fragment; update list dynamically\n\nI've updated the offlineArea fragment so that the list of offline areas\nnow updated dynamically according to the contents of the db. We use\nLive Data now instead of a direct reference to RX types.", "committedDate": "2020-04-17T17:03:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM2MzIyMg==", "url": "https://github.com/google/ground-android/pull/448#discussion_r410363222", "bodyText": "Moving these two lines to the end of onCreateView would allow offlineAreaListAdapter to be declared as local variable. The adapter isn't being used anywhere else. Wdyt?", "author": "shobhitagarwal1612", "createdAt": "2020-04-17T17:21:30Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/offlinearea/OfflineAreasFragment.java", "diffHunk": "@@ -50,17 +52,26 @@\n   public void onCreate(@Nullable Bundle savedInstanceState) {\n     super.onCreate(savedInstanceState);\n     viewModel = getViewModel(OfflineAreasViewModel.class);\n-    // TODO: use the viewmodel\n+    this.offlineAreaListAdapter = new OfflineAreaListAdapter();\n+    viewModel.getOfflineAreas().observe(this, offlineAreaListAdapter::update);", "originalCommit": "47830ec2022b25eb1a669144d7a6035895b70917", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM3MzUxMA==", "url": "https://github.com/google/ground-android/pull/448#discussion_r410373510", "bodyText": "done! 34b3dfa", "author": "scolsen", "createdAt": "2020-04-17T17:41:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM2MzIyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM2MzY2NQ==", "url": "https://github.com/google/ground-android/pull/448#discussion_r410363665", "bodyText": "Can we use androidx.* for consistency?", "author": "shobhitagarwal1612", "createdAt": "2020-04-17T17:22:16Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/offlinearea/OfflineAreasFragment.java", "diffHunk": "@@ -21,14 +21,15 @@\n import android.view.View;\n import android.view.ViewGroup;\n import androidx.annotation.Nullable;\n+import androidx.recyclerview.widget.LinearLayoutManager;\n import androidx.recyclerview.widget.RecyclerView;\n import butterknife.BindView;\n import com.google.android.gnd.MainActivity;\n import com.google.android.gnd.R;\n import com.google.android.gnd.databinding.OfflineAreasFragBinding;\n import com.google.android.gnd.inject.ActivityScoped;\n import com.google.android.gnd.ui.common.AbstractFragment;\n-import com.google.android.gnd.ui.common.TwoLineToolbar;\n+import org.jetbrains.annotations.NotNull;", "originalCommit": "47830ec2022b25eb1a669144d7a6035895b70917", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM3MzU0Mw==", "url": "https://github.com/google/ground-android/pull/448#discussion_r410373543", "bodyText": "Good catch thanks! 34b3dfa", "author": "scolsen", "createdAt": "2020-04-17T17:41:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM2MzY2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM2NDA2OA==", "url": "https://github.com/google/ground-android/pull/448#discussion_r410364068", "bodyText": "As discussed on hangouts, we should call this getOfflineAreasOnceAndStream", "author": "shobhitagarwal1612", "createdAt": "2020-04-17T17:23:03Z", "path": "gnd/src/main/java/com/google/android/gnd/persistence/local/LocalDataStore.java", "diffHunk": "@@ -145,4 +145,6 @@\n    * the area into the local data store.\n    */\n   Completable insertOrUpdateOfflineArea(OfflineArea area);\n+\n+  Flowable<ImmutableList<OfflineArea>> getOfflineAreas();", "originalCommit": "47830ec2022b25eb1a669144d7a6035895b70917", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM3NjM2MA==", "url": "https://github.com/google/ground-android/pull/448#discussion_r410376360", "bodyText": "Totally forgot, thanks! 6724e83", "author": "scolsen", "createdAt": "2020-04-17T17:46:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM2NDA2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM2NDYxOA==", "url": "https://github.com/google/ground-android/pull/448#discussion_r410364618", "bodyText": "Same as above.", "author": "shobhitagarwal1612", "createdAt": "2020-04-17T17:24:05Z", "path": "gnd/src/main/java/com/google/android/gnd/persistence/local/room/RoomLocalDataStore.java", "diffHunk": "@@ -482,4 +482,12 @@ public Completable insertOrUpdateOfflineArea(OfflineArea area) {\n         .insertOrUpdate(OfflineAreaEntity.fromArea(area))\n         .subscribeOn(schedulers.io());\n   }\n+\n+  @Override\n+  public Flowable<ImmutableList<OfflineArea>> getOfflineAreas() {", "originalCommit": "47830ec2022b25eb1a669144d7a6035895b70917", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM3NjI3OA==", "url": "https://github.com/google/ground-android/pull/448#discussion_r410376278", "bodyText": "6724e83", "author": "scolsen", "createdAt": "2020-04-17T17:46:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM2NDYxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM2NDcwMw==", "url": "https://github.com/google/ground-android/pull/448#discussion_r410364703", "bodyText": "Same as above", "author": "shobhitagarwal1612", "createdAt": "2020-04-17T17:24:16Z", "path": "gnd/src/main/java/com/google/android/gnd/repository/OfflineAreaRepository.java", "diffHunk": "@@ -94,4 +95,8 @@ public Completable addAreaAndEnqueue(LatLngBounds bounds) {\n         .doOnError(__ -> Timber.e(\"failed to add/update offline area in the database\"))\n         .andThen(enqueueTileDownloads(offlineArea));\n   }\n+\n+  public Flowable<ImmutableList<OfflineArea>> getOfflineAreas() {", "originalCommit": "47830ec2022b25eb1a669144d7a6035895b70917", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM3NjI1Nw==", "url": "https://github.com/google/ground-android/pull/448#discussion_r410376257", "bodyText": "6724e83", "author": "scolsen", "createdAt": "2020-04-17T17:46:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM2NDcwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM2NTMyOQ==", "url": "https://github.com/google/ground-android/pull/448#discussion_r410365329", "bodyText": "We should avoid using single character variable name for better readability. Can you please call it binding instead?", "author": "shobhitagarwal1612", "createdAt": "2020-04-17T17:25:24Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/offlinearea/OfflineAreaListAdapter.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.offlinearea;\n+\n+import android.view.LayoutInflater;\n+import android.view.ViewGroup;\n+import androidx.recyclerview.widget.RecyclerView;\n+import com.google.android.gnd.databinding.OfflineAreasListItemBinding;\n+import com.google.android.gnd.model.basemap.OfflineArea;\n+import com.google.common.collect.ImmutableList;\n+import org.jetbrains.annotations.NotNull;\n+\n+class OfflineAreaListAdapter extends RecyclerView.Adapter<OfflineAreaListAdapter.ViewHolder> {\n+  private ImmutableList<OfflineArea> offlineAreas;\n+\n+  public static class ViewHolder extends RecyclerView.ViewHolder {\n+    public OfflineAreasListItemBinding binding;\n+\n+    ViewHolder(OfflineAreasListItemBinding b) {", "originalCommit": "47830ec2022b25eb1a669144d7a6035895b70917", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM3NDY0Mg==", "url": "https://github.com/google/ground-android/pull/448#discussion_r410374642", "bodyText": "15d933c", "author": "scolsen", "createdAt": "2020-04-17T17:43:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM2NTMyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM2NTUwMA==", "url": "https://github.com/google/ground-android/pull/448#discussion_r410365500", "bodyText": "Same as above.", "author": "shobhitagarwal1612", "createdAt": "2020-04-17T17:25:41Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/offlinearea/OfflineAreaListAdapter.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.offlinearea;\n+\n+import android.view.LayoutInflater;\n+import android.view.ViewGroup;\n+import androidx.recyclerview.widget.RecyclerView;\n+import com.google.android.gnd.databinding.OfflineAreasListItemBinding;\n+import com.google.android.gnd.model.basemap.OfflineArea;\n+import com.google.common.collect.ImmutableList;\n+import org.jetbrains.annotations.NotNull;\n+\n+class OfflineAreaListAdapter extends RecyclerView.Adapter<OfflineAreaListAdapter.ViewHolder> {\n+  private ImmutableList<OfflineArea> offlineAreas;\n+\n+  public static class ViewHolder extends RecyclerView.ViewHolder {\n+    public OfflineAreasListItemBinding binding;\n+\n+    ViewHolder(OfflineAreasListItemBinding b) {\n+      super(b.getRoot());\n+      binding = b;\n+    }\n+  }\n+\n+  OfflineAreaListAdapter() {\n+    offlineAreas = ImmutableList.of();\n+  }\n+\n+  @NotNull\n+  @Override\n+  public OfflineAreaListAdapter.ViewHolder onCreateViewHolder(\n+      @NotNull ViewGroup parent, int viewType) {\n+    OfflineAreasListItemBinding o =", "originalCommit": "47830ec2022b25eb1a669144d7a6035895b70917", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM3NDYwMQ==", "url": "https://github.com/google/ground-android/pull/448#discussion_r410374601", "bodyText": "15d933c", "author": "scolsen", "createdAt": "2020-04-17T17:43:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM2NTUwMA=="}], "type": "inlineReview"}, {"oid": "34b3dfa89cbc0f20bbc47e33cbcbebfdea1e4959", "url": "https://github.com/google/ground-android/commit/34b3dfa89cbc0f20bbc47e33cbcbebfdea1e4959", "message": "Make offlineAreaListAdapter a local variable.", "committedDate": "2020-04-17T17:40:23Z", "type": "commit"}, {"oid": "15d933ce46a49224901c61029954859cfb13f339", "url": "https://github.com/google/ground-android/commit/15d933ce46a49224901c61029954859cfb13f339", "message": "Don't use single letter variable names.", "committedDate": "2020-04-17T17:42:36Z", "type": "commit"}, {"oid": "6724e83ab54559b7bd74ff3d509e304571287a4b", "url": "https://github.com/google/ground-android/commit/6724e83ab54559b7bd74ff3d509e304571287a4b", "message": "Rename getOfflineAreas -> getOfflineAreasOnceAndStream", "committedDate": "2020-04-17T17:46:00Z", "type": "commit"}, {"oid": "0cbb3d9b4dbcf712dc2db12dc7c79dc71c4e7402", "url": "https://github.com/google/ground-android/commit/0cbb3d9b4dbcf712dc2db12dc7c79dc71c4e7402", "message": "Fix linting error", "committedDate": "2020-04-20T17:41:59Z", "type": "commit"}]}