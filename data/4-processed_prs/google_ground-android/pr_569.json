{"pr_number": 569, "pr_title": "Adding UI tests for adding a feature", "pr_createdAt": "2020-08-25T14:27:15Z", "pr_url": "https://github.com/google/ground-android/pull/569", "timeline": [{"oid": "6fba2a175151d91d2fc2e23403008dcb3155d13a", "url": "https://github.com/google/ground-android/commit/6fba2a175151d91d2fc2e23403008dcb3155d13a", "message": "Refactor test data into own class. Tidy up.", "committedDate": "2020-08-25T14:48:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5MDMxMA==", "url": "https://github.com/google/ground-android/pull/569#discussion_r477090310", "bodyText": "Close parenthesis at the same level as the first character of the line that opens it. Not a hard rule but I think it's the trend now.\nTo avoid bikeshedding like this I recommend you install spotless. It's 10 lines in your build.gradle file that will save a lot of time.", "author": "JoseAlcerreca", "createdAt": "2020-08-26T07:27:17Z", "path": "gnd/src/androidTest/java/com/google/android/gnd/AddFeatureTest.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd;\n+\n+import static androidx.test.espresso.Espresso.onData;\n+import static androidx.test.espresso.Espresso.onView;\n+import static androidx.test.espresso.action.ViewActions.click;\n+import static androidx.test.espresso.assertion.ViewAssertions.matches;\n+import static androidx.test.espresso.matcher.ViewMatchers.isCompletelyDisplayed;\n+import static androidx.test.espresso.matcher.ViewMatchers.withId;\n+import static androidx.test.espresso.matcher.ViewMatchers.withText;\n+import static org.hamcrest.CoreMatchers.allOf;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.Matchers.instanceOf;\n+import static org.hamcrest.Matchers.not;\n+\n+import android.content.Context;\n+import androidx.room.Room;\n+import androidx.test.core.app.ActivityScenario;\n+import androidx.test.ext.junit.rules.ActivityScenarioRule;\n+import com.google.android.gnd.persistence.local.LocalDatabaseModule;\n+import com.google.android.gnd.persistence.local.room.LocalDatabase;\n+import com.google.android.gnd.persistence.remote.FakeRemoteDataStore;\n+import com.google.android.gnd.persistence.remote.FakeRemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteDataStore;\n+import com.google.android.gnd.persistence.remote.RemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteStorageModule;\n+import com.google.android.gnd.persistence.uuid.FakeUuidGenerator;\n+import com.google.android.gnd.persistence.uuid.OfflineUuidGenerator;\n+import com.google.android.gnd.system.auth.AuthenticationManager;\n+import com.google.android.gnd.system.auth.AuthenticationModule;\n+import com.google.android.gnd.system.auth.FakeAuthenticationManager;\n+import dagger.Binds;\n+import dagger.Module;\n+import dagger.Provides;\n+import dagger.hilt.InstallIn;\n+import dagger.hilt.android.components.ApplicationComponent;\n+import dagger.hilt.android.qualifiers.ApplicationContext;\n+import dagger.hilt.android.testing.HiltAndroidRule;\n+import dagger.hilt.android.testing.HiltAndroidTest;\n+import dagger.hilt.android.testing.UninstallModules;\n+import javax.inject.Singleton;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+@UninstallModules({AuthenticationModule.class, RemoteStorageModule.class,\n+  LocalDatabaseModule.class})\n+@HiltAndroidTest\n+public class AddFeatureTest {\n+\n+  // Ensures that the Hilt component is initialized before running the ActivityScenarioRule.\n+  public @Rule(order = 0)\n+  HiltAndroidRule hiltRule = new HiltAndroidRule(this);\n+\n+  // Sets the preferences so no login is required and an active project is selected.\n+  public @Rule(order = 1)\n+  SetPreferencesRule preferencesRule = new SetPreferencesRule();\n+\n+  public @Rule(order = 2)\n+  ActivityScenarioRule scenarioRule =\n+    new ActivityScenarioRule(MainActivity.class);\n+\n+  @Module\n+  @InstallIn(ApplicationComponent.class)\n+  abstract class TestDependenciesModule {\n+\n+    @Binds\n+    @Singleton\n+    abstract AuthenticationManager bindAuthenticationManager(\n+      FakeAuthenticationManager authenticationManager);", "originalCommit": "6fba2a175151d91d2fc2e23403008dcb3155d13a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIxNDAxNg==", "url": "https://github.com/google/ground-android/pull/569#discussion_r477214016", "bodyText": "We're already using checkstyle with the google java style guide, however, there is no rule for this. I tried trawling through the docs to see if it's easy to add, but tbh after 15 mins of researching I didn't think it was worth it.", "author": "dturner", "createdAt": "2020-08-26T10:58:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5MDMxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyNDY3OQ==", "url": "https://github.com/google/ground-android/pull/569#discussion_r477224679", "bodyText": "@gino-m Any thoughts on this? If it's an easy add it's probably worth adding a rule for this, just for code consistency.", "author": "dturner", "createdAt": "2020-08-26T11:19:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5MDMxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5MTAzMQ==", "url": "https://github.com/google/ground-android/pull/569#discussion_r477091031", "bodyText": "I don't think this is super idiomatic. I would move these modules to their own files or put them at the bottom of this file. I've opened this file to read the tests, not to read the setup. The only reason you would put a class inside another class is if you need to access the parent from the child.", "author": "JoseAlcerreca", "createdAt": "2020-08-26T07:28:40Z", "path": "gnd/src/androidTest/java/com/google/android/gnd/AddFeatureTest.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd;\n+\n+import static androidx.test.espresso.Espresso.onData;\n+import static androidx.test.espresso.Espresso.onView;\n+import static androidx.test.espresso.action.ViewActions.click;\n+import static androidx.test.espresso.assertion.ViewAssertions.matches;\n+import static androidx.test.espresso.matcher.ViewMatchers.isCompletelyDisplayed;\n+import static androidx.test.espresso.matcher.ViewMatchers.withId;\n+import static androidx.test.espresso.matcher.ViewMatchers.withText;\n+import static org.hamcrest.CoreMatchers.allOf;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.Matchers.instanceOf;\n+import static org.hamcrest.Matchers.not;\n+\n+import android.content.Context;\n+import androidx.room.Room;\n+import androidx.test.core.app.ActivityScenario;\n+import androidx.test.ext.junit.rules.ActivityScenarioRule;\n+import com.google.android.gnd.persistence.local.LocalDatabaseModule;\n+import com.google.android.gnd.persistence.local.room.LocalDatabase;\n+import com.google.android.gnd.persistence.remote.FakeRemoteDataStore;\n+import com.google.android.gnd.persistence.remote.FakeRemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteDataStore;\n+import com.google.android.gnd.persistence.remote.RemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteStorageModule;\n+import com.google.android.gnd.persistence.uuid.FakeUuidGenerator;\n+import com.google.android.gnd.persistence.uuid.OfflineUuidGenerator;\n+import com.google.android.gnd.system.auth.AuthenticationManager;\n+import com.google.android.gnd.system.auth.AuthenticationModule;\n+import com.google.android.gnd.system.auth.FakeAuthenticationManager;\n+import dagger.Binds;\n+import dagger.Module;\n+import dagger.Provides;\n+import dagger.hilt.InstallIn;\n+import dagger.hilt.android.components.ApplicationComponent;\n+import dagger.hilt.android.qualifiers.ApplicationContext;\n+import dagger.hilt.android.testing.HiltAndroidRule;\n+import dagger.hilt.android.testing.HiltAndroidTest;\n+import dagger.hilt.android.testing.UninstallModules;\n+import javax.inject.Singleton;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+@UninstallModules({AuthenticationModule.class, RemoteStorageModule.class,\n+  LocalDatabaseModule.class})\n+@HiltAndroidTest\n+public class AddFeatureTest {\n+\n+  // Ensures that the Hilt component is initialized before running the ActivityScenarioRule.\n+  public @Rule(order = 0)\n+  HiltAndroidRule hiltRule = new HiltAndroidRule(this);\n+\n+  // Sets the preferences so no login is required and an active project is selected.\n+  public @Rule(order = 1)\n+  SetPreferencesRule preferencesRule = new SetPreferencesRule();\n+\n+  public @Rule(order = 2)\n+  ActivityScenarioRule scenarioRule =\n+    new ActivityScenarioRule(MainActivity.class);\n+\n+  @Module\n+  @InstallIn(ApplicationComponent.class)\n+  abstract class TestDependenciesModule {", "originalCommit": "6fba2a175151d91d2fc2e23403008dcb3155d13a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5MTg4Mw==", "url": "https://github.com/google/ground-android/pull/569#discussion_r477091883", "bodyText": "Weird throws here, is it needed?", "author": "JoseAlcerreca", "createdAt": "2020-08-26T07:30:11Z", "path": "gnd/src/androidTest/java/com/google/android/gnd/AddFeatureTest.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd;\n+\n+import static androidx.test.espresso.Espresso.onData;\n+import static androidx.test.espresso.Espresso.onView;\n+import static androidx.test.espresso.action.ViewActions.click;\n+import static androidx.test.espresso.assertion.ViewAssertions.matches;\n+import static androidx.test.espresso.matcher.ViewMatchers.isCompletelyDisplayed;\n+import static androidx.test.espresso.matcher.ViewMatchers.withId;\n+import static androidx.test.espresso.matcher.ViewMatchers.withText;\n+import static org.hamcrest.CoreMatchers.allOf;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.Matchers.instanceOf;\n+import static org.hamcrest.Matchers.not;\n+\n+import android.content.Context;\n+import androidx.room.Room;\n+import androidx.test.core.app.ActivityScenario;\n+import androidx.test.ext.junit.rules.ActivityScenarioRule;\n+import com.google.android.gnd.persistence.local.LocalDatabaseModule;\n+import com.google.android.gnd.persistence.local.room.LocalDatabase;\n+import com.google.android.gnd.persistence.remote.FakeRemoteDataStore;\n+import com.google.android.gnd.persistence.remote.FakeRemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteDataStore;\n+import com.google.android.gnd.persistence.remote.RemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteStorageModule;\n+import com.google.android.gnd.persistence.uuid.FakeUuidGenerator;\n+import com.google.android.gnd.persistence.uuid.OfflineUuidGenerator;\n+import com.google.android.gnd.system.auth.AuthenticationManager;\n+import com.google.android.gnd.system.auth.AuthenticationModule;\n+import com.google.android.gnd.system.auth.FakeAuthenticationManager;\n+import dagger.Binds;\n+import dagger.Module;\n+import dagger.Provides;\n+import dagger.hilt.InstallIn;\n+import dagger.hilt.android.components.ApplicationComponent;\n+import dagger.hilt.android.qualifiers.ApplicationContext;\n+import dagger.hilt.android.testing.HiltAndroidRule;\n+import dagger.hilt.android.testing.HiltAndroidTest;\n+import dagger.hilt.android.testing.UninstallModules;\n+import javax.inject.Singleton;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+@UninstallModules({AuthenticationModule.class, RemoteStorageModule.class,\n+  LocalDatabaseModule.class})\n+@HiltAndroidTest\n+public class AddFeatureTest {\n+\n+  // Ensures that the Hilt component is initialized before running the ActivityScenarioRule.\n+  public @Rule(order = 0)\n+  HiltAndroidRule hiltRule = new HiltAndroidRule(this);\n+\n+  // Sets the preferences so no login is required and an active project is selected.\n+  public @Rule(order = 1)\n+  SetPreferencesRule preferencesRule = new SetPreferencesRule();\n+\n+  public @Rule(order = 2)\n+  ActivityScenarioRule scenarioRule =\n+    new ActivityScenarioRule(MainActivity.class);\n+\n+  @Module\n+  @InstallIn(ApplicationComponent.class)\n+  abstract class TestDependenciesModule {\n+\n+    @Binds\n+    @Singleton\n+    abstract AuthenticationManager bindAuthenticationManager(\n+      FakeAuthenticationManager authenticationManager);\n+\n+    @Binds\n+    @Singleton\n+    abstract RemoteDataStore bindRemoteDataStore(FakeRemoteDataStore remoteDataStore);\n+\n+    @Binds\n+    @Singleton\n+    abstract RemoteStorageManager bindRemoteStorageManager(\n+      FakeRemoteStorageManager remoteStorageManager);\n+\n+    @Binds\n+    @Singleton\n+    abstract OfflineUuidGenerator offlineUuidGenerator(FakeUuidGenerator uuidGenerator);\n+  }\n+\n+  @InstallIn(ApplicationComponent.class)\n+  @Module\n+  public class LocalDatabaseModule {\n+\n+    @Provides\n+    @Singleton\n+    LocalDatabase localDatabase(@ApplicationContext Context context) {\n+      return Room.inMemoryDatabaseBuilder(context, LocalDatabase.class).build();\n+    }\n+  }\n+\n+  // Given: a logged in user - with an active project with no map markers.\n+  // When: they tap on the centre of the map.\n+  // Then: nothing happens - the feature fragment is not displayed.\n+  @Test\n+  public void tappingCrosshairOnEmptyMapDoesNothing() throws InterruptedException {", "originalCommit": "6fba2a175151d91d2fc2e23403008dcb3155d13a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyMzk4OQ==", "url": "https://github.com/google/ground-android/pull/569#discussion_r477223989", "bodyText": "I used to have a Thread.sleep in that method but it was removed so the InterruptedException can also be removed. Good spot, thanks.", "author": "dturner", "createdAt": "2020-08-26T11:18:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5MTg4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5ODgxMw==", "url": "https://github.com/google/ground-android/pull/569#discussion_r477098813", "bodyText": "Have you tried idling resources? Given you're dealing with maps and fragments it might be tricky", "author": "JoseAlcerreca", "createdAt": "2020-08-26T07:42:57Z", "path": "gnd/src/androidTest/java/com/google/android/gnd/AddFeatureTest.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd;\n+\n+import static androidx.test.espresso.Espresso.onData;\n+import static androidx.test.espresso.Espresso.onView;\n+import static androidx.test.espresso.action.ViewActions.click;\n+import static androidx.test.espresso.assertion.ViewAssertions.matches;\n+import static androidx.test.espresso.matcher.ViewMatchers.isCompletelyDisplayed;\n+import static androidx.test.espresso.matcher.ViewMatchers.withId;\n+import static androidx.test.espresso.matcher.ViewMatchers.withText;\n+import static org.hamcrest.CoreMatchers.allOf;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.Matchers.instanceOf;\n+import static org.hamcrest.Matchers.not;\n+\n+import android.content.Context;\n+import androidx.room.Room;\n+import androidx.test.core.app.ActivityScenario;\n+import androidx.test.ext.junit.rules.ActivityScenarioRule;\n+import com.google.android.gnd.persistence.local.LocalDatabaseModule;\n+import com.google.android.gnd.persistence.local.room.LocalDatabase;\n+import com.google.android.gnd.persistence.remote.FakeRemoteDataStore;\n+import com.google.android.gnd.persistence.remote.FakeRemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteDataStore;\n+import com.google.android.gnd.persistence.remote.RemoteStorageManager;\n+import com.google.android.gnd.persistence.remote.RemoteStorageModule;\n+import com.google.android.gnd.persistence.uuid.FakeUuidGenerator;\n+import com.google.android.gnd.persistence.uuid.OfflineUuidGenerator;\n+import com.google.android.gnd.system.auth.AuthenticationManager;\n+import com.google.android.gnd.system.auth.AuthenticationModule;\n+import com.google.android.gnd.system.auth.FakeAuthenticationManager;\n+import dagger.Binds;\n+import dagger.Module;\n+import dagger.Provides;\n+import dagger.hilt.InstallIn;\n+import dagger.hilt.android.components.ApplicationComponent;\n+import dagger.hilt.android.qualifiers.ApplicationContext;\n+import dagger.hilt.android.testing.HiltAndroidRule;\n+import dagger.hilt.android.testing.HiltAndroidTest;\n+import dagger.hilt.android.testing.UninstallModules;\n+import javax.inject.Singleton;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+@UninstallModules({AuthenticationModule.class, RemoteStorageModule.class,\n+  LocalDatabaseModule.class})\n+@HiltAndroidTest\n+public class AddFeatureTest {\n+\n+  // Ensures that the Hilt component is initialized before running the ActivityScenarioRule.\n+  public @Rule(order = 0)\n+  HiltAndroidRule hiltRule = new HiltAndroidRule(this);\n+\n+  // Sets the preferences so no login is required and an active project is selected.\n+  public @Rule(order = 1)\n+  SetPreferencesRule preferencesRule = new SetPreferencesRule();\n+\n+  public @Rule(order = 2)\n+  ActivityScenarioRule scenarioRule =\n+    new ActivityScenarioRule(MainActivity.class);\n+\n+  @Module\n+  @InstallIn(ApplicationComponent.class)\n+  abstract class TestDependenciesModule {\n+\n+    @Binds\n+    @Singleton\n+    abstract AuthenticationManager bindAuthenticationManager(\n+      FakeAuthenticationManager authenticationManager);\n+\n+    @Binds\n+    @Singleton\n+    abstract RemoteDataStore bindRemoteDataStore(FakeRemoteDataStore remoteDataStore);\n+\n+    @Binds\n+    @Singleton\n+    abstract RemoteStorageManager bindRemoteStorageManager(\n+      FakeRemoteStorageManager remoteStorageManager);\n+\n+    @Binds\n+    @Singleton\n+    abstract OfflineUuidGenerator offlineUuidGenerator(FakeUuidGenerator uuidGenerator);\n+  }\n+\n+  @InstallIn(ApplicationComponent.class)\n+  @Module\n+  public class LocalDatabaseModule {\n+\n+    @Provides\n+    @Singleton\n+    LocalDatabase localDatabase(@ApplicationContext Context context) {\n+      return Room.inMemoryDatabaseBuilder(context, LocalDatabase.class).build();\n+    }\n+  }\n+\n+  // Given: a logged in user - with an active project with no map markers.\n+  // When: they tap on the centre of the map.\n+  // Then: nothing happens - the feature fragment is not displayed.\n+  @Test\n+  public void tappingCrosshairOnEmptyMapDoesNothing() throws InterruptedException {\n+    ActivityScenario<MainActivity> scenario = scenarioRule.getScenario();\n+\n+    // Tap on the crosshair at the centre of the map.\n+    onView(withId(R.id.map_crosshairs)).perform(click());\n+\n+    // Verify that the title is not displayed.\n+    onView(withId(R.id.feature_title)).check(matches(not(isCompletelyDisplayed())));\n+  }\n+\n+  // Given: a logged in user - with an active project which doesn't direct the user to add an\n+  // observation when adding a feature.\n+  // When: they tap the \"Add feature\" FAB and choose a feature type.\n+  // Then: the observation marker is displayed on the map screen.\n+  @Test\n+  public void addFeatureWithNoFields() throws InterruptedException {\n+    ActivityScenario<MainActivity> scenario = scenarioRule.getScenario();\n+\n+    // Tap on the \"Add feature\" button.\n+    onView(withId(R.id.add_feature_btn)).perform(click());\n+\n+    // Tap on the layer type.\n+    onData(allOf(is(instanceOf(String.class)), is(FakeData.LAYER_NO_FIELDS_NAME))).perform(click());\n+\n+    // Tap on the crosshair at the centre of the map.\n+    onView(withId(R.id.map_crosshairs)).perform(click());\n+\n+    // TODO: figure out how to remove this\n+    //  It's probably because the feature fragment animation does not block the test and the\n+    //  feature title isn't updated until the animation has completed (and it isn't disabled by the\n+    //  normal `transition_animation_scale 0` etc commands).\n+    Thread.sleep(100);", "originalCommit": "6fba2a175151d91d2fc2e23403008dcb3155d13a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyNDI2NQ==", "url": "https://github.com/google/ground-android/pull/569#discussion_r477224265", "bodyText": "I think your idea for an AnimationManager which switches off animations for testing is probably the best one.", "author": "dturner", "createdAt": "2020-08-26T11:19:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5ODgxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQ4NzM3Nw==", "url": "https://github.com/google/ground-android/pull/569#discussion_r478487377", "bodyText": "In iosched animation is disabled manually for the bottom sheet: https://github.com/google/iosched/blob/89df01ebc19d9a46495baac4690c2ebfa74946dc/mobile/src/main/java/com/google/samples/apps/iosched/widget/BottomSheetBehavior.kt#L209 (thanks @JoseAlcerreca)", "author": "dturner", "createdAt": "2020-08-27T15:02:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5ODgxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUzNjkzMw==", "url": "https://github.com/google/ground-android/pull/569#discussion_r478536933", "bodyText": "I tried taking the current version of BottomSheetBehavior and modifying it so that animations are disabled. This resulted in the test passing without Thread.sleep on my Pixel 4A but still failing on the emulator (tried API 23 and 29). I feel like there's a background thread being spun up somewhere after tapping on the map pin which delays the display of the bottom sheet just long enough for the test to fail.", "author": "dturner", "createdAt": "2020-08-27T16:13:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5ODgxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5OTA2OA==", "url": "https://github.com/google/ground-android/pull/569#discussion_r477099068", "bodyText": "Was this kind of indentation allowed in Java? D:", "author": "JoseAlcerreca", "createdAt": "2020-08-26T07:43:26Z", "path": "gnd/src/androidTest/java/com/google/android/gnd/CustomTestRunner.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd;\n+\n+import android.app.Application;\n+import android.content.Context;\n+import androidx.test.runner.AndroidJUnitRunner;\n+import dagger.hilt.android.testing.HiltTestApplication;\n+import timber.log.Timber;\n+import timber.log.Timber.DebugTree;\n+\n+public class CustomTestRunner extends AndroidJUnitRunner {\n+\n+  @Override\n+  public Application newApplication(ClassLoader cl, String className,\n+    Context context)", "originalCommit": "6fba2a175151d91d2fc2e23403008dcb3155d13a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyMzMzNA==", "url": "https://github.com/google/ground-android/pull/569#discussion_r477223334", "bodyText": "Nope :) All fixed now.", "author": "dturner", "createdAt": "2020-08-26T11:17:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5OTA2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5OTQyNg==", "url": "https://github.com/google/ground-android/pull/569#discussion_r477099426", "bodyText": "same line", "author": "JoseAlcerreca", "createdAt": "2020-08-26T07:44:04Z", "path": "gnd/src/androidTest/java/com/google/android/gnd/persistence/remote/FakeRemoteDataStore.java", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.persistence.remote;\n+\n+import com.google.android.gnd.FakeData;\n+import com.google.android.gnd.model.Mutation;\n+import com.google.android.gnd.model.Project;\n+import com.google.android.gnd.model.User;\n+import com.google.android.gnd.model.feature.Feature;\n+import com.google.android.gnd.model.layer.Layer;\n+import com.google.android.gnd.model.layer.Style;\n+import com.google.android.gnd.model.observation.Observation;\n+import com.google.android.gnd.rx.ValueOrError;\n+import com.google.common.collect.ImmutableCollection;\n+import com.google.common.collect.ImmutableList;\n+import io.reactivex.Completable;\n+import io.reactivex.Flowable;\n+import io.reactivex.Single;\n+import java.util.Collections;\n+import java.util.List;\n+import javax.inject.Inject;\n+\n+public class FakeRemoteDataStore implements RemoteDataStore {\n+\n+  private final Layer layerWithNoFields = Layer.newBuilder()\n+    .setId(FakeData.LAYER_NO_FIELDS_ID)\n+    .setName(FakeData.LAYER_NO_FIELDS_NAME)\n+    .setDefaultStyle(Style.builder()\n+      .setColor(FakeData.LAYER_NO_FIELDS_COLOR)\n+      .build())\n+    .build();\n+\n+  private final Project testProject = Project.newBuilder()\n+    .setId(FakeData.PROJECT_ID)\n+    .setTitle(FakeData.PROJECT_TITLE)\n+    .setDescription(FakeData.PROJECT_DESCRIPTION)\n+    .putLayer(FakeData.LAYER_NO_FIELDS_ID, layerWithNoFields)\n+    .build();\n+\n+  @Inject\n+  FakeRemoteDataStore() {\n+  }\n+\n+  @Override\n+  public Single<List<Project>> loadProjectSummaries(\n+    User user) {", "originalCommit": "6fba2a175151d91d2fc2e23403008dcb3155d13a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d1dcac7b1a521da35cd7e134ef129d7f9630679a", "url": "https://github.com/google/ground-android/commit/d1dcac7b1a521da35cd7e134ef129d7f9630679a", "message": "Fix PMD error", "committedDate": "2020-09-08T12:47:07Z", "type": "forcePushed"}, {"oid": "82bd42f8401a531beab46ff39fdfe1fd78d28262", "url": "https://github.com/google/ground-android/commit/82bd42f8401a531beab46ff39fdfe1fd78d28262", "message": "Remove custom BottomSheetBehavior. Add back sleep. Tidy up code", "committedDate": "2020-09-22T16:07:07Z", "type": "forcePushed"}, {"oid": "4f2ffbc265ab9c73763f048a0b18b752a65ffff8", "url": "https://github.com/google/ground-android/commit/4f2ffbc265ab9c73763f048a0b18b752a65ffff8", "message": "Adding test dependencies and basic UI test", "committedDate": "2020-09-22T16:08:14Z", "type": "commit"}, {"oid": "1b776fbb0d93aea2e7962cc792f0b64d3bdbcd07", "url": "https://github.com/google/ground-android/commit/1b776fbb0d93aea2e7962cc792f0b64d3bdbcd07", "message": "Refactor AuthenticationManager into interface and implementation", "committedDate": "2020-09-22T16:08:14Z", "type": "commit"}, {"oid": "8ee3b69cd61d333eeebaf06b5f4dcf464532c140", "url": "https://github.com/google/ground-android/commit/8ee3b69cd61d333eeebaf06b5f4dcf464532c140", "message": "Fix checkstyle issues", "committedDate": "2020-09-22T16:08:14Z", "type": "commit"}, {"oid": "d138fcfd9e7d2e30091202645a48497886c21428", "url": "https://github.com/google/ground-android/commit/d138fcfd9e7d2e30091202645a48497886c21428", "message": "Move authentication clases into auth package", "committedDate": "2020-09-22T16:08:14Z", "type": "commit"}, {"oid": "e8feb8b929c3ab52c8004dd8a3205d2bbc2e2d4e", "url": "https://github.com/google/ground-android/commit/e8feb8b929c3ab52c8004dd8a3205d2bbc2e2d4e", "message": "Create AuthenticationModule which can be uninstalled for tests", "committedDate": "2020-09-22T16:08:14Z", "type": "commit"}, {"oid": "8ed5b9bb7ddcaa23a11ee37ee291fc41eebfb1be", "url": "https://github.com/google/ground-android/commit/8ed5b9bb7ddcaa23a11ee37ee291fc41eebfb1be", "message": "Add minimum code for FakeAuthMgr to facilitate sign in", "committedDate": "2020-09-22T16:08:14Z", "type": "commit"}, {"oid": "860380b3cced590c64662e05e2089edad70cc0c2", "url": "https://github.com/google/ground-android/commit/860380b3cced590c64662e05e2089edad70cc0c2", "message": "Allow Timber output from tests", "committedDate": "2020-09-22T16:08:14Z", "type": "commit"}, {"oid": "de34924a82ad3fa074cce9e060acdf2daef1f926", "url": "https://github.com/google/ground-android/commit/de34924a82ad3fa074cce9e060acdf2daef1f926", "message": "Move remote storage dependencies into new module", "committedDate": "2020-09-22T16:08:14Z", "type": "commit"}, {"oid": "34be340b4c0f0494cdd63bdc65dfd63d428fe98c", "url": "https://github.com/google/ground-android/commit/34be340b4c0f0494cdd63bdc65dfd63d428fe98c", "message": "Hacky version of UI tests working", "committedDate": "2020-09-22T16:08:14Z", "type": "commit"}, {"oid": "dce4998bba8a2fd9ee04b954c95409b80e5252de", "url": "https://github.com/google/ground-android/commit/dce4998bba8a2fd9ee04b954c95409b80e5252de", "message": "Refactor test data into own class. Tidy up.", "committedDate": "2020-09-22T16:08:14Z", "type": "commit"}, {"oid": "3a1707625c64e64157d196204dcf1b3587c6c411", "url": "https://github.com/google/ground-android/commit/3a1707625c64e64157d196204dcf1b3587c6c411", "message": "Fix checkstyle issues. Also fixes #570 and #571", "committedDate": "2020-09-22T16:08:14Z", "type": "commit"}, {"oid": "fa5b8d1f850178af2052192fa24abb35cc48d4f4", "url": "https://github.com/google/ground-android/commit/fa5b8d1f850178af2052192fa24abb35cc48d4f4", "message": "Refactor test modules into own classes", "committedDate": "2020-09-22T16:08:14Z", "type": "commit"}, {"oid": "e3e140f667e13a03bfadb2ee42621318713cb337", "url": "https://github.com/google/ground-android/commit/e3e140f667e13a03bfadb2ee42621318713cb337", "message": "Remove InterruptedException", "committedDate": "2020-09-22T16:08:14Z", "type": "commit"}, {"oid": "e3996a6e502d7bcdcce547421fa747f24ac36ebc", "url": "https://github.com/google/ground-android/commit/e3996a6e502d7bcdcce547421fa747f24ac36ebc", "message": "Make instrumented tests use same (synchronous) scheduler as host tests", "committedDate": "2020-09-22T16:08:14Z", "type": "commit"}, {"oid": "0485da93af869f18d9e27e4c6e5f50990c11e5c8", "url": "https://github.com/google/ground-android/commit/0485da93af869f18d9e27e4c6e5f50990c11e5c8", "message": "Fix PMD error", "committedDate": "2020-09-22T16:08:14Z", "type": "commit"}, {"oid": "7b4e8dd9bf0d05a1053f70176e6692e95f5f6e29", "url": "https://github.com/google/ground-android/commit/7b4e8dd9bf0d05a1053f70176e6692e95f5f6e29", "message": "Attempt to remove Thread.sleep by disabling bottom sheet animations, adding RxIdler and adding databinding idling resource", "committedDate": "2020-09-22T16:08:14Z", "type": "commit"}, {"oid": "a30a1bfaef71d69aa7c08b1fee77412c9b73ff78", "url": "https://github.com/google/ground-android/commit/a30a1bfaef71d69aa7c08b1fee77412c9b73ff78", "message": "Change postValue to setValue", "committedDate": "2020-09-22T16:08:14Z", "type": "commit"}, {"oid": "80064895e9d09a6010576ee91a846392972a706d", "url": "https://github.com/google/ground-android/commit/80064895e9d09a6010576ee91a846392972a706d", "message": "Add back in code which shouldn't have been commented out", "committedDate": "2020-09-22T16:08:15Z", "type": "commit"}, {"oid": "bda7c8390058d9066613e9892ffc79f2fc1a20d8", "url": "https://github.com/google/ground-android/commit/bda7c8390058d9066613e9892ffc79f2fc1a20d8", "message": "Remove custom BottomSheetBehavior. Add back sleep. Tidy up code", "committedDate": "2020-09-22T16:08:15Z", "type": "commit"}, {"oid": "bda7c8390058d9066613e9892ffc79f2fc1a20d8", "url": "https://github.com/google/ground-android/commit/bda7c8390058d9066613e9892ffc79f2fc1a20d8", "message": "Remove custom BottomSheetBehavior. Add back sleep. Tidy up code", "committedDate": "2020-09-22T16:08:15Z", "type": "forcePushed"}, {"oid": "e7120e27f61ad53c10436dc81bfbc323c079a322", "url": "https://github.com/google/ground-android/commit/e7120e27f61ad53c10436dc81bfbc323c079a322", "message": "Some final tidy up and refactoring", "committedDate": "2020-09-22T19:26:17Z", "type": "commit"}, {"oid": "809208b50aef2deaee8f0f520691a9a0c3fc6aa9", "url": "https://github.com/google/ground-android/commit/809208b50aef2deaee8f0f520691a9a0c3fc6aa9", "message": "Fix checkstyle errors", "committedDate": "2020-09-22T19:54:33Z", "type": "commit"}]}