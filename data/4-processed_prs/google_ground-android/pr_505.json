{"pr_number": 505, "pr_title": "Migrate codebase from Dagger to Hilt", "pr_createdAt": "2020-06-27T10:18:09Z", "pr_url": "https://github.com/google/ground-android/pull/505", "timeline": [{"oid": "0fb9b3c977bafd09769e8dd481088814c00b2046", "url": "https://github.com/google/ground-android/commit/0fb9b3c977bafd09769e8dd481088814c00b2046", "message": "Add Hilt dependencies", "committedDate": "2020-06-25T14:35:42Z", "type": "commit"}, {"oid": "cd6bc120bc371904a79b781353710e85f13e83b8", "url": "https://github.com/google/ground-android/commit/cd6bc120bc371904a79b781353710e85f13e83b8", "message": "Migrate to Hilt ApplicationComponent", "committedDate": "2020-06-25T15:43:14Z", "type": "commit"}, {"oid": "c82c34c5639e76ec849bad1dce983fa856209804", "url": "https://github.com/google/ground-android/commit/c82c34c5639e76ec849bad1dce983fa856209804", "message": "Migrate to using Hilt Activity and Fragment components", "committedDate": "2020-06-25T15:51:47Z", "type": "commit"}, {"oid": "2a90339e4b51093fb888a57607225e9af50aa582", "url": "https://github.com/google/ground-android/commit/2a90339e4b51093fb888a57607225e9af50aa582", "message": "Remove Dagger Android dependencies", "committedDate": "2020-06-25T16:12:55Z", "type": "commit"}, {"oid": "2bd68e33450e7c9e82aff29587c3bf2059ac5792", "url": "https://github.com/google/ground-android/commit/2bd68e33450e7c9e82aff29587c3bf2059ac5792", "message": "Removing redundant classes", "committedDate": "2020-06-25T16:23:27Z", "type": "commit"}, {"oid": "ac19b61e1108c5ae17a9cc89b1f6106fb8141f54", "url": "https://github.com/google/ground-android/commit/ac19b61e1108c5ae17a9cc89b1f6106fb8141f54", "message": "Remove Dagger dependencies and commmented out code", "committedDate": "2020-06-26T21:26:48Z", "type": "commit"}, {"oid": "c2439d4d13b3a93dbc1322aaeaaa2bf0f07065e7", "url": "https://github.com/google/ground-android/commit/c2439d4d13b3a93dbc1322aaeaaa2bf0f07065e7", "message": "Replace GndWorkerFactory with HiltWorkerFactory", "committedDate": "2020-06-26T22:13:34Z", "type": "commit"}, {"oid": "ec50db26fdc01a849d5f65cd21739e9374cb984a", "url": "https://github.com/google/ground-android/commit/ec50db26fdc01a849d5f65cd21739e9374cb984a", "message": "Fix blank screen on startup by scoping Navigator to Activity", "committedDate": "2020-06-27T09:56:57Z", "type": "commit"}, {"oid": "eefd2165ef0309bf2ec78cd778a25c4db6b4d391", "url": "https://github.com/google/ground-android/commit/eefd2165ef0309bf2ec78cd778a25c4db6b4d391", "message": "Remove old modules", "committedDate": "2020-06-27T09:57:19Z", "type": "commit"}, {"oid": "a0243bbc6aa03fa18fa2129c06272ee65ed560c5", "url": "https://github.com/google/ground-android/commit/a0243bbc6aa03fa18fa2129c06272ee65ed560c5", "message": "Remove commented out code", "committedDate": "2020-06-27T10:34:54Z", "type": "commit"}, {"oid": "f990c7822cff88dfe0322bbb28e429d02bf67366", "url": "https://github.com/google/ground-android/commit/f990c7822cff88dfe0322bbb28e429d02bf67366", "message": "Add back @ActivityScoped to classes where it was accidentally removed", "committedDate": "2020-06-27T10:35:29Z", "type": "commit"}, {"oid": "544079b790d7c69ba04d412c1c44a2f59af58121", "url": "https://github.com/google/ground-android/commit/544079b790d7c69ba04d412c1c44a2f59af58121", "message": "Fix checkstyle issue - line length", "committedDate": "2020-06-28T19:48:33Z", "type": "commit"}, {"oid": "9dcc1da4d10465ff13b7adfdea23295a22567bb5", "url": "https://github.com/google/ground-android/commit/9dcc1da4d10465ff13b7adfdea23295a22567bb5", "message": "Migrate robolectric tests", "committedDate": "2020-06-29T11:04:16Z", "type": "forcePushed"}, {"oid": "8f0f425729e7f789f199a6be2c71a5e582d44816", "url": "https://github.com/google/ground-android/commit/8f0f425729e7f789f199a6be2c71a5e582d44816", "message": "Migrate robolectric tests", "committedDate": "2020-06-29T11:16:49Z", "type": "commit"}, {"oid": "8f0f425729e7f789f199a6be2c71a5e582d44816", "url": "https://github.com/google/ground-android/commit/8f0f425729e7f789f199a6be2c71a5e582d44816", "message": "Migrate robolectric tests", "committedDate": "2020-06-29T11:16:49Z", "type": "forcePushed"}, {"oid": "79c2bc2c73eaed5fd2a5fad340e5bfd3f1a560c9", "url": "https://github.com/google/ground-android/commit/79c2bc2c73eaed5fd2a5fad340e5bfd3f1a560c9", "message": "Remove the default WorkManager initializer (which was causing lintDebug to fail)", "committedDate": "2020-06-29T11:36:50Z", "type": "commit"}, {"oid": "decbe2a9bd850bd12915930382e2511648dc64a5", "url": "https://github.com/google/ground-android/commit/decbe2a9bd850bd12915930382e2511648dc64a5", "message": "Fix PMD errors. Remove unused imports & change MainActivity super.onCreate call order", "committedDate": "2020-06-29T13:12:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4OTc0OA==", "url": "https://github.com/google/ground-android/pull/505#discussion_r446989748", "bodyText": "daggerVersion can be removed from this list now", "author": "shobhitagarwal1612", "createdAt": "2020-06-29T13:54:43Z", "path": "gnd/build.gradle", "diffHunk": "@@ -29,6 +30,7 @@ project.ext {\n     daggerVersion = \"2.27\"", "originalCommit": "decbe2a9bd850bd12915930382e2511648dc64a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5MDkyOA==", "url": "https://github.com/google/ground-android/pull/505#discussion_r446990928", "bodyText": "Sorry for nit-picking. But can we please remove the parentheses for consistency across all dependencies?", "author": "shobhitagarwal1612", "createdAt": "2020-06-29T13:56:17Z", "path": "gnd/build.gradle", "diffHunk": "@@ -136,14 +141,15 @@ dependencies {\n     implementation 'com.google.firebase:firebase-storage:19.1.1'\n     implementation 'com.google.firebase:firebase-crashlytics:17.0.1'\n \n-    // Dagger\n-    implementation \"com.google.dagger:dagger:$project.daggerVersion\"\n-    implementation \"com.google.dagger:dagger-android:$project.daggerVersion\"\n-    implementation \"com.google.dagger:dagger-android-support:$project.daggerVersion\"\n-    annotationProcessor \"com.google.dagger:dagger-android-processor:$project.daggerVersion\"\n-    annotationProcessor \"com.google.dagger:dagger-compiler:$project.daggerVersion\"\n-    testAnnotationProcessor \"com.google.dagger:dagger-compiler:$project.daggerVersion\"\n-    androidTestAnnotationProcessor \"com.google.dagger:dagger-compiler:$project.daggerVersion\"\n+    // Hilt\n+    implementation(\"com.google.dagger:hilt-android:$project.hiltVersion\")\n+    implementation(\"androidx.hilt:hilt-lifecycle-viewmodel:$project.hiltJetpackVersion\")\n+    implementation(\"androidx.hilt:hilt-work:$project.hiltJetpackVersion\")\n+    androidTestImplementation(\"com.google.dagger:hilt-android-testing:$project.hiltVersion\")\n+    annotationProcessor(\"com.google.dagger:hilt-android-compiler:$project.hiltVersion\")\n+    annotationProcessor(\"androidx.hilt:hilt-compiler:$project.hiltJetpackVersion\")\n+    androidTestAnnotationProcessor(\"com.google.dagger:hilt-android-compiler:$project.hiltVersion\")\n+    androidTestAnnotationProcessor(\"androidx.hilt:hilt-compiler:$project.hiltJetpackVersion\")", "originalCommit": "decbe2a9bd850bd12915930382e2511648dc64a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAyODk4Ng==", "url": "https://github.com/google/ground-android/pull/505#discussion_r447028986", "bodyText": "Nit away, consistency is king :)", "author": "dturner", "createdAt": "2020-06-29T14:48:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5MDkyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5MjI3Mw==", "url": "https://github.com/google/ground-android/pull/505#discussion_r446992273", "bodyText": "Can we please move these up with rest of the hilt dependencies?", "author": "shobhitagarwal1612", "createdAt": "2020-06-29T13:58:04Z", "path": "gnd/build.gradle", "diffHunk": "@@ -206,6 +212,8 @@ dependencies {\n     testImplementation 'androidx.test:core:1.2.0'\n     testImplementation 'org.robolectric:robolectric:4.3.1'\n     testImplementation 'android.arch.core:core-testing:1.1.1'\n+    testImplementation 'com.google.dagger:hilt-android-testing:2.28-alpha'\n+    testAnnotationProcessor 'com.google.dagger:hilt-android-compiler:2.28-alpha'", "originalCommit": "decbe2a9bd850bd12915930382e2511648dc64a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5NTA4OQ==", "url": "https://github.com/google/ground-android/pull/505#discussion_r446995089", "bodyText": "I am curious why this is needed? I understand that this is useful when we have to do some custom initialization, but I am not sure that we do. Do we?", "author": "shobhitagarwal1612", "createdAt": "2020-06-29T14:01:55Z", "path": "gnd/src/main/AndroidManifest.xml", "diffHunk": "@@ -70,18 +70,11 @@\n       android:name=\"org.apache.http.legacy\"\n       android:required=\"false\" />\n \n-    <!--\n-      Disable WorkManagerInitializer so that we can initialize ourselves in GndApplication setting\n-      custom GndWorkerFactory to perform Dagger injection.\n-      TODO(github.com/google/dagger/issues/1183): Remove this if and when Worker inject is supported\n-      natively.\n-    -->\n+    <!-- Remove the default WorkManager initializer since we are providing our own -->\n     <provider\n       android:name=\"androidx.work.impl.WorkManagerInitializer\"\n-      android:authorities=\"com.google.android.gnd.workmanager-init\"\n-      android:enabled=\"false\"\n-      android:exported=\"false\"\n-      tools:replace=\"android:authorities\" />\n+      android:authorities=\"${applicationId}.workmanager-init\"\n+      tools:node=\"remove\" />", "originalCommit": "decbe2a9bd850bd12915930382e2511648dc64a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAyNzA2Mw==", "url": "https://github.com/google/ground-android/pull/505#discussion_r447027063", "bodyText": "It's because we're using the HiltWorkerFactory from Jetpack (https://developer.android.com/training/dependency-injection/hilt-jetpack#workmanager) so we have to remove the default initializer.", "author": "dturner", "createdAt": "2020-06-29T14:45:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5NTA4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA0NDM2Mg==", "url": "https://github.com/google/ground-android/pull/505#discussion_r447044362", "bodyText": "Based on the \"WorkManager is not initialized properly\" crash which I'm also getting, this may not be implemented correctly. Currently investigating.", "author": "dturner", "createdAt": "2020-06-29T15:08:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5NTA4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5NTg2OA==", "url": "https://github.com/google/ground-android/pull/505#discussion_r446995868", "bodyText": "We should update this comment as it is out-of-date now", "author": "shobhitagarwal1612", "createdAt": "2020-06-29T14:02:58Z", "path": "gnd/src/main/java/com/google/android/gnd/GndApplication.java", "diffHunk": "@@ -16,30 +16,31 @@\n \n package com.google.android.gnd;\n \n+import android.app.Application;\n import android.content.Context;\n import android.os.StrictMode;\n import android.util.Log;\n import androidx.annotation.NonNull;\n+import androidx.hilt.work.HiltWorkerFactory;\n import androidx.multidex.MultiDex;\n import androidx.work.Configuration;\n-import androidx.work.WorkManager;\n import com.akaita.java.rxjava2debug.RxJava2Debug;\n import com.facebook.stetho.Stetho;\n-import com.google.android.gnd.inject.GndWorkerFactory;\n import com.google.android.gnd.rx.RxDebug;\n import com.google.firebase.crashlytics.FirebaseCrashlytics;\n-import dagger.android.AndroidInjector;\n-import dagger.android.support.DaggerApplication;\n+import dagger.hilt.android.HiltAndroidApp;\n import io.reactivex.plugins.RxJavaPlugins;\n import javax.inject.Inject;\n+import org.jetbrains.annotations.NotNull;\n import timber.log.Timber;\n \n // TODO: When implementing background data sync service, we'll need to inject a Service here; we\n // should then extend DaggerApplication instead. If MultiDex is still needed, we can install it\n // without extending MultiDexApplication.", "originalCommit": "decbe2a9bd850bd12915930382e2511648dc64a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA2NjY5Mg==", "url": "https://github.com/google/ground-android/pull/505#discussion_r447066692", "bodyText": "@gino-m Is this comment (or something similar) still required?", "author": "dturner", "createdAt": "2020-06-29T15:39:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5NTg2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA3MDgxNw==", "url": "https://github.com/google/ground-android/pull/505#discussion_r447070817", "bodyText": "I think it can be removed, since we're not using Services, and Workers appear to be injected here w/o additional changes. Thanks!", "author": "gino-m", "createdAt": "2020-06-29T15:45:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5NTg2OA=="}], "type": "inlineReview"}, {"oid": "a3efe2628d43870844e549ee4bdeae4482cd44eb", "url": "https://github.com/google/ground-android/commit/a3efe2628d43870844e549ee4bdeae4482cd44eb", "message": "Remove daggerVersion", "committedDate": "2020-06-29T14:47:25Z", "type": "commit"}, {"oid": "079a732d2fc2f14b40420b388f6acd653a2da6c4", "url": "https://github.com/google/ground-android/commit/079a732d2fc2f14b40420b388f6acd653a2da6c4", "message": "Remove parenthesis", "committedDate": "2020-06-29T14:49:06Z", "type": "commit"}, {"oid": "f053399a68c1d1cf0847eef403bd37aa4c0516fc", "url": "https://github.com/google/ground-android/commit/f053399a68c1d1cf0847eef403bd37aa4c0516fc", "message": "Fix crash by initializing WorkManager", "committedDate": "2020-06-29T15:36:19Z", "type": "commit"}, {"oid": "698fdc1206f5106a2e2c51fa5fc1f534f0db82fd", "url": "https://github.com/google/ground-android/commit/698fdc1206f5106a2e2c51fa5fc1f534f0db82fd", "message": "Remove comment", "committedDate": "2020-06-29T16:21:35Z", "type": "commit"}, {"oid": "6b9503210d9645b9331b9e26dce284309b63f92b", "url": "https://github.com/google/ground-android/commit/6b9503210d9645b9331b9e26dce284309b63f92b", "message": "Group hilt dependencies together", "committedDate": "2020-06-29T16:23:50Z", "type": "commit"}, {"oid": "2f7433a8ecf5e1ead030223abfa67396bfca3f56", "url": "https://github.com/google/ground-android/commit/2f7433a8ecf5e1ead030223abfa67396bfca3f56", "message": "Merge branch 'master' into hilt-migration", "committedDate": "2020-06-30T19:15:11Z", "type": "commit"}]}