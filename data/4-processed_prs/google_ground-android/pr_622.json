{"pr_number": 622, "pr_title": "[Map] Fix NPE when rotating screen after selecting map type", "pr_createdAt": "2020-11-10T12:16:03Z", "pr_url": "https://github.com/google/ground-android/pull/622", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxODMxMw==", "url": "https://github.com/google/ground-android/pull/622#discussion_r520518313", "bodyText": "I also considered using a flowable processor which converts events to LiveData. But the problem with that is, it always emits the last value on resubscription. So, the dialog would pop-up again and again after every rotation (or any config change).", "author": "shobhitagarwal1612", "createdAt": "2020-11-10T12:17:44Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/home/mapcontainer/MapContainerFragment.java", "diffHunk": "@@ -163,6 +146,24 @@ private void onMapReady(MapAdapter map) {\n     binding.moveFeature.cancelButton.setOnClickListener(__ -> setDefaultMode());\n     enableLocationLockBtn();\n     mapContainerViewModel.getMbtilesFilePaths().observe(this, map::addTileOverlays);\n+    mapContainerViewModel.getSelectMapTypeClicks()\n+        .as(autoDisposable(getViewLifecycleOwner()))", "originalCommit": "0efca49d11db4b2a0a0302c635c8129d44aa1d72", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMzMDM2Mg==", "url": "https://github.com/google/ground-android/pull/622#discussion_r521330362", "bodyText": "That shouldn't be the case; Flowables would only emit the last item if you use buffer strategy \"latest\". I think this is the most likely cause, since selectMapTypeClicks is a PublishSubject, which doesn't cache the last value.\nIf you're still having trouble with duplicate requests, consider using com.google.android.gnd.rx.Event to wrap the value, and only processing it using its ifUnhandled() method.", "author": "gino-m", "createdAt": "2020-11-11T12:40:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxODMxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk4NjQzNA==", "url": "https://github.com/google/ground-android/pull/622#discussion_r521986434", "bodyText": "Done", "author": "shobhitagarwal1612", "createdAt": "2020-11-12T10:08:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxODMxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxOTYxMg==", "url": "https://github.com/google/ground-android/pull/622#discussion_r520519612", "bodyText": "These changes were unintentional. IDE added these after running \"reformat file\".", "author": "shobhitagarwal1612", "createdAt": "2020-11-10T12:20:08Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/home/mapcontainer/MapContainerViewModel.java", "diffHunk": "@@ -300,8 +305,8 @@ public void setSelectedFeature(Optional<Feature> selectedFeature) {\n \n   static class CameraUpdate {\n \n-    private Point center;\n-    private Optional<Float> minZoomLevel;\n+    private final Point center;\n+    private final Optional<Float> minZoomLevel;", "originalCommit": "0efca49d11db4b2a0a0302c635c8129d44aa1d72", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMzMDYxNw==", "url": "https://github.com/google/ground-android/pull/622#discussion_r521330617", "bodyText": "Ok", "author": "gino-m", "createdAt": "2020-11-11T12:41:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxOTYxMg=="}], "type": "inlineReview"}, {"oid": "e13fe36cb86f5b40ed0ce3ddd91955ec5d42b78b", "url": "https://github.com/google/ground-android/commit/e13fe36cb86f5b40ed0ce3ddd91955ec5d42b78b", "message": "Subscribe for mapType clicks when the map is ready to prevent NPE", "committedDate": "2020-11-11T11:51:45Z", "type": "forcePushed"}, {"oid": "9e9b9f357402216bfb7dc4bdf89bfae0108ae28d", "url": "https://github.com/google/ground-android/commit/9e9b9f357402216bfb7dc4bdf89bfae0108ae28d", "message": "Subscribe for mapType clicks when the map is ready to prevent NPE", "committedDate": "2020-11-12T09:32:12Z", "type": "commit"}, {"oid": "edf04fdb0ffa0acf5c1a4469f2f3f3d0ef65baa1", "url": "https://github.com/google/ground-android/commit/edf04fdb0ffa0acf5c1a4469f2f3f3d0ef65baa1", "message": "Simplify by replacing PublishSubject with MutableLiveData", "committedDate": "2020-11-12T10:07:50Z", "type": "commit"}, {"oid": "edf04fdb0ffa0acf5c1a4469f2f3f3d0ef65baa1", "url": "https://github.com/google/ground-android/commit/edf04fdb0ffa0acf5c1a4469f2f3f3d0ef65baa1", "message": "Simplify by replacing PublishSubject with MutableLiveData", "committedDate": "2020-11-12T10:07:50Z", "type": "forcePushed"}]}