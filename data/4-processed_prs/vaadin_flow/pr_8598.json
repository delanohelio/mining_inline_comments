{"pr_number": 8598, "pr_title": "Add impliesRequired Validator flag", "pr_createdAt": "2020-06-22T10:44:11Z", "pr_url": "https://github.com/vaadin/flow/pull/8598", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA4MjY2OA==", "url": "https://github.com/vaadin/flow/pull/8598#discussion_r444082668", "bodyText": "This relies on presence of impliesRequired: true validator now, does not need to assess the validator type anymore.", "author": "platosha", "createdAt": "2020-06-23T09:17:30Z", "path": "flow-client/src/main/resources/META-INF/resources/frontend/form/BinderNode.ts", "diffHunk": "@@ -153,15 +152,7 @@ export class BinderNode<T, M extends AbstractModel<T>> {\n   }\n \n   get required() {\n-    return !!this[validatorsSymbol].find(val => {\n-      if (val instanceof Required) {\n-        return true;\n-      } else if (val instanceof Size) {\n-        const min = (val as Size).value.min;\n-        return min && min > 0;\n-      }\n-      return false;\n-    });\n+    return !!this[validatorsSymbol].find(val => !!val.impliesRequired);", "originalCommit": "4168278f4ca2f4f94ac9e626da51d04bc5e73eef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcwNDQ1Nw==", "url": "https://github.com/vaadin/flow/pull/8598#discussion_r444704457", "bodyText": "This can be slightly simplified by using some() (which returns a boolean) instead of find().\nAlso imo the explicit boolean cast !! inside the callback is unnecessary in this case (but it's also ok).\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                return !!this[validatorsSymbol].find(val => !!val.impliesRequired);\n          \n          \n            \n                return this[validatorsSymbol].some(validator => validator.impliesRequired);", "author": "Haprog", "createdAt": "2020-06-24T07:41:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA4MjY2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA4NTA1NQ==", "url": "https://github.com/vaadin/flow/pull/8598#discussion_r444085055", "bodyText": "Renamed from options to attributes for couple of reasons:\n\nmost often these are not optional, but rather required for validators to specify\nin Java annotations the term attributes is used\n\nAlso used interfaces instead of type aliases for consistency, as all of them specify object contents.", "author": "platosha", "createdAt": "2020-06-23T09:21:37Z", "path": "flow-client/src/main/resources/META-INF/resources/frontend/form/Validators.ts", "diffHunk": "@@ -3,24 +3,40 @@\n import * as validator from 'validator';\n import { Validator } from './Validation';\n \n-interface FormOptions { message?: string };\n-type ValueNumberOptions = FormOptions & { value: number | string };\n-type DigitOptions = FormOptions & { integer: number, fraction: number };\n-type SizeOptions = FormOptions & { min?: number, max?: number };\n-type PatternOptions = FormOptions & { regexp: RegExp | string };\n-type DecimalOptions = ValueNumberOptions & { inclusive: boolean | undefined };\n+interface ValidatorAttributes {", "originalCommit": "4168278f4ca2f4f94ac9e626da51d04bc5e73eef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA4NjAzMQ==", "url": "https://github.com/vaadin/flow/pull/8598#discussion_r444086031", "bodyText": "Added a flag. The old value referred to validator constrain argument (e. g., minimum value specified in annotation), removed from here to reduce confusion.", "author": "platosha", "createdAt": "2020-06-23T09:23:13Z", "path": "flow-client/src/main/resources/META-INF/resources/frontend/form/Validation.ts", "diffHunk": "@@ -29,7 +29,7 @@ export type ValidationCallback<T> = (value: T) => boolean | ValueError<T> | void\n export interface Validator<T> {\n   validate: ValidationCallback<T>,\n   message: string,\n-  value?: any\n+  impliesRequired?: boolean", "originalCommit": "4168278f4ca2f4f94ac9e626da51d04bc5e73eef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA4NjA3MA==", "url": "https://github.com/vaadin/flow/pull/8598#discussion_r444086070", "bodyText": "Not strictly required in runtime, but still specifying this explicitly. This allows for simple asserting false in the tests.", "author": "platosha", "createdAt": "2020-06-23T09:23:16Z", "path": "flow-client/src/main/resources/META-INF/resources/frontend/form/Validators.ts", "diffHunk": "@@ -3,24 +3,40 @@\n import * as validator from 'validator';\n import { Validator } from './Validation';\n \n-interface FormOptions { message?: string };\n-type ValueNumberOptions = FormOptions & { value: number | string };\n-type DigitOptions = FormOptions & { integer: number, fraction: number };\n-type SizeOptions = FormOptions & { min?: number, max?: number };\n-type PatternOptions = FormOptions & { regexp: RegExp | string };\n-type DecimalOptions = ValueNumberOptions & { inclusive: boolean | undefined };\n+interface ValidatorAttributes {\n+  message?: string;\n+}\n+interface ValueNumberAttributes extends ValidatorAttributes {\n+  value: number | string;\n+}\n+interface DigitAttributes extends ValidatorAttributes {\n+  integer: number;\n+  fraction: number;\n+}\n+interface SizeAttributes extends ValidatorAttributes {\n+  min?: number;\n+  max?: number;\n+}\n+interface PatternAttributes extends ValidatorAttributes {\n+  regexp: RegExp | string;\n+}\n+interface DecimalAttributes extends ValueNumberAttributes {\n+  inclusive?: boolean;\n+}\n \n abstract class AbstractValidator<T> implements Validator<T> {\n   message = 'invalid';\n-  constructor(options?: FormOptions) {\n-    if (options && options.message) {\n-      this.message = options.message;\n+  impliesRequired = false;", "originalCommit": "4168278f4ca2f4f94ac9e626da51d04bc5e73eef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA4NzM1NQ==", "url": "https://github.com/vaadin/flow/pull/8598#discussion_r444087355", "bodyText": "Exposed attribute keys on the validator directly, removing the wrapper object for consistency with other validators.", "author": "platosha", "createdAt": "2020-06-23T09:25:18Z", "path": "flow-client/src/main/resources/META-INF/resources/frontend/form/Validators.ts", "diffHunk": "@@ -97,28 +113,35 @@ export class PositiveOrZero extends AbstractValidator<any> {\n }\n \n export class Size extends AbstractValidator<string> {\n-  value: SizeOptions;\n-  constructor(opts: SizeOptions) {\n-    super(opts);\n-    this.value = { min: opts.min || 0, max: opts.max || 0x7fffffff };\n+  min: number;", "originalCommit": "4168278f4ca2f4f94ac9e626da51d04bc5e73eef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA5MDY0Mw==", "url": "https://github.com/vaadin/flow/pull/8598#discussion_r444090643", "bodyText": "Minimum greater than zero means required.", "author": "platosha", "createdAt": "2020-06-23T09:30:44Z", "path": "flow-client/src/main/resources/META-INF/resources/frontend/form/Validators.ts", "diffHunk": "@@ -97,28 +113,35 @@ export class PositiveOrZero extends AbstractValidator<any> {\n }\n \n export class Size extends AbstractValidator<string> {\n-  value: SizeOptions;\n-  constructor(opts: SizeOptions) {\n-    super(opts);\n-    this.value = { min: opts.min || 0, max: opts.max || 0x7fffffff };\n+  min: number;\n+  max: number;\n+  constructor(attrs: SizeAttributes) {\n+    super(attrs);\n+    this.min = attrs.min || 0;\n+    this.max = attrs.max || Number.MAX_SAFE_INTEGER;\n+    if (this.min > 0) {\n+      this.impliesRequired = true;", "originalCommit": "4168278f4ca2f4f94ac9e626da51d04bc5e73eef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "55bf22fe44495cdc547b487bb8c76dda7c9e64cc", "url": "https://github.com/vaadin/flow/commit/55bf22fe44495cdc547b487bb8c76dda7c9e64cc", "message": "Add impliesRequired flag to client-side Validator interface\n\nFixes #8551", "committedDate": "2020-06-23T09:34:02Z", "type": "commit"}, {"oid": "55bf22fe44495cdc547b487bb8c76dda7c9e64cc", "url": "https://github.com/vaadin/flow/commit/55bf22fe44495cdc547b487bb8c76dda7c9e64cc", "message": "Add impliesRequired flag to client-side Validator interface\n\nFixes #8551", "committedDate": "2020-06-23T09:34:02Z", "type": "forcePushed"}, {"oid": "8b690324aa9ccf2070bdde4d6082894f8eb0f9d9", "url": "https://github.com/vaadin/flow/commit/8b690324aa9ccf2070bdde4d6082894f8eb0f9d9", "message": "Update flow-client/src/main/resources/META-INF/resources/frontend/form/BinderNode.ts\n\nCo-authored-by: Kari S\u00f6derholm <haprog@vaadin.com>", "committedDate": "2020-06-24T10:11:54Z", "type": "commit"}]}