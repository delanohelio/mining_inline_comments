{"pr_number": 9280, "pr_title": "Fix navigation fallback", "pr_createdAt": "2020-11-02T11:34:53Z", "pr_url": "https://github.com/vaadin/flow/pull/9280", "timeline": [{"oid": "b43ecb54672863d2bbed8813d67e70c053d879b8", "url": "https://github.com/vaadin/flow/commit/b43ecb54672863d2bbed8813d67e70c053d879b8", "message": "test: add IT for offline start at non-root URL\n\nShould fail for the issue described in #9218 but currently this is a false positive. Needs a bit more work.", "committedDate": "2020-11-02T11:27:12Z", "type": "commit"}, {"oid": "7d6e29114d794b9a97044846c08dcc1df8b413bd", "url": "https://github.com/vaadin/flow/commit/7d6e29114d794b9a97044846c08dcc1df8b413bd", "message": "fix: navigation fallback\n\nFixes #9218", "committedDate": "2020-11-02T11:27:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTkxNjM1Mg==", "url": "https://github.com/vaadin/flow/pull/9280#discussion_r515916352", "bodyText": "This is the main change here.\nThe else block (which used to separately handle offline start situation) from previous if (OFFLINE_PATH_ENABLED) { is removed. The main condition is now on this line. Otherwise the contents that were inside the if is kept as is.", "author": "Haprog", "createdAt": "2020-11-02T11:42:57Z", "path": "flow-server/src/main/resources/sw.ts", "diffHunk": "@@ -5,43 +5,33 @@ import {skipWaiting, clientsClaim} from 'workbox-core';\n import {matchPrecache, precacheAndRoute} from 'workbox-precaching';\n import {NavigationRoute, registerRoute} from 'workbox-routing';\n import {PrecacheEntry} from 'workbox-precaching/_types';\n-import {NetworkFirst, NetworkOnly} from 'workbox-strategies';\n+import {NetworkOnly} from 'workbox-strategies';\n \n skipWaiting();\n clientsClaim();\n \n-let navigationFallback;\n-// @ts-ignore: OFFLINE_PATH_ENABLED is defined by webpack.generated.js\n-if (OFFLINE_PATH_ENABLED) {\n-  // @ts-ignore\n-  const offlinePath = '/' + OFFLINE_PATH;\n-  const networkOnly = new NetworkOnly();\n-  navigationFallback = new NavigationRoute(async (params: any) => {\n-    // Use offlinePath fallback if offline was detected\n-    if (!self.navigator.onLine) {\n-      const offlinePathPrecachedResponse = await matchPrecache(offlinePath);\n-      if (offlinePathPrecachedResponse) {\n-        return offlinePathPrecachedResponse;\n-      }\n+const appShellPath = '/';\n+// @ts-ignore: OFFLINE_PATH_ENABLED and OFFLINE_PATH are defined by webpack.generated.js\n+const offlinePath = OFFLINE_PATH_ENABLED ? '/' + OFFLINE_PATH : appShellPath;", "originalCommit": "7d6e29114d794b9a97044846c08dcc1df8b413bd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ea104a67ba54e9483a4f4d2c8cd6258de003e73c", "url": "https://github.com/vaadin/flow/commit/ea104a67ba54e9483a4f4d2c8cd6258de003e73c", "message": "deferred call submission status API refactor (#9304)\n\n- use DeferredCallHandler class instead of a callback function\r\n- instead of relying on re-throwing error to keep the deferred request in the queue, \r\n  now it uses deferredCallSubmitter.keepDeferredCallInTheQueue();\r\n- renamed EndpointRequest to DeferredCall\r\n- created a common interface EndpointCallMetaInfo for holding the meta info of an \r\n  endpoint call. Both MiddlewareContext and DeferredCall extend from it.\r\n- split offline related code to a separate Offline.ts file\r\n\r\nFixes #9243.", "committedDate": "2020-11-04T13:35:40Z", "type": "commit"}, {"oid": "c941eacf065d4bad742f575403e318feef25b993", "url": "https://github.com/vaadin/flow/commit/c941eacf065d4bad742f575403e318feef25b993", "message": "Merge branch 'feature/offline' into haprog/fix-nav-fallback", "committedDate": "2020-11-04T13:37:06Z", "type": "commit"}]}