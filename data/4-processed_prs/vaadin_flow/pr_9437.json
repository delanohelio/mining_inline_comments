{"pr_number": 9437, "pr_title": "Cherry Picks for 2.4", "pr_createdAt": "2020-11-18T12:53:49Z", "pr_url": "https://github.com/vaadin/flow/pull/9437", "timeline": [{"oid": "acf539766a09aa51f66409177ff5558b2e8d8492", "url": "https://github.com/vaadin/flow/commit/acf539766a09aa51f66409177ff5558b2e8d8492", "message": "fix: check if Url contains directory change in Dev Mode (#9392)\n\nChecks whether the Url contains a directory change and a double encoding in Dev Mode. Returns 403 Forbidden immediately and skip the request handling, if does.\n\n(cherry picked from commit 19fe3864f9d1567c5ac7a211189986ac093e781f)", "committedDate": "2020-11-18T12:43:20Z", "type": "commit"}, {"oid": "f8797a3048ff4163af82b4359c5fda1a8fdf2234", "url": "https://github.com/vaadin/flow/commit/f8797a3048ff4163af82b4359c5fda1a8fdf2234", "message": "fix: support Range requests with either start or end byte index omitted (#9368)\n\nSupports headers of the type Range: -123 and Range: 123-.\n\nFixes #9083.\n\n(cherry picked from commit ff28dd041ce8f477b4a0734c37540cec71ea524d)", "committedDate": "2020-11-18T13:22:14Z", "type": "commit"}, {"oid": "2eea21099e426a6e89c213ef0b8cc6da6a28a8a0", "url": "https://github.com/vaadin/flow/commit/2eea21099e426a6e89c213ef0b8cc6da6a28a8a0", "message": "fix: Simplify check for recursive Composite::getContent() (#9180)\n\nUsing a regular instance field instead of a non-static ThreadLocal has\nno functional difference except in the hypothetical case when\ngetContent() would be called concurrently on a different thread. That\ncase is not supposed to happen since the session lock should be used to\nprevent concurrent access. Furthermore, concurrent invocation would\nstill not work properly since use of the `content` field is not\nsynchronized.\n\nA simple boolean communicates the intent more clearly, thus making the\npurpose of the implementation easier to understand. The simpler approach\nalso has a minimal positive impact on CPU usage and memory allocation.\n\nFixes #9160\n\n(cherry picked from commit 51f0eda33063e00b4cdc79e97f4724159ea9a09f)", "committedDate": "2020-11-18T13:42:40Z", "type": "commit"}, {"oid": "181daee6b776e628e947b6f2d746f30816a2700f", "url": "https://github.com/vaadin/flow/commit/181daee6b776e628e947b6f2d746f30816a2700f", "message": "test: run UriValidationIT with DevMode and JS resource", "committedDate": "2020-11-18T17:12:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMwOTM2NA==", "url": "https://github.com/vaadin/flow/pull/9437#discussion_r526309364", "bodyText": "Define and throw a dedicated exception instead of using a generic one.", "author": "vaadin-bot", "createdAt": "2020-11-18T18:03:25Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/HandlerHelper.java", "diffHunk": "@@ -171,4 +184,26 @@ public static String getCancelingRelativePath(String pathToCancel) {\n         return sb.toString();\n     }\n \n+    /**\n+     * Checks if the given URL path contains the directory change instruction\n+     * (dot-dot), taking into account possible double encoding in hexadecimal\n+     * format, which can be injected maliciously.\n+     *\n+     * @param path\n+     *            the URL path to be verified.\n+     * @return {@code true}, if the given path has a directory change\n+     *         instruction, {@code false} otherwise.\n+     */\n+    static boolean isPathUnsafe(String path) {\n+        // Check that the path does not have '/../', '\\..\\', %5C..%5C,\n+        // %2F..%2F, nor '/..', '\\..', %5C.., %2F..\n+        try {\n+            path = URLDecoder.decode(path, StandardCharsets.UTF_8.name());\n+        } catch (UnsupportedEncodingException e) {\n+            throw new RuntimeException(\"An error occurred during decoding URL.\",", "originalCommit": "181daee6b776e628e947b6f2d746f30816a2700f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a21e0550db17899921a35b887df00a471699a85e", "url": "https://github.com/vaadin/flow/commit/a21e0550db17899921a35b887df00a471699a85e", "message": "chore: update header", "committedDate": "2020-11-18T18:35:50Z", "type": "commit"}]}