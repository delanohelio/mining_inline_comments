{"pr_number": 8580, "pr_title": "Enable generating self-referencing arrays in TypeScript models", "pr_createdAt": "2020-06-17T15:14:36Z", "pr_url": "https://github.com/vaadin/flow/pull/8580", "timeline": [{"oid": "d1df42094fac93aa1f8ab5c4afc04ef0cb3fdb1c", "url": "https://github.com/vaadin/flow/commit/d1df42094fac93aa1f8ab5c4afc04ef0cb3fdb1c", "message": "Enable generating self-referencing arrays in TypeScript models\n\nFixes #8515", "committedDate": "2020-06-17T15:14:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgxMTgxNA==", "url": "https://github.com/vaadin/flow/pull/8580#discussion_r441811814", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            /* Copyright 2000-2020 Vaadin Ltd.\n          \n          \n            \n            /*\n          \n          \n            \n             * Copyright 2000-2020 Vaadin Ltd.\n          \n          \n            \n             *", "author": "vlukashov", "createdAt": "2020-06-17T20:24:41Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/connect/generator/VaadinConnectTsGenerator.java", "diffHunk": "@@ -1,6 +1,4 @@\n-/*\n- * Copyright 2000-2020 Vaadin Ltd.\n- *\n+/* Copyright 2000-2020 Vaadin Ltd.", "originalCommit": "d1df42094fac93aa1f8ab5c4afc04ef0cb3fdb1c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f8ab6cb45c2b939cf1f79b68160a6fd392826102", "url": "https://github.com/vaadin/flow/commit/f8ab6cb45c2b939cf1f79b68160a6fd392826102", "message": "revert changes to the copyright header", "committedDate": "2020-06-17T20:25:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgzOTI3NQ==", "url": "https://github.com/vaadin/flow/pull/8580#discussion_r441839275", "bodyText": "This fails for multidimensional arrays like int[][]. The failure is also present in the master branch (i.e. it's not introduced by this PR), so I would not mark it as a blocking review comment here. Instead, I've created a separate issue to fix it: #8582\nAs a side note, regex is usually not an appropriate tool to parse source code. In the best case it creates difficult to detect but fixable bugs (like this one). And in the worst case it is theoretically proven to be insufficient for the task (e.g. see https://stackoverflow.com/a/1732454).\nI have not checked whether type declarations in TypeScript follow a regular grammar (i.e. that they in principle can be parsed with a regex). Maybe.", "author": "vlukashov", "createdAt": "2020-06-17T21:16:38Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/connect/generator/VaadinConnectTsGenerator.java", "diffHunk": "@@ -518,7 +518,22 @@ private String getSimpleNameFromImports(String dataType,\n         return getSimpleNameFromQualifiedName(dataType);\n     }\n \n-    private String getModeleConstructor(CodegenProperty property,\n+    private String getModelType(CodegenProperty property,\n+            List<Map<String, String>> imports) {\n+        String simpleName = getSimpleNameFromImports(property.datatype,\n+                imports);\n+\n+        Matcher matcher = Pattern.compile(\"Array<(.+)>\").matcher(simpleName);", "originalCommit": "f8ab6cb45c2b939cf1f79b68160a6fd392826102", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}