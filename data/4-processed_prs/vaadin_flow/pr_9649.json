{"pr_number": 9649, "pr_title": "fix(offline): simple state transitions when only Connect client is loaded", "pr_createdAt": "2020-12-14T14:56:09Z", "pr_url": "https://github.com/vaadin/flow/pull/9649", "timeline": [{"oid": "5d142189beb7362b9ee50fe197d251a0a7a58c9d", "url": "https://github.com/vaadin/flow/commit/5d142189beb7362b9ee50fe197d251a0a7a58c9d", "message": "fix: simple state transitions when only Connect client is loaded", "committedDate": "2020-12-14T14:19:05Z", "type": "commit"}, {"oid": "bfdd30a9c1f9d508c1977615350aab645905a853", "url": "https://github.com/vaadin/flow/commit/bfdd30a9c1f9d508c1977615350aab645905a853", "message": "Merge branch 'feature/offline' into joheriks/9506-pure-fusion-indicator", "committedDate": "2020-12-16T12:27:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MDQ3OA==", "url": "https://github.com/vaadin/flow/pull/9649#discussion_r544670478", "bodyText": "I know it's a bit of the edge case, but Vaadin.Flow could be also defined if there is an embedded Flow component (not the whole application, just a component, probably even coming from another server)", "author": "fluorumlabs", "createdAt": "2020-12-16T22:31:36Z", "path": "flow-client/src/main/resources/META-INF/resources/frontend/Connect.ts", "diffHunk": "@@ -285,6 +285,19 @@ export class ConnectClient {\n \n     // ensure connection indicator is visible from this entry point\n     getConnectionIndicator();\n+\n+    // Listen to browser online/offline events and update the loading indicator accordingly.\n+    // Note: if Flow.ts is loaded, it instead handles the state transitions.\n+    $wnd.addEventListener('online', () => {\n+      if ($wnd.Vaadin.Flow === undefined) {", "originalCommit": "bfdd30a9c1f9d508c1977615350aab645905a853", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg0MTM1OQ==", "url": "https://github.com/vaadin/flow/pull/9649#discussion_r544841359", "bodyText": "Any suggestions on how it can be improved?", "author": "haijian-vaadin", "createdAt": "2020-12-17T06:24:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MDQ3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg1NzAyOA==", "url": "https://github.com/vaadin/flow/pull/9649#discussion_r544857028", "bodyText": "I prefer to merge the PR now, as the fix is more important than covering the edge case atm.\nAfter the merge, we can start merging the offline branch to master, which can unblock the release.\nFurther suggestions can be applied to the master branch later on.", "author": "haijian-vaadin", "createdAt": "2020-12-17T07:05:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MDQ3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg1ODAwOA==", "url": "https://github.com/vaadin/flow/pull/9649#discussion_r544858008", "bodyText": "Hard to say. To me it looks Flow client doesn't listen to online/offline events at all. Needs to be rechecked though.", "author": "fluorumlabs", "createdAt": "2020-12-17T07:07:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MDQ3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg1ODYyMQ==", "url": "https://github.com/vaadin/flow/pull/9649#discussion_r544858621", "bodyText": "I prefer to merge the PR now, as the fix is more important than covering the edge case atm.\n\nSure thing. Let's move this to technical debt :)", "author": "fluorumlabs", "createdAt": "2020-12-17T07:09:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MDQ3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg3MjU0Mg==", "url": "https://github.com/vaadin/flow/pull/9649#discussion_r544872542", "bodyText": "Hard to say. To me it looks Flow client doesn't listen to online/offline events at all. Needs to be rechecked though.\n\nhttps://github.com/vaadin/flow/blob/feature/offline/flow-client/src/main/java/com/vaadin/client/communication/DefaultConnectionStateHandler.java#L541-L551\nThough the point is good, the embedded case needs testing. Will do and create a ticket if I find some issues.", "author": "joheriks", "createdAt": "2020-12-17T07:39:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MDQ3OA=="}], "type": "inlineReview"}, {"oid": "2fa818f13774f2c60b52252f78cf2a18e780dab7", "url": "https://github.com/vaadin/flow/commit/2fa818f13774f2c60b52252f78cf2a18e780dab7", "message": "Merge branch 'feature/offline' into joheriks/9506-pure-fusion-indicator", "committedDate": "2020-12-17T03:31:36Z", "type": "commit"}]}