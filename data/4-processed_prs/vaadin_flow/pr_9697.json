{"pr_number": 9697, "pr_title": "chore: improve stability of two tests", "pr_createdAt": "2020-12-18T17:46:57Z", "pr_url": "https://github.com/vaadin/flow/pull/9697", "timeline": [{"oid": "aab191534c3f0ace6ff9ade66ba6fd88c58c3904", "url": "https://github.com/vaadin/flow/commit/aab191534c3f0ace6ff9ade66ba6fd88c58c3904", "message": "chore: clear timers between tests", "committedDate": "2020-12-18T17:27:13Z", "type": "commit"}, {"oid": "b765461dd23f07925f884bfd9e7b3d4175448daf", "url": "https://github.com/vaadin/flow/commit/b765461dd23f07925f884bfd9e7b3d4175448daf", "message": "chore: accept a session expiration message in LogoutIT", "committedDate": "2020-12-18T17:28:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5OTQ3Ng==", "url": "https://github.com/vaadin/flow/pull/9697#discussion_r545999476", "bodyText": "Is this commented line needed?", "author": "haijian-vaadin", "createdAt": "2020-12-18T18:04:50Z", "path": "flow-client/src/test/frontend/FlowTests.ts", "diffHunk": "@@ -488,20 +492,23 @@ suite(\"Flow\", () => {\n             return {cancel: true};\n           }})\n           .then(obj => assert.isTrue(obj.cancel));\n-\n       });\n   });\n \n-  test(\"onBeforeLeave should cancel `server->client` navigation\", () => {\n+  test(\"onBeforeLeave should cancel `server->client` navigation\", async () => {\n     // true to prevent navigation from server\n     stubServerRemoteFunction('foobar-12345', true);\n     mockInitResponse('foobar-12345');\n \n+    await new Promise(resolve => setTimeout(resolve, 150));\n+\n     const flow = new Flow();\n     const route = flow.serverSideRoutes[0];\n \n     return route.action({pathname: 'Foo'})\n       .then((elem: any) => {\n+        //await new Promise(resolve => setTimeout(resolve, 500));", "originalCommit": "b765461dd23f07925f884bfd9e7b3d4175448daf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAwMDUxNA==", "url": "https://github.com/vaadin/flow/pull/9697#discussion_r546000514", "bodyText": "Good catch! Neither this comment nor the above await should be in the test, they are remnants from inserting waits to provoke the race condition. Removed.", "author": "joheriks", "createdAt": "2020-12-18T18:06:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5OTQ3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAwNzkyMw==", "url": "https://github.com/vaadin/flow/pull/9697#discussion_r546007923", "bodyText": "thanks, now it looks good", "author": "haijian-vaadin", "createdAt": "2020-12-18T18:19:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5OTQ3Ng=="}], "type": "inlineReview"}, {"oid": "5cb454ab070d531ed58a86c2786a66c205240bdf", "url": "https://github.com/vaadin/flow/commit/5cb454ab070d531ed58a86c2786a66c205240bdf", "message": "fix: removed waits", "committedDate": "2020-12-18T18:06:03Z", "type": "commit"}, {"oid": "3dd60903e10d33ca879fe0309470ba1463a9fe93", "url": "https://github.com/vaadin/flow/commit/3dd60903e10d33ca879fe0309470ba1463a9fe93", "message": "fix: remove unnecessary async", "committedDate": "2020-12-18T22:55:08Z", "type": "commit"}]}