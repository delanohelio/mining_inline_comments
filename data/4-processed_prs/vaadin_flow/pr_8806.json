{"pr_number": 8806, "pr_title": "Add client-side authentication features", "pr_createdAt": "2020-08-03T07:50:11Z", "pr_url": "https://github.com/vaadin/flow/pull/8806", "timeline": [{"oid": "52105b27bb3febd8c3b8ff2e77293fd9731ebdfe", "url": "https://github.com/vaadin/flow/commit/52105b27bb3febd8c3b8ff2e77293fd9731ebdfe", "message": "add login method", "committedDate": "2020-07-30T08:00:42Z", "type": "commit"}, {"oid": "c7f64d4d97814c0a9b9e9c8b387afec41e1d9160", "url": "https://github.com/vaadin/flow/commit/c7f64d4d97814c0a9b9e9c8b387afec41e1d9160", "message": "export login as function", "committedDate": "2020-07-30T10:29:58Z", "type": "commit"}, {"oid": "f9f26772a71d177821777c58d998c8f3ac575ad8", "url": "https://github.com/vaadin/flow/commit/f9f26772a71d177821777c58d998c8f3ac575ad8", "message": "add logout function", "committedDate": "2020-08-03T08:19:16Z", "type": "commit"}, {"oid": "f3bae48ccd8b828ad763988c1b57a90920727ffb", "url": "https://github.com/vaadin/flow/commit/f3bae48ccd8b828ad763988c1b57a90920727ffb", "message": "remove unneccesary default connect  prefix config", "committedDate": "2020-08-03T08:36:59Z", "type": "commit"}, {"oid": "f9850b8665ece5cfe24e3002653e1fef5d96490c", "url": "https://github.com/vaadin/flow/commit/f9850b8665ece5cfe24e3002653e1fef5d96490c", "message": "fix typo", "committedDate": "2020-08-03T10:33:09Z", "type": "commit"}, {"oid": "a5ee1142a064d8b69d0eb5457485ce8e17ac38a2", "url": "https://github.com/vaadin/flow/commit/a5ee1142a064d8b69d0eb5457485ce8e17ac38a2", "message": "Revert \"remove unneccesary default connect  prefix config\"\n\nThis reverts commit f3bae48ccd8b828ad763988c1b57a90920727ffb.", "committedDate": "2020-08-03T11:02:49Z", "type": "commit"}, {"oid": "7c8670cbd15153a3c276d5ce7c28c770e4eff0ca", "url": "https://github.com/vaadin/flow/commit/7c8670cbd15153a3c276d5ce7c28c770e4eff0ca", "message": "revert the default connect prefix", "committedDate": "2020-08-03T11:11:07Z", "type": "commit"}, {"oid": "3f4e66f9b792b8d6c729b145bc5d14657739a96f", "url": "https://github.com/vaadin/flow/commit/3f4e66f9b792b8d6c729b145bc5d14657739a96f", "message": "add tests for login", "committedDate": "2020-08-03T12:24:08Z", "type": "commit"}, {"oid": "9ecf52ffd0d0cc44739532e08faf4b30e1534997", "url": "https://github.com/vaadin/flow/commit/9ecf52ffd0d0cc44739532e08faf4b30e1534997", "message": "fix login tests", "committedDate": "2020-08-03T18:04:32Z", "type": "commit"}, {"oid": "8de3f311cb5b32cbbad6baf6b6fbd4a305f0de7b", "url": "https://github.com/vaadin/flow/commit/8de3f311cb5b32cbbad6baf6b6fbd4a305f0de7b", "message": "add tests for invalid session callback", "committedDate": "2020-08-04T10:29:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk0NDgxOQ==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r464944819", "bodyText": "Why export const login instead of export async function login?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            export const login = async (username: string, password: string): Promise<LoginResult> => {\n          \n          \n            \n            export async function login(username: string, password: string): Promise<LoginResult> {", "author": "Haprog", "createdAt": "2020-08-04T10:09:17Z", "path": "flow-client/src/main/resources/META-INF/resources/frontend/Connect.ts", "diffHunk": "@@ -369,3 +369,93 @@ export class ConnectClient {\n     }\n   }\n }\n+\n+export interface LoginResult {\n+  token?: string;\n+  error: boolean;\n+  errorTitle: string;\n+  errorMessage: string;\n+}\n+\n+export const login = async (username: string, password: string): Promise<LoginResult> => {", "originalCommit": "9ecf52ffd0d0cc44739532e08faf4b30e1534997", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk4MzQ4NQ==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r464983485", "bodyText": "done", "author": "haijian-vaadin", "createdAt": "2020-08-04T11:30:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk0NDgxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk0NzY0Mw==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r464947643", "bodyText": "I think this is ok for a first version so not a blocker, but this catching could be improved to check for some type of errors (like specifically network errors) so we could give a bit more meaningful error messages (different message for actual network errors and different for other errors that may be caused by bugs in our logic. Maybe wrap only smaller parts of the code in try/catch block.\nNow this always results in \"Communication error\" even if there's a bug in the try block that throws for other reason like  trying to access properties in undefined objects.", "author": "Haprog", "createdAt": "2020-08-04T10:15:07Z", "path": "flow-client/src/main/resources/META-INF/resources/frontend/Connect.ts", "diffHunk": "@@ -369,3 +369,93 @@ export class ConnectClient {\n     }\n   }\n }\n+\n+export interface LoginResult {\n+  token?: string;\n+  error: boolean;\n+  errorTitle: string;\n+  errorMessage: string;\n+}\n+\n+export const login = async (username: string, password: string): Promise<LoginResult> => {\n+  let result;\n+  try {\n+    // this assumes the default Spring Security form login configuration (parameter names)\n+    const data = new FormData();\n+    data.append('username', username);\n+    data.append('password', password);\n+\n+    const response = await fetch('/login', {method: 'POST', body: data});\n+\n+    // this assumes the default Spring Security form login configuration (handler URL and responses)\n+    if (response.ok && response.redirected && response.url.endsWith('/login?error')) {\n+      result = {\n+        error: true,\n+        errorTitle: 'Incorrect username or password.',\n+        errorMessage: 'Check that you have entered the correct username and password and try again.'\n+      };\n+    } else if (response.ok && response.redirected && response.url.endsWith('/')) {\n+      // TODO: find a more efficient way to get a new CSRF token\n+      // parsing the full response body just to get a token may be wasteful\n+      const token = getCsrfTokenFromResponseBody(await response.text());\n+      if (token) {\n+        (window as any).Vaadin.TypeScript = (window as any).Vaadin.TypeScript || {};\n+        (window as any).Vaadin.TypeScript.csrfToken = token;\n+        result = {\n+          error: false,\n+          errorTitle: '',\n+          errorMessage: '',\n+          token\n+        };\n+      }\n+    }\n+  } catch (e) {\n+    // eat the exception\n+  }\n+\n+  return result || {\n+    error: true,\n+    errorTitle: 'Communication error.',\n+    errorMessage: 'Please check your network connection and try again.',\n+  };", "originalCommit": "9ecf52ffd0d0cc44739532e08faf4b30e1534997", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk5MjE1MQ==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r464992151", "bodyText": "did some change, now returns a different result in the catch block", "author": "haijian-vaadin", "createdAt": "2020-08-04T11:48:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk0NzY0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ3ODQxMA==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r465478410", "bodyText": "I think it's better now, but I just realized the \"Please check your network connection and try again.\" is only shown in case the network request does not fail (the server does respond) but when the response doesn't match either of the two expected redirection cases above. So basically if the response is not \"ok\" (like it is a 404 or 500) or if it's not a redirection, then this message is shown.\nSo this message should be something else since actual network failures are caught in the catch block I think.", "author": "Haprog", "createdAt": "2020-08-05T05:17:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk0NzY0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQzNDcyOQ==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r466434729", "bodyText": "updated with a more generic message.", "author": "haijian-vaadin", "createdAt": "2020-08-06T14:01:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk0NzY0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk1NjA2Mg==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r464956062", "bodyText": "I wonder if there should be some \"base URL\" prefix for this so it works even if the app is hosted in different directory? Or does Spring always have /login at the root? Or should this login path be configurable?", "author": "Haprog", "createdAt": "2020-08-04T10:32:24Z", "path": "flow-client/src/main/resources/META-INF/resources/frontend/Connect.ts", "diffHunk": "@@ -369,3 +369,93 @@ export class ConnectClient {\n     }\n   }\n }\n+\n+export interface LoginResult {\n+  token?: string;\n+  error: boolean;\n+  errorTitle: string;\n+  errorMessage: string;\n+}\n+\n+export const login = async (username: string, password: string): Promise<LoginResult> => {\n+  let result;\n+  try {\n+    // this assumes the default Spring Security form login configuration (parameter names)\n+    const data = new FormData();\n+    data.append('username', username);\n+    data.append('password', password);\n+\n+    const response = await fetch('/login', {method: 'POST', body: data});", "originalCommit": "9ecf52ffd0d0cc44739532e08faf4b30e1534997", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk2OTAyMQ==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r464969021", "bodyText": "very good catch!\nDo you have experience in how to get the context root?", "author": "haijian-vaadin", "createdAt": "2020-08-04T10:59:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk1NjA2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ3NTgzMQ==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r465475831", "bodyText": "Unfortunately I don't know much about this since I haven't done that much web dev on the Java side.", "author": "Haprog", "createdAt": "2020-08-05T05:08:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk1NjA2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQzNTI2Mg==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r466435262", "bodyText": "Made login/logout parameters configurable.", "author": "haijian-vaadin", "createdAt": "2020-08-06T14:02:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk1NjA2Mg=="}], "type": "inlineReview"}, {"oid": "93890bab03ed581bed3cccd486845a46010002a4", "url": "https://github.com/vaadin/flow/commit/93890bab03ed581bed3cccd486845a46010002a4", "message": "apply code review suggestions", "committedDate": "2020-08-04T11:28:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ4MDcxMA==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r465480710", "bodyText": "Prefer to continue the convention that test descriptions are naturally readable like \"it should do [this] when [that]\" or so. So try to start with it('should ... or similar. For example in this case I'd maybe write something like:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  it('on invalid credential', async () => {\n          \n          \n            \n                  it('should return an error on invalid credentials', async () => {", "author": "Haprog", "createdAt": "2020-08-05T05:25:52Z", "path": "flow-client/src/test/frontend/ConnectTests.ts", "diffHunk": "@@ -396,5 +395,111 @@ describe('ConnectClient', () => {\n         await client.call('FooEndpoint', 'fooMethod', {fooParam: 'foo'});\n       });\n     });\n+\n+    describe('login', () => {\n+      afterEach(() => fetchMock.restore());\n+\n+      it('on invalid credential', async () => {", "originalCommit": "93890bab03ed581bed3cccd486845a46010002a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQzNTM4OQ==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r466435389", "bodyText": "done", "author": "haijian-vaadin", "createdAt": "2020-08-06T14:02:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ4MDcxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ4MTk2Ng==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r465481966", "bodyText": "Suggestion for more natural description.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  it('on valid credential', async () => {\n          \n          \n            \n                  it('should return a CSRF token on valid credentials', async () => {\n          \n      \n    \n    \n  \n\n(btw I'm not 100% sure how this CSRF protection should work in our case. At least some Spring example I saw included the token in the login POST request already along with the username and password. Not sure if we should do it like that too? Now we're just expecting it back in the response, not sending it in the request)", "author": "Haprog", "createdAt": "2020-08-05T05:30:03Z", "path": "flow-client/src/test/frontend/ConnectTests.ts", "diffHunk": "@@ -396,5 +395,111 @@ describe('ConnectClient', () => {\n         await client.call('FooEndpoint', 'fooMethod', {fooParam: 'foo'});\n       });\n     });\n+\n+    describe('login', () => {\n+      afterEach(() => fetchMock.restore());\n+\n+      it('on invalid credential', async () => {\n+        fetchMock.post('/login', { redirectUrl: '/login?error' });\n+        const result = await login('invalid-username', 'invalid-password');\n+        const expectedResult = {\n+          error: true,\n+          errorTitle: 'Incorrect username or password.',\n+          errorMessage: 'Check that you have entered the correct username and password and try again.'\n+        };\n+\n+        expect(fetchMock.calls()).to.have.lengthOf(1);\n+        expect(result).to.deep.equal(expectedResult);\n+      })\n+\n+      it('on valid credential', async () => {", "originalCommit": "93890bab03ed581bed3cccd486845a46010002a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQzNTQ0Mw==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r466435443", "bodyText": "done", "author": "haijian-vaadin", "createdAt": "2020-08-06T14:02:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ4MTk2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ4MjQ1Nw==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r465482457", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  it('on other erros', async () => {\n          \n          \n            \n                  it('should return an error on other unexpected responses', async () => {", "author": "Haprog", "createdAt": "2020-08-05T05:31:38Z", "path": "flow-client/src/test/frontend/ConnectTests.ts", "diffHunk": "@@ -396,5 +395,111 @@ describe('ConnectClient', () => {\n         await client.call('FooEndpoint', 'fooMethod', {fooParam: 'foo'});\n       });\n     });\n+\n+    describe('login', () => {\n+      afterEach(() => fetchMock.restore());\n+\n+      it('on invalid credential', async () => {\n+        fetchMock.post('/login', { redirectUrl: '/login?error' });\n+        const result = await login('invalid-username', 'invalid-password');\n+        const expectedResult = {\n+          error: true,\n+          errorTitle: 'Incorrect username or password.',\n+          errorMessage: 'Check that you have entered the correct username and password and try again.'\n+        };\n+\n+        expect(fetchMock.calls()).to.have.lengthOf(1);\n+        expect(result).to.deep.equal(expectedResult);\n+      })\n+\n+      it('on valid credential', async () => {\n+        fetchMock.post('/login', {\n+          body: 'window.Vaadin = {TypeScript: {\"csrfToken\":\"6a60700e-852b-420f-a126-a1c61b73d1ba\"}};',\n+          redirectUrl: '/'\n+        });\n+        const result = await login('valid-username', 'valid-password');\n+        const expectedResult = {\n+          error: false,\n+          errorTitle: '',\n+          errorMessage: '',\n+          token: '6a60700e-852b-420f-a126-a1c61b73d1ba'\n+        };\n+\n+        expect(fetchMock.calls()).to.have.lengthOf(1);\n+        expect(result).to.deep.equal(expectedResult);\n+      })\n+\n+      it('on other erros', async () => {", "originalCommit": "93890bab03ed581bed3cccd486845a46010002a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQzNTQ5Ng==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r466435496", "bodyText": "done", "author": "haijian-vaadin", "createdAt": "2020-08-06T14:02:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ4MjQ1Nw=="}], "type": "inlineReview"}, {"oid": "774d7b2635f4d6cb6726b4b20bf6ec99f182be18", "url": "https://github.com/vaadin/flow/commit/774d7b2635f4d6cb6726b4b20bf6ec99f182be18", "message": "apply code review sugguestions", "committedDate": "2020-08-06T13:56:56Z", "type": "commit"}, {"oid": "71cb0a64d6207c45ebb2a3cefc80039a11732ac0", "url": "https://github.com/vaadin/flow/commit/71cb0a64d6207c45ebb2a3cefc80039a11732ac0", "message": "Merge branch 'master' into haijian/auth", "committedDate": "2020-08-06T13:57:18Z", "type": "commit"}, {"oid": "b5db5e87df2cf4f20dfef957aca06a11dd96b915", "url": "https://github.com/vaadin/flow/commit/b5db5e87df2cf4f20dfef957aca06a11dd96b915", "message": "fix compile error in test", "committedDate": "2020-08-06T14:27:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg1Mjc1Mw==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r466852753", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * It takes a <code>EndpointCallContinue</code> paramter, which can be \n          \n          \n            \n             * It takes an <code>EndpointCallContinue</code> parameter, which can be", "author": "Haprog", "createdAt": "2020-08-07T06:46:08Z", "path": "flow-client/src/main/resources/META-INF/resources/frontend/Connect.ts", "diffHunk": "@@ -439,27 +465,38 @@ const getCsrfTokenFromResponseBody = (body: string): string | undefined => {\n   return match ? match[1] : undefined;\n }\n \n-export type EndpointCallContinue = (token: string) => void;\n+type EndpointCallContinue = (token: string) => void;\n+\n+/**\n+ * It defines what to do when it detects a session is invalid. E.g., \n+ * show a login view.\n+ * It takes a <code>EndpointCallContinue</code> paramter, which can be ", "originalCommit": "b5db5e87df2cf4f20dfef957aca06a11dd96b915", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg4NTMxNQ==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r466885315", "bodyText": "done", "author": "haijian-vaadin", "createdAt": "2020-08-07T08:00:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg1Mjc1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg1Mjg1Ng==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r466852856", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * used to continune the endpoint call.  \n          \n          \n            \n             * used to continue the endpoint call.", "author": "Haprog", "createdAt": "2020-08-07T06:46:24Z", "path": "flow-client/src/main/resources/META-INF/resources/frontend/Connect.ts", "diffHunk": "@@ -439,27 +465,38 @@ const getCsrfTokenFromResponseBody = (body: string): string | undefined => {\n   return match ? match[1] : undefined;\n }\n \n-export type EndpointCallContinue = (token: string) => void;\n+type EndpointCallContinue = (token: string) => void;\n+\n+/**\n+ * It defines what to do when it detects a session is invalid. E.g., \n+ * show a login view.\n+ * It takes a <code>EndpointCallContinue</code> paramter, which can be \n+ * used to continune the endpoint call.  ", "originalCommit": "b5db5e87df2cf4f20dfef957aca06a11dd96b915", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg4NTM4NA==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r466885384", "bodyText": "done", "author": "haijian-vaadin", "createdAt": "2020-08-07T08:00:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg1Mjg1Ng=="}], "type": "inlineReview"}, {"oid": "3292139571f88518a4f7d71e4f31ae87c31b99c3", "url": "https://github.com/vaadin/flow/commit/3292139571f88518a4f7d71e4f31ae87c31b99c3", "message": "apply code review suggestions", "committedDate": "2020-08-07T07:59:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg5MDY0OQ==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r466890649", "bodyText": "I think this also needs to be exported still. Otherwise users can't do class MyMiddleware implements MiddlewareClass, right?", "author": "Haprog", "createdAt": "2020-08-07T08:11:43Z", "path": "flow-client/src/main/resources/META-INF/resources/frontend/Connect.ts", "diffHunk": "@@ -207,18 +207,29 @@ export interface MiddlewareContext {\n export type MiddlewareNext = (context: MiddlewareContext) =>\n   Promise<Response> | Response;\n \n-/**\n- * An async callback function that can intercept the request and response\n- * of a call.\n- */\n-export interface Middleware {\n+\n+\n+interface MiddlewareClass {", "originalCommit": "3292139571f88518a4f7d71e4f31ae87c31b99c3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg5MTYzOQ==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r466891639", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            export class InvalidSessionMiddleWare implements MiddlewareClass {\n          \n          \n            \n            export class InvalidSessionMiddleware implements MiddlewareClass {\n          \n      \n    \n    \n  \n\nI just noticed this is the only place where middleware is written like MiddleWare, in all other places it's Middleware.", "author": "Haprog", "createdAt": "2020-08-07T08:13:54Z", "path": "flow-client/src/main/resources/META-INF/resources/frontend/Connect.ts", "diffHunk": "@@ -480,10 +497,10 @@ export type OnInvalidSessionCallback = (continueFunc: EndpointCallContinue) => v\n  * E.g., you can use this to show user a login page when the session has expired.\n  * Use <code>InvalidSessionMiddleWare.create()</code> to create the middleware.\n  */\n-export class InvalidSessionMiddleWare implements Middleware {\n+export class InvalidSessionMiddleWare implements MiddlewareClass {", "originalCommit": "3292139571f88518a4f7d71e4f31ae87c31b99c3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg5NzY0Ng==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r466897646", "bodyText": "good point, done", "author": "haijian-vaadin", "createdAt": "2020-08-07T08:26:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg5MTYzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjkwMTc4NA==", "url": "https://github.com/vaadin/flow/pull/8806#discussion_r466901784", "bodyText": "Missing same rename in tests where it's used.", "author": "Haprog", "createdAt": "2020-08-07T08:34:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg5MTYzOQ=="}], "type": "inlineReview"}, {"oid": "7d6dd724fd80b9269794467bdd5836d2c921368b", "url": "https://github.com/vaadin/flow/commit/7d6dd724fd80b9269794467bdd5836d2c921368b", "message": "export MiddlewareClass", "committedDate": "2020-08-07T08:25:20Z", "type": "commit"}, {"oid": "59626ef4c9c71f57809a7e0c21be031a2d927912", "url": "https://github.com/vaadin/flow/commit/59626ef4c9c71f57809a7e0c21be031a2d927912", "message": "correct typo", "committedDate": "2020-08-07T08:28:54Z", "type": "commit"}, {"oid": "4b581ab4cc361425ccfb3565caed2162dfe6a974", "url": "https://github.com/vaadin/flow/commit/4b581ab4cc361425ccfb3565caed2162dfe6a974", "message": "fix tests after renaming", "committedDate": "2020-08-07T08:36:54Z", "type": "commit"}]}