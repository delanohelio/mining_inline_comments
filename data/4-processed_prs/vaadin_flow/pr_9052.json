{"pr_number": 9052, "pr_title": "Skip data provider verification in AbstractDataView if default one is used", "pr_createdAt": "2020-09-23T08:53:57Z", "pr_url": "https://github.com/vaadin/flow/pull/9052", "timeline": [{"oid": "3cec4557c7e755ae1d1a0f00ac1ce786f3ffe553", "url": "https://github.com/vaadin/flow/commit/3cec4557c7e755ae1d1a0f00ac1ce786f3ffe553", "message": "Skip data provider verification in AbstractDataView if default one is used in data communicator", "committedDate": "2020-09-23T08:49:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM2MTg2Ng==", "url": "https://github.com/vaadin/flow/pull/9052#discussion_r493361866", "bodyText": "This should be before instance variables, and any static variables too", "author": "pleku", "createdAt": "2020-09-23T09:24:03Z", "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java", "diffHunk": "@@ -648,6 +648,30 @@ public void setPagingEnabled(boolean pagingEnabled) {\n         this.pagingEnabled = pagingEnabled;\n     }\n \n+    /**\n+     * In-memory data provider with no items.\n+     * <p>\n+     * Data Communicator is initialised with this data provider by default\n+     * until a new data provider is assigned with\n+     * {@link #setDataProvider(DataProvider, Object)}.\n+     * <p>\n+     * This type of data provider signals to data view to skip the data\n+     * provider verification on data view instantiation phase, so as to\n+     * support generic API for lazy loading case (add item count listener,\n+     * for instance), even if no backend data provider set by user.\n+     *\n+     * @param <T1> item type\n+     */\n+    static final class EmptyDataProvider<T1> extends ListDataProvider<T1> {", "originalCommit": "3cec4557c7e755ae1d1a0f00ac1ce786f3ffe553", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE4NzE4Nw==", "url": "https://github.com/vaadin/flow/pull/9052#discussion_r494187187", "bodyText": "I would better place it just before SizeVerifier declaration and after the instance variables, because IMO inner class declaration on the top of outer class decrease the readability, and I couldn't find the recommendations (from Oracle) to place inner classes on the top (before variables declaration).", "author": "mshabarov", "createdAt": "2020-09-24T09:54:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM2MTg2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM4NDA5Mg==", "url": "https://github.com/vaadin/flow/pull/9052#discussion_r493384092", "bodyText": "NIT: it feels like this is documented now in two places, abstract data view and here, IMO this is a bit excessive and one would have sufficed with a comment // see xyz for the other place", "author": "pleku", "createdAt": "2020-09-23T09:46:34Z", "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java", "diffHunk": "@@ -648,6 +648,30 @@ public void setPagingEnabled(boolean pagingEnabled) {\n         this.pagingEnabled = pagingEnabled;\n     }\n \n+    /**\n+     * In-memory data provider with no items.\n+     * <p>\n+     * Data Communicator is initialised with this data provider by default\n+     * until a new data provider is assigned with\n+     * {@link #setDataProvider(DataProvider, Object)}.\n+     * <p>\n+     * This type of data provider signals to data view to skip the data\n+     * provider verification on data view instantiation phase, so as to\n+     * support generic API for lazy loading case (add item count listener,\n+     * for instance), even if no backend data provider set by user.", "originalCommit": "3cec4557c7e755ae1d1a0f00ac1ce786f3ffe553", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDIxMDgwOQ==", "url": "https://github.com/vaadin/flow/pull/9052#discussion_r494210809", "bodyText": "Done", "author": "mshabarov", "createdAt": "2020-09-24T10:35:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM4NDA5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM4NTk2MQ==", "url": "https://github.com/vaadin/flow/pull/9052#discussion_r493385961", "bodyText": "This documentation (and the other duplicate in the empty data provider) is missing the part that in-memory data view API is supported without explicitly setting the data provider. Since you're documenting the usage, might add that too", "author": "pleku", "createdAt": "2020-09-23T09:48:35Z", "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/AbstractDataView.java", "diffHunk": "@@ -56,13 +56,27 @@ public AbstractDataView(\n                 \"DataProvider supplier cannot be null\");\n         this.dataProviderSupplier = dataProviderSupplier;\n         this.component = component;\n-        verifyDataProviderType(dataProviderSupplier.get().getClass());\n+        final Class<?> dataProviderType = dataProviderSupplier.get().getClass();\n+        /*\n+         * Skip verification if the verified data provider has not been\n+         * initialized yet.\n+         * This mainly refers to the following cases:\n+         * 1. Component uses data communicator which initialises data provider\n+         * lazily and meanwhile has a default empty one. Good example is a\n+         * ComboBox.\n+         * 2. Developer wants to set the ItemCountChangeListener before the data\n+         * provider has been set.", "originalCommit": "3cec4557c7e755ae1d1a0f00ac1ce786f3ffe553", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDIxNTA5Mw==", "url": "https://github.com/vaadin/flow/pull/9052#discussion_r494215093", "bodyText": "Done", "author": "mshabarov", "createdAt": "2020-09-24T10:44:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM4NTk2MQ=="}], "type": "inlineReview"}, {"oid": "78dfb1f3f552cc6214846eb92d9c583d4c033da8", "url": "https://github.com/vaadin/flow/commit/78dfb1f3f552cc6214846eb92d9c583d4c033da8", "message": "Improve explanatory comments", "committedDate": "2020-09-24T10:46:11Z", "type": "commit"}, {"oid": "b3cb2dbe08454ad62a3f11e296103c885c2d2b7f", "url": "https://github.com/vaadin/flow/commit/b3cb2dbe08454ad62a3f11e296103c885c2d2b7f", "message": "Make empty data provider public for being used in components", "committedDate": "2020-09-28T18:16:12Z", "type": "commit"}]}