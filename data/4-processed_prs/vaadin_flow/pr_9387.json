{"pr_number": 9387, "pr_title": "Cherry picks for 5.0", "pr_createdAt": "2020-11-12T08:06:51Z", "pr_url": "https://github.com/vaadin/flow/pull/9387", "timeline": [{"oid": "fcc6aa3d0380f337b58d1c6fd9b19f74ad111001", "url": "https://github.com/vaadin/flow/commit/fcc6aa3d0380f337b58d1c6fd9b19f74ad111001", "message": "chore: do not depend on commons.lang3 (#9271)\n\n(cherry picked from commit 427ca7840cb2ec4fea44e7bb81fef22cf9d41965)", "committedDate": "2020-11-12T08:26:57Z", "type": "commit"}, {"oid": "0184d9de5589a325ec1a334b2b8f790d2080c699", "url": "https://github.com/vaadin/flow/commit/0184d9de5589a325ec1a334b2b8f790d2080c699", "message": "chore: fix typo (#9272)\n\nFix typo in DataCommunicator::getDataProviderSize() javadoc.\n\n(cherry picked from commit 3fd66e0fb14b2fb7e11e92d198cc776f0fb14de5)", "committedDate": "2020-11-12T08:27:08Z", "type": "commit"}, {"oid": "a6038692f3dd4121bcdc5dc48491ebdbce9a1bfe", "url": "https://github.com/vaadin/flow/commit/a6038692f3dd4121bcdc5dc48491ebdbce9a1bfe", "message": "refactor: make web browser immutable (#9298)\n\n(cherry picked from commit 9f7cfa76fd21d8d18338237e6e325c1eeaf5c21b)", "committedDate": "2020-11-12T08:57:45Z", "type": "commit"}, {"oid": "386bd365591a585987707dc2405242c68b9b7451", "url": "https://github.com/vaadin/flow/commit/386bd365591a585987707dc2405242c68b9b7451", "message": "fix: AppShellConfigurator is now considered for theme endpoint (#9332)\n\nAppShellConfigurator is now also considered when\nscanning for annotations and deciding theme.\n\nFixes #9110\n\n(cherry picked from commit 0ad3b215d2487bab11477e9379d8b063581bb656)", "committedDate": "2020-11-12T09:12:44Z", "type": "commit"}, {"oid": "0af733e91dd41200a853b236fdc3d6d4387a0db9", "url": "https://github.com/vaadin/flow/commit/0af733e91dd41200a853b236fdc3d6d4387a0db9", "message": "feat!: Theme annotation should be only on AppShellConfigurator (#9313)\n\nHaving the `@Theme` annotation on Flow views or router layouts will not be allowed anymore, it should be on `AppShellConfigurator` instead.\n\nFixes #9092\n\n(cherry picked from commit c5f531937fe99ae7b49b2a7310abfccfdc5e5bcc)", "committedDate": "2020-11-12T09:15:08Z", "type": "commit"}, {"oid": "8ce616c78558b1de9e37391e17a17372f2d0c5fa", "url": "https://github.com/vaadin/flow/commit/8ce616c78558b1de9e37391e17a17372f2d0c5fa", "message": "test(TypeScript): ensure CSRF token is updated when session is invalidated (#9329)\n\n* test(TypeScript): ensure CSRF token is updated when session is invalidated\n\nFixes #9164\n\n* add log message\n\n(cherry picked from commit 5a385294ad6d12f81da3244d9941c0373587d6fa)", "committedDate": "2020-11-12T09:18:32Z", "type": "commit"}, {"oid": "79203fe234fb1b2a67f47b211cce6c2f4a3b6b93", "url": "https://github.com/vaadin/flow/commit/79203fe234fb1b2a67f47b211cce6c2f4a3b6b93", "message": "fix: increase threshold for performance test (#9381)\n\n(cherry picked from commit 529f7111729fe68c3c3190d12b22e3d41fcb84b6)", "committedDate": "2020-11-12T09:30:40Z", "type": "commit"}, {"oid": "e9bbd1576f4372495990b44783c3215b2519360a", "url": "https://github.com/vaadin/flow/commit/e9bbd1576f4372495990b44783c3215b2519360a", "message": "fix: hide loading indicator when endpoint call fails (#9380)\n\n(cherry picked from commit 676f7529f1eafeb188d3cf3bb87be86ea7722af6)", "committedDate": "2020-11-12T09:31:09Z", "type": "commit"}, {"oid": "1002a803ca7bd492fb60c51721288c037d1a1608", "url": "https://github.com/vaadin/flow/commit/1002a803ca7bd492fb60c51721288c037d1a1608", "message": "feat: tree-shakeable ES imports for TS form validators (#9374)\n\n- Use tree-shakeable ES imports for TS form validators based on the latest version of validators lib.\n- Add missing `return` in the `submit()` method\n\n(cherry picked from commit 6608604b94af4f11013463dfdcf9521681ddb4e0)", "committedDate": "2020-11-12T09:33:11Z", "type": "commit"}, {"oid": "ebb2a888bceddd86fa0df0de89cdab70f692b86c", "url": "https://github.com/vaadin/flow/commit/ebb2a888bceddd86fa0df0de89cdab70f692b86c", "message": "fix!: Use data view filter and sorting only to that component (#9315)\n\nIn-memory filtering and sorting are now stored directly in component, which gives an opportunity to change it through the data view API for a certain component separately from other components bound to the same data provider.\n\nFixes #8655\n\n(cherry picked from commit 5b2d4d8259a2efb3de70ea9d38fda18c4979cac6)", "committedDate": "2020-11-12T09:35:40Z", "type": "commit"}, {"oid": "5666cd61f3b39b0ffbe3b0f71d156b79d0283684", "url": "https://github.com/vaadin/flow/commit/5666cd61f3b39b0ffbe3b0f71d156b79d0283684", "message": "fix: support Range requests with either start or end byte index omitted (#9368)\n\nSupports headers of the type Range: -123 and Range: 123-.\n\nFixes #9083.\n\n(cherry picked from commit ff28dd041ce8f477b4a0734c37540cec71ea524d)", "committedDate": "2020-11-12T09:38:13Z", "type": "commit"}, {"oid": "5666cd61f3b39b0ffbe3b0f71d156b79d0283684", "url": "https://github.com/vaadin/flow/commit/5666cd61f3b39b0ffbe3b0f71d156b79d0283684", "message": "fix: support Range requests with either start or end byte index omitted (#9368)\n\nSupports headers of the type Range: -123 and Range: 123-.\n\nFixes #9083.\n\n(cherry picked from commit ff28dd041ce8f477b4a0734c37540cec71ea524d)", "committedDate": "2020-11-12T09:38:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwMzcwOA==", "url": "https://github.com/vaadin/flow/pull/9387#discussion_r522003708", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-11-12T10:34:50Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/WebBrowser.java", "diffHunk": "@@ -296,7 +322,12 @@ public boolean isChromeOS() {\n      *\n      * @param request\n      *            the Vaadin request to read the information from\n+     *\n+     * @deprecated Use {@link #WebBrowser(VaadinRequest)} constructor instead\n+     *             and create a new instance of WebBrowser to apply the changes\n+     *             from given {@link VaadinRequest}.\n      */\n+    @Deprecated\n     public void updateRequestDetails(VaadinRequest request) {", "originalCommit": "5666cd61f3b39b0ffbe3b0f71d156b79d0283684", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6b40b5e34947baf69cf66425dc73abf60802d425", "url": "https://github.com/vaadin/flow/commit/6b40b5e34947baf69cf66425dc73abf60802d425", "message": "fix!: move filter and sorting handling methods to util class (#9391)", "committedDate": "2020-11-16T12:55:20Z", "type": "commit"}, {"oid": "7725740fb537610eebd57c92df5b5ba1779ed2c0", "url": "https://github.com/vaadin/flow/commit/7725740fb537610eebd57c92df5b5ba1779ed2c0", "message": "fix: check if Url contains directory change in Dev Mode (#9392)\n\nChecks whether the Url contains a directory change and a double encoding in Dev Mode. Returns 403 Forbidden immediately and skip the request handling, if does.\n\n(cherry picked from commit 19fe3864f9d1567c5ac7a211189986ac093e781f)", "committedDate": "2020-11-18T11:23:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA0NDY5NQ==", "url": "https://github.com/vaadin/flow/pull/9387#discussion_r526044695", "bodyText": "Define and throw a dedicated exception instead of using a generic one.", "author": "vaadin-bot", "createdAt": "2020-11-18T12:21:58Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/HandlerHelper.java", "diffHunk": "@@ -176,4 +189,26 @@ public static String getCancelingRelativePath(String pathToCancel) {\n         return sb.toString();\n     }\n \n+    /**\n+     * Checks if the given URL path contains the directory change instruction\n+     * (dot-dot), taking into account possible double encoding in hexadecimal\n+     * format, which can be injected maliciously.\n+     *\n+     * @param path\n+     *            the URL path to be verified.\n+     * @return {@code true}, if the given path has a directory change\n+     *         instruction, {@code false} otherwise.\n+     */\n+    public static boolean isPathUnsafe(String path) {\n+        // Check that the path does not have '/../', '\\..\\', %5C..%5C,\n+        // %2F..%2F, nor '/..', '\\..', %5C.., %2F..\n+        try {\n+            path = URLDecoder.decode(path, StandardCharsets.UTF_8.name());\n+        } catch (UnsupportedEncodingException e) {\n+            throw new RuntimeException(\"An error occurred during decoding URL.\",", "originalCommit": "7725740fb537610eebd57c92df5b5ba1779ed2c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "51580d6589aa5ebea613c1f8273b2931abada6b3", "url": "https://github.com/vaadin/flow/commit/51580d6589aa5ebea613c1f8273b2931abada6b3", "message": "chore: remove test module test-subcontext (#9394)\n\nThis module is subsumed by test-router-custom-context.\n\n(cherry picked from commit ea7d5c6ace26628da706bf335ec5bfef5e37df44)", "committedDate": "2020-11-18T13:17:52Z", "type": "commit"}, {"oid": "428b2e58c51669a1a6daf5e7e8887db86e04e411", "url": "https://github.com/vaadin/flow/commit/428b2e58c51669a1a6daf5e7e8887db86e04e411", "message": "fix: preserve filter to not lose it between page requests (#9421)\n\nData communicator's filter removal, which has been introduced for components with internal filtering (like a ComboBox), may lead to filter loss during the items scrolling. This fix reverts the filter removal and the components should implement this feature on their side, if necessary.\n\nRelated-to: vaadin/vaadin-flow-components#388\n\n(cherry picked from commit f3be09a172b2b63a5e1875ae5a939b708cc1692c)", "committedDate": "2020-11-18T19:44:10Z", "type": "commit"}, {"oid": "808a8ee29035e8098ee5363ff1c439b01c8ed70c", "url": "https://github.com/vaadin/flow/commit/808a8ee29035e8098ee5363ff1c439b01c8ed70c", "message": "test: remove Theme annotation from demo helpers module (#9395)\n\n(cherry picked from commit f1fcf4f51ff3e70f6056a02d042fa67345a2d9de)", "committedDate": "2020-11-19T08:34:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg1NjI5OA==", "url": "https://github.com/vaadin/flow/pull/9387#discussion_r526856298", "bodyText": "Is this now picked intentionally or not ?", "author": "pleku", "createdAt": "2020-11-19T12:51:41Z", "path": "flow-tests/test-npm-only-features/test-npm-performance-regression/src/test/java/com/vaadin/flow/testnpmonlyfeatures/performanceregression/StartupPerformanceIT.java", "diffHunk": "@@ -55,7 +55,7 @@ public void devModeInitializerToWebpackUpIsBelowThreshold() {\n         final int thresholdMs = Boolean.getBoolean(\n                 System.getProperty(\"vaadin.useDeprecatedV14Bootstrapping\"))\n                         ? 5500\n-                        : 10500;\n+                        : 10700;", "originalCommit": "808a8ee29035e8098ee5363ff1c439b01c8ed70c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg1ODQzMQ==", "url": "https://github.com/vaadin/flow/pull/9387#discussion_r526858431", "bodyText": "I picked that before our discussion that the threshold version-specific. Will revert it.", "author": "mshabarov", "createdAt": "2020-11-19T12:55:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg1NjI5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg2Njc1NA==", "url": "https://github.com/vaadin/flow/pull/9387#discussion_r526866754", "bodyText": "Oh, stop. I'm confused. The label is still there target/5.0. We agreed to not CP in to 2.4 and 2.5 branches, since they have significantly different startup performance.", "author": "mshabarov", "createdAt": "2020-11-19T13:08:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg1NjI5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg2NzU5MQ==", "url": "https://github.com/vaadin/flow/pull/9387#discussion_r526867591", "bodyText": "Yes, but it was you who added the label, not the PR author or the reviewer. So we better ask them if it is needed here or not ?", "author": "pleku", "createdAt": "2020-11-19T13:10:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg1NjI5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg2ODY0MA==", "url": "https://github.com/vaadin/flow/pull/9387#discussion_r526868640", "bodyText": "Well, the difference is not so much that it should matter that much", "author": "pleku", "createdAt": "2020-11-19T13:11:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg1NjI5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg1NzEzOQ==", "url": "https://github.com/vaadin/flow/pull/9387#discussion_r526857139", "bodyText": "Why was this picked to 5.0 ?", "author": "pleku", "createdAt": "2020-11-19T12:53:07Z", "path": "flow-component-demo-helpers/src/main/java/com/vaadin/flow/demo/DemoView.java", "diffHunk": "@@ -47,7 +45,6 @@\n  * @since 1.0\n  */\n @Tag(Tag.DIV)\n-@Theme(Lumo.class)", "originalCommit": "808a8ee29035e8098ee5363ff1c439b01c8ed70c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg2MDQ3MA==", "url": "https://github.com/vaadin/flow/pull/9387#discussion_r526860470", "bodyText": "Because fix: AppShellConfigurator is now considered for theme endpoint and feat!: Theme annotation should be only on AppShellConfigurator are picked to 5.0 from master (according to labels). And without this commit the components tests will fail.", "author": "mshabarov", "createdAt": "2020-11-19T12:58:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg1NzEzOQ=="}], "type": "inlineReview"}]}