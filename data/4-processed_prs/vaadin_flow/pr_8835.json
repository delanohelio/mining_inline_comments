{"pr_number": 8835, "pr_title": "fix(TypeScript): Ensure model validators are generated for fields of bean type", "pr_createdAt": "2020-08-10T17:01:12Z", "pr_url": "https://github.com/vaadin/flow/pull/8835", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA4MTk0Mw==", "url": "https://github.com/vaadin/flow/pull/8835#discussion_r468081943", "bodyText": "This combination of annotations doesn't look right. I think @Nullable has to be removed.", "author": "knoobie", "createdAt": "2020-08-10T18:00:38Z", "path": "flow-server/src/test/java/com/vaadin/flow/server/connect/generator/tsmodel/TsFormEndpoint.java", "diffHunk": "@@ -110,5 +110,6 @@ public String stringNullable() {\n         @Nullable MyEntity nullableEntity;\n         @Nullable List<Optional<String>> nullableList;\n         @Nullable Optional<String>[][] nullableMatrix;\n+        @Nullable @NotNull MyEntity nullableNotNullEntity;", "originalCommit": "42836a1e6056a818921f3b9efd76976d97ed014a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODYxOTY0MA==", "url": "https://github.com/vaadin/flow/pull/8835#discussion_r468619640", "bodyText": "Thanks a lot for the quick feedback. I agree, this does look strange. This is just a test fixture code, it does not matter much which of supported annotations are listed here.\nLet me kindly a related question though, because I think I have a use case for this strange combination. Consider below:\nclass MySelection {\n  long id;\n  // ...\n}\n\nclass MyForm {\n  // @Nullable?\n  @NotNull\n  MySelection selection; \n}\nWe generate TypeScript definitions corresponding to the Java beans above. When doing that, we assume everything to be kind of a @Nonnull by default, so that the TypeScript interfaces are strict, nicely require initialisation of all the fields on creation, and guarantee a value presence when are being read.\nHowever, when it comes to binding a form with a combo-box to the selection field, the following is expected:\n\nThe combo-box is empty by default, unless an initial value is provided or selected by the user. That\u2019s why I\u2019d add @Nullable to make the generated TypeScript type interface for MyForm allow selection to be undefined. We need to explicitly opt-out from the \u201call the data must be defined\u201d\u00a0assumption.\nThe empty combo-box errors when submitted. That\u2019s why I\u2019d add the @NotNull validation constrain.\n\nDo you have any suggestions for how to more reasonably express that kind of a field in Java?", "author": "platosha", "createdAt": "2020-08-11T14:20:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA4MTk0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODcwOTc1NA==", "url": "https://github.com/vaadin/flow/pull/8835#discussion_r468709754", "bodyText": "From a java point of view combining both annotation doesn't make sense (and probably (not tested; just a guess) some validation frameworks are going to complain about it). My understanding for this kind of TS \"magic\" is that \"java is always first\". Meaning that I create the bean / pojo / dto / object with the annotations or re-use an existing piece of code and just add vaadin as presentation layer.\nExamples:\nclass Person {\n\n  String doctorate;\n\n  @NotNull\n  String name;\n\n  @NotNull\n  Address mainAddress;\n\n  List<Address> secondaryAddresses;\n\n}\n\nclass Address {\n\n  @NotNull\n  String street;\n  // ... and more\n}\nGiven this example; I would expect the following from vaadin to generate:\n\noptional text-input for doctorate\nrequired text-input for name\nrequired layout for mainAddress (in this example a simple text-field)\nbutton \"Add Secondary Address\" which creates a new layout for an address input + a \"Delete this secondary address button\"\n\nor am I mistaken that the Java Bean Validation says that every property is optional until otherwise specified via annotation?\nEdit: Currently with Binder you can specify \"asRequired()\" and the default value passed from server side won't break the UI. Meaning if it is null the combo box is just empty, otherwise it's filled with the current selected item. The TS world should be able to handle such cases as well. (without adding not intuitive annotations ;))", "author": "knoobie", "createdAt": "2020-08-11T16:28:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA4MTk0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTEzNzMzMQ==", "url": "https://github.com/vaadin/flow/pull/8835#discussion_r469137331", "bodyText": "@platosha Did I get the use case right that selection of MyForm (in the above example) is supposed to be a required field so that a null value is not considered valid (for submission), but it's \"nullable\" in the sense that we need to be able to store or refer to the state of the form when the user has not yet filled in the selection field?\nSo internally we need to be able to know that this field is null/empty even though it is a required field that must not be null for validation/submission.", "author": "Haprog", "createdAt": "2020-08-12T09:42:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA4MTk0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE0NDAzOA==", "url": "https://github.com/vaadin/flow/pull/8835#discussion_r469144038", "bodyText": "I agree that combining annotations like @NotNull and @Nullable makes no sense at least if they would be visible in user projects. If we need an additional annotation, better naming would be required for it.", "author": "Haprog", "createdAt": "2020-08-12T09:54:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA4MTk0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg2NjUyMw==", "url": "https://github.com/vaadin/flow/pull/8835#discussion_r469866523", "bodyText": "@knoobie very good point. Thanks again for your detailed response.\n@Haprog yes, that\u2019s the use case.\nLooks like it is a problem in the way our existing TS magic works. Perhaps have to reconsider our defaults in there to make our generated TypeScript fields nullable by default, as they work in Java. This change is not in scope of this PR, so to be done separately.\nFor now I removed the annotation from the fixture.", "author": "platosha", "createdAt": "2020-08-13T10:53:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA4MTk0Mw=="}], "type": "inlineReview"}, {"oid": "a910acddf5f197a66fdd1b648efdd78075e23756", "url": "https://github.com/vaadin/flow/commit/a910acddf5f197a66fdd1b648efdd78075e23756", "message": "Suppress large file warning and add refactoring TODO", "committedDate": "2020-08-12T09:57:04Z", "type": "forcePushed"}, {"oid": "20dcbccb28f55280f413a71a7d889da918999a86", "url": "https://github.com/vaadin/flow/commit/20dcbccb28f55280f413a71a7d889da918999a86", "message": "fix(TypeScript): Ensure model validators are generated for fields of bean type\n\nFixes #8821", "committedDate": "2020-08-13T10:51:26Z", "type": "commit"}, {"oid": "53ba10f6b8ff0c0404ef0c015be0e839fcf92119", "url": "https://github.com/vaadin/flow/commit/53ba10f6b8ff0c0404ef0c015be0e839fcf92119", "message": "Add a comment to test fixture", "committedDate": "2020-08-13T10:51:26Z", "type": "commit"}, {"oid": "40e140584e0b04c6c8bf821247076c80f801c503", "url": "https://github.com/vaadin/flow/commit/40e140584e0b04c6c8bf821247076c80f801c503", "message": "Remove confusing @Nullable annotation from test fixture", "committedDate": "2020-08-13T10:51:26Z", "type": "commit"}, {"oid": "5705603f474328ee1ab1fa392cc6770157aecc9e", "url": "https://github.com/vaadin/flow/commit/5705603f474328ee1ab1fa392cc6770157aecc9e", "message": "Suppress large file warning and add refactoring TODO", "committedDate": "2020-08-13T10:51:26Z", "type": "commit"}, {"oid": "0be4655eb0b5f0f51fb316b50a1048e355af05d3", "url": "https://github.com/vaadin/flow/commit/0be4655eb0b5f0f51fb316b50a1048e355af05d3", "message": "Fix TsFormTest fixture", "committedDate": "2020-08-13T10:51:26Z", "type": "commit"}, {"oid": "0be4655eb0b5f0f51fb316b50a1048e355af05d3", "url": "https://github.com/vaadin/flow/commit/0be4655eb0b5f0f51fb316b50a1048e355af05d3", "message": "Fix TsFormTest fixture", "committedDate": "2020-08-13T10:51:26Z", "type": "forcePushed"}, {"oid": "67eb385a39b4d618540a4da28a3ca2fb123f0b5e", "url": "https://github.com/vaadin/flow/commit/67eb385a39b4d618540a4da28a3ca2fb123f0b5e", "message": "refactor: split-out schema creating methods from OpenApiObjectGenerator", "committedDate": "2020-08-13T13:46:44Z", "type": "commit"}, {"oid": "5a6d23dac3301ed82fd46fb7eea88acb2f4ace9a", "url": "https://github.com/vaadin/flow/commit/5a6d23dac3301ed82fd46fb7eea88acb2f4ace9a", "message": "Make SchemaGenerator package-private", "committedDate": "2020-08-14T07:11:26Z", "type": "commit"}, {"oid": "0d7812f8fd9f87bb89937d299ed9d152e8207a14", "url": "https://github.com/vaadin/flow/commit/0d7812f8fd9f87bb89937d299ed9d152e8207a14", "message": "Fix syntax warnings in SchemaGenerator", "committedDate": "2020-08-14T07:13:36Z", "type": "commit"}, {"oid": "eef99392279412db2bd4469a6a3312b3b6b4d579", "url": "https://github.com/vaadin/flow/commit/eef99392279412db2bd4469a6a3312b3b6b4d579", "message": "Remove TODO and warning suppression", "committedDate": "2020-08-14T07:15:04Z", "type": "commit"}, {"oid": "2d2f5e79fe9552cff70e8570255d812e48329966", "url": "https://github.com/vaadin/flow/commit/2d2f5e79fe9552cff70e8570255d812e48329966", "message": "Fix syntax warnings in SchemaGenerator", "committedDate": "2020-08-14T07:16:02Z", "type": "commit"}]}