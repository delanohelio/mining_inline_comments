{"pr_number": 7881, "pr_title": "Extract frontend executable functionality to a separate contextual", "pr_createdAt": "2020-03-25T12:41:42Z", "pr_url": "https://github.com/vaadin/flow/pull/7881", "timeline": [{"oid": "6ae083f24da7d020aa517c323ac3f52e825edefe", "url": "https://github.com/vaadin/flow/commit/6ae083f24da7d020aa517c323ac3f52e825edefe", "message": "Extract frontend executable functionality to a separate contextual\nclass. (#7849)\n\nFixes #7771\n# Conflicts:\n#\tflow-server/src/main/java/com/vaadin/flow/server/DevModeHandler.java\n#\tflow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendUtils.java\n#\tflow-server/src/test/java/com/vaadin/flow/server/frontend/TaskRunPnpmInstallTest.java", "committedDate": "2020-03-25T12:26:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzM5OA==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827398", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:49:44Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/Constants.java", "diffHunk": "@@ -282,16 +282,76 @@\n      */\n     public static final String LOCAL_FRONTEND_RESOURCES_PATH = \"src/main/resources/META-INF/resources/frontend\";\n \n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NODE_MAJOR_VERSION = 10;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NODE_MINOR_VERSION = 0;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NPM_MAJOR_VERSION = 5;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzQwMw==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827403", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:49:45Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/Constants.java", "diffHunk": "@@ -282,16 +282,76 @@\n      */\n     public static final String LOCAL_FRONTEND_RESOURCES_PATH = \"src/main/resources/META-INF/resources/frontend\";\n \n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NODE_MAJOR_VERSION = 10;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzQxMA==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827410", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:49:46Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/Constants.java", "diffHunk": "@@ -282,16 +282,76 @@\n      */\n     public static final String LOCAL_FRONTEND_RESOURCES_PATH = \"src/main/resources/META-INF/resources/frontend\";\n \n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NODE_MAJOR_VERSION = 10;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NODE_MINOR_VERSION = 0;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NPM_MAJOR_VERSION = 5;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NPM_MINOR_VERSION = 6;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SHOULD_WORK_NODE_MAJOR_VERSION = 8;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SHOULD_WORK_NODE_MINOR_VERSION = 9;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SHOULD_WORK_NPM_MAJOR_VERSION = 5;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SHOULD_WORK_NPM_MINOR_VERSION = 5;\n \n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_PNPM_MAJOR_VERSION = 4;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_PNPM_MINOR_VERSION = 4;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzQyMw==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827423", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:49:47Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/Constants.java", "diffHunk": "@@ -282,16 +282,76 @@\n      */\n     public static final String LOCAL_FRONTEND_RESOURCES_PATH = \"src/main/resources/META-INF/resources/frontend\";\n \n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NODE_MAJOR_VERSION = 10;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NODE_MINOR_VERSION = 0;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NPM_MAJOR_VERSION = 5;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NPM_MINOR_VERSION = 6;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SHOULD_WORK_NODE_MAJOR_VERSION = 8;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SHOULD_WORK_NODE_MINOR_VERSION = 9;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SHOULD_WORK_NPM_MAJOR_VERSION = 5;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SHOULD_WORK_NPM_MINOR_VERSION = 5;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzQzMg==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827432", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:49:48Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/Constants.java", "diffHunk": "@@ -282,16 +282,76 @@\n      */\n     public static final String LOCAL_FRONTEND_RESOURCES_PATH = \"src/main/resources/META-INF/resources/frontend\";\n \n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NODE_MAJOR_VERSION = 10;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NODE_MINOR_VERSION = 0;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NPM_MAJOR_VERSION = 5;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NPM_MINOR_VERSION = 6;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SHOULD_WORK_NODE_MAJOR_VERSION = 8;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SHOULD_WORK_NODE_MINOR_VERSION = 9;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzQzNw==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827437", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:49:49Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/Constants.java", "diffHunk": "@@ -282,16 +282,76 @@\n      */\n     public static final String LOCAL_FRONTEND_RESOURCES_PATH = \"src/main/resources/META-INF/resources/frontend\";\n \n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NODE_MAJOR_VERSION = 10;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NODE_MINOR_VERSION = 0;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NPM_MAJOR_VERSION = 5;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NPM_MINOR_VERSION = 6;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzQ0MQ==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827441", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:49:50Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/Constants.java", "diffHunk": "@@ -282,16 +282,76 @@\n      */\n     public static final String LOCAL_FRONTEND_RESOURCES_PATH = \"src/main/resources/META-INF/resources/frontend\";\n \n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NODE_MAJOR_VERSION = 10;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NODE_MINOR_VERSION = 0;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzQ1Mg==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827452", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:49:51Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/Constants.java", "diffHunk": "@@ -282,16 +282,76 @@\n      */\n     public static final String LOCAL_FRONTEND_RESOURCES_PATH = \"src/main/resources/META-INF/resources/frontend\";\n \n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NODE_MAJOR_VERSION = 10;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NODE_MINOR_VERSION = 0;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NPM_MAJOR_VERSION = 5;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NPM_MINOR_VERSION = 6;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SHOULD_WORK_NODE_MAJOR_VERSION = 8;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SHOULD_WORK_NODE_MINOR_VERSION = 9;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SHOULD_WORK_NPM_MAJOR_VERSION = 5;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SHOULD_WORK_NPM_MINOR_VERSION = 5;\n \n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_PNPM_MAJOR_VERSION = 4;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzQ2Ng==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827466", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:49:52Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/Constants.java", "diffHunk": "@@ -282,16 +282,76 @@\n      */\n     public static final String LOCAL_FRONTEND_RESOURCES_PATH = \"src/main/resources/META-INF/resources/frontend\";\n \n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NODE_MAJOR_VERSION = 10;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NODE_MINOR_VERSION = 0;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NPM_MAJOR_VERSION = 5;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NPM_MINOR_VERSION = 6;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SHOULD_WORK_NODE_MAJOR_VERSION = 8;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SHOULD_WORK_NODE_MINOR_VERSION = 9;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SHOULD_WORK_NPM_MAJOR_VERSION = 5;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzQ4Mw==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827483", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:49:53Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/Constants.java", "diffHunk": "@@ -282,16 +282,76 @@\n      */\n     public static final String LOCAL_FRONTEND_RESOURCES_PATH = \"src/main/resources/META-INF/resources/frontend\";\n \n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NODE_MAJOR_VERSION = 10;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NODE_MINOR_VERSION = 0;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NPM_MAJOR_VERSION = 5;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SUPPORTED_NPM_MINOR_VERSION = 6;\n+    /**\n+     * Internal constant.\n+     *\n+     * @deprecated this is an internal constant, don't use it\n+     */\n+    @Deprecated\n     public static final int SHOULD_WORK_NODE_MAJOR_VERSION = 8;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzQ5Mg==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827492", "bodyText": "Remove this unused private \"getNonNull\" method.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:49:54Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendUtils.java", "diffHunk": "@@ -344,176 +269,11 @@ public static boolean isWindows() {\n         return getOsName().startsWith(\"Windows\");\n     }\n \n-    /**\n-     * Locate <code>node</code> executable.\n-     *\n-     * @param baseDir\n-     *            project root folder.\n-     *\n-     * @return the full path to the executable\n-     */\n-    public static String getNodeExecutable(String baseDir) {\n-        Pair<String, String> nodeCommands = getNodeCommands();\n-        return getExecutable(baseDir, nodeCommands.getFirst(),\n-                nodeCommands.getSecond(), true).getAbsolutePath();\n-    }\n-\n-    /**\n-     * Install node and npm into target directory.\n-     *\n-     *\n-     * @param baseDir\n-     *            project root folder.\n-     * @param installDirectory\n-     *            installation directory\n-     * @param nodeVersion\n-     *            node version to install\n-     * @param downloadRoot\n-     *            optional download root for downloading node. May be a\n-     *            filesystem file or a URL see\n-     *            {@link NodeInstaller#setNodeDownloadRoot(URI)}.\n-     * @return node installation path\n-     */\n-    protected static String installNode(String baseDir, File installDirectory,\n-            String nodeVersion, URI downloadRoot) {\n-        NodeInstaller nodeInstaller = new NodeInstaller(installDirectory,\n-                getProxies(baseDir)).setNodeVersion(nodeVersion);\n-        if (downloadRoot != null) {\n-            nodeInstaller.setNodeDownloadRoot(downloadRoot);\n-        }\n-\n-        try {\n-            nodeInstaller.install();\n-        } catch (InstallationException e) {\n-            throw new IllegalStateException(\"Failed to install Node\", e);\n-        }\n-\n-        String command = isWindows() ? \"node.exe\" : \"node\";\n-        return new File(nodeInstaller.getInstallDirectory(), command)\n-                .toString();\n-    }\n-\n-    /**\n-     * Read list of configured proxies in order from system properties, .npmrc\n-     * file in the project root folder, .npmrc file in user root folder and\n-     * system environment variables.\n-     *\n-     * @param baseDir\n-     *            project root folder.\n-     * @return list of configured proxies\n-     */\n-    // Not private because of test\n-    static List<ProxyConfig.Proxy> getProxies(String baseDir) {\n-        File projectNpmrc = new File(baseDir, \".npmrc\");\n-        File userNpmrc = new File(FileUtils.getUserDirectory(), \".npmrc\");\n-        List<ProxyConfig.Proxy> proxyList = new ArrayList<>();\n-\n-        proxyList.addAll(readProxySettingsFromSystemProperties());\n-        proxyList.addAll(\n-                readProxySettingsFromNpmrcFile(\"project .npmrc\", projectNpmrc));\n-        proxyList.addAll(\n-                readProxySettingsFromNpmrcFile(\"user .npmrc\", userNpmrc));\n-        proxyList.addAll(readProxySettingsFromEnvironmentVariables());\n-\n-        return proxyList;\n-    }\n-\n-    private static List<ProxyConfig.Proxy> readProxySettingsFromNpmrcFile(\n-            String fileDescription, File npmrc) {\n-        if (!npmrc.exists()) {\n-            return Collections.emptyList();\n-        }\n-\n-        try (FileReader fileReader = new FileReader(npmrc)) {\n-            List<ProxyConfig.Proxy> proxyList = new ArrayList<>(2);\n-            Properties properties = new Properties();\n-            properties.load(fileReader);\n-            String noproxy = properties.getProperty(NPMRC_NOPROXY_PROPERTY_KEY);\n-            if (noproxy != null)\n-                noproxy = noproxy.replaceAll(\",\", \"|\");\n-            String httpsProxyUrl = properties\n-                    .getProperty(NPMRC_HTTPS_PROXY_PROPERTY_KEY);\n-            if (httpsProxyUrl != null) {\n-                proxyList.add(new ProxyConfig.Proxy(\n-                        \"https-proxy - \" + fileDescription, httpsProxyUrl,\n-                        noproxy));\n-            }\n-            String proxyUrl = properties.getProperty(NPMRC_PROXY_PROPERTY_KEY);\n-            if (proxyUrl != null) {\n-                proxyList.add(new ProxyConfig.Proxy(\n-                        \"proxy - \" + fileDescription, proxyUrl, noproxy));\n-            }\n-            return proxyList;\n-        } catch (IOException e) {\n-            throw new UncheckedIOException(e);\n-        }\n-    }\n-\n-    private static List<ProxyConfig.Proxy> readProxySettingsFromSystemProperties() {\n-        List<ProxyConfig.Proxy> proxyList = new ArrayList<>(2);\n-\n-        String noproxy = getNonNull(\n-                System.getProperty(SYSTEM_NOPROXY_PROPERTY_KEY),\n-                System.getProperty(SYSTEM_NOPROXY_PROPERTY_KEY.toLowerCase()));\n-        if (noproxy != null) {\n-            noproxy = noproxy.replaceAll(\",\", \"|\");\n-        }\n-        \n-        String httpsProxyUrl = getNonNull(\n-                System.getProperty(SYSTEM_HTTPS_PROXY_PROPERTY_KEY),\n-                System.getProperty(\n-                        SYSTEM_HTTPS_PROXY_PROPERTY_KEY.toLowerCase()));\n-        if (httpsProxyUrl != null) {\n-            proxyList.add(new ProxyConfig.Proxy(\"https-proxy - system\",\n-                    httpsProxyUrl, noproxy));\n-        }\n-\n-        String proxyUrl = getNonNull(\n-                System.getProperty(SYSTEM_HTTP_PROXY_PROPERTY_KEY),\n-                System.getProperty(\n-                        SYSTEM_HTTP_PROXY_PROPERTY_KEY.toLowerCase()));\n-        if (proxyUrl != null) {\n-            proxyList.add(\n-                    new ProxyConfig.Proxy(\"proxy - system\", proxyUrl, noproxy));\n-        }\n-\n-        return proxyList;\n-    }\n-\n-    private static List<ProxyConfig.Proxy> readProxySettingsFromEnvironmentVariables() {\n-        List<ProxyConfig.Proxy> proxyList = new ArrayList<>(2);\n-\n-        String noproxy = getNonNull(\n-                System.getenv(SYSTEM_NOPROXY_PROPERTY_KEY),\n-                System.getenv(SYSTEM_NOPROXY_PROPERTY_KEY.toLowerCase()));\n-        if (noproxy != null) {\n-            noproxy = noproxy.replaceAll(\",\", \"|\");\n-        }\n-\n-        String httpsProxyUrl = getNonNull(\n-                System.getenv(SYSTEM_HTTPS_PROXY_PROPERTY_KEY),\n-                System.getenv(SYSTEM_HTTPS_PROXY_PROPERTY_KEY.toLowerCase()));\n-        if (httpsProxyUrl != null) {\n-            proxyList.add(new ProxyConfig.Proxy(\"https-proxy - env\",\n-                    httpsProxyUrl, noproxy));\n-        }\n-\n-        String proxyUrl = getNonNull(\n-                System.getenv(SYSTEM_HTTP_PROXY_PROPERTY_KEY),\n-                System.getenv(SYSTEM_HTTP_PROXY_PROPERTY_KEY.toLowerCase()));\n-        if (proxyUrl != null) {\n-            proxyList.add(\n-                    new ProxyConfig.Proxy(\"proxy - env\", proxyUrl, noproxy));\n-        }\n-\n-        return proxyList;\n-    }\n-\n     /**\n      * Get the first non null value from the given array.\n      *\n      * @param valueArray\n-     *         array of values to get non null from\n+     *            array of values to get non null from\n      * @return first non null value or null if no values found\n      */\n     private static String getNonNull(String... valueArray) {", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzUwNQ==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827505", "bodyText": "Remove this use of \"SUPPORTED_PNPM_MAJOR_VERSION\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:49:55Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendTools.java", "diffHunk": "@@ -0,0 +1,753 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.server.frontend;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.UncheckedIOException;\n+import java.net.URI;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.Properties;\n+import java.util.function.Supplier;\n+import java.util.stream.Collectors;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.vaadin.flow.internal.Pair;\n+import com.vaadin.flow.server.Constants;\n+import com.vaadin.flow.server.frontend.FrontendUtils.UnknownVersionException;\n+import com.vaadin.flow.server.frontend.installer.InstallationException;\n+import com.vaadin.flow.server.frontend.installer.NodeInstaller;\n+import com.vaadin.flow.server.frontend.installer.ProxyConfig;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonObject;\n+\n+/**\n+ * Provides access to frontend tools (node.js and npm, pnpm) and optionally\n+ * installs the tools if needed.\n+ * <p>\n+ * <b>WARNING:</b> This class is intended for internal usage only.\n+ *\n+ * @author Vaadin Ltd\n+ *\n+ */\n+public class FrontendTools {\n+\n+    private static final String DEFAULT_NODE_VERSION = \"v12.16.0\";\n+\n+    public static final String DEFAULT_PNPM_VERSION = \"4.5.0\";\n+\n+    public static final String INSTALL_NODE_LOCALLY = \"%n  $ mvn com.github.eirslett:frontend-maven-plugin:1.7.6:install-node-and-npm -DnodeVersion=\\\"v12.14.0\\\" \";\n+\n+    private static final String MSG_PREFIX = \"%n%n======================================================================================================\";\n+    private static final String MSG_SUFFIX = \"%n======================================================================================================%n\";\n+\n+    private static final String NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. Please install the latest LTS version of node.js (with npm) either by:\"\n+            + \"%n  1) following the https://nodejs.org/en/download/ guide to install it globally. This is the recommended way.\"\n+            + \"%n  2) running the following Maven plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY\n+            + \"%n%nNote that in case you don't install it globally, you'll need to install it again for another Vaadin project.\"\n+            + \"%nIn case you have just installed node.js globally, it was not discovered, so you need to restart your system to get the path variables updated.\"\n+            + MSG_SUFFIX;\n+\n+    private static final String LOCAL_NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. The %s directory already contains 'node' but it's either not a file \"\n+            + \"or not a 'node' executable. Please check %s directory and clean up it: remove '%s'.\"\n+            + \"%n then please run the app or maven goal again.\" + MSG_SUFFIX;\n+\n+    private static final String BAD_VERSION = MSG_PREFIX\n+            + \"%nYour installed '%s' version (%s) is known to have problems.\" //\n+            + \"%nPlease update to a new one either:\"\n+            + \"%n  - by following the https://nodejs.org/en/download/ guide to install it globally\"\n+            + \"%s\"\n+            + \"%n  - or by running the frontend-maven-plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY + \"%n\" //\n+            + FrontendUtils.DISABLE_CHECK //\n+            + MSG_SUFFIX;\n+\n+    private static final List<FrontendVersion> NPM_BLACKLISTED_VERSIONS = Arrays\n+            .asList(new FrontendVersion(\"6.11.0\"),\n+                    new FrontendVersion(\"6.11.1\"),\n+                    new FrontendVersion(\"6.11.2\"));\n+\n+    private static final String PNMP_INSTALLED_BY_NPM_FOLDER = \"node_modules/pnpm/\";\n+\n+    private static final String PNMP_INSTALLED_BY_NPM = PNMP_INSTALLED_BY_NPM_FOLDER\n+            + \"bin/pnpm.js\";\n+\n+    private static final int SUPPORTED_NODE_MAJOR_VERSION = Constants.SUPPORTED_NODE_MAJOR_VERSION;\n+    private static final int SUPPORTED_NODE_MINOR_VERSION = Constants.SUPPORTED_NODE_MINOR_VERSION;\n+    private static final int SUPPORTED_NPM_MAJOR_VERSION = Constants.SUPPORTED_NPM_MAJOR_VERSION;\n+    private static final int SUPPORTED_NPM_MINOR_VERSION = Constants.SUPPORTED_NPM_MINOR_VERSION;\n+    private static final int SHOULD_WORK_NODE_MAJOR_VERSION = Constants.SHOULD_WORK_NODE_MAJOR_VERSION;\n+    private static final int SHOULD_WORK_NODE_MINOR_VERSION = Constants.SHOULD_WORK_NODE_MINOR_VERSION;\n+    private static final int SHOULD_WORK_NPM_MAJOR_VERSION = Constants.SHOULD_WORK_NPM_MAJOR_VERSION;\n+    private static final int SHOULD_WORK_NPM_MINOR_VERSION = Constants.SHOULD_WORK_NPM_MINOR_VERSION;\n+\n+    public static final int SUPPORTED_PNPM_MAJOR_VERSION = Constants.SUPPORTED_PNPM_MAJOR_VERSION;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzUxNg==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827516", "bodyText": "Remove this use of \"SUPPORTED_PNPM_MINOR_VERSION\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:49:55Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendTools.java", "diffHunk": "@@ -0,0 +1,753 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.server.frontend;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.UncheckedIOException;\n+import java.net.URI;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.Properties;\n+import java.util.function.Supplier;\n+import java.util.stream.Collectors;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.vaadin.flow.internal.Pair;\n+import com.vaadin.flow.server.Constants;\n+import com.vaadin.flow.server.frontend.FrontendUtils.UnknownVersionException;\n+import com.vaadin.flow.server.frontend.installer.InstallationException;\n+import com.vaadin.flow.server.frontend.installer.NodeInstaller;\n+import com.vaadin.flow.server.frontend.installer.ProxyConfig;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonObject;\n+\n+/**\n+ * Provides access to frontend tools (node.js and npm, pnpm) and optionally\n+ * installs the tools if needed.\n+ * <p>\n+ * <b>WARNING:</b> This class is intended for internal usage only.\n+ *\n+ * @author Vaadin Ltd\n+ *\n+ */\n+public class FrontendTools {\n+\n+    private static final String DEFAULT_NODE_VERSION = \"v12.16.0\";\n+\n+    public static final String DEFAULT_PNPM_VERSION = \"4.5.0\";\n+\n+    public static final String INSTALL_NODE_LOCALLY = \"%n  $ mvn com.github.eirslett:frontend-maven-plugin:1.7.6:install-node-and-npm -DnodeVersion=\\\"v12.14.0\\\" \";\n+\n+    private static final String MSG_PREFIX = \"%n%n======================================================================================================\";\n+    private static final String MSG_SUFFIX = \"%n======================================================================================================%n\";\n+\n+    private static final String NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. Please install the latest LTS version of node.js (with npm) either by:\"\n+            + \"%n  1) following the https://nodejs.org/en/download/ guide to install it globally. This is the recommended way.\"\n+            + \"%n  2) running the following Maven plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY\n+            + \"%n%nNote that in case you don't install it globally, you'll need to install it again for another Vaadin project.\"\n+            + \"%nIn case you have just installed node.js globally, it was not discovered, so you need to restart your system to get the path variables updated.\"\n+            + MSG_SUFFIX;\n+\n+    private static final String LOCAL_NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. The %s directory already contains 'node' but it's either not a file \"\n+            + \"or not a 'node' executable. Please check %s directory and clean up it: remove '%s'.\"\n+            + \"%n then please run the app or maven goal again.\" + MSG_SUFFIX;\n+\n+    private static final String BAD_VERSION = MSG_PREFIX\n+            + \"%nYour installed '%s' version (%s) is known to have problems.\" //\n+            + \"%nPlease update to a new one either:\"\n+            + \"%n  - by following the https://nodejs.org/en/download/ guide to install it globally\"\n+            + \"%s\"\n+            + \"%n  - or by running the frontend-maven-plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY + \"%n\" //\n+            + FrontendUtils.DISABLE_CHECK //\n+            + MSG_SUFFIX;\n+\n+    private static final List<FrontendVersion> NPM_BLACKLISTED_VERSIONS = Arrays\n+            .asList(new FrontendVersion(\"6.11.0\"),\n+                    new FrontendVersion(\"6.11.1\"),\n+                    new FrontendVersion(\"6.11.2\"));\n+\n+    private static final String PNMP_INSTALLED_BY_NPM_FOLDER = \"node_modules/pnpm/\";\n+\n+    private static final String PNMP_INSTALLED_BY_NPM = PNMP_INSTALLED_BY_NPM_FOLDER\n+            + \"bin/pnpm.js\";\n+\n+    private static final int SUPPORTED_NODE_MAJOR_VERSION = Constants.SUPPORTED_NODE_MAJOR_VERSION;\n+    private static final int SUPPORTED_NODE_MINOR_VERSION = Constants.SUPPORTED_NODE_MINOR_VERSION;\n+    private static final int SUPPORTED_NPM_MAJOR_VERSION = Constants.SUPPORTED_NPM_MAJOR_VERSION;\n+    private static final int SUPPORTED_NPM_MINOR_VERSION = Constants.SUPPORTED_NPM_MINOR_VERSION;\n+    private static final int SHOULD_WORK_NODE_MAJOR_VERSION = Constants.SHOULD_WORK_NODE_MAJOR_VERSION;\n+    private static final int SHOULD_WORK_NODE_MINOR_VERSION = Constants.SHOULD_WORK_NODE_MINOR_VERSION;\n+    private static final int SHOULD_WORK_NPM_MAJOR_VERSION = Constants.SHOULD_WORK_NPM_MAJOR_VERSION;\n+    private static final int SHOULD_WORK_NPM_MINOR_VERSION = Constants.SHOULD_WORK_NPM_MINOR_VERSION;\n+\n+    public static final int SUPPORTED_PNPM_MAJOR_VERSION = Constants.SUPPORTED_PNPM_MAJOR_VERSION;\n+    public static final int SUPPORTED_PNPM_MINOR_VERSION = Constants.SUPPORTED_PNPM_MINOR_VERSION;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzUyMA==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827520", "bodyText": "Remove this use of \"SUPPORTED_NODE_MAJOR_VERSION\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:49:56Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendTools.java", "diffHunk": "@@ -0,0 +1,753 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.server.frontend;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.UncheckedIOException;\n+import java.net.URI;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.Properties;\n+import java.util.function.Supplier;\n+import java.util.stream.Collectors;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.vaadin.flow.internal.Pair;\n+import com.vaadin.flow.server.Constants;\n+import com.vaadin.flow.server.frontend.FrontendUtils.UnknownVersionException;\n+import com.vaadin.flow.server.frontend.installer.InstallationException;\n+import com.vaadin.flow.server.frontend.installer.NodeInstaller;\n+import com.vaadin.flow.server.frontend.installer.ProxyConfig;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonObject;\n+\n+/**\n+ * Provides access to frontend tools (node.js and npm, pnpm) and optionally\n+ * installs the tools if needed.\n+ * <p>\n+ * <b>WARNING:</b> This class is intended for internal usage only.\n+ *\n+ * @author Vaadin Ltd\n+ *\n+ */\n+public class FrontendTools {\n+\n+    private static final String DEFAULT_NODE_VERSION = \"v12.16.0\";\n+\n+    public static final String DEFAULT_PNPM_VERSION = \"4.5.0\";\n+\n+    public static final String INSTALL_NODE_LOCALLY = \"%n  $ mvn com.github.eirslett:frontend-maven-plugin:1.7.6:install-node-and-npm -DnodeVersion=\\\"v12.14.0\\\" \";\n+\n+    private static final String MSG_PREFIX = \"%n%n======================================================================================================\";\n+    private static final String MSG_SUFFIX = \"%n======================================================================================================%n\";\n+\n+    private static final String NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. Please install the latest LTS version of node.js (with npm) either by:\"\n+            + \"%n  1) following the https://nodejs.org/en/download/ guide to install it globally. This is the recommended way.\"\n+            + \"%n  2) running the following Maven plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY\n+            + \"%n%nNote that in case you don't install it globally, you'll need to install it again for another Vaadin project.\"\n+            + \"%nIn case you have just installed node.js globally, it was not discovered, so you need to restart your system to get the path variables updated.\"\n+            + MSG_SUFFIX;\n+\n+    private static final String LOCAL_NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. The %s directory already contains 'node' but it's either not a file \"\n+            + \"or not a 'node' executable. Please check %s directory and clean up it: remove '%s'.\"\n+            + \"%n then please run the app or maven goal again.\" + MSG_SUFFIX;\n+\n+    private static final String BAD_VERSION = MSG_PREFIX\n+            + \"%nYour installed '%s' version (%s) is known to have problems.\" //\n+            + \"%nPlease update to a new one either:\"\n+            + \"%n  - by following the https://nodejs.org/en/download/ guide to install it globally\"\n+            + \"%s\"\n+            + \"%n  - or by running the frontend-maven-plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY + \"%n\" //\n+            + FrontendUtils.DISABLE_CHECK //\n+            + MSG_SUFFIX;\n+\n+    private static final List<FrontendVersion> NPM_BLACKLISTED_VERSIONS = Arrays\n+            .asList(new FrontendVersion(\"6.11.0\"),\n+                    new FrontendVersion(\"6.11.1\"),\n+                    new FrontendVersion(\"6.11.2\"));\n+\n+    private static final String PNMP_INSTALLED_BY_NPM_FOLDER = \"node_modules/pnpm/\";\n+\n+    private static final String PNMP_INSTALLED_BY_NPM = PNMP_INSTALLED_BY_NPM_FOLDER\n+            + \"bin/pnpm.js\";\n+\n+    private static final int SUPPORTED_NODE_MAJOR_VERSION = Constants.SUPPORTED_NODE_MAJOR_VERSION;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzUyNw==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827527", "bodyText": "Remove this use of \"SUPPORTED_NODE_MINOR_VERSION\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:49:57Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendTools.java", "diffHunk": "@@ -0,0 +1,753 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.server.frontend;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.UncheckedIOException;\n+import java.net.URI;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.Properties;\n+import java.util.function.Supplier;\n+import java.util.stream.Collectors;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.vaadin.flow.internal.Pair;\n+import com.vaadin.flow.server.Constants;\n+import com.vaadin.flow.server.frontend.FrontendUtils.UnknownVersionException;\n+import com.vaadin.flow.server.frontend.installer.InstallationException;\n+import com.vaadin.flow.server.frontend.installer.NodeInstaller;\n+import com.vaadin.flow.server.frontend.installer.ProxyConfig;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonObject;\n+\n+/**\n+ * Provides access to frontend tools (node.js and npm, pnpm) and optionally\n+ * installs the tools if needed.\n+ * <p>\n+ * <b>WARNING:</b> This class is intended for internal usage only.\n+ *\n+ * @author Vaadin Ltd\n+ *\n+ */\n+public class FrontendTools {\n+\n+    private static final String DEFAULT_NODE_VERSION = \"v12.16.0\";\n+\n+    public static final String DEFAULT_PNPM_VERSION = \"4.5.0\";\n+\n+    public static final String INSTALL_NODE_LOCALLY = \"%n  $ mvn com.github.eirslett:frontend-maven-plugin:1.7.6:install-node-and-npm -DnodeVersion=\\\"v12.14.0\\\" \";\n+\n+    private static final String MSG_PREFIX = \"%n%n======================================================================================================\";\n+    private static final String MSG_SUFFIX = \"%n======================================================================================================%n\";\n+\n+    private static final String NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. Please install the latest LTS version of node.js (with npm) either by:\"\n+            + \"%n  1) following the https://nodejs.org/en/download/ guide to install it globally. This is the recommended way.\"\n+            + \"%n  2) running the following Maven plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY\n+            + \"%n%nNote that in case you don't install it globally, you'll need to install it again for another Vaadin project.\"\n+            + \"%nIn case you have just installed node.js globally, it was not discovered, so you need to restart your system to get the path variables updated.\"\n+            + MSG_SUFFIX;\n+\n+    private static final String LOCAL_NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. The %s directory already contains 'node' but it's either not a file \"\n+            + \"or not a 'node' executable. Please check %s directory and clean up it: remove '%s'.\"\n+            + \"%n then please run the app or maven goal again.\" + MSG_SUFFIX;\n+\n+    private static final String BAD_VERSION = MSG_PREFIX\n+            + \"%nYour installed '%s' version (%s) is known to have problems.\" //\n+            + \"%nPlease update to a new one either:\"\n+            + \"%n  - by following the https://nodejs.org/en/download/ guide to install it globally\"\n+            + \"%s\"\n+            + \"%n  - or by running the frontend-maven-plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY + \"%n\" //\n+            + FrontendUtils.DISABLE_CHECK //\n+            + MSG_SUFFIX;\n+\n+    private static final List<FrontendVersion> NPM_BLACKLISTED_VERSIONS = Arrays\n+            .asList(new FrontendVersion(\"6.11.0\"),\n+                    new FrontendVersion(\"6.11.1\"),\n+                    new FrontendVersion(\"6.11.2\"));\n+\n+    private static final String PNMP_INSTALLED_BY_NPM_FOLDER = \"node_modules/pnpm/\";\n+\n+    private static final String PNMP_INSTALLED_BY_NPM = PNMP_INSTALLED_BY_NPM_FOLDER\n+            + \"bin/pnpm.js\";\n+\n+    private static final int SUPPORTED_NODE_MAJOR_VERSION = Constants.SUPPORTED_NODE_MAJOR_VERSION;\n+    private static final int SUPPORTED_NODE_MINOR_VERSION = Constants.SUPPORTED_NODE_MINOR_VERSION;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzUzNQ==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827535", "bodyText": "Remove this use of \"SUPPORTED_NPM_MAJOR_VERSION\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:49:59Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendTools.java", "diffHunk": "@@ -0,0 +1,753 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.server.frontend;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.UncheckedIOException;\n+import java.net.URI;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.Properties;\n+import java.util.function.Supplier;\n+import java.util.stream.Collectors;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.vaadin.flow.internal.Pair;\n+import com.vaadin.flow.server.Constants;\n+import com.vaadin.flow.server.frontend.FrontendUtils.UnknownVersionException;\n+import com.vaadin.flow.server.frontend.installer.InstallationException;\n+import com.vaadin.flow.server.frontend.installer.NodeInstaller;\n+import com.vaadin.flow.server.frontend.installer.ProxyConfig;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonObject;\n+\n+/**\n+ * Provides access to frontend tools (node.js and npm, pnpm) and optionally\n+ * installs the tools if needed.\n+ * <p>\n+ * <b>WARNING:</b> This class is intended for internal usage only.\n+ *\n+ * @author Vaadin Ltd\n+ *\n+ */\n+public class FrontendTools {\n+\n+    private static final String DEFAULT_NODE_VERSION = \"v12.16.0\";\n+\n+    public static final String DEFAULT_PNPM_VERSION = \"4.5.0\";\n+\n+    public static final String INSTALL_NODE_LOCALLY = \"%n  $ mvn com.github.eirslett:frontend-maven-plugin:1.7.6:install-node-and-npm -DnodeVersion=\\\"v12.14.0\\\" \";\n+\n+    private static final String MSG_PREFIX = \"%n%n======================================================================================================\";\n+    private static final String MSG_SUFFIX = \"%n======================================================================================================%n\";\n+\n+    private static final String NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. Please install the latest LTS version of node.js (with npm) either by:\"\n+            + \"%n  1) following the https://nodejs.org/en/download/ guide to install it globally. This is the recommended way.\"\n+            + \"%n  2) running the following Maven plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY\n+            + \"%n%nNote that in case you don't install it globally, you'll need to install it again for another Vaadin project.\"\n+            + \"%nIn case you have just installed node.js globally, it was not discovered, so you need to restart your system to get the path variables updated.\"\n+            + MSG_SUFFIX;\n+\n+    private static final String LOCAL_NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. The %s directory already contains 'node' but it's either not a file \"\n+            + \"or not a 'node' executable. Please check %s directory and clean up it: remove '%s'.\"\n+            + \"%n then please run the app or maven goal again.\" + MSG_SUFFIX;\n+\n+    private static final String BAD_VERSION = MSG_PREFIX\n+            + \"%nYour installed '%s' version (%s) is known to have problems.\" //\n+            + \"%nPlease update to a new one either:\"\n+            + \"%n  - by following the https://nodejs.org/en/download/ guide to install it globally\"\n+            + \"%s\"\n+            + \"%n  - or by running the frontend-maven-plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY + \"%n\" //\n+            + FrontendUtils.DISABLE_CHECK //\n+            + MSG_SUFFIX;\n+\n+    private static final List<FrontendVersion> NPM_BLACKLISTED_VERSIONS = Arrays\n+            .asList(new FrontendVersion(\"6.11.0\"),\n+                    new FrontendVersion(\"6.11.1\"),\n+                    new FrontendVersion(\"6.11.2\"));\n+\n+    private static final String PNMP_INSTALLED_BY_NPM_FOLDER = \"node_modules/pnpm/\";\n+\n+    private static final String PNMP_INSTALLED_BY_NPM = PNMP_INSTALLED_BY_NPM_FOLDER\n+            + \"bin/pnpm.js\";\n+\n+    private static final int SUPPORTED_NODE_MAJOR_VERSION = Constants.SUPPORTED_NODE_MAJOR_VERSION;\n+    private static final int SUPPORTED_NODE_MINOR_VERSION = Constants.SUPPORTED_NODE_MINOR_VERSION;\n+    private static final int SUPPORTED_NPM_MAJOR_VERSION = Constants.SUPPORTED_NPM_MAJOR_VERSION;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzU0Mw==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827543", "bodyText": "Remove this use of \"SUPPORTED_NPM_MINOR_VERSION\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:49:59Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendTools.java", "diffHunk": "@@ -0,0 +1,753 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.server.frontend;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.UncheckedIOException;\n+import java.net.URI;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.Properties;\n+import java.util.function.Supplier;\n+import java.util.stream.Collectors;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.vaadin.flow.internal.Pair;\n+import com.vaadin.flow.server.Constants;\n+import com.vaadin.flow.server.frontend.FrontendUtils.UnknownVersionException;\n+import com.vaadin.flow.server.frontend.installer.InstallationException;\n+import com.vaadin.flow.server.frontend.installer.NodeInstaller;\n+import com.vaadin.flow.server.frontend.installer.ProxyConfig;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonObject;\n+\n+/**\n+ * Provides access to frontend tools (node.js and npm, pnpm) and optionally\n+ * installs the tools if needed.\n+ * <p>\n+ * <b>WARNING:</b> This class is intended for internal usage only.\n+ *\n+ * @author Vaadin Ltd\n+ *\n+ */\n+public class FrontendTools {\n+\n+    private static final String DEFAULT_NODE_VERSION = \"v12.16.0\";\n+\n+    public static final String DEFAULT_PNPM_VERSION = \"4.5.0\";\n+\n+    public static final String INSTALL_NODE_LOCALLY = \"%n  $ mvn com.github.eirslett:frontend-maven-plugin:1.7.6:install-node-and-npm -DnodeVersion=\\\"v12.14.0\\\" \";\n+\n+    private static final String MSG_PREFIX = \"%n%n======================================================================================================\";\n+    private static final String MSG_SUFFIX = \"%n======================================================================================================%n\";\n+\n+    private static final String NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. Please install the latest LTS version of node.js (with npm) either by:\"\n+            + \"%n  1) following the https://nodejs.org/en/download/ guide to install it globally. This is the recommended way.\"\n+            + \"%n  2) running the following Maven plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY\n+            + \"%n%nNote that in case you don't install it globally, you'll need to install it again for another Vaadin project.\"\n+            + \"%nIn case you have just installed node.js globally, it was not discovered, so you need to restart your system to get the path variables updated.\"\n+            + MSG_SUFFIX;\n+\n+    private static final String LOCAL_NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. The %s directory already contains 'node' but it's either not a file \"\n+            + \"or not a 'node' executable. Please check %s directory and clean up it: remove '%s'.\"\n+            + \"%n then please run the app or maven goal again.\" + MSG_SUFFIX;\n+\n+    private static final String BAD_VERSION = MSG_PREFIX\n+            + \"%nYour installed '%s' version (%s) is known to have problems.\" //\n+            + \"%nPlease update to a new one either:\"\n+            + \"%n  - by following the https://nodejs.org/en/download/ guide to install it globally\"\n+            + \"%s\"\n+            + \"%n  - or by running the frontend-maven-plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY + \"%n\" //\n+            + FrontendUtils.DISABLE_CHECK //\n+            + MSG_SUFFIX;\n+\n+    private static final List<FrontendVersion> NPM_BLACKLISTED_VERSIONS = Arrays\n+            .asList(new FrontendVersion(\"6.11.0\"),\n+                    new FrontendVersion(\"6.11.1\"),\n+                    new FrontendVersion(\"6.11.2\"));\n+\n+    private static final String PNMP_INSTALLED_BY_NPM_FOLDER = \"node_modules/pnpm/\";\n+\n+    private static final String PNMP_INSTALLED_BY_NPM = PNMP_INSTALLED_BY_NPM_FOLDER\n+            + \"bin/pnpm.js\";\n+\n+    private static final int SUPPORTED_NODE_MAJOR_VERSION = Constants.SUPPORTED_NODE_MAJOR_VERSION;\n+    private static final int SUPPORTED_NODE_MINOR_VERSION = Constants.SUPPORTED_NODE_MINOR_VERSION;\n+    private static final int SUPPORTED_NPM_MAJOR_VERSION = Constants.SUPPORTED_NPM_MAJOR_VERSION;\n+    private static final int SUPPORTED_NPM_MINOR_VERSION = Constants.SUPPORTED_NPM_MINOR_VERSION;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzU1NQ==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827555", "bodyText": "Remove this use of \"SHOULD_WORK_NODE_MAJOR_VERSION\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:50:00Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendTools.java", "diffHunk": "@@ -0,0 +1,753 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.server.frontend;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.UncheckedIOException;\n+import java.net.URI;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.Properties;\n+import java.util.function.Supplier;\n+import java.util.stream.Collectors;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.vaadin.flow.internal.Pair;\n+import com.vaadin.flow.server.Constants;\n+import com.vaadin.flow.server.frontend.FrontendUtils.UnknownVersionException;\n+import com.vaadin.flow.server.frontend.installer.InstallationException;\n+import com.vaadin.flow.server.frontend.installer.NodeInstaller;\n+import com.vaadin.flow.server.frontend.installer.ProxyConfig;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonObject;\n+\n+/**\n+ * Provides access to frontend tools (node.js and npm, pnpm) and optionally\n+ * installs the tools if needed.\n+ * <p>\n+ * <b>WARNING:</b> This class is intended for internal usage only.\n+ *\n+ * @author Vaadin Ltd\n+ *\n+ */\n+public class FrontendTools {\n+\n+    private static final String DEFAULT_NODE_VERSION = \"v12.16.0\";\n+\n+    public static final String DEFAULT_PNPM_VERSION = \"4.5.0\";\n+\n+    public static final String INSTALL_NODE_LOCALLY = \"%n  $ mvn com.github.eirslett:frontend-maven-plugin:1.7.6:install-node-and-npm -DnodeVersion=\\\"v12.14.0\\\" \";\n+\n+    private static final String MSG_PREFIX = \"%n%n======================================================================================================\";\n+    private static final String MSG_SUFFIX = \"%n======================================================================================================%n\";\n+\n+    private static final String NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. Please install the latest LTS version of node.js (with npm) either by:\"\n+            + \"%n  1) following the https://nodejs.org/en/download/ guide to install it globally. This is the recommended way.\"\n+            + \"%n  2) running the following Maven plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY\n+            + \"%n%nNote that in case you don't install it globally, you'll need to install it again for another Vaadin project.\"\n+            + \"%nIn case you have just installed node.js globally, it was not discovered, so you need to restart your system to get the path variables updated.\"\n+            + MSG_SUFFIX;\n+\n+    private static final String LOCAL_NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. The %s directory already contains 'node' but it's either not a file \"\n+            + \"or not a 'node' executable. Please check %s directory and clean up it: remove '%s'.\"\n+            + \"%n then please run the app or maven goal again.\" + MSG_SUFFIX;\n+\n+    private static final String BAD_VERSION = MSG_PREFIX\n+            + \"%nYour installed '%s' version (%s) is known to have problems.\" //\n+            + \"%nPlease update to a new one either:\"\n+            + \"%n  - by following the https://nodejs.org/en/download/ guide to install it globally\"\n+            + \"%s\"\n+            + \"%n  - or by running the frontend-maven-plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY + \"%n\" //\n+            + FrontendUtils.DISABLE_CHECK //\n+            + MSG_SUFFIX;\n+\n+    private static final List<FrontendVersion> NPM_BLACKLISTED_VERSIONS = Arrays\n+            .asList(new FrontendVersion(\"6.11.0\"),\n+                    new FrontendVersion(\"6.11.1\"),\n+                    new FrontendVersion(\"6.11.2\"));\n+\n+    private static final String PNMP_INSTALLED_BY_NPM_FOLDER = \"node_modules/pnpm/\";\n+\n+    private static final String PNMP_INSTALLED_BY_NPM = PNMP_INSTALLED_BY_NPM_FOLDER\n+            + \"bin/pnpm.js\";\n+\n+    private static final int SUPPORTED_NODE_MAJOR_VERSION = Constants.SUPPORTED_NODE_MAJOR_VERSION;\n+    private static final int SUPPORTED_NODE_MINOR_VERSION = Constants.SUPPORTED_NODE_MINOR_VERSION;\n+    private static final int SUPPORTED_NPM_MAJOR_VERSION = Constants.SUPPORTED_NPM_MAJOR_VERSION;\n+    private static final int SUPPORTED_NPM_MINOR_VERSION = Constants.SUPPORTED_NPM_MINOR_VERSION;\n+    private static final int SHOULD_WORK_NODE_MAJOR_VERSION = Constants.SHOULD_WORK_NODE_MAJOR_VERSION;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzU2NQ==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827565", "bodyText": "Remove this use of \"SHOULD_WORK_NODE_MINOR_VERSION\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:50:02Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendTools.java", "diffHunk": "@@ -0,0 +1,753 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.server.frontend;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.UncheckedIOException;\n+import java.net.URI;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.Properties;\n+import java.util.function.Supplier;\n+import java.util.stream.Collectors;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.vaadin.flow.internal.Pair;\n+import com.vaadin.flow.server.Constants;\n+import com.vaadin.flow.server.frontend.FrontendUtils.UnknownVersionException;\n+import com.vaadin.flow.server.frontend.installer.InstallationException;\n+import com.vaadin.flow.server.frontend.installer.NodeInstaller;\n+import com.vaadin.flow.server.frontend.installer.ProxyConfig;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonObject;\n+\n+/**\n+ * Provides access to frontend tools (node.js and npm, pnpm) and optionally\n+ * installs the tools if needed.\n+ * <p>\n+ * <b>WARNING:</b> This class is intended for internal usage only.\n+ *\n+ * @author Vaadin Ltd\n+ *\n+ */\n+public class FrontendTools {\n+\n+    private static final String DEFAULT_NODE_VERSION = \"v12.16.0\";\n+\n+    public static final String DEFAULT_PNPM_VERSION = \"4.5.0\";\n+\n+    public static final String INSTALL_NODE_LOCALLY = \"%n  $ mvn com.github.eirslett:frontend-maven-plugin:1.7.6:install-node-and-npm -DnodeVersion=\\\"v12.14.0\\\" \";\n+\n+    private static final String MSG_PREFIX = \"%n%n======================================================================================================\";\n+    private static final String MSG_SUFFIX = \"%n======================================================================================================%n\";\n+\n+    private static final String NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. Please install the latest LTS version of node.js (with npm) either by:\"\n+            + \"%n  1) following the https://nodejs.org/en/download/ guide to install it globally. This is the recommended way.\"\n+            + \"%n  2) running the following Maven plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY\n+            + \"%n%nNote that in case you don't install it globally, you'll need to install it again for another Vaadin project.\"\n+            + \"%nIn case you have just installed node.js globally, it was not discovered, so you need to restart your system to get the path variables updated.\"\n+            + MSG_SUFFIX;\n+\n+    private static final String LOCAL_NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. The %s directory already contains 'node' but it's either not a file \"\n+            + \"or not a 'node' executable. Please check %s directory and clean up it: remove '%s'.\"\n+            + \"%n then please run the app or maven goal again.\" + MSG_SUFFIX;\n+\n+    private static final String BAD_VERSION = MSG_PREFIX\n+            + \"%nYour installed '%s' version (%s) is known to have problems.\" //\n+            + \"%nPlease update to a new one either:\"\n+            + \"%n  - by following the https://nodejs.org/en/download/ guide to install it globally\"\n+            + \"%s\"\n+            + \"%n  - or by running the frontend-maven-plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY + \"%n\" //\n+            + FrontendUtils.DISABLE_CHECK //\n+            + MSG_SUFFIX;\n+\n+    private static final List<FrontendVersion> NPM_BLACKLISTED_VERSIONS = Arrays\n+            .asList(new FrontendVersion(\"6.11.0\"),\n+                    new FrontendVersion(\"6.11.1\"),\n+                    new FrontendVersion(\"6.11.2\"));\n+\n+    private static final String PNMP_INSTALLED_BY_NPM_FOLDER = \"node_modules/pnpm/\";\n+\n+    private static final String PNMP_INSTALLED_BY_NPM = PNMP_INSTALLED_BY_NPM_FOLDER\n+            + \"bin/pnpm.js\";\n+\n+    private static final int SUPPORTED_NODE_MAJOR_VERSION = Constants.SUPPORTED_NODE_MAJOR_VERSION;\n+    private static final int SUPPORTED_NODE_MINOR_VERSION = Constants.SUPPORTED_NODE_MINOR_VERSION;\n+    private static final int SUPPORTED_NPM_MAJOR_VERSION = Constants.SUPPORTED_NPM_MAJOR_VERSION;\n+    private static final int SUPPORTED_NPM_MINOR_VERSION = Constants.SUPPORTED_NPM_MINOR_VERSION;\n+    private static final int SHOULD_WORK_NODE_MAJOR_VERSION = Constants.SHOULD_WORK_NODE_MAJOR_VERSION;\n+    private static final int SHOULD_WORK_NODE_MINOR_VERSION = Constants.SHOULD_WORK_NODE_MINOR_VERSION;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzU3Mg==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827572", "bodyText": "Remove this use of \"SHOULD_WORK_NPM_MAJOR_VERSION\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:50:02Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendTools.java", "diffHunk": "@@ -0,0 +1,753 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.server.frontend;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.UncheckedIOException;\n+import java.net.URI;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.Properties;\n+import java.util.function.Supplier;\n+import java.util.stream.Collectors;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.vaadin.flow.internal.Pair;\n+import com.vaadin.flow.server.Constants;\n+import com.vaadin.flow.server.frontend.FrontendUtils.UnknownVersionException;\n+import com.vaadin.flow.server.frontend.installer.InstallationException;\n+import com.vaadin.flow.server.frontend.installer.NodeInstaller;\n+import com.vaadin.flow.server.frontend.installer.ProxyConfig;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonObject;\n+\n+/**\n+ * Provides access to frontend tools (node.js and npm, pnpm) and optionally\n+ * installs the tools if needed.\n+ * <p>\n+ * <b>WARNING:</b> This class is intended for internal usage only.\n+ *\n+ * @author Vaadin Ltd\n+ *\n+ */\n+public class FrontendTools {\n+\n+    private static final String DEFAULT_NODE_VERSION = \"v12.16.0\";\n+\n+    public static final String DEFAULT_PNPM_VERSION = \"4.5.0\";\n+\n+    public static final String INSTALL_NODE_LOCALLY = \"%n  $ mvn com.github.eirslett:frontend-maven-plugin:1.7.6:install-node-and-npm -DnodeVersion=\\\"v12.14.0\\\" \";\n+\n+    private static final String MSG_PREFIX = \"%n%n======================================================================================================\";\n+    private static final String MSG_SUFFIX = \"%n======================================================================================================%n\";\n+\n+    private static final String NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. Please install the latest LTS version of node.js (with npm) either by:\"\n+            + \"%n  1) following the https://nodejs.org/en/download/ guide to install it globally. This is the recommended way.\"\n+            + \"%n  2) running the following Maven plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY\n+            + \"%n%nNote that in case you don't install it globally, you'll need to install it again for another Vaadin project.\"\n+            + \"%nIn case you have just installed node.js globally, it was not discovered, so you need to restart your system to get the path variables updated.\"\n+            + MSG_SUFFIX;\n+\n+    private static final String LOCAL_NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. The %s directory already contains 'node' but it's either not a file \"\n+            + \"or not a 'node' executable. Please check %s directory and clean up it: remove '%s'.\"\n+            + \"%n then please run the app or maven goal again.\" + MSG_SUFFIX;\n+\n+    private static final String BAD_VERSION = MSG_PREFIX\n+            + \"%nYour installed '%s' version (%s) is known to have problems.\" //\n+            + \"%nPlease update to a new one either:\"\n+            + \"%n  - by following the https://nodejs.org/en/download/ guide to install it globally\"\n+            + \"%s\"\n+            + \"%n  - or by running the frontend-maven-plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY + \"%n\" //\n+            + FrontendUtils.DISABLE_CHECK //\n+            + MSG_SUFFIX;\n+\n+    private static final List<FrontendVersion> NPM_BLACKLISTED_VERSIONS = Arrays\n+            .asList(new FrontendVersion(\"6.11.0\"),\n+                    new FrontendVersion(\"6.11.1\"),\n+                    new FrontendVersion(\"6.11.2\"));\n+\n+    private static final String PNMP_INSTALLED_BY_NPM_FOLDER = \"node_modules/pnpm/\";\n+\n+    private static final String PNMP_INSTALLED_BY_NPM = PNMP_INSTALLED_BY_NPM_FOLDER\n+            + \"bin/pnpm.js\";\n+\n+    private static final int SUPPORTED_NODE_MAJOR_VERSION = Constants.SUPPORTED_NODE_MAJOR_VERSION;\n+    private static final int SUPPORTED_NODE_MINOR_VERSION = Constants.SUPPORTED_NODE_MINOR_VERSION;\n+    private static final int SUPPORTED_NPM_MAJOR_VERSION = Constants.SUPPORTED_NPM_MAJOR_VERSION;\n+    private static final int SUPPORTED_NPM_MINOR_VERSION = Constants.SUPPORTED_NPM_MINOR_VERSION;\n+    private static final int SHOULD_WORK_NODE_MAJOR_VERSION = Constants.SHOULD_WORK_NODE_MAJOR_VERSION;\n+    private static final int SHOULD_WORK_NODE_MINOR_VERSION = Constants.SHOULD_WORK_NODE_MINOR_VERSION;\n+    private static final int SHOULD_WORK_NPM_MAJOR_VERSION = Constants.SHOULD_WORK_NPM_MAJOR_VERSION;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyNzU4NA==", "url": "https://github.com/vaadin/flow/pull/7881#discussion_r397827584", "bodyText": "Remove this use of \"SHOULD_WORK_NPM_MINOR_VERSION\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-03-25T12:50:04Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendTools.java", "diffHunk": "@@ -0,0 +1,753 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.server.frontend;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.UncheckedIOException;\n+import java.net.URI;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.Properties;\n+import java.util.function.Supplier;\n+import java.util.stream.Collectors;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.vaadin.flow.internal.Pair;\n+import com.vaadin.flow.server.Constants;\n+import com.vaadin.flow.server.frontend.FrontendUtils.UnknownVersionException;\n+import com.vaadin.flow.server.frontend.installer.InstallationException;\n+import com.vaadin.flow.server.frontend.installer.NodeInstaller;\n+import com.vaadin.flow.server.frontend.installer.ProxyConfig;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonObject;\n+\n+/**\n+ * Provides access to frontend tools (node.js and npm, pnpm) and optionally\n+ * installs the tools if needed.\n+ * <p>\n+ * <b>WARNING:</b> This class is intended for internal usage only.\n+ *\n+ * @author Vaadin Ltd\n+ *\n+ */\n+public class FrontendTools {\n+\n+    private static final String DEFAULT_NODE_VERSION = \"v12.16.0\";\n+\n+    public static final String DEFAULT_PNPM_VERSION = \"4.5.0\";\n+\n+    public static final String INSTALL_NODE_LOCALLY = \"%n  $ mvn com.github.eirslett:frontend-maven-plugin:1.7.6:install-node-and-npm -DnodeVersion=\\\"v12.14.0\\\" \";\n+\n+    private static final String MSG_PREFIX = \"%n%n======================================================================================================\";\n+    private static final String MSG_SUFFIX = \"%n======================================================================================================%n\";\n+\n+    private static final String NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. Please install the latest LTS version of node.js (with npm) either by:\"\n+            + \"%n  1) following the https://nodejs.org/en/download/ guide to install it globally. This is the recommended way.\"\n+            + \"%n  2) running the following Maven plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY\n+            + \"%n%nNote that in case you don't install it globally, you'll need to install it again for another Vaadin project.\"\n+            + \"%nIn case you have just installed node.js globally, it was not discovered, so you need to restart your system to get the path variables updated.\"\n+            + MSG_SUFFIX;\n+\n+    private static final String LOCAL_NODE_NOT_FOUND = MSG_PREFIX\n+            + \"%nVaadin requires node.js & npm to be installed. The %s directory already contains 'node' but it's either not a file \"\n+            + \"or not a 'node' executable. Please check %s directory and clean up it: remove '%s'.\"\n+            + \"%n then please run the app or maven goal again.\" + MSG_SUFFIX;\n+\n+    private static final String BAD_VERSION = MSG_PREFIX\n+            + \"%nYour installed '%s' version (%s) is known to have problems.\" //\n+            + \"%nPlease update to a new one either:\"\n+            + \"%n  - by following the https://nodejs.org/en/download/ guide to install it globally\"\n+            + \"%s\"\n+            + \"%n  - or by running the frontend-maven-plugin goal to install it in this project:\"\n+            + INSTALL_NODE_LOCALLY + \"%n\" //\n+            + FrontendUtils.DISABLE_CHECK //\n+            + MSG_SUFFIX;\n+\n+    private static final List<FrontendVersion> NPM_BLACKLISTED_VERSIONS = Arrays\n+            .asList(new FrontendVersion(\"6.11.0\"),\n+                    new FrontendVersion(\"6.11.1\"),\n+                    new FrontendVersion(\"6.11.2\"));\n+\n+    private static final String PNMP_INSTALLED_BY_NPM_FOLDER = \"node_modules/pnpm/\";\n+\n+    private static final String PNMP_INSTALLED_BY_NPM = PNMP_INSTALLED_BY_NPM_FOLDER\n+            + \"bin/pnpm.js\";\n+\n+    private static final int SUPPORTED_NODE_MAJOR_VERSION = Constants.SUPPORTED_NODE_MAJOR_VERSION;\n+    private static final int SUPPORTED_NODE_MINOR_VERSION = Constants.SUPPORTED_NODE_MINOR_VERSION;\n+    private static final int SUPPORTED_NPM_MAJOR_VERSION = Constants.SUPPORTED_NPM_MAJOR_VERSION;\n+    private static final int SUPPORTED_NPM_MINOR_VERSION = Constants.SUPPORTED_NPM_MINOR_VERSION;\n+    private static final int SHOULD_WORK_NODE_MAJOR_VERSION = Constants.SHOULD_WORK_NODE_MAJOR_VERSION;\n+    private static final int SHOULD_WORK_NODE_MINOR_VERSION = Constants.SHOULD_WORK_NODE_MINOR_VERSION;\n+    private static final int SHOULD_WORK_NPM_MAJOR_VERSION = Constants.SHOULD_WORK_NPM_MAJOR_VERSION;\n+    private static final int SHOULD_WORK_NPM_MINOR_VERSION = Constants.SHOULD_WORK_NPM_MINOR_VERSION;", "originalCommit": "6ae083f24da7d020aa517c323ac3f52e825edefe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f6da7fd08950b8d89e0d61e1c0c0d7f2ad5f43dc", "url": "https://github.com/vaadin/flow/commit/f6da7fd08950b8d89e0d61e1c0c0d7f2ad5f43dc", "message": "Fix javadocs", "committedDate": "2020-03-25T12:55:50Z", "type": "commit"}, {"oid": "e4772fd856256c891bc284ff0ceb298a843e865c", "url": "https://github.com/vaadin/flow/commit/e4772fd856256c891bc284ff0ceb298a843e865c", "message": "Don't catch Exception (#7857)", "committedDate": "2020-03-25T12:58:46Z", "type": "commit"}, {"oid": "b949191245382b1186d7feb029870c7474b26ded", "url": "https://github.com/vaadin/flow/commit/b949191245382b1186d7feb029870c7474b26ded", "message": "Take globally installed pnpm into account in the tests\nUse temp dir to install bower.", "committedDate": "2020-03-25T13:36:02Z", "type": "commit"}]}