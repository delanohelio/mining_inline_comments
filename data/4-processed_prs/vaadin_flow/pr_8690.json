{"pr_number": 8690, "pr_title": "fix: render server errors and submitting state", "pr_createdAt": "2020-07-03T17:14:41Z", "pr_url": "https://github.com/vaadin/flow/pull/8690", "timeline": [{"oid": "a942d0ca0a249def414a18a42e5470c667ebc7cd", "url": "https://github.com/vaadin/flow/commit/a942d0ca0a249def414a18a42e5470c667ebc7cd", "message": "fix: render server errors and submitting state\n\nFixes #8631", "committedDate": "2020-07-03T17:13:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA1MDk0NQ==", "url": "https://github.com/vaadin/flow/pull/8690#discussion_r450050945", "bodyText": "What's the main reason why reset(this.value) does not always call update() itself?\nIn this case it would be convenient to keep the one line reset(this.value) instead of implementing something similar to reset locally.\nWhat's the case when I would want to call reset() without calling update()? Should there be a short comment to explain this here?", "author": "vlukashov", "createdAt": "2020-07-06T08:04:45Z", "path": "flow-client/src/main/resources/META-INF/resources/frontend/form/Binder.ts", "diffHunk": "@@ -109,18 +109,20 @@ export class Binder<T, M extends AbstractModel<T>> extends BinderNode<T, M> {\n       return await endpointMethod.call(this.context, this.value);\n     } catch (error) {\n       if (error.validationErrorData && error.validationErrorData.length) {\n-        const valueErrors:Array<ValueError<any>> = [];\n+        const valueErrors: Array<ValueError<any>> = [];\n         error.validationErrorData.forEach((data:any) => {\n           const res = /Object of type '(.+)' has invalid property '(.+)' with value '(.+)', validation error: '(.+)'/.exec(data.message);\n           const [property, value, message] = res ? res.splice(2) : [data.parameterName, undefined, data.message];\n           valueErrors.push({ property, value, validator: new ServerValidator(message), message });\n         });\n+        this.setErrorsWithDescendants(valueErrors);\n         error = new ValidationError(valueErrors);\n       }\n       throw (error);\n     } finally {\n       this[submittingSymbol] = false;\n-      this.reset(this.value);\n+      this.defaultValue = this.value;", "originalCommit": "a942d0ca0a249def414a18a42e5470c667ebc7cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDEzMzc2Nw==", "url": "https://github.com/vaadin/flow/pull/8690#discussion_r450133767", "bodyText": "In this case we cannot call reset() because it has a side-effect of clearing all validation errors we might just have received as a result of server validation.\nBtw, I\u2019m not sure here if we want to change the default form value at all after unsuccessful submit.\nreset() does not always call update() because that results in duplicate updates with the value setter.", "author": "platosha", "createdAt": "2020-07-06T10:35:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA1MDk0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE1NTcyOQ==", "url": "https://github.com/vaadin/flow/pull/8690#discussion_r450155729", "bodyText": "\ud83d\udc4d", "author": "vlukashov", "createdAt": "2020-07-06T11:24:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA1MDk0NQ=="}], "type": "inlineReview"}, {"oid": "42b5dc3d2795065029b6e99a461fbc23b34174a5", "url": "https://github.com/vaadin/flow/commit/42b5dc3d2795065029b6e99a461fbc23b34174a5", "message": "Fix linter error", "committedDate": "2020-07-06T10:16:54Z", "type": "commit"}, {"oid": "21ed3744a7f90e5d4ffe419c206d9a9921669467", "url": "https://github.com/vaadin/flow/commit/21ed3744a7f90e5d4ffe419c206d9a9921669467", "message": "Add comments to code", "committedDate": "2020-07-06T10:29:16Z", "type": "commit"}]}