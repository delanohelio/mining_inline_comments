{"pr_number": 9677, "pr_title": "Merge offline to master", "pr_createdAt": "2020-12-17T07:10:29Z", "pr_url": "https://github.com/vaadin/flow/pull/9677", "timeline": [{"oid": "9252de596afec687ca38327316ac823d80ee0e6f", "url": "https://github.com/vaadin/flow/commit/9252de596afec687ca38327316ac823d80ee0e6f", "message": "fix: verify server line by HEAD to /sw.js instead of / (#9739)\n\nTo avoid false positive due to service worker serving precached index.html.\r\n\r\nFixes #9688.", "committedDate": "2021-01-05T07:52:09Z", "type": "commit"}, {"oid": "8b2272681b2641084bf57887427e3ed739377ded", "url": "https://github.com/vaadin/flow/commit/8b2272681b2641084bf57887427e3ed739377ded", "message": "Merge branch 'feature/offline' into merge-offline-to-master", "committedDate": "2021-01-05T07:54:57Z", "type": "commit"}, {"oid": "b937ebb03ce29fe8e4e2fbccef6209a39b21e5f7", "url": "https://github.com/vaadin/flow/commit/b937ebb03ce29fe8e4e2fbccef6209a39b21e5f7", "message": "feat(offline): emit offline resources list in generated webpack config (#8941)\n\nThis does a necessary ground work for emitting PWA configuration in `webpack.generated.js`. Done so far:\r\n\r\n- `PwaConfiguration` is now public, to enable usage from `TaskUpdateWebpack`\r\n-  `PwaConfiguration` does not depend on `ServiceContext`, which is unavailable during build. `PwaRegistry` is changed accordingly.\r\n- `TaskUpdateWeback` is moved from `prepare-frontend` to `build-frontend`, so that it could find the annotation in compiled classes\r\n- `webpack.generated.js` template now includes a list of offline resources coming from `PwaConfiguration`\r\n- In `NodeTasks`, the `TaskUpdateWebpack` is now enqueued using a default `PwaConfiguration`\r\n- `DevModeInitializer` always runs `TaskUpdateWebpack`, to ensure that it is up-to-date\r\n\r\nRemains TBD in the scope of the ticket: use frontend scanner to find the `@PWA` annotation and construct `PwaConfiguration` based on that. I guess this is coming in a separate PR, as this quite big already.", "committedDate": "2020-09-08T13:07:31Z", "type": "commit"}, {"oid": "b3d0104be3ae64c8df3986adfe050c41308e9a91", "url": "https://github.com/vaadin/flow/commit/b3d0104be3ae64c8df3986adfe050c41308e9a91", "message": "feat: Endpoint generation based on @Deferrable (#8992)\n\n- When there is a `@Deferrable` in an Endpoint class or method, the generated function will return a `DeferrableResult` instead.\r\n- If no `@Deferrable` is present, the generated code is the same as before.", "committedDate": "2020-09-10T07:37:16Z", "type": "commit"}, {"oid": "6d07a5d66ca0f69844472194aed7bc5cb68e4ed5", "url": "https://github.com/vaadin/flow/commit/6d07a5d66ca0f69844472194aed7bc5cb68e4ed5", "message": "feat: support deferrable endpoint request (#8999)\n\n- Add client.deferrableCall() which allows caching the endpoint request when offline\r\n- Generated endpoints will call `client.deferrableCall()` if a `@Deferrable` annotion is detected (#8951)\r\n- Use a IndexedDB helper `\"idb-keyval\": \"3.2.0\"` for easier indexedDB manipulation\r\n- Use an uuid helper `\"uuid\": \"8.0.0\"` for generating uuid", "committedDate": "2020-09-11T10:04:35Z", "type": "commit"}, {"oid": "8f998e067224b1525d069a1ee78e040d937ae3e9", "url": "https://github.com/vaadin/flow/commit/8f998e067224b1525d069a1ee78e040d937ae3e9", "message": "Merge branch 'master' into haijian/merge-master-to-offline", "committedDate": "2020-09-15T19:24:42Z", "type": "commit"}, {"oid": "e7f5a3b902e9de09964fb655d54113ddd00842ec", "url": "https://github.com/vaadin/flow/commit/e7f5a3b902e9de09964fb655d54113ddd00842ec", "message": "Merge master to offline", "committedDate": "2020-09-18T09:01:01Z", "type": "commit"}, {"oid": "847f33c3487ddca0787a50c781ee644e09436a1c", "url": "https://github.com/vaadin/flow/commit/847f33c3487ddca0787a50c781ee644e09436a1c", "message": "feat(offline): read @PWA to configure webpack build (#8993)\n\n* feat(offline): read @PWA to configure webpack build\r\n\r\nFixes #8983\r\n\r\n* Return default PwaConfiguration in full scanner when annotation not found\r\n\r\n* Fix knownClasses in test\r\n\r\n* fix: NPE during PwaConfiguration instantiation in FrontendDependencies\r\n\r\n* Add tests and apply analysis suggestions\r\n\r\n* test: ensure TaskUpdateWebpack generates offlineResources from PwaConfiguration\r\n\r\n* test: ensure offline resources are listed in webpack from PWA annotaion\r\n\r\n* fix PwaTestIT fixture app as PWA annotation must be on AppShell class\r\n\r\n* Update test fixtures so that PWA annotation is on AppShell\r\n\r\n* Update flow-server/src/main/java/com/vaadin/flow/server/frontend/scanner/FrontendAnnotatedClassVisitor.java\r\n\r\nCo-authored-by: Artem Godin <fluorumlabs@users.noreply.github.com>\r\n\r\n* Update flow-server/src/main/java/com/vaadin/flow/server/frontend/scanner/FrontendAnnotatedClassVisitor.java\r\n\r\nCo-authored-by: Artem Godin <fluorumlabs@users.noreply.github.com>\r\n\r\n* Apply review suggestions\r\n\r\n* Apply IDE suggestions\r\n\r\n* fix: visit annotation items from repeatable container\r\n\r\n* Add periods to javadoc comments.\r\n\r\n* Remove unnecessary error log line\r\n\r\n* fix: use non-deprecated constant\r\n\r\n* Use better name for PWA annotation error\r\n\r\nCo-authored-by: Artem Godin <fluorumlabs@users.noreply.github.com>", "committedDate": "2020-09-23T11:33:48Z", "type": "commit"}, {"oid": "d617b27fc39cc8b3b8b87ce8cc53692afbc63e6c", "url": "https://github.com/vaadin/flow/commit/d617b27fc39cc8b3b8b87ce8cc53692afbc63e6c", "message": "feat: submit cached endpoint requests in window online listener (#9036)", "committedDate": "2020-09-30T08:01:49Z", "type": "commit"}, {"oid": "29581acc65267c921c76ddb848b982c26b5bd8de", "url": "https://github.com/vaadin/flow/commit/29581acc65267c921c76ddb848b982c26b5bd8de", "message": "chore: add @ts-ignore to DeferrableResult import (#9075)", "committedDate": "2020-09-30T09:01:24Z", "type": "commit"}, {"oid": "d69c44539dcf86ecce4bb5a399e137276bc3f1ba", "url": "https://github.com/vaadin/flow/commit/d69c44539dcf86ecce4bb5a399e137276bc3f1ba", "message": "Move service worker generation to webpack config (#8940)\n\n* Move service worker generation to webpack config\r\n\r\nWIP related to #8911.\r\n\r\nTODO:\r\n- service worker should be registered and work both in dev and production mode (after `mvn clean` and removal of webpack.generated.js)\r\n- following things should be somehow added to workbox precache manifest (with hash/revision):\r\n  - offline.html (currently runtime generated)\r\n  - manifest.webmanifest (currently runtime generated)\r\n  - pwa/app icons (currently runtime generated), only webmanifest icons?\r\n\r\n* Fix SonarQube complaints\r\n\r\n* Enable serving webpack generated sw and workbox js resources in DevMode\r\n\r\n* fix typo in webpack.generated.js template\r\n\r\n* Add asset manifest json to webpack\r\n\r\n* Align all webpack output files to use META-INF/VAADIN/webapp/\r\n\r\n* Map all webpack output resource paths listed in manifest.json\r\n\r\n* cleanup in webpack.generated.js\r\n\r\n* fix serving root-located Vaadin resources in StaticFileServer.java\r\n\r\n* Precache the app shell and use it as navigateFallback\r\n\r\nMove serviceWorkerPlugin after HtmlWebpackPlugin so that it adds the generated index.html into the precache manifest automatically. Enable navigateFallback to precache the app shell (index.html served from '/' with some runtime changes).\r\n\r\n* Use CopyPlugin to to include offline resources to workbox precache (#8982)\r\n\r\n* Move config/ json resources back to META-INF/VAADIN/config\r\n\r\nThis partially reverts earlier changes, moving the config output files `META-INF/VAADIN/webapp/VAADIN/config` back to `META-INF/VAADIN/config`. Motivation:\r\n\r\n- Configuration resources are not intended for serving. Having `config/` outside of `webapp/` public resource root fits better in that regard.\r\n- Fixes tests expecting configuration json resources in their original location.\r\n\r\nAdditionally, this reverts several constants to their original value, including `VAADIN_SERVLET_RESOURCES`, `STATISTICS_JSON_DEFAULT`, and `VAADIN_CONFIGURATION_FILES_PATH` is removed.\r\n\r\nA new constant `VAADIN_WEBAPP_RESOURCES` is introduced to refer to the default location of served resources root.\r\n\r\n* Move `index.html` test resource to webapp/\r\n\r\n* fix(test): support manifest.json in StaticFileServerTest\r\n\r\n* fix(test): support \"manifest.json\" request in DevModeHandlerTest\r\n\r\n* fix: obfuscate root url '/' to pass absolute path test\r\n\r\n* add resourceOutputDirectory parameter to generated webpack config\r\n\r\n* fix: support webpack internal prefixing of output bundles in BootstrapHandler\r\n\r\n* fix: skip \"index.html\" in mapped static resource paths\r\n\r\n* fix: relax performance IT startup time threshold\r\n\r\n* fix(test): skip rootUrl when checking absolute paths in TaskUpdateWebpackTest\r\n\r\n* refactor: apply analysis suggestions\r\n\r\n* refactor: apply analysis suggessions\r\n\r\n* refactor: extract FrontendUtil.parseManifestPaths utility method\r\n\r\n* test: handling manifest paths in DevModeHanlder and StaticFileServer\r\n\r\n* chore: mention issue link in TODO\r\n\r\nCo-authored-by: Anton Platonov <platosha@gmail.com>\r\nCo-authored-by: Haijian Wang <30408303+haijian-vaadin@users.noreply.github.com>", "committedDate": "2020-09-30T12:03:27Z", "type": "commit"}, {"oid": "e8de5f85f5ba9429c20c388522e550d64bab8d98", "url": "https://github.com/vaadin/flow/commit/e8de5f85f5ba9429c20c388522e550d64bab8d98", "message": "Merge branch 'master' into haijian/merge-master", "committedDate": "2020-09-30T19:32:05Z", "type": "commit"}, {"oid": "0abbf7ecd305dff637a496b144d80c0831f0f52a", "url": "https://github.com/vaadin/flow/commit/0abbf7ecd305dff637a496b144d80c0831f0f52a", "message": "Merge master to offline feature branch", "committedDate": "2020-10-01T07:44:37Z", "type": "commit"}, {"oid": "395be3ca77581db68c3ab425a418777522d35569", "url": "https://github.com/vaadin/flow/commit/395be3ca77581db68c3ab425a418777522d35569", "message": "feat(offline): expose isDeferred flag on MiddlewareContext (#9094)\n\nConnected to #9046", "committedDate": "2020-10-02T12:29:54Z", "type": "commit"}, {"oid": "318d20f84ffbee0c087498fd864f6872be93485b", "url": "https://github.com/vaadin/flow/commit/318d20f84ffbee0c087498fd864f6872be93485b", "message": "feat: Precache runtime generated resources (#9109)\n\nPrecache generated icons, webmanifest and offline.html in the service worker.\r\n\r\nUse `InjectManifest` instead of `GenerateSW` (from `workbox-webpack-plugin`). Define service worker template in `sw.js` and generate it via maven plugin (if it doesn't exist).\r\n\r\nThere's a new Java request handler for `/sw-runtime-resources-precache.js` that defines an array of additional entries for the precache manifest. This makes it easy to get correct hashes for precaching runtime generated resources (icons, webmanifest, etc.). This script declares an array `self.additionalManifestEntries` which is imported into the main service worker with `importScripts('sw-runtime-resources-precache.js');` (imported at runtime). It is then merged with the manifest entries injected by `InjectManifest` plugin and precached with workbox.\r\n\r\nConvert service worker source to Type Script. After starting to use workbox with TypeScript (in sw.ts) the webpack build started randomly failing. This seemed to be solved by adding \"webworker\" to \"lib\" section of tsconfig.json. See https://github.com/GoogleChrome/workbox/issues/2584#issuecomment-704889527\r\n\r\nFixes #9063 and #9064", "committedDate": "2020-10-07T21:18:46Z", "type": "commit"}, {"oid": "1ecb227bb54cabbc075175cdc03f8524298a6623", "url": "https://github.com/vaadin/flow/commit/1ecb227bb54cabbc075175cdc03f8524298a6623", "message": "feat(offline): add processDeferredCalls / onDeferredCall API to ConnectClient (#9128)\n\nFixes #9046", "committedDate": "2020-10-08T09:01:04Z", "type": "commit"}, {"oid": "193bd1f62aaf822cc64b98071348295f32394ab2", "url": "https://github.com/vaadin/flow/commit/193bd1f62aaf822cc64b98071348295f32394ab2", "message": "fix: don't check import in compilation unit for @Deferrable (#9127)", "committedDate": "2020-10-08T09:24:05Z", "type": "commit"}, {"oid": "ea5b561362c33f0e582769ec89c201cf0548c048", "url": "https://github.com/vaadin/flow/commit/ea5b561362c33f0e582769ec89c201cf0548c048", "message": "fix: declare webworker lib for sw.ts with TS triple-slash directive (#9153)\n\nRevert adding lib section to tsconfig.json to avoid needing a manual upgrade step in projects.\r\n\r\nFixes #9144", "committedDate": "2020-10-12T06:42:56Z", "type": "commit"}, {"oid": "d292c8de532e639ae82ada71cad245cfb657b71f", "url": "https://github.com/vaadin/flow/commit/d292c8de532e639ae82ada71cad245cfb657b71f", "message": "Merge branch 'master' into merge-master-to-offline", "committedDate": "2020-10-14T09:05:44Z", "type": "commit"}, {"oid": "98b8b8769e253576be2eaf0d5fd54bc0cbd9d9e7", "url": "https://github.com/vaadin/flow/commit/98b8b8769e253576be2eaf0d5fd54bc0cbd9d9e7", "message": "Merge pull request #9177 from vaadin/merge-master-to-offline\n\nMerge master to offline", "committedDate": "2020-10-14T10:10:23Z", "type": "commit"}, {"oid": "1801b16d54e2d2978906b5c88f134daafe33bd57", "url": "https://github.com/vaadin/flow/commit/1801b16d54e2d2978906b5c88f134daafe33bd57", "message": "Merge pull request #9210 from vaadin/master\n\nMerge master into feature/offline", "committedDate": "2020-10-21T12:08:45Z", "type": "commit"}, {"oid": "273e684727a14ff40adbe76b20923ab01327ac35", "url": "https://github.com/vaadin/flow/commit/273e684727a14ff40adbe76b20923ab01327ac35", "message": "fix: implement navigation fallback (#9183)\n\nFixes #9137", "committedDate": "2020-10-22T07:36:56Z", "type": "commit"}, {"oid": "3c34523c15828cf61c2085c394db11b28b5337cb", "url": "https://github.com/vaadin/flow/commit/3c34523c15828cf61c2085c394db11b28b5337cb", "message": "chore: Update README with branch versions (#9148)\n\nUpdated `master` to reference version 5.0. Added a few missing branches/versions. Updated to table format.", "committedDate": "2020-10-26T14:35:36Z", "type": "commit"}, {"oid": "5b85a0db9072250f14e789374914b61483014f54", "url": "https://github.com/vaadin/flow/commit/5b85a0db9072250f14e789374914b61483014f54", "message": "chore: Update chrome to 86 (#9221)", "committedDate": "2020-10-26T14:35:36Z", "type": "commit"}, {"oid": "131ffa3a51e54cd2d19f8bc1ce42e443b2338801", "url": "https://github.com/vaadin/flow/commit/131ffa3a51e54cd2d19f8bc1ce42e443b2338801", "message": "fix: add maven plugin documentation (#9204)\n\nAdd documentation on maven plugin\r\ngoals and configuration options.\r\n\r\nFixes #8617", "committedDate": "2020-10-26T14:35:36Z", "type": "commit"}, {"oid": "6f2c5a1d55cd9cec45eaf3eabb1c521e05fa724d", "url": "https://github.com/vaadin/flow/commit/6f2c5a1d55cd9cec45eaf3eabb1c521e05fa724d", "message": "test: Fix duplicate registration (#9233)\n\nLock the registry when registering\r\ndynamic route in serviceInit to not have\r\na race where 2 inits note that path is not\r\nregistered and then try to register the route.\r\n\r\nFixes #9223", "committedDate": "2020-10-26T14:35:36Z", "type": "commit"}, {"oid": "f7644414d0d19183fdf965a93e09e1c8da37e2d1", "url": "https://github.com/vaadin/flow/commit/f7644414d0d19183fdf965a93e09e1c8da37e2d1", "message": "fix: use relative path reference to index.html (`.` instead of `/`) (#9226)\n\nFixes #9216", "committedDate": "2020-10-26T19:54:07Z", "type": "commit"}, {"oid": "ffc0326710f8c704746546c85394b409f162b26f", "url": "https://github.com/vaadin/flow/commit/ffc0326710f8c704746546c85394b409f162b26f", "message": "fix(offline): support offlinePath from PWA annotation (#9181)\n\n* fix: enable using PWA offlinePath HTML for offline mode when set\r\n\r\nFixes #8856\r\n\r\n* fix(test): avoid casting of CI RemoteWebDriver to ChromeDriver\r\n\r\n* fix(test): use setNetworkConnection API for offline testing\r\n\r\n* fix(test): try waiting for offline page load\r\n\r\n* fix(test): enable service workers in CI remote Chrome\r\n\r\n* fix(PwaTestIT): remove headless flags from Chrome\r\n\r\n* refactor(test): extract ChromeDeviceTest superclass and cleanup\r\n\r\n* docs: fix offlinePath description on file not found case", "committedDate": "2020-10-28T10:50:11Z", "type": "commit"}, {"oid": "b543aef60396a3498bf2836e0d0c401313cd9091", "url": "https://github.com/vaadin/flow/commit/b543aef60396a3498bf2836e0d0c401313cd9091", "message": "feat: offline stub for server-side views (#9200)\n\nAn information page, similar in style and content to the default offline.html, is rendered in\r\nwhen navigating to a server-side view in offline mode.\r\n\r\nFixes #9132.", "committedDate": "2020-10-29T08:01:01Z", "type": "commit"}, {"oid": "8cb3721d469b2c8d126f100133d2d078922aac62", "url": "https://github.com/vaadin/flow/commit/8cb3721d469b2c8d126f100133d2d078922aac62", "message": "fix: make field with @Id nullable in TypeScript (#9253)\n\nWithout the fix, the id field will have a default value of 0, which can be wrong when saving a new entity.\r\n\r\nCo-authored-by: Anton Platonov <anton@vaadin.com>", "committedDate": "2020-10-29T11:23:49Z", "type": "commit"}, {"oid": "29dbd0200939a1b9efa6116b41ff8cf54389247c", "url": "https://github.com/vaadin/flow/commit/29dbd0200939a1b9efa6116b41ff8cf54389247c", "message": "feat: defer deferrable endpoint calls on network failure (#9244)\n\nA `@Deferrable` endpoint call will be stored locally in case of network failures.", "committedDate": "2020-10-29T18:50:59Z", "type": "commit"}, {"oid": "e6de7378691e736a43c52430186f460112250d95", "url": "https://github.com/vaadin/flow/commit/e6de7378691e736a43c52430186f460112250d95", "message": "Add test for navigation fallback (#9261)\n\n* test: add test for offline start aka navigation fallback\r\n\r\nCloses #9215\r\n\r\n* test: fix test and refactor\r\n\r\n* test: try to fix script timeout in test\r\n\r\n* test: revert setScriptTimeout in ChromeDeviceTest\r\n\r\n* test: fix test in OfflineServerViewIT\r\n\r\nCo-authored-by: Haijian Wang <30408303+haijian-vaadin@users.noreply.github.com>", "committedDate": "2020-10-30T09:36:33Z", "type": "commit"}, {"oid": "2c4db5ae903750a44fb223b157cd3d669389e6fb", "url": "https://github.com/vaadin/flow/commit/2c4db5ae903750a44fb223b157cd3d669389e6fb", "message": "fix(offline): resolve offlineResources at runtime (#9258)\n\n* fix: resolve offlineResources at runtime\r\n\r\n* Run ITs in sequence\r\n\r\n* Check isOfflinePathEnabled when deciding about precaching offline html\r\n\r\n* Removed IT sequential forcing, added mimeType check\r\n\r\n* waitForServiceWorkerReady", "committedDate": "2020-10-30T11:08:06Z", "type": "commit"}, {"oid": "bef21cd879ba1d349f0da881435568a8480a616b", "url": "https://github.com/vaadin/flow/commit/bef21cd879ba1d349f0da881435568a8480a616b", "message": "test: service-worker aware live reload IT (#9285)\n\n* test: service-worker aware live reload ITs\r\n\r\n* refactor: split Java and frontend-triggered live reload tests into separate classes, and added functional test for PreserveOnRefresh", "committedDate": "2020-11-03T19:37:42Z", "type": "commit"}, {"oid": "da6cc55357798ca122676790e90119d01da041be", "url": "https://github.com/vaadin/flow/commit/da6cc55357798ca122676790e90119d01da041be", "message": "fix: enable workbox Webpack plugin only for PWAs (#9296)\n\nCo-authored-by: Haijian Wang <30408303+haijian-vaadin@users.noreply.github.com>", "committedDate": "2020-11-04T07:58:26Z", "type": "commit"}, {"oid": "3c8d3104e6c9afad1633a8c72fe99e6c312425a1", "url": "https://github.com/vaadin/flow/commit/3c8d3104e6c9afad1633a8c72fe99e6c312425a1", "message": "refactor(offline): deferred call submission status API refactor (#9304)\n\n- use DeferredCallHandler class instead of a callback function\n- instead of relying on re-throwing error to keep the deferred request in the queue,\n  now it uses deferredCallSubmitter.keepDeferredCallInTheQueue();\n- renamed EndpointRequest to DeferredCall\n- created a common interface EndpointCallMetaInfo for holding the meta info of an\n  endpoint call. Both MiddlewareContext and DeferredCall extend from it.\n- split offline related code to a separate Offline.ts file\n\nFixes #9243.", "committedDate": "2020-11-04T14:04:16Z", "type": "commit"}, {"oid": "b4a8c3e683f4aa309f8f409c9ee99be7cb032525", "url": "https://github.com/vaadin/flow/commit/b4a8c3e683f4aa309f8f409c9ee99be7cb032525", "message": "fix(offline): navigation fallback (#9280)\n\nFixes #9218.\n\nThis makes navigation fallback (offline start) use the same service worker logic as we use for `offlinePath`, just using the app shell route `/` instead of the route to offline page for the cache entry to be returned. I did some manual testing and this does seem to fix the issues described in #9218.\n\nThe added IT seems to be a false negative (always passes) and doesn't fail even without the fix, test can be fixed in #9314", "committedDate": "2020-11-04T15:33:29Z", "type": "commit"}, {"oid": "eba82c08f3a20dae4744dc10c4796247e67aa681", "url": "https://github.com/vaadin/flow/commit/eba82c08f3a20dae4744dc10c4796247e67aa681", "message": "fix: do not attempt to call `$server.leaveNavigation` in offline case (#9335)", "committedDate": "2020-11-06T12:46:04Z", "type": "commit"}, {"oid": "00ef3a27a85f2cb5bb5707f7f1dbd4b4c2b54880", "url": "https://github.com/vaadin/flow/commit/00ef3a27a85f2cb5bb5707f7f1dbd4b4c2b54880", "message": "chore: consolidated offline navigation tests to single class (#9325)\n\nFixes #9121", "committedDate": "2020-11-06T14:12:21Z", "type": "commit"}, {"oid": "304780274a96c463255748fc0969703d574af6de", "url": "https://github.com/vaadin/flow/commit/304780274a96c463255748fc0969703d574af6de", "message": "generate sw.ts to frontend folder when pwa enabled (#9309)\n\n- generate `sw.ts` to the target folder instead of the project root folder\r\n- generate `sw.ts` only when PWA is enabled", "committedDate": "2020-11-10T19:44:57Z", "type": "commit"}, {"oid": "4a040fe7238178996e7072e8dc11f290191d930f", "url": "https://github.com/vaadin/flow/commit/4a040fe7238178996e7072e8dc11f290191d930f", "message": "Merge branch 'master' into merge-master", "committedDate": "2020-11-12T20:04:36Z", "type": "commit"}, {"oid": "3446cac2357f268fdbb8f7ac3f1ac4dc56ded6f5", "url": "https://github.com/vaadin/flow/commit/3446cac2357f268fdbb8f7ac3f1ac4dc56ded6f5", "message": "Merge branch 'master' into merge-master", "committedDate": "2020-11-13T07:52:54Z", "type": "commit"}, {"oid": "8c1885fa0d14af7fe33c17b2934537f499c1df69", "url": "https://github.com/vaadin/flow/commit/8c1885fa0d14af7fe33c17b2934537f499c1df69", "message": "Merge pull request #9393 from vaadin/merge-master\n\nMerge master to offline feature branch", "committedDate": "2020-11-13T11:36:21Z", "type": "commit"}, {"oid": "29fe11405c0c47051721df0010b00b4e7fbdc20b", "url": "https://github.com/vaadin/flow/commit/29fe11405c0c47051721df0010b00b4e7fbdc20b", "message": "feat: application connection state store (#9377)\n\nAdds a global ConnectionStateStore instance as window.Vaadin.connectionState\r\nand moves the existing LoadingIndicator to window.Vaadin.loadingIndicator.\r\nThis indicator is used by both Flow (GWT client) and Fusion (Flow.ts) for querying \r\nand transitioning between connection states (CONNECTED, LOADING, \r\nRECONNECTING and CONNECTION_LOST). The state store will be used for the\r\nimplementation of the up-and-coming loading indicator.\r\n\r\nFixes #9343.", "committedDate": "2020-11-17T13:35:27Z", "type": "commit"}, {"oid": "10a3fcd4d41ef4d47224e9ac88b6fa54d341455a", "url": "https://github.com/vaadin/flow/commit/10a3fcd4d41ef4d47224e9ac88b6fa54d341455a", "message": "Merge branch 'master' into joheriks/merge-master-to-offline\n\n# Conflicts:\n#\tflow-server/src/main/java/com/vaadin/flow/server/StaticFileServer.java\n#\tflow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendUtils.java\n#\tflow-server/src/test/java/com/vaadin/flow/server/frontend/FrontendUtilsTest.java", "committedDate": "2020-11-20T11:16:40Z", "type": "commit"}, {"oid": "4f38cc41a814492ef24242a509a144dc2a3fcf37", "url": "https://github.com/vaadin/flow/commit/4f38cc41a814492ef24242a509a144dc2a3fcf37", "message": "chore: mock VaadinServletService.getClassoader in OSGiVaadinServletTest", "committedDate": "2020-11-20T12:59:39Z", "type": "commit"}, {"oid": "bbac127625d7ff9be7e18a5911d9258d5d4ac268", "url": "https://github.com/vaadin/flow/commit/bbac127625d7ff9be7e18a5911d9258d5d4ac268", "message": "chore: updated resourceBases directory", "committedDate": "2020-11-20T13:00:05Z", "type": "commit"}, {"oid": "bfdf7f9eae8fb40c7cb1f56f2801240c6e9bedcd", "url": "https://github.com/vaadin/flow/commit/bfdf7f9eae8fb40c7cb1f56f2801240c6e9bedcd", "message": "Merge pull request #9454 from vaadin/joheriks/merge-master-to-offline\n\nMerge master to offline", "committedDate": "2020-11-20T19:55:10Z", "type": "commit"}, {"oid": "c35b6b63a0ade2f28a3c7d2ab30dc8121e500900", "url": "https://github.com/vaadin/flow/commit/c35b6b63a0ade2f28a3c7d2ab30dc8121e500900", "message": "feat: transition to RECONNECTING when receiving browser online event (#9452)\n\n* fix: transition from CONNECTION_LOST to CONNECTED via RECONNECTING.\r\n\r\nAlso pause heartbeats during CONNECTION_LOST.\r\nString constants instead of enum connection state.\r\n\r\n* Updated Javadocs\r\n\r\n* Simplified syntax", "committedDate": "2020-11-23T12:33:51Z", "type": "commit"}, {"oid": "3866f99acdcd4e22a9fdc661d3a28252c18f979e", "url": "https://github.com/vaadin/flow/commit/3866f99acdcd4e22a9fdc661d3a28252c18f979e", "message": "feat(offline): add connection indicator element (#9396)\n\n* feat(offline): add connection indicator element\r\n\r\n* use ConnectionStateStore in connection indicator element\r\n\r\n* combine separate loading boolean states into LoadingBarState enum\r\n\r\n* fix linter errors\r\n\r\n* render connection indicator style under head\r\n\r\n* fix document.head contents removed by accident\r\n\r\n* reflect reconnecting attribute\r\n\r\n* remove obsolete LoadingIndicator.ts\r\n\r\n* rename Vaadin.loadingIndicator to .connectionIndicator\r\n\r\n* fix ConnectionIndicator showing online text for reconnecting\r\n\r\n* fix: only expand connection indicator when after state changes\r\n\r\n* chore: better formatting, add missing semicolons\r\n\r\n* add tests and cleanup\r\n\r\n* assert message text in ConnectionIndicator tests\r\n\r\n* fix linter error", "committedDate": "2020-11-23T15:08:24Z", "type": "commit"}, {"oid": "b57d65c6ac37152241a41c8e48790be16c676560", "url": "https://github.com/vaadin/flow/commit/b57d65c6ac37152241a41c8e48790be16c676560", "message": "feat: TypeScript API for connection indicator configuration (#9427)\n\nUse ConnectionIndicator.ts: getConnectionIndicator to access the component\r\nand configure it using properties in index.ts. Also fixes broken connection state\r\ntransition when the app is entered via a client-side view.\r\n\r\nFixes #9402.", "committedDate": "2020-11-25T08:00:56Z", "type": "commit"}, {"oid": "7412a643a2338c62606333f1c596febc15544643", "url": "https://github.com/vaadin/flow/commit/7412a643a2338c62606333f1c596febc15544643", "message": "feat: remove reconnect dialog (#9481)", "committedDate": "2020-11-26T08:03:57Z", "type": "commit"}, {"oid": "1441961197894bfe653aa522589721fe536de849", "url": "https://github.com/vaadin/flow/commit/1441961197894bfe653aa522589721fe536de849", "message": "fix: reconnect dialog settings to vaadin-connection-indicator (#9502)\n\nThe Java API for configuring the messages shown in the reconnect dialog\r\n(ReconnectDialogConfiguration.setDialogText and \r\nReconnectDialogConfiguration.getDialogTextGaveUp) now carry over to \r\nthe corresponding properties of the new <vaadin-connection-indicator> \r\ncomponent (reconnectingText and offlineText, respectively). The flow-client \r\nclass ReconnectDialogConfiguration has been renamed to ReconnectConfiguration\r\nto better capture that it manages the reconnect logic (connection attempts and \r\ninterval), not the dialog visuals.\r\n\r\nTwo properties, which have no correspondence in the new connection indicator (ReconnectDialogConfiguration.setDialogGracePeriod and \r\nReconnectDialogConfiguration.setDialogModal are now no-ops and have been \r\ndeprecated).\r\n\r\nFixes #9401.", "committedDate": "2020-11-26T15:11:19Z", "type": "commit"}, {"oid": "06a9dfe88290f74202771cf379146ab966bfbcef", "url": "https://github.com/vaadin/flow/commit/06a9dfe88290f74202771cf379146ab966bfbcef", "message": "fix: do not go offline until Vaadin completed loading (#9519)", "committedDate": "2020-11-27T13:03:17Z", "type": "commit"}, {"oid": "443bbb2571f6efd4302c661d4848fc129e2482a4", "url": "https://github.com/vaadin/flow/commit/443bbb2571f6efd4302c661d4848fc129e2482a4", "message": "fix: add vaadin-connection-indicator in Connect ctor (#9510)", "committedDate": "2020-11-28T10:54:13Z", "type": "commit"}, {"oid": "8b0771e9a689ba101c55abd43c4ae4fb69319a47", "url": "https://github.com/vaadin/flow/commit/8b0771e9a689ba101c55abd43c4ae4fb69319a47", "message": "chore: remove defunct dialogGracePeriod and dialogModal (#9511)", "committedDate": "2020-11-28T10:59:17Z", "type": "commit"}, {"oid": "a76218afa689394b9210f92497a36c9049339cbf", "url": "https://github.com/vaadin/flow/commit/a76218afa689394b9210f92497a36c9049339cbf", "message": "feat(offline): retry server navigation when back online (#9513)\n\nFixes #9207", "committedDate": "2020-11-30T09:30:38Z", "type": "commit"}, {"oid": "44ac4423f8cead8e2ecd50d6564000a92739fc1d", "url": "https://github.com/vaadin/flow/commit/44ac4423f8cead8e2ecd50d6564000a92739fc1d", "message": "fix: add waitForDevServer to offline ITs (#9547)", "committedDate": "2020-12-01T10:45:29Z", "type": "commit"}, {"oid": "f663f148ae92b1df02cc5723cd2a1ae06a6c3fdb", "url": "https://github.com/vaadin/flow/commit/f663f148ae92b1df02cc5723cd2a1ae06a6c3fdb", "message": "Merge branch 'master' into feature/offline\n\n# Conflicts:\n#\tflow-maven-plugin/src/main/java/com/vaadin/flow/plugin/maven/FlowModeAbstractMojo.java\n#\tflow-server/src/main/java/com/vaadin/flow/server/StaticFileServer.java\n#\tflow-server/src/main/java/com/vaadin/flow/server/frontend/TaskUpdateWebpack.java\n#\tflow-server/src/test/java/com/vaadin/flow/server/OSGiVaadinServletTest.java\n#\tflow-tests/test-themes/pom.xml", "committedDate": "2020-12-01T11:14:19Z", "type": "commit"}, {"oid": "3cd150696b9deeac3e5f419ee0d228d9e19307dd", "url": "https://github.com/vaadin/flow/commit/3cd150696b9deeac3e5f419ee0d228d9e19307dd", "message": "fix: put VAADIN/static into VAADIN/webapp", "committedDate": "2020-12-01T13:50:06Z", "type": "commit"}, {"oid": "25b46ea66a446cfd2d82f5ba3dac4ba5367afc4a", "url": "https://github.com/vaadin/flow/commit/25b46ea66a446cfd2d82f5ba3dac4ba5367afc4a", "message": "chore: Merge pull request #9549 from vaadin/ap/merge/master-2020-12-01", "committedDate": "2020-12-02T15:16:23Z", "type": "commit"}, {"oid": "07d0e27ebc84d7938da284be548f42bb8d40302c", "url": "https://github.com/vaadin/flow/commit/07d0e27ebc84d7938da284be548f42bb8d40302c", "message": "feat: add entry for @Deferrable to Vaadin usage statistics (#9577)\n\nFixes #9540.", "committedDate": "2020-12-07T12:52:29Z", "type": "commit"}, {"oid": "8b2a138e15c4a8c41ab8eb64a10efdca87f5f45f", "url": "https://github.com/vaadin/flow/commit/8b2a138e15c4a8c41ab8eb64a10efdca87f5f45f", "message": "fix: reorder manifest and compression plugins (#9584)\n\nCompress service worker sw.js only after InjectManifest plugin \r\nhas completed. Also enable offline test modules (test-pwa and \r\ntest-ccdm-flow-navigation) in production mode.\r\n\r\nFixes #9457.", "committedDate": "2020-12-08T07:29:30Z", "type": "commit"}, {"oid": "0d1a6a22ead081416846dc83fd323d1da14d861f", "url": "https://github.com/vaadin/flow/commit/0d1a6a22ead081416846dc83fd323d1da14d861f", "message": "fix: Vaadin.Flow.clients.TypeScript.isActive will be true when endpoint requests active (#9600)\n\nThis allows TestBench tests to assume that all initial endpoint requests have\r\ncompleted before the test case is executed.", "committedDate": "2020-12-09T07:14:40Z", "type": "commit"}, {"oid": "1b4cfaf1fd463e10af2c5d120b5ff993b0ffb877", "url": "https://github.com/vaadin/flow/commit/1b4cfaf1fd463e10af2c5d120b5ff993b0ffb877", "message": "test: test was flaky in production mode (#9621)", "committedDate": "2020-12-09T14:02:23Z", "type": "commit"}, {"oid": "644bde4dcbc07a3f1c26de8f92a8d85141cb66ef", "url": "https://github.com/vaadin/flow/commit/644bde4dcbc07a3f1c26de8f92a8d85141cb66ef", "message": "fix: corrected position of SW plugin (#9619)", "committedDate": "2020-12-11T12:26:33Z", "type": "commit"}, {"oid": "9f7463b3b267816f756479a615610eeff543db68", "url": "https://github.com/vaadin/flow/commit/9f7463b3b267816f756479a615610eeff543db68", "message": "fix: do not depend on global connection state for isActive (#9636)\n\nThis reverts part of 0d1a6a22ead081416846dc83fd323d1da14d861f, which made\r\nFlow.isActive dependent on the global connection state. This caused flaky tests\r\nand was incorrect use of global state which may be modified by other clients.\r\nRather each client must independently compute isActive.\r\n\r\nAlso renamed ConnectionState.loadingSucceeded to the more descriptive\r\nloadingFinished.", "committedDate": "2020-12-14T07:22:43Z", "type": "commit"}, {"oid": "0467a2f9c8647513ece59b219c6e06c5becf3221", "url": "https://github.com/vaadin/flow/commit/0467a2f9c8647513ece59b219c6e06c5becf3221", "message": "fix(offline): do not cache CSRF token and clear on offline logout (#9629)\n\nWhen `index.html` is requested by service worker (identified by \r\n`Referer` header), omit CSRF token to prevent it from being cached.\r\nAlso clear `Vaadin.TypeScript.csrfToken` on logout.\r\n\r\nFixes #9537.", "committedDate": "2020-12-14T09:42:59Z", "type": "commit"}, {"oid": "98085685260fb8f14e146957eb7bcba5232003e1", "url": "https://github.com/vaadin/flow/commit/98085685260fb8f14e146957eb7bcba5232003e1", "message": "Remove deferrable feature (#9638)\n\nThe deferrable feature has a backup in the feature/offline-with-deferrable branch.\r\nThe docs for @deferrable stay in the [old doc repo](https://github.com/vaadin/flow-and-components-documentation), no need to migrate to the new doc site yet.", "committedDate": "2020-12-14T12:12:03Z", "type": "commit"}, {"oid": "14b4428fc8115cf41cfb3498fcf834b2700458b9", "url": "https://github.com/vaadin/flow/commit/14b4428fc8115cf41cfb3498fcf834b2700458b9", "message": "chore: improve IT stability (#9651)", "committedDate": "2020-12-15T15:06:18Z", "type": "commit"}, {"oid": "1b02c0acd22bbbdea77253b1ee0ad540c8cb12ca", "url": "https://github.com/vaadin/flow/commit/1b02c0acd22bbbdea77253b1ee0ad540c8cb12ca", "message": "fix: expose loadingStarted and loadingFinished (#9662)\n\nCo-authored-by: Haijian Wang <30408303+haijian-vaadin@users.noreply.github.com>", "committedDate": "2020-12-15T16:05:07Z", "type": "commit"}, {"oid": "b89af1bd28f83daa86f7c149659af611cec65aed", "url": "https://github.com/vaadin/flow/commit/b89af1bd28f83daa86f7c149659af611cec65aed", "message": "Merge branch 'master' into merge-master-to-offline", "committedDate": "2020-12-15T19:44:17Z", "type": "commit"}, {"oid": "31c0d8cdc1fa03346494b3b36d961e01f21ab7f2", "url": "https://github.com/vaadin/flow/commit/31c0d8cdc1fa03346494b3b36d961e01f21ab7f2", "message": "remove legacy test from Flow.ts", "committedDate": "2020-12-15T19:45:50Z", "type": "commit"}, {"oid": "29c8a30f5e57e742b074ed80b26efd84df6e0387", "url": "https://github.com/vaadin/flow/commit/29c8a30f5e57e742b074ed80b26efd84df6e0387", "message": "chore: avoid race condition in test", "committedDate": "2020-12-15T19:54:29Z", "type": "commit"}, {"oid": "53ef27adddd8bbd68d6f99d954f953ca0824a114", "url": "https://github.com/vaadin/flow/commit/53ef27adddd8bbd68d6f99d954f953ca0824a114", "message": "fix: set file-loader to use VAADIN/static/ prefix", "committedDate": "2020-12-15T21:40:04Z", "type": "commit"}, {"oid": "093c95cc54b32c08a62aa781f7d3154dea46dc37", "url": "https://github.com/vaadin/flow/commit/093c95cc54b32c08a62aa781f7d3154dea46dc37", "message": "Merge pull request #9664 from vaadin/merge-master-to-offline\n\nMerge master to offline", "committedDate": "2020-12-16T19:11:49Z", "type": "commit"}, {"oid": "e611bfa4696908b19532337ec07fe3f66221d6be", "url": "https://github.com/vaadin/flow/commit/e611bfa4696908b19532337ec07fe3f66221d6be", "message": "fix(offline): Rewrite <base href> in service worker using sw scope (#9652)\n\n* fix(offline): Rewrite <base href> in service worker using sw scope\r\n\r\nFixes #8878\r\n\r\n* test: use non-root contextPath in test-ccdm-flow-navigation IT\r\n\r\nCo-authored-by: Haijian Wang <30408303+haijian-vaadin@users.noreply.github.com>", "committedDate": "2020-12-17T02:33:06Z", "type": "commit"}, {"oid": "156676a1f438663491e902b3c03978e5f8b5ae11", "url": "https://github.com/vaadin/flow/commit/156676a1f438663491e902b3c03978e5f8b5ae11", "message": "fix: serve compressed files (#9643)\n\n* fix: look for compressed file in the right location\r\n\r\n* test: misc-IT for gz compression\r\n\r\nCo-authored-by: Haijian Wang <30408303+haijian-vaadin@users.noreply.github.com>", "committedDate": "2020-12-17T03:30:52Z", "type": "commit"}, {"oid": "a34b45d2db2957e0e757238eb4154134b8fe3e6d", "url": "https://github.com/vaadin/flow/commit/a34b45d2db2957e0e757238eb4154134b8fe3e6d", "message": "fix: simple state transitions when only Connect client is loaded (#9649)\n\nCo-authored-by: Anton Platonov <anton@vaadin.com>\r\nCo-authored-by: Haijian Wang <30408303+haijian-vaadin@users.noreply.github.com>", "committedDate": "2020-12-17T07:05:37Z", "type": "commit"}, {"oid": "dedb4dbb76dc9713c5c3d5b32cd68d4af245655f", "url": "https://github.com/vaadin/flow/commit/dedb4dbb76dc9713c5c3d5b32cd68d4af245655f", "message": "Merge branch 'feature/offline' into merge-offline-to-master", "committedDate": "2020-12-17T07:09:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk2MDQ0Nw==", "url": "https://github.com/vaadin/flow/pull/9677#discussion_r544960447", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-12-17T10:00:56Z", "path": "flow-client/src/main/java/com/vaadin/client/communication/ReconnectConfiguration.java", "diffHunk": "@@ -95,12 +85,14 @@ public String getDialogText() {\n      *\n      * @return the text to show in the reconnect dialog when no longer trying to\n      *         reconnect\n+     *\n+     * @deprecated The API for configuring the connection indicator has changed.\n      */\n+    @Deprecated\n     public String getDialogTextGaveUp() {", "originalCommit": "dedb4dbb76dc9713c5c3d5b32cd68d4af245655f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk2MDQ2MA==", "url": "https://github.com/vaadin/flow/pull/9677#discussion_r544960460", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-12-17T10:00:57Z", "path": "flow-client/src/main/java/com/vaadin/client/communication/ReconnectConfiguration.java", "diffHunk": "@@ -66,27 +66,17 @@ private MapProperty getProperty(String key) {\n         return configurationMap.getProperty(key);\n     }\n \n-    /**\n-     * Checks whether the reconnect dialog should be modal, i.e. prevent\n-     * application usage while being shown.\n-     *\n-     * @return true if the dialog is modal, false otherwise\n-     */\n-    public boolean isDialogModal() {\n-        return getProperty(ReconnectDialogConfigurationMap.DIALOG_MODAL_KEY)\n-                .getValueOrDefault(\n-                        ReconnectDialogConfigurationMap.DIALOG_MODAL_DEFAULT);\n-    }\n-\n     /**\n      * Gets the text to show in the reconnect dialog.\n      *\n      * @return the text to show in the reconnect dialog.\n+     *\n+     * @deprecated The API for configuring the connection indicator has changed.\n      */\n+    @Deprecated\n     public String getDialogText() {", "originalCommit": "dedb4dbb76dc9713c5c3d5b32cd68d4af245655f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk2MDQ3OQ==", "url": "https://github.com/vaadin/flow/pull/9677#discussion_r544960479", "bodyText": "Remove this use of \"getDialogTextGaveUp\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-12-17T10:00:59Z", "path": "flow-client/src/main/java/com/vaadin/client/communication/DefaultConnectionStateHandler.java", "diffHunk": "@@ -385,11 +312,18 @@ protected String getDialogText(int reconnectAttempt) {\n     @Override\n     public void configurationUpdated() {\n         // All other properties are fetched directly from the state when needed\n-        reconnectDialog.setModal(getConfiguration().isDialogModal());\n+        if (getConfiguration().getDialogText() != null) {\n+            ConnectionIndicator.setProperty(\"reconnectingText\",\n+                    getConfiguration().getDialogText());\n+        }\n+        if (getConfiguration().getDialogTextGaveUp() != null) {\n+        ConnectionIndicator.setProperty(\"offlineText\",\n+                getConfiguration().getDialogTextGaveUp());", "originalCommit": "dedb4dbb76dc9713c5c3d5b32cd68d4af245655f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk2MDQ4OQ==", "url": "https://github.com/vaadin/flow/pull/9677#discussion_r544960489", "bodyText": "Remove this use of \"getDialogText\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-12-17T10:01:00Z", "path": "flow-client/src/main/java/com/vaadin/client/communication/DefaultConnectionStateHandler.java", "diffHunk": "@@ -385,11 +312,18 @@ protected String getDialogText(int reconnectAttempt) {\n     @Override\n     public void configurationUpdated() {\n         // All other properties are fetched directly from the state when needed\n-        reconnectDialog.setModal(getConfiguration().isDialogModal());\n+        if (getConfiguration().getDialogText() != null) {", "originalCommit": "dedb4dbb76dc9713c5c3d5b32cd68d4af245655f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk2MDQ5OA==", "url": "https://github.com/vaadin/flow/pull/9677#discussion_r544960498", "bodyText": "Remove this use of \"getDialogText\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-12-17T10:01:00Z", "path": "flow-client/src/main/java/com/vaadin/client/communication/DefaultConnectionStateHandler.java", "diffHunk": "@@ -385,11 +312,18 @@ protected String getDialogText(int reconnectAttempt) {\n     @Override\n     public void configurationUpdated() {\n         // All other properties are fetched directly from the state when needed\n-        reconnectDialog.setModal(getConfiguration().isDialogModal());\n+        if (getConfiguration().getDialogText() != null) {\n+            ConnectionIndicator.setProperty(\"reconnectingText\",\n+                    getConfiguration().getDialogText());", "originalCommit": "dedb4dbb76dc9713c5c3d5b32cd68d4af245655f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk2MDUwNQ==", "url": "https://github.com/vaadin/flow/pull/9677#discussion_r544960505", "bodyText": "Remove this use of \"getDialogTextGaveUp\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-12-17T10:01:01Z", "path": "flow-client/src/main/java/com/vaadin/client/communication/DefaultConnectionStateHandler.java", "diffHunk": "@@ -385,11 +312,18 @@ protected String getDialogText(int reconnectAttempt) {\n     @Override\n     public void configurationUpdated() {\n         // All other properties are fetched directly from the state when needed\n-        reconnectDialog.setModal(getConfiguration().isDialogModal());\n+        if (getConfiguration().getDialogText() != null) {\n+            ConnectionIndicator.setProperty(\"reconnectingText\",\n+                    getConfiguration().getDialogText());\n+        }\n+        if (getConfiguration().getDialogTextGaveUp() != null) {", "originalCommit": "dedb4dbb76dc9713c5c3d5b32cd68d4af245655f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk2MDUyMA==", "url": "https://github.com/vaadin/flow/pull/9677#discussion_r544960520", "bodyText": "Complete the task associated to this TODO comment.", "author": "vaadin-bot", "createdAt": "2020-12-17T10:01:02Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/startup/DevModeInitializer.java", "diffHunk": "@@ -311,12 +313,14 @@ public static void initDevModeHandler(Set<Class<?>> classes,\n         File generatedPackages = new File(builder.generatedFolder,\n                 PACKAGE_JSON);\n \n-        // If we are missing the generated webpack configuration then generate\n-        // webpack configurations\n-        if (!new File(builder.npmFolder, WEBPACK_GENERATED).exists()) {\n-            builder.withWebpack(builder.npmFolder, FrontendUtils.WEBPACK_CONFIG,\n-                    FrontendUtils.WEBPACK_GENERATED);\n-        }\n+        // Regenerate webpack configuration, as it may be necessary to update it\n+        // TODO: make sure target directories are aligned with build config,", "originalCommit": "dedb4dbb76dc9713c5c3d5b32cd68d4af245655f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk2MDU5MQ==", "url": "https://github.com/vaadin/flow/pull/9677#discussion_r544960591", "bodyText": "Remove this use of \"SERVLET_PARAMETER_PRODUCTION_MODE\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-12-17T10:01:09Z", "path": "flow-maven-plugin/src/main/java/com/vaadin/flow/plugin/maven/PrepareFrontendMojo.java", "diffHunk": "@@ -161,7 +143,7 @@ public void execute() throws MojoExecutionException, MojoFailureException {\n     private void propagateBuildInfo() {\n         // For forked processes not accessing to System.properties we leave a\n         // token file with the information about the build\n-        File token = new File(webpackOutputDirectory, TOKEN_FILE);\n+        File token = new File(resourceOutputDirectory, TOKEN_FILE);\n         JsonObject buildInfo = Json.createObject();\n         buildInfo.put(SERVLET_PARAMETER_PRODUCTION_MODE, productionMode);", "originalCommit": "dedb4dbb76dc9713c5c3d5b32cd68d4af245655f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk2MDYwNw==", "url": "https://github.com/vaadin/flow/pull/9677#discussion_r544960607", "bodyText": "Remove this use of \"SERVLET_PARAMETER_USE_V14_BOOTSTRAP\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-12-17T10:01:10Z", "path": "flow-maven-plugin/src/main/java/com/vaadin/flow/plugin/maven/PrepareFrontendMojo.java", "diffHunk": "@@ -161,7 +143,7 @@ public void execute() throws MojoExecutionException, MojoFailureException {\n     private void propagateBuildInfo() {\n         // For forked processes not accessing to System.properties we leave a\n         // token file with the information about the build\n-        File token = new File(webpackOutputDirectory, TOKEN_FILE);\n+        File token = new File(resourceOutputDirectory, TOKEN_FILE);\n         JsonObject buildInfo = Json.createObject();\n         buildInfo.put(SERVLET_PARAMETER_PRODUCTION_MODE, productionMode);\n         buildInfo.put(SERVLET_PARAMETER_USE_V14_BOOTSTRAP,", "originalCommit": "dedb4dbb76dc9713c5c3d5b32cd68d4af245655f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6b06affa412d452120d970d3c9eb572d56c81240", "url": "https://github.com/vaadin/flow/commit/6b06affa412d452120d970d3c9eb572d56c81240", "message": "chore: improve stability of two tests (#9697)\n\n* chore: clear timers between tests\r\n\r\n* chore: accept a session expiration message in LogoutIT\r\n\r\n* fix: removed waits\r\n\r\n* fix: remove unnecessary async", "committedDate": "2020-12-21T08:38:51Z", "type": "commit"}, {"oid": "12011de06a15d51d8c2ede13224aab8bf58cf48e", "url": "https://github.com/vaadin/flow/commit/12011de06a15d51d8c2ede13224aab8bf58cf48e", "message": "refactor!: expose connectionIndicator as constant instead of via getter (#9706)\n\n* fix!: expose connectionIndicator as constant instead of via getter\r\n\r\n* fix: add connection indicator in function.\r\n\r\nInstead of relying on side effects in the accessor, factor our the\r\ncreation of the loading indicator components into another function.", "committedDate": "2020-12-21T13:34:18Z", "type": "commit"}, {"oid": "c3d0bc992eb4c6a2f049afede248a5c51330a928", "url": "https://github.com/vaadin/flow/commit/c3d0bc992eb4c6a2f049afede248a5c51330a928", "message": "Merge branch 'master' into merge-master-to-offline\n\n# Conflicts:\n#\tflow-server/src/main/java/com/vaadin/flow/server/DevModeHandler.java\n#\tflow-server/src/test/java/com/vaadin/flow/server/startup/DevModeInitializerTest.java", "committedDate": "2020-12-28T08:21:37Z", "type": "commit"}, {"oid": "509cebbd5bd6840ba0b4cba94609d4e8f12414ad", "url": "https://github.com/vaadin/flow/commit/509cebbd5bd6840ba0b4cba94609d4e8f12414ad", "message": "chore: remove double semicolon\n\nCo-authored-by: Mikhail Shabarov <61410877+mshabarov@users.noreply.github.com>", "committedDate": "2020-12-28T13:48:44Z", "type": "commit"}, {"oid": "0b903011fdced09eb9e060b8799c045af144e547", "url": "https://github.com/vaadin/flow/commit/0b903011fdced09eb9e060b8799c045af144e547", "message": "Merge pull request #9726 from vaadin/merge-master-to-offline\n\nchore: merge master to offline", "committedDate": "2020-12-28T20:35:49Z", "type": "commit"}, {"oid": "7115ef8164adf235b8846ccb7817973bb98c5e22", "url": "https://github.com/vaadin/flow/commit/7115ef8164adf235b8846ccb7817973bb98c5e22", "message": "fix: offline indicator visibility (#9733)\n\nConnection indicator again working when Flow not loaded.\r\nIncrease z-index of connection indicator.", "committedDate": "2020-12-31T07:25:35Z", "type": "commit"}, {"oid": "e773ec09cb63d4e33909cacdafdc46513913509a", "url": "https://github.com/vaadin/flow/commit/e773ec09cb63d4e33909cacdafdc46513913509a", "message": "Merge branch 'feature/offline' into merge-offline-to-master", "committedDate": "2020-12-31T08:29:56Z", "type": "commit"}, {"oid": "a660332327a17edea8e8c094a9e3d1df07ef674b", "url": "https://github.com/vaadin/flow/commit/a660332327a17edea8e8c094a9e3d1df07ef674b", "message": "Merge branch 'master' into merge-offline-to-master", "committedDate": "2020-12-31T10:03:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTM0MDIwMA==", "url": "https://github.com/vaadin/flow/pull/9677#discussion_r551340200", "bodyText": "I guess these comments should be removed. My fault as I think I introduced them. :P", "author": "Haprog", "createdAt": "2021-01-04T14:14:38Z", "path": "flow-server/src/main/resources/webpack.generated.js", "diffHunk": "@@ -107,6 +122,52 @@ if (useClientSideIndexFileForBootstrapping) {\n   webPackEntries.bundle = fileNameOfTheFlowGeneratedMainEntryPoint;\n }\n \n+const appShellUrl = '.';\n+\n+const swManifestTransform = (manifestEntries) => {\n+  const warnings = [];\n+  const manifest = manifestEntries;\n+\n+  // `index.html` is a special case: in contrast with the JS bundles produced by webpack\n+  // it's not served as-is directly from the webpack output at `/index.html`.\n+  // It goes through IndexHtmlRequestHandler and is served at `/`.\n+  //\n+  // TODO: calculate the revision based on the IndexHtmlRequestHandler-processed content\n+  // of the index.html file\n+  const indexEntryIdx = manifest.findIndex(entry => entry.url === 'index.html');\n+  if (indexEntryIdx !== -1) {\n+    manifest[indexEntryIdx].url = appShellUrl;\n+  }\n+\n+  return { manifest, warnings };\n+};\n+\n+const serviceWorkerPlugin = new InjectManifest({\n+  swSrc: clientServiceWorkerEntryPoint,\n+  swDest: serviceWorkerPath,\n+  manifestTransforms: [swManifestTransform],\n+  maximumFileSizeToCacheInBytes: 100 * 1024 * 1024,\n+  dontCacheBustURLsMatching: /.*-[a-z0-9]{20}\\.cache\\.js/,\n+  include: [\n+    (chunk) => {\n+      return true;\n+    },\n+  ],\n+  webpackCompilationPlugins: [\n+    new DefinePlugin({\n+      OFFLINE_PATH_ENABLED: offlinePathEnabled,\n+      OFFLINE_PATH: JSON.stringify(offlinePath)\n+    }),\n+  ],\n+  //navigateFallback: rootUrl,\n+  /*runtimeCaching: [\n+    {\n+      urlPattern: /.* /,\n+      handler: \"NetworkFirst\",\n+    },\n+  ],*/", "originalCommit": "a660332327a17edea8e8c094a9e3d1df07ef674b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTUzMDM5OA==", "url": "https://github.com/vaadin/flow/pull/9677#discussion_r551530398", "bodyText": "Done.", "author": "joheriks", "createdAt": "2021-01-04T19:47:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTM0MDIwMA=="}], "type": "inlineReview"}, {"oid": "a3c040af3f43824092b353401e31f38b485aa8be", "url": "https://github.com/vaadin/flow/commit/a3c040af3f43824092b353401e31f38b485aa8be", "message": "chore: code cleanup", "committedDate": "2021-01-04T20:05:21Z", "type": "forcePushed"}, {"oid": "521acceec7c052577f1eddbd8d257c2b38ee6372", "url": "https://github.com/vaadin/flow/commit/521acceec7c052577f1eddbd8d257c2b38ee6372", "message": "chore: code cleanup", "committedDate": "2021-01-04T21:37:35Z", "type": "forcePushed"}, {"oid": "49487bf557669b9bdef75676688ebaeedc3aa776", "url": "https://github.com/vaadin/flow/commit/49487bf557669b9bdef75676688ebaeedc3aa776", "message": "chore: code cleanup", "committedDate": "2021-01-05T07:45:29Z", "type": "commit"}, {"oid": "49487bf557669b9bdef75676688ebaeedc3aa776", "url": "https://github.com/vaadin/flow/commit/49487bf557669b9bdef75676688ebaeedc3aa776", "message": "chore: code cleanup", "committedDate": "2021-01-05T07:45:29Z", "type": "forcePushed"}]}