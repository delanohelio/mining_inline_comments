{"pr_number": 9617, "pr_title": "Feat: Check that npm resources are available", "pr_createdAt": "2020-12-09T09:57:05Z", "pr_url": "https://github.com/vaadin/flow/pull/9617", "timeline": [{"oid": "2583f9d5281ae2b856de386901747f2f9421d218", "url": "https://github.com/vaadin/flow/commit/2583f9d5281ae2b856de386901747f2f9421d218", "message": "Feat: Check that npm resources are available\n\nCheck that we have named npm resources\navailable or throw an exception informing\nthe user to intall it using a NpmPackage\nannotation or manually with (p)npm i\n\nFixes #9615", "committedDate": "2020-12-10T08:12:45Z", "type": "commit"}, {"oid": "d43242e419cbae9b032563a20d583770f7b4db6f", "url": "https://github.com/vaadin/flow/commit/d43242e419cbae9b032563a20d583770f7b4db6f", "message": "Add npmPackage for assets.", "committedDate": "2020-12-10T08:12:47Z", "type": "commit"}, {"oid": "d43242e419cbae9b032563a20d583770f7b4db6f", "url": "https://github.com/vaadin/flow/commit/d43242e419cbae9b032563a20d583770f7b4db6f", "message": "Add npmPackage for assets.", "committedDate": "2020-12-10T08:12:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4MTU2OQ==", "url": "https://github.com/vaadin/flow/pull/9617#discussion_r539981569", "bodyText": "Would it be better if we would check for all the missing packages in a loop and output all of them at once ?\nSo if one is missing 5 of those (for example due to not reading our docs on how to package a reusable theme), they could know all of the missing things after one run instead of 5 ?", "author": "pleku", "createdAt": "2020-12-10T08:48:22Z", "path": "flow-server/src/main/resources/plugins/application-theme-plugin/theme-copy.js", "diffHunk": "@@ -66,7 +66,10 @@ function copyStaticAssets(themeName, themeProperties, projectStaticAssetsOutputF\n     const copyRules = assets[module];\n     Object.keys(copyRules).forEach((copyRule) => {\n       const nodeSources = path.resolve('node_modules/', module, copyRule);\n-      const files = glob.sync(nodeSources, {nodir: true});\n+      if(!fs.existsSync(path.resolve('node_modules/', module))) {\n+        throw Error(\"Missing '\" + module + \"'. Install package by adding a @NpmPackage annotation or install it using 'npm/pnpm i'\");", "originalCommit": "d43242e419cbae9b032563a20d583770f7b4db6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDAwNTI2OA==", "url": "https://github.com/vaadin/flow/pull/9617#discussion_r540005268", "bodyText": "done.", "author": "caalador", "createdAt": "2020-12-10T09:22:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4MTU2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4MzAzNw==", "url": "https://github.com/vaadin/flow/pull/9617#discussion_r539983037", "bodyText": "Should this clarify that the module is needed as an CSS asset in theme.json so they don't have to wonder where does this module come from ?", "author": "pleku", "createdAt": "2020-12-10T08:50:35Z", "path": "flow-server/src/main/resources/plugins/application-theme-plugin/theme-copy.js", "diffHunk": "@@ -66,7 +66,10 @@ function copyStaticAssets(themeName, themeProperties, projectStaticAssetsOutputF\n     const copyRules = assets[module];\n     Object.keys(copyRules).forEach((copyRule) => {\n       const nodeSources = path.resolve('node_modules/', module, copyRule);\n-      const files = glob.sync(nodeSources, {nodir: true});\n+      if(!fs.existsSync(path.resolve('node_modules/', module))) {\n+        throw Error(\"Missing '\" + module + \"'. Install package by adding a @NpmPackage annotation or install it using 'npm/pnpm i'\");", "originalCommit": "d43242e419cbae9b032563a20d583770f7b4db6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDAwNjE2OA==", "url": "https://github.com/vaadin/flow/pull/9617#discussion_r540006168", "bodyText": "No the assets are of style:\n  \"assets\": {\n    \"@fortawesome/fontawesome-free\": {\n      \"svgs/regular/**\": \"fortawesome/icons\"\n    }\n  }\n\nso it's just the module that is missing. These are added when you want to use it from java.\nBut added clarification.", "author": "caalador", "createdAt": "2020-12-10T09:24:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4MzAzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4MzI0MQ==", "url": "https://github.com/vaadin/flow/pull/9617#discussion_r539983241", "bodyText": "Same comment here, should we first collect all of the missing packages and output them once ?", "author": "pleku", "createdAt": "2020-12-10T08:50:52Z", "path": "flow-server/src/main/resources/plugins/application-theme-plugin/theme-generator.js", "diffHunk": "@@ -83,6 +84,11 @@ function generateThemeFile(themeFolder, themeName, themeProperties) {\n   let i = 0;\n   if (themeProperties.importCss) {\n     themeProperties.importCss.forEach((cssPath) => {\n+      const nodeSources = path.resolve('node_modules/', cssPath);\n+      if(!fs.existsSync(nodeSources)) {\n+        throw Error(\"Missing resource '\" + cssPath + \"'. Install package by adding a @NpmPackage annotation or install it using 'npm/pnpm i'\");", "originalCommit": "d43242e419cbae9b032563a20d583770f7b4db6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDAxMzk0NA==", "url": "https://github.com/vaadin/flow/pull/9617#discussion_r540013944", "bodyText": "done", "author": "caalador", "createdAt": "2020-12-10T09:34:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4MzI0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4NTA1NA==", "url": "https://github.com/vaadin/flow/pull/9617#discussion_r539985054", "bodyText": "Same, should this mention what this resource is and where is it coming from, like \"Missing imported css file  imported by theme.json. Install ...\"", "author": "pleku", "createdAt": "2020-12-10T08:53:39Z", "path": "flow-server/src/main/resources/plugins/application-theme-plugin/theme-generator.js", "diffHunk": "@@ -83,6 +84,11 @@ function generateThemeFile(themeFolder, themeName, themeProperties) {\n   let i = 0;\n   if (themeProperties.importCss) {\n     themeProperties.importCss.forEach((cssPath) => {\n+      const nodeSources = path.resolve('node_modules/', cssPath);\n+      if(!fs.existsSync(nodeSources)) {\n+        throw Error(\"Missing resource '\" + cssPath + \"'. Install package by adding a @NpmPackage annotation or install it using 'npm/pnpm i'\");", "originalCommit": "d43242e419cbae9b032563a20d583770f7b4db6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDAxMzk5MQ==", "url": "https://github.com/vaadin/flow/pull/9617#discussion_r540013991", "bodyText": "added", "author": "caalador", "createdAt": "2020-12-10T09:34:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4NTA1NA=="}], "type": "inlineReview"}, {"oid": "d8261c6d93e69d4d05873dffb2dcefe47d6c6fdf", "url": "https://github.com/vaadin/flow/commit/d8261c6d93e69d4d05873dffb2dcefe47d6c6fdf", "message": "Collect all missing, update exception.", "committedDate": "2020-12-10T09:35:19Z", "type": "commit"}]}