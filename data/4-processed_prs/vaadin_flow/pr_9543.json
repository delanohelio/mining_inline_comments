{"pr_number": 9543, "pr_title": "feat: Enable importing CSS from node_modules", "pr_createdAt": "2020-11-30T17:18:49Z", "pr_url": "https://github.com/vaadin/flow/pull/9543", "timeline": [{"oid": "9b25ea8b2b253319f85406ef98f277dbcbf725ba", "url": "https://github.com/vaadin/flow/commit/9b25ea8b2b253319f85406ef98f277dbcbf725ba", "message": "feat: Enable importing CSS from node_modules (#9410)", "committedDate": "2020-11-30T17:16:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzA5NTc0Mg==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r533095742", "bodyText": "No added param documentation for themeProperties.", "author": "caalador", "createdAt": "2020-12-01T06:15:30Z", "path": "flow-server/src/main/resources/plugins/application-theme-plugin/theme-generator.js", "diffHunk": "@@ -46,7 +46,7 @@ export const injectGlobalCss = (css, target) => {\n  * @param {string} themeName name of the handled theme", "originalCommit": "9b25ea8b2b253319f85406ef98f277dbcbf725ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzEyMjQwMw==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r533122403", "bodyText": "Added.", "author": "tanbt", "createdAt": "2020-12-01T07:29:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzA5NTc0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzA5NjYzNw==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r533096637", "bodyText": "Lots of unrelated formatting changes in the test file.\nCould you check the TeamWiki Code style section. indentation at least seems different", "author": "caalador", "createdAt": "2020-12-01T06:18:24Z", "path": "flow-tests/test-themes/src/test/java/com/vaadin/flow/uitest/ui/theme/ThemeIT.java", "diffHunk": "@@ -38,11 +39,11 @@\n     public void secondTheme_staticFilesNotCopied() {\n         getDriver().get(getRootURL() + \"/path/VAADIN/static/img/bg.jpg\");\n         Assert.assertFalse(\"app-theme static files should be copied\",\n-            driver.getPageSource().contains(\"HTTP ERROR 404 Not Found\"));", "originalCommit": "9b25ea8b2b253319f85406ef98f277dbcbf725ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzEzMjExMg==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r533132112", "bodyText": "Reverted. My formatter setting was disappear somehow.", "author": "tanbt", "createdAt": "2020-12-01T07:50:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzA5NjYzNw=="}], "type": "inlineReview"}, {"oid": "c2b0d5c62bf4c83d0c6381e7e275663fec1dac07", "url": "https://github.com/vaadin/flow/commit/c2b0d5c62bf4c83d0c6381e7e275663fec1dac07", "message": "Update based on comments", "committedDate": "2020-12-01T07:34:49Z", "type": "commit"}, {"oid": "2bb8d35a1ce095c730a312711f9bdd9279d3673b", "url": "https://github.com/vaadin/flow/commit/2bb8d35a1ce095c730a312711f9bdd9279d3673b", "message": "Reformat", "committedDate": "2020-12-01T07:41:35Z", "type": "commit"}, {"oid": "d8474de155c1c6632a03db28ddaa43b0eca8743f", "url": "https://github.com/vaadin/flow/commit/d8474de155c1c6632a03db28ddaa43b0eca8743f", "message": "Reformat", "committedDate": "2020-12-01T07:49:04Z", "type": "commit"}, {"oid": "490533abc27b0867e66e930da09ba9bcbda09bc9", "url": "https://github.com/vaadin/flow/commit/490533abc27b0867e66e930da09ba9bcbda09bc9", "message": "Allow webpack css loader to import from node_modules", "committedDate": "2020-12-01T08:23:17Z", "type": "commit"}, {"oid": "b286d64eb31b4f9a0649c829cd3a82b54992d2fb", "url": "https://github.com/vaadin/flow/commit/b286d64eb31b4f9a0649c829cd3a82b54992d2fb", "message": "Fix the commit above - wrong config place", "committedDate": "2020-12-01T08:28:30Z", "type": "commit"}, {"oid": "f57db68ca8256b95f4058faa6cff957c38edade6", "url": "https://github.com/vaadin/flow/commit/f57db68ca8256b95f4058faa6cff957c38edade6", "message": "File-loader only copies files used as imports in .js files", "committedDate": "2020-12-01T09:23:55Z", "type": "commit"}, {"oid": "2c4f25c0f9a0d8ad57bb058d683adbfaad1803ed", "url": "https://github.com/vaadin/flow/commit/2c4f25c0f9a0d8ad57bb058d683adbfaad1803ed", "message": "Add file-loader to NodeUpdater", "committedDate": "2020-12-01T10:08:28Z", "type": "commit"}, {"oid": "736739b299c704f28c7bc2beee37f3e1b86f2fdd", "url": "https://github.com/vaadin/flow/commit/736739b299c704f28c7bc2beee37f3e1b86f2fdd", "message": "Fix test for import CSS", "committedDate": "2020-12-01T15:14:11Z", "type": "commit"}, {"oid": "953a82b99e087a080cb900743b7c2a9675c1756d", "url": "https://github.com/vaadin/flow/commit/953a82b99e087a080cb900743b7c2a9675c1756d", "message": "Merge branch 'master' into issues/9410-import-css", "committedDate": "2020-12-01T15:34:47Z", "type": "commit"}, {"oid": "27777eb143aca8715060170b6e29ec4a159ae08b", "url": "https://github.com/vaadin/flow/commit/27777eb143aca8715060170b6e29ec4a159ae08b", "message": "Allow importing css not only from node_modules", "committedDate": "2020-12-01T17:55:26Z", "type": "commit"}, {"oid": "b856802ce3473029a052060cd10eae0c42e176c1", "url": "https://github.com/vaadin/flow/commit/b856802ce3473029a052060cd10eae0c42e176c1", "message": "Also allow import css from frontend/theme", "committedDate": "2020-12-01T18:35:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkyNjcwNA==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r533926704", "bodyText": "This has the problem that \"external\" url's are not filtered out making it fail as the files can not be found.", "author": "caalador", "createdAt": "2020-12-02T06:32:03Z", "path": "flow-server/src/main/resources/webpack.generated.js", "diffHunk": "@@ -173,7 +173,8 @@ module.exports = {\n             options: {\n               url: (url, resourcePath) => {\n                 // Only translate files from node_modules\n-                return resourcePath.includes('/node_modules/');\n+                return resourcePath.includes('/node_modules/')\n+                    || resourcePath.includes('/frontend/theme/');", "originalCommit": "b856802ce3473029a052060cd10eae0c42e176c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk1MjA1Ng==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r533952056", "bodyText": "Added a check to skip external URL.", "author": "tanbt", "createdAt": "2020-12-02T07:36:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkyNjcwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk5Mjc3Mw==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r533992773", "bodyText": "Only http:// doesn't mean external also ./served/by/server or /absolute is external from the view of the theme see test module octopuss and monarch-butterfly", "author": "caalador", "createdAt": "2020-12-02T08:52:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkyNjcwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDgwNzU5Ng==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r534807596", "bodyText": "Will update with #9558.", "author": "tanbt", "createdAt": "2020-12-03T07:28:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkyNjcwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDgxODA3OQ==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r534818079", "bodyText": "Let's take in 9558 and you can rebase the fix on that.", "author": "caalador", "createdAt": "2020-12-03T07:35:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkyNjcwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkyNzA2Mw==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r533927063", "bodyText": "This was my mistake, but the output path should be outputPath: 'static/', also I can't get this to actually copy anything.", "author": "caalador", "createdAt": "2020-12-02T06:33:06Z", "path": "flow-server/src/main/resources/webpack.generated.js", "diffHunk": "@@ -189,6 +190,17 @@ module.exports = {\n           }\n         ],\n       },\n+      {\n+        // File-loader only copies files used as imports in .js files\n+        test: /\\.(png|gif|jpg|svg|eot|woff|woff2|ttf)$/,\n+        use: [{\n+          loader: 'file-loader',\n+          options: {\n+            outputPath: '../resources/VAADIN/static/',", "originalCommit": "b856802ce3473029a052060cd10eae0c42e176c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk2MjAyNw==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r533962027", "bodyText": "Fixed.\nI can still see files are copied to target\\classes\\META-INF\\VAADIN\\static when using outputPath: '../resources/VAADIN/static/'.", "author": "tanbt", "createdAt": "2020-12-02T07:57:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkyNzA2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk4NjA2Mw==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r533986063", "bodyText": "that's because it's not file-loader that is doing the copying.", "author": "caalador", "createdAt": "2020-12-02T08:41:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkyNzA2Mw=="}], "type": "inlineReview"}, {"oid": "ed0f83de1ce77adb02b282b47c0b346d0a66ab50", "url": "https://github.com/vaadin/flow/commit/ed0f83de1ce77adb02b282b47c0b346d0a66ab50", "message": "Skip translating external URLs", "committedDate": "2020-12-02T07:56:14Z", "type": "commit"}, {"oid": "83edc8f9bfc42d08d0bc3466269df3bf79f08d90", "url": "https://github.com/vaadin/flow/commit/83edc8f9bfc42d08d0bc3466269df3bf79f08d90", "message": "Merge branch 'master' into issues/9410-import-css", "committedDate": "2020-12-02T07:59:09Z", "type": "commit"}, {"oid": "cca1dc2f3d50dccef1091f11232b4c0ccd6163ba", "url": "https://github.com/vaadin/flow/commit/cca1dc2f3d50dccef1091f11232b4c0ccd6163ba", "message": "correct the path for background-image", "committedDate": "2020-12-04T10:48:42Z", "type": "commit"}, {"oid": "be290d7635a2d32b3c47601adea19b18ee53dcd0", "url": "https://github.com/vaadin/flow/commit/be290d7635a2d32b3c47601adea19b18ee53dcd0", "message": "merged with master", "committedDate": "2020-12-04T11:19:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzIzMDczMA==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r537230730", "bodyText": "As this should stay unchanged the path should get path from the application as it should be requested with the application context. There is a test that ./ should match RootUrl+/path when executed in browser context.", "author": "caalador", "createdAt": "2020-12-07T04:55:11Z", "path": "flow-tests/test-themes/frontend/theme/app-theme/global.css", "diffHunk": "@@ -12,7 +12,7 @@ body {\n \n #butterfly {\n     /* This shouldn't be translated */\n-    background-image: url(\"./test/path/monarch-butterfly.jpg\");\n+    background-image: url(\"/path/test/path/monarch-butterfly.jpg\");", "originalCommit": "be290d7635a2d32b3c47601adea19b18ee53dcd0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzcyMTA0OA==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r537721048", "bodyText": "I'm not sure about this, since the monarch-butterfly.jpg is a non-theme resource under src/webapp and that leading /path is actually a folder under webapp. As I know the URL of non-theme resources should not be translated, but please let me know if I'm missing something.", "author": "taefi", "createdAt": "2020-12-07T18:13:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzIzMDczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODAzNDI4Ng==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r538034286", "bodyText": "But the point is that the url is relative to the application and /path/ is from the application servlet path.", "author": "caalador", "createdAt": "2020-12-08T04:54:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzIzMDczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODIyNzMzMQ==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r538227331", "bodyText": "Also this feature shouldn't touch the external url tests as this shouldn't change them in any way.", "author": "caalador", "createdAt": "2020-12-08T10:38:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzIzMDczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODMyNzIxOA==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r538327218", "bodyText": "/path/ is from the application servlet path\n\nThe project structure is like this:\nproject-root\n|_ src\n    |_ webapp\n        |_ path\n            |_ test\n                |_ path\n                    |_ monarch-butterfly.jpg\n\nSo I think I got confused because @WebServlet(\"/path/*\") was the URL-pattern and not the context-path. So I removed the /path and changed it back to ./ as it was before.", "author": "taefi", "createdAt": "2020-12-08T12:46:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzIzMDczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODMyOTM5Mw==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r538329393", "bodyText": "I agree it's a bit confusing and should perhaps have a better comment on top.", "author": "caalador", "createdAt": "2020-12-08T12:49:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzIzMDczMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI2MjU0OQ==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r537262549", "bodyText": "Remove the extra file-loader as it was added from the merge in master. see 3 lines down", "author": "caalador", "createdAt": "2020-12-07T06:34:42Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/NodeUpdater.java", "diffHunk": "@@ -303,6 +303,7 @@ static void addVaadinDefaultsToJson(JsonObject json) {\n         defaults.put(\"compression-webpack-plugin\", \"4.0.1\");\n         defaults.put(\"webpack-merge\", \"4.2.2\");\n         defaults.put(\"css-loader\", \"4.2.1\");\n+        defaults.put(\"file-loader\", \"6.1.0\");", "originalCommit": "be290d7635a2d32b3c47601adea19b18ee53dcd0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzcxODg0Ng==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r537718846", "bodyText": "Done.", "author": "taefi", "createdAt": "2020-12-07T18:09:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI2MjU0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI2NDM0OQ==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r537264349", "bodyText": "Should this check for something more. Are we certain the resource is available just because the css has been applied and no exceptions are on the console?\nShould we also check the resource e.g.\n        getDriver().get(getRootURL() + \"/path/VAADIN/static/[THE_RESOURCE_THAT_IS_EXPECTED]\");\n        Assert.assertFalse(\"Font resource should be available\",\n            driver.getPageSource().contains(\"HTTP ERROR 404 Not Found\"));", "author": "caalador", "createdAt": "2020-12-07T06:39:41Z", "path": "flow-tests/test-themes/src/test/java/com/vaadin/flow/uitest/ui/theme/ThemeIT.java", "diffHunk": "@@ -79,6 +80,16 @@ public void applicationTheme_GlobalCss_isUsed() {\n             driver.getPageSource().contains(\"Could not navigate\"));\n     }\n \n+    @Test\n+    public void applicationTheme_importCSS_isUsed() {\n+        open();\n+        checkLogsForErrors();\n+\n+        Assert.assertEquals(\"Imported FontAwesome css file should be applied.\",\n+                \"\\\"Font Awesome 5 Brands\\\"\", $(SpanElement.class).id(FONTAWESOME_ID)\n+                        .getCssValue(\"font-family\"));", "originalCommit": "be290d7635a2d32b3c47601adea19b18ee53dcd0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ3MjAxOQ==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r538472019", "bodyText": "Done.", "author": "taefi", "createdAt": "2020-12-08T15:04:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI2NDM0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI2NDcwMQ==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r537264701", "bodyText": "Does this give something visible or should we add a icon class name also?", "author": "caalador", "createdAt": "2020-12-07T06:40:42Z", "path": "flow-tests/test-themes/src/main/java/com/vaadin/flow/uitest/ui/theme/ThemeView.java", "diffHunk": "@@ -45,12 +46,16 @@ public ThemeView() {\n         Span octopuss = new Span();\n         octopuss.setId(OCTOPUSS_ID);\n \n+        Span faText = new Span(\"This test is FontAwesome.\");\n+        faText.setClassName(\"fab\");", "originalCommit": "be290d7635a2d32b3c47601adea19b18ee53dcd0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ3MTk3MA==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r538471970", "bodyText": "Added an Icon. Done.", "author": "taefi", "createdAt": "2020-12-08T15:04:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI2NDcwMQ=="}], "type": "inlineReview"}, {"oid": "786ec8c2f8d40fb094227998551f6334a32bbcef", "url": "https://github.com/vaadin/flow/commit/786ec8c2f8d40fb094227998551f6334a32bbcef", "message": "omit duplicate definition of file-loader dependency", "committedDate": "2020-12-07T18:09:16Z", "type": "commit"}, {"oid": "3a06b5480711616ed24538d7d1850a9a06e8d8a6", "url": "https://github.com/vaadin/flow/commit/3a06b5480711616ed24538d7d1850a9a06e8d8a6", "message": "removed the leading path in butterfly selector", "committedDate": "2020-12-08T12:46:26Z", "type": "commit"}, {"oid": "4c8a22c8da0b861e1145510321f35ad66dda21eb", "url": "https://github.com/vaadin/flow/commit/4c8a22c8da0b861e1145510321f35ad66dda21eb", "message": "apply review comments", "committedDate": "2020-12-08T15:02:51Z", "type": "commit"}, {"oid": "59df29f32ceafcdb99e4ccef230f40a1fcf0a297", "url": "https://github.com/vaadin/flow/commit/59df29f32ceafcdb99e4ccef230f40a1fcf0a297", "message": "increase app theme plugin version", "committedDate": "2020-12-08T22:42:14Z", "type": "commit"}, {"oid": "21350169bae0a31a0289c54b52d26c9d45a7c762", "url": "https://github.com/vaadin/flow/commit/21350169bae0a31a0289c54b52d26c9d45a7c762", "message": "Merge branch 'master' into issues/9410-import-css", "committedDate": "2020-12-09T06:42:13Z", "type": "commit"}]}