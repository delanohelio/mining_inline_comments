{"pr_number": 7456, "pr_title": "Pin versions based on versions file provided by the Platform", "pr_createdAt": "2020-01-31T09:41:26Z", "pr_url": "https://github.com/vaadin/flow/pull/7456", "timeline": [{"oid": "79de59d9966eaabdb0d0dda1db1f3fa53add0076", "url": "https://github.com/vaadin/flow/commit/79de59d9966eaabdb0d0dda1db1f3fa53add0076", "message": "Pin versions based on versions file provided by the Platform\n\nFixes #7451", "committedDate": "2020-01-31T09:40:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM5NTIzMw==", "url": "https://github.com/vaadin/flow/pull/7456#discussion_r373395233", "bodyText": "nit: probably better to remove before merging, there might be a lot of logging output.", "author": "web-padawan", "createdAt": "2020-01-31T09:50:49Z", "path": "flow-server/src/main/resources/pnpmfile.js", "diffHunk": "@@ -0,0 +1,42 @@\n+const fs = require('fs');\n+\n+const packageJson = JSON.parse(fs.readFileSync('./package.json', 'utf-8'));\n+\n+const versionsFile = '[to-be-generated-by-flow]';\n+\n+if (!fs.existsSync(versionsFile)) {\n+    return;\n+}\n+const versions = JSON.parse(fs.readFileSync(versionsFile, 'utf-8'));\n+\n+let vaadinDeps;\n+\n+module.exports = {\n+  hooks: {\n+    readPackage\n+  }\n+};\n+\n+function getExactVersion(string) {\n+  return string.replace('^', '');\n+}\n+\n+\n+function readPackage(pkg) {\n+  const deps = versions;\n+\n+  const { dependencies } = pkg;\n+\n+  if (dependencies) {\n+    for (let k in deps) {\n+      if (dependencies[k] && dependencies[k] !== deps[k]) {\n+        console.log(", "originalCommit": "79de59d9966eaabdb0d0dda1db1f3fa53add0076", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM5NTM5MA==", "url": "https://github.com/vaadin/flow/pull/7456#discussion_r373395390", "bodyText": "nit: unused variable from the original script, please remove.", "author": "web-padawan", "createdAt": "2020-01-31T09:51:13Z", "path": "flow-server/src/main/resources/pnpmfile.js", "diffHunk": "@@ -0,0 +1,42 @@\n+const fs = require('fs');\n+\n+const packageJson = JSON.parse(fs.readFileSync('./package.json', 'utf-8'));\n+\n+const versionsFile = '[to-be-generated-by-flow]';\n+\n+if (!fs.existsSync(versionsFile)) {\n+    return;\n+}\n+const versions = JSON.parse(fs.readFileSync(versionsFile, 'utf-8'));\n+\n+let vaadinDeps;", "originalCommit": "79de59d9966eaabdb0d0dda1db1f3fa53add0076", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM5ODY5NA==", "url": "https://github.com/vaadin/flow/pull/7456#discussion_r373398694", "bodyText": "nit: this extra assignment is not necessary.\nyou can remove it and use for (let k in versions) { etc below.", "author": "web-padawan", "createdAt": "2020-01-31T09:58:44Z", "path": "flow-server/src/main/resources/pnpmfile.js", "diffHunk": "@@ -0,0 +1,42 @@\n+const fs = require('fs');\n+\n+const packageJson = JSON.parse(fs.readFileSync('./package.json', 'utf-8'));\n+\n+const versionsFile = '[to-be-generated-by-flow]';\n+\n+if (!fs.existsSync(versionsFile)) {\n+    return;\n+}\n+const versions = JSON.parse(fs.readFileSync(versionsFile, 'utf-8'));\n+\n+let vaadinDeps;\n+\n+module.exports = {\n+  hooks: {\n+    readPackage\n+  }\n+};\n+\n+function getExactVersion(string) {\n+  return string.replace('^', '');\n+}\n+\n+\n+function readPackage(pkg) {\n+  const deps = versions;", "originalCommit": "79de59d9966eaabdb0d0dda1db1f3fa53add0076", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c2a3e0d53a4208c8ec06c6f2b0401cb48d400e01", "url": "https://github.com/vaadin/flow/commit/c2a3e0d53a4208c8ec06c6f2b0401cb48d400e01", "message": "Exclude class for temporary work from serializable.", "committedDate": "2020-01-31T10:00:34Z", "type": "commit"}, {"oid": "d39b84a0ea2f20fe3a6fb26ce978976fabab6ce1", "url": "https://github.com/vaadin/flow/commit/d39b84a0ea2f20fe3a6fb26ce978976fabab6ce1", "message": "Clean up js file", "committedDate": "2020-01-31T10:05:32Z", "type": "commit"}, {"oid": "42922e5504b022019af95d3a1e0a68a131daae86", "url": "https://github.com/vaadin/flow/commit/42922e5504b022019af95d3a1e0a68a131daae86", "message": "Add a new line in the end", "committedDate": "2020-01-31T10:06:49Z", "type": "commit"}, {"oid": "58839b2a404e666611f138f2765b2530b7e5d99a", "url": "https://github.com/vaadin/flow/commit/58839b2a404e666611f138f2765b2530b7e5d99a", "message": "Fixes based on review", "committedDate": "2020-01-31T11:46:05Z", "type": "commit"}, {"oid": "daec074f173622ac67942cb553af8c8e97708c70", "url": "https://github.com/vaadin/flow/commit/daec074f173622ac67942cb553af8c8e97708c70", "message": "More review fixes.", "committedDate": "2020-01-31T13:01:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ2OTE3Mg==", "url": "https://github.com/vaadin/flow/pull/7456#discussion_r373469172", "bodyText": "nit: this function can be removed altogether and there are extra newlines below it.\ndidn't notice this during the first review round, sorry about that.", "author": "web-padawan", "createdAt": "2020-01-31T13:04:32Z", "path": "flow-server/src/main/resources/pnpmfile.js", "diffHunk": "@@ -0,0 +1,35 @@\n+const fs = require('fs');\n+\n+const packageJson = JSON.parse(fs.readFileSync('./package.json', 'utf-8'));\n+\n+const versionsFile = '[to-be-generated-by-flow]';\n+\n+if (!fs.existsSync(versionsFile)) {\n+    return;\n+}\n+const versions = JSON.parse(fs.readFileSync(versionsFile, 'utf-8'));\n+\n+module.exports = {\n+  hooks: {\n+    readPackage\n+  }\n+};\n+\n+function getExactVersion(string) {", "originalCommit": "58839b2a404e666611f138f2765b2530b7e5d99a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bfafa835ec11509142d561a3fe7304ec36392af8", "url": "https://github.com/vaadin/flow/commit/bfafa835ec11509142d561a3fe7304ec36392af8", "message": "Clean up hook file content and correct the class name in serializable\ntest", "committedDate": "2020-02-03T05:45:24Z", "type": "commit"}, {"oid": "dfe4664d8a6cbde4388f08abe0b6ee19a4a856ec", "url": "https://github.com/vaadin/flow/commit/dfe4664d8a6cbde4388f08abe0b6ee19a4a856ec", "message": "Remove test which is failing on CI.", "committedDate": "2020-02-03T07:09:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzk3MjIzMQ==", "url": "https://github.com/vaadin/flow/pull/7456#discussion_r373972231", "bodyText": "Remove the declaration of thrown exception 'java.io.IOException', as it cannot be thrown from method's body.", "author": "vaadin-bot", "createdAt": "2020-02-03T08:32:17Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/VersionsJsonConverter.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2000-2018 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.server.frontend;\n+\n+import java.io.IOException;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonObject;\n+import elemental.json.JsonValue;\n+\n+/**\n+ * Converts platform versions file to internal format which doesn't contain\n+ * extra information.\n+ * <p>\n+ * The result contains all dependencies as keys and their versions as value.\n+ *\n+ * @author Vaadin Ltd\n+ *\n+ */\n+class VersionsJsonConverter {\n+\n+    private static final String JS_VERSION = \"jsVersion\";\n+    private static final String NPM_NAME = \"npmName\";\n+    private final JsonObject convertedObject;\n+\n+    VersionsJsonConverter(JsonObject platformVersions) {\n+        convertedObject = Json.createObject();\n+\n+        collectDependencies(platformVersions);\n+    }\n+\n+    JsonObject convert() throws IOException {", "originalCommit": "dfe4664d8a6cbde4388f08abe0b6ee19a4a856ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzk3MjIzNg==", "url": "https://github.com/vaadin/flow/pull/7456#discussion_r373972236", "bodyText": "Remove this unused \"TemporaryFolder\".", "author": "vaadin-bot", "createdAt": "2020-02-03T08:32:18Z", "path": "flow-server/src/test/java/com/vaadin/flow/server/frontend/VersionsJsonConverterTest.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2000-2018 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.server.frontend;\n+\n+import java.io.IOException;\n+\n+import org.junit.Assert;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonObject;\n+\n+public class VersionsJsonConverterTest {\n+\n+    @Rule\n+    public TemporaryFolder temporaryFolder = new TemporaryFolder();", "originalCommit": "dfe4664d8a6cbde4388f08abe0b6ee19a4a856ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}