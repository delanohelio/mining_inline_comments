{"pr_number": 3097, "pr_title": "Create multi-pattern resource using the new static create/format methods in samples and tests", "pr_createdAt": "2020-02-20T00:35:47Z", "pr_url": "https://github.com/googleapis/gapic-generator/pull/3097", "timeline": [{"oid": "82eabe9f5b747620dac7312d08b5fd3e13a0c305", "url": "https://github.com/googleapis/gapic-generator/commit/82eabe9f5b747620dac7312d08b5fd3e13a0c305", "message": "first pass", "committedDate": "2020-02-20T00:34:21Z", "type": "commit"}, {"oid": "1c6467506448127db0dd7794cd2c15c9c19d782e", "url": "https://github.com/googleapis/gapic-generator/commit/1c6467506448127db0dd7794cd2c15c9c19d782e", "message": "update baseline", "committedDate": "2020-02-20T00:49:59Z", "type": "commit"}, {"oid": "a563ff69685a448debf5302206b201feec3d0fec", "url": "https://github.com/googleapis/gapic-generator/commit/a563ff69685a448debf5302206b201feec3d0fec", "message": "remove extra ;", "committedDate": "2020-02-20T00:59:19Z", "type": "commit"}, {"oid": "fc2fbf7b2f8f6b59340217b1b26a03df2228fa09", "url": "https://github.com/googleapis/gapic-generator/commit/fc2fbf7b2f8f6b59340217b1b26a03df2228fa09", "message": "add unit tests", "committedDate": "2020-02-20T01:13:45Z", "type": "commit"}, {"oid": "58ee318c9f3affb8015aebecb46555d9ec5968e2", "url": "https://github.com/googleapis/gapic-generator/commit/58ee318c9f3affb8015aebecb46555d9ec5968e2", "message": "tests too!", "committedDate": "2020-02-20T19:01:27Z", "type": "commit"}, {"oid": "256184a7a03bebc6bc2d5b5a044729275357e890", "url": "https://github.com/googleapis/gapic-generator/commit/256184a7a03bebc6bc2d5b5a044729275357e890", "message": "baseline update", "committedDate": "2020-02-20T19:04:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEzOTYyOA==", "url": "https://github.com/googleapis/gapic-generator/pull/3097#discussion_r384139628", "bodyText": "Minor: Please add a java doc here", "author": "vam-google", "createdAt": "2020-02-25T21:34:40Z", "path": "src/main/java/com/google/api/codegen/config/ResourceNamePatternConfig.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/* Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.api.codegen.config;\n+\n+import com.google.api.codegen.util.Name;\n+import com.google.api.pathtemplate.PathTemplate;\n+import com.google.common.collect.ImmutableSet;\n+import java.util.stream.Collectors;\n+import javax.annotation.Nullable;\n+\n+/** ResourceNamePatternConfig represents the configuration a resource name pattern. */\n+public class ResourceNamePatternConfig {\n+\n+  private final String pattern;\n+  @Nullable private final PathTemplate template;\n+\n+  public ResourceNamePatternConfig(String pattern) {\n+    this.pattern = pattern;\n+    this.template = PathTemplate.create(pattern);\n+  }\n+\n+  public ImmutableSet<String> getBindingVariables() {", "originalCommit": "256184a7a03bebc6bc2d5b5a044729275357e890", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE0Mjk0MA==", "url": "https://github.com/googleapis/gapic-generator/pull/3097#discussion_r384142940", "bodyText": "Isn't checking for only one of the braces enough?", "author": "vam-google", "createdAt": "2020-02-25T21:41:20Z", "path": "src/main/java/com/google/api/codegen/config/ResourceNamePatternConfig.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/* Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.api.codegen.config;\n+\n+import com.google.api.codegen.util.Name;\n+import com.google.api.pathtemplate.PathTemplate;\n+import com.google.common.collect.ImmutableSet;\n+import java.util.stream.Collectors;\n+import javax.annotation.Nullable;\n+\n+/** ResourceNamePatternConfig represents the configuration a resource name pattern. */\n+public class ResourceNamePatternConfig {\n+\n+  private final String pattern;\n+  @Nullable private final PathTemplate template;\n+\n+  public ResourceNamePatternConfig(String pattern) {\n+    this.pattern = pattern;\n+    this.template = PathTemplate.create(pattern);\n+  }\n+\n+  public ImmutableSet<String> getBindingVariables() {\n+    if (isFixedPattern()) {\n+      return ImmutableSet.of();\n+    }\n+    return ImmutableSet.copyOf(template.vars());\n+  }\n+\n+  /** Returns true if the pattern does not have binding variables. */\n+  public boolean isFixedPattern() {\n+    return pattern.indexOf('{') == -1 && pattern.indexOf('}') == -1;", "originalCommit": "256184a7a03bebc6bc2d5b5a044729275357e890", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY5ODU3Mw==", "url": "https://github.com/googleapis/gapic-generator/pull/3097#discussion_r384698573", "bodyText": "protoc resource name plugin checks fixed pattern this way - just wanted to be consistent.", "author": "yihanzhen", "createdAt": "2020-02-26T19:01:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE0Mjk0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDIzMTQ2OQ==", "url": "https://github.com/googleapis/gapic-generator/pull/3097#discussion_r384231469", "bodyText": "Please consider replacing this method with String.replaceAll().", "author": "vam-google", "createdAt": "2020-02-26T01:39:21Z", "path": "src/main/java/com/google/api/codegen/config/ResourceNamePatternConfig.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/* Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.api.codegen.config;\n+\n+import com.google.api.codegen.util.Name;\n+import com.google.api.pathtemplate.PathTemplate;\n+import com.google.common.collect.ImmutableSet;\n+import java.util.stream.Collectors;\n+import javax.annotation.Nullable;\n+\n+/** ResourceNamePatternConfig represents the configuration a resource name pattern. */\n+public class ResourceNamePatternConfig {\n+\n+  private final String pattern;\n+  @Nullable private final PathTemplate template;\n+\n+  public ResourceNamePatternConfig(String pattern) {\n+    this.pattern = pattern;\n+    this.template = PathTemplate.create(pattern);\n+  }\n+\n+  public ImmutableSet<String> getBindingVariables() {\n+    if (isFixedPattern()) {\n+      return ImmutableSet.of();\n+    }\n+    return ImmutableSet.copyOf(template.vars());\n+  }\n+\n+  /** Returns true if the pattern does not have binding variables. */\n+  public boolean isFixedPattern() {\n+    return pattern.indexOf('{') == -1 && pattern.indexOf('}') == -1;\n+  }\n+\n+  /**\n+   * Returns the name of the static method that creates an instance of the resource name class\n+   * representing this pattern, such as ofProjectBookName.\n+   */\n+  public String getCreateMethodName() {\n+    return Name.anyLower(\"of\", getPatternNameLowerUnderscore(), \"name\").toLowerCamel();\n+  }\n+\n+  /**\n+   * Returns the name of the static method that returns a formatted string using this pattern, such\n+   * as formatProjectBookName.\n+   */\n+  public String getFormatMethodName() {\n+    return Name.anyLower(\"format\", getPatternNameLowerUnderscore(), \"name\").toLowerCamel();\n+  }\n+\n+  private String getPatternNameLowerUnderscore() {", "originalCommit": "256184a7a03bebc6bc2d5b5a044729275357e890", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDIzMjczNQ==", "url": "https://github.com/googleapis/gapic-generator/pull/3097#discussion_r384232735", "bodyText": "Please consider moving this in a variable (not changed in the stream).", "author": "vam-google", "createdAt": "2020-02-26T01:44:11Z", "path": "src/main/java/com/google/api/codegen/transformer/InitCodeTransformer.java", "diffHunk": "@@ -977,6 +1001,20 @@ private static SingleResourceNameConfig getMatchingSingleResourceNameConfig(\n     return matchingConfigs.get(0);\n   }\n \n+  private static ResourceNamePatternConfig getMatchingResourceNamePattern(\n+      InitCodeNode node, ResourceNameOneofConfig oneofConfig) {\n+    Optional<ResourceNamePatternConfig> pattern =\n+        oneofConfig\n+            .getPatterns()\n+            .stream()\n+            .filter(\n+                p ->\n+                    p.getBindingVariables()\n+                        .equals(node.getInitValueConfig().getResourceNameBindingValues().keySet()))", "originalCommit": "256184a7a03bebc6bc2d5b5a044729275357e890", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2429a83b619624b65bbead795ee691d43a17ab5a", "url": "https://github.com/googleapis/gapic-generator/commit/2429a83b619624b65bbead795ee691d43a17ab5a", "message": "implement all", "committedDate": "2020-02-26T19:25:10Z", "type": "commit"}, {"oid": "965767bbfa16379787731a61d50a92e437b6fe7f", "url": "https://github.com/googleapis/gapic-generator/commit/965767bbfa16379787731a61d50a92e437b6fe7f", "message": "Merge branch 'master' into multi-pattern-samplegen", "committedDate": "2020-02-26T19:25:48Z", "type": "commit"}]}