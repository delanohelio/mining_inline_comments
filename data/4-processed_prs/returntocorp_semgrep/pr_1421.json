{"pr_number": 1421, "pr_title": "Match \"OtherAttribute\" attributes in any order", "pr_createdAt": "2020-07-31T16:37:42Z", "pr_url": "https://github.com/returntocorp/semgrep/pull/1421", "timeline": [{"oid": "8ce43b13e3d306456495de0061bc3499943f4ea0", "url": "https://github.com/returntocorp/semgrep/commit/8ce43b13e3d306456495de0061bc3499943f4ea0", "message": "Match \"OtherAttribute\" attributes in any order\n\nWe already have code to match keyword and named attributes in any order\nin an attribute list, and to match with \"less is ok\" functionality.\n\nThis commit extends that to work with \"OtherAttribute\" AST nodes as\nwell. Note that it is not fully implemented here, as I took a shortcut\nthat would leave this pattern:\n\n```python\n@x(\"a\")\n@x(\"a\")\ndef foo:\n  ...\n```\n\nstill matching this code:\n\n```python\n@x(\"a\")\ndef foo:\n  pass\n```\n\nI'm leaving this as a TODO for now.\n\nFixes #1406.", "committedDate": "2020-07-31T16:36:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcxNjExOQ==", "url": "https://github.com/returntocorp/semgrep/pull/1421#discussion_r463716119", "bodyText": "Note that \"the general case\" is actually just the specific \"OtherAttribute\" case", "author": "nbrahms", "createdAt": "2020-07-31T16:41:56Z", "path": "semgrep-core/matching/Generic_vs_generic.ml", "diffHunk": "@@ -1298,13 +1298,25 @@ and m_list__m_attribute (xsa: A.attribute list) (xsb: A.attribute list) =\n       with Not_found -> fail ()\n       )\n   (*e: [[Generic_vs_generic.m_list__m_attribute]] [[NamedAttr]] pattern case *)\n-  (* the general case *)", "originalCommit": "8ce43b13e3d306456495de0061bc3499943f4ea0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fd58867dd1fb9d7ea5a00dada892566c16989fc7", "url": "https://github.com/returntocorp/semgrep/commit/fd58867dd1fb9d7ea5a00dada892566c16989fc7", "message": "Alternate solution", "committedDate": "2020-07-31T19:30:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDg0ODczOA==", "url": "https://github.com/returntocorp/semgrep/pull/1421#discussion_r464848738", "bodyText": "better to remove the body of m_list__m_attribute and call\nm_list_in_any_order ... in it that way all the places where we look for attributes will have this new behavior.\n(need to check the possible perf regression when applied to all the instances).", "author": "aryx", "createdAt": "2020-08-04T07:18:11Z", "path": "semgrep-core/matching/Generic_vs_generic.ml", "diffHunk": "@@ -1846,7 +1846,7 @@ and m_entity a b =\n   { A. name = a1; attrs = a2; tparams = a4; info = a5 },\n   { B. name = b1; attrs = b2; tparams = b4; info = b5 } ->\n     m_ident_and_id_info_add_in_env_Expr (a1, a5) (b1, b5) >>= (fun () ->\n-    (m_list__m_attribute) a2 b2 >>= (fun () ->\n+    (m_list_in_any_order ~less_is_ok:true m_attribute a2 b2) >>= (fun () ->", "originalCommit": "fd58867dd1fb9d7ea5a00dada892566c16989fc7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}