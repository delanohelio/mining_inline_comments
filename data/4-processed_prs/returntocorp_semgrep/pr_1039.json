{"pr_number": 1039, "pr_title": "Add pretty error for invalid language", "pr_createdAt": "2020-06-17T01:35:13Z", "pr_url": "https://github.com/returntocorp/semgrep/pull/1039", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2ODMyOQ==", "url": "https://github.com/returntocorp/semgrep/pull/1039#discussion_r441268329", "bodyText": "It might be easier to know what errors are raised by semgrep if we subclass and have an InvalidLanguageError that takes in language and span?", "author": "brendongo", "createdAt": "2020-06-17T04:05:56Z", "path": "semgrep/semgrep/core_runner.py", "diffHunk": "@@ -224,7 +228,18 @@ def _run_rule(\n         for language, all_patterns_for_language in self._group_patterns_by_language(\n             [rule]\n         ).items():\n-            targets = target_manager.get_files(language, rule.includes, rule.excludes)\n+            try:\n+                targets = target_manager.get_files(\n+                    language, rule.includes, rule.excludes\n+                )\n+            except UnknownLanguageError as ex:\n+                raise ErrorWithSpan(", "originalCommit": "c6cd9eccd8277fa213640b6825008edf4854a7ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTUzMDAzMg==", "url": "https://github.com/returntocorp/semgrep/pull/1039#discussion_r441530032", "bodyText": "We can do that but it would duplicate what you have -- at the time you throw the error we don't have context.\nSince the cause is chained in, the verbose mode I'm imagining would be able to easily show a complete stack trace.\nHowever, we can definitely just subclass and have two unknown language errors.", "author": "rcoh", "createdAt": "2020-06-17T13:07:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2ODMyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcyNjc3OQ==", "url": "https://github.com/returntocorp/semgrep/pull/1039#discussion_r441726779", "bodyText": "Oh I see. I think that's fine. Maybe rename the target manager exception to _UnknownLanguageError or something since with this PR that exception should be internal anyway. I think it makes sense as you say below to always subclass ErrorWithSpan so it's always clear from the type of the exception alone what kind of error this is vs having to look into the short_msg to find out", "author": "brendongo", "createdAt": "2020-06-17T17:56:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2ODMyOQ=="}], "type": "inlineReview"}, {"oid": "6368b33df9ffafa7cf2a6ab11165ce2077653437", "url": "https://github.com/returntocorp/semgrep/commit/6368b33df9ffafa7cf2a6ab11165ce2077653437", "message": "Add pretty error for invalid language", "committedDate": "2020-06-17T19:54:19Z", "type": "commit"}, {"oid": "5ebad71e9ef53c38173da272247c81156c74e188", "url": "https://github.com/returntocorp/semgrep/commit/5ebad71e9ef53c38173da272247c81156c74e188", "message": "Switch to subclassing SemgrepError", "committedDate": "2020-06-17T19:54:19Z", "type": "commit"}, {"oid": "67b9e1e42ca813ae36940ec33aa2bbade0c32512", "url": "https://github.com/returntocorp/semgrep/commit/67b9e1e42ca813ae36940ec33aa2bbade0c32512", "message": "Remove unused import", "committedDate": "2020-06-17T19:54:19Z", "type": "commit"}, {"oid": "67b9e1e42ca813ae36940ec33aa2bbade0c32512", "url": "https://github.com/returntocorp/semgrep/commit/67b9e1e42ca813ae36940ec33aa2bbade0c32512", "message": "Remove unused import", "committedDate": "2020-06-17T19:54:19Z", "type": "forcePushed"}]}