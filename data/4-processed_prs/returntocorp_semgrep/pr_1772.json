{"pr_number": 1772, "pr_title": "Improved tags in Sarif output", "pr_createdAt": "2020-10-02T07:58:11Z", "pr_url": "https://github.com/returntocorp/semgrep/pull/1772", "timeline": [{"oid": "94798867e703a2c377769f96b0ac10d902197ae4", "url": "https://github.com/returntocorp/semgrep/commit/94798867e703a2c377769f96b0ac10d902197ae4", "message": "Metadata values used in Sarif output", "committedDate": "2020-10-02T06:39:24Z", "type": "commit"}, {"oid": "17d2f53dbdeaad9ea51375ab01b4234a1a5470be", "url": "https://github.com/returntocorp/semgrep/commit/17d2f53dbdeaad9ea51375ab01b4234a1a5470be", "message": "now using isdigit() to check char vals", "committedDate": "2020-10-02T07:36:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDUzODgxMA==", "url": "https://github.com/returntocorp/semgrep/pull/1772#discussion_r500538810", "bodyText": "Hi @hunt3rkillerz, thanks for the PR. Is it reasonable to simply return the string from the metadata if it exists? This avoids all the heavy string parsing. E.g.\nif \"cwe\" in self.metadata:\n    yield self.metadata['cwe']\nif \"owasp\" in self.metadata:\n    yield f\"OWASP-{self.metadata['owasp']}\"\nNote that I prepended OWASP because our convention hasn't included it, but has for CWE:\njavascript/lang/security/audit/path-traversal/path-join-resolve-traversal.yaml\n47:    owasp: 'A5: Broken Access Control'\n48:    cwe: 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (Path Traversal)'\n\njavascript/lang/security/audit/non-constant-sql-query.yaml\n10:    owasp: 'A1: Injection'\n11:    cwe: \"CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')\"\n\njavascript/lang/security/audit/unknown-value-with-script-tag.yaml\n14:    owasp: 'A7: Cross-site Scripting (XSS)'\n15:    cwe: \"CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')\"", "author": "mschwager", "createdAt": "2020-10-06T19:18:35Z", "path": "semgrep/semgrep/rule.py", "diffHunk": "@@ -261,9 +261,25 @@ def sarif_tags(self) -> Iterator[str]:\n         Tags to display on SARIF-compliant UIs, such as GitHub security scans.\n         \"\"\"\n         if \"cwe\" in self.metadata:\n-            yield \"cwe\"\n+            # Handling unexpected formatting of CWE meta-data", "originalCommit": "17d2f53dbdeaad9ea51375ab01b4234a1a5470be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU3MzUxNg==", "url": "https://github.com/returntocorp/semgrep/pull/1772#discussion_r500573516", "bodyText": "Hi @mschwager, the reason I tried to cut down the tags is I noticed that there was some inconsistent formatting in the rules repo (some rules had the full description and some did not).\nAdditionally, I'm not sure if there is a string length limit on tags when you upload a SARIF to Github's API (happy to test this if the preference is to avoid the string parsing).", "author": "hunt3rkillerz", "createdAt": "2020-10-06T20:23:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDUzODgxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI3MzU3OA==", "url": "https://github.com/returntocorp/semgrep/pull/1772#discussion_r501273578", "bodyText": "I think simply returning what's in the metadata key (e.g. self.metadata['cwe']) would be easiest. If there are inconsistencies, or we want to improve the metadata, let's do so in the rules themselves instead of accounting for all cases here. If you have a list of rules whose metadata could be improved I'd be happy to help out \ud83d\udc4d", "author": "mschwager", "createdAt": "2020-10-07T19:58:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDUzODgxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU1NDAzMQ==", "url": "https://github.com/returntocorp/semgrep/pull/1772#discussion_r501554031", "bodyText": "The changes above have been implemented.", "author": "hunt3rkillerz", "createdAt": "2020-10-08T08:52:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDUzODgxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU1NTcyMQ==", "url": "https://github.com/returntocorp/semgrep/pull/1772#discussion_r501555721", "bodyText": "Regarding rules with Metadata issues. I can probably go through the rules repo and see about cleaning up some formatting.", "author": "hunt3rkillerz", "createdAt": "2020-10-08T08:55:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDUzODgxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgwNTQzOQ==", "url": "https://github.com/returntocorp/semgrep/pull/1772#discussion_r501805439", "bodyText": "Awesome, thank you!", "author": "mschwager", "createdAt": "2020-10-08T15:18:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDUzODgxMA=="}], "type": "inlineReview"}, {"oid": "aaffe1a527365f58fbc04ecf43a4ea2eb7270029", "url": "https://github.com/returntocorp/semgrep/commit/aaffe1a527365f58fbc04ecf43a4ea2eb7270029", "message": "Directly outputting meta values", "committedDate": "2020-10-08T08:10:46Z", "type": "commit"}]}