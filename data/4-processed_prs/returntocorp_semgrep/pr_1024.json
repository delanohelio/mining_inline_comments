{"pr_number": 1024, "pr_title": "Add tqdm", "pr_createdAt": "2020-06-15T20:39:00Z", "pr_url": "https://github.com/returntocorp/semgrep/pull/1024", "timeline": [{"oid": "7a1fe03d5df64b072725a64e2e1f24e658437a57", "url": "https://github.com/returntocorp/semgrep/commit/7a1fe03d5df64b072725a64e2e1f24e658437a57", "message": "core_runner: pass targets using -target_file instead of as list\n\nPassing as a list to subprocess will potentially hit command line\ncharacter limits. This bypasses the limit by using semgrep-core's\ntarget_file option.", "committedDate": "2020-06-13T02:11:48Z", "type": "commit"}, {"oid": "2773340c769910bfba4d432df20851819170b99c", "url": "https://github.com/returntocorp/semgrep/commit/2773340c769910bfba4d432df20851819170b99c", "message": "fixup! core_runner: pass targets using -target_file instead of as list", "committedDate": "2020-06-15T18:00:52Z", "type": "commit"}, {"oid": "fb9ebedd65b184976148e5a97dc5fb35918dc682", "url": "https://github.com/returntocorp/semgrep/commit/fb9ebedd65b184976148e5a97dc5fb35918dc682", "message": "fixup! core_runner: pass targets using -target_file instead of as list", "committedDate": "2020-06-15T18:46:18Z", "type": "commit"}, {"oid": "1cfd8e48c0b75fabd1c56dff052365af4273ed22", "url": "https://github.com/returntocorp/semgrep/commit/1cfd8e48c0b75fabd1c56dff052365af4273ed22", "message": "Merge branch 'brendon/usetargetfile' of https://github.com/returntocorp/semgrep into progress-indicator", "committedDate": "2020-06-15T19:32:41Z", "type": "commit"}, {"oid": "946309201eb108e2ea2954dfdc22aa34a89b3065", "url": "https://github.com/returntocorp/semgrep/commit/946309201eb108e2ea2954dfdc22aa34a89b3065", "message": "Add tqdm to indicate that semgrep is running. tqdm progress bar uses rules as its basis. With verbose flag, semgrep will now also print which rule is running.", "committedDate": "2020-06-15T20:37:27Z", "type": "commit"}, {"oid": "0c67ae0236aa657bd9d86f732b57daeb1f99dd7e", "url": "https://github.com/returntocorp/semgrep/commit/0c67ae0236aa657bd9d86f732b57daeb1f99dd7e", "message": "Merge with develop branch. Remove debug print showing semgrep command.", "committedDate": "2020-06-15T20:40:50Z", "type": "commit"}, {"oid": "f7ae13a5677fcbdb58d4d1a8c5be7918a9326fee", "url": "https://github.com/returntocorp/semgrep/commit/f7ae13a5677fcbdb58d4d1a8c5be7918a9326fee", "message": "Update snapshots", "committedDate": "2020-06-15T20:41:51Z", "type": "commit"}, {"oid": "71b55c7ba40537df42df44f45a6b7fd095704230", "url": "https://github.com/returntocorp/semgrep/commit/71b55c7ba40537df42df44f45a6b7fd095704230", "message": "Change bar format to not include iterations/cycle.", "committedDate": "2020-06-15T20:55:14Z", "type": "commit"}, {"oid": "6d2c731c6efd5db5b6200420dd6f50e31e139c9b", "url": "https://github.com/returntocorp/semgrep/commit/6d2c731c6efd5db5b6200420dd6f50e31e139c9b", "message": "Update snapshots", "committedDate": "2020-06-15T20:55:27Z", "type": "commit"}, {"oid": "d3c474ccd14a9af0fc5397058f593a1c2cf112f4", "url": "https://github.com/returntocorp/semgrep/commit/d3c474ccd14a9af0fc5397058f593a1c2cf112f4", "message": "Add tqdm to setup.py to enable Docker build", "committedDate": "2020-06-15T21:29:28Z", "type": "commit"}, {"oid": "ee7896d1ed2ba263bdfa0452de5fb034d4a39047", "url": "https://github.com/returntocorp/semgrep/commit/ee7896d1ed2ba263bdfa0452de5fb034d4a39047", "message": "Added a wrapper function which will check to see if the output stream for tqdm is a tty. If so, returns the iterable wrapped with tqdm, otherwise returns the regular iterable. Regenerated tests with this update.", "committedDate": "2020-06-15T21:48:05Z", "type": "commit"}, {"oid": "aa02a7e224ab7ae49f1207b1a0a4a508f74a8088", "url": "https://github.com/returntocorp/semgrep/commit/aa02a7e224ab7ae49f1207b1a0a4a508f74a8088", "message": "Merge branch 'develop' into add-tqdm", "committedDate": "2020-06-16T00:34:39Z", "type": "commit"}, {"oid": "524dedcfc4a230d8f5d2a8f282fdc78a62924038", "url": "https://github.com/returntocorp/semgrep/commit/524dedcfc4a230d8f5d2a8f282fdc78a62924038", "message": "Black formatting'", "committedDate": "2020-06-16T11:25:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzNzQwNw==", "url": "https://github.com/returntocorp/semgrep/pull/1024#discussion_r440537407", "bodyText": "having it in setup.py is sufficient, you can remove this", "author": "rcoh", "createdAt": "2020-06-16T01:38:55Z", "path": "semgrep/Pipfile", "diffHunk": "@@ -13,6 +13,7 @@ appdirs = \"*\"\n \n [packages]\n semgrep = {editable = true,path = \".\"}\n+tqdm = \"*\"", "originalCommit": "aa02a7e224ab7ae49f1207b1a0a4a508f74a8088", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk5NjcyOA==", "url": "https://github.com/returntocorp/semgrep/pull/1024#discussion_r440996728", "bodyText": "Does pipenv install pick up setup.py?", "author": "minusworld", "createdAt": "2020-06-16T16:47:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzNzQwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxNDMwNw==", "url": "https://github.com/returntocorp/semgrep/pull/1024#discussion_r441014307", "bodyText": "Google says yes \ud83c\udfb1", "author": "minusworld", "createdAt": "2020-06-16T17:16:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzNzQwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzNzY4Ng==", "url": "https://github.com/returntocorp/semgrep/pull/1024#discussion_r440537686", "bodyText": "might as well put this in util", "author": "rcoh", "createdAt": "2020-06-16T01:40:01Z", "path": "semgrep/semgrep/core_runner.py", "diffHunk": "@@ -35,6 +37,16 @@\n from semgrep.util import partition\n \n \n+def _progress_bar(iterable: List[Rule], file: IO = sys.stderr, **kwargs: Any) -> Any:", "originalCommit": "aa02a7e224ab7ae49f1207b1a0a4a508f74a8088", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzNzkxNg==", "url": "https://github.com/returntocorp/semgrep/pull/1024#discussion_r440537916", "bodyText": "Also, it isn't iterable[Rule], since this is generally useful it can be Iterable[T]. It should also return Iterable[T]", "author": "rcoh", "createdAt": "2020-06-16T01:40:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzNzY4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzODEwMA==", "url": "https://github.com/returntocorp/semgrep/pull/1024#discussion_r440538100", "bodyText": "we shouldn't print while the progress bar is running, it will cause the progress bar output to be corrupted. I want tqdm.write I think?", "author": "rcoh", "createdAt": "2020-06-16T01:41:32Z", "path": "semgrep/semgrep/core_runner.py", "diffHunk": "@@ -327,8 +338,10 @@ def _run_rules(\n         debugging_steps_by_rule: Dict[Rule, List[Dict[str, Any]]] = {}\n         all_errors = []\n \n+        # cf. for bar_format: https://tqdm.github.io/docs/tqdm/\n         with tempfile.TemporaryDirectory() as semgrep_core_ast_cache_dir:\n-            for rule in rules:\n+            for rule in _progress_bar(rules, bar_format=\"{l_bar}{bar}|{n_fmt}/{total_fmt}\"):\n+                debug_print(f\"Running rule {rule._raw.get('id')}\")", "originalCommit": "aa02a7e224ab7ae49f1207b1a0a4a508f74a8088", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8f62dfa0803f7ad406c29b129569efefb5e2dfca", "url": "https://github.com/returntocorp/semgrep/commit/8f62dfa0803f7ad406c29b129569efefb5e2dfca", "message": "Address PR comments; Remove tqdm from Pipfile", "committedDate": "2020-06-16T17:17:59Z", "type": "commit"}, {"oid": "50c3c4568bcbf2f08cf669cd91a30d3a1dbca176", "url": "https://github.com/returntocorp/semgrep/commit/50c3c4568bcbf2f08cf669cd91a30d3a1dbca176", "message": "Address PR comments; move progress bar func to util. Use generic type hints", "committedDate": "2020-06-16T17:38:17Z", "type": "commit"}, {"oid": "5d6176b0941d5b1fb6e32166e472e71d0b993723", "url": "https://github.com/returntocorp/semgrep/commit/5d6176b0941d5b1fb6e32166e472e71d0b993723", "message": "Remove unused imports", "committedDate": "2020-06-16T17:44:54Z", "type": "commit"}]}