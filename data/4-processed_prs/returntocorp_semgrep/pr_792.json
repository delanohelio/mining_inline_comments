{"pr_number": 792, "pr_title": "qa-tests: Add tests for realworld pattern-regex", "pr_createdAt": "2020-05-19T19:34:46Z", "pr_url": "https://github.com/returntocorp/semgrep/pull/792", "timeline": [{"oid": "4b5886c2cbae2cbb673010f7edca856904f216df", "url": "https://github.com/returntocorp/semgrep/commit/4b5886c2cbae2cbb673010f7edca856904f216df", "message": "qa-tests: Add tests for realworld pattern-regex", "committedDate": "2020-05-19T19:33:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU1MzE0NQ==", "url": "https://github.com/returntocorp/semgrep/pull/792#discussion_r427553145", "bodyText": "aww my lil number working his way into everyone's hearts \ud83d\ude0a", "author": "underyx", "createdAt": "2020-05-19T19:38:58Z", "path": "semgrep/tests/qa/rules/regex-sentinel.yaml", "diffHunk": "@@ -0,0 +1,7 @@\n+rules:\n+  - id: test-regex\n+    patterns:\n+      - pattern-regex: '. = 87518275812375164'", "originalCommit": "4b5886c2cbae2cbb673010f7edca856904f216df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU1NDI3NA==", "url": "https://github.com/returntocorp/semgrep/pull/792#discussion_r427554274", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"--config=rules/regex-sentinel.yaml\",\n          \n          \n            \n                        \"--config\",\n          \n          \n            \n                        Path(TESTS_PATH / \"qa\" / \"rules\" / \"regex-sentinel.yaml\").resolve(),\n          \n      \n    \n    \n  \n\nwouldn't this work? then we wouldn't need to mess with tmp paths above.", "author": "underyx", "createdAt": "2020-05-19T19:41:00Z", "path": "semgrep/tests/qa/test_public_repos.py", "diffHunk": "@@ -109,3 +114,19 @@ def test_semgrep_on_repo(run_semgrep_in_tmp, repo_url):\n         assert output[\"errors\"] == []\n         assert len(output[\"results\"]) == 1\n         assert output[\"results\"][0][\"path\"] == str(sentinel_path)\n+\n+    output = subprocess.check_output(\n+        [\n+            \"python3\",\n+            \"-m\",\n+            \"semgrep\",\n+            \"--config=rules/regex-sentinel.yaml\",", "originalCommit": "4b5886c2cbae2cbb673010f7edca856904f216df", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU1NTI0NQ==", "url": "https://github.com/returntocorp/semgrep/pull/792#discussion_r427555245", "bodyText": "I think you need to wrap with str(...)", "author": "DrewDennison", "createdAt": "2020-05-19T19:42:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU1NDI3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU1NTYwMw==", "url": "https://github.com/returntocorp/semgrep/pull/792#discussion_r427555603", "bodyText": "nope, subprocess functions accept Path", "author": "underyx", "createdAt": "2020-05-19T19:43:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU1NDI3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU1Njg3Ng==", "url": "https://github.com/returntocorp/semgrep/pull/792#discussion_r427556876", "bodyText": "Ah, now I see that most of the tmp_path lines would need to stay anyway cause we got rid of the run_semgrep_in_tmp fixture which would normally set it up.", "author": "underyx", "createdAt": "2020-05-19T19:45:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU1NDI3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU1ODQxMQ==", "url": "https://github.com/returntocorp/semgrep/pull/792#discussion_r427558411", "bodyText": "Not really sure what's going on with all this path stuff - I trust @underyx's thoughts \ud83d\udc4d", "author": "mschwager", "createdAt": "2020-05-19T19:48:40Z", "path": "semgrep/tests/qa/test_public_repos.py", "diffHunk": "@@ -60,7 +60,12 @@ def xfail_repo(url, *, reason=None):\n         ),\n     ],\n )\n-def test_semgrep_on_repo(run_semgrep_in_tmp, repo_url):\n+def test_semgrep_on_repo(monkeypatch, tmp_path, repo_url):\n+    TESTS_PATH = Path(__file__).parent.parent", "originalCommit": "4b5886c2cbae2cbb673010f7edca856904f216df", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU2OTc2NA==", "url": "https://github.com/returntocorp/semgrep/pull/792#discussion_r427569764", "bodyText": "it's just replicating the code from run_semgrep_in_tmp fixture, we good \ud83d\ude07", "author": "underyx", "createdAt": "2020-05-19T20:09:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU1ODQxMQ=="}], "type": "inlineReview"}]}