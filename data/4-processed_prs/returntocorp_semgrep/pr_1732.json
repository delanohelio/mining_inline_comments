{"pr_number": 1732, "pr_title": "Clean up parser warning UX", "pr_createdAt": "2020-09-26T19:22:54Z", "pr_url": "https://github.com/returntocorp/semgrep/pull/1732", "timeline": [{"oid": "266ae0260b56881d2317ee906939fff206e2d7a8", "url": "https://github.com/returntocorp/semgrep/commit/266ae0260b56881d2317ee906939fff206e2d7a8", "message": "display a stats line in normal textual output", "committedDate": "2020-09-26T19:20:56Z", "type": "commit"}, {"oid": "f589a171fb6d7c7bdc6316330c97b5ad160b338b", "url": "https://github.com/returntocorp/semgrep/commit/f589a171fb6d7c7bdc6316330c97b5ad160b338b", "message": "debug now actually means logging debug; verbose is for displaying errors", "committedDate": "2020-09-26T19:51:37Z", "type": "commit"}, {"oid": "6b4c5e5122cadbaee8fa11ab4a33e960f125dc84", "url": "https://github.com/returntocorp/semgrep/commit/6b4c5e5122cadbaee8fa11ab4a33e960f125dc84", "message": "per rule # of files ran on in --debug mode", "committedDate": "2020-09-26T20:00:51Z", "type": "commit"}, {"oid": "ad27e1adc63525de995b61fc55b86783e7b6e768", "url": "https://github.com/returntocorp/semgrep/commit/ad27e1adc63525de995b61fc55b86783e7b6e768", "message": "add changelog", "committedDate": "2020-09-26T20:05:31Z", "type": "commit"}, {"oid": "6a2178b336038206e026230a5c4886013b34f444", "url": "https://github.com/returntocorp/semgrep/commit/6a2178b336038206e026230a5c4886013b34f444", "message": "revert ocaml tree sitter lang", "committedDate": "2020-09-26T20:07:15Z", "type": "commit"}, {"oid": "bc52e2a220099bf25e2dc7f81ca8e46e15186405", "url": "https://github.com/returntocorp/semgrep/commit/bc52e2a220099bf25e2dc7f81ca8e46e15186405", "message": "Fixes for #1562 and #1551", "committedDate": "2020-09-26T20:40:36Z", "type": "commit"}, {"oid": "a5dc0c88a5aa81004b02fb79562caad65f000911", "url": "https://github.com/returntocorp/semgrep/commit/a5dc0c88a5aa81004b02fb79562caad65f000911", "message": "hide only WARN level SemgrepError(s) by default", "committedDate": "2020-09-26T20:53:35Z", "type": "commit"}, {"oid": "6982ec1f1746917c7f73a8fa0f7b79ce75678f8d", "url": "https://github.com/returntocorp/semgrep/commit/6982ec1f1746917c7f73a8fa0f7b79ce75678f8d", "message": "add missing kwargs", "committedDate": "2020-09-26T21:24:04Z", "type": "commit"}, {"oid": "02a335b9a298a76690dd74b09c58e701463a420a", "url": "https://github.com/returntocorp/semgrep/commit/02a335b9a298a76690dd74b09c58e701463a420a", "message": "commit expected text changes", "committedDate": "2020-09-26T21:36:25Z", "type": "commit"}, {"oid": "454daaf0cfaa0e0c6cf294db27d6f109d00d324e", "url": "https://github.com/returntocorp/semgrep/commit/454daaf0cfaa0e0c6cf294db27d6f109d00d324e", "message": "fix expected tests", "committedDate": "2020-09-26T22:37:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcyOTIyNQ==", "url": "https://github.com/returntocorp/semgrep/pull/1732#discussion_r497729225", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    # logger.debug(all_targets)", "author": "brendongo", "createdAt": "2020-09-30T18:51:46Z", "path": "semgrep/semgrep/core_runner.py", "diffHunk": "@@ -498,6 +501,7 @@ def _run_rules(\n                             max_timeout_files.append(err.path)\n \n         all_errors = dedup_errors(all_errors)\n+        # logger.debug(all_targets)", "originalCommit": "454daaf0cfaa0e0c6cf294db27d6f109d00d324e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczMjI0NA==", "url": "https://github.com/returntocorp/semgrep/pull/1732#discussion_r497732244", "bodyText": "Some users expect no output to be printed when no matches are found. IMO a stats line should be under --verbose and output should only ever be findings.", "author": "brendongo", "createdAt": "2020-09-30T18:57:12Z", "path": "semgrep/semgrep/output.py", "diffHunk": "@@ -399,7 +409,10 @@ def build_output(self, color_output: bool) -> str:\n         elif output_format == OutputFormat.SARIF:\n             return build_sarif_output(self.rule_matches, self.rules)\n         elif output_format == OutputFormat.TEXT:\n-            return \"\\n\".join(build_normal_output(self.rule_matches, color_output))\n+            return \"\\n\".join(\n+                list(build_normal_output(self.rule_matches, color_output))\n+                + ([self.stats_line] if self.stats_line else [])", "originalCommit": "454daaf0cfaa0e0c6cf294db27d6f109d00d324e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU2NjA1Nw==", "url": "https://github.com/returntocorp/semgrep/pull/1732#discussion_r498566057", "bodyText": "Even in an interactive session @brendongo? I agree if run under a headless shell but for interactive it makes more sense that it tells you how many files it ran on and that there were 0 findings. I get that that differs from grep, but I'm trying to think about the non-poweruser UX.", "author": "ievans", "createdAt": "2020-10-01T23:55:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczMjI0NA=="}], "type": "inlineReview"}, {"oid": "20ba06f3190906d29666c4038a57a29b0fba6ae3", "url": "https://github.com/returntocorp/semgrep/commit/20ba06f3190906d29666c4038a57a29b0fba6ae3", "message": "Update semgrep/semgrep/core_runner.py\n\nCo-authored-by: Brendon Go <brendon.go@gmail.com>", "committedDate": "2020-10-01T23:54:51Z", "type": "commit"}, {"oid": "4c6a8646ec70b11db12546f440b1f664329de3df", "url": "https://github.com/returntocorp/semgrep/commit/4c6a8646ec70b11db12546f440b1f664329de3df", "message": "Merge branch 'develop' into ie/output-stats", "committedDate": "2020-10-02T00:01:13Z", "type": "commit"}, {"oid": "dfae656daf741307613054e07fdb85c8540938a6", "url": "https://github.com/returntocorp/semgrep/commit/dfae656daf741307613054e07fdb85c8540938a6", "message": "address PR feedback", "committedDate": "2020-10-05T20:37:39Z", "type": "commit"}, {"oid": "3cb743e442f8953577daeac1663f8ec3eadbe41d", "url": "https://github.com/returntocorp/semgrep/commit/3cb743e442f8953577daeac1663f8ec3eadbe41d", "message": "update tests", "committedDate": "2020-10-05T22:07:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxNTk3MQ==", "url": "https://github.com/returntocorp/semgrep/pull/1732#discussion_r499915971", "bodyText": "Still not sure why we are passing stats line to output and gating tty instead of outputting to stderr like all other non finding output.", "author": "brendongo", "createdAt": "2020-10-05T22:57:14Z", "path": "semgrep/semgrep/output.py", "diffHunk": "@@ -399,7 +409,13 @@ def build_output(self, color_output: bool) -> str:\n         elif output_format == OutputFormat.SARIF:\n             return build_sarif_output(self.rule_matches, self.rules)\n         elif output_format == OutputFormat.TEXT:\n-            return \"\\n\".join(build_normal_output(self.rule_matches, color_output))\n+            stats_line = []\n+            if sys.stderr.isatty():", "originalCommit": "3cb743e442f8953577daeac1663f8ec3eadbe41d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxNjQ3OQ==", "url": "https://github.com/returntocorp/semgrep/pull/1732#discussion_r499916479", "bodyText": "Relevant slack convo: https://returntocorp.slack.com/archives/C6A1GN4P3/p1601598463387000?thread_ts=1601596568.384500&cid=C6A1GN4P3", "author": "brendongo", "createdAt": "2020-10-05T22:58:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxNTk3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxNzk2OQ==", "url": "https://github.com/returntocorp/semgrep/pull/1732#discussion_r499917969", "bodyText": "It's also less code: call logger.info here: https://github.com/returntocorp/semgrep/blob/develop/semgrep/semgrep/output.py#L346 ?", "author": "brendongo", "createdAt": "2020-10-05T23:03:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxNTk3MQ=="}], "type": "inlineReview"}, {"oid": "820e229278c6f40f6378cb35fedfd42e83868209", "url": "https://github.com/returntocorp/semgrep/commit/820e229278c6f40f6378cb35fedfd42e83868209", "message": "Revert \"update tests\"\n\nThis reverts commit 3cb743e442f8953577daeac1663f8ec3eadbe41d.", "committedDate": "2020-10-05T23:30:03Z", "type": "commit"}, {"oid": "b76cda41c41fa71bdcd0344e68d6bd66daee4c39", "url": "https://github.com/returntocorp/semgrep/commit/b76cda41c41fa71bdcd0344e68d6bd66daee4c39", "message": "ty bgo", "committedDate": "2020-10-05T23:31:52Z", "type": "commit"}, {"oid": "734bf601c3d4468b8e4f468279f3c88f2bba8d5d", "url": "https://github.com/returntocorp/semgrep/commit/734bf601c3d4468b8e4f468279f3c88f2bba8d5d", "message": "update tests", "committedDate": "2020-10-06T15:06:26Z", "type": "commit"}]}