{"pr_number": 853, "pr_title": "Disable program normalization (!= ==> !(==) rewriting builtin hack)", "pr_createdAt": "2020-05-28T14:30:45Z", "pr_url": "https://github.com/returntocorp/semgrep/pull/853", "timeline": [{"oid": "0300de1c7b550321eaf558c718d59afecc5e7815", "url": "https://github.com/returntocorp/semgrep/commit/0300de1c7b550321eaf558c718d59afecc5e7815", "message": "Disable program normalization (!= ==> !(==) rewriting builtin hack)\n\nThis closes issue #851\n\nThis was a hack to demo some semantic matching but it actually works\nin only one direction ... User-defined equivalences are better for that\nand are more explicit.\n\nTest plan:\ntest file included", "committedDate": "2020-05-28T14:30:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkxNTg0NQ==", "url": "https://github.com/returntocorp/semgrep/pull/853#discussion_r431915845", "bodyText": "This was only here to support Normalize_AST.normalize, so we could undo the argument. \ud83e\udd37", "author": "nbrahms", "createdAt": "2020-05-28T15:14:10Z", "path": "semgrep-core/matching/Semgrep_generic.ml", "diffHunk": "@@ -222,15 +222,22 @@ let apply_equivalences equivs any =\n (*****************************************************************************)\n \n (*s: function [[Semgrep_generic.check2]] *)\n-let check2 ~hook rules equivs file lang ast =\n+let check2 ~hook rules equivs file _lang ast =", "originalCommit": "0300de1c7b550321eaf558c718d59afecc5e7815", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM2ODAzNg==", "url": "https://github.com/returntocorp/semgrep/pull/853#discussion_r432368036", "bodyText": "Yep, except I've found a bug elsewhere that will require again this argument :)", "author": "aryx", "createdAt": "2020-05-29T09:32:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkxNTg0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkxNjgwOA==", "url": "https://github.com/returntocorp/semgrep/pull/853#discussion_r431916808", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 (* Python == is not the same than !(==) *)\n          \n          \n            \n                 (* Python != is not the same as !(==) *)", "author": "nbrahms", "createdAt": "2020-05-28T15:15:30Z", "path": "semgrep-core/tests/Test.ml", "diffHunk": "@@ -94,7 +94,13 @@ let regression_tests_for_lang files lang =\n     let rule = { R.\n       id = \"unit testing\"; pattern; message = \"\"; severity = R.Error; \n       languages = [lang] } in\n-    let equiv = [] in\n+    let equiv = \n+     (* Python == is not the same than !(==) *)", "originalCommit": "0300de1c7b550321eaf558c718d59afecc5e7815", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkyMDgwMw==", "url": "https://github.com/returntocorp/semgrep/pull/853#discussion_r431920803", "bodyText": "FWIW, I think basic_equivalences.yml already excludes Python from the rewrite. Do we still need the language check here?", "author": "nbrahms", "createdAt": "2020-05-28T15:21:01Z", "path": "semgrep-core/tests/Test.ml", "diffHunk": "@@ -94,7 +94,13 @@ let regression_tests_for_lang files lang =\n     let rule = { R.\n       id = \"unit testing\"; pattern; message = \"\"; severity = R.Error; \n       languages = [lang] } in\n-    let equiv = [] in\n+    let equiv = \n+     (* Python == is not the same than !(==) *)\n+     if lang <> Lang.Python", "originalCommit": "0300de1c7b550321eaf558c718d59afecc5e7815", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM2ODM3NQ==", "url": "https://github.com/returntocorp/semgrep/pull/853#discussion_r432368375", "bodyText": "Oh, yeah, you're right! Actually I just realized the equivalence code does not respect the languages[] field\nin the equivalence file ... I'll fix that in another diff.", "author": "aryx", "createdAt": "2020-05-29T09:32:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkyMDgwMw=="}], "type": "inlineReview"}, {"oid": "46e5d26a0beb4e6d393f524774f5b2a8ff5513fc", "url": "https://github.com/returntocorp/semgrep/commit/46e5d26a0beb4e6d393f524774f5b2a8ff5513fc", "message": "Merge branch 'develop' into remove_normalize", "committedDate": "2020-05-28T20:16:37Z", "type": "commit"}]}