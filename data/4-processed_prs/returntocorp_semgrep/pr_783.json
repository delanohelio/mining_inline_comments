{"pr_number": 783, "pr_title": "Fix get_re_matches error with deep paths", "pr_createdAt": "2020-05-19T11:40:19Z", "pr_url": "https://github.com/returntocorp/semgrep/pull/783", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzMxNDUwMw==", "url": "https://github.com/returntocorp/semgrep/pull/783#discussion_r427314503", "bodyText": "Do we want to be more general than UnicodeDecodeError here, e.g. just catch Exception and warn the user something went wrong? I took a look at the read_text docs: https://docs.python.org/3/library/pathlib.html?highlight=path#pathlib.Path.read_text and it looks like the errors kwarg can be utilized too. It looks like errors defaults to strict (makes sense here, we can't easily regex non-text contents), which will raise a ValueError if there's an encoding error. So here we got ValueError -> UnicodeError -> UnicodeDecodeError.\nGenerally, though, it's better to fail quick and loud and learn about cases we didn't consider. I'd say we should catch UnicodeDecodeError here, QA this functionality over a large corpus, look for failures, and patch this up with our learnings. Thoughts?", "author": "mschwager", "createdAt": "2020-05-19T13:45:57Z", "path": "semgrep/semgrep/core_runner.py", "diffHunk": "@@ -35,7 +35,11 @@\n \n \n def get_re_matches(patterns_re: List[Tuple], path: Path) -> List[PatternMatch]:\n-    contents = path.read_text()\n+    try:\n+        contents = path.read_text()\n+    except UnicodeDecodeError:", "originalCommit": "c9e9260b02f346027f55ab40f4389c12b7376268", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ1NDMyNw==", "url": "https://github.com/returntocorp/semgrep/pull/783#discussion_r427454327", "bodyText": "I'd leave it like this before #785 is done, and like you said, find more bugs to fix that way that would get their handling filed as new issues.", "author": "underyx", "createdAt": "2020-05-19T16:55:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzMxNDUwMw=="}], "type": "inlineReview"}, {"oid": "8ce57515468275fe734a582c449d54492f2492d5", "url": "https://github.com/returntocorp/semgrep/commit/8ce57515468275fe734a582c449d54492f2492d5", "message": "Fix get_re_matches error with deep paths\n\nCloses https://github.com/returntocorp/semgrep/issues/781", "committedDate": "2020-05-19T16:57:18Z", "type": "commit"}, {"oid": "c6c5e075d0ea114a80afef30f376f100f65004c7", "url": "https://github.com/returntocorp/semgrep/commit/c6c5e075d0ea114a80afef30f376f100f65004c7", "message": "get_re_matches: Skip binary file instead of erroring", "committedDate": "2020-05-19T16:57:18Z", "type": "commit"}, {"oid": "c6c5e075d0ea114a80afef30f376f100f65004c7", "url": "https://github.com/returntocorp/semgrep/commit/c6c5e075d0ea114a80afef30f376f100f65004c7", "message": "get_re_matches: Skip binary file instead of erroring", "committedDate": "2020-05-19T16:57:18Z", "type": "forcePushed"}]}