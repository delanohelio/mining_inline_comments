{"pr_number": 1859, "pr_title": "Use metavariable ranges", "pr_createdAt": "2020-10-19T23:37:50Z", "pr_url": "https://github.com/returntocorp/semgrep/pull/1859", "timeline": [{"oid": "13e83adced348ce63b86d2b22dd6ad77151ced7d", "url": "https://github.com/returntocorp/semgrep/commit/13e83adced348ce63b86d2b22dd6ad77151ced7d", "message": "Use metavariable ranges\n\nBefore this commit semgrep was using the abstract_context associated\nwith each metavariable assuming it was what the metavariable matched with\nthis is not always the case since the abstract context removes some concrete\nsyntax.\n\nThis PR relies on the more stable line ranges reported with the metavariable\nas the value of the metavariable.", "committedDate": "2020-10-19T23:35:52Z", "type": "commit"}, {"oid": "2716631f7965a7dd459abf585de446fd11e8d92d", "url": "https://github.com/returntocorp/semgrep/commit/2716631f7965a7dd459abf585de446fd11e8d92d", "message": "fixup! Use metavariable ranges", "committedDate": "2020-10-19T23:47:31Z", "type": "commit"}, {"oid": "3c2acd192e9a476a9128a327320d99f8eaed3730", "url": "https://github.com/returntocorp/semgrep/commit/3c2acd192e9a476a9128a327320d99f8eaed3730", "message": "Update tests", "committedDate": "2020-10-20T00:51:55Z", "type": "commit"}, {"oid": "ad494de50145e59fc8cdb15ade93e04e6473f280", "url": "https://github.com/returntocorp/semgrep/commit/ad494de50145e59fc8cdb15ade93e04e6473f280", "message": "fixup! Update tests", "committedDate": "2020-10-20T23:32:14Z", "type": "commit"}, {"oid": "24cf9fe0131347e621c53d4f63e2f403e620e7e6", "url": "https://github.com/returntocorp/semgrep/commit/24cf9fe0131347e621c53d4f63e2f403e620e7e6", "message": "fixup! fixup! Update tests", "committedDate": "2020-10-21T00:11:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA1NTAzOA==", "url": "https://github.com/returntocorp/semgrep/pull/1859#discussion_r509055038", "bodyText": "If start or end are missing as keys, we'll fail anyway, so I'll update this to [\"end\"][\"offset\"] to make the error message more clear.", "author": "underyx", "createdAt": "2020-10-21T07:38:33Z", "path": "semgrep/semgrep/pattern_match.py", "diffHunk": "@@ -63,5 +63,23 @@ def end(self) -> Dict[str, Any]:\n             del end[\"offset\"]\n         return end\n \n+    def get_metavariable_value(self, metavariable: str) -> str:\n+        \"\"\"\n+            Use metavars start and end to read into the file to find what the\n+            metavariable in this pattern match maps to in the file\n+\n+            Assumes METAVARIABLE is a key in self.metavars\n+        \"\"\"\n+        # Offsets are start inclusive and end exclusive\n+        start_offset = self.metavars[metavariable].get(\"start\").get(\"offset\")\n+        end_offset = self.metavars[metavariable].get(\"end\").get(\"offset\")", "originalCommit": "24cf9fe0131347e621c53d4f63e2f403e620e7e6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b97055950e78a163f1fac2156b5651a652684a39", "url": "https://github.com/returntocorp/semgrep/commit/b97055950e78a163f1fac2156b5651a652684a39", "message": "get_metavariable_value: Fail faster on wrong data", "committedDate": "2020-10-21T07:53:41Z", "type": "commit"}]}