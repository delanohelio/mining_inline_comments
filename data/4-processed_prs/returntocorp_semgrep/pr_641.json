{"pr_number": 641, "pr_title": "semgrep: Pass through include/exclude flags to semgrep-core (#479)", "pr_createdAt": "2020-05-01T13:23:26Z", "pr_url": "https://github.com/returntocorp/semgrep/pull/641", "timeline": [{"oid": "06307564cdae44863bffb2b960d909518d868108", "url": "https://github.com/returntocorp/semgrep/commit/06307564cdae44863bffb2b960d909518d868108", "message": "semgrep: Pass through include/exclude flags to semgrep-core (#479)\n\nCloses https://github.com/returntocorp/semgrep/issues/616\n\nAuthored-by: Bence Nagy <bence@underyx.me>\nSigned-off-by: Bence Nagy <bence@underyx.me>", "committedDate": "2020-05-01T13:26:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU1NzQ1Ng==", "url": "https://github.com/returntocorp/semgrep/pull/641#discussion_r418557456", "bodyText": "These changes are just me standardizing the order to exclude, include, exclude-dir, include-dir.", "author": "underyx", "createdAt": "2020-05-01T14:10:34Z", "path": "semgrep/semgrep/cli.py", "diffHunk": "@@ -64,23 +64,29 @@ def cli() -> None:\n     )\n \n     parser.add_argument(\n-        \"--include\",\n+        \"--exclude\",", "originalCommit": "81c9b19709446f9c87dc46c4db1af80a0e71225a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU3MTM1Mw==", "url": "https://github.com/returntocorp/semgrep/pull/641#discussion_r418571353", "bodyText": "This will not work, because include_dirs, like exclude_dirs, apply the filter to the directory component of a path,\nit's not to a prefix of a path, so here you want ~include_dirs:[\"a\"] (or ~include_dirs:[\"b\"]).\nGREP exclude dirs work like that I think.\nI know @DrewDennison wanted to change that, but then you can have issues when the path is ./a/b/c\nand if you put \"a/b\" it will not match because it's not a prefix.", "author": "aryx", "createdAt": "2020-05-01T14:41:33Z", "path": "semgrep-core/finding/unit_files.ml", "diffHunk": "@@ -15,7 +15,8 @@ let unittest =\n         let filters = Files_filter.mk_filters\n           ~excludes:[\"*.{c,h}\"; \"*.go\"]\n           ~includes:[\"foo.*\"]\n-          ~exclude_dirs:[\"c\"] in\n+          ~exclude_dirs:[\"c\"] \n+          ~include_dirs:[\"a/b\"] in", "originalCommit": "069fd85e99511699ffb294b137b18acc109dc3e8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY5NDYzOA==", "url": "https://github.com/returntocorp/semgrep/pull/641#discussion_r418694638", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    help=\"Don't scan these directories, such as --exclude-dir='tests'. Add multiple times to exclude multiple patterns.\",\n          \n          \n            \n                    help=\"Skip any directory with this name; --exclude-dir=doc will ignore doc/ as well as src/doc. Can add multiple times. Overrides includes.\",", "author": "underyx", "createdAt": "2020-05-01T19:16:08Z", "path": "semgrep/semgrep/cli.py", "diffHunk": "@@ -62,11 +62,30 @@ def cli() -> None:\n         help=f\"only invoke semgrep if config(s) are valid\",\n         action=\"store_true\",\n     )\n+\n     parser.add_argument(\n         \"--exclude\",\n         action=\"append\",\n         default=[],\n-        help=\"Path pattern to exclude. Can be added multiple times to exclude multiple patterns.\",\n+        help=\"Don't scan files with this filename, such as --exclude='*.js'. Add multiple times to exclude multiple patterns.\",\n+    )\n+    parser.add_argument(\n+        \"--include\",\n+        action=\"append\",\n+        default=[],\n+        help=\"Scan only files with this filename, such as --include='*.js'. Add multiple times to include multiple patterns.\",\n+    )\n+    parser.add_argument(\n+        \"--exclude-dir\",\n+        action=\"append\",\n+        default=[],\n+        help=\"Don't scan these directories, such as --exclude-dir='tests'. Add multiple times to exclude multiple patterns.\",", "originalCommit": "069fd85e99511699ffb294b137b18acc109dc3e8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e56e2652aecbb6347c7e2ae0e02fb68d68a572e3", "url": "https://github.com/returntocorp/semgrep/commit/e56e2652aecbb6347c7e2ae0e02fb68d68a572e3", "message": "Add include-dir flag to semgrep-core and semgrep\n\nThis was present in grep but not in semgrep.", "committedDate": "2020-05-05T19:46:48Z", "type": "forcePushed"}, {"oid": "3554bfa4b8d45d9ac60df84ca55efcbe4f3dfc20", "url": "https://github.com/returntocorp/semgrep/commit/3554bfa4b8d45d9ac60df84ca55efcbe4f3dfc20", "message": "Add include-dir flag to semgrep-core and semgrep\n\nThis was present in grep but not in semgrep.", "committedDate": "2020-05-05T19:48:23Z", "type": "forcePushed"}, {"oid": "817f6f3b3cee44cebc064a423d48b4bd235cb027", "url": "https://github.com/returntocorp/semgrep/commit/817f6f3b3cee44cebc064a423d48b4bd235cb027", "message": "Add include-dir flag to semgrep-core and semgrep\n\nThis was present in grep but not in semgrep.", "committedDate": "2020-05-05T19:49:58Z", "type": "forcePushed"}, {"oid": "69d32c472d119e0d07c7d4849cb261ec3f5da2ef", "url": "https://github.com/returntocorp/semgrep/commit/69d32c472d119e0d07c7d4849cb261ec3f5da2ef", "message": "semgrep: Pass through include/exclude flags to semgrep-core (#479)\n\nCloses https://github.com/returntocorp/semgrep/issues/616\n\nAuthored-by: Bence Nagy <bence@underyx.me>\nSigned-off-by: Bence Nagy <bence@underyx.me>", "committedDate": "2020-05-05T19:58:09Z", "type": "commit"}, {"oid": "56bfff835f806060a7d9fc99b772fe26a105f7e6", "url": "https://github.com/returntocorp/semgrep/commit/56bfff835f806060a7d9fc99b772fe26a105f7e6", "message": "Add include-dir flag to semgrep-core and semgrep\n\nThis was present in grep but not in semgrep.", "committedDate": "2020-05-05T19:58:10Z", "type": "forcePushed"}, {"oid": "c0de26bca4af3f0c379ba5d5f77e2f936f67bbd9", "url": "https://github.com/returntocorp/semgrep/commit/c0de26bca4af3f0c379ba5d5f77e2f936f67bbd9", "message": "Add include-dir flag to semgrep-core and semgrep\n\nThis was present in grep but not in semgrep.", "committedDate": "2020-05-05T20:02:41Z", "type": "forcePushed"}, {"oid": "10a6d533e78a64673b373800b1436fc84ab947d5", "url": "https://github.com/returntocorp/semgrep/commit/10a6d533e78a64673b373800b1436fc84ab947d5", "message": "Add include-dir flag to semgrep-core and semgrep\n\nThis was present in grep but not in semgrep.", "committedDate": "2020-05-05T20:03:13Z", "type": "commit"}, {"oid": "10a6d533e78a64673b373800b1436fc84ab947d5", "url": "https://github.com/returntocorp/semgrep/commit/10a6d533e78a64673b373800b1436fc84ab947d5", "message": "Add include-dir flag to semgrep-core and semgrep\n\nThis was present in grep but not in semgrep.", "committedDate": "2020-05-05T20:03:13Z", "type": "forcePushed"}, {"oid": "956b308fa9472bde9821f3a5203db8118e49d29a", "url": "https://github.com/returntocorp/semgrep/commit/956b308fa9472bde9821f3a5203db8118e49d29a", "message": "Fix changelog", "committedDate": "2020-05-05T20:46:41Z", "type": "commit"}, {"oid": "60a64d601e01e9f66006b1a60f352c9bcb6e114c", "url": "https://github.com/returntocorp/semgrep/commit/60a64d601e01e9f66006b1a60f352c9bcb6e114c", "message": "fixup! Add include-dir flag to semgrep-core and semgrep", "committedDate": "2020-05-05T22:13:14Z", "type": "commit"}, {"oid": "371d5919b920387b565454c4a8e1ba9c6c5227da", "url": "https://github.com/returntocorp/semgrep/commit/371d5919b920387b565454c4a8e1ba9c6c5227da", "message": "fixup! Add include-dir flag to semgrep-core and semgrep", "committedDate": "2020-05-05T22:34:00Z", "type": "commit"}]}