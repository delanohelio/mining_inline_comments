{"pr_number": 1369, "pr_title": "Use -timeout for the matching process and improve debugging experience", "pr_createdAt": "2020-07-27T12:29:28Z", "pr_url": "https://github.com/returntocorp/semgrep/pull/1369", "timeline": [{"oid": "2b42ef563b6b21863b0de2d44073e364e01e457f", "url": "https://github.com/returntocorp/semgrep/commit/2b42ef563b6b21863b0de2d44073e364e01e457f", "message": "Timeout not only on parsing but also matching!\n\nthis should help issue #1361\n\nTest plan:\n\npad@yrax:~/semgrep/tests/PERF$ time yy -timeout 3 -lang js -rules_file ajin2_semgrepcore.yaml three.js\n+ /home/pad/github/semgrep/semgrep-core/_build/default/bin/Main.exe -timeout 3 -lang js -rules_file ajin2_semgrepcore.yaml three.js\n{\n  \"matches\": [],\n  \"errors\": [\n    {\n      \"check_id\": \"Timeout\",\n      \"path\": \"three.js\",\n      \"start\": { \"line\": 1, \"col\": 1 },\n      \"end\": { \"line\": 1, \"col\": 1 },\n      \"extra\": { \"message\": \"Timeout\", \"line\": \"/**\" }\n    }\n  ],\n  \"stats\": { \"okfiles\": 0, \"errorfiles\": 1 }\n}\n\nreal\t0m3.366s\nuser\t0m2.999s\nsys\t0m0.353s", "committedDate": "2020-07-27T12:10:53Z", "type": "commit"}, {"oid": "0c395240a184663fc581717e90ea1668d84476b6", "url": "https://github.com/returntocorp/semgrep/commit/0c395240a184663fc581717e90ea1668d84476b6", "message": "add new SEMGREP_CORE_EXTRA environment variable\n\nIt can be difficult to debug semgrep-core when called from semgrep.\nThis diff adds the option to add extra argument to the invocation\nof semgrep_core from anywhere (especially from the semgrep python wrapper)\nto turn on and off semgrep core flags (especially debugging flags).\n\nTest plan:\nyou need to modify core_runner.py which does not yet support\nthe -no-redirect-stderr option and write\n  core_run = sub_run(cmd, stdout=subprocess.PIPE\n\nthen:\n\n(semgrep) pad@yrax:~/semgrep/tests/PERF$ export SEMGREP_CORE_EXTRA='-max_memory 1 -timeout 3 -debug'\n(semgrep) pad@yrax:~/semgrep/tests/PERF$ semgrep -f ajin2.yaml three.js\nrunning 2 rules...\n  0%|                                                                                                                                                    |0/2Debug mode On\nExecuted as: semgrep-core -lang javascript -rules_file /tmp/tmpdi_o9tzg -j 8 -target_file /tmp/tmp_kwylvia -use_parsing_cache /tmp/tmpagptv9io\nPARSING: three.js\nreturned JSON: {\n  \"matches\": [],\n  \"errors\": [\n    {\n      \"check_id\": \"OutOfMemory\",\n      \"path\": \"three.js\",\n      \"start\": { \"line\": 1, \"col\": 1 },\n      \"end\": { \"line\": 1, \"col\": 1 },\n      \"extra\": { \"message\": \"Out of memory\", \"line\": \"/**\" }\n    }\n  ],\n  \"stats\": { \"okfiles\": 0, \"errorfiles\": 1 }\n}\n...", "committedDate": "2020-07-27T12:28:09Z", "type": "commit"}, {"oid": "c5f01f0495611475fb5c5a42163e1c613faa434e", "url": "https://github.com/returntocorp/semgrep/commit/c5f01f0495611475fb5c5a42163e1c613faa434e", "message": "Remove -verbose, consistently use -debug\n\nYou are not supposed to call semgrep-core directly, so any extra\ninformation is really about helping the debugging the process, not\nabout improving the output.\n\nTest plan:\nmeh", "committedDate": "2020-07-27T12:45:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA4MzUwNA==", "url": "https://github.com/returntocorp/semgrep/pull/1369#discussion_r461083504", "bodyText": "is it a flag? a mode to run the test suite? what is its semantic effect? perhaps a more descriptive name would be helpful", "author": "ievans", "createdAt": "2020-07-27T18:23:44Z", "path": "semgrep-core/bin/Main.ml", "diffHunk": "@@ -55,16 +55,16 @@ module J = Json_type\n let env_debug = \"SEMGREP_CORE_DEBUG\"\n let env_profile = \"SEMGREP_CORE_PROFILE\"\n \n+(* see also verbose/... flags in Flag_semgrep.ml *)\n+(* to test things *)\n+let test = ref false", "originalCommit": "c5f01f0495611475fb5c5a42163e1c613faa434e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}