{"pr_number": 2857, "pr_title": "[DROOLS-5237] Wrong property reactivity with non getter chain of non-\u2026", "pr_createdAt": "2020-04-16T03:37:14Z", "pr_url": "https://github.com/kiegroup/drools/pull/2857", "timeline": [{"oid": "a7baecdcd0aabc2c6554fdee65a9321692c19f62", "url": "https://github.com/kiegroup/drools/commit/a7baecdcd0aabc2c6554fdee65a9321692c19f62", "message": "[DROOLS-5237] Wrong property reactivity with non getter chain of non-direct statements", "committedDate": "2020-04-16T05:22:12Z", "type": "commit"}, {"oid": "a7baecdcd0aabc2c6554fdee65a9321692c19f62", "url": "https://github.com/kiegroup/drools/commit/a7baecdcd0aabc2c6554fdee65a9321692c19f62", "message": "[DROOLS-5237] Wrong property reactivity with non getter chain of non-direct statements", "committedDate": "2020-04-16T05:22:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTMyMDg0Mg==", "url": "https://github.com/kiegroup/drools/pull/2857#discussion_r409320842", "bodyText": "Similar to standard-drl, we want to evaluate only direct statements.\nFor example, assuming you have\n{\n    System.out.println(\"name.length = \" + $p.getName().length());\n    modify($p) { setAge(41) };\n}\n\nin RHS. findModifiedProperties() takes various MethodCallExpr as methodCallExprs.\n\nSystem.out.println(\"name.length = \" + $p.getName().length())\n$p.getName().length()\n$p.getName()\n($p).setAge(41)\n\nHowever, what we want to parse are, only direct statements.\n\nSystem.out.println(\"name.length = \" + $p.getName().length())\n($p).setAge(41)\n\nThen, System.out.println(\"name.length = \" + $p.getName().length()) is not accepted because scope is not $p.\nThen, only \"age\" is parsed as modified property.", "author": "tkobayas", "createdAt": "2020-04-16T06:51:35Z", "path": "drools-model/drools-model-compiler/src/main/java/org/drools/modelcompiler/builder/generator/Consequence.java", "diffHunk": "@@ -425,6 +428,10 @@ private AssignExpr createBitMaskField(String updatedVar, MethodCallExpr bitMaskC\n         return modifiedProps;\n     }\n \n+    private boolean isDirectExpression(MethodCallExpr methodCall) {\n+        return methodCall.getParentNode().map(parent -> parent instanceof ExpressionStmt).orElse(false);", "originalCommit": "a7baecdcd0aabc2c6554fdee65a9321692c19f62", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}