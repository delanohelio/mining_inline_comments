{"pr_number": 1047, "pr_title": "TSK-1197: readded test case for testing the ordering of the databases\u2026", "pr_createdAt": "2020-05-04T13:22:37Z", "pr_url": "https://github.com/Taskana/taskana/pull/1047", "timeline": [{"oid": "cb4450c87c75e6bdee293c502ac203f8fdcb3862", "url": "https://github.com/Taskana/taskana/commit/cb4450c87c75e6bdee293c502ac203f8fdcb3862", "message": "TSK-1197: readded test case for testing the ordering of the databases H2, Postgress and DB2; remove Db2 10.5 travis job\nTSK-1197: build Postgres image with german collation", "committedDate": "2020-05-04T13:16:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwNjY5Mw==", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419506693", "bodyText": "FROM postgres:10 ;)", "author": "mustaphazorgati", "createdAt": "2020-05-04T15:06:17Z", "path": "ci/Dockerfile", "diffHunk": "@@ -0,0 +1,3 @@\n+FROM postgres:10.4", "originalCommit": "cb4450c87c75e6bdee293c502ac203f8fdcb3862", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwNjkwMQ==", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419506901", "bodyText": "taskana-postgres_10 please ;)", "author": "mustaphazorgati", "createdAt": "2020-05-04T15:06:32Z", "path": "ci/docker-compose.yml", "diffHunk": "@@ -0,0 +1,9 @@\n+version: '3'\n+services:\n+  taskana-postgres_10_4:", "originalCommit": "cb4450c87c75e6bdee293c502ac203f8fdcb3862", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwNzU0NA==", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419507544", "bodyText": "please move this to\nenv.global", "author": "mustaphazorgati", "createdAt": "2020-05-04T15:07:27Z", "path": ".travis.yml", "diffHunk": "@@ -53,9 +52,17 @@ jobs:\n       language: node_js\n       node_js: $NODE_VERSION\n       install: skip\n-      env: DB=WEB\n+      env: \n+        - DB=WEB\n+        - DOCKER_COMPOSE_VERSION=1.4.2", "originalCommit": "cb4450c87c75e6bdee293c502ac203f8fdcb3862", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwOTM1OA==", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419509358", "bodyText": "I think this is wrong.\nPlease insert this in the install phase of the Test-matrix phase (replace install: skip from line 45 with this.`)", "author": "mustaphazorgati", "createdAt": "2020-05-04T15:10:01Z", "path": ".travis.yml", "diffHunk": "@@ -53,9 +52,17 @@ jobs:\n       language: node_js\n       node_js: $NODE_VERSION\n       install: skip\n-      env: DB=WEB\n+      env: \n+        - DB=WEB\n+        - DOCKER_COMPOSE_VERSION=1.4.2\n       script: ci/test.sh \"$DB\"\n       before_cache: rm -rf \"$HOME/.m2/repository/pro/taskana\"\n+      before_install:", "originalCommit": "cb4450c87c75e6bdee293c502ac203f8fdcb3862", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwOTc3NA==", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419509774", "bodyText": "Please concat these statements with && to implement lazy evaluation. (so that the step will not be executed when the previous one exits with != 0)", "author": "mustaphazorgati", "createdAt": "2020-05-04T15:10:39Z", "path": ".travis.yml", "diffHunk": "@@ -53,9 +52,17 @@ jobs:\n       language: node_js\n       node_js: $NODE_VERSION\n       install: skip\n-      env: DB=WEB\n+      env: \n+        - DB=WEB\n+        - DOCKER_COMPOSE_VERSION=1.4.2\n       script: ci/test.sh \"$DB\"\n       before_cache: rm -rf \"$HOME/.m2/repository/pro/taskana\"\n+      before_install:\n+        - sudo rm /usr/local/bin/docker-compose\n+        - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose\n+        - chmod +x docker-compose\n+        - sudo mv docker-compose /usr/local/bin", "originalCommit": "cb4450c87c75e6bdee293c502ac203f8fdcb3862", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0NjkxNw==", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419546917", "bodyText": "there is no need for this seperation anymore. docker-compose up -d recreates the container if already existing.", "author": "mustaphazorgati", "createdAt": "2020-05-04T16:03:07Z", "path": "ci/prepare_db.bat", "diffHunk": "@@ -107,13 +107,17 @@ SET PROP_FILE=%HOMEPATH%\\taskanaUnitTest.properties\n     del %TEMP%\\temp\n \n     IF DEFINED CONTAINER_EXISTS (\n-        ECHO docker start taskana-postgres_10_4\n-        docker start taskana-postgres_10_4\n+        REM ECHO docker start taskana-postgres_10_4\n+        REM docker start taskana-postgres_10_4\n+        ECHO docker-compose -f %~dp0/docker-compose.yml start taskana-postgres_10_4\n+        docker-compose -f %~dp0/docker-compose.yml start taskana-postgres_10_4\n     )\n \n     IF NOT DEFINED CONTAINER_EXISTS (\n-        ECHO docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n-        docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n+        REM ECHO docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n+        REM docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n+        ECHO docker-compose -f %~dp0/docker-compose.yml up -d\n+        docker-compose -f %~dp0/docker-compose.yml up -d", "originalCommit": "cb4450c87c75e6bdee293c502ac203f8fdcb3862", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0NzEzMg==", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419547132", "bodyText": "I just started a polly.. Maybe this file is not needed anymore. Let's wait for the feedback in #taskana.", "author": "mustaphazorgati", "createdAt": "2020-05-04T16:03:28Z", "path": "ci/prepare_db.bat", "diffHunk": "@@ -107,13 +107,17 @@ SET PROP_FILE=%HOMEPATH%\\taskanaUnitTest.properties\n     del %TEMP%\\temp\n \n     IF DEFINED CONTAINER_EXISTS (\n-        ECHO docker start taskana-postgres_10_4\n-        docker start taskana-postgres_10_4\n+        REM ECHO docker start taskana-postgres_10_4\n+        REM docker start taskana-postgres_10_4\n+        ECHO docker-compose -f %~dp0/docker-compose.yml start taskana-postgres_10_4\n+        docker-compose -f %~dp0/docker-compose.yml start taskana-postgres_10_4\n     )\n \n     IF NOT DEFINED CONTAINER_EXISTS (\n-        ECHO docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n-        docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n+        REM ECHO docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n+        REM docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n+        ECHO docker-compose -f %~dp0/docker-compose.yml up -d\n+        docker-compose -f %~dp0/docker-compose.yml up -d\n     )\n \n     ECHO jdbcDriver=org.postgresql.Driver> %PROP_FILE%", "originalCommit": "cb4450c87c75e6bdee293c502ac203f8fdcb3862", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg4NjY4OA==", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419886688", "bodyText": "\ud83d\udc4d", "author": "sfrevel", "createdAt": "2020-05-05T06:22:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0NzEzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0Nzc5OQ==", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419547799", "bodyText": "please rename this to POSTGRES_10", "author": "mustaphazorgati", "createdAt": "2020-05-04T16:04:25Z", "path": "ci/prepare_db.sh", "diffHunk": "@@ -63,9 +63,9 @@ function main() {\n   POSTGRES_10_4)", "originalCommit": "cb4450c87c75e6bdee293c502ac203f8fdcb3862", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0ODE5OA==", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419548198", "bodyText": "no need to differentiate anymore. docker-compose up -d is enough. See comment above", "author": "mustaphazorgati", "createdAt": "2020-05-04T16:04:59Z", "path": "ci/prepare_db.sh", "diffHunk": "@@ -63,9 +63,9 @@ function main() {\n   POSTGRES_10_4)\n     if [[ -z $(docker ps -aq -f name=^/taskana-postgres_10_4$ -f status=running) ]]; then\n       if [[ -z $(docker ps -aq -f name=^/taskana-postgres_10_4$) ]]; then\n-        docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n+\t\t docker-compose -f `dirname $0`/docker-compose.yml up -d\n       else\n-        docker start taskana-postgres_10_4\n+\t\tdocker-compose -f `dirname $0`/docker-compose.yml start taskana-postgres_10_4\n       fi\n     fi", "originalCommit": "cb4450c87c75e6bdee293c502ac203f8fdcb3862", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0ODgyNA==", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419548824", "bodyText": "I am a big fan of making an extra variable for dirname $0. But you don't have to ;)", "author": "mustaphazorgati", "createdAt": "2020-05-04T16:05:58Z", "path": "ci/prepare_db.sh", "diffHunk": "@@ -63,9 +63,9 @@ function main() {\n   POSTGRES_10_4)\n     if [[ -z $(docker ps -aq -f name=^/taskana-postgres_10_4$ -f status=running) ]]; then\n       if [[ -z $(docker ps -aq -f name=^/taskana-postgres_10_4$) ]]; then\n-        docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n+\t\t docker-compose -f `dirname $0`/docker-compose.yml up -d\n       else\n-        docker start taskana-postgres_10_4", "originalCommit": "cb4450c87c75e6bdee293c502ac203f8fdcb3862", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0OTQ1NA==", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419549454", "bodyText": "This looks like a big code smell due to the dependency to the database locale.\nTicket?", "author": "mustaphazorgati", "createdAt": "2020-05-04T16:06:49Z", "path": "lib/taskana-core/src/main/java/pro/taskana/task/internal/TaskServiceImpl.java", "diffHunk": "@@ -261,7 +261,7 @@ public Task createTask(Task taskToCreate)\n         // primary key violation: \"UC_EXTERNAL_ID_INDEX_2 ON TASKANA.TASK(EXTERNAL_ID) ...\n         String msg = e.getMessage() != null ? e.getMessage().toLowerCase() : null;\n         if (msg != null\n-            && (msg.contains(\"violation\") || msg.contains(\"violates\"))\n+            && (msg.contains(\"violation\") || msg.contains(\"violates\") || msg.contains(\"verletzt\"))", "originalCommit": "cb4450c87c75e6bdee293c502ac203f8fdcb3862", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg4NDA2Mw==", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419884063", "bodyText": "Yes I also think a ticket would be great. Maybe there is a way to get this done in a better way. I always thought that all DBs have an explicit \"UniqueContraintViolation\" exception. It seems that is not the case and therefore this workaround is implemented.", "author": "sfrevel", "createdAt": "2020-05-05T06:15:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0OTQ1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA1MzUzNw==", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r420053537", "bodyText": "did you create the ticket?", "author": "mustaphazorgati", "createdAt": "2020-05-05T11:57:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0OTQ1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA4MDQ0Nw==", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r420080447", "bodyText": "Yes, now i did ;D\nhttps://taskana.atlassian.net/browse/TSK-1231", "author": "sfrevel", "createdAt": "2020-05-05T12:46:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0OTQ1NA=="}], "type": "inlineReview"}, {"oid": "fb1182370436c9ee20af28dd162cd58c57172d8c", "url": "https://github.com/Taskana/taskana/commit/fb1182370436c9ee20af28dd162cd58c57172d8c", "message": "TSK-1197: use only postgres:10 tag; use only docker compose up; clean up docker compose installation for travis\n\nTSK-1197: moved docker-compose install to the right place; fixed variable definition\n\nTSK-1197: remove docker-compose installation, use preinstalled travis version\n\nTSK-1197: harmonize postgres db version parameter in scripts preparedb and test.sh\n\nTSK-1197: removed DB2_10_5 handling from scripts", "committedDate": "2020-05-05T13:04:16Z", "type": "commit"}, {"oid": "fb1182370436c9ee20af28dd162cd58c57172d8c", "url": "https://github.com/Taskana/taskana/commit/fb1182370436c9ee20af28dd162cd58c57172d8c", "message": "TSK-1197: use only postgres:10 tag; use only docker compose up; clean up docker compose installation for travis\n\nTSK-1197: moved docker-compose install to the right place; fixed variable definition\n\nTSK-1197: remove docker-compose installation, use preinstalled travis version\n\nTSK-1197: harmonize postgres db version parameter in scripts preparedb and test.sh\n\nTSK-1197: removed DB2_10_5 handling from scripts", "committedDate": "2020-05-05T13:04:16Z", "type": "forcePushed"}]}