{"pr_number": 1171, "pr_title": "TSK-1331: allowed multiple sortBy declarations in REST api", "pr_createdAt": "2020-07-10T08:32:02Z", "pr_url": "https://github.com/Taskana/taskana/pull/1171", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjcwNzU2NQ==", "url": "https://github.com/Taskana/taskana/pull/1171#discussion_r452707565", "bodyText": "I don't like this name.\nAny suggestion?\nI'd love to expand this class in the future by adding e.g. the extraction of paging here, etc.", "author": "mustaphazorgati", "createdAt": "2020-07-10T08:42:45Z", "path": "rest/taskana-rest-spring/src/main/java/pro/taskana/common/rest/QueryHelper.java", "diffHunk": "@@ -0,0 +1,80 @@\n+package pro.taskana.common.rest;\n+\n+import java.util.List;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.util.MultiValueMap;\n+\n+import pro.taskana.common.api.BaseQuery.SortDirection;\n+import pro.taskana.common.api.exceptions.InvalidArgumentException;\n+import pro.taskana.common.internal.util.CheckedBiConsumer;\n+\n+public class QueryHelper {", "originalCommit": "220a2740e67b8b05d80ee53c0632c04e9311b89e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjcxMzkyNQ==", "url": "https://github.com/Taskana/taskana/pull/1171#discussion_r452713925", "bodyText": "What's wrong with the name? Maybe we should discuss this if you have concerns.", "author": "holgerhagen", "createdAt": "2020-07-10T08:54:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjcwNzU2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjcwNzYzMg==", "url": "https://github.com/Taskana/taskana/pull/1171#discussion_r452707632", "bodyText": "This package ok?", "author": "mustaphazorgati", "createdAt": "2020-07-10T08:42:51Z", "path": "rest/taskana-rest-spring/src/main/java/pro/taskana/common/rest/QueryHelper.java", "diffHunk": "@@ -0,0 +1,80 @@\n+package pro.taskana.common.rest;", "originalCommit": "220a2740e67b8b05d80ee53c0632c04e9311b89e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjcxMzQxMA==", "url": "https://github.com/Taskana/taskana/pull/1171#discussion_r452713410", "bodyText": "This package is part of the public API, isn't it? I don't think that the QueryHelper belongs to the public API.", "author": "holgerhagen", "createdAt": "2020-07-10T08:53:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjcwNzYzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjcxMTY4Mw==", "url": "https://github.com/Taskana/taskana/pull/1171#discussion_r452711683", "bodyText": "According to clean code it is a good practice to return the changed value, even if you don't have to do it. What do you think?", "author": "holgerhagen", "createdAt": "2020-07-10T08:50:42Z", "path": "history/taskana-simplehistory-rest-spring/src/main/java/pro/taskana/simplehistory/rest/TaskHistoryEventController.java", "diffHunk": "@@ -152,7 +109,7 @@ public TaskHistoryEventController(\n     }\n \n     HistoryQuery query = simpleHistoryService.createHistoryQuery();\n-    query = applySortingParams(query, params);", "originalCommit": "220a2740e67b8b05d80ee53c0632c04e9311b89e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjcxMjM5MQ==", "url": "https://github.com/Taskana/taskana/pull/1171#discussion_r452712391", "bodyText": "Do we have a rule in the coding guideline with respect to naming variables?", "author": "holgerhagen", "createdAt": "2020-07-10T08:52:07Z", "path": "rest/taskana-rest-spring/src/main/java/pro/taskana/classification/rest/ClassificationController.java", "diffHunk": "@@ -48,56 +49,33 @@\n   private static final Logger LOGGER = LoggerFactory.getLogger(ClassificationController.class);\n \n   private static final String LIKE = \"%\";\n-\n   private static final String NAME = \"name\";\n-\n   private static final String NAME_LIKE = \"name-like\";\n-\n   private static final String KEY = \"key\";\n-\n   private static final String DOMAIN = \"domain\";\n-\n   private static final String CATEGORY = \"category\";\n-\n   private static final String TYPE = \"type\";\n-\n   private static final String CUSTOM_1_LIKE = \"custom-1-like\";\n-\n   private static final String CUSTOM_2_LIKE = \"custom-2-like\";\n-\n   private static final String CUSTOM_3_LIKE = \"custom-3-like\";\n-\n   private static final String CUSTOM_4_LIKE = \"custom-4-like\";\n-\n   private static final String CUSTOM_5_LIKE = \"custom-5-like\";\n-\n   private static final String CUSTOM_6_LIKE = \"custom-6-like\";\n-\n   private static final String CUSTOM_7_LIKE = \"custom-7-like\";\n-\n   private static final String CUSTOM_8_LIKE = \"custom-8-like\";\n \n-  private static final String SORT_BY = \"sort-by\";\n-\n-  private static final String SORT_DIRECTION = \"order\";\n-\n   private final ClassificationService classificationService;\n+  private final ClassificationRepresentationModelAssembler modelAssembler;", "originalCommit": "220a2740e67b8b05d80ee53c0632c04e9311b89e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjczODg5NA==", "url": "https://github.com/Taskana/taskana/pull/1171#discussion_r452738894", "bodyText": "cop?", "author": "mustaphazorgati", "createdAt": "2020-07-10T09:42:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjcxMjM5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjcxNDgwOA==", "url": "https://github.com/Taskana/taskana/pull/1171#discussion_r452714808", "bodyText": "don't we have a default for order by?", "author": "holgerhagen", "createdAt": "2020-07-10T08:56:06Z", "path": "rest/taskana-rest-spring/src/main/java/pro/taskana/common/rest/QueryHelper.java", "diffHunk": "@@ -0,0 +1,80 @@\n+package pro.taskana.common.rest;\n+\n+import java.util.List;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.util.MultiValueMap;\n+\n+import pro.taskana.common.api.BaseQuery.SortDirection;\n+import pro.taskana.common.api.exceptions.InvalidArgumentException;\n+import pro.taskana.common.internal.util.CheckedBiConsumer;\n+\n+public class QueryHelper {\n+\n+  public static final String SORT_BY = \"sort-by\";\n+  public static final String ORDER_DIRECTION = \"order\";\n+  private static final Logger LOGGER = LoggerFactory.getLogger(QueryHelper.class);\n+\n+  private QueryHelper() {\n+    // no op\n+  }\n+\n+  public static void applyAndRemoveSortingParams(\n+      MultiValueMap<String, String> params,\n+      CheckedBiConsumer<String, SortDirection, InvalidArgumentException> consumer)\n+      throws InvalidArgumentException {\n+    if (LOGGER.isDebugEnabled()) {\n+      LOGGER.debug(\"Entry to applyAndRemoveSortingParams(params= {})\", params);\n+    }\n+\n+    if (params == null || consumer == null) {\n+      throw new InvalidArgumentException(\"params or consumer can't be null!\");\n+    }\n+    List<String> allSortBy = params.remove(SORT_BY);\n+    List<String> allOrderBy = params.remove(ORDER_DIRECTION);\n+\n+    verifyNotOnlyOrderByExists(allSortBy, allOrderBy);\n+    verifyAmountOfSortByAndOrderByMatches(allSortBy, allOrderBy);\n+\n+    if (allSortBy != null) {\n+      for (int i = 0; i < allSortBy.size(); i++) {\n+        consumer.accept(allSortBy.get(i), getSortDirectionForIndex(allOrderBy, i));\n+      }\n+    }\n+    if (LOGGER.isDebugEnabled()) {\n+      LOGGER.debug(\"Exit from applyAndRemoveSortingParams()\");\n+    }\n+  }\n+\n+  private static SortDirection getSortDirectionForIndex(List<String> allOrderBy, int i) {\n+    SortDirection sortDirection = SortDirection.ASCENDING;\n+    if (allOrderBy != null && !allOrderBy.isEmpty() && \"desc\".equalsIgnoreCase(allOrderBy.get(i))) {\n+      sortDirection = SortDirection.DESCENDING;\n+    }\n+    return sortDirection;\n+  }\n+\n+  private static void verifyNotOnlyOrderByExists(List<String> allSortBy, List<String> allOrderBy)\n+      throws InvalidArgumentException {\n+    if (allSortBy == null && allOrderBy != null) {\n+      throw new InvalidArgumentException(", "originalCommit": "220a2740e67b8b05d80ee53c0632c04e9311b89e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjcxNDkzMw==", "url": "https://github.com/Taskana/taskana/pull/1171#discussion_r452714933", "bodyText": "see above", "author": "holgerhagen", "createdAt": "2020-07-10T08:56:21Z", "path": "rest/taskana-rest-spring/src/main/java/pro/taskana/common/rest/QueryHelper.java", "diffHunk": "@@ -0,0 +1,80 @@\n+package pro.taskana.common.rest;\n+\n+import java.util.List;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.util.MultiValueMap;\n+\n+import pro.taskana.common.api.BaseQuery.SortDirection;\n+import pro.taskana.common.api.exceptions.InvalidArgumentException;\n+import pro.taskana.common.internal.util.CheckedBiConsumer;\n+\n+public class QueryHelper {\n+\n+  public static final String SORT_BY = \"sort-by\";\n+  public static final String ORDER_DIRECTION = \"order\";\n+  private static final Logger LOGGER = LoggerFactory.getLogger(QueryHelper.class);\n+\n+  private QueryHelper() {\n+    // no op\n+  }\n+\n+  public static void applyAndRemoveSortingParams(\n+      MultiValueMap<String, String> params,\n+      CheckedBiConsumer<String, SortDirection, InvalidArgumentException> consumer)\n+      throws InvalidArgumentException {\n+    if (LOGGER.isDebugEnabled()) {\n+      LOGGER.debug(\"Entry to applyAndRemoveSortingParams(params= {})\", params);\n+    }\n+\n+    if (params == null || consumer == null) {\n+      throw new InvalidArgumentException(\"params or consumer can't be null!\");\n+    }\n+    List<String> allSortBy = params.remove(SORT_BY);\n+    List<String> allOrderBy = params.remove(ORDER_DIRECTION);\n+\n+    verifyNotOnlyOrderByExists(allSortBy, allOrderBy);\n+    verifyAmountOfSortByAndOrderByMatches(allSortBy, allOrderBy);\n+\n+    if (allSortBy != null) {\n+      for (int i = 0; i < allSortBy.size(); i++) {\n+        consumer.accept(allSortBy.get(i), getSortDirectionForIndex(allOrderBy, i));\n+      }\n+    }\n+    if (LOGGER.isDebugEnabled()) {\n+      LOGGER.debug(\"Exit from applyAndRemoveSortingParams()\");\n+    }\n+  }\n+\n+  private static SortDirection getSortDirectionForIndex(List<String> allOrderBy, int i) {\n+    SortDirection sortDirection = SortDirection.ASCENDING;\n+    if (allOrderBy != null && !allOrderBy.isEmpty() && \"desc\".equalsIgnoreCase(allOrderBy.get(i))) {\n+      sortDirection = SortDirection.DESCENDING;\n+    }\n+    return sortDirection;\n+  }\n+\n+  private static void verifyNotOnlyOrderByExists(List<String> allSortBy, List<String> allOrderBy)\n+      throws InvalidArgumentException {\n+    if (allSortBy == null && allOrderBy != null) {\n+      throw new InvalidArgumentException(\n+          String.format(\n+              \"Only '%s' were provided. Please also provide '%s' parameter(s)\",\n+              ORDER_DIRECTION, SORT_BY));\n+    }\n+  }\n+\n+  private static void verifyAmountOfSortByAndOrderByMatches(", "originalCommit": "220a2740e67b8b05d80ee53c0632c04e9311b89e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjcxNjE2Mw==", "url": "https://github.com/Taskana/taskana/pull/1171#discussion_r452716163", "bodyText": "Don't we sort on the dababase?", "author": "holgerhagen", "createdAt": "2020-07-10T08:58:33Z", "path": "rest/taskana-rest-spring/src/main/java/pro/taskana/task/rest/TaskCommentController.java", "diffHunk": "@@ -201,45 +201,35 @@\n     return result;\n   }\n \n-  private List<TaskComment> applySortingParams(\n+  private void applySortingParams(\n       List<TaskComment> taskComments, MultiValueMap<String, String> params)\n       throws InvalidArgumentException {\n-\n     if (LOGGER.isDebugEnabled()) {\n       LOGGER.debug(\n           \"Entry to applySortingParams(taskComments= {}, params= {})\", taskComments, params);\n     }\n-\n-    String sortBy = params.getFirst(SORT_BY);\n-\n-    if (sortBy != null) {\n-\n-      switch (sortBy) {\n-        case (CREATED):\n-          if (params.getFirst(SORT_DIRECTION) != null\n-              && \"desc\".equals(params.getFirst(SORT_DIRECTION))) {\n-            taskComments.sort(Comparator.comparing(TaskComment::getCreated).reversed());\n-          } else {\n-            taskComments.sort(Comparator.comparing(TaskComment::getCreated));\n+    QueryHelper.applyAndRemoveSortingParams(\n+        params,\n+        (sortBy, sortDirection) -> {\n+          Comparator<TaskComment> comparator;", "originalCommit": "220a2740e67b8b05d80ee53c0632c04e9311b89e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjcxNzA3OA==", "url": "https://github.com/Taskana/taskana/pull/1171#discussion_r452717078", "bodyText": "What is the meaning of this name?", "author": "holgerhagen", "createdAt": "2020-07-10T09:00:06Z", "path": "lib/taskana-core/src/main/java/pro/taskana/common/internal/util/CheckedBiConsumer.java", "diffHunk": "@@ -0,0 +1,8 @@\n+package pro.taskana.common.internal.util;\n+\n+@FunctionalInterface\n+public interface CheckedBiConsumer<T, U, E extends Throwable> {", "originalCommit": "220a2740e67b8b05d80ee53c0632c04e9311b89e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8b0eef58aa2ad748b4e1e2db98810b4933ed6c58", "url": "https://github.com/Taskana/taskana/commit/8b0eef58aa2ad748b4e1e2db98810b4933ed6c58", "message": "TSK-1331: allowed multiple sortBy declarations in REST api", "committedDate": "2020-07-10T11:59:05Z", "type": "commit"}]}