{"pr_number": 1159, "pr_title": "TSK-1253: Prevent LDAP injection.", "pr_createdAt": "2020-07-01T12:33:03Z", "pr_url": "https://github.com/Taskana/taskana/pull/1159", "timeline": [{"oid": "3f0b65182672711523570e54faa384a1ce772006", "url": "https://github.com/Taskana/taskana/commit/3f0b65182672711523570e54faa384a1ce772006", "message": "TSK-1253: Prevent LDAP injection.", "committedDate": "2020-07-01T12:19:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMzOTUyNA==", "url": "https://github.com/Taskana/taskana/pull/1159#discussion_r448339524", "bodyText": "what happens if the accessId is already a full dn? Do we have a test for this case?", "author": "mustaphazorgati", "createdAt": "2020-07-01T12:49:12Z", "path": "rest/taskana-rest-spring/src/main/java/pro/taskana/common/rest/ldap/LdapClient.java", "diffHunk": "@@ -191,7 +191,18 @@ public AccessIdRepresentationModel searchGroupByDn(final String name) {\n \n     final AndFilter andFilter = new AndFilter();\n     andFilter.and(new EqualsFilter(getGroupSearchFilterName(), getGroupSearchFilterValue()));\n-    andFilter.and(new LikeFilter(getGroupsOfUser(), \"*\" + accessId + \"*\"));\n+    final OrFilter orFilter = new OrFilter();\n+    orFilter.or(new EqualsFilter(getGroupsOfUser(), accessId));\n+    orFilter.or(\n+        new EqualsFilter(\n+            getGroupsOfUser(),\n+            LdapNameBuilder.newInstance()\n+                .add(getBaseDn())\n+                .add(getUserSearchBase())\n+                .add(\"uid\", accessId)", "originalCommit": "3f0b65182672711523570e54faa384a1ce772006", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM0OTg3Ng==", "url": "https://github.com/Taskana/taskana/pull/1159#discussion_r448349876", "bodyText": "It could be either a full dn, then \"orFilter.or(new EqualsFilter(getGroupsOfUser(), accessId))\" applies, or it is a userid, then this case applies.", "author": "holgerhagen", "createdAt": "2020-07-01T13:07:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMzOTUyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYyOTk3Mw==", "url": "https://github.com/Taskana/taskana/pull/1159#discussion_r448629973", "bodyText": "I don't see a matching test for that.", "author": "mustaphazorgati", "createdAt": "2020-07-01T21:38:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMzOTUyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODgxNzg3NA==", "url": "https://github.com/Taskana/taskana/pull/1159#discussion_r448817874", "bodyText": "This test already exists:\nAccessIdControllerIntTest::should_returnAccessIdsOfGroupsTheAccessIdIsMemberOf_ifAccessIdOfGroupIsGiven", "author": "holgerhagen", "createdAt": "2020-07-02T07:58:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMzOTUyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODgyNTg2Mw==", "url": "https://github.com/Taskana/taskana/pull/1159#discussion_r448825863", "bodyText": "ok :) Missed that. Thanks", "author": "mustaphazorgati", "createdAt": "2020-07-02T08:11:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMzOTUyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM0MTAyMg==", "url": "https://github.com/Taskana/taskana/pull/1159#discussion_r448341022", "bodyText": "Sorry \ud83d\ude05 : I don't understand the test name.\nWhat in ksc-teamleads,cn=groups is invalid?", "author": "mustaphazorgati", "createdAt": "2020-07-01T12:51:52Z", "path": "rest/taskana-rest-spring/src/test/java/pro/taskana/common/rest/AccessIdControllerIntTest.java", "diffHunk": "@@ -61,6 +61,17 @@ void testQueryGroupsByCn() {\n         .containsExactly(\"cn=ksc-users,cn=groups,OU=Test,O=TASKANA\");\n   }\n \n+  @Test\n+  void should_returnEmptyResults_ifInvalidCharacterIsUsedInCondition() {", "originalCommit": "3f0b65182672711523570e54faa384a1ce772006", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM1MDY4Nw==", "url": "https://github.com/Taskana/taskana/pull/1159#discussion_r448350687", "bodyText": "It is supposed to be a cn and nothing more. LDAP injection aims to prevent, that you can change the search path implictly, as I try in this case.", "author": "holgerhagen", "createdAt": "2020-07-01T13:08:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM0MTAyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzMDIwMw==", "url": "https://github.com/Taskana/taskana/pull/1159#discussion_r448630203", "bodyText": "thanks! :)", "author": "mustaphazorgati", "createdAt": "2020-07-01T21:39:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM0MTAyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM0MTQ5OQ==", "url": "https://github.com/Taskana/taskana/pull/1159#discussion_r448341499", "bodyText": "Does this test make sense? You want to test something within the LdapClient, but the exception is thrown in the AccessIdController. Thus this test only tests that getGroupsByAccessId is called with a valid accessId", "author": "mustaphazorgati", "createdAt": "2020-07-01T12:52:41Z", "path": "rest/taskana-rest-spring/src/test/java/pro/taskana/common/rest/AccessIdControllerIntTest.java", "diffHunk": "@@ -128,6 +139,23 @@ void should_returnAccessIdsOfGroupsTheAccessIdIsMemberOf_ifAccessIdOfUserIsGiven\n                 + \"cn=Organisationseinheit KSC,cn=organisation,OU=Test,O=TASKANA\");\n   }\n \n+  @Test\n+  void should_returnBadRequest_ifAccessIdOfUserContainsInvalidCharacter() {", "originalCommit": "3f0b65182672711523570e54faa384a1ce772006", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM1NDI2NA==", "url": "https://github.com/Taskana/taskana/pull/1159#discussion_r448354264", "bodyText": "This makes sense in case we do a refactoring. In the end, the test makes sure that this case is correctly handled, regardless the way we do it...\nOk for you?", "author": "holgerhagen", "createdAt": "2020-07-01T13:14:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM0MTQ5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzMDEzNg==", "url": "https://github.com/Taskana/taskana/pull/1159#discussion_r448630136", "bodyText": "For now, yes :)", "author": "mustaphazorgati", "createdAt": "2020-07-01T21:39:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM0MTQ5OQ=="}], "type": "inlineReview"}]}