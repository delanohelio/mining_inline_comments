{"pr_number": 1360, "pr_title": "TSK-1476: Rework workbasket access items", "pr_createdAt": "2020-12-03T15:41:29Z", "pr_url": "https://github.com/Taskana/taskana/pull/1360", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMxOTI3NA==", "url": "https://github.com/Taskana/taskana/pull/1360#discussion_r537319274", "bodyText": "In the other refactored components, we use the matTooltip: <button mat-stroked-button matTooltip=\"Add new access\" ... It would be nice to have consistency \ud83d\ude42", "author": "sofie29", "createdAt": "2020-12-07T08:35:39Z", "path": "web/src/app/administration/components/workbasket-access-items/workbasket-access-items.component.html", "diffHunk": "@@ -3,9 +3,20 @@\n \n \t<!-- ACCESS ITEMS -->\n \t<div class=\"workbasket-access-items\">\n-\t\t<form [formGroup]=\"AccessItemsForm\">\n-\t\t\t<table formArrayName=\"accessItemsGroups\" id=\"table-access-items\" class=\"workbasket-access-items__table table-striped\">\n-\n+\t\t<div class=\"workbasket-access-items__buttons\">\n+\t\t\t<button mat-stroked-button type=\"button\" class=\"workbasket-access-items__buttons-add-access\"", "originalCommit": "456b55a58aa2dcfba4d3d390f9b63529a24a9548", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMxOTYzMQ==", "url": "https://github.com/Taskana/taskana/pull/1360#discussion_r537319631", "bodyText": "see above", "author": "sofie29", "createdAt": "2020-12-07T08:36:18Z", "path": "web/src/app/administration/components/workbasket-access-items/workbasket-access-items.component.html", "diffHunk": "@@ -3,9 +3,20 @@\n \n \t<!-- ACCESS ITEMS -->\n \t<div class=\"workbasket-access-items\">\n-\t\t<form [formGroup]=\"AccessItemsForm\">\n-\t\t\t<table formArrayName=\"accessItemsGroups\" id=\"table-access-items\" class=\"workbasket-access-items__table table-striped\">\n-\n+\t\t<div class=\"workbasket-access-items__buttons\">\n+\t\t\t<button mat-stroked-button type=\"button\" class=\"workbasket-access-items__buttons-add-access\"\n+\t\t\t\t(click)=\"addAccessItem()\" data-toggle=\"tooltip\" title=\"Add new access\">\n+\t\t\t\tAdd new access\n+\t\t\t\t<mat-icon color=\"green-blue\" aria-label=\"add new access\">add</mat-icon>\n+\t\t\t</button>\n+\t\t\t<button mat-stroked-button type=\"button\" class=\"workbasket-access-items__buttons-delete-access\"\n+\t\t\t\t(click)=\"deleteAccessItems()\" data-toggle=\"tooltip\" title=\"delete selected access\">", "originalCommit": "456b55a58aa2dcfba4d3d390f9b63529a24a9548", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMyMDEzOQ==", "url": "https://github.com/Taskana/taskana/pull/1360#discussion_r537320139", "bodyText": "class naming is not BEM convention", "author": "sofie29", "createdAt": "2020-12-07T08:37:05Z", "path": "web/src/app/administration/components/workbasket-access-items/workbasket-access-items.component.html", "diffHunk": "@@ -3,9 +3,20 @@\n \n \t<!-- ACCESS ITEMS -->\n \t<div class=\"workbasket-access-items\">\n-\t\t<form [formGroup]=\"AccessItemsForm\">\n-\t\t\t<table formArrayName=\"accessItemsGroups\" id=\"table-access-items\" class=\"workbasket-access-items__table table-striped\">\n-\n+\t\t<div class=\"workbasket-access-items__buttons\">\n+\t\t\t<button mat-stroked-button type=\"button\" class=\"workbasket-access-items__buttons-add-access\"\n+\t\t\t\t(click)=\"addAccessItem()\" data-toggle=\"tooltip\" title=\"Add new access\">\n+\t\t\t\tAdd new access\n+\t\t\t\t<mat-icon color=\"green-blue\" aria-label=\"add new access\">add</mat-icon>\n+\t\t\t</button>\n+\t\t\t<button mat-stroked-button type=\"button\" class=\"workbasket-access-items__buttons-delete-access\"\n+\t\t\t\t(click)=\"deleteAccessItems()\" data-toggle=\"tooltip\" title=\"delete selected access\">\n+\t\t\t\tDelete selected access\n+\t\t\t\t<mat-icon color=\"green-blue\" aria-label=\"delete access\">delete</mat-icon>\n+\t\t\t</button>\n+\t\t</div>\n+\t\t<form [formGroup]=\"AccessItemsForm\" class=\"myForm\">", "originalCommit": "456b55a58aa2dcfba4d3d390f9b63529a24a9548", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMyOTAyNQ==", "url": "https://github.com/Taskana/taskana/pull/1360#discussion_r537329025", "bodyText": "I introduced these lines because of this ticket: https://taskana.atlassian.net/browse/TSK-1041. The table header should always be shown.", "author": "sofie29", "createdAt": "2020-12-07T08:51:20Z", "path": "web/src/app/administration/components/workbasket-access-items/workbasket-access-items.component.scss", "diffHunk": "@@ -27,55 +88,17 @@ td > input[type='checkbox'] {\n   color: red;\n }\n \n-th {\n-  padding: 0.25rem;\n-  position: sticky;\n-  top: 0;\n-  z-index: 3;\n-  background: white;", "originalCommit": "456b55a58aa2dcfba4d3d390f9b63529a24a9548", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMzMjE4MQ==", "url": "https://github.com/Taskana/taskana/pull/1360#discussion_r537332181", "bodyText": "For ng-deep, Webstorm shows the error: Unknown pseudo selector 'ng-deep'. This inspection detects unknown and inappropriate pseudo-classes and pseudo-elements.", "author": "sofie29", "createdAt": "2020-12-07T08:56:17Z", "path": "web/src/app/administration/components/workbasket-access-items/workbasket-access-items.component.scss", "diffHunk": "@@ -27,55 +88,17 @@ td > input[type='checkbox'] {\n   color: red;\n }\n \n-th {\n-  padding: 0.25rem;\n-  position: sticky;\n-  top: 0;\n-  z-index: 3;\n-  background: white;\n-}\n-.workbasket-access-items__table {\n-  margin-top: 20px;\n-}\n-.workbasket-access-items__table thead th {\n-  vertical-align: bottom;\n-  border-bottom: 2px solid #dee2e6;\n-}\n-\n-.workbasket-access-items__table td,\n-.table th {\n-  padding: 0.5rem;\n-  vertical-align: middle;\n-  border-top: 1px solid #dee2e6;\n-}\n-\n-.workbasket-access-items__table > thead > tr > th {\n-  max-width: 150px;\n-  border-bottom: none;\n+::ng-deep .myForm .mat-form-field-wrapper {", "originalCommit": "456b55a58aa2dcfba4d3d390f9b63529a24a9548", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTMzNTY0Ng==", "url": "https://github.com/Taskana/taskana/pull/1360#discussion_r539335646", "bodyText": "The selector is actually valid, webstorm apparently doesn't want to know it :D I've read that several people get the same error message. But I can try to handle it without the ng-deep selector.", "author": "Franzi321", "createdAt": "2020-12-09T14:09:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMzMjE4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMzMzM0OA==", "url": "https://github.com/Taskana/taskana/pull/1360#discussion_r537333348", "bodyText": "Unused import FormControl", "author": "sofie29", "createdAt": "2020-12-07T08:57:58Z", "path": "web/src/app/administration/components/workbasket-access-items/workbasket-access-items.component.ts", "diffHunk": "@@ -11,15 +11,14 @@ import {\n } from '@angular/core';\n import { Observable, Subject } from 'rxjs';\n import { Select, Store } from '@ngxs/store';\n-import { FormArray, FormBuilder, Validators } from '@angular/forms';\n+import { FormArray, FormBuilder, FormControl, Validators } from '@angular/forms';", "originalCommit": "456b55a58aa2dcfba4d3d390f9b63529a24a9548", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM0NTY3Mg==", "url": "https://github.com/Taskana/taskana/pull/1360#discussion_r537345672", "bodyText": "I think this ticket https://taskana.atlassian.net/browse/TSK-1044 should be part of the rework of the workbasket access items. We can also work on this ticket in a separate PR.", "author": "sofie29", "createdAt": "2020-12-07T09:17:14Z", "path": "web/src/app/administration/components/workbasket-access-items/workbasket-access-items.component.html", "diffHunk": "@@ -23,86 +34,101 @@\n \t\t\t\t\t</tr>\n \t\t\t\t</thead>\n \n-\n \t\t\t\t<tbody>\n-\t\t\t\t\t<tr *ngFor=\"let accessItem of accessItemsGroups.controls; let index = index;\" [formGroupName]=\"index\">\n+\t\t\t\t\t<tr *ngFor=\"let accessItem of accessItemsGroups?.controls; let index = index;\"\n+\t\t\t\t\t\t[formGroupName]=\"index\">\n \t\t\t\t\t\t<!-- REMOVE BUTTON -->\n \t\t\t\t\t\t<td>\n-\t\t\t\t\t\t\t<button mat-button type=\"button\" style=\"padding: 3px;\" (click)=\"remove(index)\" title=\"Remove\">\n-\t\t\t\t\t\t\t\t<span class=\"material-icons md-24 red\">clear</span>\n-\t\t\t\t\t\t\t</button>\n+\t\t\t\t\t\t\t<input class=\"workbasket-access-items__permission-checkbox\" type=\"checkbox\"\n+\t\t\t\t\t\t\t\taria-label=\"selectRow\" aria-labelledby=\"selectRow\" (change)=\"selectRow($event, index)\">\n \t\t\t\t\t\t</td>\n \n \t\t\t\t\t\t<!-- ACCESS ID -->\n \t\t\t\t\t\t<td *ngIf=\"(accessItemsCustomization$ | async)?.accessId.lookupField else accessIdInput\"\n-                class=\"workbasket-access-items__typeahead\"\n-                [ngClass]=\"{\t'has-warning': (accessItemsClone[index].accessId !== accessItem.value.accessId),\n+\t\t\t\t\t\t\tclass=\"workbasket-access-items__typeahead\" [ngClass]=\"{\t'has-warning': (accessItemsClone[index].accessId !== accessItem.value.accessId),\n                 \t\t\t\t\t\t\t'has-error': !accessItem.value.accessId }\">\n \n-\t\t\t\t\t\t\t<taskana-shared-type-ahead formControlName=\"accessId\" placeHolderMessage=\"* Access id is required\"\n-                                         [validationValue]=\"toggleValidationAccessIdMap.get(index)\"\n-                                         [displayError]=\"!isFieldValid('accessItem.value.accessId', index)\"\n-                                         (selectedItem)=\"accessItemSelected($event, index)\"\n-                                         (inputField)=\"focusNewInput($event)\">\n-              </taskana-shared-type-ahead>\n-            </td>\n+\t\t\t\t\t\t\t<taskana-shared-type-ahead formControlName=\"accessId\"\n+\t\t\t\t\t\t\t\tplaceHolderMessage=\"* Access id is required\"\n+\t\t\t\t\t\t\t\t[validationValue]=\"toggleValidationAccessIdMap.get(index)\"\n+\t\t\t\t\t\t\t\t[displayError]=\"!isFieldValid('accessItem.value.accessId', index)\"\n+\t\t\t\t\t\t\t\t(selectedItem)=\"accessItemSelected($event, index)\">\n+\t\t\t\t\t\t\t</taskana-shared-type-ahead>\n+\t\t\t\t\t\t</td>\n \n \t\t\t\t\t\t<ng-template #accessIdInput>\n \t\t\t\t\t\t\t<td>\n \t\t\t\t\t\t\t\t<div [ngClass]=\"{ 'has-warning': (accessItemsClone[index].accessId !== accessItem.value.accessId),\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  'has-error': !accessItem.value.accessId && formsValidatorService.formSubmitAttempt}\">\n-                  <input matInput type=\"text\" formControlName=\"accessId\"\n-                         placeholder=\"{{accessItem.invalid ? '* Access id is required': ''}}\"\n-                         [@validation]=\"toggleValidationAccessIdMap.get(index)\" #htmlInputElement>\n+\t\t\t\t\t\t\t\t\t<input matInput type=\"text\" formControlName=\"accessId\"\n+\t\t\t\t\t\t\t\t\t\tplaceholder=\"{{accessItem.invalid ? '* Access id is required': ''}}\"\n+\t\t\t\t\t\t\t\t\t\t[@validation]=\"toggleValidationAccessIdMap.get(index)\" #htmlInputElement>\n \t\t\t\t\t\t\t\t</div>\n \t\t\t\t\t\t\t</td>\n \t\t\t\t\t\t</ng-template>\n \n \t\t\t\t\t\t<!-- SELECT ALL -->\n \t\t\t\t\t\t<td>\n-                <input class=\"workbasket-access-items__permission-checkbox\" type=\"checkbox\"  id=\"checkbox-{{index}}-00\" (change)=\"checkAll(index, $event)\" aria-label=\"checkAll\" aria-labelledby=\"checkAll\">\n-            </td>\n+\t\t\t\t\t\t\t<input class=\"workbasket-access-items__permission-checkbox\" type=\"checkbox\"\n+\t\t\t\t\t\t\t\tid=\"checkbox-{{index}}-00\" (change)=\"checkAll(index, $event)\" aria-label=\"checkAll\"\n+\t\t\t\t\t\t\t\taria-labelledby=\"checkAll\">\n+\t\t\t\t\t\t</td>", "originalCommit": "456b55a58aa2dcfba4d3d390f9b63529a24a9548", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1c6f184b3f9beb6a4a7a36ba0b192ec5144fc748", "url": "https://github.com/Taskana/taskana/commit/1c6f184b3f9beb6a4a7a36ba0b192ec5144fc748", "message": "TSK-1476: Rework Workbasket Access Items", "committedDate": "2020-12-18T13:19:45Z", "type": "commit"}, {"oid": "a641838bf6b5e63abaa2e15ed12fa119ea61b590", "url": "https://github.com/Taskana/taskana/commit/a641838bf6b5e63abaa2e15ed12fa119ea61b590", "message": "TSK-1476: Rework Workbasket Access Items", "committedDate": "2020-12-18T13:22:26Z", "type": "commit"}, {"oid": "2a3a4f1c11e68382f198647d6aeff9897a900130", "url": "https://github.com/Taskana/taskana/commit/2a3a4f1c11e68382f198647d6aeff9897a900130", "message": "TSK-1476: update", "committedDate": "2020-12-18T13:22:41Z", "type": "commit"}]}