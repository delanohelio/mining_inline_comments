{"pr_number": 1127, "pr_title": "TSK-1279 Enable the creation of subclassifications", "pr_createdAt": "2020-06-15T13:15:06Z", "pr_url": "https://github.com/Taskana/taskana/pull/1127", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYzMzQzMg==", "url": "https://github.com/Taskana/taskana/pull/1127#discussion_r441633432", "bodyText": "I'm missing a takeUntil(this.destroy$)", "author": "mustaphazorgati", "createdAt": "2020-06-17T15:26:00Z", "path": "web/src/app/administration/components/classification-details/classification-details.component.ts", "diffHunk": "@@ -80,7 +78,9 @@ export class ClassificationDetailsComponent implements OnInit, OnDestroy {\n     this.action$.pipe(takeUntil(this.destroy$)).subscribe(data => {\n       this.action = data;\n       if (this.action === ACTION.CREATE) {\n-        this.initClassificationOnCreation();\n+        this.selectedClassification$.pipe(take(1)).subscribe(initialClassification => {", "originalCommit": "8742a3efd53adb38e8e6f83cb15cf8295f751e7a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjc5ODkzNw==", "url": "https://github.com/Taskana/taskana/pull/1127#discussion_r442798937", "bodyText": "this is not needed since there is take(1)", "author": "sofie29", "createdAt": "2020-06-19T11:58:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYzMzQzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYzNTUxNA==", "url": "https://github.com/Taskana/taskana/pull/1127#discussion_r441635514", "bodyText": "why are you not using classificationCopy$?", "author": "mustaphazorgati", "createdAt": "2020-06-17T15:28:56Z", "path": "web/src/app/shared/components/tree/tree.component.ts", "diffHunk": "@@ -92,19 +87,25 @@ export class TaskanaTreeComponent implements OnInit, AfterViewChecked, OnDestroy\n       this.action = action;\n     });\n \n-    this.selectedClassificationId$.pipe(takeUntil(this.destroy$)).subscribe(selectedClassificationId => {\n-      this.selectNodeId = typeof selectedClassificationId !== 'undefined' ? selectedClassificationId : undefined;\n-      if (typeof this.tree.treeModel.getActiveNode() !== 'undefined') {\n-        if (this.tree.treeModel.getActiveNode().data.classificationId !== this.selectNodeId) {\n-          this.selectNode(this.selectNodeId);\n+    const classificationCopy$: Observable<TreeNodeModel[]> = this.classifications$.pipe(\n+      filter(classifications => typeof (classifications) !== 'undefined'),\n+      tap(classifications => {\n+        this.classifications = classifications.map(this.classificationsDeepCopy.bind(this));\n+      })\n+    );\n+\n+    combineLatest(this.selectedClassificationId$, classificationCopy$).pipe(takeUntil(this.destroy$))", "originalCommit": "8742a3efd53adb38e8e6f83cb15cf8295f751e7a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjc5OTAxMg==", "url": "https://github.com/Taskana/taskana/pull/1127#discussion_r442799012", "bodyText": "I am using classificationCopy$, see the code snippet you marked", "author": "sofie29", "createdAt": "2020-06-19T11:59:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYzNTUxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE0Mjg0Mg==", "url": "https://github.com/Taskana/taskana/pull/1127#discussion_r443142842", "bodyText": "I only see the selectedClassificationId in the subscribe statement. Or am I missing something?", "author": "mustaphazorgati", "createdAt": "2020-06-20T16:28:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYzNTUxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM0MzY2MA==", "url": "https://github.com/Taskana/taskana/pull/1127#discussion_r443343660", "bodyText": "Ah I understand. The classifications are set with \"tap\" in the classificationCopy$ (line 93), that is why I don't need the classifications here...", "author": "sofie29", "createdAt": "2020-06-22T06:36:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYzNTUxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYzODAzOA==", "url": "https://github.com/Taskana/taskana/pull/1127#discussion_r441638038", "bodyText": "why are we copying the classification?", "author": "mustaphazorgati", "createdAt": "2020-06-17T15:32:45Z", "path": "web/src/app/administration/components/classification-details/classification-details.component.ts", "diffHunk": "@@ -80,7 +78,9 @@ export class ClassificationDetailsComponent implements OnInit, OnDestroy {\n     this.action$.pipe(takeUntil(this.destroy$)).subscribe(data => {\n       this.action = data;\n       if (this.action === ACTION.CREATE) {\n-        this.initClassificationOnCreation();\n+        this.selectedClassification$.pipe(take(1)).subscribe(initialClassification => {\n+          this.classification = { ...initialClassification };", "originalCommit": "8742a3efd53adb38e8e6f83cb15cf8295f751e7a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjc5OTEyMw==", "url": "https://github.com/Taskana/taskana/pull/1127#discussion_r442799123", "bodyText": "Because the initialClassication from store is read only and we want to edit it while creating this new classification", "author": "sofie29", "createdAt": "2020-06-19T11:59:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYzODAzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE0Mjc5OA==", "url": "https://github.com/Taskana/taskana/pull/1127#discussion_r443142798", "bodyText": "\ud83d\udc4d", "author": "mustaphazorgati", "createdAt": "2020-06-20T16:27:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYzODAzOA=="}], "type": "inlineReview"}, {"oid": "a4fe0cb0572da7c75d612d1ae8426972e5d4a04b", "url": "https://github.com/Taskana/taskana/commit/a4fe0cb0572da7c75d612d1ae8426972e5d4a04b", "message": "TSK-1214: refactored taskana-classification\n\nTSK-1214 Trying to make drag'n drop in tree possible\n\nTSK-1214 Removed refreshClassification output from tree\n\nTSK-1214 New action in store updates a classification and refetches all, saving now correctly refreshes the classification-list\n\nTSK-1214 Fixed tests in tree component\n\nTSK-1214 Removed tree service and corresponding test in class-details\n\nTSK-1214 fixed issues in tree where multiple actions to store are fired incorrectly\n\nTSK-1214 added accessibility action, use space to select a tree node\n\nTSK-1214 swapped space and enter in tree component, cleaned code\n\nTSK-1214 fixed bug where page isn't updated dynamically according to browser path\n\nTSK-1214 workaround circular dependency.\n\nservice uses snapshot of store, does not actually access the state in store\n\nTSK-1214 fixed eslint. TODO: circular dependency between classification.service and classification.state\n\nTSK-1214 changed first() to take(1) to fix Observable dying during test\n\nTSK-1214 fixed test cases and lint issues\n\nTSK-1214 fixed circular dependency\n\nTSK-1214 devmode = false\n\nTSK-1214: fixed merge problems with notificationService and removed some warnings\n\nTSK-1214: fixed merge problems with notificationService\n\nTSK-1214 remove wrong imports from before merge", "committedDate": "2020-06-22T10:11:02Z", "type": "commit"}, {"oid": "abe54cd6c90054cf0d53b9475ade85fe290fb60a", "url": "https://github.com/Taskana/taskana/commit/abe54cd6c90054cf0d53b9475ade85fe290fb60a", "message": "TSK-1279: Enable the creation of subclassifications", "committedDate": "2020-06-22T10:14:02Z", "type": "commit"}]}