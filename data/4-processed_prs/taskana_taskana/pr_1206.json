{"pr_number": 1206, "pr_title": "TSK-1338: tasklist now does not refresh after selection of a task", "pr_createdAt": "2020-07-29T14:30:37Z", "pr_url": "https://github.com/Taskana/taskana/pull/1206", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDIxNDI0Mw==", "url": "https://github.com/Taskana/taskana/pull/1206#discussion_r464214243", "bodyText": "Why don't we update selectedId and currentBasket like before when taskSelectedStream (getSelectedTask()) changes?", "author": "sofie29", "createdAt": "2020-08-03T06:19:47Z", "path": "web/src/app/workplace/components/task-master/task-master.component.ts", "diffHunk": "@@ -55,19 +55,13 @@ export class TaskMasterComponent implements OnInit, OnDestroy {\n   ) {}\n \n   ngOnInit() {\n-    this.taskService\n-      .getSelectedTask()\n-      .pipe(takeUntil(this.destroy$))\n-      .subscribe((task: Task) => {\n-        if (!this.currentBasket) {\n-          this.selectedId = task.taskId;\n-          this.currentBasket = task.workbasketSummary;\n-          this.getTasks();\n-        }\n-        if (!task) {\n-          this.selectedId = '';\n-        }\n-      });\n+    this.taskService.taskChangedStream.pipe(takeUntil(this.destroy$)).subscribe((task: Task) => {\n+      this.selectedId = task ? task.taskId : '';\n+      if (!this.currentBasket) {\n+        this.currentBasket = task.workbasketSummary;\n+        this.getTasks();\n+      }\n+    });", "originalCommit": "82eab5b2a93e30ef889c7c43151dcbf95161b5b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTA2NTc1OQ==", "url": "https://github.com/Taskana/taskana/pull/1206#discussion_r465065759", "bodyText": "I used the taskChangedStream, because i assumed it was the same as the selected stream (it worked for my purposes). I changed it to the selectedStream and the list now gets displayed when working on a task.\nGood suggestion, thanks", "author": "Tristan2357", "createdAt": "2020-08-04T13:52:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDIxNDI0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg5NzU2MA==", "url": "https://github.com/Taskana/taskana/pull/1206#discussion_r465897560", "bodyText": "I thought about this - I think we have to delete the currentBasket even when there is an objectReference. In case we search by type and value, the method getTasks() should be called without a currentBasket. Otherwise the method would filter the tasks by a workbasket (the currentBasket).", "author": "sofie29", "createdAt": "2020-08-05T17:45:07Z", "path": "web/src/app/workplace/components/task-master/task-master.component.ts", "diffHunk": "@@ -90,9 +84,10 @@ export class TaskMasterComponent implements OnInit, OnDestroy {\n \n     this.workplaceService.objectReferenceSelectedStream.pipe(takeUntil(this.destroy$)).subscribe((objectReference) => {\n       this.objectReference = objectReference;\n-      delete this.currentBasket;\n       if (objectReference) {\n         this.getTasks();\n+      } else {\n+        delete this.currentBasket;", "originalCommit": "f0ddb1725ca1817662fecd1d23c6c60c74b0801f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b330dd287fe6b55d3de7c20cd5896e616eacdb37", "url": "https://github.com/Taskana/taskana/commit/b330dd287fe6b55d3de7c20cd5896e616eacdb37", "message": "TSK-1338: List now does not refresh after selection of a task", "committedDate": "2020-08-06T14:39:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc0NzUxNw==", "url": "https://github.com/Taskana/taskana/pull/1206#discussion_r467747517", "bodyText": "nice", "author": "cnguyen-de", "createdAt": "2020-08-10T08:11:34Z", "path": "web/src/app/workplace/services/task.service.ts", "diffHunk": "@@ -91,29 +90,17 @@ export class TaskService {\n     return this.httpClient.post<Task>(this.url, task);\n   }\n \n-  private convertTasksDatesToGMT(task: Task): Task {\n-    if (task.created) {\n-      task.created = new Date(task.created).toISOString();\n-    }\n-    if (task.claimed) {\n-      task.claimed = new Date(task.claimed).toISOString();\n-    }\n-    if (task.completed) {\n-      task.completed = new Date(task.completed).toISOString();\n-    }\n-    if (task.modified) {\n-      task.modified = new Date(task.modified).toISOString();\n-    }\n-    if (task.planned) {\n-      task.planned = new Date(task.planned).toISOString();\n-    }\n-    if (task.due) {\n-      task.due = new Date(task.due).toISOString();\n-    }\n+  private static convertTasksDatesToGMT(task: Task): Task {\n+    const timeAttributes = ['created', 'claimed', 'completed', 'modified', 'planned', 'due'];\n+    timeAttributes.forEach((attributeName) => {\n+      if (task[attributeName]) {\n+        task[attributeName] = new Date(task[attributeName]).toISOString();\n+      }\n+    });", "originalCommit": "b330dd287fe6b55d3de7c20cd5896e616eacdb37", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}