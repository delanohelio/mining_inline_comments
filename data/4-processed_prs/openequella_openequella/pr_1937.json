{"pr_number": 1937, "pr_title": "chore(ci): Prepackage coverage report", "pr_createdAt": "2020-06-25T03:09:43Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/1937", "timeline": [{"oid": "e6ddd3fffed2727ab1b1351e8746204f0e59da7b", "url": "https://github.com/openequella/openEQUELLA/commit/e6ddd3fffed2727ab1b1351e8746204f0e59da7b", "message": "chore(ci): Prepackage coverage report\n\nThe uploading of the coverage reports was taking a very long time and\nsometimes failing. I believe this is because the artefact upload action\nwasn't really designed for uploading directories with tens of thousands\nof files.\n\nConsidering the upload of the primary artefacts only takes a few minutes\n(and is a few hundred megabytes), I'm assuming this will save us\nsignificant time and shorten our test runs by about 50%.", "committedDate": "2020-06-25T03:04:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI5NzQ3Nw==", "url": "https://github.com/openequella/openEQUELLA/pull/1937#discussion_r445297477", "bodyText": "\ud83e\udd14 if upload is where the script is taking most of the hit, it may be worth adding some additional compression to reduce the size\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      tar cvf coverage_report.tar autotest/target/coverage-report/\n          \n          \n            \n                      tar cvzf coverage_report.tar.gz autotest/target/coverage-report/", "author": "ChristianMurphy", "createdAt": "2020-06-25T04:17:43Z", "path": ".github/workflows/ci.yaml", "diffHunk": "@@ -255,8 +255,15 @@ jobs:\n           ./sbt -jvm-opts autotest/.jvmopts \"project autotest\" \\\n             coverageReport\n \n+      # To save significant time on file upload, we first tar up the directory\n+      # as it contains > 10k files and the artefact upload was taking almost\n+      # 1hr.\n+      - name: Package Coverage Report\n+        run: |\n+          tar cvf coverage_report.tar autotest/target/coverage-report/", "originalCommit": "e6ddd3fffed2727ab1b1351e8746204f0e59da7b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwMjYwMA==", "url": "https://github.com/openequella/openEQUELLA/pull/1937#discussion_r445302600", "bodyText": "I felt it was more the IO of opening and closing all the files - especially seeing a lot are tiny. Plus, the artefact upload action compresses to zip as well.", "author": "edalex-ian", "createdAt": "2020-06-25T04:40:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI5NzQ3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI5NzQ5Ng==", "url": "https://github.com/openequella/openEQUELLA/pull/1937#discussion_r445297496", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      path: coverage_report.tar\n          \n          \n            \n                      path: coverage_report.tar.gz", "author": "ChristianMurphy", "createdAt": "2020-06-25T04:17:51Z", "path": ".github/workflows/ci.yaml", "diffHunk": "@@ -255,8 +255,15 @@ jobs:\n           ./sbt -jvm-opts autotest/.jvmopts \"project autotest\" \\\n             coverageReport\n \n+      # To save significant time on file upload, we first tar up the directory\n+      # as it contains > 10k files and the artefact upload was taking almost\n+      # 1hr.\n+      - name: Package Coverage Report\n+        run: |\n+          tar cvf coverage_report.tar autotest/target/coverage-report/\n+\n       - name: Save Coverage Report\n         uses: actions/upload-artifact@v2.0.1\n         with:\n           name: CoverageReport-newui-${{ matrix.newui }}\n-          path: autotest/target/coverage-report/\n+          path: coverage_report.tar", "originalCommit": "e6ddd3fffed2727ab1b1351e8746204f0e59da7b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}