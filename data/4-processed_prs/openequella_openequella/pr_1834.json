{"pr_number": 1834, "pr_title": "Add schema node selector", "pr_createdAt": "2020-06-15T06:50:08Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/1834", "timeline": [{"oid": "377a96bba13e5c790b976626385ea1e6bba66f75", "url": "https://github.com/openequella/openEQUELLA/commit/377a96bba13e5c790b976626385ea1e6bba66f75", "message": "Add initial component and story for SchemaNodeSelector.tsx", "committedDate": "2020-06-01T02:32:49Z", "type": "commit"}, {"oid": "93d8fb3fcdab6187012c3093822c3a149d6ec64f", "url": "https://github.com/openequella/openEQUELLA/commit/93d8fb3fcdab6187012c3093822c3a149d6ec64f", "message": "Start SchemaSelector.tsx", "committedDate": "2020-06-01T02:32:49Z", "type": "commit"}, {"oid": "797c85d02f072b4671fa5e9428cc9deabb07d669", "url": "https://github.com/openequella/openEQUELLA/commit/797c85d02f072b4671fa5e9428cc9deabb07d669", "message": "Connect to schema rest endpoints", "committedDate": "2020-06-02T04:07:20Z", "type": "commit"}, {"oid": "5c120193216635382b266ea00f78d1956d652e74", "url": "https://github.com/openequella/openEQUELLA/commit/5c120193216635382b266ea00f78d1956d652e74", "message": "Add mock data for story", "committedDate": "2020-06-12T04:56:17Z", "type": "commit"}, {"oid": "a6828cde70900ae6fd33408cd19472abef5892e4", "url": "https://github.com/openequella/openEQUELLA/commit/a6828cde70900ae6fd33408cd19472abef5892e4", "message": "Merge branch 'develop' into feature/add_schema_node_selector", "committedDate": "2020-06-15T01:46:18Z", "type": "commit"}, {"oid": "7afdff357e2e54cf029c814cc5dd090e4d2b14f4", "url": "https://github.com/openequella/openEQUELLA/commit/7afdff357e2e54cf029c814cc5dd090e4d2b14f4", "message": "Revert mistaken change to tsconfig.json", "committedDate": "2020-06-15T03:45:02Z", "type": "commit"}, {"oid": "4272917353aaba6379f65a9976002a449215a6fb", "url": "https://github.com/openequella/openEQUELLA/commit/4272917353aaba6379f65a9976002a449215a6fb", "message": "Add parents to the mock data", "committedDate": "2020-06-15T03:57:46Z", "type": "commit"}, {"oid": "f79adb030404e10342d2193f50af59fa7773f62c", "url": "https://github.com/openequella/openEQUELLA/commit/f79adb030404e10342d2193f50af59fa7773f62c", "message": "Add a method to get all paths and to render the tree in SchemaModule.tsx", "committedDate": "2020-06-15T03:58:33Z", "type": "commit"}, {"oid": "8c4b2c2f024702bcccfb4a1d115e025a8390a23b", "url": "https://github.com/openequella/openEQUELLA/commit/8c4b2c2f024702bcccfb4a1d115e025a8390a23b", "message": "Add tests to new SchemaModule functions", "committedDate": "2020-06-15T03:59:07Z", "type": "commit"}, {"oid": "deade57f1b85d227ac01b86d4fe1ecc1f0a981ef", "url": "https://github.com/openequella/openEQUELLA/commit/deade57f1b85d227ac01b86d4fe1ecc1f0a981ef", "message": "Update FacetDialog.tsx to include the SchemaSelector", "committedDate": "2020-06-15T04:01:41Z", "type": "commit"}, {"oid": "09da546bdf18133a22eef7f249d12273533a7e79", "url": "https://github.com/openequella/openEQUELLA/commit/09da546bdf18133a22eef7f249d12273533a7e79", "message": "Add expand/collapse controls", "committedDate": "2020-06-15T04:07:44Z", "type": "commit"}, {"oid": "efa10bfae7e24fbff7c45f6b0140cfc606b9f7db", "url": "https://github.com/openequella/openEQUELLA/commit/efa10bfae7e24fbff7c45f6b0140cfc606b9f7db", "message": "Enable manual input", "committedDate": "2020-06-15T05:41:24Z", "type": "commit"}, {"oid": "1ad2366daa09e1ea53df17a64a3d7f9faa0c8000", "url": "https://github.com/openequella/openEQUELLA/commit/1ad2366daa09e1ea53df17a64a3d7f9faa0c8000", "message": "Update language strings", "committedDate": "2020-06-15T06:32:17Z", "type": "commit"}, {"oid": "2e8946b5bc2278b185a7c21141550adc84cde2ab", "url": "https://github.com/openequella/openEQUELLA/commit/2e8946b5bc2278b185a7c21141550adc84cde2ab", "message": "Stop using for of loop\n\nRequired a special flag in tsconfig.json. using Map.forEach\navoids the issue.", "committedDate": "2020-06-15T07:11:52Z", "type": "commit"}, {"oid": "5e8ea6da665e89c9970cea57e4ed05b52221d84f", "url": "https://github.com/openequella/openEQUELLA/commit/5e8ea6da665e89c9970cea57e4ed05b52221d84f", "message": "Merge branch 'develop' into feature/add_schema_node_selector", "committedDate": "2020-06-15T07:39:36Z", "type": "commit"}, {"oid": "48a8e3e4d56444a2f825e4b68f93490d47778fd2", "url": "https://github.com/openequella/openEQUELLA/commit/48a8e3e4d56444a2f825e4b68f93490d47778fd2", "message": "Add mock API calls to FacetedSearchSettingsPage.test.tsx", "committedDate": "2020-06-16T00:03:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU4NjAyMg==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r440586022", "bodyText": "Can we make tree the first parameter to be consistent with the interface definition ?", "author": "PenghaiZhang", "createdAt": "2020-06-16T04:56:48Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/SchemaNodeSelector.tsx", "diffHunk": "@@ -0,0 +1,120 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { TreeView } from \"@material-ui/lab\";\n+import { Add, Remove } from \"@material-ui/icons\";\n+import { getAllPaths, renderTree, SchemaNode } from \"../schema/SchemaModule\";\n+import { Button, Grid } from \"@material-ui/core\";\n+import { makeStyles, Theme } from \"@material-ui/core/styles\";\n+import { languageStrings } from \"../util/langstrings\";\n+\n+const useStyles = makeStyles((theme: Theme) => {\n+  return {\n+    treeView: {\n+      flexGrow: 1,\n+      maxHeight: \"30vh\",\n+      overflowY: \"auto\",\n+      width: \"100%\",\n+    },\n+    button: {\n+      marginTop: theme.spacing(1),\n+      marginBottom: theme.spacing(1),\n+    },\n+  };\n+});\n+\n+interface SchemaNodeSelectorProps {\n+  /**\n+   * The schema tree this component will display.\n+   */\n+  tree: SchemaNode | undefined;\n+  /**\n+   * Function that gets called upon selection of a node.\n+   * @param node The path of the selected node.\n+   */\n+  setSelectedNode: (node: string) => void;\n+  /**\n+   * If present, expand all/collapse all buttons will be available.\n+   */\n+  expandControls?: boolean;\n+}\n+\n+/**\n+ * This component defines a schema node selector, for the display of a schema and selection of its nodes. The schema itself passed into this should be of type SchemaNode.\n+ */\n+export default function SchemaNodeSelector({\n+  setSelectedNode,\n+  tree,", "originalCommit": "48a8e3e4d56444a2f825e4b68f93490d47778fd2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU4NjcwNQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r440586705", "bodyText": "This name makes me feel it was a boolean variable at the first glance, but it's certainly fine.", "author": "PenghaiZhang", "createdAt": "2020-06-16T04:59:41Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/SchemaNodeSelector.tsx", "diffHunk": "@@ -0,0 +1,120 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { TreeView } from \"@material-ui/lab\";\n+import { Add, Remove } from \"@material-ui/icons\";\n+import { getAllPaths, renderTree, SchemaNode } from \"../schema/SchemaModule\";\n+import { Button, Grid } from \"@material-ui/core\";\n+import { makeStyles, Theme } from \"@material-ui/core/styles\";\n+import { languageStrings } from \"../util/langstrings\";\n+\n+const useStyles = makeStyles((theme: Theme) => {\n+  return {\n+    treeView: {\n+      flexGrow: 1,\n+      maxHeight: \"30vh\",\n+      overflowY: \"auto\",\n+      width: \"100%\",\n+    },\n+    button: {\n+      marginTop: theme.spacing(1),\n+      marginBottom: theme.spacing(1),\n+    },\n+  };\n+});\n+\n+interface SchemaNodeSelectorProps {\n+  /**\n+   * The schema tree this component will display.\n+   */\n+  tree: SchemaNode | undefined;\n+  /**\n+   * Function that gets called upon selection of a node.\n+   * @param node The path of the selected node.\n+   */\n+  setSelectedNode: (node: string) => void;\n+  /**\n+   * If present, expand all/collapse all buttons will be available.\n+   */\n+  expandControls?: boolean;\n+}\n+\n+/**\n+ * This component defines a schema node selector, for the display of a schema and selection of its nodes. The schema itself passed into this should be of type SchemaNode.\n+ */\n+export default function SchemaNodeSelector({\n+  setSelectedNode,\n+  tree,\n+  expandControls,\n+}: SchemaNodeSelectorProps) {\n+  const [selectedNode, setSelected] = React.useState(\"\");\n+  const [expanded, setExpanded] = React.useState<string[]>([]);", "originalCommit": "48a8e3e4d56444a2f825e4b68f93490d47778fd2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDYxODAwMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r440618001", "bodyText": "This is only to map with the TreeView parameter \"expanded\" which takes a list of strings.", "author": "SammyIsConfused", "createdAt": "2020-06-16T06:39:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU4NjcwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU4NzU0Mw==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r440587543", "bodyText": "I think we just need if (tree) .", "author": "PenghaiZhang", "createdAt": "2020-06-16T05:02:52Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/SchemaNodeSelector.tsx", "diffHunk": "@@ -0,0 +1,120 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { TreeView } from \"@material-ui/lab\";\n+import { Add, Remove } from \"@material-ui/icons\";\n+import { getAllPaths, renderTree, SchemaNode } from \"../schema/SchemaModule\";\n+import { Button, Grid } from \"@material-ui/core\";\n+import { makeStyles, Theme } from \"@material-ui/core/styles\";\n+import { languageStrings } from \"../util/langstrings\";\n+\n+const useStyles = makeStyles((theme: Theme) => {\n+  return {\n+    treeView: {\n+      flexGrow: 1,\n+      maxHeight: \"30vh\",\n+      overflowY: \"auto\",\n+      width: \"100%\",\n+    },\n+    button: {\n+      marginTop: theme.spacing(1),\n+      marginBottom: theme.spacing(1),\n+    },\n+  };\n+});\n+\n+interface SchemaNodeSelectorProps {\n+  /**\n+   * The schema tree this component will display.\n+   */\n+  tree: SchemaNode | undefined;\n+  /**\n+   * Function that gets called upon selection of a node.\n+   * @param node The path of the selected node.\n+   */\n+  setSelectedNode: (node: string) => void;\n+  /**\n+   * If present, expand all/collapse all buttons will be available.\n+   */\n+  expandControls?: boolean;\n+}\n+\n+/**\n+ * This component defines a schema node selector, for the display of a schema and selection of its nodes. The schema itself passed into this should be of type SchemaNode.\n+ */\n+export default function SchemaNodeSelector({\n+  setSelectedNode,\n+  tree,\n+  expandControls,\n+}: SchemaNodeSelectorProps) {\n+  const [selectedNode, setSelected] = React.useState(\"\");\n+  const [expanded, setExpanded] = React.useState<string[]>([]);\n+  const [renderedTree, setRenderedTree] = React.useState<JSX.Element>(<div />);\n+  const classes = useStyles();\n+  const strings =\n+    languageStrings.settings.searching.facetedsearchsetting.schemaselector\n+      .nodeselector;\n+  React.useEffect(() => {\n+    if (tree !== undefined) {", "originalCommit": "48a8e3e4d56444a2f825e4b68f93490d47778fd2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU5MDIzNA==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r440590234", "bodyText": "May I ask why choose Grid here? There is only one grid item.", "author": "PenghaiZhang", "createdAt": "2020-06-16T05:13:10Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/SchemaNodeSelector.tsx", "diffHunk": "@@ -0,0 +1,120 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { TreeView } from \"@material-ui/lab\";\n+import { Add, Remove } from \"@material-ui/icons\";\n+import { getAllPaths, renderTree, SchemaNode } from \"../schema/SchemaModule\";\n+import { Button, Grid } from \"@material-ui/core\";\n+import { makeStyles, Theme } from \"@material-ui/core/styles\";\n+import { languageStrings } from \"../util/langstrings\";\n+\n+const useStyles = makeStyles((theme: Theme) => {\n+  return {\n+    treeView: {\n+      flexGrow: 1,\n+      maxHeight: \"30vh\",\n+      overflowY: \"auto\",\n+      width: \"100%\",\n+    },\n+    button: {\n+      marginTop: theme.spacing(1),\n+      marginBottom: theme.spacing(1),\n+    },\n+  };\n+});\n+\n+interface SchemaNodeSelectorProps {\n+  /**\n+   * The schema tree this component will display.\n+   */\n+  tree: SchemaNode | undefined;\n+  /**\n+   * Function that gets called upon selection of a node.\n+   * @param node The path of the selected node.\n+   */\n+  setSelectedNode: (node: string) => void;\n+  /**\n+   * If present, expand all/collapse all buttons will be available.\n+   */\n+  expandControls?: boolean;\n+}\n+\n+/**\n+ * This component defines a schema node selector, for the display of a schema and selection of its nodes. The schema itself passed into this should be of type SchemaNode.\n+ */\n+export default function SchemaNodeSelector({\n+  setSelectedNode,\n+  tree,\n+  expandControls,\n+}: SchemaNodeSelectorProps) {\n+  const [selectedNode, setSelected] = React.useState(\"\");\n+  const [expanded, setExpanded] = React.useState<string[]>([]);\n+  const [renderedTree, setRenderedTree] = React.useState<JSX.Element>(<div />);\n+  const classes = useStyles();\n+  const strings =\n+    languageStrings.settings.searching.facetedsearchsetting.schemaselector\n+      .nodeselector;\n+  React.useEffect(() => {\n+    if (tree !== undefined) {\n+      setRenderedTree(renderTree(tree));\n+      setExpanded([]);\n+      setSelectedNode(\"\");\n+    }\n+  }, [tree]);\n+\n+  return (\n+    <>\n+      {expandControls && (\n+        <Grid container direction={\"row\"} wrap={\"nowrap\"} justify={\"flex-end\"}>\n+          <Grid item>", "originalCommit": "48a8e3e4d56444a2f825e4b68f93490d47778fd2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDYyNDY5MA==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r440624690", "bodyText": "Added the second one - it was for the buttons so that they would be right aligned and in a row. It must have still worked because of the parameters passed to the grid container above.", "author": "SammyIsConfused", "createdAt": "2020-06-16T06:54:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU5MDIzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU5MzUxNA==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r440593514", "bodyText": "Is there any particular reason for using JSX.Element ?  I think JSX.Element is more or less the same as ReactElement but I did not see any usage of JSX.Element  before in oEQ.", "author": "PenghaiZhang", "createdAt": "2020-06-16T05:25:31Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/SchemaSelector.tsx", "diffHunk": "@@ -0,0 +1,115 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { Grid, InputLabel, MenuItem, Select } from \"@material-ui/core\";\n+import {\n+  schemaListSummary,\n+  SchemaNode,\n+  schemaTree,\n+} from \"../schema/SchemaModule\";\n+import SchemaNodeSelector from \"../settings/SchemaNodeSelector\";\n+import { languageStrings } from \"../util/langstrings\";\n+\n+interface SchemaSelectorProps {\n+  /**\n+   * Callback function triggered upon selection of a node.\n+   * @param node  Path of the selected node.\n+   */\n+  setSchemaNode: (node: string) => void;\n+}\n+\n+/**\n+ * This component defines a schema selector, for selecting a schema and then a node within.\n+ * When a schema is selected, it will display that schema within a SchemaNodeSelector.\n+ *\n+ */\n+export default function SchemaSelector({ setSchemaNode }: SchemaSelectorProps) {\n+  const [selectedSchema, setSelectedSchema] = React.useState<\n+    string | undefined\n+  >(undefined);\n+  const [schema, setSchema] = React.useState<SchemaNode>();\n+  const [schemaList, setSchemaList] = React.useState<JSX.Element[]>([]);", "originalCommit": "48a8e3e4d56444a2f825e4b68f93490d47778fd2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDYyNTAwNg==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r440625006", "bodyText": "Changed to ReactElement - I believe that was an inferred type from my IDE.", "author": "SammyIsConfused", "createdAt": "2020-06-16T06:55:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU5MzUxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU5NDY4Mw==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r440594683", "bodyText": "Does this default MenuItem need an ID?", "author": "PenghaiZhang", "createdAt": "2020-06-16T05:29:41Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/SchemaSelector.tsx", "diffHunk": "@@ -0,0 +1,115 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { Grid, InputLabel, MenuItem, Select } from \"@material-ui/core\";\n+import {\n+  schemaListSummary,\n+  SchemaNode,\n+  schemaTree,\n+} from \"../schema/SchemaModule\";\n+import SchemaNodeSelector from \"../settings/SchemaNodeSelector\";\n+import { languageStrings } from \"../util/langstrings\";\n+\n+interface SchemaSelectorProps {\n+  /**\n+   * Callback function triggered upon selection of a node.\n+   * @param node  Path of the selected node.\n+   */\n+  setSchemaNode: (node: string) => void;\n+}\n+\n+/**\n+ * This component defines a schema selector, for selecting a schema and then a node within.\n+ * When a schema is selected, it will display that schema within a SchemaNodeSelector.\n+ *\n+ */\n+export default function SchemaSelector({ setSchemaNode }: SchemaSelectorProps) {\n+  const [selectedSchema, setSelectedSchema] = React.useState<\n+    string | undefined\n+  >(undefined);\n+  const [schema, setSchema] = React.useState<SchemaNode>();\n+  const [schemaList, setSchemaList] = React.useState<JSX.Element[]>([]);\n+  const [schemaNodePath, setSchemaNodePath] = React.useState<string>(\"\");\n+  const strings =\n+    languageStrings.settings.searching.facetedsearchsetting.schemaselector;\n+  React.useEffect(() => {\n+    schemaListSummary().then((schemas) => {\n+      const elementList: JSX.Element[] = [\n+        <MenuItem value={undefined}>{strings.selectaschema}</MenuItem>,", "originalCommit": "48a8e3e4d56444a2f825e4b68f93490d47778fd2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU5NTQzMw==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r440595433", "bodyText": "what about selectedSchema && selectedSchema.trim() ?", "author": "PenghaiZhang", "createdAt": "2020-06-16T05:32:16Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/SchemaSelector.tsx", "diffHunk": "@@ -0,0 +1,115 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { Grid, InputLabel, MenuItem, Select } from \"@material-ui/core\";\n+import {\n+  schemaListSummary,\n+  SchemaNode,\n+  schemaTree,\n+} from \"../schema/SchemaModule\";\n+import SchemaNodeSelector from \"../settings/SchemaNodeSelector\";\n+import { languageStrings } from \"../util/langstrings\";\n+\n+interface SchemaSelectorProps {\n+  /**\n+   * Callback function triggered upon selection of a node.\n+   * @param node  Path of the selected node.\n+   */\n+  setSchemaNode: (node: string) => void;\n+}\n+\n+/**\n+ * This component defines a schema selector, for selecting a schema and then a node within.\n+ * When a schema is selected, it will display that schema within a SchemaNodeSelector.\n+ *\n+ */\n+export default function SchemaSelector({ setSchemaNode }: SchemaSelectorProps) {\n+  const [selectedSchema, setSelectedSchema] = React.useState<\n+    string | undefined\n+  >(undefined);\n+  const [schema, setSchema] = React.useState<SchemaNode>();\n+  const [schemaList, setSchemaList] = React.useState<JSX.Element[]>([]);\n+  const [schemaNodePath, setSchemaNodePath] = React.useState<string>(\"\");\n+  const strings =\n+    languageStrings.settings.searching.facetedsearchsetting.schemaselector;\n+  React.useEffect(() => {\n+    schemaListSummary().then((schemas) => {\n+      const elementList: JSX.Element[] = [\n+        <MenuItem value={undefined}>{strings.selectaschema}</MenuItem>,\n+      ];\n+      schemas.forEach((name, uuid) => {\n+        elementList.push(\n+          <MenuItem id={uuid} value={uuid}>\n+            {name}\n+          </MenuItem>\n+        );\n+      });\n+      setSchemaList(elementList);\n+    });\n+  }, []);\n+\n+  React.useEffect(() => {\n+    if (selectedSchema && selectedSchema !== \"\") {", "originalCommit": "48a8e3e4d56444a2f825e4b68f93490d47778fd2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU5NzE1MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r440597151", "bodyText": "Same as line 67.", "author": "PenghaiZhang", "createdAt": "2020-06-16T05:38:12Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/SchemaSelector.tsx", "diffHunk": "@@ -0,0 +1,115 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { Grid, InputLabel, MenuItem, Select } from \"@material-ui/core\";\n+import {\n+  schemaListSummary,\n+  SchemaNode,\n+  schemaTree,\n+} from \"../schema/SchemaModule\";\n+import SchemaNodeSelector from \"../settings/SchemaNodeSelector\";\n+import { languageStrings } from \"../util/langstrings\";\n+\n+interface SchemaSelectorProps {\n+  /**\n+   * Callback function triggered upon selection of a node.\n+   * @param node  Path of the selected node.\n+   */\n+  setSchemaNode: (node: string) => void;\n+}\n+\n+/**\n+ * This component defines a schema selector, for selecting a schema and then a node within.\n+ * When a schema is selected, it will display that schema within a SchemaNodeSelector.\n+ *\n+ */\n+export default function SchemaSelector({ setSchemaNode }: SchemaSelectorProps) {\n+  const [selectedSchema, setSelectedSchema] = React.useState<\n+    string | undefined\n+  >(undefined);\n+  const [schema, setSchema] = React.useState<SchemaNode>();\n+  const [schemaList, setSchemaList] = React.useState<JSX.Element[]>([]);\n+  const [schemaNodePath, setSchemaNodePath] = React.useState<string>(\"\");\n+  const strings =\n+    languageStrings.settings.searching.facetedsearchsetting.schemaselector;\n+  React.useEffect(() => {\n+    schemaListSummary().then((schemas) => {\n+      const elementList: JSX.Element[] = [\n+        <MenuItem value={undefined}>{strings.selectaschema}</MenuItem>,\n+      ];\n+      schemas.forEach((name, uuid) => {\n+        elementList.push(\n+          <MenuItem id={uuid} value={uuid}>\n+            {name}\n+          </MenuItem>\n+        );\n+      });\n+      setSchemaList(elementList);\n+    });\n+  }, []);\n+\n+  React.useEffect(() => {\n+    if (selectedSchema && selectedSchema !== \"\") {\n+      schemaTree(selectedSchema).then((tree) => setSchema(tree));\n+    } else {\n+      setSchema(undefined);\n+    }\n+  }, [selectedSchema]);\n+\n+  React.useEffect(() => {\n+    if (schemaNodePath !== \"\") {", "originalCommit": "48a8e3e4d56444a2f825e4b68f93490d47778fd2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU5NzQyNQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r440597425", "bodyText": "Do we need this fragment ?", "author": "PenghaiZhang", "createdAt": "2020-06-16T05:39:21Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/SchemaSelector.tsx", "diffHunk": "@@ -0,0 +1,115 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { Grid, InputLabel, MenuItem, Select } from \"@material-ui/core\";\n+import {\n+  schemaListSummary,\n+  SchemaNode,\n+  schemaTree,\n+} from \"../schema/SchemaModule\";\n+import SchemaNodeSelector from \"../settings/SchemaNodeSelector\";\n+import { languageStrings } from \"../util/langstrings\";\n+\n+interface SchemaSelectorProps {\n+  /**\n+   * Callback function triggered upon selection of a node.\n+   * @param node  Path of the selected node.\n+   */\n+  setSchemaNode: (node: string) => void;\n+}\n+\n+/**\n+ * This component defines a schema selector, for selecting a schema and then a node within.\n+ * When a schema is selected, it will display that schema within a SchemaNodeSelector.\n+ *\n+ */\n+export default function SchemaSelector({ setSchemaNode }: SchemaSelectorProps) {\n+  const [selectedSchema, setSelectedSchema] = React.useState<\n+    string | undefined\n+  >(undefined);\n+  const [schema, setSchema] = React.useState<SchemaNode>();\n+  const [schemaList, setSchemaList] = React.useState<JSX.Element[]>([]);\n+  const [schemaNodePath, setSchemaNodePath] = React.useState<string>(\"\");\n+  const strings =\n+    languageStrings.settings.searching.facetedsearchsetting.schemaselector;\n+  React.useEffect(() => {\n+    schemaListSummary().then((schemas) => {\n+      const elementList: JSX.Element[] = [\n+        <MenuItem value={undefined}>{strings.selectaschema}</MenuItem>,\n+      ];\n+      schemas.forEach((name, uuid) => {\n+        elementList.push(\n+          <MenuItem id={uuid} value={uuid}>\n+            {name}\n+          </MenuItem>\n+        );\n+      });\n+      setSchemaList(elementList);\n+    });\n+  }, []);\n+\n+  React.useEffect(() => {\n+    if (selectedSchema && selectedSchema !== \"\") {\n+      schemaTree(selectedSchema).then((tree) => setSchema(tree));\n+    } else {\n+      setSchema(undefined);\n+    }\n+  }, [selectedSchema]);\n+\n+  React.useEffect(() => {\n+    if (schemaNodePath !== \"\") {\n+      setSchemaNode(schemaNodePath);\n+    }\n+  }, [schemaNodePath]);\n+  return (\n+    <Grid container direction={\"column\"} spacing={0}>\n+      <>\n+        <Grid item>\n+          {schemaList && (\n+            <>", "originalCommit": "48a8e3e4d56444a2f825e4b68f93490d47778fd2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "df887c7fb75177327b98eb1c56b55d75b93607f5", "url": "https://github.com/openequella/openEQUELLA/commit/df887c7fb75177327b98eb1c56b55d75b93607f5", "message": "Add id to default menu item, tidy up code based on Penghai's feedback", "committedDate": "2020-06-16T06:52:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAwNjM4MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441006381", "bodyText": "maybe leverage flatMap with concat to add\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              paths.push(pathForNode(nodes, stripXml));\n          \n          \n            \n              nodes.children?.forEach((childNode) => {\n          \n          \n            \n                paths.concat(getAllPaths(childNode, paths, stripXml));\n          \n          \n            \n              });\n          \n          \n            \n            \n          \n          \n            \n              return paths;\n          \n          \n            \n              return paths.concat(pathForNode(nodes, stripXml)).concat(\n          \n          \n            \n                nodes.children?.flatMap((childNode) => {\n          \n          \n            \n                  return getAllPaths(childNode, paths, stripXml);\n          \n          \n            \n                }) ?? []\n          \n          \n            \n              );", "author": "ChristianMurphy", "createdAt": "2020-06-16T17:02:55Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/schema/SchemaModule.tsx", "diffHunk": "@@ -123,3 +125,43 @@ export const pathForNode = (node: SchemaNode, stripXml = true): string => {\n \n   return path;\n };\n+\n+/**\n+ * Recursive helper function to get a list of all possible xml paths from a given SchemaNode.\n+ * @param nodes The schema to generate paths for.\n+ * @param paths Used by the recursive algorithm to build up the returned list.\n+ *          When passing in initially, leave as a blank array.\n+ * @param stripXml Passed into pathForNode. Whether to include the leading /xml.\n+ *\n+ */\n+export const getAllPaths = (\n+  nodes: SchemaNode,\n+  paths: string[],\n+  stripXml = true\n+) => {\n+  paths.push(pathForNode(nodes, stripXml));\n+  nodes.children?.forEach((childNode) => {\n+    paths.concat(getAllPaths(childNode, paths, stripXml));\n+  });\n+\n+  return paths;", "originalCommit": "df887c7fb75177327b98eb1c56b55d75b93607f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE5ODEwNQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441198105", "bodyText": "This will put an empty array into paths if nodes.children is undefined.", "author": "PenghaiZhang", "createdAt": "2020-06-16T23:31:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAwNjM4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE5OTQwMw==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441199403", "bodyText": "It doesn't, line 142 uses concat.\nwhen concat is passed an empty array it doesn't add anything.\nTry it out in your browser console.\n['example'].concat([])", "author": "ChristianMurphy", "createdAt": "2020-06-16T23:36:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAwNjM4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwNzkyMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441207921", "bodyText": "Ah  I did a wrong experiment. I tried ['example'].concat(['a', []])  and got [\"example\", \"a\", Array []].", "author": "PenghaiZhang", "createdAt": "2020-06-17T00:06:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAwNjM4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxMjEyOQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441012129", "bodyText": "use map as an alternative forEach with push when possible.\nmap makes it visually easier to track data flow\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  const elementList: JSX.Element[] = [\n          \n          \n            \n                    <MenuItem id={strings.selectaschema} value={undefined}>\n          \n          \n            \n                      {strings.selectaschema}\n          \n          \n            \n                    </MenuItem>,\n          \n          \n            \n                  ];\n          \n          \n            \n                  schemas.forEach((name, uuid) => {\n          \n          \n            \n                    elementList.push(\n          \n          \n            \n                      <MenuItem id={uuid} value={uuid}>\n          \n          \n            \n                        {name}\n          \n          \n            \n                      </MenuItem>\n          \n          \n            \n                    );\n          \n          \n            \n                  });\n          \n          \n            \n                  setSchemaList(elementList);\n          \n          \n            \n                  const defaultListItem = [\n          \n          \n            \n                    <MenuItem id={strings.selectaschema} value={undefined}>\n          \n          \n            \n                      {strings.selectaschema}\n          \n          \n            \n                    </MenuItem>,\n          \n          \n            \n                  ];\n          \n          \n            \n                  const schemaListItems = schemas.map((name, uuid) => (\n          \n          \n            \n                    <MenuItem id={uuid} value={uuid}>\n          \n          \n            \n                      {name}\n          \n          \n            \n                    </MenuItem>\n          \n          \n            \n                  ));\n          \n          \n            \n                  setSchemaList(defaultListItem.concat(schemaListItems));", "author": "ChristianMurphy", "createdAt": "2020-06-16T17:12:56Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/SchemaSelector.tsx", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { ReactElement } from \"react\";\n+import { Grid, InputLabel, MenuItem, Select } from \"@material-ui/core\";\n+import {\n+  schemaListSummary,\n+  SchemaNode,\n+  schemaTree,\n+} from \"../schema/SchemaModule\";\n+import SchemaNodeSelector from \"../settings/SchemaNodeSelector\";\n+import { languageStrings } from \"../util/langstrings\";\n+\n+interface SchemaSelectorProps {\n+  /**\n+   * Callback function triggered upon selection of a node.\n+   * @param node  Path of the selected node.\n+   */\n+  setSchemaNode: (node: string) => void;\n+}\n+\n+/**\n+ * This component defines a schema selector, for selecting a schema and then a node within.\n+ * When a schema is selected, it will display that schema within a SchemaNodeSelector.\n+ *\n+ */\n+export default function SchemaSelector({ setSchemaNode }: SchemaSelectorProps) {\n+  const [selectedSchema, setSelectedSchema] = React.useState<\n+    string | undefined\n+  >(undefined);\n+  const [schema, setSchema] = React.useState<SchemaNode>();\n+  const [schemaList, setSchemaList] = React.useState<ReactElement[]>([]);\n+  const [schemaNodePath, setSchemaNodePath] = React.useState<string>(\"\");\n+  const strings =\n+    languageStrings.settings.searching.facetedsearchsetting.schemaselector;\n+  React.useEffect(() => {\n+    schemaListSummary().then((schemas) => {\n+      const elementList: JSX.Element[] = [\n+        <MenuItem id={strings.selectaschema} value={undefined}>\n+          {strings.selectaschema}\n+        </MenuItem>,\n+      ];\n+      schemas.forEach((name, uuid) => {\n+        elementList.push(\n+          <MenuItem id={uuid} value={uuid}>\n+            {name}\n+          </MenuItem>\n+        );\n+      });\n+      setSchemaList(elementList);", "originalCommit": "df887c7fb75177327b98eb1c56b55d75b93607f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwOTY3OA==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441209678", "bodyText": "And to just flip it around slightly. If you can simply add to your schemas with the default value at the top, then you could simply have:\nsetSchemaList(schemas.map((name, uuid) => (<MenuItem>...</MenuItem>));", "author": "edalex-ian", "createdAt": "2020-06-17T00:12:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxMjEyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2MzI4NQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441263285", "bodyText": ".map is not a function of Map<string, string> in Typescript, which is the type of schemas. At least, my IDE doesn't think so. Neither of these work.", "author": "SammyIsConfused", "createdAt": "2020-06-17T03:44:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxMjEyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxMzIwNA==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441013204", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              }, [schemaNodePath]);\n          \n          \n            \n              return (\n          \n          \n            \n              }, [schemaNodePath]);\n          \n          \n            \n            \n          \n          \n            \n              return (", "author": "ChristianMurphy", "createdAt": "2020-06-16T17:14:47Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/SchemaSelector.tsx", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { ReactElement } from \"react\";\n+import { Grid, InputLabel, MenuItem, Select } from \"@material-ui/core\";\n+import {\n+  schemaListSummary,\n+  SchemaNode,\n+  schemaTree,\n+} from \"../schema/SchemaModule\";\n+import SchemaNodeSelector from \"../settings/SchemaNodeSelector\";\n+import { languageStrings } from \"../util/langstrings\";\n+\n+interface SchemaSelectorProps {\n+  /**\n+   * Callback function triggered upon selection of a node.\n+   * @param node  Path of the selected node.\n+   */\n+  setSchemaNode: (node: string) => void;\n+}\n+\n+/**\n+ * This component defines a schema selector, for selecting a schema and then a node within.\n+ * When a schema is selected, it will display that schema within a SchemaNodeSelector.\n+ *\n+ */\n+export default function SchemaSelector({ setSchemaNode }: SchemaSelectorProps) {\n+  const [selectedSchema, setSelectedSchema] = React.useState<\n+    string | undefined\n+  >(undefined);\n+  const [schema, setSchema] = React.useState<SchemaNode>();\n+  const [schemaList, setSchemaList] = React.useState<ReactElement[]>([]);\n+  const [schemaNodePath, setSchemaNodePath] = React.useState<string>(\"\");\n+  const strings =\n+    languageStrings.settings.searching.facetedsearchsetting.schemaselector;\n+  React.useEffect(() => {\n+    schemaListSummary().then((schemas) => {\n+      const elementList: JSX.Element[] = [\n+        <MenuItem id={strings.selectaschema} value={undefined}>\n+          {strings.selectaschema}\n+        </MenuItem>,\n+      ];\n+      schemas.forEach((name, uuid) => {\n+        elementList.push(\n+          <MenuItem id={uuid} value={uuid}>\n+            {name}\n+          </MenuItem>\n+        );\n+      });\n+      setSchemaList(elementList);\n+    });\n+  }, []);\n+\n+  React.useEffect(() => {\n+    if (selectedSchema?.trim()) {\n+      schemaTree(selectedSchema).then((tree) => setSchema(tree));\n+    } else {\n+      setSchema(undefined);\n+    }\n+  }, [selectedSchema]);\n+\n+  React.useEffect(() => {\n+    if (schemaNodePath?.trim()) {\n+      setSchemaNode(schemaNodePath);\n+    }\n+  }, [schemaNodePath]);\n+  return (", "originalCommit": "df887c7fb75177327b98eb1c56b55d75b93607f5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxNDE1MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441014151", "bodyText": "using currentTarget instead of target may remove the need for the cast", "author": "ChristianMurphy", "createdAt": "2020-06-16T17:16:26Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/SchemaSelector.tsx", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { ReactElement } from \"react\";\n+import { Grid, InputLabel, MenuItem, Select } from \"@material-ui/core\";\n+import {\n+  schemaListSummary,\n+  SchemaNode,\n+  schemaTree,\n+} from \"../schema/SchemaModule\";\n+import SchemaNodeSelector from \"../settings/SchemaNodeSelector\";\n+import { languageStrings } from \"../util/langstrings\";\n+\n+interface SchemaSelectorProps {\n+  /**\n+   * Callback function triggered upon selection of a node.\n+   * @param node  Path of the selected node.\n+   */\n+  setSchemaNode: (node: string) => void;\n+}\n+\n+/**\n+ * This component defines a schema selector, for selecting a schema and then a node within.\n+ * When a schema is selected, it will display that schema within a SchemaNodeSelector.\n+ *\n+ */\n+export default function SchemaSelector({ setSchemaNode }: SchemaSelectorProps) {\n+  const [selectedSchema, setSelectedSchema] = React.useState<\n+    string | undefined\n+  >(undefined);\n+  const [schema, setSchema] = React.useState<SchemaNode>();\n+  const [schemaList, setSchemaList] = React.useState<ReactElement[]>([]);\n+  const [schemaNodePath, setSchemaNodePath] = React.useState<string>(\"\");\n+  const strings =\n+    languageStrings.settings.searching.facetedsearchsetting.schemaselector;\n+  React.useEffect(() => {\n+    schemaListSummary().then((schemas) => {\n+      const elementList: JSX.Element[] = [\n+        <MenuItem id={strings.selectaschema} value={undefined}>\n+          {strings.selectaschema}\n+        </MenuItem>,\n+      ];\n+      schemas.forEach((name, uuid) => {\n+        elementList.push(\n+          <MenuItem id={uuid} value={uuid}>\n+            {name}\n+          </MenuItem>\n+        );\n+      });\n+      setSchemaList(elementList);\n+    });\n+  }, []);\n+\n+  React.useEffect(() => {\n+    if (selectedSchema?.trim()) {\n+      schemaTree(selectedSchema).then((tree) => setSchema(tree));\n+    } else {\n+      setSchema(undefined);\n+    }\n+  }, [selectedSchema]);\n+\n+  React.useEffect(() => {\n+    if (schemaNodePath?.trim()) {\n+      setSchemaNode(schemaNodePath);\n+    }\n+  }, [schemaNodePath]);\n+  return (\n+    <Grid container direction={\"column\"} spacing={0}>\n+      <>\n+        <Grid item>\n+          {schemaList && (\n+            <Select\n+              fullWidth\n+              label={\n+                <InputLabel shrink id=\"select-label\">\n+                  {strings.schema}\n+                </InputLabel>\n+              }\n+              value={selectedSchema}\n+              displayEmpty\n+              onChange={(event) => {\n+                setSelectedSchema(event.target.value as string | undefined);", "originalCommit": "df887c7fb75177327b98eb1c56b55d75b93607f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1ODk1OQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441258959", "bodyText": "Nope, it won't. Material UI selects values are now of type unknown.", "author": "SammyIsConfused", "createdAt": "2020-06-17T03:25:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxNDE1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxNjkwNg==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441016906", "bodyText": "In general it may be easier to work with currentTarget over target, unless bubbling is explicitly needed.\nTypeScript can statically check currentTarget, it can't with target since it is dynamic.", "author": "ChristianMurphy", "createdAt": "2020-06-16T17:20:52Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetDialog.tsx", "diffHunk": "@@ -134,7 +153,24 @@ const FacetDialog = ({\n               event.target.value ? parseInt(event.target.value) : undefined\n             )\n           }\n-          helperText={\"Leave blank to display all categories\"}\n+          helperText={facetFieldStrings.categorynumberhelper}\n+        />\n+        <TextField\n+          margin=\"dense\"\n+          label={facetFieldStrings.schemanode}\n+          value={schemaNode}\n+          helperText={facetFieldStrings.schemanodehelper}\n+          onChange={(event) => {\n+            setSchemaNode(event.target.value);", "originalCommit": "df887c7fb75177327b98eb1c56b55d75b93607f5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxNzQwMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441017401", "bodyText": "Would it make sense to leverage camel case for the multi-word language strings?", "author": "ChristianMurphy", "createdAt": "2020-06-16T17:21:46Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/util/langstrings.ts", "diffHunk": "@@ -444,11 +444,25 @@ export const languageStrings = {\n       },\n       facetedsearchsetting: {\n         name: \"Faceted search settings\",\n-        add: \"Create facet\",\n+        subheading: \"Classifications\",\n+        add: \"Create classification\",\n+        edit: \"Edit classification\",\n         facetfields: {\n           name: \"Classification name\",\n+          namehelper: \"Enter name to display in the Refine search panel\",\n           schemanode: \"Schema node\",\n+          schemanodehelper:\n+            \"The categories will be generated from the selected node\",\n           categorynumber: \"Default number of categories\",\n+          categorynumberhelper: \"Leave blank to display all categories\",\n+        },\n+        schemaselector: {\n+          schema: \"Schema\",\n+          selectaschema: \"Select a schema...\",\n+          nodeselector: {\n+            expandall: \"Expand All\",\n+            collapseall: \"Collapse All\",\n+          },", "originalCommit": "df887c7fb75177327b98eb1c56b55d75b93607f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE4OTU4Mg==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441189582", "bodyText": "I remember last year I asked Jolse same question and he said all characters in lower case is the convention so... But I certainly prefer camel case.", "author": "PenghaiZhang", "createdAt": "2020-06-16T23:04:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxNzQwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwMTUyNg==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441201526", "bodyText": "It seems more of this file uses camel case than all lower case.\nSince the file isn't normalized, and Jolse is no longer involved with the project, I'd lean towards normalizing toward camel case.", "author": "ChristianMurphy", "createdAt": "2020-06-16T23:43:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxNzQwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwNDAxMg==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441204012", "bodyText": "Thoughts @edalex-ian? \ud83d\udcad", "author": "ChristianMurphy", "createdAt": "2020-06-16T23:52:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxNzQwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMjMzMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441212331", "bodyText": "I'd be keen to see it camel case, as it's hard to read and I see we've got a mix in there. Although, I wonder what convention Jolse was talking about @PenghaiZhang ? Was it perhaps that the existing oEQ language strings are all lower case - i.e. in the language string packs?", "author": "edalex-ian", "createdAt": "2020-06-17T00:22:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxNzQwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI3NTk0OA==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441275948", "bodyText": "Sorry I can't find the conversation from PR. Maybe it was just a verbal conversation which happened when I was working Cloud provider stuff.\nI prefer camel case, too.", "author": "PenghaiZhang", "createdAt": "2020-06-17T04:39:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxNzQwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMwMTgwMg==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441301802", "bodyText": "I also prefer camel case but I just kept to the existing pattern. We could create a ticket to refactor all of these strings in the future?", "author": "SammyIsConfused", "createdAt": "2020-06-17T06:09:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxNzQwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMwNjY5Mg==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441306692", "bodyText": "Changed all the new strings from this PR into camelCase. c333d68", "author": "SammyIsConfused", "createdAt": "2020-06-17T06:23:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxNzQwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMwOTc4MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441309781", "bodyText": "Good plan. To refactor all the others we can create a ticket and/or do in another PR when time permits. Going forward let's use the camels.", "author": "edalex-ian", "createdAt": "2020-06-17T06:30:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxNzQwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwNDUzMw==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441204533", "bodyText": "If you're going to match against an external mocked definition, it might be a good idea to have the input also over in the mock file. Keep them both together so they can be maintained together if needed.", "author": "edalex-ian", "createdAt": "2020-06-16T23:54:28Z", "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/schema/SchemaModule.test.ts", "diffHunk": "@@ -62,3 +63,46 @@ describe(\"pathForNode\", () => {\n       \"/xml/child1/child2/child3\"\n     ));\n });\n+\n+describe(\"getAllPaths\", () => {\n+  const schemaDefinition = {\n+    child1: {\n+      _type: \"text\",\n+      child2: { _type: \"text\", child3: { _type: \"text\" } },\n+    },\n+  };\n+  const testSchema = SchemaModule.buildSchemaTree(schemaDefinition, \"xml\");\n+  it(\"should correctly generate the list of full paths\", () => {\n+    const paths = SchemaModule.getAllPaths(testSchema, [], false);\n+    expect(paths).toEqual([\n+      \"/xml\",\n+      \"/xml/child1\",\n+      \"/xml/child1/child2\",\n+      \"/xml/child1/child2/child3\",\n+    ]);\n+  });\n+  it(\"should correctly generate the list of xml stripped paths\", () => {\n+    const paths = SchemaModule.getAllPaths(testSchema, [], true);\n+    expect(paths).toEqual([\n+      \"\",\n+      \"/child1\",\n+      \"/child1/child2\",\n+      \"/child1/child2/child3\",\n+    ]);\n+  });\n+});\n+describe(\"renderTree\", () => {\n+  const schemaDefinition = {\n+    child1: {\n+      _type: \"text\",\n+      child2: { _type: \"text\", child3: { _type: \"text\" } },\n+    },\n+  };\n+\n+  const testSchema = SchemaModule.buildSchemaTree(schemaDefinition, \"xml\");\n+  const rendered = SchemaModule.renderTree(testSchema);\n+\n+  it(\"should render the tree into nested TreeItem components correctly\", () => {\n+    expect(rendered.toString()).toEqual(jsxOutput.toString());", "originalCommit": "df887c7fb75177327b98eb1c56b55d75b93607f5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwNDg1Mw==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441204853", "bodyText": "nit: stray line", "author": "edalex-ian", "createdAt": "2020-06-16T23:55:27Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/schema/SchemaModule.tsx", "diffHunk": "@@ -123,3 +125,43 @@ export const pathForNode = (node: SchemaNode, stripXml = true): string => {\n \n   return path;\n };\n+\n+/**\n+ * Recursive helper function to get a list of all possible xml paths from a given SchemaNode.\n+ * @param nodes The schema to generate paths for.\n+ * @param paths Used by the recursive algorithm to build up the returned list.\n+ *          When passing in initially, leave as a blank array.\n+ * @param stripXml Passed into pathForNode. Whether to include the leading /xml.\n+ *", "originalCommit": "df887c7fb75177327b98eb1c56b55d75b93607f5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwNTUwNA==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441205504", "bodyText": "Could we explicitly specify the return type. Adds to doco and also provides assurance that we're writing what we think we are.", "author": "edalex-ian", "createdAt": "2020-06-16T23:57:34Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/schema/SchemaModule.tsx", "diffHunk": "@@ -123,3 +125,43 @@ export const pathForNode = (node: SchemaNode, stripXml = true): string => {\n \n   return path;\n };\n+\n+/**\n+ * Recursive helper function to get a list of all possible xml paths from a given SchemaNode.\n+ * @param nodes The schema to generate paths for.\n+ * @param paths Used by the recursive algorithm to build up the returned list.\n+ *          When passing in initially, leave as a blank array.\n+ * @param stripXml Passed into pathForNode. Whether to include the leading /xml.\n+ *\n+ */\n+export const getAllPaths = (\n+  nodes: SchemaNode,\n+  paths: string[],\n+  stripXml = true\n+) => {", "originalCommit": "df887c7fb75177327b98eb1c56b55d75b93607f5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwNjM5OA==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441206398", "bodyText": "It'd be preferable to not mutate an input (paths) and simply build up the internal list and return.", "author": "edalex-ian", "createdAt": "2020-06-17T00:00:44Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/schema/SchemaModule.tsx", "diffHunk": "@@ -123,3 +125,43 @@ export const pathForNode = (node: SchemaNode, stripXml = true): string => {\n \n   return path;\n };\n+\n+/**\n+ * Recursive helper function to get a list of all possible xml paths from a given SchemaNode.\n+ * @param nodes The schema to generate paths for.\n+ * @param paths Used by the recursive algorithm to build up the returned list.\n+ *          When passing in initially, leave as a blank array.\n+ * @param stripXml Passed into pathForNode. Whether to include the leading /xml.\n+ *\n+ */\n+export const getAllPaths = (\n+  nodes: SchemaNode,\n+  paths: string[],\n+  stripXml = true\n+) => {\n+  paths.push(pathForNode(nodes, stripXml));", "originalCommit": "df887c7fb75177327b98eb1c56b55d75b93607f5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwNjkwOA==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441206908", "bodyText": "It would be preferable to keep the Modules as much as possible focused on business logic and not presentation. Seeing that this helper function is only needed for one component, could we keep it over there for now? Otherwise, I'd be inclined to see how we could do this as a component itself.", "author": "edalex-ian", "createdAt": "2020-06-17T00:02:38Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/schema/SchemaModule.tsx", "diffHunk": "@@ -123,3 +125,43 @@ export const pathForNode = (node: SchemaNode, stripXml = true): string => {\n \n   return path;\n };\n+\n+/**\n+ * Recursive helper function to get a list of all possible xml paths from a given SchemaNode.\n+ * @param nodes The schema to generate paths for.\n+ * @param paths Used by the recursive algorithm to build up the returned list.\n+ *          When passing in initially, leave as a blank array.\n+ * @param stripXml Passed into pathForNode. Whether to include the leading /xml.\n+ *\n+ */\n+export const getAllPaths = (\n+  nodes: SchemaNode,\n+  paths: string[],\n+  stripXml = true\n+) => {\n+  paths.push(pathForNode(nodes, stripXml));\n+  nodes.children?.forEach((childNode) => {\n+    paths.concat(getAllPaths(childNode, paths, stripXml));\n+  });\n+\n+  return paths;\n+};\n+\n+/**\n+ * Recursive helper function that converts a SchemaNode into a corresponding Material UI\n+ * TreeItem tree.\n+ * @param nodes The node to generate a TreeItem for.\n+ */\n+export const renderTree = (nodes: SchemaNode) => {", "originalCommit": "df887c7fb75177327b98eb1c56b55d75b93607f5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a7550426f4f5fd63e3bf1edb3780b6e905ca3d76", "url": "https://github.com/openequella/openEQUELLA/commit/a7550426f4f5fd63e3bf1edb3780b6e905ca3d76", "message": "Move renderTree out of the module into SchemaNodeSelector.tsx", "committedDate": "2020-06-17T06:01:23Z", "type": "commit"}, {"oid": "d0fc36ce2e3da4e29ab7ea04a1de88bee4aa96b2", "url": "https://github.com/openequella/openEQUELLA/commit/d0fc36ce2e3da4e29ab7ea04a1de88bee4aa96b2", "message": "Move renderTree test into SchemaNodeSelector.test.tsx", "committedDate": "2020-06-17T06:02:16Z", "type": "commit"}, {"oid": "0785c7182d835dd84cd09b925281277ac17aecea", "url": "https://github.com/openequella/openEQUELLA/commit/0785c7182d835dd84cd09b925281277ac17aecea", "message": "Include a null check on selectedSchema", "committedDate": "2020-06-17T06:03:11Z", "type": "commit"}, {"oid": "c430e9d54cd1193ca8b9bbed1f035de6b2d12996", "url": "https://github.com/openequella/openEQUELLA/commit/c430e9d54cd1193ca8b9bbed1f035de6b2d12996", "message": "Simplify building up the schemaList", "committedDate": "2020-06-17T06:03:56Z", "type": "commit"}, {"oid": "4987530e1c3b30a4b51bae6a4a0bb6bd8d81731b", "url": "https://github.com/openequella/openEQUELLA/commit/4987530e1c3b30a4b51bae6a4a0bb6bd8d81731b", "message": "Add mock data to schemaSelectorDataMock.tsx", "committedDate": "2020-06-17T06:04:21Z", "type": "commit"}, {"oid": "c333d68dc39db3ab294819fa1c78a605db6a88c1", "url": "https://github.com/openequella/openEQUELLA/commit/c333d68dc39db3ab294819fa1c78a605db6a88c1", "message": "Change new language strings to camelCase", "committedDate": "2020-06-17T06:19:53Z", "type": "commit"}, {"oid": "321952339b40e151e28f4e60c7606d63f37dc7a0", "url": "https://github.com/openequella/openEQUELLA/commit/321952339b40e151e28f4e60c7606d63f37dc7a0", "message": "Add explanatory text to top of FacetedSearchSettingsPage", "committedDate": "2020-06-17T07:50:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM2NjY2MA==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441366660", "bodyText": "This can now just have a function body of implicit return types with arrow functions:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ): string[] => {\n          \n          \n            \n              return paths.concat(pathForNode(nodes, stripXml)).concat(\n          \n          \n            \n                nodes.children?.flatMap((childNode) => {\n          \n          \n            \n                  return getAllPaths(childNode, paths, stripXml);\n          \n          \n            \n                }) ?? []\n          \n          \n            \n              );\n          \n          \n            \n            };\n          \n          \n            \n            ): string[] =>\n          \n          \n            \n              paths\n          \n          \n            \n                .concat(pathForNode(nodes, stripXml))\n          \n          \n            \n                .concat(nodes.children?.flatMap((childNode) => getAllPaths(childNode, paths, stripXml))\n          \n          \n            \n              ?? [];", "author": "edalex-ian", "createdAt": "2020-06-17T08:18:02Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/schema/SchemaModule.tsx", "diffHunk": "@@ -132,36 +130,15 @@ export const pathForNode = (node: SchemaNode, stripXml = true): string => {\n  * @param paths Used by the recursive algorithm to build up the returned list.\n  *          When passing in initially, leave as a blank array.\n  * @param stripXml Passed into pathForNode. Whether to include the leading /xml.\n- *\n  */\n export const getAllPaths = (\n   nodes: SchemaNode,\n   paths: string[],\n   stripXml = true\n-) => {\n-  paths.push(pathForNode(nodes, stripXml));\n-  nodes.children?.forEach((childNode) => {\n-    paths.concat(getAllPaths(childNode, paths, stripXml));\n-  });\n-\n-  return paths;\n-};\n-\n-/**\n- * Recursive helper function that converts a SchemaNode into a corresponding Material UI\n- * TreeItem tree.\n- * @param nodes The node to generate a TreeItem for.\n- */\n-export const renderTree = (nodes: SchemaNode) => {\n-  return (\n-    <TreeItem\n-      key={nodes.name}\n-      nodeId={pathForNode(nodes, false)}\n-      label={nodes.name}\n-    >\n-      {Array.isArray(nodes.children)\n-        ? nodes.children.map((node) => renderTree(node))\n-        : null}\n-    </TreeItem>\n+): string[] => {\n+  return paths.concat(pathForNode(nodes, stripXml)).concat(\n+    nodes.children?.flatMap((childNode) => {\n+      return getAllPaths(childNode, paths, stripXml);\n+    }) ?? []\n   );\n };", "originalCommit": "321952339b40e151e28f4e60c7606d63f37dc7a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwOTA0MA==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441909040", "bodyText": "Fixed. Still needs the word return at the start - TS doesn't have that sugar.", "author": "SammyIsConfused", "createdAt": "2020-06-18T00:50:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM2NjY2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM2ODQyMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441368421", "bodyText": "Okay, so keeping paths just for the internal recursive mechanism, how about you swap this around and add a default:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              paths: string[],\n          \n          \n            \n              stripXml = true\n          \n          \n            \n              stripXml = true,\n          \n          \n            \n              paths: string[] = []\n          \n      \n    \n    \n  \n\nAnd then typical usage (and your current usage) would just be getAllPaths(node); or maybe occassionally getAllPaths(node, false); All while still bootstrapping your recursive algorithm.", "author": "edalex-ian", "createdAt": "2020-06-17T08:20:54Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/schema/SchemaModule.tsx", "diffHunk": "@@ -132,36 +130,15 @@ export const pathForNode = (node: SchemaNode, stripXml = true): string => {\n  * @param paths Used by the recursive algorithm to build up the returned list.\n  *          When passing in initially, leave as a blank array.\n  * @param stripXml Passed into pathForNode. Whether to include the leading /xml.\n- *\n  */\n export const getAllPaths = (\n   nodes: SchemaNode,\n   paths: string[],\n   stripXml = true", "originalCommit": "321952339b40e151e28f4e60c7606d63f37dc7a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM3MTA4Mg==", "url": "https://github.com/openequella/openEQUELLA/pull/1834#discussion_r441371082", "bodyText": "As mentioned, I'm struggling to read this with the big first sentence. Let's see tomorrow if we can come up with some different wording.", "author": "edalex-ian", "createdAt": "2020-06-17T08:25:26Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/util/langstrings.ts", "diffHunk": "@@ -444,24 +444,26 @@ export const languageStrings = {\n       },\n       facetedsearchsetting: {\n         name: \"Faceted search settings\",\n-        subheading: \"Classifications\",\n+        subHeading: \"Classifications\",\n+        explanationText:\n+          \"A classification (schema node) and its categories (unique values found within the selected schema node across all items matching search criteria) displays in the Refine search panel of the Search page. The number of matches per category is shown, and users can click on a category to view results.\",", "originalCommit": "321952339b40e151e28f4e60c7606d63f37dc7a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7d9ec4bd9383718c9dbf56094e2fc5712cbd9a3b", "url": "https://github.com/openequella/openEQUELLA/commit/7d9ec4bd9383718c9dbf56094e2fc5712cbd9a3b", "message": "Simplify explanation text", "committedDate": "2020-06-18T00:57:35Z", "type": "commit"}, {"oid": "79bfabb976433556f93fe0cd65bcf3bbb780a852", "url": "https://github.com/openequella/openEQUELLA/commit/79bfabb976433556f93fe0cd65bcf3bbb780a852", "message": "Simplify getAllPaths with a default paths array", "committedDate": "2020-06-18T00:58:31Z", "type": "commit"}, {"oid": "2dddaf2ccaa8d062cdeb13c3c21fec5a58921582", "url": "https://github.com/openequella/openEQUELLA/commit/2dddaf2ccaa8d062cdeb13c3c21fec5a58921582", "message": "Use implicit return for getAllPaths", "committedDate": "2020-06-18T01:12:13Z", "type": "commit"}]}