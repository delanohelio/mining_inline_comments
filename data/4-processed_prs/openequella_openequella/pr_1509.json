{"pr_number": 1509, "pr_title": "Back-end for Search page settings", "pr_createdAt": "2020-02-26T03:17:44Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/1509", "timeline": [{"oid": "dc30f6c797efc84ec1b8e77d9a6f39f02785cde7", "url": "https://github.com/openequella/openEQUELLA/commit/dc30f6c797efc84ec1b8e77d9a6f39f02785cde7", "message": "Create new REST endpoints to support Search page settings", "committedDate": "2020-02-26T01:13:56Z", "type": "commit"}, {"oid": "92e7f72d99181b7a99b7c60cf3ac4b470fa2e9df", "url": "https://github.com/openequella/openEQUELLA/commit/92e7f72d99181b7a99b7c60cf3ac4b470fa2e9df", "message": "Create a new test for Search page setting API", "committedDate": "2020-02-26T03:14:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDI1NTc1NA==", "url": "https://github.com/openequella/openEQUELLA/pull/1509#discussion_r384255754", "bodyText": "Maybe PUT is more suitable?", "author": "PenghaiZhang", "createdAt": "2020-02-26T03:21:23Z", "path": "Source/Plugins/Core/com.equella.core/scalasrc/com/tle/web/api/settings/SettingsResource.scala", "diffHunk": "@@ -69,4 +105,26 @@ class SettingsResource {\n   def setUISettings(in: UISettings): Unit = RunWithDB.executeWithPostCommit(\n     SettingsDB.ensureEditSystem(UISettings.setUISettings(in))\n   )\n+\n+  @GET\n+  @Path(\"searchpage\")\n+  def loadSearchPageSettings: SearchPageSettings = {\n+    searchPrivProvider.checkAuthorised()\n+    SearchPageSettings(loadSettings(new SearchSettings), loadSettings(new CloudSettings))\n+  }\n+\n+  @POST", "originalCommit": "92e7f72d99181b7a99b7c60cf3ac4b470fa2e9df", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDI1NzcwNA==", "url": "https://github.com/openequella/openEQUELLA/pull/1509#discussion_r384257704", "bodyText": "I agree with this, PUT fits better. The difference is that PUT is idempotent; meaning if you were to try the same request multiple times the output would be the same as if you did it just once. That applies to changing settings, which is update rather than create operation.", "author": "SammyIsConfused", "createdAt": "2020-02-26T03:30:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDI1NTc1NA=="}], "type": "inlineReview"}, {"oid": "0019899a8a08ab15a4fc8dfdf57cf67938104b50", "url": "https://github.com/openequella/openEQUELLA/commit/0019899a8a08ab15a4fc8dfdf57cf67938104b50", "message": "Use token rather than getToken", "committedDate": "2020-02-26T03:28:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDI1ODIwNQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1509#discussion_r384258205", "bodyText": "could defaultResultOrder become defaultSortOrder?\nAlso, for showNoneLive we need the prefix version of the term (non) rather than none as a value. So it would end up being showNonLive", "author": "SammyIsConfused", "createdAt": "2020-02-26T03:33:00Z", "path": "Source/Plugins/Core/com.equella.core/scalasrc/com/tle/web/api/settings/SettingsResource.scala", "diffHunk": "@@ -45,12 +49,44 @@ object SettingTypeLinks {\n                        if (ed.isRoute) Some(\"/\" + ed.uri) else None)\n   }\n }\n+\n+case class GalleryViewSettings(disableImage: Boolean,\n+                               disableVideo: Boolean,\n+                               disableFileCount: Boolean)\n+\n+case class SearchPageSettings(showNoneLive: Boolean,\n+                              disableGalleryViews: GalleryViewSettings,\n+                              disableCloudSearching: Boolean,\n+                              defaultResultOrder: String,", "originalCommit": "92e7f72d99181b7a99b7c60cf3ac4b470fa2e9df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5f09303561b25e78ae0f49b63200b1305ce365c7", "url": "https://github.com/openequella/openEQUELLA/commit/5f09303561b25e78ae0f49b63200b1305ce365c7", "message": "Use PUT instead of POST for updating settings", "committedDate": "2020-02-26T03:36:46Z", "type": "commit"}, {"oid": "1fcd0947f0427fbead1c6dc2a6f5f0658a6f64d7", "url": "https://github.com/openequella/openEQUELLA/commit/1fcd0947f0427fbead1c6dc2a6f5f0658a6f64d7", "message": "A couple of wording changes", "committedDate": "2020-02-26T03:43:37Z", "type": "commit"}, {"oid": "474ce9d0cd4351d4ce54296554035c33cac287d4", "url": "https://github.com/openequella/openEQUELLA/commit/474ce9d0cd4351d4ce54296554035c33cac287d4", "message": "Endpoints for 'settings/search' and 'settings/search/cloud';\n\nDisable the new test for now.", "committedDate": "2020-02-27T00:47:44Z", "type": "commit"}, {"oid": "377bb68c21095f03366cb1acf1c828f77bff737a", "url": "https://github.com/openequella/openEQUELLA/commit/377bb68c21095f03366cb1acf1c828f77bff737a", "message": "Update tests for Search setting and Cloud setting;", "committedDate": "2020-02-27T02:52:19Z", "type": "commit"}, {"oid": "b2a92936dbeb981fd4636e5fc15a852ff6dac57e", "url": "https://github.com/openequella/openEQUELLA/commit/b2a92936dbeb981fd4636e5fc15a852ff6dac57e", "message": "Update doco and remove some useless code.", "committedDate": "2020-02-27T03:35:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkwNDg4NA==", "url": "https://github.com/openequella/openEQUELLA/pull/1509#discussion_r384904884", "bodyText": "When reading this class by itself it's going to seem a bit out of place to have a stray @JsonIgnore. So how about we add a comment:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              @JsonIgnore\n          \n          \n            \n              @JsonIgnore // The REST endpoints for this was split into two - one for general search settings, and one for filters - so we don't want this included in the general search settings.", "author": "edalex-ian", "createdAt": "2020-02-27T04:13:52Z", "path": "Source/Plugins/Core/com.equella.base/src/com/tle/common/settings/standard/SearchSettings.java", "diffHunk": "@@ -73,6 +74,7 @@\n   @Property(key = \"search.defaultsort\")\n   private String defaultSearchSort;\n \n+  @JsonIgnore", "originalCommit": "b2a92936dbeb981fd4636e5fc15a852ff6dac57e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkwNTAyNg==", "url": "https://github.com/openequella/openEQUELLA/pull/1509#discussion_r384905026", "bodyText": "No need to specify the Model classes here, as Swagger will document them for you based on method typings.", "author": "edalex-ian", "createdAt": "2020-02-27T04:14:48Z", "path": "Source/Plugins/Core/com.equella.core/scalasrc/com/tle/web/api/settings/SettingsResource.scala", "diffHunk": "@@ -69,4 +87,46 @@ class SettingsResource {\n   def setUISettings(in: UISettings): Unit = RunWithDB.executeWithPostCommit(\n     SettingsDB.ensureEditSystem(UISettings.setUISettings(in))\n   )\n+\n+  @GET\n+  @Path(\"search\")\n+  @ApiOperation(\n+    value = \"Load Search settings\",\n+    notes =\n+      \"This endpoint is used to retrieve general search settings excluding search filter. The corresponding Model class is SearchSettings.\"", "originalCommit": "b2a92936dbeb981fd4636e5fc15a852ff6dac57e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkwNTMzOQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1509#discussion_r384905339", "bodyText": "As we add all these additional settings going forward we don't all want them in this one class. I suggest for each grouping we split them into their own class. So for below we'd probably add (in the same package):\n\nSearchSettingsResource\nCloudSearchSettingsResource\n\nAnd later\n\nSearchFiltersResource", "author": "edalex-ian", "createdAt": "2020-02-27T04:16:19Z", "path": "Source/Plugins/Core/com.equella.core/scalasrc/com/tle/web/api/settings/SettingsResource.scala", "diffHunk": "@@ -69,4 +87,46 @@ class SettingsResource {\n   def setUISettings(in: UISettings): Unit = RunWithDB.executeWithPostCommit(\n     SettingsDB.ensureEditSystem(UISettings.setUISettings(in))\n   )\n+\n+  @GET\n+  @Path(\"search\")\n+  @ApiOperation(\n+    value = \"Load Search settings\",\n+    notes =\n+      \"This endpoint is used to retrieve general search settings excluding search filter. The corresponding Model class is SearchSettings.\"\n+  )\n+  def loadSearchSettings: SearchSettings = {", "originalCommit": "b2a92936dbeb981fd4636e5fc15a852ff6dac57e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d4cd453888965e620b8fe76ea6b097df523b65f1", "url": "https://github.com/openequella/openEQUELLA/commit/d4cd453888965e620b8fe76ea6b097df523b65f1", "message": "Split different endpoints into their own class;", "committedDate": "2020-02-27T05:25:12Z", "type": "commit"}, {"oid": "225165d38d9a2e68561138dd13bd39768cb10d7a", "url": "https://github.com/openequella/openEQUELLA/commit/225165d38d9a2e68561138dd13bd39768cb10d7a", "message": "Reformat the comment for JsonIgnore", "committedDate": "2020-02-27T22:36:58Z", "type": "commit"}]}