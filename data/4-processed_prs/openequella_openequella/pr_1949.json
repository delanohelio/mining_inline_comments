{"pr_number": 1949, "pr_title": "EBP improvements", "pr_createdAt": "2020-06-25T08:15:35Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/1949", "timeline": [{"oid": "48c5ac32375d574211e26c9bf703780bcacde87f", "url": "https://github.com/openequella/openEQUELLA/commit/48c5ac32375d574211e26c9bf703780bcacde87f", "message": "Make the Auto-complete taxonomy control full width.", "committedDate": "2020-06-25T04:52:33Z", "type": "commit"}, {"oid": "add491ccf7beb40a38b5bc2105d1c3b1473d2335", "url": "https://github.com/openequella/openEQUELLA/commit/add491ccf7beb40a38b5bc2105d1c3b1473d2335", "message": "Make right navigation bar stick on top of Moderation page\n\nDue to different page layout, the CSS style applied on 'affix-div' has\nto be slightly different. And in Moderation page, apply this style only\nwhen the Moderation panel is invisible in viewport.", "committedDate": "2020-06-25T08:13:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4NjQ5MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1949#discussion_r445386491", "bodyText": "This new function is the only real change I made. Prettier did others I think.", "author": "PenghaiZhang", "createdAt": "2020-06-25T08:16:51Z", "path": "Source/Plugins/Core/com.equella.core/resources/web/scripts/wizardctrl.js", "diffHunk": "@@ -1,24 +1,62 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n var WizardCtrl = {\n-\tsetMessage : function(ctrlid, message)\n-\t{\n-\t\tvar $ctrl = $(\"#\" + ctrlid);\n-\t\tvar $content = $ctrl.children(\"div:first-child\");\n-\t\tvar $msg = $content.children(\"p.ctrlinvalidmessage\");\n-\t\tif (!message)\n-\t\t{\n-\t\t\t$content.removeClass(\"ctrlinvalid\");\n-\t\t\t$msg.empty();\n-\t\t}\n-\t\telse\n-\t\t{\n-\t\t\t$content.addClass(\"ctrlinvalid\");\n-\t\t\t$msg.html(message);\n-\t\t}\n-\t},\n-\taffixDiv: function() {\n-\t    var ad = $(\"#affix-div\");\n-\t    ad.attr(\"data-spy\", \"affix\");\n-\t    var offset = (ad.offset().top) - 55;\n-\t    ad.attr(\"data-offset-top\",offset);\n-\t}\n-};\n\\ No newline at end of file\n+  setMessage: function (ctrlid, message) {\n+    var $ctrl = $(\"#\" + ctrlid);\n+    var $content = $ctrl.children(\"div:first-child\");\n+    var $msg = $content.children(\"p.ctrlinvalidmessage\");\n+    if (!message) {\n+      $content.removeClass(\"ctrlinvalid\");\n+      $msg.empty();\n+    } else {\n+      $content.addClass(\"ctrlinvalid\");\n+      $msg.html(message);\n+    }\n+  },\n+  affixDiv: function () {\n+    var ad = $(\"#affix-div\");\n+    ad.attr(\"data-spy\", \"affix\");\n+    var offset = ad.offset().top - 55;\n+    ad.attr(\"data-offset-top\", offset);\n+  },\n+  affixDivNewUI: function () {", "originalCommit": "add491ccf7beb40a38b5bc2105d1c3b1473d2335", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg5NzQ0MA==", "url": "https://github.com/openequella/openEQUELLA/pull/1949#discussion_r445897440", "bodyText": "I think we're safe to use const as that's even supported in IE11 (unlike let). So we should.", "author": "edalex-ian", "createdAt": "2020-06-25T23:47:41Z", "path": "Source/Plugins/Core/com.equella.core/resources/web/scripts/wizardctrl.js", "diffHunk": "@@ -1,24 +1,62 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n var WizardCtrl = {\n-\tsetMessage : function(ctrlid, message)\n-\t{\n-\t\tvar $ctrl = $(\"#\" + ctrlid);\n-\t\tvar $content = $ctrl.children(\"div:first-child\");\n-\t\tvar $msg = $content.children(\"p.ctrlinvalidmessage\");\n-\t\tif (!message)\n-\t\t{\n-\t\t\t$content.removeClass(\"ctrlinvalid\");\n-\t\t\t$msg.empty();\n-\t\t}\n-\t\telse\n-\t\t{\n-\t\t\t$content.addClass(\"ctrlinvalid\");\n-\t\t\t$msg.html(message);\n-\t\t}\n-\t},\n-\taffixDiv: function() {\n-\t    var ad = $(\"#affix-div\");\n-\t    ad.attr(\"data-spy\", \"affix\");\n-\t    var offset = (ad.offset().top) - 55;\n-\t    ad.attr(\"data-offset-top\",offset);\n-\t}\n-};\n\\ No newline at end of file\n+  setMessage: function (ctrlid, message) {\n+    var $ctrl = $(\"#\" + ctrlid);\n+    var $content = $ctrl.children(\"div:first-child\");\n+    var $msg = $content.children(\"p.ctrlinvalidmessage\");\n+    if (!message) {\n+      $content.removeClass(\"ctrlinvalid\");\n+      $msg.empty();\n+    } else {\n+      $content.addClass(\"ctrlinvalid\");\n+      $msg.html(message);\n+    }\n+  },\n+  affixDiv: function () {\n+    var ad = $(\"#affix-div\");\n+    ad.attr(\"data-spy\", \"affix\");\n+    var offset = ad.offset().top - 55;\n+    ad.attr(\"data-offset-top\", offset);\n+  },\n+  affixDivNewUI: function () {\n+    var moderate = $(\"#moderate\");", "originalCommit": "add491ccf7beb40a38b5bc2105d1c3b1473d2335", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg5OTMxNw==", "url": "https://github.com/openequella/openEQUELLA/pull/1949#discussion_r445899317", "bodyText": "We need some improved variable names here. Maybe:\n\nmoderateTop -> moderationControlsHeight\nscrollTop -> currentWindowYPos", "author": "edalex-ian", "createdAt": "2020-06-25T23:54:32Z", "path": "Source/Plugins/Core/com.equella.core/resources/web/scripts/wizardctrl.js", "diffHunk": "@@ -1,24 +1,62 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n var WizardCtrl = {\n-\tsetMessage : function(ctrlid, message)\n-\t{\n-\t\tvar $ctrl = $(\"#\" + ctrlid);\n-\t\tvar $content = $ctrl.children(\"div:first-child\");\n-\t\tvar $msg = $content.children(\"p.ctrlinvalidmessage\");\n-\t\tif (!message)\n-\t\t{\n-\t\t\t$content.removeClass(\"ctrlinvalid\");\n-\t\t\t$msg.empty();\n-\t\t}\n-\t\telse\n-\t\t{\n-\t\t\t$content.addClass(\"ctrlinvalid\");\n-\t\t\t$msg.html(message);\n-\t\t}\n-\t},\n-\taffixDiv: function() {\n-\t    var ad = $(\"#affix-div\");\n-\t    ad.attr(\"data-spy\", \"affix\");\n-\t    var offset = (ad.offset().top) - 55;\n-\t    ad.attr(\"data-offset-top\",offset);\n-\t}\n-};\n\\ No newline at end of file\n+  setMessage: function (ctrlid, message) {\n+    var $ctrl = $(\"#\" + ctrlid);\n+    var $content = $ctrl.children(\"div:first-child\");\n+    var $msg = $content.children(\"p.ctrlinvalidmessage\");\n+    if (!message) {\n+      $content.removeClass(\"ctrlinvalid\");\n+      $msg.empty();\n+    } else {\n+      $content.addClass(\"ctrlinvalid\");\n+      $msg.html(message);\n+    }\n+  },\n+  affixDiv: function () {\n+    var ad = $(\"#affix-div\");\n+    ad.attr(\"data-spy\", \"affix\");\n+    var offset = ad.offset().top - 55;\n+    ad.attr(\"data-offset-top\", offset);\n+  },\n+  affixDivNewUI: function () {\n+    var moderate = $(\"#moderate\");\n+    var affixDiv = $(\"#affix-div\");\n+    if (moderate.length > 0) {\n+      $(window).on(\"scroll\", function () {\n+        // Use outerHeight to include margin.\n+        var moderateTop = moderate.outerHeight(true);\n+        var scrollTop = $(window).scrollTop();", "originalCommit": "add491ccf7beb40a38b5bc2105d1c3b1473d2335", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkwMDc3MA==", "url": "https://github.com/openequella/openEQUELLA/pull/1949#discussion_r445900770", "bodyText": "jQuery works such that if you add the same class again then it has no effect. And removing a non-existing class has no effect. (hmmm, unless maybe performance).\nAlso, this should be a if/else - not just two ifs. And in that case, a ternary operator would be fine I'd say.\nWith all that in mind, is this then just:\ncurrentWindowYPos >= moderationControlsHeight ?\n  affixDiv.addClass(\"moderation-rightNav\") :\n  affixDiv.removeClass(\"moderation-rightNav\" )", "author": "edalex-ian", "createdAt": "2020-06-25T23:59:39Z", "path": "Source/Plugins/Core/com.equella.core/resources/web/scripts/wizardctrl.js", "diffHunk": "@@ -1,24 +1,62 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n var WizardCtrl = {\n-\tsetMessage : function(ctrlid, message)\n-\t{\n-\t\tvar $ctrl = $(\"#\" + ctrlid);\n-\t\tvar $content = $ctrl.children(\"div:first-child\");\n-\t\tvar $msg = $content.children(\"p.ctrlinvalidmessage\");\n-\t\tif (!message)\n-\t\t{\n-\t\t\t$content.removeClass(\"ctrlinvalid\");\n-\t\t\t$msg.empty();\n-\t\t}\n-\t\telse\n-\t\t{\n-\t\t\t$content.addClass(\"ctrlinvalid\");\n-\t\t\t$msg.html(message);\n-\t\t}\n-\t},\n-\taffixDiv: function() {\n-\t    var ad = $(\"#affix-div\");\n-\t    ad.attr(\"data-spy\", \"affix\");\n-\t    var offset = (ad.offset().top) - 55;\n-\t    ad.attr(\"data-offset-top\",offset);\n-\t}\n-};\n\\ No newline at end of file\n+  setMessage: function (ctrlid, message) {\n+    var $ctrl = $(\"#\" + ctrlid);\n+    var $content = $ctrl.children(\"div:first-child\");\n+    var $msg = $content.children(\"p.ctrlinvalidmessage\");\n+    if (!message) {\n+      $content.removeClass(\"ctrlinvalid\");\n+      $msg.empty();\n+    } else {\n+      $content.addClass(\"ctrlinvalid\");\n+      $msg.html(message);\n+    }\n+  },\n+  affixDiv: function () {\n+    var ad = $(\"#affix-div\");\n+    ad.attr(\"data-spy\", \"affix\");\n+    var offset = ad.offset().top - 55;\n+    ad.attr(\"data-offset-top\", offset);\n+  },\n+  affixDivNewUI: function () {\n+    var moderate = $(\"#moderate\");\n+    var affixDiv = $(\"#affix-div\");\n+    if (moderate.length > 0) {\n+      $(window).on(\"scroll\", function () {\n+        // Use outerHeight to include margin.\n+        var moderateTop = moderate.outerHeight(true);\n+        var scrollTop = $(window).scrollTop();\n+        if (\n+          scrollTop >= moderateTop &&\n+          !affixDiv.hasClass(\"moderation-rightNav\")\n+        ) {\n+          affixDiv.addClass(\"moderation-rightNav\");\n+        }\n+        if (\n+          scrollTop < moderateTop &&\n+          affixDiv.hasClass(\"moderation-rightNav\")\n+        ) {\n+          affixDiv.removeClass(\"moderation-rightNav\");\n+        }", "originalCommit": "add491ccf7beb40a38b5bc2105d1c3b1473d2335", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkwOTkxMg==", "url": "https://github.com/openequella/openEQUELLA/pull/1949#discussion_r445909912", "bodyText": "Yeah performance was what I was thinking yesterday although it shouldn't cause huge performance issue.", "author": "PenghaiZhang", "createdAt": "2020-06-26T00:36:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkwMDc3MA=="}], "type": "inlineReview"}, {"oid": "158a6eba41ab75833112755bda7acaf668741be7", "url": "https://github.com/openequella/openEQUELLA/commit/158a6eba41ab75833112755bda7acaf668741be7", "message": "Improve readability of JS function 'affixDivNewUI'.", "committedDate": "2020-06-26T00:39:44Z", "type": "commit"}, {"oid": "e936dc65ecf06076ebd0e28f5c1213a2a6a8232c", "url": "https://github.com/openequella/openEQUELLA/commit/e936dc65ecf06076ebd0e28f5c1213a2a6a8232c", "message": "Attempt to pass TaxonomyControlsTest on GHA\n\nGHA's builds failed TaxonomyControlsTest because the test somehow selected\na wrong taxonomy term. So try to ensure right term is selected.", "committedDate": "2020-06-26T04:50:26Z", "type": "commit"}, {"oid": "34db9f55b6b4194781f9f85508e40231afbdff10", "url": "https://github.com/openequella/openEQUELLA/commit/34db9f55b6b4194781f9f85508e40231afbdff10", "message": "Use Media Queries to control the width of auto-complete taxonomy control.", "committedDate": "2020-06-26T06:51:26Z", "type": "commit"}, {"oid": "f098c89ce5b812a8dbe5777ad312614f9468e833", "url": "https://github.com/openequella/openEQUELLA/commit/f098c89ce5b812a8dbe5777ad312614f9468e833", "message": "Revert \"Attempt to pass TaxonomyControlsTest on GHA\"\n\nThis reverts commit e936dc65ecf06076ebd0e28f5c1213a2a6a8232c.", "committedDate": "2020-06-26T06:53:57Z", "type": "commit"}]}