{"pr_number": 2434, "pr_title": "Show Item's star ratings in new search page", "pr_createdAt": "2020-10-19T03:11:06Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/2434", "timeline": [{"oid": "508002e2c4ac91efe7486e1ce26cb72a21636be7", "url": "https://github.com/openequella/openEQUELLA/commit/508002e2c4ac91efe7486e1ce26cb72a21636be7", "message": "Include Item's star ratings in search2 response.", "committedDate": "2020-10-19T00:10:00Z", "type": "commit"}, {"oid": "925165f0aa89c8b9de44b177b849a72692b631bd", "url": "https://github.com/openequella/openEQUELLA/commit/925165f0aa89c8b9de44b177b849a72692b631bd", "message": "Update the type definition of search result Item to\ninclude star rating.", "committedDate": "2020-10-19T00:10:00Z", "type": "commit"}, {"oid": "6f44fbda6e71f1596d5bddbf973445102fb2ca32", "url": "https://github.com/openequella/openEQUELLA/commit/6f44fbda6e71f1596d5bddbf973445102fb2ca32", "message": "Use MUI star icons to represent Item's ratings.", "committedDate": "2020-10-19T00:16:56Z", "type": "commit"}, {"oid": "04802359482169a2506513a3e7d2d7cdbcbae2e9", "url": "https://github.com/openequella/openEQUELLA/commit/04802359482169a2506513a3e7d2d7cdbcbae2e9", "message": "Show star ratings when the rating is 0.", "committedDate": "2020-10-19T00:43:34Z", "type": "commit"}, {"oid": "dfa8ac9a0b145fc42672ea9b3e42d7655a92c2b6", "url": "https://github.com/openequella/openEQUELLA/commit/dfa8ac9a0b145fc42672ea9b3e42d7655a92c2b6", "message": "Improve the accessibility of MUI Star icons.", "committedDate": "2020-10-19T01:05:56Z", "type": "commit"}, {"oid": "22dc8be5f9ea464b29913701ac5b938343101db4", "url": "https://github.com/openequella/openEQUELLA/commit/22dc8be5f9ea464b29913701ac5b938343101db4", "message": "Add a JEST test to check if Item's star ratings are displayed.", "committedDate": "2020-10-19T03:02:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQwMTc0OQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2434#discussion_r507401749", "bodyText": "I have run NewSearchPageTest and I did not find any ACL issue with low privileged user so I think the type does not need to be Option.\nAlso I did not find  any permission about viewing the rating.", "author": "PenghaiZhang", "createdAt": "2020-10-19T03:18:51Z", "path": "Source/Plugins/Core/com.equella.core/scalasrc/com/tle/web/api/search/model/SearchResultItem.scala", "diffHunk": "@@ -50,6 +50,7 @@ case class SearchResultItem(\n     modifiedDate: Date,\n     collectionId: String,\n     commentCount: Option[Integer],\n+    starRatings: Float,", "originalCommit": "22dc8be5f9ea464b29913701ac5b938343101db4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg3ODkwMw==", "url": "https://github.com/openequella/openEQUELLA/pull/2434#discussion_r507878903", "bodyText": "Will this work?\nFloating point equality can have some quirks, but I think this will be okay?", "author": "ChristianMurphy", "createdAt": "2020-10-19T16:13:04Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -140,6 +144,26 @@ export default function SearchResult({\n       />\n     );\n \n+    /**\n+     * Generate star icons for Item's ratings.\n+     * Each rating will be rounded to its nearest 0.5.\n+     * For example, 3.33 will be 3.5 and 3.23 will be 3.\n+     */\n+    const showStar = () => {\n+      const rating = Math.round(starRatings * 2) / 2;\n+      return [1, 2, 3, 4, 5].map((i) => {\n+        if (i <= rating) {\n+          return <Star aria-label=\"full-star\" key={i} />;\n+        }\n+\n+        if (i - 0.5 === rating) {", "originalCommit": "22dc8be5f9ea464b29913701ac5b938343101db4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODExOTU4Nw==", "url": "https://github.com/openequella/openEQUELLA/pull/2434#discussion_r508119587", "bodyText": "Hi @ChristianMurphy , yes, it works in this case. I can also set a epsilon. Do you have any better recommendations for handling float numbers with TS", "author": "PenghaiZhang", "createdAt": "2020-10-19T23:28:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg3ODkwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEyMTc2OA==", "url": "https://github.com/openequella/openEQUELLA/pull/2434#discussion_r508121768", "bodyText": "This could be fine.\nThe alternative would be to skip the / 2 above and use whole numbers/ints.\nBut since this works as is, let's leave it.", "author": "ChristianMurphy", "createdAt": "2020-10-19T23:35:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg3ODkwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg4NjUzMA==", "url": "https://github.com/openequella/openEQUELLA/pull/2434#discussion_r507886530", "bodyText": "neat way of preventing >5 stars \ud83d\udc4d \ud83c\udf1f", "author": "ChristianMurphy", "createdAt": "2020-10-19T16:24:17Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -140,6 +144,26 @@ export default function SearchResult({\n       />\n     );\n \n+    /**\n+     * Generate star icons for Item's ratings.\n+     * Each rating will be rounded to its nearest 0.5.\n+     * For example, 3.33 will be 3.5 and 3.23 will be 3.\n+     */\n+    const showStar = () => {\n+      const rating = Math.round(starRatings * 2) / 2;\n+      return [1, 2, 3, 4, 5].map((i) => {", "originalCommit": "22dc8be5f9ea464b29913701ac5b938343101db4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg5MTU2NQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2434#discussion_r507891565", "bodyText": "-1 is this context means no rating?\nwould it make sense to not pass the attribute starRatings if there are not ratings?", "author": "ChristianMurphy", "createdAt": "2020-10-19T16:31:46Z", "path": "Source/Plugins/Core/com.equella.core/js/__mocks__/searchresult_mock_data.ts", "diffHunk": "@@ -140,6 +143,7 @@ const customMetaSearchObj: OEQ.Search.SearchResultItem = {\n   modifiedDate: new Date(\"2020-05-26T12:45:06.857+10:00\"),\n   collectionId: \"b28f1ffe-2008-4f5e-d559-83c8acd79316\",\n   commentCount: 0,\n+  starRatings: -1,", "originalCommit": "22dc8be5f9ea464b29913701ac5b938343101db4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEyMTIzNg==", "url": "https://github.com/openequella/openEQUELLA/pull/2434#discussion_r508121236", "bodyText": "Yes, it means no rating.\nI can make this field optional.  On server side, check if the value is -1 or not and return the value if it's not -1.", "author": "PenghaiZhang", "createdAt": "2020-10-19T23:33:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg5MTU2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEyMzM3Nw==", "url": "https://github.com/openequella/openEQUELLA/pull/2434#discussion_r508123377", "bodyText": "Okay,\nis the reason behind this decision to avoid null values in the DB?\nOr something else?", "author": "ChristianMurphy", "createdAt": "2020-10-19T23:40:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg5MTU2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEyNTA5OQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2434#discussion_r508125099", "bodyText": "Sorry I don't know the reason. This was implemented long long ago by someone else without explaining why use -1. But since the type is float, I think the value defaults to 0.0f.", "author": "PenghaiZhang", "createdAt": "2020-10-19T23:45:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg5MTU2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEyODczMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2434#discussion_r508128731", "bodyText": "ah, so this is an existing pattern, got it.", "author": "ChristianMurphy", "createdAt": "2020-10-19T23:56:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg5MTU2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI0MzY4Mw==", "url": "https://github.com/openequella/openEQUELLA/pull/2434#discussion_r508243683", "bodyText": "Missing @param in above ScalaDoc.", "author": "edalex-ian", "createdAt": "2020-10-20T06:38:49Z", "path": "Source/Plugins/Core/com.equella.core/scalasrc/com/tle/web/api/search/model/SearchResultItem.scala", "diffHunk": "@@ -50,6 +50,7 @@ case class SearchResultItem(\n     modifiedDate: Date,\n     collectionId: String,\n     commentCount: Option[Integer],\n+    starRatings: Float,", "originalCommit": "22dc8be5f9ea464b29913701ac5b938343101db4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI0NTQ1Mw==", "url": "https://github.com/openequella/openEQUELLA/pull/2434#discussion_r508245453", "bodyText": "Nit: Should be else if, but hey.", "author": "edalex-ian", "createdAt": "2020-10-20T06:42:26Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -140,6 +144,26 @@ export default function SearchResult({\n       />\n     );\n \n+    /**\n+     * Generate star icons for Item's ratings.\n+     * Each rating will be rounded to its nearest 0.5.\n+     * For example, 3.33 will be 3.5 and 3.23 will be 3.\n+     */\n+    const showStar = () => {\n+      const rating = Math.round(starRatings * 2) / 2;\n+      return [1, 2, 3, 4, 5].map((i) => {\n+        if (i <= rating) {\n+          return <Star aria-label=\"full-star\" key={i} />;\n+        }\n+\n+        if (i - 0.5 === rating) {", "originalCommit": "22dc8be5f9ea464b29913701ac5b938343101db4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7396811b7fad318c05d7256b00a0b2012a6c6753", "url": "https://github.com/openequella/openEQUELLA/commit/7396811b7fad318c05d7256b00a0b2012a6c6753", "message": "Add ScalaDoc for starRatings.", "committedDate": "2020-10-23T04:18:36Z", "type": "commit"}, {"oid": "b7c90ad1b1be9f2612fb407541dfcbd4b5662056", "url": "https://github.com/openequella/openEQUELLA/commit/b7c90ad1b1be9f2612fb407541dfcbd4b5662056", "message": "Add a new component and Storybook for StarRating.", "committedDate": "2020-10-23T04:49:27Z", "type": "commit"}, {"oid": "e8d90a40ee942cd5003127f2bacfdc81d65dd7a7", "url": "https://github.com/openequella/openEQUELLA/commit/e8d90a40ee942cd5003127f2bacfdc81d65dd7a7", "message": "Move component StarRating to the right folder and update imports\nof this component.", "committedDate": "2020-10-23T05:08:57Z", "type": "commit"}, {"oid": "d1407a9e1e80738f9ba879105778837235442021", "url": "https://github.com/openequella/openEQUELLA/commit/d1407a9e1e80738f9ba879105778837235442021", "message": "Add a Jest test for component StarRating.", "committedDate": "2020-10-23T06:07:17Z", "type": "commit"}, {"oid": "f15b59cdbf5a5de9baba796106c15b48a63df9f3", "url": "https://github.com/openequella/openEQUELLA/commit/f15b59cdbf5a5de9baba796106c15b48a63df9f3", "message": "Merge branch 'develop' into feature/view-star-ratings-from-search-page", "committedDate": "2020-10-23T06:13:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY2MTk2NQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2434#discussion_r510661965", "bodyText": "Probably good to rename this something like 'HalfStarRating' - as that's the state I guess you're demonstrating here (that is, where one of the stars is only half).\nProbably then good to also have stories to cover the examples of:\n\nNo stars;\nFull stars; and\nDifferent number of stars.", "author": "edalex-ian", "createdAt": "2020-10-23T06:28:48Z", "path": "Source/Plugins/Core/com.equella.core/js/__stories__/components/StarRating.stories.tsx", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import { Meta, Story } from \"@storybook/react\";\n+import * as React from \"react\";\n+import { StarRating, StarRatingProps } from \"../../tsrc/components/StarRating\";\n+\n+export default {\n+  title: \"StarRating\",\n+  component: StarRating,\n+} as Meta<StarRatingProps>;\n+\n+export const FiveStars: Story<StarRatingProps> = (args) => (", "originalCommit": "f15b59cdbf5a5de9baba796106c15b48a63df9f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY2MzA2Nw==", "url": "https://github.com/openequella/openEQUELLA/pull/2434#discussion_r510663067", "bodyText": "Either this (or additional tests) should be testing boundaries. That is:\n\nTesting for ratings of: 0, half max, max, max + 1;\nTesting for number of stars: 0, 5, lots; amd\nTesting your rounding logic - to make sure it goes up to half, down to whole, etc.\n\nBeing able to easily test all that (at speed) is the real benefit you get here of splitting it out. And combined with parametrised tests, you should be able to do that succinctly.", "author": "edalex-ian", "createdAt": "2020-10-23T06:31:43Z", "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/components/StarRating.test.tsx", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import \"@testing-library/jest-dom/extend-expect\";\n+import { render } from \"@testing-library/react\";\n+import * as React from \"react\";\n+import { StarRating } from \"../../../tsrc/components/StarRating\";\n+\n+describe(\"<StarRating />\", () => {\n+  it.each([", "originalCommit": "f15b59cdbf5a5de9baba796106c15b48a63df9f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY2MzcxOA==", "url": "https://github.com/openequella/openEQUELLA/pull/2434#discussion_r510663718", "bodyText": "Should probably be a language string.", "author": "edalex-ian", "createdAt": "2020-10-23T06:33:41Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -236,6 +238,15 @@ export default function SearchResult({\n             </Typography>\n           </>\n         )}\n+\n+        {starRatings >= 0 && (\n+          <>\n+            {metaDataDivider}\n+            <div aria-label={`item rating: ${starRatings}`}>", "originalCommit": "f15b59cdbf5a5de9baba796106c15b48a63df9f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "02ca33df39a53ab2ef9862cad487e421580b4bf8", "url": "https://github.com/openequella/openEQUELLA/commit/02ca33df39a53ab2ef9862cad487e421580b4bf8", "message": "Add more Stories for component StarRating.", "committedDate": "2020-10-25T23:27:18Z", "type": "commit"}, {"oid": "9159ffb6db4e0118cedd19efffedc479205aceea", "url": "https://github.com/openequella/openEQUELLA/commit/9159ffb6db4e0118cedd19efffedc479205aceea", "message": "Use language string as Star rating label text.", "committedDate": "2020-10-26T00:03:18Z", "type": "commit"}, {"oid": "e804598b11ecc63f1cea8d05e6904ed311eadd4f", "url": "https://github.com/openequella/openEQUELLA/commit/e804598b11ecc63f1cea8d05e6904ed311eadd4f", "message": "More Jest tests for component StarRating\n\n1. Add tests to check the round logic.\n2. Add tests to check the number of displayed stars.\n3. Add tests to check if the rating is correctly represented\nby Star Icons.", "committedDate": "2020-10-26T00:36:45Z", "type": "commit"}, {"oid": "318ea335fe1d9295d5bf7504d2cd4820f70a10d2", "url": "https://github.com/openequella/openEQUELLA/commit/318ea335fe1d9295d5bf7504d2cd4820f70a10d2", "message": "Update SearchResult Test for Star rating.", "committedDate": "2020-10-26T00:44:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM2NDEwMA==", "url": "https://github.com/openequella/openEQUELLA/pull/2434#discussion_r512364100", "bodyText": "Sorry, should of mentioned this before. Bit by bit I'm trying to keep these stories a bit more structured in the Storybook UI. As a result, could you please change this to:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              title: \"StarRating\",\n          \n          \n            \n              title: \"component/StarRating\",", "author": "edalex-ian", "createdAt": "2020-10-27T01:34:11Z", "path": "Source/Plugins/Core/com.equella.core/js/__stories__/components/StarRating.stories.tsx", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import { Meta, Story } from \"@storybook/react\";\n+import * as React from \"react\";\n+import { StarRating, StarRatingProps } from \"../../tsrc/components/StarRating\";\n+\n+export default {\n+  title: \"StarRating\",", "originalCommit": "318ea335fe1d9295d5bf7504d2cd4820f70a10d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "570a0478826071b9c88ecfc3456c0c4e65df5498", "url": "https://github.com/openequella/openEQUELLA/commit/570a0478826071b9c88ecfc3456c0c4e65df5498", "message": "Update the title of StarRating Storybook\n\nCo-authored-by: edalex-ian <43919233+edalex-ian@users.noreply.github.com>", "committedDate": "2020-10-27T02:45:52Z", "type": "commit"}]}