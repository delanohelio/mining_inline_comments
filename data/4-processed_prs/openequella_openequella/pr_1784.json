{"pr_number": 1784, "pr_title": "Add support to the REST Client API to call the \u2018normal' Search REST API", "pr_createdAt": "2020-06-04T05:51:07Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/1784", "timeline": [{"oid": "8c0e1a34990928b291b9f9dc08c232b65c96ea4e", "url": "https://github.com/openequella/openEQUELLA/commit/8c0e1a34990928b291b9f9dc08c232b65c96ea4e", "message": "oeq-ts-rest-api: Add support for searching by the new REST search endpoint.\nThis includes: models for search result, a function calling the 'search2'\nand check the type of returned data and one Jest test.\n\nAdd 'paramsSerializer' to the GET method in order to pass an\narray as a query parameter.", "committedDate": "2020-06-04T05:45:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAwOTg0Mg==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435009842", "bodyText": "The reason to add this is because the default query string format for array is not accepted on oEQ Server.\nFor example, /search2/?status[]=xxx&status[]=yyy  is not OK but /search2/?status=xxx&status=yyy is fine.\nAnybody have better ideas?", "author": "PenghaiZhang", "createdAt": "2020-06-04T06:00:06Z", "path": "oeq-ts-rest-api/src/AxiosInstance.ts", "diffHunk": "@@ -19,7 +20,7 @@ export const GET = <T>(\n   queryParams?: object\n ): Promise<T> =>\n   axios\n-    .get<T>(path, {params: queryParams})\n+    .get<T>(path, {params: queryParams, paramsSerializer: params => stringify(params)}, )", "originalCommit": "8c0e1a34990928b291b9f9dc08c232b65c96ea4e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxNjIyOA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435016228", "bodyText": "I'm fine with that. But see my comment, as we may want to use a slightly more active module.", "author": "edalex-ian", "createdAt": "2020-06-04T06:19:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAwOTg0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxMDQ3NQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435010475", "bodyText": "I feel this Jest test is more focused on validating the returned data type and handling errors rather than checking if the search result is correct or not.\nWe have another test Search2ApiTest which check the search results.", "author": "PenghaiZhang", "createdAt": "2020-06-04T06:02:23Z", "path": "oeq-ts-rest-api/test/search.test.ts", "diffHunk": "@@ -0,0 +1,56 @@\n+import * as Search from '../src/Search';\n+import * as SearchResult from '../src/SearchResult';\n+import * as Common from '../src/Common';\n+import * as Auth from '../src/Auth';\n+import * as TC from './TestConfig';\n+import * as Errors from \"../src/Errors\";\n+\n+beforeAll(() => Auth.login(TC.API_PATH, TC.USERNAME, TC.PASSWORD));\n+afterAll(() => Auth.logout(TC.API_PATH, true));\n+\n+describe(\"Search for items\", () => {", "originalCommit": "8c0e1a34990928b291b9f9dc08c232b65c96ea4e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxNjUzNA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435016534", "bodyText": "Correct. The Jest tests here are to ensure the API comms work. The test of the actual search logic is a core oEQ testing concern. \ud83d\udc4d", "author": "edalex-ian", "createdAt": "2020-06-04T06:20:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxMDQ3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAwOTg3Ng==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435009876", "bodyText": "Please add JSDoc at the interface level too.", "author": "edalex-ian", "createdAt": "2020-06-04T06:00:13Z", "path": "oeq-ts-rest-api/src/Search.ts", "diffHunk": "@@ -0,0 +1,70 @@\n+import * as Common from './Common';\n+import { is } from 'typescript-is';\n+import * as SearchResult from './SearchResult';\n+import {GET} from './AxiosInstance';\n+\n+export interface SearchParams {", "originalCommit": "8c0e1a34990928b291b9f9dc08c232b65c96ea4e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxMDI0OA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435010248", "bodyText": "No need for this to be in its own stand-alone function. You'll see the others have just defined it where used. I see you've also exported it, but AFAICT it's not needed anywhere else.", "author": "edalex-ian", "createdAt": "2020-06-04T06:01:31Z", "path": "oeq-ts-rest-api/src/Search.ts", "diffHunk": "@@ -0,0 +1,70 @@\n+import * as Common from './Common';\n+import { is } from 'typescript-is';\n+import * as SearchResult from './SearchResult';\n+import {GET} from './AxiosInstance';\n+\n+export interface SearchParams {\n+  /**\n+   * Query string.\n+   */\n+  query?: string;\n+  /**\n+   * The first record of the search results to return.\n+   */\n+  start?: number;\n+  /**\n+   * The number of results to return.\n+   */\n+  length?: number;\n+  /**\n+   * List of collections.\n+   */\n+  collections?: string[];\n+  /**\n+   * The order of the search results.\n+   */\n+  order?: string;\n+  /**\n+   * Reverse the order of the search results.\n+   */\n+  reverseOrder?: boolean;\n+  /**\n+   * An advanced search UUID.\n+   */\n+  advancedSearch?: string;\n+  /**\n+   * A where clause.\n+   */\n+  whereClause?: string;\n+  /**\n+   * Item status.\n+   */\n+  status?: SearchResult.ItemStatus[];\n+  /**\n+   * A date before which items are modified. Date format (yyyy-MM-dd).\n+   */\n+  modifiedBefore?: string;\n+  /**\n+   * A date after which items are modified. Date format (yyyy-MM-dd).\n+   */\n+  modifiedAfter?: string;\n+  /**\n+   * An ID of a user.\n+   */\n+  owner?: string;\n+  /**\n+   * single dynamic collection uuid.\n+   */\n+  dynaCollection?: string;\n+}\n+\n+export const isPagedSearchResultItem = (instance: unknown): boolean =>\n+  is<Common.PagedResult<SearchResult.Item>>(instance);", "originalCommit": "8c0e1a34990928b291b9f9dc08c232b65c96ea4e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxMDcyNQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435010725", "bodyText": "File level comments:\n\nAll the interfaces here should be in either Common and over in Search, there's no need for this file; and\nAll of the interfaces in this file are missing JSDoc.", "author": "edalex-ian", "createdAt": "2020-06-04T06:03:07Z", "path": "oeq-ts-rest-api/src/SearchResult.ts", "diffHunk": "@@ -0,0 +1,50 @@\n+import * as Common from './Common';", "originalCommit": "8c0e1a34990928b291b9f9dc08c232b65c96ea4e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxMTE1OQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435011159", "bodyText": "We believe (thanks to the recent updates from @ChristianMurphy ), that we don't need this if you define the test as async and use await for the API call - see the other tests.", "author": "edalex-ian", "createdAt": "2020-06-04T06:04:36Z", "path": "oeq-ts-rest-api/test/search.test.ts", "diffHunk": "@@ -0,0 +1,56 @@\n+import * as Search from '../src/Search';\n+import * as SearchResult from '../src/SearchResult';\n+import * as Common from '../src/Common';\n+import * as Auth from '../src/Auth';\n+import * as TC from './TestConfig';\n+import * as Errors from \"../src/Errors\";\n+\n+beforeAll(() => Auth.login(TC.API_PATH, TC.USERNAME, TC.PASSWORD));\n+afterAll(() => Auth.logout(TC.API_PATH, true));\n+\n+describe(\"Search for items\", () => {\n+  const SEARCH_API_PATH = `${TC.API_PATH}/search2`;\n+\n+  it(\"should be able to search without params\", () => {\n+    expect.assertions(4);", "originalCommit": "8c0e1a34990928b291b9f9dc08c232b65c96ea4e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxMTkzNw==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435011937", "bodyText": "Missing JSDoc.\nKeep in mind the pattern is that searchPath is just meant to be apiBasePath. It then uses that to build the full path so that the caller does not need to worry about the routes etc. (See others as examples.)", "author": "edalex-ian", "createdAt": "2020-06-04T06:07:00Z", "path": "oeq-ts-rest-api/src/Search.ts", "diffHunk": "@@ -0,0 +1,70 @@\n+import * as Common from './Common';\n+import { is } from 'typescript-is';\n+import * as SearchResult from './SearchResult';\n+import {GET} from './AxiosInstance';\n+\n+export interface SearchParams {\n+  /**\n+   * Query string.\n+   */\n+  query?: string;\n+  /**\n+   * The first record of the search results to return.\n+   */\n+  start?: number;\n+  /**\n+   * The number of results to return.\n+   */\n+  length?: number;\n+  /**\n+   * List of collections.\n+   */\n+  collections?: string[];\n+  /**\n+   * The order of the search results.\n+   */\n+  order?: string;\n+  /**\n+   * Reverse the order of the search results.\n+   */\n+  reverseOrder?: boolean;\n+  /**\n+   * An advanced search UUID.\n+   */\n+  advancedSearch?: string;\n+  /**\n+   * A where clause.\n+   */\n+  whereClause?: string;\n+  /**\n+   * Item status.\n+   */\n+  status?: SearchResult.ItemStatus[];\n+  /**\n+   * A date before which items are modified. Date format (yyyy-MM-dd).\n+   */\n+  modifiedBefore?: string;\n+  /**\n+   * A date after which items are modified. Date format (yyyy-MM-dd).\n+   */\n+  modifiedAfter?: string;\n+  /**\n+   * An ID of a user.\n+   */\n+  owner?: string;\n+  /**\n+   * single dynamic collection uuid.\n+   */\n+  dynaCollection?: string;\n+}\n+\n+export const isPagedSearchResultItem = (instance: unknown): boolean =>\n+  is<Common.PagedResult<SearchResult.Item>>(instance);\n+\n+export const search = (searchPath: string, params?: SearchParams): Promise<Common.PagedResult<SearchResult.Item>> => {", "originalCommit": "8c0e1a34990928b291b9f9dc08c232b65c96ea4e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxMjIzNg==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435012236", "bodyText": "As mentioned in Search.ts, this path should be internalised to Search.ts.", "author": "edalex-ian", "createdAt": "2020-06-04T06:07:53Z", "path": "oeq-ts-rest-api/test/search.test.ts", "diffHunk": "@@ -0,0 +1,56 @@\n+import * as Search from '../src/Search';\n+import * as SearchResult from '../src/SearchResult';\n+import * as Common from '../src/Common';\n+import * as Auth from '../src/Auth';\n+import * as TC from './TestConfig';\n+import * as Errors from \"../src/Errors\";\n+\n+beforeAll(() => Auth.login(TC.API_PATH, TC.USERNAME, TC.PASSWORD));\n+afterAll(() => Auth.logout(TC.API_PATH, true));\n+\n+describe(\"Search for items\", () => {\n+  const SEARCH_API_PATH = `${TC.API_PATH}/search2`;", "originalCommit": "8c0e1a34990928b291b9f9dc08c232b65c96ea4e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxMjc4NA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435012784", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              it(\"should get 404 response if search for an non-existing collection\", () => {\n          \n          \n            \n              it(\"should get 404 response if search for a non-existing collection\", () => {", "author": "edalex-ian", "createdAt": "2020-06-04T06:09:38Z", "path": "oeq-ts-rest-api/test/search.test.ts", "diffHunk": "@@ -0,0 +1,56 @@\n+import * as Search from '../src/Search';\n+import * as SearchResult from '../src/SearchResult';\n+import * as Common from '../src/Common';\n+import * as Auth from '../src/Auth';\n+import * as TC from './TestConfig';\n+import * as Errors from \"../src/Errors\";\n+\n+beforeAll(() => Auth.login(TC.API_PATH, TC.USERNAME, TC.PASSWORD));\n+afterAll(() => Auth.logout(TC.API_PATH, true));\n+\n+describe(\"Search for items\", () => {\n+  const SEARCH_API_PATH = `${TC.API_PATH}/search2`;\n+\n+  it(\"should be able to search without params\", () => {\n+    expect.assertions(4);\n+    return Search.search(SEARCH_API_PATH).then(\n+      (pagedResult: Common.PagedResult<SearchResult.Item>) => {\n+        // The default start is 0 and length of search results is 10.\n+        expect(pagedResult.start).toBe(0);\n+        expect(pagedResult).toHaveLength(10);\n+        expect(pagedResult.available).toBeGreaterThan(0);\n+        expect(pagedResult.results).toHaveLength(10)\n+      }\n+    )\n+  });\n+\n+  it(\"should be able to search with params\", () => {\n+    expect.assertions(4);\n+    const collection = \"a77112e6-3370-fd02-6ac6-6bc5aec22001\";\n+    const searchParams: Search.SearchParams = {\n+      query: \"API\",\n+      status: [SearchResult.ItemStatus.LIVE],\n+      collections: [collection]\n+    };\n+    return Search.search(SEARCH_API_PATH, searchParams).then(\n+      (pagedResult: Common.PagedResult<SearchResult.Item>) => {\n+        const {uuid, status, collectionId} = pagedResult.results[0];\n+        expect(pagedResult).toHaveLength(pagedResult.results.length);\n+        expect(uuid).toBeTruthy();\n+        // Status returned is in lowercase so have to convert to uppercase.\n+        expect(status.toUpperCase()).toBe(SearchResult.ItemStatus.LIVE);\n+        expect(collectionId).toBe(collection);\n+      }\n+    )\n+  });\n+\n+  it(\"should get 404 response if search for an non-existing collection\", () => {", "originalCommit": "8c0e1a34990928b291b9f9dc08c232b65c96ea4e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxNTc4MA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435015780", "bodyText": "I wonder if instead we should use https://www.npmjs.com/package/query-string\nOnly because it's been updated lately (2 months vs 7 years) and seems a bit more widely used.\nIt is also interesting that you could pull this in without adding anything to package.json. \ud83e\udd14\n(And as a real minor sidenote, interest that this is in double quotes where the others are in single quotes - I wonder if you ran Prettier over this...)", "author": "edalex-ian", "createdAt": "2020-06-04T06:18:14Z", "path": "oeq-ts-rest-api/src/AxiosInstance.ts", "diffHunk": "@@ -2,6 +2,7 @@ import Axios, { AxiosResponse, AxiosError } from 'axios';\n import axiosCookieJarSupport from 'axios-cookiejar-support';\n import * as tough from 'tough-cookie';\n import { repackageError } from './Errors';\n+import {stringify} from \"querystring\";", "originalCommit": "8c0e1a34990928b291b9f9dc08c232b65c96ea4e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAzNzIyMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435037221", "bodyText": "No I did not. I just hit alt+enter to import this library.", "author": "PenghaiZhang", "createdAt": "2020-06-04T07:08:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxNTc4MA=="}], "type": "inlineReview"}, {"oid": "709165beb03861bc92e7d3e21ccb5be95c5b1145", "url": "https://github.com/openequella/openEQUELLA/commit/709165beb03861bc92e7d3e21ccb5be95c5b1145", "message": "Use the library 'query-string' to serialize query params.\n\nDon't need 'SearchResult' so move its code to 'Search' and remove it.\n\nUse async/await to call the search api in the test.\n\nAdd more JSDoc.", "committedDate": "2020-06-04T07:43:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTMwNDg0MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435304841", "bodyText": "Are these statuses fixed/static? Or are they customizable at an institution level?", "author": "ChristianMurphy", "createdAt": "2020-06-04T14:31:36Z", "path": "oeq-ts-rest-api/src/Search.ts", "diffHunk": "@@ -0,0 +1,210 @@\n+import * as Common from './Common';\n+import { is } from 'typescript-is';\n+import {GET} from './AxiosInstance';\n+\n+/**\n+ * Type of query parameters that can be used in a search.\n+ */\n+export interface SearchParams {\n+  /**\n+   * Query string.\n+   */\n+  query?: string;\n+  /**\n+   * The first record of the search results to return.\n+   */\n+  start?: number;\n+  /**\n+   * The number of results to return.\n+   */\n+  length?: number;\n+  /**\n+   * List of collections.\n+   */\n+  collections?: string[];\n+  /**\n+   * The order of the search results.\n+   */\n+  order?: string;\n+  /**\n+   * Reverse the order of the search results.\n+   */\n+  reverseOrder?: boolean;\n+  /**\n+   * An advanced search UUID.\n+   */\n+  advancedSearch?: string;\n+  /**\n+   * A where clause.\n+   */\n+  whereClause?: string;\n+  /**\n+   * Item status.\n+   */\n+  status?: ItemStatus[];\n+  /**\n+   * A date before which items are modified. Date format (yyyy-MM-dd).\n+   */\n+  modifiedBefore?: string;\n+  /**\n+   * A date after which items are modified. Date format (yyyy-MM-dd).\n+   */\n+  modifiedAfter?: string;\n+  /**\n+   * An ID of a user.\n+   */\n+  owner?: string;\n+  /**\n+   * single dynamic collection uuid.\n+   */\n+  dynaCollection?: string;\n+}\n+\n+export enum ItemStatus {\n+  DRAFT = \"DRAFT\",\n+  LIVE = \"LIVE\",\n+  REJECTED = \"REJECTED\",\n+  MODERATING = \"MODERATING\",\n+  ARCHIVED = \"ARCHIVED\",\n+  SUSPENDED = \"SUSPENDED\",\n+  DELETED = \"DELETED\",\n+  REVIEW = \"REVIEW\",\n+  PERSONAL = \"PERSONAL\",\n+}", "originalCommit": "709165beb03861bc92e7d3e21ccb5be95c5b1145", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcxODIwMA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435718200", "bodyText": "These are fixed/static and match an enum server side.", "author": "edalex-ian", "createdAt": "2020-06-05T06:39:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTMwNDg0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcxOTAyMA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435719020", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Type of item's display options.\n          \n          \n            \n             * How an item should be displayed as configured per institution via the search result display template.", "author": "edalex-ian", "createdAt": "2020-06-05T06:41:25Z", "path": "oeq-ts-rest-api/src/Search.ts", "diffHunk": "@@ -58,13 +60,151 @@ export interface SearchParams {\n   dynaCollection?: string;\n }\n \n-export const isPagedSearchResultItem = (instance: unknown): boolean =>\n-  is<Common.PagedResult<SearchResult.Item>>(instance);\n+export enum ItemStatus {\n+  DRAFT = \"DRAFT\",\n+  LIVE = \"LIVE\",\n+  REJECTED = \"REJECTED\",\n+  MODERATING = \"MODERATING\",\n+  ARCHIVED = \"ARCHIVED\",\n+  SUSPENDED = \"SUSPENDED\",\n+  DELETED = \"DELETED\",\n+  REVIEW = \"REVIEW\",\n+  PERSONAL = \"PERSONAL\",\n+}\n+\n+/**\n+ * Type of item's display fields.\n+ */\n+export interface DisplayFields {\n+  /**\n+   * Type of a field.\n+   */\n+  type: string;\n+  /**\n+   * Name of a field.\n+   */\n+  name: Common.i18nString;\n+  /**\n+   * Html code of a field.\n+   */\n+  html: Common.i18nString;\n+}\n+\n+/**\n+ * Type of item's display options.", "originalCommit": "709165beb03861bc92e7d3e21ccb5be95c5b1145", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcxOTc2Nw==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435719767", "bodyText": "We can probably simplify the name here:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            export interface SearchResultAttachment {\n          \n          \n            \n            export interface Attachment {\n          \n      \n    \n    \n  \n\nMaybe the long name matches the server side, but with namespacing here it'll be Search.Attachment anyway... \ud83e\udd14", "author": "edalex-ian", "createdAt": "2020-06-05T06:43:35Z", "path": "oeq-ts-rest-api/src/Search.ts", "diffHunk": "@@ -58,13 +60,151 @@ export interface SearchParams {\n   dynaCollection?: string;\n }\n \n-export const isPagedSearchResultItem = (instance: unknown): boolean =>\n-  is<Common.PagedResult<SearchResult.Item>>(instance);\n+export enum ItemStatus {\n+  DRAFT = \"DRAFT\",\n+  LIVE = \"LIVE\",\n+  REJECTED = \"REJECTED\",\n+  MODERATING = \"MODERATING\",\n+  ARCHIVED = \"ARCHIVED\",\n+  SUSPENDED = \"SUSPENDED\",\n+  DELETED = \"DELETED\",\n+  REVIEW = \"REVIEW\",\n+  PERSONAL = \"PERSONAL\",\n+}\n+\n+/**\n+ * Type of item's display fields.\n+ */\n+export interface DisplayFields {\n+  /**\n+   * Type of a field.\n+   */\n+  type: string;\n+  /**\n+   * Name of a field.\n+   */\n+  name: Common.i18nString;\n+  /**\n+   * Html code of a field.\n+   */\n+  html: Common.i18nString;\n+}\n+\n+/**\n+ * Type of item's display options.\n+ */\n+export interface DisplayOptions {\n+  /**\n+   * The display mode for attachments when viewed from search result page.\n+   */\n+  attachmentType: string;\n+  /**\n+   * True if thumbnail is prevented from displaying.\n+   */\n+  disableThumbnail: boolean;\n+  /**\n+   * True if the 'show attachments' icon is enabled for standard search result pages.\n+   */\n+  standardOpen: boolean;\n+  /**\n+   * True if the 'show attachments' icon is enabled for integration screen result pages.\n+   */\n+  integrationOpen: boolean;\n+}\n+\n+/**\n+ * Type of search result attachment.\n+ */\n+export interface SearchResultAttachment {", "originalCommit": "709165beb03861bc92e7d3e21ccb5be95c5b1145", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcxOTk5Mg==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435719992", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Type of search result attachment.\n          \n          \n            \n             * Summary of an attachment associated with an item returned in a search result.", "author": "edalex-ian", "createdAt": "2020-06-05T06:44:11Z", "path": "oeq-ts-rest-api/src/Search.ts", "diffHunk": "@@ -58,13 +60,151 @@ export interface SearchParams {\n   dynaCollection?: string;\n }\n \n-export const isPagedSearchResultItem = (instance: unknown): boolean =>\n-  is<Common.PagedResult<SearchResult.Item>>(instance);\n+export enum ItemStatus {\n+  DRAFT = \"DRAFT\",\n+  LIVE = \"LIVE\",\n+  REJECTED = \"REJECTED\",\n+  MODERATING = \"MODERATING\",\n+  ARCHIVED = \"ARCHIVED\",\n+  SUSPENDED = \"SUSPENDED\",\n+  DELETED = \"DELETED\",\n+  REVIEW = \"REVIEW\",\n+  PERSONAL = \"PERSONAL\",\n+}\n+\n+/**\n+ * Type of item's display fields.\n+ */\n+export interface DisplayFields {\n+  /**\n+   * Type of a field.\n+   */\n+  type: string;\n+  /**\n+   * Name of a field.\n+   */\n+  name: Common.i18nString;\n+  /**\n+   * Html code of a field.\n+   */\n+  html: Common.i18nString;\n+}\n+\n+/**\n+ * Type of item's display options.\n+ */\n+export interface DisplayOptions {\n+  /**\n+   * The display mode for attachments when viewed from search result page.\n+   */\n+  attachmentType: string;\n+  /**\n+   * True if thumbnail is prevented from displaying.\n+   */\n+  disableThumbnail: boolean;\n+  /**\n+   * True if the 'show attachments' icon is enabled for standard search result pages.\n+   */\n+  standardOpen: boolean;\n+  /**\n+   * True if the 'show attachments' icon is enabled for integration screen result pages.\n+   */\n+  integrationOpen: boolean;\n+}\n+\n+/**\n+ * Type of search result attachment.", "originalCommit": "709165beb03861bc92e7d3e21ccb5be95c5b1145", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcyMTAxMA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435721010", "bodyText": "Could be good to give example values of some of the standard ones...\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Attachment type.\n          \n          \n            \n               * Attachment type, e.g. \"file\", \"url\", \"package\", \"scorm\", etc.\n          \n      \n    \n    \n  \n\nFrom memory these are configurable server side, so I guess we can't use an enum.", "author": "edalex-ian", "createdAt": "2020-06-05T06:46:57Z", "path": "oeq-ts-rest-api/src/Search.ts", "diffHunk": "@@ -58,13 +60,151 @@ export interface SearchParams {\n   dynaCollection?: string;\n }\n \n-export const isPagedSearchResultItem = (instance: unknown): boolean =>\n-  is<Common.PagedResult<SearchResult.Item>>(instance);\n+export enum ItemStatus {\n+  DRAFT = \"DRAFT\",\n+  LIVE = \"LIVE\",\n+  REJECTED = \"REJECTED\",\n+  MODERATING = \"MODERATING\",\n+  ARCHIVED = \"ARCHIVED\",\n+  SUSPENDED = \"SUSPENDED\",\n+  DELETED = \"DELETED\",\n+  REVIEW = \"REVIEW\",\n+  PERSONAL = \"PERSONAL\",\n+}\n+\n+/**\n+ * Type of item's display fields.\n+ */\n+export interface DisplayFields {\n+  /**\n+   * Type of a field.\n+   */\n+  type: string;\n+  /**\n+   * Name of a field.\n+   */\n+  name: Common.i18nString;\n+  /**\n+   * Html code of a field.\n+   */\n+  html: Common.i18nString;\n+}\n+\n+/**\n+ * Type of item's display options.\n+ */\n+export interface DisplayOptions {\n+  /**\n+   * The display mode for attachments when viewed from search result page.\n+   */\n+  attachmentType: string;\n+  /**\n+   * True if thumbnail is prevented from displaying.\n+   */\n+  disableThumbnail: boolean;\n+  /**\n+   * True if the 'show attachments' icon is enabled for standard search result pages.\n+   */\n+  standardOpen: boolean;\n+  /**\n+   * True if the 'show attachments' icon is enabled for integration screen result pages.\n+   */\n+  integrationOpen: boolean;\n+}\n+\n+/**\n+ * Type of search result attachment.\n+ */\n+export interface SearchResultAttachment {\n+  /**\n+   * Attachment type.", "originalCommit": "709165beb03861bc92e7d3e21ccb5be95c5b1145", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA2ODI1Mg==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r437068252", "bodyText": "Yes. We have quite a few beans which extend AttachmentBean and these beans define their types.", "author": "PenghaiZhang", "createdAt": "2020-06-09T00:14:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcyMTAxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcyMTE5NQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435721195", "bodyText": "Seeing this is a string, does that mean it's a UUID?", "author": "edalex-ian", "createdAt": "2020-06-05T06:47:30Z", "path": "oeq-ts-rest-api/src/Search.ts", "diffHunk": "@@ -58,13 +60,151 @@ export interface SearchParams {\n   dynaCollection?: string;\n }\n \n-export const isPagedSearchResultItem = (instance: unknown): boolean =>\n-  is<Common.PagedResult<SearchResult.Item>>(instance);\n+export enum ItemStatus {\n+  DRAFT = \"DRAFT\",\n+  LIVE = \"LIVE\",\n+  REJECTED = \"REJECTED\",\n+  MODERATING = \"MODERATING\",\n+  ARCHIVED = \"ARCHIVED\",\n+  SUSPENDED = \"SUSPENDED\",\n+  DELETED = \"DELETED\",\n+  REVIEW = \"REVIEW\",\n+  PERSONAL = \"PERSONAL\",\n+}\n+\n+/**\n+ * Type of item's display fields.\n+ */\n+export interface DisplayFields {\n+  /**\n+   * Type of a field.\n+   */\n+  type: string;\n+  /**\n+   * Name of a field.\n+   */\n+  name: Common.i18nString;\n+  /**\n+   * Html code of a field.\n+   */\n+  html: Common.i18nString;\n+}\n+\n+/**\n+ * Type of item's display options.\n+ */\n+export interface DisplayOptions {\n+  /**\n+   * The display mode for attachments when viewed from search result page.\n+   */\n+  attachmentType: string;\n+  /**\n+   * True if thumbnail is prevented from displaying.\n+   */\n+  disableThumbnail: boolean;\n+  /**\n+   * True if the 'show attachments' icon is enabled for standard search result pages.\n+   */\n+  standardOpen: boolean;\n+  /**\n+   * True if the 'show attachments' icon is enabled for integration screen result pages.\n+   */\n+  integrationOpen: boolean;\n+}\n+\n+/**\n+ * Type of search result attachment.\n+ */\n+export interface SearchResultAttachment {\n+  /**\n+   * Attachment type.\n+   */\n+  attachmentType: string;\n+  /**\n+   * The unique ID of an attachment.", "originalCommit": "709165beb03861bc92e7d3e21ccb5be95c5b1145", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA1Mzc4MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r437053781", "bodyText": "Yes.", "author": "PenghaiZhang", "createdAt": "2020-06-08T23:22:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcyMTE5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcyMTk2NQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435721965", "bodyText": "I wonder if we're able to use Date on this side and then Axios might transform it for us. And from memory, typescript-is supports Date.", "author": "edalex-ian", "createdAt": "2020-06-05T06:49:36Z", "path": "oeq-ts-rest-api/src/Search.ts", "diffHunk": "@@ -58,13 +60,151 @@ export interface SearchParams {\n   dynaCollection?: string;\n }\n \n-export const isPagedSearchResultItem = (instance: unknown): boolean =>\n-  is<Common.PagedResult<SearchResult.Item>>(instance);\n+export enum ItemStatus {\n+  DRAFT = \"DRAFT\",\n+  LIVE = \"LIVE\",\n+  REJECTED = \"REJECTED\",\n+  MODERATING = \"MODERATING\",\n+  ARCHIVED = \"ARCHIVED\",\n+  SUSPENDED = \"SUSPENDED\",\n+  DELETED = \"DELETED\",\n+  REVIEW = \"REVIEW\",\n+  PERSONAL = \"PERSONAL\",\n+}\n+\n+/**\n+ * Type of item's display fields.\n+ */\n+export interface DisplayFields {\n+  /**\n+   * Type of a field.\n+   */\n+  type: string;\n+  /**\n+   * Name of a field.\n+   */\n+  name: Common.i18nString;\n+  /**\n+   * Html code of a field.\n+   */\n+  html: Common.i18nString;\n+}\n+\n+/**\n+ * Type of item's display options.\n+ */\n+export interface DisplayOptions {\n+  /**\n+   * The display mode for attachments when viewed from search result page.\n+   */\n+  attachmentType: string;\n+  /**\n+   * True if thumbnail is prevented from displaying.\n+   */\n+  disableThumbnail: boolean;\n+  /**\n+   * True if the 'show attachments' icon is enabled for standard search result pages.\n+   */\n+  standardOpen: boolean;\n+  /**\n+   * True if the 'show attachments' icon is enabled for integration screen result pages.\n+   */\n+  integrationOpen: boolean;\n+}\n+\n+/**\n+ * Type of search result attachment.\n+ */\n+export interface SearchResultAttachment {\n+  /**\n+   * Attachment type.\n+   */\n+  attachmentType: string;\n+  /**\n+   * The unique ID of an attachment.\n+   */\n+  id: string;\n+  /**\n+   * The description of an attachment.\n+   */\n+  description?: string;\n+  /**\n+   * True if an attachment can be previewed.\n+   */\n+  preview: boolean;\n+  /**\n+   * Links to the attachment.\n+   */\n+  links: Record<string, string>;\n+}\n+\n+/**\n+ * Type of search result item.\n+ */\n+export interface SearchResultItem {\n+  /**\n+   * Item's unique ID.\n+   */\n+  uuid: string;\n+  /**\n+   * Item's name.\n+   */\n+  name?: Common.i18nString;\n+  /**\n+   * Item's description.\n+   */\n+  description?: Common.i18nString;\n+  /**\n+   * Item's status\n+   */\n+  status: string;\n+  /**\n+   * The date when item is created.\n+   */\n+  createdDate: string;\n+  /**\n+   * The last date when item is modified.\n+   */\n+  modifiedDate: string;", "originalCommit": "709165beb03861bc92e7d3e21ccb5be95c5b1145", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA4MjYzMA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r437082630", "bodyText": "I am a bit confused about this. Let's have a quick talk tomorrow.\nThe issue is using Date as the field's type will break type checks", "author": "PenghaiZhang", "createdAt": "2020-06-09T01:10:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcyMTk2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzg1MjkzNw==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r437852937", "bodyText": "Yup, looks like we need support in the GET to take another function (say, transformer) which can modify the response.data as required, and then maybe a standard transformer called convertDateFields looking something like:\nconst convertDateFields = (fields: string[], data: unknown) => T\nThat could sit in a new Utils.ts", "author": "edalex-ian", "createdAt": "2020-06-10T04:27:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcyMTk2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcyMjM2NA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435722364", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Type of item's display fields.\n          \n          \n            \n             * Details of an additional field to display as part of search results - server side configurable in collections.", "author": "edalex-ian", "createdAt": "2020-06-05T06:50:38Z", "path": "oeq-ts-rest-api/src/Search.ts", "diffHunk": "@@ -58,13 +60,151 @@ export interface SearchParams {\n   dynaCollection?: string;\n }\n \n-export const isPagedSearchResultItem = (instance: unknown): boolean =>\n-  is<Common.PagedResult<SearchResult.Item>>(instance);\n+export enum ItemStatus {\n+  DRAFT = \"DRAFT\",\n+  LIVE = \"LIVE\",\n+  REJECTED = \"REJECTED\",\n+  MODERATING = \"MODERATING\",\n+  ARCHIVED = \"ARCHIVED\",\n+  SUSPENDED = \"SUSPENDED\",\n+  DELETED = \"DELETED\",\n+  REVIEW = \"REVIEW\",\n+  PERSONAL = \"PERSONAL\",\n+}\n+\n+/**\n+ * Type of item's display fields.", "originalCommit": "709165beb03861bc92e7d3e21ccb5be95c5b1145", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcyMzAwNw==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435723007", "bodyText": "I imagine this should be over in Common as it's not unique to search results, and so later when working with Items we'll most likely use it again.", "author": "edalex-ian", "createdAt": "2020-06-05T06:52:29Z", "path": "oeq-ts-rest-api/src/Search.ts", "diffHunk": "@@ -58,13 +60,151 @@ export interface SearchParams {\n   dynaCollection?: string;\n }\n \n-export const isPagedSearchResultItem = (instance: unknown): boolean =>\n-  is<Common.PagedResult<SearchResult.Item>>(instance);\n+export enum ItemStatus {", "originalCommit": "709165beb03861bc92e7d3e21ccb5be95c5b1145", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcyNDAxMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435724011", "bodyText": "Could we please match the namespaced import style as done in the other tests?\nSo instead go with the:\nimport * as OEQ from '../src';\n\nAnd then below you'd do your calls for example with:\nOEQ.Search.search(TC.API_PATH)", "author": "edalex-ian", "createdAt": "2020-06-05T06:55:09Z", "path": "oeq-ts-rest-api/test/search.test.ts", "diffHunk": "@@ -1,56 +1,39 @@\n import * as Search from '../src/Search';\n-import * as SearchResult from '../src/SearchResult';\n-import * as Common from '../src/Common';\n import * as Auth from '../src/Auth';\n import * as TC from './TestConfig';\n-import * as Errors from \"../src/Errors\";", "originalCommit": "709165beb03861bc92e7d3e21ccb5be95c5b1145", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcyNDk5OA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r435724998", "bodyText": "We need to be thorough with the JSDoc. Here you're missing the @param statements.\nYou should just be able to copy across the definitely for apiBasePath from the others - to keep it consistent. And then add one for params.\nLong term - if we do this right - when we build it as it's own module, we can also publish the JSDocs for easy reference on a github pages setup. Further, the doco assists with IDE integrated doco.", "author": "edalex-ian", "createdAt": "2020-06-05T06:57:45Z", "path": "oeq-ts-rest-api/src/Search.ts", "diffHunk": "@@ -58,13 +60,151 @@ export interface SearchParams {\n   dynaCollection?: string;\n }\n \n-export const isPagedSearchResultItem = (instance: unknown): boolean =>\n-  is<Common.PagedResult<SearchResult.Item>>(instance);\n+export enum ItemStatus {\n+  DRAFT = \"DRAFT\",\n+  LIVE = \"LIVE\",\n+  REJECTED = \"REJECTED\",\n+  MODERATING = \"MODERATING\",\n+  ARCHIVED = \"ARCHIVED\",\n+  SUSPENDED = \"SUSPENDED\",\n+  DELETED = \"DELETED\",\n+  REVIEW = \"REVIEW\",\n+  PERSONAL = \"PERSONAL\",\n+}\n+\n+/**\n+ * Type of item's display fields.\n+ */\n+export interface DisplayFields {\n+  /**\n+   * Type of a field.\n+   */\n+  type: string;\n+  /**\n+   * Name of a field.\n+   */\n+  name: Common.i18nString;\n+  /**\n+   * Html code of a field.\n+   */\n+  html: Common.i18nString;\n+}\n+\n+/**\n+ * Type of item's display options.\n+ */\n+export interface DisplayOptions {\n+  /**\n+   * The display mode for attachments when viewed from search result page.\n+   */\n+  attachmentType: string;\n+  /**\n+   * True if thumbnail is prevented from displaying.\n+   */\n+  disableThumbnail: boolean;\n+  /**\n+   * True if the 'show attachments' icon is enabled for standard search result pages.\n+   */\n+  standardOpen: boolean;\n+  /**\n+   * True if the 'show attachments' icon is enabled for integration screen result pages.\n+   */\n+  integrationOpen: boolean;\n+}\n+\n+/**\n+ * Type of search result attachment.\n+ */\n+export interface SearchResultAttachment {\n+  /**\n+   * Attachment type.\n+   */\n+  attachmentType: string;\n+  /**\n+   * The unique ID of an attachment.\n+   */\n+  id: string;\n+  /**\n+   * The description of an attachment.\n+   */\n+  description?: string;\n+  /**\n+   * True if an attachment can be previewed.\n+   */\n+  preview: boolean;\n+  /**\n+   * Links to the attachment.\n+   */\n+  links: Record<string, string>;\n+}\n+\n+/**\n+ * Type of search result item.\n+ */\n+export interface SearchResultItem {\n+  /**\n+   * Item's unique ID.\n+   */\n+  uuid: string;\n+  /**\n+   * Item's name.\n+   */\n+  name?: Common.i18nString;\n+  /**\n+   * Item's description.\n+   */\n+  description?: Common.i18nString;\n+  /**\n+   * Item's status\n+   */\n+  status: string;\n+  /**\n+   * The date when item is created.\n+   */\n+  createdDate: string;\n+  /**\n+   * The last date when item is modified.\n+   */\n+  modifiedDate: string;\n+  /**\n+   * The ID of item's collection.\n+   */\n+  collectionId: string;\n+  /**\n+   * The number of item's comments.\n+   */\n+  commentCount: number;\n+  /**\n+   * Item's attachments.\n+   */\n+  attachments: SearchResultAttachment[];\n+  /**\n+   * Item's thumbnail.\n+   */\n+  thumbnail: string;\n+  /**\n+   * Item's display fields.\n+   */\n+  displayFields: DisplayFields[];\n+  /**\n+   * Item's display options.\n+   */\n+  displayOptions?: DisplayOptions;\n+  /**\n+   * Links to an item.\n+   */\n+  links: Record<string, string>;\n+}\n+\n+const SEARCH2_API_PATH = '/search2';\n \n-export const search = (searchPath: string, params?: SearchParams): Promise<Common.PagedResult<SearchResult.Item>> => {\n-  return GET<Common.PagedResult<SearchResult.Item>>(\n-    searchPath,\n-    isPagedSearchResultItem,\n+/**\n+ * Communicate with REST endpoint 'search2' to do a search with specified search criteria.\n+ */", "originalCommit": "709165beb03861bc92e7d3e21ccb5be95c5b1145", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ae51c1e72842f5243ad88a6b2f236ea0e08e3aab", "url": "https://github.com/openequella/openEQUELLA/commit/ae51c1e72842f5243ad88a6b2f236ea0e08e3aab", "message": "Move ItemStatus to the module Common;\n\nReword JSDoc;\n\nMatch the namespaced import style in the search test.", "committedDate": "2020-06-12T04:54:40Z", "type": "commit"}, {"oid": "10b9b794294d4f158b5d2af672c0e227d8986d76", "url": "https://github.com/openequella/openEQUELLA/commit/10b9b794294d4f158b5d2af672c0e227d8986d76", "message": "Add a function that converts types of an object's certain fields to Date.\n\nAdd a Jest test for the function.\n\nAdd an optional parameter to GET, which allows data structure transformation\nas required.", "committedDate": "2020-06-12T05:12:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIxMzQzNg==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r439213436", "bodyText": "The type of data should be T so I am concerned about if using any will break type safety.", "author": "PenghaiZhang", "createdAt": "2020-06-12T05:26:29Z", "path": "oeq-ts-rest-api/src/AxiosInstance.ts", "diffHunk": "@@ -17,17 +17,19 @@ const catchHandler = (error: AxiosError | Error): never => {\n export const GET = <T>(\n   path: string,\n   validator?: (data: unknown) => boolean,\n-  queryParams?: object\n+  queryParams?: object,\n+  transformer?: (data: T) => unknown,\n ): Promise<T> =>\n   axios\n     .get<T>(path, {params: queryParams, paramsSerializer: params => stringify(params)}, )\n     .then((response: AxiosResponse<T>) => {\n-      if (validator && !validator(response.data)) {\n+      const data: any = transformer? transformer(response.data) : response.data;", "originalCommit": "10b9b794294d4f158b5d2af672c0e227d8986d76", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg4MTE2Nw==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r439881167", "bodyText": "I think we've got this the wrong way about.\nReally, it's the data returned from axios.get() which is potentially unknown. So maybe the axios.get<T>() should drop the generic and just do axios.get(). Then, the signature for the transformer should be:\n(data: unknown) => T\n\nBecause it's still a blind transform (i.e. the validator hasn't be run yet) you could argue the return should still be unknown. But I guess the argument is we're expecting it to return T and then we're simply validating it.\nSo how about we make the above two changes - that's the axios.get call, and the signature for the transformer?", "author": "edalex-ian", "createdAt": "2020-06-14T23:59:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIxMzQzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwMDYyNA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441200624", "bodyText": "If I'm interpreting the previous comments for this line correctly right, this still needs to be updated\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  const data: any = transformer? transformer(response.data) : response.data;\n          \n          \n            \n                  const data: unknown = transformer? transformer(response.data) : response.data;", "author": "ChristianMurphy", "createdAt": "2020-06-16T23:40:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIxMzQzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2ODg3MA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441268870", "bodyText": "see PenghaiZhang#2 for another approach", "author": "ChristianMurphy", "createdAt": "2020-06-17T04:08:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIxMzQzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIxMzk2NA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r439213964", "bodyText": "The returning type is unknown because the object is modified so it might be no longer of its original type. This is my understanding but I am not very sure if I am right.", "author": "PenghaiZhang", "createdAt": "2020-06-12T05:28:32Z", "path": "oeq-ts-rest-api/src/Utils.ts", "diffHunk": "@@ -0,0 +1,29 @@\n+import * as Lodash from \"lodash\";\n+\n+/**\n+ * Return a copied object of which types of specified fields are converted to Date.\n+ * @param fields Names of fields that need type conversion.\n+ * @param data The object to be processed. Nested objects will be processed, too.\n+ * @param cloneData True if deep clone is required.\n+ */\n+export const convertDateFields = <T>(fields: string[], data: T, cloneData: boolean): unknown => {", "originalCommit": "10b9b794294d4f158b5d2af672c0e227d8986d76", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg4MTgxOA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r439881818", "bodyText": "I think that's right, but I'd also argue the input too is also unknown - or more so, does not have to be known consider we don't use any of the type information here - we've mostly resorted to metaprogramming.", "author": "edalex-ian", "createdAt": "2020-06-15T00:05:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIxMzk2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg4MDQ0OA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r439880448", "bodyText": "I think we're now at a point where this function needs some JSDoc to support future maintenance. Although it's primarily internal, I think it'll help with it's consumption going forward. Maybe something like:\n/**\n * Executes a HTTP GET for a given path.\n *\n * @param path The URL path for the target GET\n * @param validator A function to perform runtime type checking against the result - typically with typescript-is\n * @param queryParams The query parameters to send with the GET request\n * @param transformer A function which returns a copy of the raw data from the GET with any required values transformed - this should NOT mutate the input data (transforms should start on a copy/clone of the input)\n */", "author": "edalex-ian", "createdAt": "2020-06-14T23:52:18Z", "path": "oeq-ts-rest-api/src/AxiosInstance.ts", "diffHunk": "@@ -16,17 +17,19 @@ const catchHandler = (error: AxiosError | Error): never => {\n export const GET = <T>(", "originalCommit": "10b9b794294d4f158b5d2af672c0e227d8986d76", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg4MTk4MA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r439881980", "bodyText": "I'd suggest the target (data) should be the first param.\nWhy do we need an option around deep cloning?\nAhhh, now I see what's going on. You've kind of got two functions in one here. I suggest you split it out to something like:\nexport const convertDateFields = (input: unknown, fields: string[]): unknown => {\n  final inputClone = Lodash.cloneDeep(input);\n  // Note: Not sure if we need to validate the date - so the converter returning `undefined` might be fine...\n  convertFields(inputClone, fields, true, (value: string) => new Date( value));\n  return inputClone;\n}\n\n/**\n * Performs inplace conversion of specified fields with supplied converter.\n*/\nconst convertFields = (input: unknown, targetFields: string[], recursive: boolean, converter: (value: T) => R?): void =>\n  Object.entries( input ).forEach((field, value}) => {\n    if(typeof value === \"object\" && recursive) {\n      convertFields(value, targetFields, recursive, converter);\n    }\n    else {\n      targetFields.each( targetField => {\n        if(field === targetField) {\n          input[field] = converter(value);\n        }\n      });\n    }\n  }\nDisclaimer: I've just hacked this code together here - probably completely broken with syntax errors.\nI think there's a couple of benefits here: First makes for a cleaner interface on the converDateFields function, and second splits out a potentially reusable function - while also splitting out some recursive functionality (which is always wise to avoid accidents).", "author": "edalex-ian", "createdAt": "2020-06-15T00:07:33Z", "path": "oeq-ts-rest-api/src/Utils.ts", "diffHunk": "@@ -0,0 +1,29 @@\n+import * as Lodash from \"lodash\";\n+\n+/**\n+ * Return a copied object of which types of specified fields are converted to Date.\n+ * @param fields Names of fields that need type conversion.\n+ * @param data The object to be processed. Nested objects will be processed, too.\n+ * @param cloneData True if deep clone is required.\n+ */\n+export const convertDateFields = <T>(fields: string[], data: T, cloneData: boolean): unknown => {", "originalCommit": "10b9b794294d4f158b5d2af672c0e227d8986d76", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg4MjI3MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r439882271", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Return a copied object of which types of specified fields are converted to Date.\n          \n          \n            \n             * @param fields Names of fields that need type conversion.\n          \n          \n            \n             * @param data The object to be processed. Nested objects will be processed, too.\n          \n          \n            \n             * @param cloneData True if deep clone is required.\n          \n          \n            \n             * Return a clone of the provided object with specified fields converted to type Date. A deep clone\n          \n          \n            \n             * will be undertaken, and so nested fields with matching names will also be converted.\n          \n          \n            \n             *\n          \n          \n            \n             * @param fields List of the names of fields to convert.\n          \n          \n            \n             * @param data The object to be processed.\n          \n          \n            \n             * @param cloneData True if deep clone is required.", "author": "edalex-ian", "createdAt": "2020-06-15T00:10:46Z", "path": "oeq-ts-rest-api/src/Utils.ts", "diffHunk": "@@ -0,0 +1,29 @@\n+import * as Lodash from \"lodash\";\n+\n+/**\n+ * Return a copied object of which types of specified fields are converted to Date.\n+ * @param fields Names of fields that need type conversion.\n+ * @param data The object to be processed. Nested objects will be processed, too.\n+ * @param cloneData True if deep clone is required.", "originalCommit": "10b9b794294d4f158b5d2af672c0e227d8986d76", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "76f12af6ce9644648ff842d4db737ddd88cdd5b0", "url": "https://github.com/openequella/openEQUELLA/commit/76f12af6ce9644648ff842d4db737ddd88cdd5b0", "message": "Drop the generic of axios.get();\n\nTweak the signature of field type transforming function.\n\nReturn undefined for converting fields that have invalid date strings.", "committedDate": "2020-06-15T05:13:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE5NzczNw==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441197737", "bodyText": "Hold on, you've still got some of the specific date conversion logic here. This function should now be general purpose, and the logic goes down in the convertDateFields() function.\nThis line would now just be:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      (input as any)[field] = isNaN(Date.parse(value))? undefined: converter(value);\n          \n          \n            \n                      (input as any)[field] = converter(value);", "author": "edalex-ian", "createdAt": "2020-06-16T23:30:14Z", "path": "oeq-ts-rest-api/src/Utils.ts", "diffHunk": "@@ -1,29 +1,40 @@\n import * as Lodash from \"lodash\";\n \n /**\n- * Return a copied object of which types of specified fields are converted to Date.\n- * @param fields Names of fields that need type conversion.\n- * @param data The object to be processed. Nested objects will be processed, too.\n- * @param cloneData True if deep clone is required.\n+ * Performs inplace conversion of specified fields with supplied converter.\n+ *\n+ * @param input The object to be processed.\n+ * @param targetFields List of the names of fields to convert.\n+ * @param recursive True if processing nested objects is required.\n+ * @param converter A function converting fields' type.\n  */\n-export const convertDateFields = <T>(fields: string[], data: T, cloneData: boolean): unknown => {\n-  const clonedData: T = cloneData? Lodash.cloneDeep(data) : data;\n-  const results: [string, any][] = Object.entries(clonedData);\n+const convertFields = <T, R>(input: unknown, targetFields: string[], recursive: boolean, converter: (value: T) => R): void => {\n+  const entries: [string, any][] = Object.entries(input as any);\n \n-  results.forEach(([key, value]) => {\n-    if(typeof value === \"object\"){\n-      // Don't need to deep clone nested objects again.\n-      convertDateFields(fields, value, false);\n+  entries.forEach(([field, value]) => {\n+    if(typeof value === \"object\" && recursive) {\n+      convertFields(value, targetFields, recursive, converter);\n     }\n-    else{\n-      fields.forEach(field => {\n-        // Convert when a date string can be parsed to Date.\n-        if(field === key && !isNaN(Date.parse(value))){\n-          (clonedData as any)[field] = new Date(value)\n+    else {\n+      targetFields.forEach( targetField => {\n+        if(field === targetField) {\n+          (input as any)[field] = isNaN(Date.parse(value))? undefined: converter(value);", "originalCommit": "76f12af6ce9644648ff842d4db737ddd88cdd5b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE5ODk2Ng==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441198966", "bodyText": "I fear this block has now become a bit unreadable and unwieldly. But we can tidy it up with filter I feel. e.g.\ntargetFields\n  .filter(targetField => targetField === field)\n  .forEach(field => (input as any)[field] = converter(value));", "author": "edalex-ian", "createdAt": "2020-06-16T23:34:30Z", "path": "oeq-ts-rest-api/src/Utils.ts", "diffHunk": "@@ -1,29 +1,40 @@\n import * as Lodash from \"lodash\";\n \n /**\n- * Return a copied object of which types of specified fields are converted to Date.\n- * @param fields Names of fields that need type conversion.\n- * @param data The object to be processed. Nested objects will be processed, too.\n- * @param cloneData True if deep clone is required.\n+ * Performs inplace conversion of specified fields with supplied converter.\n+ *\n+ * @param input The object to be processed.\n+ * @param targetFields List of the names of fields to convert.\n+ * @param recursive True if processing nested objects is required.\n+ * @param converter A function converting fields' type.\n  */\n-export const convertDateFields = <T>(fields: string[], data: T, cloneData: boolean): unknown => {\n-  const clonedData: T = cloneData? Lodash.cloneDeep(data) : data;\n-  const results: [string, any][] = Object.entries(clonedData);\n+const convertFields = <T, R>(input: unknown, targetFields: string[], recursive: boolean, converter: (value: T) => R): void => {\n+  const entries: [string, any][] = Object.entries(input as any);\n \n-  results.forEach(([key, value]) => {\n-    if(typeof value === \"object\"){\n-      // Don't need to deep clone nested objects again.\n-      convertDateFields(fields, value, false);\n+  entries.forEach(([field, value]) => {\n+    if(typeof value === \"object\" && recursive) {\n+      convertFields(value, targetFields, recursive, converter);\n     }\n-    else{\n-      fields.forEach(field => {\n-        // Convert when a date string can be parsed to Date.\n-        if(field === key && !isNaN(Date.parse(value))){\n-          (clonedData as any)[field] = new Date(value)\n+    else {\n+      targetFields.forEach( targetField => {\n+        if(field === targetField) {\n+          (input as any)[field] = isNaN(Date.parse(value))? undefined: converter(value);\n         }\n-      })\n+      });", "originalCommit": "76f12af6ce9644648ff842d4db737ddd88cdd5b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwMjc3MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441202771", "bodyText": "Could we avoid importing all of lodash for one function?\nInstead using\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import * as Lodash from \"lodash\";\n          \n          \n            \n            import { cloneDeep } from \"lodash\";\n          \n      \n    \n    \n  \n\nwith https://github.com/lodash/babel-plugin-lodash\nor\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import * as Lodash from \"lodash\";\n          \n          \n            \n            import * as cloneDeep from \"lodash/cloneDeep\";", "author": "ChristianMurphy", "createdAt": "2020-06-16T23:48:18Z", "path": "oeq-ts-rest-api/src/Utils.ts", "diffHunk": "@@ -0,0 +1,40 @@\n+import * as Lodash from \"lodash\";", "originalCommit": "76f12af6ce9644648ff842d4db737ddd88cdd5b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwMzExMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441203111", "bodyText": "destructuring is inconsistent\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import { is } from 'typescript-is';\n          \n          \n            \n            import {GET} from './AxiosInstance';\n          \n          \n            \n            import { is } from 'typescript-is';\n          \n          \n            \n            import { GET } from './AxiosInstance';", "author": "ChristianMurphy", "createdAt": "2020-06-16T23:49:33Z", "path": "oeq-ts-rest-api/src/Search.ts", "diffHunk": "@@ -0,0 +1,203 @@\n+import * as Common from './Common';\n+import { is } from 'typescript-is';\n+import {GET} from './AxiosInstance';", "originalCommit": "76f12af6ce9644648ff842d4db737ddd88cdd5b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxNDM4NQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441214385", "bodyText": "Yeah, really need to get this setup with linting and formatting. Just with the plan to move to own repo I want to wait until then rather than messing things up here. So, I guess it's manual for now - which I do by manually triggering Prettier in my IDE as I work.", "author": "edalex-ian", "createdAt": "2020-06-17T00:30:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwMzExMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDE4MA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441210180", "bodyText": "@PenghaiZhang cast could be avoided by using the type predicate to narrow unknown automatically before returning, with:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  if (validator && !validator(data)) {\n          \n          \n            \n                    // If a validator is provided, but it fails to validate the provided data...\n          \n          \n            \n                    throw new Error('Data format mismatch with data received from server.');\n          \n          \n            \n                  }\n          \n          \n            \n            \n          \n          \n            \n                  return response.data;\n          \n          \n            \n                  return data;\n          \n          \n            \n                  if (validator) {\n          \n          \n            \n                    if (validator(data)) {\n          \n          \n            \n                      return data;\n          \n          \n            \n                    }\n          \n          \n            \n                    throw new Error('Data format mismatch with data received from server.');\n          \n          \n            \n                  }\n          \n          \n            \n            \n          \n          \n            \n                  return data;", "author": "ChristianMurphy", "createdAt": "2020-06-17T00:14:34Z", "path": "oeq-ts-rest-api/src/AxiosInstance.ts", "diffHunk": "@@ -17,17 +17,19 @@ const catchHandler = (error: AxiosError | Error): never => {\n export const GET = <T>(\n   path: string,\n   validator?: (data: unknown) => boolean,\n-  queryParams?: object\n+  queryParams?: object,\n+  transformer?: (data: T) => unknown,\n ): Promise<T> =>\n   axios\n     .get<T>(path, {params: queryParams, paramsSerializer: params => stringify(params)}, )\n     .then((response: AxiosResponse<T>) => {\n-      if (validator && !validator(response.data)) {\n+      const data: any = transformer? transformer(response.data) : response.data;\n+      if (validator && !validator(data)) {\n         // If a validator is provided, but it fails to validate the provided data...\n         throw new Error('Data format mismatch with data received from server.');\n       }\n \n-      return response.data;\n+      return data;", "originalCommit": "10b9b794294d4f158b5d2af672c0e227d8986d76", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMTAxMw==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441211013", "bodyText": "this may also need a change to the type for validator see #1784 (review)", "author": "ChristianMurphy", "createdAt": "2020-06-17T00:17:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDE4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMTI4Mw==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441211283", "bodyText": "This function is expected to return a Promise<T>. As data is unknown, return data  without casting may not be OK.\nI can see this error Type unknown is not assignable to type T.", "author": "PenghaiZhang", "createdAt": "2020-06-17T00:18:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDE4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMzk0NA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441213944", "bodyText": "That is closer to what we want, if the type isn't validated it is unknown.\n\ud83e\udd14 the return type may need to be made conditional on the presence of validator", "author": "ChristianMurphy", "createdAt": "2020-06-17T00:28:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDE4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIyODI4Ng==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441228286", "bodyText": "Okay, we had more of a play with this but it's getting a bit confusing. Perhaps what we've got is good enough for now, and we can try and improve it later. Or if you have time @ChristianMurphy  maybe once this branch is merged in you can have a hack at it then.", "author": "edalex-ian", "createdAt": "2020-06-17T01:24:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDE4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2MTY3MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441261671", "bodyText": "@edalex-ian @PenghaiZhang PenghaiZhang#2", "author": "ChristianMurphy", "createdAt": "2020-06-17T03:36:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDE4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMwNjIyMA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441306220", "bodyText": "Okay, we've had a look but are concerned about how that supports all the different possible permutations. e.g. What If I want a path, no validator, but params; or, path, no validator, maybe params, and a transformer. It's just getting a bit crazy, and we need to merge this one in so as not to block further work.\nSo let's proceed to merge for now, and then maybe once in your can repoint your PR and show us how all the permutations can be support cleanly... Sorry we can't accommodate just now, but we definitely tried.", "author": "edalex-ian", "createdAt": "2020-06-17T06:21:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDE4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU1MTEwMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441551101", "bodyText": "but are concerned about how that supports all the different possible permutations. e.g. What If I want a path, no validator, but params; or, path, no validator, maybe params, and a transformer\n\nI'm not sure I follow this, params are positional.\nin the current implementation\n(\n  path: string,\n  validator?: (data: unknown) => boolean,\n  queryParams?: object,\n  transformer?: (data: T) => unknown,\n)\n\nThe parameters must be added in order (path, path and validator, path and validator and query params, or path and validator and query params and transformer).\nIt isn't possible to skip validator and go straight to transformer with this syntax.\nexport function GET<T>(path: string): Promise<unknown>;\nexport function GET<T>(\n  path: string,\n  validator: (data: unknown) => data is T,\n  queryParams?: object,\n  transformer?: (data: unknown) => T\n): Promise<T>;\ncovers all possible combinations.", "author": "ChristianMurphy", "createdAt": "2020-06-17T13:37:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDE4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDgzOA==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441210838", "bodyText": "to ensure validator is a predicate use\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              validator?: (data: unknown) => boolean,\n          \n          \n            \n              validator?: (data: unknown) => data is T,", "author": "ChristianMurphy", "createdAt": "2020-06-17T00:16:57Z", "path": "oeq-ts-rest-api/src/AxiosInstance.ts", "diffHunk": "@@ -13,20 +14,30 @@ const catchHandler = (error: AxiosError | Error): never => {\n   throw repackageError(error);\n };\n \n+/**\n+ * Executes a HTTP GET for a given path.\n+ *\n+ * @param path The URL path for the target GET\n+ * @param validator A function to perform runtime type checking against the result - typically with typescript-is\n+ * @param queryParams The query parameters to send with the GET request\n+ * @param transformer A function which returns a copy of the raw data from the GET with any required values transformed - this should NOT mutate the input data (transforms should start on a copy/clone of the input)\n+ */\n export const GET = <T>(\n   path: string,\n   validator?: (data: unknown) => boolean,", "originalCommit": "76f12af6ce9644648ff842d4db737ddd88cdd5b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMTMxNw==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441211317", "bodyText": "see: https://www.typescriptlang.org/docs/handbook/advanced-types.html#using-type-predicates for more information on predicates", "author": "ChristianMurphy", "createdAt": "2020-06-17T00:18:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDgzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMzcwNw==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441213707", "bodyText": "Hold on though. This is not just meant to be a simple validator or type predicate. This is so that we can parse in a function that under the hood will do runtime validation via typescript-is.", "author": "edalex-ian", "createdAt": "2020-06-17T00:27:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDgzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIyNDMxMg==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441224312", "bodyText": "Ahhh, okay you're talking about the typeof predicate. My bad... Pondering... \ud83e\udd14", "author": "edalex-ian", "createdAt": "2020-06-17T01:08:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDgzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2ODY1Mg==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441268652", "bodyText": "See PenghaiZhang#2 for how this would work", "author": "ChristianMurphy", "createdAt": "2020-06-17T04:07:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDgzOA=="}], "type": "inlineReview"}, {"oid": "0a19c055c6abe30e3439f480e7ce174a68f44078", "url": "https://github.com/openequella/openEQUELLA/commit/0a19c055c6abe30e3439f480e7ce174a68f44078", "message": "Move date string validation to the date specific converter.\n\nImport 'cloneDeep' rather than the whole library of lodash.", "committedDate": "2020-06-17T01:42:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI0NDU4MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441244581", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import {stringify} from 'query-string';\n          \n          \n            \n            import { stringify } from 'query-string';", "author": "ChristianMurphy", "createdAt": "2020-06-17T02:26:57Z", "path": "oeq-ts-rest-api/src/AxiosInstance.ts", "diffHunk": "@@ -2,6 +2,7 @@ import Axios, { AxiosResponse, AxiosError } from 'axios';\n import axiosCookieJarSupport from 'axios-cookiejar-support';\n import * as tough from 'tough-cookie';\n import { repackageError } from './Errors';\n+import {stringify} from 'query-string';", "originalCommit": "0a19c055c6abe30e3439f480e7ce174a68f44078", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2ODY4MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1784#discussion_r441268681", "bodyText": "also resolved in PenghaiZhang#2", "author": "ChristianMurphy", "createdAt": "2020-06-17T04:07:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI0NDU4MQ=="}], "type": "inlineReview"}, {"oid": "c41348bd8415b7b0d111907e3105680fc64b84bf", "url": "https://github.com/openequella/openEQUELLA/commit/c41348bd8415b7b0d111907e3105680fc64b84bf", "message": "prettier formatting\n\nCo-authored-by: Christian Murphy <christian.murphy.42@gmail.com>", "committedDate": "2020-06-17T06:26:00Z", "type": "commit"}]}