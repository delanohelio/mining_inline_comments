{"pr_number": 2410, "pr_title": "View Item comment count from new search page", "pr_createdAt": "2020-10-15T04:45:47Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/2410", "timeline": [{"oid": "3c52bc65a247a935ed581af7afbd76ba24344b05", "url": "https://github.com/openequella/openEQUELLA/commit/3c52bc65a247a935ed581af7afbd76ba24344b05", "message": "Display Item comment count on new search page.\n\nShow number of Comments as link. If link selected,take\nuser to Summary page with ''#comments-list' anchor.\nHide link if permissions not granted.", "committedDate": "2020-10-14T03:16:30Z", "type": "commit"}, {"oid": "c6e3888a421693715f34887c60cc2fadb3ba51cd", "url": "https://github.com/openequella/openEQUELLA/commit/c6e3888a421693715f34887c60cc2fadb3ba51cd", "message": "Two tweaks for component SearchResult\n\n1. Use language strings to properly display comment count.\n2. Slightly refactor 'itemMetadata'.", "committedDate": "2020-10-14T03:44:09Z", "type": "commit"}, {"oid": "82c172822c4d7db4fced26b51852a151f2fd13ea", "url": "https://github.com/openequella/openEQUELLA/commit/82c172822c4d7db4fced26b51852a151f2fd13ea", "message": "Merge branch 'component/new-search-page' into feature/view-comment-from-search-page", "committedDate": "2020-10-14T05:37:04Z", "type": "commit"}, {"oid": "88a92780c620c0e7f383154d3ad6662b2c91c96e", "url": "https://github.com/openequella/openEQUELLA/commit/88a92780c620c0e7f383154d3ad6662b2c91c96e", "message": "Merge branch 'develop' into feature/view-comment-from-search-page", "committedDate": "2020-10-15T03:22:46Z", "type": "commit"}, {"oid": "f846f6de6c3144a3491f1211620c9cb5bd81287a", "url": "https://github.com/openequella/openEQUELLA/commit/f846f6de6c3144a3491f1211620c9cb5bd81287a", "message": "Don't show comment count in new search page if it's 0.", "committedDate": "2020-10-15T03:51:13Z", "type": "commit"}, {"oid": "8528b4ccd8549a6aa104715802a6daa46550f1ea", "url": "https://github.com/openequella/openEQUELLA/commit/8528b4ccd8549a6aa104715802a6daa46550f1ea", "message": "Created Jest tests for showing Item comment count.", "committedDate": "2020-10-15T22:07:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTkxNjMxMg==", "url": "https://github.com/openequella/openEQUELLA/pull/2410#discussion_r505916312", "bodyText": "Should use the languageString for 'No comments'.", "author": "edalex-ian", "createdAt": "2020-10-15T23:15:47Z", "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/components/SearchResult.test.tsx", "diffHunk": "@@ -52,4 +53,30 @@ describe(\"<SearchResult/>\", () => {\n       queryByLabelText(container, keywordFoundInAttachmentLabel)\n     ).not.toBeInTheDocument();\n   });\n+\n+  it.each([\n+    [\"singular comment\", mockData.basicSearchObj],\n+    [\"plural comments\", mockData.attachSearchObj],\n+  ])(\n+    \"should show comment count as a link for %s\",\n+    (testName: string, item: OEQ.Search.SearchResultItem) => {\n+      const { container } = renderSearchResult(item);\n+      const countLink = getByText(\n+        container,\n+        formatSize(item.commentCount ?? 0, languageStrings.searchpage.comments),\n+        { selector: \"a\" }\n+      );\n+\n+      expect(countLink).toBeInTheDocument();\n+    }\n+  );\n+\n+  it(\"should hide comment count link if count is 0\", () => {\n+    const { container } = renderSearchResult(\n+      mockData.keywordFoundInAttachmentObj\n+    );\n+    expect(\n+      queryByLabelText(container, `No comments`, { selector: \"a\" })", "originalCommit": "8528b4ccd8549a6aa104715802a6daa46550f1ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTkxNjU1MA==", "url": "https://github.com/openequella/openEQUELLA/pull/2410#discussion_r505916550", "bodyText": "This line will never fail, because if getByText fails it'll throw an exception. In this context I normally go with queryByText for an item to be checked.", "author": "edalex-ian", "createdAt": "2020-10-15T23:16:33Z", "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/components/SearchResult.test.tsx", "diffHunk": "@@ -52,4 +53,30 @@ describe(\"<SearchResult/>\", () => {\n       queryByLabelText(container, keywordFoundInAttachmentLabel)\n     ).not.toBeInTheDocument();\n   });\n+\n+  it.each([\n+    [\"singular comment\", mockData.basicSearchObj],\n+    [\"plural comments\", mockData.attachSearchObj],\n+  ])(\n+    \"should show comment count as a link for %s\",\n+    (testName: string, item: OEQ.Search.SearchResultItem) => {\n+      const { container } = renderSearchResult(item);\n+      const countLink = getByText(\n+        container,\n+        formatSize(item.commentCount ?? 0, languageStrings.searchpage.comments),\n+        { selector: \"a\" }\n+      );\n+\n+      expect(countLink).toBeInTheDocument();", "originalCommit": "8528b4ccd8549a6aa104715802a6daa46550f1ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk5NjU0NQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2410#discussion_r505996545", "bodyText": "Ah I completely forgot this :)", "author": "PenghaiZhang", "createdAt": "2020-10-16T02:31:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTkxNjU1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTkxNjc0Nw==", "url": "https://github.com/openequella/openEQUELLA/pull/2410#discussion_r505916747", "bodyText": "Better to just go straight to destructing what you want:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  const { container } = renderSearchResult(item);\n          \n          \n            \n                  const { getByText } = renderSearchResult(item);", "author": "edalex-ian", "createdAt": "2020-10-15T23:17:09Z", "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/components/SearchResult.test.tsx", "diffHunk": "@@ -52,4 +53,30 @@ describe(\"<SearchResult/>\", () => {\n       queryByLabelText(container, keywordFoundInAttachmentLabel)\n     ).not.toBeInTheDocument();\n   });\n+\n+  it.each([\n+    [\"singular comment\", mockData.basicSearchObj],\n+    [\"plural comments\", mockData.attachSearchObj],\n+  ])(\n+    \"should show comment count as a link for %s\",\n+    (testName: string, item: OEQ.Search.SearchResultItem) => {\n+      const { container } = renderSearchResult(item);", "originalCommit": "8528b4ccd8549a6aa104715802a6daa46550f1ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTkxNzA4OA==", "url": "https://github.com/openequella/openEQUELLA/pull/2410#discussion_r505917088", "bodyText": "This is kind of just copying the same code from the code under test. Almost like testing 1 === 1 directly. Really a test should do it a different way to the code under test.", "author": "edalex-ian", "createdAt": "2020-10-15T23:18:12Z", "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/components/SearchResult.test.tsx", "diffHunk": "@@ -52,4 +53,30 @@ describe(\"<SearchResult/>\", () => {\n       queryByLabelText(container, keywordFoundInAttachmentLabel)\n     ).not.toBeInTheDocument();\n   });\n+\n+  it.each([\n+    [\"singular comment\", mockData.basicSearchObj],\n+    [\"plural comments\", mockData.attachSearchObj],\n+  ])(\n+    \"should show comment count as a link for %s\",\n+    (testName: string, item: OEQ.Search.SearchResultItem) => {\n+      const { container } = renderSearchResult(item);\n+      const countLink = getByText(\n+        container,\n+        formatSize(item.commentCount ?? 0, languageStrings.searchpage.comments),", "originalCommit": "8528b4ccd8549a6aa104715802a6daa46550f1ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a363e9d3eb458db9ac3445513db874628041a993", "url": "https://github.com/openequella/openEQUELLA/commit/a363e9d3eb458db9ac3445513db874628041a993", "message": "Tweaks for SearchResult test.", "committedDate": "2020-10-16T02:36:51Z", "type": "commit"}]}