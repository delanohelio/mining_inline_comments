{"pr_number": 2182, "pr_title": "refactor: migrate stories to leverage storybook args", "pr_createdAt": "2020-08-14T00:09:11Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/2182", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDMxNjkzMA==", "url": "https://github.com/openequella/openEQUELLA/pull/2182#discussion_r470316930", "bodyText": "These are now bundled together in essentials https://storybook.js.org/docs/react/essentials/introduction", "author": "ChristianMurphy", "createdAt": "2020-08-14T00:10:33Z", "path": "Source/Plugins/Core/com.equella.core/js/.storybook/main.js", "diffHunk": "@@ -1,10 +0,0 @@\n-module.exports = {\n-  stories: [\"../__stories__/**/*.stories.tsx\"],\n-  addons: [\n-    \"@storybook/addon-a11y\",\n-    \"@storybook/addon-actions\",\n-    \"@storybook/addon-docs\",\n-    \"@storybook/addon-knobs\",", "originalCommit": "732d518d25a4a7ffaafaa9b15673ff91e5465fb2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDMxNzA2MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2182#discussion_r470317061", "bodyText": "sets up several addons https://storybook.js.org/docs/react/essentials/introduction", "author": "ChristianMurphy", "createdAt": "2020-08-14T00:10:43Z", "path": "Source/Plugins/Core/com.equella.core/js/.storybook/main.ts", "diffHunk": "@@ -0,0 +1,7 @@\n+module.exports = {\n+  stories: [\"../__stories__/**/*\"],\n+  addons: [\n+    \"@storybook/addon-essentials\",", "originalCommit": "732d518d25a4a7ffaafaa9b15673ff91e5465fb2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDMxNzQzNA==", "url": "https://github.com/openequella/openEQUELLA/pull/2182#discussion_r470317434", "bodyText": "no longer needed thanks to built in typescript support", "author": "ChristianMurphy", "createdAt": "2020-08-14T00:11:16Z", "path": "Source/Plugins/Core/com.equella.core/js/package.json", "diffHunk": "@@ -111,7 +106,6 @@\n     \"enzyme\": \"3.11.0\",\n     \"enzyme-adapter-react-16\": \"1.15.3\",\n     \"enzyme-to-json\": \"3.5.0\",\n-    \"fork-ts-checker-webpack-plugin\": \"5.0.14\",", "originalCommit": "732d518d25a4a7ffaafaa9b15673ff91e5465fb2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDMxNzQ4Mg==", "url": "https://github.com/openequella/openEQUELLA/pull/2182#discussion_r470317482", "bodyText": "no longer needed thanks to built in typescript support", "author": "ChristianMurphy", "createdAt": "2020-08-14T00:11:20Z", "path": "Source/Plugins/Core/com.equella.core/js/package.json", "diffHunk": "@@ -124,7 +118,6 @@\n     \"rewire\": \"5.0.0\",\n     \"storybook-react-router\": \"1.0.8\",\n     \"ts-jest\": \"26.2.0\",\n-    \"ts-loader\": \"8.0.2\",", "originalCommit": "732d518d25a4a7ffaafaa9b15673ff91e5465fb2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDMxNzYyMA==", "url": "https://github.com/openequella/openEQUELLA/pull/2182#discussion_r470317620", "bodyText": "no longer needed thanks to built in typescript support", "author": "ChristianMurphy", "createdAt": "2020-08-14T00:11:31Z", "path": "Source/Plugins/Core/com.equella.core/js/package.json", "diffHunk": "@@ -101,7 +97,6 @@\n     \"@types/uuid\": \"8.3.0\",\n     \"argparse\": \"1.0.10\",\n     \"babel-jest\": \"26.3.0\",\n-    \"babel-loader\": \"8.1.0\",", "originalCommit": "732d518d25a4a7ffaafaa9b15673ff91e5465fb2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bef6364871bf3e0b79446fde8eb8a54cf5383b9f", "url": "https://github.com/openequella/openEQUELLA/commit/bef6364871bf3e0b79446fde8eb8a54cf5383b9f", "message": "refactor: migrate stories to leverage storybook args\n\nalso migrates to storybook essentials and removes unused dependencies.", "committedDate": "2020-08-14T01:36:44Z", "type": "forcePushed"}, {"oid": "f3e7e8c39cc82b2c3948ad585490a09cf18edfb3", "url": "https://github.com/openequella/openEQUELLA/commit/f3e7e8c39cc82b2c3948ad585490a09cf18edfb3", "message": "refactor: migrate stories to leverage storybook args\n\nalso migrates to storybook essentials and removes unused dependencies.", "committedDate": "2020-08-21T04:15:20Z", "type": "forcePushed"}, {"oid": "1b89854213a6eaaeec51e80688108b98a9089e2e", "url": "https://github.com/openequella/openEQUELLA/commit/1b89854213a6eaaeec51e80688108b98a9089e2e", "message": "refactor: migrate stories to leverage storybook args\n\nalso migrates to storybook essentials and removes unused dependencies.", "committedDate": "2020-08-21T04:53:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMzMjgxMw==", "url": "https://github.com/openequella/openEQUELLA/pull/2182#discussion_r475332813", "bodyText": "I'm not seeing any different here to the above story. \ud83e\udd14", "author": "edalex-ian", "createdAt": "2020-08-24T04:14:40Z", "path": "Source/Plugins/Core/com.equella.core/js/__stories__/components/MessageInfo.stories.tsx", "diffHunk": "@@ -16,75 +16,58 @@\n  * limitations under the License.\n  */\n import * as React from \"react\";\n-import { action } from \"@storybook/addon-actions\";\n-import { boolean, select, text } from \"@storybook/addon-knobs\";\n-import MessageInfo from \"../../tsrc/components/MessageInfo\";\n+import type { Meta, Story } from \"@storybook/react\";\n+import MessageInfo, {\n+  MessageInfoProps,\n+} from \"../../tsrc/components/MessageInfo\";\n \n export default {\n   title: \"MessageInfo\",\n   component: MessageInfo,\n-};\n+  argTypes: { onClose: { action: \"onClose\" } },\n+} as Meta<MessageInfoProps>;\n \n-export const DynamicVariant = () => (\n-  <MessageInfo\n-    open={boolean(\"open\", true)}\n-    onClose={action(\"close\")}\n-    title={text(\n-      \"title\",\n-      \"Lorem ipsum dolor sit amet, consectetur adipiscing elit\"\n-    )}\n-    variant={select(\n-      \"variant\",\n-      { success: \"success\", error: \"error\", info: \"info\", warning: \"warning\" },\n-      \"success\"\n-    )}\n-  />\n+export const DynamicVariant: Story<MessageInfoProps> = (args) => (\n+  <MessageInfo {...args} />\n );\n+DynamicVariant.args = {\n+  open: true,\n+  title: \"Lorem ipsum dolor sit amet, consectetur adipiscing elit\",\n+  variant: \"success\",\n+};\n \n-export const VariantSuccess = () => (\n-  <MessageInfo\n-    open={boolean(\"open\", true)}\n-    onClose={action(\"close\")}\n-    title={text(\n-      \"title\",\n-      \"Lorem ipsum dolor sit amet, consectetur adipiscing elit\"\n-    )}\n-    variant=\"success\"\n-  />\n+export const VariantSuccess: Story<MessageInfoProps> = (args) => (\n+  <MessageInfo {...args} />\n );\n+VariantSuccess.args = {\n+  open: true,\n+  title: \"Lorem ipsum dolor sit amet, consectetur adipiscing elit\",\n+  variant: \"success\",\n+};", "originalCommit": "1b89854213a6eaaeec51e80688108b98a9089e2e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk4ODQwOA==", "url": "https://github.com/openequella/openEQUELLA/pull/2182#discussion_r475988408", "bodyText": "#2182 (comment)", "author": "ChristianMurphy", "createdAt": "2020-08-25T00:12:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMzMjgxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMzMzIxNQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2182#discussion_r475333215", "bodyText": "Part of the Storybook 6 Args is to promote re-use. So this should be:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            VariantError.args = {\n          \n          \n            \n              open: true,\n          \n          \n            \n              title: \"Lorem ipsum dolor sit amet, consectetur adipiscing elit\",\n          \n          \n            \n              variant: \"error\",\n          \n          \n            \n            };\n          \n          \n            \n            VariantError.args = {\n          \n          \n            \n              ...VariantSuccess.args,\n          \n          \n            \n              variant: \"error\",\n          \n          \n            \n            };\n          \n      \n    \n    \n  \n\nI guess ideally at the top we'd have a simple test, and then we'd possibly end-up with a less confusing name for this context. E.g. Simple.args.\nThis same suggestion is then the same for the below warning and info variants.", "author": "edalex-ian", "createdAt": "2020-08-24T04:16:35Z", "path": "Source/Plugins/Core/com.equella.core/js/__stories__/components/MessageInfo.stories.tsx", "diffHunk": "@@ -16,75 +16,58 @@\n  * limitations under the License.\n  */\n import * as React from \"react\";\n-import { action } from \"@storybook/addon-actions\";\n-import { boolean, select, text } from \"@storybook/addon-knobs\";\n-import MessageInfo from \"../../tsrc/components/MessageInfo\";\n+import type { Meta, Story } from \"@storybook/react\";\n+import MessageInfo, {\n+  MessageInfoProps,\n+} from \"../../tsrc/components/MessageInfo\";\n \n export default {\n   title: \"MessageInfo\",\n   component: MessageInfo,\n-};\n+  argTypes: { onClose: { action: \"onClose\" } },\n+} as Meta<MessageInfoProps>;\n \n-export const DynamicVariant = () => (\n-  <MessageInfo\n-    open={boolean(\"open\", true)}\n-    onClose={action(\"close\")}\n-    title={text(\n-      \"title\",\n-      \"Lorem ipsum dolor sit amet, consectetur adipiscing elit\"\n-    )}\n-    variant={select(\n-      \"variant\",\n-      { success: \"success\", error: \"error\", info: \"info\", warning: \"warning\" },\n-      \"success\"\n-    )}\n-  />\n+export const DynamicVariant: Story<MessageInfoProps> = (args) => (\n+  <MessageInfo {...args} />\n );\n+DynamicVariant.args = {\n+  open: true,\n+  title: \"Lorem ipsum dolor sit amet, consectetur adipiscing elit\",\n+  variant: \"success\",\n+};\n \n-export const VariantSuccess = () => (\n-  <MessageInfo\n-    open={boolean(\"open\", true)}\n-    onClose={action(\"close\")}\n-    title={text(\n-      \"title\",\n-      \"Lorem ipsum dolor sit amet, consectetur adipiscing elit\"\n-    )}\n-    variant=\"success\"\n-  />\n+export const VariantSuccess: Story<MessageInfoProps> = (args) => (\n+  <MessageInfo {...args} />\n );\n+VariantSuccess.args = {\n+  open: true,\n+  title: \"Lorem ipsum dolor sit amet, consectetur adipiscing elit\",\n+  variant: \"success\",\n+};\n \n-export const VariantError = () => (\n-  <MessageInfo\n-    open={boolean(\"open\", true)}\n-    onClose={action(\"close\")}\n-    title={text(\n-      \"title\",\n-      \"Lorem ipsum dolor sit amet, consectetur adipiscing elit\"\n-    )}\n-    variant=\"error\"\n-  />\n+export const VariantError: Story<MessageInfoProps> = (args) => (\n+  <MessageInfo {...args} />\n );\n+VariantError.args = {\n+  open: true,\n+  title: \"Lorem ipsum dolor sit amet, consectetur adipiscing elit\",\n+  variant: \"error\",\n+};", "originalCommit": "1b89854213a6eaaeec51e80688108b98a9089e2e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk4ODMyMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2182#discussion_r475988321", "bodyText": "Thanks for the feedback, refactored to share args", "author": "ChristianMurphy", "createdAt": "2020-08-25T00:12:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMzMzIxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMzNDUxOA==", "url": "https://github.com/openequella/openEQUELLA/pull/2182#discussion_r475334518", "bodyText": "This was a shame. I see there's some options for auto-generating based on regex, but this feels the best approach for now.", "author": "edalex-ian", "createdAt": "2020-08-24T04:22:46Z", "path": "Source/Plugins/Core/com.equella.core/js/__stories__/components/AppBarQuery.stories.tsx", "diffHunk": "@@ -16,14 +16,20 @@\n  * limitations under the License.\n  */\n import * as React from \"react\";\n-import { action } from \"@storybook/addon-actions\";\n-import AppBarQuery from \"../../tsrc/components/AppBarQuery\";\n+import type { Meta, Story } from \"@storybook/react\";\n+import AppBarQuery, {\n+  AppBarQueryProps,\n+} from \"../../tsrc/components/AppBarQuery\";\n \n export default {\n   title: \"AppBarQuery\",\n   component: AppBarQuery,\n-};\n+  argTypes: {", "originalCommit": "1b89854213a6eaaeec51e80688108b98a9089e2e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM1NzYyMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2182#discussion_r475357621", "bodyText": "I think there may be a better way,  the blog post mentions:\n\nArgs also supercharges addons and brings lots of new features to Storybook, which we\u2019ll expand on over the coming weeks\nAuto-generated actions for event logging\n\nhttps://medium.com/storybookjs/introducing-storybook-args-2dadcdb777cc\nStill waiting for the post that describes the preferred/recommended method.\nFor now this seems to be good enough.", "author": "ChristianMurphy", "createdAt": "2020-08-24T05:54:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMzNDUxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMzNTcxOA==", "url": "https://github.com/openequella/openEQUELLA/pull/2182#discussion_r475335718", "bodyText": "So to not repeat this, I wonder if we should switch these two stories around and then you can re-use the args for WithHTMLInput. That is, it would be:\nWithHTMLInput.args = {\n  ...WithoutHTMLInput.args,\n  htmlInput: \"<p>Example.</p>\"\n}", "author": "edalex-ian", "createdAt": "2020-08-24T04:28:33Z", "path": "Source/Plugins/Core/com.equella.core/js/__stories__/components/RichEditor.stories.tsx", "diffHunk": "@@ -31,17 +32,23 @@ import RichTextEditor from \"../../tsrc/components/RichTextEditor\";\n export default {\n   title: \"RichTextEditor\",\n   component: RichTextEditor,\n-};\n+  argTypes: {\n+    onStateChange: { action: \"onStateChange\" },\n+    imageUploadCallBack: { action: \"imageUploadCallBack\" },\n+  },\n+} as Meta<RichTextEditorProps>;\n \n-const defaultProps = {\n+export const WithHTMLInput: Story<RichTextEditorProps> = (args) => (\n+  <RichTextEditor {...args} />\n+);\n+WithHTMLInput.args = {\n   skinUrl: \"http://localhost:6006/tinymce/skins/ui/oxide\",\n-  onStateChange: action(\"stateChange\"),\n+  htmlInput: \"<p>example</p>\",\n };\n-export const WithHTMLInput = () => (\n-  <RichTextEditor\n-    {...defaultProps}\n-    htmlInput={text(\"htmlInput\", \"<p>example</p>\")}\n-  />\n-);\n \n-export const WithoutHTMLInput = () => <RichTextEditor {...defaultProps} />;\n+export const WithoutHTMLInput: Story<RichTextEditorProps> = (args) => (\n+  <RichTextEditor {...args} />\n+);\n+WithoutHTMLInput.args = {\n+  skinUrl: \"http://localhost:6006/tinymce/skins/ui/oxide\",", "originalCommit": "1b89854213a6eaaeec51e80688108b98a9089e2e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk4ODUyOA==", "url": "https://github.com/openequella/openEQUELLA/pull/2182#discussion_r475988528", "bodyText": "#2182 (comment)", "author": "ChristianMurphy", "createdAt": "2020-08-25T00:12:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMzNTcxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM1MTUwOA==", "url": "https://github.com/openequella/openEQUELLA/pull/2182#discussion_r475351508", "bodyText": "Ummm, so there seems to be no value setup for this one. What am I missing? \ud83e\udd14", "author": "edalex-ian", "createdAt": "2020-08-24T05:32:06Z", "path": "Source/Plugins/Core/com.equella.core/js/__stories__/components/SettingsList.stories.tsx", "diffHunk": "@@ -39,25 +44,35 @@ const marks: Mark[] = [\n   { label: \"x8\", value: 7 },\n ];\n \n-export const ListWithTwoItems = () => (\n-  <SettingsList subHeading={text(\"Sub Heading\", \"Sub Heading\")}>\n+type Props = Pick<SettingsListProps, \"subHeading\"> &\n+  Pick<SettingsToggleSwitchProps, \"setValue\" | \"disabled\"> &\n+  Pick<SettingsListControlProps, \"primaryText\" | \"secondaryText\">;\n+\n+export const ListWithTwoItems: Story<Props> = (args) => (\n+  <SettingsList subHeading={args.subHeading}>\n     <SettingsListControl\n       secondaryText=\"Box for checking\"\n       control={\n         <SettingsToggleSwitch\n-          setValue={action(\"Checkbox\")}\n-          disabled={false}\n+          setValue={args.setValue}", "originalCommit": "1b89854213a6eaaeec51e80688108b98a9089e2e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk4ODczNg==", "url": "https://github.com/openequella/openEQUELLA/pull/2182#discussion_r475988736", "bodyText": "good catch, added argTypes for setValue", "author": "ChristianMurphy", "createdAt": "2020-08-25T00:12:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM1MTUwOA=="}], "type": "inlineReview"}, {"oid": "7334d3c872d0c401961343c5c3262370fa03b777", "url": "https://github.com/openequella/openEQUELLA/commit/7334d3c872d0c401961343c5c3262370fa03b777", "message": "refactor: migrate stories to leverage storybook args\n\nalso migrates to storybook essentials and removes unused dependencies.", "committedDate": "2020-08-25T00:04:11Z", "type": "commit"}, {"oid": "7334d3c872d0c401961343c5c3262370fa03b777", "url": "https://github.com/openequella/openEQUELLA/commit/7334d3c872d0c401961343c5c3262370fa03b777", "message": "refactor: migrate stories to leverage storybook args\n\nalso migrates to storybook essentials and removes unused dependencies.", "committedDate": "2020-08-25T00:04:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk5MzkzMg==", "url": "https://github.com/openequella/openEQUELLA/pull/2182#discussion_r475993932", "bodyText": "Ahhh, another sneaky setValue.", "author": "edalex-ian", "createdAt": "2020-08-25T00:20:26Z", "path": "Source/Plugins/Core/com.equella.core/js/__stories__/components/SettingsListControl.stories.tsx", "diffHunk": "@@ -38,34 +41,59 @@ const marks: Mark[] = [\n   { label: \"x8\", value: 7 },\n ];\n \n-export const ToggleSwitchControl = () => (\n+type ToggleSwitchControlProps = Pick<\n+  SettingsListControlProps,\n+  \"primaryText\" | \"secondaryText\" | \"divider\"\n+> &\n+  Pick<SettingsToggleSwitchProps, \"disabled\" | \"setValue\" | \"value\">;\n+export const ToggleSwitchControl: Story<ToggleSwitchControlProps> = (args) => (\n   <SettingsListControl\n-    secondaryText={text(\"Secondary Text\", \"Box for checking\")}\n+    primaryText={args.primaryText}\n+    secondaryText={args.secondaryText}\n+    divider={args.divider}\n     control={\n       <SettingsToggleSwitch\n-        disabled={boolean(\"Disabled\", false)}\n+        disabled={args.disabled}\n         id=\"toggle\"\n-        setValue={action(\"Value of checkbox changed\")}\n-        value={boolean(\"Toggle state\", false)}\n+        setValue={args.setValue}", "originalCommit": "84791a763531fc70600015166d435a33c9b3d508", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk5OTE2Ng==", "url": "https://github.com/openequella/openEQUELLA/pull/2182#discussion_r475999166", "bodyText": "updated", "author": "ChristianMurphy", "createdAt": "2020-08-25T00:28:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk5MzkzMg=="}], "type": "inlineReview"}, {"oid": "ad145728588062e05b27e47f8c999b52dd4aefb3", "url": "https://github.com/openequella/openEQUELLA/commit/ad145728588062e05b27e47f8c999b52dd4aefb3", "message": "refactor: reuse storybook args\n\nCo-authored-by: Ian Stevenson <ian.stevenson@edalex.com>", "committedDate": "2020-08-25T00:27:49Z", "type": "commit"}, {"oid": "ad145728588062e05b27e47f8c999b52dd4aefb3", "url": "https://github.com/openequella/openEQUELLA/commit/ad145728588062e05b27e47f8c999b52dd4aefb3", "message": "refactor: reuse storybook args\n\nCo-authored-by: Ian Stevenson <ian.stevenson@edalex.com>", "committedDate": "2020-08-25T00:27:49Z", "type": "forcePushed"}]}