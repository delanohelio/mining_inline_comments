{"pr_number": 2167, "pr_title": "Make date range end inclusive in searches", "pr_createdAt": "2020-08-11T05:25:05Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/2167", "timeline": [{"oid": "d7fd6a03087ede4d8fac6b308274a1a0db2d417a", "url": "https://github.com/openequella/openEQUELLA/commit/d7fd6a03087ede4d8fac6b308274a1a0db2d417a", "message": "Make the end of date range inclusive in searches.\n\nFirstly, change the time of start to '00:00:00' and that of end to\n'23:59:59'. Secondly, to ensure the old Search page keeps unchanged, add a\nnew boolean variable to flag if a search is performed by 'Search2' API.\nAnd then in the function that prepares Lucine queries, use proper timezone\nbased on the flag.", "committedDate": "2020-08-11T05:12:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODM5MzEzOA==", "url": "https://github.com/openequella/openEQUELLA/pull/2167#discussion_r468393138", "bodyText": "Two things:\n\nCould we use a better name for this? From what I can gather, it only does one thing - control whether or not to include a timezone in the DateFilter. So maybe a name like useServerTimeZone?\nLike we've started doing in all our TS code, let's add a JavaDoc comment to any new bits we add - especially here at the interface level.", "author": "edalex-ian", "createdAt": "2020-08-11T07:53:14Z", "path": "Source/Plugins/Core/com.equella.base/src/com/tle/common/searching/Search.java", "diffHunk": "@@ -86,4 +86,6 @@ public SortField getSortField(boolean reverseTheDefault) {\n   String getPrivilegeToCollect();\n \n   Collection<DateFilter> getDateFilters();\n+\n+  boolean isFromSearch2API();", "originalCommit": "d7fd6a03087ede4d8fac6b308274a1a0db2d417a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODkyNjY5Mw==", "url": "https://github.com/openequella/openEQUELLA/pull/2167#discussion_r468926693", "bodyText": "I actually came up with this name when I was working on the multiple Dynamic Collections because I wanted to indicate some code is only written for the new Search page. However, as we won't do multiple Dynamic Collections, perhaps this feature becomes the only one that requires changes on legacy code. So I am happy to rename the variable to useServerTimeZone.", "author": "PenghaiZhang", "createdAt": "2020-08-11T23:49:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODM5MzEzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODM5OTAxMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2167#discussion_r468399011", "bodyText": "I feel the isStart flag is obfuscating things unnecessarily here. Could this not just be time: LocalTime?\nIf it was, where it's used would become much clearer, as you'd simply have:\n    // The After date is the start of the range and so should be at the first possible moment of the day - LocalTime.MIN\n    val modifiedAfter  = handleModifiedDate(params.modifiedAfter, LocalTime.MIN)\n    // The Before date is the end of the range and so should be in the last possible moment of the day - LocalTime.MAX\n    val modifiedBefore = handleModifiedDate(params.modifiedBefore, LocalTime.MAX)\n(As an aside, you'll also note I've re-ordered the declaration of these two values to be slightly more logical.)\nThis change then also simplifies the code down below.", "author": "edalex-ian", "createdAt": "2020-08-11T08:03:58Z", "path": "Source/Plugins/Core/com.equella.core/scalasrc/com/tle/web/api/search/SearchHelper.scala", "diffHunk": "@@ -118,17 +120,22 @@ object SearchHelper {\n \n   /**\n     * Parse a string to a new instance of Date in the format of \"yyyy-MM-dd\".\n-    * @param date The string to parse.\n-    * @return An option which wraps an instace of Date.\n+    * @param dateString The string to parse.\n+    * @param isStart True if the date is the start of a date range.\n+    * @return An option which wraps an instance of Date.\n     */\n-  def handleModifiedDate(date: String): Option[Date] = {\n-    if (Check.isEmpty(date)) {\n+  def handleModifiedDate(dateString: String, isStart: Boolean = false): Option[Date] = {", "originalCommit": "d7fd6a03087ede4d8fac6b308274a1a0db2d417a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8c96f1862d00c65ae0ff9e098a4d6e87a3d0c659", "url": "https://github.com/openequella/openEQUELLA/commit/8c96f1862d00c65ae0ff9e098a4d6e87a3d0c659", "message": "Simplify SearchHelper's method 'handleModifiedDate'.", "committedDate": "2020-08-12T00:13:02Z", "type": "commit"}, {"oid": "12120bd516e381d7d5d42d1ae7b0f55bbdf6ee66", "url": "https://github.com/openequella/openEQUELLA/commit/12120bd516e381d7d5d42d1ae7b0f55bbdf6ee66", "message": "Rename variable 'isFromSearch2API' to 'useServerTimeZone' and add JavaDoc.", "committedDate": "2020-08-12T00:14:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAyMzUxOA==", "url": "https://github.com/openequella/openEQUELLA/pull/2167#discussion_r469023518", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Indicate if the server time zone is needed in searches.\n          \n          \n            \n               * Indicates if the server time zone should be included in searches.", "author": "edalex-ian", "createdAt": "2020-08-12T06:03:04Z", "path": "Source/Plugins/Core/com.equella.base/src/com/tle/common/searching/Search.java", "diffHunk": "@@ -87,5 +87,10 @@ public SortField getSortField(boolean reverseTheDefault) {\n \n   Collection<DateFilter> getDateFilters();\n \n-  boolean isFromSearch2API();\n+  /**\n+   * Indicate if the server time zone is needed in searches.", "originalCommit": "12120bd516e381d7d5d42d1ae7b0f55bbdf6ee66", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAyNTczNg==", "url": "https://github.com/openequella/openEQUELLA/pull/2167#discussion_r469025736", "bodyText": "Be good to further detail the return value. That way a user can rely on their IDE's documentation feature to display useful guidance without needing to review the function.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                * @return An option which wraps an instance of Date.\n          \n          \n            \n                * @return An Option which wraps an instance of Date, combining the successfully parsed dateString and provided time (based on the system's default timezone).", "author": "edalex-ian", "createdAt": "2020-08-12T06:09:15Z", "path": "Source/Plugins/Core/com.equella.core/scalasrc/com/tle/web/api/search/SearchHelper.scala", "diffHunk": "@@ -118,17 +121,20 @@ object SearchHelper {\n \n   /**\n     * Parse a string to a new instance of Date in the format of \"yyyy-MM-dd\".\n-    * @param date The string to parse.\n-    * @return An option which wraps an instace of Date.\n+    * @param dateString The string to parse.\n+    * @param time The time added to a date.\n+    * @return An option which wraps an instance of Date.", "originalCommit": "12120bd516e381d7d5d42d1ae7b0f55bbdf6ee66", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3489e5b52972d129912004de67d8b092ccb80bee", "url": "https://github.com/openequella/openEQUELLA/commit/3489e5b52972d129912004de67d8b092ccb80bee", "message": "Two tweaks for JavaDoc.\n\nCo-authored-by: edalex-ian <43919233+edalex-ian@users.noreply.github.com>", "committedDate": "2020-08-12T06:14:27Z", "type": "commit"}]}