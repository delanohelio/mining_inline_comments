{"pr_number": 2197, "pr_title": "Feature/attachment search indicator", "pr_createdAt": "2020-08-18T03:36:13Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/2197", "timeline": [{"oid": "ba906aa69c5252aac0aa4f7eebd954b86e78a28b", "url": "https://github.com/openequella/openEQUELLA/commit/ba906aa69c5252aac0aa4f7eebd954b86e78a28b", "message": "Add keywordFoundInAttachment property to SearchItemResult interface", "committedDate": "2020-08-17T01:10:08Z", "type": "commit"}, {"oid": "940992686f3c03ec3dc03b7e94a0675b54ca6e3e", "url": "https://github.com/openequella/openEQUELLA/commit/940992686f3c03ec3dc03b7e94a0675b54ca6e3e", "message": "Add Badge to Attachment Expansion panel, indicating if search term was found inside item attachment", "committedDate": "2020-08-17T05:16:41Z", "type": "commit"}, {"oid": "1e36f3eabb898a54ebc6a5651f46df6a8ddf1e81", "url": "https://github.com/openequella/openEQUELLA/commit/1e36f3eabb898a54ebc6a5651f46df6a8ddf1e81", "message": "Use language string for tooltip", "committedDate": "2020-08-18T00:33:18Z", "type": "commit"}, {"oid": "447c1a57a2fa4b0a3799df7d7f67e78751baeeae", "url": "https://github.com/openequella/openEQUELLA/commit/447c1a57a2fa4b0a3799df7d7f67e78751baeeae", "message": "Add SearchResult tests for testing keyWordFoundInAttachment indicator", "committedDate": "2020-08-18T00:43:34Z", "type": "commit"}, {"oid": "8f0858aa1bca58660d0ebab19723263723ea2951", "url": "https://github.com/openequella/openEQUELLA/commit/8f0858aa1bca58660d0ebab19723263723ea2951", "message": "Wrap SearchResult component in BrowserRouter for test", "committedDate": "2020-08-18T01:29:03Z", "type": "commit"}, {"oid": "029c491b4e01b3d47e1f5bbf37b8185a8e4282e4", "url": "https://github.com/openequella/openEQUELLA/commit/029c491b4e01b3d47e1f5bbf37b8185a8e4282e4", "message": "Add some actual text for language string", "committedDate": "2020-08-18T01:53:07Z", "type": "commit"}, {"oid": "09847a1e2e78d7202a748769225344f6d3fa3906", "url": "https://github.com/openequella/openEQUELLA/commit/09847a1e2e78d7202a748769225344f6d3fa3906", "message": "Update storybook, make SearchResult test use the storybook mock data", "committedDate": "2020-08-18T02:31:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg5NTE4Mg==", "url": "https://github.com/openequella/openEQUELLA/pull/2197#discussion_r471895182", "bodyText": "To reduce repetition, \"keywordFoundInAttachment\" should be a constant.", "author": "SammyIsConfused", "createdAt": "2020-08-18T03:40:11Z", "path": "Source/Plugins/Core/com.equella.core/js/__stories__/search/SearchResult.stories.tsx", "diffHunk": "@@ -48,6 +48,10 @@ export const BasicSearchResultComponent = () => (\n     collectionId={text(\"collection ID\", mockData.basicSearchObj.collectionId)}\n     commentCount={number(\"comment count\", mockData.basicSearchObj.commentCount)}\n     thumbnail={text(\"thumbnail\", mockData.basicSearchObj.thumbnail)}\n+    keywordFoundInAttachment={boolean(\n+      \"keywordFoundInAttachment\",", "originalCommit": "09847a1e2e78d7202a748769225344f6d3fa3906", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg5NTQ0NA==", "url": "https://github.com/openequella/openEQUELLA/pull/2197#discussion_r471895444", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  //This needs to be wrapped inside a BrowserRouter, to prevent an `Invariant failed: You should not use <Link> outside a <Router>` error\n          \n          \n            \n                  //This needs to be wrapped inside a BrowserRouter, to prevent an `Invariant failed: You should not use <Link> outside a <Router>` error because of the <Link/> tag within SearchResult", "author": "SammyIsConfused", "createdAt": "2020-08-18T03:41:18Z", "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/components/SearchResult.test.tsx", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import { render, queryByTestId } from \"@testing-library/react\";\n+import * as React from \"react\";\n+import * as mockData from \"../../../../__mocks__/searchresult_mock_data\";\n+import SearchResult from \"../../../../tsrc/search/components/SearchResult\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+\n+import \"@testing-library/jest-dom/extend-expect\";\n+import { BrowserRouter } from \"react-router-dom\";\n+\n+describe(\"<SearchResult/>\", () => {\n+  const renderSearchResult = (itemResult: OEQ.Search.SearchResultItem) => {\n+    return render(\n+      //This needs to be wrapped inside a BrowserRouter, to prevent an `Invariant failed: You should not use <Link> outside a <Router>` error", "originalCommit": "09847a1e2e78d7202a748769225344f6d3fa3906", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg5NTYzNg==", "url": "https://github.com/openequella/openEQUELLA/pull/2197#discussion_r471895636", "bodyText": "String should be constant", "author": "SammyIsConfused", "createdAt": "2020-08-18T03:42:13Z", "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/search/components/SearchResult.test.tsx", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import { render, queryByTestId } from \"@testing-library/react\";\n+import * as React from \"react\";\n+import * as mockData from \"../../../../__mocks__/searchresult_mock_data\";\n+import SearchResult from \"../../../../tsrc/search/components/SearchResult\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+\n+import \"@testing-library/jest-dom/extend-expect\";\n+import { BrowserRouter } from \"react-router-dom\";\n+\n+describe(\"<SearchResult/>\", () => {\n+  const renderSearchResult = (itemResult: OEQ.Search.SearchResultItem) => {\n+    return render(\n+      //This needs to be wrapped inside a BrowserRouter, to prevent an `Invariant failed: You should not use <Link> outside a <Router>` error\n+      <BrowserRouter>\n+        <SearchResult {...itemResult} key={itemResult.uuid} />\n+      </BrowserRouter>\n+    );\n+  };\n+\n+  it(\"Should show indicator in Attachment panel if keyword was found inside attachment\", () => {\n+    const itemWithSearchTermFound = mockData.keywordFoundInAttachmentObj;\n+    const { container } = renderSearchResult(itemWithSearchTermFound);\n+    expect(\n+      queryByTestId(container, \"keywordFoundInAttachment\")", "originalCommit": "09847a1e2e78d7202a748769225344f6d3fa3906", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkxODM4NQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2197#discussion_r471918385", "bodyText": "I'd prefer to avoid using these. They're minimal use when we get to selenium testing, so they end up only being for React Testing Library.\nInstead, with this gone, in your test you can use queryByLabel due to your (rather nicely) having correctly placed an aria-label above.", "author": "edalex-ian", "createdAt": "2020-08-18T05:13:35Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -167,8 +178,38 @@ export default function SearchResult({\n           onClick={(event) => handleAttachmentPanelClick(event)}\n         >\n           <AccordionSummary expandIcon={<ExpandMore />}>\n-            <AttachFile className={classes.attachmentIcon} />\n-            <Typography>{searchResultStrings.attachments}</Typography>\n+            <Grid container spacing={2} alignItems=\"center\">\n+              <Grid item>\n+                <Badge\n+                  anchorOrigin={{\n+                    vertical: \"bottom\",\n+                    horizontal: \"right\",\n+                  }}\n+                  overlap=\"circle\"\n+                  badgeContent={\n+                    keywordFoundInAttachment ? (\n+                      <Tooltip\n+                        title={searchResultStrings.keywordFoundInAttachment}\n+                        aria-label={\n+                          searchResultStrings.keywordFoundInAttachment\n+                        }\n+                      >\n+                        <Search\n+                          fontSize=\"small\"\n+                          className={classes.attachmentBadge}\n+                          data-testid=\"keywordFoundInAttachment\"", "originalCommit": "09847a1e2e78d7202a748769225344f6d3fa3906", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkyNzYxMw==", "url": "https://github.com/openequella/openEQUELLA/pull/2197#discussion_r471927613", "bodyText": "Yeah, that makes sense", "author": "mrblippy", "createdAt": "2020-08-18T05:44:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkxODM4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkyMTAzOA==", "url": "https://github.com/openequella/openEQUELLA/pull/2197#discussion_r471921038", "bodyText": "To aid readability, could you please split the badge out into something like:\nconst attachFileBadge = (includeIndicator: boolean) => (\n  <Badge\n    anchorOrigin={{\n      vertical: \"bottom\",\n      horizontal: \"right\",\n    }}\n    overlap=\"circle\"\n    badgeContent={\n    includeIndicator ? (\n      <Tooltip\n        title={searchResultStrings.keywordFoundInAttachment}\n        aria-label={\n          searchResultStrings.keywordFoundInAttachment\n        }\n      >\n        <Search\n          fontSize=\"small\"\n          className={classes.attachmentBadge}\n        />\n      </Tooltip>\n      ) : undefined\n    }\n  >\n    <AttachFile />\n  </Badge>);", "author": "edalex-ian", "createdAt": "2020-08-18T05:22:31Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -167,8 +178,38 @@ export default function SearchResult({\n           onClick={(event) => handleAttachmentPanelClick(event)}\n         >\n           <AccordionSummary expandIcon={<ExpandMore />}>\n-            <AttachFile className={classes.attachmentIcon} />\n-            <Typography>{searchResultStrings.attachments}</Typography>\n+            <Grid container spacing={2} alignItems=\"center\">\n+              <Grid item>\n+                <Badge\n+                  anchorOrigin={{\n+                    vertical: \"bottom\",\n+                    horizontal: \"right\",\n+                  }}\n+                  overlap=\"circle\"\n+                  badgeContent={\n+                    keywordFoundInAttachment ? (\n+                      <Tooltip\n+                        title={searchResultStrings.keywordFoundInAttachment}\n+                        aria-label={\n+                          searchResultStrings.keywordFoundInAttachment\n+                        }\n+                      >\n+                        <Search\n+                          fontSize=\"small\"\n+                          className={classes.attachmentBadge}\n+                          data-testid=\"keywordFoundInAttachment\"\n+                        />\n+                      </Tooltip>\n+                    ) : undefined\n+                  }\n+                >\n+                  <AttachFile />\n+                </Badge>", "originalCommit": "09847a1e2e78d7202a748769225344f6d3fa3906", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkyNzQ0Mw==", "url": "https://github.com/openequella/openEQUELLA/pull/2197#discussion_r471927443", "bodyText": "To aid readability, could you please split the badge out into something like:\nconst attachFileBadge = (includeIndicator: boolean) => (\n  <Badge\n    anchorOrigin={{\n      vertical: \"bottom\",\n      horizontal: \"right\",\n    }}\n    overlap=\"circle\"\n    badgeContent={\n    includeIndicator ? (\n      <Tooltip\n        title={searchResultStrings.keywordFoundInAttachment}\n        aria-label={\n          searchResultStrings.keywordFoundInAttachment\n        }\n      >\n        <Search\n          fontSize=\"small\"\n          className={classes.attachmentBadge}\n        />\n      </Tooltip>\n      ) : undefined\n    }\n  >\n    <AttachFile />\n  </Badge>);\n\nYeah, I was umming and ahing about this part. The nesting was getting a little bit intense", "author": "mrblippy", "createdAt": "2020-08-18T05:43:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkyMTAzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkzNTIwMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2197#discussion_r471935201", "bodyText": "Did you say we already have this language string in the i18n properties file?  If yes we need to remember to remove this one once we fix the language string issue.", "author": "PenghaiZhang", "createdAt": "2020-08-18T06:07:42Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/util/langstrings.ts", "diffHunk": "@@ -368,6 +368,7 @@ export const languageStrings = {\n     searchresult: {\n       attachments: \"Attachments\",\n       dateModified: \"Modified\",\n+      keywordFoundInAttachment: \"Search term found in attachment content\",", "originalCommit": "09847a1e2e78d7202a748769225344f6d3fa3906", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkzNjk0Mw==", "url": "https://github.com/openequella/openEQUELLA/pull/2197#discussion_r471936943", "bodyText": "Yes that's true @PenghaiZhang . But i neglected to mention this in the PR. What would be the best way to keep track of this?", "author": "mrblippy", "createdAt": "2020-08-18T06:13:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkzNTIwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkzODkzNQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2197#discussion_r471938935", "bodyText": "Maybe put this in the ticket of fixing language strings ?", "author": "PenghaiZhang", "createdAt": "2020-08-18T06:19:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkzNTIwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTk0ODI0MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2197#discussion_r471948241", "bodyText": "Good idea", "author": "mrblippy", "createdAt": "2020-08-18T06:41:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkzNTIwMQ=="}], "type": "inlineReview"}, {"oid": "4712242113d1aec3ef3be6b244d911e791cc79b8", "url": "https://github.com/openequella/openEQUELLA/commit/4712242113d1aec3ef3be6b244d911e791cc79b8", "message": "Use queryByLabelText in test instead of testid. Move AttachmentBadge in SearchResult into function, aiding in readability", "committedDate": "2020-08-18T06:22:17Z", "type": "commit"}]}