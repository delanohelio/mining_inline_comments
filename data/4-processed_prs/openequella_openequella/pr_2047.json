{"pr_number": 2047, "pr_title": "Search page Refine panel", "pr_createdAt": "2020-07-14T00:53:12Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/2047", "timeline": [{"oid": "7abe0cf2094170c0b20ba47a937437b5ec399f34", "url": "https://github.com/openequella/openEQUELLA/commit/7abe0cf2094170c0b20ba47a937437b5ec399f34", "message": "Add a Refine panel for Search page\n\n1. Add a new component RefineSearchPanel. It renders a MUI List and each\n   child component is put inside a ListItem.\n2. Refactor the outer Grid so that the main content takes 75% width and\n   the Refine panel takes 25% width.\n3. Due to the wrong Grid spacing, separate the nested Grid which is both\n   an item and a container into two separate Grids", "committedDate": "2020-07-13T06:49:51Z", "type": "commit"}, {"oid": "8e77b39977d2177239b9fa8c53d49000634c330f", "url": "https://github.com/openequella/openEQUELLA/commit/8e77b39977d2177239b9fa8c53d49000634c330f", "message": "Add JSDoc for RefinePanelProps.", "committedDate": "2020-07-14T00:49:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA1NzUzMA==", "url": "https://github.com/openequella/openEQUELLA/pull/2047#discussion_r454057530", "bodyText": "Wowsers, this return has now become a bit incomprehensible. Let's refactor, and try and ensure it concisely captures the page layout and key elements.", "author": "edalex-ian", "createdAt": "2020-07-14T02:18:24Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -150,65 +151,82 @@ const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n   );\n \n   return (", "originalCommit": "8e77b39977d2177239b9fa8c53d49000634c330f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA1NzcyOQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2047#discussion_r454057729", "bodyText": "I'm not sure we really need this. Does the panel have to be 100%. I'm kind of happy if it's just as big as its contents.", "author": "edalex-ian", "createdAt": "2020-07-14T02:19:10Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/RefineSearchPanel.tsx", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { ReactNode } from \"react\";\n+import {\n+  Card,\n+  CardContent,\n+  CardHeader,\n+  List,\n+  ListItem,\n+  makeStyles,\n+} from \"@material-ui/core\";\n+import { languageStrings } from \"../../util/langstrings\";\n+\n+interface RefinePanelProps {\n+  /**\n+   * Child components rendered inside this panel.\n+   */\n+  children: ReactNode;\n+}\n+\n+const useStyles = makeStyles({\n+  refineSearchPanel: {\n+    height: \"100%\", // Ensure Card always takes the item grid's full height.\n+  },\n+});", "originalCommit": "8e77b39977d2177239b9fa8c53d49000634c330f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDExMzUyNg==", "url": "https://github.com/openequella/openEQUELLA/pull/2047#discussion_r454113526", "bodyText": "No it does not have to be 100%. I had a talk with Charlie regarding this and we both seem to like 100% height, but I am happy to change it.", "author": "PenghaiZhang", "createdAt": "2020-07-14T05:39:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA1NzcyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA1ODIyOA==", "url": "https://github.com/openequella/openEQUELLA/pull/2047#discussion_r454058228", "bodyText": "We don't want the divider on the last one.", "author": "edalex-ian", "createdAt": "2020-07-14T02:20:58Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/RefineSearchPanel.tsx", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import { ReactNode } from \"react\";\n+import {\n+  Card,\n+  CardContent,\n+  CardHeader,\n+  List,\n+  ListItem,\n+  makeStyles,\n+} from \"@material-ui/core\";\n+import { languageStrings } from \"../../util/langstrings\";\n+\n+interface RefinePanelProps {\n+  /**\n+   * Child components rendered inside this panel.\n+   */\n+  children: ReactNode;\n+}\n+\n+const useStyles = makeStyles({\n+  refineSearchPanel: {\n+    height: \"100%\", // Ensure Card always takes the item grid's full height.\n+  },\n+});\n+\n+export const RefineSearchPanel = ({ children }: RefinePanelProps) => {\n+  const classes = useStyles();\n+  const { title } = languageStrings.searchpage.refineSearchPanel;\n+  return (\n+    <Card className={classes.refineSearchPanel}>\n+      <CardHeader title={title} />\n+      <CardContent>\n+        <List>\n+          {React.Children.map(children, (child) => (\n+            <ListItem divider>{child}</ListItem>", "originalCommit": "8e77b39977d2177239b9fa8c53d49000634c330f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDEwMjQ2OQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2047#discussion_r454102469", "bodyText": "Yeah. If you can get an index out of that map, you should be able to go\ndivider={index != React.Children.count-1}", "author": "SammyIsConfused", "createdAt": "2020-07-14T05:03:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA1ODIyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDExNDI0MA==", "url": "https://github.com/openequella/openEQUELLA/pull/2047#discussion_r454114240", "bodyText": "Yep I will change it, but may I ask why we want the divider on the last Search result item ? Also on the Facet search setting page, we have a divider for the last classification as well.", "author": "PenghaiZhang", "createdAt": "2020-07-14T05:41:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA1ODIyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDExNDk2Mw==", "url": "https://github.com/openequella/openEQUELLA/pull/2047#discussion_r454114963", "bodyText": "We don't want the last divider because its a divider between an item and nothing. As of the Facet Page, that probably shouldn't have a last one either.\nWe want:\n1\n2\n3\nas opposed to:\n1\n2\n3", "author": "SammyIsConfused", "createdAt": "2020-07-14T05:43:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA1ODIyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDEwMTIwOQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2047#discussion_r454101209", "bodyText": "Is this worth fleshing out a little?\nI'm aware its just a placeholder, but we are going to need to populate this panel with some sort of component made for it - eg. something along the lines of a new <SearchRefineControl/> component.", "author": "SammyIsConfused", "createdAt": "2020-07-14T05:00:04Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchPage.tsx", "diffHunk": "@@ -150,65 +151,82 @@ const SearchPage = ({ updateTemplate }: TemplateUpdateProps) => {\n   );\n \n   return (\n-    <Grid container direction=\"column\" spacing={2}>\n+    <Grid container spacing={2}>\n       <Grid item xs={9}>\n-        <Card>\n-          <CardContent>\n-            <SearchBar onChange={handleQueryChanged} />\n-          </CardContent>\n-        </Card>\n-      </Grid>\n-      <Grid item xs={9}>\n-        <Card>\n-          <CardHeader\n-            title={searchStrings.subtitle}\n-            action={\n-              <SearchOrderSelect\n-                value={searchOptions.sortOrder}\n-                onChange={handleSortOrderChanged}\n-              />\n-            }\n-          />\n-          {/*Add an inline style to make the spinner display at the Card's horizontal center.*/}\n-          <CardContent style={{ textAlign: \"center\" }}>\n-            {showSpinner && (\n-              <CircularProgress\n-                variant=\"indeterminate\"\n-                className={\n-                  pagedSearchResult.results.length > 0\n-                    ? classes.centralSpinner\n-                    : \"\"\n+        <Grid container spacing={2}>\n+          <Grid item xs={12}>\n+            <Card>\n+              <CardContent>\n+                <SearchBar onChange={handleQueryChanged} />\n+              </CardContent>\n+            </Card>\n+          </Grid>\n+          <Grid item xs={12}>\n+            <Card>\n+              <CardHeader\n+                title={searchStrings.subtitle}\n+                action={\n+                  <SearchOrderSelect\n+                    value={searchOptions.sortOrder}\n+                    onChange={handleSortOrderChanged}\n+                  />\n                 }\n               />\n-            )}\n-            {searchResultList}\n-          </CardContent>\n-\n-          <CardActions>\n-            <Grid container justify=\"center\">\n-              <Grid item>\n-                <TablePagination\n-                  component=\"div\"\n-                  count={pagedSearchResult.available}\n-                  page={searchOptions.currentPage}\n-                  onChangePage={(_, page: number) =>\n-                    setSearchOptions({ ...searchOptions, currentPage: page })\n-                  }\n-                  rowsPerPageOptions={[10, 25, 50]}\n-                  labelRowsPerPage={searchStrings.pagination.itemsPerPage}\n-                  rowsPerPage={searchOptions.rowsPerPage}\n-                  onChangeRowsPerPage={(event) =>\n-                    setSearchOptions({\n-                      ...searchOptions,\n-                      currentPage: 0,\n-                      rowsPerPage: parseInt(event.target.value),\n-                    })\n-                  }\n-                />\n-              </Grid>\n-            </Grid>\n-          </CardActions>\n-        </Card>\n+              {/*Add an inline style to make the spinner display at the Card's horizontal center.*/}\n+              <CardContent style={{ textAlign: \"center\" }}>\n+                {showSpinner && (\n+                  <CircularProgress\n+                    variant=\"indeterminate\"\n+                    className={\n+                      pagedSearchResult.results.length > 0\n+                        ? classes.centralSpinner\n+                        : \"\"\n+                    }\n+                  />\n+                )}\n+                {searchResultList}\n+              </CardContent>\n+\n+              <CardActions>\n+                <Grid container justify=\"center\">\n+                  <Grid item>\n+                    <TablePagination\n+                      component=\"div\"\n+                      count={pagedSearchResult.available}\n+                      page={searchOptions.currentPage}\n+                      onChangePage={(_, page: number) =>\n+                        setSearchOptions({\n+                          ...searchOptions,\n+                          currentPage: page,\n+                        })\n+                      }\n+                      rowsPerPageOptions={[10, 25, 50]}\n+                      labelRowsPerPage={searchStrings.pagination.itemsPerPage}\n+                      rowsPerPage={searchOptions.rowsPerPage}\n+                      onChangeRowsPerPage={(event) =>\n+                        setSearchOptions({\n+                          ...searchOptions,\n+                          currentPage: 0,\n+                          rowsPerPage: parseInt(event.target.value),\n+                        })\n+                      }\n+                    />\n+                  </Grid>\n+                </Grid>\n+              </CardActions>\n+            </Card>\n+          </Grid>\n+        </Grid>\n+      </Grid>\n+\n+      <Grid item xs={3}>\n+        <RefineSearchPanel>\n+          <Typography>place holder 1</Typography>\n+          <Typography>place holder 2</Typography>\n+          <Typography>place holder 3</Typography>", "originalCommit": "8e77b39977d2177239b9fa8c53d49000634c330f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDEwMTU4Ng==", "url": "https://github.com/openequella/openEQUELLA/pull/2047#discussion_r454101586", "bodyText": "That said, if that's outside the scope of this PR that's fine too.", "author": "SammyIsConfused", "createdAt": "2020-07-14T05:00:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDEwMTIwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDExOTY4MA==", "url": "https://github.com/openequella/openEQUELLA/pull/2047#discussion_r454119680", "bodyText": "I think the new component belongs to next PR \ud83d\ude03", "author": "PenghaiZhang", "createdAt": "2020-07-14T05:57:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDEwMTIwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDEyMzM1OA==", "url": "https://github.com/openequella/openEQUELLA/pull/2047#discussion_r454123358", "bodyText": "Cool! thats fair enough then.", "author": "SammyIsConfused", "createdAt": "2020-07-14T06:08:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDEwMTIwOQ=="}], "type": "inlineReview"}, {"oid": "5d8b1459ef7761f83300475ace5707bb23785119", "url": "https://github.com/openequella/openEQUELLA/commit/5d8b1459ef7761f83300475ace5707bb23785119", "message": "Merge branch 'component/new-search-page' into feature/search-page-refine-panel", "committedDate": "2020-07-14T05:05:51Z", "type": "commit"}, {"oid": "92b06ae557ea56b6f55fbdf0bb5528b803f83677", "url": "https://github.com/openequella/openEQUELLA/commit/92b06ae557ea56b6f55fbdf0bb5528b803f83677", "message": "Restructure Search page and a few Search controls\n\n1. The TextField of SearchBar is now wrapped in a Card.\n2. Move pagination from Search page to its own component.\n3. Move Search result list to its own component and put the spinner,\n   sort order select and pagination in this component.\n4. Replace MUI ExpansionPanel with MUI Accordion for component SearchResult.", "committedDate": "2020-07-14T05:22:18Z", "type": "commit"}, {"oid": "51b701403ca298bf996c6795ce9c1f4fc35f775a", "url": "https://github.com/openequella/openEQUELLA/commit/51b701403ca298bf996c6795ce9c1f4fc35f775a", "message": "Remove the Divider added on the last Search refine control.", "committedDate": "2020-07-14T05:56:32Z", "type": "commit"}, {"oid": "ccb0be9b1c20f42bb81d9173fdfb8481067dfa26", "url": "https://github.com/openequella/openEQUELLA/commit/ccb0be9b1c20f42bb81d9173fdfb8481067dfa26", "message": "Remove the style applied on RefineSearchPanel.", "committedDate": "2020-07-14T06:47:29Z", "type": "commit"}, {"oid": "d476ae5927c9371ca42dcc10674612d84bf691d9", "url": "https://github.com/openequella/openEQUELLA/commit/d476ae5927c9371ca42dcc10674612d84bf691d9", "message": "Merge branch 'component/new-search-page' into feature/search-page-refine-panel", "committedDate": "2020-07-14T23:59:50Z", "type": "commit"}, {"oid": "b7c3746df5308b7b4a1596764969d2e6428dfb76", "url": "https://github.com/openequella/openEQUELLA/commit/b7c3746df5308b7b4a1596764969d2e6428dfb76", "message": "Merge branch 'component/new-search-page' into feature/search-page-refine-panel", "committedDate": "2020-07-15T03:50:07Z", "type": "commit"}]}