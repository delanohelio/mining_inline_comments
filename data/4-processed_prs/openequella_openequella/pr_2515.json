{"pr_number": 2515, "pr_title": "Feature/buttons for selecting resources", "pr_createdAt": "2020-11-16T01:03:14Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/2515", "timeline": [{"oid": "5b27510bed0c716240fd452de84c1b6cd4d2df22", "url": "https://github.com/openequella/openEQUELLA/commit/5b27510bed0c716240fd452de84c1b6cd4d2df22", "message": "Add a new component Resource Selector and use\nit in component SearchResult.", "committedDate": "2020-11-15T23:49:39Z", "type": "commit"}, {"oid": "982b163ebfd091138db9d4b200b7cf7680418675", "url": "https://github.com/openequella/openEQUELLA/commit/982b163ebfd091138db9d4b200b7cf7680418675", "message": "Add a Storybook for ResourceSelector.", "committedDate": "2020-11-16T00:10:00Z", "type": "commit"}, {"oid": "0d961df0b5ffd1a740ee159cbc98d0b588e08ae5", "url": "https://github.com/openequella/openEQUELLA/commit/0d961df0b5ffd1a740ee159cbc98d0b588e08ae5", "message": "Add a Jest test to check if buttons for selecting\nresources are displayed in Selection Sessiin.", "committedDate": "2020-11-16T00:42:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY4Mjk4Nw==", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r524682987", "bodyText": "You could probably have a bit of JSDoc explaining this function.", "author": "SammyIsConfused", "createdAt": "2020-11-16T22:30:36Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/ResourceSelector.tsx", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import { IconButton } from \"@material-ui/core\";\n+import Tooltip from \"@material-ui/core/Tooltip\";\n+import DoubleArrowIcon from \"@material-ui/icons/DoubleArrow\";\n+import * as React from \"react\";\n+\n+export interface ResourceSelectorProps {\n+  /**\n+   * Text for the label of ResourceSelector\n+   */\n+  labelText: string;\n+  /**\n+   * Handler for clicking the ResourceSelector\n+   */\n+  onClick: () => void;\n+  /**\n+   * Whether to stop the propagation of a click event\n+   */\n+  isStopPropagation?: boolean;\n+}\n+\n+export const ResourceSelector = ({", "originalCommit": "0d961df0b5ffd1a740ee159cbc98d0b588e08ae5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY4NDI2Ng==", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r524684266", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                              onClick={nop} // todo: replace nop with an handler for selecting one attachment\n          \n          \n            \n                              onClick={nop} // todo: replace nop with a handler for selecting one attachment", "author": "SammyIsConfused", "createdAt": "2020-11-16T22:31:47Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -314,11 +322,39 @@ export default function SearchResult({\n             >\n               <ListItemText color=\"primary\" primary={description} />\n             </ItemAttachmentLink>\n+            {selectionSessionData && (\n+              <ListItemSecondaryAction>\n+                <ResourceSelector\n+                  labelText={selectResourceStrings.attachment}\n+                  isStopPropagation\n+                  onClick={nop} // todo: replace nop with an handler for selecting one attachment", "originalCommit": "0d961df0b5ffd1a740ee159cbc98d0b588e08ae5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY4NTA0MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r524685041", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        onClick={nop} // todo: replace nop with an handler for selecting attachments\n          \n          \n            \n                        onClick={nop} // todo: replace nop with a handler for selecting attachments", "author": "SammyIsConfused", "createdAt": "2020-11-16T22:32:31Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -314,11 +322,39 @@ export default function SearchResult({\n             >\n               <ListItemText color=\"primary\" primary={description} />\n             </ItemAttachmentLink>\n+            {selectionSessionData && (\n+              <ListItemSecondaryAction>\n+                <ResourceSelector\n+                  labelText={selectResourceStrings.attachment}\n+                  isStopPropagation\n+                  onClick={nop} // todo: replace nop with an handler for selecting one attachment\n+                />\n+              </ListItemSecondaryAction>\n+            )}\n           </ListItem>\n         );\n       }\n     );\n \n+    const accordionText = (\n+      <Typography>{searchResultStrings.attachments}</Typography>\n+    );\n+\n+    const accordionSummaryContent = selectionSessionData ? (\n+      <Grid container alignItems=\"center\">\n+        <Grid item>{accordionText}</Grid>\n+        <Grid>\n+          <ResourceSelector\n+            labelText={selectResourceStrings.allAttachments}\n+            isStopPropagation\n+            onClick={nop} // todo: replace nop with an handler for selecting attachments", "originalCommit": "0d961df0b5ffd1a740ee159cbc98d0b588e08ae5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY4NjIxMw==", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r524686213", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      onClick={nop} // todo: replace nop with an handler for selecting summary page\n          \n          \n            \n                      onClick={nop} // todo: replace nop with a handler for selecting summary page", "author": "SammyIsConfused", "createdAt": "2020-11-16T22:33:42Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -390,14 +428,29 @@ export default function SearchResult({\n     );\n   };\n \n+  const itemPrimaryContent = selectionSessionData ? (\n+    <Grid container alignItems=\"center\">\n+      <Grid item>{itemLink()}</Grid>\n+      <Grid item>\n+        <ResourceSelector\n+          labelText={selectResourceStrings.summaryPage}\n+          isStopPropagation\n+          onClick={nop} // todo: replace nop with an handler for selecting summary page", "originalCommit": "0d961df0b5ffd1a740ee159cbc98d0b588e08ae5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY5NzkyMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r524697921", "bodyText": "Nit: I wonder if doing a change like this would help readability:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              const selectionSessionData = renderData?.selectionSessionInfo;\n          \n          \n            \n              const inSelectionSession: boolean = renderData?.selectionSessionInfo;\n          \n      \n    \n    \n  \n\nAnd then in the one place you need selectionSessionInfo as the actual data structure, you simply use renderData?.selectionSessionInfo.", "author": "edalex-ian", "createdAt": "2020-11-16T22:44:45Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -141,6 +146,8 @@ export default function SearchResult({\n     viewerDetails?: OEQ.MimeType.MimeTypeViewerDetail;\n   }\n   const renderData = getRenderData();\n+  const selectionSessionData = renderData?.selectionSessionInfo;", "originalCommit": "0d961df0b5ffd1a740ee159cbc98d0b588e08ae5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ4MDA0Nw==", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r526480047", "bodyText": "I like this, but this we need to do a type casting from undefined to boolean.\nAlso we will need to change the parameter type of buildSelectionSessionItemSummaryLink.\nAnd lastly, we need to add a type check for whether Selection Session info is null/undefined and throw an error if yes.", "author": "PenghaiZhang", "createdAt": "2020-11-18T22:59:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY5NzkyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzMwNjc3Mg==", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r527306772", "bodyText": "As per discussions this morning, it'd still be good to address this for future readability/maintainability. @PenghaiZhang is going to see what he can come up with.", "author": "edalex-ian", "createdAt": "2020-11-20T00:34:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY5NzkyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTY5MTMxNA==", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r525691314", "bodyText": "This seems a bit surprising.\nWhy remove the ul list semantics from a list element?", "author": "ChristianMurphy", "createdAt": "2020-11-18T02:57:58Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -351,13 +387,15 @@ export default function SearchResult({\n           <AccordionSummary expandIcon={<ExpandMore />}>\n             <Grid container spacing={2} alignItems=\"center\">\n               <Grid item>{attachFileBadge(keywordFoundInAttachment)}</Grid>\n-              <Grid item>\n-                <Typography>{searchResultStrings.attachments}</Typography>\n-              </Grid>\n+              <Grid item>{accordionSummaryContent}</Grid>\n             </Grid>\n           </AccordionSummary>\n           <AccordionDetails>\n-            <List component=\"div\" disablePadding>\n+            <List\n+              component=\"div\"", "originalCommit": "0d961df0b5ffd1a740ee159cbc98d0b588e08ae5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ1MDE2MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r526450161", "bodyText": "Hi @mrblippy, do you have any answer for Christian's query ?\nI probably miss the background of using div here. Actually, I have tried to remove component=\"div\" and the UI seems unchanged.", "author": "PenghaiZhang", "createdAt": "2020-11-18T21:58:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTY5MTMxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzMxMDA1MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r527310051", "bodyText": "I can't remember exactly why i added that. But, when i look at it now, it really doesn't make sense for a List component to be a div \ud83e\udd14\nI would say you are fine to remove it @PenghaiZhang", "author": "mrblippy", "createdAt": "2020-11-20T00:38:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTY5MTMxNA=="}], "type": "inlineReview"}, {"oid": "765346aee39f4154f4d787b4811de508656476f2", "url": "https://github.com/openequella/openEQUELLA/commit/765346aee39f4154f4d787b4811de508656476f2", "message": "Tidy ups for ResourceSelector and SearchResult.", "committedDate": "2020-11-18T23:03:50Z", "type": "commit"}, {"oid": "bdf5f48e027fab95a009c2b82d697b104968a772", "url": "https://github.com/openequella/openEQUELLA/commit/bdf5f48e027fab95a009c2b82d697b104968a772", "message": "Use the default component 'ul' for the Attachment list.", "committedDate": "2020-11-20T01:02:45Z", "type": "commit"}, {"oid": "dbf1fc72047452e37701f3bc220d17c302424843", "url": "https://github.com/openequella/openEQUELLA/commit/dbf1fc72047452e37701f3bc220d17c302424843", "message": "Handle Selection Session info in module rather than in UI.", "committedDate": "2020-11-20T05:45:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ2MjQ3OA==", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r527462478", "bodyText": "Nit\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            const isSelectionSession = (\n          \n          \n            \n            const isSelectionSessionInfo = (", "author": "edalex-ian", "createdAt": "2020-11-20T06:25:11Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/modules/SelectionSessionModule.ts", "diffHunk": "@@ -15,26 +15,48 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-import { AppConfig, SelectionSessionInfo } from \"../AppConfig\";\n+import { AppConfig, getRenderData, SelectionSessionInfo } from \"../AppConfig\";\n+\n+const selectionSessionInfo:\n+  | SelectionSessionInfo\n+  | undefined\n+  | null = getRenderData()?.selectionSessionInfo;\n+\n+/**\n+ * Type guard to check whether an object is of type SelectionSessionInfo.\n+ * @param data The data to be checked\n+ */\n+const isSelectionSession = (", "originalCommit": "dbf1fc72047452e37701f3bc220d17c302424843", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ2NDMxMw==", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r527464313", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Build a Selection Session specific ItemSummary Link.\n          \n          \n            \n             * Build a Selection Session specific ItemSummary Link. Recommended to first call `inSelectionSession()`\n          \n          \n            \n             * before use.", "author": "edalex-ian", "createdAt": "2020-11-20T06:27:04Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/modules/SelectionSessionModule.ts", "diffHunk": "@@ -15,26 +15,48 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-import { AppConfig, SelectionSessionInfo } from \"../AppConfig\";\n+import { AppConfig, getRenderData, SelectionSessionInfo } from \"../AppConfig\";\n+\n+const selectionSessionInfo:\n+  | SelectionSessionInfo\n+  | undefined\n+  | null = getRenderData()?.selectionSessionInfo;\n+\n+/**\n+ * Type guard to check whether an object is of type SelectionSessionInfo.\n+ * @param data The data to be checked\n+ */\n+const isSelectionSession = (\n+  data: unknown\n+): data is { [K in keyof SelectionSessionInfo]: unknown } =>\n+  typeof data === \"object\" && data !== null && \"stateId\" in data;\n+\n+/**\n+ * True if the Selection Session info provided by renderData is neither null nor undefined.\n+ */\n+export const inSelectionSession = isSelectionSession(selectionSessionInfo);\n+\n /**\n  * Build a Selection Session specific ItemSummary Link.", "originalCommit": "dbf1fc72047452e37701f3bc220d17c302424843", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ2NTMxNg==", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r527465316", "bodyText": "Be good to force the issue here - also for the sake of doco:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            export const inSelectionSession = isSelectionSession(selectionSessionInfo);\n          \n          \n            \n            export const inSelectionSession: boolean = isSelectionSession(selectionSessionInfo);", "author": "edalex-ian", "createdAt": "2020-11-20T06:28:16Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/modules/SelectionSessionModule.ts", "diffHunk": "@@ -15,26 +15,48 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-import { AppConfig, SelectionSessionInfo } from \"../AppConfig\";\n+import { AppConfig, getRenderData, SelectionSessionInfo } from \"../AppConfig\";\n+\n+const selectionSessionInfo:\n+  | SelectionSessionInfo\n+  | undefined\n+  | null = getRenderData()?.selectionSessionInfo;\n+\n+/**\n+ * Type guard to check whether an object is of type SelectionSessionInfo.\n+ * @param data The data to be checked\n+ */\n+const isSelectionSession = (\n+  data: unknown\n+): data is { [K in keyof SelectionSessionInfo]: unknown } =>\n+  typeof data === \"object\" && data !== null && \"stateId\" in data;\n+\n+/**\n+ * True if the Selection Session info provided by renderData is neither null nor undefined.\n+ */\n+export const inSelectionSession = isSelectionSession(selectionSessionInfo);", "originalCommit": "dbf1fc72047452e37701f3bc220d17c302424843", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQzNjU5Ng==", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r528436596", "bodyText": "I have to change this const to a function to make tests passed. As a const, it gets evaluated during those imports (SearchResult imports this from the module) and the mocks done in the test are too late. So making it a function can help solve this issue.", "author": "PenghaiZhang", "createdAt": "2020-11-23T01:22:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ2NTMxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAyOTYzOQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2515#discussion_r529029639", "bodyText": "Ha! I almost commented on this during the review, but then decided the single evaluation would be fine. I forgot about the test side of things. ;)", "author": "edalex-ian", "createdAt": "2020-11-23T22:12:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ2NTMxNg=="}], "type": "inlineReview"}, {"oid": "fc06f1dc1f3acddc3d4ad402a58fd404a0dfcbef", "url": "https://github.com/openequella/openEQUELLA/commit/fc06f1dc1f3acddc3d4ad402a58fd404a0dfcbef", "message": "Mock renderData in SelectionSessionModule test.", "committedDate": "2020-11-23T01:36:19Z", "type": "commit"}, {"oid": "ec0695fcc14d6cc13380c166a11135c3af17f345", "url": "https://github.com/openequella/openEQUELLA/commit/ec0695fcc14d6cc13380c166a11135c3af17f345", "message": "Tweaks for SelectionSessionModule and SearchResult\n\n1. Remove the const for selectionSessionInfo retrieved from\nrenderData.\n2. Use a function instead of a const so that tests can mock\nthe function.", "committedDate": "2020-11-23T01:41:17Z", "type": "commit"}]}