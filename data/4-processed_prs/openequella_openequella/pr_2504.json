{"pr_number": 2504, "pr_title": "Feature/navigate to item summary page", "pr_createdAt": "2020-11-12T00:10:15Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/2504", "timeline": [{"oid": "a245affddd7a95955e49a232865c3db48a2be82d", "url": "https://github.com/openequella/openEQUELLA/commit/a245affddd7a95955e49a232865c3db48a2be82d", "message": "Tweak 'NewPageProps' and 'NewPage'\n\nRename 'isOpenInSelectionSession' to 'forceRefresh' and add\na comment to explain why 'SettingsPage' needs 'forceRefresh'.", "committedDate": "2020-11-11T23:51:32Z", "type": "commit"}, {"oid": "6e1ab77726517286b1af093fa913d5c4032e8929", "url": "https://github.com/openequella/openEQUELLA/commit/6e1ab77726517286b1af093fa913d5c4032e8929", "message": "Remove the extra call of 'getNewSearchUIContent' in\nAbstractRootSearchSection.", "committedDate": "2020-11-11T23:51:32Z", "type": "commit"}, {"oid": "33b75433dd5b6d5f79aadb79da64b2764b1814b6", "url": "https://github.com/openequella/openEQUELLA/commit/33b75433dd5b6d5f79aadb79da64b2764b1814b6", "message": "Navigate from new Search page to ItemSummary page in\nSelection Session.\n\nTo display the Selection Session specific ItemSummary\npage, extra information such as the ID of a Selection\nSession and the Item count of a Search result is required\nto help the legacy server rendering. So we can collect\nSelection Session info from 'renderData' and pass Search\nresult data from component 'SearchPage' to 'SearchResult',\nand then add query params to each Item title link.\n\nPlease note that MUI Link is used for the navigation in\nSelection Session. This is due to the complexity of creating\na route in this context. Once we have a new component for\nItemSummary page, we should come back and use React Router\nLink.", "committedDate": "2020-11-11T23:51:33Z", "type": "commit"}, {"oid": "b8205991b6ea09183ad1f840a72332da2b3833c0", "url": "https://github.com/openequella/openEQUELLA/commit/b8205991b6ea09183ad1f840a72332da2b3833c0", "message": "Make 'indexNumber' and 'totalCount' optional.", "committedDate": "2020-11-12T00:53:11Z", "type": "commit"}, {"oid": "398e915fca4db56a9640d24c161da667aebd6dc1", "url": "https://github.com/openequella/openEQUELLA/commit/398e915fca4db56a9640d24c161da667aebd6dc1", "message": "Update the Storybook of SearchResultList.", "committedDate": "2020-11-12T01:11:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc0NDAyMA==", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r521744020", "bodyText": "How about if you you make forceRefresh default to false so that the absence of this property on the element means it's off?", "author": "edalex-ian", "createdAt": "2020-11-12T00:49:56Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/App.tsx", "diffHunk": "@@ -93,15 +86,17 @@ const App = ({ entryPage }: AppProps) => {\n     [\n       Literal(\"searchPage\"),\n       () => (\n-        <NewPage classPrefix=\"oeq-nsp\" isOpenInSelectionSession>\n+        <NewPage classPrefix=\"oeq-nsp\" forceRefresh={false}>", "originalCommit": "33b75433dd5b6d5f79aadb79da64b2764b1814b6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc0NTAzNA==", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r521745034", "bodyText": "I believe you need to update the SB stories for these - I'd say that's what's triggering the build failure.\nhmmm, is it possible these props will help us later to add support for the Item Summary Page next/prev buttons?", "author": "edalex-ian", "createdAt": "2020-11-12T00:51:41Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -112,12 +117,22 @@ export interface SearchResultProps {\n    * The details of the items to display.\n    */\n   item: OEQ.Search.SearchResultItem;\n+  /**\n+   * The index of an search result Item which does not take Pagination into account.\n+   */\n+  indexNumber: number;\n+  /**\n+   * The total number of available Items matching current Search options.\n+   */\n+  totalCount: number;", "originalCommit": "33b75433dd5b6d5f79aadb79da64b2764b1814b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc4Njk0Mg==", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r521786942", "bodyText": "Yes they will! And perhaps more importantly,  these two buttons are missing if ItemSummary page is opened from new Search page.", "author": "PenghaiZhang", "createdAt": "2020-11-12T02:59:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc0NTAzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc1NTU2MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r521755561", "bodyText": "This block of logic should really be out in the Module layer. It's more to do with the internal workings of oEQ as opposed to how we present a result.\nconst buildSelectionSessionItemSummaryLink =\n  ({ stateId, integId, layout }: SelectionSessionInfo,\n  indexNumber?: number, totalCount?: number): string => {\n    ...\n}\nIf you had something like that, then this method could be more (declarative) like:\nconst itemLink = () => {\n  const itemTitle = name ? highlightField(name) : uuid;\n  const basicLink = <Link to={routes.ViewItem.to(uuid, version)}>{itemTitle}</Link>;\n  return renderData?.selectionSessionInfo ?\n    (<MUILink\n      href={buildSelectionSessionItemSummaryLink(renderData.selectionSessionInfo)}\n      underline=\"none\">\n        {itemTitle}\n    </MUILink>) :\n    basicLink;\n}\nAdded bonus, would be that you can then also easily unit test this.", "author": "edalex-ian", "createdAt": "2020-11-12T01:10:37Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -366,11 +381,36 @@ export default function SearchResult({\n   const highlightField = (fieldValue: string) =>\n     ReactHtmlParser(highlight(fieldValue, highlights, classes.highlight));\n \n-  const itemLink = (\n-    <Link to={routes.ViewItem.to(uuid, version)}>\n-      {name ? highlightField(name) : uuid}\n-    </Link>\n-  );\n+  const itemLink = () => {\n+    const itemTitle = name ? highlightField(name) : uuid;\n+    if (renderData?.selectionSessionInfo) {\n+      const { stateId, integId, layout } = renderData.selectionSessionInfo;\n+      let itemSummaryPageLink = AppConfig.baseUrl.concat(\n+        `items/${uuid}/${version}/?_sl.stateId=${stateId}&a=${layout}&search=%/searching.do`\n+      );\n+\n+      if (indexNumber !== undefined && totalCount !== undefined) {\n+        itemSummaryPageLink = itemSummaryPageLink.concat(\n+          `&index=${indexNumber}&available=${totalCount}`\n+        );\n+      }\n+\n+      // integId can be null in 'Resource Selector'.\n+      if (integId) {\n+        itemSummaryPageLink = itemSummaryPageLink.concat(`&_int.id=${integId}`);\n+      }", "originalCommit": "b8205991b6ea09183ad1f840a72332da2b3833c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ac2004a300d4a197ebb1a55559b718da3f0b7eba", "url": "https://github.com/openequella/openEQUELLA/commit/ac2004a300d4a197ebb1a55559b718da3f0b7eba", "message": "Make 'forceRefresh' optional and default to false.", "committedDate": "2020-11-12T02:29:26Z", "type": "commit"}, {"oid": "4718deea2fd017a60ddadbe744633bc159d67b76", "url": "https://github.com/openequella/openEQUELLA/commit/4718deea2fd017a60ddadbe744633bc159d67b76", "message": "Add a new ts module for Selection Session which provides\na function to generate ItemSummary link.", "committedDate": "2020-11-12T03:48:11Z", "type": "commit"}, {"oid": "52bc0c66963e8a003dc0268d947a0c59cb1c28ea", "url": "https://github.com/openequella/openEQUELLA/commit/52bc0c66963e8a003dc0268d947a0c59cb1c28ea", "message": "Remove Item index and Item count for SearchResult\n\nDue to the Next/Prev buttons in ItemSummary page\nnot working, do not put Item index and Item count\nin Item title link.", "committedDate": "2020-11-12T03:51:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg2NzA0MA==", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r521867040", "bodyText": "Hmmm, TSDoc is a bit curious here, as really the param is a SelectionSessionInfo object and you'd refer there for the value of the inside params. \ud83d\ude15\nHere's how it's done in JSDoc land... But no TSDoc / typedoc description is jumping out for me. \ud83d\ude1e", "author": "edalex-ian", "createdAt": "2020-11-12T06:30:35Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/modules/SelectionSessionModule.ts", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import { AppConfig } from \"../AppConfig\";\n+import { SelectionSessionInfo } from \"../mainui\";\n+\n+/**\n+ * Build a Selection Session specific ItemSummary Link.\n+ * @param stateId The ID of a Selection Session\n+ * @param integId The ID of a LSM Integration\n+ * @param layout The UI layout used in Selection Session", "originalCommit": "52bc0c66963e8a003dc0268d947a0c59cb1c28ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "792d1c24ccf853d6b428f4733037652419557400", "url": "https://github.com/openequella/openEQUELLA/commit/792d1c24ccf853d6b428f4733037652419557400", "message": "Centralise 'renderData' and provide a function to access it.", "committedDate": "2020-11-12T23:30:32Z", "type": "commit"}, {"oid": "876623e1d100a60a8370ad0e130404bf3389f7dc", "url": "https://github.com/openequella/openEQUELLA/commit/876623e1d100a60a8370ad0e130404bf3389f7dc", "message": "Add a type guard for accessing 'renderData'.", "committedDate": "2020-11-13T04:35:54Z", "type": "commit"}, {"oid": "6538f4a5310f6ac450d9aeeba159663acb5f63c5", "url": "https://github.com/openequella/openEQUELLA/commit/6538f4a5310f6ac450d9aeeba159663acb5f63c5", "message": "Update TSDoc for 'buildSelectionSessionItemSummaryLink'.", "committedDate": "2020-11-13T05:10:16Z", "type": "commit"}, {"oid": "f3b59b93da0bd4f56ea93188d6a46d2da8cbe924", "url": "https://github.com/openequella/openEQUELLA/commit/f3b59b93da0bd4f56ea93188d6a46d2da8cbe924", "message": "Add a Jest test for 'SelectionSessionModule'.", "committedDate": "2020-11-13T05:11:57Z", "type": "commit"}, {"oid": "8413122da80bb64867f16ca6caa72a3c9c247a68", "url": "https://github.com/openequella/openEQUELLA/commit/8413122da80bb64867f16ca6caa72a3c9c247a68", "message": "Tidy ups for SearchResult and SearchResultList.", "committedDate": "2020-11-13T05:12:33Z", "type": "commit"}, {"oid": "52ad7612e2f10aa6339f85abf3c3381242d12d67", "url": "https://github.com/openequella/openEQUELLA/commit/52ad7612e2f10aa6339f85abf3c3381242d12d67", "message": "Add Jest tests to check the Item title link of SearchResult.", "committedDate": "2020-11-13T05:15:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3MjEwMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r523272101", "bodyText": "Due to the name of this file we already know it's for the SelectionSessionModule. More so, this block is all about the buildSelectionSessionItemSummaryLink so it'd make more sense to go with:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            describe(\"SelectionSessionModule\", () => {\n          \n          \n            \n            describe(\"buildSelectionSessionItemSummaryLink()\", () => {\n          \n      \n    \n    \n  \n\nAnd then later when SelectionSessionModule has more functions, you'd add another describe block for each function.", "author": "edalex-ian", "createdAt": "2020-11-13T22:47:29Z", "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/modules/SelectionSessionModule.test.ts", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import { getSearchResult } from \"../../../__mocks__/SearchResult.mock\";\n+import type { SelectionSessionInfo } from \"../../../tsrc/AppConfig\";\n+import { buildSelectionSessionItemSummaryLink } from \"../../../tsrc/modules/SelectionSessionModule\";\n+\n+describe(\"SelectionSessionModule\", () => {", "originalCommit": "52ad7612e2f10aa6339f85abf3c3381242d12d67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3MjM5Nw==", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r523272397", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              it(\"should build a URL for accessing ItemSummary page in Selection Session\", () => {\n          \n          \n            \n              it(\"builds basic URLs for accessing ItemSummary pages in Selection Session mode\", () => {", "author": "edalex-ian", "createdAt": "2020-11-13T22:48:31Z", "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/modules/SelectionSessionModule.test.ts", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import { getSearchResult } from \"../../../__mocks__/SearchResult.mock\";\n+import type { SelectionSessionInfo } from \"../../../tsrc/AppConfig\";\n+import { buildSelectionSessionItemSummaryLink } from \"../../../tsrc/modules/SelectionSessionModule\";\n+\n+describe(\"SelectionSessionModule\", () => {\n+  const selectionSessionInfo: SelectionSessionInfo = {\n+    stateId: \"1\",\n+    layout: \"coursesearch\",\n+  };\n+  const { uuid, version } = getSearchResult.results[0];\n+\n+  it(\"should build a URL for accessing ItemSummary page in Selection Session\", () => {", "originalCommit": "52ad7612e2f10aa6339f85abf3c3381242d12d67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3MjY0Nw==", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r523272647", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              it(\"should also include Integration ID in the URL\", () => {\n          \n          \n            \n              it(\"will include the Integration ID in the URL if provided in SelectionSessionInfo\", () => {", "author": "edalex-ian", "createdAt": "2020-11-13T22:49:20Z", "path": "Source/Plugins/Core/com.equella.core/js/__tests__/tsrc/modules/SelectionSessionModule.test.ts", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import { getSearchResult } from \"../../../__mocks__/SearchResult.mock\";\n+import type { SelectionSessionInfo } from \"../../../tsrc/AppConfig\";\n+import { buildSelectionSessionItemSummaryLink } from \"../../../tsrc/modules/SelectionSessionModule\";\n+\n+describe(\"SelectionSessionModule\", () => {\n+  const selectionSessionInfo: SelectionSessionInfo = {\n+    stateId: \"1\",\n+    layout: \"coursesearch\",\n+  };\n+  const { uuid, version } = getSearchResult.results[0];\n+\n+  it(\"should build a URL for accessing ItemSummary page in Selection Session\", () => {\n+    const link = buildSelectionSessionItemSummaryLink(\n+      selectionSessionInfo,\n+      uuid,\n+      version\n+    );\n+    expect(link).toBe(\n+      \"items/9b9bf5a9-c5af-490b-88fe-7e330679fad2/1/?_sl.stateId=1&a=coursesearch\"\n+    );\n+  });\n+\n+  it(\"should also include Integration ID in the URL\", () => {", "originalCommit": "52ad7612e2f10aa6339f85abf3c3381242d12d67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3NDExMA==", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r523274110", "bodyText": "Should this be:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              selectionSessionInfo: SelectionSessionInfo | null;\n          \n          \n            \n              selectionSessionInfo?: SelectionSessionInfo;\n          \n      \n    \n    \n  \n\nOr is it explicitly null sometimes?", "author": "edalex-ian", "createdAt": "2020-11-13T22:54:18Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/AppConfig.ts", "diffHunk": "@@ -22,6 +22,41 @@ interface Config {\n   baseUrl: string;\n }\n \n+/**\n+ * Structure of Selection Session information which is used to help build\n+ * components(e.g. SearchResult) in the context of Selection Session.\n+ */\n+export interface SelectionSessionInfo {\n+  /**\n+   * The ID of a Selection Session\n+   */\n+  stateId: string;\n+  /**\n+   * The ID of an LMS Integration\n+   */\n+  integId?: string;\n+  /**\n+   * The UI layout used in Selection Session\n+   */\n+  layout: \"coursesearch\" | \"search\" | \"skinnysearch\";\n+}\n+\n+export interface RenderData {\n+  baseResources: string;\n+  newUI: boolean;\n+  autotestMode: boolean;\n+  newSearch: boolean;\n+  selectionSessionInfo: SelectionSessionInfo | null;", "originalCommit": "52ad7612e2f10aa6339f85abf3c3381242d12d67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3NjUxNA==", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r523276514", "bodyText": "Being an exported function, we should make sure we fully type it:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            export const getRenderData = () => {\n          \n          \n            \n            export const getRenderData = (): RenderData | undefined => {", "author": "edalex-ian", "createdAt": "2020-11-13T23:02:00Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/AppConfig.ts", "diffHunk": "@@ -22,6 +22,41 @@ interface Config {\n   baseUrl: string;\n }\n \n+/**\n+ * Structure of Selection Session information which is used to help build\n+ * components(e.g. SearchResult) in the context of Selection Session.\n+ */\n+export interface SelectionSessionInfo {\n+  /**\n+   * The ID of a Selection Session\n+   */\n+  stateId: string;\n+  /**\n+   * The ID of an LMS Integration\n+   */\n+  integId?: string;\n+  /**\n+   * The UI layout used in Selection Session\n+   */\n+  layout: \"coursesearch\" | \"search\" | \"skinnysearch\";\n+}\n+\n+export interface RenderData {\n+  baseResources: string;\n+  newUI: boolean;\n+  autotestMode: boolean;\n+  newSearch: boolean;\n+  selectionSessionInfo: SelectionSessionInfo | null;\n+}\n+\n+declare const renderData: RenderData | undefined;\n+export const getRenderData = () => {", "originalCommit": "52ad7612e2f10aa6339f85abf3c3381242d12d67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3NzExMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r523277111", "bodyText": "Nit: Should this be more specific - should we be checking to see if renderData is an instance of RenderData. If so, maybe rework this function to a simple () => match(...).", "author": "edalex-ian", "createdAt": "2020-11-13T23:04:05Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/AppConfig.ts", "diffHunk": "@@ -22,6 +22,41 @@ interface Config {\n   baseUrl: string;\n }\n \n+/**\n+ * Structure of Selection Session information which is used to help build\n+ * components(e.g. SearchResult) in the context of Selection Session.\n+ */\n+export interface SelectionSessionInfo {\n+  /**\n+   * The ID of a Selection Session\n+   */\n+  stateId: string;\n+  /**\n+   * The ID of an LMS Integration\n+   */\n+  integId?: string;\n+  /**\n+   * The UI layout used in Selection Session\n+   */\n+  layout: \"coursesearch\" | \"search\" | \"skinnysearch\";\n+}\n+\n+export interface RenderData {\n+  baseResources: string;\n+  newUI: boolean;\n+  autotestMode: boolean;\n+  newSearch: boolean;\n+  selectionSessionInfo: SelectionSessionInfo | null;\n+}\n+\n+declare const renderData: RenderData | undefined;\n+export const getRenderData = () => {\n+  if (typeof renderData !== \"undefined\") {", "originalCommit": "52ad7612e2f10aa6339f85abf3c3381242d12d67", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzM2ODU2OQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r523368569", "bodyText": "I guess we have to resort to typeof to ensure settings page works fine in Old UI. This is because renderData does not exist in Old UI at all. So any use of it will trigger a uncaught reference error.\nBut I can simply this function with a ternary operator.", "author": "PenghaiZhang", "createdAt": "2020-11-14T03:27:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3NzExMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3NzMxMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r523277311", "bodyText": "Noice! \ud83d\udc4d", "author": "edalex-ian", "createdAt": "2020-11-13T23:04:42Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/RichTextEditor.tsx", "diffHunk": "@@ -59,9 +59,8 @@ import \"tinymce/plugins/toc\";\n import \"tinymce/plugins/visualblocks\";\n import \"tinymce/plugins/visualchars\";\n import \"tinymce/plugins/wordcount\";\n-import type { RenderData } from \"../mainui\";\n \n-declare const renderData: RenderData | undefined;\n+const renderData = getRenderData();", "originalCommit": "52ad7612e2f10aa6339f85abf3c3381242d12d67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3NzY2NA==", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r523277664", "bodyText": "Yup, I think this makes much more sense now in AppConfig. Good work. \ud83d\udc4d", "author": "edalex-ian", "createdAt": "2020-11-13T23:05:48Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/index.tsx", "diffHunk": "@@ -20,32 +20,6 @@ import * as ReactDOM from \"react-dom\";\n import { initStrings } from \"../util/langstrings\";\n import \"../util/polyfill\";\n \n-/**\n- * Structure of Selection Session information which is used to help build\n- * components(e.g. SearchResult) in the context of Selection Session.\n- */\n-interface SelectionSessionInfo {\n-  /**\n-   * The ID of a Selection Session\n-   */\n-  stateId: string;\n-  /**\n-   * The ID of an LMS Integration\n-   */\n-  integId?: string;\n-  /**\n-   * The UI layout used in Selection Session\n-   */\n-  layout: string;\n-}\n-\n-export interface RenderData {\n-  baseResources: string;\n-  newUI: boolean;\n-  autotestMode: boolean;\n-  newSearch: boolean;\n-  selectionSessionInfo: SelectionSessionInfo | null;\n-}", "originalCommit": "52ad7612e2f10aa6339f85abf3c3381242d12d67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3ODQxOA==", "url": "https://github.com/openequella/openEQUELLA/pull/2504#discussion_r523278418", "bodyText": "Nit. Seeing you're only using in once place below, throwing in a variable is a bit redundant.", "author": "edalex-ian", "createdAt": "2020-11-13T23:08:36Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/SearchResult.tsx", "diffHunk": "@@ -137,7 +140,7 @@ export default function SearchResult({\n     attachment: OEQ.Search.Attachment;\n     viewerDetails?: OEQ.MimeType.MimeTypeViewerDetail;\n   }\n-\n+  const renderData = getRenderData();", "originalCommit": "52ad7612e2f10aa6339f85abf3c3381242d12d67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2d666d551e7aa059a9d2b6cd91558f8c8d9197ba", "url": "https://github.com/openequella/openEQUELLA/commit/2d666d551e7aa059a9d2b6cd91558f8c8d9197ba", "message": "A few tweaks for SelectionSessionModule test.", "committedDate": "2020-11-14T01:50:19Z", "type": "commit"}, {"oid": "2dc1424f9b296c1b7408ee400c8cb8dbd1863307", "url": "https://github.com/openequella/openEQUELLA/commit/2dc1424f9b296c1b7408ee400c8cb8dbd1863307", "message": "Type function 'getRenderData'.", "committedDate": "2020-11-14T02:49:54Z", "type": "commit"}, {"oid": "9b9358fca158663f193341300436b660e3c89667", "url": "https://github.com/openequella/openEQUELLA/commit/9b9358fca158663f193341300436b660e3c89667", "message": "Simplify function 'getRenderData'.", "committedDate": "2020-11-14T03:30:03Z", "type": "commit"}]}