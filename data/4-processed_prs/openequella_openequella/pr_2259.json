{"pr_number": 2259, "pr_title": "Feature/facet selector integration", "pr_createdAt": "2020-09-09T00:00:51Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/2259", "timeline": [{"oid": "8bbba9ebbfbf5e2c32740e20f4c353a207ae7bdf", "url": "https://github.com/openequella/openEQUELLA/commit/8bbba9ebbfbf5e2c32740e20f4c353a207ae7bdf", "message": "Don't show the Classification panel if there are no Classifications configured.", "committedDate": "2020-09-08T04:37:07Z", "type": "commit"}, {"oid": "aad1c5b7be7ba4e6523343a315d26c6046f3f879", "url": "https://github.com/openequella/openEQUELLA/commit/aad1c5b7be7ba4e6523343a315d26c6046f3f879", "message": "Refactor the logic of generating category where clause\n\nEach Classification should be joined by AND, and each selected category\nof one Classification should be joined by OR.", "committedDate": "2020-09-08T04:44:27Z", "type": "commit"}, {"oid": "9fc12b7e4f8c3f27178ff28f793e1690168e6d92", "url": "https://github.com/openequella/openEQUELLA/commit/9fc12b7e4f8c3f27178ff28f793e1690168e6d92", "message": "Refactor SearchFacetsModule for where clause\n\nA where clause for each Classification should only use categories\nof other Classifications", "committedDate": "2020-09-08T04:46:38Z", "type": "commit"}, {"oid": "ac7b43a58d8e72ccbc90366614d1bc7b183e71a2", "url": "https://github.com/openequella/openEQUELLA/commit/ac7b43a58d8e72ccbc90366614d1bc7b183e71a2", "message": "Refactor Category Selector.\n\nCategories that have been selected but no longer apply to current\nsearch criteria should be displayed as well, and their counts are\n0.", "committedDate": "2020-09-08T05:00:02Z", "type": "commit"}, {"oid": "3f5c199b39b0ead1b834e6874c2ac37466b98f8d", "url": "https://github.com/openequella/openEQUELLA/commit/3f5c199b39b0ead1b834e6874c2ac37466b98f8d", "message": "Update Search module test for the where clause change.", "committedDate": "2020-09-08T06:03:58Z", "type": "commit"}, {"oid": "60493f59770677cee1748dd8ab7eeded34361082", "url": "https://github.com/openequella/openEQUELLA/commit/60493f59770677cee1748dd8ab7eeded34361082", "message": "The Classification panel should not display if all Classifications have\nno categories.", "committedDate": "2020-09-08T23:02:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI2MDYwOQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2259#discussion_r485260609", "bodyText": "It was struggling for me to give proper names in this function. so HELP wanted.", "author": "PenghaiZhang", "createdAt": "2020-09-09T00:04:33Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/CategorySelector.tsx", "diffHunk": "@@ -212,21 +212,28 @@ export const CategorySelector = ({\n   ): ReactElement[] => {\n     const selectedTerms: string[] =\n       selectedCategories?.find((c) => c.id === id)?.categories ?? [];\n-    const selectedFacets: OEQ.SearchFacets.Facet[] = selectedTerms.map(\n-      (selectedTerm) => {\n-        const facet = categories.find((c) => selectedTerm === c.term);\n-        if (!facet) {\n-          throw new Error(\n-            \"Data integrity issue, we're unable to match a selected term.\"\n-          );\n-        }\n \n-        return facet;\n-      }\n+    // Previously selected categories that still apply to current search criteria.\n+    const selectedAndExist = categories.filter((c) =>", "originalCommit": "60493f59770677cee1748dd8ab7eeded34361082", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTMyOTQwMA==", "url": "https://github.com/openequella/openEQUELLA/pull/2259#discussion_r485329400", "bodyText": "You could go with:\n\nselectedApplicable\nselectedNotApplicable\nnotSelected\n\nAnd to further this idea, it'd be great to maintain the relationships here strictly back to selectedTerms. So how about changing the first two sets to be processed with something like:\nconst [selectedApplicable, selectedNotApplicable] =\n  selectedTerms.reduce<[OEQ.SearchFacets.Facet[], OEQ.SearchFacets.Facet[]]>(\n    ([applicable, notApplicable], term) => {\n      const applicableCategory = category.find( c => c.term === term );\n      return applicableCategory\n        ? [applicable.concat(applicableCategory), notApplicable]\n        : [applicable, notApplicable.concat({term: term, count: 0});\n    }, [[], []]);\nThis is a bit more verbose, but it ties it the data structure it is being generated from, and so I think it's worth that.", "author": "edalex-ian", "createdAt": "2020-09-09T04:25:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI2MDYwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTMzNjI2OA==", "url": "https://github.com/openequella/openEQUELLA/pull/2259#discussion_r485336268", "bodyText": "This is a very good use of reduce! I like it!", "author": "PenghaiZhang", "createdAt": "2020-09-09T04:50:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI2MDYwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTMyOTQ4MA==", "url": "https://github.com/openequella/openEQUELLA/pull/2259#discussion_r485329480", "bodyText": "I'm guess this is a typo and should be:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                const noSelected = categories.filter(\n          \n          \n            \n                const notSelected = categories.filter(", "author": "edalex-ian", "createdAt": "2020-09-09T04:25:57Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/CategorySelector.tsx", "diffHunk": "@@ -212,21 +212,28 @@ export const CategorySelector = ({\n   ): ReactElement[] => {\n     const selectedTerms: string[] =\n       selectedCategories?.find((c) => c.id === id)?.categories ?? [];\n-    const selectedFacets: OEQ.SearchFacets.Facet[] = selectedTerms.map(\n-      (selectedTerm) => {\n-        const facet = categories.find((c) => selectedTerm === c.term);\n-        if (!facet) {\n-          throw new Error(\n-            \"Data integrity issue, we're unable to match a selected term.\"\n-          );\n-        }\n \n-        return facet;\n-      }\n+    // Previously selected categories that still apply to current search criteria.\n+    const selectedAndExist = categories.filter((c) =>\n+      selectedTerms.includes(c.term)\n     );\n-    const orderedFacets = selectedFacets.concat(\n-      categories.filter((c) => !selectedFacets.includes(c))\n+\n+    // Previously selected categories that do not apply to current search criteria.\n+    // Their counts should be 0.\n+    const selectedButDisappear = selectedTerms\n+      .filter((t) => categories.every((c) => c.term !== t))\n+      .map((t) => ({ term: t, count: 0 }));\n+\n+    // Categories that apply to current search criteria but have not been selected.\n+    const noSelected = categories.filter(", "originalCommit": "60493f59770677cee1748dd8ab7eeded34361082", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b823a3f1f07f6ad1ea74716b4ce31e09ce76278e", "url": "https://github.com/openequella/openEQUELLA/commit/b823a3f1f07f6ad1ea74716b4ce31e09ce76278e", "message": "Simplify function 'listCategories' and use proper names.", "committedDate": "2020-09-09T05:02:59Z", "type": "commit"}, {"oid": "28db24d4e9d92f74d97080025afe8f9387ee030f", "url": "https://github.com/openequella/openEQUELLA/commit/28db24d4e9d92f74d97080025afe8f9387ee030f", "message": "Update JSDoc for Search Module and Search Facet Module.", "committedDate": "2020-09-09T05:17:56Z", "type": "commit"}, {"oid": "f8460d246043f6523a61cb0d7b8cdf21668d8472", "url": "https://github.com/openequella/openEQUELLA/commit/f8460d246043f6523a61cb0d7b8cdf21668d8472", "message": "Refactor the rule for showing 'SHOW MORE' buttons.\n\nBecause categories that are not applicable but were previously\nselected are also displayed now, we need to take into account these\ncategories for displaying the 'SHOW MORE' buttons.", "committedDate": "2020-09-09T23:52:40Z", "type": "commit"}]}