{"pr_number": 2500, "pr_title": "Include Selection Session information in RenderData.", "pr_createdAt": "2020-11-10T04:45:27Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/2500", "timeline": [{"oid": "958629c95ad33549547b3879e77e1d52f32f629b", "url": "https://github.com/openequella/openEQUELLA/commit/958629c95ad33549547b3879e77e1d52f32f629b", "message": "Include Selection Session information in RenderData.", "committedDate": "2020-11-10T03:52:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI4NDM4MA==", "url": "https://github.com/openequella/openEQUELLA/pull/2500#discussion_r520284380", "bodyText": "In selectOrAdd mode, the Integration ID is null, according to my research. So I make it optional.", "author": "PenghaiZhang", "createdAt": "2020-11-10T04:49:54Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/index.tsx", "diffHunk": "@@ -20,11 +20,18 @@ import * as ReactDOM from \"react-dom\";\n import { initStrings } from \"../util/langstrings\";\n import \"../util/polyfill\";\n \n+interface SelectionSessionInfo {\n+  stateId: string;\n+  integId?: string;", "originalCommit": "958629c95ad33549547b3879e77e1d52f32f629b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "199709d20235830ee7e21bf49cc0812a9a14f7ff", "url": "https://github.com/openequella/openEQUELLA/commit/199709d20235830ee7e21bf49cc0812a9a14f7ff", "message": "Only retrieve Integration ID when Integration Section is available.", "committedDate": "2020-11-10T22:42:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA1MTkwNA==", "url": "https://github.com/openequella/openEQUELLA/pull/2500#discussion_r521051904", "bodyText": "Would it be easy to add some TSDoc, or would that be a matter of digging further into the internals of Selection Sessions?", "author": "edalex-ian", "createdAt": "2020-11-11T02:51:14Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/index.tsx", "diffHunk": "@@ -20,11 +20,18 @@ import * as ReactDOM from \"react-dom\";\n import { initStrings } from \"../util/langstrings\";\n import \"../util/polyfill\";\n \n+interface SelectionSessionInfo {", "originalCommit": "199709d20235830ee7e21bf49cc0812a9a14f7ff", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTA1NzIyMw==", "url": "https://github.com/openequella/openEQUELLA/pull/2500#discussion_r521057223", "bodyText": "I prefer this to the normal use of ObjectExpression vargs. Makes me wonder if we can do anything more declarative, but good for now. \ud83d\udc4d\n(No action required.)", "author": "edalex-ian", "createdAt": "2020-11-11T02:56:42Z", "path": "Source/Plugins/Core/com.equella.core/scalasrc/com/tle/web/template/RenderNewTemplate.scala", "diffHunk": "@@ -141,6 +144,31 @@ object RenderNewTemplate {\n         }\n       })\n \n+  private def getSelectionSessionInfo(context: RenderEventContext): Option[ObjectExpression] = {\n+    val currentSession = LegacyGuice.selectionService.get().getCurrentSession(context)\n+    Option(currentSession).map(session => {\n+      val layout = session.getLayout match {\n+        case Layout.COURSE => \"coursesearch\"\n+        case Layout.NORMAL => \"search\"\n+        case Layout.SKINNY => \"skinnysearch\"\n+      }\n+\n+      val rootSelectionSection: RootSelectionSection =\n+        context.lookupSection(classOf[RootSelectionSection])\n+      val stateId = rootSelectionSection.getSessionId(context)\n+\n+      val integrationSection: IntegrationSection =\n+        context.lookupSection(classOf[IntegrationSection])\n+      val integId = Option(integrationSection).map(_.getStateId(context)).orNull\n+\n+      val selectionSessionInfo = new ObjectExpression\n+      selectionSessionInfo.put(\"stateId\", stateId)\n+      selectionSessionInfo.put(\"integId\", integId)\n+      selectionSessionInfo.put(\"layout\", layout)", "originalCommit": "199709d20235830ee7e21bf49cc0812a9a14f7ff", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f08a1403e820e24dd1ee959dddbfe7394b4ce4a7", "url": "https://github.com/openequella/openEQUELLA/commit/f08a1403e820e24dd1ee959dddbfe7394b4ce4a7", "message": "Add TSDoc for type 'SelectionSessionInfo'.", "committedDate": "2020-11-11T03:13:33Z", "type": "commit"}]}