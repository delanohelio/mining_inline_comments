{"pr_number": 2307, "pr_title": "Add a tooltip to show the username on the account icon", "pr_createdAt": "2020-09-21T04:50:53Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/2307", "timeline": [{"oid": "b52e74992e87965a73b608f07c8dbb99557f8e52", "url": "https://github.com/openequella/openEQUELLA/commit/b52e74992e87965a73b608f07c8dbb99557f8e52", "message": "Add username field to UserData", "committedDate": "2020-09-21T04:46:10Z", "type": "commit"}, {"oid": "b411d98b56d51712ec68b33d13f0571a79c313cd", "url": "https://github.com/openequella/openEQUELLA/commit/b411d98b56d51712ec68b33d13f0571a79c313cd", "message": "Change the icon tooltip to the username", "committedDate": "2020-09-21T04:46:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTc5NTU3NQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r491795575", "bodyText": "Aaahhhh, this reminds me.\nWe need to drop out currentuser.ts and use the support in oeq-ts-rest-api. So, this PR seems as good as any.\nCould you please remove currentuser.ts and move the code to use getCurrentUserDetails (and supporting interfaces) @ https://github.com/openequella/openEQUELLA/blob/develop/oeq-ts-rest-api/src/LegacyContent.ts#L38", "author": "edalex-ian", "createdAt": "2020-09-21T05:07:50Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/api/currentuser.ts", "diffHunk": "@@ -31,6 +31,7 @@ export interface UserData {\n   guest: boolean;\n   autoLoggedIn: boolean;\n   prefsEditable: boolean;\n+  username: string;", "originalCommit": "b411d98b56d51712ec68b33d13f0571a79c313cd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTc5NzIyNw==", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r491797227", "bodyText": "Could be good to also have a fallback here - just so we never have an empty \"bubble\" of a tooltip. Maybe \"Username unknown\". \ud83e\udd14", "author": "edalex-ian", "createdAt": "2020-09-21T05:16:17Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/Template.tsx", "diffHunk": "@@ -512,7 +512,7 @@ export const Template = React.memo(function Template({\n                 topBarString.notifications\n               )}\n             </Hidden>\n-            <Tooltip title={strings.menu.title}>\n+            <Tooltip title={currentUser?.username}>", "originalCommit": "b411d98b56d51712ec68b33d13f0571a79c313cd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "81dc0bb12440ca40aa4d0b8a64e369b27f7fd068", "url": "https://github.com/openequella/openEQUELLA/commit/81dc0bb12440ca40aa4d0b8a64e369b27f7fd068", "message": "Merge branch 'develop' into feature/see_logged_in_details", "committedDate": "2020-09-21T06:07:30Z", "type": "commit"}, {"oid": "f9afaf8c6354614e4801e6f3fffb5f5fae44de3f", "url": "https://github.com/openequella/openEQUELLA/commit/f9afaf8c6354614e4801e6f3fffb5f5fae44de3f", "message": "Delete currentuser.ts and refactor to use the oeq-ts-rest-api", "committedDate": "2020-09-22T02:27:04Z", "type": "commit"}, {"oid": "50fbaa38e2986134c3129ac227e70896c71fe0ee", "url": "https://github.com/openequella/openEQUELLA/commit/50fbaa38e2986134c3129ac227e70896c71fe0ee", "message": "Add a fallback state for an unknown user name", "committedDate": "2020-09-22T02:34:55Z", "type": "commit"}, {"oid": "ee7b1aaa4170c150ac6564578e6cce774073f92f", "url": "https://github.com/openequella/openEQUELLA/commit/ee7b1aaa4170c150ac6564578e6cce774073f92f", "message": "Make whitespace changes", "committedDate": "2020-09-22T02:38:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA5Njg3MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r493096871", "bodyText": "The convention for this library is to:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import type { CurrentUserDetails } from \"@openequella/rest-api-client/dist/LegacyContent\";\n          \n          \n            \n            import * as OEQ from \"@openequella\";\n          \n      \n    \n    \n  \n\nAnd then use accordingly.", "author": "edalex-ian", "createdAt": "2020-09-22T23:54:49Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/legacycontent/LegacyContent.tsx", "diffHunk": "@@ -20,6 +20,7 @@ import { ErrorResponse, fromAxiosResponse } from \"../api/errors\";\n import Axios from \"axios\";\n import { v4 } from \"uuid\";\n import { Config } from \"../config\";\n+import type { CurrentUserDetails } from \"@openequella/rest-api-client/dist/LegacyContent\";", "originalCommit": "ee7b1aaa4170c150ac6564578e6cce774073f92f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA5NzA4Mg==", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r493097082", "bodyText": "The convention for this library is to:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import type {\n          \n          \n            \n              CurrentUserDetails,\n          \n          \n            \n              MenuItem as MI,\n          \n          \n            \n            } from \"@openequella/rest-api-client/dist/LegacyContent\";\n          \n          \n            \n            import * as OEQ from \"@openequella\";\n          \n      \n    \n    \n  \n\nAnd then use accordingly.", "author": "edalex-ian", "createdAt": "2020-09-22T23:55:21Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/Template.tsx", "diffHunk": "@@ -46,11 +46,15 @@ import {\n import luxonUtils from \"@date-io/luxon\";\n import { makeStyles, Theme } from \"@material-ui/core/styles\";\n import { languageStrings } from \"../util/langstrings\";\n-import { guestUser, MenuItem as MI, UserData } from \"../api/currentuser\";\n import MessageInfo from \"../components/MessageInfo\";\n import { Link } from \"react-router-dom\";\n import { LocationDescriptor } from \"history\";\n import { routes } from \"./routes\";\n+import type {\n+  CurrentUserDetails,\n+  MenuItem as MI,\n+} from \"@openequella/rest-api-client/dist/LegacyContent\";", "originalCommit": "ee7b1aaa4170c150ac6564578e6cce774073f92f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA5NzIyMg==", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r493097222", "bodyText": "The convention for this library is to:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import type { CurrentUserDetails } from \"@openequella/rest-api-client/dist/LegacyContent\";\n          \n          \n            \n            import * as OEQ from \"@openequella\";\n          \n      \n    \n    \n  \n\nAnd then use accordingly.", "author": "edalex-ian", "createdAt": "2020-09-22T23:55:54Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/index.tsx", "diffHunk": "@@ -43,11 +43,12 @@ import {\n   PageContent,\n } from \"../legacycontent/LegacyContent\";\n import HtmlParser from \"react-html-parser\";\n-import { getCurrentUser, UserData } from \"../api/currentuser\";\n import { ErrorResponse } from \"../api/errors\";\n import ErrorPage from \"./ErrorPage\";\n import { LegacyForm } from \"../legacycontent/LegacyForm\";\n import SettingsPage from \"../settings/SettingsPage\";\n+import type { CurrentUserDetails } from \"@openequella/rest-api-client/dist/LegacyContent\";", "originalCommit": "ee7b1aaa4170c150ac6564578e6cce774073f92f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk0OTYyMA==", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r493949620", "bodyText": "As we have a language string change log now, do we need to put this new string into the log  when component is merged to develop?", "author": "PenghaiZhang", "createdAt": "2020-09-23T23:19:27Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/util/langstrings.ts", "diffHunk": "@@ -237,6 +237,7 @@ export const languageStrings = {\n       title: \"My Account\",\n       logout: \"Logout\",\n       prefs: \"My preferences\",\n+      usernameUnknown: \"Username unknown\",", "originalCommit": "ee7b1aaa4170c150ac6564578e6cce774073f92f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk4OTQ5Mw==", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r493989493", "bodyText": "You raise a good point there @PenghaiZhang\nI was only thinking though to do that with the ResourceCentre ones for now - i.e. the old properly released ones. It feels like all these (langstrings.ts) are essentially 'new' for 2020.2. But after that, then we'd want to document these too me thinks.\nWhat do you think?", "author": "edalex-ian", "createdAt": "2020-09-24T01:37:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk0OTYyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk5NDk4NA==", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r493994984", "bodyText": "That's a good idea! I agree.", "author": "PenghaiZhang", "createdAt": "2020-09-24T01:59:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk0OTYyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk0OTk3MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r493949971", "bodyText": "Can simplify the callback to (result: OEQ.LegacyContent.CurrentUserDetails) => result to save 2 lines \ud83d\ude04", "author": "PenghaiZhang", "createdAt": "2020-09-23T23:20:35Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/modules/UserDetailsModule.ts", "diffHunk": "@@ -15,41 +15,15 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-import Axios from \"axios\";\n+import * as OEQ from \"@openequella/rest-api-client\";\n+import { API_BASE_URL } from \"../config\";\n \n-export interface MenuItem {\n-  route?: string;\n-  href?: string;\n-  title: string;\n-  systemIcon?: string;\n-  iconUrl?: string;\n-  newWindow: boolean;\n-}\n-\n-export interface UserData {\n-  id: string;\n-  guest: boolean;\n-  autoLoggedIn: boolean;\n-  prefsEditable: boolean;\n-  counts?: {\n-    tasks: number;\n-    notifications: number;\n-  };\n-  menuGroups: MenuItem[][];\n-}\n-\n-export const guestUser: UserData = {\n-  id: \"guest\",\n-  guest: true,\n-  autoLoggedIn: false,\n-  prefsEditable: false,\n-  counts: {\n-    tasks: 0,\n-    notifications: 0,\n-  },\n-  menuGroups: [],\n-};\n-\n-export function getCurrentUser(): Promise<UserData> {\n-  return Axios.get<UserData>(\"api/content/currentuser\").then((r) => r.data);\n-}\n+/**\n+ * Gets the current user's info from the server as OEQ.LegacyContent.CurrentUserDetails.\n+ */\n+export const getCurrentUserDetails = () =>\n+  OEQ.LegacyContent.getCurrentUserDetails(API_BASE_URL).then(\n+    (result: OEQ.LegacyContent.CurrentUserDetails) => {\n+      return result;", "originalCommit": "ee7b1aaa4170c150ac6564578e6cce774073f92f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY3NDUwMg==", "url": "https://github.com/openequella/openEQUELLA/pull/2307#discussion_r494674502", "bodyText": "Done!", "author": "SammyIsConfused", "createdAt": "2020-09-25T00:02:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzk0OTk3MQ=="}], "type": "inlineReview"}, {"oid": "8da05efd1a40d17dc2d0300daea003f14f7eb606", "url": "https://github.com/openequella/openEQUELLA/commit/8da05efd1a40d17dc2d0300daea003f14f7eb606", "message": "Rename to UserModule.ts", "committedDate": "2020-09-25T00:00:17Z", "type": "commit"}, {"oid": "8d2550a7f946c8d67a9180389d77ae9e3ac66c47", "url": "https://github.com/openequella/openEQUELLA/commit/8d2550a7f946c8d67a9180389d77ae9e3ac66c47", "message": "Use the correct import convention for the rest-api-client", "committedDate": "2020-09-25T00:01:30Z", "type": "commit"}, {"oid": "a0db7ee13dbc63565be609f4b449592f7cbeae75", "url": "https://github.com/openequella/openEQUELLA/commit/a0db7ee13dbc63565be609f4b449592f7cbeae75", "message": "Apply whitespace changes", "committedDate": "2020-09-27T22:58:27Z", "type": "commit"}]}