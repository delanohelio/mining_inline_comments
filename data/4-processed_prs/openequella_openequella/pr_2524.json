{"pr_number": 2524, "pr_title": "Feature - REST API to list remote searches", "pr_createdAt": "2020-11-17T06:49:20Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/2524", "timeline": [{"oid": "57c7f4434d985418fd50b9f6758c4f83983c2081", "url": "https://github.com/openequella/openEQUELLA/commit/57c7f4434d985418fd50b9f6758c4f83983c2081", "message": "chore(server): Sort properties of LegacyGuice\n\nThere's a lot in there now, so we need to make sure they're easy to browse and add to.", "committedDate": "2020-11-17T05:26:00Z", "type": "commit"}, {"oid": "a67f5b54455d74f8a3b6dc2b73fed0cd6d2dbf36", "url": "https://github.com/openequella/openEQUELLA/commit/a67f5b54455d74f8a3b6dc2b73fed0cd6d2dbf36", "message": "feat(server): Add endpoint to list Remote Searches", "committedDate": "2020-11-17T06:07:24Z", "type": "commit"}, {"oid": "328758ae5e27abb3e53f7f2606a1e971a72113ce", "url": "https://github.com/openequella/openEQUELLA/commit/328758ae5e27abb3e53f7f2606a1e971a72113ce", "message": "refactor(server): Modify Advanced Search endpoint to use new BaseEntitySummary", "committedDate": "2020-11-17T06:23:34Z", "type": "commit"}, {"oid": "201e27f9e6a437fe3cb97911545e58c4ebbdea85", "url": "https://github.com/openequella/openEQUELLA/commit/201e27f9e6a437fe3cb97911545e58c4ebbdea85", "message": "refactor(oeq-ts-rest-api): Modify Advanced Search function to use new BaseEntitySummary", "committedDate": "2020-11-17T06:31:45Z", "type": "commit"}, {"oid": "5702b0fc99ffe76ef13cc8988049259c41f666a9", "url": "https://github.com/openequella/openEQUELLA/commit/5702b0fc99ffe76ef13cc8988049259c41f666a9", "message": "refactor(autotest): Modify Advanced Search endpoint test to use new BaseEntitySummary", "committedDate": "2020-11-17T06:35:09Z", "type": "commit"}, {"oid": "d00dc73b5b3800f6de9fd5178461892d06c409a9", "url": "https://github.com/openequella/openEQUELLA/commit/d00dc73b5b3800f6de9fd5178461892d06c409a9", "message": "test(autotest): Add test for new Remote Search endpoint", "committedDate": "2020-11-17T06:43:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkxODQ2Mw==", "url": "https://github.com/openequella/openEQUELLA/pull/2524#discussion_r524918463", "bodyText": "This is the key work of this PR.", "author": "edalex-ian", "createdAt": "2020-11-17T06:50:00Z", "path": "Source/Plugins/Core/com.equella.core/scalasrc/com/tle/web/api/settings/RemoteSearchResource.scala", "diffHunk": "@@ -0,0 +1,32 @@\n+package com.tle.web.api.settings\n+\n+import com.tle.legacy.LegacyGuice\n+import com.tle.web.api.entity.BaseEntitySummary\n+import io.swagger.annotations.{Api, ApiOperation}\n+import javax.ws.rs.core.Response\n+import javax.ws.rs.{GET, Path, Produces}\n+\n+import scala.collection.JavaConverters.collectionAsScalaIterableConverter\n+\n+@Path(\"settings/remotesearch/\")\n+@Produces(value = Array(\"application/json\"))\n+@Api(value = \"Settings\")\n+class RemoteSearchResource {\n+  private val federatedSearchService = LegacyGuice.federatedSearchService\n+\n+  @GET\n+  @ApiOperation(\n+    value = \"List available Remote (Federated) Searches\",\n+    notes =\n+      \"This endpoint is used to retrieve available Remote Searches and is secured by SEARCH_FEDERATED_SEARCH\",\n+    response = classOf[BaseEntitySummary],\n+    responseContainer = \"List\"\n+  )\n+  def getAll: Response =", "originalCommit": "d00dc73b5b3800f6de9fd5178461892d06c409a9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkxODc2MA==", "url": "https://github.com/openequella/openEQUELLA/pull/2524#discussion_r524918760", "bodyText": "Following a pattern I saw used for Remote Searches to centralise the string literals for privileges.", "author": "edalex-ian", "createdAt": "2020-11-17T06:50:47Z", "path": "Source/Plugins/Core/com.equella.core/src/com/tle/core/powersearch/PowerSearchPrivileges.java", "diffHunk": "@@ -0,0 +1,10 @@\n+package com.tle.core.powersearch;\n+\n+public final class PowerSearchPrivileges {", "originalCommit": "d00dc73b5b3800f6de9fd5178461892d06c409a9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkxOTExNQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2524#discussion_r524919115", "bodyText": "It is handy (and DB efficient) to be able to get straight at the Base Entities. I saw this was done and secured with Remote Searches, and it nice supports the refactor for BaseEntitySummary.", "author": "edalex-ian", "createdAt": "2020-11-17T06:51:41Z", "path": "Source/Plugins/Core/com.equella.core/src/com/tle/core/powersearch/PowerSearchService.java", "diffHunk": "@@ -40,4 +40,11 @@\n   List<BaseEntityLabel> listAllForSchema(long schemaId);\n \n   List<BaseEntityLabel> listAllForSchema(Schema schema);\n+\n+  /**\n+   * List all available Power Searches (Advanced Searches) assuming 'SEARCH_POWER_SEARCH' ACL.\n+   *\n+   * @return available power searches\n+   */\n+  List<PowerSearch> enumerateSearchable();", "originalCommit": "d00dc73b5b3800f6de9fd5178461892d06c409a9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkxOTMwNA==", "url": "https://github.com/openequella/openEQUELLA/pull/2524#discussion_r524919304", "bodyText": "Here's the sort I mentioned. In there I have also added FederatedSearchService.", "author": "edalex-ian", "createdAt": "2020-11-17T06:52:14Z", "path": "Source/Plugins/Core/com.equella.core/src/com/tle/legacy/LegacyGuice.java", "diffHunk": "@@ -96,149 +97,151 @@\n \n public class LegacyGuice extends AbstractModule {", "originalCommit": "d00dc73b5b3800f6de9fd5178461892d06c409a9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3fcb4a376325fde853097451934e22997ebb163c", "url": "https://github.com/openequella/openEQUELLA/commit/3fcb4a376325fde853097451934e22997ebb163c", "message": "chore(server): Add missing license headers", "committedDate": "2020-11-17T21:38:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTYyNzI2Mw==", "url": "https://github.com/openequella/openEQUELLA/pull/2524#discussion_r525627263", "bodyText": "I am a bit surprised that this annotation works. I used to do this for the search2 test which also extends AbstractRestApiTest but it always runs against rest.", "author": "PenghaiZhang", "createdAt": "2020-11-18T01:04:00Z", "path": "autotest/OldTests/src/test/java/io/github/openequella/rest/RemoteSearchApiTest.java", "diffHunk": "@@ -0,0 +1,44 @@\n+package io.github.openequella.rest;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+import com.tle.webtests.framework.TestConfig;\n+import com.tle.webtests.framework.TestInstitution;\n+import io.github.openequella.rest.models.BaseEntitySummary;\n+import java.io.IOException;\n+import java.util.List;\n+import org.apache.commons.httpclient.HttpMethod;\n+import org.apache.commons.httpclient.HttpStatus;\n+import org.apache.commons.httpclient.methods.GetMethod;\n+import org.codehaus.jackson.type.TypeReference;\n+import org.testng.annotations.Test;\n+\n+@TestInstitution(\"vanilla\")", "originalCommit": "3fcb4a376325fde853097451934e22997ebb163c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}