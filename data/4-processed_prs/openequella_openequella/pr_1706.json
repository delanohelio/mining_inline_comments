{"pr_number": 1706, "pr_title": "Faceted search setting page", "pr_createdAt": "2020-05-06T07:49:23Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/1706", "timeline": [{"oid": "e3c598938df43897c16b0c98ca04465e1233937c", "url": "https://github.com/openequella/openEQUELLA/commit/e3c598938df43897c16b0c98ca04465e1233937c", "message": "Add route to Faceted search setting page.", "committedDate": "2020-05-06T07:07:43Z", "type": "commit"}, {"oid": "23a4fe5689da046d30c8282de8632b31fe7d1283", "url": "https://github.com/openequella/openEQUELLA/commit/23a4fe5689da046d30c8282de8632b31fe7d1283", "message": "Create a new page for managing Faceted search classifications. The main\ncontents are wrapped by the Setting page template.\n\nCreate a new dialog for adding a new classification.", "committedDate": "2020-05-06T07:41:55Z", "type": "commit"}, {"oid": "f700ff6651d04ffb2fa33d12ff7699e0cbd53b87", "url": "https://github.com/openequella/openEQUELLA/commit/f700ff6651d04ffb2fa33d12ff7699e0cbd53b87", "message": "Merge branch 'component/search_configuration' into feature/faceted-search-classification-dialog", "committedDate": "2020-05-07T04:50:11Z", "type": "commit"}, {"oid": "6911cdb908b19e22db24f026d86e329421be462f", "url": "https://github.com/openequella/openEQUELLA/commit/6911cdb908b19e22db24f026d86e329421be462f", "message": "Remove the subtitle of MessageDialog;\nMove the language string for 207 response to the category of 'common'.", "committedDate": "2020-05-08T00:04:46Z", "type": "commit"}, {"oid": "ed006ff5ac660ef8b29b300333a5897ea5410a8f", "url": "https://github.com/openequella/openEQUELLA/commit/ed006ff5ac660ef8b29b300333a5897ea5410a8f", "message": "Use flags to indicate if classifications need saving;\n\nSave all of the new classifications to Server at one time;\n\nShow a dialog or snackbar based on 207 response;", "committedDate": "2020-05-08T01:13:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkwMTc5Ng==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r421901796", "bodyText": "We don't need this array for now. When chained then returns one or more 207 responses, use this array to store all error messages, and set them to state in the last then.", "author": "PenghaiZhang", "createdAt": "2020-05-08T02:30:53Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetedSearchSettingsPage.tsx", "diffHunk": "@@ -0,0 +1,218 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  templateDefaults,\n+  templateError,\n+  TemplateUpdateProps,\n+} from \"../../../mainui/Template\";\n+import SettingPageTemplate from \"../../../components/SettingPageTemplate\";\n+import { useState } from \"react\";\n+import {\n+  Card,\n+  CardActions,\n+  IconButton,\n+  List,\n+  ListItem,\n+  ListItemSecondaryAction,\n+  ListItemText,\n+  ListSubheader,\n+  makeStyles,\n+} from \"@material-ui/core\";\n+import { languageStrings } from \"../../../util/langstrings\";\n+import {\n+  addFlags,\n+  batchUpdateOrAdd,\n+  ModifiedClassification,\n+  FacetedSearchClassification,\n+  getClassificationsFromServer,\n+  removeFlags,\n+  getHighestOrderIndex,\n+} from \"./FacetedSearchSettingsModule\";\n+import EditIcon from \"@material-ui/icons/Edit\";\n+import DeleteIcon from \"@material-ui/icons/Delete\";\n+import AddCircleIcon from \"@material-ui/icons/AddCircle\";\n+import ClassificationDialog from \"./ClassificationDialog\";\n+import { useEffect } from \"react\";\n+import { routes } from \"../../../mainui/routes\";\n+import { addElement } from \"../../../util/ImmutableArrayUtil\";\n+import { generateFromError } from \"../../../api/errors\";\n+import MessageDialog from \"../../../components/MessageDialog\";\n+import { commonString } from \"../../../util/commonstrings\";\n+\n+const useStyles = makeStyles({\n+  spacedCards: {\n+    margin: \"16px\",\n+    width: \"75%\",\n+    padding: \"16px\",\n+    float: \"left\",\n+  },\n+  cardAction: {\n+    display: \"flex\",\n+    justifyContent: \"flex-end\",\n+  },\n+});\n+\n+/**\n+ * A page for setting Faceted search classifications.\n+ */\n+const FacetedSearchSettingsPage = ({ updateTemplate }: TemplateUpdateProps) => {\n+  const facetedsearchsettingStrings =\n+    languageStrings.settings.searching.facetedsearchsetting;\n+  const classes = useStyles();\n+\n+  // Show the snackbar when all the status of a 207 response is 2xx.\n+  const [showSnackBar, setShowSnackBar] = useState<boolean>(false);\n+  // Show a message dialog when a 207 response includes any status that's 4xx.\n+  const [showResultDialog, setShowResultDialog] = useState<boolean>(false);\n+  const [resultMessages, setResultMessagesMessages] = useState<string[]>([]);\n+\n+  const [showEditingDialog, setShowEditingDialog] = useState<boolean>(false);\n+  const [classifications, setClassifications] = useState<\n+    ModifiedClassification[]\n+  >([]);\n+\n+  const addOrEditQueue = classifications\n+    .filter((classification) => classification.changed)\n+    .map((classification) => removeFlags(classification));\n+  const changesUnsaved = addOrEditQueue.length > 0;\n+\n+  /**\n+   * Update the page title and back route, and get a list of classifications.\n+   */\n+  useEffect(() => {\n+    updateTemplate((tp) => ({\n+      ...templateDefaults(facetedsearchsettingStrings.name)(tp),\n+      backRoute: routes.Settings.to,\n+    }));\n+    getClassifications();\n+  }, []);\n+\n+  const getClassifications = () => {\n+    getClassificationsFromServer().then((classifications) => {\n+      setClassifications(\n+        classifications.map((classification) => {\n+          return addFlags(classification, false, false, false);\n+        })\n+      );\n+    });\n+  };\n+\n+  /**\n+   * Save classifications in the queue to the Server.\n+   * Show the message dialog if any error message is received otherwise show snackbar.\n+   */\n+  const save = () => {\n+    const errorMessages: string[] = [];", "originalCommit": "ed006ff5ac660ef8b29b300333a5897ea5410a8f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkwOTIyNQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r421909225", "bodyText": "Alternative below, it's not much of a difference and the only real nicety is for setMaxResults and the not needing a ternary.\nsetName(classication?.name ?? '')\nsetSchemaNode(classification?.schemaNode ?? \"\");\nsetMaxResults(classification?.maxResults);", "author": "edalex-tom", "createdAt": "2020-05-08T03:00:16Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/ClassificationDialog.tsx", "diffHunk": "@@ -0,0 +1,160 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  Button,\n+  Dialog,\n+  DialogActions,\n+  DialogContent,\n+  DialogTitle,\n+  TextField,\n+} from \"@material-ui/core\";\n+import { commonString } from \"../../../util/commonstrings\";\n+import { languageStrings } from \"../../../util/langstrings\";\n+import { useEffect, useState } from \"react\";\n+import {\n+  FacetedSearchClassification,\n+  validateClassificationFields,\n+} from \"./FacetedSearchSettingsModule\";\n+\n+interface ClassificationDialogProps {\n+  /**\n+   * If true, the dialog will be shown.\n+   */\n+  open: boolean;\n+  /**\n+   * Fired when the dialog is closed.\n+   */\n+  onClose: () => void;\n+  /**\n+   * Fired when click the ADD button.\n+   */\n+  addOrEdit: (classification: FacetedSearchClassification) => void;\n+  /**\n+   * The classification to be edited; undefined if the action is to add a new one.\n+   */\n+  classification?: FacetedSearchClassification;\n+  /**\n+   * Error handling.\n+   */\n+  handleError: (error: Error) => void;\n+  /**\n+   * Current highest order index.\n+   */\n+  highestOrderIndex: number;\n+}\n+\n+/**\n+ * A dialog for adding/editing a Faceted search classification\n+ */\n+const ClassificationDialog = ({\n+  open,\n+  onClose,\n+  addOrEdit,\n+  handleError,\n+  classification,\n+  highestOrderIndex,\n+}: ClassificationDialogProps) => {\n+  const {\n+    facetedsearchsetting: facetedSearchSettingStrings,\n+  } = languageStrings.settings.searching;\n+  const { classification: classificationStrings } = facetedSearchSettingStrings;\n+\n+  const [name, setName] = useState<string>(\"\");\n+  const [schemaNode, setSchemaNode] = useState<string>(\"\");\n+  const [maxResults, setMaxResults] = useState<number | undefined>();\n+\n+  const isNameInvalid = validateClassificationFields(name);\n+  const isSchemaNodeInvalid = validateClassificationFields(schemaNode);\n+\n+  /**\n+   * Initialise textfields' values, depending on 'onClose'.\n+   */\n+  useEffect(() => {\n+    setName(classification ? classification.name : \"\");", "originalCommit": "ed006ff5ac660ef8b29b300333a5897ea5410a8f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkzNTEyNA==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r421935124", "bodyText": "I like this. I need to update my Intellij as the version I am using does not recognise this operator.", "author": "PenghaiZhang", "createdAt": "2020-05-08T04:45:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkwOTIyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkwOTk4MA==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r421909980", "bodyText": "Can this be simplified to\naddOrEdit({\n      name,\n      schemaNode,\n      maxResults,\n      orderIndex: highestOrderIndex + 1,\n    });", "author": "edalex-tom", "createdAt": "2020-05-08T03:03:22Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/ClassificationDialog.tsx", "diffHunk": "@@ -0,0 +1,160 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  Button,\n+  Dialog,\n+  DialogActions,\n+  DialogContent,\n+  DialogTitle,\n+  TextField,\n+} from \"@material-ui/core\";\n+import { commonString } from \"../../../util/commonstrings\";\n+import { languageStrings } from \"../../../util/langstrings\";\n+import { useEffect, useState } from \"react\";\n+import {\n+  FacetedSearchClassification,\n+  validateClassificationFields,\n+} from \"./FacetedSearchSettingsModule\";\n+\n+interface ClassificationDialogProps {\n+  /**\n+   * If true, the dialog will be shown.\n+   */\n+  open: boolean;\n+  /**\n+   * Fired when the dialog is closed.\n+   */\n+  onClose: () => void;\n+  /**\n+   * Fired when click the ADD button.\n+   */\n+  addOrEdit: (classification: FacetedSearchClassification) => void;\n+  /**\n+   * The classification to be edited; undefined if the action is to add a new one.\n+   */\n+  classification?: FacetedSearchClassification;\n+  /**\n+   * Error handling.\n+   */\n+  handleError: (error: Error) => void;\n+  /**\n+   * Current highest order index.\n+   */\n+  highestOrderIndex: number;\n+}\n+\n+/**\n+ * A dialog for adding/editing a Faceted search classification\n+ */\n+const ClassificationDialog = ({\n+  open,\n+  onClose,\n+  addOrEdit,\n+  handleError,\n+  classification,\n+  highestOrderIndex,\n+}: ClassificationDialogProps) => {\n+  const {\n+    facetedsearchsetting: facetedSearchSettingStrings,\n+  } = languageStrings.settings.searching;\n+  const { classification: classificationStrings } = facetedSearchSettingStrings;\n+\n+  const [name, setName] = useState<string>(\"\");\n+  const [schemaNode, setSchemaNode] = useState<string>(\"\");\n+  const [maxResults, setMaxResults] = useState<number | undefined>();\n+\n+  const isNameInvalid = validateClassificationFields(name);\n+  const isSchemaNodeInvalid = validateClassificationFields(schemaNode);\n+\n+  /**\n+   * Initialise textfields' values, depending on 'onClose'.\n+   */\n+  useEffect(() => {\n+    setName(classification ? classification.name : \"\");\n+    setSchemaNode(classification ? classification.schemaNode : \"\");\n+    setMaxResults(classification ? classification.maxResults : undefined);\n+  }, [onClose]);\n+\n+  const onAddOrEdit = () => {\n+    addOrEdit({\n+      name: name,\n+      schemaNode: schemaNode,\n+      maxResults: maxResults,\n+      orderIndex: highestOrderIndex + 1,\n+    });", "originalCommit": "ed006ff5ac660ef8b29b300333a5897ea5410a8f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxMDY3MA==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r421910670", "bodyText": "Should this be classifications?", "author": "edalex-tom", "createdAt": "2020-05-08T03:05:55Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetedSearchSettingsModule.ts", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import Axios from \"axios\";\n+import {\n+  BatchOperationResponse,\n+  groupErrorMessages,\n+} from \"../../../api/BatchOperationResponse\";\n+\n+export interface FacetedSearchClassification {\n+  /**\n+   * Name of a classification\n+   */\n+  name: string;\n+  /**\n+   * Schema node of a classification\n+   */\n+  schemaNode: string;\n+  /**\n+   * The number of category of a classification; Being undefined means the number is unlimited.\n+   */\n+  maxResults?: number;\n+  /**\n+   * Used for re-ordering classifications.\n+   */\n+  orderIndex: number;\n+}\n+\n+export interface ModifiedClassification extends FacetedSearchClassification {\n+  /**\n+   * A flag indicating creating or updating this classification on the Server.\n+   */\n+  changed: boolean;\n+  /**\n+   * A flag indicating deleting this classification from the Server.\n+   */\n+  deleted: boolean;\n+  /**\n+   * A flag indication if a classification hasn't been saved to the Server.\n+   */\n+  dirty: boolean;\n+}\n+\n+const FACETED_SEARCH_API_URL = \"api/settings/facetedsearch/classification\";\n+\n+export const getClassificationsFromServer = (): Promise<\n+  FacetedSearchClassification[]\n+> => Axios.get(FACETED_SEARCH_API_URL).then((res) => res.data);\n+\n+export const batchUpdateOrAdd = (\n+  classifitioncas: FacetedSearchClassification[]", "originalCommit": "ed006ff5ac660ef8b29b300333a5897ea5410a8f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxMTEwMw==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r421911103", "bodyText": "This should be made a function or read only, otherwise it could be mutated by accident", "author": "edalex-tom", "createdAt": "2020-05-08T03:07:37Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetedSearchSettingsModule.ts", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import Axios from \"axios\";\n+import {\n+  BatchOperationResponse,\n+  groupErrorMessages,\n+} from \"../../../api/BatchOperationResponse\";\n+\n+export interface FacetedSearchClassification {\n+  /**\n+   * Name of a classification\n+   */\n+  name: string;\n+  /**\n+   * Schema node of a classification\n+   */\n+  schemaNode: string;\n+  /**\n+   * The number of category of a classification; Being undefined means the number is unlimited.\n+   */\n+  maxResults?: number;\n+  /**\n+   * Used for re-ordering classifications.\n+   */\n+  orderIndex: number;\n+}\n+\n+export interface ModifiedClassification extends FacetedSearchClassification {\n+  /**\n+   * A flag indicating creating or updating this classification on the Server.\n+   */\n+  changed: boolean;\n+  /**\n+   * A flag indicating deleting this classification from the Server.\n+   */\n+  deleted: boolean;\n+  /**\n+   * A flag indication if a classification hasn't been saved to the Server.\n+   */\n+  dirty: boolean;\n+}\n+\n+const FACETED_SEARCH_API_URL = \"api/settings/facetedsearch/classification\";\n+\n+export const getClassificationsFromServer = (): Promise<\n+  FacetedSearchClassification[]\n+> => Axios.get(FACETED_SEARCH_API_URL).then((res) => res.data);\n+\n+export const batchUpdateOrAdd = (\n+  classifitioncas: FacetedSearchClassification[]\n+) =>\n+  Axios.put<BatchOperationResponse[]>(\n+    FACETED_SEARCH_API_URL,\n+    classifitioncas\n+  ).then((res) => groupErrorMessages(res.data));\n+\n+/**\n+ * Validate if trimmed name or schema node is empty.\n+ * Return true if they are invalid.\n+ */\n+export const validateClassificationFields = (field: string): boolean => {\n+  return !field?.trim();\n+};\n+\n+/**\n+ * Convert an instace of FacetedSearchClassification to an instace of ModifiedClassification.\n+ */\n+export const addFlags = (\n+  classification: FacetedSearchClassification,\n+  changed: boolean,\n+  deleted: boolean,\n+  dirty: boolean\n+): ModifiedClassification =>\n+  Object.assign(classification, {\n+    changed: changed,\n+    deleted: deleted,\n+    dirty: dirty,\n+  });\n+\n+/**\n+ * Convert an instace of ModifiedClassification to an instace of FacetedSearchClassification.\n+ */\n+export const removeFlags = (classification: ModifiedClassification) => {\n+  delete classification.deleted;\n+  delete classification.changed;\n+  delete classification.dirty;\n+  return classification;\n+};\n+\n+/**\n+ * Given a list of classifications, find the one that has the highest order index.\n+ */\n+export const getHighestOrderIndex = (\n+  classifications: ModifiedClassification[]\n+) => {\n+  const classification = classifications.reduce((prev, current) => {\n+    return prev.orderIndex > current.orderIndex ? prev : current;\n+  }, defaultClassifion);\n+  return classification.orderIndex;\n+};\n+\n+const defaultClassifion: FacetedSearchClassification = {", "originalCommit": "ed006ff5ac660ef8b29b300333a5897ea5410a8f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxMjAyNA==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r421912024", "bodyText": "This approach tends to scale poorly (e.g. if a new field is added to ModifiedClassification then this will still appear to work), as discussed this won't provide any type safety (it's also missing the return type).\nI'm not sure there's any better approaches though, I've had a brief look and there doesn't seem to be any nice way of converting interfaces and it can't be easily achieved with reflection on an interface", "author": "edalex-tom", "createdAt": "2020-05-08T03:10:53Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetedSearchSettingsModule.ts", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import Axios from \"axios\";\n+import {\n+  BatchOperationResponse,\n+  groupErrorMessages,\n+} from \"../../../api/BatchOperationResponse\";\n+\n+export interface FacetedSearchClassification {\n+  /**\n+   * Name of a classification\n+   */\n+  name: string;\n+  /**\n+   * Schema node of a classification\n+   */\n+  schemaNode: string;\n+  /**\n+   * The number of category of a classification; Being undefined means the number is unlimited.\n+   */\n+  maxResults?: number;\n+  /**\n+   * Used for re-ordering classifications.\n+   */\n+  orderIndex: number;\n+}\n+\n+export interface ModifiedClassification extends FacetedSearchClassification {\n+  /**\n+   * A flag indicating creating or updating this classification on the Server.\n+   */\n+  changed: boolean;\n+  /**\n+   * A flag indicating deleting this classification from the Server.\n+   */\n+  deleted: boolean;\n+  /**\n+   * A flag indication if a classification hasn't been saved to the Server.\n+   */\n+  dirty: boolean;\n+}\n+\n+const FACETED_SEARCH_API_URL = \"api/settings/facetedsearch/classification\";\n+\n+export const getClassificationsFromServer = (): Promise<\n+  FacetedSearchClassification[]\n+> => Axios.get(FACETED_SEARCH_API_URL).then((res) => res.data);\n+\n+export const batchUpdateOrAdd = (\n+  classifitioncas: FacetedSearchClassification[]\n+) =>\n+  Axios.put<BatchOperationResponse[]>(\n+    FACETED_SEARCH_API_URL,\n+    classifitioncas\n+  ).then((res) => groupErrorMessages(res.data));\n+\n+/**\n+ * Validate if trimmed name or schema node is empty.\n+ * Return true if they are invalid.\n+ */\n+export const validateClassificationFields = (field: string): boolean => {\n+  return !field?.trim();\n+};\n+\n+/**\n+ * Convert an instace of FacetedSearchClassification to an instace of ModifiedClassification.\n+ */\n+export const addFlags = (\n+  classification: FacetedSearchClassification,\n+  changed: boolean,\n+  deleted: boolean,\n+  dirty: boolean\n+): ModifiedClassification =>\n+  Object.assign(classification, {\n+    changed: changed,\n+    deleted: deleted,\n+    dirty: dirty,\n+  });\n+\n+/**\n+ * Convert an instace of ModifiedClassification to an instace of FacetedSearchClassification.\n+ */\n+export const removeFlags = (classification: ModifiedClassification) => {\n+  delete classification.deleted;\n+  delete classification.changed;\n+  delete classification.dirty;\n+  return classification;", "originalCommit": "ed006ff5ac660ef8b29b300333a5897ea5410a8f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxMjYyMA==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r421912620", "bodyText": "I'm not sure this provides any type safety, it may be better as a simple spread operator as that would\n\nnot mutate the original object, the classification instance is being modified here\ntypescript should pickup on any key mismatches\n\nIt may be simpler to just spread the extra values rather than having a addFlags method at all, needing to pass multiple booleans in a method may cause confusion as it's hard to track what the correct order when calling the method.  JS doc for the arguments may help as they'd give code hints for development", "author": "edalex-tom", "createdAt": "2020-05-08T03:13:19Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetedSearchSettingsModule.ts", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import Axios from \"axios\";\n+import {\n+  BatchOperationResponse,\n+  groupErrorMessages,\n+} from \"../../../api/BatchOperationResponse\";\n+\n+export interface FacetedSearchClassification {\n+  /**\n+   * Name of a classification\n+   */\n+  name: string;\n+  /**\n+   * Schema node of a classification\n+   */\n+  schemaNode: string;\n+  /**\n+   * The number of category of a classification; Being undefined means the number is unlimited.\n+   */\n+  maxResults?: number;\n+  /**\n+   * Used for re-ordering classifications.\n+   */\n+  orderIndex: number;\n+}\n+\n+export interface ModifiedClassification extends FacetedSearchClassification {\n+  /**\n+   * A flag indicating creating or updating this classification on the Server.\n+   */\n+  changed: boolean;\n+  /**\n+   * A flag indicating deleting this classification from the Server.\n+   */\n+  deleted: boolean;\n+  /**\n+   * A flag indication if a classification hasn't been saved to the Server.\n+   */\n+  dirty: boolean;\n+}\n+\n+const FACETED_SEARCH_API_URL = \"api/settings/facetedsearch/classification\";\n+\n+export const getClassificationsFromServer = (): Promise<\n+  FacetedSearchClassification[]\n+> => Axios.get(FACETED_SEARCH_API_URL).then((res) => res.data);\n+\n+export const batchUpdateOrAdd = (\n+  classifitioncas: FacetedSearchClassification[]\n+) =>\n+  Axios.put<BatchOperationResponse[]>(\n+    FACETED_SEARCH_API_URL,\n+    classifitioncas\n+  ).then((res) => groupErrorMessages(res.data));\n+\n+/**\n+ * Validate if trimmed name or schema node is empty.\n+ * Return true if they are invalid.\n+ */\n+export const validateClassificationFields = (field: string): boolean => {\n+  return !field?.trim();\n+};\n+\n+/**\n+ * Convert an instace of FacetedSearchClassification to an instace of ModifiedClassification.\n+ */\n+export const addFlags = (\n+  classification: FacetedSearchClassification,\n+  changed: boolean,\n+  deleted: boolean,\n+  dirty: boolean\n+): ModifiedClassification =>\n+  Object.assign(classification, {\n+    changed: changed,\n+    deleted: deleted,\n+    dirty: dirty,\n+  });", "originalCommit": "ed006ff5ac660ef8b29b300333a5897ea5410a8f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxMzY1Mg==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r421913652", "bodyText": "Could be simplified with a .map and Math.max. the reduce is better if there's a need to get the object itself rather than just the orderIndex", "author": "edalex-tom", "createdAt": "2020-05-08T03:17:36Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetedSearchSettingsModule.ts", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import Axios from \"axios\";\n+import {\n+  BatchOperationResponse,\n+  groupErrorMessages,\n+} from \"../../../api/BatchOperationResponse\";\n+\n+export interface FacetedSearchClassification {\n+  /**\n+   * Name of a classification\n+   */\n+  name: string;\n+  /**\n+   * Schema node of a classification\n+   */\n+  schemaNode: string;\n+  /**\n+   * The number of category of a classification; Being undefined means the number is unlimited.\n+   */\n+  maxResults?: number;\n+  /**\n+   * Used for re-ordering classifications.\n+   */\n+  orderIndex: number;\n+}\n+\n+export interface ModifiedClassification extends FacetedSearchClassification {\n+  /**\n+   * A flag indicating creating or updating this classification on the Server.\n+   */\n+  changed: boolean;\n+  /**\n+   * A flag indicating deleting this classification from the Server.\n+   */\n+  deleted: boolean;\n+  /**\n+   * A flag indication if a classification hasn't been saved to the Server.\n+   */\n+  dirty: boolean;\n+}\n+\n+const FACETED_SEARCH_API_URL = \"api/settings/facetedsearch/classification\";\n+\n+export const getClassificationsFromServer = (): Promise<\n+  FacetedSearchClassification[]\n+> => Axios.get(FACETED_SEARCH_API_URL).then((res) => res.data);\n+\n+export const batchUpdateOrAdd = (\n+  classifitioncas: FacetedSearchClassification[]\n+) =>\n+  Axios.put<BatchOperationResponse[]>(\n+    FACETED_SEARCH_API_URL,\n+    classifitioncas\n+  ).then((res) => groupErrorMessages(res.data));\n+\n+/**\n+ * Validate if trimmed name or schema node is empty.\n+ * Return true if they are invalid.\n+ */\n+export const validateClassificationFields = (field: string): boolean => {\n+  return !field?.trim();\n+};\n+\n+/**\n+ * Convert an instace of FacetedSearchClassification to an instace of ModifiedClassification.\n+ */\n+export const addFlags = (\n+  classification: FacetedSearchClassification,\n+  changed: boolean,\n+  deleted: boolean,\n+  dirty: boolean\n+): ModifiedClassification =>\n+  Object.assign(classification, {\n+    changed: changed,\n+    deleted: deleted,\n+    dirty: dirty,\n+  });\n+\n+/**\n+ * Convert an instace of ModifiedClassification to an instace of FacetedSearchClassification.\n+ */\n+export const removeFlags = (classification: ModifiedClassification) => {\n+  delete classification.deleted;\n+  delete classification.changed;\n+  delete classification.dirty;\n+  return classification;\n+};\n+\n+/**\n+ * Given a list of classifications, find the one that has the highest order index.\n+ */\n+export const getHighestOrderIndex = (\n+  classifications: ModifiedClassification[]\n+) => {\n+  const classification = classifications.reduce((prev, current) => {\n+    return prev.orderIndex > current.orderIndex ? prev : current;\n+  }, defaultClassifion);\n+  return classification.orderIndex;", "originalCommit": "ed006ff5ac660ef8b29b300333a5897ea5410a8f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxMzg2MA==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r421913860", "bodyText": "Not sure the comments should be here, it's dictating how the state is used when ideally this is just defining state.", "author": "edalex-tom", "createdAt": "2020-05-08T03:18:33Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetedSearchSettingsPage.tsx", "diffHunk": "@@ -0,0 +1,218 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  templateDefaults,\n+  templateError,\n+  TemplateUpdateProps,\n+} from \"../../../mainui/Template\";\n+import SettingPageTemplate from \"../../../components/SettingPageTemplate\";\n+import { useState } from \"react\";\n+import {\n+  Card,\n+  CardActions,\n+  IconButton,\n+  List,\n+  ListItem,\n+  ListItemSecondaryAction,\n+  ListItemText,\n+  ListSubheader,\n+  makeStyles,\n+} from \"@material-ui/core\";\n+import { languageStrings } from \"../../../util/langstrings\";\n+import {\n+  addFlags,\n+  batchUpdateOrAdd,\n+  ModifiedClassification,\n+  FacetedSearchClassification,\n+  getClassificationsFromServer,\n+  removeFlags,\n+  getHighestOrderIndex,\n+} from \"./FacetedSearchSettingsModule\";\n+import EditIcon from \"@material-ui/icons/Edit\";\n+import DeleteIcon from \"@material-ui/icons/Delete\";\n+import AddCircleIcon from \"@material-ui/icons/AddCircle\";\n+import ClassificationDialog from \"./ClassificationDialog\";\n+import { useEffect } from \"react\";\n+import { routes } from \"../../../mainui/routes\";\n+import { addElement } from \"../../../util/ImmutableArrayUtil\";\n+import { generateFromError } from \"../../../api/errors\";\n+import MessageDialog from \"../../../components/MessageDialog\";\n+import { commonString } from \"../../../util/commonstrings\";\n+\n+const useStyles = makeStyles({\n+  spacedCards: {\n+    margin: \"16px\",\n+    width: \"75%\",\n+    padding: \"16px\",\n+    float: \"left\",\n+  },\n+  cardAction: {\n+    display: \"flex\",\n+    justifyContent: \"flex-end\",\n+  },\n+});\n+\n+/**\n+ * A page for setting Faceted search classifications.\n+ */\n+const FacetedSearchSettingsPage = ({ updateTemplate }: TemplateUpdateProps) => {\n+  const facetedsearchsettingStrings =\n+    languageStrings.settings.searching.facetedsearchsetting;\n+  const classes = useStyles();\n+\n+  // Show the snackbar when all the status of a 207 response is 2xx.", "originalCommit": "ed006ff5ac660ef8b29b300333a5897ea5410a8f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxNDI0NQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r421914245", "bodyText": "not sure addOrEditQueue is describing what this is actually doing", "author": "edalex-tom", "createdAt": "2020-05-08T03:19:53Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetedSearchSettingsPage.tsx", "diffHunk": "@@ -0,0 +1,218 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  templateDefaults,\n+  templateError,\n+  TemplateUpdateProps,\n+} from \"../../../mainui/Template\";\n+import SettingPageTemplate from \"../../../components/SettingPageTemplate\";\n+import { useState } from \"react\";\n+import {\n+  Card,\n+  CardActions,\n+  IconButton,\n+  List,\n+  ListItem,\n+  ListItemSecondaryAction,\n+  ListItemText,\n+  ListSubheader,\n+  makeStyles,\n+} from \"@material-ui/core\";\n+import { languageStrings } from \"../../../util/langstrings\";\n+import {\n+  addFlags,\n+  batchUpdateOrAdd,\n+  ModifiedClassification,\n+  FacetedSearchClassification,\n+  getClassificationsFromServer,\n+  removeFlags,\n+  getHighestOrderIndex,\n+} from \"./FacetedSearchSettingsModule\";\n+import EditIcon from \"@material-ui/icons/Edit\";\n+import DeleteIcon from \"@material-ui/icons/Delete\";\n+import AddCircleIcon from \"@material-ui/icons/AddCircle\";\n+import ClassificationDialog from \"./ClassificationDialog\";\n+import { useEffect } from \"react\";\n+import { routes } from \"../../../mainui/routes\";\n+import { addElement } from \"../../../util/ImmutableArrayUtil\";\n+import { generateFromError } from \"../../../api/errors\";\n+import MessageDialog from \"../../../components/MessageDialog\";\n+import { commonString } from \"../../../util/commonstrings\";\n+\n+const useStyles = makeStyles({\n+  spacedCards: {\n+    margin: \"16px\",\n+    width: \"75%\",\n+    padding: \"16px\",\n+    float: \"left\",\n+  },\n+  cardAction: {\n+    display: \"flex\",\n+    justifyContent: \"flex-end\",\n+  },\n+});\n+\n+/**\n+ * A page for setting Faceted search classifications.\n+ */\n+const FacetedSearchSettingsPage = ({ updateTemplate }: TemplateUpdateProps) => {\n+  const facetedsearchsettingStrings =\n+    languageStrings.settings.searching.facetedsearchsetting;\n+  const classes = useStyles();\n+\n+  // Show the snackbar when all the status of a 207 response is 2xx.\n+  const [showSnackBar, setShowSnackBar] = useState<boolean>(false);\n+  // Show a message dialog when a 207 response includes any status that's 4xx.\n+  const [showResultDialog, setShowResultDialog] = useState<boolean>(false);\n+  const [resultMessages, setResultMessagesMessages] = useState<string[]>([]);\n+\n+  const [showEditingDialog, setShowEditingDialog] = useState<boolean>(false);\n+  const [classifications, setClassifications] = useState<\n+    ModifiedClassification[]\n+  >([]);\n+\n+  const addOrEditQueue = classifications\n+    .filter((classification) => classification.changed)\n+    .map((classification) => removeFlags(classification));", "originalCommit": "ed006ff5ac660ef8b29b300333a5897ea5410a8f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxNDg1NQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r421914855", "bodyText": "Having trouble identifying why errorMessages is defined, it looks like the messages could be used directly", "author": "edalex-tom", "createdAt": "2020-05-08T03:22:41Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetedSearchSettingsPage.tsx", "diffHunk": "@@ -0,0 +1,218 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  templateDefaults,\n+  templateError,\n+  TemplateUpdateProps,\n+} from \"../../../mainui/Template\";\n+import SettingPageTemplate from \"../../../components/SettingPageTemplate\";\n+import { useState } from \"react\";\n+import {\n+  Card,\n+  CardActions,\n+  IconButton,\n+  List,\n+  ListItem,\n+  ListItemSecondaryAction,\n+  ListItemText,\n+  ListSubheader,\n+  makeStyles,\n+} from \"@material-ui/core\";\n+import { languageStrings } from \"../../../util/langstrings\";\n+import {\n+  addFlags,\n+  batchUpdateOrAdd,\n+  ModifiedClassification,\n+  FacetedSearchClassification,\n+  getClassificationsFromServer,\n+  removeFlags,\n+  getHighestOrderIndex,\n+} from \"./FacetedSearchSettingsModule\";\n+import EditIcon from \"@material-ui/icons/Edit\";\n+import DeleteIcon from \"@material-ui/icons/Delete\";\n+import AddCircleIcon from \"@material-ui/icons/AddCircle\";\n+import ClassificationDialog from \"./ClassificationDialog\";\n+import { useEffect } from \"react\";\n+import { routes } from \"../../../mainui/routes\";\n+import { addElement } from \"../../../util/ImmutableArrayUtil\";\n+import { generateFromError } from \"../../../api/errors\";\n+import MessageDialog from \"../../../components/MessageDialog\";\n+import { commonString } from \"../../../util/commonstrings\";\n+\n+const useStyles = makeStyles({\n+  spacedCards: {\n+    margin: \"16px\",\n+    width: \"75%\",\n+    padding: \"16px\",\n+    float: \"left\",\n+  },\n+  cardAction: {\n+    display: \"flex\",\n+    justifyContent: \"flex-end\",\n+  },\n+});\n+\n+/**\n+ * A page for setting Faceted search classifications.\n+ */\n+const FacetedSearchSettingsPage = ({ updateTemplate }: TemplateUpdateProps) => {\n+  const facetedsearchsettingStrings =\n+    languageStrings.settings.searching.facetedsearchsetting;\n+  const classes = useStyles();\n+\n+  // Show the snackbar when all the status of a 207 response is 2xx.\n+  const [showSnackBar, setShowSnackBar] = useState<boolean>(false);\n+  // Show a message dialog when a 207 response includes any status that's 4xx.\n+  const [showResultDialog, setShowResultDialog] = useState<boolean>(false);\n+  const [resultMessages, setResultMessagesMessages] = useState<string[]>([]);\n+\n+  const [showEditingDialog, setShowEditingDialog] = useState<boolean>(false);\n+  const [classifications, setClassifications] = useState<\n+    ModifiedClassification[]\n+  >([]);\n+\n+  const addOrEditQueue = classifications\n+    .filter((classification) => classification.changed)\n+    .map((classification) => removeFlags(classification));\n+  const changesUnsaved = addOrEditQueue.length > 0;\n+\n+  /**\n+   * Update the page title and back route, and get a list of classifications.\n+   */\n+  useEffect(() => {\n+    updateTemplate((tp) => ({\n+      ...templateDefaults(facetedsearchsettingStrings.name)(tp),\n+      backRoute: routes.Settings.to,\n+    }));\n+    getClassifications();\n+  }, []);\n+\n+  const getClassifications = () => {\n+    getClassificationsFromServer().then((classifications) => {\n+      setClassifications(\n+        classifications.map((classification) => {\n+          return addFlags(classification, false, false, false);\n+        })\n+      );\n+    });\n+  };\n+\n+  /**\n+   * Save classifications in the queue to the Server.\n+   * Show the message dialog if any error message is received otherwise show snackbar.\n+   */\n+  const save = () => {\n+    const errorMessages: string[] = [];\n+    batchUpdateOrAdd(addOrEditQueue)\n+      .then((messages) => {\n+        errorMessages.push(...messages);\n+        if (errorMessages.length > 0) {\n+          setResultMessagesMessages(errorMessages);", "originalCommit": "ed006ff5ac660ef8b29b300333a5897ea5410a8f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxNjA2NQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r421916065", "bodyText": "May be going into component overdrive (i.e. writing too many generic components) but this could be a common AddButton which would standardise it and reduce the need to import IconButton + Icon", "author": "edalex-tom", "createdAt": "2020-05-08T03:27:19Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetedSearchSettingsPage.tsx", "diffHunk": "@@ -0,0 +1,218 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  templateDefaults,\n+  templateError,\n+  TemplateUpdateProps,\n+} from \"../../../mainui/Template\";\n+import SettingPageTemplate from \"../../../components/SettingPageTemplate\";\n+import { useState } from \"react\";\n+import {\n+  Card,\n+  CardActions,\n+  IconButton,\n+  List,\n+  ListItem,\n+  ListItemSecondaryAction,\n+  ListItemText,\n+  ListSubheader,\n+  makeStyles,\n+} from \"@material-ui/core\";\n+import { languageStrings } from \"../../../util/langstrings\";\n+import {\n+  addFlags,\n+  batchUpdateOrAdd,\n+  ModifiedClassification,\n+  FacetedSearchClassification,\n+  getClassificationsFromServer,\n+  removeFlags,\n+  getHighestOrderIndex,\n+} from \"./FacetedSearchSettingsModule\";\n+import EditIcon from \"@material-ui/icons/Edit\";\n+import DeleteIcon from \"@material-ui/icons/Delete\";\n+import AddCircleIcon from \"@material-ui/icons/AddCircle\";\n+import ClassificationDialog from \"./ClassificationDialog\";\n+import { useEffect } from \"react\";\n+import { routes } from \"../../../mainui/routes\";\n+import { addElement } from \"../../../util/ImmutableArrayUtil\";\n+import { generateFromError } from \"../../../api/errors\";\n+import MessageDialog from \"../../../components/MessageDialog\";\n+import { commonString } from \"../../../util/commonstrings\";\n+\n+const useStyles = makeStyles({\n+  spacedCards: {\n+    margin: \"16px\",\n+    width: \"75%\",\n+    padding: \"16px\",\n+    float: \"left\",\n+  },\n+  cardAction: {\n+    display: \"flex\",\n+    justifyContent: \"flex-end\",\n+  },\n+});\n+\n+/**\n+ * A page for setting Faceted search classifications.\n+ */\n+const FacetedSearchSettingsPage = ({ updateTemplate }: TemplateUpdateProps) => {\n+  const facetedsearchsettingStrings =\n+    languageStrings.settings.searching.facetedsearchsetting;\n+  const classes = useStyles();\n+\n+  // Show the snackbar when all the status of a 207 response is 2xx.\n+  const [showSnackBar, setShowSnackBar] = useState<boolean>(false);\n+  // Show a message dialog when a 207 response includes any status that's 4xx.\n+  const [showResultDialog, setShowResultDialog] = useState<boolean>(false);\n+  const [resultMessages, setResultMessagesMessages] = useState<string[]>([]);\n+\n+  const [showEditingDialog, setShowEditingDialog] = useState<boolean>(false);\n+  const [classifications, setClassifications] = useState<\n+    ModifiedClassification[]\n+  >([]);\n+\n+  const addOrEditQueue = classifications\n+    .filter((classification) => classification.changed)\n+    .map((classification) => removeFlags(classification));\n+  const changesUnsaved = addOrEditQueue.length > 0;\n+\n+  /**\n+   * Update the page title and back route, and get a list of classifications.\n+   */\n+  useEffect(() => {\n+    updateTemplate((tp) => ({\n+      ...templateDefaults(facetedsearchsettingStrings.name)(tp),\n+      backRoute: routes.Settings.to,\n+    }));\n+    getClassifications();\n+  }, []);\n+\n+  const getClassifications = () => {\n+    getClassificationsFromServer().then((classifications) => {\n+      setClassifications(\n+        classifications.map((classification) => {\n+          return addFlags(classification, false, false, false);\n+        })\n+      );\n+    });\n+  };\n+\n+  /**\n+   * Save classifications in the queue to the Server.\n+   * Show the message dialog if any error message is received otherwise show snackbar.\n+   */\n+  const save = () => {\n+    const errorMessages: string[] = [];\n+    batchUpdateOrAdd(addOrEditQueue)\n+      .then((messages) => {\n+        errorMessages.push(...messages);\n+        if (errorMessages.length > 0) {\n+          setResultMessagesMessages(errorMessages);\n+          setShowResultDialog(true);\n+        } else {\n+          setShowSnackBar(true);\n+        }\n+      })\n+      .catch((error) => handleError(error))\n+      .finally(() => getClassifications());\n+  };\n+\n+  /**\n+   * Visually add/update a classification\n+   */\n+  const addOrEdit = (classification: FacetedSearchClassification) => {\n+    setClassifications(\n+      addElement(classifications, addFlags(classification, true, false, true))\n+    );\n+  };\n+\n+  /**\n+   * Error handling which throws a new error in order to break chained 'then'.\n+   */\n+  const handleError = (error: Error) => {\n+    updateTemplate(templateError(generateFromError(error)));\n+    throw new Error(error.message);\n+  };\n+\n+  return (\n+    <SettingPageTemplate\n+      onSave={save}\n+      saveButtonDisabled={!changesUnsaved}\n+      snackbarOpen={showSnackBar}\n+      snackBarOnClose={() => setShowSnackBar(false)}\n+      preventNavigation={changesUnsaved}\n+    >\n+      <Card className={classes.spacedCards}>\n+        <List\n+          subheader={\n+            <ListSubheader disableGutters>\n+              {facetedsearchsettingStrings.name}\n+            </ListSubheader>\n+          }\n+        >\n+          {classifications\n+            .filter((classification) => !classification.deleted)\n+            .map((classification, index) => {\n+              return (\n+                <ListItem divider={true} key={index}>\n+                  <ListItemText primary={classification.name} />\n+                  <ListItemSecondaryAction>\n+                    <IconButton color={\"secondary\"}>\n+                      <EditIcon />\n+                    </IconButton>\n+                    |\n+                    <IconButton color=\"secondary\">\n+                      <DeleteIcon />\n+                    </IconButton>\n+                  </ListItemSecondaryAction>\n+                </ListItem>\n+              );\n+            })}\n+        </List>\n+        <CardActions className={classes.cardAction}>\n+          <IconButton\n+            onClick={() => setShowEditingDialog(true)}\n+            aria-label={facetedsearchsettingStrings.add}\n+            color={\"primary\"}\n+          >\n+            <AddCircleIcon fontSize={\"large\"} />\n+          </IconButton>", "originalCommit": "ed006ff5ac660ef8b29b300333a5897ea5410a8f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkzNTU1Ng==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r421935556", "bodyText": "I will talk to Ian in sprint review and see if we want to do another commonality refactoring.", "author": "PenghaiZhang", "createdAt": "2020-05-08T04:47:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxNjA2NQ=="}], "type": "inlineReview"}, {"oid": "2c75a5b5b7def80c471d61954418905b11deaf40", "url": "https://github.com/openequella/openEQUELLA/commit/2c75a5b5b7def80c471d61954418905b11deaf40", "message": "Reduce verbosity of variable names and rename properly;\n\nAvoid mutating a facet object when add boolean flags to it;", "committedDate": "2020-05-08T08:25:19Z", "type": "commit"}, {"oid": "8365a61d4734153a196b736cd4a314253613a71f", "url": "https://github.com/openequella/openEQUELLA/commit/8365a61d4734153a196b736cd4a314253613a71f", "message": "Simplify the construction an objecot of facet.", "committedDate": "2020-05-08T08:30:46Z", "type": "commit"}, {"oid": "64e9ad6c4ac8975ee7c7e9d39faddbd52707e87f", "url": "https://github.com/openequella/openEQUELLA/commit/64e9ad6c4ac8975ee7c7e9d39faddbd52707e87f", "message": "Merge branch 'component/search_configuration' into feature/faceted-search-classification-dialog", "committedDate": "2020-05-10T23:36:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxNDk5MA==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422714990", "bodyText": "Why was this removed?", "author": "edalex-ian", "createdAt": "2020-05-10T23:18:14Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/components/MessageDialog.tsx", "diffHunk": "@@ -30,25 +30,24 @@ import { commonString } from \"../util/commonstrings\";\n interface MessageDialogProps {\n   open: boolean;\n   title: string;\n-  subtitle: string;", "originalCommit": "8365a61d4734153a196b736cd4a314253613a71f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxOTg1OA==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422719858", "bodyText": "It looks like Penghai wanted to use this component without the subtitle - but removing the option to do so limits the component. Better to make it an optional prop.", "author": "SammyIsConfused", "createdAt": "2020-05-10T23:57:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxNDk5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDE0Ng==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422720146", "bodyText": "I found the other two dialogs(AdminDownloadDialog and ConfirmDialog) do not have a subtitle, and none of the MUI Dialog examples use subtitle. So I removed it.", "author": "PenghaiZhang", "createdAt": "2020-05-11T00:00:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxNDk5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyNjAyNQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422726025", "bodyText": "Gotcha. Good plan. \ud83d\udc4d", "author": "edalex-ian", "createdAt": "2020-05-11T00:43:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxNDk5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxNTM4Mw==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422715383", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            interface facetDialogProps {\n          \n          \n            \n            interface FacetDialogProps {", "author": "edalex-ian", "createdAt": "2020-05-10T23:21:27Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetDialog.tsx", "diffHunk": "@@ -0,0 +1,163 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  Button,\n+  Dialog,\n+  DialogActions,\n+  DialogContent,\n+  DialogTitle,\n+  TextField,\n+} from \"@material-ui/core\";\n+import { commonString } from \"../../../util/commonstrings\";\n+import { languageStrings } from \"../../../util/langstrings\";\n+import { useEffect, useState } from \"react\";\n+import {\n+  FacetWithFlags,\n+  validateFacetFields,\n+} from \"./FacetedSearchSettingsModule\";\n+\n+interface facetDialogProps {", "originalCommit": "8365a61d4734153a196b736cd4a314253613a71f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxNTg5MA==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422715890", "bodyText": "Feels like this logic should be in the calling component. Actually, indeed if this is an 'edit' then this shouldn't change at all. So yes, this should be logic in the addOrEdit method and highestOrderIndex should be removed from the props interface.", "author": "edalex-ian", "createdAt": "2020-05-10T23:25:25Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetDialog.tsx", "diffHunk": "@@ -0,0 +1,163 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  Button,\n+  Dialog,\n+  DialogActions,\n+  DialogContent,\n+  DialogTitle,\n+  TextField,\n+} from \"@material-ui/core\";\n+import { commonString } from \"../../../util/commonstrings\";\n+import { languageStrings } from \"../../../util/langstrings\";\n+import { useEffect, useState } from \"react\";\n+import {\n+  FacetWithFlags,\n+  validateFacetFields,\n+} from \"./FacetedSearchSettingsModule\";\n+\n+interface facetDialogProps {\n+  /**\n+   * If true, the dialog will be shown.\n+   */\n+  open: boolean;\n+  /**\n+   * Fired when the dialog is closed.\n+   */\n+  onClose: () => void;\n+  /**\n+   * Fired when click the ADD button.\n+   */\n+  addOrEdit: (facet: FacetWithFlags) => void;\n+  /**\n+   * The facet to be edited; undefined if the action is to add a new one.\n+   */\n+  facet?: FacetWithFlags;\n+  /**\n+   * Error handling.\n+   */\n+  handleError: (error: Error) => void;\n+  /**\n+   * Current highest order index.\n+   */\n+  highestOrderIndex: number;\n+}\n+\n+/**\n+ * A dialog for adding/editing a facet\n+ */\n+const FacetDialog = ({\n+  open,\n+  onClose,\n+  addOrEdit,\n+  handleError,\n+  facet,\n+  highestOrderIndex,\n+}: facetDialogProps) => {\n+  const {\n+    facetedsearchsetting: facetedSearchSettingStrings,\n+  } = languageStrings.settings.searching;\n+  const { facetfields: facetFieldStrings } = facetedSearchSettingStrings;\n+\n+  const [name, setName] = useState<string>(\"\");\n+  const [schemaNode, setSchemaNode] = useState<string>(\"\");\n+  const [maxResults, setMaxResults] = useState<number | undefined>();\n+\n+  const isNameInvalid = validateFacetFields(name);\n+  const isSchemaNodeInvalid = validateFacetFields(schemaNode);\n+\n+  /**\n+   * Initialise textfields' values, depending on 'onClose'.\n+   */\n+  useEffect(() => {\n+    setName(facet?.name ?? \"\");\n+    setSchemaNode(facet?.schemaNode ?? \"\");\n+    setMaxResults(facet?.maxResults);\n+  }, [onClose]);\n+\n+  const onAddOrEdit = () => {\n+    addOrEdit({\n+      name,\n+      schemaNode,\n+      maxResults,\n+      orderIndex: highestOrderIndex + 1,", "originalCommit": "8365a61d4734153a196b736cd4a314253613a71f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMTA4Mg==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422721082", "bodyText": "my code was looking like this :\nlet newFacet: FacetWithFlags;\nif(!facet){\nnewFacet = {\nname,\nschemaNode,\nmaxResults,\norderIndex: highestOrderIndex + 1,\nupdated: true,\ndeleted: false,\ndirty: true,\n}\n}\nelse{\nnewFacet = {\n...facet,\nname,\nschemaNode,\nmaxResults,\nupdated: true\n}\n}\naddOrEdit(newFacet);\nBased on whether facet is undefined or not we know this action is adding or updating. And then construct an object based on this action.\nBut before I opened a PR I simplified this function as this PR only focuses on adding.", "author": "PenghaiZhang", "createdAt": "2020-05-11T00:08:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxNTg5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMTQ5Ng==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422721496", "bodyText": "But no worries I will move highestOrderIndex to the calling component.", "author": "PenghaiZhang", "createdAt": "2020-05-11T00:11:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxNTg5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyNTg0Ng==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422725846", "bodyText": "Well actually that highlights the main issue here. This dialog only needs to know about three things - the three fields it's displaying. So really really, that's all it should be putting in this object, everything else should be left to higher up where it knows the details.\nAs a result, these lines should really just be:\n    addOrEdit({\n      name,\n      schemaNode,\n      maxResults });\n\nAll the flags etc are only the concern of the calling component.", "author": "edalex-ian", "createdAt": "2020-05-11T00:42:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxNTg5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjczMjg1OA==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422732858", "bodyText": "I am afraid above may not work because the type of Facet requires orderIndex unless this field can be undefined. Alternatively I can create another interface which only includes these three fields.", "author": "PenghaiZhang", "createdAt": "2020-05-11T01:24:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxNTg5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjczODE1MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422738151", "bodyText": "I just recalled that in back-end orderIndex is not a mandatory field and its default value  is 0, so it may be OK to allow it to be undefined in front-end.", "author": "PenghaiZhang", "createdAt": "2020-05-11T01:42:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxNTg5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxNzI4Mg==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422717282", "bodyText": "For readability, could we please extract this out into a const and then simply place the variable in here? I'd like to start minimising the use of logic and functions within the return/render methods.", "author": "edalex-ian", "createdAt": "2020-05-10T23:36:53Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetedSearchSettingsPage.tsx", "diffHunk": "@@ -0,0 +1,209 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  templateDefaults,\n+  templateError,\n+  TemplateUpdateProps,\n+} from \"../../../mainui/Template\";\n+import SettingPageTemplate from \"../../../components/SettingPageTemplate\";\n+import { useState } from \"react\";\n+import {\n+  Card,\n+  CardActions,\n+  IconButton,\n+  List,\n+  ListItem,\n+  ListItemSecondaryAction,\n+  ListItemText,\n+  ListSubheader,\n+  makeStyles,\n+} from \"@material-ui/core\";\n+import { languageStrings } from \"../../../util/langstrings\";\n+import {\n+  batchUpdateOrAdd,\n+  FacetWithFlags,\n+  getFacetsFromServer,\n+  getHighestOrderIndex,\n+} from \"./FacetedSearchSettingsModule\";\n+import EditIcon from \"@material-ui/icons/Edit\";\n+import DeleteIcon from \"@material-ui/icons/Delete\";\n+import AddCircleIcon from \"@material-ui/icons/AddCircle\";\n+import FacetDialog from \"./FacetDialog\";\n+import { useEffect } from \"react\";\n+import { routes } from \"../../../mainui/routes\";\n+import { addElement } from \"../../../util/ImmutableArrayUtil\";\n+import { generateFromError } from \"../../../api/errors\";\n+import MessageDialog from \"../../../components/MessageDialog\";\n+import { commonString } from \"../../../util/commonstrings\";\n+\n+const useStyles = makeStyles({\n+  spacedCards: {\n+    margin: \"16px\",\n+    width: \"75%\",\n+    padding: \"16px\",\n+    float: \"left\",\n+  },\n+  cardAction: {\n+    display: \"flex\",\n+    justifyContent: \"flex-end\",\n+  },\n+});\n+\n+/**\n+ * A page for setting Faceted search facets.\n+ */\n+const FacetedSearchSettingsPage = ({ updateTemplate }: TemplateUpdateProps) => {\n+  const facetedsearchsettingStrings =\n+    languageStrings.settings.searching.facetedsearchsetting;\n+  const classes = useStyles();\n+\n+  const [showSnackBar, setShowSnackBar] = useState<boolean>(false);\n+  const [showResultDialog, setShowResultDialog] = useState<boolean>(false);\n+  const [resultMessages, setResultMessagesMessages] = useState<string[]>([]);\n+  const [showEditingDialog, setShowEditingDialog] = useState<boolean>(false);\n+  const [facets, setFacets] = useState<FacetWithFlags[]>([]);\n+\n+  const listOfUpdates: FacetWithFlags[] = facets.filter(\n+    (facet) => facet.updated\n+  );\n+  const changesUnsaved = listOfUpdates.length > 0;\n+\n+  /**\n+   * Update the page title and back route, and get a list of facets.\n+   */\n+  useEffect(() => {\n+    updateTemplate((tp) => ({\n+      ...templateDefaults(facetedsearchsettingStrings.name)(tp),\n+      backRoute: routes.Settings.to,\n+    }));\n+    getFacets();\n+  }, []);\n+\n+  /**\n+   * Get facets from the Server and add boolean flags on them.\n+   */\n+  const getFacets = () => {\n+    getFacetsFromServer().then((facets) => {\n+      setFacets(\n+        facets.map((facet) => {\n+          return { ...facet, updated: false, deleted: false, dirty: false };\n+        })\n+      );\n+    });\n+  };\n+\n+  /**\n+   * Save updated/deleted facets to the Server.\n+   * Show the message dialog if any error message is received otherwise show snackbar.\n+   */\n+  const save = () => {\n+    batchUpdateOrAdd(listOfUpdates)\n+      .then((messages) => {\n+        if (messages.length > 0) {\n+          setResultMessagesMessages(messages);\n+          setShowResultDialog(true);\n+        } else {\n+          setShowSnackBar(true);\n+        }\n+      })\n+      .catch((error) => handleError(error))\n+      .finally(() => getFacets());\n+  };\n+\n+  /**\n+   * Visually add/update a facet.\n+   */\n+  const addOrEdit = (facet: FacetWithFlags) => {\n+    setFacets(addElement(facets, facet));\n+  };\n+\n+  /**\n+   * Error handling which throws a new error in order to break chained 'then'.\n+   */\n+  const handleError = (error: Error) => {\n+    updateTemplate(templateError(generateFromError(error)));\n+    throw new Error(error.message);\n+  };\n+\n+  return (\n+    <SettingPageTemplate\n+      onSave={save}\n+      saveButtonDisabled={!changesUnsaved}\n+      snackbarOpen={showSnackBar}\n+      snackBarOnClose={() => setShowSnackBar(false)}\n+      preventNavigation={changesUnsaved}\n+    >\n+      <Card className={classes.spacedCards}>\n+        <List\n+          subheader={\n+            <ListSubheader disableGutters>\n+              {facetedsearchsettingStrings.name}\n+            </ListSubheader>\n+          }\n+        >\n+          {facets\n+            .filter((facet) => !facet.deleted)\n+            .map((facet, index) => {\n+              return (\n+                <ListItem divider={true} key={index}>\n+                  <ListItemText primary={facet.name} />\n+                  <ListItemSecondaryAction>\n+                    <IconButton color={\"secondary\"}>\n+                      <EditIcon />\n+                    </IconButton>\n+                    |\n+                    <IconButton color=\"secondary\">\n+                      <DeleteIcon />\n+                    </IconButton>\n+                  </ListItemSecondaryAction>\n+                </ListItem>\n+              );\n+            })}", "originalCommit": "8365a61d4734153a196b736cd4a314253613a71f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxNzY2Ng==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422717666", "bodyText": "Can you please remind me why this is here (rather than just using the message mechanism in the template)? Is it due to the batch CRUDing?", "author": "edalex-ian", "createdAt": "2020-05-10T23:40:11Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetedSearchSettingsPage.tsx", "diffHunk": "@@ -0,0 +1,209 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  templateDefaults,\n+  templateError,\n+  TemplateUpdateProps,\n+} from \"../../../mainui/Template\";\n+import SettingPageTemplate from \"../../../components/SettingPageTemplate\";\n+import { useState } from \"react\";\n+import {\n+  Card,\n+  CardActions,\n+  IconButton,\n+  List,\n+  ListItem,\n+  ListItemSecondaryAction,\n+  ListItemText,\n+  ListSubheader,\n+  makeStyles,\n+} from \"@material-ui/core\";\n+import { languageStrings } from \"../../../util/langstrings\";\n+import {\n+  batchUpdateOrAdd,\n+  FacetWithFlags,\n+  getFacetsFromServer,\n+  getHighestOrderIndex,\n+} from \"./FacetedSearchSettingsModule\";\n+import EditIcon from \"@material-ui/icons/Edit\";\n+import DeleteIcon from \"@material-ui/icons/Delete\";\n+import AddCircleIcon from \"@material-ui/icons/AddCircle\";\n+import FacetDialog from \"./FacetDialog\";\n+import { useEffect } from \"react\";\n+import { routes } from \"../../../mainui/routes\";\n+import { addElement } from \"../../../util/ImmutableArrayUtil\";\n+import { generateFromError } from \"../../../api/errors\";\n+import MessageDialog from \"../../../components/MessageDialog\";\n+import { commonString } from \"../../../util/commonstrings\";\n+\n+const useStyles = makeStyles({\n+  spacedCards: {\n+    margin: \"16px\",\n+    width: \"75%\",\n+    padding: \"16px\",\n+    float: \"left\",\n+  },\n+  cardAction: {\n+    display: \"flex\",\n+    justifyContent: \"flex-end\",\n+  },\n+});\n+\n+/**\n+ * A page for setting Faceted search facets.\n+ */\n+const FacetedSearchSettingsPage = ({ updateTemplate }: TemplateUpdateProps) => {\n+  const facetedsearchsettingStrings =\n+    languageStrings.settings.searching.facetedsearchsetting;\n+  const classes = useStyles();\n+\n+  const [showSnackBar, setShowSnackBar] = useState<boolean>(false);\n+  const [showResultDialog, setShowResultDialog] = useState<boolean>(false);\n+  const [resultMessages, setResultMessagesMessages] = useState<string[]>([]);\n+  const [showEditingDialog, setShowEditingDialog] = useState<boolean>(false);\n+  const [facets, setFacets] = useState<FacetWithFlags[]>([]);\n+\n+  const listOfUpdates: FacetWithFlags[] = facets.filter(\n+    (facet) => facet.updated\n+  );\n+  const changesUnsaved = listOfUpdates.length > 0;\n+\n+  /**\n+   * Update the page title and back route, and get a list of facets.\n+   */\n+  useEffect(() => {\n+    updateTemplate((tp) => ({\n+      ...templateDefaults(facetedsearchsettingStrings.name)(tp),\n+      backRoute: routes.Settings.to,\n+    }));\n+    getFacets();\n+  }, []);\n+\n+  /**\n+   * Get facets from the Server and add boolean flags on them.\n+   */\n+  const getFacets = () => {\n+    getFacetsFromServer().then((facets) => {\n+      setFacets(\n+        facets.map((facet) => {\n+          return { ...facet, updated: false, deleted: false, dirty: false };\n+        })\n+      );\n+    });\n+  };\n+\n+  /**\n+   * Save updated/deleted facets to the Server.\n+   * Show the message dialog if any error message is received otherwise show snackbar.\n+   */\n+  const save = () => {\n+    batchUpdateOrAdd(listOfUpdates)\n+      .then((messages) => {\n+        if (messages.length > 0) {\n+          setResultMessagesMessages(messages);\n+          setShowResultDialog(true);\n+        } else {\n+          setShowSnackBar(true);\n+        }\n+      })\n+      .catch((error) => handleError(error))\n+      .finally(() => getFacets());\n+  };\n+\n+  /**\n+   * Visually add/update a facet.\n+   */\n+  const addOrEdit = (facet: FacetWithFlags) => {\n+    setFacets(addElement(facets, facet));\n+  };\n+\n+  /**\n+   * Error handling which throws a new error in order to break chained 'then'.\n+   */\n+  const handleError = (error: Error) => {\n+    updateTemplate(templateError(generateFromError(error)));\n+    throw new Error(error.message);\n+  };\n+\n+  return (\n+    <SettingPageTemplate\n+      onSave={save}\n+      saveButtonDisabled={!changesUnsaved}\n+      snackbarOpen={showSnackBar}\n+      snackBarOnClose={() => setShowSnackBar(false)}\n+      preventNavigation={changesUnsaved}\n+    >\n+      <Card className={classes.spacedCards}>\n+        <List\n+          subheader={\n+            <ListSubheader disableGutters>\n+              {facetedsearchsettingStrings.name}\n+            </ListSubheader>\n+          }\n+        >\n+          {facets\n+            .filter((facet) => !facet.deleted)\n+            .map((facet, index) => {\n+              return (\n+                <ListItem divider={true} key={index}>\n+                  <ListItemText primary={facet.name} />\n+                  <ListItemSecondaryAction>\n+                    <IconButton color={\"secondary\"}>\n+                      <EditIcon />\n+                    </IconButton>\n+                    |\n+                    <IconButton color=\"secondary\">\n+                      <DeleteIcon />\n+                    </IconButton>\n+                  </ListItemSecondaryAction>\n+                </ListItem>\n+              );\n+            })}\n+        </List>\n+        <CardActions className={classes.cardAction}>\n+          <IconButton\n+            onClick={() => setShowEditingDialog(true)}\n+            aria-label={facetedsearchsettingStrings.add}\n+            color={\"primary\"}\n+          >\n+            <AddCircleIcon fontSize={\"large\"} />\n+          </IconButton>\n+        </CardActions>\n+      </Card>\n+\n+      <FacetDialog\n+        addOrEdit={addOrEdit}\n+        open={showEditingDialog}\n+        onClose={() => setShowEditingDialog(false)}\n+        handleError={handleError}\n+        facet={undefined}\n+        highestOrderIndex={getHighestOrderIndex(facets)}\n+      />\n+\n+      <MessageDialog", "originalCommit": "64e9ad6c4ac8975ee7c7e9d39faddbd52707e87f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxOTk4MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422719981", "bodyText": "Should this have the same formatting as the above routes, for consistency?", "author": "SammyIsConfused", "createdAt": "2020-05-10T23:58:21Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/mainui/routes.tsx", "diffHunk": "@@ -64,16 +65,20 @@ export const routes = {\n     path: \"/page/searchsettings\",\n     render: (p: OEQRouteComponentProps<any>) => <SearchPageSettings {...p} />,\n   },\n-\n   SearchFilterSettings: {\n     path: \"/page/searchfiltersettings\",\n     render: (p: OEQRouteComponentProps<any>) => <SearchFilterPage {...p} />,\n   },\n-\n   ContentIndexSettings: {\n     path: \"/page/contentindexsettings\",\n     render: (p: OEQRouteComponentProps<any>) => <ContentIndexSettings {...p} />,\n   },\n+  FacetedSearchSetting: {", "originalCommit": "64e9ad6c4ac8975ee7c7e9d39faddbd52707e87f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDE0OQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422720149", "bodyText": "What happens here if facet is undefined? Is that a possible situation?", "author": "SammyIsConfused", "createdAt": "2020-05-11T00:00:09Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetDialog.tsx", "diffHunk": "@@ -0,0 +1,163 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  Button,\n+  Dialog,\n+  DialogActions,\n+  DialogContent,\n+  DialogTitle,\n+  TextField,\n+} from \"@material-ui/core\";\n+import { commonString } from \"../../../util/commonstrings\";\n+import { languageStrings } from \"../../../util/langstrings\";\n+import { useEffect, useState } from \"react\";\n+import {\n+  FacetWithFlags,\n+  validateFacetFields,\n+} from \"./FacetedSearchSettingsModule\";\n+\n+interface facetDialogProps {\n+  /**\n+   * If true, the dialog will be shown.\n+   */\n+  open: boolean;\n+  /**\n+   * Fired when the dialog is closed.\n+   */\n+  onClose: () => void;\n+  /**\n+   * Fired when click the ADD button.\n+   */\n+  addOrEdit: (facet: FacetWithFlags) => void;\n+  /**\n+   * The facet to be edited; undefined if the action is to add a new one.\n+   */\n+  facet?: FacetWithFlags;\n+  /**\n+   * Error handling.\n+   */\n+  handleError: (error: Error) => void;\n+  /**\n+   * Current highest order index.\n+   */\n+  highestOrderIndex: number;\n+}\n+\n+/**\n+ * A dialog for adding/editing a facet\n+ */\n+const FacetDialog = ({\n+  open,\n+  onClose,\n+  addOrEdit,\n+  handleError,\n+  facet,\n+  highestOrderIndex,\n+}: facetDialogProps) => {\n+  const {\n+    facetedsearchsetting: facetedSearchSettingStrings,\n+  } = languageStrings.settings.searching;\n+  const { facetfields: facetFieldStrings } = facetedSearchSettingStrings;\n+\n+  const [name, setName] = useState<string>(\"\");\n+  const [schemaNode, setSchemaNode] = useState<string>(\"\");\n+  const [maxResults, setMaxResults] = useState<number | undefined>();\n+\n+  const isNameInvalid = validateFacetFields(name);\n+  const isSchemaNodeInvalid = validateFacetFields(schemaNode);\n+\n+  /**\n+   * Initialise textfields' values, depending on 'onClose'.\n+   */\n+  useEffect(() => {\n+    setName(facet?.name ?? \"\");\n+    setSchemaNode(facet?.schemaNode ?? \"\");\n+    setMaxResults(facet?.maxResults);", "originalCommit": "64e9ad6c4ac8975ee7c7e9d39faddbd52707e87f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyNTEwOQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422725109", "bodyText": "Yes facet can be undefined. When this happens, empty strings will be set to name and schemaNode.", "author": "PenghaiZhang", "createdAt": "2020-05-11T00:37:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDE0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjczMDQxMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422730411", "bodyText": "And maxResults is allowed to be undefined. Gotcha. \ud83d\udc4d Thanks for clarifying.", "author": "SammyIsConfused", "createdAt": "2020-05-11T01:10:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDE0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDMyNg==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422720326", "bodyText": "Unnecessary braces", "author": "SammyIsConfused", "createdAt": "2020-05-11T00:01:40Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetDialog.tsx", "diffHunk": "@@ -0,0 +1,163 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  Button,\n+  Dialog,\n+  DialogActions,\n+  DialogContent,\n+  DialogTitle,\n+  TextField,\n+} from \"@material-ui/core\";\n+import { commonString } from \"../../../util/commonstrings\";\n+import { languageStrings } from \"../../../util/langstrings\";\n+import { useEffect, useState } from \"react\";\n+import {\n+  FacetWithFlags,\n+  validateFacetFields,\n+} from \"./FacetedSearchSettingsModule\";\n+\n+interface facetDialogProps {\n+  /**\n+   * If true, the dialog will be shown.\n+   */\n+  open: boolean;\n+  /**\n+   * Fired when the dialog is closed.\n+   */\n+  onClose: () => void;\n+  /**\n+   * Fired when click the ADD button.\n+   */\n+  addOrEdit: (facet: FacetWithFlags) => void;\n+  /**\n+   * The facet to be edited; undefined if the action is to add a new one.\n+   */\n+  facet?: FacetWithFlags;\n+  /**\n+   * Error handling.\n+   */\n+  handleError: (error: Error) => void;\n+  /**\n+   * Current highest order index.\n+   */\n+  highestOrderIndex: number;\n+}\n+\n+/**\n+ * A dialog for adding/editing a facet\n+ */\n+const FacetDialog = ({\n+  open,\n+  onClose,\n+  addOrEdit,\n+  handleError,\n+  facet,\n+  highestOrderIndex,\n+}: facetDialogProps) => {\n+  const {\n+    facetedsearchsetting: facetedSearchSettingStrings,\n+  } = languageStrings.settings.searching;\n+  const { facetfields: facetFieldStrings } = facetedSearchSettingStrings;\n+\n+  const [name, setName] = useState<string>(\"\");\n+  const [schemaNode, setSchemaNode] = useState<string>(\"\");\n+  const [maxResults, setMaxResults] = useState<number | undefined>();\n+\n+  const isNameInvalid = validateFacetFields(name);\n+  const isSchemaNodeInvalid = validateFacetFields(schemaNode);\n+\n+  /**\n+   * Initialise textfields' values, depending on 'onClose'.\n+   */\n+  useEffect(() => {\n+    setName(facet?.name ?? \"\");\n+    setSchemaNode(facet?.schemaNode ?? \"\");\n+    setMaxResults(facet?.maxResults);\n+  }, [onClose]);\n+\n+  const onAddOrEdit = () => {\n+    addOrEdit({\n+      name,\n+      schemaNode,\n+      maxResults,\n+      orderIndex: highestOrderIndex + 1,\n+      updated: true,\n+      deleted: false,\n+      dirty: true,\n+    });\n+    onClose();\n+  };\n+\n+  return (\n+    <Dialog\n+      open={open}\n+      onClose={onClose}\n+      disableBackdropClick\n+      disableEscapeKeyDown\n+      fullWidth\n+    >\n+      <DialogTitle>{facetedSearchSettingStrings.add}</DialogTitle>\n+      <DialogContent>\n+        <TextField\n+          margin=\"dense\"\n+          label={facetFieldStrings.name}\n+          value={name}\n+          required\n+          fullWidth\n+          onChange={(event) => setName(event.target.value)}\n+          error={!!name && isNameInvalid}\n+        />\n+        <TextField\n+          margin=\"dense\"\n+          label={facetFieldStrings.schemanode}\n+          value={schemaNode}\n+          required\n+          fullWidth\n+          onChange={(event) => setSchemaNode(event.target.value)}\n+          error={!!schemaNode && isSchemaNodeInvalid}\n+        />\n+        <TextField\n+          type={\"number\"}", "originalCommit": "64e9ad6c4ac8975ee7c7e9d39faddbd52707e87f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDQ0MA==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422720440", "bodyText": "Rather than setting a const, couldn't you just refer to event.target.value directly in the setMaxResults function call?", "author": "SammyIsConfused", "createdAt": "2020-05-11T00:02:50Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetDialog.tsx", "diffHunk": "@@ -0,0 +1,163 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  Button,\n+  Dialog,\n+  DialogActions,\n+  DialogContent,\n+  DialogTitle,\n+  TextField,\n+} from \"@material-ui/core\";\n+import { commonString } from \"../../../util/commonstrings\";\n+import { languageStrings } from \"../../../util/langstrings\";\n+import { useEffect, useState } from \"react\";\n+import {\n+  FacetWithFlags,\n+  validateFacetFields,\n+} from \"./FacetedSearchSettingsModule\";\n+\n+interface facetDialogProps {\n+  /**\n+   * If true, the dialog will be shown.\n+   */\n+  open: boolean;\n+  /**\n+   * Fired when the dialog is closed.\n+   */\n+  onClose: () => void;\n+  /**\n+   * Fired when click the ADD button.\n+   */\n+  addOrEdit: (facet: FacetWithFlags) => void;\n+  /**\n+   * The facet to be edited; undefined if the action is to add a new one.\n+   */\n+  facet?: FacetWithFlags;\n+  /**\n+   * Error handling.\n+   */\n+  handleError: (error: Error) => void;\n+  /**\n+   * Current highest order index.\n+   */\n+  highestOrderIndex: number;\n+}\n+\n+/**\n+ * A dialog for adding/editing a facet\n+ */\n+const FacetDialog = ({\n+  open,\n+  onClose,\n+  addOrEdit,\n+  handleError,\n+  facet,\n+  highestOrderIndex,\n+}: facetDialogProps) => {\n+  const {\n+    facetedsearchsetting: facetedSearchSettingStrings,\n+  } = languageStrings.settings.searching;\n+  const { facetfields: facetFieldStrings } = facetedSearchSettingStrings;\n+\n+  const [name, setName] = useState<string>(\"\");\n+  const [schemaNode, setSchemaNode] = useState<string>(\"\");\n+  const [maxResults, setMaxResults] = useState<number | undefined>();\n+\n+  const isNameInvalid = validateFacetFields(name);\n+  const isSchemaNodeInvalid = validateFacetFields(schemaNode);\n+\n+  /**\n+   * Initialise textfields' values, depending on 'onClose'.\n+   */\n+  useEffect(() => {\n+    setName(facet?.name ?? \"\");\n+    setSchemaNode(facet?.schemaNode ?? \"\");\n+    setMaxResults(facet?.maxResults);\n+  }, [onClose]);\n+\n+  const onAddOrEdit = () => {\n+    addOrEdit({\n+      name,\n+      schemaNode,\n+      maxResults,\n+      orderIndex: highestOrderIndex + 1,\n+      updated: true,\n+      deleted: false,\n+      dirty: true,\n+    });\n+    onClose();\n+  };\n+\n+  return (\n+    <Dialog\n+      open={open}\n+      onClose={onClose}\n+      disableBackdropClick\n+      disableEscapeKeyDown\n+      fullWidth\n+    >\n+      <DialogTitle>{facetedSearchSettingStrings.add}</DialogTitle>\n+      <DialogContent>\n+        <TextField\n+          margin=\"dense\"\n+          label={facetFieldStrings.name}\n+          value={name}\n+          required\n+          fullWidth\n+          onChange={(event) => setName(event.target.value)}\n+          error={!!name && isNameInvalid}\n+        />\n+        <TextField\n+          margin=\"dense\"\n+          label={facetFieldStrings.schemanode}\n+          value={schemaNode}\n+          required\n+          fullWidth\n+          onChange={(event) => setSchemaNode(event.target.value)}\n+          error={!!schemaNode && isSchemaNodeInvalid}\n+        />\n+        <TextField\n+          type={\"number\"}\n+          margin=\"dense\"\n+          label={facetFieldStrings.categorynumber}\n+          value={maxResults}\n+          fullWidth\n+          onChange={(event) => {\n+            const value = event.target.value;", "originalCommit": "64e9ad6c4ac8975ee7c7e9d39faddbd52707e87f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDY5Ng==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422720696", "bodyText": "Why the ?? This function is typed such that field must be a string.", "author": "SammyIsConfused", "createdAt": "2020-05-11T00:04:58Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetedSearchSettingsModule.ts", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import Axios from \"axios\";\n+import {\n+  BatchOperationResponse,\n+  groupErrorMessages,\n+} from \"../../../api/BatchOperationResponse\";\n+\n+export interface Facet {\n+  /**\n+   * Name of a facet\n+   */\n+  name: string;\n+  /**\n+   * Schema node of a facet\n+   */\n+  schemaNode: string;\n+  /**\n+   * The number of category of a facet; Being undefined means the number is unlimited.\n+   */\n+  maxResults?: number;\n+  /**\n+   * Used for re-ordering facets.\n+   */\n+  orderIndex: number;\n+}\n+\n+export interface FacetWithFlags extends Facet {\n+  /**\n+   * A flag indicating a facet has been visually updated/created.\n+   */\n+  updated: boolean;\n+  /**\n+   * A flag indicating a facet has been visually deleted.\n+   */\n+  deleted: boolean;\n+  /**\n+   * A flag indication if a facet does not exist on the Server.\n+   */\n+  dirty: boolean;\n+}\n+\n+const FACETED_SEARCH_API_URL = \"api/settings/facetedsearch/classification\";\n+\n+export const getFacetsFromServer = (): Promise<Facet[]> =>\n+  Axios.get(FACETED_SEARCH_API_URL).then((res) => res.data);\n+\n+/**\n+ * Remove the boolean flags and then save to the Server.\n+ */\n+export const batchUpdateOrAdd = (facets: FacetWithFlags[]) =>\n+  Axios.put<BatchOperationResponse[]>(\n+    FACETED_SEARCH_API_URL,\n+    facets.map((facet) => removeFlags(facet))\n+  ).then((res) => groupErrorMessages(res.data));\n+\n+/**\n+ * Validate if trimmed name or schema node is empty.\n+ * Return true if they are invalid.\n+ */\n+export const validateFacetFields = (field: string): boolean => {\n+  return !field?.trim();", "originalCommit": "64e9ad6c4ac8975ee7c7e9d39faddbd52707e87f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDk5MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422720991", "bodyText": "Should be its own function.", "author": "SammyIsConfused", "createdAt": "2020-05-11T00:07:35Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetedSearchSettingsPage.tsx", "diffHunk": "@@ -0,0 +1,209 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  templateDefaults,\n+  templateError,\n+  TemplateUpdateProps,\n+} from \"../../../mainui/Template\";\n+import SettingPageTemplate from \"../../../components/SettingPageTemplate\";\n+import { useState } from \"react\";\n+import {\n+  Card,\n+  CardActions,\n+  IconButton,\n+  List,\n+  ListItem,\n+  ListItemSecondaryAction,\n+  ListItemText,\n+  ListSubheader,\n+  makeStyles,\n+} from \"@material-ui/core\";\n+import { languageStrings } from \"../../../util/langstrings\";\n+import {\n+  batchUpdateOrAdd,\n+  FacetWithFlags,\n+  getFacetsFromServer,\n+  getHighestOrderIndex,\n+} from \"./FacetedSearchSettingsModule\";\n+import EditIcon from \"@material-ui/icons/Edit\";\n+import DeleteIcon from \"@material-ui/icons/Delete\";\n+import AddCircleIcon from \"@material-ui/icons/AddCircle\";\n+import FacetDialog from \"./FacetDialog\";\n+import { useEffect } from \"react\";\n+import { routes } from \"../../../mainui/routes\";\n+import { addElement } from \"../../../util/ImmutableArrayUtil\";\n+import { generateFromError } from \"../../../api/errors\";\n+import MessageDialog from \"../../../components/MessageDialog\";\n+import { commonString } from \"../../../util/commonstrings\";\n+\n+const useStyles = makeStyles({\n+  spacedCards: {\n+    margin: \"16px\",\n+    width: \"75%\",\n+    padding: \"16px\",\n+    float: \"left\",\n+  },\n+  cardAction: {\n+    display: \"flex\",\n+    justifyContent: \"flex-end\",\n+  },\n+});\n+\n+/**\n+ * A page for setting Faceted search facets.\n+ */\n+const FacetedSearchSettingsPage = ({ updateTemplate }: TemplateUpdateProps) => {\n+  const facetedsearchsettingStrings =\n+    languageStrings.settings.searching.facetedsearchsetting;\n+  const classes = useStyles();\n+\n+  const [showSnackBar, setShowSnackBar] = useState<boolean>(false);\n+  const [showResultDialog, setShowResultDialog] = useState<boolean>(false);\n+  const [resultMessages, setResultMessagesMessages] = useState<string[]>([]);\n+  const [showEditingDialog, setShowEditingDialog] = useState<boolean>(false);\n+  const [facets, setFacets] = useState<FacetWithFlags[]>([]);\n+\n+  const listOfUpdates: FacetWithFlags[] = facets.filter(\n+    (facet) => facet.updated\n+  );\n+  const changesUnsaved = listOfUpdates.length > 0;\n+\n+  /**\n+   * Update the page title and back route, and get a list of facets.\n+   */\n+  useEffect(() => {\n+    updateTemplate((tp) => ({\n+      ...templateDefaults(facetedsearchsettingStrings.name)(tp),\n+      backRoute: routes.Settings.to,\n+    }));\n+    getFacets();\n+  }, []);\n+\n+  /**\n+   * Get facets from the Server and add boolean flags on them.\n+   */\n+  const getFacets = () => {\n+    getFacetsFromServer().then((facets) => {\n+      setFacets(\n+        facets.map((facet) => {\n+          return { ...facet, updated: false, deleted: false, dirty: false };\n+        })\n+      );\n+    });\n+  };\n+\n+  /**\n+   * Save updated/deleted facets to the Server.\n+   * Show the message dialog if any error message is received otherwise show snackbar.\n+   */\n+  const save = () => {\n+    batchUpdateOrAdd(listOfUpdates)\n+      .then((messages) => {\n+        if (messages.length > 0) {\n+          setResultMessagesMessages(messages);\n+          setShowResultDialog(true);\n+        } else {\n+          setShowSnackBar(true);\n+        }\n+      })\n+      .catch((error) => handleError(error))\n+      .finally(() => getFacets());\n+  };\n+\n+  /**\n+   * Visually add/update a facet.\n+   */\n+  const addOrEdit = (facet: FacetWithFlags) => {\n+    setFacets(addElement(facets, facet));\n+  };\n+\n+  /**\n+   * Error handling which throws a new error in order to break chained 'then'.\n+   */\n+  const handleError = (error: Error) => {\n+    updateTemplate(templateError(generateFromError(error)));\n+    throw new Error(error.message);\n+  };\n+\n+  return (\n+    <SettingPageTemplate\n+      onSave={save}\n+      saveButtonDisabled={!changesUnsaved}\n+      snackbarOpen={showSnackBar}\n+      snackBarOnClose={() => setShowSnackBar(false)}\n+      preventNavigation={changesUnsaved}\n+    >\n+      <Card className={classes.spacedCards}>\n+        <List\n+          subheader={\n+            <ListSubheader disableGutters>\n+              {facetedsearchsettingStrings.name}\n+            </ListSubheader>\n+          }\n+        >\n+          {facets", "originalCommit": "64e9ad6c4ac8975ee7c7e9d39faddbd52707e87f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMTQ0NA==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422721444", "bodyText": "Why are messagedialogtitle and messagedialogsubtitle removed? I can see that the messagedialogsubtitle is moved to errors, but the other one just seems to drop off.", "author": "SammyIsConfused", "createdAt": "2020-05-11T00:10:54Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/util/langstrings.ts", "diffHunk": "@@ -420,9 +421,6 @@ export const languageStrings = {\n         save: \"save Search filter configurations\",\n         filternamelabel: \"Name\",\n         mimetypelistlabel: \"MIME types *\",\n-        messagedialogtitle: \"Search filter setting results\",", "originalCommit": "64e9ad6c4ac8975ee7c7e9d39faddbd52707e87f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyOTE1Nw==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422729157", "bodyText": "Yes, as I mentioned above I found most Dialogs do not use subtitle so I removed it.", "author": "PenghaiZhang", "createdAt": "2020-05-11T01:03:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMTQ0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjczMDA1NQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422730055", "bodyText": "When you say \"most\", does that mean all of them don't use the subtitle prop? If so then yes, feel free to remove.", "author": "SammyIsConfused", "createdAt": "2020-05-11T01:08:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMTQ0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjczNDIxOA==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422734218", "bodyText": "I'd say yes. In oEQ existing dialogs and MUI Dialog examples I don't see any subtitle.  In MUI examples, they just put title in  DialogTitle and no subtitle is used.", "author": "PenghaiZhang", "createdAt": "2020-05-11T01:32:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMTQ0NA=="}], "type": "inlineReview"}, {"oid": "59db42fd57650d345ba0bc06865f0ccd8c371bf7", "url": "https://github.com/openequella/openEQUELLA/commit/59db42fd57650d345ba0bc06865f0ccd8c371bf7", "message": "Move the list of facets to a const so improve readability;\n\nMove the flag 'dirty' because we can later use ID to check if a facet is\ndirty or not;\n\nRemove highestOrderIndex from FacetDialog, and make addOrEdit take three\nparameters because this dialog only need to handle name, schema node and\nmax resutls.", "committedDate": "2020-05-11T04:06:04Z", "type": "commit"}, {"oid": "fb036c5f721dcd4915e94e017aa753faa4251cfc", "url": "https://github.com/openequella/openEQUELLA/commit/fb036c5f721dcd4915e94e017aa753faa4251cfc", "message": "The 'field' passed in 'validateFacetFields' must be a string so remove\nthe question mark after 'field' .", "committedDate": "2020-05-11T04:10:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjc3MDI2OQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422770269", "bodyText": "You can just use divider without ={true}", "author": "SammyIsConfused", "createdAt": "2020-05-11T04:14:59Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetedSearchSettingsPage.tsx", "diffHunk": "@@ -141,6 +153,43 @@ const FacetedSearchSettingsPage = ({ updateTemplate }: TemplateUpdateProps) => {\n     throw new Error(error.message);\n   };\n \n+  /**\n+   * Only renders a ListItem for each non-deleted facet.\n+   */\n+  const facetListItems: ReactElement[] = facets\n+    .filter((facet) => !facet.deleted)\n+    .map((facet, index) => {\n+      return (\n+        <ListItem divider={true} key={index}>", "originalCommit": "fb036c5f721dcd4915e94e017aa753faa4251cfc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "060af42768f24a807f5859f28a04dc404a1f0d39", "url": "https://github.com/openequella/openEQUELLA/commit/060af42768f24a807f5859f28a04dc404a1f0d39", "message": "In MUI ListItem, just use 'divider' instead of 'divider={true}'.", "committedDate": "2020-05-11T04:18:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjc3NjUzMA==", "url": "https://github.com/openequella/openEQUELLA/pull/1706#discussion_r422776530", "bodyText": "Just a reminder, performance wise you normally don't want to simply use an item's array index as the key. Typically in this case - if I didn't have unique id from a DB for example - I'd go with something like facet.name + index.\nThis'll be more important once the editing/deleting/re-ordering is added.", "author": "edalex-ian", "createdAt": "2020-05-11T04:40:08Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetedSearchSettingsPage.tsx", "diffHunk": "@@ -0,0 +1,231 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  templateDefaults,\n+  templateError,\n+  TemplateUpdateProps,\n+} from \"../../../mainui/Template\";\n+import SettingPageTemplate from \"../../../components/SettingPageTemplate\";\n+import { ReactElement, useState } from \"react\";\n+import {\n+  Card,\n+  CardActions,\n+  IconButton,\n+  List,\n+  ListItem,\n+  ListItemSecondaryAction,\n+  ListItemText,\n+  ListSubheader,\n+  makeStyles,\n+} from \"@material-ui/core\";\n+import { languageStrings } from \"../../../util/langstrings\";\n+import {\n+  batchUpdateOrAdd,\n+  FacetWithFlags,\n+  getFacetsFromServer,\n+  getHighestOrderIndex,\n+} from \"./FacetedSearchSettingsModule\";\n+import EditIcon from \"@material-ui/icons/Edit\";\n+import DeleteIcon from \"@material-ui/icons/Delete\";\n+import AddCircleIcon from \"@material-ui/icons/AddCircle\";\n+import FacetDialog from \"./FacetDialog\";\n+import { useEffect } from \"react\";\n+import { routes } from \"../../../mainui/routes\";\n+import { addElement } from \"../../../util/ImmutableArrayUtil\";\n+import { generateFromError } from \"../../../api/errors\";\n+import MessageDialog from \"../../../components/MessageDialog\";\n+import { commonString } from \"../../../util/commonstrings\";\n+\n+const useStyles = makeStyles({\n+  spacedCards: {\n+    margin: \"16px\",\n+    width: \"75%\",\n+    padding: \"16px\",\n+    float: \"left\",\n+  },\n+  cardAction: {\n+    display: \"flex\",\n+    justifyContent: \"flex-end\",\n+  },\n+});\n+\n+/**\n+ * A page for setting Faceted search facets.\n+ */\n+const FacetedSearchSettingsPage = ({ updateTemplate }: TemplateUpdateProps) => {\n+  const facetedsearchsettingStrings =\n+    languageStrings.settings.searching.facetedsearchsetting;\n+  const classes = useStyles();\n+\n+  const [showSnackBar, setShowSnackBar] = useState<boolean>(false);\n+  const [showResultDialog, setShowResultDialog] = useState<boolean>(false);\n+  const [resultMessages, setResultMessagesMessages] = useState<string[]>([]);\n+  const [showEditingDialog, setShowEditingDialog] = useState<boolean>(false);\n+  const [facets, setFacets] = useState<FacetWithFlags[]>([]);\n+\n+  const listOfUpdates: FacetWithFlags[] = facets.filter(\n+    (facet) => facet.updated\n+  );\n+  const changesUnsaved = listOfUpdates.length > 0;\n+\n+  /**\n+   * Update the page title and back route, and get a list of facets.\n+   */\n+  useEffect(() => {\n+    updateTemplate((tp) => ({\n+      ...templateDefaults(facetedsearchsettingStrings.name)(tp),\n+      backRoute: routes.Settings.to,\n+    }));\n+    getFacets();\n+  }, []);\n+\n+  /**\n+   * Get facets from the Server and add boolean flags on them.\n+   */\n+  const getFacets = () => {\n+    getFacetsFromServer().then((facets) => {\n+      setFacets(\n+        facets.map((facet) => {\n+          return { ...facet, updated: false, deleted: false };\n+        })\n+      );\n+    });\n+  };\n+\n+  /**\n+   * Save updated/deleted facets to the Server.\n+   * Show the message dialog if any error message is received otherwise show snackbar.\n+   */\n+  const save = () => {\n+    batchUpdateOrAdd(listOfUpdates)\n+      .then((messages) => {\n+        if (messages.length > 0) {\n+          setResultMessagesMessages(messages);\n+          setShowResultDialog(true);\n+        } else {\n+          setShowSnackBar(true);\n+        }\n+      })\n+      .catch((error) => handleError(error))\n+      .finally(() => getFacets());\n+  };\n+\n+  /**\n+   * Visually add/update a facet.\n+   */\n+  const addOrEdit = (\n+    name: string,\n+    schemaNode: string,\n+    maxResults: number | undefined\n+  ) => {\n+    const facet = {\n+      name,\n+      schemaNode,\n+      maxResults,\n+      orderIndex: getHighestOrderIndex(facets) + 1,\n+      updated: true,\n+      deleted: false,\n+    };\n+    setFacets(addElement(facets, facet));\n+  };\n+\n+  /**\n+   * Error handling which throws a new error in order to break chained 'then'.\n+   */\n+  const handleError = (error: Error) => {\n+    updateTemplate(templateError(generateFromError(error)));\n+    throw new Error(error.message);\n+  };\n+\n+  /**\n+   * Only renders a ListItem for each non-deleted facet.\n+   */\n+  const facetListItems: ReactElement[] = facets\n+    .filter((facet) => !facet.deleted)\n+    .map((facet, index) => {\n+      return (\n+        <ListItem divider key={index}>", "originalCommit": "060af42768f24a807f5859f28a04dc404a1f0d39", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}