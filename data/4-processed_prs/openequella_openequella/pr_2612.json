{"pr_number": 2612, "pr_title": "Address some ESLint react-hooks/exhaustive-deps warnings", "pr_createdAt": "2020-12-16T07:08:09Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/2612", "timeline": [{"oid": "9db069af6f57a4cdb79a7e7569350b6df1d7bc92", "url": "https://github.com/openequella/openEQUELLA/commit/9db069af6f57a4cdb79a7e7569350b6df1d7bc92", "message": "chore(front-end): Fix react-hooks/exhaustive-deps for UISettingsEditor", "committedDate": "2020-12-16T06:25:50Z", "type": "commit"}, {"oid": "114454af29cc4d301b06bcb310f9935b1b3506bd", "url": "https://github.com/openequella/openEQUELLA/commit/114454af29cc4d301b06bcb310f9935b1b3506bd", "message": "chore(front-end): Fix react-hooks/exhaustive-deps for SearchFilterSettingsPage\n\nNeeded a bit of work, and really should probably be completely reworked\nto use a reducer. But that's outside of this scope.\n\nAlso, looks like the 'Error' be returned from\ngetSearchSettingsFromServer is no such thing.", "committedDate": "2020-12-16T06:25:50Z", "type": "commit"}, {"oid": "29b22eca15512cbd3e1a35b5d67507f492045d64", "url": "https://github.com/openequella/openEQUELLA/commit/29b22eca15512cbd3e1a35b5d67507f492045d64", "message": "chore(front-end): Fix react-hooks/exhaustive-deps for SettingsPage", "committedDate": "2020-12-16T06:25:50Z", "type": "commit"}, {"oid": "b89f0fe1a7e4c8aae3cf76acf496d3d9a8c87224", "url": "https://github.com/openequella/openEQUELLA/commit/b89f0fe1a7e4c8aae3cf76acf496d3d9a8c87224", "message": "chore(front-end): Add new useError hook\n\nThis can be used (for now) to assist managing state and effect\ndependencies related with the way errors are being done.", "committedDate": "2020-12-16T06:25:50Z", "type": "commit"}, {"oid": "33c6b18bc9b1a51a4b8e42d466b71d7e0cf41293", "url": "https://github.com/openequella/openEQUELLA/commit/33c6b18bc9b1a51a4b8e42d466b71d7e0cf41293", "message": "chore(front-end): Fix react-hooks/exhaustive-deps for CollectionSelector", "committedDate": "2020-12-16T06:25:50Z", "type": "commit"}, {"oid": "b7b67e3dfdc8a2cf1458efa23d8178d129fa1ea1", "url": "https://github.com/openequella/openEQUELLA/commit/b7b67e3dfdc8a2cf1458efa23d8178d129fa1ea1", "message": "chore(front-end): Apply useError to UISettingEditor", "committedDate": "2020-12-16T06:25:50Z", "type": "commit"}, {"oid": "8572189f42568c59af4624528e79fa506127ce0b", "url": "https://github.com/openequella/openEQUELLA/commit/8572189f42568c59af4624528e79fa506127ce0b", "message": "chore(front-end): Fix react-hooks/exhaustive-deps for MimeTypeFilterEditingDialog", "committedDate": "2020-12-16T06:25:50Z", "type": "commit"}, {"oid": "fe21239b1ebc8a1d9fd91aa4f3aba41516557d61", "url": "https://github.com/openequella/openEQUELLA/commit/fe21239b1ebc8a1d9fd91aa4f3aba41516557d61", "message": "chore(front-end): Fix react-hooks/exhaustive-deps for FacetedSearchSettingsPage", "committedDate": "2020-12-16T06:25:50Z", "type": "commit"}, {"oid": "fd83166a9b775b7beb2def68e556929fc4ec9fb8", "url": "https://github.com/openequella/openEQUELLA/commit/fd83166a9b775b7beb2def68e556929fc4ec9fb8", "message": "chore(front-end): Fix react-hooks/exhaustive-deps for FacetedDialog", "committedDate": "2020-12-16T06:25:50Z", "type": "commit"}, {"oid": "dcaddee741efb46799e8c9d880dd3afd94c3515d", "url": "https://github.com/openequella/openEQUELLA/commit/dcaddee741efb46799e8c9d880dd3afd94c3515d", "message": "chore(front-end): Fix react-hooks/exhaustive-deps for NavigationGuard", "committedDate": "2020-12-16T06:25:50Z", "type": "commit"}, {"oid": "d655b05452f6b50a414479514f9176a2873db915", "url": "https://github.com/openequella/openEQUELLA/commit/d655b05452f6b50a414479514f9176a2873db915", "message": "chore(front-end): Address react-hooks/exhaustive-deps for SearchBar", "committedDate": "2020-12-16T06:25:50Z", "type": "commit"}, {"oid": "18cbd416b5203005f3eeec91ecd2123c969ea426", "url": "https://github.com/openequella/openEQUELLA/commit/18cbd416b5203005f3eeec91ecd2123c969ea426", "message": "chore(front-end): Update SettingsPage to use useError", "committedDate": "2020-12-16T07:07:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA1NzM4OA==", "url": "https://github.com/openequella/openEQUELLA/pull/2612#discussion_r544057388", "bodyText": "I did also ponder this taking an optional deps, however at the time it wasn't needed. Now I wonder if maybe it is for the cases where's it passed an anonymous function using updateTemplate. \ud83e\udd14", "author": "edalex-ian", "createdAt": "2020-12-16T07:09:27Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/util/useError.ts", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import { useEffect, useState } from \"react\";\n+\n+/**\n+ * A custom hook to assist with the management of of state (and effect dependencies) for the\n+ * displaying of errors within the New UI Template. Ideally long term this will be replaced\n+ * possibly through the centralising of this via a Context with `useContent`. Further, the\n+ * project will start to make use of Error Boundaries (possibly via `react-error-boundary`).\n+ *\n+ * But for now, we have this...\n+ *\n+ * @param onError A function which typically calls out to updateTemplate to trigger the error\n+ *                mechanisms, but often passed in via props\n+ */\n+export const useError = (\n+  onError: (error: Error) => void\n+): ((error: Error) => void) => {", "originalCommit": "18cbd416b5203005f3eeec91ecd2123c969ea426", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3MjM3Nw==", "url": "https://github.com/openequella/openEQUELLA/pull/2612#discussion_r544772377", "bodyText": "If this effect depends on open, do we need to put line 89 - 91 in a if statement ?\nif(open) {\n    setName(facet?.name ?? \"\");\n    setSchemaNode(facet?.schemaNode ?? \"\");\n    setMaxResults(facet?.maxResults);\n}", "author": "PenghaiZhang", "createdAt": "2020-12-17T02:50:49Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetDialog.tsx", "diffHunk": "@@ -83,13 +83,13 @@ const FacetDialog = ({\n   const isSchemaNodeInvalid = validateFacetFields(schemaNode);\n \n   /**\n-   * Initialise textfields' values, depending on 'onClose'.\n+   * Initialise `textfields` values when the dialog is opened.\n    */\n   useEffect(() => {\n     setName(facet?.name ?? \"\");\n     setSchemaNode(facet?.schemaNode ?? \"\");\n     setMaxResults(facet?.maxResults);\n-  }, [onClose]);\n+  }, [open, facet]);", "originalCommit": "18cbd416b5203005f3eeec91ecd2123c969ea426", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc5MDgxOQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2612#discussion_r544790819", "bodyText": "Wouldn't be a bad idea as an optimisation.... Actually, might suppress a visual oddity... I'll go add that. \ud83d\udc4d", "author": "edalex-ian", "createdAt": "2020-12-17T03:47:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3MjM3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3MzYxMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2612#discussion_r544773611", "bodyText": "If a language string is changed, users must fresh the page to see the new language string, which means this component will get re-rendered. So is it really useful to make this effect depend on facetedsearchsettingStrings.name?", "author": "PenghaiZhang", "createdAt": "2020-12-17T02:54:24Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/settings/Search/facetedsearch/FacetedSearchSettingsPage.tsx", "diffHunk": "@@ -106,13 +111,12 @@ const FacetedSearchSettingsPage = ({ updateTemplate }: TemplateUpdateProps) => {\n       ...templateDefaults(facetedsearchsettingStrings.name)(tp),\n       backRoute: routes.Settings.to,\n     }));\n-    getFacets();\n-  }, []);\n+  }, [updateTemplate, facetedsearchsettingStrings.name]);", "originalCommit": "18cbd416b5203005f3eeec91ecd2123c969ea426", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc4OTUxMg==", "url": "https://github.com/openequella/openEQUELLA/pull/2612#discussion_r544789512", "bodyText": "Yup, it's a fair point. But that's an implementation detail that is correct right now. In the future we could suddenly be doing something more dynamic - even if, that's very unlikely.\nBut the idea of dependencies are more abstract than that. That is, any external variable (incl. function) could be irrelevant/changed due to the enclosing function having been destroyed/recreated, so by making sure they're included the anonymous function in the effect is still closing over relative data.\nHowever, in the real world when you read this you can find yourself asking... What's the point, that'll never change - and in that case, then we could use the eslint suppress comment, but seems like it's better to just declare it when you know it.", "author": "edalex-ian", "createdAt": "2020-12-17T03:42:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3MzYxMQ=="}], "type": "inlineReview"}, {"oid": "1da57fd4c1a9c339071da52833bbcb544f5602b8", "url": "https://github.com/openequella/openEQUELLA/commit/1da57fd4c1a9c339071da52833bbcb544f5602b8", "message": "chore(front-end): Only initialise textfields on open\n\nMinor optimisation from feedback in PR #2612 . Will also help with a\ndisplay oddity of values reverting as the dialog closes.", "committedDate": "2020-12-17T04:55:00Z", "type": "commit"}]}