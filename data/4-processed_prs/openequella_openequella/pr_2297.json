{"pr_number": 2297, "pr_title": "Include REST module's tests in GHA", "pr_createdAt": "2020-09-17T04:21:08Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/2297", "timeline": [{"oid": "893e57b74b8a706369ea4826c57fbca2cdd47175", "url": "https://github.com/openequella/openEQUELLA/commit/893e57b74b8a706369ea4826c57fbca2cdd47175", "message": "Add 'async' to a test of 'auth.test.ts'.", "committedDate": "2020-09-17T04:04:10Z", "type": "commit"}, {"oid": "9e53a26c9600f6463f75cd50881155db1d035284", "url": "https://github.com/openequella/openEQUELLA/commit/9e53a26c9600f6463f75cd50881155db1d035284", "message": "Include the tests of module 'oeq-ts-rest-api' in GHA.", "committedDate": "2020-09-17T04:07:08Z", "type": "commit"}, {"oid": "5f489fa82336b0dc36abcc4b947d680ac2164d2f", "url": "https://github.com/openequella/openEQUELLA/commit/5f489fa82336b0dc36abcc4b947d680ac2164d2f", "message": "Update the password used in Rest module tests.", "committedDate": "2020-09-17T04:13:05Z", "type": "commit"}, {"oid": "8dfb852b4c91cb0cd480237be4de5c5501be2b6e", "url": "https://github.com/openequella/openEQUELLA/commit/8dfb852b4c91cb0cd480237be4de5c5501be2b6e", "message": "Install Chromium and Chrome Driver for GHA job\n'rest-module-testing'.", "committedDate": "2020-09-17T05:22:08Z", "type": "commit"}, {"oid": "fe5126e1ce71fea2dd4f78503eccd97356bad1db", "url": "https://github.com/openequella/openEQUELLA/commit/fe5126e1ce71fea2dd4f78503eccd97356bad1db", "message": "Specify the configuration used for initialising\noEQ in autotest.", "committedDate": "2020-09-17T06:39:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMyNjgyNw==", "url": "https://github.com/openequella/openEQUELLA/pull/2297#discussion_r490326827", "bodyText": "FWIW the github linux virtual environment comes with Chrome + ChromeDriver and Firefox + GeckoDriver pre-installed https://github.com/actions/virtual-environments/blob/main/images/linux/Ubuntu2004-README.md#ubuntu-20041-lts", "author": "ChristianMurphy", "createdAt": "2020-09-17T15:05:41Z", "path": ".github/workflows/ci.yaml", "diffHunk": "@@ -259,3 +259,78 @@ jobs:\n         with:\n           name: CoverageReport-newui-${{ matrix.newui }}\n           path: coverage_report.tar\n+\n+  rest-module-testing:\n+    needs: build_and_check\n+\n+    runs-on: ubuntu-latest\n+\n+    services:\n+      postgres:\n+        image: postgres:9.6\n+        env:\n+          POSTGRES_USER: equellatests\n+          POSTGRES_PASSWORD: password\n+        # Set health checks to wait until postgres has started\n+        options: >-\n+          --health-cmd pg_isready\n+          --health-interval 10s\n+          --health-timeout 5s\n+          --health-retries 5\n+        ports:\n+          # Maps tcp port 5432 on service container to the host\n+          - 5432:5432\n+\n+    env:\n+      AUTOTEST_CONFIG: autotest/github-actions.conf\n+\n+    steps:\n+      - uses: actions/checkout@v1\n+\n+      - name: Set up JDK 1.8\n+        uses: actions/setup-java@v1\n+        with:\n+          java-version: 1.8\n+\n+      - name: Install Chromium\n+        run: |\n+          sudo apt-get update\n+          sudo apt-get install -y --no-install-recommends \\\n+            chromium-browser \\\n+            chromium-chromedriver \\", "originalCommit": "fe5126e1ce71fea2dd4f78503eccd97356bad1db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY1MDI0Nw==", "url": "https://github.com/openequella/openEQUELLA/pull/2297#discussion_r490650247", "bodyText": "Nice! Thanks @ChristianMurphy !", "author": "PenghaiZhang", "createdAt": "2020-09-18T01:34:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMyNjgyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY2Mjg3MA==", "url": "https://github.com/openequella/openEQUELLA/pull/2297#discussion_r490662870", "bodyText": "hmmm it looks like oEQ may be hard coded to look for chromium, even if chrome is present.", "author": "ChristianMurphy", "createdAt": "2020-09-18T02:22:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMyNjgyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY2MzQ2Mg==", "url": "https://github.com/openequella/openEQUELLA/pull/2297#discussion_r490663462", "bodyText": "Yes, in github-actions.conf we specify where to look for chromedriver. Do you know where is the pre-installed chromedriver ? I am about to do some search.", "author": "PenghaiZhang", "createdAt": "2020-09-18T02:24:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMyNjgyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY2MzYxOQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2297#discussion_r490663619", "bodyText": "It's in the autotest.conf. So if you change this, make sure you also change it for the functional test.", "author": "edalex-ian", "createdAt": "2020-09-18T02:25:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMyNjgyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY2NTQzOQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2297#discussion_r490665439", "bodyText": "Do you know where is the pre-installed chromedriver ?\n\nI'm not sure the exact location, but the docs mention\n\nChrome Driver is available via CHROMEWEBDRIVER environment variable\n\nso I'm guessing using that directly, or echo'ing it and the coding it in would work.\nhttps://github.com/actions/virtual-environments/blob/main/images/linux/Ubuntu2004-README.md#ubuntu-20041-lts", "author": "ChristianMurphy", "createdAt": "2020-09-18T02:32:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMyNjgyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY2NzEyNA==", "url": "https://github.com/openequella/openEQUELLA/pull/2297#discussion_r490667124", "bodyText": "Yes I also found this. I will push a commit soon.", "author": "PenghaiZhang", "createdAt": "2020-09-18T02:39:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMyNjgyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY2NzE4MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2297#discussion_r490667181", "bodyText": "actions/virtual-environments#248", "author": "PenghaiZhang", "createdAt": "2020-09-18T02:39:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMyNjgyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMyNzM3OA==", "url": "https://github.com/openequella/openEQUELLA/pull/2297#discussion_r490327378", "bodyText": "#2284 may work here as well", "author": "ChristianMurphy", "createdAt": "2020-09-17T15:06:33Z", "path": ".github/workflows/ci.yaml", "diffHunk": "@@ -259,3 +259,78 @@ jobs:\n         with:\n           name: CoverageReport-newui-${{ matrix.newui }}\n           path: coverage_report.tar\n+\n+  rest-module-testing:\n+    needs: build_and_check\n+\n+    runs-on: ubuntu-latest\n+\n+    services:\n+      postgres:\n+        image: postgres:9.6\n+        env:\n+          POSTGRES_USER: equellatests\n+          POSTGRES_PASSWORD: password\n+        # Set health checks to wait until postgres has started\n+        options: >-\n+          --health-cmd pg_isready\n+          --health-interval 10s\n+          --health-timeout 5s\n+          --health-retries 5\n+        ports:\n+          # Maps tcp port 5432 on service container to the host\n+          - 5432:5432\n+\n+    env:\n+      AUTOTEST_CONFIG: autotest/github-actions.conf\n+\n+    steps:\n+      - uses: actions/checkout@v1\n+\n+      - name: Set up JDK 1.8\n+        uses: actions/setup-java@v1\n+        with:\n+          java-version: 1.8\n+\n+      - name: Install Chromium\n+        run: |\n+          sudo apt-get update\n+          sudo apt-get install -y --no-install-recommends \\\n+            chromium-browser \\\n+            chromium-chromedriver \\\n+\n+      - name: Download installer\n+        uses: actions/download-artifact@v1\n+        with:\n+          name: Artefacts\n+\n+      - name: Extract installer from build\n+        env:\n+          DOWNLOAD_DIR: Artefacts\n+          INSTALLER_DIR: Installer/target\n+        run: |\n+          tar --directory $DOWNLOAD_DIR -xvf $DOWNLOAD_DIR/artefacts.tar\n+          mkdir -p $INSTALLER_DIR\n+          mv -v $DOWNLOAD_DIR/equella-installer*.zip $INSTALLER_DIR\n+\n+      - name: Install openEquella\n+        run: |\n+          ./sbt -jvm-opts autotest/.jvmopts \"project autotest\" \\\n+            installEquella startEquella configureInstall setupForTests\n+\n+      - name: Set up NVM\n+        shell: bash -l {0}\n+        run: |\n+          curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh | bash\n+          export NVM_DIR=\"$HOME/.nvm\"\n+          echo \"source $NVM_DIR/nvm.sh\" >> \"$HOME/.bash_profile\"\n+\n+      - name: Install NodeJS\n+        shell: bash -l {0}\n+        run: |\n+          nvm install", "originalCommit": "fe5126e1ce71fea2dd4f78503eccd97356bad1db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY0ODc1MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2297#discussion_r490648751", "bodyText": "Thanks!!  I should action setup-node!", "author": "PenghaiZhang", "createdAt": "2020-09-18T01:28:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMyNzM3OA=="}], "type": "inlineReview"}, {"oid": "4380765d4823fd293909299299402f86ac3f67db", "url": "https://github.com/openequella/openEQUELLA/commit/4380765d4823fd293909299299402f86ac3f67db", "message": "Use autotest account in REST Module tests.", "committedDate": "2020-09-18T01:25:39Z", "type": "commit"}, {"oid": "e035fca9c050a45e4dc4eea32bd904555c9d0b99", "url": "https://github.com/openequella/openEQUELLA/commit/e035fca9c050a45e4dc4eea32bd904555c9d0b99", "message": "Install NodeJs by using action 'setup-node@v1'.", "committedDate": "2020-09-18T01:32:16Z", "type": "commit"}, {"oid": "24d46f2eae40797e52c9129aca8efd0bbed2b5b8", "url": "https://github.com/openequella/openEQUELLA/commit/24d46f2eae40797e52c9129aca8efd0bbed2b5b8", "message": "No need to install Chromium and ChromeDriver as\nthey are pre-installed.", "committedDate": "2020-09-18T01:33:30Z", "type": "commit"}, {"oid": "16ba1e4317d815d61b0a5f35843ba7b8bbea8f3f", "url": "https://github.com/openequella/openEQUELLA/commit/16ba1e4317d815d61b0a5f35843ba7b8bbea8f3f", "message": "Use env variable to access ChromeDriver.\n\nGHA's VM (ubuntu) adds ChromeDriver to an env variable\nnamed CHROMEWEBDRIVER so we can use this variable.", "committedDate": "2020-09-18T02:38:30Z", "type": "commit"}, {"oid": "83ee2fe53aaef3e9972d98c3a1ee1fd9efa4f313", "url": "https://github.com/openequella/openEQUELLA/commit/83ee2fe53aaef3e9972d98c3a1ee1fd9efa4f313", "message": "Correct the path to ChromeDriver.", "committedDate": "2020-09-18T03:55:05Z", "type": "commit"}, {"oid": "fcd3b003ef8c8ec30c66427220889803198fb1ba", "url": "https://github.com/openequella/openEQUELLA/commit/fcd3b003ef8c8ec30c66427220889803198fb1ba", "message": "Remove redundant double quotes for ChromeDriver path.", "committedDate": "2020-09-18T04:29:55Z", "type": "commit"}, {"oid": "738c06fbf380cc472cf6415c8b3c22e95b8b1fc2", "url": "https://github.com/openequella/openEQUELLA/commit/738c06fbf380cc472cf6415c8b3c22e95b8b1fc2", "message": "Try another env var for Chrome.", "committedDate": "2020-09-18T05:25:40Z", "type": "commit"}, {"oid": "ff2b14083ace9c3b0d1ee5fb24138ddb9389f393", "url": "https://github.com/openequella/openEQUELLA/commit/ff2b14083ace9c3b0d1ee5fb24138ddb9389f393", "message": "Job 'functional_testing' does not need to install Chrome\nas well.", "committedDate": "2020-09-18T06:18:09Z", "type": "commit"}]}