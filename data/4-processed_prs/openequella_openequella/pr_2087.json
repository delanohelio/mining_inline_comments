{"pr_number": 2087, "pr_title": "Refine control: Last modified date selector", "pr_createdAt": "2020-07-22T01:34:13Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/2087", "timeline": [{"oid": "136f6cc69fc251b643d670032c9063fd1877717c", "url": "https://github.com/openequella/openEQUELLA/commit/136f6cc69fc251b643d670032c9063fd1877717c", "message": "Create a new component as Last modified date selector\n\nThis refine control shows a Dropdown of date options or two custom Date\npickers, depending on the value of the Switch which is also included in\nthis control.", "committedDate": "2020-07-22T01:14:17Z", "type": "commit"}, {"oid": "c7b41bf3b4234936d4dc740bb2fca88a8eaccae9", "url": "https://github.com/openequella/openEQUELLA/commit/c7b41bf3b4234936d4dc740bb2fca88a8eaccae9", "message": "Add a Storybook for the Last modified date selector.", "committedDate": "2020-07-22T01:14:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUxOTEyMA==", "url": "https://github.com/openequella/openEQUELLA/pull/2087#discussion_r458519120", "bodyText": "This will need language strings.", "author": "edalex-ian", "createdAt": "2020-07-22T03:56:05Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/SearchModule.ts", "diffHunk": "@@ -108,3 +109,89 @@ export interface SearchOptions {\n    */\n   rawMode: boolean;\n }\n+\n+/**\n+ * Type of Last modified date range.\n+ */\n+export interface LastModifiedDateRange {\n+  /**\n+   * The date before which items are modified.\n+   */\n+  modifiedBefore?: string;\n+  /**\n+   * The date after which items are modified.\n+   */\n+  modifiedAfter?: string;\n+}\n+\n+/**\n+ * An enum providing five values as the Quick date options.\n+ */\n+export enum LastModifiedDateOption {\n+  ALL = \"All\",\n+  TODAY = \"Today\",\n+  LAST_SEVEN_DAYS = \"Last seven days\",\n+  LAST_MONTH = \"Last month\",\n+  THIS_YEAR = \"This year\",\n+}", "originalCommit": "c7b41bf3b4234936d4dc740bb2fca88a8eaccae9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUyMDE2Mw==", "url": "https://github.com/openequella/openEQUELLA/pull/2087#discussion_r458520163", "bodyText": "A couple of things:\n\nThese props are duplicates - maybe put them in an object and spread them; and\nShould format be using the locale format or if internal than ISO? (I'm not sure what this prop controls.)", "author": "edalex-ian", "createdAt": "2020-07-22T04:00:36Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/ModifiedDateSelector.tsx", "diffHunk": "@@ -0,0 +1,155 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  FormControl,\n+  Grid,\n+  InputLabel,\n+  MenuItem,\n+  Select,\n+} from \"@material-ui/core\";\n+import { InlineDatePicker } from \"material-ui-pickers\";\n+\n+import { DateTime } from \"luxon\";\n+import {\n+  dateOptionToDateRangeConverter,\n+  dateRangeToDateOptionConverter,\n+  LastModifiedDateOption,\n+  LastModifiedDateRange,\n+} from \"../SearchModule\";\n+import SettingsToggleSwitch from \"../../components/SettingsToggleSwitch\";\n+import { ReactNode } from \"react\";\n+import { languageStrings } from \"../../util/langstrings\";\n+\n+export interface ModifiedDateSelectorProps {\n+  /**\n+   * Fired when date range is changed.\n+   * @param dateRange A new date range.\n+   */\n+  onDateRangeChange: (dateRange?: LastModifiedDateRange) => void;\n+  /**\n+   * Fired when the status of Quick mode is changed.\n+   * @param enabled The new status of Quick mode\n+   */\n+  onQuickModeChange: (enabled: boolean) => void;\n+  /**\n+   * Initially selected date range.\n+   */\n+  dateRange?: LastModifiedDateRange;\n+  /**\n+   * Initial status of Quick mode.\n+   */\n+  quickModeEnabled?: boolean;\n+}\n+\n+/**\n+ * As a refine control, this component is used to filter search results by last modified dates.\n+ * Depending on what mode is selected, a Quick option Dropdown or two custom date pickers are displayed.\n+ */\n+export const ModifiedDateSelector = ({\n+  onDateRangeChange,\n+  onQuickModeChange,\n+  dateRange,\n+  quickModeEnabled,\n+}: ModifiedDateSelectorProps) => {\n+  const modifiedDateSelectorStrings =\n+    languageStrings.searchpage.modifiedDateSelector;\n+\n+  const handleQuickDateOptionChange = (\n+    option: LastModifiedDateOption\n+  ): void => {\n+    const dateRange = dateOptionToDateRangeConverter(option);\n+    onDateRangeChange(dateRange);\n+  };\n+\n+  const quickOptions: ReactNode = (\n+    <FormControl variant=\"outlined\" fullWidth>\n+      <InputLabel id=\"modified_date_range_selector_label\">\n+        {modifiedDateSelectorStrings.quickOptionLabel}\n+      </InputLabel>\n+      <Select\n+        value={dateRangeToDateOptionConverter(dateRange)}\n+        id=\"modified_date_range_selector\"\n+        labelId=\"modified_date_range_selector_label\"\n+        onChange={(event) =>\n+          handleQuickDateOptionChange(\n+            event.target.value as LastModifiedDateOption\n+          )\n+        }\n+        label={modifiedDateSelectorStrings.quickOptionLabel}\n+      >\n+        {Object.values(LastModifiedDateOption).map((value) => (\n+          <MenuItem key={value} value={value}>\n+            {value}\n+          </MenuItem>\n+        ))}\n+      </Select>\n+    </FormControl>\n+  );\n+\n+  const customDateRange: ReactNode = (\n+    <Grid container>\n+      <Grid item xs={6}>\n+        <InlineDatePicker\n+          disableFuture\n+          variant=\"outlined\"\n+          format=\"dd/MM/yyyy\"", "originalCommit": "c7b41bf3b4234936d4dc740bb2fca88a8eaccae9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2099e40e5a30feec6e38611673e0c301aee4bf0b", "url": "https://github.com/openequella/openEQUELLA/commit/2099e40e5a30feec6e38611673e0c301aee4bf0b", "message": "Remove prop 'xs' from the two Grids for Last modified date pickers.", "committedDate": "2020-07-22T05:30:22Z", "type": "commit"}, {"oid": "50bf786627bc50248b920778103d88ee18a312f0", "url": "https://github.com/openequella/openEQUELLA/commit/50bf786627bc50248b920778103d88ee18a312f0", "message": "Update material-ui picker to the latest stable version\n\nThe update requires some changes made on 'PreLoginNoticeConfigurator'.\nAlso move 'MuiPickersUtilsProvider' from the Legacy content template to\n'PreLoginNoticeConfigurator'.", "committedDate": "2020-07-22T05:57:59Z", "type": "commit"}, {"oid": "d6f92c869ee4662c7a73595dc395f968510e6c19", "url": "https://github.com/openequella/openEQUELLA/commit/d6f92c869ee4662c7a73595dc395f968510e6c19", "message": "A few tweaks for Last modified date pickers\n\n1. Wrap Date pickers by MuiPickersUtilsProvider; and\n2. Enable autoOK; and;\n3. Use \"outlined\" as input variant.", "committedDate": "2020-07-22T06:26:55Z", "type": "commit"}, {"oid": "8ecac6273a5862f635725e94ea1fbe5a9855615a", "url": "https://github.com/openequella/openEQUELLA/commit/8ecac6273a5862f635725e94ea1fbe5a9855615a", "message": "Refactor ModifiedDateSelector and its Storybook.\n\n1. Move this control's utils from Search module back to itself.\n2. Change types of date range fields from string to Date.\n3. Remove the usage of enum for Quick options.\n4. Update JSDoc and Storybook.", "committedDate": "2020-07-23T02:17:00Z", "type": "commit"}, {"oid": "d48b3c16329f282548e5fc1c9833b02023e083c9", "url": "https://github.com/openequella/openEQUELLA/commit/d48b3c16329f282548e5fc1c9833b02023e083c9", "message": "Extract MUI Date picker general props into an object.", "committedDate": "2020-07-23T02:33:21Z", "type": "commit"}, {"oid": "59119d75b63ac97832b60cb59003c5c0730d38d4", "url": "https://github.com/openequella/openEQUELLA/commit/59119d75b63ac97832b60cb59003c5c0730d38d4", "message": "Fix a typo issue for Search page", "committedDate": "2020-07-23T04:00:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIwOTQ2NA==", "url": "https://github.com/openequella/openEQUELLA/pull/2087#discussion_r459209464", "bodyText": "AFAICT, there's no planned external use of this, so no need to export.", "author": "edalex-ian", "createdAt": "2020-07-23T04:33:43Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/ModifiedDateSelector.tsx", "diffHunk": "@@ -0,0 +1,251 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  FormControl,\n+  Grid,\n+  InputLabel,\n+  MenuItem,\n+  Select,\n+} from \"@material-ui/core\";\n+import { DatePicker, MuiPickersUtilsProvider } from \"@material-ui/pickers\";\n+import SettingsToggleSwitch from \"../../components/SettingsToggleSwitch\";\n+import { ReactNode } from \"react\";\n+import { languageStrings } from \"../../util/langstrings\";\n+import { MaterialUiPickersDate } from \"@material-ui/pickers/typings/date\";\n+import LuxonUtils from \"@date-io/luxon\";\n+import { DateTime } from \"luxon\";\n+\n+/**\n+ * Type of Last modified date range.\n+ */\n+export interface LastModifiedDateRange {\n+  /**\n+   * The date before which items are modified.\n+   */\n+  modifiedBefore?: Date;\n+  /**\n+   * The date after which items are modified.\n+   */\n+  modifiedAfter?: Date;\n+}\n+\n+export interface ModifiedDateSelectorProps {\n+  /**\n+   * Fired when date range is changed.\n+   * @param dateRange A new date range.\n+   */\n+  onDateRangeChange: (dateRange?: LastModifiedDateRange) => void;\n+  /**\n+   * Fired when the status of Quick mode is changed.\n+   * @param enabled The new status of Quick mode\n+   */\n+  onQuickModeChange: (enabled: boolean) => void;\n+  /**\n+   * Initially selected date range.\n+   */\n+  dateRange?: LastModifiedDateRange;\n+  /**\n+   * Initial status of Quick mode.\n+   */\n+  quickModeEnabled?: boolean;\n+}\n+\n+type DatePickerInputVariant = \"standard\" | \"outlined\" | \"filled\";\n+type DatePickerWrapperVariant = \"dialog\" | \"inline\" | \"static\";\n+\n+/**\n+ * General props for Material ui Date Picker.\n+ *\n+ * @see BaseDatePickerProps\n+ * @see BasePickerProps\n+ */\n+export interface GeneralDatePickerProps {", "originalCommit": "59119d75b63ac97832b60cb59003c5c0730d38d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIwOTkxNQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2087#discussion_r459209915", "bodyText": "I wonder if you've overdone it here. You only ever use one value from each of these, and they wont be used externally, so... \ud83e\udd14", "author": "edalex-ian", "createdAt": "2020-07-23T04:35:58Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/ModifiedDateSelector.tsx", "diffHunk": "@@ -0,0 +1,251 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  FormControl,\n+  Grid,\n+  InputLabel,\n+  MenuItem,\n+  Select,\n+} from \"@material-ui/core\";\n+import { DatePicker, MuiPickersUtilsProvider } from \"@material-ui/pickers\";\n+import SettingsToggleSwitch from \"../../components/SettingsToggleSwitch\";\n+import { ReactNode } from \"react\";\n+import { languageStrings } from \"../../util/langstrings\";\n+import { MaterialUiPickersDate } from \"@material-ui/pickers/typings/date\";\n+import LuxonUtils from \"@date-io/luxon\";\n+import { DateTime } from \"luxon\";\n+\n+/**\n+ * Type of Last modified date range.\n+ */\n+export interface LastModifiedDateRange {\n+  /**\n+   * The date before which items are modified.\n+   */\n+  modifiedBefore?: Date;\n+  /**\n+   * The date after which items are modified.\n+   */\n+  modifiedAfter?: Date;\n+}\n+\n+export interface ModifiedDateSelectorProps {\n+  /**\n+   * Fired when date range is changed.\n+   * @param dateRange A new date range.\n+   */\n+  onDateRangeChange: (dateRange?: LastModifiedDateRange) => void;\n+  /**\n+   * Fired when the status of Quick mode is changed.\n+   * @param enabled The new status of Quick mode\n+   */\n+  onQuickModeChange: (enabled: boolean) => void;\n+  /**\n+   * Initially selected date range.\n+   */\n+  dateRange?: LastModifiedDateRange;\n+  /**\n+   * Initial status of Quick mode.\n+   */\n+  quickModeEnabled?: boolean;\n+}\n+\n+type DatePickerInputVariant = \"standard\" | \"outlined\" | \"filled\";\n+type DatePickerWrapperVariant = \"dialog\" | \"inline\" | \"static\";", "originalCommit": "59119d75b63ac97832b60cb59003c5c0730d38d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIxMDIxMg==", "url": "https://github.com/openequella/openEQUELLA/pull/2087#discussion_r459210212", "bodyText": "I wonder if you even need all this typing. Where you use it you end up doing a one off literal declaration of an object and then never change it. Sure you spread over the props into the element, but if it's got types then that'll check things for you anyway.", "author": "edalex-ian", "createdAt": "2020-07-23T04:37:35Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/ModifiedDateSelector.tsx", "diffHunk": "@@ -0,0 +1,251 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  FormControl,\n+  Grid,\n+  InputLabel,\n+  MenuItem,\n+  Select,\n+} from \"@material-ui/core\";\n+import { DatePicker, MuiPickersUtilsProvider } from \"@material-ui/pickers\";\n+import SettingsToggleSwitch from \"../../components/SettingsToggleSwitch\";\n+import { ReactNode } from \"react\";\n+import { languageStrings } from \"../../util/langstrings\";\n+import { MaterialUiPickersDate } from \"@material-ui/pickers/typings/date\";\n+import LuxonUtils from \"@date-io/luxon\";\n+import { DateTime } from \"luxon\";\n+\n+/**\n+ * Type of Last modified date range.\n+ */\n+export interface LastModifiedDateRange {\n+  /**\n+   * The date before which items are modified.\n+   */\n+  modifiedBefore?: Date;\n+  /**\n+   * The date after which items are modified.\n+   */\n+  modifiedAfter?: Date;\n+}\n+\n+export interface ModifiedDateSelectorProps {\n+  /**\n+   * Fired when date range is changed.\n+   * @param dateRange A new date range.\n+   */\n+  onDateRangeChange: (dateRange?: LastModifiedDateRange) => void;\n+  /**\n+   * Fired when the status of Quick mode is changed.\n+   * @param enabled The new status of Quick mode\n+   */\n+  onQuickModeChange: (enabled: boolean) => void;\n+  /**\n+   * Initially selected date range.\n+   */\n+  dateRange?: LastModifiedDateRange;\n+  /**\n+   * Initial status of Quick mode.\n+   */\n+  quickModeEnabled?: boolean;\n+}\n+\n+type DatePickerInputVariant = \"standard\" | \"outlined\" | \"filled\";\n+type DatePickerWrapperVariant = \"dialog\" | \"inline\" | \"static\";\n+\n+/**\n+ * General props for Material ui Date Picker.\n+ *\n+ * @see BaseDatePickerProps\n+ * @see BasePickerProps\n+ */\n+export interface GeneralDatePickerProps {\n+  disableFuture: boolean;\n+  variant: DatePickerWrapperVariant;\n+  inputVariant: DatePickerInputVariant;\n+  autoOk: boolean;\n+  labelFunc: (value: MaterialUiPickersDate, invalidLabel: string) => string;\n+}", "originalCommit": "59119d75b63ac97832b60cb59003c5c0730d38d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIxMTQ5MA==", "url": "https://github.com/openequella/openEQUELLA/pull/2087#discussion_r459211490", "bodyText": "Would be nice to use meaningful names here, something like:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  (value: DateTime | undefined, key: string) => {\n          \n          \n            \n                  (dt: DateTime | undefined, label: string) => {\n          \n      \n    \n    \n  \n\ndt is not great, but might do. I wonder about optionDateTime, but not sure.", "author": "edalex-ian", "createdAt": "2020-07-23T04:43:54Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/ModifiedDateSelector.tsx", "diffHunk": "@@ -0,0 +1,251 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  FormControl,\n+  Grid,\n+  InputLabel,\n+  MenuItem,\n+  Select,\n+} from \"@material-ui/core\";\n+import { DatePicker, MuiPickersUtilsProvider } from \"@material-ui/pickers\";\n+import SettingsToggleSwitch from \"../../components/SettingsToggleSwitch\";\n+import { ReactNode } from \"react\";\n+import { languageStrings } from \"../../util/langstrings\";\n+import { MaterialUiPickersDate } from \"@material-ui/pickers/typings/date\";\n+import LuxonUtils from \"@date-io/luxon\";\n+import { DateTime } from \"luxon\";\n+\n+/**\n+ * Type of Last modified date range.\n+ */\n+export interface LastModifiedDateRange {\n+  /**\n+   * The date before which items are modified.\n+   */\n+  modifiedBefore?: Date;\n+  /**\n+   * The date after which items are modified.\n+   */\n+  modifiedAfter?: Date;\n+}\n+\n+export interface ModifiedDateSelectorProps {\n+  /**\n+   * Fired when date range is changed.\n+   * @param dateRange A new date range.\n+   */\n+  onDateRangeChange: (dateRange?: LastModifiedDateRange) => void;\n+  /**\n+   * Fired when the status of Quick mode is changed.\n+   * @param enabled The new status of Quick mode\n+   */\n+  onQuickModeChange: (enabled: boolean) => void;\n+  /**\n+   * Initially selected date range.\n+   */\n+  dateRange?: LastModifiedDateRange;\n+  /**\n+   * Initial status of Quick mode.\n+   */\n+  quickModeEnabled?: boolean;\n+}\n+\n+type DatePickerInputVariant = \"standard\" | \"outlined\" | \"filled\";\n+type DatePickerWrapperVariant = \"dialog\" | \"inline\" | \"static\";\n+\n+/**\n+ * General props for Material ui Date Picker.\n+ *\n+ * @see BaseDatePickerProps\n+ * @see BasePickerProps\n+ */\n+export interface GeneralDatePickerProps {\n+  disableFuture: boolean;\n+  variant: DatePickerWrapperVariant;\n+  inputVariant: DatePickerInputVariant;\n+  autoOk: boolean;\n+  labelFunc: (value: MaterialUiPickersDate, invalidLabel: string) => string;\n+}\n+\n+/**\n+ * As a refine control, this component is used to filter search results by last modified dates.\n+ * Depending on what mode is selected, a Quick option Dropdown or two custom date pickers are displayed.\n+ */\n+export const ModifiedDateSelector = ({\n+  onDateRangeChange,\n+  onQuickModeChange,\n+  dateRange,\n+  quickModeEnabled,\n+}: ModifiedDateSelectorProps) => {\n+  const {\n+    quickOptionLabel,\n+    quickOptionSwitchLabel,\n+    modifiedBeforeLabel,\n+    modifiedAfterLabel,\n+    optionsLabel,\n+  } = languageStrings.searchpage.modifiedDateSelector;\n+\n+  const datePickerProps: GeneralDatePickerProps = {\n+    disableFuture: true,\n+    variant: \"inline\",\n+    inputVariant: \"outlined\",\n+    autoOk: true,\n+    labelFunc: (value, invalidLabel) => value?.toLocaleString() ?? invalidLabel,\n+  };\n+\n+  /**\n+   * Return a map in which keys are language strings and values are instances of DateTime or undefined.\n+   */\n+  const getLastModifiedDateOptions = (): Map<string, DateTime | undefined> => {\n+    const { today, lastSevenDays, lastMonth, thisYear, all } = optionsLabel;\n+    const now = DateTime.local();\n+    return new Map([\n+      [today, now],\n+      [lastSevenDays, now.minus({ days: 7 })],\n+      [lastMonth, now.minus({ month: 1 })],\n+      [thisYear, DateTime.local(now.year)],\n+      [all, undefined],\n+    ]);\n+  };\n+\n+  /**\n+   * Convert a quick date option to a date range.\n+   * The value of field 'modifiedAfter' depends on what Quick date option is selected.\n+   * The value of field 'modifiedBefore' is always undefined.\n+   *\n+   * @param option  An option selected from the Quick date options.\n+   */\n+  const dateOptionToDateRangeConverter = (\n+    option: string\n+  ): LastModifiedDateRange => {\n+    const modifiedAfter = getLastModifiedDateOptions().get(option);\n+    return {\n+      modifiedAfter: modifiedAfter?.toJSDate(),\n+      modifiedBefore: undefined,\n+    };\n+  };\n+\n+  /**\n+   * Convert a date range to a Quick date option.\n+   * If the provided date range is undefined, or defined but the value of field modifiedAfter is undefined,\n+   * then return the Quick option \"All\".\n+   * Otherwise, returns the Quick option whose value is equal to modifiedAfter in ISO Date format.\n+   *\n+   * @param dateRange A date range to be converted to a Quick date range\n+   */\n+  const dateRangeToDateOptionConverter = (\n+    dateRange?: LastModifiedDateRange\n+  ): string => {\n+    let option = optionsLabel.all;\n+    if (!dateRange || !dateRange.modifiedAfter) {\n+      return option;\n+    }\n+    const modifiedAfter = DateTime.fromJSDate(dateRange.modifiedAfter);\n+    getLastModifiedDateOptions().forEach(\n+      (value: DateTime | undefined, key: string) => {", "originalCommit": "59119d75b63ac97832b60cb59003c5c0730d38d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIxNDY0Ng==", "url": "https://github.com/openequella/openEQUELLA/pull/2087#discussion_r459214646", "bodyText": "That's a big duplicated block other than value and label. I'd say either create a function, or internal component (i.e. another component in this file), or even something maybe fun like:\nnew Map([\n  [modifiedAfterLabel, dateRange?.modifiedAfter],\n  [modifiedBeforeLabel, dateRange?.modifiedBefore],\n]).forEach((label, value) =>\n  <Grid item>\n    <DatePicker\n      {...datePickerProps}\n        label={label}\n        value={value}\n        onChange={(newDate: MaterialUiPickersDate) =>\n          onDateRangeChange({\n            ...dateRange,\n            modifiedBefore: newDate?.toJSDate(),\n          })\n        }\n    />\n  </Grid>\n);", "author": "edalex-ian", "createdAt": "2020-07-23T04:58:16Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/search/components/ModifiedDateSelector.tsx", "diffHunk": "@@ -0,0 +1,251 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import * as React from \"react\";\n+import {\n+  FormControl,\n+  Grid,\n+  InputLabel,\n+  MenuItem,\n+  Select,\n+} from \"@material-ui/core\";\n+import { DatePicker, MuiPickersUtilsProvider } from \"@material-ui/pickers\";\n+import SettingsToggleSwitch from \"../../components/SettingsToggleSwitch\";\n+import { ReactNode } from \"react\";\n+import { languageStrings } from \"../../util/langstrings\";\n+import { MaterialUiPickersDate } from \"@material-ui/pickers/typings/date\";\n+import LuxonUtils from \"@date-io/luxon\";\n+import { DateTime } from \"luxon\";\n+\n+/**\n+ * Type of Last modified date range.\n+ */\n+export interface LastModifiedDateRange {\n+  /**\n+   * The date before which items are modified.\n+   */\n+  modifiedBefore?: Date;\n+  /**\n+   * The date after which items are modified.\n+   */\n+  modifiedAfter?: Date;\n+}\n+\n+export interface ModifiedDateSelectorProps {\n+  /**\n+   * Fired when date range is changed.\n+   * @param dateRange A new date range.\n+   */\n+  onDateRangeChange: (dateRange?: LastModifiedDateRange) => void;\n+  /**\n+   * Fired when the status of Quick mode is changed.\n+   * @param enabled The new status of Quick mode\n+   */\n+  onQuickModeChange: (enabled: boolean) => void;\n+  /**\n+   * Initially selected date range.\n+   */\n+  dateRange?: LastModifiedDateRange;\n+  /**\n+   * Initial status of Quick mode.\n+   */\n+  quickModeEnabled?: boolean;\n+}\n+\n+type DatePickerInputVariant = \"standard\" | \"outlined\" | \"filled\";\n+type DatePickerWrapperVariant = \"dialog\" | \"inline\" | \"static\";\n+\n+/**\n+ * General props for Material ui Date Picker.\n+ *\n+ * @see BaseDatePickerProps\n+ * @see BasePickerProps\n+ */\n+export interface GeneralDatePickerProps {\n+  disableFuture: boolean;\n+  variant: DatePickerWrapperVariant;\n+  inputVariant: DatePickerInputVariant;\n+  autoOk: boolean;\n+  labelFunc: (value: MaterialUiPickersDate, invalidLabel: string) => string;\n+}\n+\n+/**\n+ * As a refine control, this component is used to filter search results by last modified dates.\n+ * Depending on what mode is selected, a Quick option Dropdown or two custom date pickers are displayed.\n+ */\n+export const ModifiedDateSelector = ({\n+  onDateRangeChange,\n+  onQuickModeChange,\n+  dateRange,\n+  quickModeEnabled,\n+}: ModifiedDateSelectorProps) => {\n+  const {\n+    quickOptionLabel,\n+    quickOptionSwitchLabel,\n+    modifiedBeforeLabel,\n+    modifiedAfterLabel,\n+    optionsLabel,\n+  } = languageStrings.searchpage.modifiedDateSelector;\n+\n+  const datePickerProps: GeneralDatePickerProps = {\n+    disableFuture: true,\n+    variant: \"inline\",\n+    inputVariant: \"outlined\",\n+    autoOk: true,\n+    labelFunc: (value, invalidLabel) => value?.toLocaleString() ?? invalidLabel,\n+  };\n+\n+  /**\n+   * Return a map in which keys are language strings and values are instances of DateTime or undefined.\n+   */\n+  const getLastModifiedDateOptions = (): Map<string, DateTime | undefined> => {\n+    const { today, lastSevenDays, lastMonth, thisYear, all } = optionsLabel;\n+    const now = DateTime.local();\n+    return new Map([\n+      [today, now],\n+      [lastSevenDays, now.minus({ days: 7 })],\n+      [lastMonth, now.minus({ month: 1 })],\n+      [thisYear, DateTime.local(now.year)],\n+      [all, undefined],\n+    ]);\n+  };\n+\n+  /**\n+   * Convert a quick date option to a date range.\n+   * The value of field 'modifiedAfter' depends on what Quick date option is selected.\n+   * The value of field 'modifiedBefore' is always undefined.\n+   *\n+   * @param option  An option selected from the Quick date options.\n+   */\n+  const dateOptionToDateRangeConverter = (\n+    option: string\n+  ): LastModifiedDateRange => {\n+    const modifiedAfter = getLastModifiedDateOptions().get(option);\n+    return {\n+      modifiedAfter: modifiedAfter?.toJSDate(),\n+      modifiedBefore: undefined,\n+    };\n+  };\n+\n+  /**\n+   * Convert a date range to a Quick date option.\n+   * If the provided date range is undefined, or defined but the value of field modifiedAfter is undefined,\n+   * then return the Quick option \"All\".\n+   * Otherwise, returns the Quick option whose value is equal to modifiedAfter in ISO Date format.\n+   *\n+   * @param dateRange A date range to be converted to a Quick date range\n+   */\n+  const dateRangeToDateOptionConverter = (\n+    dateRange?: LastModifiedDateRange\n+  ): string => {\n+    let option = optionsLabel.all;\n+    if (!dateRange || !dateRange.modifiedAfter) {\n+      return option;\n+    }\n+    const modifiedAfter = DateTime.fromJSDate(dateRange.modifiedAfter);\n+    getLastModifiedDateOptions().forEach(\n+      (value: DateTime | undefined, key: string) => {\n+        if (value && value.toISODate() === modifiedAfter.toISODate()) {\n+          option = key;\n+        }\n+      }\n+    );\n+\n+    return option;\n+  };\n+\n+  /**\n+   * Fired when a different Quick option is selected.\n+   * @param option A Quick option.\n+   */\n+  const handleQuickDateOptionChange = (option: string): void => {\n+    const dateRange = dateOptionToDateRangeConverter(option);\n+    onDateRangeChange(dateRange);\n+  };\n+\n+  const quickOptionSelector: ReactNode = (\n+    <FormControl variant=\"outlined\" fullWidth>\n+      <InputLabel id=\"modified_date_range_selector_label\">\n+        {quickOptionLabel}\n+      </InputLabel>\n+      <Select\n+        value={dateRangeToDateOptionConverter(dateRange)}\n+        id=\"modified_date_range_selector\"\n+        labelId=\"modified_date_range_selector_label\"\n+        onChange={(event) =>\n+          handleQuickDateOptionChange(event.target.value as string)\n+        }\n+        label={quickOptionLabel}\n+      >\n+        {Array.from(getLastModifiedDateOptions()).map(([option, _]) => (\n+          <MenuItem key={option} value={option}>\n+            {option}\n+          </MenuItem>\n+        ))}\n+      </Select>\n+    </FormControl>\n+  );\n+\n+  const customDatePicker: ReactNode = (\n+    <MuiPickersUtilsProvider utils={LuxonUtils}>\n+      <Grid container spacing={2}>\n+        <Grid item>\n+          <DatePicker\n+            {...datePickerProps}\n+            label={modifiedAfterLabel}\n+            value={dateRange?.modifiedAfter}\n+            onChange={(newDate: MaterialUiPickersDate) =>\n+              onDateRangeChange({\n+                ...dateRange,\n+                modifiedAfter: newDate?.toJSDate(),\n+              })\n+            }\n+          />\n+        </Grid>\n+        <Grid item>\n+          <DatePicker\n+            {...datePickerProps}\n+            label={modifiedBeforeLabel}\n+            value={dateRange?.modifiedBefore}\n+            onChange={(newDate: MaterialUiPickersDate) =>\n+              onDateRangeChange({\n+                ...dateRange,\n+                modifiedBefore: newDate?.toJSDate(),\n+              })\n+            }\n+          />\n+        </Grid>", "originalCommit": "59119d75b63ac97832b60cb59003c5c0730d38d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1245e02eb008b1cc97d0aa076ead4b88828e2ca9", "url": "https://github.com/openequella/openEQUELLA/commit/1245e02eb008b1cc97d0aa076ead4b88828e2ca9", "message": "Make the date range selector generic\n\n1. Rename the component and relevant interfaces and functions.\n2. Add three props to allow custom labels for the pickers and Dropdown.\n3. Move the component to 'tsrc/components'.\n4. Remove some duplicated and useless code.", "committedDate": "2020-07-24T01:15:40Z", "type": "commit"}, {"oid": "77f720663df2231550552dd89bd901ab2056d90d", "url": "https://github.com/openequella/openEQUELLA/commit/77f720663df2231550552dd89bd901ab2056d90d", "message": "Rename DateRangeSelector's storybook.", "committedDate": "2020-07-24T01:57:02Z", "type": "commit"}]}