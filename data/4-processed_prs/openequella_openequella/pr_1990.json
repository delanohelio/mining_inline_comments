{"pr_number": 1990, "pr_title": "Refactor Theme Editor page to use the new standard SettingsPageTemplate", "pr_createdAt": "2020-07-02T02:40:54Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/1990", "timeline": [{"oid": "e641996b21a89e2aab8a3652f0588db7413023c1", "url": "https://github.com/openequella/openEQUELLA/commit/e641996b21a89e2aab8a3652f0588db7413023c1", "message": "Convert ColorPickerComponent to functional component\n\nAlso included some minor changes in how it works, to better utilise two way binding.\n\nPaves the way for further rework.", "committedDate": "2020-07-02T02:04:46Z", "type": "commit"}, {"oid": "1225404052745303428e36eee9caa159f54bdcc2", "url": "https://github.com/openequella/openEQUELLA/commit/1225404052745303428e36eee9caa159f54bdcc2", "message": "Convert ColorPickerComponent to Dialog based\n\nThe old setup had a couple of issues when attempting to refactor the theme settings page (the one place it's used) to the SettingsPageTemplate.", "committedDate": "2020-07-02T02:04:46Z", "type": "commit"}, {"oid": "cfb3a3067f1a4725146936d3c18192f864f5b5f5", "url": "https://github.com/openequella/openEQUELLA/commit/cfb3a3067f1a4725146936d3c18192f864f5b5f5", "message": "Refactor ThemePage to use SettingPageTemplate\n\nSo as to ensure a consistent user experience with all the other new settings pages.", "committedDate": "2020-07-02T02:04:46Z", "type": "commit"}, {"oid": "f4fe9bdfbeb5e2729151923fd48634e1bd58e3ae", "url": "https://github.com/openequella/openEQUELLA/commit/f4fe9bdfbeb5e2729151923fd48634e1bd58e3ae", "message": "Modify SettingsList to have a more dominant heading\n\nThe other heading was rather subtle and often lost in the background.", "committedDate": "2020-07-02T02:04:46Z", "type": "commit"}, {"oid": "ff8ca0b85d4aaf09c426830083cd6c92ae128afc", "url": "https://github.com/openequella/openEQUELLA/commit/ff8ca0b85d4aaf09c426830083cd6c92ae128afc", "message": "Add back navigation to ThemePage\n\nFor consistency with other new ui settings pages, and ease of use.", "committedDate": "2020-07-02T02:04:46Z", "type": "commit"}, {"oid": "0a4e7b2490ab8e2f4ea937539b2a425bbb5a7278", "url": "https://github.com/openequella/openEQUELLA/commit/0a4e7b2490ab8e2f4ea937539b2a425bbb5a7278", "message": "Split out the SettingsList heading component\n\nThis then facilitates a more fool proof way when other settings areas doing their own content.", "committedDate": "2020-07-02T02:04:46Z", "type": "commit"}, {"oid": "4dd3877f4270a56d30ec088c3f7bf998e30d173f", "url": "https://github.com/openequella/openEQUELLA/commit/4dd3877f4270a56d30ec088c3f7bf998e30d173f", "message": "Refactor settings pages to use SettingsListHeading\n\nSo as to ensure consistency.", "committedDate": "2020-07-02T02:04:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODczNzc1Ng==", "url": "https://github.com/openequella/openEQUELLA/pull/1990#discussion_r448737756", "bodyText": "If all color settings are already default and I press the reset button again, will the Save button become enabled and allow me to submit?", "author": "PenghaiZhang", "createdAt": "2020-07-02T04:10:55Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/theme/ThemePage.tsx", "diffHunk": "@@ -122,6 +130,7 @@ class ThemePage extends React.Component<\n         menuIcon: \"#000000\",\n         primaryText: \"#000000\",\n         secondaryText: \"#444444\",\n+        changesUnsaved: true,", "originalCommit": "4dd3877f4270a56d30ec088c3f7bf998e30d173f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc0OTAyNA==", "url": "https://github.com/openequella/openEQUELLA/pull/1990#discussion_r448749024", "bodyText": "Yup, it will. It's very simple.\nArguably it could have some more smarts in there. However there's no real harm as a result, and for that kind of stuff I've tried to keep the logic pretty well the same.\nIndeed, the logo reset was designed to reload when pushing the button, and I've left that as is for now. But in the future, we may want to come back and refactor that side of things.", "author": "edalex-ian", "createdAt": "2020-07-02T04:57:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODczNzc1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc0MTUxOQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1990#discussion_r448741519", "bodyText": "I like this try...catch block because it makes this function easy to read. Only when the two promises get resolved,  the state is updated.", "author": "PenghaiZhang", "createdAt": "2020-07-02T04:27:13Z", "path": "Source/Plugins/Core/com.equella.core/js/tsrc/theme/ThemePage.tsx", "diffHunk": "@@ -184,58 +168,52 @@ class ThemePage extends React.Component<\n         this.setState({\n           logoToUpload: file,\n           fileName: file.name,\n+          changesUnsaved: true,\n         });\n       };\n     }\n   };\n \n-  submitTheme = () => {\n-    axios\n-      .put(`${API_BASE_URL}/theme/settings/`, {\n-        primaryColor: this.state.primary,\n-        secondaryColor: this.state.secondary,\n-        backgroundColor: this.state.background,\n-        menuItemColor: this.state.menu,\n-        menuItemIconColor: this.state.menuIcon,\n-        menuItemTextColor: this.state.menuText,\n-        primaryTextColor: this.state.primaryText,\n-        menuTextColor: this.state.secondaryText,\n-        fontSize: 14,\n-      })\n-      .then(() => {\n-        this.reload();\n-      })\n-      .catch((error) => {\n-        this.handleError(error);\n-      });\n-  };\n+  submitTheme = () =>\n+    axios.put(`${API_BASE_URL}/theme/settings/`, {\n+      primaryColor: this.state.primary,\n+      secondaryColor: this.state.secondary,\n+      backgroundColor: this.state.background,\n+      menuItemColor: this.state.menu,\n+      menuItemIconColor: this.state.menuIcon,\n+      menuItemTextColor: this.state.menuText,\n+      primaryTextColor: this.state.primaryText,\n+      menuTextColor: this.state.secondaryText,\n+      fontSize: 14,\n+    });\n+\n+  submitLogo = () =>\n+    this.state.logoToUpload &&\n+    axios.put(`${API_BASE_URL}/theme/logo/`, this.state.logoToUpload);\n+\n+  async saveChanges() {\n+    try {\n+      await this.submitLogo();\n+      await this.submitTheme();\n+      this.setState({ changesUnsaved: false, showSuccess: true });", "originalCommit": "4dd3877f4270a56d30ec088c3f7bf998e30d173f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc0NzY2Mw==", "url": "https://github.com/openequella/openEQUELLA/pull/1990#discussion_r448747663", "bodyText": "Yeah, the async function syntax is definitely a big win for readability.", "author": "edalex-ian", "createdAt": "2020-07-02T04:52:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc0MTUxOQ=="}], "type": "inlineReview"}]}