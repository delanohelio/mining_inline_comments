{"pr_number": 7290, "pr_title": "CB-5548 Sdx status checker won't move cluster from REPAIR_FAILED state", "pr_createdAt": "2020-02-14T14:22:20Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/7290", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA4MjUyMg==", "url": "https://github.com/hortonworks/cloudbreak/pull/7290#discussion_r380082522", "bodyText": "SDX_REPAIR_FINISHED message can be a little bit misleading as if it's not coming from repair failed", "author": "lacikaaa", "createdAt": "2020-02-17T09:55:44Z", "path": "datalake/src/main/java/com/sequenceiq/datalake/job/SdxClusterStatusCheckerJob.java", "diffHunk": "@@ -66,35 +77,44 @@ private void handleAmbiguousSdx(StackStatusV4Response stack, SdxCluster sdx) {\n \n     private void handleStoppedSdx(StackStatusV4Response stack, SdxCluster sdx) {\n         if (stack.getStatus().isAvailable() && stack.getClusterStatus().isAvailable()) {\n-            sdxStatusService.setStatusForDatalakeAndNotify(DatalakeStatusEnum.RUNNING, ResourceEvent.SDX_STOP_FINISHED, \"\", sdx);\n+            sdxStatusService.setStatusForDatalakeAndNotify(DatalakeStatusEnum.RUNNING, ResourceEvent.SDX_START_FINISHED, \"\", sdx);\n             logStateChange(DatalakeStatusEnum.STOPPED, DatalakeStatusEnum.RUNNING);\n         }\n-        if (stack.getStatus().equals(Status.DELETE_COMPLETED)) {\n-            sdxStatusService.setStatusForDatalakeAndNotify(DatalakeStatusEnum.STACK_DELETED, ResourceEvent.SDX_CLUSTER_DELETION_FINISHED, \"\", sdx);\n-            jobService.unschedule(String.valueOf(sdx.getId()));\n-            logStateChange(DatalakeStatusEnum.RUNNING, DatalakeStatusEnum.STACK_DELETED);\n+        setDeleteCompleted(stack, sdx);\n+        setDeleteFailed(stack, sdx);\n+    }\n+\n+    private void handleFailedSdx(StackStatusV4Response stack, SdxCluster sdx) {\n+        if (stack.getStatus().isAvailable() && stack.getClusterStatus().isAvailable()) {\n+            sdxStatusService.setStatusForDatalakeAndNotify(DatalakeStatusEnum.RUNNING, ResourceEvent.SDX_REPAIR_FINISHED, \"\", sdx);", "originalCommit": "6c4aaab9a3ff81e08df55c24d8a62b409cc6b390", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1141ec225cde1691076a4888c227450413f2390e", "url": "https://github.com/hortonworks/cloudbreak/commit/1141ec225cde1691076a4888c227450413f2390e", "message": "CB-5548 Sdx status checker won't move cluster from REPAIR_FAILED state", "committedDate": "2020-02-17T10:37:20Z", "type": "commit"}, {"oid": "1141ec225cde1691076a4888c227450413f2390e", "url": "https://github.com/hortonworks/cloudbreak/commit/1141ec225cde1691076a4888c227450413f2390e", "message": "CB-5548 Sdx status checker won't move cluster from REPAIR_FAILED state", "committedDate": "2020-02-17T10:37:20Z", "type": "forcePushed"}]}