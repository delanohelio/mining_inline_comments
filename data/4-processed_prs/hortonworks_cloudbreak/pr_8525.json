{"pr_number": 8525, "pr_title": "DISTX-478-Introduce Config Change History Event", "pr_createdAt": "2020-07-09T12:01:17Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8525", "timeline": [{"oid": "f37d50f941ba025dbcbb6504de99c54c7e142494", "url": "https://github.com/hortonworks/cloudbreak/commit/f37d50f941ba025dbcbb6504de99c54c7e142494", "message": "DISTX-478-Introduce Config Change History Event\n\nIntroduce history event for Cluster Autoscale Config Change.", "committedDate": "2020-07-10T11:27:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ0MzgzOA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8525#discussion_r452443838", "bodyText": "Can we add more details here? i.e. Switched from load based to schedule, etc etc?\nNext question would be whether autoscaling events go in the regular Activity tab or a separate tab altogether. Also - this will get very noisy while the UI updates configs on each change. That may not matter since this is not displayed on the UI at the moment?", "author": "sidseth", "createdAt": "2020-07-09T19:32:49Z", "path": "autoscale/src/main/java/com/sequenceiq/periscope/controller/DistroXAutoScaleClusterV1Controller.java", "diffHunk": "@@ -119,10 +129,18 @@ private DistroXAutoscaleClusterResponse updateClusterAutoScaleConfig(Long cluste\n                 alertController.createTimeAlerts(clusterId, autoscaleClusterRequest.getTimeAlertRequests());\n                 asClusterCommonService.setAutoscaleState(clusterId, autoscaleClusterRequest.getEnableAutoscaling());\n             });\n+            createHistoryAndNotifyConfigChange(clusterId);\n         } catch (TransactionService.TransactionExecutionException e) {\n             throw e.getCause();\n         }\n \n         return createClusterJsonResponse(clusterService.findById(clusterId));\n     }\n+\n+    private void createHistoryAndNotifyConfigChange(long clusterId) {\n+        Cluster cluster = clusterService.findById(clusterId);\n+        History history = historyService.createEntry(ScalingStatus.CONFIG_UPDATED,\n+                \"Autoscaling config has been updated for the cluster.\", cluster);\n+        notificationSender.send(cluster, history);", "originalCommit": "28263e9d229d637694bd4f92c66d2b1b7d27a541", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIzNTI1Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8525#discussion_r454235257", "bodyText": "Updated to include HostGroup and ScalingType in the historyEvent for CONFIG_UPDATED.  This is a valid history event along with Enabling\\Disabling Autoscaling and would be required in case of support issues and to avoid customer confusion as to current Autoscaling Config.\nThere is little noise because UI updates on each change basically for Load-Based Autoscaling, specific event CONFIG_UPDATED can be filtered out while showing in UI if it becomes too noisy.", "author": "smaniraju", "createdAt": "2020-07-14T09:44:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ0MzgzOA=="}], "type": "inlineReview"}, {"oid": "b2065a2832b3dac1a8d19aa3cde0d48be664ce28", "url": "https://github.com/hortonworks/cloudbreak/commit/b2065a2832b3dac1a8d19aa3cde0d48be664ce28", "message": "DISTX-478-Introduce Config Change History Event\n\nIntroduce History Event for Cluster Autoscale Config Change.\nIntroduce History Event for Schedule-Based Autoscaling.\nAdditonal Validations for Autoscaling Requests.", "committedDate": "2020-07-14T09:38:36Z", "type": "forcePushed"}, {"oid": "f55447ff030cb540bac2ee260f2009595b07adab", "url": "https://github.com/hortonworks/cloudbreak/commit/f55447ff030cb540bac2ee260f2009595b07adab", "message": "DISTX-478-Introduce Config Change History Event\n\nIntroduce History Event for Cluster Autoscale Config Change.\nIntroduce History Event for Schedule-Based Autoscaling.\nAdditonal Validations for Autoscaling Requests.", "committedDate": "2020-07-14T11:56:12Z", "type": "commit"}, {"oid": "f55447ff030cb540bac2ee260f2009595b07adab", "url": "https://github.com/hortonworks/cloudbreak/commit/f55447ff030cb540bac2ee260f2009595b07adab", "message": "DISTX-478-Introduce Config Change History Event\n\nIntroduce History Event for Cluster Autoscale Config Change.\nIntroduce History Event for Schedule-Based Autoscaling.\nAdditonal Validations for Autoscaling Requests.", "committedDate": "2020-07-14T11:56:12Z", "type": "forcePushed"}]}