{"pr_number": 8686, "pr_title": "CB-8207: Add --region flag to aws s3 cp command for datalake backup/restore", "pr_createdAt": "2020-07-31T18:31:31Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8686", "timeline": [{"oid": "281cf6074eb338b5749ad0e45b41a3ba7e846034", "url": "https://github.com/hortonworks/cloudbreak/commit/281cf6074eb338b5749ad0e45b41a3ba7e846034", "message": "Add --region flag to aws s3 cp command in backup scripts.\n\nAdd region option to aws restore.", "committedDate": "2020-07-31T18:40:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc5MDA4MA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8686#discussion_r463790080", "bodyText": "When/where is this actually filled in with the region, if applicable?", "author": "hreeve-cloudera", "createdAt": "2020-07-31T19:24:54Z", "path": "orchestrator-salt/src/main/resources/salt/pillar/postgresql/disaster_recovery.sls", "diffHunk": "@@ -1,3 +1,4 @@\n disaster_recovery:\n   object_storage_url:\n+  aws_region: '' # empty string to prevent salt from passing the literal 'None'", "originalCommit": "281cf6074eb338b5749ad0e45b41a3ba7e846034", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzkwMzYwNA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8686#discussion_r463903604", "bodyText": "you are defining a new pillar for this, right. Where is the application change that passes this information?", "author": "kkalvagadda1", "createdAt": "2020-08-01T01:29:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc5MDA4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQzNzc4Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8686#discussion_r464437787", "bodyText": "y'all are correct. I had originally written the issue to just include the salt script changes, but obviously we need a way to provide the region value.\nI'm investigating how to determine the appropriate region and add it to the pillar.", "author": "brycederriso", "createdAt": "2020-08-03T14:09:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc5MDA4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQ5NjczMQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8686#discussion_r464496731", "bodyText": "I've pushed updated changes to the salt pillar config.", "author": "brycederriso", "createdAt": "2020-08-03T15:42:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc5MDA4MA=="}], "type": "inlineReview"}, {"oid": "39c7ddca4ba46d78030d753af2055018ad44fa1a", "url": "https://github.com/hortonworks/cloudbreak/commit/39c7ddca4ba46d78030d753af2055018ad44fa1a", "message": "Use stack to derive region value for salt pillar config.", "committedDate": "2020-08-03T15:40:48Z", "type": "forcePushed"}, {"oid": "6fd16e84b2a66bb2905bbbf7128b06bbe064301f", "url": "https://github.com/hortonworks/cloudbreak/commit/6fd16e84b2a66bb2905bbbf7128b06bbe064301f", "message": "Remove unused imports.", "committedDate": "2020-08-04T13:37:10Z", "type": "forcePushed"}, {"oid": "c9fdb7c3714d44f0e009ce85018b630a38454b1d", "url": "https://github.com/hortonworks/cloudbreak/commit/c9fdb7c3714d44f0e009ce85018b630a38454b1d", "message": "Add --region flag to aws s3 cp command in backup scripts.\n\nAdd region option to aws restore.\n\nPass stack object into createSaltConfig.\n\nUse stack to derive region value for salt pillar config.\n\nRemove unused imports.\n\nFix checkstyle and spotbugs errors", "committedDate": "2020-08-04T14:12:03Z", "type": "commit"}, {"oid": "c9fdb7c3714d44f0e009ce85018b630a38454b1d", "url": "https://github.com/hortonworks/cloudbreak/commit/c9fdb7c3714d44f0e009ce85018b630a38454b1d", "message": "Add --region flag to aws s3 cp command in backup scripts.\n\nAdd region option to aws restore.\n\nPass stack object into createSaltConfig.\n\nUse stack to derive region value for salt pillar config.\n\nRemove unused imports.\n\nFix checkstyle and spotbugs errors", "committedDate": "2020-08-04T14:12:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUwMzU2Mg==", "url": "https://github.com/hortonworks/cloudbreak/pull/8686#discussion_r465503562", "bodyText": "This doesn't need to be public, others visibility can be lowered also to package level.", "author": "keyki", "createdAt": "2020-08-05T06:34:17Z", "path": "core/src/main/java/com/sequenceiq/cloudbreak/reactor/handler/cluster/dr/BackupRestoreSaltConfigGenerator.java", "diffHunk": "@@ -17,17 +18,31 @@\n \n @Component\n public class BackupRestoreSaltConfigGenerator {\n+    // these values are tightly coupled to the `postgresql/disaster_recovery.sls` salt pillar in `orchestrator-salt`\n+    public static final String POSTGRESQL_DISASTER_RECOVERY_PILLAR_PATH = \"/postgresql/disaster_recovery.sls\";", "originalCommit": "c9fdb7c3714d44f0e009ce85018b630a38454b1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUxNDE3Ng==", "url": "https://github.com/hortonworks/cloudbreak/pull/8686#discussion_r465514176", "bodyText": "I'm merging the PR. We can address this later.", "author": "keyki", "createdAt": "2020-08-05T06:59:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUwMzU2Mg=="}], "type": "inlineReview"}]}