{"pr_number": 9440, "pr_title": "CB-9783 update SDX HA to final shape.", "pr_createdAt": "2020-11-16T18:25:00Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/9440", "timeline": [{"oid": "1d75f46bbcd796efe27e9a98822c6514fc2df1f7", "url": "https://github.com/hortonworks/cloudbreak/commit/1d75f46bbcd796efe27e9a98822c6514fc2df1f7", "message": "CB-9783 update SDX HA to final shape.\n\nFor 7.2.7+, SDX HA now has 2 gateway nodes and additional 3 core node that primarily\nruns Hadoop services that are dependencies of other groups.  As a result there is\nreshuffling of where services are installed.  This also includes renaming master\nto main.", "committedDate": "2020-11-16T20:21:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY2MTM0MQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/9440#discussion_r524661341", "bodyText": "We have \"core\" of \"CORE\" type and \"main\"/\"auxiliary\" of \"CORE\" type. Very confusing :)", "author": "kmanamcheri", "createdAt": "2020-11-16T22:10:28Z", "path": "datalake/src/main/resources/duties/7.2.7/aws/medium_duty_ha.json", "diffHunk": "@@ -44,7 +84,7 @@\n         }\n       },\n       \"nodeCount\": 1,\n-      \"type\": \"GATEWAY\",\n+      \"type\": \"CORE\",", "originalCommit": "1d75f46bbcd796efe27e9a98822c6514fc2df1f7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM3MDA0Mg==", "url": "https://github.com/hortonworks/cloudbreak/pull/9440#discussion_r525370042", "bodyText": "Well, we started with gateway as gateway.  Might as well continue the confusion.", "author": "frozenwizard", "createdAt": "2020-11-17T17:56:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY2MTM0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA0NDQyMA==", "url": "https://github.com/hortonworks/cloudbreak/pull/9440#discussion_r525044420", "bodyText": "unclean.leader.election.enable defaults to false - you might not need to specify this parameter explicitly.\nYou can also consider omitting the config override for all the configs that now are set to the default values. Explicitly setting these is also perfectly fine.", "author": "gergowilder", "createdAt": "2020-11-17T10:25:40Z", "path": "core/src/main/resources/defaults/blueprints/7.2.7/cdp-sdx-medium-ha.bp", "diffHunk": "@@ -361,39 +377,39 @@\n           },\n           {\n             \"name\": \"default.replication.factor\",\n-            \"value\": \"2\"\n+            \"value\": \"3\"\n           },\n           {\n             \"name\": \"offsets.topic.replication.factor\",\n-            \"value\": \"2\"\n+            \"value\": \"3\"\n           },\n           {\n             \"name\": \"transaction.state.log.replication.factor\",\n-            \"value\": \"2\"\n+            \"value\": \"3\"\n           },\n           {\n             \"name\": \"offset.storage.replication.factor\",\n-            \"value\": \"2\"\n+            \"value\": \"3\"\n           },\n           {\n             \"name\": \"config.storage.replication.factor\",\n-            \"value\": \"2\"\n+            \"value\": \"3\"\n           },\n           {\n             \"name\": \"status.storage.replication.factor\",\n-            \"value\": \"2\"\n+            \"value\": \"3\"\n           },\n           {\n             \"name\": \"transaction.state.log.min.isr\",\n-            \"value\": \"1\"\n+            \"value\": \"2\"\n           },\n           {\n             \"name\": \"min.insync.replicas\",\n-            \"value\": \"1\"\n+            \"value\": \"2\"\n           },\n           {\n             \"name\": \"unclean.leader.election.enable\",", "originalCommit": "1d75f46bbcd796efe27e9a98822c6514fc2df1f7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM3MjM3Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/9440#discussion_r525372377", "bodyText": "Ok.", "author": "frozenwizard", "createdAt": "2020-11-17T18:00:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA0NDQyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU0MDMzMA==", "url": "https://github.com/hortonworks/cloudbreak/pull/9440#discussion_r525540330", "bodyText": "I removed them but default.replication.factor and min.insync.replicas weren't being set to the right value, so i've set it to default.replication.factor=3 and min.insync.replicas=2.", "author": "frozenwizard", "createdAt": "2020-11-17T21:36:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA0NDQyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIwMTgwMA==", "url": "https://github.com/hortonworks/cloudbreak/pull/9440#discussion_r526201800", "bodyText": "LGTM now.", "author": "gergowilder", "createdAt": "2020-11-18T15:57:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA0NDQyMA=="}], "type": "inlineReview"}, {"oid": "a72f3c66ab2b500fd8b987a8831ce43482541c96", "url": "https://github.com/hortonworks/cloudbreak/commit/a72f3c66ab2b500fd8b987a8831ce43482541c96", "message": "CB-9783 update SDX HA to final shape.\n\nFor 7.2.7+, SDX HA now has 2 gateway nodes and additional 3 core node that primarily\nruns Hadoop services that are dependencies of other groups.  As a result there is\nreshuffling of where services are installed.  This also includes renaming master\nto main.", "committedDate": "2020-11-17T21:32:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU4OTk2Mg==", "url": "https://github.com/hortonworks/cloudbreak/pull/9440#discussion_r525589962", "bodyText": "Hmm.. Didn't think about this.. Did you run a search-all on all code for the string \"master\". Hopefully this doesn't break things arbitrarily.", "author": "kmanamcheri", "createdAt": "2020-11-17T23:19:21Z", "path": "template-manager-cmtemplate/src/main/java/com/sequenceiq/cloudbreak/cmtemplate/configproviders/raz/RangerRazBaseConfigProvider.java", "diffHunk": "@@ -30,7 +30,7 @@\n             Set<HostgroupView> hostgroupViews = source.getHostgroupViews();\n \n             return hostgroupViews.stream()\n-                    .filter(hg -> hg.getName().toLowerCase().equals(\"master\"))\n+                    .filter(hg -> hg.getName().toLowerCase().equals(\"master\") || hg.getName().toLowerCase().equals(\"main\"))", "originalCommit": "a72f3c66ab2b500fd8b987a8831ce43482541c96", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE5NTcwNw==", "url": "https://github.com/hortonworks/cloudbreak/pull/9440#discussion_r526195707", "bodyText": "It deploys fine.  But I'll look further into if anything uses that name.", "author": "frozenwizard", "createdAt": "2020-11-18T15:51:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU4OTk2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE5NzMwOA==", "url": "https://github.com/hortonworks/cloudbreak/pull/9440#discussion_r526197308", "bodyText": "There's 3196 occurrences of \"master\" in CB.", "author": "frozenwizard", "createdAt": "2020-11-18T15:53:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU4OTk2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIwMTI4NA==", "url": "https://github.com/hortonworks/cloudbreak/pull/9440#discussion_r526201284", "bodyText": "There's 3196 occurrences of \"master\" in CB.\n\n:/\nI am wondering if we should split this into two tasks\n\nChanging the shape\nChanging the name \"master\" to \"main\"\n\nThat way, if something does cause an issue with hardcoded string \"master\", we can look into that separately and we would not need to rollback the whole shape change if it comes down to that. What do you think?", "author": "kmanamcheri", "createdAt": "2020-11-18T15:56:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU4OTk2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIwODgyOQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/9440#discussion_r526208829", "bodyText": "I'm going to do the rename of master->main in another commit so if we have to change it back, we can just revert that commit instead of the whole commit.  There's a bunch of user text and integration tests that use the name master.  Maybe we should just name gateway master (since it runs CM anyway).", "author": "frozenwizard", "createdAt": "2020-11-18T16:05:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU4OTk2Mg=="}], "type": "inlineReview"}, {"oid": "d169aae503e697e9198c3d38ba5ceb11696c56c2", "url": "https://github.com/hortonworks/cloudbreak/commit/d169aae503e697e9198c3d38ba5ceb11696c56c2", "message": "CB-9783 update SDX HA to final shape.\n\nFor 7.2.7+, SDX HA now has 2 gateway nodes and additional 3 core node that primarily\nruns Hadoop services that are dependencies of other groups.  As a result there is\nreshuffling of where services are installed.", "committedDate": "2020-11-18T17:27:39Z", "type": "commit"}, {"oid": "d169aae503e697e9198c3d38ba5ceb11696c56c2", "url": "https://github.com/hortonworks/cloudbreak/commit/d169aae503e697e9198c3d38ba5ceb11696c56c2", "message": "CB-9783 update SDX HA to final shape.\n\nFor 7.2.7+, SDX HA now has 2 gateway nodes and additional 3 core node that primarily\nruns Hadoop services that are dependencies of other groups.  As a result there is\nreshuffling of where services are installed.", "committedDate": "2020-11-18T17:27:39Z", "type": "forcePushed"}]}