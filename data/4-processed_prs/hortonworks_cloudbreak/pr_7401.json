{"pr_number": 7401, "pr_title": "DISTX-397 Create data engineering HA template", "pr_createdAt": "2020-02-27T07:49:29Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/7401", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAyOTk2MA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7401#discussion_r385029960", "bodyText": "This is probably a typo as the other instancegroups have just an empty object here: \"azure\": {},. The current content has unbalanced braces, so it should be fixed either way.", "author": "lajosrodek", "createdAt": "2020-02-27T10:12:34Z", "path": "core/src/main/resources/defaults/clustertemplates/azure/azure-dataengineering-ha-710.json", "diffHunk": "@@ -0,0 +1,177 @@\n+{\n+  \"name\": \"7.1.0 - Data Engineering HA for Azure\",\n+  \"description\": \"\",\n+  \"type\": \"DATAENGINEERING\",\n+  \"featureState\": \"PREVIEW\",\n+  \"cloudPlatform\": \"AZURE\",\n+  \"distroXTemplate\": {\n+    \"cluster\": {\n+      \"blueprintName\": \"7.1.0 - Data Engineering: HA: Apache Spark, Apache Hive, Apache Oozie\"\n+    },\n+    \"instanceGroups\": [\n+      {\n+        \"nodeCount\": 3,\n+        \"name\": \"quorum\",\n+        \"type\": \"CORE\",\n+        \"azure\": {},\n+        \"recoveryMode\": \"MANUAL\",\n+        \"template\": {\n+          \"azure\": {\n+            \"encrypted\": false,\n+            \"managedDisk\": true\n+          },\n+          \"instanceType\": \"Standard_D8_v3\",\n+          \"rootVolume\": {\n+            \"size\": 50\n+          },\n+          \"attachedVolumes\": [\n+            {\n+              \"size\": 100,\n+              \"count\": 1,\n+              \"type\": \"StandardSSD_LRS\"\n+            }\n+          ],\n+          \"cloudPlatform\": \"AZURE\"\n+        },\n+        \"recipeNames\": [],\n+        \"cloudPlatform\": \"AZURE\"\n+      },\n+      {\n+        \"nodeCount\": 1,\n+        \"name\": \"manager\",\n+        \"type\": \"GATEWAY\",\n+        \"azure\": {},\n+        \"recoveryMode\": \"MANUAL\",\n+        \"template\": {\n+          \"azure\": {\n+            \"encrypted\": false,\n+            \"managedDisk\": true\n+          },\n+          \"instanceType\": \"Standard_D8_v3\",\n+          \"rootVolume\": {\n+            \"size\": 50\n+          },\n+          \"attachedVolumes\": [\n+            {\n+              \"size\": 100,\n+              \"count\": 1,\n+              \"type\": \"StandardSSD_LRS\"\n+            }\n+          ],\n+          \"cloudPlatform\": \"AZURE\"\n+        },\n+        \"recipeNames\": [],\n+        \"cloudPlatform\": \"AZURE\"\n+      },\n+      {\n+        \"nodeCount\": 0,\n+        \"name\": \"compute\",\n+        \"type\": \"CORE\",\n+        \"azure\": {},\n+        \"recoveryMode\": \"MANUAL\",\n+        \"template\": {\n+          \"azure\": {\n+            \"encrypted\": false,\n+            \"managedDisk\": true\n+          },\n+          \"instanceType\": \"Standard_D8_v3\",\n+          \"rootVolume\": {\n+            \"size\": 50\n+          },\n+          \"attachedVolumes\": [\n+            {\n+              \"size\": 100,\n+              \"count\": 1,\n+              \"type\": \"StandardSSD_LRS\"\n+            }\n+          ],\n+          \"cloudPlatform\": \"AZURE\"\n+        },\n+        \"recipeNames\": [],\n+        \"cloudPlatform\": \"AZURE\"\n+      },\n+      {\n+        \"nodeCount\": 3,\n+        \"name\": \"worker\",\n+        \"type\": \"CORE\",\n+        \"azure\": {\n+          \"availabilitySet\": {},", "originalCommit": "7659a36d16f580df529abb1aaf6d57337e8c6e44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM0NzM4OA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7401#discussion_r385347388", "bodyText": "Nice catch @lajosrodek. Thank you!", "author": "cegganesh84", "createdAt": "2020-02-27T20:14:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAyOTk2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAzMTk3Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/7401#discussion_r385031977", "bodyText": "This opening brace is displayed as an inverted white on red background, probably due to the above improper brace nesting in lines 97--98.", "author": "lajosrodek", "createdAt": "2020-02-27T10:16:25Z", "path": "core/src/main/resources/defaults/clustertemplates/azure/azure-dataengineering-ha-710.json", "diffHunk": "@@ -0,0 +1,177 @@\n+{\n+  \"name\": \"7.1.0 - Data Engineering HA for Azure\",\n+  \"description\": \"\",\n+  \"type\": \"DATAENGINEERING\",\n+  \"featureState\": \"PREVIEW\",\n+  \"cloudPlatform\": \"AZURE\",\n+  \"distroXTemplate\": {\n+    \"cluster\": {\n+      \"blueprintName\": \"7.1.0 - Data Engineering: HA: Apache Spark, Apache Hive, Apache Oozie\"\n+    },\n+    \"instanceGroups\": [\n+      {\n+        \"nodeCount\": 3,\n+        \"name\": \"quorum\",\n+        \"type\": \"CORE\",\n+        \"azure\": {},\n+        \"recoveryMode\": \"MANUAL\",\n+        \"template\": {\n+          \"azure\": {\n+            \"encrypted\": false,\n+            \"managedDisk\": true\n+          },\n+          \"instanceType\": \"Standard_D8_v3\",\n+          \"rootVolume\": {\n+            \"size\": 50\n+          },\n+          \"attachedVolumes\": [\n+            {\n+              \"size\": 100,\n+              \"count\": 1,\n+              \"type\": \"StandardSSD_LRS\"\n+            }\n+          ],\n+          \"cloudPlatform\": \"AZURE\"\n+        },\n+        \"recipeNames\": [],\n+        \"cloudPlatform\": \"AZURE\"\n+      },\n+      {\n+        \"nodeCount\": 1,\n+        \"name\": \"manager\",\n+        \"type\": \"GATEWAY\",\n+        \"azure\": {},\n+        \"recoveryMode\": \"MANUAL\",\n+        \"template\": {\n+          \"azure\": {\n+            \"encrypted\": false,\n+            \"managedDisk\": true\n+          },\n+          \"instanceType\": \"Standard_D8_v3\",\n+          \"rootVolume\": {\n+            \"size\": 50\n+          },\n+          \"attachedVolumes\": [\n+            {\n+              \"size\": 100,\n+              \"count\": 1,\n+              \"type\": \"StandardSSD_LRS\"\n+            }\n+          ],\n+          \"cloudPlatform\": \"AZURE\"\n+        },\n+        \"recipeNames\": [],\n+        \"cloudPlatform\": \"AZURE\"\n+      },\n+      {\n+        \"nodeCount\": 0,\n+        \"name\": \"compute\",\n+        \"type\": \"CORE\",\n+        \"azure\": {},\n+        \"recoveryMode\": \"MANUAL\",\n+        \"template\": {\n+          \"azure\": {\n+            \"encrypted\": false,\n+            \"managedDisk\": true\n+          },\n+          \"instanceType\": \"Standard_D8_v3\",\n+          \"rootVolume\": {\n+            \"size\": 50\n+          },\n+          \"attachedVolumes\": [\n+            {\n+              \"size\": 100,\n+              \"count\": 1,\n+              \"type\": \"StandardSSD_LRS\"\n+            }\n+          ],\n+          \"cloudPlatform\": \"AZURE\"\n+        },\n+        \"recipeNames\": [],\n+        \"cloudPlatform\": \"AZURE\"\n+      },\n+      {\n+        \"nodeCount\": 3,\n+        \"name\": \"worker\",\n+        \"type\": \"CORE\",\n+        \"azure\": {\n+          \"availabilitySet\": {},\n+        \"recoveryMode\": \"MANUAL\",\n+        \"template\": {\n+          \"azure\": {\n+            \"encrypted\": false,\n+            \"managedDisk\": true\n+          },\n+          \"instanceType\": \"Standard_D8_v3\",\n+          \"rootVolume\": {\n+            \"size\": 50\n+          },\n+          \"attachedVolumes\": [\n+            {\n+              \"size\": 100,\n+              \"count\": 1,\n+              \"type\": \"StandardSSD_LRS\"\n+            }\n+          ],\n+          \"cloudPlatform\": \"AZURE\"\n+        },\n+        \"recipeNames\": [],\n+        \"cloudPlatform\": \"AZURE\"\n+      },\n+      {", "originalCommit": "7659a36d16f580df529abb1aaf6d57337e8c6e44", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1957754a1da44273d50c339c1b6cb4d51b23cc8e", "url": "https://github.com/hortonworks/cloudbreak/commit/1957754a1da44273d50c339c1b6cb4d51b23cc8e", "message": "DISTX-397 Create data engineering HA template\n\n1. Design : https://docs.google.com/document/d/1oN8l9p74gKNps1aeG2NCjdh1_6yRo5YZA4eTolS9dVw/edit\n2. Added all the templates in preview mode as noted in the design.\n3. The requirement was to use smaller instance type for quorum nodes. At the moment not possible because, a unit test fails with m5.xlarge for quorum nodes.\n4. Tested that cluster definitions and blueprints came up fine in UI via moonlander private stack https://gk1-console.cdp-priv.mow-dev.cloudera.com/cloud/environments/list.", "committedDate": "2020-02-27T20:17:06Z", "type": "forcePushed"}, {"oid": "ec0aa9bb45922ff45947f7d545820eed7a99b65b", "url": "https://github.com/hortonworks/cloudbreak/commit/ec0aa9bb45922ff45947f7d545820eed7a99b65b", "message": "DISTX-397 Create data engineering HA template\n\n1. Design : https://docs.google.com/document/d/1oN8l9p74gKNps1aeG2NCjdh1_6yRo5YZA4eTolS9dVw/edit\n2. Added all the templates in preview mode as noted in the design.\n3. The requirement was to use smaller instance type for quorum nodes. At the moment not possible because, a unit test fails with m5.xlarge for quorum nodes.\n4. Tested that cluster definitions and blueprints came up fine in UI via moonlander private stack https://gk1-console.cdp-priv.mow-dev.cloudera.com/cloud/environments/list.", "committedDate": "2020-02-28T05:57:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkyMjM0OQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/7401#discussion_r385922349", "bodyText": "Not required because?, and if so - this is probably not what the value needs to be?", "author": "sidseth", "createdAt": "2020-02-28T21:07:06Z", "path": "core/src/main/resources/defaults/blueprints/cdp-data-engineering-ha-702.bp", "diffHunk": "@@ -0,0 +1,403 @@\n+{\n+  \"description\": \"7.0.2 - Data Engineering HA\",\n+  \"blueprint\": {\n+    \"cdhVersion\": \"7.0.2\",\n+    \"displayName\": \"dataengineering ha\",\n+    \"services\": [\n+      {\n+        \"refName\": \"zookeeper\",\n+        \"serviceType\": \"ZOOKEEPER\",\n+        \"roleConfigGroups\": [\n+          {\n+            \"refName\": \"zookeeper-SERVER-BASE\",\n+            \"roleType\": \"SERVER\",\n+            \"base\": true\n+          }\n+        ]\n+      },\n+      {\n+        \"refName\": \"hdfs\",\n+        \"serviceType\": \"HDFS\",\n+        \"serviceConfigs\": [\n+          {\n+            \"name\": \"redaction_policy_enabled\",\n+            \"value\": \"false\"\n+          },\n+          {\n+            \"name\": \"zookeeper_service\",\n+            \"ref\": \"zookeeper\"\n+          }\n+        ],\n+        \"roleConfigGroups\": [\n+          {\n+            \"refName\": \"hdfs-NAMENODE-BASE\",\n+            \"roleType\": \"NAMENODE\",\n+            \"base\": true\n+          },\n+          {\n+            \"refName\": \"hdfs-FAILOVERCONTROLLER-BASE\",\n+            \"roleType\": \"FAILOVERCONTROLLER\",\n+            \"base\": true\n+          },\n+          {\n+            \"refName\": \"hdfs-JOURNALNODE-BASE\",\n+            \"roleType\": \"JOURNALNODE\",\n+            \"base\": true\n+          },\n+          {\n+            \"refName\": \"hdfs-DATANODE-BASE\",\n+            \"roleType\": \"DATANODE\",\n+            \"base\": true\n+          },\n+          {\n+            \"refName\": \"hdfs-SECONDARYNAMENODE-BASE\",\n+            \"roleType\": \"SECONDARYNAMENODE\",\n+            \"configs\": [\n+              {\n+                \"name\": \"fs_checkpoint_dir_list\",\n+                \"value\": \"/should_not_be_required_in_HA_setup\"", "originalCommit": "ec0aa9bb45922ff45947f7d545820eed7a99b65b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk1OTczNQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/7401#discussion_r385959735", "bodyText": "There is an open jira about this https://jira.cloudera.com/browse/OPSAPS-50592", "author": "cegganesh84", "createdAt": "2020-02-28T22:56:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkyMjM0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyMjcyNw==", "url": "https://github.com/hortonworks/cloudbreak/pull/7401#discussion_r386622727", "bodyText": "This setting only applies to the secondary namenode, which is not running in the HDFS HA setup.  It is only included in the template because CM requires it anyway.", "author": "adoroszlai", "createdAt": "2020-03-02T20:09:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkyMjM0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcyMzcwMw==", "url": "https://github.com/hortonworks/cloudbreak/pull/7401#discussion_r386723703", "bodyText": "Thanks @adoroszlai", "author": "cegganesh84", "createdAt": "2020-03-02T23:59:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkyMjM0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkyNTM0OA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7401#discussion_r385925348", "bodyText": "The secondary namenode isn't set up on any of the nodes. Does it need to be?", "author": "sidseth", "createdAt": "2020-02-28T21:15:14Z", "path": "core/src/main/resources/defaults/blueprints/cdp-data-engineering-ha-702.bp", "diffHunk": "@@ -0,0 +1,403 @@\n+{\n+  \"description\": \"7.0.2 - Data Engineering HA\",\n+  \"blueprint\": {\n+    \"cdhVersion\": \"7.0.2\",\n+    \"displayName\": \"dataengineering ha\",\n+    \"services\": [\n+      {\n+        \"refName\": \"zookeeper\",\n+        \"serviceType\": \"ZOOKEEPER\",\n+        \"roleConfigGroups\": [\n+          {\n+            \"refName\": \"zookeeper-SERVER-BASE\",\n+            \"roleType\": \"SERVER\",\n+            \"base\": true\n+          }\n+        ]\n+      },\n+      {\n+        \"refName\": \"hdfs\",\n+        \"serviceType\": \"HDFS\",\n+        \"serviceConfigs\": [\n+          {\n+            \"name\": \"redaction_policy_enabled\",\n+            \"value\": \"false\"\n+          },\n+          {\n+            \"name\": \"zookeeper_service\",\n+            \"ref\": \"zookeeper\"\n+          }\n+        ],\n+        \"roleConfigGroups\": [\n+          {\n+            \"refName\": \"hdfs-NAMENODE-BASE\",\n+            \"roleType\": \"NAMENODE\",\n+            \"base\": true\n+          },\n+          {\n+            \"refName\": \"hdfs-FAILOVERCONTROLLER-BASE\",\n+            \"roleType\": \"FAILOVERCONTROLLER\",\n+            \"base\": true\n+          },\n+          {\n+            \"refName\": \"hdfs-JOURNALNODE-BASE\",\n+            \"roleType\": \"JOURNALNODE\",\n+            \"base\": true\n+          },\n+          {\n+            \"refName\": \"hdfs-DATANODE-BASE\",\n+            \"roleType\": \"DATANODE\",\n+            \"base\": true\n+          },\n+          {\n+            \"refName\": \"hdfs-SECONDARYNAMENODE-BASE\",\n+            \"roleType\": \"SECONDARYNAMENODE\",\n+            \"configs\": [\n+              {\n+                \"name\": \"fs_checkpoint_dir_list\",\n+                \"value\": \"/should_not_be_required_in_HA_setup\"\n+              }\n+            ],\n+            \"base\": true\n+          },\n+          {\n+            \"refName\": \"hdfs-BALANCER-BASE\",\n+            \"roleType\": \"BALANCER\",\n+            \"base\": true\n+          }\n+        ]\n+      },\n+      {\n+        \"refName\": \"hms\",\n+        \"serviceType\": \"HIVE\",\n+        \"displayName\": \"Hive Metastore\",\n+        \"roleConfigGroups\": [\n+          {\n+            \"refName\": \"hms-GATEWAY-BASE\",\n+            \"roleType\": \"GATEWAY\",\n+            \"base\": true\n+          },\n+          {\n+            \"refName\": \"hms-HIVEMETASTORE-BASE\",\n+            \"roleType\": \"HIVEMETASTORE\",\n+            \"base\": true\n+          }\n+        ]\n+      },\n+      {\n+        \"refName\": \"hive\",\n+        \"serviceType\": \"HIVE_ON_TEZ\",\n+        \"displayName\": \"Hive\",\n+        \"roleConfigGroups\": [\n+          {\n+            \"refName\": \"hive-GATEWAY-BASE\",\n+            \"roleType\": \"GATEWAY\",\n+            \"base\": true\n+          },\n+          {\n+            \"refName\": \"hive-HIVESERVER2-BASE\",\n+            \"roleType\": \"HIVESERVER2\",\n+            \"base\": true,\n+            \"configs\": [\n+              {\n+                \"name\": \"hive_server2_transport_mode\",\n+                \"value\": \"http\"\n+              }\n+            ]\n+          }\n+        ]\n+      },\n+      {\n+        \"refName\": \"hue\",\n+        \"serviceType\": \"HUE\",\n+        \"serviceConfigs\": [\n+          {\n+            \"name\": \"hue_service_safety_valve\",\n+            \"value\": \"[desktop]\\napp_blacklist=spark,zookeeper,hbase,impala,search,sqoop,security,metastore,pig\"\n+          }\n+        ],\n+        \"roleConfigGroups\": [\n+          {\n+            \"refName\": \"hue-HUE_SERVER-BASE\",\n+            \"roleType\": \"HUE_SERVER\",\n+            \"base\": true\n+          },\n+          {\n+            \"refName\": \"hue-HUE_LOAD_BALANCER-BASE\",\n+            \"roleType\": \"HUE_LOAD_BALANCER\",\n+            \"base\": true\n+          }\n+        ]\n+      },\n+      {\n+        \"refName\": \"livy\",\n+        \"serviceType\": \"LIVY\",\n+        \"roleConfigGroups\": [\n+          {\n+            \"refName\": \"livy-GATEWAY-BASE\",\n+            \"roleType\": \"GATEWAY\",\n+            \"base\": true\n+          },\n+          {\n+            \"refName\": \"livy-LIVY_SERVER-BASE\",\n+            \"roleType\": \"LIVY_SERVER\",\n+            \"base\": true\n+          }\n+        ]\n+      },\n+      {\n+        \"refName\": \"oozie\",\n+        \"serviceType\": \"OOZIE\",\n+        \"roleConfigGroups\": [\n+          {\n+            \"refName\": \"oozie-OOZIE_SERVER-BASE\",\n+            \"roleType\": \"OOZIE_SERVER\",\n+            \"base\": true\n+          }\n+        ]\n+      },\n+      {\n+        \"refName\": \"yarn\",\n+        \"serviceType\": \"YARN\",\n+        \"serviceConfigs\": [\n+          {\n+            \"name\": \"yarn_admin_acl\",\n+            \"value\": \"yarn,hive,hdfs\"\n+          }\n+        ],\n+        \"roleConfigGroups\": [\n+          {\n+            \"refName\": \"yarn-RESOURCEMANAGER-BASE\",\n+            \"roleType\": \"RESOURCEMANAGER\",\n+            \"base\": true,\n+            \"configs\": [\n+              {\n+                \"name\": \"resourcemanager_config_safety_valve\",\n+                \"value\": \"<property><name>yarn.scheduler.configuration.store.class</name><value>file</value></property>\"\n+              },\n+              {\n+                \"name\": \"yarn_resourcemanager_scheduler_class\",\n+                \"value\": \"org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler\"\n+              },\n+              {\n+                \"name\": \"yarn_scheduler_capacity_resource_calculator\",\n+                \"value\": \"org.apache.hadoop.yarn.util.resource.DefaultResourceCalculator\"\n+              },\n+              {\n+                \"name\": \"resourcemanager_capacity_scheduler_configuration\",\n+                \"value\": \"<configuration><property><name>yarn.scheduler.capacity.root.queues</name><value>default</value></property><property><name>yarn.scheduler.capacity.root.capacity</name><value>100</value></property><property><name>yarn.scheduler.capacity.root.default.capacity</name><value>100</value></property><property><name>yarn.scheduler.capacity.root.acl_submit_applications</name><value> </value></property><property><name>yarn.scheduler.capacity.root.acl_administer_queue</name><value> </value></property><property><name>yarn.scheduler.capacity.root.default.acl_submit_applications</name><value>*</value></property><property><name>yarn.scheduler.capacity.root.default.minimum-user-limit-percent</name><value>100</value></property><property><name>yarn.scheduler.capacity.maximum-am-resource-percent</name><value>0.33</value></property><property><name>yarn.scheduler.capacity.node-locality-delay</name><value>0</value></property><property><name>yarn.scheduler.capacity.schedule-asynchronously.maximum-threads</name><value>1</value></property><property><name>yarn.scheduler.capacity.schedule-asynchronously.scheduling-interval-ms</name><value>10</value></property><property><name>yarn.scheduler.capacity.per-node-heartbeat.maximum-offswitch-assignments</name><value>4</value></property></configuration>\"\n+              }\n+            ]\n+          },\n+          {\n+            \"refName\": \"yarn-NODEMANAGER-WORKER\",\n+            \"roleType\": \"NODEMANAGER\",\n+            \"base\": false\n+          },\n+          {\n+            \"refName\": \"yarn-NODEMANAGER-COMPUTE\",\n+            \"roleType\": \"NODEMANAGER\",\n+            \"base\": false\n+          },\n+          {\n+            \"refName\": \"yarn-JOBHISTORY-BASE\",\n+            \"roleType\": \"JOBHISTORY\",\n+            \"base\": true\n+          }\n+        ]\n+      },\n+      {\n+        \"refName\": \"spark_on_yarn\",\n+        \"serviceType\": \"SPARK_ON_YARN\",\n+        \"roleConfigGroups\": [\n+          {\n+            \"refName\": \"spark_on_yarn-SPARK_YARN_HISTORY_SERVER-BASE\",\n+            \"roleType\": \"SPARK_YARN_HISTORY_SERVER\",\n+            \"base\": true\n+          },\n+          {\n+            \"refName\": \"spark_on_yarn-GATEWAY-BASE\",\n+            \"roleType\": \"GATEWAY\",\n+            \"base\": true\n+          }\n+        ]\n+      },\n+      {\n+        \"refName\": \"tez\",\n+        \"serviceType\": \"TEZ\",\n+        \"serviceConfigs\": [\n+          {\n+            \"name\": \"yarn_service\",\n+            \"ref\": \"yarn\"\n+          },\n+          {\n+            \"name\": \"tez.am.container.reuse.non-local-fallback.enabled\",\n+            \"value\": \"true\"\n+          },\n+          {\n+            \"name\": \"tez.am.container.reuse.locality.delay-allocation-millis\",\n+            \"value\": \"0\"\n+          },\n+          {\n+            \"name\": \"tez.am.launch.cmd-opts\",\n+            \"value\": \"-XX:+PrintGCDetails -verbose:gc -XX:+UseNUMA -XX:+UseG1GC -XX:+ResizeTLAB\"\n+          },\n+          {\n+            \"name\": \"tez.task.launch.cmd-opts\",\n+            \"value\": \"-XX:+PrintGCDetails -verbose:gc -XX:+UseNUMA -XX:+UseG1GC -XX:+ResizeTLAB\"\n+          }\n+        ],\n+        \"roleConfigGroups\": [\n+          {\n+            \"refName\": \"tez-GATEWAY-BASE\",\n+            \"roleType\": \"GATEWAY\",\n+            \"base\": true\n+          }\n+        ]\n+      },\n+      {\n+        \"refName\": \"das\",\n+        \"serviceType\": \"DAS\",\n+        \"roleConfigGroups\": [\n+          {\n+            \"refName\": \"das-DAS_WEBAPP\",\n+            \"roleType\": \"DAS_WEBAPP\",\n+            \"base\": true,\n+            \"configs\": [\n+              {\n+                \"name\": \"data_analytics_studio_admin_users\",\n+                \"value\": \"*\"\n+              }\n+            ]\n+          },\n+          {\n+            \"refName\": \"das-DAS_EVENT_PROCESSOR\",\n+            \"roleType\": \"DAS_EVENT_PROCESSOR\",\n+            \"base\": true\n+          }\n+        ]\n+      },\n+      {\n+        \"refName\": \"knox\",\n+        \"roleConfigGroups\": [\n+          {\n+            \"base\": true,\n+            \"refName\": \"knox-KNOX_GATEWAY-BASE\",\n+            \"roleType\": \"KNOX_GATEWAY\"\n+          }\n+        ],\n+        \"serviceType\": \"KNOX\"\n+      },\n+      {\n+        \"refName\": \"zeppelin\",\n+        \"serviceType\": \"ZEPPELIN\",\n+        \"serviceConfigs\": [\n+          {\n+            \"name\": \"yarn_service\",\n+            \"ref\": \"yarn\"\n+          },\n+          {\n+            \"name\": \"hdfs_service\",\n+            \"ref\": \"hdfs\"\n+          },\n+          {\n+            \"name\": \"spark_on_yarn_service\",\n+            \"ref\": \"spark_on_yarn\"\n+          }\n+        ],\n+        \"roleConfigGroups\": [\n+          {\n+            \"refName\": \"zeppelin-ZEPPELIN_SERVER-BASE\",\n+            \"roleType\": \"ZEPPELIN_SERVER\",\n+            \"base\": true\n+          }\n+        ]\n+      }\n+    ],\n+    \"hostTemplates\": [\n+      {\n+        \"refName\": \"gateway\",\n+        \"cardinality\": 0,\n+        \"roleConfigGroupsRefNames\": [\n+          \"hive-GATEWAY-BASE\",\n+          \"hms-GATEWAY-BASE\",\n+          \"livy-GATEWAY-BASE\",\n+          \"spark_on_yarn-GATEWAY-BASE\",\n+          \"tez-GATEWAY-BASE\"\n+        ]\n+      },\n+      {\n+        \"refName\": \"master\",\n+        \"cardinality\": 2,\n+        \"roleConfigGroupsRefNames\": [\n+          \"hdfs-FAILOVERCONTROLLER-BASE\",\n+          \"hdfs-NAMENODE-BASE\",\n+          \"hive-GATEWAY-BASE\",\n+          \"hive-HIVESERVER2-BASE\",\n+          \"hms-GATEWAY-BASE\",\n+          \"hms-HIVEMETASTORE-BASE\",\n+          \"hue-HUE_SERVER-BASE\",\n+          \"knox-KNOX_GATEWAY-BASE\",\n+          \"livy-GATEWAY-BASE\",\n+          \"spark_on_yarn-GATEWAY-BASE\",\n+          \"tez-GATEWAY-BASE\",\n+          \"yarn-RESOURCEMANAGER-BASE\"\n+        ]\n+      },\n+      {\n+        \"refName\": \"manager\",", "originalCommit": "ec0aa9bb45922ff45947f7d545820eed7a99b65b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk1ODgyOA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7401#discussion_r385958828", "bodyText": "There are two namenodes in master group. One will be active at any point of time. The other one will be secondary. Am I getting the concept wrong?", "author": "cegganesh84", "createdAt": "2020-02-28T22:53:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkyNTM0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU5NDI4Ng==", "url": "https://github.com/hortonworks/cloudbreak/pull/7401#discussion_r386594286", "bodyText": "The 'secondary namenode' is a completely different process. The name is rather confusing. Not sure if it's required in an HA setup with the Journal nodes running. Worth checking with the HDFS team on the recommended deployment topology.", "author": "sidseth", "createdAt": "2020-03-02T19:14:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkyNTM0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyNDMyMA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7401#discussion_r386624320", "bodyText": "Not sure if it's required in an HA setup with the Journal nodes running.\n\nNot required, neither allowed:\n\nNote that, in an HA cluster, the Standby NameNodes also performs checkpoints of the namespace state, and thus it is not necessary to run a Secondary NameNode, CheckpointNode, or BackupNode in an HA cluster. In fact, to do so would be an error. This also allows one who is reconfiguring a non-HA-enabled HDFS cluster to be HA-enabled to reuse the hardware which they had previously dedicated to the Secondary NameNode.\n\nhttps://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithQJM.html#Hardware_resources", "author": "adoroszlai", "createdAt": "2020-03-02T20:13:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkyNTM0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcyMzQ1NA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7401#discussion_r386723454", "bodyText": "Thanks @adoroszlai", "author": "cegganesh84", "createdAt": "2020-03-02T23:59:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkyNTM0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkyNzI3NA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7401#discussion_r385927274", "bodyText": "What's the smallest instance that CB supports? Will likely need to make a change in CB to allow these nodes to be quite a bit smaller.", "author": "sidseth", "createdAt": "2020-02-28T21:20:12Z", "path": "core/src/main/resources/defaults/clustertemplates/aws/aws-dataengineering-ha-702.json", "diffHunk": "@@ -0,0 +1,133 @@\n+{\n+  \"name\": \"Data Engineering HA for AWS\",\n+  \"description\": \"\",\n+  \"type\": \"DATAENGINEERING\",\n+  \"featureState\": \"PREVIEW\",\n+  \"cloudPlatform\": \"AWS\",\n+  \"distroXTemplate\": {\n+    \"cluster\": {\n+      \"blueprintName\": \"CDP 1.2 - Data Engineering: HA: Apache Spark, Apache Hive, Apache Oozie\"\n+    },\n+    \"instanceGroups\": [{\n+      \"nodeCount\": 1,\n+      \"name\": \"manager\",\n+      \"type\": \"GATEWAY\",\n+      \"recoveryMode\": \"MANUAL\",\n+      \"template\": {\n+        \"aws\": {},\n+        \"instanceType\": \"m5.2xlarge\",\n+        \"rootVolume\": {\n+          \"size\": 50\n+        },\n+        \"attachedVolumes\": [{\n+          \"size\": 100,\n+          \"count\": 1,\n+          \"type\": \"standard\"\n+        }],\n+        \"cloudPlatform\": \"AWS\"\n+      },\n+      \"recipeNames\": []\n+    },\n+      {\n+        \"nodeCount\": 0,\n+        \"name\": \"compute\",\n+        \"type\": \"CORE\",\n+        \"recoveryMode\": \"MANUAL\",\n+        \"template\": {\n+          \"aws\": {},\n+          \"instanceType\": \"m5.2xlarge\",\n+          \"rootVolume\": {\n+            \"size\": 50\n+          },\n+          \"attachedVolumes\": [{\n+            \"size\": 100,\n+            \"count\": 1,\n+            \"type\": \"standard\"\n+          }],\n+          \"cloudPlatform\": \"AWS\"\n+        },\n+        \"recipeNames\": []\n+      },\n+      {\n+        \"nodeCount\": 0,\n+        \"name\": \"gateway\",\n+        \"type\": \"CORE\",\n+        \"recoveryMode\": \"MANUAL\",\n+        \"template\": {\n+          \"aws\": {},\n+          \"instanceType\": \"m5.2xlarge\",\n+          \"rootVolume\": {\n+            \"size\": 50\n+          },\n+          \"attachedVolumes\": [{\n+            \"size\": 100,\n+            \"count\": 1,\n+            \"type\": \"standard\"\n+          }],\n+          \"cloudPlatform\": \"AWS\"\n+        },\n+        \"recipeNames\": []\n+      },\n+      {\n+        \"nodeCount\": 3,\n+        \"name\": \"quorum\",\n+        \"type\": \"CORE\",\n+        \"recoveryMode\": \"MANUAL\",\n+        \"template\": {\n+          \"aws\": {},\n+          \"instanceType\": \"m5.2xlarge\",", "originalCommit": "ec0aa9bb45922ff45947f7d545820eed7a99b65b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk1ODUxOA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7401#discussion_r385958518", "bodyText": "m5.2xlarge. CC: @mschumpert", "author": "cegganesh84", "createdAt": "2020-02-28T22:51:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkyNzI3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkzMDk1Ng==", "url": "https://github.com/hortonworks/cloudbreak/pull/7401#discussion_r385930956", "bodyText": "This stood out. Azure masters get 16cores/64GB. AWS gets 8 cores/32GB. Intentional?", "author": "sidseth", "createdAt": "2020-02-28T21:29:21Z", "path": "core/src/main/resources/defaults/clustertemplates/azure/azure-dataengineering-ha-702.json", "diffHunk": "@@ -0,0 +1,174 @@\n+{\n+  \"name\": \"Data Engineering HA for Azure\",\n+  \"description\": \"\",\n+  \"type\": \"DATAENGINEERING\",\n+  \"featureState\": \"PREVIEW\",\n+  \"cloudPlatform\": \"AZURE\",\n+  \"distroXTemplate\": {\n+    \"cluster\": {\n+      \"blueprintName\": \"CDP 1.2 - Data Engineering: HA: Apache Spark, Apache Hive, Apache Oozie\"\n+    },\n+    \"instanceGroups\": [\n+      {\n+        \"nodeCount\": 3,\n+        \"name\": \"quorum\",\n+        \"type\": \"CORE\",\n+        \"azure\": {},\n+        \"recoveryMode\": \"MANUAL\",\n+        \"template\": {\n+          \"azure\": {\n+            \"encrypted\": false,\n+            \"managedDisk\": true\n+          },\n+          \"instanceType\": \"Standard_D8_v3\",\n+          \"rootVolume\": {\n+            \"size\": 50\n+          },\n+          \"attachedVolumes\": [\n+            {\n+              \"size\": 100,\n+              \"count\": 1,\n+              \"type\": \"StandardSSD_LRS\"\n+            }\n+          ],\n+          \"cloudPlatform\": \"AZURE\"\n+        },\n+        \"recipeNames\": [],\n+        \"cloudPlatform\": \"AZURE\"\n+      },\n+      {\n+        \"nodeCount\": 1,\n+        \"name\": \"manager\",\n+        \"type\": \"GATEWAY\",\n+        \"azure\": {},\n+        \"recoveryMode\": \"MANUAL\",\n+        \"template\": {\n+          \"azure\": {\n+            \"encrypted\": false,\n+            \"managedDisk\": true\n+          },\n+          \"instanceType\": \"Standard_D8_v3\",\n+          \"rootVolume\": {\n+            \"size\": 50\n+          },\n+          \"attachedVolumes\": [\n+            {\n+              \"size\": 100,\n+              \"count\": 1,\n+              \"type\": \"StandardSSD_LRS\"\n+            }\n+          ],\n+          \"cloudPlatform\": \"AZURE\"\n+        },\n+        \"recipeNames\": [],\n+        \"cloudPlatform\": \"AZURE\"\n+      },\n+      {\n+        \"nodeCount\": 0,\n+        \"name\": \"compute\",\n+        \"type\": \"CORE\",\n+        \"azure\": {},\n+        \"recoveryMode\": \"MANUAL\",\n+        \"template\": {\n+          \"azure\": {\n+            \"encrypted\": false,\n+            \"managedDisk\": true\n+          },\n+          \"instanceType\": \"Standard_D8_v3\",\n+          \"rootVolume\": {\n+            \"size\": 50\n+          },\n+          \"attachedVolumes\": [\n+            {\n+              \"size\": 100,\n+              \"count\": 1,\n+              \"type\": \"StandardSSD_LRS\"\n+            }\n+          ],\n+          \"cloudPlatform\": \"AZURE\"\n+        },\n+        \"recipeNames\": [],\n+        \"cloudPlatform\": \"AZURE\"\n+      },\n+      {\n+        \"nodeCount\": 3,\n+        \"name\": \"worker\",\n+        \"type\": \"CORE\",\n+        \"azure\": {},\n+        \"recoveryMode\": \"MANUAL\",\n+        \"template\": {\n+          \"azure\": {\n+            \"encrypted\": false,\n+            \"managedDisk\": true\n+          },\n+          \"instanceType\": \"Standard_D8_v3\",\n+          \"rootVolume\": {\n+            \"size\": 50\n+          },\n+          \"attachedVolumes\": [\n+            {\n+              \"size\": 100,\n+              \"count\": 1,\n+              \"type\": \"StandardSSD_LRS\"\n+            }\n+          ],\n+          \"cloudPlatform\": \"AZURE\"\n+        },\n+        \"recipeNames\": [],\n+        \"cloudPlatform\": \"AZURE\"\n+      },\n+      {\n+        \"nodeCount\": 2,\n+        \"name\": \"master\",\n+        \"type\": \"CORE\",\n+        \"azure\": {},\n+        \"recoveryMode\": \"MANUAL\",\n+        \"template\": {\n+          \"azure\": {\n+            \"encrypted\": false,\n+            \"managedDisk\": true\n+          },\n+          \"instanceType\": \"Standard_D16_v3\",", "originalCommit": "ec0aa9bb45922ff45947f7d545820eed7a99b65b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk1ODM0NA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7401#discussion_r385958344", "bodyText": "Good catch. I was following the existing DE Azure definition. Can fix in all the DE templates for Azure.", "author": "cegganesh84", "createdAt": "2020-02-28T22:51:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkzMDk1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk2MjY1NQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/7401#discussion_r385962655", "bodyText": "This jira answers many questions https://jira.cloudera.com/browse/CB-4012. This is where the master instance type was set to Standard_D16_v3 CC: @doktoric", "author": "cegganesh84", "createdAt": "2020-02-28T23:07:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkzMDk1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk2MzM4Mg==", "url": "https://github.com/hortonworks/cloudbreak/pull/7401#discussion_r385963382", "bodyText": "At the same time opdb master is moving to D8 https://jira.cloudera.com/browse/CB-5275", "author": "cegganesh84", "createdAt": "2020-02-28T23:10:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkzMDk1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcyMjk4Mw==", "url": "https://github.com/hortonworks/cloudbreak/pull/7401#discussion_r386722983", "bodyText": "Moved to Standard_D8_v3 for all the DE template masters.", "author": "cegganesh84", "createdAt": "2020-03-02T23:57:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkzMDk1Ng=="}], "type": "inlineReview"}, {"oid": "302e818f719f14540f2a51c8ef6eefd54df6e311", "url": "https://github.com/hortonworks/cloudbreak/commit/302e818f719f14540f2a51c8ef6eefd54df6e311", "message": "DISTX-397 Create data engineering HA template\n\n1. Design : https://docs.google.com/document/d/1oN8l9p74gKNps1aeG2NCjdh1_6yRo5YZA4eTolS9dVw/edit\n2. Added all the templates in preview mode as noted in the design.\n3. The requirement was to use smaller instance type for quorum nodes. At the moment not possible because, a unit test fails with m5.xlarge for quorum nodes. To compensate that moved to Standard_D8_v3 for all the DE master nodes.\n4. Tested that cluster definitions and blueprints came up fine in UI via moonlander private stack https://gk1-console.cdp-priv.mow-dev.cloudera.com/cloud/environments/list.", "committedDate": "2020-03-02T23:43:04Z", "type": "commit"}, {"oid": "302e818f719f14540f2a51c8ef6eefd54df6e311", "url": "https://github.com/hortonworks/cloudbreak/commit/302e818f719f14540f2a51c8ef6eefd54df6e311", "message": "DISTX-397 Create data engineering HA template\n\n1. Design : https://docs.google.com/document/d/1oN8l9p74gKNps1aeG2NCjdh1_6yRo5YZA4eTolS9dVw/edit\n2. Added all the templates in preview mode as noted in the design.\n3. The requirement was to use smaller instance type for quorum nodes. At the moment not possible because, a unit test fails with m5.xlarge for quorum nodes. To compensate that moved to Standard_D8_v3 for all the DE master nodes.\n4. Tested that cluster definitions and blueprints came up fine in UI via moonlander private stack https://gk1-console.cdp-priv.mow-dev.cloudera.com/cloud/environments/list.", "committedDate": "2020-03-02T23:43:04Z", "type": "forcePushed"}]}