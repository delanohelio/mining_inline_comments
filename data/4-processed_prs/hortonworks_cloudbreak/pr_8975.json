{"pr_number": 8975, "pr_title": "CB-8735 set CDP_ENV to PUBLIC_CLOUD when CM server starts rather than\u2026", "pr_createdAt": "2020-09-10T10:06:32Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8975", "timeline": [{"oid": "87d902fc23ab419ad5525fb2b350815a159ac6a8", "url": "https://github.com/hortonworks/cloudbreak/commit/87d902fc23ab419ad5525fb2b350815a159ac6a8", "message": "CB-8735 set CDP_ENV to PUBLIC_CLOUD when CM server starts rather than with API\nPreviously, we set this env var with API call after them CM server has started.\nHowever, CM team would like to rely on this env var during CM startup so they can\ninitialise the application accordingly.", "committedDate": "2020-09-10T13:14:03Z", "type": "forcePushed"}, {"oid": "99a8abca609735e42f2627d4d385164e9668d4ae", "url": "https://github.com/hortonworks/cloudbreak/commit/99a8abca609735e42f2627d4d385164e9668d4ae", "message": "CB-8735 set CDP_ENV to PUBLIC_CLOUD when CM server starts rather than with API\nPreviously, we set this env var with API call after them CM server has started.\nHowever, CM team would like to rely on this env var during CM startup so they can\ninitialise the application accordingly. Making this change in the cm.settings\nfile is not viable as the different initialisation processes do not use this file\nand it would be too late for the CM server to use this file hence the -env server\nargumentum.", "committedDate": "2020-09-11T05:53:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgxMjMzOQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8975#discussion_r486812339", "bodyText": "this won't match \"-i /etc/cloudera-scm-server/cm.settings -env PUBLIC_CLOUD\"", "author": "lacikaaa", "createdAt": "2020-09-11T06:56:43Z", "path": "orchestrator-salt/src/main/resources/salt/salt/cloudera/manager/init.sls", "diffHunk": "@@ -30,6 +30,17 @@ setup_missed_cm_heartbeat:\n     - text: setsettings MISSED_HB_BAD {{ cloudera_manager.settings.missed_heartbeat_interval }}\n     - unless: grep \"MISSED_HB_BAD\" /etc/cloudera-scm-server/cm.settings\n \n+add_settings_file_to_cfm_server_args:\n+  file.replace:\n+    - name: /etc/default/cloudera-scm-server\n+    - pattern: \"CMF_SERVER_ARGS=.*\"\n+{% if salt['pillar.get']('cloudera-manager:settings:set_cdp_env') == True %}\n+    - repl: CMF_SERVER_ARGS=\"-i /etc/cloudera-scm-server/cm.settings -env PUBLIC_CLOUD\"\n+{% else %}\n+    - repl: CMF_SERVER_ARGS=\"-i /etc/cloudera-scm-server/cm.settings\"\n+{% endif %}\n+    - unless: grep \"CMF_SERVER_ARGS=\\\"-i /etc/cloudera-scm-server/cm.settings\\\"\" /etc/default/cloudera-scm-server", "originalCommit": "99a8abca609735e42f2627d4d385164e9668d4ae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0bf561eb3aad7a36ab4a78b19970490b88c6cadf", "url": "https://github.com/hortonworks/cloudbreak/commit/0bf561eb3aad7a36ab4a78b19970490b88c6cadf", "message": "CB-8735 set CDP_ENV to PUBLIC_CLOUD when CM server starts rather than with API\nPreviously, we set this env var with API call after them CM server has started.\nHowever, CM team would like to rely on this env var during CM startup so they can\ninitialise the application accordingly. Making this change in the cm.settings\nfile is not viable as the different initialisation processes do not use this file\nand it would be too late for the CM server to use this file hence the -env server\nargumentum.", "committedDate": "2020-09-11T07:03:53Z", "type": "forcePushed"}, {"oid": "e6da1d5edbbb7f95e8f85a91222402c98c84476d", "url": "https://github.com/hortonworks/cloudbreak/commit/e6da1d5edbbb7f95e8f85a91222402c98c84476d", "message": "CB-8735 set CDP_ENV to PUBLIC_CLOUD when CM server starts rather than with API\nPreviously, we set this env var with API call after them CM server has started.\nHowever, CM team would like to rely on this env var during CM startup so they can\ninitialise the application accordingly. Making this change in the cm.settings\nfile is not viable as the different initialisation processes do not use this file\nand it would be too late for the CM server to use this file hence the -env server\nargumentum.", "committedDate": "2020-09-11T07:09:07Z", "type": "commit"}, {"oid": "e6da1d5edbbb7f95e8f85a91222402c98c84476d", "url": "https://github.com/hortonworks/cloudbreak/commit/e6da1d5edbbb7f95e8f85a91222402c98c84476d", "message": "CB-8735 set CDP_ENV to PUBLIC_CLOUD when CM server starts rather than with API\nPreviously, we set this env var with API call after them CM server has started.\nHowever, CM team would like to rely on this env var during CM startup so they can\ninitialise the application accordingly. Making this change in the cm.settings\nfile is not viable as the different initialisation processes do not use this file\nand it would be too late for the CM server to use this file hence the -env server\nargumentum.", "committedDate": "2020-09-11T07:09:07Z", "type": "forcePushed"}]}