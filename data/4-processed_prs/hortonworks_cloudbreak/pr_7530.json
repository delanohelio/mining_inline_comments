{"pr_number": 7530, "pr_title": "CB-5590 spark3 added", "pr_createdAt": "2020-03-10T21:27:35Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/7530", "timeline": [{"oid": "cd28ffccaaf934dcc6ea5f3274928c69f4ce7ddc", "url": "https://github.com/hortonworks/cloudbreak/commit/cd28ffccaaf934dcc6ea5f3274928c69f4ce7ddc", "message": "CB-5590 spark3 added", "committedDate": "2020-03-11T14:15:03Z", "type": "forcePushed"}, {"oid": "d582e89250d2383580160bd9a26d809c33bf0b7e", "url": "https://github.com/hortonworks/cloudbreak/commit/d582e89250d2383580160bd9a26d809c33bf0b7e", "message": "CB-5590 spark3 added", "committedDate": "2020-03-19T10:12:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMxMDMyOQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/7530#discussion_r396310329", "bodyText": "I think ACLs are missing from the topology.", "author": "keyki", "createdAt": "2020-03-23T09:24:56Z", "path": "orchestrator-salt/src/main/resources/salt/salt/gateway/config/cm/topology.xml.j2", "diffHunk": "@@ -480,6 +480,17 @@\n     {%- endif %}\n     {%- endif %}\n \n+    {% if 'SPARK3_YARN_HISTORY_SERVER' in salt['pillar.get']('gateway:location') -%}\n+    {% if 'SPARK3HISTORYUI' in exposed -%}\n+    <service>\n+        <role>SPARK3HISTORYUI</role>", "originalCommit": "d582e89250d2383580160bd9a26d809c33bf0b7e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "08f0c5b65d8638879943e18a195bd1d3181d5184", "url": "https://github.com/hortonworks/cloudbreak/commit/08f0c5b65d8638879943e18a195bd1d3181d5184", "message": "CB-5590 spark3 added", "committedDate": "2020-03-23T09:36:29Z", "type": "forcePushed"}, {"oid": "c424ccb17593acce6ebace473249ccb1367af28d", "url": "https://github.com/hortonworks/cloudbreak/commit/c424ccb17593acce6ebace473249ccb1367af28d", "message": "CB-5590 spark3 added", "committedDate": "2020-03-23T11:10:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ0MDk1Mw==", "url": "https://github.com/hortonworks/cloudbreak/pull/7530#discussion_r396440953", "bodyText": "I thought we were moving away from safety valves? This uses another one?", "author": "risdenk", "createdAt": "2020-03-23T13:15:36Z", "path": "template-manager-cmtemplate/src/main/java/com/sequenceiq/cloudbreak/cmtemplate/configproviders/spark/Spark3OnYarnRoleConfigProvider.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package com.sequenceiq.cloudbreak.cmtemplate.configproviders.spark;\n+\n+import static com.sequenceiq.cloudbreak.cmtemplate.configproviders.ConfigUtils.config;\n+import static com.sequenceiq.cloudbreak.cmtemplate.configproviders.hive.HiveMetastoreCloudStorageServiceConfigProvider.HMS_METASTORE_EXTERNAL_DIR;\n+\n+import java.util.List;\n+\n+import org.springframework.stereotype.Component;\n+\n+import com.cloudera.api.swagger.model.ApiClusterTemplateConfig;\n+import com.sequenceiq.cloudbreak.cmtemplate.CmTemplateProcessor;\n+import com.sequenceiq.cloudbreak.cmtemplate.configproviders.AbstractRoleConfigProvider;\n+import com.sequenceiq.cloudbreak.cmtemplate.configproviders.ConfigUtils;\n+import com.sequenceiq.cloudbreak.template.TemplatePreparationObject;\n+\n+@Component\n+public class Spark3OnYarnRoleConfigProvider extends AbstractRoleConfigProvider {\n+\n+    private static final String SPARK3_CONF_CLIENT_SAFETY_VALVE = \"spark-conf/spark-defaults.conf_client_config_safety_valve\";", "originalCommit": "c424ccb17593acce6ebace473249ccb1367af28d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ4NTg4Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/7530#discussion_r396485887", "bodyText": "@risdenk unfortunately we can only moving aways if we have fix property in CM side", "author": "doktoric", "createdAt": "2020-03-23T14:20:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ0MDk1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ5NDM5Mw==", "url": "https://github.com/hortonworks/cloudbreak/pull/7530#discussion_r396494393", "bodyText": "Yea agreed - CB-4191 is being used to track a bunch of this. Is there a CM jira to add a specific property and a CB one to remove this use of safety valve? Otherwise we are going to keep fighting up a hill.\nThis looks like a new Spark CSD so it should be possible to add the specific config and then CB wouldn't need to deal w/ this safety valve.", "author": "risdenk", "createdAt": "2020-03-23T14:31:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ0MDk1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUxNjc4Ng==", "url": "https://github.com/hortonworks/cloudbreak/pull/7530#discussion_r396516786", "bodyText": "@risdenk this is https://jira.cloudera.com/browse/OPSAPS-55172", "author": "doktoric", "createdAt": "2020-03-23T15:00:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ0MDk1Mw=="}], "type": "inlineReview"}, {"oid": "9fe1555444ab7f4c20508065b8039b63fa1fee51", "url": "https://github.com/hortonworks/cloudbreak/commit/9fe1555444ab7f4c20508065b8039b63fa1fee51", "message": "CB-5590 spark3 added", "committedDate": "2020-03-23T16:42:57Z", "type": "forcePushed"}, {"oid": "d62e44b30f6b1834bcbba024cfd82fe8cb430057", "url": "https://github.com/hortonworks/cloudbreak/commit/d62e44b30f6b1834bcbba024cfd82fe8cb430057", "message": "CB-5590 spark3 added", "committedDate": "2020-03-25T20:45:06Z", "type": "forcePushed"}, {"oid": "4d1ef183d4e2aa90eda312751b5e85541b9de515", "url": "https://github.com/hortonworks/cloudbreak/commit/4d1ef183d4e2aa90eda312751b5e85541b9de515", "message": "CB-5590 spark3 added", "committedDate": "2020-03-26T07:44:55Z", "type": "commit"}, {"oid": "4d1ef183d4e2aa90eda312751b5e85541b9de515", "url": "https://github.com/hortonworks/cloudbreak/commit/4d1ef183d4e2aa90eda312751b5e85541b9de515", "message": "CB-5590 spark3 added", "committedDate": "2020-03-26T07:44:55Z", "type": "forcePushed"}]}