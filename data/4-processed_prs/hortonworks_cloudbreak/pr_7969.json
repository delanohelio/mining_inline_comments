{"pr_number": 7969, "pr_title": "CB-6897 Improve InstanceMetadata with instance lifecycle", "pr_createdAt": "2020-05-05T10:46:53Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/7969", "timeline": [{"oid": "2fb59fbffa159139d7d26698b1bf3dafd671c9b8", "url": "https://github.com/hortonworks/cloudbreak/commit/2fb59fbffa159139d7d26698b1bf3dafd671c9b8", "message": "CB-6897 Improve InstanceMetadata with instance lifecycle", "committedDate": "2020-05-05T10:45:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA2OTc1Mg==", "url": "https://github.com/hortonworks/cloudbreak/pull/7969#discussion_r420069752", "bodyText": "I've read somewhere in a PR comment that this blocks the whole table for a (relatively) long time.\nIdeal solution is not putting the default into the ADD COLUMN but as a second statement and then setting the default value to the null columns.\nExample here: https://github.com/hortonworks/cloudbreak/blob/master/freeipa/src/main/resources/schema/app/20200406095012_CB-6385_add_version_to_stack.sql\nSimilarly, change the SQL script in the freeipa module as well.", "author": "bergerdenes", "createdAt": "2020-05-05T12:28:09Z", "path": "core/src/main/resources/schema/app/20200504164000_CB-6897_improve_instance_metadata_with_instance_lifecycle.sql", "diffHunk": "@@ -0,0 +1,9 @@\n+-- // CB-6897 Improve InstanceMetadata with instance lifecycle\n+-- Migration SQL that makes the change goes here.\n+\n+ALTER TABLE instancemetadata ADD COLUMN IF NOT EXISTS lifecycle VARCHAR(255) DEFAULT 'NORMAL';", "originalCommit": "2fb59fbffa159139d7d26698b1bf3dafd671c9b8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1d4ab7eacd8614d86ed3e37d1e4430ae497d76a8", "url": "https://github.com/hortonworks/cloudbreak/commit/1d4ab7eacd8614d86ed3e37d1e4430ae497d76a8", "message": "CB-6897 Optimize sql for instance lifecycle column addition", "committedDate": "2020-05-05T13:09:22Z", "type": "commit"}, {"oid": "1d4ab7eacd8614d86ed3e37d1e4430ae497d76a8", "url": "https://github.com/hortonworks/cloudbreak/commit/1d4ab7eacd8614d86ed3e37d1e4430ae497d76a8", "message": "CB-6897 Optimize sql for instance lifecycle column addition", "committedDate": "2020-05-05T13:09:22Z", "type": "forcePushed"}]}