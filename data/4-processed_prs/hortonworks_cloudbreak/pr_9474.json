{"pr_number": 9474, "pr_title": "CDPSDX-1981: missing DNS a record in ipa during datalake provisioning ", "pr_createdAt": "2020-11-18T22:39:35Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/9474", "timeline": [{"oid": "0ca0a1dbf5dc68aec35f319e47ad0c8799f1843a", "url": "https://github.com/hortonworks/cloudbreak/commit/0ca0a1dbf5dc68aec35f319e47ad0c8799f1843a", "message": "CDPSDX-1981: missing DNS A record in ipa during datalake provisioning\n\nDuring datalake provisioning, an intermittent error of \"does not have corresponding DNS A/AAAA record\" happens. Currently we don't have logging for dnsrecord add operation. Only a timestamp exists in the log to show the dns add operation is done. This fix will log the added DNS record and the success return information in the add operation. This will help to confirm and debug the missing DNS a record issue.", "committedDate": "2020-11-20T23:24:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY2ODE5Mg==", "url": "https://github.com/hortonworks/cloudbreak/pull/9474#discussion_r528668192", "bodyText": "is there a reason you used ; instead of &&?\nI think dnsrecord-add.log would be better name, and more consistent with the other salt states, as we use the .log for logs and the executed ending for indicating that the script has run", "author": "lacikaaa", "createdAt": "2020-11-23T12:28:36Z", "path": "orchestrator-salt/src/main/resources/salt/salt/sssd/ipa.sls", "diffHunk": "@@ -65,7 +65,7 @@ removing_dns_entries:\n \n add_dns_record:\n   cmd.run:\n-    - name: /opt/salt/scripts/add_dns_record.sh && echo $(date +%Y-%m-%d:%H:%M:%S) >> /var/log/dnsrecord-add-executed\n+    - name: /opt/salt/scripts/add_dns_record.sh 2>&1 | tee -a /var/log/dnsrecord-add-history ; test ${PIPESTATUS[0]} -eq 0 && echo $(date +%Y-%m-%d:%H:%M:%S) >> /var/log/dnsrecord-add-executed", "originalCommit": "0ca0a1dbf5dc68aec35f319e47ad0c8799f1843a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODc4OTE5NA==", "url": "https://github.com/hortonworks/cloudbreak/pull/9474#discussion_r528789194", "bodyText": "; and && are same here. I changed it to && now. I feel ; would make the one line only separated by a single &&. Therefore, it is clear that first block /opt/salt/scripts/add_dns_record.sh 2>&1 | tee -a /var/log/dnsrecord-add-history ; test ${PIPESTATUS[0]} -eq 0  was a whole section. But this is more of a style preference.\nThanks! I changed the log name to \"dnsrecord-add.log\"", "author": "christmasferret", "createdAt": "2020-11-23T15:32:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY2ODE5Mg=="}], "type": "inlineReview"}, {"oid": "35dca73e559ddfa540207326c0aeca64c6b0c91f", "url": "https://github.com/hortonworks/cloudbreak/commit/35dca73e559ddfa540207326c0aeca64c6b0c91f", "message": "CDPSDX-1981: missing DNS a record in ipa during datalake provisioning\n\nDuring datalake provisioning, an intermittent error of \"does not have corresponding DNS A/AAAA record\" happens. Currently we don't have logging for dnsrecord add operation. Only a timestamp exists in the log to show the dns add operation is done. This fix will log the added DNS record and the success return information in the add operation. This will help to confirm and debug the missing DNS a record issue.", "committedDate": "2020-11-23T15:26:33Z", "type": "commit"}, {"oid": "35dca73e559ddfa540207326c0aeca64c6b0c91f", "url": "https://github.com/hortonworks/cloudbreak/commit/35dca73e559ddfa540207326c0aeca64c6b0c91f", "message": "CDPSDX-1981: missing DNS a record in ipa during datalake provisioning\n\nDuring datalake provisioning, an intermittent error of \"does not have corresponding DNS A/AAAA record\" happens. Currently we don't have logging for dnsrecord add operation. Only a timestamp exists in the log to show the dns add operation is done. This fix will log the added DNS record and the success return information in the add operation. This will help to confirm and debug the missing DNS a record issue.", "committedDate": "2020-11-23T15:26:33Z", "type": "forcePushed"}]}