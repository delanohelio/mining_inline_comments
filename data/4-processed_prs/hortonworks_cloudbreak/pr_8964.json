{"pr_number": 8964, "pr_title": "CDPCP-2986. Include internal machine users in user sync", "pr_createdAt": "2020-09-09T17:33:27Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8964", "timeline": [{"oid": "4fd2053950b4cbab7275a9d42ce4431e4a1f34bc", "url": "https://github.com/hortonworks/cloudbreak/commit/4fd2053950b4cbab7275a9d42ce4431e4a1f34bc", "message": "CDPCP-2986. Include internal machine users in user sync\n\nInternal machine users are needed in user sync. This commit adds\nthe includeInternal flag to the listMachineUsers calls.", "committedDate": "2020-09-09T17:47:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTgwODg2MQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8964#discussion_r485808861", "bodyText": "Don't we want to make this configurable?", "author": "keyki", "createdAt": "2020-09-09T17:54:27Z", "path": "freeipa/src/main/java/com/sequenceiq/freeipa/service/freeipa/user/UmsUsersStateProvider.java", "diffHunk": "@@ -43,6 +43,8 @@\n \n     private static final String ADMIN_FREEIPA_GROUP = \"admins\";\n \n+    private static final boolean INCLUDE_INTERNAL_MACHINE_USERS = true;", "originalCommit": "4fd2053950b4cbab7275a9d42ce4431e4a1f34bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTgyMjc4OA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8964#discussion_r485822788", "bodyText": "We do not want to make this configurable. We always want to include internal machine users. Internal machine users may be identities within the environment. Right now, single user syncs that provide a machineUser crn can sync the user to the environment but then the users will be deleted by a full sync. This is incorrect behavior that we need to fix.\nI don't think there are any internal machineUsers currently in use, but the DWX team is working on creating an internal machine user for their service and potentially the DEX team.\nI'll update the commit message to include more details about the behavior we are fixing", "author": "handavid", "createdAt": "2020-09-09T18:19:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTgwODg2MQ=="}], "type": "inlineReview"}, {"oid": "a6c85ac666369d8eb30322d19af5465e6c132e13", "url": "https://github.com/hortonworks/cloudbreak/commit/a6c85ac666369d8eb30322d19af5465e6c132e13", "message": "CDPCP-2986. Include internal machine users in user sync\n\nInternal machineUsers may be environment users. UMS behavior\nis to return machineUsers if specified by CRN. This means that user\nsync will sync the internal machineUser if specified by CRN but\nthen delete the internal machineUser on a full user sync.\n\nThis commit fixes this behavior by exposing the includeInternal\nflag on the UMS listMachineUsers requests and always setting this\nflag to true when calculating the users state from the UMS.", "committedDate": "2020-09-09T18:20:00Z", "type": "commit"}, {"oid": "a6c85ac666369d8eb30322d19af5465e6c132e13", "url": "https://github.com/hortonworks/cloudbreak/commit/a6c85ac666369d8eb30322d19af5465e6c132e13", "message": "CDPCP-2986. Include internal machine users in user sync\n\nInternal machineUsers may be environment users. UMS behavior\nis to return machineUsers if specified by CRN. This means that user\nsync will sync the internal machineUser if specified by CRN but\nthen delete the internal machineUser on a full user sync.\n\nThis commit fixes this behavior by exposing the includeInternal\nflag on the UMS listMachineUsers requests and always setting this\nflag to true when calculating the users state from the UMS.", "committedDate": "2020-09-09T18:20:00Z", "type": "forcePushed"}]}