{"pr_number": 9642, "pr_title": "CB-10320: Do not enable HBase on S3 for 7.2.6 when Raz is enabled", "pr_createdAt": "2020-12-11T17:47:44Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/9642", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIzNjY3Mg==", "url": "https://github.com/hortonworks/cloudbreak/pull/9642#discussion_r541236672", "bodyText": "Nit: What about UT? If there is no associated test class, it might make sense to add one now.", "author": "lajosrodek", "createdAt": "2020-12-11T20:11:45Z", "path": "template-manager-cmtemplate/src/main/java/com/sequenceiq/cloudbreak/cmtemplate/configproviders/hbase/HbaseCloudStorageServiceConfigProvider.java", "diffHunk": "@@ -54,13 +54,13 @@ public boolean isConfigurationNeeded(CmTemplateProcessor cmTemplateProcessor, Te\n                 .map(SharedServiceConfigsView::isDatalakeCluster)\n                 .orElse(false);\n         String cdhVersion = getCdhVersion(source);\n-        boolean is722OrNewer = isVersionNewerOrEqualThanLimited(cdhVersion, CLOUDERAMANAGER_VERSION_7_2_2);\n+        boolean is727OrNewer = isVersionNewerOrEqualThanLimited(cdhVersion, CLOUDERAMANAGER_VERSION_7_2_7);\n         String accountId = ThreadBasedUserCrnProvider.getAccountId();\n         boolean sdxHbaseCloudStorageEnabled =\n                 entitlementService.sdxHbaseCloudStorageEnabled(accountId);\n         return source.getFileSystemConfigurationView().isPresent()\n                 && cmTemplateProcessor.isRoleTypePresentInService(getServiceType(), getRoleTypes())\n-                && (!datalakeCluster || (is722OrNewer && sdxHbaseCloudStorageEnabled));\n+                && (!datalakeCluster || (is727OrNewer && sdxHbaseCloudStorageEnabled));", "originalCommit": "7aa7f9946c9e6934d0e8780250bf85daa8321bf2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTI2MzY5Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/9642#discussion_r541263697", "bodyText": "UT is updated.", "author": "LinaAtAustin", "createdAt": "2020-12-11T20:37:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIzNjY3Mg=="}], "type": "inlineReview"}, {"oid": "ebf1f194adb060c496bcca5dbb2905335ed952a5", "url": "https://github.com/hortonworks/cloudbreak/commit/ebf1f194adb060c496bcca5dbb2905335ed952a5", "message": "CB-10320: Do not enable HBase on S3 for 7.2.6 when Raz is enabled", "committedDate": "2020-12-11T20:35:38Z", "type": "commit"}, {"oid": "ebf1f194adb060c496bcca5dbb2905335ed952a5", "url": "https://github.com/hortonworks/cloudbreak/commit/ebf1f194adb060c496bcca5dbb2905335ed952a5", "message": "CB-10320: Do not enable HBase on S3 for 7.2.6 when Raz is enabled", "committedDate": "2020-12-11T20:35:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTM3ODkxNw==", "url": "https://github.com/hortonworks/cloudbreak/pull/9642#discussion_r541378917", "bodyText": "mmm so we are switching to Runtime and CM versions being different starting from 7.2.7. I\nThe question now becomes if you should check for the CM version or Cloudera Runtime (CDH) version. If it is Cloudera Runtime version, then we should update the check on runtime (instead of CM).\nIf this should be a CM check, then there is no CM 7.2.7. After CM 7.2.6, it becomes CM 7.3.0. You should follow up with CRB-1455 to understand more about how to check runtime version vs. CM version.", "author": "kmanamcheri", "createdAt": "2020-12-11T22:44:54Z", "path": "template-manager-cmtemplate/src/main/java/com/sequenceiq/cloudbreak/cmtemplate/CMRepositoryVersionUtil.java", "diffHunk": "@@ -32,6 +32,8 @@\n \n     public static final Versioned CLOUDERAMANAGER_VERSION_7_2_6 = () -> \"7.2.6\";\n \n+    public static final Versioned CLOUDERAMANAGER_VERSION_7_2_7 = () -> \"7.2.7\";", "originalCommit": "ebf1f194adb060c496bcca5dbb2905335ed952a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTc1MDQ0OA==", "url": "https://github.com/hortonworks/cloudbreak/pull/9642#discussion_r541750448", "bodyText": "This is not a problem\n\nI get the runtime version from blueprint as input of the check, not CM version. See https://github.com/hortonworks/cloudbreak/blob/master/template-manager-cmtemplate/src/main/java/com/sequenceiq/cloudbreak/cmtemplate/configproviders/hbase/HbaseCloudStorageServiceConfigProvider.java#L66\nAlthough the constant used is defined in the CM utility, we are comparing the stack runtime version against a constant. So the check is still valid even when CM version is different from runtime version. What matters is the meaning of the input variable. see https://github.com/hortonworks/cloudbreak/blob/master/template-manager-cmtemplate/src/main/java/com/sequenceiq/cloudbreak/cmtemplate/configproviders/hbase/HbaseCloudStorageServiceConfigProvider.java#L57", "author": "LinaAtAustin", "createdAt": "2020-12-12T19:32:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTM3ODkxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU4NDYzMw==", "url": "https://github.com/hortonworks/cloudbreak/pull/9642#discussion_r542584633", "bodyText": "Ah that makes sense. Thanks for the information @LinaAtAustin\nsince we are checking for the runtime version and not the CM version, lets change the constant name to \"CLOUDERA_RUNTIE_VERSION_7_2_7\", so its not confusing for future maintainers.", "author": "kmanamcheri", "createdAt": "2020-12-14T17:51:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTM3ODkxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc0NjcwMg==", "url": "https://github.com/hortonworks/cloudbreak/pull/9642#discussion_r542746702", "bodyText": "@kmanamcheri  please open a backburner ticket for this.", "author": "bergerdenes", "createdAt": "2020-12-14T20:28:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTM3ODkxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc5ODg5Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/9642#discussion_r542798897", "bodyText": "ok done https://jira.cloudera.com/browse/CB-10353", "author": "kmanamcheri", "createdAt": "2020-12-14T21:17:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTM3ODkxNw=="}], "type": "inlineReview"}]}