{"pr_number": 7422, "pr_title": "CB-5795 Azure subnet validation improvement: given subnets must exist on azure side", "pr_createdAt": "2020-02-28T13:31:15Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/7422", "timeline": [{"oid": "7bf16bf97a2f72715a2e8d7380144d1329730bb7", "url": "https://github.com/hortonworks/cloudbreak/commit/7bf16bf97a2f72715a2e8d7380144d1329730bb7", "message": "CB-5795 Azure subnet validation improvement: given subnets must exist on azure side", "committedDate": "2020-02-28T13:27:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyODE4MQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/7422#discussion_r385728181", "bodyText": "What if the number of subnets listed is right but one subnet contains a typo?", "author": "gergopapi2", "createdAt": "2020-02-28T14:35:11Z", "path": "environment/src/main/java/com/sequenceiq/environment/environment/validation/network/AzureEnvironmentNetworkValidator.java", "diffHunk": "@@ -50,14 +50,22 @@ public void validateDuringRequest(NetworkDto networkDto, Map<String, CloudSubnet\n         }\n     }\n \n-    private void checkSubnetsProvidedWhenExistingNetwork(ValidationResult.ValidationResultBuilder resultBuilder,\n+    private void checkSubnetsProvidedWhenExistingNetwork(ValidationResult.ValidationResultBuilder resultBuilder, NetworkDto network,\n             AzureParams azureParams, Map<String, CloudSubnet> subnetMetas) {\n-        if (StringUtils.isNotEmpty(azureParams.getNetworkId()) && StringUtils.isNotEmpty(azureParams.getResourceGroupName())\n-                && MapUtils.isEmpty(subnetMetas)) {\n-            String message = String.format(\"If networkId (%s) and resourceGroupName (%s) are specified then subnet ids must be specified as well.\",\n-                    azureParams.getNetworkId(), azureParams.getResourceGroupName());\n-            LOGGER.info(message);\n-            resultBuilder.error(message);\n+        if (StringUtils.isNotEmpty(azureParams.getNetworkId()) && StringUtils.isNotEmpty(azureParams.getResourceGroupName())) {\n+            if (CollectionUtils.isEmpty(network.getSubnetIds())) {\n+                String message = String.format(\"If networkId (%s) and resourceGroupName (%s) are specified then subnet ids must be specified as well.\",\n+                        azureParams.getNetworkId(), azureParams.getResourceGroupName());\n+                LOGGER.info(message);\n+                resultBuilder.error(message);\n+            } else if (subnetMetas.size() != network.getSubnetIds().size()) {", "originalCommit": "7bf16bf97a2f72715a2e8d7380144d1329730bb7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgwODU5OA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7422#discussion_r385808598", "bodyText": "Ah, my mistake, this is right.", "author": "gergopapi2", "createdAt": "2020-02-28T16:56:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcyODE4MQ=="}], "type": "inlineReview"}]}