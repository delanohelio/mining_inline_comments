{"pr_number": 8453, "pr_title": "CB-7701: Capture failures and log them when dropping and creating database for restore.", "pr_createdAt": "2020-06-29T14:28:55Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8453", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAzNjczNw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8453#discussion_r447036737", "bodyText": "Commenting here primarily to do a \"request changes\" review. I think that'll prevent the change from being merged in accidentally. See my general comment for the requested changes.", "author": "hreeve-cloudera", "createdAt": "2020-06-29T14:58:17Z", "path": "orchestrator-salt/src/main/resources/salt/salt/postgresql/disaster_recovery/scripts/restore_db.sh", "diffHunk": "@@ -52,8 +52,8 @@ restore_db_from_local() {\n \n   doLog \"INFO Restoring $SERVICE\"\n \n-  psql --host=\"$HOST\" --port=\"$PORT\" --dbname=\"postgres\" --username=\"$USERNAME\" -c \"drop database ${SERVICE};\"\n-  psql --host=\"$HOST\" --port=\"$PORT\" --dbname=\"postgres\" --username=\"$USERNAME\" -c \"create database ${SERVICE};\"\n+  psql --host=\"$HOST\" --port=\"$PORT\" --dbname=\"postgres\" --username=\"$USERNAME\" -c \"drop database ${SERVICE};\" >>$LOGFILE 2>&1 || errorExit \"Unable to drop database ${SERVICE}\"", "originalCommit": "48a9c0000c996a04f150c04342e370c653275cd2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2b768ddc77a7ed2ae477dc8b4c38742e805cc2e7", "url": "https://github.com/hortonworks/cloudbreak/commit/2b768ddc77a7ed2ae477dc8b4c38742e805cc2e7", "message": "Try to log failures from psql restore.\n\nTee all stderr to log and stderr.", "committedDate": "2020-06-29T16:26:41Z", "type": "forcePushed"}, {"oid": "494ca8fb2ce09cf20593ce51b7b2a68155857932", "url": "https://github.com/hortonworks/cloudbreak/commit/494ca8fb2ce09cf20593ce51b7b2a68155857932", "message": "Try to log failures from psql restore.\n\nTee all stderr to log and stderr.\n\nFix not sending error to stderr.", "committedDate": "2020-06-29T18:18:43Z", "type": "forcePushed"}, {"oid": "0aea6a130355b77c83f0dcdb41a661ccbe834368", "url": "https://github.com/hortonworks/cloudbreak/commit/0aea6a130355b77c83f0dcdb41a661ccbe834368", "message": "Try to log failures from psql restore.\n\nTee all stderr to log and stderr.\n\nFix not sending error to stderr.\n\nFix over-exuberant logging to stdout.", "committedDate": "2020-06-29T18:30:39Z", "type": "commit"}, {"oid": "0aea6a130355b77c83f0dcdb41a661ccbe834368", "url": "https://github.com/hortonworks/cloudbreak/commit/0aea6a130355b77c83f0dcdb41a661ccbe834368", "message": "Try to log failures from psql restore.\n\nTee all stderr to log and stderr.\n\nFix not sending error to stderr.\n\nFix over-exuberant logging to stdout.", "committedDate": "2020-06-29T18:30:39Z", "type": "forcePushed"}]}