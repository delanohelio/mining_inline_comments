{"pr_number": 8811, "pr_title": "CB-8401: Add the operation ID to the FreeIPA logs", "pr_createdAt": "2020-08-14T02:09:03Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8811", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQzOTAyMw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8811#discussion_r470439023", "bodyText": "I think you should add these methods to MDCBuilder as we have it like addEnvCrn", "author": "lacikaaa", "createdAt": "2020-08-14T06:41:44Z", "path": "freeipa/src/main/java/com/sequenceiq/freeipa/service/operation/OperationService.java", "diffHunk": "@@ -99,6 +102,14 @@ public Operation getOperationForAccountIdAndOperationId(String accountId, String\n         return operationOptional.get();\n     }\n \n+    public static void addMdcOperationId(String operationId) {\n+        MDCBuilder.addMdcField(OPERATION_ID_MDC_NAME, operationId);\n+    }\n+\n+    public static void removeMdcOperationId() {\n+        MDCBuilder.removeMdcField(OPERATION_ID_MDC_NAME);\n+    }", "originalCommit": "5c6394cbc51a2651d4e4fd1a9f9d106a71f3dd66", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQzOTQyOA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8811#discussion_r470439428", "bodyText": "@oleewere does this change break kibana log parsing?", "author": "lacikaaa", "createdAt": "2020-08-14T06:42:51Z", "path": "freeipa/src/main/resources/logback.xml", "diffHunk": "@@ -12,7 +12,7 @@\n         <encoder class=\"ch.qos.logback.core.encoder.LayoutWrappingEncoder\">\n             <layout class=\"com.sequenceiq.cloudbreak.logger.MaskingPatternLayout\">\n                 <loggerNameFilter>com.sequenceiq</loggerNameFilter>\n-                <pattern>%date{ISO8601} [%thread] %method:%line %-5level %logger{5} - [type:%X{resourceType:-springLog}] [crn:%X{resourceCrn:-}] [name:%X{resourceName:-}] [flow:%X{flowId:-}] [requestid:%X{requestId:-}] [tenant:%X{tenant:-}] [userCrn:%X{userCrn:-}] [environment:%X{environmentCrn:-}] [traceId:%X{traceId:-}] [spanId:%X{spanId:-}] %msg%n</pattern>\n+                <pattern>%date{ISO8601} [%thread] %method:%line %-5level %logger{5} - [type:%X{resourceType:-springLog}] [crn:%X{resourceCrn:-}] [name:%X{resourceName:-}] [flow:%X{flowId:-}] [requestid:%X{requestId:-}] [tenant:%X{tenant:-}] [userCrn:%X{userCrn:-}] [environment:%X{environmentCrn:-}] [traceId:%X{traceId:-}] [spanId:%X{spanId:-}] [operationId:%X{operationId:-}] %msg%n</pattern>", "originalCommit": "5c6394cbc51a2651d4e4fd1a9f9d106a71f3dd66", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ2OTI2NA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8811#discussion_r476469264", "bodyText": "@lacikaaa nope, we are using JSON formatter on mow envs", "author": "oleewere", "createdAt": "2020-08-25T13:57:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQzOTQyOA=="}], "type": "inlineReview"}, {"oid": "74d89f02ae45ff4602379d69fc8f59e2f0cb5146", "url": "https://github.com/hortonworks/cloudbreak/commit/74d89f02ae45ff4602379d69fc8f59e2f0cb5146", "message": "CB-8401: Add the operation ID to the FreeIPA logs\n\nAdd the operation ID to the FreeIPA logs for repair.\n\nChange the user sync to use the operationId for the operation ID\nrather than the flowId.\n\nEnsure the MDC cleanup happens if an exception is thrown.\n\nThis was tested using a local deployment of cloudbreak.", "committedDate": "2020-08-14T18:58:05Z", "type": "forcePushed"}, {"oid": "041b5e226bc017cd1f10627ebbb930831107316e", "url": "https://github.com/hortonworks/cloudbreak/commit/041b5e226bc017cd1f10627ebbb930831107316e", "message": "CB-8401: Add the operation ID to the FreeIPA logs\n\nAdd the operation ID to the FreeIPA logs for repair.\n\nChange the user sync to use the operationId for the operation ID\nrather than the flowId.\n\nEnsure the MDC cleanup happens if an exception is thrown.\n\nThis was tested using a local deployment of cloudbreak.", "committedDate": "2020-08-24T14:21:55Z", "type": "forcePushed"}, {"oid": "7fd53ed6b6b7e501aeec466ab8b21a30f245250f", "url": "https://github.com/hortonworks/cloudbreak/commit/7fd53ed6b6b7e501aeec466ab8b21a30f245250f", "message": "CB-8401: Add the operation ID to the FreeIPA logs\n\nAdd the operation ID to the FreeIPA logs for repair.\n\nChange the user sync to use the operationId for the operation ID\nrather than the flowId.\n\nEnsure the MDC cleanup happens if an exception is thrown.\n\nThis was tested using a local deployment of cloudbreak.", "committedDate": "2020-08-24T14:53:24Z", "type": "commit"}, {"oid": "7fd53ed6b6b7e501aeec466ab8b21a30f245250f", "url": "https://github.com/hortonworks/cloudbreak/commit/7fd53ed6b6b7e501aeec466ab8b21a30f245250f", "message": "CB-8401: Add the operation ID to the FreeIPA logs\n\nAdd the operation ID to the FreeIPA logs for repair.\n\nChange the user sync to use the operationId for the operation ID\nrather than the flowId.\n\nEnsure the MDC cleanup happens if an exception is thrown.\n\nThis was tested using a local deployment of cloudbreak.", "committedDate": "2020-08-24T14:53:24Z", "type": "forcePushed"}]}