{"pr_number": 8222, "pr_title": "CB-7057: fix null status reason", "pr_createdAt": "2020-06-05T11:37:32Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8222", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTg3NjM1Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8222#discussion_r435876357", "bodyText": "We should not log the last message if it is null", "author": "keyki", "createdAt": "2020-06-05T12:04:53Z", "path": "orchestrator-api/src/main/java/com/sequenceiq/cloudbreak/orchestrator/OrchestratorBootstrapRunner.java", "diffHunk": "@@ -157,9 +157,9 @@ private Boolean checkResult(Boolean success, int retryCount, Exception actualExc\n             nodesWithErrors = ((CloudbreakOrchestratorException) actualException).getNodesWithErrors();\n         }\n         if (retryCount >= maxRetryCount) {\n-            throw new CloudbreakOrchestratorTimeoutException(cause, nodesWithErrors, elapsedTimeRounded);\n+            throw new CloudbreakOrchestratorTimeoutException(errorMessage, nodesWithErrors, elapsedTimeRounded);", "originalCommit": "89d4ace4312983fa11227e8cdb90794a44efe4ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "63be897e0dece2e7abaf23635ff15f3bc4526687", "url": "https://github.com/hortonworks/cloudbreak/commit/63be897e0dece2e7abaf23635ff15f3bc4526687", "message": "CB-7057: fix null status reason", "committedDate": "2020-06-05T14:53:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAwNjY4Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8222#discussion_r436006687", "bodyText": "What happens if the template requires 1 param when the actualException is null, but we pass 2 params with the cause to String.format?", "author": "keyki", "createdAt": "2020-06-05T15:43:31Z", "path": "orchestrator-api/src/main/java/com/sequenceiq/cloudbreak/orchestrator/OrchestratorBootstrapRunner.java", "diffHunk": "@@ -143,23 +143,28 @@ private Boolean checkResult(Boolean success, int retryCount, Exception actualExc\n         }\n \n         String cause = null;\n+        String messageTemplate;\n+        long elapsedTimeRounded = Math.max(Math.round((double) retryCount * SLEEP_TIME / MS_IN_SEC / SEC_IN_MIN), MINIMUM_DISPLAYED_TIME_IN_MIN);\n         if (actualException != null) {\n             cause = actualException.getMessage();\n+            messageTemplate = success == null\n+                    ? \"Timeout: Orchestrator component failed to finish in %d min(s), last message: %s\"\n+                    : \"Failed: Orchestrator component went failed in %d min(s), message: %s\";\n+        } else {\n+            messageTemplate = success == null\n+                    ? \"Timeout: Orchestrator component failed to finish in %d min(s)\"\n+                    : \"Failed: Orchestrator component went failed in %d min(s)\";\n         }\n-        String messageTemplate = success == null\n-                ? \"Timeout: Orchestrator component failed to finish in %d min(s), last message: %s\"\n-                : \"Failed: Orchestrator component went failed in %d min(s), message: %s\";\n-        long elapsedTimeRounded = Math.max(Math.round((double) retryCount * SLEEP_TIME / MS_IN_SEC / SEC_IN_MIN), MINIMUM_DISPLAYED_TIME_IN_MIN);\n         String errorMessage = String.format(messageTemplate, elapsedTimeRounded, cause);", "originalCommit": "63be897e0dece2e7abaf23635ff15f3bc4526687", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAxMjU4Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8222#discussion_r436012587", "bodyText": "According to the Java Doc: If there are more arguments than format specifiers, the extra arguments are ignored.", "author": "tiborpopovics", "createdAt": "2020-06-05T15:53:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAwNjY4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAxNTE2Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8222#discussion_r436015167", "bodyText": "Cool.", "author": "keyki", "createdAt": "2020-06-05T15:58:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAwNjY4Nw=="}], "type": "inlineReview"}, {"oid": "3ee239e4a64ec154a15895389f91e5295b6a2246", "url": "https://github.com/hortonworks/cloudbreak/commit/3ee239e4a64ec154a15895389f91e5295b6a2246", "message": "CB-7057: fix null status reason", "committedDate": "2020-06-08T07:21:28Z", "type": "commit"}, {"oid": "3ee239e4a64ec154a15895389f91e5295b6a2246", "url": "https://github.com/hortonworks/cloudbreak/commit/3ee239e4a64ec154a15895389f91e5295b6a2246", "message": "CB-7057: fix null status reason", "committedDate": "2020-06-08T07:21:28Z", "type": "forcePushed"}]}