{"pr_number": 9651, "pr_title": "CB-9745 Enabling Knox sticky sessions for ui and api requests.", "pr_createdAt": "2020-12-14T22:33:12Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/9651", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzMjUxMw==", "url": "https://github.com/hortonworks/cloudbreak/pull/9651#discussion_r542932513", "bodyText": "Is this enabled for all runtime versions? Is there a way to enable this only for 7.2.7 and above?", "author": "kmanamcheri", "createdAt": "2020-12-14T23:54:33Z", "path": "orchestrator-salt/src/main/resources/salt/salt/gateway/config/cm/topology.xml.j2", "diffHunk": "@@ -198,21 +198,21 @@\n              {% if 'ATLAS' in exposed and 'ATLAS_SERVER' in salt['pillar.get']('gateway:location') -%}\n              <param>\n                  <name>ATLAS</name>\n-                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000</value>\n+                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000;enableStickySessions=true</value>", "originalCommit": "af32c982e4af3d664049d4dae3996ec518ef12de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzQ4NzU2MQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/9651#discussion_r543487561", "bodyText": "All run times, knox should ignore it if it's not supported.  There's no way to make it 7.2.7+ only.", "author": "frozenwizard", "createdAt": "2020-12-15T16:20:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzMjUxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI3MjA0NA==", "url": "https://github.com/hortonworks/cloudbreak/pull/9651#discussion_r543272044", "bodyText": "Why are we not this for HIVE? Hive would be one to benefit the most.", "author": "moresandeep", "createdAt": "2020-12-15T11:41:12Z", "path": "orchestrator-salt/src/main/resources/salt/salt/gateway/config/cm/topology.xml.j2", "diffHunk": "@@ -198,21 +198,21 @@\n              {% if 'ATLAS' in exposed and 'ATLAS_SERVER' in salt['pillar.get']('gateway:location') -%}\n              <param>\n                  <name>ATLAS</name>\n-                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000</value>\n+                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000;enableStickySessions=true</value>\n              </param>\n              <param>\n                  <name>ATLAS-API</name>\n-                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000</value>\n+                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000;enableStickySessions=true</value>\n              </param>\n              {%- endif %}\n              {% if 'CM-API' in exposed and 'CM-API' in salt['pillar.get']('gateway:location') -%}\n              <param>\n                  <name>CM-API</name>\n-                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000</value>\n+                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000;enableStickySessions=true</value>\n              </param>\n              <param>\n                  <name>CM-UI</name>\n-                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000</value>\n+                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000;enableStickySessions=true</value>\n              </param>\n              {%- endif %}\n              {% if 'HIVE' in exposed and 'HIVESERVER2' in salt['pillar.get']('gateway:location') -%}", "originalCommit": "af32c982e4af3d664049d4dae3996ec518ef12de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzQ3MzcxOA==", "url": "https://github.com/hortonworks/cloudbreak/pull/9651#discussion_r543473718", "bodyText": "Hive is connected to by the compute engines, so it shouldn't need this?  Or should it?  I've only done this for the ui/api services.\nAlso it's possible that the datahub would use those configurations as well, I'm not sure if they should be supported?", "author": "frozenwizard", "createdAt": "2020-12-15T16:03:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI3MjA0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzQ4MTIyMg==", "url": "https://github.com/hortonworks/cloudbreak/pull/9651#discussion_r543481222", "bodyText": "The original bug was opened for Hive and I tested this, like dev tested it using beeline for hive.", "author": "moresandeep", "createdAt": "2020-12-15T16:12:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI3MjA0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzQ4NzAwOA==", "url": "https://github.com/hortonworks/cloudbreak/pull/9651#discussion_r543487008", "bodyText": "@orngejaket We want to change only for Datalake right? Is the current code change applicable for Datalake or Datahubs as well?\n@moresandeep I understand that the original one was opened for Hive, but we'd like to use it for Atlas/Ranger and the other components in the datalake.", "author": "kmanamcheri", "createdAt": "2020-12-15T16:19:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI3MjA0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzY3MjE3OA==", "url": "https://github.com/hortonworks/cloudbreak/pull/9651#discussion_r543672178", "bodyText": "We should be careful with this, there are some edge cases that could cause issues with retries.\nAlso, Atlas is active/passive so HA will not work there.", "author": "moresandeep", "createdAt": "2020-12-15T20:42:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI3MjA0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzQ4MDMxMw==", "url": "https://github.com/hortonworks/cloudbreak/pull/9651#discussion_r543480313", "bodyText": "This would break Atlas, we should not be using Knox HA for atlas since it is active-passive. adding stickysession would break it badly.", "author": "moresandeep", "createdAt": "2020-12-15T16:11:20Z", "path": "orchestrator-salt/src/main/resources/salt/salt/gateway/config/cm/topology.xml.j2", "diffHunk": "@@ -198,21 +198,21 @@\n              {% if 'ATLAS' in exposed and 'ATLAS_SERVER' in salt['pillar.get']('gateway:location') -%}\n              <param>\n                  <name>ATLAS</name>\n-                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000</value>\n+                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000;enableStickySessions=true</value>\n              </param>\n              <param>\n                  <name>ATLAS-API</name>\n-                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000</value>\n+                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000;enableStickySessions=true</value>", "originalCommit": "af32c982e4af3d664049d4dae3996ec518ef12de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTUxOTA3NA==", "url": "https://github.com/hortonworks/cloudbreak/pull/9651#discussion_r551519074", "bodyText": "Ok so no changes to Atlas then?", "author": "frozenwizard", "createdAt": "2021-01-04T19:26:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzQ4MDMxMw=="}], "type": "inlineReview"}, {"oid": "72b32c80eead4cdc51a7bc5d85f06beaf91c533f", "url": "https://github.com/hortonworks/cloudbreak/commit/72b32c80eead4cdc51a7bc5d85f06beaf91c533f", "message": "CB-9745 Enable Knox backend round robin to hosts\n\nThis enables Ranger UI/API, Solr, Hive and Phoenix to loadbalance to the other Knox server.", "committedDate": "2021-04-02T15:13:30Z", "type": "forcePushed"}, {"oid": "fc55bbaf3ca1a625176b54077f1c10d37c71f607", "url": "https://github.com/hortonworks/cloudbreak/commit/fc55bbaf3ca1a625176b54077f1c10d37c71f607", "message": "CB-9745 Enable Knox backend round robin to hosts\n\nThis enables Ranger UI/API, Solr, Hive and Phoenix to loadbalance to the other Knox server.", "committedDate": "2021-04-05T19:55:38Z", "type": "forcePushed"}, {"oid": "0b230d92524e16e8588d90773f2106449a460e4a", "url": "https://github.com/hortonworks/cloudbreak/commit/0b230d92524e16e8588d90773f2106449a460e4a", "message": "CB-9745 Enable Knox backend round robin to hosts\n\nThis enables Ranger UI/API, Solr, Hive and Phoenix to loadbalance to the other Knox server.", "committedDate": "2021-04-07T15:21:12Z", "type": "commit"}, {"oid": "0b230d92524e16e8588d90773f2106449a460e4a", "url": "https://github.com/hortonworks/cloudbreak/commit/0b230d92524e16e8588d90773f2106449a460e4a", "message": "CB-9745 Enable Knox backend round robin to hosts\n\nThis enables Ranger UI/API, Solr, Hive and Phoenix to loadbalance to the other Knox server.", "committedDate": "2021-04-07T15:21:12Z", "type": "forcePushed"}]}