{"pr_number": 9348, "pr_title": "CB-9545 use JpaRepository getOne() instead of EntityManager", "pr_createdAt": "2020-10-30T15:49:31Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/9348", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ3MTcwNA==", "url": "https://github.com/hortonworks/cloudbreak/pull/9348#discussion_r515471704", "bodyText": "Please add a detailed commit message that why we need to change it, what problem is caused by the old solution. I just want to avoid that situation that a year from now somebody would accidentally/intentionally write it back.\nPlease also double-check whether we could eliminate the following lines from DatabaseConfig java files.\n   @Bean\n    public EntityManager entityManager(EntityManagerFactory entityManagerFactory) {\n        return entityManagerFactory.createEntityManager();\n    }\n\n\n\n  \n    \n      cloudbreak/autoscale/src/main/java/com/sequenceiq/periscope/config/DatabaseConfig.java\n    \n    \n         Line 119\n      in\n      fe089b5\n    \n    \n    \n    \n\n        \n          \n           return entityManagerFactory.createEntityManager();", "author": "akanto", "createdAt": "2020-10-31T08:17:55Z", "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/eventbus/CloudResourcePersisterService.java", "diffHunk": "@@ -31,7 +32,7 @@\n     @Inject\n     private ResourceService resourceService;\n \n-    @Inject\n+    @PersistenceContext", "originalCommit": "d7a98602c9907d7ec81b62a701b9a2d10ff1bc1f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU5NDUxMg==", "url": "https://github.com/hortonworks/cloudbreak/pull/9348#discussion_r515594512", "bodyText": "Detailed commit message and java comment added.\nIt seems the referred DatabaseConfig lines can be removed, applications are able to start without these lines.", "author": "sodre90", "createdAt": "2020-11-01T09:50:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ3MTcwNA=="}], "type": "inlineReview"}, {"oid": "98098fa949c884f178a2cbd9f12e750b1273142f", "url": "https://github.com/hortonworks/cloudbreak/commit/98098fa949c884f178a2cbd9f12e750b1273142f", "message": "CB-9545 use @PersistenceContext for EntityManager\n\nOn mow-int QE got some `Session/EntityManager is closed` error message for some of their clusters. Our assumption with @lnardai the problem could be `EntityManager` is injected by `@Inject` in `CloudResourcePersisterService` instead of `@PersistenceContext`. `@PersistenceContext` takes care to create a unique `EntityManager` for every thread.", "committedDate": "2020-11-01T08:14:46Z", "type": "forcePushed"}, {"oid": "61ad89bb53dc362aa039ffddf303a68089db8aa6", "url": "https://github.com/hortonworks/cloudbreak/commit/61ad89bb53dc362aa039ffddf303a68089db8aa6", "message": "CB-9545 use @PersistenceContext for EntityManager\n\nOn mow-int QE got some `Session/EntityManager is closed` error message for some of their clusters. Our assumption with @lnardai the problem could be `EntityManager` is injected by `@Inject` in `CloudResourcePersisterService` instead of `@PersistenceContext`. `@PersistenceContext` takes care to create a unique `EntityManager` for every thread.", "committedDate": "2020-11-01T08:47:09Z", "type": "forcePushed"}, {"oid": "ec1c98b268504bc50c4f7e4448dae176719e46fc", "url": "https://github.com/hortonworks/cloudbreak/commit/ec1c98b268504bc50c4f7e4448dae176719e46fc", "message": "CB-9545 use JpaRepository getOne() instead of EntityManager", "committedDate": "2020-11-02T08:53:37Z", "type": "forcePushed"}, {"oid": "777863dbe664fc8610f7cab2ef68a79bb3c1beeb", "url": "https://github.com/hortonworks/cloudbreak/commit/777863dbe664fc8610f7cab2ef68a79bb3c1beeb", "message": "CB-9545 use JpaRepository getOne() instead of EntityManager", "committedDate": "2020-11-02T09:22:31Z", "type": "commit"}, {"oid": "777863dbe664fc8610f7cab2ef68a79bb3c1beeb", "url": "https://github.com/hortonworks/cloudbreak/commit/777863dbe664fc8610f7cab2ef68a79bb3c1beeb", "message": "CB-9545 use JpaRepository getOne() instead of EntityManager", "committedDate": "2020-11-02T09:22:31Z", "type": "forcePushed"}]}