{"pr_number": 9329, "pr_title": "Merge CB-2.32.0 branch into master", "pr_createdAt": "2020-10-29T11:48:52Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/9329", "timeline": [{"oid": "2f06c9d8e23eb3cc303f7542012dbc9510637b24", "url": "https://github.com/hortonworks/cloudbreak/commit/2f06c9d8e23eb3cc303f7542012dbc9510637b24", "message": "CB-9506 - YCloud hybrid env test failure on teardown, so tearDown method has been removed from the test class since it has a duplicated functionality that breaks the test", "committedDate": "2020-10-28T15:39:28Z", "type": "commit"}, {"oid": "0d77295c3674ba90b96f3185de2564c9d39e60f1", "url": "https://github.com/hortonworks/cloudbreak/commit/0d77295c3674ba90b96f3185de2564c9d39e60f1", "message": "CB-9289 Redbeams ssl integration for supporting cloud provider related certs. This PR also helps to identify that customer would like to use the offical provider cert or they preffer BYO scenario", "committedDate": "2020-10-28T19:23:14Z", "type": "commit"}, {"oid": "0675b84ea506e8e1cf7d6686ad58f52616a8a0f3", "url": "https://github.com/hortonworks/cloudbreak/commit/0675b84ea506e8e1cf7d6686ad58f52616a8a0f3", "message": "CB-8107 CB-8108 Enable SSL enforcement for AWS & Azure DL external DB\n\n* Rebased onto #9215\n* Enable SSL enforcement for the external DB of data lakes. The list of\n  cloud platforms where this is applied is controlled by the new\n  Datalake service property\n  datalake.supported.externaldb.sslenforcement.platform (see\n  PlatformConfig.dbServiceSslEnforcementSupportedPlatforms).\n  * In AWS, the CF stack is extended with a new\n    AWS::RDS::DBParameterGroup resource that has rds.force_ssl=1.\n    Supported engine versions: 9.5, 9.6, 10.x, 11.x, 12.x, 13.x.\n  * In Azure, the Microsoft.DBforPostgreSQL/servers resource will\n    have sslEnforcement=Enabled and minimalTlsVersion=TLS1_2.\n* Data hub DBs and embedded DBs of any cluster type are not affected.\n* Added new unit tests and updated existing ones to use JUnit 5 and\n  AssertJ.", "committedDate": "2020-10-28T19:23:14Z", "type": "commit"}, {"oid": "51bb63722c98c2aa4b59e7829d22a13ea94c4a4d", "url": "https://github.com/hortonworks/cloudbreak/commit/51bb63722c98c2aa4b59e7829d22a13ea94c4a4d", "message": "Fix of SQL migration scripts", "committedDate": "2020-10-28T19:23:14Z", "type": "commit"}, {"oid": "b7bb64bdda30e8e9a733fa88a99fcc819361d5c9", "url": "https://github.com/hortonworks/cloudbreak/commit/b7bb64bdda30e8e9a733fa88a99fcc819361d5c9", "message": "CB-8114 save related remote databases' root SSL certificates to cluster", "committedDate": "2020-10-28T19:23:14Z", "type": "commit"}, {"oid": "021fee092493b9ff60387baa224a9e0828c28403", "url": "https://github.com/hortonworks/cloudbreak/commit/021fee092493b9ff60387baa224a9e0828c28403", "message": "CB-8114 save gathered certs into separated pillar and save it to file on every node", "committedDate": "2020-10-28T19:23:14Z", "type": "commit"}, {"oid": "d221eda480b8dcc5c842f141704618fe71991e24", "url": "https://github.com/hortonworks/cloudbreak/commit/d221eda480b8dcc5c842f141704618fe71991e24", "message": "CB-8107 CB-8108 Apply DL external DB SSL enforcement only for >= 7.2.2", "committedDate": "2020-10-28T19:23:14Z", "type": "commit"}, {"oid": "c97069b43a1c844295cdf0a6b56da404244c675c", "url": "https://github.com/hortonworks/cloudbreak/commit/c97069b43a1c844295cdf0a6b56da404244c675c", "message": "CB-8788 replace/append CM's JDBC connection URL in db.properties in case of client side remote database root certificate validation", "committedDate": "2020-10-28T19:23:14Z", "type": "commit"}, {"oid": "40a37edad7034fe9a9890c5729a13f6096731fab", "url": "https://github.com/hortonworks/cloudbreak/commit/40a37edad7034fe9a9890c5729a13f6096731fab", "message": "CB-8107 CB-8108 Check for DB param group only when using SSL enforcement", "committedDate": "2020-10-28T19:23:14Z", "type": "commit"}, {"oid": "fdd1ede0bb549cf6476c487a3d818033f1adee6a", "url": "https://github.com/hortonworks/cloudbreak/commit/fdd1ede0bb549cf6476c487a3d818033f1adee6a", "message": "CB-8114 unit tests for RedbeamsDbCertificateProvider.java", "committedDate": "2020-10-28T19:23:14Z", "type": "commit"}, {"oid": "327d95440ceeee8774cd926d249f6ef445127340", "url": "https://github.com/hortonworks/cloudbreak/commit/327d95440ceeee8774cd926d249f6ef445127340", "message": "CB-8789 Configure DB TLS for DL cluster services & DH HMS\n\n* Persist DB SSL status in RDSConfig\n  * Currently populated for external DBs only\n* Return DB SSL status in RDSDetails\n* Additions to RdsView:\n  * DB SSL status\n  * SSL certificate file path; empty when not using SSL\n  * ConnectionURL extended wit SSL options as necessary\n* Add new compile dependency to\n  template-manager-cmtemplate/build.gradle:\n  org.apache.commons:commons-text:1.5\n* Inject DB SSL configs for HMS and Ranger Admin\n* Honor custom HMS DB settings in cluster template\n* Add new unit tests and migrate existing ones to JUnit 5 & AssertJ", "committedDate": "2020-10-28T19:23:14Z", "type": "commit"}, {"oid": "f5aeb066359286673dc41d7d65ffb7fb1002d096", "url": "https://github.com/hortonworks/cloudbreak/commit/f5aeb066359286673dc41d7d65ffb7fb1002d096", "message": "CB-9434 CB-9437 Entitlement check for DB TLS\n\n* Apply DL external DB SSL enforcement only if entitlement\n  CDP_CB_DATABASE_WIRE_ENCRYPTION has been granted.\n* The presence of CDP_CB_DATABASE_WIRE_ENCRYPTION in\n  MockUserManagementService.getAccount() is conditional, depending on\n  the app system property auth.mock.database.wire.encryption.enable .\n* Minor Redbeams SSL API cleanup: SslConfigurationV4Request renamed to\n  SslConfigV4Request, AllocateDatabaseServerV4Request.sslConfiguration\n  renamed to sslConfig, correct field / type descriptions.\n* Add & enhance unit tests.", "committedDate": "2020-10-28T19:23:14Z", "type": "commit"}, {"oid": "db9ac4b87344ffac8b662cf2c3f4784ae425d916", "url": "https://github.com/hortonworks/cloudbreak/commit/db9ac4b87344ffac8b662cf2c3f4784ae425d916", "message": "CB-9154 Add ssl root cert and ssl mode to PGSQL settings.\n\n* Check if root cert file exists.\n* Opt in to verify-full and provide the root cert if it does exist.\n* Follow default behavior if it doesn't.", "committedDate": "2020-10-29T08:43:31Z", "type": "commit"}, {"oid": "1f0c915bb4b961d2df0a187c541dc7ed238421da", "url": "https://github.com/hortonworks/cloudbreak/commit/1f0c915bb4b961d2df0a187c541dc7ed238421da", "message": "Look up root cert from pillar.", "committedDate": "2020-10-29T08:43:31Z", "type": "commit"}, {"oid": "21ae7017a0136c61a61c8c270275c0a2d2b3ba6d", "url": "https://github.com/hortonworks/cloudbreak/commit/21ae7017a0136c61a61c8c270275c0a2d2b3ba6d", "message": "CB-9452 Fix image import/export issue for Google cloud\n\n1. Google for their default centos 7 deprecated SECURE_BOOT guest os feature and started using UEFI_COMPATIBLE flag\n2. When we import such images without this flag, then instances could not be created from that\n3. Tested by importing this flag with gcloud apis and made sure that the instance booted properly.", "committedDate": "2020-10-29T12:26:30Z", "type": "commit"}, {"oid": "921cdfedd8a92aa5ddb5f429c69d94673ae4c77f", "url": "https://github.com/hortonworks/cloudbreak/commit/921cdfedd8a92aa5ddb5f429c69d94673ae4c77f", "message": "CB-9493 Cloudbreak user is appended at the end of the ssh key because of the new Gcloud ssh key format", "committedDate": "2020-10-29T12:26:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDI2OTMwMQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/9329#discussion_r514269301", "bodyText": "I think these two lines should be added back.", "author": "lajosrodek", "createdAt": "2020-10-29T13:45:18Z", "path": "auth-connector/src/test/java/com/sequenceiq/cloudbreak/auth/altus/EntitlementServiceTest.java", "diffHunk": "@@ -43,10 +43,8 @@\n \n     static Object[][] entitlementCheckDataProvider() {\n         return new Object[][]{\n-                // entitlementName, function, enabled\n-                {\"CDP_AZURE\", (EntitlementCheckFunction) EntitlementService::azureEnabled, false},\n-                {\"CDP_AZURE\", (EntitlementCheckFunction) EntitlementService::azureEnabled, true},", "originalCommit": "ff86e7576ba7a1c8ad4281df077c1b5eac4674a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDMwMjU2OQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/9329#discussion_r514302569", "bodyText": "Nice catch, thanks It was not a usual merge \ud83d\ude04", "author": "biharitomi", "createdAt": "2020-10-29T14:29:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDI2OTMwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDMwOTIzMA==", "url": "https://github.com/hortonworks/cloudbreak/pull/9329#discussion_r514309230", "bodyText": "Sure. Life would be too easy without (merge) conflicts. \ud83d\ude08", "author": "lajosrodek", "createdAt": "2020-10-29T14:37:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDI2OTMwMQ=="}], "type": "inlineReview"}, {"oid": "909c36367c48eb0709d338f3d643f92d5ed20f41", "url": "https://github.com/hortonworks/cloudbreak/commit/909c36367c48eb0709d338f3d643f92d5ed20f41", "message": "Merge remote-tracking branch 'origin/CB-2.32.0' into master", "committedDate": "2020-10-29T15:39:21Z", "type": "commit"}, {"oid": "909c36367c48eb0709d338f3d643f92d5ed20f41", "url": "https://github.com/hortonworks/cloudbreak/commit/909c36367c48eb0709d338f3d643f92d5ed20f41", "message": "Merge remote-tracking branch 'origin/CB-2.32.0' into master", "committedDate": "2020-10-29T15:39:21Z", "type": "forcePushed"}]}