{"pr_number": 8806, "pr_title": "ENGESC-3681 Cluster expansion hung after hitting EC2 limit. An attemp\u2026", "pr_createdAt": "2020-08-13T12:15:15Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8806", "timeline": [{"oid": "759becaa44e3c0a4c058c0432e2cfa6f3236bec9", "url": "https://github.com/hortonworks/cloudbreak/commit/759becaa44e3c0a4c058c0432e2cfa6f3236bec9", "message": "ENGESC-3681 Cluster expansion hung after hitting EC2 limit. An attempt to increase the size of a data hub cluster failed due to an AWS quota limit, but the operation in CB isn't timing out or canceling. I'm decreasing the timeout from 13,5H to 0,5H and I am checking the last activity whether is failed or not. If it failed, the upscale will be aborted.", "committedDate": "2020-08-14T15:06:36Z", "type": "forcePushed"}, {"oid": "ac056fcc05573b5c895c6f803d856707428731ab", "url": "https://github.com/hortonworks/cloudbreak/commit/ac056fcc05573b5c895c6f803d856707428731ab", "message": "ENGESC-3681 Cluster expansion hung after hitting EC2 limit. An attempt to increase the size of a data hub cluster failed due to an AWS quota limit, but the operation in CB isn't timing out or canceling. I'm decreasing the timeout from 13,5H to 0,5H and I am checking the last activity whether is failed or not. If it failed, the upscale will be aborted.", "committedDate": "2020-08-14T15:11:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY5OTY4NQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8806#discussion_r470699685", "bodyText": "Wouldn't it be better to have a solid try-catch on this provider call?", "author": "biharitomi", "createdAt": "2020-08-14T15:33:13Z", "path": "cloud-aws/src/main/java/com/sequenceiq/cloudbreak/cloud/aws/connector/resource/AwsAutoScalingService.java", "diffHunk": "@@ -143,6 +149,27 @@ private void waitForGroup(AmazonEC2Client amClient, AmazonAutoScalingClient asCl\n         }\n     }\n \n+    private void checkLastScalingActivity(AmazonAutoScalingClient asClient, AmazonAutoScalingRetryClient asRetryClient, String autoScalingGroupName,\n+            Date timeBeforeASUpdate) throws AmazonAutoscalingFailed {\n+        try {\n+            Waiter<DescribeScalingActivitiesRequest> autoscalingActivitesWaiter = customAmazonWaiterProvider\n+                    .getAutoscalingActivitesWaiter(asClient, timeBeforeASUpdate);\n+            autoscalingActivitesWaiter.run(new WaiterParameters<>(new DescribeScalingActivitiesRequest().withAutoScalingGroupName(autoScalingGroupName)));\n+        } catch (Exception e) {\n+            LOGGER.error(\"Failed to list activities: {}\", e.getMessage(), e);\n+            throw new AmazonAutoscalingFailed(e.getMessage(), e);\n+        }\n+        DescribeScalingActivitiesResult describeScalingActivitiesResult = asRetryClient", "originalCommit": "ac056fcc05573b5c895c6f803d856707428731ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c6d4815f0bc86ffba2240750e04d412debfa9c4d", "url": "https://github.com/hortonworks/cloudbreak/commit/c6d4815f0bc86ffba2240750e04d412debfa9c4d", "message": "ENGESC-3681 Cluster expansion hung after hitting EC2 limit. An attempt to increase the size of a data hub cluster failed due to an AWS quota limit, but the operation in CB isn't timing out or canceling. I'm decreasing the timeout from 13,5H to 0,5H and I am checking the last activity whether is failed or not. If it failed, the upscale will be aborted.", "committedDate": "2020-08-17T11:57:46Z", "type": "forcePushed"}, {"oid": "a5647ebb1438d0d84a5f8fd21e0f8377359a6a46", "url": "https://github.com/hortonworks/cloudbreak/commit/a5647ebb1438d0d84a5f8fd21e0f8377359a6a46", "message": "ENGESC-3681 Cluster expansion hung after hitting EC2 limit. An attempt to increase the size of a data hub cluster failed due to an AWS quota limit, but the operation in CB isn't timing out or canceling. I'm decreasing the timeout from 13,5H to 0,5H and I am checking the last activity whether is failed or not. If it failed, the upscale will be aborted.", "committedDate": "2020-08-17T12:10:11Z", "type": "forcePushed"}, {"oid": "25f2bbe562674577256fe2c5d52dac94169ced34", "url": "https://github.com/hortonworks/cloudbreak/commit/25f2bbe562674577256fe2c5d52dac94169ced34", "message": "ENGESC-3681 Cluster expansion hung after hitting EC2 limit. An attempt to increase the size of a data hub cluster failed due to an AWS quota limit, but the operation in CB isn't timing out or canceling. I'm decreasing the timeout from 13,5H to 0,5H and I am checking the last activity whether is failed or not. If it failed, the upscale will be aborted.", "committedDate": "2020-08-17T13:05:53Z", "type": "commit"}, {"oid": "25f2bbe562674577256fe2c5d52dac94169ced34", "url": "https://github.com/hortonworks/cloudbreak/commit/25f2bbe562674577256fe2c5d52dac94169ced34", "message": "ENGESC-3681 Cluster expansion hung after hitting EC2 limit. An attempt to increase the size of a data hub cluster failed due to an AWS quota limit, but the operation in CB isn't timing out or canceling. I'm decreasing the timeout from 13,5H to 0,5H and I am checking the last activity whether is failed or not. If it failed, the upscale will be aborted.", "committedDate": "2020-08-17T13:05:53Z", "type": "forcePushed"}]}