{"pr_number": 8441, "pr_title": "CB-7360 Speed up handling of encrypted EBS", "pr_createdAt": "2020-06-28T01:18:35Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8441", "timeline": [{"oid": "0303e48ca79d8f5a5c49249fe68a8cb98a6c244f", "url": "https://github.com/hortonworks/cloudbreak/commit/0303e48ca79d8f5a5c49249fe68a8cb98a6c244f", "message": "CB-7360 Speed up handling of encrypted EBS\n\nSquashed commits:\nCB-7360 Add unit tests; fix aws-cf-dbstack.ftl JSON error", "committedDate": "2020-06-28T00:54:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzUzOTIxMA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8441#discussion_r447539210", "bodyText": "Minor, we could introduce a new method to replace group.getReferenceInstanceConfiguration().getTemplate() with getReferenceTemplate as it is used at many places.", "author": "keyki", "createdAt": "2020-06-30T09:19:49Z", "path": "cloud-aws/src/main/java/com/sequenceiq/cloudbreak/cloud/aws/resource/AwsVolumeResourceBuilder.java", "diffHunk": "@@ -226,18 +229,39 @@ private String getAvailabilityZoneFromSubnet(AuthenticatedContext auth, CloudRes\n                 .build();\n     }\n \n-    private Function<VolumeSetAttributes.Volume, CreateVolumeRequest> createVolumeRequest(String snapshotId, TagSpecification tagSpecification,\n-            VolumeSetAttributes volumeSet) {\n-        return volume -> new CreateVolumeRequest()\n-                .withAvailabilityZone(volumeSet.getAvailabilityZone())\n-                .withSize(volume.getSize())\n-                .withSnapshotId(snapshotId)\n-                .withTagSpecifications(tagSpecification)\n-                .withVolumeType(volume.getType());\n+    private boolean isFastEbsEncryptionEnabled(Group group) {\n+        return new AwsInstanceView(group.getReferenceInstanceConfiguration().getTemplate()).isFastEbsEncryptionEnabled();", "originalCommit": "0303e48ca79d8f5a5c49249fe68a8cb98a6c244f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU3NTMzMQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8441#discussion_r447575331", "bodyText": "Good idea, will do that in a follow-up PR. \ud83d\udc4d", "author": "lajosrodek", "createdAt": "2020-06-30T10:19:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzUzOTIxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI1OTgzNw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8441#discussion_r449259837", "bodyText": "See #8482.", "author": "lajosrodek", "createdAt": "2020-07-02T20:50:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzUzOTIxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU0MTYwOQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8441#discussion_r447541609", "bodyText": "Is this a bug being fixed? What does it cause if we have the , there?", "author": "keyki", "createdAt": "2020-06-30T09:23:38Z", "path": "cloud-aws/src/main/resources/templates/aws-cf-dbstack.ftl", "diffHunk": "@@ -89,7 +89,7 @@\n     \"VPCSecurityGroupsParameter\": {\n         \"Type\": \"List<AWS::EC2::SecurityGroup::Id>\",\n         \"Description\": \"VPC security groups\"\n-    },\n+    }", "originalCommit": "0303e48ca79d8f5a5c49249fe68a8cb98a6c244f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU3MDA3MQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8441#discussion_r447570071", "bodyText": "Yes, it is a malformed JSON. I noticed this when adding a unit test case. I wonder if anyone has used that code path before, otherwise CF would have rejected the request (unless their JSON parser is lenient enough to ignore such extra commas).", "author": "lajosrodek", "createdAt": "2020-06-30T10:10:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU0MTYwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU3MTQ1Mg==", "url": "https://github.com/hortonworks/cloudbreak/pull/8441#discussion_r447571452", "bodyText": "In particular, each test case of CloudFormationTemplateBuilderDBTest starts with the assertion assertThat(JsonUtil.isValid(result)).overridingErrorMessage(\"Invalid JSON: \" + result).isTrue();. This failed due to the above extra comma.", "author": "lajosrodek", "createdAt": "2020-06-30T10:12:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU0MTYwOQ=="}], "type": "inlineReview"}]}