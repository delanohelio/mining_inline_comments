{"pr_number": 8685, "pr_title": "CB-8236: Fix repair to ensure freeipa servers are removed", "pr_createdAt": "2020-07-31T17:32:40Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8685", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDMyMjgzNg==", "url": "https://github.com/hortonworks/cloudbreak/pull/8685#discussion_r464322836", "bodyText": "EventHandler is deprecated, could you switch to ExceptionCatcherEventHandler?", "author": "lacikaaa", "createdAt": "2020-08-03T10:15:03Z", "path": "freeipa/src/main/java/com/sequenceiq/freeipa/flow/freeipa/downscale/handler/CollectAdditionalHostnamesHandler.java", "diffHunk": "@@ -0,0 +1,67 @@\n+package com.sequenceiq.freeipa.flow.freeipa.downscale.handler;\n+\n+import com.sequenceiq.cloudbreak.common.event.Selectable;\n+import com.sequenceiq.flow.event.EventSelectorUtil;\n+import com.sequenceiq.flow.reactor.api.handler.EventHandler;\n+import com.sequenceiq.freeipa.client.FreeIpaClient;\n+import com.sequenceiq.freeipa.client.FreeIpaClientException;\n+import com.sequenceiq.freeipa.client.model.IpaServer;\n+import com.sequenceiq.freeipa.flow.freeipa.downscale.event.DownscaleFailureEvent;\n+import com.sequenceiq.freeipa.flow.freeipa.downscale.event.collecthostnames.CollectAdditionalHostnamesRequest;\n+import com.sequenceiq.freeipa.flow.freeipa.downscale.event.collecthostnames.CollectAdditionalHostnamesResponse;\n+import com.sequenceiq.freeipa.service.freeipa.FreeIpaClientFactory;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+import reactor.bus.Event;\n+import reactor.bus.EventBus;\n+\n+import javax.inject.Inject;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+@Component\n+public class CollectAdditionalHostnamesHandler implements EventHandler<CollectAdditionalHostnamesRequest> {", "originalCommit": "6a6ca8214638d5c1a1407b8f0dc66c37e0faee2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "244b04289c22bafbf492fe60418cc97e529cde3c", "url": "https://github.com/hortonworks/cloudbreak/commit/244b04289c22bafbf492fe60418cc97e529cde3c", "message": "CB-8236: Fix repair to ensure freeipa servers are removed\n\nEnsure old deleted FreeIPA servers are cleaned up during repair. In\naddition the the expected hostnames, check FreeIPA for unexpected\nhostnames and add these hostnames to the list of hostnames are are\ncleaned up during the downscale process of FreeIPA repair.\n\nThis was tested locally on a cluster that was failing due to\npreviously deleted FreeIPA servers still being listed in FreeIPA when\nthe 'ipa server-find' commmand was run.", "committedDate": "2020-08-03T21:08:02Z", "type": "commit"}, {"oid": "244b04289c22bafbf492fe60418cc97e529cde3c", "url": "https://github.com/hortonworks/cloudbreak/commit/244b04289c22bafbf492fe60418cc97e529cde3c", "message": "CB-8236: Fix repair to ensure freeipa servers are removed\n\nEnsure old deleted FreeIPA servers are cleaned up during repair. In\naddition the the expected hostnames, check FreeIPA for unexpected\nhostnames and add these hostnames to the list of hostnames are are\ncleaned up during the downscale process of FreeIPA repair.\n\nThis was tested locally on a cluster that was failing due to\npreviously deleted FreeIPA servers still being listed in FreeIPA when\nthe 'ipa server-find' commmand was run.", "committedDate": "2020-08-03T21:08:02Z", "type": "forcePushed"}]}