{"pr_number": 7030, "pr_title": "CB-4578 - Allow base image usage only based on entitlement system", "pr_createdAt": "2020-01-08T15:01:50Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/7030", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDkwMzk2NQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/7030#discussion_r364903965", "bodyText": "This log message might not be correct.", "author": "keyki", "createdAt": "2020-01-09T18:49:59Z", "path": "core/src/main/java/com/sequenceiq/cloudbreak/controller/StackCreatorService.java", "diffHunk": "@@ -386,14 +392,20 @@ private Blueprint determineBlueprint(StackV4Request stackRequest, Workspace work\n         if (clusterRequest == null) {\n             return null;\n         }\n+        boolean shouldUseBaseCMImage = shouldUseBaseCMImage(clusterRequest);\n+        boolean baseImageEnabled = imageCatalogService.baseImageEnabled();\n         return executorService.submit(() -> {\n-            try {\n-                boolean base = shouldUseBaseCMImage(clusterRequest);\n-                LOGGER.info(\"The stack with name {} will use base image: {}\", stackName, base);\n-                return imageService.determineImageFromCatalog(workspace.getId(), stackRequest.getImage(), platformString, blueprint, base, user, image -> true);\n-            } catch (CloudbreakImageNotFoundException | CloudbreakImageCatalogException e) {\n-                throw new BadRequestException(e.getMessage(), e);\n-            }\n+\n+            LOGGER.info(\"The stack with name {} will use base image: {}\", stackName, shouldUseBaseCMImage);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDkwNDUzMg==", "url": "https://github.com/hortonworks/cloudbreak/pull/7030#discussion_r364904532", "bodyText": "exiting typo", "author": "keyki", "createdAt": "2020-01-09T18:51:15Z", "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/image/ImageCatalogService.java", "diffHunk": "@@ -146,14 +149,14 @@ public ImageCatalog findByResourceCrn(String resourceCrn) {\n \n     public Images getImagesByCatalogName(Long workspaceId, String catalogName, String stackName, String platform) throws CloudbreakImageCatalogException {\n         if (isNotEmpty(platform) && isNotEmpty(stackName)) {\n-            throw new BadRequestException(\"Platform or stackName cannot be filled in the same request.\");\n+            throw new BadRequestException(\"Both platform and exiting stack name could not be present in the request.\");", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDkwNTg4MQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/7030#discussion_r364905881", "bodyText": "fix or delete", "author": "keyki", "createdAt": "2020-01-09T18:54:18Z", "path": "core/src/test/java/com/sequenceiq/cloudbreak/service/image/ImageCatalogServiceTest.java", "diffHunk": "@@ -631,7 +639,7 @@ public void testGetByWorkspaceIfDtoIsNullThenIllegalArgumentExceptionComes() {\n     public void testPopulateCrnCorrectly() {\n         ImageCatalog imageCatalog = getImageCatalog();\n \n-        when(userService.getOrCreate(any(CloudbreakUser.class))).thenReturn(user);\n+        //when(userService.getOrCreate(any(CloudbreakUser.class))).thenReturn(user);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a4cc85067459ac0eef7147c6104d02f1129a953d", "url": "https://github.com/hortonworks/cloudbreak/commit/a4cc85067459ac0eef7147c6104d02f1129a953d", "message": "CB-4578 - Allow base image usage only based on entitlement system", "committedDate": "2020-01-09T20:56:19Z", "type": "forcePushed"}, {"oid": "52a557ac4369ddd48cd606d1aa49ef7196970902", "url": "https://github.com/hortonworks/cloudbreak/commit/52a557ac4369ddd48cd606d1aa49ef7196970902", "message": "CB-4578 - Allow base image usage only based on entitlement system", "committedDate": "2020-01-10T14:55:14Z", "type": "forcePushed"}, {"oid": "bf2b3c03f48362252f9a11886f5eb32bb09b1aac", "url": "https://github.com/hortonworks/cloudbreak/commit/bf2b3c03f48362252f9a11886f5eb32bb09b1aac", "message": "CB-4578 - Allow base image usage only based on entitlement system", "committedDate": "2020-01-10T15:45:21Z", "type": "commit"}, {"oid": "bf2b3c03f48362252f9a11886f5eb32bb09b1aac", "url": "https://github.com/hortonworks/cloudbreak/commit/bf2b3c03f48362252f9a11886f5eb32bb09b1aac", "message": "CB-4578 - Allow base image usage only based on entitlement system", "committedDate": "2020-01-10T15:45:21Z", "type": "forcePushed"}]}