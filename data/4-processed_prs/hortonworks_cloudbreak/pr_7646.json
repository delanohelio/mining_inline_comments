{"pr_number": 7646, "pr_title": "CB-6217 Remove redundancy from API E2E test cases", "pr_createdAt": "2020-03-25T13:41:40Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/7646", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg2NTA2Ng==", "url": "https://github.com/hortonworks/cloudbreak/pull/7646#discussion_r397865066", "bodyText": "I think this class should not extend ImageValidatorE2ETest, since InternalSdxDistroxTests also creates DistroX cluster", "author": "horadla23", "createdAt": "2020-03-25T13:46:27Z", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/e2e/distrox/DistroXImageValidatorTest.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.sequenceiq.it.cloudbreak.testcase.e2e.distrox;\n+\n+import javax.inject.Inject;\n+\n+import org.testng.annotations.Test;\n+\n+import com.sequenceiq.it.cloudbreak.client.DistroXTestClient;\n+import com.sequenceiq.it.cloudbreak.context.Description;\n+import com.sequenceiq.it.cloudbreak.context.TestContext;\n+import com.sequenceiq.it.cloudbreak.dto.distrox.DistroXTestDto;\n+import com.sequenceiq.it.cloudbreak.testcase.e2e.ImageValidatorE2ETest;\n+\n+public class DistroXImageValidatorTest extends ImageValidatorE2ETest {", "originalCommit": "eb6a33c137b10c3f5712106906b000bf50eb30f2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg2NTg1OA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7646#discussion_r397865858", "bodyText": "This class also should not extend ImageValidatorE2ETest, since it is not used in imagevalidation test suite", "author": "horadla23", "createdAt": "2020-03-25T13:47:27Z", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/e2e/sdx/InternalSdxTests.java", "diffHunk": "@@ -19,15 +19,6 @@\n     @Inject\n     private SdxTestClient sdxTestClient;\n \n-    @Override\n-    protected void setupTest(TestContext testContext) {", "originalCommit": "eb6a33c137b10c3f5712106906b000bf50eb30f2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg3MzY0Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/7646#discussion_r397873647", "bodyText": "Since image validation does not use this test currently, I think you can move it back to the DistroxTests class, it does not need to be an imagevalidation test, the only class used for image validation is InternalSdxDistroxTests", "author": "horadla23", "createdAt": "2020-03-25T13:57:32Z", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/e2e/distrox/DistroXImageValidatorTest.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.sequenceiq.it.cloudbreak.testcase.e2e.distrox;\n+\n+import javax.inject.Inject;\n+\n+import org.testng.annotations.Test;\n+\n+import com.sequenceiq.it.cloudbreak.client.DistroXTestClient;\n+import com.sequenceiq.it.cloudbreak.context.Description;\n+import com.sequenceiq.it.cloudbreak.context.TestContext;\n+import com.sequenceiq.it.cloudbreak.dto.distrox.DistroXTestDto;\n+import com.sequenceiq.it.cloudbreak.testcase.e2e.ImageValidatorE2ETest;\n+\n+public class DistroXImageValidatorTest extends ImageValidatorE2ETest {\n+\n+    @Inject\n+    private DistroXTestClient distroXTestClient;\n+\n+    @Test(dataProvider = TEST_CONTEXT)\n+    @Description(\n+            given = \"there is a running cloudbreak\",\n+            when = \"a valid DistroX create request is sent\",\n+            then = \"DistroX cluster is created\")\n+    public void testCreateDistroX(TestContext testContext) {", "originalCommit": "eb6a33c137b10c3f5712106906b000bf50eb30f2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg3NTUzMw==", "url": "https://github.com/hortonworks/cloudbreak/pull/7646#discussion_r397875533", "bodyText": "Or you can simply remove this test", "author": "horadla23", "createdAt": "2020-03-25T13:59:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg3MzY0Nw=="}], "type": "inlineReview"}, {"oid": "70201a749d12757609004ece9915c0483023f1a6", "url": "https://github.com/hortonworks/cloudbreak/commit/70201a749d12757609004ece9915c0483023f1a6", "message": "CB-6217 Remove redundancy from API E2E test cases", "committedDate": "2020-03-25T16:46:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTExMTUyNg==", "url": "https://github.com/hortonworks/cloudbreak/pull/7646#discussion_r399111526", "bodyText": "please modify class name in the image validation suites as well", "author": "horadla23", "createdAt": "2020-03-27T08:46:09Z", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/e2e/sdx/InternalSdxDistroxTest.java", "diffHunk": "@@ -17,23 +17,14 @@\n import com.sequenceiq.sdx.api.model.SdxClusterStatusResponse;\n import com.sequenceiq.sdx.api.model.SdxDatabaseRequest;\n \n-public class InternalSdxDistroxTests extends ImageValidatorE2ETest {\n+public class InternalSdxDistroxTest extends ImageValidatorE2ETest {", "originalCommit": "885415cc8487e160edf2ff9757a29e1dc7741cef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "48be7fd34a9c05f8f5fbc3a131ebaa0f3e29da25", "url": "https://github.com/hortonworks/cloudbreak/commit/48be7fd34a9c05f8f5fbc3a131ebaa0f3e29da25", "message": "CB-6217 Remove redundancy from API E2E test cases", "committedDate": "2020-03-27T08:51:41Z", "type": "forcePushed"}, {"oid": "fcf55146834e9081a1ff06f5bce0910a9c208f7e", "url": "https://github.com/hortonworks/cloudbreak/commit/fcf55146834e9081a1ff06f5bce0910a9c208f7e", "message": "CB-6217 Remove redundancy from API E2E test cases", "committedDate": "2020-03-27T09:07:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQwNzIwNw==", "url": "https://github.com/hortonworks/cloudbreak/pull/7646#discussion_r399407207", "bodyText": "I would move into sdx package, as all of its descendants are there.", "author": "gergopapi2", "createdAt": "2020-03-27T16:55:39Z", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/e2e/PreconditionSdxE2ETest.java", "diffHunk": "@@ -0,0 +1,112 @@\n+package com.sequenceiq.it.cloudbreak.testcase.e2e;", "originalCommit": "fcf55146834e9081a1ff06f5bce0910a9c208f7e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQwNzk0MQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/7646#discussion_r399407941", "bodyText": "I would move the class into sdx package as its sole descendant is also there.", "author": "gergopapi2", "createdAt": "2020-03-27T16:56:46Z", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/e2e/ImageValidatorE2ETest.java", "diffHunk": "@@ -33,6 +33,15 @@\n     @Value(\"${integrationtest.imageValidation.sourceCatalogUrl}\")\n     private String sourceImageCatalogUrl;\n ", "originalCommit": "fcf55146834e9081a1ff06f5bce0910a9c208f7e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQyNDA5OA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7646#discussion_r399424098", "bodyText": "This method and checkDistroxInstanceState are almost identical. I would try to refactor them to have one method. I think it is only the log and exception messages that differ within method body.", "author": "gergopapi2", "createdAt": "2020-03-27T17:23:09Z", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/util/wait/WaitUtil.java", "diffHunk": "@@ -449,13 +451,37 @@ private boolean checkSdxInstanceState(SdxClient sdxClient, String sdxName, Strin\n         List<InstanceGroupV4Response> instanceGroups = sdxClient.getSdxClient().sdxEndpoint().getDetail(sdxName, Set.of())\n                 .getStackV4Response()\n                 .getInstanceGroups();\n-        return checkInstanceState(hostGroup, desiredState, instanceGroups);\n+        SdxClusterResponse sdxResponse = sdxClient.getSdxClient().sdxEndpoint().get(sdxName);", "originalCommit": "fcf55146834e9081a1ff06f5bce0910a9c208f7e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bedeea3ae2ac2bacc2f423d94bc9ccb2644595ef", "url": "https://github.com/hortonworks/cloudbreak/commit/bedeea3ae2ac2bacc2f423d94bc9ccb2644595ef", "message": "CB-6217 Remove redundancy from API E2E test cases", "committedDate": "2020-03-30T08:45:58Z", "type": "commit"}, {"oid": "bedeea3ae2ac2bacc2f423d94bc9ccb2644595ef", "url": "https://github.com/hortonworks/cloudbreak/commit/bedeea3ae2ac2bacc2f423d94bc9ccb2644595ef", "message": "CB-6217 Remove redundancy from API E2E test cases", "committedDate": "2020-03-30T08:45:58Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA3OTM3OQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/7646#discussion_r400079379", "bodyText": "Is there some override for this variable?\nOr where do we get the 8 value?", "author": "lnardai", "createdAt": "2020-03-30T10:16:37Z", "path": "integration-test/src/main/java/com/sequenceiq/it/IntegrationTestApp.java", "diffHunk": "@@ -66,7 +66,7 @@\n     @Value(\"${integrationtest.threadCount:2}\")", "originalCommit": "bedeea3ae2ac2bacc2f423d94bc9ccb2644595ef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}