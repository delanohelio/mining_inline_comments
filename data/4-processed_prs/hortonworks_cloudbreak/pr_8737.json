{"pr_number": 8737, "pr_title": "DISTX-528 Periscope API Resource Based Authorizations.", "pr_createdAt": "2020-08-06T12:54:57Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8737", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxMDI1Mw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#discussion_r466410253", "bodyText": "getClusters for tenant with Autoscaling Configured  is still an AccountLevel Permission Check.", "author": "smaniraju", "createdAt": "2020-08-06T13:26:19Z", "path": "autoscale/src/main/java/com/sequenceiq/periscope/controller/DistroXAutoScaleClusterV1Controller.java", "diffHunk": "@@ -58,91 +66,102 @@\n     @Inject\n     private CloudbreakMessagesService messagesService;\n \n+    @Inject\n+    private TimeAlertRequestConverter timeAlertRequestConverter;\n+\n+    @Inject\n+    private LoadAlertRequestConverter loadAlertRequestConverter;\n+\n+    @Inject\n+    private EntitlementValidationService entitlementValidationService;\n+\n     @Override\n-    @CheckPermissionByAccount(action = AuthorizationResourceAction.DATAHUB_READ)\n+    @CheckPermissionByAccount(action = AuthorizationResourceAction.SCALE_DATAHUB)\n     public List<DistroXAutoscaleClusterResponse> getClusters() {\n         return distroXAutoscaleClusterResponseConverter.convertAllToJson(asClusterCommonService.getDistroXClusters());\n     }", "originalCommit": "55f975481b3c241f8ec438afc60df37d5524c7d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcxODg0Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#discussion_r466718847", "bodyText": "This is interesting. Wondering, if in the future, we can have list* calls give back a list of resources to which the user has READ/WRITE access.\ni.e. instead of listing all entities (clusters in this case) belonging to an environment - list clusters on which this particular user can either READ the autoscaling rules or CREATE autoscaling rules.\ncc @lnardai\nDistroXV1Controller in CB-core seems disable permission checking for list(envName, envCrn) - so presumably that allows a user with access to the tenant to see all other running clusters.", "author": "sidseth", "createdAt": "2020-08-06T22:26:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxMDI1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg5MTU0OA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#discussion_r466891548", "bodyText": "i think scaledatahub right will be present only in resource roles, so it wont work with account level, so this will work only with poweruser, so it is better to change this @DisabledCheckPermissions since we decided to disable authz on list for now, right @lnardai ?", "author": "horadla23", "createdAt": "2020-08-07T08:13:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxMDI1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk0NDQ1OQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#discussion_r466944459", "bodyText": "ok added @DisabledCheckPermissions for listApi in sync with other listApi like distrox.", "author": "smaniraju", "createdAt": "2020-08-07T10:00:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxMDI1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg4ODExMA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#discussion_r466888110", "bodyText": "I think this should be changed to @InternalOnly to ensure that noone will call this", "author": "horadla23", "createdAt": "2020-08-07T08:06:22Z", "path": "autoscale/src/main/java/com/sequenceiq/periscope/controller/AutoScaleClusterV2Controller.java", "diffHunk": "@@ -17,7 +18,8 @@\n /**\n  * @deprecated Database ID based endpoints are deprecated for removal.\n  */\n-@Component\n+@Controller\n+@DisableCheckPermissions", "originalCommit": "55f975481b3c241f8ec438afc60df37d5524c7d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjkwMzcxOA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#discussion_r466903718", "bodyText": "ok", "author": "smaniraju", "createdAt": "2020-08-07T08:38:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg4ODExMA=="}], "type": "inlineReview"}, {"oid": "02bb8b913d98df9701113d801c04e6f351f7daec", "url": "https://github.com/hortonworks/cloudbreak/commit/02bb8b913d98df9701113d801c04e6f351f7daec", "message": "DISTX-528 Periscope API Resource Based Authorizations.\n\n1. Periscope endpoints updated to use resource based UMS authorization.\n2. Periscope API are authroized for AuthorizationResourceAction.SCALE_DATAHUB\n3. Authorization annotation check enabled in periscope.\n4. Unused DB-Id based AlertEndpoint removed.", "committedDate": "2020-08-07T09:55:43Z", "type": "forcePushed"}, {"oid": "4f5f1bb310d0c2d4246763b051a5d3164b376073", "url": "https://github.com/hortonworks/cloudbreak/commit/4f5f1bb310d0c2d4246763b051a5d3164b376073", "message": "DISTX-528 Periscope API Resource Based Authorizations.\n\n1. Periscope endpoints updated to use resource based UMS authorization.\n2. Periscope API are authroized for AuthorizationResourceAction.SCALE_DATAHUB\n3. Authorization annotation check enabled in periscope.\n4. Unused DB-Id based AlertEndpoint removed.", "committedDate": "2020-08-07T11:03:25Z", "type": "commit"}, {"oid": "4f5f1bb310d0c2d4246763b051a5d3164b376073", "url": "https://github.com/hortonworks/cloudbreak/commit/4f5f1bb310d0c2d4246763b051a5d3164b376073", "message": "DISTX-528 Periscope API Resource Based Authorizations.\n\n1. Periscope endpoints updated to use resource based UMS authorization.\n2. Periscope API are authroized for AuthorizationResourceAction.SCALE_DATAHUB\n3. Authorization annotation check enabled in periscope.\n4. Unused DB-Id based AlertEndpoint removed.", "committedDate": "2020-08-07T11:03:25Z", "type": "forcePushed"}]}