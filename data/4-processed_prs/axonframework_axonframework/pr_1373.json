{"pr_number": 1373, "pr_title": "Added possibility to use event store of node currently connected to.", "pr_createdAt": "2020-03-13T18:15:36Z", "pr_url": "https://github.com/AxonFramework/AxonFramework/pull/1373", "timeline": [{"oid": "ceb8ef500ffe212d26e0d5a16c3f14459d0c9276", "url": "https://github.com/AxonFramework/AxonFramework/commit/ceb8ef500ffe212d26e0d5a16c3f14459d0c9276", "message": "Added possibility to use event store of node currently connected to.", "committedDate": "2020-03-13T18:06:13Z", "type": "commit"}, {"oid": "cc531329c25ffb83ad37479013187950da82c975", "url": "https://github.com/AxonFramework/AxonFramework/commit/cc531329c25ffb83ad37479013187950da82c975", "message": "Renamed useLocal(Event)Store to allowReading(Events)FromFollower.", "committedDate": "2020-03-18T09:00:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIwODE4Mg==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1373#discussion_r394208182", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Indicates whether it is ok to query events from the local Axon Server node - the node the client is currently\n          \n          \n            \n                 * Indicates whether it is OK to query events from the local Axon Server node - the node the client is currently", "author": "smcvb", "createdAt": "2020-03-18T09:28:09Z", "path": "axon-server-connector/src/main/java/org/axonframework/axonserver/connector/AxonServerConfiguration.java", "diffHunk": "@@ -210,6 +210,17 @@\n      */\n     private long connectTimeout = 5000;\n \n+    /**\n+     * Indicates whether it is ok to query events from the local Axon Server node - the node the client is currently", "originalCommit": "cc531329c25ffb83ad37479013187950da82c975", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIwODY1Nw==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1373#discussion_r394208657", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * this node yet. Used when criteria for eventual consistency is loosen up. It will spread the load for querying\n          \n          \n            \n                 * this node yet. Can be used when the criteria for eventual consistency is less strict. It will spread the load for querying", "author": "smcvb", "createdAt": "2020-03-18T09:28:54Z", "path": "axon-server-connector/src/main/java/org/axonframework/axonserver/connector/AxonServerConfiguration.java", "diffHunk": "@@ -210,6 +210,17 @@\n      */\n     private long connectTimeout = 5000;\n \n+    /**\n+     * Indicates whether it is ok to query events from the local Axon Server node - the node the client is currently\n+     * connected to. This means that the client will probably get stale events since all events my not be replicated to\n+     * this node yet. Used when criteria for eventual consistency is loosen up. It will spread the load for querying", "originalCommit": "cc531329c25ffb83ad37479013187950da82c975", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIwOTc5Mw==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1373#discussion_r394209793", "bodyText": "Would it make sense to set this field once for the AxonIQEventStorageEngine to be used on every GetEventsRequest and QueryEventsRequest call instead of retrieving it from the config each time? \ud83e\udd14", "author": "smcvb", "createdAt": "2020-03-18T09:30:37Z", "path": "axon-server-connector/src/main/java/org/axonframework/axonserver/connector/event/axon/AxonServerEventStore.java", "diffHunk": "@@ -481,7 +481,10 @@ public void onCompleted() {\n                     requestStream,\n                     configuration.getClientId(),\n                     configuration.getEventFlowControl(),\n-                    t -> GetEventsRequest.newBuilder().setNumberOfPermits(t.getPermits()).build(),\n+                    t -> GetEventsRequest.newBuilder()\n+                                         .setAllowReadingFromFollower(configuration.isAllowReadingEventsFromFollower())", "originalCommit": "cc531329c25ffb83ad37479013187950da82c975", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIxMDQyMQ==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1373#discussion_r394210421", "bodyText": "Nit: I'd expected your changes to update the copyright notice to 2020.", "author": "smcvb", "createdAt": "2020-03-18T09:31:39Z", "path": "axon-server-connector/src/test/java/org/axonframework/axonserver/connector/event/EventStoreImpl.java", "diffHunk": "@@ -16,16 +16,40 @@\n \n package org.axonframework.axonserver.connector.event;\n \n-import io.axoniq.axonserver.grpc.event.*;\n+import io.axoniq.axonserver.grpc.event.Confirmation;", "originalCommit": "cc531329c25ffb83ad37479013187950da82c975", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIxMTA0MA==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1373#discussion_r394211040", "bodyText": "When in the spot, might be nice to provide a short piece of class-level javadoc.", "author": "smcvb", "createdAt": "2020-03-18T09:32:38Z", "path": "axon-server-connector/src/test/java/org/axonframework/axonserver/connector/event/EventStoreImpl.java", "diffHunk": "@@ -16,16 +16,40 @@\n \n package org.axonframework.axonserver.connector.event;\n \n-import io.axoniq.axonserver.grpc.event.*;\n+import io.axoniq.axonserver.grpc.event.Confirmation;\n+import io.axoniq.axonserver.grpc.event.Event;\n+import io.axoniq.axonserver.grpc.event.EventStoreGrpc;\n+import io.axoniq.axonserver.grpc.event.EventWithToken;\n+import io.axoniq.axonserver.grpc.event.GetAggregateEventsRequest;\n+import io.axoniq.axonserver.grpc.event.GetEventsRequest;\n+import io.axoniq.axonserver.grpc.event.QueryEventsRequest;\n+import io.axoniq.axonserver.grpc.event.QueryEventsResponse;\n+import io.axoniq.axonserver.grpc.event.ReadHighestSequenceNrRequest;\n+import io.axoniq.axonserver.grpc.event.ReadHighestSequenceNrResponse;\n import io.grpc.stub.StreamObserver;\n \n-import java.util.*;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.Iterator;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Map;\n import java.util.concurrent.atomic.AtomicLong;\n \n public class EventStoreImpl extends EventStoreGrpc.EventStoreImplBase {", "originalCommit": "cc531329c25ffb83ad37479013187950da82c975", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "33cf0baa490abbceda48f229537777fdcdf742ae", "url": "https://github.com/AxonFramework/AxonFramework/commit/33cf0baa490abbceda48f229537777fdcdf742ae", "message": "Update axon-server-connector/src/main/java/org/axonframework/axonserver/connector/AxonServerConfiguration.java\n\nCo-Authored-By: Steven van Beelen <steven.vanbeelen@axoniq.io>", "committedDate": "2020-03-18T09:42:01Z", "type": "commit"}, {"oid": "8c36e378aca07078547ccbf879839de132d3896b", "url": "https://github.com/AxonFramework/AxonFramework/commit/8c36e378aca07078547ccbf879839de132d3896b", "message": "Update axon-server-connector/src/main/java/org/axonframework/axonserver/connector/AxonServerConfiguration.java\n\nCo-Authored-By: Steven van Beelen <steven.vanbeelen@axoniq.io>", "committedDate": "2020-03-18T09:46:26Z", "type": "commit"}, {"oid": "4ce2c918bd87c450bcc0ce01a07844874d75ace3", "url": "https://github.com/AxonFramework/AxonFramework/commit/4ce2c918bd87c450bcc0ce01a07844874d75ace3", "message": "Minor adjustments.", "committedDate": "2020-03-18T09:58:54Z", "type": "commit"}, {"oid": "b1000d888e34bbef0c23dbf7ecbb8ba9c6375ab8", "url": "https://github.com/AxonFramework/AxonFramework/commit/b1000d888e34bbef0c23dbf7ecbb8ba9c6375ab8", "message": "Merge remote-tracking branch 'origin/master' into use-local-store", "committedDate": "2020-03-19T11:08:21Z", "type": "commit"}, {"oid": "9b4830637712097a2fdb8c59a46197127874d5da", "url": "https://github.com/AxonFramework/AxonFramework/commit/9b4830637712097a2fdb8c59a46197127874d5da", "message": "Tell travis to use snapshot repositories.", "committedDate": "2020-03-19T13:18:00Z", "type": "commit"}, {"oid": "b4687c3e2d55db4b6daad12af905a9555ea0f7b3", "url": "https://github.com/AxonFramework/AxonFramework/commit/b4687c3e2d55db4b6daad12af905a9555ea0f7b3", "message": "Fixed typo in mvn build.", "committedDate": "2020-03-19T14:01:54Z", "type": "commit"}]}