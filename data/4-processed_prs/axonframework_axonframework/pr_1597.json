{"pr_number": 1597, "pr_title": "[#1593] Filter ResetHandlers from canHandleType", "pr_createdAt": "2020-11-10T17:51:22Z", "pr_url": "https://github.com/AxonFramework/AxonFramework/pull/1597", "timeline": [{"oid": "c54d624bebf67fcd27fe123820708dc4f404ebf2", "url": "https://github.com/AxonFramework/AxonFramework/commit/c54d624bebf67fcd27fe123820708dc4f404ebf2", "message": "Filter out ResetHandlers when filtering out events\n\nWhen the canHandleType is called, it should disregard ResetHandler\nannotated methods as those should only be invoked through the\nprepareReset method directly. Thus will ensure that filtering out\nevents as is supported by the BlockingStream actually works for\n@ResetHandler annotated methods which do not include a context\n\n#1593", "committedDate": "2020-11-10T16:14:36Z", "type": "commit"}, {"oid": "868b324d2d599e8f6362ceee0df23d8b55230c4d", "url": "https://github.com/AxonFramework/AxonFramework/commit/868b324d2d599e8f6362ceee0df23d8b55230c4d", "message": "Merge remote-tracking branch 'origin/axon-4.4.x' into bug/1593", "committedDate": "2020-11-10T17:44:50Z", "type": "commit"}, {"oid": "69be9a276f22d3c519208919ea1abfd0c815bdef", "url": "https://github.com/AxonFramework/AxonFramework/commit/69be9a276f22d3c519208919ea1abfd0c815bdef", "message": "Add comment for clarity\n\nAdd a comment specifying these methods are intended to be no-op\n\n#1593", "committedDate": "2020-11-10T17:52:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTIzNzk2NQ==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1597#discussion_r521237965", "bodyText": "The idea of these meta-annotations is that we shouldn't check on the actual annotation used. Instead, we should check whether the MessageHandler annotation declares a type of message that is compatible with the EventMessage.", "author": "abuijze", "createdAt": "2020-11-11T09:47:40Z", "path": "messaging/src/main/java/org/axonframework/eventhandling/AnnotationEventHandlerAdapter.java", "diffHunk": "@@ -105,6 +105,7 @@ public boolean canHandle(EventMessage<?> event) {\n     @Override\n     public boolean canHandleType(Class<?> payloadType) {\n         return inspector.getHandlers(listenerType)\n+                        .filter(messageHandler -> !messageHandler.hasAnnotation(ResetHandler.class))", "originalCommit": "69be9a276f22d3c519208919ea1abfd0c815bdef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI1Nzg5NA==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1597#discussion_r521257894", "bodyText": "Good point. Resolved just now.", "author": "smcvb", "createdAt": "2020-11-11T10:21:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTIzNzk2NQ=="}], "type": "inlineReview"}, {"oid": "6e914e21fe45210bcb3367c1b8428a69a7409cd0", "url": "https://github.com/AxonFramework/AxonFramework/commit/6e914e21fe45210bcb3367c1b8428a69a7409cd0", "message": "Adjust filtering logic\n\nAdjust filtering logic to base itself on the messageType attributes on\nthe MessageHandler annotation. This way users can still create their own\n reset handlers specific annotation, meta-annotated with ResetHandler\n\n#1593", "committedDate": "2020-11-11T10:21:39Z", "type": "commit"}, {"oid": "93d990fae5d5752f6fe4991a05a68003a05889df", "url": "https://github.com/AxonFramework/AxonFramework/commit/93d990fae5d5752f6fe4991a05a68003a05889df", "message": "Switch filter logic\n\nSwitch filter logic to only accept events, instead of reject the\nResetContext. This way it automatically copes with the scenario that\nother message types will be introduced.\n\n#1593", "committedDate": "2020-11-11T10:52:51Z", "type": "commit"}, {"oid": "b3e8f630fc95b598351076f7cb7c6b53f5533697", "url": "https://github.com/AxonFramework/AxonFramework/commit/b3e8f630fc95b598351076f7cb7c6b53f5533697", "message": "Shorten filter operation\n\nShorten filter operation by using annotationAttributes instead of\ninvoking the annotationUtils\n\n#1593", "committedDate": "2020-11-11T13:05:15Z", "type": "commit"}, {"oid": "d58faca73231033c72a81e18c5894d5c862d7884", "url": "https://github.com/AxonFramework/AxonFramework/commit/d58faca73231033c72a81e18c5894d5c862d7884", "message": "Merge remote-tracking branch 'origin/axon-4.4.x' into bug/1593", "committedDate": "2020-11-11T13:05:31Z", "type": "commit"}, {"oid": "8542568e77ffc272bd5002bd06e751b3acb3c90f", "url": "https://github.com/AxonFramework/AxonFramework/commit/8542568e77ffc272bd5002bd06e751b3acb3c90f", "message": "Switch check order\n\nSwitch check order to focus on the EventMessage first\n\n#1593", "committedDate": "2020-11-11T13:18:08Z", "type": "commit"}, {"oid": "9b070a48bacd91b2624e88de00814f1d2d3a808f", "url": "https://github.com/AxonFramework/AxonFramework/commit/9b070a48bacd91b2624e88de00814f1d2d3a808f", "message": "Use boolean i.o. Boolean\n\nUse boolean i.o. Boolean\n\n#1593", "committedDate": "2020-11-11T13:28:44Z", "type": "commit"}]}