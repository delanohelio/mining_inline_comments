{"pr_number": 75, "pr_title": "Hexmap", "pr_createdAt": "2020-01-08T07:05:28Z", "pr_url": "https://github.com/dedica-team/nivio/pull/75", "timeline": [{"oid": "028742b05871b88dc75a111394a02e17ab223dd6", "url": "https://github.com/dedica-team/nivio/commit/028742b05871b88dc75a111394a02e17ab223dd6", "message": "hexmap wip", "committedDate": "2019-09-26T02:57:34Z", "type": "commit"}, {"oid": "9c759d915eb1fca8d6725c72a194bc26e05bb78e", "url": "https://github.com/dedica-team/nivio/commit/9c759d915eb1fca8d6725c72a194bc26e05bb78e", "message": "Merge branch 'develop' into hexmap", "committedDate": "2019-10-02T15:47:02Z", "type": "commit"}, {"oid": "2421e1fd8e848dd5c6834f328589b81706b5b892", "url": "https://github.com/dedica-team/nivio/commit/2421e1fd8e848dd5c6834f328589b81706b5b892", "message": "demo landscape config fix", "committedDate": "2019-10-03T20:14:12Z", "type": "commit"}, {"oid": "bade53b19b35d47a8afaddbf16a690fe16f202e1", "url": "https://github.com/dedica-team/nivio/commit/bade53b19b35d47a8afaddbf16a690fe16f202e1", "message": "react app to render hex", "committedDate": "2019-10-03T20:23:05Z", "type": "commit"}, {"oid": "c494ab910c104d76479db324c44fc1d3381ab172", "url": "https://github.com/dedica-team/nivio/commit/c494ab910c104d76479db324c44fc1d3381ab172", "message": "react app to render hex (wip)", "committedDate": "2019-10-04T14:23:27Z", "type": "commit"}, {"oid": "d02a082ef1b98aa210fce81602ac0c6d3a5022e8", "url": "https://github.com/dedica-team/nivio/commit/d02a082ef1b98aa210fce81602ac0c6d3a5022e8", "message": "react app to render hex (wip)", "committedDate": "2019-10-04T21:18:10Z", "type": "commit"}, {"oid": "58a24fddbd8fc5c78d6ff7422d5227da19feafb6", "url": "https://github.com/dedica-team/nivio/commit/58a24fddbd8fc5c78d6ff7422d5227da19feafb6", "message": "[#1] added hal support (spring hateos 1.0.0 did not work)", "committedDate": "2019-10-06T11:21:36Z", "type": "commit"}, {"oid": "b811866a21a0755dcf705eb7d5e9db85206981e4", "url": "https://github.com/dedica-team/nivio/commit/b811866a21a0755dcf705eb7d5e9db85206981e4", "message": "[#1] extended hal links", "committedDate": "2019-10-06T12:03:29Z", "type": "commit"}, {"oid": "f6e4509a2a33e8f4f9bbe2eb94a8224219b10b7f", "url": "https://github.com/dedica-team/nivio/commit/f6e4509a2a33e8f4f9bbe2eb94a8224219b10b7f", "message": "hexmap wip", "committedDate": "2019-12-15T14:54:47Z", "type": "commit"}, {"oid": "72987dbb1d0e9ebfddd59d4a00c16ce1a71c0fec", "url": "https://github.com/dedica-team/nivio/commit/72987dbb1d0e9ebfddd59d4a00c16ce1a71c0fec", "message": "react app to render hex", "committedDate": "2019-12-15T15:26:33Z", "type": "commit"}, {"oid": "a231d9ce4a8416aaab71d1e18f0438aa670c389b", "url": "https://github.com/dedica-team/nivio/commit/a231d9ce4a8416aaab71d1e18f0438aa670c389b", "message": "react app to render hex (wip)", "committedDate": "2019-12-15T15:32:22Z", "type": "commit"}, {"oid": "55af130d74ccb6688c5f9a72e64c66cdadde684d", "url": "https://github.com/dedica-team/nivio/commit/55af130d74ccb6688c5f9a72e64c66cdadde684d", "message": "react app to render hex (wip)", "committedDate": "2019-12-15T15:32:22Z", "type": "commit"}, {"oid": "ac898be7c1a2d6ac07920e7b405395009b5683d5", "url": "https://github.com/dedica-team/nivio/commit/ac898be7c1a2d6ac07920e7b405395009b5683d5", "message": "Merge branch 'hexmap' of github.com:bonndan/nivio into hexmap", "committedDate": "2019-12-16T06:59:45Z", "type": "commit"}, {"oid": "da0f9898629a80b6677ea7f2b4d3b6f0d5fb5f6f", "url": "https://github.com/dedica-team/nivio/commit/da0f9898629a80b6677ea7f2b4d3b6f0d5fb5f6f", "message": "fixes to get hexmap running", "committedDate": "2019-12-16T07:36:09Z", "type": "commit"}, {"oid": "3ab77c046835aef126deeca3b80659ca56ac1d8b", "url": "https://github.com/dedica-team/nivio/commit/3ab77c046835aef126deeca3b80659ca56ac1d8b", "message": "Merge branch 'develop' into hexmap", "committedDate": "2019-12-18T06:55:58Z", "type": "commit"}, {"oid": "c330adf3a5fd5b2a195b67376914b81a26981f29", "url": "https://github.com/dedica-team/nivio/commit/c330adf3a5fd5b2a195b67376914b81a26981f29", "message": "new method to get group color", "committedDate": "2019-12-26T22:30:21Z", "type": "commit"}, {"oid": "4ceec30c73eb48ee62371e27d40df30b29e417f7", "url": "https://github.com/dedica-team/nivio/commit/4ceec30c73eb48ee62371e27d40df30b29e417f7", "message": "preparation to unify rendered output", "committedDate": "2019-12-26T22:31:27Z", "type": "commit"}, {"oid": "f114dab167601a2d434b3cc23fc50718c6500421", "url": "https://github.com/dedica-team/nivio/commit/f114dab167601a2d434b3cc23fc50718c6500421", "message": "20px grid on final graph", "committedDate": "2019-12-26T22:42:48Z", "type": "commit"}, {"oid": "c3b2779e60fd8e2c602da50d68577b24c6cd844b", "url": "https://github.com/dedica-team/nivio/commit/c3b2779e60fd8e2c602da50d68577b24c6cd844b", "message": "simplifying mapping json", "committedDate": "2019-12-28T22:28:59Z", "type": "commit"}, {"oid": "be71f8a256ba399aebb7661bb5945d3389a9b855", "url": "https://github.com/dedica-team/nivio/commit/be71f8a256ba399aebb7661bb5945d3389a9b855", "message": "hexmap min max", "committedDate": "2019-12-29T11:44:21Z", "type": "commit"}, {"oid": "7bc8a34a7f11d1de5f73699ccae5faa89a440e30", "url": "https://github.com/dedica-team/nivio/commit/7bc8a34a7f11d1de5f73699ccae5faa89a440e30", "message": "react hexmap pathfinder wip", "committedDate": "2019-12-30T10:01:40Z", "type": "commit"}, {"oid": "ed6db8c80f0362777b1dce4e08eb77b1486170c7", "url": "https://github.com/dedica-team/nivio/commit/ed6db8c80f0362777b1dce4e08eb77b1486170c7", "message": "fastest path chosen", "committedDate": "2019-12-30T15:41:01Z", "type": "commit"}, {"oid": "5e0e70b87247144d7b4d1853237f0f2316cc6eed", "url": "https://github.com/dedica-team/nivio/commit/5e0e70b87247144d7b4d1853237f0f2316cc6eed", "message": "mapitem with identifier as name fallback", "committedDate": "2019-12-30T16:43:40Z", "type": "commit"}, {"oid": "f0952f2b1dd6cc68dc40e89c19c1b70963d5676f", "url": "https://github.com/dedica-team/nivio/commit/f0952f2b1dd6cc68dc40e89c19c1b70963d5676f", "message": "rounded curves", "committedDate": "2019-12-30T18:00:17Z", "type": "commit"}, {"oid": "6ce6503a8a24232a346d92d3fc63150d3cbb724d", "url": "https://github.com/dedica-team/nivio/commit/6ce6503a8a24232a346d92d3fc63150d3cbb724d", "message": "tilepath fix", "committedDate": "2019-12-30T18:14:03Z", "type": "commit"}, {"oid": "7c47bbf2169f0da9fbba81b865a4491e13f09055", "url": "https://github.com/dedica-team/nivio/commit/7c47bbf2169f0da9fbba81b865a4491e13f09055", "message": "fix to provide icon urls to map items", "committedDate": "2019-12-30T21:08:52Z", "type": "commit"}, {"oid": "44455a3dcbd69592525a8ad3ce641dd18f97bc09", "url": "https://github.com/dedica-team/nivio/commit/44455a3dcbd69592525a8ad3ce641dd18f97bc09", "message": "showing images in map", "committedDate": "2019-12-30T21:38:21Z", "type": "commit"}, {"oid": "a8e9f2047546214a31a82fefbc8b48b6eb048fde", "url": "https://github.com/dedica-team/nivio/commit/a8e9f2047546214a31a82fefbc8b48b6eb048fde", "message": "cleanup", "committedDate": "2019-12-31T15:20:14Z", "type": "commit"}, {"oid": "f36195b64b3bf574a2a2e7c9867aae856bc699ea", "url": "https://github.com/dedica-team/nivio/commit/f36195b64b3bf574a2a2e7c9867aae856bc699ea", "message": "map group items have hex start/end coords", "committedDate": "2019-12-31T16:09:30Z", "type": "commit"}, {"oid": "560a31754dd1af46add1c5843e7c7d94483e242b", "url": "https://github.com/dedica-team/nivio/commit/560a31754dd1af46add1c5843e7c7d94483e242b", "message": "showing group and labels", "committedDate": "2020-01-01T17:53:14Z", "type": "commit"}, {"oid": "d5c2d3c46f01e51ecd9f650b5b855d017704bca4", "url": "https://github.com/dedica-team/nivio/commit/d5c2d3c46f01e51ecd9f650b5b855d017704bca4", "message": "pan and zoom svg", "committedDate": "2020-01-02T21:08:09Z", "type": "commit"}, {"oid": "13dbc566bfcf75ee387a31bb9ff7a7a9cc93a6c7", "url": "https://github.com/dedica-team/nivio/commit/13dbc566bfcf75ee387a31bb9ff7a7a9cc93a6c7", "message": "mvn dependency-analyzer for java 11 (workaround)", "committedDate": "2020-01-02T21:08:40Z", "type": "commit"}, {"oid": "5069459ca20cf4758a9db57f33f7e8871be1de8c", "url": "https://github.com/dedica-team/nivio/commit/5069459ca20cf4758a9db57f33f7e8871be1de8c", "message": "link to app/map in landscape hateoas, map moved to subdirectory", "committedDate": "2020-01-04T17:35:30Z", "type": "commit"}, {"oid": "c5591ba0297a44186023dd4a4ee2d104c28a6324", "url": "https://github.com/dedica-team/nivio/commit/c5591ba0297a44186023dd4a4ee2d104c28a6324", "message": "showing details under labels on click", "committedDate": "2020-01-05T21:31:09Z", "type": "commit"}, {"oid": "f16f557e25d9933c1aeda359ab3242fa6a35a36c", "url": "https://github.com/dedica-team/nivio/commit/f16f557e25d9933c1aeda359ab3242fa6a35a36c", "message": "more details", "committedDate": "2020-01-06T07:02:01Z", "type": "commit"}, {"oid": "1acd3d12609dd45eb616a856cc40e8c84e3ae286", "url": "https://github.com/dedica-team/nivio/commit/1acd3d12609dd45eb616a856cc40e8c84e3ae286", "message": "showing group names and landscape name", "committedDate": "2020-01-06T20:46:24Z", "type": "commit"}, {"oid": "3c2f7f1b0ea0262fe6033f3f117cddc20f392888", "url": "https://github.com/dedica-team/nivio/commit/3c2f7f1b0ea0262fe6033f3f117cddc20f392888", "message": "Merge branch 'develop' into hexmap", "committedDate": "2020-01-08T06:25:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDI1MTEwOQ==", "url": "https://github.com/dedica-team/nivio/pull/75#discussion_r364251109", "bodyText": "\"It receives\"... ?", "author": "jpgoelz", "createdAt": "2020-01-08T14:15:15Z", "path": "src/main/java/de/bonndan/nivio/output/jgraphx/FinalGraph.java", "diffHunk": "@@ -9,31 +9,47 @@\n import com.mxgraph.view.mxGraph;\n import com.mxgraph.view.mxStyleRegistry;\n import com.mxgraph.view.mxStylesheet;\n+\n import de.bonndan.nivio.model.*;\n import de.bonndan.nivio.output.*;\n+import de.bonndan.nivio.output.Rendered;\n import de.bonndan.nivio.util.RootPath;\n+\n+import de.bonndan.nivio.output.Icon;\n+import de.bonndan.nivio.output.IconService;\n+import de.bonndan.nivio.output.LocalServer;\n+\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.springframework.util.StringUtils;\n \n import java.io.File;\n import java.net.MalformedURLException;\n import java.util.*;\n+import java.util.List;\n import java.util.concurrent.atomic.AtomicInteger;\n import java.util.stream.Stream;\n \n import static de.bonndan.nivio.model.Status.UNKNOWN;\n import static de.bonndan.nivio.output.Color.getGroupColor;\n \n-public class FinalGraph {\n+/**\n+ * This class is responsible for rendering services and groups nicely with bells and whistles.\n+ * <p>\n+ * It receives", "originalCommit": "3c2f7f1b0ea0262fe6033f3f117cddc20f392888", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg1MjY1MA==", "url": "https://github.com/dedica-team/nivio/pull/75#discussion_r364852650", "bodyText": "done", "author": "bonndan", "createdAt": "2020-01-09T16:55:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDI1MTEwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQzNjM4NQ==", "url": "https://github.com/dedica-team/nivio/pull/75#discussion_r364436385", "bodyText": "5 * size (add spaces)", "author": "jpgoelz", "createdAt": "2020-01-08T20:49:11Z", "path": "src/main/app/src/NGroup.js", "diffHunk": "@@ -0,0 +1,42 @@\n+import React, {Component} from 'react';\n+import PropTypes from 'prop-types';\n+import {HexUtils} from 'react-hexgrid';\n+\n+class NGroup extends Component {\n+\n+    static propTypes = {\n+        group: PropTypes.object,\n+        cellStyle: PropTypes.oneOfType([\n+            PropTypes.string,\n+            PropTypes.object\n+        ])\n+    };\n+\n+    static contextTypes = {\n+        layout: PropTypes.object\n+    };\n+\n+    render() {\n+        const {group, cellStyle} = this.props;\n+        const {layout} = this.context;\n+        const fill = group.color;\n+        const fillId = (fill) ? `#${fill}` : null;\n+        const start = group.start;\n+        const end = group.end;\n+        const size = 40;\n+        let startPoint = HexUtils.hexToPixel(start, layout);\n+        let endPoint = HexUtils.hexToPixel(end, layout);\n+        let width = endPoint.x - startPoint.x + 4 * size;\n+        let height = endPoint.y - startPoint.y + 5*size;", "originalCommit": "3c2f7f1b0ea0262fe6033f3f117cddc20f392888", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0MDE0Mg==", "url": "https://github.com/dedica-team/nivio/pull/75#discussion_r364440142", "bodyText": "Maybe there is a better, more readable approach to this than doing the calculations within the JSX?", "author": "jpgoelz", "createdAt": "2020-01-08T20:58:41Z", "path": "src/main/app/src/NGroup.js", "diffHunk": "@@ -0,0 +1,42 @@\n+import React, {Component} from 'react';\n+import PropTypes from 'prop-types';\n+import {HexUtils} from 'react-hexgrid';\n+\n+class NGroup extends Component {\n+\n+    static propTypes = {\n+        group: PropTypes.object,\n+        cellStyle: PropTypes.oneOfType([\n+            PropTypes.string,\n+            PropTypes.object\n+        ])\n+    };\n+\n+    static contextTypes = {\n+        layout: PropTypes.object\n+    };\n+\n+    render() {\n+        const {group, cellStyle} = this.props;\n+        const {layout} = this.context;\n+        const fill = group.color;\n+        const fillId = (fill) ? `#${fill}` : null;\n+        const start = group.start;\n+        const end = group.end;\n+        const size = 40;\n+        let startPoint = HexUtils.hexToPixel(start, layout);\n+        let endPoint = HexUtils.hexToPixel(end, layout);\n+        let width = endPoint.x - startPoint.x + 4 * size;\n+        let height = endPoint.y - startPoint.y + 5*size;\n+        return (\n+            <g>\n+                <rect x={startPoint.x - 2 * size} y={startPoint.y - 2* size} rx=\"50\" ry=\"50\" width={width} height={height}\n+                      style={cellStyle}\n+                      stroke={fillId} fill={fillId} className=\"group\"/>\n+                <text x={startPoint.x - 2 * size + width/2} y={startPoint.y + height - 3*size} fill={fillId}  font-size=\"24\" width={width} textAnchor={'middle'}>{group.name}</text>", "originalCommit": "3c2f7f1b0ea0262fe6033f3f117cddc20f392888", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTA5NjgwMA==", "url": "https://github.com/dedica-team/nivio/pull/75#discussion_r365096800", "bodyText": "can be refactored in develop branch", "author": "bonndan", "createdAt": "2020-01-10T07:07:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0MDE0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0MDg3NA==", "url": "https://github.com/dedica-team/nivio/pull/75#discussion_r364440874", "bodyText": "Remove spaces within <div>.", "author": "jpgoelz", "createdAt": "2020-01-08T21:00:34Z", "path": "src/main/app/src/NLabel.js", "diffHunk": "@@ -0,0 +1,59 @@\n+import React, {Component} from 'react';\n+import PropTypes from 'prop-types';\n+import NText from \"./NText\";\n+\n+class NLabel extends Component {\n+\n+    static propTypes = {\n+        item: PropTypes.object,\n+        x: PropTypes.oneOfType([\n+            PropTypes.string,\n+            PropTypes.number\n+        ]),\n+        y: PropTypes.oneOfType([\n+            PropTypes.string,\n+            PropTypes.number\n+        ]),\n+        className: PropTypes.string,\n+        width: PropTypes.number,\n+        size: PropTypes.number,\n+        padding: PropTypes.number\n+    };\n+\n+    constructor() {\n+        super();\n+        this.state = {showDetails: false};\n+    }\n+\n+    itemPopup(e) {\n+        this.setState({showDetails: !this.state.showDetails})\n+    }\n+\n+    render() {\n+        const {size, item, padding, width} = this.props;\n+        let showDetails = this.state.showDetails;\n+        let style = showDetails ? {display: 'block'} : {display: 'none'};\n+        return (\n+            <g className={'label'}>\n+                <rect x={size + padding} y={-10} rx=\"10\" ry=\"10\" fill={'white'} width={width} height={size / 2}/>\n+                <NText key={item.identifier} x={size + padding + (width / 2)} y={5}\n+                       width={width} item={item} onClick={e => this.itemPopup(e, this)}/>\n+\n+                <foreignObject width={width} height=\"220\" y={padding} x={size + padding } style={style}>\n+                    <div className=\"details\">\n+                        {item.landscapeItem.description && (<div >\"{item.landscapeItem.description}\"<br /></div>)}\n+                        {item.landscapeItem.owner && (<div >Owner: {item.landscapeItem.owner}</div>)}\n+                        {item.landscapeItem.team && (<div >Team: {item.landscapeItem.team}</div>)}\n+                        {item.landscapeItem.contact && (<div >Contact: {item.landscapeItem.contact}</div>)}\n+                        {item.landscapeItem.software && (<div >Software: {item.landscapeItem.software}</div>)}\n+                        {item.landscapeItem.version && (<div >Version: {item.landscapeItem.version}</div>)}\n+                        {item.landscapeItem.lifecycle && (<div >Lifecycle: {item.landscapeItem.lifecycle}</div>)}", "originalCommit": "3c2f7f1b0ea0262fe6033f3f117cddc20f392888", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0MTgyOA==", "url": "https://github.com/dedica-team/nivio/pull/75#discussion_r364441828", "bodyText": "Is this correct or was it supposed to be named NHexagon?", "author": "jpgoelz", "createdAt": "2020-01-08T21:03:12Z", "path": "src/main/app/src/Nexagon.js", "diffHunk": "@@ -0,0 +1,61 @@\n+import React, {Component} from 'react';\n+import PropTypes from 'prop-types';\n+import classNames from 'classnames';\n+import {Hex, HexUtils} from 'react-hexgrid';\n+\n+\n+class Nexagon extends Component {", "originalCommit": "3c2f7f1b0ea0262fe6033f3f117cddc20f392888", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTA5Njg5OA==", "url": "https://github.com/dedica-team/nivio/pull/75#discussion_r365096898", "bodyText": "The whole naming can be refactored later", "author": "bonndan", "createdAt": "2020-01-10T07:08:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0MTgyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0MjkzMQ==", "url": "https://github.com/dedica-team/nivio/pull/75#discussion_r364442931", "bodyText": "let instead of var", "author": "jpgoelz", "createdAt": "2020-01-08T21:06:10Z", "path": "src/main/app/src/PathFinder.js", "diffHunk": "@@ -0,0 +1,87 @@\n+import {HexUtils} from 'react-hexgrid';\n+import TilePath from \"./TilePath\";\n+\n+class PathFinder {\n+\n+    constructor(occupied) {\n+        this.occupied = occupied;\n+    }\n+\n+    findPaths(paths, target) {\n+\n+        paths.forEach(path => {\n+            let source = path.tiles[path.tiles.length - 1];\n+            let distance = HexUtils.distance(source, target);\n+\n+            if (distance === 0) {\n+                path.close();\n+            }\n+\n+            let possibleSteps = HexUtils.neighbours(source)\n+                .filter(neigh => this.isSame(neigh, target) || !this.isOccupied(neigh))\n+                .filter(neigh => {\n+                    //return neighbours which are closer to the target\n+                    let ndist = HexUtils.distance(neigh, target);\n+                    return ndist < distance;\n+                });\n+            /*console.log(possibleSteps.length + \" poss. steps (\" +\n+                possibleSteps.map(hex => hex.q + \",\" + hex.r).join(\"; \")\n+                + \") in distance \" + distance + \" from \" + source.q + \",\" + source.r\n+                + \" to \" + target.q + \",\" + target.r);\n+             */\n+\n+            if (possibleSteps.length === 0) { //TODO wrong, wont go back\n+                path.close()\n+            } else {\n+\n+                //prolong path and create clones if there are more possibilties\n+                let template = new TilePath();\n+                template.tiles = path.tiles;\n+                path.tiles.push(possibleSteps.shift());\n+\n+                for (var i = 0; i < possibleSteps.length; i++) {", "originalCommit": "3c2f7f1b0ea0262fe6033f3f117cddc20f392888", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTA5NzA2MA==", "url": "https://github.com/dedica-team/nivio/pull/75#discussion_r365097060", "bodyText": "done", "author": "bonndan", "createdAt": "2020-01-10T07:08:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0MjkzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0NjA5NA==", "url": "https://github.com/dedica-team/nivio/pull/75#discussion_r364446094", "bodyText": "You should really run Reformat Code on this file (Ctrl+Alt+L). \ud83d\ude43 Loads of missing spaces.", "author": "jpgoelz", "createdAt": "2020-01-08T21:14:19Z", "path": "src/main/app/src/TilePath.js", "diffHunk": "@@ -0,0 +1,94 @@\n+import {HexUtils} from \"react-hexgrid\";\n+\n+class TilePath {\n+\n+    constructor(tile) {\n+        this.tiles = [];\n+        this.bends = [];\n+        if (tile !== undefined)\n+            this.tiles.push(tile);\n+        this.closed = false;\n+    }\n+\n+    close() {\n+        if (this.closed)\n+            return;\n+\n+        this.closed = true;\n+\n+        let i =0;\n+        for (i = 1; i < this.tiles.length - 1; i++) {\n+            let prev = this.tiles[i - 1];\n+            let cur = this.tiles[i];\n+            let next = this.tiles[i+1];\n+            let qBend = (prev.q === cur.q && next.q !== cur.q) || (prev.q !== cur.q && next.q === cur.q);\n+            let rBend = (prev.r === cur.r && next.r !== cur.r) || (prev.r !== cur.r && next.r === cur.r);\n+            if (qBend || rBend)\n+                this.bends.push(cur);\n+        }\n+\n+    }\n+\n+    reducePoints() {\n+        //reduce tiles (not first or last)\n+\n+\n+        /*\n+        let reduced = [];\n+        console.log(drop);\n+        for (i = 0; i < this.tiles.length; i++) {\n+            if (drop.indexOf(i) !== -1)\n+                continue;\n+            reduced.push(this.tiles[i]);\n+        }\n+        this.tiles = reduced;\n+         */\n+    }\n+\n+    getPoints(layout) {\n+        let points = 'M';\n+        for (var i = 0; i < this.tiles.length; i++) {\n+            let hex = this.tiles[i];\n+            if (this._isBend(hex)) {\n+                //cubic curve\n+                let prev = HexUtils.hexToPixel(this.tiles[i-1], layout);\n+                let point = HexUtils.hexToPixel(this.tiles[i], layout);\n+                let next = HexUtils.hexToPixel(this.tiles[i+1], layout);\n+\n+                let newBefore = {};\n+                newBefore.x = prev.x + (point.x -prev.x)/2;\n+                newBefore.y = prev.y + (point.y -prev.y)/2;\n+                points += ` ${newBefore.x},${newBefore.y} ` ;\n+                //points = points.substr(0, points.length-1);\n+                points += `Q ${point.x},${point.y} ` ;\n+\n+                let newAfter = {};\n+                newAfter.x = next.x + (point.x -next.x)/2;\n+                newAfter.y = next.y + (point.y -next.y)/2;\n+                points += ` ${newAfter.x},${newAfter.y} L` ;\n+            } else {\n+                let p = HexUtils.hexToPixel(hex, layout);\n+                points += ` ${p.x},${p.y} L` ;\n+            }\n+        }\n+        return points.substr(0, points.length -1);\n+    }\n+\n+    _isBend(hex) {\n+        if (this.bends.length === 0)\n+            return false;\n+\n+        for (var i = 0; i < this.bends.length; i++) {\n+            if (this.bends[i].q === hex.q && this.bends[i].r === hex.r)\n+                return true;\n+        }\n+\n+        return false;\n+    }\n+\n+    getSpeed() {\n+        return this.tiles.length - this.bends.length;\n+    }\n+}\n+\n+export default TilePath;", "originalCommit": "3c2f7f1b0ea0262fe6033f3f117cddc20f392888", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ1MDA1MQ==", "url": "https://github.com/dedica-team/nivio/pull/75#discussion_r364450051", "bodyText": "Why do you import Rendered, Icon, IconService and LocalServer specifically if you already import de.bonndan.nivio.output.*?", "author": "jpgoelz", "createdAt": "2020-01-08T21:24:11Z", "path": "src/main/java/de/bonndan/nivio/output/jgraphx/FinalGraph.java", "diffHunk": "@@ -9,31 +9,47 @@\n import com.mxgraph.view.mxGraph;\n import com.mxgraph.view.mxStyleRegistry;\n import com.mxgraph.view.mxStylesheet;\n+\n import de.bonndan.nivio.model.*;\n import de.bonndan.nivio.output.*;\n+import de.bonndan.nivio.output.Rendered;\n import de.bonndan.nivio.util.RootPath;\n+\n+import de.bonndan.nivio.output.Icon;\n+import de.bonndan.nivio.output.IconService;\n+import de.bonndan.nivio.output.LocalServer;\n+", "originalCommit": "3c2f7f1b0ea0262fe6033f3f117cddc20f392888", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ1MDE4OA==", "url": "https://github.com/dedica-team/nivio/pull/75#discussion_r364450188", "bodyText": "...again.", "author": "jpgoelz", "createdAt": "2020-01-08T21:24:35Z", "path": "src/main/java/de/bonndan/nivio/output/jgraphx/FinalGraph.java", "diffHunk": "@@ -9,31 +9,47 @@\n import com.mxgraph.view.mxGraph;\n import com.mxgraph.view.mxStyleRegistry;\n import com.mxgraph.view.mxStylesheet;\n+\n import de.bonndan.nivio.model.*;\n import de.bonndan.nivio.output.*;\n+import de.bonndan.nivio.output.Rendered;\n import de.bonndan.nivio.util.RootPath;\n+\n+import de.bonndan.nivio.output.Icon;\n+import de.bonndan.nivio.output.IconService;\n+import de.bonndan.nivio.output.LocalServer;\n+\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.springframework.util.StringUtils;\n \n import java.io.File;\n import java.net.MalformedURLException;\n import java.util.*;\n+import java.util.List;", "originalCommit": "3c2f7f1b0ea0262fe6033f3f117cddc20f392888", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ1MTgxMA==", "url": "https://github.com/dedica-team/nivio/pull/75#discussion_r364451810", "bodyText": "Can't you extract this into a method (using some kind of Point)? It get's repeated in lines 93-102.", "author": "jpgoelz", "createdAt": "2020-01-08T21:28:29Z", "path": "src/main/java/de/bonndan/nivio/output/jgraphx/RenderedXYMapFactory.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package de.bonndan.nivio.output.jgraphx;\n+\n+import com.mxgraph.model.mxCell;\n+import com.mxgraph.model.mxGeometry;\n+import com.mxgraph.view.mxGraph;\n+import de.bonndan.nivio.model.LandscapeImpl;\n+import de.bonndan.nivio.output.IconService;\n+import de.bonndan.nivio.output.Rendered;\n+import de.bonndan.nivio.output.map.*;\n+\n+import java.util.concurrent.atomic.AtomicInteger;\n+import java.util.concurrent.atomic.AtomicLong;\n+\n+public class RenderedXYMapFactory implements MapFactory<mxGraph, mxCell> {\n+\n+    public static final int SIZE_FACTOR = 40;\n+    private final IconService iconService;\n+\n+    public RenderedXYMapFactory(IconService iconService) {\n+        this.iconService = iconService;\n+    }\n+\n+    public RenderedXYMap getRenderedMap(LandscapeImpl landscape, Rendered<mxGraph, mxCell> rendered) {\n+        RenderedXYMap renderedMap = from(rendered);\n+\n+        AtomicInteger minX = new AtomicInteger(0);\n+        AtomicInteger maxX = new AtomicInteger(0);\n+        AtomicInteger minY = new AtomicInteger(0);\n+        AtomicInteger maxY = new AtomicInteger(0);\n+        renderedMap.items.forEach(item -> {\n+            if (item.x < minX.get())\n+                minX.set((int) item.x);\n+            if (item.x > maxX.get())\n+                maxX.set((int) item.x);\n+            if (item.y < minY.get())\n+                minY.set((int) item.y);\n+            if (item.y > maxY.get())\n+                maxY.set((int) item.y);\n+        });\n+\n+        renderedMap.landscape = landscape.getName();\n+        renderedMap.sizeFactor = SIZE_FACTOR;\n+        renderedMap.width = maxX.get() - minX.get();\n+        renderedMap.height = maxY.get() - minY.get();\n+        int size = Math.max(renderedMap.width, renderedMap.height) / SIZE_FACTOR;\n+\n+        renderedMap.items.forEach(item -> item.size = size);\n+        renderedMap.groups.forEach(groupMapItem -> groupMapItem.size = size);\n+\n+        return renderedMap;\n+    }\n+\n+    RenderedXYMap from(Rendered<mxGraph, mxCell> rendered) {\n+        RenderedXYMap renderedMap = new RenderedXYMap();\n+\n+        rendered.getItemObjects().forEach((item, cell) -> {\n+            mxGeometry geometry = cell.getGeometry();\n+\n+            long x;\n+            long y;\n+            if (cell.getParent().getGeometry() != null) {\n+                x = Math.round(geometry.getX() + cell.getParent().getGeometry().getX());\n+                y = Math.round(geometry.getY() + cell.getParent().getGeometry().getY());\n+            } else {\n+                x = Math.round(geometry.getX());\n+                y = Math.round(geometry.getY());\n+            }", "originalCommit": "3c2f7f1b0ea0262fe6033f3f117cddc20f392888", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTA5NjcyNg==", "url": "https://github.com/dedica-team/nivio/pull/75#discussion_r365096726", "bodyText": "done.", "author": "bonndan", "createdAt": "2020-01-10T07:07:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ1MTgxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ1MjU1OA==", "url": "https://github.com/dedica-team/nivio/pull/75#discussion_r364452558", "bodyText": "Move static fields to the top of the class.", "author": "jpgoelz", "createdAt": "2020-01-08T21:30:19Z", "path": "src/main/java/de/bonndan/nivio/output/map/Hex.java", "diffHunk": "@@ -0,0 +1,82 @@\n+package de.bonndan.nivio.output.map;\n+\n+import java.util.ArrayList;\n+\n+public class Hex {\n+    public Hex(int q, int r, int s) {\n+        this.q = q;\n+        this.r = r;\n+        this.s = s;\n+        if (q + r + s != 0) throw new IllegalArgumentException(\"q + r + s must be 0\");\n+    }\n+\n+    public final int q;\n+    public final int r;\n+    public final int s;\n+\n+    public Hex add(Hex b) {\n+        return new Hex(q + b.q, r + b.r, s + b.s);\n+    }\n+\n+\n+    public Hex subtract(Hex b) {\n+        return new Hex(q - b.q, r - b.r, s - b.s);\n+    }\n+\n+\n+    public Hex scale(int k) {\n+        return new Hex(q * k, r * k, s * k);\n+    }\n+\n+\n+    public Hex rotateLeft() {\n+        return new Hex(-s, -q, -r);\n+    }\n+\n+\n+    public Hex rotateRight() {\n+        return new Hex(-r, -s, -q);\n+    }\n+\n+    static public ArrayList<Hex> directions = new ArrayList<Hex>() {{\n+        add(new Hex(1, 0, -1));\n+        add(new Hex(1, -1, 0));\n+        add(new Hex(0, -1, 1));\n+        add(new Hex(-1, 0, 1));\n+        add(new Hex(-1, 1, 0));\n+        add(new Hex(0, 1, -1));\n+    }};\n+\n+    static public Hex direction(int direction) {\n+        return Hex.directions.get(direction);\n+    }\n+\n+\n+    public Hex neighbor(int direction) {\n+        return add(Hex.direction(direction));\n+    }\n+\n+    static public ArrayList<Hex> diagonals = new ArrayList<Hex>() {{\n+        add(new Hex(2, -1, -1));\n+        add(new Hex(1, -2, 1));\n+        add(new Hex(-1, -1, 2));\n+        add(new Hex(-2, 1, 1));\n+        add(new Hex(-1, 2, -1));\n+        add(new Hex(1, 1, -2));\n+    }};", "originalCommit": "3c2f7f1b0ea0262fe6033f3f117cddc20f392888", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTA5NDczNw==", "url": "https://github.com/dedica-team/nivio/pull/75#discussion_r365094737", "bodyText": "done", "author": "bonndan", "createdAt": "2020-01-10T06:58:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ1MjU1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ1Mzc2Ng==", "url": "https://github.com/dedica-team/nivio/pull/75#discussion_r364453766", "bodyText": "remove", "author": "jpgoelz", "createdAt": "2020-01-08T21:33:18Z", "path": "src/main/java/de/bonndan/nivio/output/map/MapItem.java", "diffHunk": "@@ -0,0 +1,45 @@\n+package de.bonndan.nivio.output.map;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import de.bonndan.nivio.model.LandscapeItem;", "originalCommit": "3c2f7f1b0ea0262fe6033f3f117cddc20f392888", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "97fb7ba5eed9dc6b5960df28b469e7e8124cb652", "url": "https://github.com/dedica-team/nivio/commit/97fb7ba5eed9dc6b5960df28b469e7e8124cb652", "message": "cleanup", "committedDate": "2020-01-09T07:27:29Z", "type": "commit"}, {"oid": "dde3ccbaee76f712fac5ce65067c44e55f5fcaf1", "url": "https://github.com/dedica-team/nivio/commit/dde3ccbaee76f712fac5ce65067c44e55f5fcaf1", "message": "[#79] removed hex stuff calculation from java, now done in react", "committedDate": "2020-01-09T16:54:59Z", "type": "commit"}, {"oid": "0c368606472916a9443982fcc69ce9ff6c81cbf7", "url": "https://github.com/dedica-team/nivio/commit/0c368606472916a9443982fcc69ce9ff6c81cbf7", "message": "Merge branch 'develop' into hexmap", "committedDate": "2020-01-09T16:57:56Z", "type": "commit"}, {"oid": "10b01e074bbfd82dad173c65001771be33a81756", "url": "https://github.com/dedica-team/nivio/commit/10b01e074bbfd82dad173c65001771be33a81756", "message": "[#75] extracted method", "committedDate": "2020-01-10T07:06:12Z", "type": "commit"}, {"oid": "51d7dd3c4107adcfa5085cb4b504ed1053655c3a", "url": "https://github.com/dedica-team/nivio/commit/51d7dd3c4107adcfa5085cb4b504ed1053655c3a", "message": "Merge remote-tracking branch 'origin/hexmap' into hexmap", "committedDate": "2020-01-10T07:06:36Z", "type": "commit"}, {"oid": "b388e1cdffb0a6768cf1ea713d62308b7745dbec", "url": "https://github.com/dedica-team/nivio/commit/b388e1cdffb0a6768cf1ea713d62308b7745dbec", "message": "[#75] cleanup", "committedDate": "2020-01-10T07:08:44Z", "type": "commit"}]}