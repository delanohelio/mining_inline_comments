{"pr_number": 329, "pr_title": "working towards more immutable Landscape object", "pr_createdAt": "2020-10-31T11:39:27Z", "pr_url": "https://github.com/dedica-team/nivio/pull/329", "timeline": [{"oid": "6e97b26b35060eceac1225b8a909cadcfcdb8b37", "url": "https://github.com/dedica-team/nivio/commit/6e97b26b35060eceac1225b8a909cadcfcdb8b37", "message": "wip: working towards more immutable Landscape object", "committedDate": "2020-10-31T11:33:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ4ODQwMA==", "url": "https://github.com/dedica-team/nivio/pull/329#discussion_r515488400", "bodyText": "If we work towards immutable objects, the identifier must not be set from the outside. Did I understand the Test as it was before and do you think that it is meaningful now too?", "author": "mfbieber", "createdAt": "2020-10-31T11:41:12Z", "path": "src/test/java/de/bonndan/nivio/output/map/RenderCacheTest.java", "diffHunk": "@@ -43,41 +43,48 @@ public void setup() {\n \n     @Test\n     void toPNGCached() {\n-        Landscape landscape = getLandscape(\"test\");\n+        Landscape landscape = getLandscape(\"test\", \"testLandscape\");\n         String first = renderCache.getSVG(landscape, false);\n         String second = renderCache.getSVG(landscape, false);\n \n-        verify(stylesheetFactory, times(1)).getMapStylesheet(any(), any());\n+        verify(stylesheetFactory, times(1))\n+                .getMapStylesheet(any(), any());\n     }\n \n     @Test\n     void cachesBasedOnIdentifier() {\n-        Landscape one = getLandscape(\"test\");\n-        String first = renderCache.getSVG(getLandscape(\"test\"), false);\n-        Landscape two = getLandscape(\"test\");\n+        Landscape one = getLandscape(\"first\", \"one\");\n+        String first = renderCache.getSVG(\n+                getLandscape(\"first\", \"testLandscape\"),\n+                false\n+        );\n+        Landscape two = getLandscape(\"second\", \"two\");\n         two.setProcessLog(one.getLog()); //sync last update\n-        two.setIdentifier(\"second\");\n         String second = renderCache.getSVG(two, false);\n \n-        verify(stylesheetFactory, times(2)).getMapStylesheet(any(), any());\n+        verify(stylesheetFactory, times(2))\n+                .getMapStylesheet(any(), any());\n     }", "originalCommit": "6e97b26b35060eceac1225b8a909cadcfcdb8b37", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ5MDA4OA==", "url": "https://github.com/dedica-team/nivio/pull/329#discussion_r515490088", "bodyText": "You're right. It makes no sense changing the identifier.", "author": "bonndan", "createdAt": "2020-10-31T12:02:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ4ODQwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ5MDExOQ==", "url": "https://github.com/dedica-team/nivio/pull/329#discussion_r515490119", "bodyText": "The test is still valid.", "author": "bonndan", "createdAt": "2020-10-31T12:02:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ4ODQwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ5MDE0OA==", "url": "https://github.com/dedica-team/nivio/pull/329#discussion_r515490148", "bodyText": "Thanks :)", "author": "mfbieber", "createdAt": "2020-10-31T12:03:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ4ODQwMA=="}], "type": "inlineReview"}, {"oid": "6751d903c58110c98d817e01fb2e30a2a00d1d72", "url": "https://github.com/dedica-team/nivio/commit/6751d903c58110c98d817e01fb2e30a2a00d1d72", "message": "wip: removing setters for name, identifier and contact, and setting them through Landscape constructor", "committedDate": "2020-10-31T12:30:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ5MjgxMA==", "url": "https://github.com/dedica-team/nivio/pull/329#discussion_r515492810", "bodyText": "Is this meaningful?\nThis is for @RequestMapping(path = \"/landscape/{identifier}/services\", method = RequestMethod.POST), which I think triggers the indexing of a landscape provided by the POST body? Is this correct? Or are just Items added?", "author": "mfbieber", "createdAt": "2020-10-31T12:34:04Z", "path": "src/main/java/de/bonndan/nivio/api/ApiController.java", "diffHunk": "@@ -133,8 +133,7 @@ public ProcessLog indexLandscape(\n             @RequestHeader(name = \"format\") String format,\n             @RequestBody String body\n     ) {\n-        LandscapeDescription dto = new LandscapeDescription();\n-        dto.setIdentifier(identifier);\n+        LandscapeDescription dto = new LandscapeDescription(identifier, \"\", null);", "originalCommit": "6751d903c58110c98d817e01fb2e30a2a00d1d72", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ5OTA5NQ==", "url": "https://github.com/dedica-team/nivio/pull/329#discussion_r515499095", "bodyText": "This is for adding items via POST body. It should also trigger reindexing. While you're at it, you might consider renaming the path to \"/items\", because \"/services\" is not used as term anymore and narrows the usage too much (although this is not scope of the ticket).", "author": "bonndan", "createdAt": "2020-10-31T13:49:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ5MjgxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU2ODQyOQ==", "url": "https://github.com/dedica-team/nivio/pull/329#discussion_r535568429", "bodyText": "That is fine, I renamed the endpoint.\nSo it is totally ok to have a LandscapeDescription with an identifier, but without a human readble name - correct?", "author": "mfbieber", "createdAt": "2020-12-03T20:25:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ5MjgxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzODIxNw==", "url": "https://github.com/dedica-team/nivio/pull/329#discussion_r546238217", "bodyText": "Yes.", "author": "bonndan", "createdAt": "2020-12-19T13:24:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ5MjgxMA=="}], "type": "inlineReview"}, {"oid": "6fec7afa0174218a1094ec730d8b144df4604ce5", "url": "https://github.com/dedica-team/nivio/commit/6fec7afa0174218a1094ec730d8b144df4604ce5", "message": "Merge branch 'develop' into 212-immutable-objects\n\n# Conflicts:\n#\tsrc/main/java/de/bonndan/nivio/model/Landscape.java\n#\tsrc/test/java/de/bonndan/nivio/assessment/kpi/KPIFactoryTest.java", "committedDate": "2020-11-29T14:04:41Z", "type": "commit"}, {"oid": "2a015ed605f6ce8df4e4dcda76ddaef933bed3ec", "url": "https://github.com/dedica-team/nivio/commit/2a015ed605f6ce8df4e4dcda76ddaef933bed3ec", "message": "adapted KPIFactoryTest after merge with develop", "committedDate": "2020-11-29T14:14:20Z", "type": "commit"}, {"oid": "4942058a21e787910e59b34a30f0fac30b2f6678", "url": "https://github.com/dedica-team/nivio/commit/4942058a21e787910e59b34a30f0fac30b2f6678", "message": "started adding @Nonnull and @Nullable annotations, added jacoco", "committedDate": "2020-12-03T20:53:46Z", "type": "commit"}, {"oid": "e645ca60f319cf5f52cd465a73a0eda42f3668d6", "url": "https://github.com/dedica-team/nivio/commit/e645ca60f319cf5f52cd465a73a0eda42f3668d6", "message": "trying to fix jacoco test report generation", "committedDate": "2020-12-03T22:08:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg3NDg2NQ==", "url": "https://github.com/dedica-team/nivio/pull/329#discussion_r535874865", "bodyText": "StringUtils.isEmpty also handles null. This is why I like it.", "author": "bonndan", "createdAt": "2020-12-04T06:51:33Z", "path": "src/main/java/de/bonndan/nivio/assessment/StatusValue.java", "diffHunk": "@@ -54,23 +63,26 @@\n     /**\n      * Creates a summary status value.\n      *\n-     * @param field composed field name\n-     * @param max   max/highest status value\n+     * @param fieldName composed field name\n+     * @param maxValue   max/highest status value\n      * @return summary\n      */\n-    public static StatusValue summary(@NonNull String field, @NonNull StatusValue max) {\n-\n-        if (StringUtils.isEmpty(field)) {\n-            throw new IllegalArgumentException(\"Status value has no field\");\n+    @NonNull\n+    public static StatusValue summary(@NonNull String fieldName, @NonNull StatusValue maxValue) {\n+        if (StringUtils.isEmpty(fieldName)) {\n+            throw new IllegalArgumentException(\"Status value has no field name.\");\n         }\n-        return new StatusValue(field, max.getStatus(), max.getMessage(), max.getField());\n+        if (StringUtils.isEmpty(maxValue)) {\n+            throw new IllegalArgumentException(\"Status value has no max status value.\");\n+        }\n+        return new StatusValue(fieldName, maxValue.getStatus(), maxValue.getMessage(), maxValue.getField());\n     }\n \n     public StatusValue(@NonNull String field, @Nullable Status status, @Nullable String message) {\n         if (StringUtils.isEmpty(field)) {\n             throw new IllegalArgumentException(\"Status value has no field\");\n         }\n-        this.field = field;\n+        this.field = Objects.requireNonNull(field);", "originalCommit": "4942058a21e787910e59b34a30f0fac30b2f6678", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjAwMjYzOQ==", "url": "https://github.com/dedica-team/nivio/pull/329#discussion_r536002639", "bodyText": "Yes, I know that and use it too for null and empty checks. I don't know why I did that \ud83d\ude04", "author": "mfbieber", "createdAt": "2020-12-04T10:38:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg3NDg2NQ=="}], "type": "inlineReview"}, {"oid": "48a2756e36af70f89b0067c84ad10108e89c9e81", "url": "https://github.com/dedica-team/nivio/commit/48a2756e36af70f89b0067c84ad10108e89c9e81", "message": "removes unneeded Objects.requireNonNull() and initialized field in constructor of StatusValue", "committedDate": "2020-12-19T11:05:40Z", "type": "commit"}, {"oid": "d2e23014fe33e4fe978bea1959219b17cf8de75c", "url": "https://github.com/dedica-team/nivio/commit/d2e23014fe33e4fe978bea1959219b17cf8de75c", "message": "Merge branch 'develop' into 212-immutable-objects\n\n# Conflicts:\n#\tsrc/test/java/de/bonndan/nivio/output/map/svg/SVGItemLabelTest.java", "committedDate": "2020-12-19T13:07:09Z", "type": "commit"}, {"oid": "1a4e23635b23e431fa4b91285e3745cf9352844b", "url": "https://github.com/dedica-team/nivio/commit/1a4e23635b23e431fa4b91285e3745cf9352844b", "message": "Merge branch 'develop' into 212-immutable-objects", "committedDate": "2021-02-06T15:14:48Z", "type": "commit"}, {"oid": "5673b79f0d73f63a391fb29cc7a6de3ebda25424", "url": "https://github.com/dedica-team/nivio/commit/5673b79f0d73f63a391fb29cc7a6de3ebda25424", "message": "landscape is more immutable (collections can still be modified in size)", "committedDate": "2021-02-06T19:45:01Z", "type": "commit"}, {"oid": "270e8d228f373f370657c4f6fefd5d5aa845ebff", "url": "https://github.com/dedica-team/nivio/commit/270e8d228f373f370657c4f6fefd5d5aa845ebff", "message": "landscape kpis are final", "committedDate": "2021-02-07T07:29:29Z", "type": "commit"}, {"oid": "88d3523dc2781dd3f429f09aed1f9bb882095a84", "url": "https://github.com/dedica-team/nivio/commit/88d3523dc2781dd3f429f09aed1f9bb882095a84", "message": "refactored GroupFactory", "committedDate": "2021-02-07T07:55:37Z", "type": "commit"}, {"oid": "c7161109492695646f33b96e2e8bb11b78819aef", "url": "https://github.com/dedica-team/nivio/commit/c7161109492695646f33b96e2e8bb11b78819aef", "message": "immutable group", "committedDate": "2021-02-07T09:05:30Z", "type": "commit"}, {"oid": "65ca14b6c3002a60f7e94536ab19a280f18e3cfc", "url": "https://github.com/dedica-team/nivio/commit/65ca14b6c3002a60f7e94536ab19a280f18e3cfc", "message": "cleanup", "committedDate": "2021-02-07T09:11:31Z", "type": "commit"}, {"oid": "47383a03a3b82404d16c23748119c6386a9fe581", "url": "https://github.com/dedica-team/nivio/commit/47383a03a3b82404d16c23748119c6386a9fe581", "message": "immutable items", "committedDate": "2021-02-07T13:15:45Z", "type": "commit"}, {"oid": "d2cea03ad9b1f898afd8cfe871c55178978d4435", "url": "https://github.com/dedica-team/nivio/commit/d2cea03ad9b1f898afd8cfe871c55178978d4435", "message": "immutable relations", "committedDate": "2021-02-07T13:38:35Z", "type": "commit"}, {"oid": "dd48f4e61488d21e9ca34e1af7a9aec2320bd9d1", "url": "https://github.com/dedica-team/nivio/commit/dd48f4e61488d21e9ca34e1af7a9aec2320bd9d1", "message": "disabled tests which will be dropped in the future", "committedDate": "2021-02-07T13:40:12Z", "type": "commit"}, {"oid": "ca2a810c6a25e85c2052f0e1ff1aaa5f61533ece", "url": "https://github.com/dedica-team/nivio/commit/ca2a810c6a25e85c2052f0e1ff1aaa5f61533ece", "message": "Merge branch 'develop' into 212-immutable-objects\n\n# Conflicts:\n#\tsrc/main/java/de/bonndan/nivio/api/ApiController.java\n#\tsrc/test/java/de/bonndan/nivio/input/LandscapeDescriptionFactoryTest.java", "committedDate": "2021-02-07T18:02:33Z", "type": "commit"}, {"oid": "41d94e877c82cdd681fa95d6b9c8185cd8b8f1ed", "url": "https://github.com/dedica-team/nivio/commit/41d94e877c82cdd681fa95d6b9c8185cd8b8f1ed", "message": "resolved conflicts after merge with develop", "committedDate": "2021-02-07T18:06:17Z", "type": "commit"}, {"oid": "164a0ff96451afc7e7c9dde6a01f4c607199e18c", "url": "https://github.com/dedica-team/nivio/commit/164a0ff96451afc7e7c9dde6a01f4c607199e18c", "message": "Merge branch 'develop' into 212-immutable-objects\n\n# Conflicts:\n#\tsrc/main/java/de/bonndan/nivio/input/GroupQueryProcessor.java\n#\tsrc/main/java/de/bonndan/nivio/input/ItemRelationProcessor.java\n#\tsrc/main/java/de/bonndan/nivio/input/dto/LandscapeDescription.java\n#\tsrc/main/java/de/bonndan/nivio/model/Group.java\n#\tsrc/main/java/de/bonndan/nivio/model/Item.java\n#\tsrc/main/java/de/bonndan/nivio/model/ItemFactory.java\n#\tsrc/main/java/de/bonndan/nivio/model/Landscape.java\n#\tsrc/test/java/de/bonndan/nivio/input/MagicLabelRelationProcessorTest.java\n#\tsrc/test/java/de/bonndan/nivio/search/SearchDocumentFactoryTest.java", "committedDate": "2021-02-07T18:19:03Z", "type": "commit"}, {"oid": "d8683a3d49a139a53b7b1c53348c4b24c8ef4ec7", "url": "https://github.com/dedica-team/nivio/commit/d8683a3d49a139a53b7b1c53348c4b24c8ef4ec7", "message": "resolved conflicts after merge with develop", "committedDate": "2021-02-07T18:29:32Z", "type": "commit"}]}