{"pr_number": 136, "pr_title": "Refactor Context/API, fix changes from backend rework", "pr_createdAt": "2020-05-07T05:52:54Z", "pr_url": "https://github.com/dedica-team/nivio/pull/136", "timeline": [{"oid": "434e94226a05c21076da980a0961268726e679cc", "url": "https://github.com/dedica-team/nivio/commit/434e94226a05c21076da980a0961268726e679cc", "message": "first changes to fix backend rework", "committedDate": "2020-05-07T02:26:02Z", "type": "commit"}, {"oid": "e2172939edeb4807cd686502190adafe7ba54f8b", "url": "https://github.com/dedica-team/nivio/commit/e2172939edeb4807cd686502190adafe7ba54f8b", "message": "Merge branch 'develop' into refactoring/context-api", "committedDate": "2020-05-07T02:36:16Z", "type": "commit"}, {"oid": "17280cab55f400d93bdd10001235a34eafdfb4cb", "url": "https://github.com/dedica-team/nivio/commit/17280cab55f400d93bdd10001235a34eafdfb4cb", "message": "fix tests and remove react console mock", "committedDate": "2020-05-07T02:50:31Z", "type": "commit"}, {"oid": "0e2c32c966f5de6d08c087996b888124b5722fc1", "url": "https://github.com/dedica-team/nivio/commit/0e2c32c966f5de6d08c087996b888124b5722fc1", "message": "add dateformat for easy formatting, remove landscape context, add Item interface and use it in LandscapeItem", "committedDate": "2020-05-07T03:41:01Z", "type": "commit"}, {"oid": "0b75b40b1ad228427182edb43b7786dc151c3b15", "url": "https://github.com/dedica-team/nivio/commit/0b75b40b1ad228427182edb43b7786dc151c3b15", "message": "add titleBar in landscapeoverview layout", "committedDate": "2020-05-07T03:48:40Z", "type": "commit"}, {"oid": "2ebb7754f203c79b0efe84c97453c0760515b677", "url": "https://github.com/dedica-team/nivio/commit/2ebb7754f203c79b0efe84c97453c0760515b677", "message": "dont show pure json in landscapeItem, still needs rework", "committedDate": "2020-05-07T04:05:36Z", "type": "commit"}, {"oid": "9532e4ef14d3e090467cb783b100ea3530b56a98", "url": "https://github.com/dedica-team/nivio/commit/9532e4ef14d3e090467cb783b100ea3530b56a98", "message": "extract all api calls into an APIClient", "committedDate": "2020-05-07T05:22:08Z", "type": "commit"}, {"oid": "1665bdd5032bd1a53365f775ea838b18916a6cbc", "url": "https://github.com/dedica-team/nivio/commit/1665bdd5032bd1a53365f775ea838b18916a6cbc", "message": "change apiClient to a single get function with route as parameter", "committedDate": "2020-05-07T05:49:07Z", "type": "commit"}, {"oid": "4f6e77957508078e8e3d6b3fdf208ffed2eccaee", "url": "https://github.com/dedica-team/nivio/commit/4f6e77957508078e8e3d6b3fdf208ffed2eccaee", "message": "reroll env changes", "committedDate": "2020-05-07T05:54:04Z", "type": "commit"}, {"oid": "6223a00bcf886a33942eaae3c33e7305aaf3af1e", "url": "https://github.com/dedica-team/nivio/commit/6223a00bcf886a33942eaae3c33e7305aaf3af1e", "message": "Update .env", "committedDate": "2020-05-07T05:54:48Z", "type": "commit"}, {"oid": "465e90e69398846a0c715c6dd6df2c903ba7739f", "url": "https://github.com/dedica-team/nivio/commit/465e90e69398846a0c715c6dd6df2c903ba7739f", "message": "fix tests", "committedDate": "2020-05-07T06:00:19Z", "type": "commit"}, {"oid": "47a43c42bf7fc59831893512ca481fc8e88d640a", "url": "https://github.com/dedica-team/nivio/commit/47a43c42bf7fc59831893512ca481fc8e88d640a", "message": "npm run format", "committedDate": "2020-05-07T06:06:19Z", "type": "commit"}, {"oid": "f344ae930b52e67093afb34a91652574aa0e7d9b", "url": "https://github.com/dedica-team/nivio/commit/f344ae930b52e67093afb34a91652574aa0e7d9b", "message": "Merge branch 'refactoring/context-api' of https://github.com/dedica-team/nivio into refactoring/context-api", "committedDate": "2020-05-07T06:06:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI2NDg0Mw==", "url": "https://github.com/dedica-team/nivio/pull/136#discussion_r421264843", "bodyText": "What is actually the difference in JS?", "author": "bonndan", "createdAt": "2020-05-07T06:21:09Z", "path": "src/main/app/src/App.tsx", "diffHunk": "@@ -5,7 +5,7 @@ import LandscapeOverview from './Components/LandscapeComponent/LandscapeOverview\n import Landscape from './Components/LandscapeComponent/Landscape/Landscape';\n import Man from './Components/ManComponent/Man';\n import Layout from './Components/LayoutComponent/Layout';\n-import Events from \"./Components/EventComponent/Events\";\n+import Events from './Components/EventComponent/Events';", "originalCommit": "f344ae930b52e67093afb34a91652574aa0e7d9b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ4MDU0Nw==", "url": "https://github.com/dedica-team/nivio/pull/136#discussion_r421480547", "bodyText": "its just our prettier settings, we can change it to \" instead of '", "author": "MarvinSchoening", "createdAt": "2020-05-07T12:54:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI2NDg0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI3MzEyNw==", "url": "https://github.com/dedica-team/nivio/pull/136#discussion_r421273127", "bodyText": "We should think about removing the attributes width, height, x,y  from the API. These are leftovers from times when to hex map was drawn in the frontend.", "author": "bonndan", "createdAt": "2020-05-07T06:42:43Z", "path": "src/main/app/src/interfaces.ts", "diffHunk": "@@ -1,10 +1,35 @@\n export interface ILandscape {\n-    name: string;\n-    identifier: string;\n-    description?: string;\n-    contact?: string;\n-    teams: string[];\n-    groups?: string[];\n-    items?: string[];\n-    lastUpdate?: string;\n+  name: string;\n+  identifier: string;\n+  description?: string;\n+  teams?: object[]; // TODO: Create interface\n+  items?: IItem[];\n+  groups?: object[]; // TODO: Create interface\n+  lastUpdate?: string;\n+  overallState?: string;\n+}\n+\n+export interface IItem {\n+  color?: string;\n+  contact?: string;\n+  description?: string;\n+  fill?: string;", "originalCommit": "f344ae930b52e67093afb34a91652574aa0e7d9b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkzMzU3OA==", "url": "https://github.com/dedica-team/nivio/pull/136#discussion_r421933578", "bodyText": "see #137", "author": "bonndan", "createdAt": "2020-05-08T04:39:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI3MzEyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI3MzYyMw==", "url": "https://github.com/dedica-team/nivio/pull/136#discussion_r421273623", "bodyText": "Pls check if this appears at all. ProvidedBy is a shortcut for configuring landscapes long before internal processing is done.", "author": "bonndan", "createdAt": "2020-05-07T06:43:56Z", "path": "src/main/app/src/interfaces.ts", "diffHunk": "@@ -1,10 +1,35 @@\n export interface ILandscape {\n-    name: string;\n-    identifier: string;\n-    description?: string;\n-    contact?: string;\n-    teams: string[];\n-    groups?: string[];\n-    items?: string[];\n-    lastUpdate?: string;\n+  name: string;\n+  identifier: string;\n+  description?: string;\n+  teams?: object[]; // TODO: Create interface\n+  items?: IItem[];\n+  groups?: object[]; // TODO: Create interface\n+  lastUpdate?: string;\n+  overallState?: string;\n+}\n+\n+export interface IItem {\n+  color?: string;\n+  contact?: string;\n+  description?: string;\n+  fill?: string;\n+  fullyQualifiedIdentifier?: string;\n+  group?: string;\n+  height?: number;\n+  icon?: string;\n+  identifier: string;\n+  interfaces?: Array<Object>;\n+  labels?: Object;\n+  lifecycle?: String;\n+  links?: Object;\n+  name?: String;\n+  owner?: String;\n+  providedBy?: Array<Object>;", "originalCommit": "f344ae930b52e67093afb34a91652574aa0e7d9b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ4MTA1NQ==", "url": "https://github.com/dedica-team/nivio/pull/136#discussion_r421481055", "bodyText": "i've added all attributes that got send within the response, idk if its used anywhere but it is send", "author": "MarvinSchoening", "createdAt": "2020-05-07T12:55:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI3MzYyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkzMzM2Mg==", "url": "https://github.com/dedica-team/nivio/pull/136#discussion_r421933362", "bodyText": "OK. Then we should do #137 later.", "author": "bonndan", "createdAt": "2020-05-08T04:38:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI3MzYyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI3MzgzMQ==", "url": "https://github.com/dedica-team/nivio/pull/136#discussion_r421273831", "bodyText": "fqi is mandatory", "author": "bonndan", "createdAt": "2020-05-07T06:44:26Z", "path": "src/main/app/src/interfaces.ts", "diffHunk": "@@ -1,10 +1,35 @@\n export interface ILandscape {\n-    name: string;\n-    identifier: string;\n-    description?: string;\n-    contact?: string;\n-    teams: string[];\n-    groups?: string[];\n-    items?: string[];\n-    lastUpdate?: string;\n+  name: string;\n+  identifier: string;\n+  description?: string;\n+  teams?: object[]; // TODO: Create interface\n+  items?: IItem[];\n+  groups?: object[]; // TODO: Create interface\n+  lastUpdate?: string;\n+  overallState?: string;\n+}\n+\n+export interface IItem {\n+  color?: string;\n+  contact?: string;\n+  description?: string;\n+  fill?: string;\n+  fullyQualifiedIdentifier?: string;", "originalCommit": "f344ae930b52e67093afb34a91652574aa0e7d9b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI3Mzg4MA==", "url": "https://github.com/dedica-team/nivio/pull/136#discussion_r421273880", "bodyText": "name is mandatory", "author": "bonndan", "createdAt": "2020-05-07T06:44:34Z", "path": "src/main/app/src/interfaces.ts", "diffHunk": "@@ -1,10 +1,35 @@\n export interface ILandscape {\n-    name: string;\n-    identifier: string;\n-    description?: string;\n-    contact?: string;\n-    teams: string[];\n-    groups?: string[];\n-    items?: string[];\n-    lastUpdate?: string;\n+  name: string;\n+  identifier: string;\n+  description?: string;\n+  teams?: object[]; // TODO: Create interface\n+  items?: IItem[];\n+  groups?: object[]; // TODO: Create interface\n+  lastUpdate?: string;\n+  overallState?: string;\n+}\n+\n+export interface IItem {\n+  color?: string;\n+  contact?: string;\n+  description?: string;\n+  fill?: string;\n+  fullyQualifiedIdentifier?: string;\n+  group?: string;\n+  height?: number;\n+  icon?: string;\n+  identifier: string;\n+  interfaces?: Array<Object>;\n+  labels?: Object;\n+  lifecycle?: String;\n+  links?: Object;\n+  name?: String;", "originalCommit": "f344ae930b52e67093afb34a91652574aa0e7d9b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI3NDYxMw==", "url": "https://github.com/dedica-team/nivio/pull/136#discussion_r421274613", "bodyText": "see LandscapeDTO, I think overallState has been removed", "author": "bonndan", "createdAt": "2020-05-07T06:46:28Z", "path": "src/main/app/src/interfaces.ts", "diffHunk": "@@ -1,10 +1,35 @@\n export interface ILandscape {\n-    name: string;\n-    identifier: string;\n-    description?: string;\n-    contact?: string;\n-    teams: string[];\n-    groups?: string[];\n-    items?: string[];\n-    lastUpdate?: string;\n+  name: string;\n+  identifier: string;\n+  description?: string;\n+  teams?: object[]; // TODO: Create interface\n+  items?: IItem[];\n+  groups?: object[]; // TODO: Create interface\n+  lastUpdate?: string;\n+  overallState?: string;", "originalCommit": "f344ae930b52e67093afb34a91652574aa0e7d9b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ4MTcxNQ==", "url": "https://github.com/dedica-team/nivio/pull/136#discussion_r421481715", "bodyText": "yeah i wasn't sure if it was in before because we always had no data for it, i'll remove it for now", "author": "MarvinSchoening", "createdAt": "2020-05-07T12:56:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI3NDYxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI3NTI2OQ==", "url": "https://github.com/dedica-team/nivio/pull/136#discussion_r421275269", "bodyText": "We can leave this for now. I've made a wireframe to discuss future changes.", "author": "bonndan", "createdAt": "2020-05-07T06:48:05Z", "path": "src/main/app/src/Components/LandscapeComponent/Item/LandscapeItem.tsx", "diffHunk": "@@ -1,36 +1,46 @@\n-import React, { useEffect, useState } from 'react';\n+import React, { useEffect, useState, useCallback } from 'react';\n+import { get } from '../../../utils/API/APIClient';\n import './LandscapeItem.scss';\n \n+import { IItem } from '../../../interfaces';\n+\n interface Props {\n   element: Element;\n }\n \n /**\n  * Returns a choosen Landscape Item if informations are available\n  * @param element Choosen SVG Element from our Landscape Component\n- * TODO load assessment data\n- * TODO maybe use data from landscape context\n  */\n const LandscapeItem: React.FC<Props> = ({ element }) => {\n-  const [html, setHtml] = useState<string>(`Not Found :(`);\n+  const [item, setItem] = useState<IItem | null>();\n+  const [loadItem, setLoadItem] = useState<boolean>(true);\n   const [topic, setTopic] = useState<string | null>(null);\n \n+  const getItem = useCallback(async () => {\n+    if (loadItem && topic) {\n+      setItem(await get(`/api/${topic}`));\n+      setLoadItem(false);\n+    }\n+  }, [loadItem, topic]);\n+\n   useEffect(() => {\n     let topic = element.getAttribute('data-identifier');\n     setTopic(topic);\n     if (topic !== null) {\n-      console.log(topic);\n-      fetch(process.env.REACT_APP_BACKEND_URL + '/api/' + topic)\n-        .then((response) => {\n-          return response.json();\n-        })\n-        .then((data) => {\n-          setHtml(JSON.stringify(data));\n-        });\n+      getItem();\n     }\n-  }, [element, topic, html]);\n+  }, [element, topic, getItem]);\n \n-  return <div className='landscapeItemContent'>{html}</div>;\n+  return (", "originalCommit": "f344ae930b52e67093afb34a91652574aa0e7d9b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ4MDE3Mg==", "url": "https://github.com/dedica-team/nivio/pull/136#discussion_r421480172", "bodyText": "no we cant because it doesnt work anymore this way, we wont get html served anymore and we cant convert json to html :/", "author": "MarvinSchoening", "createdAt": "2020-05-07T12:54:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI3NTI2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ4MjQ2Nw==", "url": "https://github.com/dedica-team/nivio/pull/136#discussion_r421482467", "bodyText": "oh or do you mean styling the component? that's something that we can leave for now yes :D the slide in from the right side was the next thing i wanted to do", "author": "MarvinSchoening", "createdAt": "2020-05-07T12:57:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI3NTI2OQ=="}], "type": "inlineReview"}, {"oid": "4f311baf2324bc520f5911525e6de74970003de2", "url": "https://github.com/dedica-team/nivio/commit/4f311baf2324bc520f5911525e6de74970003de2", "message": "update interfaces", "committedDate": "2020-05-07T13:02:36Z", "type": "commit"}, {"oid": "ed1da19c5fca9ca458586ec20f15bb11d3e1835a", "url": "https://github.com/dedica-team/nivio/commit/ed1da19c5fca9ca458586ec20f15bb11d3e1835a", "message": "remove overall state from landscape overview", "committedDate": "2020-05-07T13:03:18Z", "type": "commit"}]}