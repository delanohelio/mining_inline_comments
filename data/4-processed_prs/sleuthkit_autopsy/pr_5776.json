{"pr_number": 5776, "pr_title": "6229: SEVERE errors from CR failing to handle custom account types", "pr_createdAt": "2020-04-03T19:04:55Z", "pr_url": "https://github.com/sleuthkit/autopsy/pull/5776", "timeline": [{"oid": "4303329f1f0f3428255961a92d36f1438d8afa17", "url": "https://github.com/sleuthkit/autopsy/commit/4303329f1f0f3428255961a92d36f1438d8afa17", "message": "6229: SEVERE errors from CR failing to handle custom account types", "committedDate": "2020-04-03T19:04:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI1ODU4OA==", "url": "https://github.com/sleuthkit/autopsy/pull/5776#discussion_r403258588", "bodyText": "We can\u2019t be sure the reason the exception is thrown is because the account type is not in the CR. I think it would be better to check the account type for membership in the set of standard account types. If it is not in the set, i.e., it is a custom account type, then we return without making a round trip to the CR at all.", "author": "rcordovano", "createdAt": "2020-04-03T19:18:59Z", "path": "Core/src/org/sleuthkit/autopsy/centralrepository/datamodel/CorrelationAttributeUtil.java", "diffHunk": "@@ -215,7 +215,14 @@ private static void makeCorrAttrFromAcctArtifact(List<CorrelationAttributeInstan\n         if (Account.Type.DEVICE.getTypeName().equalsIgnoreCase(accountTypeStr) == false) {\n \n             // Get the corresponding CentralRepoAccountType from the database.\n-            CentralRepoAccountType crAccountType = CentralRepository.getInstance().getAccountTypeByName(accountTypeStr);\n+            CentralRepoAccountType crAccountType;\n+            try {\n+                // @@TODO Vik-6136: CR currently does not know of custom account types.  \n+                // This try/catch prevents unnecessary exceptions, till CR handles implement custom account types\n+                crAccountType = CentralRepository.getInstance().getAccountTypeByName(accountTypeStr);\n+            } catch (CentralRepoException ex) {\n+                return;", "originalCommit": "4303329f1f0f3428255961a92d36f1438d8afa17", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI3OTMwOQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5776#discussion_r403279309", "bodyText": "That is exactly how I started out,  till I realized there is no easy, inexpensive and definitive way to check if the account we have is one of the default account types, so it might just be better to ignore the exception this way.\nThe only way to check is match on the DisplayName of the CorrelationAttrribute.Type from the list returned by CorrelationAttributeInstance.getDefaultCorrelationTypes().  In theory, the display names don't have to be unique - so there is a possibility of false positive - but since we set them up ourselves, I suppose we can assume they are unique.\nAnd getting the display name of the account type, from the account type that we have (from the TSK_ACCOUNT_TYPE attribute value of the artifact) in itself requires a roundtrip to the Case DB:\nskCase. getCommunicationsManager().getAccountType(acountTypeName)\nIt seems we would be adding more CPU cycles to EVERY call of makeCorrAttrFromAcctArtifact(),  to prevent an error message that has a low probability of happening.\nIf you still prefer this solution though. I'm happy to change it.", "author": "raman-bt", "createdAt": "2020-04-03T19:48:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI1ODU4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM0MTM0NQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5776#discussion_r403341345", "bodyText": "I don't understand why this is not simpler. In CorrelationAttributeUtil.makeCorrAttrFromAcctArtifact we have a BlackboardArtifact of type TSK_ACCOUNT in hand. We have a BlackboardAttribute of type TSK_ACCOUNT_TYPE from that artifact. If the string value of the attribute is is not equal to the type name of one of the account types in Account.PREDEFINED_ACCOUNT_TYPES, then we are done. What am I missing?", "author": "rcordovano", "createdAt": "2020-04-03T21:19:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI1ODU4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA1NzMxOQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5776#discussion_r404057319", "bodyText": "(SMH) Ahh, I see it now. You're saying to search the account type at hand with the Account.PREDEFINED_ACCOUNT_TYPES list.\nI was thinking of searching for the corresponding Correlation Attribute instance name, in the CorrelationAttributeInstance.getDefaultCorrelationTypes().\nI'll fix it.  Thanks.", "author": "raman-bt", "createdAt": "2020-04-06T12:38:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI1ODU4OA=="}], "type": "inlineReview"}, {"oid": "27cd407d8676a90df77d9b85d5addc7459bc7159", "url": "https://github.com/sleuthkit/autopsy/commit/27cd407d8676a90df77d9b85d5addc7459bc7159", "message": "Search incoming account in the Account.PREDEFINED_ACCOUNT_TYPES list.", "committedDate": "2020-04-06T13:26:28Z", "type": "commit"}]}