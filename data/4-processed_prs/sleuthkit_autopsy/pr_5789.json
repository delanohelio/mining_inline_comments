{"pr_number": 5789, "pr_title": "6251 is supported NPE", "pr_createdAt": "2020-04-08T15:04:13Z", "pr_url": "https://github.com/sleuthkit/autopsy/pull/5789", "timeline": [{"oid": "76d7292ea2cf9272254f8be236b0ed873398f52a", "url": "https://github.com/sleuthkit/autopsy/commit/76d7292ea2cf9272254f8be236b0ed873398f52a", "message": "initial implementation", "committedDate": "2020-04-07T20:13:02Z", "type": "commit"}, {"oid": "3c47c8b5f69448f29f231b7370358c90e9eb0069", "url": "https://github.com/sleuthkit/autopsy/commit/3c47c8b5f69448f29f231b7370358c90e9eb0069", "message": "initial implementation", "committedDate": "2020-04-07T20:13:20Z", "type": "commit"}, {"oid": "5a89c431a6ec1905fe20b359edc04edf8ddeca91", "url": "https://github.com/sleuthkit/autopsy/commit/5a89c431a6ec1905fe20b359edc04edf8ddeca91", "message": "updates to TextFileExtractor", "committedDate": "2020-04-08T13:13:02Z", "type": "commit"}, {"oid": "98933985031dc8ad8759959b716fbb91f48bb76a", "url": "https://github.com/sleuthkit/autopsy/commit/98933985031dc8ad8759959b716fbb91f48bb76a", "message": "cleanup", "committedDate": "2020-04-08T15:02:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4NzAxNg==", "url": "https://github.com/sleuthkit/autopsy/pull/5789#discussion_r405687016", "bodyText": "@rcordovano I'm wondering if we should log this as severe? I know that typically we try to reserve severe for errors that compromise the case, but I think if we are unable to instantiate FileTypeDetector class, then it definitely needs to be investigated.", "author": "eugene7646", "createdAt": "2020-04-08T17:19:08Z", "path": "Core/src/org/sleuthkit/autopsy/textextractors/TextFileExtractor.java", "diffHunk": "@@ -73,7 +76,26 @@ private Reader getReader(Charset encoding) {\n     }\n \n     @Override\n-    public boolean isSupported() {\n-        return file.getMIMEType().equals(\"text/plain\");\n+    public boolean isSupported() {        \n+        // get the MIME type\n+        String mimeType = file.getMIMEType();\n+        \n+        // if it is not present, attempt to use the FileTypeDetector to determine\n+        if (StringUtils.isEmpty(mimeType)) {\n+            FileTypeDetector fileTypeDetector = null;\n+            try {\n+                fileTypeDetector = new FileTypeDetector();\n+            } catch (FileTypeDetector.FileTypeDetectorInitException ex) {\n+                logger.log(Level.WARNING, \"Unable to create file type detector for determining MIME type.\");", "originalCommit": "98933985031dc8ad8759959b716fbb91f48bb76a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4ODQyOQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5789#discussion_r405688429", "bodyText": "@eugene7646 and @gdicristofaro, I agree, something is very wrong if we can't do file type detection and it will greatly affect the case.", "author": "rcordovano", "createdAt": "2020-04-08T17:21:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4NzAxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY5MzQ0OQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5789#discussion_r405693449", "bodyText": "Yep. Everything else looks good.", "author": "eugene7646", "createdAt": "2020-04-08T17:29:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4NzAxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcwNjQxNQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5789#discussion_r405706415", "bodyText": "Ok.  This should be resolved now.  Thanks.", "author": "gdicristofaro", "createdAt": "2020-04-08T17:51:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4NzAxNg=="}], "type": "inlineReview"}, {"oid": "1b238183046b0f25e83d7f4322e314076d59e4a8", "url": "https://github.com/sleuthkit/autopsy/commit/1b238183046b0f25e83d7f4322e314076d59e4a8", "message": "update log entry to severe", "committedDate": "2020-04-08T17:51:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1NTMzOQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5789#discussion_r405755339", "bodyText": "@eugene7646 and @gdicristofaro...\nDo you gentlemen realize that AbstractFile.setMIMEType only stores the result in the object, not in the case database? I suspect that is not what was intended here. I'm no longer sure what our policy is: do we save or throw away such calculations? We should check what we do elsewhere, and if the intent is to save here, call AbstractFile.save here.", "author": "rcordovano", "createdAt": "2020-04-08T19:15:59Z", "path": "Core/src/org/sleuthkit/autopsy/textextractors/TextFileExtractor.java", "diffHunk": "@@ -73,7 +76,26 @@ private Reader getReader(Charset encoding) {\n     }\n \n     @Override\n-    public boolean isSupported() {\n-        return file.getMIMEType().equals(\"text/plain\");\n+    public boolean isSupported() {        \n+        // get the MIME type\n+        String mimeType = file.getMIMEType();\n+        \n+        // if it is not present, attempt to use the FileTypeDetector to determine\n+        if (StringUtils.isEmpty(mimeType)) {\n+            FileTypeDetector fileTypeDetector = null;\n+            try {\n+                fileTypeDetector = new FileTypeDetector();\n+            } catch (FileTypeDetector.FileTypeDetectorInitException ex) {\n+                logger.log(Level.SEVERE, \"Unable to create file type detector for determining MIME type.\");\n+                return false;\n+            }\n+            mimeType = fileTypeDetector.getMIMEType(file);\n+            \n+            // if able to determine mime type, \n+            if (!StringUtils.isEmpty(mimeType))\n+                file.setMIMEType(mimeType);\n+        }", "originalCommit": "1b238183046b0f25e83d7f4322e314076d59e4a8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1NzQxMQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5789#discussion_r405757411", "bodyText": "Do you gentlemen realize that AbstractFile.setMIMEType only stores the result in the object, not in the case database?\n\nThe answer is \"no\". Personally I think we should save it in the database but I agree, we should check what we do in other places.", "author": "eugene7646", "createdAt": "2020-04-08T19:19:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1NTMzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwMjc0NQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5789#discussion_r405802745", "bodyText": "From what I can see, typically the result of FileTypeDetector.getMIMEType() is not persisted like FileViewer.isPreferred().  I don't believe I saw an example that the MIME type is set on a purely in-memory object either.  So, I can keep with this precedent if you would like and remove the file.setMIMEType all together or call save().  It appears that the save() method throws an exception on sql error, which may increase the complexity of the isSupported() method.", "author": "gdicristofaro", "createdAt": "2020-04-08T20:43:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1NTMzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwNDgxNA==", "url": "https://github.com/sleuthkit/autopsy/pull/5789#discussion_r405804814", "bodyText": "Let's just remove the call, thanks.", "author": "rcordovano", "createdAt": "2020-04-08T20:47:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1NTMzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE1MTI0OA==", "url": "https://github.com/sleuthkit/autopsy/pull/5789#discussion_r406151248", "bodyText": "Got it.", "author": "gdicristofaro", "createdAt": "2020-04-09T11:54:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1NTMzOQ=="}], "type": "inlineReview"}, {"oid": "797b4a99060ac555b8f0c09feb5af6b228fbe819", "url": "https://github.com/sleuthkit/autopsy/commit/797b4a99060ac555b8f0c09feb5af6b228fbe819", "message": "remove in-memory mime type change", "committedDate": "2020-04-09T11:54:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU4MjM4MQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5789#discussion_r406582381", "bodyText": "We should pass the exception to the logger as the third argument so that a stack trace is logged.", "author": "rcordovano", "createdAt": "2020-04-10T03:07:41Z", "path": "Core/src/org/sleuthkit/autopsy/textextractors/TextFileExtractor.java", "diffHunk": "@@ -73,7 +76,22 @@ private Reader getReader(Charset encoding) {\n     }\n \n     @Override\n-    public boolean isSupported() {\n-        return file.getMIMEType().equals(\"text/plain\");\n+    public boolean isSupported() {        \n+        // get the MIME type\n+        String mimeType = file.getMIMEType();\n+        \n+        // if it is not present, attempt to use the FileTypeDetector to determine\n+        if (StringUtils.isEmpty(mimeType)) {\n+            FileTypeDetector fileTypeDetector = null;\n+            try {\n+                fileTypeDetector = new FileTypeDetector();\n+            } catch (FileTypeDetector.FileTypeDetectorInitException ex) {\n+                logger.log(Level.SEVERE, \"Unable to create file type detector for determining MIME type.\");", "originalCommit": "797b4a99060ac555b8f0c09feb5af6b228fbe819", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}