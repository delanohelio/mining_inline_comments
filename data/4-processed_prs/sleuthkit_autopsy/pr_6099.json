{"pr_number": 6099, "pr_title": "6600 Text Detection Error", "pr_createdAt": "2020-07-20T14:58:41Z", "pr_url": "https://github.com/sleuthkit/autopsy/pull/6099", "timeline": [{"oid": "0940fe98cc750a5f50da4023f54db1e826833c53", "url": "https://github.com/sleuthkit/autopsy/commit/0940fe98cc750a5f50da4023f54db1e826833c53", "message": "Updated the EncodingUtils class to discard Tika's IBM500 result", "committedDate": "2020-07-20T14:53:05Z", "type": "commit"}, {"oid": "033935168f7467eea5c7f9fd516f0b06847f5591", "url": "https://github.com/sleuthkit/autopsy/commit/033935168f7467eea5c7f9fd516f0b06847f5591", "message": "Address Codacy comments", "committedDate": "2020-07-20T15:33:51Z", "type": "commit"}, {"oid": "4e7695dc12c75f831d9f13a5af610ab280cc15cf", "url": "https://github.com/sleuthkit/autopsy/commit/4e7695dc12c75f831d9f13a5af610ab280cc15cf", "message": "Removed useless comment", "committedDate": "2020-07-20T15:36:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUwNDY3MQ==", "url": "https://github.com/sleuthkit/autopsy/pull/6099#discussion_r457504671", "bodyText": "We should put the Tika story in here too.", "author": "bcarrier", "createdAt": "2020-07-20T15:39:45Z", "path": "Core/src/org/sleuthkit/autopsy/coreutils/textutils/EncodingUtils.java", "diffHunk": "@@ -87,12 +87,27 @@ public static Charset getEncoding(AbstractFile file) throws TskCoreException, IO\n         try (InputStream stream = new BufferedInputStream(new ReadContentInputStream(file))) {\n             CharsetDetector detector = new CharsetDetector();\n             detector.setText(stream);\n-            CharsetMatch tikaResult = detector.detect();\n-            if (tikaResult != null && tikaResult.getConfidence() >= MIN_CHARSETDETECT_MATCH_CONFIDENCE) {\n-                String tikaCharSet = tikaResult.getName();\n-                //Check if the nio package has support for the charset determined by Tika.\n-                if(Charset.isSupported(tikaCharSet)) {\n-                    return Charset.forName(tikaCharSet);\n+            \n+            CharsetMatch[] tikaResults = detector.detectAll();\n+            // Get all guesses by Tika. These CharsetMatch's are ordered\n+            // by descending confidence (largest first).\n+            if (tikaResults.length > 0) {\n+                CharsetMatch topPick = tikaResults[0];\n+                \n+                if (topPick.getName().equalsIgnoreCase(\"IBM500\") && tikaResults.length > 1) {\n+                    // Legacy encoding, let's discard this one in favor\n+                    // of the second pick. Tika has some problems with \n+                    // mistakenly identifying text as IBM500. See JIRA-6600 ", "originalCommit": "4e7695dc12c75f831d9f13a5af610ab280cc15cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUwOTQ3NA==", "url": "https://github.com/sleuthkit/autopsy/pull/6099#discussion_r457509474", "bodyText": "Done :)", "author": "dannysmyda", "createdAt": "2020-07-20T15:45:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUwNDY3MQ=="}], "type": "inlineReview"}, {"oid": "8532d1dc4c04a4a47648c00d60140b9e65c7fdae", "url": "https://github.com/sleuthkit/autopsy/commit/8532d1dc4c04a4a47648c00d60140b9e65c7fdae", "message": "Added link to TIKA story about IBM500 issue", "committedDate": "2020-07-20T15:43:16Z", "type": "commit"}]}