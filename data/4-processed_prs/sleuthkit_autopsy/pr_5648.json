{"pr_number": 5648, "pr_title": "6040 file discovery documents", "pr_createdAt": "2020-02-13T19:28:52Z", "pr_url": "https://github.com/sleuthkit/autopsy/pull/5648", "timeline": [{"oid": "8e7f51d0e37413ad4b343b0cdc29a6e0306a9c23", "url": "https://github.com/sleuthkit/autopsy/commit/8e7f51d0e37413ad4b343b0cdc29a6e0306a9c23", "message": "Merge branch 'develop' of https://github.com/sleuthkit/autopsy into 5979-DocumentViewer", "committedDate": "2020-02-04T20:23:52Z", "type": "commit"}, {"oid": "08a44050564b803d4e1bcfc83dfccfec066f01ff", "url": "https://github.com/sleuthkit/autopsy/commit/08a44050564b803d4e1bcfc83dfccfec066f01ff", "message": "6040 add end point for document summarization", "committedDate": "2020-02-13T17:40:34Z", "type": "commit"}, {"oid": "da53229ba436eb0980831ef417ec63a5ea2c069b", "url": "https://github.com/sleuthkit/autopsy/commit/da53229ba436eb0980831ef417ec63a5ea2c069b", "message": "6040 use summarizer for file discovery documents view", "committedDate": "2020-02-13T17:43:22Z", "type": "commit"}, {"oid": "6823ee858b7f78680e7fe204670aeb42ee666330", "url": "https://github.com/sleuthkit/autopsy/commit/6823ee858b7f78680e7fe204670aeb42ee666330", "message": "Merge branch 'develop' of https://github.com/sleuthkit/autopsy into 6040-FileDiscoveryDocuments", "committedDate": "2020-02-13T17:43:30Z", "type": "commit"}, {"oid": "314007f94055bbf87fd72bff9112fc7aff9ee144", "url": "https://github.com/sleuthkit/autopsy/commit/314007f94055bbf87fd72bff9112fc7aff9ee144", "message": "6040 adjust comments", "committedDate": "2020-02-13T19:28:27Z", "type": "commit"}, {"oid": "046e35b0d031a0d78df139c4321e29956044eb16", "url": "https://github.com/sleuthkit/autopsy/commit/046e35b0d031a0d78df139c4321e29956044eb16", "message": "6040 rename summarizer to textsummarizer", "committedDate": "2020-02-13T21:42:00Z", "type": "commit"}, {"oid": "3f25a126f1facae30b5048564287773c22440571", "url": "https://github.com/sleuthkit/autopsy/commit/3f25a126f1facae30b5048564287773c22440571", "message": "6040 fix exporting of renamed package", "committedDate": "2020-02-13T21:56:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTYxOTE2Nw==", "url": "https://github.com/sleuthkit/autopsy/pull/5648#discussion_r379619167", "bodyText": "Perhaps it would be better to return null instead of throwing an exception? Nothing has really gone wrong. And then you wouldn't need that empty catch block.", "author": "APriestman", "createdAt": "2020-02-14T20:00:35Z", "path": "Core/src/org/sleuthkit/autopsy/filequery/FileSearch.java", "diffHunk": "@@ -239,6 +247,80 @@ static SearchResults runFileSearchDebug(String userName,\n         return page;\n     }\n \n+    /**\n+     * Get a summary for the specified AbstractFile if no TextSummarizers exist get\n+     * the first bit of the file.\n+     *\n+     * @param file The AbstractFile to summarize.\n+     *\n+     * @return The summary or first bit of the specified file as a String.\n+     */\n+    @NbBundle.Messages({\"FileSearch.documentSummary.noPreview=No preview available.\",\n+        \"FileSearch.documentSummary.noBytes=No bytes read for document, unable to display preview.\"})\n+    static String summarize(AbstractFile file) {\n+        TextSummarizer localSummarizer = summarizerToUse;\n+        if (localSummarizer == null) {\n+            synchronized (searchCache) {\n+                if (localSummarizer == null) {\n+                    try {\n+                        localSummarizer = getLocalSummarizer();\n+                    } catch (IOException ignored) {\n+                        //no summarizers being present is not unexpected\n+                    }\n+                }\n+            }\n+        }\n+        if (localSummarizer == null) {\n+            //no summarizer was found just grab the first bit of the file\n+            return getFirstLines(file);\n+        } else {\n+            try {\n+                //a summary of length 40 seems to fit without vertical scroll bars\n+                return localSummarizer.summarize(file, 40);\n+            } catch (IOException ex) {\n+                return Bundle.FileSearch_documentSummary_noPreview();\n+            }\n+        }\n+\n+    }\n+\n+    /**\n+     * Get the first bit of text from the specified AbstractFile.\n+     *\n+     * @param file The AbstractFile to get text from.\n+     *\n+     * @return The first bit of text from the specified AbstractFile.\n+     */\n+    private static String getFirstLines(AbstractFile file) {\n+        try (Reader reader = TextExtractorFactory.getExtractor(file, null).getReader()) {\n+            char[] cbuf = new char[PREVIEW_SIZE];\n+            reader.read(cbuf, 0, PREVIEW_SIZE);\n+            return Arrays.toString(cbuf);\n+        } catch (IOException ex) {\n+            return Bundle.FileSearch_documentSummary_noBytes();\n+        } catch (TextExtractorFactory.NoTextExtractorFound | TextExtractor.InitReaderException ex) {\n+            return Bundle.FileSearch_documentSummary_noPreview();\n+        }\n+    }\n+\n+    /**\n+     * Get the first TextSummarizer found by a lookup of TextSummarizers.\n+     *\n+     * @return The first TextSummarizer found by a lookup of TextSummarizers.\n+     *\n+     * @throws IOException\n+     */\n+    private static TextSummarizer getLocalSummarizer() throws IOException {\n+        Collection<? extends TextSummarizer> summarizers\n+                = Lookup.getDefault().lookupAll(TextSummarizer.class\n+                );\n+        if (!summarizers.isEmpty()) {\n+            summarizerToUse = summarizers.iterator().next();\n+            return summarizerToUse;\n+        }\n+        throw new IOException(\"No summarizers found\");", "originalCommit": "3f25a126f1facae30b5048564287773c22440571", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c15d73f56125c9301363fe5a79f34aa5defbff65", "url": "https://github.com/sleuthkit/autopsy/commit/c15d73f56125c9301363fe5a79f34aa5defbff65", "message": "6040 fix comments to make more clear", "committedDate": "2020-02-18T20:48:37Z", "type": "commit"}, {"oid": "cc164739ed3fac131ab6123667a375a9760c357b", "url": "https://github.com/sleuthkit/autopsy/commit/cc164739ed3fac131ab6123667a375a9760c357b", "message": "6040 fix codacy issue", "committedDate": "2020-02-18T21:35:23Z", "type": "commit"}, {"oid": "9093fc4137cb0135375d685c6ce85a23352fb802", "url": "https://github.com/sleuthkit/autopsy/commit/9093fc4137cb0135375d685c6ce85a23352fb802", "message": "6040 fix char[] to String conversion", "committedDate": "2020-02-19T18:26:21Z", "type": "commit"}, {"oid": "425c59e63abaed6ebc11ff339bb8001c1ac5d875", "url": "https://github.com/sleuthkit/autopsy/commit/425c59e63abaed6ebc11ff339bb8001c1ac5d875", "message": "6040 inline size and count for doc summary", "committedDate": "2020-02-20T15:50:49Z", "type": "commit"}, {"oid": "13398f833a96dc6a2a7263c047684de148da1693", "url": "https://github.com/sleuthkit/autopsy/commit/13398f833a96dc6a2a7263c047684de148da1693", "message": "6040 add name label to panels to include name of first instance", "committedDate": "2020-02-20T23:52:29Z", "type": "commit"}, {"oid": "b5e84692740498ea305f5e8b92ff80650d1d629e", "url": "https://github.com/sleuthkit/autopsy/commit/b5e84692740498ea305f5e8b92ff80650d1d629e", "message": "6040 fix missing bundle message and exceptions from other workers", "committedDate": "2020-02-21T00:06:34Z", "type": "commit"}, {"oid": "7b7291119f9a9d32a7fec57c367bde25e94a33ba", "url": "https://github.com/sleuthkit/autopsy/commit/7b7291119f9a9d32a7fec57c367bde25e94a33ba", "message": "6040 fix paths for name field", "committedDate": "2020-02-21T16:38:28Z", "type": "commit"}, {"oid": "b611e6b822ae0b4e1f0c13da3bd9d70692a9ff20", "url": "https://github.com/sleuthkit/autopsy/commit/b611e6b822ae0b4e1f0c13da3bd9d70692a9ff20", "message": "6040 fix codacy address comment", "committedDate": "2020-02-21T18:09:37Z", "type": "commit"}]}