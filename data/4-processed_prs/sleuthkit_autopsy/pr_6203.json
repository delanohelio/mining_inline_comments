{"pr_number": 6203, "pr_title": "6732 - Added getArtifact method to DataSourceInfoUtilities", "pr_createdAt": "2020-08-21T20:43:39Z", "pr_url": "https://github.com/sleuthkit/autopsy/pull/6203", "timeline": [{"oid": "6e164dcfda9c5f8aa2912f9592f3ba39086639a5", "url": "https://github.com/sleuthkit/autopsy/commit/6e164dcfda9c5f8aa2912f9592f3ba39086639a5", "message": "Added getArtifact method to DataSourceInfoUtilities", "committedDate": "2020-08-21T20:42:46Z", "type": "commit"}, {"oid": "b697a4472c2c4df2a5bd1d68d4822fe631e922bd", "url": "https://github.com/sleuthkit/autopsy/commit/b697a4472c2c4df2a5bd1d68d4822fe631e922bd", "message": "Fixed codacy issues", "committedDate": "2020-08-24T14:24:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTgyNjk4NQ==", "url": "https://github.com/sleuthkit/autopsy/pull/6203#discussion_r475826985", "bodyText": "I think this is 'DESCENDING'", "author": "gdicristofaro", "createdAt": "2020-08-24T18:54:51Z", "path": "Core/src/org/sleuthkit/autopsy/datasourcesummary/datamodel/DataSourceInfoUtilities.java", "diffHunk": "@@ -133,9 +139,126 @@ static String getMetaFlagsContainsStatement(TSK_FS_META_FLAG_ENUM flag) {\n         return \"meta_flags & \" + flag.getValue() + \" > 0\";\n     }\n \n+    /**\n+     * Enum for specifying the sort order for getAttributes.\n+     */\n+    enum SortOrder {\n+        DECENDING,", "originalCommit": "b697a4472c2c4df2a5bd1d68d4822fe631e922bd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTgyODMyNA==", "url": "https://github.com/sleuthkit/autopsy/pull/6203#discussion_r475828324", "bodyText": "I think this may need to be a different data structure.  Right now, artifacts that have a null value for the attribute being sorted on are removed.  Also, if two items have the same sort value, then I believe only one is stored.", "author": "gdicristofaro", "createdAt": "2020-08-24T18:57:14Z", "path": "Core/src/org/sleuthkit/autopsy/datasourcesummary/datamodel/DataSourceInfoUtilities.java", "diffHunk": "@@ -133,9 +139,126 @@ static String getMetaFlagsContainsStatement(TSK_FS_META_FLAG_ENUM flag) {\n         return \"meta_flags & \" + flag.getValue() + \" > 0\";\n     }\n \n+    /**\n+     * Enum for specifying the sort order for getAttributes.\n+     */\n+    enum SortOrder {\n+        DECENDING,\n+        ASCENDING\n+    }\n+\n+    /**\n+     * Return a list of artifacts that have been sorted by their attribute of\n+     * attributeType.\n+     *\n+     * Sorting on attributes of type byte[] and JSON is not currently supported.\n+     *\n+     * @param skCase        SleuthkitCase instance.\n+     * @param artifactType  Type of artifacts to sort.\n+     * @param dataSource    Data Source that the artifact belongs to.\n+     * @param attributeType Attribute type to sort by.\n+     * @param sortOrder     Sort order of the attributes, either ascending or\n+     *                      descending.\n+     * @param maxCount      Maximum number of results to return. To return all\n+     *                      values maxCount should be -1.\n+     *\n+     * @return A list of artifacts of type artifactType sorted by the attribute\n+     *         of attributeType in the given sortOrder. If no artifacts are\n+     *         found an empty list will be returned.\n+     *\n+     * @throws TskCoreException\n+     */\n+    static List<BlackboardArtifact> getArtifacts(SleuthkitCase skCase, BlackboardArtifact.Type artifactType, DataSource dataSource, BlackboardAttribute.Type attributeType, SortOrder sortOrder, int maxCount) throws TskCoreException {\n+        if (maxCount < 1 && maxCount != -1) {\n+            throw new IllegalArgumentException(\"Invalid maxCount passed to getArtifacts, value must be at greater 0\");\n+        }\n+\n+        TreeMap<BlackboardAttribute, BlackboardArtifact> sortedMap = new TreeMap<>(new AttributeComparator(sortOrder));", "originalCommit": "b697a4472c2c4df2a5bd1d68d4822fe631e922bd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTg0MjMyOQ==", "url": "https://github.com/sleuthkit/autopsy/pull/6203#discussion_r475842329", "bodyText": "If an artifact does not have the attribute being sorted on it is not included.  Why would artifacts that doesn't have the attribute be of interest?\nYou are correct, the TreeMap doesn't allow for multiple of the same key.  I will fix that.", "author": "kellykelly3", "createdAt": "2020-08-24T19:24:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTgyODMyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTg2MTE0Mw==", "url": "https://github.com/sleuthkit/autopsy/pull/6203#discussion_r475861143", "bodyText": "Ok.  I think it would be good to document that behavior in the comment.  I initially thought it was going to behave comparable to a sql sort where rows with null for the sort value are still included.  It would be good to update the comment for the 'maxCount' parameter for the same reason.", "author": "gdicristofaro", "createdAt": "2020-08-24T20:01:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTgyODMyNA=="}], "type": "inlineReview"}, {"oid": "4cfbe6d18b0d9f5a498da9e0bd2d1f5cf7fc72ae", "url": "https://github.com/sleuthkit/autopsy/commit/4cfbe6d18b0d9f5a498da9e0bd2d1f5cf7fc72ae", "message": "Fixed bug and addressed review comment", "committedDate": "2020-08-25T18:58:12Z", "type": "commit"}, {"oid": "cf3bd7c831bcc2cb284706adb4db59f12ed3887f", "url": "https://github.com/sleuthkit/autopsy/commit/cf3bd7c831bcc2cb284706adb4db59f12ed3887f", "message": "fixed codacy issue", "committedDate": "2020-08-27T14:32:23Z", "type": "commit"}, {"oid": "9c455f728d079309c0ae764294c9c7e4668036a9", "url": "https://github.com/sleuthkit/autopsy/commit/9c455f728d079309c0ae764294c9c7e4668036a9", "message": "Fixed another codacy issue", "committedDate": "2020-08-27T19:16:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc2MDg2MA==", "url": "https://github.com/sleuthkit/autopsy/pull/6203#discussion_r478760860", "bodyText": "I think this is an unused import causing a codacy issue.", "author": "gdicristofaro", "createdAt": "2020-08-28T00:08:22Z", "path": "Core/src/org/sleuthkit/autopsy/datasourcesummary/datamodel/DataSourceInfoUtilities.java", "diffHunk": "@@ -20,13 +20,21 @@\n \n import java.sql.ResultSet;\n import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.Comparator;\n+import java.util.List;\n+import java.util.Map;", "originalCommit": "9c455f728d079309c0ae764294c9c7e4668036a9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc2MTA2Mw==", "url": "https://github.com/sleuthkit/autopsy/pull/6203#discussion_r478761063", "bodyText": "I think this is supposed to be \"Invalid maxCount passed to getArtifacts; value must be greater than or equal to 0.\"", "author": "gdicristofaro", "createdAt": "2020-08-28T00:09:09Z", "path": "Core/src/org/sleuthkit/autopsy/datasourcesummary/datamodel/DataSourceInfoUtilities.java", "diffHunk": "@@ -133,9 +141,204 @@ static String getMetaFlagsContainsStatement(TSK_FS_META_FLAG_ENUM flag) {\n         return \"meta_flags & \" + flag.getValue() + \" > 0\";\n     }\n \n+    /**\n+     * Enum for specifying the sort order for getAttributes.\n+     */\n+    enum SortOrder {\n+        DESCENDING,\n+        ASCENDING\n+    }\n+\n+    /**\n+     * Returns a list of all artifacts of the given type that have an attribute\n+     * of the given type sorted by given attribute type value. Artifacts that do\n+     * not have the given attribute will not be included in the list.\n+     *\n+     * Sorting on attributes of type byte[] and JSON is not currently supported.\n+     *\n+     * @param skCase        SleuthkitCase instance.\n+     * @param artifactType  Type of artifacts to sort.\n+     * @param dataSource    Data Source that the artifact belongs to.\n+     * @param attributeType Attribute type to sort by.\n+     * @param sortOrder     Sort order of the attributes, either ascending or\n+     *                      descending.\n+     *\n+     * @return A list of artifacts of type artifactType sorted by the attribute\n+     *         of attributeType in the given sortOrder. If no artifacts are\n+     *         found an empty list will be returned.\n+     *\n+     * @throws TskCoreException\n+     */\n+    static List<BlackboardArtifact> getArtifacts(SleuthkitCase skCase, BlackboardArtifact.Type artifactType, DataSource dataSource, BlackboardAttribute.Type attributeType, SortOrder sortOrder) throws TskCoreException {\n+        return getArtifacts(skCase, artifactType, dataSource, attributeType, sortOrder, 0);\n+    }\n+\n+    /**\n+     * Return a list of artifacts that have been sorted by their attribute of\n+     * attributeType. If an artifact of the given type does not have the given\n+     * attribute it will not be included in the returned list.\n+     *\n+     * Sorting on attributes of type byte[] and JSON is not currently supported.\n+     *\n+     * @param skCase        SleuthkitCase instance.\n+     * @param artifactType  Type of artifacts to sort.\n+     * @param dataSource    Data Source that the artifact belongs to.\n+     * @param attributeType Attribute type to sort by.\n+     * @param sortOrder     Sort order of the attributes, either ascending or\n+     *                      descending.\n+     * @param maxCount      Maximum number of results to return. To return all\n+     *                      values maxCount should be 0.\n+     *\n+     * @return A list of artifacts of type artifactType sorted by the attribute\n+     *         of attributeType in the given sortOrder. If no artifacts are\n+     *         found an empty list will be returned.\n+     *\n+     * @throws TskCoreException\n+     */\n+    static List<BlackboardArtifact> getArtifacts(SleuthkitCase skCase, BlackboardArtifact.Type artifactType, DataSource dataSource, BlackboardAttribute.Type attributeType, SortOrder sortOrder, int maxCount) throws TskCoreException {\n+        if (maxCount < 0) {\n+            throw new IllegalArgumentException(\"Invalid maxCount passed to getArtifacts, value must be at greater 0\");", "originalCommit": "9c455f728d079309c0ae764294c9c7e4668036a9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTI0NDUyNg==", "url": "https://github.com/sleuthkit/autopsy/pull/6203#discussion_r479244526", "bodyText": "I believe the intent is that if maxCount is zero, return all records.  It looks like this line causes no records to be returned in that event.", "author": "gdicristofaro", "createdAt": "2020-08-28T12:39:04Z", "path": "Core/src/org/sleuthkit/autopsy/datasourcesummary/datamodel/DataSourceInfoUtilities.java", "diffHunk": "@@ -133,9 +141,204 @@ static String getMetaFlagsContainsStatement(TSK_FS_META_FLAG_ENUM flag) {\n         return \"meta_flags & \" + flag.getValue() + \" > 0\";\n     }\n \n+    /**\n+     * Enum for specifying the sort order for getAttributes.\n+     */\n+    enum SortOrder {\n+        DESCENDING,\n+        ASCENDING\n+    }\n+\n+    /**\n+     * Returns a list of all artifacts of the given type that have an attribute\n+     * of the given type sorted by given attribute type value. Artifacts that do\n+     * not have the given attribute will not be included in the list.\n+     *\n+     * Sorting on attributes of type byte[] and JSON is not currently supported.\n+     *\n+     * @param skCase        SleuthkitCase instance.\n+     * @param artifactType  Type of artifacts to sort.\n+     * @param dataSource    Data Source that the artifact belongs to.\n+     * @param attributeType Attribute type to sort by.\n+     * @param sortOrder     Sort order of the attributes, either ascending or\n+     *                      descending.\n+     *\n+     * @return A list of artifacts of type artifactType sorted by the attribute\n+     *         of attributeType in the given sortOrder. If no artifacts are\n+     *         found an empty list will be returned.\n+     *\n+     * @throws TskCoreException\n+     */\n+    static List<BlackboardArtifact> getArtifacts(SleuthkitCase skCase, BlackboardArtifact.Type artifactType, DataSource dataSource, BlackboardAttribute.Type attributeType, SortOrder sortOrder) throws TskCoreException {\n+        return getArtifacts(skCase, artifactType, dataSource, attributeType, sortOrder, 0);\n+    }\n+\n+    /**\n+     * Return a list of artifacts that have been sorted by their attribute of\n+     * attributeType. If an artifact of the given type does not have the given\n+     * attribute it will not be included in the returned list.\n+     *\n+     * Sorting on attributes of type byte[] and JSON is not currently supported.\n+     *\n+     * @param skCase        SleuthkitCase instance.\n+     * @param artifactType  Type of artifacts to sort.\n+     * @param dataSource    Data Source that the artifact belongs to.\n+     * @param attributeType Attribute type to sort by.\n+     * @param sortOrder     Sort order of the attributes, either ascending or\n+     *                      descending.\n+     * @param maxCount      Maximum number of results to return. To return all\n+     *                      values maxCount should be 0.\n+     *\n+     * @return A list of artifacts of type artifactType sorted by the attribute\n+     *         of attributeType in the given sortOrder. If no artifacts are\n+     *         found an empty list will be returned.\n+     *\n+     * @throws TskCoreException\n+     */\n+    static List<BlackboardArtifact> getArtifacts(SleuthkitCase skCase, BlackboardArtifact.Type artifactType, DataSource dataSource, BlackboardAttribute.Type attributeType, SortOrder sortOrder, int maxCount) throws TskCoreException {\n+        if (maxCount < 0) {\n+            throw new IllegalArgumentException(\"Invalid maxCount passed to getArtifacts, value must be at greater 0\");\n+        }\n+\n+        return createListFromMap(getArtifactMap(skCase, artifactType, dataSource, attributeType, sortOrder), maxCount);\n+    }\n+\n     /**\n      * Empty private constructor\n      */\n     private DataSourceInfoUtilities() {\n     }\n+    \n+     /**\n+     * Create a Map of lists of artifacts sorted by the given attribute.\n+     *\n+     * @param skCase        SleuthkitCase instance.\n+     * @param artifactType  Type of artifacts to sort.\n+     * @param dataSource    Data Source that the artifact belongs to.\n+     * @param attributeType Attribute type to sort by.\n+     * @param sortOrder     Sort order of the attributes, either ascending or\n+     *                      descending.\n+     *\n+     * @return A Map of lists of artifacts sorted by the value of attribute\n+     *         given type. Artifacts that do not have an attribute of the given\n+     *         type will not be included.\n+     *\n+     * @throws TskCoreException\n+     */\n+    static private SortedMap<BlackboardAttribute, List<BlackboardArtifact>> getArtifactMap(SleuthkitCase skCase, BlackboardArtifact.Type artifactType, DataSource dataSource, BlackboardAttribute.Type attributeType, SortOrder sortOrder) throws TskCoreException {\n+        SortedMap<BlackboardAttribute, List<BlackboardArtifact>> sortedMap = new TreeMap<>(new AttributeComparator(sortOrder));\n+        List<BlackboardArtifact> artifactList = skCase.getBlackboard().getArtifacts(artifactType.getTypeID(), dataSource.getId());\n+\n+        for (BlackboardArtifact artifact : artifactList) {\n+            BlackboardAttribute attribute = artifact.getAttribute(attributeType);\n+            if (attribute == null) {\n+                continue;\n+            }\n+\n+            List<BlackboardArtifact> mapArtifactList = sortedMap.get(attribute);\n+            if (mapArtifactList == null) {\n+                mapArtifactList = new ArrayList<>();\n+                sortedMap.put(attribute, mapArtifactList);\n+            }\n+\n+            mapArtifactList.add(artifact);\n+        }\n+\n+        return sortedMap;\n+    }\n+\n+    /**\n+     * Creates the list of artifacts from the sorted map and the given count.\n+     *\n+     * @param sortedMap Sorted map of artifact lists.\n+     * @param maxCount  Maximum number of artifacts to return.\n+     *\n+     * @return List of artifacts, list will be empty if none were found.\n+     */\n+    static private List<BlackboardArtifact> createListFromMap(SortedMap<BlackboardAttribute, List<BlackboardArtifact>> sortedMap, int maxCount) {\n+        List<BlackboardArtifact> artifactList = new ArrayList<>();\n+\n+        for (List<BlackboardArtifact> mapArtifactList : sortedMap.values()) {\n+\n+            if (maxCount == artifactList.size()) {", "originalCommit": "9c455f728d079309c0ae764294c9c7e4668036a9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "024fb9325162380a1d4043895219bc389ab2a7d5", "url": "https://github.com/sleuthkit/autopsy/commit/024fb9325162380a1d4043895219bc389ab2a7d5", "message": "Fixed codacy issue", "committedDate": "2020-08-28T14:12:06Z", "type": "commit"}, {"oid": "964a06c37cedee96009d0a48c528e8da3bd92a8b", "url": "https://github.com/sleuthkit/autopsy/commit/964a06c37cedee96009d0a48c528e8da3bd92a8b", "message": "Merge branch 'develop' into 6732-getArtifact-datasourcesummary", "committedDate": "2020-08-28T14:38:53Z", "type": "commit"}, {"oid": "a1ad8398a1f4855595eb62ddc7fb62ce0823ce29", "url": "https://github.com/sleuthkit/autopsy/commit/a1ad8398a1f4855595eb62ddc7fb62ce0823ce29", "message": "Merged in develop", "committedDate": "2020-08-28T14:52:42Z", "type": "commit"}]}