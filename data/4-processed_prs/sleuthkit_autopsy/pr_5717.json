{"pr_number": 5717, "pr_title": "6151: Do not add account_id column to non-account correlation attribu\u2026", "pr_createdAt": "2020-03-17T20:17:06Z", "pr_url": "https://github.com/sleuthkit/autopsy/pull/5717", "timeline": [{"oid": "291d778ee2a96bf2d36e15f08ebe50650ed719f7", "url": "https://github.com/sleuthkit/autopsy/commit/291d778ee2a96bf2d36e15f08ebe50650ed719f7", "message": "6151: Do not add account_id column to non-account correlation attribute instance tables", "committedDate": "2020-03-17T20:16:04Z", "type": "commit"}, {"oid": "6b2f81134a9fcc4392e3e60e4db597d6cfe540f9", "url": "https://github.com/sleuthkit/autopsy/commit/6b2f81134a9fcc4392e3e60e4db597d6cfe540f9", "message": "Address Codacy comment.", "committedDate": "2020-03-17T22:48:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ5MDg0NA==", "url": "https://github.com/sleuthkit/autopsy/pull/5717#discussion_r394490844", "bodyText": "You could flatten this logic a bit by combining the else and the first conditional statement since everything in the else block also requires the first conditional to be true to happen.\nThis would likely make codacy not complain about the deeply nested inner conditional.", "author": "wschaeferB", "createdAt": "2020-03-18T16:44:44Z", "path": "Core/src/org/sleuthkit/autopsy/centralrepository/datamodel/CentralRepoDbUpgrader13To14.java", "diffHunk": "@@ -61,18 +61,19 @@ public void upgradeSchema(CaseDbSchemaVersionNumber dbSchemaVersion, Connection\n                         // add new correlation type\n                         CentralRepoDbUtil.insertCorrelationType(connection, type);\n \n-                    } else {\n-\n-                        // Alter the existing X_Instance tables to add account_id column \n-                        String sqlStr = String.format(getAlterArtifactInstancesAddAccountIdTemplate(selectedPlatform), instance_type_dbname);\n-                        statement.execute(sqlStr);\n-\n-                        // SQLite does NOT allow adding a constraint with Alter Table statement.\n-                        // The alternative would be to create new tables, copy all data over, and delete old tables - potentially a time consuming process. \n-                        // We decided to not add this constraint for SQLite, since there likely aren't many users using SQLite based Central Repo.\n-                        if (selectedPlatform == CentralRepoPlatforms.POSTGRESQL) {\n-                            sqlStr = String.format(getAlterArtifactInstancesAddAccountIdConstraintTemplate(), instance_type_dbname);\n+                    } else {    // existing attributes \n+                        // Alter the existing _instance tables for Phone and Email attributes to add account_id column \n+                        if (type.getId() == CorrelationAttributeInstance.EMAIL_TYPE_ID || type.getId() == CorrelationAttributeInstance.PHONE_TYPE_ID) {", "originalCommit": "291d778ee2a96bf2d36e15f08ebe50650ed719f7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU3OTI5Ng==", "url": "https://github.com/sleuthkit/autopsy/pull/5717#discussion_r394579296", "bodyText": "Uhh, I'd done just that, yesterday evening.  But apparently I did not push that commit up, as I though I had.", "author": "raman-bt", "createdAt": "2020-03-18T19:09:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ5MDg0NA=="}], "type": "inlineReview"}]}