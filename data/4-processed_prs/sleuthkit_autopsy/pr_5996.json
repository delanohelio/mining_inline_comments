{"pr_number": 5996, "pr_title": "1484 - Fixed SQL error in PersonaAccount add", "pr_createdAt": "2020-06-19T16:13:30Z", "pr_url": "https://github.com/sleuthkit/autopsy/pull/5996", "timeline": [{"oid": "27bdf3c0ce78e9b201a1334fb765491a6b29c79e", "url": "https://github.com/sleuthkit/autopsy/commit/27bdf3c0ce78e9b201a1334fb765491a6b29c79e", "message": "Fixed SQL error", "committedDate": "2020-06-19T16:12:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM4MzI5MQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5996#discussion_r444383291", "bodyText": "The justification itself could have a single quote in it.\nI think we may need to check and escape those.", "author": "raman-bt", "createdAt": "2020-06-23T17:17:35Z", "path": "Core/src/org/sleuthkit/autopsy/centralrepository/datamodel/PersonaAccount.java", "diffHunk": "@@ -379,7 +379,7 @@ static void modifyPersonaAccount(long id, Persona.Confidence confidence, String\n             throw new CentralRepoException(\"Failed to modify persona account, Central Repo is not enabled\");\n         }\n         \n-        String updateClause = \"UPDATE persona_accounts SET confidence_id = \" + confidence.getLevelId() + \", justification = \\\"\" + justification + \"\\\" WHERE id = \" + id;\n+        String updateClause = \"UPDATE persona_accounts SET confidence_id = \" + confidence.getLevelId() + \", justification = '\" + justification + \"' WHERE id = \" + id;", "originalCommit": "27bdf3c0ce78e9b201a1334fb765491a6b29c79e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM4ODAyOA==", "url": "https://github.com/sleuthkit/autopsy/pull/5996#discussion_r444388028", "bodyText": "Do we generally do that?  Do we look for other characters that should be escaped from a string?  That doesn't seem like a just here type of issue.  Like what prevents the justification from being an SQL statement?", "author": "kellykelly3", "createdAt": "2020-06-23T17:25:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM4MzI5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM5MjIwOA==", "url": "https://github.com/sleuthkit/autopsy/pull/5996#discussion_r444392208", "bodyText": "This is something an end user will type in UI. There's a good possibility that it could have a single quote :)\nI'm not saying to check it in every string, or check of all kinds of characters.  But a single quote in the justification string will cause the same kind of SQL error you're fixing.  If you search, you will find calls to escapeSingleQuotes() method in Persona API and elsewhere.", "author": "raman-bt", "createdAt": "2020-06-23T17:33:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM4MzI5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM5MzE2Nw==", "url": "https://github.com/sleuthkit/autopsy/pull/5996#discussion_r444393167", "bodyText": "I get that, my suggestion is that escapeSingleQuotes is not good enough.  What do we do in other places where the user can supply a string field like this?", "author": "kellykelly3", "createdAt": "2020-06-23T17:34:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM4MzI5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ0NjI1NA==", "url": "https://github.com/sleuthkit/autopsy/pull/5996#discussion_r444446254", "bodyText": "Since it sounds like there is more work in this area might be coming.  I will just remove the other instances of double quotes for this Jira\\PR", "author": "kellykelly3", "createdAt": "2020-06-23T19:08:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM4MzI5MQ=="}], "type": "inlineReview"}, {"oid": "8b9c5450c523ac0632fe224d1563dd1d77de93f3", "url": "https://github.com/sleuthkit/autopsy/commit/8b9c5450c523ac0632fe224d1563dd1d77de93f3", "message": "Removed the double quotes from the queries", "committedDate": "2020-06-24T14:06:12Z", "type": "commit"}, {"oid": "1e86dfb4e64c232d927f1fe35962bd3e90163059", "url": "https://github.com/sleuthkit/autopsy/commit/1e86dfb4e64c232d927f1fe35962bd3e90163059", "message": "merged in develop to fix conflict", "committedDate": "2020-06-25T18:28:01Z", "type": "commit"}, {"oid": "eb4a49fb1239255760ea73e6214341a5c38f187f", "url": "https://github.com/sleuthkit/autopsy/commit/eb4a49fb1239255760ea73e6214341a5c38f187f", "message": "Merged in develop", "committedDate": "2020-06-26T15:06:11Z", "type": "commit"}]}