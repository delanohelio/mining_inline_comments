{"pr_number": 6493, "pr_title": "6984 Add support for GPS area artifacts", "pr_createdAt": "2020-11-24T13:41:33Z", "pr_url": "https://github.com/sleuthkit/autopsy/pull/6493", "timeline": [{"oid": "98f3d2a974d96a35314e74b928f03a7e14a318d3", "url": "https://github.com/sleuthkit/autopsy/commit/98f3d2a974d96a35314e74b928f03a7e14a318d3", "message": "Add support for GPS area artifacts", "committedDate": "2020-11-24T13:22:17Z", "type": "commit"}, {"oid": "821b733428c258b2600b4938a89bfad9cfa7293d", "url": "https://github.com/sleuthkit/autopsy/commit/821b733428c258b2600b4938a89bfad9cfa7293d", "message": "Cleanup", "committedDate": "2020-11-24T13:40:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg2NTMwNA==", "url": "https://github.com/sleuthkit/autopsy/pull/6493#discussion_r529865304", "bodyText": "Missing method header.", "author": "kellykelly3", "createdAt": "2020-11-24T20:42:29Z", "path": "Core/src/org/sleuthkit/autopsy/geolocation/MapPanel.java", "diffHunk": "@@ -903,4 +943,66 @@ public void paint(Graphics2D g, JXMapViewer map, int w, int h) {\n             g2d.dispose();\n         }\n     }\n+    \n+    /**\n+     * Renderer for map areas\n+     */\n+    private class MapAreaRenderer implements Painter<JXMapViewer> {\n+\n+        private final List<Set<MapWaypoint>> areas;\n+\n+        MapAreaRenderer(List<Set<MapWaypoint>> areas) {\n+            this.areas = areas;\n+        }\n+\n+        private void drawArea(Set<MapWaypoint> area, Graphics2D g, JXMapViewer map) {", "originalCommit": "821b733428c258b2600b4938a89bfad9cfa7293d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg2NTYzOA==", "url": "https://github.com/sleuthkit/autopsy/pull/6493#discussion_r529865638", "bodyText": "Put 255.0 into constant.", "author": "kellykelly3", "createdAt": "2020-11-24T20:43:12Z", "path": "Core/src/org/sleuthkit/autopsy/geolocation/MapPanel.java", "diffHunk": "@@ -903,4 +943,66 @@ public void paint(Graphics2D g, JXMapViewer map, int w, int h) {\n             g2d.dispose();\n         }\n     }\n+    \n+    /**\n+     * Renderer for map areas\n+     */\n+    private class MapAreaRenderer implements Painter<JXMapViewer> {\n+\n+        private final List<Set<MapWaypoint>> areas;\n+\n+        MapAreaRenderer(List<Set<MapWaypoint>> areas) {\n+            this.areas = areas;\n+        }\n+\n+        private void drawArea(Set<MapWaypoint> area, Graphics2D g, JXMapViewer map) {\n+            if (area.isEmpty()) {\n+                return;\n+            }\n+            boolean first = true;\n+            \n+            GeneralPath polygon = new GeneralPath(GeneralPath.WIND_EVEN_ODD, area.size());\n+\n+            for (MapWaypoint wp : area) {\n+                Point2D p = map.getTileFactory().geoToPixel(wp.getPosition(), map.getZoom());\n+                int thisX = (int) p.getX();\n+                int thisY = (int) p.getY();\n+\n+                if (first) {\n+                    polygon.moveTo(thisX, thisY);\n+                    first = false;\n+                } else {\n+                    polygon.lineTo(thisX, thisY);\n+                }\n+            }\n+            polygon.closePath();\n+            \n+            Color areaColor = area.iterator().next().getColor();\n+            g.setPaint(new Color((float)(areaColor.getRed() / 255.0), ", "originalCommit": "821b733428c258b2600b4938a89bfad9cfa7293d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg2NTg4Nw==", "url": "https://github.com/sleuthkit/autopsy/pull/6493#discussion_r529865887", "bodyText": "Should the class for the logger be Track or Area?", "author": "kellykelly3", "createdAt": "2020-11-24T20:43:43Z", "path": "Core/src/org/sleuthkit/autopsy/geolocation/datamodel/Area.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2020 Basis Technology Corp.\n+ * contact: carrier <at> sleuthkit <dot> org\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.sleuthkit.autopsy.geolocation.datamodel;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.logging.Level;\n+import org.openide.util.NbBundle.Messages;\n+import org.sleuthkit.datamodel.BlackboardArtifact;\n+import org.sleuthkit.datamodel.BlackboardAttribute;\n+import org.sleuthkit.datamodel.blackboardutils.attributes.BlackboardJsonAttrUtil;\n+import org.sleuthkit.datamodel.blackboardutils.attributes.BlackboardJsonAttrUtil.InvalidJsonException;\n+import org.sleuthkit.datamodel.blackboardutils.attributes.GeoAreaPoints;\n+import org.sleuthkit.autopsy.coreutils.Logger;\n+\n+/**\n+ * A GPS track with which wraps the TSK_GPS_AREA artifact.\n+ */\n+public final class Area extends GeoPath {\n+    private static final Logger LOGGER = Logger.getLogger(Track.class.getName());", "originalCommit": "821b733428c258b2600b4938a89bfad9cfa7293d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg2NjYxNw==", "url": "https://github.com/sleuthkit/autopsy/pull/6493#discussion_r529866617", "bodyText": "Do we need to log the error and throw an exception?  Will the calling code write an error too?", "author": "kellykelly3", "createdAt": "2020-11-24T20:45:08Z", "path": "Core/src/org/sleuthkit/autopsy/geolocation/datamodel/Area.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2020 Basis Technology Corp.\n+ * contact: carrier <at> sleuthkit <dot> org\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.sleuthkit.autopsy.geolocation.datamodel;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.logging.Level;\n+import org.openide.util.NbBundle.Messages;\n+import org.sleuthkit.datamodel.BlackboardArtifact;\n+import org.sleuthkit.datamodel.BlackboardAttribute;\n+import org.sleuthkit.datamodel.blackboardutils.attributes.BlackboardJsonAttrUtil;\n+import org.sleuthkit.datamodel.blackboardutils.attributes.BlackboardJsonAttrUtil.InvalidJsonException;\n+import org.sleuthkit.datamodel.blackboardutils.attributes.GeoAreaPoints;\n+import org.sleuthkit.autopsy.coreutils.Logger;\n+\n+/**\n+ * A GPS track with which wraps the TSK_GPS_AREA artifact.\n+ */\n+public final class Area extends GeoPath {\n+    private static final Logger LOGGER = Logger.getLogger(Track.class.getName());\n+\n+    /**\n+     * Construct a new Area for the given artifact.\n+     *\n+     * @param artifact\n+     *\n+     * @throws GeoLocationDataException\n+     */\n+    public Area(BlackboardArtifact artifact) throws GeoLocationDataException {\n+        this(artifact, Waypoint.getAttributesFromArtifactAsMap(artifact));\n+    }\n+\n+    /**\n+     * Construct an Area for the given artifact and attributeMap.\n+     *\n+     * @param artifact     TSK_GPD_TRACK artifact\n+     * @param attributeMap Map of the artifact attributes\n+     *\n+     * @throws GeoLocationDataException\n+     */\n+    private Area(BlackboardArtifact artifact, Map<BlackboardAttribute.ATTRIBUTE_TYPE, BlackboardAttribute> attributeMap) throws GeoLocationDataException {\n+        super(artifact, getAreaName(attributeMap));\n+\n+        GeoAreaPoints points = getPointsList(attributeMap);\n+        buildPath(points, artifact);\n+    }\n+\n+    /**\n+     * Return the name of the area from the attributeMap. Track name is stored\n+     * in the attribute TSK_NAME\n+     *\n+     * @param attributeMap\n+     *\n+     * @return Area name or empty string if none was available.\n+     */\n+    private static String getAreaName(Map<BlackboardAttribute.ATTRIBUTE_TYPE, BlackboardAttribute> attributeMap) {\n+        BlackboardAttribute attribute = attributeMap.get(BlackboardAttribute.ATTRIBUTE_TYPE.TSK_NAME);\n+\n+        return attribute != null ? attribute.getValueString() : \"\";\n+    }\n+\n+    /**\n+     * Create the list of AreaWaypoints from the GeoTrackPoint list.\n+     *\n+     * @param points   GeoAreaPoints object.\n+     * @param artifact The artifact to which these points belong\n+     *\n+     * @throws GeoLocationDataException\n+     */\n+    @Messages({\n+        \"# {0} - area name\",\n+        \"GEOArea_point_label_header=Area outline point for area: {0}\"\n+    })\n+    private void buildPath(GeoAreaPoints points, BlackboardArtifact artifact) throws GeoLocationDataException {\n+        for (GeoAreaPoints.AreaPoint point : points) {\n+            addToPath(new AreaWaypoint(artifact, Bundle.GEOArea_point_label_header(getLabel()), point));\n+        }\n+    }\n+\n+    /**\n+     * Returns the list of GeoAreaPoints from the attributeMap. Creates the\n+     * GeoAreaPoint list from the TSK_GEO_AREAPOINTS attribute.\n+     *\n+     * @param attributeMap Map of artifact attributes.\n+     *\n+     * @return GeoTrackPoint list empty list if the attribute was not found.\n+     *\n+     * @throws GeoLocationDataException\n+     */\n+    private GeoAreaPoints getPointsList(Map<BlackboardAttribute.ATTRIBUTE_TYPE, BlackboardAttribute> attributeMap) throws GeoLocationDataException {\n+        BlackboardAttribute attribute = attributeMap.get(BlackboardAttribute.ATTRIBUTE_TYPE.TSK_GEO_AREAPOINTS);\n+        if (attribute == null) {\n+            LOGGER.log(Level.SEVERE, \"No TSK_GEO_AREAPOINTS attribute was present on the artifact.\");", "originalCommit": "821b733428c258b2600b4938a89bfad9cfa7293d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg4NTcxNA==", "url": "https://github.com/sleuthkit/autopsy/pull/6493#discussion_r529885714", "bodyText": "So that's copied from the Track class, and the error actually isn't logged in the one place I see it being caught in GeoPath.\n} catch (GeoLocationDataException e) {\nallParsedSuccessfully = false;\n}\nBut I think it is better behavior to throw the exception and then log it up there where we have access to the artifactID, so I'll update my code and the Track code.", "author": "APriestman", "createdAt": "2020-11-24T21:21:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg2NjYxNw=="}], "type": "inlineReview"}, {"oid": "37756a5f908fcfc0bc4c48d9c1dd9eed0d9469ee", "url": "https://github.com/sleuthkit/autopsy/commit/37756a5f908fcfc0bc4c48d9c1dd9eed0d9469ee", "message": "Review", "committedDate": "2020-11-25T13:00:10Z", "type": "commit"}]}