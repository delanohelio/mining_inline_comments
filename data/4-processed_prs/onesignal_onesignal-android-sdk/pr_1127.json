{"pr_number": 1127, "pr_title": "Make OSTimeoutHandler be a HandlerThread", "pr_createdAt": "2020-08-28T21:17:04Z", "pr_url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1127", "timeline": [{"oid": "aef7c2ffabed715f67f9fc03ee646cfa32c88985", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/aef7c2ffabed715f67f9fc03ee646cfa32c88985", "message": "Make OSTimeoutHandler be a HandlerThread\n\n  * Workers dependens on the device cores to have a pool of threads available.\n  * Loopers handling are hard to debug, and maintain\n  * Make a Handler Thread available for post delays runnables\n  * Make OSTimeoutHandler available betweeen jobs", "committedDate": "2020-08-28T21:17:58Z", "type": "forcePushed"}, {"oid": "e74c4f71932fb2076c94788f01befa582ecd34cb", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/e74c4f71932fb2076c94788f01befa582ecd34cb", "message": "Make OSTimeoutHandler be a HandlerThread\n\n  * Workers dependens on the device cores to have a pool of threads available.\n  * Loopers handling are hard to debug, and maintain\n  * Make a Handler Thread available for post delays runnables\n  * Make OSTimeoutHandler available betweeen jobs", "committedDate": "2020-08-28T21:34:38Z", "type": "forcePushed"}, {"oid": "065afc6d43709c94d13076411a7752c7a360d85d", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/065afc6d43709c94d13076411a7752c7a360d85d", "message": "Make OSTimeoutHandler be a HandlerThread\n\n  * Workers dependens on the device cores to have a pool of threads available.\n  * Loopers handling are hard to debug, and maintain\n  * Make a Handler Thread available for post delays runnables\n  * Make OSTimeoutHandler available betweeen jobs", "committedDate": "2020-08-28T21:35:38Z", "type": "forcePushed"}, {"oid": "905b7166cd2d85cb52cb698111baba5cb8f482e1", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/905b7166cd2d85cb52cb698111baba5cb8f482e1", "message": "Make OSTimeoutHandler be a HandlerThread\n\n  * Workers dependens on the device cores to have a pool of threads available.\n  * Loopers handling are hard to debug, and maintain\n  * Make a Handler Thread available for post delays runnables\n  * Make OSTimeoutHandler available betweeen jobs", "committedDate": "2020-08-28T21:50:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTcwMjA0NA==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1127#discussion_r479702044", "bodyText": "This test is now taking ~35 seconds to complete when it wasn't before.\nI investigated this a bit and it is due to the Thread.sleep in notificationWillShowInForeground in the\ncom.test.onesignal.GenerateNotificationRunner$NotificationExtensionService_workTimeLongerThanTimeout class never being interrupted.\nThe other app specific one notificationWillShowInForeground is being interrupted correctly however.", "author": "jkasten2", "createdAt": "2020-08-29T23:55:49Z", "path": "OneSignalSDK/unittest/src/test/java/com/test/onesignal/GenerateNotificationRunner.java", "diffHunk": "@@ -2121,6 +2125,7 @@ public void notificationWillShowInForeground(OSNotificationGenerationJob.ExtNoti\n    }\n \n    @Test\n+   @Config(shadows = { ShadowTimeoutHandler.class })\n    public void testNotificationWillShowInForegroundHandler_workTimeLongerThanTimeout() throws Exception {", "originalCommit": "905b7166cd2d85cb52cb698111baba5cb8f482e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI1MzgzMQ==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1127#discussion_r480253831", "bodyText": "there is no need for the 35 seconds, due that we are reducing the timeout time to 1, to avoid waiting that long. Also reduced the thread sleep for 3 seconds, first sleep will be interrupted but the second sleep", "author": "Jeasmine", "createdAt": "2020-08-31T16:44:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTcwMjA0NA=="}], "type": "inlineReview"}, {"oid": "ee55428ec4539c55820c6489335262793bdcb7b6", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/ee55428ec4539c55820c6489335262793bdcb7b6", "message": "Make OSTimeoutHandler be a HandlerThread\n\n  * Workers dependens on the device cores to have a pool of threads available.\n  * Loopers handling are hard to debug, and maintain\n  * Make a Handler Thread available for post delays runnables\n  * Make OSTimeoutHandler available betweeen jobs", "committedDate": "2020-08-31T16:43:17Z", "type": "commit"}, {"oid": "ee55428ec4539c55820c6489335262793bdcb7b6", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/ee55428ec4539c55820c6489335262793bdcb7b6", "message": "Make OSTimeoutHandler be a HandlerThread\n\n  * Workers dependens on the device cores to have a pool of threads available.\n  * Loopers handling are hard to debug, and maintain\n  * Make a Handler Thread available for post delays runnables\n  * Make OSTimeoutHandler available betweeen jobs", "committedDate": "2020-08-31T16:43:17Z", "type": "forcePushed"}]}