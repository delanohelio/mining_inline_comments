{"pr_number": 2854, "pr_title": "SONARJAVA-3312 FN for S2755: improve detection of XXE attacks", "pr_createdAt": "2020-03-03T12:04:06Z", "pr_url": "https://github.com/SonarSource/sonar-java/pull/2854", "timeline": [{"oid": "f916ffe71b43440c6e400698ca46be50d42d8574", "url": "https://github.com/SonarSource/sonar-java/commit/f916ffe71b43440c6e400698ca46be50d42d8574", "message": "Support setting property with variable", "committedDate": "2020-03-03T12:07:34Z", "type": "forcePushed"}, {"oid": "0bf2634a67d29f9271d13701a4c66e59bd6148f5", "url": "https://github.com/SonarSource/sonar-java/commit/0bf2634a67d29f9271d13701a4c66e59bd6148f5", "message": "Support setting property with variable", "committedDate": "2020-03-03T12:10:40Z", "type": "forcePushed"}, {"oid": "2f4bce980c7101196146fecced36fb5d4040f58d", "url": "https://github.com/SonarSource/sonar-java/commit/2f4bce980c7101196146fecced36fb5d4040f58d", "message": "SONARJAVA-3312 Correctly support transferring method call with argument(s)", "committedDate": "2020-03-03T15:16:46Z", "type": "commit"}, {"oid": "0226b92ba5b7bc6ecf3ca810e27d95e58923e431", "url": "https://github.com/SonarSource/sonar-java/commit/0226b92ba5b7bc6ecf3ca810e27d95e58923e431", "message": "SONARJAVA-3312 Support setting property from (non constant) identifier", "committedDate": "2020-03-03T15:17:35Z", "type": "forcePushed"}, {"oid": "d6582a2408f6ecf520db8439bddb1377ff8b0d3d", "url": "https://github.com/SonarSource/sonar-java/commit/d6582a2408f6ecf520db8439bddb1377ff8b0d3d", "message": "SONARJAVA-3312 Support setting property from (non constant) identifier", "committedDate": "2020-03-03T15:20:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE1MDA2Mg==", "url": "https://github.com/SonarSource/sonar-java/pull/2854#discussion_r387150062", "bodyText": "two options here:\n\nyou can replace property.propertyName()::equals by property::isNamed\nor you can drop isNamed(String), as I have to feeling that it does the same at the end  (see line below)", "author": "m-g-sonar", "createdAt": "2020-03-03T16:42:57Z", "path": "java-frontend/src/main/java/org/sonar/java/se/checks/XxeProcessingCheck.java", "diffHunk": "@@ -339,8 +346,13 @@ private ProgramState checkArguments(ProgramState state, Arguments arguments, Xxe\n       return state;\n     }\n \n-    boolean isSettingProperty(ExpressionTree arg0, String propertyName) {\n-      return arg0.asConstant(String.class).filter(propertyName::equals).isPresent();\n+    boolean isSettingProperty(ProgramState state, ExpressionTree arg0, XxeProperty property) {\n+      if (arg0.asConstant(String.class).filter(property.propertyName()::equals).isPresent()) {", "originalCommit": "d6582a2408f6ecf520db8439bddb1377ff8b0d3d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE1MjIzNA==", "url": "https://github.com/SonarSource/sonar-java/pull/2854#discussion_r387152234", "bodyText": "what about property.propertyName().equals(value.get()) and drop isNamed? or maybe we don't need anymore propertyName()", "author": "m-g-sonar", "createdAt": "2020-03-03T16:46:17Z", "path": "java-frontend/src/main/java/org/sonar/java/se/checks/XxeProcessingCheck.java", "diffHunk": "@@ -351,6 +363,23 @@ public ProgramState checkPostStatement(CheckerContext context, Tree syntaxNode)\n     return visitor.programState;\n   }\n \n+  private static ProgramState addNamedConstraint(@Nullable ExpressionTree expressionTree, ProgramState state) {\n+    if (expressionTree != null) {\n+      SymbolicValue sv = state.peekValue();\n+      if (sv != null) {\n+        Optional<String> value = expressionTree.asConstant(String.class);\n+        if (value.isPresent()) {\n+          for (XxeProperty property : PROPERTIES_TO_CHECK) {\n+            if (property.isNamed(value.get())) {", "originalCommit": "d6582a2408f6ecf520db8439bddb1377ff8b0d3d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE1MzYyMA==", "url": "https://github.com/SonarSource/sonar-java/pull/2854#discussion_r387153620", "bodyText": "I would put named on the first line, next to propertyName to group them semantically.", "author": "m-g-sonar", "createdAt": "2020-03-03T16:48:25Z", "path": "java-frontend/src/main/java/org/sonar/java/se/checks/XxeProperty.java", "diffHunk": "@@ -81,24 +89,28 @@ static boolean isSetToTrue(@Nullable SymbolicValue sv1, ExpressionTree arg1) {\n     private final BiPredicate<SymbolicValue, ExpressionTree> unsecuring;\n     private final Constraint unsecured;\n \n+    private final Constraint named;\n+\n     public XxePropertyHolder(String propertyName,\n       BiPredicate<SymbolicValue, ExpressionTree> securing, Constraint secured,\n-      BiPredicate<SymbolicValue, ExpressionTree> unsecuring, Constraint unsecured) {\n+      BiPredicate<SymbolicValue, ExpressionTree> unsecuring, Constraint unsecured, Constraint named) {", "originalCommit": "d6582a2408f6ecf520db8439bddb1377ff8b0d3d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d5f33ba3620821f0e15178ccc3f1e1a148ccf527", "url": "https://github.com/SonarSource/sonar-java/commit/d5f33ba3620821f0e15178ccc3f1e1a148ccf527", "message": "SONARJAVA-3312 Support setting property from (non constant) identifier", "committedDate": "2020-03-04T09:45:33Z", "type": "commit"}, {"oid": "d5f33ba3620821f0e15178ccc3f1e1a148ccf527", "url": "https://github.com/SonarSource/sonar-java/commit/d5f33ba3620821f0e15178ccc3f1e1a148ccf527", "message": "SONARJAVA-3312 Support setting property from (non constant) identifier", "committedDate": "2020-03-04T09:45:33Z", "type": "forcePushed"}]}