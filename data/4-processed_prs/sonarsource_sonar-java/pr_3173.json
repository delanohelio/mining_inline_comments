{"pr_number": 3173, "pr_title": "SONARJAVA-3511 Rule S5961: Test methods should not contain too many assertions", "pr_createdAt": "2020-09-11T11:58:08Z", "pr_url": "https://github.com/SonarSource/sonar-java/pull/3173", "timeline": [{"oid": "e4332fd6c796290ac9ead87e3913a6796d31a02b", "url": "https://github.com/SonarSource/sonar-java/commit/e4332fd6c796290ac9ead87e3913a6796d31a02b", "message": "Implement rule & refactoring", "committedDate": "2020-09-11T17:15:53Z", "type": "forcePushed"}, {"oid": "359daa1f7589f52b37579da05b5aa93f0d80022d", "url": "https://github.com/SonarSource/sonar-java/commit/359daa1f7589f52b37579da05b5aa93f0d80022d", "message": "Update tests", "committedDate": "2020-09-11T19:03:17Z", "type": "forcePushed"}, {"oid": "2f8d8ce43bcef3469dc1597f10a2394e47d1bb31", "url": "https://github.com/SonarSource/sonar-java/commit/2f8d8ce43bcef3469dc1597f10a2394e47d1bb31", "message": "Update tests", "committedDate": "2020-09-14T07:05:44Z", "type": "forcePushed"}, {"oid": "0c77fa79ce33f4bf56c6855c37d2b8998ed90d83", "url": "https://github.com/SonarSource/sonar-java/commit/0c77fa79ce33f4bf56c6855c37d2b8998ed90d83", "message": "Update tests", "committedDate": "2020-09-14T07:10:55Z", "type": "forcePushed"}, {"oid": "02a18ad62bf3eba02c18f8dd541bb51ca0cb5057", "url": "https://github.com/SonarSource/sonar-java/commit/02a18ad62bf3eba02c18f8dd541bb51ca0cb5057", "message": "Update tests", "committedDate": "2020-09-14T08:55:01Z", "type": "forcePushed"}, {"oid": "eca9a78a401b0f7099025a88897f0ac41f0e0dd5", "url": "https://github.com/SonarSource/sonar-java/commit/eca9a78a401b0f7099025a88897f0ac41f0e0dd5", "message": "Update tests", "committedDate": "2020-09-14T09:39:36Z", "type": "forcePushed"}, {"oid": "0241a1d1b57d75af1b02ef55cd9ec65a3f69557c", "url": "https://github.com/SonarSource/sonar-java/commit/0241a1d1b57d75af1b02ef55cd9ec65a3f69557c", "message": "SONARJAVA-3511 Rule S5961: Test methods should not contain too many assertions", "committedDate": "2020-09-14T11:09:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgzNjUyNA==", "url": "https://github.com/SonarSource/sonar-java/pull/3173#discussion_r487836524", "bodyText": "This case is not covered in tests because as I found there is only one method starting with \"time\", which is time itself and it is true for name.equals(\"time\") if I remove this line, could hit performance a little(very little), I wanted to remove startsWith(..) but maybe I am missing something", "author": "margarita-nedzelska-sonarsource", "createdAt": "2020-09-14T11:20:00Z", "path": "java-checks/src/main/java/org/sonar/java/checks/helpers/UnitTestUtils.java", "diffHunk": "@@ -34,6 +36,38 @@\n \n public final class UnitTestUtils {\n \n+  public static final Pattern ASSERTION_METHODS_PATTERN = Pattern.compile(\"(assert|verify|fail|should|check|expect|validate).*\");\n+  public static final Pattern TEST_METHODS_PATTERN = Pattern.compile(\"test.*|.*Test\");\n+\n+  public static final MethodMatchers ASSERTION_INVOCATION_MATCHERS = MethodMatchers.or(\n+    // fest 1.x / 2.X\n+    MethodMatchers.create().ofSubTypes(\"org.fest.assertions.GenericAssert\", \"org.fest.assertions.api.AbstractAssert\").anyName().withAnyParameters().build(),\n+    // rest assured 2.0\n+    MethodMatchers.create().ofTypes(\"io.restassured.response.ValidatableResponseOptions\")\n+      .name(name -> name.equals(\"body\") ||\n+        name.equals(\"time\") ||\n+        name.startsWith(\"time\") ||", "originalCommit": "0241a1d1b57d75af1b02ef55cd9ec65a3f69557c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQxNzQzMw==", "url": "https://github.com/SonarSource/sonar-java/pull/3173#discussion_r488417433", "bodyText": "It might be related to old version of restassured API, and so it would make us support them all, to be confirmed. For me it's OK to let it like this.", "author": "m-g-sonar", "createdAt": "2020-09-15T06:29:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgzNjUyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQxOTY2MQ==", "url": "https://github.com/SonarSource/sonar-java/pull/3173#discussion_r488419661", "bodyText": "If the default 10 is too noisy, I would adjust it to a more appropriate number by default, to have a rule \"already configured for most cases\" when it is enabled. 50 looks like too far away from the default to me.\nCould you have a look at the distribution of values on our test projects? Then the boundary could be set to catch 5-10% of them.", "author": "m-g-sonar", "createdAt": "2020-09-15T06:35:28Z", "path": "java-checks/src/main/java/org/sonar/java/checks/tests/TooManyAssertionsCheck.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/*\n+ * SonarQube Java\n+ * Copyright (C) 2012-2020 SonarSource SA\n+ * mailto:info AT sonarsource DOT com\n+ *\n+ * This program is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation; either\n+ * version 3 of the License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public License\n+ * along with this program; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n+ */\n+package org.sonar.java.checks.tests;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.sonar.check.Rule;\n+import org.sonar.check.RuleProperty;\n+import org.sonar.java.model.ModifiersUtils;\n+import org.sonar.plugins.java.api.JavaFileScanner;\n+import org.sonar.plugins.java.api.JavaFileScannerContext;\n+import org.sonar.plugins.java.api.semantic.Symbol;\n+import org.sonar.plugins.java.api.tree.BaseTreeVisitor;\n+import org.sonar.plugins.java.api.tree.IdentifierTree;\n+import org.sonar.plugins.java.api.tree.MethodInvocationTree;\n+import org.sonar.plugins.java.api.tree.MethodReferenceTree;\n+import org.sonar.plugins.java.api.tree.MethodTree;\n+import org.sonar.plugins.java.api.tree.Modifier;\n+import org.sonar.plugins.java.api.tree.Tree;\n+\n+import static org.sonar.java.checks.helpers.UnitTestUtils.ASSERTION_INVOCATION_MATCHERS;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.ASSERTION_METHODS_PATTERN;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.REACTIVE_X_TEST_METHODS;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.TEST_METHODS_PATTERN;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.isUnitTest;\n+import static org.sonar.java.model.ExpressionUtils.methodName;\n+\n+@Rule(key = \"S5961\")\n+public class TooManyAssertionsCheck extends BaseTreeVisitor implements JavaFileScanner {\n+\n+  private static final int DEFAULT_MAX = 10;", "originalCommit": "0241a1d1b57d75af1b02ef55cd9ec65a3f69557c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODY0Mzg2NA==", "url": "https://github.com/SonarSource/sonar-java/pull/3173#discussion_r488643864", "bodyText": "Sounds like a good idea. I checked in sonarqube locally. So the majority of issues contain <20 assertions. If we want to be even less noisy I'll suggest to put 25.\nWdyt, 20 or 25?", "author": "margarita-nedzelska-sonarsource", "createdAt": "2020-09-15T12:56:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQxOTY2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQyMDc2NQ==", "url": "https://github.com/SonarSource/sonar-java/pull/3173#discussion_r488420765", "bodyText": "shouldn't you also remove the ASSERTION_INVOCATION_MATCHERS and REACTIVE_X_TEST_METHODS constants from this file, since you duplicated it in UnitTestUtils?", "author": "m-g-sonar", "createdAt": "2020-09-15T06:38:05Z", "path": "java-checks/src/main/java/org/sonar/java/checks/tests/AssertionsInTestsCheck.java", "diffHunk": "@@ -172,23 +173,6 @@ private static boolean expectAssertion(MethodTree methodTree) {\n     return false;\n   }\n \n-  private static boolean isUnitTest(MethodTree methodTree) {", "originalCommit": "0241a1d1b57d75af1b02ef55cd9ec65a3f69557c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQyMjQ3MA==", "url": "https://github.com/SonarSource/sonar-java/pull/3173#discussion_r488422470", "bodyText": "you already have the declaration in the visitMethod() method (L70), why not directly use it instead of the symbol?\nSo you would not have to jump into the declaration. You can these the symbol inside this method the.", "author": "m-g-sonar", "createdAt": "2020-09-15T06:41:52Z", "path": "java-checks/src/main/java/org/sonar/java/checks/tests/TooManyAssertionsCheck.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/*\n+ * SonarQube Java\n+ * Copyright (C) 2012-2020 SonarSource SA\n+ * mailto:info AT sonarsource DOT com\n+ *\n+ * This program is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation; either\n+ * version 3 of the License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public License\n+ * along with this program; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n+ */\n+package org.sonar.java.checks.tests;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.sonar.check.Rule;\n+import org.sonar.check.RuleProperty;\n+import org.sonar.java.model.ModifiersUtils;\n+import org.sonar.plugins.java.api.JavaFileScanner;\n+import org.sonar.plugins.java.api.JavaFileScannerContext;\n+import org.sonar.plugins.java.api.semantic.Symbol;\n+import org.sonar.plugins.java.api.tree.BaseTreeVisitor;\n+import org.sonar.plugins.java.api.tree.IdentifierTree;\n+import org.sonar.plugins.java.api.tree.MethodInvocationTree;\n+import org.sonar.plugins.java.api.tree.MethodReferenceTree;\n+import org.sonar.plugins.java.api.tree.MethodTree;\n+import org.sonar.plugins.java.api.tree.Modifier;\n+import org.sonar.plugins.java.api.tree.Tree;\n+\n+import static org.sonar.java.checks.helpers.UnitTestUtils.ASSERTION_INVOCATION_MATCHERS;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.ASSERTION_METHODS_PATTERN;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.REACTIVE_X_TEST_METHODS;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.TEST_METHODS_PATTERN;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.isUnitTest;\n+import static org.sonar.java.model.ExpressionUtils.methodName;\n+\n+@Rule(key = \"S5961\")\n+public class TooManyAssertionsCheck extends BaseTreeVisitor implements JavaFileScanner {\n+\n+  private static final int DEFAULT_MAX = 10;\n+\n+  @RuleProperty(key = \"MaximumAssertionNumber\", description = \"The maximum authorized number of assertions in a test method\", defaultValue = \"\" + DEFAULT_MAX)\n+  public int maximumAssertionNumber = DEFAULT_MAX;\n+\n+  private final Map<Symbol, Integer> assertionsInMethod = new HashMap<>();\n+  private JavaFileScannerContext context;\n+\n+  @Override\n+  public void scanFile(JavaFileScannerContext context) {\n+    this.context = context;\n+    assertionsInMethod.clear();\n+    scan(context.getTree());\n+    assertionsInMethod.clear();\n+  }\n+\n+  @Override\n+  public void visitMethod(MethodTree methodTree) {\n+    if (ModifiersUtils.hasModifier(methodTree.modifiers(), Modifier.ABSTRACT)) {\n+      return;\n+    }\n+\n+    if (isUnitTest(methodTree) && numberOfAssertions(methodTree.symbol()) > maximumAssertionNumber) {\n+      context.reportIssue(this, methodTree.simpleName(), String.format(\"Refactor this method in order to have less than %d assertions.\", maximumAssertionNumber));\n+    }\n+  }\n+\n+  private int numberOfAssertions(Symbol symbol) {\n+    if (!assertionsInMethod.containsKey(symbol)) {\n+      assertionsInMethod.put(symbol, 0);\n+      Tree declaration = symbol.declaration();", "originalCommit": "0241a1d1b57d75af1b02ef55cd9ec65a3f69557c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ3ODA4Ng==", "url": "https://github.com/SonarSource/sonar-java/pull/3173#discussion_r488478086", "bodyText": "I think we need declaration in case we want to detect a local method which contains assertions.\n  @Test\n  void test3() { // Noncompliant [[sc=8;ec=13]]{{Refactor this method in order to have less than 2 assertions.}}\n    assertEquals(2, f(2));\n    assertEquals(3, f(1));\n    customAssert();\n  }\n\n  void customAssert() {\n    assertEquals(2, f(2));\n    assertEquals(3, f(1));\n  }\n\nIn this case tree points to invocation of customAssert() while to understand whether this is an assert itself we need its declaration.", "author": "margarita-nedzelska-sonarsource", "createdAt": "2020-09-15T08:20:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQyMjQ3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQyMjkyMQ==", "url": "https://github.com/SonarSource/sonar-java/pull/3173#discussion_r488422921", "bodyText": "I don't see the interest of using a BaseTreeVisitor if you are only visiting methods. Use an IssuableSubscriptionVisitor, it will be simpler.", "author": "m-g-sonar", "createdAt": "2020-09-15T06:43:00Z", "path": "java-checks/src/main/java/org/sonar/java/checks/tests/TooManyAssertionsCheck.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/*\n+ * SonarQube Java\n+ * Copyright (C) 2012-2020 SonarSource SA\n+ * mailto:info AT sonarsource DOT com\n+ *\n+ * This program is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation; either\n+ * version 3 of the License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public License\n+ * along with this program; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n+ */\n+package org.sonar.java.checks.tests;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.sonar.check.Rule;\n+import org.sonar.check.RuleProperty;\n+import org.sonar.java.model.ModifiersUtils;\n+import org.sonar.plugins.java.api.JavaFileScanner;\n+import org.sonar.plugins.java.api.JavaFileScannerContext;\n+import org.sonar.plugins.java.api.semantic.Symbol;\n+import org.sonar.plugins.java.api.tree.BaseTreeVisitor;\n+import org.sonar.plugins.java.api.tree.IdentifierTree;\n+import org.sonar.plugins.java.api.tree.MethodInvocationTree;\n+import org.sonar.plugins.java.api.tree.MethodReferenceTree;\n+import org.sonar.plugins.java.api.tree.MethodTree;\n+import org.sonar.plugins.java.api.tree.Modifier;\n+import org.sonar.plugins.java.api.tree.Tree;\n+\n+import static org.sonar.java.checks.helpers.UnitTestUtils.ASSERTION_INVOCATION_MATCHERS;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.ASSERTION_METHODS_PATTERN;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.REACTIVE_X_TEST_METHODS;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.TEST_METHODS_PATTERN;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.isUnitTest;\n+import static org.sonar.java.model.ExpressionUtils.methodName;\n+\n+@Rule(key = \"S5961\")\n+public class TooManyAssertionsCheck extends BaseTreeVisitor implements JavaFileScanner {", "originalCommit": "0241a1d1b57d75af1b02ef55cd9ec65a3f69557c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQyMzE2OQ==", "url": "https://github.com/SonarSource/sonar-java/pull/3173#discussion_r488423169", "bodyText": "2 comments:\n\n\nWith an IssuableSubscriptionVisitor, you could directly call reportIssue(methodTree.simpleName())\n\n\nI think it would be valuable to use secondaries on all the assertions, in order to proof our count.", "author": "m-g-sonar", "createdAt": "2020-09-15T06:43:37Z", "path": "java-checks/src/main/java/org/sonar/java/checks/tests/TooManyAssertionsCheck.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/*\n+ * SonarQube Java\n+ * Copyright (C) 2012-2020 SonarSource SA\n+ * mailto:info AT sonarsource DOT com\n+ *\n+ * This program is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation; either\n+ * version 3 of the License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public License\n+ * along with this program; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n+ */\n+package org.sonar.java.checks.tests;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.sonar.check.Rule;\n+import org.sonar.check.RuleProperty;\n+import org.sonar.java.model.ModifiersUtils;\n+import org.sonar.plugins.java.api.JavaFileScanner;\n+import org.sonar.plugins.java.api.JavaFileScannerContext;\n+import org.sonar.plugins.java.api.semantic.Symbol;\n+import org.sonar.plugins.java.api.tree.BaseTreeVisitor;\n+import org.sonar.plugins.java.api.tree.IdentifierTree;\n+import org.sonar.plugins.java.api.tree.MethodInvocationTree;\n+import org.sonar.plugins.java.api.tree.MethodReferenceTree;\n+import org.sonar.plugins.java.api.tree.MethodTree;\n+import org.sonar.plugins.java.api.tree.Modifier;\n+import org.sonar.plugins.java.api.tree.Tree;\n+\n+import static org.sonar.java.checks.helpers.UnitTestUtils.ASSERTION_INVOCATION_MATCHERS;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.ASSERTION_METHODS_PATTERN;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.REACTIVE_X_TEST_METHODS;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.TEST_METHODS_PATTERN;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.isUnitTest;\n+import static org.sonar.java.model.ExpressionUtils.methodName;\n+\n+@Rule(key = \"S5961\")\n+public class TooManyAssertionsCheck extends BaseTreeVisitor implements JavaFileScanner {\n+\n+  private static final int DEFAULT_MAX = 10;\n+\n+  @RuleProperty(key = \"MaximumAssertionNumber\", description = \"The maximum authorized number of assertions in a test method\", defaultValue = \"\" + DEFAULT_MAX)\n+  public int maximumAssertionNumber = DEFAULT_MAX;\n+\n+  private final Map<Symbol, Integer> assertionsInMethod = new HashMap<>();\n+  private JavaFileScannerContext context;\n+\n+  @Override\n+  public void scanFile(JavaFileScannerContext context) {\n+    this.context = context;\n+    assertionsInMethod.clear();\n+    scan(context.getTree());\n+    assertionsInMethod.clear();\n+  }\n+\n+  @Override\n+  public void visitMethod(MethodTree methodTree) {\n+    if (ModifiersUtils.hasModifier(methodTree.modifiers(), Modifier.ABSTRACT)) {\n+      return;\n+    }\n+\n+    if (isUnitTest(methodTree) && numberOfAssertions(methodTree.symbol()) > maximumAssertionNumber) {\n+      context.reportIssue(this, methodTree.simpleName(), String.format(\"Refactor this method in order to have less than %d assertions.\", maximumAssertionNumber));", "originalCommit": "0241a1d1b57d75af1b02ef55cd9ec65a3f69557c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQyNDU3OA==", "url": "https://github.com/SonarSource/sonar-java/pull/3173#discussion_r488424578", "bodyText": "the field name sounds complicated for a so simple purpose. Why not calling it maximum or threshold only?", "author": "m-g-sonar", "createdAt": "2020-09-15T06:46:37Z", "path": "java-checks/src/main/java/org/sonar/java/checks/tests/TooManyAssertionsCheck.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/*\n+ * SonarQube Java\n+ * Copyright (C) 2012-2020 SonarSource SA\n+ * mailto:info AT sonarsource DOT com\n+ *\n+ * This program is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation; either\n+ * version 3 of the License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public License\n+ * along with this program; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n+ */\n+package org.sonar.java.checks.tests;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.sonar.check.Rule;\n+import org.sonar.check.RuleProperty;\n+import org.sonar.java.model.ModifiersUtils;\n+import org.sonar.plugins.java.api.JavaFileScanner;\n+import org.sonar.plugins.java.api.JavaFileScannerContext;\n+import org.sonar.plugins.java.api.semantic.Symbol;\n+import org.sonar.plugins.java.api.tree.BaseTreeVisitor;\n+import org.sonar.plugins.java.api.tree.IdentifierTree;\n+import org.sonar.plugins.java.api.tree.MethodInvocationTree;\n+import org.sonar.plugins.java.api.tree.MethodReferenceTree;\n+import org.sonar.plugins.java.api.tree.MethodTree;\n+import org.sonar.plugins.java.api.tree.Modifier;\n+import org.sonar.plugins.java.api.tree.Tree;\n+\n+import static org.sonar.java.checks.helpers.UnitTestUtils.ASSERTION_INVOCATION_MATCHERS;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.ASSERTION_METHODS_PATTERN;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.REACTIVE_X_TEST_METHODS;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.TEST_METHODS_PATTERN;\n+import static org.sonar.java.checks.helpers.UnitTestUtils.isUnitTest;\n+import static org.sonar.java.model.ExpressionUtils.methodName;\n+\n+@Rule(key = \"S5961\")\n+public class TooManyAssertionsCheck extends BaseTreeVisitor implements JavaFileScanner {\n+\n+  private static final int DEFAULT_MAX = 10;\n+\n+  @RuleProperty(key = \"MaximumAssertionNumber\", description = \"The maximum authorized number of assertions in a test method\", defaultValue = \"\" + DEFAULT_MAX)\n+  public int maximumAssertionNumber = DEFAULT_MAX;", "originalCommit": "0241a1d1b57d75af1b02ef55cd9ec65a3f69557c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "eb139f08cd6a65f60b5bf0b31238ec82183673a6", "url": "https://github.com/SonarSource/sonar-java/commit/eb139f08cd6a65f60b5bf0b31238ec82183673a6", "message": "Change BaseTreeVisitor -> IssuableSuscriptionVisitor, add secondaries to reporting issuess & refactorig", "committedDate": "2020-09-15T13:53:11Z", "type": "forcePushed"}, {"oid": "429d4c972a600ce460d0de3fb88245534040bebb", "url": "https://github.com/SonarSource/sonar-java/commit/429d4c972a600ce460d0de3fb88245534040bebb", "message": "Change BaseTreeVisitor -> IssuableSuscriptionVisitor, add secondaries to reporting issuess & refactorig", "committedDate": "2020-09-15T14:05:03Z", "type": "forcePushed"}, {"oid": "42e05871e5e0f44472d07b306e9209f0d617b14e", "url": "https://github.com/SonarSource/sonar-java/commit/42e05871e5e0f44472d07b306e9209f0d617b14e", "message": "Change BaseTreeVisitor -> IssuableSuscriptionVisitor, add secondaries to reporting issuess & refactorig", "committedDate": "2020-09-15T14:07:32Z", "type": "forcePushed"}, {"oid": "eecef3ba1250d8c851436107f1d59c988c56ea15", "url": "https://github.com/SonarSource/sonar-java/commit/eecef3ba1250d8c851436107f1d59c988c56ea15", "message": "SONARJAVA-3511 Rule S5961: Test methods should not contain too many assertions", "committedDate": "2020-09-16T06:40:20Z", "type": "commit"}, {"oid": "9e29b97a4c043fb76fd240fd7038a28fda493b00", "url": "https://github.com/SonarSource/sonar-java/commit/9e29b97a4c043fb76fd240fd7038a28fda493b00", "message": "Change BaseTreeVisitor -> IssuableSuscriptionVisitor, add secondaries to reporting issuess & refactorig", "committedDate": "2020-09-16T06:40:23Z", "type": "commit"}, {"oid": "ab21297aef4c1952e5f48e9bbb8e88a6fba71c69", "url": "https://github.com/SonarSource/sonar-java/commit/ab21297aef4c1952e5f48e9bbb8e88a6fba71c69", "message": "Fix StackOverflow Error in case of recursive functions", "committedDate": "2020-09-16T06:40:23Z", "type": "commit"}, {"oid": "ab21297aef4c1952e5f48e9bbb8e88a6fba71c69", "url": "https://github.com/SonarSource/sonar-java/commit/ab21297aef4c1952e5f48e9bbb8e88a6fba71c69", "message": "Fix StackOverflow Error in case of recursive functions", "committedDate": "2020-09-16T06:40:23Z", "type": "forcePushed"}]}