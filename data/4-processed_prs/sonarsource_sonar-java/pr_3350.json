{"pr_number": 3350, "pr_title": "SONARJAVA-3620 FP in S2384 when unmodifiable collection is returned", "pr_createdAt": "2020-12-14T11:22:16Z", "pr_url": "https://github.com/SonarSource/sonar-java/pull/3350", "timeline": [{"oid": "9c50d9409b57ec4b8589ba7e3bb9e948d6e8a155", "url": "https://github.com/SonarSource/sonar-java/commit/9c50d9409b57ec4b8589ba7e3bb9e948d6e8a155", "message": "SONARJAVA-3620 FP in S2384 when unmodifiable collection is returned", "committedDate": "2020-12-14T11:20:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjMxMTY4MQ==", "url": "https://github.com/SonarSource/sonar-java/pull/3350#discussion_r542311681", "bodyText": "// symbol is private, so declaration can only be null if assignment is done in static block\n\nI did not manage to reproduce a case where the declaration is null, but I still added a null check because I was not convinced by this comment.\nI think it makes sense to keep it for defensive programming.", "author": "quentin-jaquier-sonarsource", "createdAt": "2020-12-14T11:26:53Z", "path": "java-checks/src/main/java/org/sonar/java/checks/MutableMembersUsageCheck.java", "diffHunk": "@@ -149,18 +149,21 @@ private static boolean isThis(ExpressionTree expression) {\n     return expression.is(Tree.Kind.IDENTIFIER) && ((IdentifierTree) expression).name().equals(\"this\");\n   }\n \n-  private static boolean isImmutableFinalVariable(Symbol.VariableSymbol symbol) {\n-    if (symbol.isFinal()) {\n-      VariableTree declaration = symbol.declaration();\n-      // symbol is private, so declaration can only be null if assignment is done in static block", "originalCommit": "9c50d9409b57ec4b8589ba7e3bb9e948d6e8a155", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI1MTk1NQ==", "url": "https://github.com/SonarSource/sonar-java/pull/3350#discussion_r543251955", "bodyText": "Maybe Objects.requireNonNull will be a better option here, cause I can't imagine a situation when declaration is null for private fields. But null check is also fine for me", "author": "margarita-nedzelska-sonarsource", "createdAt": "2020-12-15T11:08:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjMxMTY4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzMyMDExMQ==", "url": "https://github.com/SonarSource/sonar-java/pull/3350#discussion_r543320111", "bodyText": "Both alternatives sound good to me aswell. The behavior when the declaration is null (for whatever reason) is to proceed with the check of the usages as if it was not initialized, so it seems fine to me to keep it as it is.", "author": "quentin-jaquier-sonarsource", "createdAt": "2020-12-15T12:58:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjMxMTY4MQ=="}], "type": "inlineReview"}]}