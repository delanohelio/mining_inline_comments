{"pr_number": 26988, "pr_title": "Add 'dependency-graph.json' to Balo", "pr_createdAt": "2020-11-18T06:19:44Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/26988", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTg1MjI3MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26988#discussion_r525852271", "bodyText": "Here we are writing the list of dependencies.  I think the original requirement was to dump the dependency graph so that we can get it back when we read the Balo project?", "author": "sameerajayasoma", "createdAt": "2020-11-18T06:56:47Z", "path": "compiler/ballerina-lang/src/main/java/io/ballerina/projects/BaloWriter.java", "diffHunk": "@@ -244,6 +255,31 @@ private void addPackageSource(ZipOutputStream baloOutputStream, Package pkg) thr\n         }\n     }\n \n+    private void addDependenciesJson(ZipOutputStream baloOutputStream, Package pkg) {\n+        List<PackageId> sortedPackageIds = pkg.getCompilation().packageDependencyGraph().toTopologicallySortedList();\n+        ProjectEnvironment projectEnvironment = pkg.packageContext().project().projectEnvironmentContext();\n+        PackageResolver packageResolver = projectEnvironment.getService(PackageResolver.class);\n+        List<Dependency> dependencies = new ArrayList<>();\n+\n+        for (PackageId packageId : sortedPackageIds) {\n+            PackageContext packageContext = packageResolver.getPackage(packageId).packageContext();\n+            Dependency dependency = new Dependency(packageContext.packageOrg().toString(),\n+                    packageContext.packageName().toString(),\n+                    packageContext.packageVersion().toString());\n+            dependencies.add(dependency);\n+        }\n+\n+        DependenciesJson dependenciesJson = new DependenciesJson(dependencies);", "originalCommit": "6245d728933166b5c75ed60972bb7588a3470c0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA0NjA5Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26988#discussion_r527046093", "bodyText": "Added", "author": "pramodya1994", "createdAt": "2020-11-19T16:58:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTg1MjI3MQ=="}], "type": "inlineReview"}, {"oid": "ed21b7bb44e0520a349f98ca9a70a7c4ccbb48b7", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ed21b7bb44e0520a349f98ca9a70a7c4ccbb48b7", "message": "Add 'dependencies.json' to balo", "committedDate": "2020-11-18T11:43:37Z", "type": "commit"}, {"oid": "ed21b7bb44e0520a349f98ca9a70a7c4ccbb48b7", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ed21b7bb44e0520a349f98ca9a70a7c4ccbb48b7", "message": "Add 'dependencies.json' to balo", "committedDate": "2020-11-18T11:43:37Z", "type": "forcePushed"}, {"oid": "a58de042751597892a4be5beca8e6c14a1592003", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a58de042751597892a4be5beca8e6c14a1592003", "message": "Merge branch 'prj_api_module_refactor' of https://github.com/ballerina-platform/ballerina-lang into dependencies-json-prj_api", "committedDate": "2020-11-18T12:46:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIwODgzMQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26988#discussion_r526208831", "bodyText": "I have a concern about exposing the internal data structure of the dependency graph.\nWe can refactor this later.", "author": "sameerajayasoma", "createdAt": "2020-11-18T16:05:27Z", "path": "compiler/ballerina-lang/src/main/java/io/ballerina/projects/DependencyGraph.java", "diffHunk": "@@ -84,6 +84,10 @@ public void findCycles() {\n         return topologicallySortedNodes;\n     }\n \n+    Map<T, Set<T>> dependencies() {", "originalCommit": "a58de042751597892a4be5beca8e6c14a1592003", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b290863ff061f888f7e929a69f4961c361186076", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b290863ff061f888f7e929a69f4961c361186076", "message": "Merge branch 'prj_api_module_refactor' of https://github.com/ballerina-platform/ballerina-lang into dependencies-json-prj_api", "committedDate": "2020-11-19T04:01:31Z", "type": "commit"}, {"oid": "13aaa4f1267e5942076d7b0ee932e59600e131da", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/13aaa4f1267e5942076d7b0ee932e59600e131da", "message": "Merge branch 'prj_api_module_refactor' of https://github.com/ballerina-platform/ballerina-lang into dependencies-json-prj_api", "committedDate": "2020-11-19T11:38:35Z", "type": "commit"}, {"oid": "a728248417d0445aeb5725c1fb58f5e55ccf2acc", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a728248417d0445aeb5725c1fb58f5e55ccf2acc", "message": "Add 'dependency-graph.json' to balo & populate balo project", "committedDate": "2020-11-19T15:59:19Z", "type": "commit"}, {"oid": "9fb7f558dc64691d6f2eade873183f54c758abd9", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9fb7f558dc64691d6f2eade873183f54c758abd9", "message": "Fix checkstyles and test failures", "committedDate": "2020-11-19T16:55:27Z", "type": "commit"}, {"oid": "41f92ae8a287c4f299130ef6c16d7cf994eabab5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/41f92ae8a287c4f299130ef6c16d7cf994eabab5", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into dependencies-json-prj_api", "committedDate": "2020-11-19T18:37:34Z", "type": "forcePushed"}, {"oid": "6e3ff6323d7a1b6e11635ca91ef45666f9502956", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6e3ff6323d7a1b6e11635ca91ef45666f9502956", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into dependencies-json-prj_api", "committedDate": "2020-11-19T18:43:47Z", "type": "commit"}, {"oid": "6e3ff6323d7a1b6e11635ca91ef45666f9502956", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6e3ff6323d7a1b6e11635ca91ef45666f9502956", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into dependencies-json-prj_api", "committedDate": "2020-11-19T18:43:47Z", "type": "forcePushed"}]}