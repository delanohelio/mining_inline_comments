{"pr_number": 20949, "pr_title": "Fix cleaning of entire target directory during a single module build", "pr_createdAt": "2020-02-10T09:06:48Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/20949", "timeline": [{"oid": "f4199c52ed308eace5247fbbd62d02c727c894a0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f4199c52ed308eace5247fbbd62d02c727c894a0", "message": "Fix cleaning of entire target directory during a single module build", "committedDate": "2020-02-10T08:38:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5NjU5MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20949#discussion_r376996590", "bodyText": "Where we build the mytemplate module. Another test?", "author": "warunalakshitha", "createdAt": "2020-02-10T11:04:13Z", "path": "cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java", "diffHunk": "@@ -717,6 +717,24 @@ public void testTargetCacheDirectory() throws IOException {\n         // check if each module has a bit in cache directory\n     }\n \n+    @Test(description = \"Test the cleaning of target resources in the build command.\",\n+            dependsOnMethods = {\"testBuildCommand\"})\n+    public void testTargetClean() {\n+        // If a single module is built only the relevant module's resources should be cleaned,\n+        // else the entire target will be deleted.\n+        String[] compileArgs = {\"mymodule\", \"--skip-tests\"};\n+        Path target = this.testResources.resolve(\"valid-project\").resolve(ProjectDirConstants.TARGET_DIR_NAME);\n+\n+        BuildCommand buildCommand = new BuildCommand(this.testResources.resolve(\"valid-project\"),\n+                printStream, printStream, false, true);\n+        new CommandLine(buildCommand).parse(compileArgs);\n+        buildCommand.execute();\n+\n+        // Executable of a module that is not built.\n+        Path executablePath = target.resolve(ProjectDirConstants.BIN_DIR_NAME).resolve(\"mytemplate.jar\");", "originalCommit": "f4199c52ed308eace5247fbbd62d02c727c894a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5Nzg5OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20949#discussion_r376997899", "bodyText": "Also shall we check whether the target directory stuff cleaned ( ex. balo, jar etc)", "author": "warunalakshitha", "createdAt": "2020-02-10T11:07:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5NjU5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAwOTQ1MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20949#discussion_r377009450", "bodyText": "Yes, the mytemplate module is built in the dependent test testBuildCommand.\nThere isn't actually a way to check if the relevant target directory resources are cleaned in the test case since it is an intermediate step and the artifacts will get replaced. However, this was verified when debugging the code.", "author": "IrushiL", "createdAt": "2020-02-10T11:34:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5NjU5MA=="}], "type": "inlineReview"}]}