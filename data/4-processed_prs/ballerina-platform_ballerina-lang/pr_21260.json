{"pr_number": 21260, "pr_title": "Implement Function mocking", "pr_createdAt": "2020-02-26T07:50:26Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkxNzI1NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r384917255", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if ((bbTerminator.kind.equals(InstructionKind.CALL))) {\n          \n          \n            \n                            if (bbTerminator.kind.equals(InstructionKind.CALL)) {", "author": "suganyasuven", "createdAt": "2020-02-27T05:15:40Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/BIRGen.java", "diffHunk": "@@ -280,6 +286,39 @@ private void visitBuiltinFunctions(BLangPackage pkgNode, BLangFunction function)\n         }\n     }\n \n+    private void visitMockFunctions(BIRPackage birPkg, Map<String, String> mockFunctionMap) {\n+        for (BIRFunction function : birPkg.functions) {\n+            List<BIRBasicBlock> functionBasicBlocks = function.basicBlocks;\n+            for (BIRBasicBlock functionBasicBlock : functionBasicBlocks) {\n+                BIRTerminator bbTerminator = functionBasicBlock.terminator;\n+                if ((bbTerminator.kind.equals(InstructionKind.CALL))) {", "originalCommit": "f489c86b7f6a9b2968e42d8eb97e6e96dfc93b21", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjgyOTUwOQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r386829509", "bodyText": "Done", "author": "Ibaqu", "createdAt": "2020-03-03T07:00:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkxNzI1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkxNzgwNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r384917805", "bodyText": "Shall we remove this extra line?", "author": "suganyasuven", "createdAt": "2020-02-27T05:18:16Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/BIRGen.java", "diffHunk": "@@ -280,6 +286,39 @@ private void visitBuiltinFunctions(BLangPackage pkgNode, BLangFunction function)\n         }\n     }\n \n+    private void visitMockFunctions(BIRPackage birPkg, Map<String, String> mockFunctionMap) {\n+        for (BIRFunction function : birPkg.functions) {\n+            List<BIRBasicBlock> functionBasicBlocks = function.basicBlocks;\n+            for (BIRBasicBlock functionBasicBlock : functionBasicBlocks) {\n+                BIRTerminator bbTerminator = functionBasicBlock.terminator;\n+                if ((bbTerminator.kind.equals(InstructionKind.CALL))) {\n+                    mockFunctionMap.forEach((k, v) -> {\n+                        String[] mockInfo = k.split(MOCK_ANNOTATION_DELIMITER);\n+                        if (mockInfo.length != 2) {\n+                            return;\n+                        }\n+                        if (((BIRTerminator.Call) bbTerminator).name.getValue().equals(mockInfo[1])) {\n+                            ((BIRTerminator.Call) bbTerminator).name = getMockFunctionName(v, birPkg);\n+                            if (!mockInfo[0].equals(\".\")) {\n+                                ((BIRTerminator.Call) bbTerminator).calleePkg = function.pos.src.pkgID;\n+                            }\n+                        }\n+                    });\n+                }\n+            }\n+        }\n+    }\n+\n+    private Name getMockFunctionName(String name, BIRPackage birPkg) {\n+        for (BIRFunction function : birPkg.functions) {\n+            if (function.name.value.equals(name)) {\n+                return function.name;\n+            }\n+        }\n+        return null;\n+    }\n+\n+", "originalCommit": "f489c86b7f6a9b2968e42d8eb97e6e96dfc93b21", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjgyOTYxNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r386829617", "bodyText": "Removed extra line", "author": "Ibaqu", "createdAt": "2020-03-03T07:00:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkxNzgwNQ=="}], "type": "inlineReview"}, {"oid": "046497beee08298b32ede3cec621b8b47df6e202", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/046497beee08298b32ede3cec621b8b47df6e202", "message": "Add Parameter and Return type check for function mocking implementation", "committedDate": "2020-03-03T06:35:57Z", "type": "forcePushed"}, {"oid": "330c41b7a5d2e8c99825dbdaa321b298ea695e7e", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/330c41b7a5d2e8c99825dbdaa321b298ea695e7e", "message": "Add Parameter and Return type check for function mocking implementation", "committedDate": "2020-03-03T06:59:46Z", "type": "forcePushed"}, {"oid": "0c1c06468c3d3e12f93dc27fa29e9b393e3c6da6", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0c1c06468c3d3e12f93dc27fa29e9b393e3c6da6", "message": "Add Parameter and Return type check for function mocking implementation", "committedDate": "2020-03-03T08:31:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1NzY2OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r387557669", "bodyText": "Shall we use a better name for this, so that the functionality of this method is intuitive by the name?", "author": "SupunS", "createdAt": "2020-03-04T09:55:25Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/BIRGen.java", "diffHunk": "@@ -282,6 +288,38 @@ private void visitBuiltinFunctions(BLangPackage pkgNode, BLangFunction function)\n         }\n     }\n \n+    private void visitMockFunctions(BIRPackage birPkg, Map<String, String> mockFunctionMap) {", "originalCommit": "0c1c06468c3d3e12f93dc27fa29e9b393e3c6da6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI4MTczNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r390281737", "bodyText": "I have used this name since there was another function called visitBuiltInFunction() in the same class. Im currently not sure what to rename this function. Any suggestions?", "author": "Ibaqu", "createdAt": "2020-03-10T12:35:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1NzY2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc3MDg3Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r390770877", "bodyText": "Heres a tip for function naming/designing :)\nTry to explain the logic in the code using a short single sentence. e.g: \"This method adds wheels to a car.\"\nThen the method signature can be something like addWheels(Car c).\nNow, anyone who looks at the method-signature can get a high level idea of what it does, without looking at the code.", "author": "SupunS", "createdAt": "2020-03-11T06:42:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1NzY2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc3NDUxNA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r390774514", "bodyText": "Since we are replacing the call.Terminator's name and calleepkg details i decided on 'replaceMockFunctions()' as a name. Is this suitable?", "author": "Ibaqu", "createdAt": "2020-03-11T06:54:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1NzY2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc3NTkyMw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r390775923", "bodyText": "+1\nshould it be replaceMockedFunctions()?", "author": "SupunS", "createdAt": "2020-03-11T06:59:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1NzY2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc3Nzg2Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r390777867", "bodyText": "yes. Since we are replacing the functions to be mocked...\nChanged it to replaceMockedFunctions()", "author": "Ibaqu", "createdAt": "2020-03-11T07:06:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1NzY2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1ODIxOQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r387558219", "bodyText": "I think we can refactor this to reduce the runtime-cost. No need to iterate through the mockFunctionMap and do the splitting etc. for each and every CALL instruction. Those are redundant.  Prepare a separate map before coming here, so that you can lookup function name in the map using the key.\nThat will reduce the time complexity of L#297-L#307 from O(n) to k-constant time.", "author": "SupunS", "createdAt": "2020-03-04T09:56:22Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/BIRGen.java", "diffHunk": "@@ -282,6 +288,38 @@ private void visitBuiltinFunctions(BLangPackage pkgNode, BLangFunction function)\n         }\n     }\n \n+    private void visitMockFunctions(BIRPackage birPkg, Map<String, String> mockFunctionMap) {\n+        for (BIRFunction function : birPkg.functions) {\n+            List<BIRBasicBlock> functionBasicBlocks = function.basicBlocks;\n+            for (BIRBasicBlock functionBasicBlock : functionBasicBlocks) {\n+                BIRTerminator bbTerminator = functionBasicBlock.terminator;\n+                if (bbTerminator.kind.equals(InstructionKind.CALL)) {\n+                    mockFunctionMap.forEach((k, v) -> {", "originalCommit": "0c1c06468c3d3e12f93dc27fa29e9b393e3c6da6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg2MjgwMg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r388862802", "bodyText": "I have refactored this and removed the need to split the mockFunctionMap.\n@pubudu91 I have implemented a reverse check as discussed.", "author": "Ibaqu", "createdAt": "2020-03-06T11:55:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1ODIxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2NzEwMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r387567100", "bodyText": "Since your are doing the same casting operation ((BIRTerminator.Call) bbTerminator) multiple times,  better to do it once and keep it in a local variable.", "author": "SupunS", "createdAt": "2020-03-04T10:12:02Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/BIRGen.java", "diffHunk": "@@ -282,6 +288,38 @@ private void visitBuiltinFunctions(BLangPackage pkgNode, BLangFunction function)\n         }\n     }\n \n+    private void visitMockFunctions(BIRPackage birPkg, Map<String, String> mockFunctionMap) {\n+        for (BIRFunction function : birPkg.functions) {\n+            List<BIRBasicBlock> functionBasicBlocks = function.basicBlocks;\n+            for (BIRBasicBlock functionBasicBlock : functionBasicBlocks) {\n+                BIRTerminator bbTerminator = functionBasicBlock.terminator;\n+                if (bbTerminator.kind.equals(InstructionKind.CALL)) {\n+                    mockFunctionMap.forEach((k, v) -> {\n+                        String[] mockInfo = k.split(MOCK_ANNOTATION_DELIMITER);\n+                        if (mockInfo.length != 2) {\n+                            return;\n+                        }\n+                        if (((BIRTerminator.Call) bbTerminator).name.getValue().equals(mockInfo[1])) {\n+                            ((BIRTerminator.Call) bbTerminator).name = getMockFunctionName(v, birPkg);\n+                            if (!mockInfo[0].equals(\".\")) {\n+                                ((BIRTerminator.Call) bbTerminator).calleePkg = function.pos.src.pkgID;", "originalCommit": "0c1c06468c3d3e12f93dc27fa29e9b393e3c6da6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcxMTE4Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r388711183", "bodyText": "Implemented a local variable for this. Will continue to refactor this nested loop case.", "author": "Ibaqu", "createdAt": "2020-03-06T04:46:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2NzEwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU3MTgyNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r387571827", "bodyText": "Looks like there are 4-nested loops here. Please try to reduce.", "author": "SupunS", "createdAt": "2020-03-04T10:20:32Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/BIRGen.java", "diffHunk": "@@ -282,6 +288,38 @@ private void visitBuiltinFunctions(BLangPackage pkgNode, BLangFunction function)\n         }\n     }\n \n+    private void visitMockFunctions(BIRPackage birPkg, Map<String, String> mockFunctionMap) {\n+        for (BIRFunction function : birPkg.functions) {\n+            List<BIRBasicBlock> functionBasicBlocks = function.basicBlocks;\n+            for (BIRBasicBlock functionBasicBlock : functionBasicBlocks) {\n+                BIRTerminator bbTerminator = functionBasicBlock.terminator;\n+                if (bbTerminator.kind.equals(InstructionKind.CALL)) {\n+                    mockFunctionMap.forEach((k, v) -> {\n+                        String[] mockInfo = k.split(MOCK_ANNOTATION_DELIMITER);\n+                        if (mockInfo.length != 2) {\n+                            return;\n+                        }\n+                        if (((BIRTerminator.Call) bbTerminator).name.getValue().equals(mockInfo[1])) {\n+                            ((BIRTerminator.Call) bbTerminator).name = getMockFunctionName(v, birPkg);", "originalCommit": "0c1c06468c3d3e12f93dc27fa29e9b393e3c6da6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg2MzI3MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r388863270", "bodyText": "I have reduced the complexity in this case by removing the need to go thru the mockFunctionMap. There are only 2 loops now", "author": "Ibaqu", "createdAt": "2020-03-06T11:56:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU3MTgyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYxNTMyMw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r387615323", "bodyText": "Instead of trying to extract the module using the annotation, check and see if you can get it when initializing the annotation processor.", "author": "pubudu91", "createdAt": "2020-03-04T11:46:54Z", "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "diffHunk": "@@ -137,7 +173,45 @@ public void process(FunctionNode functionNode, List<AnnotationAttachmentNode> an\n                             vals[1] = value;\n                         }\n                     });\n-                    suite.addMockFunction(vals[0] + MOCK_ANNOTATION_DELIMITER + vals[1], functionName);\n+\n+                    if (bLangPackage == null) {\n+                        setBlangPackage(attachmentNode);", "originalCommit": "0c1c06468c3d3e12f93dc27fa29e9b393e3c6da6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc4NTAyMw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r388785023", "bodyText": "I removed setting the bLangPackage entirely since there is already an instance of the BlangPackage that is initialized in the process() function.\nI am simply using this instance throughout the code.", "author": "Ibaqu", "createdAt": "2020-03-06T09:05:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYxNTMyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYxNTcyMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r387615720", "bodyText": "For compile errors the standard we follow is to use lower case letters at the start of an error message.", "author": "pubudu91", "createdAt": "2020-03-04T11:47:54Z", "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "diffHunk": "@@ -137,7 +173,45 @@ public void process(FunctionNode functionNode, List<AnnotationAttachmentNode> an\n                             vals[1] = value;\n                         }\n                     });\n-                    suite.addMockFunction(vals[0] + MOCK_ANNOTATION_DELIMITER + vals[1], functionName);\n+\n+                    if (bLangPackage == null) {\n+                        setBlangPackage(attachmentNode);\n+                    }\n+\n+                    if (vals[0].isEmpty()) {\n+                        diagnosticLog.logDiagnostic(Diagnostic.Kind.ERROR, ((BLangFunction) functionNode).pos,\n+                                \"Module name cannot be empty\");", "originalCommit": "0c1c06468c3d3e12f93dc27fa29e9b393e3c6da6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYxNjI0MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r387616240", "bodyText": "Also, this error will be given to the beginning of the function. Check and see if you can give the error to the correct position of the relevant field in the annotation.", "author": "pubudu91", "createdAt": "2020-03-04T11:49:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYxNTcyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI5MzAxNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r390293015", "bodyText": "I have changed this so that it highlights the error in the annotation", "author": "Ibaqu", "createdAt": "2020-03-10T12:57:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYxNTcyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYxNjc1NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r387616754", "bodyText": "You don't need to do this each time the process() method gets invoked right? I think this can just be done in the init.", "author": "pubudu91", "createdAt": "2020-03-04T11:50:06Z", "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "diffHunk": "@@ -137,7 +173,45 @@ public void process(FunctionNode functionNode, List<AnnotationAttachmentNode> an\n                             vals[1] = value;\n                         }\n                     });\n-                    suite.addMockFunction(vals[0] + MOCK_ANNOTATION_DELIMITER + vals[1], functionName);\n+\n+                    if (bLangPackage == null) {\n+                        setBlangPackage(attachmentNode);\n+                    }\n+\n+                    if (vals[0].isEmpty()) {\n+                        diagnosticLog.logDiagnostic(Diagnostic.Kind.ERROR, ((BLangFunction) functionNode).pos,\n+                                \"Module name cannot be empty\");\n+                    }\n+\n+                    if (vals[1].isEmpty()) {\n+                        diagnosticLog.logDiagnostic(Diagnostic.Kind.ERROR, ((BLangFunction) functionNode).pos,\n+                                \"Function name cannot be empty\");\n+                    }\n+\n+                    SymbolTable symbolTable = SymbolTable.getInstance(compilerContext);\n+                    Map<BPackageSymbol, SymbolEnv> packageEnvironmentMap = symbolTable.pkgEnvMap;", "originalCommit": "0c1c06468c3d3e12f93dc27fa29e9b393e3c6da6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcxMTI5Ng==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r388711296", "bodyText": "Moved to the init function", "author": "Ibaqu", "createdAt": "2020-03-06T04:46:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYxNjc1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYxNzY1Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r387617652", "bodyText": "This typecheck will be checking the entire signature, not just the param types. So it's not exactly right to complain about parameter mismatches. You can try using the standard incompatible types error message we have in the compiler for this.", "author": "pubudu91", "createdAt": "2020-03-04T11:52:01Z", "path": "misc/testerina/modules/testerina-core/src/main/java/org/ballerinalang/testerina/core/TestAnnotationProcessor.java", "diffHunk": "@@ -137,7 +173,45 @@ public void process(FunctionNode functionNode, List<AnnotationAttachmentNode> an\n                             vals[1] = value;\n                         }\n                     });\n-                    suite.addMockFunction(vals[0] + MOCK_ANNOTATION_DELIMITER + vals[1], functionName);\n+\n+                    if (bLangPackage == null) {\n+                        setBlangPackage(attachmentNode);\n+                    }\n+\n+                    if (vals[0].isEmpty()) {\n+                        diagnosticLog.logDiagnostic(Diagnostic.Kind.ERROR, ((BLangFunction) functionNode).pos,\n+                                \"Module name cannot be empty\");\n+                    }\n+\n+                    if (vals[1].isEmpty()) {\n+                        diagnosticLog.logDiagnostic(Diagnostic.Kind.ERROR, ((BLangFunction) functionNode).pos,\n+                                \"Function name cannot be empty\");\n+                    }\n+\n+                    SymbolTable symbolTable = SymbolTable.getInstance(compilerContext);\n+                    Map<BPackageSymbol, SymbolEnv> packageEnvironmentMap = symbolTable.pkgEnvMap;\n+                    PackageID functionToMockID = getPackageID(vals[0], packageEnvironmentMap);\n+\n+                    BType functionToMockType = getFunctionType(packageEnvironmentMap, functionToMockID, vals[1]);\n+                    BType mockFunctionType = getFunctionType(packageEnvironmentMap, bLangPackage.packageID,\n+                            ((BLangFunction) functionNode).name.toString());\n+\n+                    if (functionToMockType != null && mockFunctionType != null) {\n+                        if (!typeChecker.isAssignable(mockFunctionType, functionToMockType)) {\n+                            diagnosticLog.logDiagnostic(Diagnostic.Kind.ERROR, ((BLangFunction) functionNode).pos,", "originalCommit": "0c1c06468c3d3e12f93dc27fa29e9b393e3c6da6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYxNzk1Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r387617952", "bodyText": "It's in the form: incompatible types: expected 'T' but found 'T2'`", "author": "pubudu91", "createdAt": "2020-03-04T11:52:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYxNzY1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIzNDM2Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21260#discussion_r390234362", "bodyText": "Changed to standard error", "author": "Ibaqu", "createdAt": "2020-03-10T10:55:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYxNzY1Mg=="}], "type": "inlineReview"}, {"oid": "10975d85e57528d80638e7ad6cd2cfb597cd3d75", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/10975d85e57528d80638e7ad6cd2cfb597cd3d75", "message": "Refactor Function mocking implementation", "committedDate": "2020-03-06T04:44:19Z", "type": "forcePushed"}, {"oid": "4b79906b27be1657824913b0184ab83fda45324f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4b79906b27be1657824913b0184ab83fda45324f", "message": "Refactor Function mocking implementation", "committedDate": "2020-03-06T09:02:59Z", "type": "forcePushed"}, {"oid": "1df141839dd3b0e96ad95fd0c8843acc252a410b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1df141839dd3b0e96ad95fd0c8843acc252a410b", "message": "Refactor Function mocking implementation", "committedDate": "2020-03-06T11:50:10Z", "type": "forcePushed"}, {"oid": "f31d00f8836673807d6b41867680914d43732c5a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f31d00f8836673807d6b41867680914d43732c5a", "message": "Add MockFunctionNamesMap to BLangTestablePackage", "committedDate": "2020-03-10T10:44:44Z", "type": "commit"}, {"oid": "d795131598da270732bb14f487ec0dd244e06f54", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d795131598da270732bb14f487ec0dd244e06f54", "message": "Implement function mocking in BIRGen", "committedDate": "2020-03-10T10:48:47Z", "type": "commit"}, {"oid": "b562c733a33bc993fe8d2a469f21b0f5df87ba58", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b562c733a33bc993fe8d2a469f21b0f5df87ba58", "message": "Add Parameter and Return type check for function mocking implementation", "committedDate": "2020-03-10T10:48:47Z", "type": "commit"}, {"oid": "f7fd816db2b3236eefe0df265c8420a38c467780", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f7fd816db2b3236eefe0df265c8420a38c467780", "message": "Refactor Function mocking implementation", "committedDate": "2020-03-10T10:54:27Z", "type": "commit"}, {"oid": "f7fd816db2b3236eefe0df265c8420a38c467780", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f7fd816db2b3236eefe0df265c8420a38c467780", "message": "Refactor Function mocking implementation", "committedDate": "2020-03-10T10:54:27Z", "type": "forcePushed"}, {"oid": "b8da7fbfbb99ffc5449cfde72383e05d963cedac", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b8da7fbfbb99ffc5449cfde72383e05d963cedac", "message": "Add test cases for function mocking implementation", "committedDate": "2020-03-10T12:36:44Z", "type": "forcePushed"}, {"oid": "a80ded5efe4ec339b76bde99d9151b68ec8710b7", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a80ded5efe4ec339b76bde99d9151b68ec8710b7", "message": "Add test cases for function mocking implementation", "committedDate": "2020-03-10T12:56:35Z", "type": "forcePushed"}, {"oid": "edbd66283eb866dae03c068fdd8bcf150893acd2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/edbd66283eb866dae03c068fdd8bcf150893acd2", "message": "Add test cases for function mocking implementation", "committedDate": "2020-03-11T05:32:28Z", "type": "forcePushed"}, {"oid": "7890bb3959de5cca0b8df46f0cbf80571fbc467a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7890bb3959de5cca0b8df46f0cbf80571fbc467a", "message": "Add test cases for function mocking implementation", "committedDate": "2020-03-11T06:27:51Z", "type": "forcePushed"}, {"oid": "ae619cd1676a6d4c97f11ad92ef2c09b2e3f7123", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ae619cd1676a6d4c97f11ad92ef2c09b2e3f7123", "message": "Add test cases for function mocking implementation", "committedDate": "2020-03-11T06:53:13Z", "type": "forcePushed"}, {"oid": "ee2192fd26e17ab9b25596d01726f0cf30d378b8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ee2192fd26e17ab9b25596d01726f0cf30d378b8", "message": "Add test cases for function mocking implementation", "committedDate": "2020-03-11T07:05:24Z", "type": "commit"}, {"oid": "ee2192fd26e17ab9b25596d01726f0cf30d378b8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ee2192fd26e17ab9b25596d01726f0cf30d378b8", "message": "Add test cases for function mocking implementation", "committedDate": "2020-03-11T07:05:24Z", "type": "forcePushed"}]}