{"pr_number": 27382, "pr_title": "Fix syntax API for receive-action", "pr_createdAt": "2020-12-08T11:07:14Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/27382", "timeline": [{"oid": "709acf86568bef929c89b0cc12b77b9a988690a0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/709acf86568bef929c89b0cc12b77b9a988690a0", "message": "Fix receive-action syntax API", "committedDate": "2020-12-08T09:12:19Z", "type": "commit"}, {"oid": "709acf86568bef929c89b0cc12b77b9a988690a0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/709acf86568bef929c89b0cc12b77b9a988690a0", "message": "Fix receive-action syntax API", "committedDate": "2020-12-08T09:12:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzEwNTMyMg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27382#discussion_r547105322", "bodyText": "use createIdentifier(Location pos, Token token) method to give a name to the missing identifier. otherwise will cause a null pointer exception at the later process.", "author": "rdulmina", "createdAt": "2020-12-22T07:07:30Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -2203,7 +2203,18 @@ public BLangNode transform(TrapExpressionNode trapExpressionNode) {\n     @Override\n     public BLangNode transform(ReceiveActionNode receiveActionNode) {\n         BLangWorkerReceive workerReceiveExpr = (BLangWorkerReceive) TreeBuilder.createWorkerReceiveNode();\n-        workerReceiveExpr.setWorkerName(createIdentifier(receiveActionNode.receiveWorkers().name()));\n+        Node receiveWorkers = receiveActionNode.receiveWorkers();\n+        Token workerName;\n+        if (receiveWorkers.kind() == SyntaxKind.SIMPLE_NAME_REFERENCE) {\n+            workerName = ((SimpleNameReferenceNode) receiveWorkers).name();\n+        } else {\n+            // TODO: implement multiple-receive-action support\n+            Location receiveFieldsPos = getPosition(receiveWorkers);\n+            dlog.error(receiveFieldsPos, DiagnosticErrorCode.MULTIPLE_RECEIVE_ACTION_NOT_YET_SUPPORTED);\n+            workerName = NodeFactory.createMissingToken(SyntaxKind.IDENTIFIER_TOKEN,\n+                    NodeFactory.createEmptyMinutiaeList(), NodeFactory.createEmptyMinutiaeList());", "originalCommit": "709acf86568bef929c89b0cc12b77b9a988690a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzEyMzYzMg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27382#discussion_r547123632", "bodyText": "I see. Then we have to do the same here also?\n\n  \n    \n      ballerina-lang/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java\n    \n    \n        Lines 583 to 584\n      in\n      67c6af3\n    \n    \n    \n    \n\n        \n          \n           variableName = NodeFactory.createMissingToken(SyntaxKind.IDENTIFIER_TOKEN, \n        \n\n        \n          \n                   NodeFactory.createEmptyMinutiaeList(), NodeFactory.createEmptyMinutiaeList());", "author": "lochana-chathura", "createdAt": "2020-12-22T07:56:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzEwNTMyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzEyODg2Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27382#discussion_r547128867", "bodyText": "Ah you are calling createIdentifier(Token token) method at the end which will call createIdentifier(Location pos, Token token). So its fine no changes needed", "author": "rdulmina", "createdAt": "2020-12-22T08:09:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzEwNTMyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzEwNTkzMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27382#discussion_r547105930", "bodyText": "Can we add a jballerina-unit-test case to check this error", "author": "rdulmina", "createdAt": "2020-12-22T07:09:10Z", "path": "compiler/ballerina-lang/src/main/resources/compiler.properties", "diffHunk": "@@ -1610,3 +1610,5 @@ error.invalid.isolated.qualifier.on.module.no.init.var.decl=\\\n \n error.binding.pattern.not.yet.supported.in.module.var.decl=\\\n   ''{0}'' binding pattern not yet supported in module variable declaration\n+\n+error.multiple.receive.action.not.yet.supported=multiple receive action not yet supported", "originalCommit": "709acf86568bef929c89b0cc12b77b9a988690a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzEwNjQwNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27382#discussion_r547106406", "bodyText": "Don't we have parser test cases for multiple receive action?", "author": "rdulmina", "createdAt": "2020-12-22T07:10:37Z", "path": "compiler/ballerina-treegen/src/main/resources/syntax_tree_descriptor.json", "diffHunk": "@@ -3297,7 +3297,7 @@\n                 },\n                 {\n                     \"name\": \"receiveWorkers\",\n-                    \"type\": \"SimpleNameReferenceNode\"\n+                    \"type\": \"Node\"", "originalCommit": "709acf86568bef929c89b0cc12b77b9a988690a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzEyMzg5MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27382#discussion_r547123890", "bodyText": "We do have. https://github.com/ballerina-platform/ballerina-lang/blob/master/compiler/ballerina-parser/src/test/resources/actions/receive-action/receive_action_source_01.bal", "author": "lochana-chathura", "createdAt": "2020-12-22T07:57:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzEwNjQwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzEwNzQ0NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27382#discussion_r547107444", "bodyText": "Any issue to track this TODO?", "author": "rdulmina", "createdAt": "2020-12-22T07:13:50Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java", "diffHunk": "@@ -2203,7 +2203,18 @@ public BLangNode transform(TrapExpressionNode trapExpressionNode) {\n     @Override\n     public BLangNode transform(ReceiveActionNode receiveActionNode) {\n         BLangWorkerReceive workerReceiveExpr = (BLangWorkerReceive) TreeBuilder.createWorkerReceiveNode();\n-        workerReceiveExpr.setWorkerName(createIdentifier(receiveActionNode.receiveWorkers().name()));\n+        Node receiveWorkers = receiveActionNode.receiveWorkers();\n+        Token workerName;\n+        if (receiveWorkers.kind() == SyntaxKind.SIMPLE_NAME_REFERENCE) {\n+            workerName = ((SimpleNameReferenceNode) receiveWorkers).name();\n+        } else {\n+            // TODO: implement multiple-receive-action support", "originalCommit": "709acf86568bef929c89b0cc12b77b9a988690a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzEyNDA3Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27382#discussion_r547124073", "bodyText": "yes. #18163", "author": "lochana-chathura", "createdAt": "2020-12-22T07:57:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzEwNzQ0NA=="}], "type": "inlineReview"}, {"oid": "084efd935bfe9d7490e28d333ff86fa52ba04f06", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/084efd935bfe9d7490e28d333ff86fa52ba04f06", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into fixes-5\n\n\u0001 Conflicts:\n\u0001\tcompiler/ballerina-lang/src/main/java/org/ballerinalang/util/diagnostic/DiagnosticErrorCode.java", "committedDate": "2020-12-23T10:23:05Z", "type": "commit"}, {"oid": "49d17382d4e4597c5acdc8139136bbca608a3264", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/49d17382d4e4597c5acdc8139136bbca608a3264", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into fixes-5", "committedDate": "2021-01-04T06:32:43Z", "type": "commit"}, {"oid": "c06b959885c8a886b230b1a7f491af5822b60379", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c06b959885c8a886b230b1a7f491af5822b60379", "message": "Add unit test to check multiple receive action error", "committedDate": "2021-01-04T07:21:55Z", "type": "commit"}]}