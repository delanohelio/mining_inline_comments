{"pr_number": 20607, "pr_title": "Implement cache for OAuth2 inbound authentication - [1.1.x]", "pr_createdAt": "2020-01-14T10:03:18Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/20607", "timeline": [{"oid": "8e177481d98877873effb81da5f9ebf8a7c42c36", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8e177481d98877873effb81da5f9ebf8a7c42c36", "message": "Implement cache for oauth2 inbound auth", "committedDate": "2020-01-14T09:58:55Z", "type": "commit"}, {"oid": "9540c728d2c96a822a39bd35f6632f8d08975ee0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9540c728d2c96a822a39bd35f6632f8d08975ee0", "message": "Fix imports", "committedDate": "2020-01-14T10:04:07Z", "type": "commit"}, {"oid": "d3e4051e457667798a0fea5808d6138008184f85", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d3e4051e457667798a0fea5808d6138008184f85", "message": "Fix typo", "committedDate": "2020-01-14T10:06:45Z", "type": "commit"}, {"oid": "12c03189aaad86e30f227b2a85e2a443db44b0cd", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/12c03189aaad86e30f227b2a85e2a443db44b0cd", "message": "Fix few bugs", "committedDate": "2020-01-16T11:14:29Z", "type": "commit"}, {"oid": "12c03189aaad86e30f227b2a85e2a443db44b0cd", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/12c03189aaad86e30f227b2a85e2a443db44b0cd", "message": "Fix few bugs", "committedDate": "2020-01-16T11:14:29Z", "type": "forcePushed"}, {"oid": "d9a1f2aeabe7c44199122fa32b39749df0ed5ee4", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d9a1f2aeabe7c44199122fa32b39749df0ed5ee4", "message": "Add debug logs", "committedDate": "2020-01-21T05:16:28Z", "type": "commit"}, {"oid": "34c5c73434dd568edd94c96b8daa5a96e3fcfd6e", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/34c5c73434dd568edd94c96b8daa5a96e3fcfd6e", "message": "Replace custom cache config with ballerina cache", "committedDate": "2020-01-22T12:01:40Z", "type": "forcePushed"}, {"oid": "a88b83788b0bd06d42852f074ca5580643e6335c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a88b83788b0bd06d42852f074ca5580643e6335c", "message": "Replace custom cache config with ballerina cache", "committedDate": "2020-01-23T04:20:13Z", "type": "commit"}, {"oid": "a88b83788b0bd06d42852f074ca5580643e6335c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a88b83788b0bd06d42852f074ca5580643e6335c", "message": "Replace custom cache config with ballerina cache", "committedDate": "2020-01-23T04:20:13Z", "type": "forcePushed"}, {"oid": "ac2e33994b83d3fe692cde951572b14345838ea9", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ac2e33994b83d3fe692cde951572b14345838ea9", "message": "Fix checkstyle of line length", "committedDate": "2020-01-23T08:35:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk4NjEyOA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20607#discussion_r369986128", "bodyText": "Let's break this line to accommodate 120 line break.", "author": "wggihan", "createdAt": "2020-01-23T08:36:16Z", "path": "stdlib/oauth2/src/main/ballerina/src/oauth2/inbound_oauth2_provider.bal", "diffHunk": "@@ -43,9 +50,16 @@ public type InboundOAuth2Provider object {\n         if (credential == \"\") {\n             return false;\n         }\n-        boolean authenticated = false;\n-        string username = \"\";\n-        string scopes = \"\";\n+\n+        var oauth2Cache = self.oauth2Cache;\n+        if (oauth2Cache is cache:Cache && oauth2Cache.hasKey(credential)) {\n+            var oauth2CacheEntry = authenticateFromCache(oauth2Cache, credential);\n+            if (oauth2CacheEntry is InboundOAuth2CacheEntry) {\n+                auth:setAuthenticationContext(\"oauth2\", credential);\n+                auth:setPrincipal(oauth2CacheEntry.username, oauth2CacheEntry.username, getScopes(oauth2CacheEntry.scopes));", "originalCommit": "a88b83788b0bd06d42852f074ca5580643e6335c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAyMjE1Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20607#discussion_r370022157", "bodyText": "Fixed with ac2e339", "author": "ldclakmal", "createdAt": "2020-01-23T09:54:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk4NjEyOA=="}], "type": "inlineReview"}]}