{"pr_number": 26145, "pr_title": "Enable packerina tests", "pr_createdAt": "2020-09-28T14:32:40Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/26145", "timeline": [{"oid": "0fb29778967b7fb7396a5c8accfc362f27901f12", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0fb29778967b7fb7396a5c8accfc362f27901f12", "message": "Fix dependency scope test cases", "committedDate": "2020-09-24T05:44:22Z", "type": "commit"}, {"oid": "744af7648a6a0dc9948e1e7d694f747d5f20017b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/744af7648a6a0dc9948e1e7d694f747d5f20017b", "message": "Fix directory test case", "committedDate": "2020-09-24T06:00:07Z", "type": "commit"}, {"oid": "5bc251741934fd2ccaafa59e2ad636d1904996a4", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5bc251741934fd2ccaafa59e2ad636d1904996a4", "message": "Fix packaging test case", "committedDate": "2020-09-24T06:18:24Z", "type": "commit"}, {"oid": "4add5a9e1a9ec1cad4771678dc9420fef329fc92", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4add5a9e1a9ec1cad4771678dc9420fef329fc92", "message": "Fix maven test case", "committedDate": "2020-09-24T06:29:27Z", "type": "commit"}, {"oid": "793a3aa23cd4ab932a339c350b9a2928e54a48fe", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/793a3aa23cd4ab932a339c350b9a2928e54a48fe", "message": "Fix multiple versions module test case", "committedDate": "2020-09-24T06:48:55Z", "type": "commit"}, {"oid": "bd53528ee0dcbda340520df64d97510e608aead1", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bd53528ee0dcbda340520df64d97510e608aead1", "message": "Fix spi services test case", "committedDate": "2020-09-24T07:14:24Z", "type": "commit"}, {"oid": "659428566ef2d07dd76c30265e45a6966eca5002", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/659428566ef2d07dd76c30265e45a6966eca5002", "message": "Enable native packaging test case", "committedDate": "2020-09-25T05:38:32Z", "type": "commit"}, {"oid": "3198057d922138f850528cc8025526dcec2aeac6", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3198057d922138f850528cc8025526dcec2aeac6", "message": "Fix packaging negative test cases", "committedDate": "2020-09-25T06:59:36Z", "type": "commit"}, {"oid": "4d08291e1f0125a01973a771cc126ed251c1a253", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4d08291e1f0125a01973a771cc126ed251c1a253", "message": "Enable lock file test cases", "committedDate": "2020-09-25T16:14:28Z", "type": "commit"}, {"oid": "2f607c14fafdcbadd73ae2edd000502c470b80c0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2f607c14fafdcbadd73ae2edd000502c470b80c0", "message": "Enable path dependency test cases", "committedDate": "2020-09-26T17:01:12Z", "type": "commit"}, {"oid": "832bb64f25ea4ffa1495a106d65450935923945f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/832bb64f25ea4ffa1495a106d65450935923945f", "message": "Fix path dependency test cases", "committedDate": "2020-09-28T07:57:44Z", "type": "commit"}, {"oid": "4672ad79fa791f1cb4ce271343f9126fdf9c9ec0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4672ad79fa791f1cb4ce271343f9126fdf9c9ec0", "message": "Fix package import test case", "committedDate": "2020-09-28T08:10:56Z", "type": "commit"}, {"oid": "46a9b8a81e66010ac5f6c5f306631b4c4280ea54", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/46a9b8a81e66010ac5f6c5f306631b4c4280ea54", "message": "Enable single bal file test cases", "committedDate": "2020-09-28T14:27:59Z", "type": "commit"}, {"oid": "817efe66076412835c62a3853e31454f0ee9d738", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/817efe66076412835c62a3853e31454f0ee9d738", "message": "Fix checkstyle issues", "committedDate": "2020-09-28T15:06:49Z", "type": "commit"}, {"oid": "9a902e566db6dcbe1e2f3d9539a4690c1108e7d5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9a902e566db6dcbe1e2f3d9539a4690c1108e7d5", "message": "Fix failed tests", "committedDate": "2020-09-29T05:07:25Z", "type": "commit"}, {"oid": "85d6df2f29b810fe9406223d58b06217d8f567c2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/85d6df2f29b810fe9406223d58b06217d8f567c2", "message": "Enable validate balo dependency test", "committedDate": "2020-09-30T11:18:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIxODcwNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26145#discussion_r502218707", "bodyText": "We can get rid of asserting whether file exists because Files.isDirectory(modulePath) will fail anyway if the file doesn't exist. WDYT?\nLet's correct this in other similar places too.", "author": "Dilhasha", "createdAt": "2020-10-09T06:41:01Z", "path": "tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/packaging/ModulePushTestCase.java", "diffHunk": "@@ -70,13 +70,20 @@ public void testPush() throws Exception {\n     \n         Assert.assertTrue(Files.exists(projectPath));\n         Assert.assertTrue(Files.isDirectory(projectPath));\n+\n+        Path modulePath = projectPath.resolve(\"src\").resolve(moduleName);\n     \n         // Create module\n         balClient.runMain(\"add\", new String[]{moduleName}, envVariables, new String[]{}, new LogLeecher[]{},\n                 projectPath.toString());\n     \n-        Assert.assertTrue(Files.exists(projectPath.resolve(\"src\").resolve(moduleName)));\n-        Assert.assertTrue(Files.isDirectory(projectPath.resolve(\"src\").resolve(moduleName)));\n+        Assert.assertTrue(Files.exists(modulePath));", "originalCommit": "85d6df2f29b810fe9406223d58b06217d8f567c2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIyNTYyNA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26145#discussion_r502225624", "bodyText": "Shall we remove this new line and can you please check other place as well?", "author": "lnash94", "createdAt": "2020-10-09T06:58:29Z", "path": "tests/jballerina-integration-test/src/test/resources/packaging/balopath/case1/TestProject2/src/baz/tests/impl_test.bal", "diffHunk": "@@ -0,0 +1,9 @@\n+import ballerina/test;\n+\n+# Test function\n+", "originalCommit": "85d6df2f29b810fe9406223d58b06217d8f567c2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7a34a282ac9262e064c5b997e50d8d579642d113", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7a34a282ac9262e064c5b997e50d8d579642d113", "message": "Address review suggestions", "committedDate": "2020-10-09T07:23:31Z", "type": "commit"}, {"oid": "9929630bb7048e5557ac564ff34f35f3ebba1d81", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9929630bb7048e5557ac564ff34f35f3ebba1d81", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into packerina-tests-fix", "committedDate": "2020-10-09T08:06:45Z", "type": "commit"}, {"oid": "08d685f768daf39f34615aae684e8d683481e29c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/08d685f768daf39f34615aae684e8d683481e29c", "message": "Disable MavenTestCase", "committedDate": "2020-10-09T08:13:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEyNzU1MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26145#discussion_r503127551", "bodyText": "We can get rid of asserting whether file exists because Files.isDirectory(modulePath) will fail anyway if the file doesn't exist. WDYT?", "author": "Dilhasha", "createdAt": "2020-10-12T08:33:46Z", "path": "tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/packaging/PackagingTestCase.java", "diffHunk": "@@ -236,17 +238,31 @@ public void testPushAllPackages() throws Exception {\n         // Create first module\n         balClient.runMain(\"add\", new String[]{firstPackage}, envVariables, new String[]{}, new LogLeecher[]{},\n                 projectPath.toString());\n-    \n-        Assert.assertTrue(Files.exists(projectPath.resolve(\"src\").resolve(firstPackage)));\n-        Assert.assertTrue(Files.isDirectory(projectPath.resolve(\"src\").resolve(firstPackage)));\n+\n+        Path firstPackagePath = projectPath.resolve(\"src\").resolve(firstPackage);\n+\n+        Assert.assertTrue(Files.exists(firstPackagePath));\n+        Assert.assertTrue(Files.isDirectory(firstPackagePath));", "originalCommit": "08d685f768daf39f34615aae684e8d683481e29c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEyNzY5Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26145#discussion_r503127693", "bodyText": "We can get rid of asserting whether file exists because Files.isDirectory(modulePath) will fail anyway if the file doesn't exist. WDYT?", "author": "Dilhasha", "createdAt": "2020-10-12T08:33:58Z", "path": "tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/packaging/PackagingTestCase.java", "diffHunk": "@@ -236,17 +238,31 @@ public void testPushAllPackages() throws Exception {\n         // Create first module\n         balClient.runMain(\"add\", new String[]{firstPackage}, envVariables, new String[]{}, new LogLeecher[]{},\n                 projectPath.toString());\n-    \n-        Assert.assertTrue(Files.exists(projectPath.resolve(\"src\").resolve(firstPackage)));\n-        Assert.assertTrue(Files.isDirectory(projectPath.resolve(\"src\").resolve(firstPackage)));\n+\n+        Path firstPackagePath = projectPath.resolve(\"src\").resolve(firstPackage);\n+\n+        Assert.assertTrue(Files.exists(firstPackagePath));\n+        Assert.assertTrue(Files.isDirectory(firstPackagePath));\n+\n+        PackerinaTestUtils.copy(Paths.get(\"src\", \"test\", \"resources\", \"packaging\", \"pushingModule\", \"main.bal\"),\n+                firstPackagePath.resolve(\"main.bal\"));\n+        PackerinaTestUtils.copy(Paths.get(\"src\", \"test\", \"resources\", \"packaging\", \"pushingModule\", \"main_test.bal\"),\n+                firstPackagePath.resolve(\"tests\").resolve(\"main_test.bal\"));\n     \n         // Create second module\n         balClient.runMain(\"add\", new String[]{secondPackage}, envVariables, new String[]{}, new LogLeecher[]{},\n                 projectPath.toString());\n-    \n-        Assert.assertTrue(Files.exists(projectPath.resolve(\"src\").resolve(secondPackage)));\n-        Assert.assertTrue(Files.isDirectory(projectPath.resolve(\"src\").resolve(secondPackage)));\n-    \n+\n+        Path secondPackagePath = projectPath.resolve(\"src\").resolve(secondPackage);\n+\n+        Assert.assertTrue(Files.exists(secondPackagePath));\n+        Assert.assertTrue(Files.isDirectory(secondPackagePath));", "originalCommit": "08d685f768daf39f34615aae684e8d683481e29c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEyNzg3NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26145#discussion_r503127875", "bodyText": "We can get rid of asserting whether file exists because Files.isDirectory(modulePath) will fail anyway if the file doesn't exist. WDYT?", "author": "Dilhasha", "createdAt": "2020-10-12T08:34:09Z", "path": "tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/packaging/PackagingTestCase.java", "diffHunk": "@@ -286,39 +301,27 @@ public void testBuildAndRunModuleWithPeriod() throws BallerinaTestException {\n         balClient.runMain(\"add\", new String[] { moduleName }, envVariables, new String[] {}, new LogLeecher[] {},\n                 projectPath.toString());\n \n-        Assert.assertTrue(Files.exists(projectPath.resolve(\"src\").resolve(moduleName)));\n-        Assert.assertTrue(Files.isDirectory(projectPath.resolve(\"src\").resolve(moduleName)));\n+        Path modulePath = projectPath.resolve(\"src\").resolve(moduleName);\n+        Assert.assertTrue(Files.exists(modulePath));\n+        Assert.assertTrue(Files.isDirectory(modulePath));", "originalCommit": "08d685f768daf39f34615aae684e8d683481e29c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "487598c51edd3abeed58f868a0b4c1b57bf1bf72", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/487598c51edd3abeed58f868a0b4c1b57bf1bf72", "message": "Apply review suggestions", "committedDate": "2020-10-12T08:40:50Z", "type": "commit"}]}