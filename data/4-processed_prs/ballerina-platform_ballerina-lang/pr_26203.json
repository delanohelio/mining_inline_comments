{"pr_number": 26203, "pr_title": "Restrict zero match clauses in match statement", "pr_createdAt": "2020-10-05T07:48:48Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/26203", "timeline": [{"oid": "44017938c7c6453a1c1d0365e0c4b30807bedc2d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/44017938c7c6453a1c1d0365e0c4b30807bedc2d", "message": "Parser changes for validating empty match clauses.", "committedDate": "2020-10-02T11:00:57Z", "type": "commit"}, {"oid": "df6cbbc1047404f763a6cbc77f4a0c88499e7b36", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/df6cbbc1047404f763a6cbc77f4a0c88499e7b36", "message": "Test cases and recovery for zero match clause.", "committedDate": "2020-10-05T07:34:42Z", "type": "commit"}, {"oid": "e2e512836140ee6449ee1c5f106efc6e911ef5d2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e2e512836140ee6449ee1c5f106efc6e911ef5d2", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang", "committedDate": "2020-10-05T07:37:40Z", "type": "commit"}, {"oid": "8cb805acc4718f98bfc2b5318c84462d4e280a3d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8cb805acc4718f98bfc2b5318c84462d4e280a3d", "message": "Insert record to syntax_diagnostic_message.properties", "committedDate": "2020-10-05T07:45:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYxMTY1MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26203#discussion_r499611650", "bodyText": "Missing license header.", "author": "anupama-pathirage", "createdAt": "2020-10-05T13:47:57Z", "path": "compiler/ballerina-parser/src/test/resources/statements/match-stmt/match_stmt_source_16.bal", "diffHunk": "@@ -0,0 +1,4 @@\n+function func(any v){", "originalCommit": "8cb805acc4718f98bfc2b5318c84462d4e280a3d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk5NjY3NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26203#discussion_r499996675", "bodyText": "Added thanx.", "author": "rdulmina", "createdAt": "2020-10-06T04:17:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYxMTY1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAwMjg3MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26203#discussion_r500002870", "bodyText": "We haven't added licence headers to any of the parser-test bal-sources. The reason was, these parser tests operates at a very granular level, and tests a specific grammar rule in each test-case.\nHaving the license header means, parser has to parse additional grammar rules as well - then we no longer have that granularity in the test..\nCan we stick to the same?", "author": "SupunS", "createdAt": "2020-10-06T04:44:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYxMTY1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA3ODE4MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26203#discussion_r500078180", "bodyText": "reverted", "author": "rdulmina", "createdAt": "2020-10-06T07:58:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYxMTY1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4OTA4OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26203#discussion_r500089088", "bodyText": "+1. Thanks for the info @SupunS", "author": "anupama-pathirage", "createdAt": "2020-10-06T08:16:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYxMTY1MA=="}], "type": "inlineReview"}, {"oid": "8cb805acc4718f98bfc2b5318c84462d4e280a3d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8cb805acc4718f98bfc2b5318c84462d4e280a3d", "message": "Insert record to syntax_diagnostic_message.properties", "committedDate": "2020-10-05T07:45:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE2MDMxNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26203#discussion_r500160316", "bodyText": "shall we reword the error message?\n\"match statement should have one or more match clauses\"", "author": "SupunS", "createdAt": "2020-10-06T10:12:03Z", "path": "compiler/ballerina-parser/src/main/resources/syntax_diagnostic_message.properties", "diffHunk": "@@ -235,7 +235,8 @@ error.more.field.match.patterns.after.rest.field=more field match patterns after\n error.action.as.a.wait.expr=''wait'' cannot be used with actions\n error.invalid.usage.of.var='var' is not a valid type descriptor\n error.more.match.patterns.after.rest.match.pattern=more match patterns after rest match pattern\n-error-match-pattern-not-allowed=match pattern not allowed\n+error.match.pattern.not.allowed=match pattern not allowed\n+error.at.least.one.match.clause.required=error at least one match clause required", "originalCommit": "8cb805acc4718f98bfc2b5318c84462d4e280a3d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE2OTE3Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26203#discussion_r500169177", "bodyText": "updated", "author": "rdulmina", "createdAt": "2020-10-06T10:28:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE2MDMxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE2MTY0MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26203#discussion_r500161641", "bodyText": "shouldn't be returning here", "author": "SupunS", "createdAt": "2020-10-06T10:14:23Z", "path": "compiler/ballerina-parser/src/main/java/io/ballerina/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -11802,7 +11802,19 @@ private STNode parseMatchStatement() {\n         STNode actionOrExpr = parseActionOrExpression();\n         startContext(ParserRuleContext.MATCH_BODY);\n         STNode openBrace = parseOpenBrace();\n-        STNode matchClauses = parseMatchClauses();\n+        // Parse match clauses list\n+        List<STNode> matchClausesList = new ArrayList<>();\n+        while (!isEndOfMatchClauses(peek().kind)) {\n+            STNode clause = parseMatchClause();\n+            matchClausesList.add(clause);\n+        }\n+        STNode matchClauses =  STNodeFactory.createNodeList(matchClausesList);\n+        // At least one match clause required\n+        if (isNodeListEmpty(matchClauses)) {\n+            return SyntaxErrors.addDiagnostic(openBrace,", "originalCommit": "8cb805acc4718f98bfc2b5318c84462d4e280a3d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE2OTIzNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26203#discussion_r500169235", "bodyText": "updated thanx", "author": "rdulmina", "createdAt": "2020-10-06T10:28:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE2MTY0MQ=="}], "type": "inlineReview"}, {"oid": "fe98ce39b5a827326618e1a8c6dbde180ae0a0b5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fe98ce39b5a827326618e1a8c6dbde180ae0a0b5", "message": "Reword error msg\nReword error msg for zero match clause and remove incorrect return.", "committedDate": "2020-10-06T10:27:46Z", "type": "commit"}]}