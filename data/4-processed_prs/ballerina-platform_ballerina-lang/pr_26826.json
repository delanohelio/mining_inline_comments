{"pr_number": 26826, "pr_title": "Add support for configurable ", "pr_createdAt": "2020-11-09T12:44:25Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/26826", "timeline": [{"oid": "b8b85ad1f871dc45a44e3e957023547f955445b5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b8b85ad1f871dc45a44e3e957023547f955445b5", "message": "Merge branch 'fix-qualifiers' of https://github.com/lochana-chathura/ballerina-lang into configurable", "committedDate": "2020-10-27T04:18:05Z", "type": "commit"}, {"oid": "65a11377c2ffbfca623907c5239455cbdc0d5c6c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/65a11377c2ffbfca623907c5239455cbdc0d5c6c", "message": "Lexer changes for configurable keyword", "committedDate": "2020-10-27T04:33:29Z", "type": "commit"}, {"oid": "5b6dedb6931e0a2852725ed8f56bcc782abedd29", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5b6dedb6931e0a2852725ed8f56bcc782abedd29", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into configurable", "committedDate": "2020-10-27T04:33:44Z", "type": "commit"}, {"oid": "c8ab09d497eb6f6d687eb0709bd5caefe6e9d2ed", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c8ab09d497eb6f6d687eb0709bd5caefe6e9d2ed", "message": "Add configurable flag", "committedDate": "2020-10-27T07:27:48Z", "type": "commit"}, {"oid": "0105dfb6d35990edb89bd9edd888c19e791e33d7", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0105dfb6d35990edb89bd9edd888c19e791e33d7", "message": "Initial parser changes for configurable", "committedDate": "2020-10-27T08:40:11Z", "type": "commit"}, {"oid": "724f54694f394af23f1fb6b5c23394910406b984", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/724f54694f394af23f1fb6b5c23394910406b984", "message": "Initial desugar changes for configurable", "committedDate": "2020-10-29T10:48:52Z", "type": "commit"}, {"oid": "0120c78800f601f9a2545d6f98fc209d590c43e2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0120c78800f601f9a2545d6f98fc209d590c43e2", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into configurable", "committedDate": "2020-11-03T04:38:52Z", "type": "commit"}, {"oid": "fc5ae3c48489adca75c09f4e486ad541be158a76", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fc5ae3c48489adca75c09f4e486ad541be158a76", "message": "Add hasConfigurableValue and getConfigurableValue langlib methods", "committedDate": "2020-11-04T06:56:30Z", "type": "commit"}, {"oid": "599a102b13ea10a8c4baadf9467d2b0cc33ebc13", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/599a102b13ea10a8c4baadf9467d2b0cc33ebc13", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into configurable", "committedDate": "2020-11-04T06:58:04Z", "type": "commit"}, {"oid": "0d6d0e5b05871bbd575f7f4106327e216da0e819", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0d6d0e5b05871bbd575f7f4106327e216da0e819", "message": "Complete parser changes without required expression", "committedDate": "2020-11-04T16:56:48Z", "type": "commit"}, {"oid": "5347ffa95e8b562e8d7ed29a17333f06c93454a9", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5347ffa95e8b562e8d7ed29a17333f06c93454a9", "message": "Remove rewriteExpr from createTernaryExprFromConfigurable method", "committedDate": "2020-11-05T11:04:43Z", "type": "commit"}, {"oid": "c58731af722aa7ef81d6c84c14a2ee4c04a69780", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c58731af722aa7ef81d6c84c14a2ee4c04a69780", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into configurable", "committedDate": "2020-11-06T04:36:20Z", "type": "commit"}, {"oid": "508cac01faf12722a521d37333d4534ca2fe84d4", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/508cac01faf12722a521d37333d4534ca2fe84d4", "message": "Add RequiredExpressionNode", "committedDate": "2020-11-06T08:38:54Z", "type": "commit"}, {"oid": "17c33ff799d319ff2b7f21aee8f3be08b78dad8a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/17c33ff799d319ff2b7f21aee8f3be08b78dad8a", "message": "Complete configurable parsing with recovery", "committedDate": "2020-11-07T15:50:26Z", "type": "commit"}, {"oid": "5052a2efc8a6b379f8f52af5e509d68d82b05850", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5052a2efc8a6b379f8f52af5e509d68d82b05850", "message": "Parser test cases for configurable", "committedDate": "2020-11-07T15:51:40Z", "type": "commit"}, {"oid": "56e38635cca7c59cda8c658707314edb11213716", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/56e38635cca7c59cda8c658707314edb11213716", "message": "Complete basic configurable var support\ncomplete configurable var support without type check and required expression", "committedDate": "2020-11-09T12:17:43Z", "type": "commit"}, {"oid": "ee04342bfa31d61c3cdb32cae098242c77337f2f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ee04342bfa31d61c3cdb32cae098242c77337f2f", "message": "Comment configMap in Configurable.java", "committedDate": "2020-11-09T12:37:10Z", "type": "commit"}, {"oid": "dc188ec18f16e1e586166bb41a70ee92e23afac5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/dc188ec18f16e1e586166bb41a70ee92e23afac5", "message": "Fix checkstyle issue", "committedDate": "2020-11-09T12:59:00Z", "type": "commit"}, {"oid": "a0cccdcccb31f5d1a404afdcdb719f4fce81bce2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a0cccdcccb31f5d1a404afdcdb719f4fce81bce2", "message": "Skip invalid configurable parser test from formatter tests", "committedDate": "2020-11-10T04:17:16Z", "type": "commit"}, {"oid": "e25c6d7b3026b33742b7303324d959f96507b641", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e25c6d7b3026b33742b7303324d959f96507b641", "message": "Enable parser negetive test", "committedDate": "2020-11-10T05:20:32Z", "type": "commit"}, {"oid": "129b9186afcd4ca72059b0565f6f889a96946faf", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/129b9186afcd4ca72059b0565f6f889a96946faf", "message": "remove unused createTernaryExpr method from ASTBuilderUtil", "committedDate": "2020-11-10T11:16:40Z", "type": "commit"}, {"oid": "2a70cdaa3cdb6333b9d3e9f77ed8479c8960e990", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2a70cdaa3cdb6333b9d3e9f77ed8479c8960e990", "message": "Negetive jballerina unit tests for configurable var declaration", "committedDate": "2020-11-10T11:57:40Z", "type": "commit"}, {"oid": "6acff900ccdab6392721682ca3a544b0bb84cfc2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6acff900ccdab6392721682ca3a544b0bb84cfc2", "message": "Remove readonly flag from simple variable", "committedDate": "2020-11-11T07:10:48Z", "type": "commit"}, {"oid": "5511a5bca62607bcfcef1dbb34d534413e8530ad", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5511a5bca62607bcfcef1dbb34d534413e8530ad", "message": "Complete configurable var decl support\nAdd type check and required expression support to configurable var", "committedDate": "2020-11-11T09:37:48Z", "type": "commit"}, {"oid": "189f0c910a40131aebebcd747bdf3fe467ed6edb", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/189f0c910a40131aebebcd747bdf3fe467ed6edb", "message": "Complete negetive test cases for configurable", "committedDate": "2020-11-11T09:38:30Z", "type": "commit"}, {"oid": "26059843e651d04a6709917064a56b2bb6922f29", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/26059843e651d04a6709917064a56b2bb6922f29", "message": "Fix checkstyle", "committedDate": "2020-11-11T09:49:58Z", "type": "commit"}, {"oid": "055383267c0da3c46fb5263fed5afe402875f927", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/055383267c0da3c46fb5263fed5afe402875f927", "message": "Undo changes to TypeChecker", "committedDate": "2020-11-11T09:53:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjY2NzQwOQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26826#discussion_r522667409", "bodyText": "We shouldn't return here. Continue with the error. Otherwise, we will not type check RHS of the variable.", "author": "hasithaa", "createdAt": "2020-11-13T05:42:42Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SemanticAnalyzer.java", "diffHunk": "@@ -611,7 +611,14 @@ public void visit(BLangAnnotationAttachment annAttachmentNode) {\n \n     public void visit(BLangSimpleVariable varNode) {\n \n+        boolean configurable = isConfigurable(varNode);\n+\n         if (varNode.isDeclaredWithVar) {\n+            // Configurable variable cannot be declared with var\n+            if (configurable) {\n+                dlog.error(varNode.pos, DiagnosticCode.CONFIGURABLE_VARIABLE_CANNOT_BE_DECLARED_WITH_VAR);\n+                return;", "originalCommit": "055383267c0da3c46fb5263fed5afe402875f927", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjY2OTc0OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26826#discussion_r522669749", "bodyText": "thanx will change", "author": "rdulmina", "createdAt": "2020-11-13T05:52:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjY2NzQwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjY2NzU4NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26826#discussion_r522667584", "bodyText": "Same as the previous comment. Log the error and continue.", "author": "hasithaa", "createdAt": "2020-11-13T05:43:34Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SemanticAnalyzer.java", "diffHunk": "@@ -744,6 +759,12 @@ private void validateWorkerAnnAttachments(BLangExpression expr) {\n \n     public void visit(BLangRecordVariable varNode) {\n \n+        // Only simple variables are allowed to be configurable.\n+        if (isConfigurable(varNode)) {\n+            dlog.error(varNode.pos, DiagnosticCode.ONLY_SIMPLE_VARIABLES_ARE_ALLOWED_TO_BE_CONFIGURABLE);\n+            return;", "originalCommit": "055383267c0da3c46fb5263fed5afe402875f927", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjY2ODUzOQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26826#discussion_r522668539", "bodyText": "Handle this in other places as well.", "author": "hasithaa", "createdAt": "2020-11-13T05:47:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjY2NzU4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjY3MjI3Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26826#discussion_r522672277", "bodyText": "Done", "author": "rdulmina", "createdAt": "2020-11-13T06:03:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjY2NzU4NA=="}], "type": "inlineReview"}, {"oid": "84725a5aea5dfc81ed883813847951e13fa6dabb", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/84725a5aea5dfc81ed883813847951e13fa6dabb", "message": "Remove immediate returns after logging error", "committedDate": "2020-11-13T06:02:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg5MTcwNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26826#discussion_r523891707", "bodyText": "We need to remove this one as well. Otherwise init expr validation is not happening.", "author": "hasithaa", "createdAt": "2020-11-16T04:18:33Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SemanticAnalyzer.java", "diffHunk": "@@ -666,6 +672,14 @@ public void visit(BLangSimpleVariable varNode) {\n         BType lhsType = varNode.symbol.type;\n         varNode.type = lhsType;\n \n+        // Configurable variable type must be a subtype of anydata&readonly.\n+        if (configurable && varNode.typeNode != null) {\n+            if (!(types.isAssignable(lhsType, symTable.anydataType) &&\n+                    types.isAssignable(lhsType, symTable.readonlyType))) {\n+                dlog.error(varNode.typeNode.pos, DiagnosticCode.CONFIGURABLE_VARIABLE_MUST_BE_ANYDATA_AND_READONLY);\n+                return;", "originalCommit": "84725a5aea5dfc81ed883813847951e13fa6dabb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg5MjYwNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26826#discussion_r523892607", "bodyText": "Done thanx", "author": "rdulmina", "createdAt": "2020-11-16T04:23:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg5MTcwNw=="}], "type": "inlineReview"}, {"oid": "27c761c094db945d368dae30b22e580db99897af", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/27c761c094db945d368dae30b22e580db99897af", "message": "Remove a return statement", "committedDate": "2020-11-16T04:22:22Z", "type": "commit"}, {"oid": "adf712b2c7b392b6c281ef29aaa1b8829eab8e66", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/adf712b2c7b392b6c281ef29aaa1b8829eab8e66", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into configurable", "committedDate": "2020-11-16T04:45:19Z", "type": "commit"}, {"oid": "6cb799d95e38fdfe3289bc74d2c3cabdcfcf8f49", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6cb799d95e38fdfe3289bc74d2c3cabdcfcf8f49", "message": "Convert int vars to long", "committedDate": "2020-11-16T04:57:57Z", "type": "commit"}, {"oid": "e1ae52f18f7c4f5d4c52ad0938c971841dfa8fd8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e1ae52f18f7c4f5d4c52ad0938c971841dfa8fd8", "message": "Resolve conflicts", "committedDate": "2020-11-20T16:45:56Z", "type": "commit"}, {"oid": "62916fbc13b72b811b3e6078233388b71ebb8613", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/62916fbc13b72b811b3e6078233388b71ebb8613", "message": "Resolve conflicts", "committedDate": "2020-11-20T18:06:04Z", "type": "commit"}, {"oid": "c1e7322cdb9f003ab26ee85f8b421014a737ff11", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c1e7322cdb9f003ab26ee85f8b421014a737ff11", "message": "Fix checkstyle", "committedDate": "2020-11-20T18:09:20Z", "type": "commit"}, {"oid": "f3ca599a3409f517e2cc28e732591c6b67d16ebd", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f3ca599a3409f517e2cc28e732591c6b67d16ebd", "message": "Fix a parameter name change", "committedDate": "2020-11-20T18:21:13Z", "type": "commit"}, {"oid": "d3041af6ea606ef2ba02ce1af321bf15f8676a7a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d3041af6ea606ef2ba02ce1af321bf15f8676a7a", "message": "Update disabled test name in ParserTestFormatter", "committedDate": "2020-11-21T03:15:24Z", "type": "commit"}, {"oid": "209973d8d9bf33bd557865e7fe0a806f86aaa736", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/209973d8d9bf33bd557865e7fe0a806f86aaa736", "message": "Resolve conflicts", "committedDate": "2020-11-23T06:25:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODYxOTUxMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26826#discussion_r528619510", "bodyText": "Spec allows this, Can you create an issue to track this?", "author": "hasithaa", "createdAt": "2020-11-23T10:58:04Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SemanticAnalyzer.java", "diffHunk": "@@ -749,6 +763,11 @@ private void validateWorkerAnnAttachments(BLangExpression expr) {\n \n     public void visit(BLangRecordVariable varNode) {\n \n+        // Only simple variables are allowed to be configurable.\n+        if (isConfigurable(varNode)) {\n+            dlog.error(varNode.pos, DiagnosticErrorCode.ONLY_SIMPLE_VARIABLES_ARE_ALLOWED_TO_BE_CONFIGURABLE);", "originalCommit": "209973d8d9bf33bd557865e7fe0a806f86aaa736", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY4NjQyMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26826#discussion_r528686420", "bodyText": "Spec says binding-pattern must be just a variable-name so only simple variables are allowed right?", "author": "rdulmina", "createdAt": "2020-11-23T13:01:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODYxOTUxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcxMjk1NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26826#discussion_r528712955", "bodyText": "Yes, You are correct. I missed it.", "author": "hasithaa", "createdAt": "2020-11-23T13:45:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODYxOTUxMA=="}], "type": "inlineReview"}, {"oid": "8253fd1cfb8af59d39500cabdd768e99664783b2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8253fd1cfb8af59d39500cabdd768e99664783b2", "message": "Resolve conflicts", "committedDate": "2020-11-23T11:33:40Z", "type": "commit"}, {"oid": "23d3b5db5f69be1dce2dc9ca9ffe1f1b7972b67b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/23d3b5db5f69be1dce2dc9ca9ffe1f1b7972b67b", "message": "Temporary restrict configurable variables only to int, float, string, boolean", "committedDate": "2020-11-23T12:53:02Z", "type": "commit"}, {"oid": "afec687056da0c022d148d03f083d32216d56f5e", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/afec687056da0c022d148d03f083d32216d56f5e", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into configurable", "committedDate": "2020-11-23T13:29:24Z", "type": "commit"}, {"oid": "f30e42b716348178541cb2a008fea819a3a4a9f9", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f30e42b716348178541cb2a008fea819a3a4a9f9", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into configurable", "committedDate": "2020-11-23T14:50:54Z", "type": "commit"}]}