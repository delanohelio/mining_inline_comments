{"pr_number": 26902, "pr_title": "Add support to collect AST from single files for Observability", "pr_createdAt": "2020-11-13T04:43:35Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/26902", "timeline": [{"oid": "b60565dc9397dac0a2793f75101870299e520999", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b60565dc9397dac0a2793f75101870299e520999", "message": "Make the Observability instrumentation the first task in Compiler BE", "committedDate": "2020-11-13T05:02:35Z", "type": "forcePushed"}, {"oid": "66797631268c1c5d12a2953108d6fed4b8790411", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/66797631268c1c5d12a2953108d6fed4b8790411", "message": "Minor fix for handling single files in Observability\n\n# Single bal files are at the root of the Jar unlike modules which are within Java packages. This needs be properly handled when inferring the ballerina package from the Java Package", "committedDate": "2020-11-13T10:05:44Z", "type": "commit"}, {"oid": "3cf6042f06659da1bf190aae4ea2f7abb9ddf13d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3cf6042f06659da1bf190aae4ea2f7abb9ddf13d", "message": "Enable capturing AST for single files without modules", "committedDate": "2020-11-13T10:05:44Z", "type": "commit"}, {"oid": "5545bc3811bc9035ba2d7d5b89654a04c5503b95", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5545bc3811bc9035ba2d7d5b89654a04c5503b95", "message": "Minor bug fix to anonymous service names in Observability data\n\n# The name of the anonymous services in the captured AST and the Observability data seemed to have deviated due to a change in the ballerina core. This had to be fixed.", "committedDate": "2020-11-13T10:05:44Z", "type": "commit"}, {"oid": "2204ed96ea109a6cda56f9b0a5843754ea0ebd55", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2204ed96ea109a6cda56f9b0a5843754ea0ebd55", "message": "Add test case for programmatically start service Observability\n\n# This also tests anonymous services related observability as it is considered anonymous", "committedDate": "2020-11-13T10:05:45Z", "type": "commit"}, {"oid": "bd5f9b014b54552226507df0b550517999bf2376", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bd5f9b014b54552226507df0b550517999bf2376", "message": "Make the Observability instrumentation the first task in Compiler BE", "committedDate": "2020-11-13T10:24:23Z", "type": "commit"}, {"oid": "bd5f9b014b54552226507df0b550517999bf2376", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bd5f9b014b54552226507df0b550517999bf2376", "message": "Make the Observability instrumentation the first task in Compiler BE", "committedDate": "2020-11-13T10:24:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQxODg1Ng==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26902#discussion_r523418856", "bodyText": "is it possible to use ,  typeDef.getType().getPackage() it might be more accurate because names can be encoded.", "author": "manuranga", "createdAt": "2020-11-14T13:16:27Z", "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/observability/ObserveUtils.java", "diffHunk": "@@ -195,9 +195,14 @@ public static void startCallableObservation(Environment env, boolean isRemote, b\n         } else {\n             String className = typeDef.getClass().getCanonicalName();\n             String[] classNameSplit = className.split(\"\\\\.\");\n-            int lastIndexOfDollar = classNameSplit[3].lastIndexOf('$');\n-            newObContext.setObjectName(classNameSplit[0] + \"/\" + classNameSplit[1] + \"/\"\n-                    + classNameSplit[3].substring(lastIndexOfDollar + 1));\n+            if (classNameSplit.length == 4) {   // Object from a project module", "originalCommit": "bd5f9b014b54552226507df0b550517999bf2376", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzc0NDUyMw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26902#discussion_r523744523", "bodyText": "Yes typeDef.getType().getPackage() seems to be the better and more accurate approach.\nVerified and fixed with dcd9959", "author": "nadundesilva", "createdAt": "2020-11-15T11:18:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQxODg1Ng=="}], "type": "inlineReview"}, {"oid": "dcd995921055c7108137082ab30f492f64f93996", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/dcd995921055c7108137082ab30f492f64f93996", "message": "Update object type inferring to use BObject properties", "committedDate": "2020-11-15T08:19:54Z", "type": "commit"}]}