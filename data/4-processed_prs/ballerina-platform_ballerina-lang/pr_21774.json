{"pr_number": 21774, "pr_title": "Fix error logs of cache module", "pr_createdAt": "2020-03-16T03:29:20Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/21774", "timeline": [{"oid": "c7de44a55430de6aef90c85a8dfdf331af6bb1a6", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c7de44a55430de6aef90c85a8dfdf331af6bb1a6", "message": "Fix error logs of cache module", "committedDate": "2020-03-16T03:36:29Z", "type": "commit"}, {"oid": "c7de44a55430de6aef90c85a8dfdf331af6bb1a6", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c7de44a55430de6aef90c85a8dfdf331af6bb1a6", "message": "Fix error logs of cache module", "committedDate": "2020-03-16T03:36:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc2ODg4Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21774#discussion_r392768882", "bodyText": "Don't we need to check whether the debug has enabled or not?", "author": "chamil321", "createdAt": "2020-03-16T03:38:55Z", "path": "stdlib/cache/src/main/ballerina/src/cache/cache_errors.bal", "diffHunk": "@@ -47,3 +47,19 @@ function prepareError(string message, error? err = ()) returns Error {\n     }\n     return cacheError;\n }\n+\n+# Prepare the `error` as an `Error`.\n+#\n+# + message - Error message\n+# + err - `error` instance\n+# + return - Prepared `Error` instance\n+function prepareErrorWithDebugLog(string message, error? err = ()) returns Error {\n+    log:printDebug(message, err);", "originalCommit": "c7de44a55430de6aef90c85a8dfdf331af6bb1a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc3MDEzMw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21774#discussion_r392770133", "bodyText": "Fixed with d318ea7", "author": "ldclakmal", "createdAt": "2020-03-16T03:46:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc2ODg4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc2ODkyMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21774#discussion_r392768920", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            }\n          \n          \n            \n            }", "author": "chamil321", "createdAt": "2020-03-16T03:39:12Z", "path": "stdlib/cache/src/main/ballerina/src/cache/cache_errors.bal", "diffHunk": "@@ -47,3 +47,19 @@ function prepareError(string message, error? err = ()) returns Error {\n     }\n     return cacheError;\n }\n+\n+# Prepare the `error` as an `Error`.\n+#\n+# + message - Error message\n+# + err - `error` instance\n+# + return - Prepared `Error` instance\n+function prepareErrorWithDebugLog(string message, error? err = ()) returns Error {\n+    log:printDebug(message, err);\n+    Error cacheError;\n+    if (err is error) {\n+        cacheError = error(CACHE_ERROR, message = message, cause = err);\n+    } else {\n+        cacheError = error(CACHE_ERROR, message = message);\n+    }\n+    return cacheError;\n+}", "originalCommit": "c7de44a55430de6aef90c85a8dfdf331af6bb1a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc3MDE0Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21774#discussion_r392770142", "bodyText": "Fixed with d318ea7", "author": "ldclakmal", "createdAt": "2020-03-16T03:46:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc2ODkyMA=="}], "type": "inlineReview"}, {"oid": "d318ea7f0a283342354a9095c6d44c18fdbc1753", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d318ea7f0a283342354a9095c6d44c18fdbc1753", "message": "Fix review suggestions", "committedDate": "2020-03-16T03:45:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc3NzEzMQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21774#discussion_r392777131", "bodyText": "Do we need to make the log statement a part of this function? Doing so defeats the purpose of using the log function which takes a function pointer. The purpose of it is to delay the evaluation of any parameters passed to the log function. Using it like this doesn't achieve that objective. You might as well use the log function which takes a string param.", "author": "pubudu91", "createdAt": "2020-03-16T04:27:11Z", "path": "stdlib/cache/src/main/ballerina/src/cache/cache_errors.bal", "diffHunk": "@@ -47,3 +47,21 @@ function prepareError(string message, error? err = ()) returns Error {\n     }\n     return cacheError;\n }\n+\n+# Prepare the `error` as an `Error`.\n+#\n+# + message - Error message\n+# + err - `error` instance\n+# + return - Prepared `Error` instance\n+function prepareErrorWithDebugLog(string message, error? err = ()) returns Error {\n+    log:printDebug(function() returns string {\n+        return message;\n+    });", "originalCommit": "d318ea7f0a283342354a9095c6d44c18fdbc1753", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc4MDUyMg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21774#discussion_r392780522", "bodyText": "Added this function in order to separate out the logging and creating the particular error type of the module. That was the convention we followed most of the stdlib modules. Added the log statement as a part of this function, in order to remove code duplicates all over the places where we need to create an error.\nI just wanted to evaluate the debug function iff the debug log level is enabled. That's why I used the log function which takes a function pointer. Otherwise there is no any alternative as per the BBE [1]. Also, there is nothing to evaluate since the message parameter is already constructed, since I need to create the error message despite of the log level is enabled or not.\nPlease suggest the if there is any alternative or suggestion to change.\n[1] https://ballerina.io/v1-1/learn/by-example/log-api.html", "author": "ldclakmal", "createdAt": "2020-03-16T04:45:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc3NzEzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjgwOTU0NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21774#discussion_r392809545", "bodyText": "Then you can simply use the string param instead of the function pointer. You only need to use the function pointer if you want to avoid evaluating any expression you may want to pass as a param to the log function. The log level check is done irrespective of whether it is a function pointer param or a string param.", "author": "pubudu91", "createdAt": "2020-03-16T06:49:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc3NzEzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg0NzkyNA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21774#discussion_r392847924", "bodyText": "Got it. Then the @chamil321 's concern [1] become invalid. Actually, I also had the same concern. :) Thanks for the explanation.\n[1] #21774 (comment)", "author": "ldclakmal", "createdAt": "2020-03-16T08:21:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc3NzEzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg1ODkzNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21774#discussion_r392858935", "bodyText": "Fixed with 1a43013", "author": "ldclakmal", "createdAt": "2020-03-16T08:43:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc3NzEzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg2NjAyMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21774#discussion_r392866020", "bodyText": "My bad, I saw it as an expression inside the log function. \ud83e\udd26\u200d\u2642\ufe0f", "author": "chamil321", "createdAt": "2020-03-16T08:57:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc3NzEzMQ=="}], "type": "inlineReview"}, {"oid": "a674f02a08ee1eff16da0bc6b8577fce31a3a7d9", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a674f02a08ee1eff16da0bc6b8577fce31a3a7d9", "message": "Revert log with function pointers", "committedDate": "2020-03-16T09:00:13Z", "type": "commit"}, {"oid": "a674f02a08ee1eff16da0bc6b8577fce31a3a7d9", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a674f02a08ee1eff16da0bc6b8577fce31a3a7d9", "message": "Revert log with function pointers", "committedDate": "2020-03-16T09:00:13Z", "type": "forcePushed"}, {"oid": "65782a738ceaf5a90bc067e72d2c10d941d31779", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/65782a738ceaf5a90bc067e72d2c10d941d31779", "message": "Merge branch 'stage' of https://github.com/ballerina-platform/ballerina-lang into fix-cache-master", "committedDate": "2020-03-16T10:43:17Z", "type": "commit"}, {"oid": "0839973f2de498c2bb10251a08a13bed8ba476d9", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0839973f2de498c2bb10251a08a13bed8ba476d9", "message": "Merge branch 'stage' of https://github.com/ballerina-platform/ballerina-lang into fix-cache-master", "committedDate": "2020-03-16T15:08:02Z", "type": "commit"}]}