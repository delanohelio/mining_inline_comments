{"pr_number": 20748, "pr_title": "Revamp Language Server Completions Engine", "pr_createdAt": "2020-01-27T07:47:15Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/20748", "timeline": [{"oid": "b0829c441c13897c5d29f2fc1d45e4a69d332d75", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b0829c441c13897c5d29f2fc1d45e4a69d332d75", "message": "revamp sorting model", "committedDate": "2020-01-24T08:05:41Z", "type": "commit"}, {"oid": "6d06d83c1184d7f54d9846546c323b57d343077d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6d06d83c1184d7f54d9846546c323b57d343077d", "message": "migrate to completion item wrapper usage", "committedDate": "2020-01-26T12:30:48Z", "type": "commit"}, {"oid": "0040abed2e251dfa0bf06988f05c669e20337f60", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0040abed2e251dfa0bf06988f05c669e20337f60", "message": "fix the checkstyle issues", "committedDate": "2020-01-27T03:51:38Z", "type": "commit"}, {"oid": "80c4306a4ad0efb22e7de22f6aec5e88c57cbbeb", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/80c4306a4ad0efb22e7de22f6aec5e88c57cbbeb", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into completion-engine-revamp", "committedDate": "2020-01-27T03:52:41Z", "type": "commit"}, {"oid": "b4aa67ac8f70df05f66405ef07f07ad49521b2f0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b4aa67ac8f70df05f66405ef07f07ad49521b2f0", "message": "Sync with master", "committedDate": "2020-01-27T07:42:03Z", "type": "commit"}, {"oid": "6dd26e57e348daa804bfc975251759041a8fb232", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6dd26e57e348daa804bfc975251759041a8fb232", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into completion-engine-revamp", "committedDate": "2020-01-31T01:22:51Z", "type": "commit"}, {"oid": "1a402a3bff3585a0d09da891ac129648fd5e45f8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1a402a3bff3585a0d09da891ac129648fd5e45f8", "message": "revamp top level sorting order", "committedDate": "2020-01-31T05:27:57Z", "type": "commit"}, {"oid": "d8c7efd2847ac17dc1822d3dcbf2702ea3b76ef2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d8c7efd2847ac17dc1822d3dcbf2702ea3b76ef2", "message": "sync with master", "committedDate": "2020-01-31T06:17:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM3OTkzNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20748#discussion_r373379935", "bodyText": "Let's add a java doc here", "author": "rasika", "createdAt": "2020-01-31T09:14:48Z", "path": "language-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/SnippetBlock.java", "diffHunk": "@@ -126,6 +126,10 @@ public String getLabel() {\n         return label;\n     }\n \n+    public SnippetType getSnippetType() {", "originalCommit": "d8c7efd2847ac17dc1822d3dcbf2702ea3b76ef2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM5MDcxOQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20748#discussion_r373390719", "bodyText": "Please revisit returning an empty list here", "author": "rasika", "createdAt": "2020-01-31T09:40:24Z", "path": "language-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/completions/util/sorters/VariableDefContextItemSorter.java", "diffHunk": "@@ -17,63 +17,31 @@\n */\n package org.ballerinalang.langserver.completions.util.sorters;\n \n-import org.antlr.v4.runtime.CommonToken;\n-import org.antlr.v4.runtime.Token;\n import org.ballerinalang.langserver.commons.LSContext;\n-import org.ballerinalang.langserver.completions.util.ItemResolverConstants;\n-import org.ballerinalang.langserver.sourceprune.SourcePruneKeys;\n+import org.ballerinalang.langserver.commons.completion.LSCompletionItem;\n import org.eclipse.lsp4j.CompletionItem;\n \n+import java.util.ArrayList;\n+import java.util.Collections;\n import java.util.List;\n-import java.util.stream.Collectors;\n+\n+import javax.annotation.Nonnull;\n \n /**\n  * Item Sorter for the Variable Definition context.\n  */\n public class VariableDefContextItemSorter extends CompletionItemSorter {\n     /**\n-     * Sort Completion Items based on a particular criteria.\n-     *\n-     * @param ctx             Completion context\n-     * @param completionItems List of initial completion items\n+     * {@inheritDoc}\n      */\n     @Override\n-    public void sortItems(LSContext ctx, List<CompletionItem> completionItems) {\n-        this.setPriorities(completionItems);\n-        String variableType = this.getVariableType(ctx);\n-        // TODO: Revamp with the latest token analyzing\n-        List<String> poppedTokens = ctx.get(SourcePruneKeys.LHS_TOKENS_KEY).stream()\n-                .filter(commonToken -> commonToken.getChannel() == Token.DEFAULT_CHANNEL)\n-                .map(CommonToken::getText)\n-                .collect(Collectors.toList());\n-\n-        if (poppedTokens.contains(\"=\")) {\n-            completionItems.forEach(completionItem -> {\n-                if (completionItem.getDetail().equals(ItemResolverConstants.FUNCTION_TYPE)) {\n-                    String label = completionItem.getLabel();\n-                    String functionReturnType = label.substring(label.lastIndexOf(\"(\") + 1, label.lastIndexOf(\")\"));\n-\n-                    if (variableType.equals(functionReturnType)) {\n-                        this.increasePriority(completionItem);\n-                    }\n-                }\n-            });\n-        }\n-    }\n-    \n-    private void increasePriority(CompletionItem completionItem) {\n-        int sortText = Integer.parseInt(completionItem.getSortText());\n-        completionItem.setSortText(Integer.toString(sortText - 1));\n+    public List<CompletionItem> sortItems(LSContext ctx, List<LSCompletionItem> completionItems) {\n+        return new ArrayList<>();", "originalCommit": "d8c7efd2847ac17dc1822d3dcbf2702ea3b76ef2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}