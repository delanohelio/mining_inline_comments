{"pr_number": 22222, "pr_title": "Add observability compiler extension", "pr_createdAt": "2020-03-26T09:27:25Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222", "timeline": [{"oid": "28a152ffad28d4ddaf8b2aca31c3eb1f40262b5d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/28a152ffad28d4ddaf8b2aca31c3eb1f40262b5d", "message": "Add AST gen module", "committedDate": "2020-03-26T09:22:27Z", "type": "commit"}, {"oid": "0172d32432e20590a81783ff92cd0e4910c36654", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0172d32432e20590a81783ff92cd0e4910c36654", "message": "Implement AST data collection", "committedDate": "2020-03-26T09:23:00Z", "type": "commit"}, {"oid": "64f926fb1f7d56f4fb18bbd2db1be804aac04f04", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/64f926fb1f7d56f4fb18bbd2db1be804aac04f04", "message": "Init symbol collector after loading", "committedDate": "2020-03-26T09:23:13Z", "type": "commit"}, {"oid": "1b849103a0a09a17d506e6c746dbae491f369c51", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1b849103a0a09a17d506e6c746dbae491f369c51", "message": "Implement storing AST data to program JAR", "committedDate": "2020-03-26T09:23:24Z", "type": "commit"}, {"oid": "ada90d1a4327f1909c47adb3cbf19cd2860f5b00", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ada90d1a4327f1909c47adb3cbf19cd2860f5b00", "message": "Merge with 'observability-improvements'", "committedDate": "2020-03-26T10:46:42Z", "type": "commit"}, {"oid": "bd77bb79dd2f599dcf74f0f5fe6ab265cd3e95bc", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bd77bb79dd2f599dcf74f0f5fe6ab265cd3e95bc", "message": "Remove unwanted debug logs", "committedDate": "2020-03-27T05:21:02Z", "type": "commit"}, {"oid": "bd77bb79dd2f599dcf74f0f5fe6ab265cd3e95bc", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bd77bb79dd2f599dcf74f0f5fe6ab265cd3e95bc", "message": "Remove unwanted debug logs", "committedDate": "2020-03-27T05:21:02Z", "type": "forcePushed"}, {"oid": "28e3e366af91af5f08c3549d31f73c78986f155d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/28e3e366af91af5f08c3549d31f73c78986f155d", "message": "Improve error handling of the observerbilty collector", "committedDate": "2020-03-27T10:14:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE4NDM4MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399184380", "bodyText": "I think we need this task for Test and Run command as well", "author": "warunalakshitha", "createdAt": "2020-03-27T10:58:44Z", "path": "cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/BuildCommand.java", "diffHunk": "@@ -390,6 +391,7 @@ public void execute() {\n                 // create the jar.\n                 .addTask(new CreateJarTask(this.dumpBIR, skipCopyLibsFromDist))\n                 .addTask(new CopyResourcesTask(), isSingleFileBuild)\n+                .addTask(new CopyObservabilitySymbolsTask(), isSingleFileBuild)", "originalCommit": "28e3e366af91af5f08c3549d31f73c78986f155d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkzMjk4NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399932985", "bodyText": "I think we don't need this for the test. But not sure, we need this for run command. @a5anka Are we trying to observe using run common?", "author": "hasithaa", "createdAt": "2020-03-30T05:21:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE4NDM4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk1MDQ0Ng==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399950446", "bodyText": "Actually, I added this to run command. In the future users might need to run with observability features fro advanced debugging use cases with Choreo. Therefore it will be easier for the user if we have this enabled for run command. Isn't it?", "author": "a5anka", "createdAt": "2020-03-30T06:20:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE4NDM4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwOTE0Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399209143", "bodyText": "Shall we move this to createJarTask. AFAIU module jar with entry points should contain those sequence diagram json.\nThere is writeJarFile in CodeGenerater where we might need to modify that api with those resource files. So we do not need to create Jar File System again.", "author": "warunalakshitha", "createdAt": "2020-03-27T11:48:31Z", "path": "cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/task/CopyObservabilitySymbolsTask.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.ballerinalang.packerina.task;\n+\n+import org.ballerinalang.model.elements.PackageID;\n+import org.ballerinalang.packerina.buildcontext.BuildContext;\n+import org.ballerinalang.packerina.buildcontext.BuildContextField;\n+import org.wso2.ballerinalang.compiler.semantics.analyzer.ObserverbilitySymbolCollectorRunner;\n+import org.wso2.ballerinalang.compiler.spi.ObservabilitySymbolCollector;\n+import org.wso2.ballerinalang.compiler.tree.BLangPackage;\n+import org.wso2.ballerinalang.compiler.util.CompilerContext;\n+\n+import java.io.IOException;\n+import java.net.URI;\n+import java.nio.file.FileSystem;\n+import java.nio.file.FileSystems;\n+import java.nio.file.Path;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import static org.ballerinalang.tool.LauncherUtils.createLauncherException;\n+\n+/**\n+ * Copy collected observability symbol to module jar.\n+ */\n+public class CopyObservabilitySymbolsTask implements Task {\n+\n+    @Override\n+    public void execute(BuildContext buildContext) {\n+        List<BLangPackage> modulesWithEntryPoints = buildContext.getModules().stream()\n+                .filter(m -> m.symbol.entryPointExists)\n+                .collect(Collectors.toList());\n+\n+        if (!modulesWithEntryPoints.isEmpty()) {\n+            CompilerContext compilerContext = buildContext.get(BuildContextField.COMPILER_CONTEXT);\n+            ObservabilitySymbolCollector observabilitySymbolCollector\n+                    = ObserverbilitySymbolCollectorRunner.getInstance(compilerContext);\n+\n+            for (BLangPackage module : modulesWithEntryPoints) {\n+                PackageID packageID = module.packageID;\n+                Path moduleJarPath = buildContext.getJarPathFromTargetCache(packageID);\n+                URI uberJarUri = URI.create(\"jar:\" + moduleJarPath.toUri().toString());\n+\n+                try (FileSystem toFs = FileSystems.newFileSystem(uberJarUri, Collections.emptyMap())) {", "originalCommit": "28e3e366af91af5f08c3549d31f73c78986f155d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk1OTc3NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399959774", "bodyText": "Shall we move this to createJarTask. AFAIU module jar with entry points should contain those sequence diagram json.\n\nCreateJarTask class is delegating the jar creation to backendDriver.execute therefore may be not the best place. And additionally, we use observabilty only to build and run. Therefore isn't it better to have a separate task?\nWe are already adding the sequence diagram JSON to all module jars with entry points. Refer https://github.com/ballerina-platform/ballerina-lang/pull/22222/files/28e3e366af91af5f08c3549d31f73c78986f155d#diff-7c4c3a978dc518ee1571ea5b436a401aR51\n\nThere is writeJarFile in CodeGenerater where we might need to modify that api with those resource files. So we do not need to create Jar File System again.", "author": "a5anka", "createdAt": "2020-03-30T06:46:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwOTE0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk2OTUyNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399969526", "bodyText": "IMO we need to provide an api for all the resources to pack during create module jar. For the moment this is fine.", "author": "warunalakshitha", "createdAt": "2020-03-30T07:09:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwOTE0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIxMDcwNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399210707", "bodyText": "I think we do not need this file since no spotbug element is skip.", "author": "warunalakshitha", "createdAt": "2020-03-27T11:51:46Z", "path": "misc/observerability-symbol-collector/spotbugs-exclude.xml", "diffHunk": "@@ -0,0 +1,21 @@\n+<!--\n+  ~ Copyright (c) 2018, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "originalCommit": "28e3e366af91af5f08c3549d31f73c78986f155d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk1MDYwMw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399950603", "bodyText": "Removed in the latest commit", "author": "a5anka", "createdAt": "2020-03-30T06:21:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIxMDcwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIxMTIwMg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399211202", "bodyText": "Shall we fix licence year and missing licence in other places as well.", "author": "warunalakshitha", "createdAt": "2020-03-27T11:52:49Z", "path": "misc/observerability-symbol-collector/src/main/java/org/ballerinalang/observability/anaylze/DefaultObservabilitySymbolCollector.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/*\n+ * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "originalCommit": "28e3e366af91af5f08c3549d31f73c78986f155d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk1MDgxMQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399950811", "bodyText": "Done in the latest commit", "author": "a5anka", "createdAt": "2020-03-30T06:21:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIxMTIwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIxNDgyMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399214820", "bodyText": "We do not recommend to use stream api if performance is critical", "author": "warunalakshitha", "createdAt": "2020-03-27T12:00:13Z", "path": "misc/observerability-symbol-collector/src/main/java/org/ballerinalang/observability/anaylze/DefaultObservabilitySymbolCollector.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/*\n+ * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.ballerinalang.observability.anaylze;\n+\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import org.ballerinalang.langserver.compiler.common.modal.SymbolMetaInfo;\n+import org.ballerinalang.langserver.compiler.format.JSONGenerationException;\n+import org.ballerinalang.langserver.compiler.format.TextDocumentFormatUtil;\n+import org.ballerinalang.langserver.extensions.VisibleEndpointVisitor;\n+import org.ballerinalang.util.diagnostic.Diagnostic;\n+import org.ballerinalang.util.diagnostic.DiagnosticLog;\n+import org.wso2.ballerinalang.compiler.SourceDirectory;\n+import org.wso2.ballerinalang.compiler.SourceDirectoryManager;\n+import org.wso2.ballerinalang.compiler.spi.ObservabilitySymbolCollector;\n+import org.wso2.ballerinalang.compiler.tree.BLangCompilationUnit;\n+import org.wso2.ballerinalang.compiler.tree.BLangNode;\n+import org.wso2.ballerinalang.compiler.tree.BLangPackage;\n+import org.wso2.ballerinalang.compiler.util.CompilerContext;\n+import org.wso2.ballerinalang.compiler.util.diagnotic.BLangDiagnosticLogHelper;\n+\n+import java.io.IOException;\n+import java.io.OutputStream;\n+import java.io.PrintStream;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Properties;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * Default implementation of ObserverbilitySymbolCollector.\n+ */\n+public class DefaultObservabilitySymbolCollector implements ObservabilitySymbolCollector {\n+    private final PrintStream console = System.out;\n+\n+    private static final String NAME = \"name\";\n+    private static final String ORG_NAME = \"orgName\";\n+    private static final String PKG_VERSION = \"pkgVersion\";\n+    private static final String COMPILATION_UNITS = \"compilationUnits\";\n+    private static final String SRC = \"src\";\n+    private static final String KEY_URI = \"uri\";\n+    private static final String AST = \"ast\";\n+    private static final String JSON = \".json\";\n+    public static final String PROGRAM_HASH_KEY = \"PROGRAM_HASH\";\n+    public static final String AST_META_FILENAME = \"meta.properties\";\n+\n+    private CompilerContext compilerContext;\n+\n+    private DiagnosticLog diagnosticLog;\n+\n+    @Override\n+    public void init(CompilerContext context) {\n+        compilerContext = context;\n+        diagnosticLog = BLangDiagnosticLogHelper.getInstance(context);\n+    }\n+\n+    @Override\n+    public void process(BLangPackage module) {\n+        JsonObject moduleJson = getModuleJson(module);\n+        JsonASTHolder.getInstance().addAST(module.packageID.name.getValue(), moduleJson);\n+    }\n+\n+    @Override\n+    public void writeCollectedSymbols(BLangPackage module, Path destination) throws IOException {\n+        Path targetDirPath = destination.resolve(AST);\n+        if (Files.notExists(targetDirPath)) {\n+            Files.createDirectory(targetDirPath);\n+        }\n+        Set<String> packages = getUserPackages();\n+\n+        JsonObject ast = new JsonObject();\n+        for (Map.Entry<String, JsonObject> entry : JsonASTHolder.getInstance()\n+                .getASTMap().entrySet()) {\n+            if (packages.contains(entry.getKey())) {\n+                ast.add(entry.getKey(), entry.getValue());\n+            }\n+        }\n+\n+        String astDataString = JsonCanonicalizer.getEncodedString(ast.toString());\n+        Files.write(targetDirPath.resolve(AST + JSON), astDataString.getBytes(StandardCharsets.UTF_8));\n+\n+        Properties props = new Properties();\n+        props.setProperty(PROGRAM_HASH_KEY, String.valueOf(astDataString.hashCode()));\n+        try (OutputStream outputStream = Files.newOutputStream(targetDirPath.resolve(AST_META_FILENAME))) {\n+            props.store(outputStream, null);\n+        }\n+    }\n+\n+    private Set<String> getUserPackages() {\n+        SourceDirectoryManager sourceDirectoryManager = SourceDirectoryManager.getInstance(compilerContext);\n+        return sourceDirectoryManager.listSourceFilesAndPackages()", "originalCommit": "28e3e366af91af5f08c3549d31f73c78986f155d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk1MTIwMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399951200", "bodyText": "This is not in the critical path AFAIU. Is it ok if I keep this for readability?", "author": "a5anka", "createdAt": "2020-03-30T06:22:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIxNDgyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIxNjA3Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399216077", "bodyText": "Do we need to encode the json.", "author": "warunalakshitha", "createdAt": "2020-03-27T12:02:57Z", "path": "misc/observerability-symbol-collector/src/main/java/org/ballerinalang/observability/anaylze/DefaultObservabilitySymbolCollector.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/*\n+ * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.ballerinalang.observability.anaylze;\n+\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import org.ballerinalang.langserver.compiler.common.modal.SymbolMetaInfo;\n+import org.ballerinalang.langserver.compiler.format.JSONGenerationException;\n+import org.ballerinalang.langserver.compiler.format.TextDocumentFormatUtil;\n+import org.ballerinalang.langserver.extensions.VisibleEndpointVisitor;\n+import org.ballerinalang.util.diagnostic.Diagnostic;\n+import org.ballerinalang.util.diagnostic.DiagnosticLog;\n+import org.wso2.ballerinalang.compiler.SourceDirectory;\n+import org.wso2.ballerinalang.compiler.SourceDirectoryManager;\n+import org.wso2.ballerinalang.compiler.spi.ObservabilitySymbolCollector;\n+import org.wso2.ballerinalang.compiler.tree.BLangCompilationUnit;\n+import org.wso2.ballerinalang.compiler.tree.BLangNode;\n+import org.wso2.ballerinalang.compiler.tree.BLangPackage;\n+import org.wso2.ballerinalang.compiler.util.CompilerContext;\n+import org.wso2.ballerinalang.compiler.util.diagnotic.BLangDiagnosticLogHelper;\n+\n+import java.io.IOException;\n+import java.io.OutputStream;\n+import java.io.PrintStream;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Properties;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * Default implementation of ObserverbilitySymbolCollector.\n+ */\n+public class DefaultObservabilitySymbolCollector implements ObservabilitySymbolCollector {\n+    private final PrintStream console = System.out;\n+\n+    private static final String NAME = \"name\";\n+    private static final String ORG_NAME = \"orgName\";\n+    private static final String PKG_VERSION = \"pkgVersion\";\n+    private static final String COMPILATION_UNITS = \"compilationUnits\";\n+    private static final String SRC = \"src\";\n+    private static final String KEY_URI = \"uri\";\n+    private static final String AST = \"ast\";\n+    private static final String JSON = \".json\";\n+    public static final String PROGRAM_HASH_KEY = \"PROGRAM_HASH\";\n+    public static final String AST_META_FILENAME = \"meta.properties\";\n+\n+    private CompilerContext compilerContext;\n+\n+    private DiagnosticLog diagnosticLog;\n+\n+    @Override\n+    public void init(CompilerContext context) {\n+        compilerContext = context;\n+        diagnosticLog = BLangDiagnosticLogHelper.getInstance(context);\n+    }\n+\n+    @Override\n+    public void process(BLangPackage module) {\n+        JsonObject moduleJson = getModuleJson(module);\n+        JsonASTHolder.getInstance().addAST(module.packageID.name.getValue(), moduleJson);\n+    }\n+\n+    @Override\n+    public void writeCollectedSymbols(BLangPackage module, Path destination) throws IOException {\n+        Path targetDirPath = destination.resolve(AST);\n+        if (Files.notExists(targetDirPath)) {\n+            Files.createDirectory(targetDirPath);\n+        }\n+        Set<String> packages = getUserPackages();\n+\n+        JsonObject ast = new JsonObject();\n+        for (Map.Entry<String, JsonObject> entry : JsonASTHolder.getInstance()\n+                .getASTMap().entrySet()) {\n+            if (packages.contains(entry.getKey())) {\n+                ast.add(entry.getKey(), entry.getValue());\n+            }\n+        }\n+\n+        String astDataString = JsonCanonicalizer.getEncodedString(ast.toString());", "originalCommit": "28e3e366af91af5f08c3549d31f73c78986f155d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYxNDU4NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399614584", "bodyText": "This is to canonicalize the JSON output to ensure that we generate the same JSON when the program does not change. Without this, we observed that the order of items in the JSON changing.", "author": "a5anka", "createdAt": "2020-03-28T03:44:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIxNjA3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkzNjgyMQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399936821", "bodyText": "No Licence header.", "author": "hasithaa", "createdAt": "2020-03-30T05:35:55Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/NullObservabiltySymbolCollector.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package org.wso2.ballerinalang.compiler.semantics.analyzer;", "originalCommit": "28e3e366af91af5f08c3549d31f73c78986f155d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk1MTM3MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399951370", "bodyText": "Added in the latest commit.", "author": "a5anka", "createdAt": "2020-03-30T06:23:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkzNjgyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkzNzAyOA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399937028", "bodyText": "As a practice, we add @since annotation. Please add that.", "author": "hasithaa", "createdAt": "2020-03-30T05:36:50Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/NullObservabiltySymbolCollector.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package org.wso2.ballerinalang.compiler.semantics.analyzer;\n+\n+import org.wso2.ballerinalang.compiler.spi.ObservabilitySymbolCollector;\n+import org.wso2.ballerinalang.compiler.tree.BLangPackage;\n+import org.wso2.ballerinalang.compiler.util.CompilerContext;\n+\n+import java.nio.file.Path;\n+\n+/**\n+ * Null Object for ObserverbilitySymbolCollector interface.\n+ */", "originalCommit": "28e3e366af91af5f08c3549d31f73c78986f155d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk1MTUxNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399951517", "bodyText": "Added in the latest commit", "author": "a5anka", "createdAt": "2020-03-30T06:23:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkzNzAyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkzNzEwMQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399937101", "bodyText": "Missing Licence header.", "author": "hasithaa", "createdAt": "2020-03-30T05:37:06Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/ObserverbilitySymbolCollectorRunner.java", "diffHunk": "@@ -0,0 +1,44 @@\n+package org.wso2.ballerinalang.compiler.semantics.analyzer;", "originalCommit": "28e3e366af91af5f08c3549d31f73c78986f155d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk1MTc4Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399951783", "bodyText": "Added in the latest commit. I didn't have the copyright settings configured. I fixed it in the IDE.", "author": "a5anka", "createdAt": "2020-03-30T06:24:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkzNzEwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkzOTY0Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399939647", "bodyText": "Missing Licence header.", "author": "hasithaa", "createdAt": "2020-03-30T05:46:19Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/spi/ObservabilitySymbolCollector.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package org.wso2.ballerinalang.compiler.spi;", "originalCommit": "28e3e366af91af5f08c3549d31f73c78986f155d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk1MTk3Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22222#discussion_r399951977", "bodyText": "Added in latest commit", "author": "a5anka", "createdAt": "2020-03-30T06:25:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkzOTY0Nw=="}], "type": "inlineReview"}, {"oid": "faf4932a1cd98261bc1f3094c00b36f5bd6f7ea0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/faf4932a1cd98261bc1f3094c00b36f5bd6f7ea0", "message": "Remove spotbugs-exclude file", "committedDate": "2020-03-30T06:07:38Z", "type": "commit"}, {"oid": "d92d0173e4f07bc39b4fcb5872e6b58522a09f94", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d92d0173e4f07bc39b4fcb5872e6b58522a09f94", "message": "Update copyright header", "committedDate": "2020-03-30T06:24:36Z", "type": "commit"}, {"oid": "d92d0173e4f07bc39b4fcb5872e6b58522a09f94", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d92d0173e4f07bc39b4fcb5872e6b58522a09f94", "message": "Update copyright header", "committedDate": "2020-03-30T06:24:36Z", "type": "forcePushed"}]}