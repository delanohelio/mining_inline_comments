{"pr_number": 22632, "pr_title": "Add params support for SQL connectors", "pr_createdAt": "2020-04-15T09:06:26Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/22632", "timeline": [{"oid": "bceb7def672fa6287ff2ea81af368e9f6c76703f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bceb7def672fa6287ff2ea81af368e9f6c76703f", "message": "Add initial cut of parameterized string to sql query operation", "committedDate": "2020-04-01T07:22:06Z", "type": "commit"}, {"oid": "39dfc375ef1cf79018c05ea259e7a0beb7930244", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/39dfc375ef1cf79018c05ea259e7a0beb7930244", "message": "Add support for primitive types on the parameterized string", "committedDate": "2020-04-01T13:22:32Z", "type": "commit"}, {"oid": "e12e561bda3c0bcb48a4c62ff09d85bbbb21b078", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e12e561bda3c0bcb48a4c62ff09d85bbbb21b078", "message": "Add support for string and boolean sql types as params", "committedDate": "2020-04-06T06:30:40Z", "type": "commit"}, {"oid": "ac31dd68122b533efffa29c9f425e45843ba30e0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ac31dd68122b533efffa29c9f425e45843ba30e0", "message": "Add params support for numeric types", "committedDate": "2020-04-06T09:38:47Z", "type": "commit"}, {"oid": "f048bff98ce2e00f06ca40588341538d9048e604", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f048bff98ce2e00f06ca40588341538d9048e604", "message": "Add params support for binary, clob, and blob types", "committedDate": "2020-04-08T13:39:31Z", "type": "commit"}, {"oid": "929dfb0483f42b3df09a4e8f1eebe57baff9a715", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/929dfb0483f42b3df09a4e8f1eebe57baff9a715", "message": "Add params support for date, time, timestamp and datetime type.", "committedDate": "2020-04-09T16:45:48Z", "type": "commit"}, {"oid": "35e100ab466c2f7de90299aa7b8134493ec62e70", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/35e100ab466c2f7de90299aa7b8134493ec62e70", "message": "Add params support for arrays and struct types", "committedDate": "2020-04-14T14:18:41Z", "type": "commit"}, {"oid": "147dfb75e50fc62c98b27cdb470ba281ddd7166d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/147dfb75e50fc62c98b27cdb470ba281ddd7166d", "message": "Fix jdbc2 module api to be compatible with sql module", "committedDate": "2020-04-14T14:32:52Z", "type": "commit"}, {"oid": "dc50d62f3ad21b157270086d72266701971e51b9", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/dc50d62f3ad21b157270086d72266701971e51b9", "message": "Update mysql client with sql module changes", "committedDate": "2020-04-15T05:28:25Z", "type": "commit"}, {"oid": "62cafbe39baec09c332965f31223ac625eef6555", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/62cafbe39baec09c332965f31223ac625eef6555", "message": "Add jdbc2 test cases for the updated query operation with params", "committedDate": "2020-04-15T08:12:51Z", "type": "commit"}, {"oid": "a73382ae2176db080cad5c7ad3f77d6cf8a5a0af", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a73382ae2176db080cad5c7ad3f77d6cf8a5a0af", "message": "Merge branch 'upstream-master' into sql-connector-params-support\n\n# Conflicts:\n#\tstdlib/database/sql/src/main/java/org/ballerinalang/sql/utils/Utils.java", "committedDate": "2020-04-15T08:55:21Z", "type": "commit"}, {"oid": "852c6d0f05fad419d05515dc58440d0cb67d4c36", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/852c6d0f05fad419d05515dc58440d0cb67d4c36", "message": "Fix conflicts with master", "committedDate": "2020-04-15T09:02:02Z", "type": "commit"}, {"oid": "b07bfa47e35ca616ae2a5031026966c34327c810", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b07bfa47e35ca616ae2a5031026966c34327c810", "message": "Fix code formatting issue", "committedDate": "2020-04-15T09:04:33Z", "type": "commit"}, {"oid": "c87a4c013e2a6a3bd8e032ca68d8976eb493670e", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c87a4c013e2a6a3bd8e032ca68d8976eb493670e", "message": "Add mysql connector test cases for the query operation with params", "committedDate": "2020-04-15T13:03:10Z", "type": "commit"}, {"oid": "4a31056b285d49018373d8eeea8a1472ca4b9f83", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4a31056b285d49018373d8eeea8a1472ca4b9f83", "message": "Fix code formatting issues", "committedDate": "2020-04-15T13:07:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODk3NjIyMQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22632#discussion_r408976221", "bodyText": "Can we lift up this line to before line?", "author": "kalaiyarasiganeshalingam", "createdAt": "2020-04-15T16:30:37Z", "path": "stdlib/database/sql/src/main/java/org/ballerinalang/sql/utils/Utils.java", "diffHunk": "@@ -90,6 +104,411 @@ public static void closeResources(ResultSet resultSet, Statement statement, Conn\n         }\n     }\n \n+    static String getSqlQuery(MapValue<String, Object> paramString) throws ApplicationError {\n+        ArrayValue partsArray = paramString.getArrayValue(Constants.ParameterizedStingFields.PARTS);\n+        ArrayValue insertionsArray = paramString.getArrayValue(Constants.ParameterizedStingFields.INSERTIONS);\n+        if (partsArray.size() - 1 == insertionsArray.size()) {\n+            StringBuilder sqlQuery = new StringBuilder();\n+            for (int i = 0; i < partsArray.size(); i++) {\n+                if (i > 0) {\n+                    sqlQuery.append(\" ? \");\n+                }\n+                sqlQuery.append(partsArray.get(i).toString());\n+            }\n+            return sqlQuery.toString();\n+        } else {\n+            throw new ApplicationError(\"Parts and insertions count doesn't match in ParametrizedString passed. \"\n+                    + paramString.toString());\n+        }\n+    }\n+\n+    static void setParams(Connection connection, PreparedStatement preparedStatement, MapValue<String,\n+            Object> paramString)\n+            throws SQLException, ApplicationError, IOException, ParseException {", "originalCommit": "4a31056b285d49018373d8eeea8a1472ca4b9f83", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODk3ODA3Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22632#discussion_r408978072", "bodyText": "Remove this extra line.", "author": "kalaiyarasiganeshalingam", "createdAt": "2020-04-15T16:33:43Z", "path": "stdlib/database/mysql/src/test/java/org/ballerinalang/mysql/query/ParamsQueryTest.java", "diffHunk": "@@ -0,0 +1,456 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package org.ballerinalang.mysql.query;\n+\n+import org.ballerinalang.model.values.BBoolean;\n+import org.ballerinalang.model.values.BDecimal;\n+import org.ballerinalang.model.values.BError;\n+import org.ballerinalang.model.values.BFloat;\n+import org.ballerinalang.model.values.BInteger;\n+import org.ballerinalang.model.values.BMap;\n+import org.ballerinalang.model.values.BString;\n+import org.ballerinalang.model.values.BValue;\n+import org.ballerinalang.mysql.BaseTest;\n+import org.ballerinalang.mysql.utils.SQLDBUtils;\n+import org.ballerinalang.test.util.BCompileUtil;\n+import org.ballerinalang.test.util.BRunUtil;\n+import org.ballerinalang.test.util.CompileResult;\n+import org.testng.Assert;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+import org.wso2.ballerinalang.compiler.util.TypeTags;\n+\n+import java.io.File;\n+import java.text.DecimalFormat;\n+import java.util.LinkedHashMap;\n+\n+/**\n+ * This test class verifies the behaviour of the ParameterizedString passed into the testQuery operation.\n+ *\n+ * @since 1.3.0\n+ */\n+public class ParamsQueryTest {\n+    private CompileResult result;\n+    private static final String DB_NAME = \"TEST_SQL_PARAMS_QUERY\";\n+    private static final String SQL_SCRIPT = SQLDBUtils.SQL_RESOURCE_DIR + File.separator + SQLDBUtils.QUERY_DIR +\n+            File.separator + \"simple-params-test-data.sql\";\n+\n+    static {\n+        BaseTest.addDBSchema(DB_NAME, SQL_SCRIPT);\n+    }\n+\n+    @BeforeClass\n+    public void setup() {\n+        result = BCompileUtil.compileOffline(SQLDBUtils.getBalFilesDir(SQLDBUtils.QUERY_DIR,\n+                \"simple-params-query-test.bal\"));\n+    }\n+\n+", "originalCommit": "4a31056b285d49018373d8eeea8a1472ca4b9f83", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ce4f082ea7b9424cacec3d970fff980868e5fb0f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ce4f082ea7b9424cacec3d970fff980868e5fb0f", "message": "Fix code formatting issues suggested with code review", "committedDate": "2020-04-15T17:14:38Z", "type": "commit"}, {"oid": "33305117a38708457d6fcce45194267f2c88312a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/33305117a38708457d6fcce45194267f2c88312a", "message": "Remove unused import", "committedDate": "2020-04-15T17:38:04Z", "type": "commit"}, {"oid": "69849f36b5cb29d90e9650b7d944f243f0ac5290", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/69849f36b5cb29d90e9650b7d944f243f0ac5290", "message": "Merge branch 'upstream-master' into sql-connector-params-support", "committedDate": "2020-04-16T09:03:08Z", "type": "commit"}, {"oid": "a45f9493e73aa4b828b42db94a4c04e5d86a9665", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a45f9493e73aa4b828b42db94a4c04e5d86a9665", "message": "Merge branch 'upstream-master' into sql-connector-params-support", "committedDate": "2020-04-16T09:31:25Z", "type": "commit"}]}