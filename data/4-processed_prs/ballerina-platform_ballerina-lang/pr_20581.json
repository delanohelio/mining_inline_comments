{"pr_number": 20581, "pr_title": "Add support reading array of values via config API", "pr_createdAt": "2020-01-13T12:08:10Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/20581", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTk1MzE1MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20581#discussion_r365953151", "bodyText": "Shall we refrain from placing \"array\" within quotes? The other types were quoted because those are actual types + keywords.", "author": "pubudu91", "createdAt": "2020-01-13T18:17:42Z", "path": "bvm/ballerina-config/src/main/java/org/ballerinalang/config/ConfigRegistry.java", "diffHunk": "@@ -330,6 +331,34 @@ public double getAsFloat(String sectionHeader, String field) {\n         return getAsMap(getConfigKey(sectionHeader, field));\n     }\n \n+    /**\n+     * Retrieves the config value specified by the key as a List.\n+     *\n+     * @param key The key of the config entry\n+     * @return The associated config value\n+     */\n+    public List getAsArray(String key) {\n+        if (key == null) {\n+            return null;\n+        }\n+        Object value = configEntries.get(key);\n+        if (value instanceof List) {\n+            return (List) value;\n+        }\n+        throw new IllegalArgumentException(\"config key '\" + key + \"' does not map to a valid 'array'\");", "originalCommit": "101ce540437e05b7a65ec93f90b87e9a49fe9261", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIxMTIzOA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20581#discussion_r366211238", "bodyText": "Changed code to return an empty List instead of throwing the exception.", "author": "aashikam", "createdAt": "2020-01-14T08:46:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTk1MzE1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTk1MzgwNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20581#discussion_r365953806", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    error err = error(\"Invalid value. Expected a 'any[]'.\");\n          \n          \n            \n                    error err = error(\"Invalid value. Expected an 'any[]'.\");", "author": "pubudu91", "createdAt": "2020-01-13T18:19:12Z", "path": "stdlib/config-api/src/main/ballerina/src/config/config.bal", "diffHunk": "@@ -149,6 +149,21 @@ public function getAsMap(@untainted string key) returns map<any> {\n     }\n }\n \n+// TODO: If there is no mapping?\n+# Retrieves the specified configuration value as an array. If there is no mapping, an empty array will be returned.\n+#\n+# + key - The configuration to be retrieved\n+# + return - Configuration value mapped by the key\n+public function getAsArray(@untainted string key) returns any[] {\n+    var value = get(key, ARRAY);\n+    if (value is any[]) {\n+        return value;\n+    } else {\n+        error err = error(\"Invalid value. Expected a 'any[]'.\");", "originalCommit": "101ce540437e05b7a65ec93f90b87e9a49fe9261", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE1NTI2Ng==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20581#discussion_r366155266", "bodyText": "Fixed.", "author": "aashikam", "createdAt": "2020-01-14T05:12:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTk1MzgwNg=="}], "type": "inlineReview"}, {"oid": "3c293bd3ca7f13544709fba6d3a4a1b0287cf927", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3c293bd3ca7f13544709fba6d3a4a1b0287cf927", "message": "Add support reading array of values via config API\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/10633", "committedDate": "2020-01-14T08:44:51Z", "type": "forcePushed"}, {"oid": "bba74d637f94a098cec22277d543637c6d7c47e4", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bba74d637f94a098cec22277d543637c6d7c47e4", "message": "Add support reading array of values via config API\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/10633", "committedDate": "2020-01-14T09:13:09Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI0MTYyNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20581#discussion_r366241626", "bodyText": "Is there any way to improve this message like 'Expect 1111 got 2222' format?", "author": "wggihan", "createdAt": "2020-01-14T09:51:57Z", "path": "stdlib/config-api/src/main/ballerina/src/config/config.bal", "diffHunk": "@@ -149,6 +149,20 @@ public function getAsMap(@untainted string key) returns map<any> {\n     }\n }\n \n+# Retrieves the specified configuration value as an array. If there is no mapping, an empty array will be returned.\n+#\n+# + key - The configuration to be retrieved\n+# + return - Configuration value mapped by the key\n+public function getAsArray(@untainted string key) returns any[] {\n+    var value = get(key, ARRAY);\n+    if (value is any[]) {\n+        return value;\n+    } else {\n+        error err = error(\"Invalid value. Expected an 'any[]'.\");", "originalCommit": "bba74d637f94a098cec22277d543637c6d7c47e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI1NzE2NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20581#discussion_r367257164", "bodyText": "Removed this code block. As there is no chance of this happening.", "author": "aashikam", "createdAt": "2020-01-16T06:56:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI0MTYyNg=="}], "type": "inlineReview"}, {"oid": "dfe64f26f67f04607d8e81afbdc74e6e724202d4", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/dfe64f26f67f04607d8e81afbdc74e6e724202d4", "message": "Add support reading array of values via config API\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/10633", "committedDate": "2020-01-16T06:04:50Z", "type": "commit"}, {"oid": "dfe64f26f67f04607d8e81afbdc74e6e724202d4", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/dfe64f26f67f04607d8e81afbdc74e6e724202d4", "message": "Add support reading array of values via config API\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/10633", "committedDate": "2020-01-16T06:04:50Z", "type": "forcePushed"}, {"oid": "7a43902b2a1ac3dd03f60f06cfbc1ff574c1a6a7", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7a43902b2a1ac3dd03f60f06cfbc1ff574c1a6a7", "message": "Fix test failures", "committedDate": "2020-01-16T06:54:41Z", "type": "commit"}, {"oid": "fee5535d3654f0577169c2a81c258935503c0fa3", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fee5535d3654f0577169c2a81c258935503c0fa3", "message": "Merge branch 'ballerina-1.1.x' of https://github.com/ballerina-platform/ballerina-lang into config-api", "committedDate": "2020-01-17T04:21:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzgyOTU0OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20581#discussion_r367829548", "bodyText": "On second thoughts, shall we make this anydata[] instead of any[]? I just tested this and with an any[], you can't really do anything useful easily; you have to cast each of the array element to its required type. With anydata[], you can do the following:\nimport ballerina/config;\nimport ballerina/io;\n\npublic function main() {\n\tint[]|error ports = int[].constructFrom(config:getAsArray(\"ports\"));\n\tif (ports is int[]) {\n\t\tio:println(ports); \n\t}\n}", "author": "pubudu91", "createdAt": "2020-01-17T09:02:33Z", "path": "stdlib/config-api/src/main/ballerina/src/config/config.bal", "diffHunk": "@@ -149,6 +149,14 @@ public function getAsMap(@untainted string key) returns map<any> {\n     }\n }\n \n+# Retrieves the specified configuration value as an array. If there is no mapping, an empty array will be returned.\n+#\n+# + key - The configuration to be retrieved\n+# + return - Configuration value mapped by the key\n+public function getAsArray(@untainted string key) returns any[] {", "originalCommit": "fee5535d3654f0577169c2a81c258935503c0fa3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzgyOTc2Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20581#discussion_r367829762", "bodyText": "Other than that, this is working as expected.", "author": "pubudu91", "createdAt": "2020-01-17T09:03:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzgyOTU0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg0MDM0MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20581#discussion_r367840341", "bodyText": "Agreed. Fixed this in 91dce9a", "author": "aashikam", "createdAt": "2020-01-17T09:29:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzgyOTU0OA=="}], "type": "inlineReview"}, {"oid": "91dce9a970344c437ca6058e10f25ba7641179a2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/91dce9a970344c437ca6058e10f25ba7641179a2", "message": "Add changes from code review", "committedDate": "2020-01-17T09:22:13Z", "type": "commit"}, {"oid": "e3953d1ce151070483a82ede299cb501c45a9d2a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e3953d1ce151070483a82ede299cb501c45a9d2a", "message": "Add more tests", "committedDate": "2020-01-17T12:12:23Z", "type": "commit"}, {"oid": "e3953d1ce151070483a82ede299cb501c45a9d2a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e3953d1ce151070483a82ede299cb501c45a9d2a", "message": "Add more tests", "committedDate": "2020-01-17T12:12:23Z", "type": "forcePushed"}, {"oid": "fd22b650ba860c9bd3bec154f3c1d97928af0029", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fd22b650ba860c9bd3bec154f3c1d97928af0029", "message": "Merge branch 'ballerina-1.1.x' of https://github.com/ballerina-platform/ballerina-lang into config-api", "committedDate": "2020-01-20T01:17:25Z", "type": "commit"}, {"oid": "9e603d133125a39a65b33e459fadfa1b37c31416", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9e603d133125a39a65b33e459fadfa1b37c31416", "message": "Fix test failures", "committedDate": "2020-01-20T06:21:47Z", "type": "commit"}]}