{"pr_number": 26581, "pr_title": "Fixed parameter types of Syntax API factory methods", "pr_createdAt": "2020-10-26T00:37:37Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/26581", "timeline": [{"oid": "92cc1b61c43e6f796ee994d46b98b8b0414838f7", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/92cc1b61c43e6f796ee994d46b98b8b0414838f7", "message": "Fixed node factory issues", "committedDate": "2020-10-22T22:56:20Z", "type": "commit"}, {"oid": "59dcc1d1743f2b9e94e21219238ad3348e70ccdd", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/59dcc1d1743f2b9e94e21219238ad3348e70ccdd", "message": "Fixed SeparatedNodeList function", "committedDate": "2020-10-22T22:56:38Z", "type": "commit"}, {"oid": "62ca9ec4714ddb4fb034141f41ddc410d16315b4", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/62ca9ec4714ddb4fb034141f41ddc410d16315b4", "message": "Fixed syntax errors in blang transformer", "committedDate": "2020-10-26T20:12:27Z", "type": "commit"}, {"oid": "78f9dcd510f44df8b800ea0d6fb19fe4c61bfc07", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/78f9dcd510f44df8b800ea0d6fb19fe4c61bfc07", "message": "Removed unused import statements", "committedDate": "2020-10-26T20:27:55Z", "type": "commit"}, {"oid": "063c0017984d0eea8296d376e91240d640b87e05", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/063c0017984d0eea8296d376e91240d640b87e05", "message": "Fixed syntax errors in FormattingTreeModifier", "committedDate": "2020-10-26T20:43:39Z", "type": "commit"}, {"oid": "ec29a782d9bbc740bb53e68ddb58e31ddc43c9f3", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ec29a782d9bbc740bb53e68ddb58e31ddc43c9f3", "message": "Removed star import from FormattingTreeModifier", "committedDate": "2020-10-26T21:04:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM3OTcxMg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26581#discussion_r512379712", "bodyText": "Any idea why do we need this change?", "author": "SupunS", "createdAt": "2020-10-27T02:30:26Z", "path": "compiler/ballerina-treegen/src/main/resources/syntax_tree_descriptor.json", "diffHunk": "@@ -2877,7 +2878,7 @@\n                 },\n                 {\n                     \"name\": \"intermediateClauses\",\n-                    \"type\": \"IntermediateClauseNode\",\n+                    \"type\": \"ClauseNode\",", "originalCommit": "ec29a782d9bbc740bb53e68ddb58e31ddc43c9f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUxODM0MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26581#discussion_r512518341", "bodyText": "https://ballerina.io/swan-lake/learn/by-example/query-expression.html\nIn this code, specifically in the QueryPipelineNode, order by student.firstName descending part is a OrderByClauseNode which is extended from ClauseNode directly. So, it cannot exists inside the NodeList<IntermediateClauseNode.\nHere is a small code segment with this problem.\npublic function main() {\n    Report[] reportList = from var student in studentList\n       where student.gpa >= 2.0\n       order by student.firstName descending\n       limit 2\n       select {};\n}", "author": "kdsuneraavinash", "createdAt": "2020-10-27T09:03:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM3OTcxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUyMzIwNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26581#discussion_r512523205", "bodyText": "I see.\nIssue seems to be in the OrderByClauseNode. We should make the base type of OrderByClauseNode to IntermediateClauseNode.", "author": "SupunS", "createdAt": "2020-10-27T09:10:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM3OTcxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM3OTc4Ng==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26581#discussion_r512379786", "bodyText": "and this one too?", "author": "SupunS", "createdAt": "2020-10-27T02:30:42Z", "path": "compiler/ballerina-treegen/src/main/resources/syntax_tree_descriptor.json", "diffHunk": "@@ -2173,7 +2174,7 @@\n                 },\n                 {\n                     \"name\": \"content\",\n-                    \"type\": \"TemplateMemberNode\",\n+                    \"type\": \"Node\",", "originalCommit": "ec29a782d9bbc740bb53e68ddb58e31ddc43c9f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM4ODM0MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26581#discussion_r512388340", "bodyText": "Just saw the issue reported. +1 for this change.\nShall we also remove the TemplateMemberNode from the syntax tree, since there are no more usages of it?", "author": "SupunS", "createdAt": "2020-10-27T03:01:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM3OTc4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUyNDkxOA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26581#discussion_r512524918", "bodyText": "Should I remove that in this PR as well?", "author": "kdsuneraavinash", "createdAt": "2020-10-27T09:13:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM3OTc4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUyODcwNA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26581#discussion_r512528704", "bodyText": "+1", "author": "SupunS", "createdAt": "2020-10-27T09:19:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM3OTc4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU0ODEzOQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26581#discussion_r512548139", "bodyText": "XMLItemNode extends from TemplateMemberNode. So should I change XMLItemNode to extend from the superclass of TemplateMemberNode instead? (which is Node)", "author": "kdsuneraavinash", "createdAt": "2020-10-27T09:49:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM3OTc4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM3OTg3Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26581#discussion_r512379872", "bodyText": "Shall we remove this extra newline?", "author": "SupunS", "createdAt": "2020-10-27T02:31:03Z", "path": "misc/formatter/modules/formatter-core/src/main/java/org/ballerinalang/formatter/core/FormattingTreeModifier.java", "diffHunk": "@@ -17,6 +17,7 @@\n  */\n package org.ballerinalang.formatter.core;\n \n+", "originalCommit": "ec29a782d9bbc740bb53e68ddb58e31ddc43c9f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUyNDAxMQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26581#discussion_r512524011", "bodyText": "OK", "author": "kdsuneraavinash", "createdAt": "2020-10-27T09:12:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM3OTg3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM4MDMyNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26581#discussion_r512380327", "bodyText": "Formatting properties of the annotations should be changed depending on the existence of the type.\nCan you create an issue to track this?", "author": "SupunS", "createdAt": "2020-10-27T02:32:43Z", "path": "misc/formatter/modules/formatter-core/src/main/java/org/ballerinalang/formatter/core/FormattingTreeModifier.java", "diffHunk": "@@ -1391,7 +1391,7 @@ public TypeCastExpressionNode transform(TypeCastExpressionNode typeCastExpressio\n     @Override\n     public TypeCastParamNode transform(TypeCastParamNode typeCastParamNode) {\n         NodeList<AnnotationNode> annotations = formatNodeList(typeCastParamNode.annotations(), 0, 1, 1, 0);\n-        Node type = formatNode(typeCastParamNode.type(), env.trailingWS, env.trailingNL);\n+        Node type = formatNode(typeCastParamNode.type().orElse(null), env.trailingWS, env.trailingNL);", "originalCommit": "ec29a782d9bbc740bb53e68ddb58e31ddc43c9f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUyMjQ1NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26581#discussion_r512522455", "bodyText": "Actually previously it was possible for the typeCastParamNode.type() to be null. However, it was handled inside the formatNode method accordingly.\nprivate <T extends Node> T formatNode(T node, int trailingWS, int trailingNL) {\n        if (node == null || node.isMissing()) {\n            return node;\n        }\n       // ...\n}", "author": "kdsuneraavinash", "createdAt": "2020-10-27T09:09:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM4MDMyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUyODM5MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26581#discussion_r512528391", "bodyText": "Trailing whitespaces/newlines etc. of a given node depends on the node to be followed. So here, if the typeCastParamNode.type() is not present, then the formatting of the preceding node (annotations) must be adjusted accordingly.", "author": "SupunS", "createdAt": "2020-10-27T09:18:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM4MDMyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM4MjA1Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26581#discussion_r512382057", "bodyText": "Do we need to change the parameter type from the generic type T to Node?", "author": "SupunS", "createdAt": "2020-10-27T02:38:45Z", "path": "compiler/ballerina-parser/src/main/java/io/ballerina/compiler/syntax/tree/AbstractNodeFactory.java", "diffHunk": "@@ -189,17 +189,17 @@ public static Minutiae createEndOfLineMinutiae(String text) {\n                         .collect(Collectors.toList())).createUnlinkedFacade());\n     }\n \n-    public static <T extends Node> NodeList<T> createSeparatedNodeList(T... nodes) {\n+    public static <T extends Node> SeparatedNodeList<T> createSeparatedNodeList(Node... nodes) {", "originalCommit": "ec29a782d9bbc740bb53e68ddb58e31ddc43c9f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUyMzUzOA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26581#discussion_r512523538", "bodyText": "Yes, I think so.\nThe SeparatedNodeList contains separator nodes as well.\nThese are not of the Type T.\nSee issue #26440", "author": "kdsuneraavinash", "createdAt": "2020-10-27T09:11:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM4MjA1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUyODU0Ng==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26581#discussion_r512528546", "bodyText": "I have added a comment in 26440", "author": "SupunS", "createdAt": "2020-10-27T09:19:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM4MjA1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU3NDUwMw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26581#discussion_r512574503", "bodyText": "What if SeparatedNodeList was changed to accept the Node type, but does a runtime check to see if every even index is of Type T?", "author": "kdsuneraavinash", "createdAt": "2020-10-27T10:29:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM4MjA1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU5MzkzMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26581#discussion_r512593930", "bodyText": "oh okay, I think I misunderstood the problem.\n+1 for the change", "author": "SupunS", "createdAt": "2020-10-27T10:57:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM4MjA1Nw=="}], "type": "inlineReview"}, {"oid": "766541343f39652ab5028c88b7b5032999741e2b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/766541343f39652ab5028c88b7b5032999741e2b", "message": "Removed trailing space", "committedDate": "2020-10-27T09:20:27Z", "type": "commit"}, {"oid": "318483b606dbf9ab9561dd2c73780805874d011b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/318483b606dbf9ab9561dd2c73780805874d011b", "message": "Change OrderByClauseNode to a IntermediateClauseNode", "committedDate": "2020-10-27T09:46:50Z", "type": "commit"}, {"oid": "49dba2f9d27a646c7a9f01aebb4e3e774f63b9a8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/49dba2f9d27a646c7a9f01aebb4e3e774f63b9a8", "message": "Removed TemplateMemberNode class", "committedDate": "2020-10-27T10:06:54Z", "type": "commit"}]}