{"pr_number": 21320, "pr_title": "Fix Compilation error when function has a function typed param with only rest params", "pr_createdAt": "2020-02-27T08:14:05Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA3NDAzNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r385074036", "bodyText": "We normally don't mention the issue number on fixes. Shall we remove the issue number?", "author": "irshadnilam", "createdAt": "2020-02-27T11:40:19Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangPackageBuilder.java", "diffHunk": "@@ -574,6 +574,9 @@ void addFunctionType(DiagnosticPos pos, Set<Whitespace> ws, boolean paramsAvail,\n         if (paramsAvail) {\n             functionTypeNode.addWS(commaWsStack.pop());\n             functionTypeNode.params.addAll(this.varListStack.pop());\n+        } else if (restParamAvail) {\n+            // VarListStack pops when function typed param has only rest params, Fix for: 20919", "originalCommit": "d64fd3e833536be164bdf00a5a60dd21e7e08125", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA4ODMwMg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r385088302", "bodyText": "+1", "author": "dulvinw", "createdAt": "2020-02-27T12:12:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA3NDAzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ5NjE3Ng==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r385496176", "bodyText": "Okay. Thanks!", "author": "dulajdilshan", "createdAt": "2020-02-28T03:53:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA3NDAzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA3NDEyNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r385074125", "bodyText": "Line break", "author": "irshadnilam", "createdAt": "2020-02-27T11:40:31Z", "path": "tests/jballerina-unit-test/src/test/resources/test-src/functions/different-function-signatures.bal", "diffHunk": "@@ -177,3 +177,27 @@ type Person object {\n         return [intVal, val];\n     }\n };\n+\n+// ------------------- Test function signature which has a function typed param with only rest param ------------------\n+\n+function functionWithFunctionTypedParamWithOnlyRestParam(int[] x, function (int...) returns int bar) returns [int,int] {\n+    return [x[0], bar(x[0])] ;\n+}\n+\n+function sampleFunctionTypedParam(int... a) returns int{\n+    if (a.length() > 0) {\n+        return a[0];\n+    } else {\n+        return 0;\n+    }\n+}\n+\n+function testInvokeFunctionWithFunctionTypedParamWithOnlyRestParam1() returns [int,int]{\n+    int[] x = [4];\n+    return functionWithFunctionTypedParamWithOnlyRestParam(x, sampleFunctionTypedParam);\n+}\n+\n+function testInvokeFunctionWithFunctionTypedParamWithOnlyRestParam2() returns [int,int]{\n+    int[] x = [10, 20, 30];\n+    return functionWithFunctionTypedParamWithOnlyRestParam(x, sampleFunctionTypedParam);\n+}", "originalCommit": "d64fd3e833536be164bdf00a5a60dd21e7e08125", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU1NDA5Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r385554093", "bodyText": "Shall we shorten the function names?", "author": "hasithaa", "createdAt": "2020-02-28T08:01:22Z", "path": "tests/jballerina-unit-test/src/test/resources/test-src/functions/different-function-signatures.bal", "diffHunk": "@@ -177,3 +177,27 @@ type Person object {\n         return [intVal, val];\n     }\n };\n+\n+// ------------------- Test function signature which has a function typed param with only rest param ------------------\n+\n+function functionWithFunctionTypedParamWithOnlyRestParam(int[] x, function (int...) returns int bar) returns [int,int] {\n+    return [x[0], bar(x[0])] ;\n+}\n+\n+function sampleFunctionTypedParam(int... a) returns int{\n+    if (a.length() > 0) {\n+        return a[0];\n+    } else {\n+        return 0;\n+    }\n+}\n+\n+function testInvokeFunctionWithFunctionTypedParamWithOnlyRestParam1() returns [int,int]{", "originalCommit": "56d061ed6bcd5b6dc9b3b89acd45735a4203402f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5635a38ec1173c52a27e57dd54222f1f2cf07f35", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5635a38ec1173c52a27e57dd54222f1f2cf07f35", "message": "Fix some code practices issues", "committedDate": "2020-02-28T09:51:29Z", "type": "forcePushed"}, {"oid": "90529b291b355958c1040103b5ab3799ffb333ac", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/90529b291b355958c1040103b5ab3799ffb333ac", "message": "Fix some code practices issues", "committedDate": "2020-02-28T09:54:26Z", "type": "forcePushed"}, {"oid": "92c564970f91e9ffea457f6e43cae43953344e6b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/92c564970f91e9ffea457f6e43cae43953344e6b", "message": "Resolve param issue when function typed params with rest params are used", "committedDate": "2020-02-28T11:14:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzNzAyNA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r386337024", "bodyText": "Do we need this comment? Shall we maybe improve it to indicate popping out the empty list added to the var list stack if no non-rest params are available?", "author": "MaryamZi", "createdAt": "2020-03-02T11:24:22Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangPackageBuilder.java", "diffHunk": "@@ -574,6 +574,9 @@ void addFunctionType(DiagnosticPos pos, Set<Whitespace> ws, boolean paramsAvail,\n         if (paramsAvail) {\n             functionTypeNode.addWS(commaWsStack.pop());\n             functionTypeNode.params.addAll(this.varListStack.pop());\n+        } else if (restParamAvail) {\n+            // VarListStack pops when function typed param has only rest params", "originalCommit": "92c564970f91e9ffea457f6e43cae43953344e6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjgxNTk5Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r386815993", "bodyText": "Thanks. Resolved", "author": "dulajdilshan", "createdAt": "2020-03-03T06:09:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzNzAyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzODAwNA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r386338004", "bodyText": "Since recently, we've been trying to write the tests more in Ballerina. For example, \n  \n    \n      ballerina-lang/tests/jballerina-unit-test/src/test/resources/test-src/expressions/mappingconstructor/spread_op_field.bal\n    \n    \n         Line 31\n      in\n      133d901\n    \n    \n    \n    \n\n        \n          \n           public function testMapRefAsSpreadOp() { \n        \n    \n  \n\n.\nShall we try and do the same for the newly added tests?", "author": "MaryamZi", "createdAt": "2020-03-02T11:26:32Z", "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/functions/FunctionSignatureTest.java", "diffHunk": "@@ -444,4 +444,30 @@ public static ArrayValue mockedNativeFuncWithOptionalParams(long a, double b, St\n         tuple.add(4, (Object) e);\n         return tuple;\n     }\n+\n+    @Test(description = \"Test1: function signature which has a function typed param with only rest param\")", "originalCommit": "92c564970f91e9ffea457f6e43cae43953344e6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjkxMjI5Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r386912297", "bodyText": "Thanks. Changes are done", "author": "dulajdilshan", "createdAt": "2020-03-03T10:01:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzODAwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzODE2Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r386338162", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            function functionOfFunctionTypedParamWithRest(int[] x, function (int...) returns int bar) returns [int,int] {\n          \n          \n            \n            function functionOfFunctionTypedParamWithRest(int[] x, function (int...) returns int bar) returns [int, int] {", "author": "MaryamZi", "createdAt": "2020-03-02T11:26:50Z", "path": "tests/jballerina-unit-test/src/test/resources/test-src/functions/different-function-signatures.bal", "diffHunk": "@@ -177,3 +177,27 @@ type Person object {\n         return [intVal, val];\n     }\n };\n+\n+// ------------------- Test function signature which has a function typed param with only rest param ------------------\n+\n+function functionOfFunctionTypedParamWithRest(int[] x, function (int...) returns int bar) returns [int,int] {", "originalCommit": "92c564970f91e9ffea457f6e43cae43953344e6b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzODIxNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r386338215", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            function sampleFunctionTypedParam(int... a) returns int{\n          \n          \n            \n            function sampleFunctionTypedParam(int... a) returns int {", "author": "MaryamZi", "createdAt": "2020-03-02T11:26:59Z", "path": "tests/jballerina-unit-test/src/test/resources/test-src/functions/different-function-signatures.bal", "diffHunk": "@@ -177,3 +177,27 @@ type Person object {\n         return [intVal, val];\n     }\n };\n+\n+// ------------------- Test function signature which has a function typed param with only rest param ------------------\n+\n+function functionOfFunctionTypedParamWithRest(int[] x, function (int...) returns int bar) returns [int,int] {\n+    return [x[0], bar(x[0])] ;\n+}\n+\n+function sampleFunctionTypedParam(int... a) returns int{", "originalCommit": "92c564970f91e9ffea457f6e43cae43953344e6b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzODMyMg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r386338322", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            function testFunctionOfFunctionTypedParamWithRest1() returns [int,int]{\n          \n          \n            \n            function testFunctionOfFunctionTypedParamWithRest1() returns [int, int] {", "author": "MaryamZi", "createdAt": "2020-03-02T11:27:14Z", "path": "tests/jballerina-unit-test/src/test/resources/test-src/functions/different-function-signatures.bal", "diffHunk": "@@ -177,3 +177,27 @@ type Person object {\n         return [intVal, val];\n     }\n };\n+\n+// ------------------- Test function signature which has a function typed param with only rest param ------------------\n+\n+function functionOfFunctionTypedParamWithRest(int[] x, function (int...) returns int bar) returns [int,int] {\n+    return [x[0], bar(x[0])] ;\n+}\n+\n+function sampleFunctionTypedParam(int... a) returns int{\n+    if (a.length() > 0) {\n+        return a[0];\n+    } else {\n+        return 0;\n+    }\n+}\n+\n+function testFunctionOfFunctionTypedParamWithRest1() returns [int,int]{", "originalCommit": "92c564970f91e9ffea457f6e43cae43953344e6b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzODQxMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21320#discussion_r386338410", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            function testFunctionOfFunctionTypedParamWithRest2() returns [int,int]{\n          \n          \n            \n            function testFunctionOfFunctionTypedParamWithRest2() returns [int, int] {", "author": "MaryamZi", "createdAt": "2020-03-02T11:27:27Z", "path": "tests/jballerina-unit-test/src/test/resources/test-src/functions/different-function-signatures.bal", "diffHunk": "@@ -177,3 +177,27 @@ type Person object {\n         return [intVal, val];\n     }\n };\n+\n+// ------------------- Test function signature which has a function typed param with only rest param ------------------\n+\n+function functionOfFunctionTypedParamWithRest(int[] x, function (int...) returns int bar) returns [int,int] {\n+    return [x[0], bar(x[0])] ;\n+}\n+\n+function sampleFunctionTypedParam(int... a) returns int{\n+    if (a.length() > 0) {\n+        return a[0];\n+    } else {\n+        return 0;\n+    }\n+}\n+\n+function testFunctionOfFunctionTypedParamWithRest1() returns [int,int]{\n+    int[] x = [4];\n+    return functionOfFunctionTypedParamWithRest(x, sampleFunctionTypedParam);\n+}\n+\n+function testFunctionOfFunctionTypedParamWithRest2() returns [int,int]{", "originalCommit": "92c564970f91e9ffea457f6e43cae43953344e6b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cd1ba9cf87786fa5dba9eaefbd57c2eba8693021", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cd1ba9cf87786fa5dba9eaefbd57c2eba8693021", "message": "Resolve param issue when function typed params with rest params are used", "committedDate": "2020-03-03T10:35:19Z", "type": "commit"}, {"oid": "cd1ba9cf87786fa5dba9eaefbd57c2eba8693021", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cd1ba9cf87786fa5dba9eaefbd57c2eba8693021", "message": "Resolve param issue when function typed params with rest params are used", "committedDate": "2020-03-03T10:35:19Z", "type": "forcePushed"}]}