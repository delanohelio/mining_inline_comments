{"pr_number": 26308, "pr_title": "Add Distinct type support object constructor", "pr_createdAt": "2020-10-12T07:22:38Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/26308", "timeline": [{"oid": "c1eafb0a1995244514bdcfe1ff83cdc43e344253", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c1eafb0a1995244514bdcfe1ff83cdc43e344253", "message": "Support distinct type ids for object ctor", "committedDate": "2020-10-12T07:24:06Z", "type": "forcePushed"}, {"oid": "0e460523bd7f36f1044b71e166d28e82ab319305", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0e460523bd7f36f1044b71e166d28e82ab319305", "message": "Fix test case style", "committedDate": "2020-10-12T09:52:44Z", "type": "forcePushed"}, {"oid": "d0f12195cd60ab3927a6fd2659fa3348d5953420", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d0f12195cd60ab3927a6fd2659fa3348d5953420", "message": "Fix deprecation test case", "committedDate": "2020-10-13T04:53:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTEwMTUzNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26308#discussion_r509101536", "bodyText": "With this[1] change, I don't think we need this check and this flag\n[1] - https://github.com/ballerina-platform/ballerina-lang/pull/26098/files#diff-fa94fe90a875c08eaf806f89f6ceb7eec7205acaf75c88a41e3f7103abfa5a52L410", "author": "rdhananjaya", "createdAt": "2020-10-21T08:48:11Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolEnter.java", "diffHunk": "@@ -611,7 +611,7 @@ public void visit(BLangClassDefinition classDefinition) {\n             objectType = isReadOnly ? new BObjectType(tSymbol, Flags.READONLY) : new BObjectType(tSymbol);\n         }\n \n-        if (flags.contains(Flag.DISTINCT)) {\n+        if (flags.contains(Flag.DISTINCT) || classDefinition.induceTypeIds) {", "originalCommit": "d0f12195cd60ab3927a6fd2659fa3348d5953420", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY1NTI1MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26308#discussion_r509655251", "bodyText": "Need to merge the changes.", "author": "KRVPerera", "createdAt": "2020-10-21T20:15:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTEwMTUzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg1MzY0Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26308#discussion_r509853643", "bodyText": "Done", "author": "KRVPerera", "createdAt": "2020-10-22T03:11:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTEwMTUzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTEzMDQ4Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26308#discussion_r509130483", "bodyText": "class K {\n    int i = 0;\n    int j = 0;\n}\n\nclass J {\n    int i = 0;\n}\n\nDistinctFoo | DistinctFooA | K | J distinctObject = object {\n                                        int i;\n                                        function init() {\n                                            self.i = 20;\n                                        }\n                                    };\nThe above should not be allowed right, as the union is not definite.", "author": "rdhananjaya", "createdAt": "2020-10-21T09:29:58Z", "path": "tests/jballerina-unit-test/src/test/resources/test-src/expressions/object/object_constructor_expression.bal", "diffHunk": "@@ -125,6 +125,51 @@ function testObjectConstructorIncludedMethod() {\n     assertTrue(objWithIncludedMethod.n == 100);\n }\n \n+// test distinct id support\n+\n+distinct class DistinctFoo {\n+    int i = 0;\n+}\n+\n+distinct class DistinctFooA {\n+    int i = 0;\n+}\n+\n+distinct class DistinctFooB {\n+    int i = 0;\n+}\n+\n+function testObjectConstructorWithDistintExpectedType() {\n+    DistinctFoo distinctObject = object {\n+                                        int i;\n+                                        function init() {\n+                                            self.i = 20;\n+                                        }\n+                                    };\n+    assertValueEquality(20, distinctObject.i);\n+}\n+\n+function testObjectConstructorWithDistintTypeReference() {\n+    DistinctFooA distinctObject = object DistinctFooA {\n+                                            int i;\n+                                            function init() {\n+                                                self.i = 30;\n+                                            }\n+                                         };\n+    assertValueEquality(30, distinctObject.i);\n+}\n+\n+function testObjectConstructorWithDistintTypeReferenceVar() {\n+    var distinctObject = object DistinctFooB {\n+                                            int i;\n+                                            function init() {\n+                                                self.i = 25;\n+                                            }\n+                                         };\n+    DistinctFooB newDistinctRef = distinctObject;\n+    assertValueEquality(25, newDistinctRef.i);\n+}\n+", "originalCommit": "7c6b982da803bdb5e5da55d003ed310e32de0951", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTEzMzE2OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26308#discussion_r509133168", "bodyText": "Yes. Need to fix it.", "author": "KRVPerera", "createdAt": "2020-10-21T09:34:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTEzMDQ4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg1Mzk2NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26308#discussion_r509853965", "bodyText": "Fixed by 529f4a2", "author": "KRVPerera", "createdAt": "2020-10-22T03:12:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTEzMDQ4Mw=="}], "type": "inlineReview"}, {"oid": "d52fe16f61f03d3a5ced48a175b13a357c70780d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d52fe16f61f03d3a5ced48a175b13a357c70780d", "message": "Resolve conflicts with master", "committedDate": "2020-10-21T16:09:25Z", "type": "forcePushed"}, {"oid": "bd1788f393d17f66a87d9c13cbe09a4cadd9d023", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bd1788f393d17f66a87d9c13cbe09a4cadd9d023", "message": "Add distinct support for object type def", "committedDate": "2020-10-22T01:11:34Z", "type": "commit"}, {"oid": "f19be09e183b6afb13fc0fa35b8c7ca6c12efa25", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f19be09e183b6afb13fc0fa35b8c7ca6c12efa25", "message": "Fix failing test cases", "committedDate": "2020-10-22T01:11:34Z", "type": "commit"}, {"oid": "f8558da2d785f65c6af552474138262de5d160f7", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f8558da2d785f65c6af552474138262de5d160f7", "message": "Apply review suggestions", "committedDate": "2020-10-22T01:11:34Z", "type": "commit"}, {"oid": "6b5b0d80ea95df12ee23f992cef1444dcdc6d6a8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6b5b0d80ea95df12ee23f992cef1444dcdc6d6a8", "message": "Add parent type-ids to child classes\n\neven when the child is not specified as distinct", "committedDate": "2020-10-22T01:11:34Z", "type": "commit"}, {"oid": "87141b1da9865d1ebfe2f2a75b4d4cb6666bd5a5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/87141b1da9865d1ebfe2f2a75b4d4cb6666bd5a5", "message": "Refactor node transformer for BlangObjectCtor", "committedDate": "2020-10-22T01:12:28Z", "type": "commit"}, {"oid": "d6019be24ef66530ba42178272447962959c1117", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d6019be24ef66530ba42178272447962959c1117", "message": "Support distinct type ids for object ctor", "committedDate": "2020-10-22T01:12:29Z", "type": "commit"}, {"oid": "cb9a63758ff13ce40d6fb3e4aa254ce11a73c4c1", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cb9a63758ff13ce40d6fb3e4aa254ce11a73c4c1", "message": "Test distinct type ids for object ctor", "committedDate": "2020-10-22T01:12:29Z", "type": "commit"}, {"oid": "6c5994c51818fbe69da3e93aaa925cbf436d3d0f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6c5994c51818fbe69da3e93aaa925cbf436d3d0f", "message": "Refactor type ids for object ctor\n\nRemoved duplicate checks. Add negative test case.", "committedDate": "2020-10-22T01:12:29Z", "type": "commit"}, {"oid": "0ffa83b81882e190914dcca0c0230c9aadba3cf6", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0ffa83b81882e190914dcca0c0230c9aadba3cf6", "message": "Fix test case style", "committedDate": "2020-10-22T01:12:29Z", "type": "commit"}, {"oid": "064fd5215dff2c50bf97d590168fe849d68adfd3", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/064fd5215dff2c50bf97d590168fe849d68adfd3", "message": "Add relevant visitors for object ctor expression", "committedDate": "2020-10-22T01:12:29Z", "type": "commit"}, {"oid": "9bcce2f48fb4d9df4b5b19c48c39e7e6b1319d9a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9bcce2f48fb4d9df4b5b19c48c39e7e6b1319d9a", "message": "Test code analyzer on object ctor", "committedDate": "2020-10-22T01:12:29Z", "type": "commit"}, {"oid": "2517908caffabcd377f3d618e8e4be8cb0e8a214", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2517908caffabcd377f3d618e8e4be8cb0e8a214", "message": "Fix deprecation test case", "committedDate": "2020-10-22T01:12:29Z", "type": "commit"}, {"oid": "c911f29c9ce86dc6ff7501cf563ccfe2ce2d2fb0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c911f29c9ce86dc6ff7501cf563ccfe2ce2d2fb0", "message": "Resolve conflicts with master", "committedDate": "2020-10-22T01:13:54Z", "type": "commit"}, {"oid": "529f4a2f206330e309add582d1d4da2f283dc042", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/529f4a2f206330e309add582d1d4da2f283dc042", "message": "Fix definite object type check for unions in obj ctor", "committedDate": "2020-10-22T01:13:54Z", "type": "commit"}, {"oid": "78f870419c39f666264f574f75500582ae272c28", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/78f870419c39f666264f574f75500582ae272c28", "message": "Fix code style in ObjectConstructorTest.java", "committedDate": "2020-10-22T01:13:54Z", "type": "commit"}, {"oid": "78f870419c39f666264f574f75500582ae272c28", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/78f870419c39f666264f574f75500582ae272c28", "message": "Fix code style in ObjectConstructorTest.java", "committedDate": "2020-10-22T01:13:54Z", "type": "forcePushed"}, {"oid": "47ce7d083e4b31910caea5363ac00db84df48192", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/47ce7d083e4b31910caea5363ac00db84df48192", "message": "Merge remote-tracking branch 'origin/distinct_object_type_m2' into krv_add_type_id_for_object_ctor", "committedDate": "2020-10-22T01:18:57Z", "type": "commit"}, {"oid": "8d4070c0660fc3c450b088289bffdaece3d0e5d4", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8d4070c0660fc3c450b088289bffdaece3d0e5d4", "message": "Merge branch 'master' into cyclic_type_definition_done_right", "committedDate": "2020-10-22T01:22:52Z", "type": "commit"}, {"oid": "8dce80e73a1bd0719e0d3239a476f9a3e6dfbf94", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8dce80e73a1bd0719e0d3239a476f9a3e6dfbf94", "message": "Fix test case ObjectConstructorTest.java", "committedDate": "2020-10-22T01:36:16Z", "type": "commit"}, {"oid": "3dca05233cbd6b9b7edee78854f54253735bf0d0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3dca05233cbd6b9b7edee78854f54253735bf0d0", "message": "Remove `induceTypeIds` from BLangClassDefinition", "committedDate": "2020-10-22T02:24:25Z", "type": "commit"}, {"oid": "e85f92152384c61750c9daa919a4df18df821744", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e85f92152384c61750c9daa919a4df18df821744", "message": "Fix IsolatedObjectTest for object constructor", "committedDate": "2020-10-22T03:10:33Z", "type": "commit"}, {"oid": "e85f92152384c61750c9daa919a4df18df821744", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e85f92152384c61750c9daa919a4df18df821744", "message": "Fix IsolatedObjectTest for object constructor", "committedDate": "2020-10-22T03:10:33Z", "type": "forcePushed"}, {"oid": "e380dee4b10cea60407391d13b11e1bf81f9ddae", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e380dee4b10cea60407391d13b11e1bf81f9ddae", "message": "Merge branch 'master' into krv_add_type_id_for_object_ctor", "committedDate": "2020-11-03T10:39:49Z", "type": "commit"}]}