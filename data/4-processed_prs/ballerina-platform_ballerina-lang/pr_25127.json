{"pr_number": 25127, "pr_title": "Fix failing workerWithFutureTest1", "pr_createdAt": "2020-08-04T09:53:21Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/25127", "timeline": [{"oid": "ba5f3514e7ff6772e8632648d22cfe209afc9a18", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ba5f3514e7ff6772e8632648d22cfe209afc9a18", "message": "Fix failing workerWithFutureTest1\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23625", "committedDate": "2020-08-04T09:52:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk1Nzg0MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25127#discussion_r464957840", "bodyText": "why we have to add a sleep here? do we know the root cause of this test failure ?", "author": "Kishanthan", "createdAt": "2020-08-04T10:36:00Z", "path": "tests/jballerina-unit-test/src/test/resources/test-src/workers/workers.bal", "diffHunk": "@@ -543,6 +543,7 @@ function waitFor() {\n }\n \n function add2(int i, int j) returns int {\n+   runtime:sleep(1000);", "originalCommit": "ba5f3514e7ff6772e8632648d22cfe209afc9a18", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk2ODM1Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25127#discussion_r464968357", "bodyText": "It is failing because all three code blocks are running parallely. At one point w2 can start and go to sleep then the future can start and run to completion in 1s and then w2 can resume and the result is returned before w1 can run. In which case test fails.\nAdding a sleep will delay the future also so w1 will for sure run to completion before w2 and the add2 method.\nI think the test is to test the scenario of First cancel the future and then wait . So this change will make sure the orders are correct. cancel the future and then wait\nhttps://github.com/ballerina-platform/ballerina-lang/pull/25127/files#diff-e545514cc5d1ac3d32ca50da10adc6d0R476-R493", "author": "riyafa", "createdAt": "2020-08-04T10:58:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk1Nzg0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE3MTc2Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25127#discussion_r466171767", "bodyText": "after this sleep you have introduced, can you try and run the this particular test in a loop and verify?", "author": "Kishanthan", "createdAt": "2020-08-06T06:23:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk1Nzg0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE3MjEzOA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25127#discussion_r466172138", "bodyText": "I have verified it by running it a 1000 times", "author": "riyafa", "createdAt": "2020-08-06T06:24:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk1Nzg0MA=="}], "type": "inlineReview"}]}