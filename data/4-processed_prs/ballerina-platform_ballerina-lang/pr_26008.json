{"pr_number": 26008, "pr_title": "[Formatter] Fix several formatting issues", "pr_createdAt": "2020-09-22T10:50:22Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/26008", "timeline": [{"oid": "f2e1d0c522920ac5c1ea14e05e157103f567e0d2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f2e1d0c522920ac5c1ea14e05e157103f567e0d2", "message": "Fix the union type issue", "committedDate": "2020-09-22T07:34:05Z", "type": "commit"}, {"oid": "eeb61d79fba4eee6e90fe825cdfa40fd8d5ab6d6", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/eeb61d79fba4eee6e90fe825cdfa40fd8d5ab6d6", "message": "Fix the issue in the while statement", "committedDate": "2020-09-22T07:44:54Z", "type": "commit"}, {"oid": "23036d6647f656a4b5381b6d71768b6c5eac4b76", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/23036d6647f656a4b5381b6d71768b6c5eac4b76", "message": "Disable the if else issue", "committedDate": "2020-09-22T08:10:19Z", "type": "commit"}, {"oid": "ab81d6c51e03adfb924ffb55aeb8944063d41b81", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ab81d6c51e03adfb924ffb55aeb8944063d41b81", "message": "Fix issues in method calls and panic statements", "committedDate": "2020-09-22T08:24:08Z", "type": "commit"}, {"oid": "b67da2ef5eabd2b8cb0b7efd5f8a5122a92032a6", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b67da2ef5eabd2b8cb0b7efd5f8a5122a92032a6", "message": "Fix the new line endings issue", "committedDate": "2020-09-22T08:34:03Z", "type": "commit"}, {"oid": "fc0b18800f5e254c2131ef5a31c2a617b2a9d42d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fc0b18800f5e254c2131ef5a31c2a617b2a9d42d", "message": "Add test cases for query expressions", "committedDate": "2020-09-22T10:02:23Z", "type": "commit"}, {"oid": "0ad35f4e787106fbf3e3448d6669a827825eba21", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0ad35f4e787106fbf3e3448d6669a827825eba21", "message": "Disable the query expression formatting", "committedDate": "2020-09-22T10:41:33Z", "type": "commit"}, {"oid": "f5282dd4c7522577352827c93021c322389f81df", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f5282dd4c7522577352827c93021c322389f81df", "message": "Fix the streaming node", "committedDate": "2020-09-22T10:44:30Z", "type": "commit"}, {"oid": "5f0b843031c3e28fbb4fc2dd14b591b9d2a8ee44", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5f0b843031c3e28fbb4fc2dd14b591b9d2a8ee44", "message": "Fix formatter issue for type-descriptors with parenthesis", "committedDate": "2020-09-22T10:53:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY0OTE1Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26008#discussion_r492649153", "bodyText": "Shall we get rid of these comments?", "author": "sanjana", "createdAt": "2020-09-22T11:05:58Z", "path": "misc/formatter/modules/formatter-core/src/main/java/org/ballerinalang/formatter/core/FormattingTreeModifier.java", "diffHunk": "@@ -2996,26 +3005,26 @@ public SelectClauseNode transform(SelectClauseNode selectClauseNode) {\n \n     @Override\n     public QueryExpressionNode transform(QueryExpressionNode queryExpressionNode) {\n-        if (!isInLineRange(queryExpressionNode, lineRange)) {\n+//        if (!isInLineRange(queryExpressionNode, lineRange)) {\n             return queryExpressionNode;\n-        }\n-        QueryConstructTypeNode queryConstructType =\n-                this.modifyNode(queryExpressionNode.queryConstructType().orElse(null));\n-        QueryPipelineNode queryPipeline = this.modifyNode(queryExpressionNode.queryPipeline());\n-        SelectClauseNode selectClause = this.modifyNode(queryExpressionNode.selectClause());\n-        OnConflictClauseNode onConflictClause = this.modifyNode(queryExpressionNode.onConflictClause().orElse(null));\n-        if (queryConstructType != null) {\n-            queryExpressionNode = queryExpressionNode.modify()\n-                    .withQueryConstructType(queryConstructType).apply();\n-        }\n-        if (onConflictClause != null) {\n-            queryExpressionNode = queryExpressionNode.modify()\n-                    .withOnConflictClause(onConflictClause).apply();\n-        }\n-        return queryExpressionNode.modify()\n-                .withQueryPipeline(queryPipeline)\n-                .withSelectClause(selectClause)\n-                .apply();\n+//        }\n+//        QueryConstructTypeNode queryConstructType =\n+//                this.modifyNode(queryExpressionNode.queryConstructType().orElse(null));\n+//        QueryPipelineNode queryPipeline = this.modifyNode(queryExpressionNode.queryPipeline());\n+//        SelectClauseNode selectClause = this.modifyNode(queryExpressionNode.selectClause());\n+//        OnConflictClauseNode onConflictClause = this.modifyNode(queryExpressionNode.onConflictClause().orElse(null));\n+//        if (queryConstructType != null) {\n+//            queryExpressionNode = queryExpressionNode.modify()\n+//                    .withQueryConstructType(queryConstructType).apply();\n+//        }\n+//        if (onConflictClause != null) {\n+//            queryExpressionNode = queryExpressionNode.modify()\n+//                    .withOnConflictClause(onConflictClause).apply();\n+//        }\n+//        return queryExpressionNode.modify()\n+//                .withQueryPipeline(queryPipeline)\n+//                .withSelectClause(selectClause)\n+//                .apply();", "originalCommit": "5f0b843031c3e28fbb4fc2dd14b591b9d2a8ee44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY1MzQxOA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26008#discussion_r492653418", "bodyText": "I think it's okay to leave it there since we have to enable it again anyway.", "author": "IrushiL", "createdAt": "2020-09-22T11:15:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY0OTE1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY1OTMwNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26008#discussion_r492659306", "bodyText": "This will create an impact when formatting the following type of nested-if code.\npublic function foo() {\n    if (true) {\n        \n        if (1 < 2) {\n            int x = 2;\n        }\n    } else {\n        int y = 0;\n        return i;\n    }\n}", "author": "sanjana", "createdAt": "2020-09-22T11:27:04Z", "path": "misc/formatter/modules/formatter-core/src/main/java/org/ballerinalang/formatter/core/FormattingTreeModifier.java", "diffHunk": "@@ -912,7 +914,7 @@ public SimpleNameReferenceNode transform(SimpleNameReferenceNode simpleNameRefer\n \n     @Override\n     public IfElseStatementNode transform(IfElseStatementNode ifElseStatementNode) {\n-        if (!isInLineRange(ifElseStatementNode, lineRange)) {\n+        if (!isInLineRange(ifElseStatementNode, lineRange) || !nestedIfBlock(ifElseStatementNode).isEmpty()) {", "originalCommit": "5f0b843031c3e28fbb4fc2dd14b591b9d2a8ee44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY2MjI1NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26008#discussion_r492662254", "bodyText": "Yeah, that is added to disable the formatting of nested if blocks, since this fix requires some time. The intention is to leave the nested if block as it is now. The following issue is there to track the fix.\n#25999", "author": "IrushiL", "createdAt": "2020-09-22T11:32:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY1OTMwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjczOTczNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26008#discussion_r492739736", "bodyText": "Since the formatting of nested if blocks are disabled for now if there are formatting errors in the above code snippet, it will not get formatted.\nBut if the above code is formatted as it is, then the output will also be the same.", "author": "IrushiL", "createdAt": "2020-09-22T13:37:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY1OTMwNg=="}], "type": "inlineReview"}, {"oid": "7f6ed5255fd32467abfbb94e0be373bfb6b8fefa", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7f6ed5255fd32467abfbb94e0be373bfb6b8fefa", "message": "Add a new if else test case", "committedDate": "2020-09-22T11:39:18Z", "type": "commit"}, {"oid": "fb979f22861749933fb75bea27b0a8c9241852aa", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fb979f22861749933fb75bea27b0a8c9241852aa", "message": "Fix the issue with leading comments", "committedDate": "2020-09-22T11:40:51Z", "type": "commit"}, {"oid": "b3d4f4eac4c8264876afd307c758e66c963244c1", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b3d4f4eac4c8264876afd307c758e66c963244c1", "message": "Fix the preserving of comments", "committedDate": "2020-09-22T13:30:01Z", "type": "commit"}]}