{"pr_number": 24528, "pr_title": "Mapping-match-pattern support to match statement", "pr_createdAt": "2020-07-01T12:02:35Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/24528", "timeline": [{"oid": "fa2371e963c6e76180b107ee2862489525516325", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fa2371e963c6e76180b107ee2862489525516325", "message": "Methods for mapping match pattern", "committedDate": "2020-06-30T07:40:42Z", "type": "commit"}, {"oid": "7a7e7ac41688328a7f2c0b133f25d04222327ba1", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7a7e7ac41688328a7f2c0b133f25d04222327ba1", "message": "Mapping-match-pattern support to match statement.", "committedDate": "2020-07-01T11:10:14Z", "type": "commit"}, {"oid": "b4b8f77ed4a41a5cf98152e9877980a2ed9dae03", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b4b8f77ed4a41a5cf98152e9877980a2ed9dae03", "message": "Added missing files.", "committedDate": "2020-07-01T11:16:07Z", "type": "commit"}, {"oid": "8b6cda768cba21afeb10a5f38498b4ac1746a564", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8b6cda768cba21afeb10a5f38498b4ac1746a564", "message": "Test cases for adding mapping-match-pattern support to match statement.", "committedDate": "2020-07-01T11:58:22Z", "type": "commit"}, {"oid": "11b0f534a8b7f50385fcfd14e6187127c63a07ea", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/11b0f534a8b7f50385fcfd14e6187127c63a07ea", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into mapping-match-pattern", "committedDate": "2020-07-01T11:59:08Z", "type": "commit"}, {"oid": "d5ca38ff24d95c4404de7229287331f9e9ea88e9", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d5ca38ff24d95c4404de7229287331f9e9ea88e9", "message": "Add missing assert file.", "committedDate": "2020-07-01T12:00:17Z", "type": "commit"}, {"oid": "ec1e73262d443213eaa5273d5ce6915479820605", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ec1e73262d443213eaa5273d5ce6915479820605", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into mapping-match-pattern", "committedDate": "2020-07-02T04:25:25Z", "type": "commit"}, {"oid": "7d1996fb5a8f7a74a6afa976ccbefa357a20a293", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7d1996fb5a8f7a74a6afa976ccbefa357a20a293", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into mapping-match-pattern", "committedDate": "2020-07-03T03:48:44Z", "type": "commit"}, {"oid": "496faa23b5c1763bfb461985a2d3d3d464d06e84", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/496faa23b5c1763bfb461985a2d3d3d464d06e84", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into mapping-match-pattern", "committedDate": "2020-07-03T06:42:23Z", "type": "commit"}, {"oid": "9f15d11fac313b1893db327f10f2155ab1a94b85", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9f15d11fac313b1893db327f10f2155ab1a94b85", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into mapping-match-pattern", "committedDate": "2020-07-03T11:18:41Z", "type": "commit"}, {"oid": "ed1854b146b0bf6c55131d2098fcc5ec740b5047", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ed1854b146b0bf6c55131d2098fcc5ec740b5047", "message": "Change assert file.", "committedDate": "2020-07-05T11:18:42Z", "type": "commit"}, {"oid": "feb756f9cbc10390a30cb812cd4abed8121e76de", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/feb756f9cbc10390a30cb812cd4abed8121e76de", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into mapping-match-pattern", "committedDate": "2020-07-05T12:33:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM2ODE4MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24528#discussion_r449368181", "bodyText": "shall we go with fieldMatchPatterns to be consistent with the spec?", "author": "SupunS", "createdAt": "2020-07-03T04:21:45Z", "path": "compiler/ballerina-treegen/src/main/resources/syntax_tree_descriptor.json", "diffHunk": "@@ -3888,6 +3888,50 @@\n                     \"type\": \"SimpleNameReferenceNode\"\n                 }\n             ]\n+        },\n+        {\n+            \"name\": \"MappingMatchPatternNode\",\n+            \"base\": \"Node\",\n+            \"kind\": \"MAPPING_MATCH_PATTERN\",\n+            \"attributes\": [\n+                {\n+                    \"name\": \"openBraceToken\",\n+                    \"type\": \"Token\"\n+                },\n+                {\n+                    \"name\": \"mappingMatchPatternListNode\",", "originalCommit": "7d1996fb5a8f7a74a6afa976ccbefa357a20a293", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDEyNjIwOA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24528#discussion_r450126208", "bodyText": "changed", "author": "rdulmina", "createdAt": "2020-07-06T10:20:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM2ODE4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM4NzkxMw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24528#discussion_r449387913", "bodyText": "should the type be FieldMatchPatternNode?", "author": "SupunS", "createdAt": "2020-07-03T05:50:20Z", "path": "compiler/ballerina-treegen/src/main/resources/syntax_tree_descriptor.json", "diffHunk": "@@ -3888,6 +3888,50 @@\n                     \"type\": \"SimpleNameReferenceNode\"\n                 }\n             ]\n+        },\n+        {\n+            \"name\": \"MappingMatchPatternNode\",\n+            \"base\": \"Node\",\n+            \"kind\": \"MAPPING_MATCH_PATTERN\",\n+            \"attributes\": [\n+                {\n+                    \"name\": \"openBraceToken\",\n+                    \"type\": \"Token\"\n+                },\n+                {\n+                    \"name\": \"mappingMatchPatternListNode\",\n+                    \"type\": \"Node\",", "originalCommit": "7d1996fb5a8f7a74a6afa976ccbefa357a20a293", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDEyNjI1OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24528#discussion_r450126258", "bodyText": "changed", "author": "rdulmina", "createdAt": "2020-07-06T10:20:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM4NzkxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk2MzkxNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24528#discussion_r449963916", "bodyText": "add <br/> for line breaks.. otherwise the IDE preview will look cluttered.", "author": "SupunS", "createdAt": "2020-07-06T03:14:24Z", "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -12619,6 +12623,103 @@ private STNode parseListMatchPatternMemberRhs(SyntaxKind nextTokenKind) {\n         }\n     }\n \n+    /**\n+     * Parse mapping match pattern.\n+     * <p>\n+     *     mapping-match-pattern := { field-match-patterns }\n+     *     field-match-patterns :=", "originalCommit": "feb756f9cbc10390a30cb812cd4abed8121e76de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDEyNjMxMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24528#discussion_r450126310", "bodyText": "changed", "author": "rdulmina", "createdAt": "2020-07-06T10:20:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk2MzkxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk2NTExMQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24528#discussion_r449965111", "bodyText": "I think we should first parse the match-pattern (it could be a field-match-pattern or rest-match-pattern), and then check whether its a rest-pattern or not.\nReason is, if theres a junk token before ellipsis, above condition fail and it will try to parse it as a field-match-pattern.", "author": "SupunS", "createdAt": "2020-07-06T03:21:20Z", "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -12619,6 +12623,103 @@ private STNode parseListMatchPatternMemberRhs(SyntaxKind nextTokenKind) {\n         }\n     }\n \n+    /**\n+     * Parse mapping match pattern.\n+     * <p>\n+     *     mapping-match-pattern := { field-match-patterns }\n+     *     field-match-patterns :=\n+     *    field-match-pattern (, field-match-pattern)* [, rest-match-pattern]\n+     *    | [ rest-match-pattern ]\n+     *      field-match-pattern := field-name : match-pattern\n+     *      rest-match-pattern := ... var variable-name\n+     * </p>\n+     *\n+     * @return Parsed Node.\n+     */\n+    private STNode parseMappingMatchPattern() {\n+        startContext(ParserRuleContext.MAPPING_MATCH_PATTERN);\n+        STNode openBraceToken = parseOpenBrace();\n+        List<STNode> mappingMatchPatternList = new ArrayList<>();\n+        STNode restMatchPattern = null;\n+\n+        while (!isEndOfMappingMatchPattern()) {\n+            STToken nextToken = peek();\n+            if (nextToken.kind == SyntaxKind.ELLIPSIS_TOKEN) {\n+                restMatchPattern = parseRestMatchPattern();", "originalCommit": "feb756f9cbc10390a30cb812cd4abed8121e76de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk2NTMzMg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24528#discussion_r449965332", "bodyText": "Also, once the rest pattern is found, we should continue to parse match-patterns (do not break the loop), but add them as invalid nodes.", "author": "SupunS", "createdAt": "2020-07-06T03:22:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk2NTExMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk4NjAwMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24528#discussion_r449986000", "bodyText": "Thanks for mentioning it. I will change.", "author": "rdulmina", "createdAt": "2020-07-06T05:08:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk2NTExMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDEyNjU0Ng==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24528#discussion_r450126546", "bodyText": "changed", "author": "rdulmina", "createdAt": "2020-07-06T10:20:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk2NTExMQ=="}], "type": "inlineReview"}, {"oid": "364a0815e943cd1a89b178c7dacb2f9adcf8b627", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/364a0815e943cd1a89b178c7dacb2f9adcf8b627", "message": "Commented two language server test cases.\nCommented completionWithinInvocationArgs7 and completionWithinInvocationArgs6 test cases.", "committedDate": "2020-07-06T04:57:32Z", "type": "commit"}, {"oid": "ae3f3236215e7f14aa694fccffc893ed032e91f9", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ae3f3236215e7f14aa694fccffc893ed032e91f9", "message": "Refactor code to align with the specs.", "committedDate": "2020-07-06T05:12:32Z", "type": "commit"}, {"oid": "719e8ee9b5032498832145d4c995d7452b7f865b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/719e8ee9b5032498832145d4c995d7452b7f865b", "message": "Add invalid node support to field match pattern.\nIf there are more field match patterns after rest match pattern, those are added as invalid minutiae to the rest match pattern node.", "committedDate": "2020-07-06T10:19:05Z", "type": "commit"}]}