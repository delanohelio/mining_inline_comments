{"pr_number": 22944, "pr_title": "Improve batching in metrics and traces published", "pr_createdAt": "2020-04-28T13:27:58Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/22944", "timeline": [{"oid": "3dfeadee34ca64d583c8ce0a86ecda4801cb4569", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3dfeadee34ca64d583c8ce0a86ecda4801cb4569", "message": "Add support for batching gRPC publish calls based on gRPC server frame limit\n\n# When the total batch size exceeds the max frame size limit imposed by Choreo Cloud, the data needs to be separated into batched. Otherwise Choreo cloud will refuse to accept the payload. Moreover, if a single span or a metric is larger than the frame size limit (this is highly imporbable) it will be dropped as it cannot be published.", "committedDate": "2020-04-28T13:32:38Z", "type": "forcePushed"}, {"oid": "4ebd4f552185ccd5cfdf3500027ccd22521ed29f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4ebd4f552185ccd5cfdf3500027ccd22521ed29f", "message": "Add support for batching gRPC publish calls based on gRPC server frame limit", "committedDate": "2020-04-28T14:20:03Z", "type": "forcePushed"}, {"oid": "8960bf4beb8098f9a67d3b19e7644ac544e05e9a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8960bf4beb8098f9a67d3b19e7644ac544e05e9a", "message": "Update Timer to ScheduledThreadPoolExecutor for publishing metrics", "committedDate": "2020-04-29T07:04:01Z", "type": "commit"}, {"oid": "34cd0d75a9ffeaa63b3346c76823fd0995680e91", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/34cd0d75a9ffeaa63b3346c76823fd0995680e91", "message": "Update Timer to ScheduledThreadPoolExecutor for publishing trace spans", "committedDate": "2020-04-29T07:09:17Z", "type": "commit"}, {"oid": "fbd10d15c56fc558805a94a131214e7b568c7589", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fbd10d15c56fc558805a94a131214e7b568c7589", "message": "Add support for batching gRPC publish calls based on gRPC server frame limit", "committedDate": "2020-04-29T07:09:38Z", "type": "commit"}, {"oid": "fbd10d15c56fc558805a94a131214e7b568c7589", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fbd10d15c56fc558805a94a131214e7b568c7589", "message": "Add support for batching gRPC publish calls based on gRPC server frame limit", "committedDate": "2020-04-29T07:09:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEyMzk2NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22944#discussion_r417123964", "bodyText": "PUBLISH_INTERVAL_SECS ?", "author": "afkham", "createdAt": "2020-04-29T07:42:05Z", "path": "misc/tracing-extensions/modules/ballerina-choreo-extension/src/main/java/org/ballerinalang/observe/trace/extension/choreo/ChoreoJaegerReporter.java", "diffHunk": "@@ -33,58 +33,64 @@\n import java.util.List;\n import java.util.Map;\n import java.util.Objects;\n-import java.util.Timer;\n-import java.util.TimerTask;\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledThreadPoolExecutor;\n+import java.util.concurrent.TimeUnit;\n \n /**\n  * Custom Jaeger tracing reporter for publishing stats to Choreo cloud.\n  */\n public class ChoreoJaegerReporter implements Reporter, AutoCloseable {\n-    private static final int PUBLISH_INTERVAL = 10 * 1000;\n+    private static final int PUBLISH_INTERVAL = 10;", "originalCommit": "fbd10d15c56fc558805a94a131214e7b568c7589", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEyOTIxOQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22944#discussion_r417129219", "bodyText": "Fixed with ac15181", "author": "nadundesilva", "createdAt": "2020-04-29T07:51:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEyMzk2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEyNDQwMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22944#discussion_r417124400", "bodyText": "PUBLISH_INTERVAL_SECS ?", "author": "afkham", "createdAt": "2020-04-29T07:42:52Z", "path": "misc/tracing-extensions/modules/ballerina-choreo-extension/src/main/java/org/ballerinalang/observe/trace/extension/choreo/MetricsReporterExtension.java", "diffHunk": "@@ -50,7 +52,7 @@\n public class MetricsReporterExtension implements MetricReporter, AutoCloseable {\n     private static final Logger LOGGER = LogFactory.getLogger();\n \n-    private static final int PUBLISH_INTERVAL = 10 * 1000;\n+    private static final int PUBLISH_INTERVAL = 10;", "originalCommit": "fbd10d15c56fc558805a94a131214e7b568c7589", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEyOTI1Ng==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22944#discussion_r417129256", "bodyText": "Fixed with ac15181", "author": "nadundesilva", "createdAt": "2020-04-29T07:51:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEyNDQwMA=="}], "type": "inlineReview"}, {"oid": "ac151819d51ec0c027341a2a2beb85544f7853ef", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ac151819d51ec0c027341a2a2beb85544f7853ef", "message": "Add code review suggestions", "committedDate": "2020-04-29T09:41:22Z", "type": "forcePushed"}, {"oid": "0a4136febaccef0f1e5aebabfca1f57400e8a4b6", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0a4136febaccef0f1e5aebabfca1f57400e8a4b6", "message": "Add code review suggestions", "committedDate": "2020-04-29T11:27:30Z", "type": "commit"}, {"oid": "0a4136febaccef0f1e5aebabfca1f57400e8a4b6", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0a4136febaccef0f1e5aebabfca1f57400e8a4b6", "message": "Add code review suggestions", "committedDate": "2020-04-29T11:27:30Z", "type": "forcePushed"}]}