{"pr_number": 22447, "pr_title": "Remove `isFieldAnalyseRequired` from code", "pr_createdAt": "2020-04-03T07:42:28Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/22447", "timeline": [{"oid": "afe16377caf1abeced1675ba5078ffdae4619f9b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/afe16377caf1abeced1675ba5078ffdae4619f9b", "message": "Remove `isFieldAnalyseRequired` from code\n\nThis variable is preventing code analysys on an anonymous\nrecords/objects. No usefulness of the variable in the current code.\nVariable is removed by this commit.\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>", "committedDate": "2020-04-03T07:51:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzIxNjAzNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22447#discussion_r403216037", "bodyText": "Why have we commented these (here and L2298) out instead of removing?", "author": "MaryamZi", "createdAt": "2020-04-03T18:18:25Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -2285,18 +2285,20 @@ public void visit(BLangIntRangeExpression intRangeExpression) {\n     public void visit(BLangRecordTypeNode recordTypeNode) {\n \n         SymbolEnv recordEnv = SymbolEnv.createTypeEnv(recordTypeNode, recordTypeNode.symbol.scope, env);\n-        if (recordTypeNode.isFieldAnalyseRequired) {\n-            recordTypeNode.fields.forEach(field -> analyzeNode(field, recordEnv));\n-        }\n+//        if (recordTypeNode.isFieldAnalyseRequired) {", "originalCommit": "afe16377caf1abeced1675ba5078ffdae4619f9b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQzNjM5Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22447#discussion_r403436393", "bodyText": "removed 3e4ef54", "author": "KRVPerera", "createdAt": "2020-04-04T07:13:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzIxNjAzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzIxNjQyMg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22447#discussion_r403216422", "bodyText": "Shall we replace this and below with foreach loops?", "author": "MaryamZi", "createdAt": "2020-04-03T18:18:56Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -2285,18 +2285,20 @@ public void visit(BLangIntRangeExpression intRangeExpression) {\n     public void visit(BLangRecordTypeNode recordTypeNode) {\n \n         SymbolEnv recordEnv = SymbolEnv.createTypeEnv(recordTypeNode, recordTypeNode.symbol.scope, env);\n-        if (recordTypeNode.isFieldAnalyseRequired) {\n-            recordTypeNode.fields.forEach(field -> analyzeNode(field, recordEnv));\n-        }\n+//        if (recordTypeNode.isFieldAnalyseRequired) {\n+//            recordTypeNode.fields.forEach(field -> analyzeNode(field, recordEnv));\n+//        }\n+        recordTypeNode.fields.forEach(field -> analyzeNode(field, recordEnv));", "originalCommit": "afe16377caf1abeced1675ba5078ffdae4619f9b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQzOTE2Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22447#discussion_r403439167", "bodyText": "Fixed by : 3e8d2fb", "author": "KRVPerera", "createdAt": "2020-04-04T07:45:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzIxNjQyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg1MzcyNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22447#discussion_r403853725", "bodyText": "Can we use simple for-each loops instead.\n            for (BLangSimpleVariable field : recordTypeNode.fields) {\n                analyzeNode(field, recordEnv);\n            }", "author": "MaryamZi", "createdAt": "2020-04-06T06:24:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzIxNjQyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3ODA1MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22447#discussion_r404078051", "bodyText": "done : a043994", "author": "KRVPerera", "createdAt": "2020-04-06T13:11:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzIxNjQyMg=="}], "type": "inlineReview"}, {"oid": "e43f10e8a097742ff9f2116aefb1e653e48a5487", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e43f10e8a097742ff9f2116aefb1e653e48a5487", "message": "Remove `isFieldAnalyseRequired` from code\n\nThis variable is preventing code analysys on an anonymous\nrecords/objects. No usefulness of the variable in the current code.\nVariable is removed by this commit.\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>", "committedDate": "2020-04-04T07:10:06Z", "type": "commit"}, {"oid": "3e4ef54c4c19bec4c95f3dcb809884daaa2b44d8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3e4ef54c4c19bec4c95f3dcb809884daaa2b44d8", "message": "Remove commented lines in CodeAnalyzer.java\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>", "committedDate": "2020-04-04T07:10:06Z", "type": "commit"}, {"oid": "e8ca71620e9bc63092cdf42e8775ca578855a3be", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e8ca71620e9bc63092cdf42e8775ca578855a3be", "message": "Replace java stream in CodeAnalyzer\n\nJava stream based code in CodeAnalyzer.java BLangObjectTypeNode visitor\nis replaced by java vanilla for each loop.\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>", "committedDate": "2020-04-04T07:11:49Z", "type": "forcePushed"}, {"oid": "3e4ef54c4c19bec4c95f3dcb809884daaa2b44d8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3e4ef54c4c19bec4c95f3dcb809884daaa2b44d8", "message": "Remove commented lines in CodeAnalyzer.java\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>", "committedDate": "2020-04-04T07:10:06Z", "type": "forcePushed"}, {"oid": "3e8d2fb2111b4b9ee18eaafa7fdce45eda0df10f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3e8d2fb2111b4b9ee18eaafa7fdce45eda0df10f", "message": "Replace a java stream in CodeAnalyzer with foreach\n\nJava stream based code in CodeAnalyzer.java BLangObjectTypeNode visitor\nis replaced by java for each loop.\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>", "committedDate": "2020-04-04T07:44:40Z", "type": "commit"}, {"oid": "1829e492a3a1398a5a7821b2f4a42e9b568bf76c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1829e492a3a1398a5a7821b2f4a42e9b568bf76c", "message": "Remove unused imports from CodeAnalyzer.java\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>", "committedDate": "2020-04-05T09:24:17Z", "type": "commit"}, {"oid": "a04399453de1bfea94fff526dc43c541815c2dd1", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a04399453de1bfea94fff526dc43c541815c2dd1", "message": "Refactor replace forEach with simple for loop\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>", "committedDate": "2020-04-06T11:05:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIzODM4MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22447#discussion_r405238380", "bodyText": "Shall we use a meaningful name instead of o?", "author": "MaryamZi", "createdAt": "2020-04-08T03:31:45Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -2326,24 +2324,29 @@ public void visit(BLangIntRangeExpression intRangeExpression) {\n     public void visit(BLangRecordTypeNode recordTypeNode) {\n \n         SymbolEnv recordEnv = SymbolEnv.createTypeEnv(recordTypeNode, recordTypeNode.symbol.scope, env);\n-        if (recordTypeNode.isFieldAnalyseRequired) {\n-            recordTypeNode.fields.forEach(field -> analyzeNode(field, recordEnv));\n+        for (BLangSimpleVariable field : recordTypeNode.fields) {\n+            analyzeNode(field, recordEnv);\n         }\n     }\n \n     @Override\n     public void visit(BLangObjectTypeNode objectTypeNode) {\n \n         SymbolEnv objectEnv = SymbolEnv.createTypeEnv(objectTypeNode, objectTypeNode.symbol.scope, env);\n-        if (objectTypeNode.isFieldAnalyseRequired) {\n-            objectTypeNode.fields.forEach(field -> analyzeNode(field, objectEnv));\n+        for (BLangSimpleVariable field : objectTypeNode.fields) {\n+            analyzeNode(field, objectEnv);\n+        }\n+\n+        List<BLangFunction> bLangFunctionList = new ArrayList<>(objectTypeNode.functions);\n+        if (objectTypeNode.initFunction != null) {\n+            bLangFunctionList.add(objectTypeNode.initFunction);\n         }\n \n         // To ensure the order of the compile errors\n-        Stream.concat(objectTypeNode.functions.stream(),\n-                Optional.ofNullable(objectTypeNode.initFunction).map(Stream::of).orElseGet(Stream::empty))\n-                .sorted(Comparator.comparingInt(fn -> fn.pos.sLine))\n-                .forEachOrdered(fn -> this.analyzeNode(fn, objectEnv));\n+        bLangFunctionList.sort(Comparator.comparingInt(o -> o.pos.sLine));", "originalCommit": "a04399453de1bfea94fff526dc43c541815c2dd1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI4MTExMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22447#discussion_r405281110", "bodyText": "done : a9ac13b", "author": "KRVPerera", "createdAt": "2020-04-08T06:13:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIzODM4MA=="}], "type": "inlineReview"}, {"oid": "a9ac13b6aedad14312ec620d191afb37c907ed13", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a9ac13b6aedad14312ec620d191afb37c907ed13", "message": "Refactor CodeAnalyzer.java rename a variable\n\nSigned-off-by: KRVPerera <rukshan.viduranga@gmail.com>", "committedDate": "2020-04-08T06:12:52Z", "type": "commit"}, {"oid": "2307336c9f3b45f6884d49c97647d1cb3dbe07ea", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2307336c9f3b45f6884d49c97647d1cb3dbe07ea", "message": "Add test : Code Analyzer on anonymous Records", "committedDate": "2020-04-15T16:38:42Z", "type": "commit"}, {"oid": "b3bddbed9e87aa3c2816c38521f8c9515871cd85", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b3bddbed9e87aa3c2816c38521f8c9515871cd85", "message": "Add test : Code analyzer on anonymous object", "committedDate": "2020-04-16T12:33:41Z", "type": "commit"}]}