{"pr_number": 23137, "pr_title": "Update grammar of future and typedesc type descriptors", "pr_createdAt": "2020-05-06T20:05:54Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/23137", "timeline": [{"oid": "5175db0c73bd1a4af6b51c6bd0f9373177bbf6e1", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5175db0c73bd1a4af6b51c6bd0f9373177bbf6e1", "message": "Update grammar of future and typedesc type descriptors", "committedDate": "2020-05-06T12:17:03Z", "type": "commit"}, {"oid": "c5e289d3a4743075a054ef74aefc115062e6708c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c5e289d3a4743075a054ef74aefc115062e6708c", "message": "Initialize constraints of future and typedesc descriptors as any|error", "committedDate": "2020-05-06T19:39:56Z", "type": "commit"}, {"oid": "c16b94589bf94be385209ab41a453efa75644a3c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c16b94589bf94be385209ab41a453efa75644a3c", "message": "Add future and typedesc type tests", "committedDate": "2020-05-06T20:02:09Z", "type": "commit"}, {"oid": "95afd03ddf59a43f381b7f2aaf6e499e20893649", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/95afd03ddf59a43f381b7f2aaf6e499e20893649", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into issue-17922\n\n\u0001 Conflicts:\n\u0001\ttests/jballerina-unit-test/src/test/resources/test-src/types/typedesc/typedesc_positive.bal", "committedDate": "2020-05-06T20:29:30Z", "type": "commit"}, {"oid": "ac860e0aff2a4a4bbc2ae3da8b8bd350355a1bfd", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ac860e0aff2a4a4bbc2ae3da8b8bd350355a1bfd", "message": "Fix review suggestions", "committedDate": "2020-05-13T12:21:55Z", "type": "commit"}, {"oid": "a415a1929625fe3472cb49296e0654bbcee67c91", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a415a1929625fe3472cb49296e0654bbcee67c91", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into issue-17922\n\n\u0001 Conflicts:\n\u0001\ttests/jballerina-unit-test/src/test/resources/testng.xml", "committedDate": "2020-05-13T12:37:04Z", "type": "commit"}, {"oid": "ffbdc8406493efd482970388b322ee3a2ab15905", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ffbdc8406493efd482970388b322ee3a2ab15905", "message": "Fix the conflicts", "committedDate": "2020-05-13T12:51:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4NzEzNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23137#discussion_r424587137", "bodyText": "Missing the licence header. Let's update it in a separate PR.", "author": "MaryamZi", "createdAt": "2020-05-13T16:52:07Z", "path": "tests/jballerina-unit-test/src/test/resources/test-src/types/future/future_positive.bal", "diffHunk": "@@ -0,0 +1,180 @@\n+function testBasicTypes() {", "originalCommit": "ffbdc8406493efd482970388b322ee3a2ab15905", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU2OTI1MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23137#discussion_r440569250", "bodyText": "Done", "author": "chiranSachintha", "createdAt": "2020-06-16T03:44:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4NzEzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4Nzc5OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23137#discussion_r424587798", "bodyText": "Shall we add assertions for result2 and result3 also? Please check for all tests.", "author": "MaryamZi", "createdAt": "2020-05-13T16:53:10Z", "path": "tests/jballerina-unit-test/src/test/resources/test-src/types/future/future_positive.bal", "diffHunk": "@@ -0,0 +1,180 @@\n+function testBasicTypes() {\n+    future<int> f1 = start add(5, 2);\n+    future<boolean> f2 = start status();\n+    future<string> f3 = start concat(\"foo\");\n+\n+    int result1 = wait f1;\n+    boolean result2 = wait f2;\n+    string result3 = wait f3;\n+\n+    assertEquality(7, result1);", "originalCommit": "ffbdc8406493efd482970388b322ee3a2ab15905", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU2OTQ0MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23137#discussion_r440569441", "bodyText": "Added", "author": "chiranSachintha", "createdAt": "2020-06-16T03:45:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4Nzc5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4ODk2NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23137#discussion_r424588965", "bodyText": "Given that we are returning an int here, IMO jsonObject is kinda misleading. Shall we call this something like getJson instead?\nAlso, we don't usually use parentheses around the return type.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            function jsonObject() returns (json) {\n          \n          \n            \n            function jsonObject() returns json {", "author": "MaryamZi", "createdAt": "2020-05-13T16:55:03Z", "path": "tests/jballerina-unit-test/src/test/resources/test-src/types/future/future_positive.bal", "diffHunk": "@@ -0,0 +1,180 @@\n+function testBasicTypes() {\n+    future<int> f1 = start add(5, 2);\n+    future<boolean> f2 = start status();\n+    future<string> f3 = start concat(\"foo\");\n+\n+    int result1 = wait f1;\n+    boolean result2 = wait f2;\n+    string result3 = wait f3;\n+\n+    assertEquality(7, result1);\n+}\n+\n+function testBasicTypesWithoutFutureConstraint() {\n+    future f1 = start add(5, 2);\n+    future f2 = start status();\n+    future f3 = start concat(\"foo\");\n+\n+    any|error result1 = wait f1;\n+    any|error result2 = wait f2;\n+    any|error result3 = wait f3;\n+\n+    assertEquality(7, result1); \n+}\n+\n+function testRefTypes() {\n+    future<xml> a = start xmlFile();\n+    future<json> b = start jsonObject();\n+\n+    xml x = wait a;\n+    json y = wait b;\n+    \n+    assertEquality(\"5\", y.toString());\n+}\n+\n+function testRefTypesWithoutFutureConstraint() {\n+    future a = start xmlFile();\n+    future b = start jsonObject();\n+\n+    any|error x = wait a;\n+    any|error y = wait b;\n+    \n+    assertEquality(\"5\", y.toString());\n+}\n+\n+function testArrayTypes() {\n+    future<int[]> a = start intArray();\n+    \n+    int[] x = wait a;\n+    \n+    assertEquality(intArray(), x);\n+}\n+\n+function testArrayTypesWithoutFutureConstraint() {\n+    future a = start intArray();\n+    \n+    any|error x = wait a;\n+    \n+    assertEquality(intArray(), x);\n+}\n+\n+function testRecordTypes() {\n+    future<Person> a = start getNewPerson();\n+    \n+    Person x = wait a;\n+    \n+    assertEquality(getNewPerson(), x);\n+}\n+\n+function testRecordTypesWithoutFutureConstraint() {\n+    future a = start getNewPerson();\n+    \n+    any|error x = wait a;\n+    \n+    assertEquality(getNewPerson(), x);\n+}\n+\n+function testObjectTypes() {\n+    future<PersonA> a = start getPersonAObject();\n+\n+    PersonA x = wait a;\n+    string name = x.getName();\n+    \n+    assertEquality(\"sample name\", name);\n+}\n+\n+function testObjectTypesWithoutFutureConstraint() {\n+    future a = start getPersonAObject();\n+\n+    any|error x = wait a;\n+    \n+    assertEquality(\"object PersonA\", x.toString());\n+}\n+\n+function testCustomErrorFuture() {\n+    future<error> te = start getError();\n+\n+    error x = wait te;\n+\n+    assertEquality(\"SimpleErrorType\", x.reason());\n+}\n+\n+function testCustomErrorFutureWithoutConstraint() {\n+    future te = start getError();\n+\n+    any|error x = wait te;\n+\n+    assertEquality(getError().toString(), x.toString());\n+}\n+\n+function add(int i, int j) returns int {\n+    int k = i + j;\n+    return k;\n+}\n+\n+function concat(string name) returns string {\n+    return \"hello \" + name;\n+}\n+\n+function status() returns boolean {\n+    return true;\n+}\n+\n+function xmlFile() returns xml {\n+    xml x1 = xml `aaa`;\n+    return x1;\n+}\n+\n+function jsonObject() returns (json) {", "originalCommit": "ffbdc8406493efd482970388b322ee3a2ab15905", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU2OTUwMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23137#discussion_r440569500", "bodyText": "Fixed", "author": "chiranSachintha", "createdAt": "2020-06-16T03:45:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4ODk2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU5MDI5NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23137#discussion_r424590295", "bodyText": "IMO wherever possible it's always better to test against the exact value instead of a toString() representation since we'll also validate the type.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                assertEquality(\"5\", y.toString());\n          \n          \n            \n                assertEquality(5, y);", "author": "MaryamZi", "createdAt": "2020-05-13T16:57:05Z", "path": "tests/jballerina-unit-test/src/test/resources/test-src/types/future/future_positive.bal", "diffHunk": "@@ -0,0 +1,180 @@\n+function testBasicTypes() {\n+    future<int> f1 = start add(5, 2);\n+    future<boolean> f2 = start status();\n+    future<string> f3 = start concat(\"foo\");\n+\n+    int result1 = wait f1;\n+    boolean result2 = wait f2;\n+    string result3 = wait f3;\n+\n+    assertEquality(7, result1);\n+}\n+\n+function testBasicTypesWithoutFutureConstraint() {\n+    future f1 = start add(5, 2);\n+    future f2 = start status();\n+    future f3 = start concat(\"foo\");\n+\n+    any|error result1 = wait f1;\n+    any|error result2 = wait f2;\n+    any|error result3 = wait f3;\n+\n+    assertEquality(7, result1); \n+}\n+\n+function testRefTypes() {\n+    future<xml> a = start xmlFile();\n+    future<json> b = start jsonObject();\n+\n+    xml x = wait a;\n+    json y = wait b;\n+    \n+    assertEquality(\"5\", y.toString());\n+}\n+\n+function testRefTypesWithoutFutureConstraint() {\n+    future a = start xmlFile();\n+    future b = start jsonObject();\n+\n+    any|error x = wait a;\n+    any|error y = wait b;\n+    \n+    assertEquality(\"5\", y.toString());", "originalCommit": "ffbdc8406493efd482970388b322ee3a2ab15905", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU2OTUzNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23137#discussion_r440569536", "bodyText": "Fixed", "author": "chiranSachintha", "createdAt": "2020-06-16T03:46:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU5MDI5NQ=="}], "type": "inlineReview"}]}