{"pr_number": 22388, "pr_title": "Add subtyping feature and improvements to the Ballerina bindgen tool", "pr_createdAt": "2020-04-01T08:26:26Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/22388", "timeline": [{"oid": "b0aa0d4f18ebcb20330ef39a28c8ab068362d7d7", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b0aa0d4f18ebcb20330ef39a28c8ab068362d7d7", "message": "Fix the issue with loading inner classes", "committedDate": "2020-04-01T07:51:02Z", "type": "commit"}, {"oid": "a401bc179fab4a2395e00031ab50ec00d457554c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a401bc179fab4a2395e00031ab50ec00d457554c", "message": "Fix the issue with reading the constants file", "committedDate": "2020-04-01T07:51:02Z", "type": "commit"}, {"oid": "16389dad7b0015eeb57898c11f85887a0be0b567", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/16389dad7b0015eeb57898c11f85887a0be0b567", "message": "Improve the file structure of generated bindings and error handling", "committedDate": "2020-04-01T07:51:02Z", "type": "commit"}, {"oid": "8a3c2816f0eca0f1320cfb057de91d6d7f9c4ab1", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8a3c2816f0eca0f1320cfb057de91d6d7f9c4ab1", "message": "Add support for Java subtyping", "committedDate": "2020-04-01T07:51:02Z", "type": "commit"}, {"oid": "df3cd77753c938a2222ff91d41362ffe4b1f8f59", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/df3cd77753c938a2222ff91d41362ffe4b1f8f59", "message": "Refactor the template logic", "committedDate": "2020-04-01T07:51:02Z", "type": "commit"}, {"oid": "b4238788479caf53d5f12ae9a8a4d1607db800c2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b4238788479caf53d5f12ae9a8a4d1607db800c2", "message": "Add object tags for all implemented interfaces", "committedDate": "2020-04-01T07:51:02Z", "type": "commit"}, {"oid": "029b846fada3ad7e3e648955b3f5533c40672870", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/029b846fada3ad7e3e648955b3f5533c40672870", "message": "Fix the issue with getting string array from handle", "committedDate": "2020-04-01T07:51:02Z", "type": "commit"}, {"oid": "0103bcbd423212962002b3d0fe661d0dd537a92a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0103bcbd423212962002b3d0fe661d0dd537a92a", "message": "Fix issues related to type mappings", "committedDate": "2020-04-01T07:51:02Z", "type": "commit"}, {"oid": "6b89e7b682313f033f897911e8c8f479010f82c5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6b89e7b682313f033f897911e8c8f479010f82c5", "message": "Refactor the code and template", "committedDate": "2020-04-01T07:51:02Z", "type": "commit"}, {"oid": "c3cc49cfeb4ba7bce90e437970310f47973d2245", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c3cc49cfeb4ba7bce90e437970310f47973d2245", "message": "Fix a compilation issue in the generated template", "committedDate": "2020-04-01T07:51:02Z", "type": "commit"}, {"oid": "1db672531cdbda0e97b383774328a8b9ed37830c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1db672531cdbda0e97b383774328a8b9ed37830c", "message": "Improve and refactor the code", "committedDate": "2020-04-01T08:11:06Z", "type": "commit"}, {"oid": "69df4eff4f02da2415a6ae4b76fa46bda4eba3fc", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/69df4eff4f02da2415a6ae4b76fa46bda4eba3fc", "message": "Add review changes to the code", "committedDate": "2020-04-01T12:51:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYwNDQ2Ng==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22388#discussion_r401604466", "bodyText": "As a practice, we add @SInCE annotation. Shall we add that.", "author": "warunalakshitha", "createdAt": "2020-04-01T13:14:08Z", "path": "misc/ballerina-bindgen/src/main/java/org/ballerinalang/bindgen/model/JMethod.java", "diffHunk": "@@ -0,0 +1,181 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package org.ballerinalang.bindgen.model;\n+\n+import java.lang.reflect.Method;\n+import java.lang.reflect.Parameter;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Locale;\n+\n+import static org.ballerinalang.bindgen.command.BindingsGenerator.getAllJavaClasses;\n+import static org.ballerinalang.bindgen.command.BindingsGenerator.setClassListForLooping;\n+import static org.ballerinalang.bindgen.utils.BindgenConstants.BALLERINA_RESERVED_WORDS;\n+import static org.ballerinalang.bindgen.utils.BindgenConstants.BALLERINA_STRING;\n+import static org.ballerinalang.bindgen.utils.BindgenConstants.BALLERINA_STRING_ARRAY;\n+import static org.ballerinalang.bindgen.utils.BindgenConstants.METHOD_INTEROP_TYPE;\n+import static org.ballerinalang.bindgen.utils.BindgenUtils.getBallerinaHandleType;\n+import static org.ballerinalang.bindgen.utils.BindgenUtils.getBallerinaParamType;\n+import static org.ballerinalang.bindgen.utils.BindgenUtils.isStaticMethod;\n+\n+/**\n+ * Class for storing details pertaining to a specific Java method used for Ballerina bridge code generation.", "originalCommit": "69df4eff4f02da2415a6ae4b76fa46bda4eba3fc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYxNTI4NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22388#discussion_r401615284", "bodyText": "Added the since annotation.", "author": "IrushiL", "createdAt": "2020-04-01T13:29:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYwNDQ2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYwNDcyNA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22388#discussion_r401604724", "bodyText": "@SInCE tag is missing.", "author": "warunalakshitha", "createdAt": "2020-04-01T13:14:31Z", "path": "misc/ballerina-bindgen/src/main/java/org/ballerinalang/bindgen/model/JParameter.java", "diffHunk": "@@ -0,0 +1,132 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package org.ballerinalang.bindgen.model;\n+\n+import java.lang.reflect.Parameter;\n+\n+import static org.ballerinalang.bindgen.command.BindingsGenerator.getAllJavaClasses;\n+import static org.ballerinalang.bindgen.command.BindingsGenerator.setClassListForLooping;\n+import static org.ballerinalang.bindgen.utils.BindgenConstants.BALLERINA_STRING;\n+import static org.ballerinalang.bindgen.utils.BindgenConstants.BALLERINA_STRING_ARRAY;\n+import static org.ballerinalang.bindgen.utils.BindgenUtils.getBallerinaHandleType;\n+import static org.ballerinalang.bindgen.utils.BindgenUtils.getBallerinaParamType;\n+import static org.ballerinalang.bindgen.utils.BindgenUtils.getPrimitiveArrayType;\n+\n+/**\n+ * Class for storing specific parameter details of a Java method used for Ballerina bridge code generation.", "originalCommit": "69df4eff4f02da2415a6ae4b76fa46bda4eba3fc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYxNTM3Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22388#discussion_r401615372", "bodyText": "Added the since annotation.", "author": "IrushiL", "createdAt": "2020-04-01T13:29:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYwNDcyNA=="}], "type": "inlineReview"}, {"oid": "02b4f79ed8e0561f91df20949a1f4d07d1e4d1b8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/02b4f79ed8e0561f91df20949a1f4d07d1e4d1b8", "message": "Add the since annotation", "committedDate": "2020-04-01T13:27:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg4ODgwOQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22388#discussion_r401888809", "bodyText": "Assigned variables have never accessed?", "author": "pramodya1994", "createdAt": "2020-04-01T20:27:05Z", "path": "misc/ballerina-bindgen/src/main/java/org/ballerinalang/bindgen/model/JClass.java", "diffHunk": "@@ -39,68 +38,66 @@\n \n /**\n  * Class for storing details pertaining to a specific Java class used for Ballerina bridge code generation.\n+ *\n+ * @since 1.2.0\n  */\n public class JClass {\n \n-    public String shortClassName;\n-    public String packageName;\n-\n     private String prefix;\n     private String className;\n+    private String packageName;\n+    private String shortClassName;\n \n-    private Boolean isInterface = false;\n-    private Boolean directClass = false;\n-    private Boolean isAbstractClass = false;\n-    private Boolean singleConstructor = false;\n-    private Boolean singleConstructorError = false;\n-\n-    private Set<Class> superClassObjects = new HashSet<>();\n+    private boolean isInterface = false;\n+    private boolean isDirectClass = false;\n+    private boolean isAbstract = false;", "originalCommit": "02b4f79ed8e0561f91df20949a1f4d07d1e4d1b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkxMTE0OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22388#discussion_r401911149", "bodyText": "This field is used in the handlebars template.", "author": "IrushiL", "createdAt": "2020-04-01T21:09:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg4ODgwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg4OTMyMQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22388#discussion_r401889321", "bodyText": "This variable is assigned but never accessed", "author": "pramodya1994", "createdAt": "2020-04-01T20:28:04Z", "path": "misc/ballerina-bindgen/src/main/java/org/ballerinalang/bindgen/model/JClass.java", "diffHunk": "@@ -39,68 +38,66 @@\n \n /**\n  * Class for storing details pertaining to a specific Java class used for Ballerina bridge code generation.\n+ *\n+ * @since 1.2.0\n  */\n public class JClass {\n \n-    public String shortClassName;\n-    public String packageName;\n-\n     private String prefix;", "originalCommit": "02b4f79ed8e0561f91df20949a1f4d07d1e4d1b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkxMTIxOA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22388#discussion_r401911218", "bodyText": "This field is used in the handlebars template.", "author": "IrushiL", "createdAt": "2020-04-01T21:09:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg4OTMyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg4OTc0Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22388#discussion_r401889742", "bodyText": "Why this is empty?", "author": "pramodya1994", "createdAt": "2020-04-01T20:28:54Z", "path": "misc/ballerina-bindgen/src/main/java/org/ballerinalang/bindgen/model/JClass.java", "diffHunk": "@@ -111,52 +108,66 @@ public JClass(Class c) {\n     }\n \n     private void populateConstructors(Constructor[] constructors) {\n-\n         int i = 1;\n         for (Constructor constructor : constructors) {\n             JConstructor jConstructor = new JConstructor(constructor);\n-            jConstructor.setConstructorName(\"new\" + this.shortClassName + i);\n-            this.constructorList.add(jConstructor);\n+            jConstructor.setConstructorName(\"new\" + shortClassName + i);\n+            constructorList.add(jConstructor);\n             i++;\n         }\n     }\n \n     private void populateInitFunctions() {\n-\n         int j = 1;\n-        for (JConstructor constructor : this.constructorList) {\n+        for (JConstructor constructor : constructorList) {\n             JConstructor newCons = null;\n             try {\n                 newCons = (JConstructor) constructor.clone();\n-            } catch (CloneNotSupportedException e) {\n-                errStream.println(e);\n+            } catch (CloneNotSupportedException ignore) {\n+\n             }", "originalCommit": "02b4f79ed8e0561f91df20949a1f4d07d1e4d1b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkyMTQ3Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22388#discussion_r401921477", "bodyText": "This error affects only the constructor function generation, therefore adding an output error message there or using a throwable did not make sense since it would either clutter the output or prevent generating the rest of the class. I will address this issue in a later PR by identifying all the incompletely generated bindings and giving a separate output or a detailed log file.", "author": "IrushiL", "createdAt": "2020-04-01T21:29:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg4OTc0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg5Mzk2Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22388#discussion_r401893963", "bodyText": "This method has used anywhere?", "author": "pramodya1994", "createdAt": "2020-04-01T20:37:00Z", "path": "misc/ballerina-bindgen/src/main/java/org/ballerinalang/bindgen/utils/BindgenUtils.java", "diffHunk": "@@ -231,7 +301,6 @@ public static void createDirectory(String path) throws BindgenException {\n     }\n \n     public static Set<String> getClassNamesInJar(String jarPath) throws IOException {", "originalCommit": "02b4f79ed8e0561f91df20949a1f4d07d1e4d1b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkxNDgyNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22388#discussion_r401914825", "bodyText": "No, ATM support for generating bindings for packages is not provided, but we intend on providing that in the future. This method could be used when implementing that feature and that is why it is not removed even though it is not used.", "author": "IrushiL", "createdAt": "2020-04-01T21:17:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg5Mzk2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg5NDYwNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22388#discussion_r401894607", "bodyText": "Have we used this method?", "author": "pramodya1994", "createdAt": "2020-04-01T20:38:12Z", "path": "misc/ballerina-bindgen/src/main/java/org/ballerinalang/bindgen/utils/BindgenUtils.java", "diffHunk": "@@ -256,49 +325,41 @@ public static void createDirectory(String path) throws BindgenException {\n     }\n \n     public static boolean isPublicField(Field field) {\n-\n         int modifiers = field.getModifiers();\n         return Modifier.isPublic(modifiers);\n     }\n \n     public static boolean isPublicMethod(Method method) {\n-\n         int modifiers = method.getModifiers();\n         return Modifier.isPublic(modifiers);\n     }\n \n     public static boolean isPublicClass(Class javaClass) {\n-\n         int modifiers = javaClass.getModifiers();\n         return Modifier.isPublic(modifiers);\n     }\n \n     public static boolean isStaticField(Field field) {\n-\n         int modifiers = field.getModifiers();\n         return Modifier.isStatic(modifiers);\n     }\n \n     public static boolean isStaticMethod(Method method) {\n-\n         int modifiers = method.getModifiers();\n         return Modifier.isStatic(modifiers);\n     }\n \n     public static boolean isFinalField(Field field) {\n-\n         int modifiers = field.getModifiers();\n         return Modifier.isFinal(modifiers);\n     }\n \n     public static boolean isAbstractClass(Class javaClass) {\n-\n         int modifiers = javaClass.getModifiers();\n         return Modifier.isAbstract(modifiers);\n     }\n \n     public static String getModuleName(String jarPath) {", "originalCommit": "02b4f79ed8e0561f91df20949a1f4d07d1e4d1b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkxNTc2NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22388#discussion_r401915765", "bodyText": "No, ATM support for generating bindings for complete jar files is not provided, but we intend on providing that in the future. This method could be used when implementing that feature in order to figure out the name of the module and that is why it is not removed even though it is not used.", "author": "IrushiL", "createdAt": "2020-04-01T21:19:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg5NDYwNw=="}], "type": "inlineReview"}]}