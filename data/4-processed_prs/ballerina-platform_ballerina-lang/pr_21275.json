{"pr_number": 21275, "pr_title": "[HTTP] Introduce common HTTP client config to remove repetition ", "pr_createdAt": "2020-02-26T12:09:13Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/21275", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2ODEzMg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21275#discussion_r384968132", "bodyText": "Shall we remove this content to http_commons.bal file as it contains all the commonly used types?", "author": "chamil321", "createdAt": "2020-02-27T08:12:05Z", "path": "stdlib/http/src/main/ballerina/src/http/common_client_config.bal", "diffHunk": "@@ -0,0 +1,46 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "originalCommit": "a629b58aa96dcd4b51d4dacbb876c5b717e0543b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY1NDc5Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21275#discussion_r385654792", "bodyText": "Fixed in 2bbf173", "author": "BuddhiWathsala", "createdAt": "2020-02-28T11:51:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2ODEzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2OTE5Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21275#discussion_r384969197", "bodyText": "We can remove ProxyConfig as well as it is already grouped under ClientHttp1Settings type", "author": "chamil321", "createdAt": "2020-02-27T08:14:37Z", "path": "stdlib/http/src/main/ballerina/src/http/resiliency/failover_client_endpoint.bal", "diffHunk": "@@ -434,37 +434,27 @@ function populateErrorsFromLastResponse (Response inResponse, ClientError?[] fai\n \n # Provides a set of HTTP related configurations and failover related configurations.\n #\n-# + httpVersion - The HTTP version to be used to communicate with the endpoint\n-# + http1Settings - Configurations related to HTTP/1.x protocol\n-# + http2Settings - Configurations related to HTTP/2 protocol\n-# + timeoutInMillis - The maximum time to wait (in milliseconds) for a response before closing the connection\n-# + forwarded - The choice of setting `forwarded`/`x-forwarded` header\n-# + followRedirects - Redirect related options\n-# + poolConfig - Configurations associated with request pooling\n+# httpVersion - Copied from CommonClientConfiguration\n+# http1Settings - Copied from CommonClientConfiguration\n+# http2Settings - Copied from CommonClientConfiguration\n+# timeoutInMillis - Copied from CommonClientConfiguration\n+# forwarded - Copied from CommonClientConfiguration\n+# followRedirects - Copied from CommonClientConfiguration\n+# poolConfig - Copied from CommonClientConfiguration\n+# cache - Copied from CommonClientConfiguration\n+# compression - Copied from CommonClientConfiguration\n+# auth - Copied from CommonClientConfiguration\n+# circuitBreaker - Copied from CommonClientConfiguration\n+# retryConfig - Copied from CommonClientConfiguration\n+# cookieConfig - Copied from CommonClientConfiguration\n # + proxy - Proxy related options\n # + targets - The upstream HTTP endpoints among which the incoming HTTP traffic load should be sent on failover\n-# + cache - The configurations for controlling the caching behaviour\n-# + compression - Specifies the way of handling compression (`accept-encoding`) header\n-# + auth - HTTP authentication related configurations\n-# + circuitBreaker - Circuit Breaker behaviour configurations\n-# + retryConfig - Retry related options\n # + failoverCodes - Array of HTTP response status codes for which the failover behaviour should be triggered\n # + intervalInMillis - Failover delay interval in milliseconds\n public type FailoverClientConfiguration record {|\n-    string httpVersion = HTTP_1_1;\n-    ClientHttp1Settings http1Settings = {};\n-    ClientHttp2Settings http2Settings = {};\n-    int timeoutInMillis = 60000;\n-    string forwarded = \"disable\";\n-    FollowRedirects? followRedirects = ();\n+    *CommonClientConfiguration;\n     ProxyConfig? proxy = ();", "originalCommit": "a629b58aa96dcd4b51d4dacbb876c5b717e0543b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY1NDY0OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21275#discussion_r385654649", "bodyText": "Fixed in 2bbf173", "author": "BuddhiWathsala", "createdAt": "2020-02-28T11:50:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2OTE5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2OTM4Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21275#discussion_r384969382", "bodyText": "We can remove ProxyConfig as well as it is already grouped under ClientHttp1Settings type", "author": "chamil321", "createdAt": "2020-02-27T08:15:06Z", "path": "stdlib/http/src/main/ballerina/src/http/resiliency/load_balance_client_endpoint.bal", "diffHunk": "@@ -304,37 +304,27 @@ function populateGenericLoadBalanceActionError(LoadBalanceActionErrorData loadBa\n \n # The configurations related to the load balance client endpoint.\n #\n-# + httpVersion - The HTTP version to be used to communicate with the endpoint\n-# + http1Settings - Configurations related to HTTP/1.x protocol\n-# + http2Settings - Configurations related to HTTP/2 protocol\n-# + timeoutInMillis - The maximum time to wait (in milli seconds) for a response before closing the connection\n-# + forwarded - The choice of setting forwarded/x-forwarded header\n-# + followRedirects - Redirect related options\n-# + poolConfig - Configurations associated with request pooling\n+# httpVersion - Copied from CommonClientConfiguration\n+# http1Settings - Copied from CommonClientConfiguration\n+# http2Settings - Copied from CommonClientConfiguration\n+# timeoutInMillis - Copied from CommonClientConfiguration\n+# forwarded - Copied from CommonClientConfiguration\n+# followRedirects - Copied from CommonClientConfiguration\n+# poolConfig - Copied from CommonClientConfiguration\n+# cache - Copied from CommonClientConfiguration\n+# compression - Copied from CommonClientConfiguration\n+# auth - Copied from CommonClientConfiguration\n+# circuitBreaker - Copied from CommonClientConfiguration\n+# retryConfig - Copied from CommonClientConfiguration\n+# cookieConfig - Copied from CommonClientConfiguration\n # + proxy - Proxy related options\n # + targets - The upstream HTTP endpoints among which the incoming HTTP traffic load should be distributed\n-# + cache - The configurations for controlling the caching behaviour\n-# + compression - Specifies the way of handling compression (`accept-encoding`) header\n-# + auth - Configurations related to the HTTP authentication.\n-# + circuitBreaker - Circuit Breaker configuration\n-# + retryConfig - Retry related options\n # + lbRule - LoadBalancing rule\n # + failover - Configuration for load balancer whether to fail over in case of a failure\n public type LoadBalanceClientConfiguration record {|\n-    string httpVersion = HTTP_1_1;\n-    ClientHttp1Settings http1Settings = {};\n-    ClientHttp2Settings http2Settings = {};\n-    int timeoutInMillis = 60000;\n-    string forwarded = \"disable\";\n-    FollowRedirects? followRedirects = ();\n+    *CommonClientConfiguration;\n     ProxyConfig? proxy = ();", "originalCommit": "a629b58aa96dcd4b51d4dacbb876c5b717e0543b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY1NDQ2Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21275#discussion_r385654463", "bodyText": "Fixed in 2bbf173", "author": "BuddhiWathsala", "createdAt": "2020-02-28T11:50:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2OTM4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk3MDYyNA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21275#discussion_r384970624", "bodyText": "Shall we format the JSON using https://jsonformatter.curiousconcept.com/ and paste it here. Ideally, we need to add only the specific change. Most of these changes are just indentation.", "author": "chamil321", "createdAt": "2020-02-27T08:18:18Z", "path": "language-server/modules/langserver-core/src/test/resources/completion/function/chainCompletion4.json", "diffHunk": "@@ -4,358 +4,336 @@\n     \"character\": 7\n   },\n   \"source\": \"function/source/chainCompletion4.bal\",\n-  \"items\": [\n-    {\n-      \"label\": \"shift()((any|error))\",\n-      \"kind\": \"Function\",\n-      \"detail\": \"Function\",\n-      \"documentation\": {\n-        \"right\": {\n-          \"kind\": \"markdown\",\n-          \"value\": \"**Package:** _ballerina/lang.array_  \\n  \\nRemoves and returns first member of an array.\\nThe array must not be empty.\\n  \\n  \\n  \\n**Returns** `(any|error)`   \\n- the value that was the first member of the array  \\n  \\n\"\n-        }\n-      },\n-      \"sortText\": \"120\",\n-      \"insertText\": \"shift()\",\n-      \"insertTextFormat\": \"Snippet\"\n+  \"items\": [{\n+    \"label\": \"shift()((any|error))\",\n+    \"kind\": \"Function\",\n+    \"detail\": \"Function\",\n+    \"documentation\": {\n+      \"right\": {\n+        \"kind\": \"markdown\",\n+        \"value\": \"**Package:** _ballerina/lang.array_  \\n  \\nRemoves and returns first member of an array.\\nThe array must not be empty.\\n  \\n  \\n  \\n**Returns** `(any|error)`   \\n- the value that was the first member of the array  \\n  \\n\"\n+      }\n     },\n-    {\n-      \"label\": \"toStream()(stream<(anydata|error)><(anydata|error)>)\",\n-      \"kind\": \"Function\",\n-      \"detail\": \"Function\",\n-      \"documentation\": {\n-        \"right\": {\n-          \"kind\": \"markdown\",\n-          \"value\": \"**Package:** _ballerina/lang.array_  \\n  \\nReturns a stream from the given array.\\n  \\n\"\n-        }\n-      },\n-      \"sortText\": \"120\",\n-      \"insertText\": \"toStream()\",\n-      \"insertTextFormat\": \"Snippet\"\n+    \"sortText\": \"120\",\n+    \"insertText\": \"shift()\",\n+    \"insertTextFormat\": \"Snippet\"\n+  }, {", "originalCommit": "a629b58aa96dcd4b51d4dacbb876c5b717e0543b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY1NDI0MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21275#discussion_r385654241", "bodyText": "Fixed in 44296d1", "author": "BuddhiWathsala", "createdAt": "2020-02-28T11:50:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk3MDYyNA=="}], "type": "inlineReview"}, {"oid": "9a0cf134de3b5c6782f90b4b858100423a1e6fba", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9a0cf134de3b5c6782f90b4b858100423a1e6fba", "message": "introduce a common HTTP client config", "committedDate": "2020-02-28T09:56:02Z", "type": "commit"}, {"oid": "377668ae39647e9e3cde1853ffb17aceb405a9c9", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/377668ae39647e9e3cde1853ffb17aceb405a9c9", "message": "remove repetitive fields by introducing HTTP common client config", "committedDate": "2020-02-28T09:56:02Z", "type": "commit"}, {"oid": "4005b6f5acbd1f69a69c09a47ab34ce59a3653ba", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4005b6f5acbd1f69a69c09a47ab34ce59a3653ba", "message": "fix language tests by changing the expected config JSON", "committedDate": "2020-02-28T09:56:02Z", "type": "commit"}, {"oid": "fd87c10979b94b173dfac65d2c398345c37c4ffa", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fd87c10979b94b173dfac65d2c398345c37c4ffa", "message": "fix language server JSON formats", "committedDate": "2020-02-28T09:56:02Z", "type": "commit"}, {"oid": "2bbf173f2e61c966f125812b80ddcdaf81b4ccff", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2bbf173f2e61c966f125812b80ddcdaf81b4ccff", "message": "move CommonClientConfiguration to http_commons.bal", "committedDate": "2020-02-28T09:56:02Z", "type": "commit"}, {"oid": "11bea2ef9321fc834ecb2228f575185f5e3eb10d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/11bea2ef9321fc834ecb2228f575185f5e3eb10d", "message": "remove proxy config", "committedDate": "2020-02-28T09:56:02Z", "type": "commit"}, {"oid": "44296d135055b7826de9430384aaec4b1cbd9270", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/44296d135055b7826de9430384aaec4b1cbd9270", "message": "reformat lang server JSONs", "committedDate": "2020-02-28T09:56:03Z", "type": "commit"}, {"oid": "c95222163095a46422e49ce2d16b1be5eb190b8b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c95222163095a46422e49ce2d16b1be5eb190b8b", "message": "fix JSONs", "committedDate": "2020-02-28T09:56:03Z", "type": "commit"}, {"oid": "69c0e28a3cbef1b3313f363342f46a63b78fea0e", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/69c0e28a3cbef1b3313f363342f46a63b78fea0e", "message": "fix completion and package import JSONs", "committedDate": "2020-02-28T09:56:03Z", "type": "commit"}]}