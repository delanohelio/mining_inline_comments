{"pr_number": 21410, "pr_title": "Support multiple attachments in Ballerina task scheduler", "pr_createdAt": "2020-03-02T13:34:28Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/21410", "timeline": [{"oid": "975e0eeac22de03a9e9c2b08ab63d7d3bfb2a638", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/975e0eeac22de03a9e9c2b08ab63d7d3bfb2a638", "message": "Support multiple attachments in task schedulers", "committedDate": "2020-03-02T11:51:20Z", "type": "commit"}, {"oid": "56ab589a337ea90a95198946e3b3c48eed8c04c8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/56ab589a337ea90a95198946e3b3c48eed8c04c8", "message": "Add test for multiple attachments", "committedDate": "2020-03-02T13:00:01Z", "type": "commit"}, {"oid": "9aa6fa2d9f76caaa62b58b5af5b1974d778f54f1", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9aa6fa2d9f76caaa62b58b5af5b1974d778f54f1", "message": "Bump task module version", "committedDate": "2020-03-02T13:14:43Z", "type": "commit"}, {"oid": "9809492afed99c5dc2e270d21612c675c415a203", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9809492afed99c5dc2e270d21612c675c415a203", "message": "Update task example", "committedDate": "2020-03-02T13:15:00Z", "type": "commit"}, {"oid": "787bb2e81bd9ef89dc2bd28db20e87d138d87ca6", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/787bb2e81bd9ef89dc2bd28db20e87d138d87ca6", "message": "Remove unused constants", "committedDate": "2020-03-02T13:39:49Z", "type": "commit"}, {"oid": "a1f838db11c118c0a98ac26fc646da2a2762265e", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a1f838db11c118c0a98ac26fc646da2a2762265e", "message": "Remove unnecessary constructor in ServiceInformation Object", "committedDate": "2020-03-02T14:13:54Z", "type": "commit"}, {"oid": "636cb0ff57cfce72012fc8bc0f92085d917ee815", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/636cb0ff57cfce72012fc8bc0f92085d917ee815", "message": "Fix spotbugs issues and rename multiple attachment test function", "committedDate": "2020-03-02T19:04:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ2NDQ3NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21410#discussion_r387464474", "bodyText": "Shall we try to merge this to a single line?", "author": "wggihan", "createdAt": "2020-03-04T06:06:18Z", "path": "stdlib/task/src/main/ballerina/src/task/scheduler.bal", "diffHunk": "@@ -25,23 +25,14 @@ public type Scheduler object {\n     # Attaches the provided `service` to the task.\n     #\n     # + serviceToAttach - Ballerina `service` object which needs to be attached to the task.\n-    # + attachment - An optional parameter which needs to passed inside the resources.\n+    # + attachments - Set of optional parameters which needs to passed inside the resources.\n     # + return - Returns `task:SchedulerError` if the process failed due to any reason, nil otherwise.\n-    public function attach(service serviceToAttach, public any attachment = ()) returns SchedulerError? {\n+    public function attach(service serviceToAttach, any... attachments) returns SchedulerError? {\n         string message = \"Failed to attach the service to the scheduler\";\n-        if (attachment != ()) {\n-            map<any> attachments = { attachment: attachment };\n-            var result = attachExternal(self.taskListener, serviceToAttach, attachments);\n-            if (result is ListenerError) {\n-                SchedulerError err = error(SCHEDULER_ERROR_REASON, message = message, cause = result);\n-                return err;\n-            }\n-        } else {\n-            var result = attachExternal(self.taskListener, serviceToAttach, {});\n-            if (result is ListenerError) {\n-                SchedulerError err = error(SCHEDULER_ERROR_REASON, message = message, cause = result);\n-                return err;\n-            }\n+        var result = attachExternal(self.taskListener, serviceToAttach, ...attachments);\n+        if (result is ListenerError) {\n+            SchedulerError err = error(SCHEDULER_ERROR_REASON, message = message, cause = result);", "originalCommit": "636cb0ff57cfce72012fc8bc0f92085d917ee815", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ2OTEwNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21410#discussion_r387469105", "bodyText": "Done", "author": "ThisaruGuruge", "createdAt": "2020-03-04T06:23:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ2NDQ3NA=="}], "type": "inlineReview"}, {"oid": "57accb56f539fe371c97b8185e7013e63dd7cd9d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/57accb56f539fe371c97b8185e7013e63dd7cd9d", "message": "Remove redundant variable assignment in SchedulerError creation", "committedDate": "2020-03-04T06:23:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEwMDk0NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21410#discussion_r388100945", "bodyText": "How does this behave in the error cases? If the # of onTrigger resource param count and the # of attach() function params are different, null will be returned.\nIf the above is validated during the compile-time, then this condition is not necessary. WDYT?", "author": "chamil321", "createdAt": "2020-03-05T06:34:14Z", "path": "stdlib/task/src/main/java/org/ballerinalang/stdlib/task/utils/TaskExecutor.java", "diffHunk": "@@ -40,9 +38,17 @@ public static void executeFunction(ServiceInformation serviceInformation) {\n     }\n \n     private static Object[] getParameterList(AttachedFunction function, ServiceInformation serviceInformation) {\n-        if (function.type.paramTypes.length > 0 && Objects.nonNull(serviceInformation.getAttachment())) {\n-            return new Object[]{serviceInformation.getAttachment(), Boolean.TRUE};\n+        Object[] attachments = serviceInformation.getAttachment();\n+        int numberOfParameters = function.type.paramTypes.length;\n+        Object[] parameters = null;\n+        if (numberOfParameters == attachments.length) {", "originalCommit": "57accb56f539fe371c97b8185e7013e63dd7cd9d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEwNjAzNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21410#discussion_r388106036", "bodyText": "Ideally, this should be validated in the compile time, but unfortunately, we can't write compiler plugin for this, just yet. (See #14148)\nTherefore this is added. But since this is invoked from a resource function, we cannot return any error here. Is there a way to reflect this error scenario?", "author": "ThisaruGuruge", "createdAt": "2020-03-05T06:51:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEwMDk0NQ=="}], "type": "inlineReview"}]}