{"pr_number": 999, "pr_title": "Warn user if moving objects between admin units", "pr_createdAt": "2020-05-28T17:23:15Z", "pr_url": "https://github.com/UNC-Libraries/box-c/pull/999", "timeline": [{"oid": "0b8eb8ea76c47413db4c845ee813519210cb634b", "url": "https://github.com/UNC-Libraries/box-c/commit/0b8eb8ea76c47413db4c845ee813519210cb634b", "message": "Warn user if moving objects between admin collections", "committedDate": "2020-05-28T17:16:28Z", "type": "commit"}, {"oid": "53d3078ca4a016441bf3098d165e0942fed3860f", "url": "https://github.com/UNC-Libraries/box-c/commit/53d3078ca4a016441bf3098d165e0942fed3860f", "message": "Update conditional", "committedDate": "2020-05-28T17:53:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjcxNzU0Mw==", "url": "https://github.com/UNC-Libraries/box-c/pull/999#discussion_r432717543", "bodyText": "I think you'll need to check every object being move to see if it is moving to a different admin unit. You can have objects from multiple admin units in the same search result, in which case we'd particularly want to be able to warn users. If objects are coming from multiple admin units, maybe we can just say \"from multiple admin units\" rather than showing a title", "author": "bbpennel", "createdAt": "2020-05-29T20:23:32Z", "path": "static/js/admin/src/MoveDropLocation.js", "diffHunk": "@@ -50,27 +50,40 @@ define('MoveDropLocation', [ 'jquery', 'jquery-ui', 'ConfirmationDialog'],\n \t\t\t\t\n \t\t\t\t// Confirm the move operation before performing it\n \t\t\t\tvar representative = ui.draggable.data(\"resultObject\");\n-\t\t\t\t\n-\t\t\t\tvar repTitle = representative.metadata.title;\n-\t\t\t\tif (repTitle.length > 50) {\n-\t\t\t\t\trepTitle = repTitle.substring(0, 50) + \"...\";\n-\t\t\t\t}\n-\t\t\t\t\n-\t\t\t\tvar destTitle = metadata.title;\n-\t\t\t\tif (destTitle.length > 50) {\n-\t\t\t\t\tdestTitle = destTitle.substring(0, 50) + \"...\";\n+\t\t\t\tvar promptText = '';\n+\t\t\t\tvar moveSingleObj = self.manager.dragTargets.length === 1;\n+\n+\t\t\t\tvar destTitle = self._formatTitle(metadata.title);\n+\t\t\t\tvar targetAdminUnit = self._getAdminUnit(metadata.objectPath);\n+\n+\t\t\t\tvar repTitle = self._formatTitle(representative.metadata.title);\n+\t\t\t\tvar currentAdminUnit = self._getAdminUnit(representative.metadata.objectPath);", "originalCommit": "53d3078ca4a016441bf3098d165e0942fed3860f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjcxODAzMQ==", "url": "https://github.com/UNC-Libraries/box-c/pull/999#discussion_r432718031", "bodyText": "I might be missing something, but i think there's an extra space being added before the prompt in this case", "author": "bbpennel", "createdAt": "2020-05-29T20:24:48Z", "path": "static/js/admin/src/MoveDropLocation.js", "diffHunk": "@@ -50,27 +50,40 @@ define('MoveDropLocation', [ 'jquery', 'jquery-ui', 'ConfirmationDialog'],\n \t\t\t\t\n \t\t\t\t// Confirm the move operation before performing it\n \t\t\t\tvar representative = ui.draggable.data(\"resultObject\");\n-\t\t\t\t\n-\t\t\t\tvar repTitle = representative.metadata.title;\n-\t\t\t\tif (repTitle.length > 50) {\n-\t\t\t\t\trepTitle = repTitle.substring(0, 50) + \"...\";\n-\t\t\t\t}\n-\t\t\t\t\n-\t\t\t\tvar destTitle = metadata.title;\n-\t\t\t\tif (destTitle.length > 50) {\n-\t\t\t\t\tdestTitle = destTitle.substring(0, 50) + \"...\";\n+\t\t\t\tvar promptText = '';\n+\t\t\t\tvar moveSingleObj = self.manager.dragTargets.length === 1;\n+\n+\t\t\t\tvar destTitle = self._formatTitle(metadata.title);\n+\t\t\t\tvar targetAdminUnit = self._getAdminUnit(metadata.objectPath);\n+\n+\t\t\t\tvar repTitle = self._formatTitle(representative.metadata.title);\n+\t\t\t\tvar currentAdminUnit = self._getAdminUnit(representative.metadata.objectPath);\n+\n+\t\t\t\tif (currentAdminUnit.pid !== targetAdminUnit.pid) {\n+\t\t\t\t\tif (moveSingleObj) {\n+\t\t\t\t\t\tpromptText += \" &quot;\" + repTitle + \"&quot; is \";", "originalCommit": "53d3078ca4a016441bf3098d165e0942fed3860f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjcxOTI2MA==", "url": "https://github.com/UNC-Libraries/box-c/pull/999#discussion_r432719260", "bodyText": "I think this would throw an error if the objectPath didn't have a length > 1 since it returns undefined. I think this could occur if you were moving a collection to a different unit", "author": "bbpennel", "createdAt": "2020-05-29T20:27:41Z", "path": "static/js/admin/src/MoveDropLocation.js", "diffHunk": "@@ -50,27 +50,40 @@ define('MoveDropLocation', [ 'jquery', 'jquery-ui', 'ConfirmationDialog'],\n \t\t\t\t\n \t\t\t\t// Confirm the move operation before performing it\n \t\t\t\tvar representative = ui.draggable.data(\"resultObject\");\n-\t\t\t\t\n-\t\t\t\tvar repTitle = representative.metadata.title;\n-\t\t\t\tif (repTitle.length > 50) {\n-\t\t\t\t\trepTitle = repTitle.substring(0, 50) + \"...\";\n-\t\t\t\t}\n-\t\t\t\t\n-\t\t\t\tvar destTitle = metadata.title;\n-\t\t\t\tif (destTitle.length > 50) {\n-\t\t\t\t\tdestTitle = destTitle.substring(0, 50) + \"...\";\n+\t\t\t\tvar promptText = '';\n+\t\t\t\tvar moveSingleObj = self.manager.dragTargets.length === 1;\n+\n+\t\t\t\tvar destTitle = self._formatTitle(metadata.title);\n+\t\t\t\tvar targetAdminUnit = self._getAdminUnit(metadata.objectPath);\n+\n+\t\t\t\tvar repTitle = self._formatTitle(representative.metadata.title);\n+\t\t\t\tvar currentAdminUnit = self._getAdminUnit(representative.metadata.objectPath);\n+\n+\t\t\t\tif (currentAdminUnit.pid !== targetAdminUnit.pid) {", "originalCommit": "53d3078ca4a016441bf3098d165e0942fed3860f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4fda8ff1a9751caa86067513b4fd6a43b65c6a32", "url": "https://github.com/UNC-Libraries/box-c/commit/4fda8ff1a9751caa86067513b4fd6a43b65c6a32", "message": "Check every objects admin unit", "committedDate": "2020-06-01T18:27:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE3NjU0NQ==", "url": "https://github.com/UNC-Libraries/box-c/pull/999#discussion_r434176545", "bodyText": "I haven't verified this, but I am guessing that if you move two items from the same admin unit to a different admin unit, this will result in an adminUnitsSize of 2? Which could be a bit confusing to users, particularly if they are moving a lot more items.\nShould add a test to verify this use case.", "author": "bbpennel", "createdAt": "2020-06-02T21:08:44Z", "path": "static/js/admin/src/MoveDropLocation.js", "diffHunk": "@@ -32,13 +32,25 @@ define('MoveDropLocation', [ 'jquery', 'jquery-ui', 'ConfirmationDialog'],\n \t\t\t\t// Verify that it is the correct type of element and retrieve metadata\n \t\t\t\tvar metadata = self.options.dropTargetGetDataFunction($dropTarget);\n \t\t\t\tif (!metadata) return false;\n-\t\t\t\t\n+\n+\t\t\t\tvar destTitle = self._formatTitle(metadata.title);\n+\t\t\t\tvar targetAdminUnit = self._getAdminUnit(metadata.objectPath);\n+\t\t\t\tvar adminUnitsSize = 1;\n+\n \t\t\t\t// Check that we are not moving an object to itself\n \t\t\t\ttry {\n \t\t\t\t\t$.each(self.manager.dragTargets, function() {\n \t\t\t\t\t\tif (this.pid == metadata.id) {\n \t\t\t\t\t\t\tthrow \"Invalid destination.  Object \" + this.pid + \" cannot be move into itself.\";\n \t\t\t\t\t\t}\n+\n+\t\t\t\t\t\t// Check if the object is being moved to another admin unit\n+\t\t\t\t\t\tvar currentAdminUnit = self._getAdminUnit(this.metadata.objectPath);\n+\n+\t\t\t\t\t\tif (currentAdminUnit !== undefined && targetAdminUnit !== undefined &&", "originalCommit": "4fda8ff1a9751caa86067513b4fd6a43b65c6a32", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2a40c5e4708afcd771c071b1535a9a892bd1b182", "url": "https://github.com/UNC-Libraries/box-c/commit/2a40c5e4708afcd771c071b1535a9a892bd1b182", "message": "Fix admin unit display count", "committedDate": "2020-06-03T13:22:48Z", "type": "commit"}, {"oid": "e064a89b2be1c5a15d34f64bd72e86526a1c7ffe", "url": "https://github.com/UNC-Libraries/box-c/commit/e064a89b2be1c5a15d34f64bd72e86526a1c7ffe", "message": "Fix incorrect current admin unit when moving items between admin units", "committedDate": "2020-06-03T14:39:08Z", "type": "commit"}, {"oid": "3e0127b936f1d76861f55ecf36b0ebd57db066c8", "url": "https://github.com/UNC-Libraries/box-c/commit/3e0127b936f1d76861f55ecf36b0ebd57db066c8", "message": "Fix issue with message when moving a collection to a different admin unit", "committedDate": "2020-06-04T13:46:14Z", "type": "commit"}, {"oid": "c09b8afa6a287b9bb9598e984bc0cb9190861e6e", "url": "https://github.com/UNC-Libraries/box-c/commit/c09b8afa6a287b9bb9598e984bc0cb9190861e6e", "message": "Fix pluralization", "committedDate": "2020-06-04T15:22:43Z", "type": "commit"}]}