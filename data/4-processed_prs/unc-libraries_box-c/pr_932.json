{"pr_number": 932, "pr_title": "Update display of items marked for deletion in public UI", "pr_createdAt": "2020-03-17T13:47:45Z", "pr_url": "https://github.com/UNC-Libraries/box-c/pull/932", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc1NDcwOA==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r393754708", "bodyText": "there are still existing styles for deleted items, they are over in here:\nhttps://github.com/UNC-Libraries/Carolina-Digital-Repository/blob/46e5d59c48bde7288c6c80f348d6480ce86cada5/static/css/cdrui_styles.css#L200-L218\nhttps://github.com/UNC-Libraries/Carolina-Digital-Repository/blob/46e5d59c48bde7288c6c80f348d6480ce86cada5/static/css/cdrui_styles.css#L971-L986\nthe class name is deleted. I don't know if these are still helpful or not, but there seems to be a bit more happening there than in this rule, so its worth comparing. It covers record and result pages. We should probably consider if there are more styles there that we want to retain, and cleanup the old rules once we have everything we want in here.\nAlso, marked-delete reads a little weird to me, maybe because its an adjective plus verb. Maybe deleted or marked-deleted?\nOne other thing, in bxc3 we get a trash icon over the thumbnail when something is deleted. I haven't deployed this branch yet, but i don't see anything in the PR that would add that in.\nFor an example of a deleted resource, see:\nhttps://dcr-qa.lib.unc.edu/search?anywhere=doomed_from_the_start\nyou might have to spoof yourself some credentials, I can't remember your permission setup.", "author": "bbpennel", "createdAt": "2020-03-17T15:15:28Z", "path": "static/css/sass/cdr-ui.scss", "diffHunk": "@@ -457,6 +457,19 @@ $border-style: 1px solid $light-gray;\n $box-shadow-color: rgba(211,211,211,0.5);\n $box-shadow: inset 3px 3px 10px -1px $box-shadow-color, 0px 16px 22px -15px $box-shadow-color;\n \n+/* Items marked for deletion */\n+.marked-delete {", "originalCommit": "46e5d59c48bde7288c6c80f348d6480ce86cada5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3OTEyMA==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r393779120", "bodyText": "No, there, currently, isn't any trash icon added.", "author": "lfarrell", "createdAt": "2020-03-17T15:47:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc1NDcwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc4MDc2MA==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r393780760", "bodyText": "I saw the exisiting classes, but I think they weren't being applied for some reason in the Vue components if a link had the \"deleted\" class. I'll poke around", "author": "lfarrell", "createdAt": "2020-03-17T15:49:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc1NDcwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc4MjE4OQ==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r393782189", "bodyText": "I was thinking at some point we might want to find/run a tool to find \"dead\" css.", "author": "lfarrell", "createdAt": "2020-03-17T15:51:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc1NDcwOA=="}], "type": "inlineReview"}, {"oid": "6308781cd648eb33ba041948f03d65ae1e58d991", "url": "https://github.com/UNC-Libraries/box-c/commit/6308781cd648eb33ba041948f03d65ae1e58d991", "message": "Move deleted styles into one place", "committedDate": "2020-03-17T17:24:47Z", "type": "forcePushed"}, {"oid": "7dac9d57b66c3b009f79969273fd6916ec67858a", "url": "https://github.com/UNC-Libraries/box-c/commit/7dac9d57b66c3b009f79969273fd6916ec67858a", "message": "Add trash icon", "committedDate": "2020-03-18T12:09:42Z", "type": "forcePushed"}, {"oid": "996be2427093d23eb7f416727ee34675efb6e129", "url": "https://github.com/UNC-Libraries/box-c/commit/996be2427093d23eb7f416727ee34675efb6e129", "message": "Update display of items marked for deletion in public UI", "committedDate": "2020-03-18T13:19:58Z", "type": "commit"}, {"oid": "73682217079703de18d6903491749d84940f9a00", "url": "https://github.com/UNC-Libraries/box-c/commit/73682217079703de18d6903491749d84940f9a00", "message": "Move deleted styles into one place", "committedDate": "2020-03-18T13:19:58Z", "type": "commit"}, {"oid": "5c9dd534099575be6f33b8346f083a68a5bf075a", "url": "https://github.com/UNC-Libraries/box-c/commit/5c9dd534099575be6f33b8346f083a68a5bf075a", "message": "Add trash icon", "committedDate": "2020-03-18T13:19:58Z", "type": "commit"}, {"oid": "5c9dd534099575be6f33b8346f083a68a5bf075a", "url": "https://github.com/UNC-Libraries/box-c/commit/5c9dd534099575be6f33b8346f083a68a5bf075a", "message": "Add trash icon", "committedDate": "2020-03-18T13:19:58Z", "type": "forcePushed"}, {"oid": "60b2209771723de4c222472af758120b1a218103", "url": "https://github.com/UNC-Libraries/box-c/commit/60b2209771723de4c222472af758120b1a218103", "message": "Mark file/aggregate pages and related items as marked for deletion", "committedDate": "2020-03-18T19:41:19Z", "type": "commit"}, {"oid": "bae16b20824ccf020cd62bc17a6583147e2d4d71", "url": "https://github.com/UNC-Libraries/box-c/commit/bae16b20824ccf020cd62bc17a6583147e2d4d71", "message": "* Fix icons not showing up\n* Update icon placement", "committedDate": "2020-03-19T20:11:36Z", "type": "commit"}, {"oid": "9c86b06130e7580b53d231f9ae7cc6778d133bb6", "url": "https://github.com/UNC-Libraries/box-c/commit/9c86b06130e7580b53d231f9ae7cc6778d133bb6", "message": "Fix icons for images", "committedDate": "2020-03-20T12:19:25Z", "type": "commit"}, {"oid": "9c86b06130e7580b53d231f9ae7cc6778d133bb6", "url": "https://github.com/UNC-Libraries/box-c/commit/9c86b06130e7580b53d231f9ae7cc6778d133bb6", "message": "Fix icons for images", "committedDate": "2020-03-20T12:19:25Z", "type": "forcePushed"}, {"oid": "6f84cc6a899223acc5e05af0ae8000bf3d2e666f", "url": "https://github.com/UNC-Libraries/box-c/commit/6f84cc6a899223acc5e05af0ae8000bf3d2e666f", "message": "Fix layout of table rows with badges", "committedDate": "2020-03-20T14:01:56Z", "type": "commit"}, {"oid": "666b9d523328b73bda48f28ac538c559f7581d49", "url": "https://github.com/UNC-Libraries/box-c/commit/666b9d523328b73bda48f28ac538c559f7581d49", "message": "Fix row display for rows with badges", "committedDate": "2020-03-20T15:39:31Z", "type": "commit"}, {"oid": "666b9d523328b73bda48f28ac538c559f7581d49", "url": "https://github.com/UNC-Libraries/box-c/commit/666b9d523328b73bda48f28ac538c559f7581d49", "message": "Fix row display for rows with badges", "committedDate": "2020-03-20T15:39:31Z", "type": "forcePushed"}, {"oid": "b49d454c33dd172eddbc96da14fafe4385bcd55d", "url": "https://github.com/UNC-Libraries/box-c/commit/b49d454c33dd172eddbc96da14fafe4385bcd55d", "message": "Don't hardcode badge value", "committedDate": "2020-03-23T17:33:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE3MzQwMQ==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398173401", "bodyText": "there's a constant for this, might as well use it edu.unc.lib.dl.search.solr.util.FacetConstants.MARKED_FOR_DELETION", "author": "bbpennel", "createdAt": "2020-03-25T21:14:01Z", "path": "access/src/main/java/edu/unc/lib/dl/ui/controller/FullRecordController.java", "diffHunk": "@@ -234,6 +234,14 @@ public String getFullRecord(String pidString, Model model, HttpServletRequest re\n             model.addAttribute(\"neighborList\", neighbors);\n         }\n \n+        List<String> objectStatus = briefObject.getStatus();\n+        boolean isMarkedForDeletion = false;\n+\n+        if (objectStatus != null) {\n+            isMarkedForDeletion = objectStatus.contains(\"Marked For Deletion\");", "originalCommit": "b49d454c33dd172eddbc96da14fafe4385bcd55d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE3NTYzNg==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398175636", "bodyText": "Unindent this line once", "author": "bbpennel", "createdAt": "2020-03-25T21:17:57Z", "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord/collectionRecord.jsp", "diffHunk": "@@ -45,7 +45,12 @@\n     <div id=\"is-collection\" class=\"columns browse-header\">\n         <div class=\"column is-12\">\n             <c:import url=\"fullRecord/navigationBar.jsp\" />\n-            <h2><i class=\"fa fa-archive\" aria-hidden=\"true\"></i> <c:out value=\"${briefObject.title}\"/> <span class=\"item-count\">(<c:out value=\"${childCount}\" /> items)</span></h2>\n+            <c:choose>\n+                <c:when test=\"${markedForDeletion}\"><h2 class=\"deleted\"></c:when>\n+                <c:otherwise><h2></c:otherwise>\n+                </c:choose>", "originalCommit": "b49d454c33dd172eddbc96da14fafe4385bcd55d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE4MjAyNQ==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398182025", "bodyText": "Mostly up to you, but it looks like adding the deleted class was previously handled by setting a variable with the name of the class here:\nhttps://github.com/UNC-Libraries/Carolina-Digital-Repository/blob/fcrepo4/access/src/main/webapp/WEB-INF/jsp/fullRecord.jsp#L23-L25\nYou could update that conditional (its still there) to use the variable you are setting in the controller, and then you'd do class=\"column is-narrow-tablet <%= isDeleted %>\" instead of choose statements all over the place.\nI guess that block below it was how it was deciding whether or not to show the lock icon.\nIf you want to stick with the choose statements, we should probably clean up the stuff in fullRecord.jsp\nThese same flags are being set for browseResultEntry.jsp and searchResultEntry.jsp as well. Wonder if those files can be deleted at this point.", "author": "bbpennel", "createdAt": "2020-03-25T21:30:09Z", "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord/fileRecord.jsp", "diffHunk": "@@ -64,7 +69,12 @@\n             </div>\n         </div>\n         <div class=\"columns columns-resize file-info\">\n-            <div class=\"column is-narrow-tablet\">\n+            <c:choose>\n+                <c:when test=\"${markedForDeletion}\">\n+                    <div class=\"column is-narrow-tablet deleted\">", "originalCommit": "b49d454c33dd172eddbc96da14fafe4385bcd55d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI0OTQ2Ng==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398249466", "bodyText": "can remove this", "author": "bbpennel", "createdAt": "2020-03-26T00:25:22Z", "path": "static/js/public/fullRecord.js", "diffHunk": "@@ -156,6 +182,19 @@ define('fullRecord', ['module', 'jquery', 'JP2Viewer', 'StructureView', 'dataTab\n \t\t\treturn \"\";\n \t\t}\n \n+\t\tfunction showBadge(data) {\n+\t\t\tvar markedForDeletion = false;\n+\t\t\tvar restrictedAccess = false;\n+\n+\t\t\tif (data.status !== undefined) {\n+\t\t\t\tvar restrictions = data.status.join(',').toLowerCase();\n+\t\t\t\tmarkedForDeletion = /marked.*?deletion/.test(restrictions);\n+\t\t\t\trestrictedAccess = /embargoed|staff-only/.test(restrictions);\n+\t\t\t}\n+console.log({ markDeleted: markedForDeletion, restricted: restrictedAccess })", "originalCommit": "b49d454c33dd172eddbc96da14fafe4385bcd55d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MDc4NA==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398250784", "bodyText": "status is an array of known values, feels a little weird/roundabout to transform it into a string for searching", "author": "bbpennel", "createdAt": "2020-03-26T00:30:04Z", "path": "static/js/public/fullRecord.js", "diffHunk": "@@ -156,6 +182,19 @@ define('fullRecord', ['module', 'jquery', 'JP2Viewer', 'StructureView', 'dataTab\n \t\t\treturn \"\";\n \t\t}\n \n+\t\tfunction showBadge(data) {\n+\t\t\tvar markedForDeletion = false;\n+\t\t\tvar restrictedAccess = false;\n+\n+\t\t\tif (data.status !== undefined) {\n+\t\t\t\tvar restrictions = data.status.join(',').toLowerCase();", "originalCommit": "b49d454c33dd172eddbc96da14fafe4385bcd55d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU5NDQ4Mw==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398594483", "bodyText": "Yeah, I was using $.array, but it didn't seem to work. I can double check it.", "author": "lfarrell", "createdAt": "2020-03-26T14:00:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MDc4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYxMDI1NQ==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398610255", "bodyText": "Hmm, it does work with $.inArray, but I'm inclined to leave it as is, because with inArray you'd have to test for, I think three conditions for restricted status: Embargoed, Staff-Only Access and Parent Has Staff-Only Access.", "author": "lfarrell", "createdAt": "2020-03-26T14:20:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MDc4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc0NDQ2NQ==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398744465", "bodyText": "okay, we'll just have to be careful to make sure the regexes can't match across statuses in the future, since they aren't paying attention to the commas at present.", "author": "bbpennel", "createdAt": "2020-03-26T17:11:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MDc4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MjE5OA==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398252198", "bodyText": "is this the right class for something that is restricted rather than deleted?", "author": "bbpennel", "createdAt": "2020-03-26T00:35:17Z", "path": "static/js/vue-cdr-access/src/components/browseDisplay.vue", "diffHunk": "@@ -4,9 +4,25 @@\n             <div class=\"column is-12\" >\n                 <ul class=\"column is-12\" v-for=\"records in chunkedRecords\">\n                     <li v-for=\"record in records\" class=\"column\" :class=\"column_size\">\n-                        <a :href=\"recordUrl(record.id, 'gallery-display')\">\n-                            <img v-if=\"thumbnailPresent(record.thumbnail_url)\" :src=\"record.thumbnail_url\" :alt=\"altText(record.title)\" class=\"thumbnail thumbnail-size-large\">\n+                        <a :href=\"recordUrl(record.id, 'gallery-display')\" :class=\"{deleted: markedForDeletion(record)}\">\n+                            <img v-if=\"thumbnailPresent(record.thumbnail_url)\" :src=\"record.thumbnail_url\"\n+                                 :alt=\"altText(record.title)\" class=\"thumbnail thumbnail-size-large\"\n+                                 :class=\"{restricted: markedForDeletion(record) || isRestricted(record)}\">\n                             <i v-else class=\"fa\" :class=\"recordType(record.type)\"></i>\n+                            <div v-if=\"markedForDeletion(record)\" class=\"thumbnail-badge-trash\"\n+                                 :class=\"{'deleted-image-icon': thumbnailPresent(record.thumbnail_url)}\">\n+                                <div class=\"fa-stack\">\n+                                    <i class=\"fa fa-circle fa-stack-2x background\"></i>\n+                                    <i class=\"fa fa-trash fa-stack-1x foreground\"></i>\n+                                </div>\n+                            </div>\n+                            <div v-else-if=\"isRestricted(record)\" class=\"thumbnail-badge-lock\"\n+                                 :class=\"{'deleted-image-icon': thumbnailPresent(record.thumbnail_url)}\">", "originalCommit": "b49d454c33dd172eddbc96da14fafe4385bcd55d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MjMyOQ==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398252329", "bodyText": "same question as in the previous file", "author": "bbpennel", "createdAt": "2020-03-26T00:35:51Z", "path": "static/js/vue-cdr-access/src/components/listDisplay.vue", "diffHunk": "@@ -5,14 +5,31 @@\n                 <ul :class=\"{'margin-offset': isRecordBrowse}\">\n                     <li v-for=\"(record, index) in recordList\" class=\"columns browseitem\" :class=\"{stripe: index % 2 === 0}\">\n                         <div class=\"column is-2\">\n-                            <a :href=\"recordUrl(record.id, linkBrowseType)\">\n-                                <img v-if=\"thumbnailPresent(record.thumbnail_url)\" :src=\"record.thumbnail_url\" :alt=\"altText(record.title)\" class=\"thumbnail thumbnail-size-large\">\n+                            <a :href=\"recordUrl(record.id, linkBrowseType)\" :class=\"{deleted: markedForDeletion(record)}\">\n+                                <img v-if=\"thumbnailPresent(record.thumbnail_url)\" :src=\"record.thumbnail_url\"\n+                                     :alt=\"altText(record.title)\" class=\"thumbnail thumbnail-size-large\">\n                                 <i v-else class=\"fa\" :class=\"recordType(record.type)\"></i>\n+                                <div v-if=\"markedForDeletion(record)\" class=\"thumbnail-badge-trash\"\n+                                     :class=\"{'deleted-image-icon': thumbnailPresent(record.thumbnail_url),\n+                                     'thumbnail-badge-trash-search ': !isRecordBrowse}\">\n+                                    <div class=\"fa-stack\">\n+                                        <i class=\"fa fa-circle fa-stack-2x background\"></i>\n+                                        <i class=\"fa fa-trash fa-stack-1x foreground\"></i>\n+                                    </div>\n+                                </div>\n+                                <div v-else-if=\"isRestricted(record)\" class=\"thumbnail-badge-lock\"\n+                                     :class=\"{'deleted-image-icon': thumbnailPresent(record.thumbnail_url),", "originalCommit": "b49d454c33dd172eddbc96da14fafe4385bcd55d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MzU3Mg==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398253572", "bodyText": "Wouldn't this mark all the neighbors as deleted if the current record is deleted, even if they aren't deleted?", "author": "bbpennel", "createdAt": "2020-03-26T00:40:11Z", "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord/neighborList.jsp", "diffHunk": "@@ -29,7 +29,12 @@\n \t\t\t<c:set var=\"currentItemClass\" scope=\"page\">\n \t\t\t\t<c:if test=\"${briefObject.id == neighbor.id}\"> current_item</c:if>\n \t\t\t</c:set>\n-\t\t\t<div class=\"relateditem ${currentItemClass}\">\n+\t\t\t<c:choose>\n+\t\t\t\t<c:when test=\"${markedForDeletion}\">", "originalCommit": "b49d454c33dd172eddbc96da14fafe4385bcd55d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1NTAwNg==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398255006", "bodyText": "guess I have the same question here about searching as an array", "author": "bbpennel", "createdAt": "2020-03-26T00:45:32Z", "path": "static/js/vue-cdr-access/src/mixins/displayUtils.js", "diffHunk": "@@ -22,6 +22,22 @@ export default {\n \n         altText(title) {\n             return `Thumbnail for ${title}`;\n+        },\n+\n+        markedForDeletion(record) {\n+            return /marked.*?deletion/.test(this.restrictions(record));\n+        },\n+\n+        isRestricted(record) {\n+            return /embargoed|staff-only/.test(this.restrictions(record));\n+        },\n+\n+        restrictions(record) {\n+            if (record.status === undefined) {\n+                return '';\n+            }\n+\n+            return record.status.join(',').toLowerCase();", "originalCommit": "b49d454c33dd172eddbc96da14fafe4385bcd55d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYxMDQ1NA==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398610454", "bodyText": "See, note above", "author": "lfarrell", "createdAt": "2020-03-26T14:21:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1NTAwNg=="}], "type": "inlineReview"}, {"oid": "bb5448935360d9b5f4d6464e7d7904606257b202", "url": "https://github.com/UNC-Libraries/box-c/commit/bb5448935360d9b5f4d6464e7d7904606257b202", "message": "* Move to using existing page variable\n* Remove unused code", "committedDate": "2020-03-26T16:57:18Z", "type": "forcePushed"}, {"oid": "9ae0e500cb65cfa3907b9fc20ed23596f4c1d765", "url": "https://github.com/UNC-Libraries/box-c/commit/9ae0e500cb65cfa3907b9fc20ed23596f4c1d765", "message": "Cleanup files\n\n* Move to using existing page variable\n* Remove unused code", "committedDate": "2020-03-26T16:58:42Z", "type": "commit"}, {"oid": "9ae0e500cb65cfa3907b9fc20ed23596f4c1d765", "url": "https://github.com/UNC-Libraries/box-c/commit/9ae0e500cb65cfa3907b9fc20ed23596f4c1d765", "message": "Cleanup files\n\n* Move to using existing page variable\n* Remove unused code", "committedDate": "2020-03-26T16:58:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODczOTkxNA==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398739914", "bodyText": "i think \"session\" will stick around past the current request. If you need a broader scope than \"page\", i think you can use \"request\" to avoid some potentially weird interference", "author": "bbpennel", "createdAt": "2020-03-26T17:05:10Z", "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord.jsp", "diffHunk": "@@ -20,9 +20,10 @@\n <%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>\n <%@ taglib prefix=\"cdr\" uri=\"http://cdr.lib.unc.edu/cdrUI\" %>\n \n-<c:if test=\"${not empty briefObject && cdr:contains(briefObject.status, 'Deleted') || cdr:contains(briefObject.status, 'Parent Deleted')}\">\n-\t<c:set var=\"isDeleted\" value=\"deleted\" scope=\"page\"/>\n+<c:if test=\"${markedForDeletion}\">\n+\t<c:set var=\"isDeleted\" value=\"deleted\" scope=\"session\"/>", "originalCommit": "9ae0e500cb65cfa3907b9fc20ed23596f4c1d765", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc0MTg0NQ==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398741845", "bodyText": "Why is currentItemClass being added in here now? It doesn't look like anything has changed with the class. Was there a bug?", "author": "bbpennel", "createdAt": "2020-03-26T17:07:55Z", "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord/neighborList.jsp", "diffHunk": "@@ -30,7 +30,7 @@\n \t\t\t\t<c:if test=\"${briefObject.id == neighbor.id}\"> current_item</c:if>\n \t\t\t</c:set>\n \t\t\t<div class=\"relateditem ${currentItemClass}\">\n-\t\t\t\t<div class=\"relatedthumb\">\n+\t\t\t\t<div class=\"relatedthumb ${isDeleted} ${currentItemClass}\">", "originalCommit": "9ae0e500cb65cfa3907b9fc20ed23596f4c1d765", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgxMjIwNQ==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398812205", "bodyText": "Nope, got copy/pasted", "author": "lfarrell", "createdAt": "2020-03-26T18:49:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc0MTg0NQ=="}], "type": "inlineReview"}, {"oid": "dcbace932c6138155d70cc3af4d313b831fa500a", "url": "https://github.com/UNC-Libraries/box-c/commit/dcbace932c6138155d70cc3af4d313b831fa500a", "message": "Change page scope and get rid of class.", "committedDate": "2020-03-26T18:54:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg4NDUxOQ==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398884519", "bodyText": "This is causing all neighbors to appear marked as deleted if the current record is, or all to appear as not marked for deletion if the current record is not marked for deletion. You need to evaluate this state per object.", "author": "bbpennel", "createdAt": "2020-03-26T20:53:04Z", "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord/neighborList.jsp", "diffHunk": "@@ -30,7 +30,7 @@\n \t\t\t\t<c:if test=\"${briefObject.id == neighbor.id}\"> current_item</c:if>\n \t\t\t</c:set>\n \t\t\t<div class=\"relateditem ${currentItemClass}\">\n-\t\t\t\t<div class=\"relatedthumb\">\n+\t\t\t\t<div class=\"relatedthumb ${isDeleted}\">", "originalCommit": "dcbace932c6138155d70cc3af4d313b831fa500a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b29f605b8eb98b73e35f77237d7763f06def692d", "url": "https://github.com/UNC-Libraries/box-c/commit/b29f605b8eb98b73e35f77237d7763f06def692d", "message": "Style and badge fixes", "committedDate": "2020-03-27T15:56:47Z", "type": "commit"}, {"oid": "b4ad7a698fb4766788f0269b3a923485f5d727dd", "url": "https://github.com/UNC-Libraries/box-c/commit/b4ad7a698fb4766788f0269b3a923485f5d727dd", "message": "badge and style updates", "committedDate": "2020-03-27T17:12:59Z", "type": "commit"}, {"oid": "5751b62573dcdb8f51c87de0b6fe2d0bde287a7b", "url": "https://github.com/UNC-Libraries/box-c/commit/5751b62573dcdb8f51c87de0b6fe2d0bde287a7b", "message": "Fix badges for record pages", "committedDate": "2020-03-27T17:38:06Z", "type": "commit"}, {"oid": "91414a5a354e0bea9beb5d7549200747c6f50290", "url": "https://github.com/UNC-Libraries/box-c/commit/91414a5a354e0bea9beb5d7549200747c6f50290", "message": "Move icon location", "committedDate": "2020-03-30T13:22:25Z", "type": "commit"}, {"oid": "829a5b8c9bbb469689c06b9140afdf265b7f45af", "url": "https://github.com/UNC-Libraries/box-c/commit/829a5b8c9bbb469689c06b9140afdf265b7f45af", "message": "* gray out deleted items in browse view\n* update neighbor list display", "committedDate": "2020-03-30T15:55:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg0OTM3OA==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r401849378", "bodyText": "Do you need to set this both here and in thumbnail.jsp? Is it for areas where there aren't thumbnails but we still need the trashcan, like at the top of the collection record page?", "author": "bbpennel", "createdAt": "2020-04-01T19:15:01Z", "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord.jsp", "diffHunk": "@@ -20,14 +20,26 @@\n <%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>\n <%@ taglib prefix=\"cdr\" uri=\"http://cdr.lib.unc.edu/cdrUI\" %>\n \n-<c:if test=\"${not empty briefObject && cdr:contains(briefObject.status, 'Deleted') || cdr:contains(briefObject.status, 'Parent Deleted')}\">\n-\t<c:set var=\"isDeleted\" value=\"deleted\" scope=\"page\"/>\n+<c:if test=\"${markedForDeletion}\">\n+\t<c:set var=\"isDeleted\" value=\"deleted\" scope=\"request\"/>\n </c:if>\n+\n <c:set var=\"allowsPublicAccess\" value=\"${permsHelper.allowsPublicAccess(briefObject)}\" />\n <c:if test=\"${not empty briefObject && (not allowsPublicAccess || not empty briefObject.activeEmbargo)}\">\n \t<c:set var=\"isProtected\" value=\"protected\" scope=\"page\"/>\n </c:if>\n \n+<c:set var=\"badgeIcon\" scope=\"request\">", "originalCommit": "829a5b8c9bbb469689c06b9140afdf265b7f45af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI3OTAxMw==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r402279013", "bodyText": "Unfortunately, yes. It doesn't show up otherwise for things like the collection pages.", "author": "lfarrell", "createdAt": "2020-04-02T12:36:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg0OTM3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg5NzUzMQ==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r401897531", "bodyText": "can't you use the isDeleted variable here? I don't think having any empty class attribute is against any rules", "author": "bbpennel", "createdAt": "2020-04-01T20:43:45Z", "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord/adminUnit.jsp", "diffHunk": "@@ -45,7 +45,21 @@\n     <div id=\"is-admin-unit\" class=\"columns browse-header\">\n         <div class=\"column is-12\">\n             <c:import url=\"fullRecord/navigationBar.jsp\" />\n-            <h2><i class=\"fa fa-university\" aria-hidden=\"true\"></i> <c:out value=\"${briefObject.title}\" /></h2>\n+            \t<c:choose>", "originalCommit": "829a5b8c9bbb469689c06b9140afdf265b7f45af", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkwMDc2Mg==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r401900762", "bodyText": "i think you can use the default page scope for this, you don't need the variable past this point", "author": "bbpennel", "createdAt": "2020-04-01T20:49:56Z", "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord/neighborList.jsp", "diffHunk": "@@ -29,8 +29,18 @@\n \t\t\t<c:set var=\"currentItemClass\" scope=\"page\">\n \t\t\t\t<c:if test=\"${briefObject.id == neighbor.id}\"> current_item</c:if>\n \t\t\t</c:set>\n+\t\t\t<c:set var=\"markedForDeletion\"  value=\"${cdr:contains(neighbor.status, 'Marked For Deletion')}\" scope=\"request\"/>", "originalCommit": "829a5b8c9bbb469689c06b9140afdf265b7f45af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMxMTYwNQ==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r402311605", "bodyText": "Changing the scope here causes the current record's icon to show for all records", "author": "lfarrell", "createdAt": "2020-04-02T13:27:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkwMDc2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMzMDA4Ng==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r402330086", "bodyText": "Changing it to page does? Weird, my understanding is page is for the current file, while request is for all pages in the request:\nhttps://javapapers.com/jsp/explain-the-scope-of-jsp-objects/\nIt would likely be safest to change the name of the variable to something that doesn't overlap with the markedForDeletion variable from the controller, like neighborMarkedForDeletion.", "author": "bbpennel", "createdAt": "2020-04-02T13:52:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkwMDc2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM3MDkwMQ==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r402370901", "bodyText": "Seems like it needs the current setup so the current neighbor can override the controller set icon, changing the variable name results in the issue of all related items getting the same icon, even if they shouldn't. I'm guessing it needs to stay \"request\" so thumbnail.jsp gets the right value.", "author": "lfarrell", "createdAt": "2020-04-02T14:45:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkwMDc2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ5MjA0OA==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r402492048", "bodyText": "Hmm, yeah i guess that makes sense since thumbnail.jsp is receiving this variable from the request rather than as a parameter passed to it explicitly, or a specially named variable just for the thumbnail component. Hopefully we won't have any issues where the state of the last neighbor changes content for the record the neighbor list is embedded in. Luckily its basically the last part of the page right now, so that reduces the chance of this issue. So we can go with this, and switch to passing in a parameter if we end up moving things around later.", "author": "bbpennel", "createdAt": "2020-04-02T17:35:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkwMDc2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkwMTQ0MA==", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r401901440", "bodyText": "this is overriding the other isDeleted value, I'd suggest using a different variable name, like neighborIsDeleted so we don't end up with unintended side effects. Also you can use the page scope for this variable.", "author": "bbpennel", "createdAt": "2020-04-01T20:51:20Z", "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord/neighborList.jsp", "diffHunk": "@@ -29,8 +29,18 @@\n \t\t\t<c:set var=\"currentItemClass\" scope=\"page\">\n \t\t\t\t<c:if test=\"${briefObject.id == neighbor.id}\"> current_item</c:if>\n \t\t\t</c:set>\n+\t\t\t<c:set var=\"markedForDeletion\"  value=\"${cdr:contains(neighbor.status, 'Marked For Deletion')}\" scope=\"request\"/>\n+\t\t\t<c:choose>\n+\t\t\t\t<c:when test=\"${markedForDeletion}\">\n+\t\t\t\t\t<c:set var=\"isDeleted\" value=\"deleted\" scope=\"request\"/>", "originalCommit": "829a5b8c9bbb469689c06b9140afdf265b7f45af", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1d79f79adf4e11d8eebb4fd2b51a5d3a04e1913b", "url": "https://github.com/UNC-Libraries/box-c/commit/1d79f79adf4e11d8eebb4fd2b51a5d3a04e1913b", "message": "Update variable names and file cleanup", "committedDate": "2020-04-02T13:31:08Z", "type": "commit"}]}