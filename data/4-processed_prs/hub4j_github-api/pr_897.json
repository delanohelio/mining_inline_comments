{"pr_number": 897, "pr_title": "add create repo with template support", "pr_createdAt": "2020-07-19T15:12:40Z", "pr_url": "https://github.com/hub4j/github-api/pull/897", "timeline": [{"oid": "9830927020b74bf997044b873037ef12bc238ee9", "url": "https://github.com/hub4j/github-api/commit/9830927020b74bf997044b873037ef12bc238ee9", "message": "add create repo with template support\n\nSigned-off-by: Yang Ting <bonnie.young@maxwit.com>", "committedDate": "2020-07-19T15:07:19Z", "type": "commit"}, {"oid": "b194a19b98c395a48f34875c11f3b53550d7953f", "url": "https://github.com/hub4j/github-api/commit/b194a19b98c395a48f34875c11f3b53550d7953f", "message": "Merge branch 'master' into add-create-repo-with-template-support", "committedDate": "2020-07-20T16:32:52Z", "type": "commit"}, {"oid": "ac470dddb50695bfa9c85ec00d9100d2be4e6bd3", "url": "https://github.com/hub4j/github-api/commit/ac470dddb50695bfa9c85ec00d9100d2be4e6bd3", "message": "Merge branch 'master' into add-create-repo-with-template-support", "committedDate": "2020-07-27T21:14:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgxOTIxNg==", "url": "https://github.com/hub4j/github-api/pull/897#discussion_r462819216", "bodyText": "@bonnie-young  Could you tell me why we need two new constructors?\nCould we add an templateRepository(boolean) method to the builder instead?", "author": "bitwiseman", "createdAt": "2020-07-30T07:59:42Z", "path": "src/main/java/org/kohsuke/github/GHCreateRepositoryBuilder.java", "diffHunk": "@@ -20,6 +22,22 @@\n         this.builder.with(\"name\", name);\n     }\n \n+    GHCreateRepositoryBuilder(GitHub root, String apiUrlTail, String name, Boolean isTemplate) {", "originalCommit": "ac470dddb50695bfa9c85ec00d9100d2be4e6bd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU3OTc1OQ==", "url": "https://github.com/hub4j/github-api/pull/897#discussion_r466579759", "bodyText": "yes, you are right! sorry for my carelessness.", "author": "bonnie-young", "createdAt": "2020-08-06T17:41:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgxOTIxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgyMTQ4MA==", "url": "https://github.com/hub4j/github-api/pull/897#discussion_r462821480", "bodyText": "Similar to my previous comment could we have a fromTemplateRepository(String templateOwner, String templateRepo) method?   I think the create() method could have .withPreview(BAPTISE) set in general without any negative effect, but I could be wrong.", "author": "bitwiseman", "createdAt": "2020-07-30T08:04:08Z", "path": "src/main/java/org/kohsuke/github/GHCreateRepositoryBuilder.java", "diffHunk": "@@ -211,4 +229,15 @@ public GHRepository create() throws IOException {\n         return builder.method(\"POST\").withUrlPath(apiUrlTail).fetch(GHRepository.class).wrap(root);\n     }\n \n+    /**\n+     * Creates a repository with all the parameters, and with Preview BAPTISE for template repo.\n+     *\n+     * @return the gh repository\n+     * @throws IOException\n+     *             if repsitory cannot be created\n+     */\n+    public GHRepository createWithTemplate() throws IOException {", "originalCommit": "ac470dddb50695bfa9c85ec00d9100d2be4e6bd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU5NTEzNA==", "url": "https://github.com/hub4j/github-api/pull/897#discussion_r466595134", "bodyText": "According to the  official doc , I don't think we can add an fromTemplateRepository(String templateOwner, String templateRepo) to the builder, Because templateOwner and templateRepo are parts of the request url not parameters. anyway,  I will try it out, and find the result.\n\"create() method could have .withPreview(BAPTISE) set in general without any negative effect\" \u2014\u2014 I will try it later also, thanks for your idea.", "author": "bonnie-young", "createdAt": "2020-08-06T18:08:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgyMTQ4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgyMzU2MA==", "url": "https://github.com/hub4j/github-api/pull/897#discussion_r462823560", "bodyText": "Ah, I see.  The create from template repository has almost none of the parameters of general repository creation.\nStill I think that limitation is something that could be explained in the javadoc for fromTemplateRepository(String templateOwner, String templateRepo) and include a link to the GitHub docs.\nWhat you've done is good: guiding users to the a non-failure path.  However, in this case, I'd rather reduce the surface area and added code in this library.\nAlso add @Preview and @Deprecated annotations to the methods that call GitHub Preview APIs.", "author": "bitwiseman", "createdAt": "2020-07-30T08:07:52Z", "path": "src/main/java/org/kohsuke/github/GHOrganization.java", "diffHunk": "@@ -100,6 +100,50 @@ public GHCreateRepositoryBuilder createRepository(String name) {\n         return new GHCreateRepositoryBuilder(root, \"/orgs/\" + login + \"/repos\", name);\n     }\n \n+    /**\n+     * Starts a builder that creates a new repository.\n+     *\n+     * <p>\n+     * You use the returned builder to set various properties, then call {@link GHCreateRepositoryBuilder#create()} to\n+     * finally create a repository.\n+     *\n+     * @param name\n+     *            the name\n+     * @param isTemplate\n+     *            the is_template\n+     * @return the gh create repository builder\n+     */\n+    public GHCreateRepositoryBuilder createRepositoryWithParametersIsTemplate(String name, Boolean isTemplate) {\n+        return new GHCreateRepositoryBuilder(root, \"/orgs/\" + login + \"/repos\", name, isTemplate);\n+    }\n+\n+    /**\n+     * Starts a builder that creates a new repository.\n+     *\n+     * <p>\n+     * You use the returned builder to set various properties, then call\n+     * {@link GHCreateRepositoryBuilder#createWithTemplate()} to finally create a repository.\n+     *\n+     * @param templateOwner\n+     *            the owner of template repository\n+     * @param templateRepo\n+     *            the template repository\n+     * @param name\n+     *            the name of repository to be created\n+     * @param owner\n+     *            the organization of repository to be created\n+     * @return the gh create repository builder\n+     */\n+    public GHCreateRepositoryBuilder createRepositoryWithTemplate(String templateRepo,", "originalCommit": "ac470dddb50695bfa9c85ec00d9100d2be4e6bd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYwMTMyMg==", "url": "https://github.com/hub4j/github-api/pull/897#discussion_r466601322", "bodyText": "\u201cAlso add @Preview and @deprecated annotations to the methods that call GitHub Preview APIs.\u201d \u2014\u2014 I see. Thank you for reminding me. But I don't know why need to add the @deprecated annotation.", "author": "bonnie-young", "createdAt": "2020-08-06T18:19:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgyMzU2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzU5MjE2OQ==", "url": "https://github.com/hub4j/github-api/pull/897#discussion_r467592169", "bodyText": "\u201cAlso add @Preview and @deprecated annotations to the methods that call GitHub Preview APIs.\u201d \u2014\u2014 I see. Thank you for reminding me. But I don't know why need to add the @deprecated annotation.\n\nI found the answer from oracle official doc:\nWhen to Deprecate\nWhen you design an API, carefully consider whether it supersedes an old API. If it does, and you wish to encourage developers (users of the API) to migrate to the new API, then deprecate the old API. Valid reasons to deprecate an API include:\n\nIt is insecure, buggy, or highly inefficient (I got  this point)\nIt is going away in a future release\nIt encourages bad coding practices", "author": "bonnie-young", "createdAt": "2020-08-09T14:44:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgyMzU2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgyNTE5Mg==", "url": "https://github.com/hub4j/github-api/pull/897#discussion_r462825192", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    GHRepository repository = org.createRepositoryWithParametersIsTemplate(GITHUB_API_TEMPLATE_TEST, true)\n          \n          \n            \n                            .description(\"a test template repository used to test kohsuke's github-api\")\n          \n          \n            \n                    GHRepository repository = org.createRepository(GITHUB_API_TEMPLATE_TEST)\n          \n          \n            \n                            .templateRepository(true)\n          \n          \n            \n                            .description(\"a test template repository used to test kohsuke's github-api\")", "author": "bitwiseman", "createdAt": "2020-07-30T08:10:46Z", "path": "src/test/java/org/kohsuke/github/GHOrganizationTest.java", "diffHunk": "@@ -56,6 +57,38 @@ public void testCreateRepositoryWithAutoInitialization() throws IOException {\n         Assert.assertNotNull(repository.getReadme());\n     }\n \n+    @Test\n+    public void testCreateRepositoryWithParametersIsTemplate() throws IOException {\n+        cleanupRepository(GITHUB_API_TEST_ORG + '/' + GITHUB_API_TEMPLATE_TEST);\n+\n+        GHOrganization org = gitHub.getOrganization(GITHUB_API_TEST_ORG);\n+        GHRepository repository = org.createRepositoryWithParametersIsTemplate(GITHUB_API_TEMPLATE_TEST, true)\n+                .description(\"a test template repository used to test kohsuke's github-api\")", "originalCommit": "ac470dddb50695bfa9c85ec00d9100d2be4e6bd3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgyNjk3MA==", "url": "https://github.com/hub4j/github-api/pull/897#discussion_r462826970", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    GHRepository repository = org\n          \n          \n            \n                            .createRepositoryWithTemplate(GITHUB_API_TEMPLATE_TEST,\n          \n          \n            \n                                    GITHUB_API_TEST_ORG,\n          \n          \n            \n                                    GITHUB_API_TEST,\n          \n          \n            \n                                    GITHUB_API_TEST_ORG)\n          \n          \n            \n                            .createWithTemplate();\n          \n          \n            \n                    GHRepository repository = org.createRepository(GITHUB_API_TEST) \n          \n          \n            \n                            .owner(GITHUB_API_TEST_ORG)\n          \n          \n            \n                            .fromTemplateRepository(GITHUB_API_TEST_ORG, GITHUB_API_TEMPLATE_TEST)\n          \n          \n            \n                            .create();", "author": "bitwiseman", "createdAt": "2020-07-30T08:14:00Z", "path": "src/test/java/org/kohsuke/github/GHOrganizationTest.java", "diffHunk": "@@ -56,6 +57,38 @@ public void testCreateRepositoryWithAutoInitialization() throws IOException {\n         Assert.assertNotNull(repository.getReadme());\n     }\n \n+    @Test\n+    public void testCreateRepositoryWithParametersIsTemplate() throws IOException {\n+        cleanupRepository(GITHUB_API_TEST_ORG + '/' + GITHUB_API_TEMPLATE_TEST);\n+\n+        GHOrganization org = gitHub.getOrganization(GITHUB_API_TEST_ORG);\n+        GHRepository repository = org.createRepositoryWithParametersIsTemplate(GITHUB_API_TEMPLATE_TEST, true)\n+                .description(\"a test template repository used to test kohsuke's github-api\")\n+                .homepage(\"http://github-api.kohsuke.org/\")\n+                .team(org.getTeamByName(\"Core Developers\"))\n+                .autoInit(true)\n+                .create();\n+\n+        Assert.assertNotNull(repository);\n+        Assert.assertNotNull(repository.getReadme());\n+    }\n+\n+    @Test\n+    public void testCreateRepositoryWithTemplate() throws IOException {\n+        cleanupRepository(GITHUB_API_TEST_ORG + '/' + GITHUB_API_TEST);\n+\n+        GHOrganization org = gitHub.getOrganization(GITHUB_API_TEST_ORG);\n+        GHRepository repository = org\n+                .createRepositoryWithTemplate(GITHUB_API_TEMPLATE_TEST,\n+                        GITHUB_API_TEST_ORG,\n+                        GITHUB_API_TEST,\n+                        GITHUB_API_TEST_ORG)\n+                .createWithTemplate();", "originalCommit": "ac470dddb50695bfa9c85ec00d9100d2be4e6bd3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bb4d44138ab06d63faff3c86eb8d6ea190eb41a5", "url": "https://github.com/hub4j/github-api/commit/bb4d44138ab06d63faff3c86eb8d6ea190eb41a5", "message": "Merge branch 'master' into add-create-repo-with-template-support", "committedDate": "2020-08-04T23:05:02Z", "type": "commit"}, {"oid": "eb33cd616218db93b8c7495e2f304432a99b6c5a", "url": "https://github.com/hub4j/github-api/commit/eb33cd616218db93b8c7495e2f304432a99b6c5a", "message": "update code for create repository from template\n\nSigned-off-by: Yang Ting <bonnie.young@maxwit.com>", "committedDate": "2020-08-09T09:37:46Z", "type": "forcePushed"}, {"oid": "a2bc5c6c7018a66327e196f065c4182381883d46", "url": "https://github.com/hub4j/github-api/commit/a2bc5c6c7018a66327e196f065c4182381883d46", "message": "update code for create repository from template\n\nSigned-off-by: Yang Ting <bonnie.young@maxwit.com>", "committedDate": "2020-08-09T09:48:04Z", "type": "forcePushed"}, {"oid": "5e703be2bb25bbe83f30d9a37e6607f352cfe46f", "url": "https://github.com/hub4j/github-api/commit/5e703be2bb25bbe83f30d9a37e6607f352cfe46f", "message": "update code for create repository from template\n\nSigned-off-by: Yang Ting <bonnie.young@maxwit.com>", "committedDate": "2020-08-10T03:47:20Z", "type": "forcePushed"}, {"oid": "6afd248f866bd580fa96b2c8b06f06d4c6ae0788", "url": "https://github.com/hub4j/github-api/commit/6afd248f866bd580fa96b2c8b06f06d4c6ae0788", "message": "update code for create repository from template\n\nSigned-off-by: Yang Ting <bonnie.young@maxwit.com>", "committedDate": "2020-08-12T13:51:02Z", "type": "forcePushed"}, {"oid": "11bc669e1ded47b8cc1ddaf16be2a14f56ddf022", "url": "https://github.com/hub4j/github-api/commit/11bc669e1ded47b8cc1ddaf16be2a14f56ddf022", "message": "update code for create repository from template\n\nSigned-off-by: Yang Ting <bonnie.young@maxwit.com>", "committedDate": "2020-08-12T14:08:31Z", "type": "commit"}, {"oid": "11bc669e1ded47b8cc1ddaf16be2a14f56ddf022", "url": "https://github.com/hub4j/github-api/commit/11bc669e1ded47b8cc1ddaf16be2a14f56ddf022", "message": "update code for create repository from template\n\nSigned-off-by: Yang Ting <bonnie.young@maxwit.com>", "committedDate": "2020-08-12T14:08:31Z", "type": "forcePushed"}]}