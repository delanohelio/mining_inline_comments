{"pr_number": 3565, "pr_title": "Issue 3561/add option to share webform", "pr_createdAt": "2020-05-20T13:18:54Z", "pr_url": "https://github.com/akvo/akvo-flow/pull/3565", "timeline": [{"oid": "16e317945cf0f41af91c3fc988d36f2857d61dfa", "url": "https://github.com/akvo/akvo-flow/commit/16e317945cf0f41af91c3fc988d36f2857d61dfa", "message": "[#3561] - add component for share button", "committedDate": "2020-05-18T14:11:24Z", "type": "commit"}, {"oid": "372a70040c9b6875acdf65729a6c454488568d92", "url": "https://github.com/akvo/akvo-flow/commit/372a70040c9b6875acdf65729a6c454488568d92", "message": "[#3561] - design modal container and header", "committedDate": "2020-05-18T15:28:04Z", "type": "commit"}, {"oid": "72a2d905fdfc46075f0925a7586f673bda679ab1", "url": "https://github.com/akvo/akvo-flow/commit/72a2d905fdfc46075f0925a7586f673bda679ab1", "message": "[#3561] - design share modal and add clipboard functionality", "committedDate": "2020-05-19T09:47:45Z", "type": "commit"}, {"oid": "e961bb0613c3937060cc5367ab1416c3e74044d8", "url": "https://github.com/akvo/akvo-flow/commit/e961bb0613c3937060cc5367ab1416c3e74044d8", "message": "[#3561] - add form validation", "committedDate": "2020-05-19T13:05:47Z", "type": "commit"}, {"oid": "6e48595f3041a7e04ef59d2120aa4c162f590c47", "url": "https://github.com/akvo/akvo-flow/commit/6e48595f3041a7e04ef59d2120aa4c162f590c47", "message": "Merge remote-tracking branch 'origin/issue-3562' into issue-3561/add-option-to-share-webform", "committedDate": "2020-05-20T10:40:33Z", "type": "commit"}, {"oid": "4e2962179b9fa207e89f7d0795c6d1b33c81a9f9", "url": "https://github.com/akvo/akvo-flow/commit/4e2962179b9fa207e89f7d0795c6d1b33c81a9f9", "message": "[3561] - fetch webform id from backend", "committedDate": "2020-05-20T13:15:35Z", "type": "commit"}, {"oid": "c0d6f058013691561edcf7ac1fd74097dc615968", "url": "https://github.com/akvo/akvo-flow/commit/c0d6f058013691561edcf7ac1fd74097dc615968", "message": "[#3561] - add full webform url", "committedDate": "2020-05-20T13:29:24Z", "type": "commit"}, {"oid": "957b1c0a7866965b7a32ec855ed1ec0cd6924803", "url": "https://github.com/akvo/akvo-flow/commit/957b1c0a7866965b7a32ec855ed1ec0cd6924803", "message": "Merge branch 'master' into issue-3561/add-option-to-share-webform", "committedDate": "2020-05-21T11:52:12Z", "type": "commit"}, {"oid": "366ea6072d676141171aaa19db4c2bb93c0557d1", "url": "https://github.com/akvo/akvo-flow/commit/366ea6072d676141171aaa19db4c2bb93c0557d1", "message": "[#3561] - show loading when webform id isn't yet loaded", "committedDate": "2020-05-21T12:10:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYxNzI2OQ==", "url": "https://github.com/akvo/akvo-flow/pull/3565#discussion_r428617269", "bodyText": "remove comment and improve format", "author": "tangrammer", "createdAt": "2020-05-21T12:19:33Z", "path": "Dashboard/app/js/lib/views/surveys/form-share.jsx", "diffHunk": "@@ -0,0 +1,95 @@\n+/* eslint-disable import/no-unresolved */\n+import React from 'react';\n+import observe from 'akvo-flow/mixins/observe';\n+import WebFormShare from 'akvo-flow/components/forms/form-share';\n+\n+require('akvo-flow/views/react-component');\n+\n+FLOW.WebFormShareView = FLOW.ReactComponentView.extend(\n+  observe({\n+    'FLOW.selectedControl.selectedSurvey.status': 'formValidation',\n+    'FLOW.selectedControl.selectedSurveyGroup.monitoringGroup': 'formValidation',\n+    'FLOW.questionControl.content.isLoaded': 'formValidation',\n+    'FLOW.questionGroupControl.content.isLoaded': 'formValidation',\n+    'FLOW.surveyControl.webformId': 'renderReactSide',\n+  }),\n+  {\n+    init() {\n+      this._super();\n+      this.formValidation = this.formValidation.bind(this);\n+      this.renderReactSide = this.renderReactSide.bind(this);\n+      this.getProps = this.getProps.bind(this);\n+      this.getShareURL = this.getShareURL.bind(this);\n+\n+      this.valid = false;\n+    },\n+\n+    didInsertElement(...args) {\n+      this._super(...args);\n+\n+      // call validate on init", "originalCommit": "366ea6072d676141171aaa19db4c2bb93c0557d1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYyNzA0Mw==", "url": "https://github.com/akvo/akvo-flow/pull/3565#discussion_r428627043", "bodyText": "backend side also checks for CASCADE type https://github.com/akvo/akvo-flow/pull/3564/files#diff-0b87b53604405485c8652761c8c3f11eR28 ... is that correct? @muloem", "author": "tangrammer", "createdAt": "2020-05-21T12:41:20Z", "path": "Dashboard/app/js/lib/views/surveys/form-share.jsx", "diffHunk": "@@ -0,0 +1,95 @@\n+/* eslint-disable import/no-unresolved */\n+import React from 'react';\n+import observe from 'akvo-flow/mixins/observe';\n+import WebFormShare from 'akvo-flow/components/forms/form-share';\n+\n+require('akvo-flow/views/react-component');\n+\n+FLOW.WebFormShareView = FLOW.ReactComponentView.extend(\n+  observe({\n+    'FLOW.selectedControl.selectedSurvey.status': 'formValidation',\n+    'FLOW.selectedControl.selectedSurveyGroup.monitoringGroup': 'formValidation',\n+    'FLOW.questionControl.content.isLoaded': 'formValidation',\n+    'FLOW.questionGroupControl.content.isLoaded': 'formValidation',\n+    'FLOW.surveyControl.webformId': 'renderReactSide',\n+  }),\n+  {\n+    init() {\n+      this._super();\n+      this.formValidation = this.formValidation.bind(this);\n+      this.renderReactSide = this.renderReactSide.bind(this);\n+      this.getProps = this.getProps.bind(this);\n+      this.getShareURL = this.getShareURL.bind(this);\n+\n+      this.valid = false;\n+    },\n+\n+    didInsertElement(...args) {\n+      this._super(...args);\n+\n+      // call validate on init\n+      this.formValidation();\n+\n+      this.renderReactSide();\n+    },\n+\n+    // react side\n+    renderReactSide() {\n+      const props = this.getProps();\n+      this.reactRender(<WebFormShare {...props} />);\n+    },\n+\n+    getProps() {\n+      return {\n+        strings: {},\n+        data: {\n+          valid: this.valid,\n+          shareUrl:\n+            FLOW.surveyControl.webformId &&\n+            `${window.location.origin}/webforms/${FLOW.surveyControl.webformId}`,\n+        },\n+        actions: {\n+          getShareURL: this.getShareURL,\n+        },\n+      };\n+    },\n+\n+    formValidation() {\n+      const selectedForm = FLOW.selectedControl.get('selectedSurvey');\n+      const selectedSurveyGroup = FLOW.selectedControl.get('selectedSurveyGroup');\n+      const questions = FLOW.questionControl.get('content');\n+      const questionGroups = FLOW.questionGroupControl.get('content');\n+\n+      // case 1 is form published?\n+      const isPublished = selectedForm.get('status') === 'PUBLISHED';\n+\n+      // case 2 is not monitoring\n+      const isNotMonitoring = selectedSurveyGroup.get('monitoringGroup') === false;\n+\n+      // case 3 does not have illegal question type\n+      const noIllegalQuestion =\n+        questions.some(question => {\n+          switch (question.get('type')) {\n+            case 'CADDISFLY':\n+              return true;\n+            case 'SIGNATURE':\n+              return true;\n+            case 'GEOSHAPE':", "originalCommit": "366ea6072d676141171aaa19db4c2bb93c0557d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYyOTcxNQ==", "url": "https://github.com/akvo/akvo-flow/pull/3565#discussion_r428629715", "bodyText": "True. That one slipped by me! \ud83e\udd26  Cascade is supported!\n#3145 (comment)", "author": "muloem", "createdAt": "2020-05-21T12:47:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYyNzA0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYzMTcwNw==", "url": "https://github.com/akvo/akvo-flow/pull/3565#discussion_r428631707", "bodyText": "Huh, supported or not supported?", "author": "marvinkome", "createdAt": "2020-05-21T12:51:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYyNzA0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYzMjY0Mw==", "url": "https://github.com/akvo/akvo-flow/pull/3565#discussion_r428632643", "bodyText": "Webforms can render cascade questions correctly so no need to disable sharing if there is a cascade question.", "author": "muloem", "createdAt": "2020-05-21T12:53:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYyNzA0Mw=="}], "type": "inlineReview"}, {"oid": "65ea429b3dc4c5de623ea910fc5f53e73ca6ce63", "url": "https://github.com/akvo/akvo-flow/commit/65ea429b3dc4c5de623ea910fc5f53e73ca6ce63", "message": "[#3561] - remove comment and blank lines", "committedDate": "2020-05-21T13:55:51Z", "type": "commit"}]}