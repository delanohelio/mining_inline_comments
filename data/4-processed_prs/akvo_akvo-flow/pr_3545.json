{"pr_number": 3545, "pr_title": "Issue 3509/track assignment usage", "pr_createdAt": "2020-04-27T12:38:06Z", "pr_url": "https://github.com/akvo/akvo-flow/pull/3545", "timeline": [{"oid": "532dfebeb6005bd03ef5563e3a2c0108a31a3373", "url": "https://github.com/akvo/akvo-flow/commit/532dfebeb6005bd03ef5563e3a2c0108a31a3373", "message": "[#3509] - add tracking method", "committedDate": "2020-04-22T18:23:18Z", "type": "commit"}, {"oid": "b6178f5b40aadec448da85e74e8f9ce9cdf5f0b7", "url": "https://github.com/akvo/akvo-flow/commit/b6178f5b40aadec448da85e74e8f9ce9cdf5f0b7", "message": "[#3509] - adding tracker on assignment page", "committedDate": "2020-04-27T12:31:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3ODIwNw==", "url": "https://github.com/akvo/akvo-flow/pull/3545#discussion_r415778207", "bodyText": "Let's always use https, so const u = 'https://akvo.piwikpro.com'.\nProtocol relative URL are an anti-pattern now - https://www.paulirish.com/2010/the-protocol-relative-url/", "author": "iperdomo", "createdAt": "2020-04-27T12:41:46Z", "path": "Dashboard/app/js/lib/analytics.js", "diffHunk": "@@ -1,20 +1,41 @@\n-const _paq = window._paq || [];\n-_paq.push(['setDocumentTitle', `${document.domain}/${document.title}`]);\n-_paq.push(['setCookieDomain', '*.akvoflow.org']);\n-_paq.push(['setDomains', ['*.akvoflow.org']]);\n-_paq.push(['trackPageView']);\n-_paq.push(['enableLinkTracking']);\n+export function init() {\n+  window._paq = window._paq || [];\n \n-(function () {\n-  const u = `${(document.location.protocol == 'https:') ? 'https' : 'http'}://analytics.akvo.org/`;\n-  _paq.push(['setTrackerUrl', `${u}piwik.php`]);\n-  _paq.push(['setSiteId', '10']);\n-  const d = document;\n-  const g = d.createElement('script');\n-  const s = d.getElementsByTagName('script')[0];\n-  g.type = 'text/javascript';\n-  g.defer = true;\n-  g.async = true;\n-  g.src = `${u}piwik.js`;\n-  s.parentNode.insertBefore(g, s);\n-}());\n+  window._paq.push(['setDocumentTitle', `${document.domain}/${document.title}`]);\n+  window._paq.push(['setCookieDomain', '*.akvoflow.org']);\n+  window._paq.push(['setDomains', ['*.akvoflow.org']]);\n+  window._paq.push(['enableLinkTracking']);\n+\n+  (function() {\n+    const u =\n+      document.location.protocol === 'https:'\n+        ? 'https://akvo.piwikpro.com/'\n+        : 'http://analytics.akvo.org/';", "originalCommit": "b6178f5b40aadec448da85e74e8f9ce9cdf5f0b7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3ODY1Mw==", "url": "https://github.com/akvo/akvo-flow/pull/3545#discussion_r415778653", "bodyText": "Let's use {} in our if statements.", "author": "iperdomo", "createdAt": "2020-04-27T12:42:27Z", "path": "Dashboard/app/js/lib/analytics.js", "diffHunk": "@@ -1,20 +1,41 @@\n-const _paq = window._paq || [];\n-_paq.push(['setDocumentTitle', `${document.domain}/${document.title}`]);\n-_paq.push(['setCookieDomain', '*.akvoflow.org']);\n-_paq.push(['setDomains', ['*.akvoflow.org']]);\n-_paq.push(['trackPageView']);\n-_paq.push(['enableLinkTracking']);\n+export function init() {\n+  window._paq = window._paq || [];\n \n-(function () {\n-  const u = `${(document.location.protocol == 'https:') ? 'https' : 'http'}://analytics.akvo.org/`;\n-  _paq.push(['setTrackerUrl', `${u}piwik.php`]);\n-  _paq.push(['setSiteId', '10']);\n-  const d = document;\n-  const g = d.createElement('script');\n-  const s = d.getElementsByTagName('script')[0];\n-  g.type = 'text/javascript';\n-  g.defer = true;\n-  g.async = true;\n-  g.src = `${u}piwik.js`;\n-  s.parentNode.insertBefore(g, s);\n-}());\n+  window._paq.push(['setDocumentTitle', `${document.domain}/${document.title}`]);\n+  window._paq.push(['setCookieDomain', '*.akvoflow.org']);\n+  window._paq.push(['setDomains', ['*.akvoflow.org']]);\n+  window._paq.push(['enableLinkTracking']);\n+\n+  (function() {\n+    const u =\n+      document.location.protocol === 'https:'\n+        ? 'https://akvo.piwikpro.com/'\n+        : 'http://analytics.akvo.org/';\n+\n+    window._paq.push(['setTrackerUrl', `${u}ppms.php`]);\n+    window._paq.push(['setSiteId', '2eb02fff-08a4-4973-ae92-fb4ae6157da4']);\n+\n+    const d = document;\n+    const g = d.createElement('script');\n+    const s = d.getElementsByTagName('script')[0];\n+    g.type = 'text/javascript';\n+    g.async = true;\n+    g.defer = true;\n+    g.src = `${u}ppms.js`;\n+    s.parentNode.insertBefore(g, s);\n+  })();\n+}\n+\n+export const trackEvent = (eventType, ...values) => {\n+  if (typeof window._paq !== 'undefined') window._paq.push(['trackEvent', eventType, ...values]);", "originalCommit": "b6178f5b40aadec448da85e74e8f9ce9cdf5f0b7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8771c93ad4a4ac3b2d8a1936f65ab49d57ca997c", "url": "https://github.com/akvo/akvo-flow/commit/8771c93ad4a4ac3b2d8a1936f65ab49d57ca997c", "message": "[#3509] - minor code changes", "committedDate": "2020-04-27T12:46:31Z", "type": "commit"}, {"oid": "e4facf3aa4a7fffc46ddc38c3f40ae47f383eeec", "url": "https://github.com/akvo/akvo-flow/commit/e4facf3aa4a7fffc46ddc38c3f40ae47f383eeec", "message": "[#3509] - use shorter action names for tracking", "committedDate": "2020-04-27T13:20:08Z", "type": "commit"}]}