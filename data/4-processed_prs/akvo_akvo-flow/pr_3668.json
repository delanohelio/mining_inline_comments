{"pr_number": 3668, "pr_title": "[#3624] - add a basic text to tell user if he/she is offline", "pr_createdAt": "2020-11-17T08:31:41Z", "pr_url": "https://github.com/akvo/akvo-flow/pull/3668", "timeline": [{"oid": "aa97b2079b10f1a140fe45e429f085a4ef8b73ed", "url": "https://github.com/akvo/akvo-flow/commit/aa97b2079b10f1a140fe45e429f085a4ef8b73ed", "message": "[#3624] - add a basic text to tell user if he/she is offline\n\nThis is a simple implementation of using navigator.onLine.\n\nIt wouldn't work on some older browsers, but we would handle this edge case\n in future modifications", "committedDate": "2020-11-17T08:29:26Z", "type": "commit"}, {"oid": "ea90934183c19c66223fa3c8589dcbe326df8af1", "url": "https://github.com/akvo/akvo-flow/commit/ea90934183c19c66223fa3c8589dcbe326df8af1", "message": "[#3624] - ping gogle every 5 seconds for internet status.", "committedDate": "2020-11-18T05:01:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgxNjU4OA==", "url": "https://github.com/akvo/akvo-flow/pull/3668#discussion_r525816588", "bodyText": "https://stackoverflow.com/questions/58518098/fetch-request-to-httpswww-google-com-fails-obviously-with-cors#comment103363447_58518361\nThis explains this line", "author": "marvinkome", "createdAt": "2020-11-18T05:03:00Z", "path": "Dashboard/app/js/lib/components/reusable/OfflineIndicator/index.jsx", "diffHunk": "@@ -0,0 +1,31 @@\n+import React from 'react';\n+\n+export default class OfflineIndicator extends React.Component {\n+  state = {\n+    isOffline: false,\n+  };\n+\n+  componentDidMount() {\n+    this.timer = setInterval(() => {\n+      fetch('https://www.google.com/generate_204', { mode: 'no-cors' })\n+        .then(res => {\n+          // with no-cors, res.status is 0 because the javascript ignores all response.\n+          // we don't need the response, all we need to know is if the request went through or not\n+          if (res.status !== 204) {\n+            this.setState({ isOffline: false });\n+          }", "originalCommit": "ea90934183c19c66223fa3c8589dcbe326df8af1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgxODQ5Mw==", "url": "https://github.com/akvo/akvo-flow/pull/3668#discussion_r525818493", "bodyText": "We want to check if the status is 204? res.status === 204 right?", "author": "iperdomo", "createdAt": "2020-11-18T05:10:08Z", "path": "Dashboard/app/js/lib/components/reusable/OfflineIndicator/index.jsx", "diffHunk": "@@ -6,19 +6,25 @@ export default class OfflineIndicator extends React.Component {\n   };\n \n   componentDidMount() {\n-    window.addEventListener('online', this.onlineStatus);\n-    window.addEventListener('offline', this.onlineStatus);\n+    this.timer = setInterval(() => {\n+      fetch('https://www.google.com/generate_204', { mode: 'no-cors' })\n+        .then(res => {\n+          // with no-cors, res.status is 0 because the javascript ignores all response.\n+          // we don't need the response, all we need to know is if the request went through or not\n+          if (res.status !== 204) {", "originalCommit": "ea90934183c19c66223fa3c8589dcbe326df8af1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgyNTUzMA==", "url": "https://github.com/akvo/akvo-flow/pull/3668#discussion_r525825530", "bodyText": "OK, i tested it, then if we know that res.status is 0, we should check for that? res.status === 0 ?", "author": "iperdomo", "createdAt": "2020-11-18T05:35:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgxODQ5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgyODI3Nw==", "url": "https://github.com/akvo/akvo-flow/pull/3668#discussion_r525828277", "bodyText": "So either check for res.status === 0 or remove the whole if block, since we don't want to check the status", "author": "iperdomo", "createdAt": "2020-11-18T05:44:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgxODQ5Mw=="}], "type": "inlineReview"}, {"oid": "750c0cd910c0c0f31f4b18a66ced314d58c9d05d", "url": "https://github.com/akvo/akvo-flow/commit/750c0cd910c0c0f31f4b18a66ced314d58c9d05d", "message": "[#3624] - remove redundant if statement", "committedDate": "2020-11-18T07:08:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTg5MTk4MQ==", "url": "https://github.com/akvo/akvo-flow/pull/3668#discussion_r525891981", "bodyText": "@marvinkome what about translations of this messages?", "author": "iperdomo", "createdAt": "2020-11-18T08:19:44Z", "path": "Dashboard/app/js/lib/components/reusable/OfflineIndicator/index.jsx", "diffHunk": "@@ -0,0 +1,27 @@\n+import React from 'react';\n+\n+export default class OfflineIndicator extends React.Component {\n+  state = {\n+    isOffline: false,\n+  };\n+\n+  componentDidMount() {\n+    this.timer = setInterval(() => {\n+      fetch('https://www.google.com/generate_204', { mode: 'no-cors' })\n+        .then(() => {\n+          this.setState({ isOffline: false });\n+        })\n+        .catch(() => {\n+          this.setState({ isOffline: true });\n+        });\n+    }, 5000);\n+  }\n+\n+  componentWillUnmount() {\n+    clearInterval(this.timer);\n+  }\n+\n+  render() {\n+    return this.state.isOffline && <p>You are offline. Changes {\"won't\"} be saved</p>;", "originalCommit": "750c0cd910c0c0f31f4b18a66ced314d58c9d05d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}