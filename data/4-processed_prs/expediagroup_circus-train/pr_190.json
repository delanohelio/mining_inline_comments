{"pr_number": 190, "pr_title": "Add developers md", "pr_createdAt": "2020-06-26T16:16:28Z", "pr_url": "https://github.com/ExpediaGroup/circus-train/pull/190", "timeline": [{"oid": "e722fc3443982737458d6355d508f14e827b1fb1", "url": "https://github.com/ExpediaGroup/circus-train/commit/e722fc3443982737458d6355d508f14e827b1fb1", "message": "Added DEVELOPERS.md", "committedDate": "2020-06-26T15:12:13Z", "type": "commit"}, {"oid": "a47180d0a8a5db4992608cae6b1d5f87d72eae1f", "url": "https://github.com/ExpediaGroup/circus-train/commit/a47180d0a8a5db4992608cae6b1d5f87d72eae1f", "message": "Changed some formatting", "committedDate": "2020-06-26T15:42:06Z", "type": "commit"}, {"oid": "3dd2f3403de2d055b3ac1d73bd477330838e8c8e", "url": "https://github.com/ExpediaGroup/circus-train/commit/3dd2f3403de2d055b3ac1d73bd477330838e8c8e", "message": "Changed some formatting", "committedDate": "2020-06-26T16:04:45Z", "type": "commit"}, {"oid": "d73e9c31dc267956e1c0f96030d80635f0e18a36", "url": "https://github.com/ExpediaGroup/circus-train/commit/d73e9c31dc267956e1c0f96030d80635f0e18a36", "message": "Refining wording", "committedDate": "2020-06-26T16:14:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI4NDg5Mw==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r446284893", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * S3 \u2192 S3,  uses `S3S3Copier`\n          \n          \n            \n               * S3 \u2192 S3,  uses `S3S3Copier`\n          \n          \n            \n                  * Note: If you are replicating S3 \u2192 S3 cross account, *and* you want to assume a role in the target account (see `copier-options.assume-role` in `README.md`), then you must use `S3MapreduceCpCopier`.\n          \n      \n    \n    \n  \n\nI suggest to add a note on cross-account/assume-role requirements.", "author": "barnharts4", "createdAt": "2020-06-26T16:25:45Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,122 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+\n+\n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but it not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`", "originalCommit": "d73e9c31dc267956e1c0f96030d80635f0e18a36", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI5MTkyMg==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r446291922", "bodyText": "Great idea. Thanks for these suggestions!", "author": "JayGreeeen", "createdAt": "2020-06-26T16:39:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI4NDg5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI5MzM5MQ==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r446293391", "bodyText": "Except my comment might be completely wrong based on the question I asked further down.  If S3S3Copier can assume a role in the target, and that assumed role does NOT need read permissions on the source, then my statement above is both unnecessary and incorrect.", "author": "barnharts4", "createdAt": "2020-06-26T16:42:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI4NDg5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI4NTc4OA==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r446285788", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This replication mode behaves in the same was as `FULL` however, any existing replica table and its underlying data will first be deleted before being replaced with the source table and data. \n          \n          \n            \n            This replication mode behaves in the same was as `FULL`; however, any existing replica table and its underlying data will first be deleted before being replaced with the source table and data.", "author": "barnharts4", "createdAt": "2020-06-26T16:27:37Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,122 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+\n+\n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but it not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n+\n+**Unpartitioned** \n+\n+All data from the source is copied over to the replica table, then the metadata is updated.\n+\n+\n+### Full Overwrite Replication\n+This replication mode behaves in the same was as `FULL` however, any existing replica table and its underlying data will first be deleted before being replaced with the source table and data. ", "originalCommit": "d73e9c31dc267956e1c0f96030d80635f0e18a36", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI4ODAzNw==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r446288037", "bodyText": "Is this true?  When you added assume-role to the S3S3Copier, were you able to test assuming a role into the target account?  @KenFigueiredo and I were unable to get it to work - the role being assumed also needed S3 READ permissions on the source account in order for us to use S3S3Copier cross-account.  If we were doing something wrong, please let us know, since this is a use-case we are very interested in.", "author": "barnharts4", "createdAt": "2020-06-26T16:31:58Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,122 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+\n+\n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but it not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n+\n+**Unpartitioned** \n+\n+All data from the source is copied over to the replica table, then the metadata is updated.\n+\n+\n+### Full Overwrite Replication\n+This replication mode behaves in the same was as `FULL` however, any existing replica table and its underlying data will first be deleted before being replaced with the source table and data. \n+\n+This mode is useful in the early stages of lifecycle when incompatible schema changes are made. \n+\n+A `DataManipulator` is used to handle the deleting of data. Determining which manipulator to use is handled in the same manner as the [Copier](#copiers), in that there is a `DataManipulatorFactoryManager` which will give a suitable `DataManipulatorFactory` that will return a `DataManipulator` object. \n+\n+### Metadata Mirror Replication \n+Only metadata will be copied (mirrored) from the source to the replica. Replica metadata will not be modified so your source and replica will have the same data location.\n+\n+*NOTE:* The replica table will be marked as `EXTERNAL`. This is done to prevent accidental data loss when dropping the replica. \n+\n+For example, this can be used for copying someone else's metadata into your Hive Metastore without copying the data or to replicate a view. You still need to have access to the data in order to query it.\n+\n+### Metadata Update Replication\n+This will update the metadata only for a table that was previously fully replicated.\n+\n+No data will be copied but any metadata from the source will be copied and table/partition locations will keep pointing to previously replicated data.\n+\n+Example use case: Update the metadata of a Hive Table (for instance to change the Serde used) without having the overhead of re-replicating all the data.\n+\n+## Copiers\n+The copiers are the classes which do the actual copying of the data. \n+\n+There is a `CopierFactoryManager` which determines which type of copier will be used. The `DefaultCopierFactoryManager` is an implementation of this, and has a list of `CopierFactories` auto-wired into it. Spring will find all beans which are implementations of the `CopierFactory` and pass these into the constructor for the `DefaultCopierFactoryManager`. \n+\n+There is an optional copier option available to set which `CopierFactory` to use, if this value is set this copier factory class will be used. If this value is not set the `DefaultCopierFactoryManager` will check all `CopierFactories` in the list and return the first which supports replication between the SourceLocation and ReplicaLocation provided. \n+\n+There is an order of precedence, which means the `CopierFactories` will be checked in the following order to see if the replication is supported:\n+* `S3S3Copier`,\n+* `S3MapreduceCpCopier`, \n+* and then falls down to `DistCpCopier` if the above factories don't support the replication.\n+\n+The copiers which use S3 will create clients that allow access and give permissions to perform actions on S3 buckets. In some cases an IAM role is needed, if data is being transferred across S3 accounts. \n+\n+### Types of copier\n+**S3S3Copier**\n+\n+*Replication: S3 \u2192 S3* \n+\n+This copier uses two `AwsS3Clients` - a source client and a replica client. There is an `AwsS3ClientFactory` which will create clients with the necessary permissions to perform actions on S3 buckets", "originalCommit": "d73e9c31dc267956e1c0f96030d80635f0e18a36", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyODYzMg==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r446328632", "bodyText": "I think I did investigate this in the past and you are right. The role does require read permissions on source account. iirc, it was because the S3 class that was copying only uses one client and that was target client. There is no data handover which was possible between two clients.", "author": "abhimanyugupta07", "createdAt": "2020-06-26T17:54:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI4ODAzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA0MjkwNw==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r447042907", "bodyText": "So then this section might need a little tweaking.", "author": "barnharts4", "createdAt": "2020-06-29T15:06:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI4ODAzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODgwOTg3MA==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r458809870", "bodyText": "Hi both, yes it does need read access to the source also. This is mentioned in the readme in the s3-s3 section, but I'll also document it here so its more clear. Thanks for pointing this out!", "author": "JayGreeeen", "createdAt": "2020-07-22T13:54:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI4ODAzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI4OTE3Mw==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r446289173", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The `S3S3CopierOptions` will take the `CopierOptions` provided and change them into more specific s3 options. For example it will have the options `s3-server-side-encryption` and `assume-role`, which are specific to S3 clients and wont be used by the other copiers. \n          \n          \n            \n            The `S3S3CopierOptions` will take the `CopierOptions` provided and change them into more specific s3 options. For example it will have the options `s3-server-side-encryption` and `assume-role`, which are specific to S3 clients and won't be used by the other copiers.", "author": "barnharts4", "createdAt": "2020-06-26T16:34:11Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,122 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+\n+\n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but it not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n+\n+**Unpartitioned** \n+\n+All data from the source is copied over to the replica table, then the metadata is updated.\n+\n+\n+### Full Overwrite Replication\n+This replication mode behaves in the same was as `FULL` however, any existing replica table and its underlying data will first be deleted before being replaced with the source table and data. \n+\n+This mode is useful in the early stages of lifecycle when incompatible schema changes are made. \n+\n+A `DataManipulator` is used to handle the deleting of data. Determining which manipulator to use is handled in the same manner as the [Copier](#copiers), in that there is a `DataManipulatorFactoryManager` which will give a suitable `DataManipulatorFactory` that will return a `DataManipulator` object. \n+\n+### Metadata Mirror Replication \n+Only metadata will be copied (mirrored) from the source to the replica. Replica metadata will not be modified so your source and replica will have the same data location.\n+\n+*NOTE:* The replica table will be marked as `EXTERNAL`. This is done to prevent accidental data loss when dropping the replica. \n+\n+For example, this can be used for copying someone else's metadata into your Hive Metastore without copying the data or to replicate a view. You still need to have access to the data in order to query it.\n+\n+### Metadata Update Replication\n+This will update the metadata only for a table that was previously fully replicated.\n+\n+No data will be copied but any metadata from the source will be copied and table/partition locations will keep pointing to previously replicated data.\n+\n+Example use case: Update the metadata of a Hive Table (for instance to change the Serde used) without having the overhead of re-replicating all the data.\n+\n+## Copiers\n+The copiers are the classes which do the actual copying of the data. \n+\n+There is a `CopierFactoryManager` which determines which type of copier will be used. The `DefaultCopierFactoryManager` is an implementation of this, and has a list of `CopierFactories` auto-wired into it. Spring will find all beans which are implementations of the `CopierFactory` and pass these into the constructor for the `DefaultCopierFactoryManager`. \n+\n+There is an optional copier option available to set which `CopierFactory` to use, if this value is set this copier factory class will be used. If this value is not set the `DefaultCopierFactoryManager` will check all `CopierFactories` in the list and return the first which supports replication between the SourceLocation and ReplicaLocation provided. \n+\n+There is an order of precedence, which means the `CopierFactories` will be checked in the following order to see if the replication is supported:\n+* `S3S3Copier`,\n+* `S3MapreduceCpCopier`, \n+* and then falls down to `DistCpCopier` if the above factories don't support the replication.\n+\n+The copiers which use S3 will create clients that allow access and give permissions to perform actions on S3 buckets. In some cases an IAM role is needed, if data is being transferred across S3 accounts. \n+\n+### Types of copier\n+**S3S3Copier**\n+\n+*Replication: S3 \u2192 S3* \n+\n+This copier uses two `AwsS3Clients` - a source client and a replica client. There is an `AwsS3ClientFactory` which will create clients with the necessary permissions to perform actions on S3 buckets\n+\n+One of these client factories is `JceksAmazonS3ClientFactory`, which creates a client with the necessary credentials required. It does this using a credential provider chain, which will create (as the name states) a chain of credential providers which will be tried in order, until one is successful. One of the credentials in this chain is the `AssumeRoleCredentialProvider` which uses a role provided in the copier options to be able to replicate across S3 accounts.\n+\n+The replication is handled by a `TransferManager` which uses the target S3 client and the `S3S3CopierOptions`. The `TransferManager` will be given the the source client to replicate from. \n+\n+The `S3S3CopierOptions` will take the `CopierOptions` provided and change them into more specific s3 options. For example it will have the options `s3-server-side-encryption` and `assume-role`, which are specific to S3 clients and wont be used by the other copiers. ", "originalCommit": "d73e9c31dc267956e1c0f96030d80635f0e18a36", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bc17a3f5ff68015d837b175cf9617b2b11695b1d", "url": "https://github.com/ExpediaGroup/circus-train/commit/bc17a3f5ff68015d837b175cf9617b2b11695b1d", "message": "Apply suggestions from code review\n\nCo-authored-by: Scott Barnhart <github@barnharts4.com>", "committedDate": "2020-06-26T16:41:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMxNzc3MA==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r446317770", "bodyText": "Suggested change", "author": "abhimanyugupta07", "createdAt": "2020-06-26T17:31:29Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,123 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+", "originalCommit": "bc17a3f5ff68015d837b175cf9617b2b11695b1d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMxODEzNA==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r446318134", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            These notes are meant as a helpful developers guide into Circus Train's code and how it works, but it not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n          \n          \n            \n            These notes are meant as a helpful developers guide into Circus Train's code and how it works, but they are not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail.", "author": "abhimanyugupta07", "createdAt": "2020-06-26T17:32:15Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,123 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+\n+\n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but it not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. ", "originalCommit": "bc17a3f5ff68015d837b175cf9617b2b11695b1d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMDM3OQ==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r446320379", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This replication mode behaves in the same was as `FULL`; however, any existing replica table and its underlying data will first be deleted before being replaced with the source table and data. \n          \n          \n            \n            This replication mode behaves in the same way as `FULL`; however, corresponding existing replica table if any and its underlying data will first be deleted before being replaced with the source table and data.", "author": "abhimanyugupta07", "createdAt": "2020-06-26T17:37:01Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,123 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+\n+\n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but it not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+      * Note: If you are replicating S3 \u2192 S3 cross account, *and* you want to assume a role in the target account (see `copier-options.assume-role` in `README.md`), then you must use `S3MapreduceCpCopier`.\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n+\n+**Unpartitioned** \n+\n+All data from the source is copied over to the replica table, then the metadata is updated.\n+\n+\n+### Full Overwrite Replication\n+This replication mode behaves in the same was as `FULL`; however, any existing replica table and its underlying data will first be deleted before being replaced with the source table and data. ", "originalCommit": "bc17a3f5ff68015d837b175cf9617b2b11695b1d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMDc2Mw==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r446320763", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This mode is useful in the early stages of lifecycle when incompatible schema changes are made. \n          \n          \n            \n            This mode is useful in the early stages of development lifecycle when incompatible schema changes are being made constantly.", "author": "abhimanyugupta07", "createdAt": "2020-06-26T17:37:44Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,123 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+\n+\n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but it not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+      * Note: If you are replicating S3 \u2192 S3 cross account, *and* you want to assume a role in the target account (see `copier-options.assume-role` in `README.md`), then you must use `S3MapreduceCpCopier`.\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n+\n+**Unpartitioned** \n+\n+All data from the source is copied over to the replica table, then the metadata is updated.\n+\n+\n+### Full Overwrite Replication\n+This replication mode behaves in the same was as `FULL`; however, any existing replica table and its underlying data will first be deleted before being replaced with the source table and data. \n+\n+This mode is useful in the early stages of lifecycle when incompatible schema changes are made. ", "originalCommit": "bc17a3f5ff68015d837b175cf9617b2b11695b1d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMTU4OQ==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r446321589", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            A `DataManipulator` is used to handle the deleting of data. Determining which manipulator to use is handled in the same manner as the [Copier](#copiers), in that there is a `DataManipulatorFactoryManager` which will give a suitable `DataManipulatorFactory` that will return a `DataManipulator` object. \n          \n          \n            \n            A `DataManipulator` is used to handle the deletion of data. Determining which manipulator to use is handled in the same manner as the [Copier](#copiers), in that there is a `DataManipulatorFactoryManager` which will generate a suitable `DataManipulatorFactory` that returns a `DataManipulator` object.", "author": "abhimanyugupta07", "createdAt": "2020-06-26T17:39:37Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,123 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+\n+\n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but it not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+      * Note: If you are replicating S3 \u2192 S3 cross account, *and* you want to assume a role in the target account (see `copier-options.assume-role` in `README.md`), then you must use `S3MapreduceCpCopier`.\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n+\n+**Unpartitioned** \n+\n+All data from the source is copied over to the replica table, then the metadata is updated.\n+\n+\n+### Full Overwrite Replication\n+This replication mode behaves in the same was as `FULL`; however, any existing replica table and its underlying data will first be deleted before being replaced with the source table and data. \n+\n+This mode is useful in the early stages of lifecycle when incompatible schema changes are made. \n+\n+A `DataManipulator` is used to handle the deleting of data. Determining which manipulator to use is handled in the same manner as the [Copier](#copiers), in that there is a `DataManipulatorFactoryManager` which will give a suitable `DataManipulatorFactory` that will return a `DataManipulator` object. ", "originalCommit": "bc17a3f5ff68015d837b175cf9617b2b11695b1d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMjgzOA==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r446322838", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The copiers are the classes which do the actual copying of the data. \n          \n          \n            \n            The copiers are the classes which performs the actual copying of the data.", "author": "abhimanyugupta07", "createdAt": "2020-06-26T17:42:07Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,123 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+\n+\n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but it not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+      * Note: If you are replicating S3 \u2192 S3 cross account, *and* you want to assume a role in the target account (see `copier-options.assume-role` in `README.md`), then you must use `S3MapreduceCpCopier`.\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n+\n+**Unpartitioned** \n+\n+All data from the source is copied over to the replica table, then the metadata is updated.\n+\n+\n+### Full Overwrite Replication\n+This replication mode behaves in the same was as `FULL`; however, any existing replica table and its underlying data will first be deleted before being replaced with the source table and data. \n+\n+This mode is useful in the early stages of lifecycle when incompatible schema changes are made. \n+\n+A `DataManipulator` is used to handle the deleting of data. Determining which manipulator to use is handled in the same manner as the [Copier](#copiers), in that there is a `DataManipulatorFactoryManager` which will give a suitable `DataManipulatorFactory` that will return a `DataManipulator` object. \n+\n+### Metadata Mirror Replication \n+Only metadata will be copied (mirrored) from the source to the replica. Replica metadata will not be modified so your source and replica will have the same data location.\n+\n+*NOTE:* The replica table will be marked as `EXTERNAL`. This is done to prevent accidental data loss when dropping the replica. \n+\n+For example, this can be used for copying someone else's metadata into your Hive Metastore without copying the data or to replicate a view. You still need to have access to the data in order to query it.\n+\n+### Metadata Update Replication\n+This will update the metadata only for a table that was previously fully replicated.\n+\n+No data will be copied but any metadata from the source will be copied and table/partition locations will keep pointing to previously replicated data.\n+\n+Example use case: Update the metadata of a Hive Table (for instance to change the Serde used) without having the overhead of re-replicating all the data.\n+\n+## Copiers\n+The copiers are the classes which do the actual copying of the data. ", "originalCommit": "bc17a3f5ff68015d837b175cf9617b2b11695b1d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMzQ1MA==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r446323450", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            There is a `CopierFactoryManager` which determines which type of copier will be used. The `DefaultCopierFactoryManager` is an implementation of this, and has a list of `CopierFactories` auto-wired into it. Spring will find all beans which are implementations of the `CopierFactory` and pass these into the constructor for the `DefaultCopierFactoryManager`. \n          \n          \n            \n            There is a `CopierFactoryManager` which determines which type of copier will be used. The `DefaultCopierFactoryManager` is an implementation of this, and has a list of `CopierFactories` auto-wired into it. Spring will find all beans which are implements `CopierFactory` and pass these onto the constructor for the `DefaultCopierFactoryManager`.", "author": "abhimanyugupta07", "createdAt": "2020-06-26T17:43:24Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,123 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+\n+\n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but it not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+      * Note: If you are replicating S3 \u2192 S3 cross account, *and* you want to assume a role in the target account (see `copier-options.assume-role` in `README.md`), then you must use `S3MapreduceCpCopier`.\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n+\n+**Unpartitioned** \n+\n+All data from the source is copied over to the replica table, then the metadata is updated.\n+\n+\n+### Full Overwrite Replication\n+This replication mode behaves in the same was as `FULL`; however, any existing replica table and its underlying data will first be deleted before being replaced with the source table and data. \n+\n+This mode is useful in the early stages of lifecycle when incompatible schema changes are made. \n+\n+A `DataManipulator` is used to handle the deleting of data. Determining which manipulator to use is handled in the same manner as the [Copier](#copiers), in that there is a `DataManipulatorFactoryManager` which will give a suitable `DataManipulatorFactory` that will return a `DataManipulator` object. \n+\n+### Metadata Mirror Replication \n+Only metadata will be copied (mirrored) from the source to the replica. Replica metadata will not be modified so your source and replica will have the same data location.\n+\n+*NOTE:* The replica table will be marked as `EXTERNAL`. This is done to prevent accidental data loss when dropping the replica. \n+\n+For example, this can be used for copying someone else's metadata into your Hive Metastore without copying the data or to replicate a view. You still need to have access to the data in order to query it.\n+\n+### Metadata Update Replication\n+This will update the metadata only for a table that was previously fully replicated.\n+\n+No data will be copied but any metadata from the source will be copied and table/partition locations will keep pointing to previously replicated data.\n+\n+Example use case: Update the metadata of a Hive Table (for instance to change the Serde used) without having the overhead of re-replicating all the data.\n+\n+## Copiers\n+The copiers are the classes which do the actual copying of the data. \n+\n+There is a `CopierFactoryManager` which determines which type of copier will be used. The `DefaultCopierFactoryManager` is an implementation of this, and has a list of `CopierFactories` auto-wired into it. Spring will find all beans which are implementations of the `CopierFactory` and pass these into the constructor for the `DefaultCopierFactoryManager`. ", "originalCommit": "bc17a3f5ff68015d837b175cf9617b2b11695b1d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyNTA4Mg==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r446325082", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * and then falls down to `DistCpCopier` if the above factories don't support the replication.\n          \n          \n            \n            * and then falls back to `DistCpCopier` if the above factories don't support the replication.", "author": "abhimanyugupta07", "createdAt": "2020-06-26T17:46:50Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,123 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+\n+\n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but it not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+      * Note: If you are replicating S3 \u2192 S3 cross account, *and* you want to assume a role in the target account (see `copier-options.assume-role` in `README.md`), then you must use `S3MapreduceCpCopier`.\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n+\n+**Unpartitioned** \n+\n+All data from the source is copied over to the replica table, then the metadata is updated.\n+\n+\n+### Full Overwrite Replication\n+This replication mode behaves in the same was as `FULL`; however, any existing replica table and its underlying data will first be deleted before being replaced with the source table and data. \n+\n+This mode is useful in the early stages of lifecycle when incompatible schema changes are made. \n+\n+A `DataManipulator` is used to handle the deleting of data. Determining which manipulator to use is handled in the same manner as the [Copier](#copiers), in that there is a `DataManipulatorFactoryManager` which will give a suitable `DataManipulatorFactory` that will return a `DataManipulator` object. \n+\n+### Metadata Mirror Replication \n+Only metadata will be copied (mirrored) from the source to the replica. Replica metadata will not be modified so your source and replica will have the same data location.\n+\n+*NOTE:* The replica table will be marked as `EXTERNAL`. This is done to prevent accidental data loss when dropping the replica. \n+\n+For example, this can be used for copying someone else's metadata into your Hive Metastore without copying the data or to replicate a view. You still need to have access to the data in order to query it.\n+\n+### Metadata Update Replication\n+This will update the metadata only for a table that was previously fully replicated.\n+\n+No data will be copied but any metadata from the source will be copied and table/partition locations will keep pointing to previously replicated data.\n+\n+Example use case: Update the metadata of a Hive Table (for instance to change the Serde used) without having the overhead of re-replicating all the data.\n+\n+## Copiers\n+The copiers are the classes which do the actual copying of the data. \n+\n+There is a `CopierFactoryManager` which determines which type of copier will be used. The `DefaultCopierFactoryManager` is an implementation of this, and has a list of `CopierFactories` auto-wired into it. Spring will find all beans which are implementations of the `CopierFactory` and pass these into the constructor for the `DefaultCopierFactoryManager`. \n+\n+There is an optional copier option available to set which `CopierFactory` to use, if this value is set this copier factory class will be used. If this value is not set the `DefaultCopierFactoryManager` will check all `CopierFactories` in the list and return the first which supports replication between the SourceLocation and ReplicaLocation provided. \n+\n+There is an order of precedence, which means the `CopierFactories` will be checked in the following order to see if the replication is supported:\n+* `S3S3Copier`,\n+* `S3MapreduceCpCopier`, \n+* and then falls down to `DistCpCopier` if the above factories don't support the replication.", "originalCommit": "bc17a3f5ff68015d837b175cf9617b2b11695b1d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a0bb40810285094e73043641886379a21fd39320", "url": "https://github.com/ExpediaGroup/circus-train/commit/a0bb40810285094e73043641886379a21fd39320", "message": "Addressing PR comments", "committedDate": "2020-06-29T15:11:15Z", "type": "commit"}, {"oid": "38f083fa6204999e339f6e30d678679ac45315eb", "url": "https://github.com/ExpediaGroup/circus-train/commit/38f083fa6204999e339f6e30d678679ac45315eb", "message": "Addressing PR comments", "committedDate": "2020-07-22T13:58:23Z", "type": "commit"}, {"oid": "1226c64f3995abf00e86556573f9897f16ed66ee", "url": "https://github.com/ExpediaGroup/circus-train/commit/1226c64f3995abf00e86556573f9897f16ed66ee", "message": "Merge branch 'master' into Add-developers-md", "committedDate": "2020-07-22T13:58:26Z", "type": "commit"}, {"oid": "7b82fcb2ac5cef64bcf04057d739dad67680f508", "url": "https://github.com/ExpediaGroup/circus-train/commit/7b82fcb2ac5cef64bcf04057d739dad67680f508", "message": "Merged in master", "committedDate": "2020-07-22T14:00:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM2MjU3OA==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r459362578", "bodyText": "This isn't really part of the release so I don't think you need to update the CHANGELOG.", "author": "massdosage", "createdAt": "2020-07-23T10:45:01Z", "path": "CHANGELOG.md", "diffHunk": "@@ -1,3 +1,7 @@\n+## [16.2.1] - TBD\n+### Added\n+* A `DEVELOPERS.md` file with some notes on the inner workings of the project. ", "originalCommit": "7b82fcb2ac5cef64bcf04057d739dad67680f508", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM2Mjg3OQ==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r459362879", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            These notes are meant as a helpful developers guide into Circus Train's code and how it works, but they are not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n          \n          \n            \n            These notes are meant as a helpful developer's guide into Circus Train's code and how it works, but they are not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail.", "author": "massdosage", "createdAt": "2020-07-23T10:45:42Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,134 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but they are not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. ", "originalCommit": "7b82fcb2ac5cef64bcf04057d739dad67680f508", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM2Mjk4NA==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r459362984", "bodyText": "link to the README directly", "author": "massdosage", "createdAt": "2020-07-23T10:45:56Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,134 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but they are not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. ", "originalCommit": "7b82fcb2ac5cef64bcf04057d739dad67680f508", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM2Mzc5MA==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r459363790", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n          \n          \n            \n            If the source table has partitions containing data then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated.", "author": "massdosage", "createdAt": "2020-07-23T10:47:39Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,134 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but they are not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+      * Note: If you are replicating S3 \u2192 S3 cross account, *and* you want to assume a role in the target account (see `copier-options.assume-role` in `README.md`), then you must use `S3MapreduceCpCopier`.\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. ", "originalCommit": "7b82fcb2ac5cef64bcf04057d739dad67680f508", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM2Mzk0NA==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r459363944", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n          \n          \n            \n            Otherwise, if the source table is partitioned but has no partitions containing data only the metadata of the table will be updated.", "author": "massdosage", "createdAt": "2020-07-23T10:48:00Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,134 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but they are not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+      * Note: If you are replicating S3 \u2192 S3 cross account, *and* you want to assume a role in the target account (see `copier-options.assume-role` in `README.md`), then you must use `S3MapreduceCpCopier`.\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. ", "originalCommit": "7b82fcb2ac5cef64bcf04057d739dad67680f508", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM2NDQ5MA==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r459364490", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This mode is useful in the early stages of the development lifecycle when incompatible schema changes are being made constantly. \n          \n          \n            \n            This mode is useful in the early stages of the development lifecycle if incompatible schema changes are being made frequently so one doesn't have to manually remove data that is no longer valid.", "author": "massdosage", "createdAt": "2020-07-23T10:49:11Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,134 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but they are not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+      * Note: If you are replicating S3 \u2192 S3 cross account, *and* you want to assume a role in the target account (see `copier-options.assume-role` in `README.md`), then you must use `S3MapreduceCpCopier`.\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n+\n+**Unpartitioned** \n+\n+All data from the source is copied over to the replica table, then the metadata is updated.\n+\n+\n+### Full Overwrite Replication\n+This replication mode behaves in the same way as `FULL`; however, the corresponding existing replica table, if any, and its underlying data will first be deleted before being replaced with the source table and data. \n+\n+This mode is useful in the early stages of the development lifecycle when incompatible schema changes are being made constantly. ", "originalCommit": "7b82fcb2ac5cef64bcf04057d739dad67680f508", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM2NTEyMg==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r459365122", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Only metadata will be copied (mirrored) from the source to the replica. Replica metadata will not be modified so your source and replica will have the same data location.\n          \n          \n            \n            Only metadata will be copied (mirrored) from the source to the replica. Unlike the replication modes above, locations in the replica metadata will not be modified so your source and replica will have the same data locations.", "author": "massdosage", "createdAt": "2020-07-23T10:50:36Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,134 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but they are not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+      * Note: If you are replicating S3 \u2192 S3 cross account, *and* you want to assume a role in the target account (see `copier-options.assume-role` in `README.md`), then you must use `S3MapreduceCpCopier`.\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n+\n+**Unpartitioned** \n+\n+All data from the source is copied over to the replica table, then the metadata is updated.\n+\n+\n+### Full Overwrite Replication\n+This replication mode behaves in the same way as `FULL`; however, the corresponding existing replica table, if any, and its underlying data will first be deleted before being replaced with the source table and data. \n+\n+This mode is useful in the early stages of the development lifecycle when incompatible schema changes are being made constantly. \n+\n+A `DataManipulator` is used to handle the deletion of data. Determining which manipulator to use is handled in the same manner as the [Copier](#copiers), in that there is a `DataManipulatorFactoryManager` which will generate a suitable `DataManipulatorFactory` that returns a `DataManipulator` object. \n+\n+### Metadata Mirror Replication \n+Only metadata will be copied (mirrored) from the source to the replica. Replica metadata will not be modified so your source and replica will have the same data location.", "originalCommit": "7b82fcb2ac5cef64bcf04057d739dad67680f508", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM2NTQ1MQ==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r459365451", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            For example, this can be used for copying someone else's metadata into your Hive Metastore without copying the data or to replicate a view. You still need to have access to the data in order to query it.\n          \n          \n            \n            Example use case:  this can be used for copying someone else's metadata into your Hive Metastore without copying the data or to replicate a view. You still need to have access to the data in order to query it.\n          \n      \n    \n    \n  \n\n(to be consistent with what you've done below)", "author": "massdosage", "createdAt": "2020-07-23T10:51:19Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,134 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but they are not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+      * Note: If you are replicating S3 \u2192 S3 cross account, *and* you want to assume a role in the target account (see `copier-options.assume-role` in `README.md`), then you must use `S3MapreduceCpCopier`.\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n+\n+**Unpartitioned** \n+\n+All data from the source is copied over to the replica table, then the metadata is updated.\n+\n+\n+### Full Overwrite Replication\n+This replication mode behaves in the same way as `FULL`; however, the corresponding existing replica table, if any, and its underlying data will first be deleted before being replaced with the source table and data. \n+\n+This mode is useful in the early stages of the development lifecycle when incompatible schema changes are being made constantly. \n+\n+A `DataManipulator` is used to handle the deletion of data. Determining which manipulator to use is handled in the same manner as the [Copier](#copiers), in that there is a `DataManipulatorFactoryManager` which will generate a suitable `DataManipulatorFactory` that returns a `DataManipulator` object. \n+\n+### Metadata Mirror Replication \n+Only metadata will be copied (mirrored) from the source to the replica. Replica metadata will not be modified so your source and replica will have the same data location.\n+\n+*NOTE:* The replica table will be marked as `EXTERNAL`. This is done to prevent accidental data loss when dropping the replica. \n+\n+For example, this can be used for copying someone else's metadata into your Hive Metastore without copying the data or to replicate a view. You still need to have access to the data in order to query it.", "originalCommit": "7b82fcb2ac5cef64bcf04057d739dad67680f508", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM2NjAwMg==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r459366002", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            There is an optional copier option available to set which `CopierFactory` to use, if this value is set this copier factory class will be used. If this value is not set the `DefaultCopierFactoryManager` will check all `CopierFactories` in the list and return the first which supports replication between the SourceLocation and ReplicaLocation provided. \n          \n          \n            \n            There is an optional copier option available to specify which `CopierFactory` to use, if this value is set then this copier factory class will be used. If this value is not set the `DefaultCopierFactoryManager` will check all `CopierFactories` in the list and return the first which supports replication between the SourceLocation and ReplicaLocation provided.", "author": "massdosage", "createdAt": "2020-07-23T10:52:30Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,134 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but they are not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+      * Note: If you are replicating S3 \u2192 S3 cross account, *and* you want to assume a role in the target account (see `copier-options.assume-role` in `README.md`), then you must use `S3MapreduceCpCopier`.\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n+\n+**Unpartitioned** \n+\n+All data from the source is copied over to the replica table, then the metadata is updated.\n+\n+\n+### Full Overwrite Replication\n+This replication mode behaves in the same way as `FULL`; however, the corresponding existing replica table, if any, and its underlying data will first be deleted before being replaced with the source table and data. \n+\n+This mode is useful in the early stages of the development lifecycle when incompatible schema changes are being made constantly. \n+\n+A `DataManipulator` is used to handle the deletion of data. Determining which manipulator to use is handled in the same manner as the [Copier](#copiers), in that there is a `DataManipulatorFactoryManager` which will generate a suitable `DataManipulatorFactory` that returns a `DataManipulator` object. \n+\n+### Metadata Mirror Replication \n+Only metadata will be copied (mirrored) from the source to the replica. Replica metadata will not be modified so your source and replica will have the same data location.\n+\n+*NOTE:* The replica table will be marked as `EXTERNAL`. This is done to prevent accidental data loss when dropping the replica. \n+\n+For example, this can be used for copying someone else's metadata into your Hive Metastore without copying the data or to replicate a view. You still need to have access to the data in order to query it.\n+\n+### Metadata Update Replication\n+This will update the metadata only for a table that was previously fully replicated.\n+\n+No data will be copied but any metadata from the source will be copied and table/partition locations will keep pointing to previously replicated data.\n+\n+Example use case: Update the metadata of a Hive Table (for instance to change the Serde used) without having the overhead of re-replicating all the data.\n+\n+## Copiers\n+The copiers are the classes which perform the actual copying of the data. \n+\n+There is a `CopierFactoryManager` which determines which type of copier will be used. The `DefaultCopierFactoryManager` is an implementation of this, and has a list of `CopierFactories` auto-wired into it. Spring will find all beans which implement `CopierFactory` and pass these on to the constructor for the `DefaultCopierFactoryManager`. \n+\n+There is an optional copier option available to set which `CopierFactory` to use, if this value is set this copier factory class will be used. If this value is not set the `DefaultCopierFactoryManager` will check all `CopierFactories` in the list and return the first which supports replication between the SourceLocation and ReplicaLocation provided. ", "originalCommit": "7b82fcb2ac5cef64bcf04057d739dad67680f508", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM2NjMzMA==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r459366330", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            There is an order of precedence, which means the `CopierFactories` will be checked in the following order to see if the replication is supported:\n          \n          \n            \n            The following is the order of precedence which the `CopierFactories` will be checked in to see if the replication is supported:", "author": "massdosage", "createdAt": "2020-07-23T10:53:14Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,134 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but they are not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+      * Note: If you are replicating S3 \u2192 S3 cross account, *and* you want to assume a role in the target account (see `copier-options.assume-role` in `README.md`), then you must use `S3MapreduceCpCopier`.\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n+\n+**Unpartitioned** \n+\n+All data from the source is copied over to the replica table, then the metadata is updated.\n+\n+\n+### Full Overwrite Replication\n+This replication mode behaves in the same way as `FULL`; however, the corresponding existing replica table, if any, and its underlying data will first be deleted before being replaced with the source table and data. \n+\n+This mode is useful in the early stages of the development lifecycle when incompatible schema changes are being made constantly. \n+\n+A `DataManipulator` is used to handle the deletion of data. Determining which manipulator to use is handled in the same manner as the [Copier](#copiers), in that there is a `DataManipulatorFactoryManager` which will generate a suitable `DataManipulatorFactory` that returns a `DataManipulator` object. \n+\n+### Metadata Mirror Replication \n+Only metadata will be copied (mirrored) from the source to the replica. Replica metadata will not be modified so your source and replica will have the same data location.\n+\n+*NOTE:* The replica table will be marked as `EXTERNAL`. This is done to prevent accidental data loss when dropping the replica. \n+\n+For example, this can be used for copying someone else's metadata into your Hive Metastore without copying the data or to replicate a view. You still need to have access to the data in order to query it.\n+\n+### Metadata Update Replication\n+This will update the metadata only for a table that was previously fully replicated.\n+\n+No data will be copied but any metadata from the source will be copied and table/partition locations will keep pointing to previously replicated data.\n+\n+Example use case: Update the metadata of a Hive Table (for instance to change the Serde used) without having the overhead of re-replicating all the data.\n+\n+## Copiers\n+The copiers are the classes which perform the actual copying of the data. \n+\n+There is a `CopierFactoryManager` which determines which type of copier will be used. The `DefaultCopierFactoryManager` is an implementation of this, and has a list of `CopierFactories` auto-wired into it. Spring will find all beans which implement `CopierFactory` and pass these on to the constructor for the `DefaultCopierFactoryManager`. \n+\n+There is an optional copier option available to set which `CopierFactory` to use, if this value is set this copier factory class will be used. If this value is not set the `DefaultCopierFactoryManager` will check all `CopierFactories` in the list and return the first which supports replication between the SourceLocation and ReplicaLocation provided. \n+\n+There is an order of precedence, which means the `CopierFactories` will be checked in the following order to see if the replication is supported:", "originalCommit": "7b82fcb2ac5cef64bcf04057d739dad67680f508", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM2NjYxNw==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r459366617", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * and then falls down to `DistCpCopier` if the above factories don't support the replication.\n          \n          \n            \n            * `DistCpCopier` (i.e. this is used if all the above factories don't support the replication).", "author": "massdosage", "createdAt": "2020-07-23T10:53:50Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,134 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but they are not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+      * Note: If you are replicating S3 \u2192 S3 cross account, *and* you want to assume a role in the target account (see `copier-options.assume-role` in `README.md`), then you must use `S3MapreduceCpCopier`.\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n+\n+**Unpartitioned** \n+\n+All data from the source is copied over to the replica table, then the metadata is updated.\n+\n+\n+### Full Overwrite Replication\n+This replication mode behaves in the same way as `FULL`; however, the corresponding existing replica table, if any, and its underlying data will first be deleted before being replaced with the source table and data. \n+\n+This mode is useful in the early stages of the development lifecycle when incompatible schema changes are being made constantly. \n+\n+A `DataManipulator` is used to handle the deletion of data. Determining which manipulator to use is handled in the same manner as the [Copier](#copiers), in that there is a `DataManipulatorFactoryManager` which will generate a suitable `DataManipulatorFactory` that returns a `DataManipulator` object. \n+\n+### Metadata Mirror Replication \n+Only metadata will be copied (mirrored) from the source to the replica. Replica metadata will not be modified so your source and replica will have the same data location.\n+\n+*NOTE:* The replica table will be marked as `EXTERNAL`. This is done to prevent accidental data loss when dropping the replica. \n+\n+For example, this can be used for copying someone else's metadata into your Hive Metastore without copying the data or to replicate a view. You still need to have access to the data in order to query it.\n+\n+### Metadata Update Replication\n+This will update the metadata only for a table that was previously fully replicated.\n+\n+No data will be copied but any metadata from the source will be copied and table/partition locations will keep pointing to previously replicated data.\n+\n+Example use case: Update the metadata of a Hive Table (for instance to change the Serde used) without having the overhead of re-replicating all the data.\n+\n+## Copiers\n+The copiers are the classes which perform the actual copying of the data. \n+\n+There is a `CopierFactoryManager` which determines which type of copier will be used. The `DefaultCopierFactoryManager` is an implementation of this, and has a list of `CopierFactories` auto-wired into it. Spring will find all beans which implement `CopierFactory` and pass these on to the constructor for the `DefaultCopierFactoryManager`. \n+\n+There is an optional copier option available to set which `CopierFactory` to use, if this value is set this copier factory class will be used. If this value is not set the `DefaultCopierFactoryManager` will check all `CopierFactories` in the list and return the first which supports replication between the SourceLocation and ReplicaLocation provided. \n+\n+There is an order of precedence, which means the `CopierFactories` will be checked in the following order to see if the replication is supported:\n+* `S3S3Copier`,\n+* `S3MapreduceCpCopier`, \n+* and then falls down to `DistCpCopier` if the above factories don't support the replication.", "originalCommit": "7b82fcb2ac5cef64bcf04057d739dad67680f508", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM2Njc2NQ==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r459366765", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The copiers which use S3 will create clients that allow access and give permissions to perform actions on S3 buckets. In some cases an IAM role is needed, if data is being transferred across S3 accounts. \n          \n          \n            \n            The copiers which use S3 will create clients that allow access and give permissions to perform actions on S3 buckets. In some cases an IAM role is needed (e.g. if data is being transferred across S3 accounts).", "author": "massdosage", "createdAt": "2020-07-23T10:54:10Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,134 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but they are not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+      * Note: If you are replicating S3 \u2192 S3 cross account, *and* you want to assume a role in the target account (see `copier-options.assume-role` in `README.md`), then you must use `S3MapreduceCpCopier`.\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n+\n+**Unpartitioned** \n+\n+All data from the source is copied over to the replica table, then the metadata is updated.\n+\n+\n+### Full Overwrite Replication\n+This replication mode behaves in the same way as `FULL`; however, the corresponding existing replica table, if any, and its underlying data will first be deleted before being replaced with the source table and data. \n+\n+This mode is useful in the early stages of the development lifecycle when incompatible schema changes are being made constantly. \n+\n+A `DataManipulator` is used to handle the deletion of data. Determining which manipulator to use is handled in the same manner as the [Copier](#copiers), in that there is a `DataManipulatorFactoryManager` which will generate a suitable `DataManipulatorFactory` that returns a `DataManipulator` object. \n+\n+### Metadata Mirror Replication \n+Only metadata will be copied (mirrored) from the source to the replica. Replica metadata will not be modified so your source and replica will have the same data location.\n+\n+*NOTE:* The replica table will be marked as `EXTERNAL`. This is done to prevent accidental data loss when dropping the replica. \n+\n+For example, this can be used for copying someone else's metadata into your Hive Metastore without copying the data or to replicate a view. You still need to have access to the data in order to query it.\n+\n+### Metadata Update Replication\n+This will update the metadata only for a table that was previously fully replicated.\n+\n+No data will be copied but any metadata from the source will be copied and table/partition locations will keep pointing to previously replicated data.\n+\n+Example use case: Update the metadata of a Hive Table (for instance to change the Serde used) without having the overhead of re-replicating all the data.\n+\n+## Copiers\n+The copiers are the classes which perform the actual copying of the data. \n+\n+There is a `CopierFactoryManager` which determines which type of copier will be used. The `DefaultCopierFactoryManager` is an implementation of this, and has a list of `CopierFactories` auto-wired into it. Spring will find all beans which implement `CopierFactory` and pass these on to the constructor for the `DefaultCopierFactoryManager`. \n+\n+There is an optional copier option available to set which `CopierFactory` to use, if this value is set this copier factory class will be used. If this value is not set the `DefaultCopierFactoryManager` will check all `CopierFactories` in the list and return the first which supports replication between the SourceLocation and ReplicaLocation provided. \n+\n+There is an order of precedence, which means the `CopierFactories` will be checked in the following order to see if the replication is supported:\n+* `S3S3Copier`,\n+* `S3MapreduceCpCopier`, \n+* and then falls down to `DistCpCopier` if the above factories don't support the replication.\n+\n+The copiers which use S3 will create clients that allow access and give permissions to perform actions on S3 buckets. In some cases an IAM role is needed, if data is being transferred across S3 accounts. ", "originalCommit": "7b82fcb2ac5cef64bcf04057d739dad67680f508", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM2NzExOA==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r459367118", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            One of these client factories is `JceksAmazonS3ClientFactory`, which creates a client with the necessary credentials required. It does this using a credential provider chain, which will create (as the name states) a chain of credential providers which will be tried in order, until one is successful. One of the credentials in this chain is the `AssumeRoleCredentialProvider` which uses a role provided in the copier options to be able to replicate across S3 accounts.\n          \n          \n            \n            One of these client factories is `JceksAmazonS3ClientFactory`, which creates a client with the necessary credentials. It does this using a credential provider chain, which will create (as the name states) a chain of credential providers that will be tried in order, until one is successful. One of the credentials in this chain is the `AssumeRoleCredentialProvider` which uses a role provided in the copier options to be able to replicate across S3 accounts.", "author": "massdosage", "createdAt": "2020-07-23T10:54:56Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,134 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but they are not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+      * Note: If you are replicating S3 \u2192 S3 cross account, *and* you want to assume a role in the target account (see `copier-options.assume-role` in `README.md`), then you must use `S3MapreduceCpCopier`.\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n+\n+**Unpartitioned** \n+\n+All data from the source is copied over to the replica table, then the metadata is updated.\n+\n+\n+### Full Overwrite Replication\n+This replication mode behaves in the same way as `FULL`; however, the corresponding existing replica table, if any, and its underlying data will first be deleted before being replaced with the source table and data. \n+\n+This mode is useful in the early stages of the development lifecycle when incompatible schema changes are being made constantly. \n+\n+A `DataManipulator` is used to handle the deletion of data. Determining which manipulator to use is handled in the same manner as the [Copier](#copiers), in that there is a `DataManipulatorFactoryManager` which will generate a suitable `DataManipulatorFactory` that returns a `DataManipulator` object. \n+\n+### Metadata Mirror Replication \n+Only metadata will be copied (mirrored) from the source to the replica. Replica metadata will not be modified so your source and replica will have the same data location.\n+\n+*NOTE:* The replica table will be marked as `EXTERNAL`. This is done to prevent accidental data loss when dropping the replica. \n+\n+For example, this can be used for copying someone else's metadata into your Hive Metastore without copying the data or to replicate a view. You still need to have access to the data in order to query it.\n+\n+### Metadata Update Replication\n+This will update the metadata only for a table that was previously fully replicated.\n+\n+No data will be copied but any metadata from the source will be copied and table/partition locations will keep pointing to previously replicated data.\n+\n+Example use case: Update the metadata of a Hive Table (for instance to change the Serde used) without having the overhead of re-replicating all the data.\n+\n+## Copiers\n+The copiers are the classes which perform the actual copying of the data. \n+\n+There is a `CopierFactoryManager` which determines which type of copier will be used. The `DefaultCopierFactoryManager` is an implementation of this, and has a list of `CopierFactories` auto-wired into it. Spring will find all beans which implement `CopierFactory` and pass these on to the constructor for the `DefaultCopierFactoryManager`. \n+\n+There is an optional copier option available to set which `CopierFactory` to use, if this value is set this copier factory class will be used. If this value is not set the `DefaultCopierFactoryManager` will check all `CopierFactories` in the list and return the first which supports replication between the SourceLocation and ReplicaLocation provided. \n+\n+There is an order of precedence, which means the `CopierFactories` will be checked in the following order to see if the replication is supported:\n+* `S3S3Copier`,\n+* `S3MapreduceCpCopier`, \n+* and then falls down to `DistCpCopier` if the above factories don't support the replication.\n+\n+The copiers which use S3 will create clients that allow access and give permissions to perform actions on S3 buckets. In some cases an IAM role is needed, if data is being transferred across S3 accounts. \n+\n+### Types of copier\n+**S3S3Copier**\n+\n+*Replication: S3 \u2192 S3* \n+\n+This copier uses two `AwsS3Clients` - a source client and a replica client. There is an `AwsS3ClientFactory` which will create clients to perform actions on S3 buckets. \n+\n+One of these client factories is `JceksAmazonS3ClientFactory`, which creates a client with the necessary credentials required. It does this using a credential provider chain, which will create (as the name states) a chain of credential providers which will be tried in order, until one is successful. One of the credentials in this chain is the `AssumeRoleCredentialProvider` which uses a role provided in the copier options to be able to replicate across S3 accounts.", "originalCommit": "7b82fcb2ac5cef64bcf04057d739dad67680f508", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM2NzM0OQ==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r459367349", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The `S3S3CopierOptions` will take the `CopierOptions` provided and change them into more specific s3 options. For example it will have the options `s3-server-side-encryption` and `assume-role`, which are specific to S3 clients and won't be used by the other copiers. \n          \n          \n            \n            The `S3S3CopierOptions` will take the `CopierOptions` provided and change them into more specific S3 options. For example it will have the options `s3-server-side-encryption` and `assume-role`, which are specific to S3 clients and won't be used by the other copiers.", "author": "massdosage", "createdAt": "2020-07-23T10:55:26Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,134 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but they are not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+      * Note: If you are replicating S3 \u2192 S3 cross account, *and* you want to assume a role in the target account (see `copier-options.assume-role` in `README.md`), then you must use `S3MapreduceCpCopier`.\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n+\n+**Unpartitioned** \n+\n+All data from the source is copied over to the replica table, then the metadata is updated.\n+\n+\n+### Full Overwrite Replication\n+This replication mode behaves in the same way as `FULL`; however, the corresponding existing replica table, if any, and its underlying data will first be deleted before being replaced with the source table and data. \n+\n+This mode is useful in the early stages of the development lifecycle when incompatible schema changes are being made constantly. \n+\n+A `DataManipulator` is used to handle the deletion of data. Determining which manipulator to use is handled in the same manner as the [Copier](#copiers), in that there is a `DataManipulatorFactoryManager` which will generate a suitable `DataManipulatorFactory` that returns a `DataManipulator` object. \n+\n+### Metadata Mirror Replication \n+Only metadata will be copied (mirrored) from the source to the replica. Replica metadata will not be modified so your source and replica will have the same data location.\n+\n+*NOTE:* The replica table will be marked as `EXTERNAL`. This is done to prevent accidental data loss when dropping the replica. \n+\n+For example, this can be used for copying someone else's metadata into your Hive Metastore without copying the data or to replicate a view. You still need to have access to the data in order to query it.\n+\n+### Metadata Update Replication\n+This will update the metadata only for a table that was previously fully replicated.\n+\n+No data will be copied but any metadata from the source will be copied and table/partition locations will keep pointing to previously replicated data.\n+\n+Example use case: Update the metadata of a Hive Table (for instance to change the Serde used) without having the overhead of re-replicating all the data.\n+\n+## Copiers\n+The copiers are the classes which perform the actual copying of the data. \n+\n+There is a `CopierFactoryManager` which determines which type of copier will be used. The `DefaultCopierFactoryManager` is an implementation of this, and has a list of `CopierFactories` auto-wired into it. Spring will find all beans which implement `CopierFactory` and pass these on to the constructor for the `DefaultCopierFactoryManager`. \n+\n+There is an optional copier option available to set which `CopierFactory` to use, if this value is set this copier factory class will be used. If this value is not set the `DefaultCopierFactoryManager` will check all `CopierFactories` in the list and return the first which supports replication between the SourceLocation and ReplicaLocation provided. \n+\n+There is an order of precedence, which means the `CopierFactories` will be checked in the following order to see if the replication is supported:\n+* `S3S3Copier`,\n+* `S3MapreduceCpCopier`, \n+* and then falls down to `DistCpCopier` if the above factories don't support the replication.\n+\n+The copiers which use S3 will create clients that allow access and give permissions to perform actions on S3 buckets. In some cases an IAM role is needed, if data is being transferred across S3 accounts. \n+\n+### Types of copier\n+**S3S3Copier**\n+\n+*Replication: S3 \u2192 S3* \n+\n+This copier uses two `AwsS3Clients` - a source client and a replica client. There is an `AwsS3ClientFactory` which will create clients to perform actions on S3 buckets. \n+\n+One of these client factories is `JceksAmazonS3ClientFactory`, which creates a client with the necessary credentials required. It does this using a credential provider chain, which will create (as the name states) a chain of credential providers which will be tried in order, until one is successful. One of the credentials in this chain is the `AssumeRoleCredentialProvider` which uses a role provided in the copier options to be able to replicate across S3 accounts.\n+\n+The replication is handled by a `TransferManager` which uses the target S3 client and the `S3S3CopierOptions`. The `TransferManager` will be given the the source client to replicate from. \n+\n+The `S3S3CopierOptions` will take the `CopierOptions` provided and change them into more specific s3 options. For example it will have the options `s3-server-side-encryption` and `assume-role`, which are specific to S3 clients and won't be used by the other copiers. ", "originalCommit": "7b82fcb2ac5cef64bcf04057d739dad67680f508", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM2Nzc3Ng==", "url": "https://github.com/ExpediaGroup/circus-train/pull/190#discussion_r459367776", "bodyText": "I think we can remove this line, IMHO it's clear that if you can't read from the source then you can't do much!", "author": "massdosage", "createdAt": "2020-07-23T10:56:23Z", "path": "DEVELOPERS.md", "diffHunk": "@@ -0,0 +1,134 @@\n+![Circus Train.](circus-train.png \"Moving Hive data between sites.\")\n+\n+# Developer's Guide\n+\n+## Overview\n+\n+This document is a collection of notes on Circus Train which have been put together to outline what some of the main classes do and how they link together. The project is pretty large and if you haven't worked on it for a while its easy to get lost! \n+These notes are meant as a helpful developers guide into Circus Train's code and how it works, but they are not completely exhaustive of all the inner workings of the project. Do feel free to add more information or detail. \n+\n+## README.md\n+\n+First and foremost, its worth having a read through the [README.md](https://github.com/HotelsDotCom/circus-train) file. It is a pretty extensive guide containing a lot of info on the project, including how to run it and all the different configurations which can be used. \n+\n+## Classes\n+**Locomotive**\n+\n+* This is where it all begins.\n+* A new `Replication` object is created using the `ReplicationFactory` and *replicate* is called on it.\n+\n+**ReplicationFactory**\n+\n+* Returns a `Replication` object. The type depends on whether the source table is partitioned or not, and the replication mode specified in the configuration file.\n+\n+**Replication**\n+\n+* Either partitioned or unpartitioned.\n+* There are 4 replication modes:\n+   * `FULL` \u2190 default\n+   * `FULL_OVERWRITE`\n+   * `METADATA_MIRROR`\n+   * `METADATA_UPDATE`\n+* Uses a copier based on where the data is coming from and going to:\n+   * HDFS or S3 \u2192 HDFS, uses `DistCpCopier`\n+   * HDFS \u2192 S3, uses `S3MapreduceCpCopier`\n+   * S3 \u2192 S3,  uses `S3S3Copier`\n+      * Note: If you are replicating S3 \u2192 S3 cross account, *and* you want to assume a role in the target account (see `copier-options.assume-role` in `README.md`), then you must use `S3MapreduceCpCopier`.\n+* The data is copied over first (if the mode is `FULL` or `FULL_OVERWRITE`).\n+* Then the metadata of the table is updated.\n+\n+## Types of replication\n+There are four types of replication which Circus Train can handle:\n+\n+* `FULL` \u2190 default\n+* `FULL_OVERWRITE`\n+* `METADATA_MIRROR`\n+* `METADATA_UPDATE`\n+\n+\n+### Full Replication\n+**Partitioned**\n+\n+If the source table has partitions then these and the corresponding data will be copied over to the replica table. After this, the metadata of the table will be updated. \n+\n+Otherwise, if the source table has no partitions only the metadata of the table will be updated. \n+\n+**Unpartitioned** \n+\n+All data from the source is copied over to the replica table, then the metadata is updated.\n+\n+\n+### Full Overwrite Replication\n+This replication mode behaves in the same way as `FULL`; however, the corresponding existing replica table, if any, and its underlying data will first be deleted before being replaced with the source table and data. \n+\n+This mode is useful in the early stages of the development lifecycle when incompatible schema changes are being made constantly. \n+\n+A `DataManipulator` is used to handle the deletion of data. Determining which manipulator to use is handled in the same manner as the [Copier](#copiers), in that there is a `DataManipulatorFactoryManager` which will generate a suitable `DataManipulatorFactory` that returns a `DataManipulator` object. \n+\n+### Metadata Mirror Replication \n+Only metadata will be copied (mirrored) from the source to the replica. Replica metadata will not be modified so your source and replica will have the same data location.\n+\n+*NOTE:* The replica table will be marked as `EXTERNAL`. This is done to prevent accidental data loss when dropping the replica. \n+\n+For example, this can be used for copying someone else's metadata into your Hive Metastore without copying the data or to replicate a view. You still need to have access to the data in order to query it.\n+\n+### Metadata Update Replication\n+This will update the metadata only for a table that was previously fully replicated.\n+\n+No data will be copied but any metadata from the source will be copied and table/partition locations will keep pointing to previously replicated data.\n+\n+Example use case: Update the metadata of a Hive Table (for instance to change the Serde used) without having the overhead of re-replicating all the data.\n+\n+## Copiers\n+The copiers are the classes which perform the actual copying of the data. \n+\n+There is a `CopierFactoryManager` which determines which type of copier will be used. The `DefaultCopierFactoryManager` is an implementation of this, and has a list of `CopierFactories` auto-wired into it. Spring will find all beans which implement `CopierFactory` and pass these on to the constructor for the `DefaultCopierFactoryManager`. \n+\n+There is an optional copier option available to set which `CopierFactory` to use, if this value is set this copier factory class will be used. If this value is not set the `DefaultCopierFactoryManager` will check all `CopierFactories` in the list and return the first which supports replication between the SourceLocation and ReplicaLocation provided. \n+\n+There is an order of precedence, which means the `CopierFactories` will be checked in the following order to see if the replication is supported:\n+* `S3S3Copier`,\n+* `S3MapreduceCpCopier`, \n+* and then falls down to `DistCpCopier` if the above factories don't support the replication.\n+\n+The copiers which use S3 will create clients that allow access and give permissions to perform actions on S3 buckets. In some cases an IAM role is needed, if data is being transferred across S3 accounts. \n+\n+### Types of copier\n+**S3S3Copier**\n+\n+*Replication: S3 \u2192 S3* \n+\n+This copier uses two `AwsS3Clients` - a source client and a replica client. There is an `AwsS3ClientFactory` which will create clients to perform actions on S3 buckets. \n+\n+One of these client factories is `JceksAmazonS3ClientFactory`, which creates a client with the necessary credentials required. It does this using a credential provider chain, which will create (as the name states) a chain of credential providers which will be tried in order, until one is successful. One of the credentials in this chain is the `AssumeRoleCredentialProvider` which uses a role provided in the copier options to be able to replicate across S3 accounts.\n+\n+The replication is handled by a `TransferManager` which uses the target S3 client and the `S3S3CopierOptions`. The `TransferManager` will be given the the source client to replicate from. \n+\n+The `S3S3CopierOptions` will take the `CopierOptions` provided and change them into more specific s3 options. For example it will have the options `s3-server-side-encryption` and `assume-role`, which are specific to S3 clients and won't be used by the other copiers. \n+\n+*Cross-account Replication*\n+\n+As mentioned above, if you want to replicate from one S3 account to another S3 account you will need to make use of `roles`. \n+In the config file for the replication an `assume-role` will need to be included which will be used by Circus Train to perform the replication. In order for this to work this role will need to have the following permissions:\n+* Read access to the source account, \n+* Read and write access to the target account. \n+\n+Its important that the role has read access to the source so the data can be read before it is replicated to the target. ", "originalCommit": "7b82fcb2ac5cef64bcf04057d739dad67680f508", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5a8723f8020e1211844ef359c1854ca2833f9f33", "url": "https://github.com/ExpediaGroup/circus-train/commit/5a8723f8020e1211844ef359c1854ca2833f9f33", "message": "Apply suggestions from code review\n\nCo-authored-by: Adrian Woodhead <awoodhead@expediagroup.com>", "committedDate": "2020-07-23T11:59:27Z", "type": "commit"}, {"oid": "d3cba6c77b54fe29041b03ad22928ff241b5e7b2", "url": "https://github.com/ExpediaGroup/circus-train/commit/d3cba6c77b54fe29041b03ad22928ff241b5e7b2", "message": "Addressing PR comments", "committedDate": "2020-07-23T12:01:00Z", "type": "commit"}]}