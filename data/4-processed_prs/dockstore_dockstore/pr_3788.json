{"pr_number": 3788, "pr_title": "Set up git-secrets/maven integration", "pr_createdAt": "2020-09-03T18:25:38Z", "pr_url": "https://github.com/dockstore/dockstore/pull/3788", "timeline": [{"oid": "a244772a25e6fc33540d4704840d70be8d0c9af1", "url": "https://github.com/dockstore/dockstore/commit/a244772a25e6fc33540d4704840d70be8d0c9af1", "message": "Add an exec plugin that sets git config during initialize\nSet up git secrets AWS provider\nMake sure we don't set extra configs", "committedDate": "2020-09-03T18:50:31Z", "type": "forcePushed"}, {"oid": "6f81d9b19ab15b3f73d81f44bd4c9a68b545ca79", "url": "https://github.com/dockstore/dockstore/commit/6f81d9b19ab15b3f73d81f44bd4c9a68b545ca79", "message": "Move installation to a bash script", "committedDate": "2020-09-03T19:30:57Z", "type": "forcePushed"}, {"oid": "b77f15e96bacb26b0a997f689ed5b2e855ada065", "url": "https://github.com/dockstore/dockstore/commit/b77f15e96bacb26b0a997f689ed5b2e855ada065", "message": "Clear false positives in current source", "committedDate": "2020-09-03T20:51:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxNzM5Mw==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r483317393", "bodyText": "Will this work on Windows? Do we care if not?\nAt compliance meeting you said more people were starting to use Windows, although I'm not aware of any on Dockstore team. And if they do, they could presumably use WSL. But, checking to be safe.", "author": "coverbeck", "createdAt": "2020-09-04T00:12:52Z", "path": "pom.xml", "diffHunk": "@@ -431,9 +431,26 @@\n                     <artifactId>license-maven-plugin</artifactId>\n                     <version>2.0.0</version>\n                 </plugin>\n+                <plugin>\n+                    <artifactId>exec-maven-plugin</artifactId>\n+                    <version>1.6.0</version>\n+                    <groupId>org.codehaus.mojo</groupId>\n+                    <executions>\n+                        <execution>\n+                            <id>Install git-secrets</id>\n+                            <phase>initialize</phase>\n+                            <goals>\n+                                <goal>exec</goal>\n+                            </goals>\n+                            <configuration>\n+                                <executable>bash</executable>\n+                                <commandlineArgs>${project.parent.basedir}/git-hooks/install.sh</commandlineArgs>", "originalCommit": "481a0ba6c043641fcf70d441b87aafe270fdf0fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3MzA0Mg==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r483673042", "bodyText": "Windows users as in CLI users?\nDevelopers but off the Dockstore team?", "author": "denis-yuen", "createdAt": "2020-09-04T14:58:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxNzM5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzcxMjcxMA==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r483712710", "bodyText": "Windows users as in CLI users?\nDevelopers but off the Dockstore team?\n\nWe had just had a meeting where it was discussed that some engineers at UCSC might be starting to use Windows machines, so it was fresh on my mind when I was reviewing this PR. But no Windows machines on Seabright team, so I think we should probably just ignore this thread that I started here. :)", "author": "coverbeck", "createdAt": "2020-09-04T15:58:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxNzM5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxOTM1MA==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r483319350", "bodyText": "What happens if git-secrets is not installed? Presumably/hopefully this script fails and in turn causes the build to fail?\nDo you need the oft recommended by Denis:\n\nset -o errexit\nset -o nounset\nset -o pipefail\n\n\nEvery time a build is done, this will remove hooks, call git secrets --register-aws, and add hooks again. Is that OK? If the git secrets --register-aws is idempotent, should be fine, but just checking.", "author": "coverbeck", "createdAt": "2020-09-04T00:20:29Z", "path": "git-hooks/install.sh", "diffHunk": "@@ -0,0 +1,9 @@\n+#!/bin/bash", "originalCommit": "481a0ba6c043641fcf70d441b87aafe270fdf0fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzcxNDg3OQ==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r483714879", "bodyText": "On further reflection -- you can't have it fail without checking Travis and Circle env variables, or it will fail there.\nOverall, this PR is a big improvement, but if somebody doesn't have git secrets installed (new machine, new engineer), things could still slip through. It would be nice if commits would actually fail for all non-CI users.", "author": "coverbeck", "createdAt": "2020-09-04T16:03:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxOTM1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNDAwOA==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r483804008", "bodyText": "What happens if git-secrets is not installed? Presumably/hopefully this script fails and in turn causes the build to fail?\n\nYou can test this by moving your git secrets binary, the build error looks like this:\n[INFO] Reactor Summary for dockstore 1.10.0-alpha.1-SNAPSHOT:\n[INFO] \n[INFO] dockstore .......................................... SUCCESS [  0.485 s]\n[INFO] dockstore-common ................................... SUCCESS [  2.033 s]\n[INFO] dockstore-language-plugin-parent ................... SUCCESS [  0.648 s]\n[INFO] swagger-java-quay-client ........................... SUCCESS [  0.118 s]\n[INFO] swagger-java-sam-client ............................ SUCCESS [  0.047 s]\n[INFO] swagger-java-bitbucket-client ...................... SUCCESS [  0.048 s]\n[INFO] swagger-java-discourse-client ...................... SUCCESS [  0.045 s]\n[INFO] swagger-java-zenodo-client ......................... SUCCESS [  0.077 s]\n[INFO] dockstore-webservice ............................... FAILURE [  2.343 s]\n[INFO] swagger-java-client ................................ SKIPPED\n[INFO] openapi-java-client ................................ SKIPPED\n[INFO] dockstore-integration-testing ...................... SKIPPED\n[INFO] dockstore-event-consumer ........................... SKIPPED\n[INFO] reports ............................................ SKIPPED\n[INFO] bom-internal ....................................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  6.069 s\n[INFO] Finished at: 2020-09-04T11:58:49-07:00\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.codehaus.mojo:exec-maven-plugin:1.6.0:exec (Install git-secrets) on project dockstore-webservice: Command execution failed.: Process exited with an error: 1 (Exit value: 1) -> [Help 1]\n[ERROR] \n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR] \n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR] \n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR]   mvn <args> -rf :dockstore-webservice\n\nA developer technically can still download source, make changes and not perform the build. You will need to have git-secrets installed in environments where the build is happening, so this will need to be added to CI to merge.\nhttps://travis-ci.org/github/dockstore/dockstore/jobs/724273630#L3707\n\nDo you need the oft recommended by Denis (mode set)\n\nWill add\n\nEvery time a build is done, this will remove hooks, call git secrets --register-aws, and add hooks again. Is that OK? If the git secrets --register-aws is idempotent, should be fine, but just checking.\n\nI did verify the register call is idempotent, you can see by looking out the output of git config -l, which shows you all the config keys set for the current git directory. The git config --add call, however, is not idempotent, hence some logic was added to unset the config before setting it again.\nIf we want to set other git secrets patterns that are portable to other developers, this is an OK place to do that.", "author": "david4096", "createdAt": "2020-09-04T19:14:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxOTM1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMDc5OQ==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r483320799", "bodyText": "The risk of allow-listing files is that somebody could accidentally add a secret to one of the files, and it wouldn't be caught. Don't know if I'm being overly paranoid, but throwing it out there for consideration.", "author": "coverbeck", "createdAt": "2020-09-04T00:26:09Z", "path": ".gitallowed", "diffHunk": "@@ -0,0 +1,32 @@\n+# Each line is a regular expression against the output of git-secrets", "originalCommit": "481a0ba6c043641fcf70d441b87aafe270fdf0fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc0NjE4OA==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r483746188", "bodyText": "Yeah, it's a razor's edge of not wanting to run people off with a bunch of false positives. It seemed like these files relied on strings that were key-like, those strings might change with version bumps, and the line number might also change. It's potentially more secure to mark just the key-like string. I can do that, but I expect other developers to have to maintain the .gitallowed more often in that case.", "author": "david4096", "createdAt": "2020-09-04T16:55:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMDc5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc1NTkyNA==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r483755924", "bodyText": "I must admit in the past, I think I've been paranoid enough to not have a .gitallowed and just use --no-verify or similar on specific commits when I know I'm modifying something suspicious (which isn't often).", "author": "denis-yuen", "createdAt": "2020-09-04T17:18:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMDc5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUyNzk2Nw==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r484527967", "bodyText": "Was this file auto-generated? Would it be possible to auto-generate? This file doesn't seem easily maintainable. Also it isn't clear what the reason is for these exceptions.", "author": "chmreid", "createdAt": "2020-09-07T17:19:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMDc5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIxODIzNw==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r485218237", "bodyText": "I generated the file by hand by looking at the results of git-secrets. The first version was an allow all lines or keys on the false positives. This was seen as too permissive in review so I added the key-like string that was causing a hit for each of the files. This attempts to be a balance of allowing those strings to move line numbers and having to constantly deal with results, while always detecting if a new key-like string was added to a file.\nI don't know of an easy way to autogenerate it, but I tried to leave some helpful comments. We could perhaps document it further in the wiki.\nI expect it to be something like, \"added an s3 object key to a file > failed commit due to git secrets > add a line to gitallowed for the file and key-like string\". The risk of leaving in old data is very low. I expect these types of changes to be pretty rare (usually in setting up testing apparatuses).\nIt's certainly possible to devise a script that will automatically generate the .gitallowed lines and add it to the gitallowed. I'm not sure exactly how to set it up without it making it too easy to circumvent the security feature. If managing this file gets unwieldy we might have to look into it. Fortunately it didn't take terribly long to generate the file for the whole project using the output of git secrets -scan.", "author": "david4096", "createdAt": "2020-09-08T21:56:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMDc5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUyMTIzNA==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r486521234", "bodyText": "Okay, if we expect the data to change rarely then I'm ok with an artisanal hand-crafted list of warnings to ignore. :)", "author": "chmreid", "createdAt": "2020-09-10T17:42:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMDc5OQ=="}], "type": "inlineReview"}, {"oid": "511c6fc0c5ad4e6a46e000d4007dd8ac51850983", "url": "https://github.com/dockstore/dockstore/commit/511c6fc0c5ad4e6a46e000d4007dd8ac51850983", "message": "Move script, simplify, set bash flags", "committedDate": "2020-09-04T19:02:56Z", "type": "forcePushed"}, {"oid": "8e69a384dc7dc8b38286a21e5d9fe4c7ff23cdac", "url": "https://github.com/dockstore/dockstore/commit/8e69a384dc7dc8b38286a21e5d9fe4c7ff23cdac", "message": "Install git-secrets in CI", "committedDate": "2020-09-04T19:23:12Z", "type": "forcePushed"}, {"oid": "79a4500778495f9becb52462e730c855450af8d9", "url": "https://github.com/dockstore/dockstore/commit/79a4500778495f9becb52462e730c855450af8d9", "message": "Install git-secrets in CI", "committedDate": "2020-09-04T19:36:27Z", "type": "forcePushed"}, {"oid": "567d6c4745dabddee57b8560bba967608047d375", "url": "https://github.com/dockstore/dockstore/commit/567d6c4745dabddee57b8560bba967608047d375", "message": "Run git-secrets scan in circle\nTechnically if someone pushes a secret to a branch\nit will still be in the git tree, however, this\ncheck will help it keep from being merged.", "committedDate": "2020-09-04T22:11:24Z", "type": "forcePushed"}, {"oid": "9a085ea46db870a51503ec04ffddcc9045dfda96", "url": "https://github.com/dockstore/dockstore/commit/9a085ea46db870a51503ec04ffddcc9045dfda96", "message": "Run git-secrets scan in circle\nTechnically if someone pushes a secret to a branch\nit will still be in the git tree, however, this\ncheck will help it keep from being merged.", "committedDate": "2020-09-04T22:14:04Z", "type": "forcePushed"}, {"oid": "655f8009807a59ccaf8043ce6f8522f3ea72b3da", "url": "https://github.com/dockstore/dockstore/commit/655f8009807a59ccaf8043ce6f8522f3ea72b3da", "message": "Run git-secrets scan in circle\nTechnically if someone pushes a secret to a branch\nit will still be in the git tree, however, this\ncheck will help it keep from being merged.", "committedDate": "2020-09-04T22:14:43Z", "type": "forcePushed"}, {"oid": "992374750f6459b415639eaf2e63af2924899e8f", "url": "https://github.com/dockstore/dockstore/commit/992374750f6459b415639eaf2e63af2924899e8f", "message": "Run git-secrets scan in circle\nTechnically if someone pushes a secret to a branch\nit will still be in the git tree, however, this\ncheck will help it keep from being merged.\n\nFix travis wget script", "committedDate": "2020-09-04T22:26:07Z", "type": "forcePushed"}, {"oid": "25090ac2546a11403c7ecb6bf116833344ca707f", "url": "https://github.com/dockstore/dockstore/commit/25090ac2546a11403c7ecb6bf116833344ca707f", "message": "Run git-secrets scan in circle\nTechnically if someone pushes a secret to a branch\nit will still be in the git tree, however, this\ncheck will help it keep from being merged.\n\nFix travis wget script", "committedDate": "2020-09-04T22:33:15Z", "type": "forcePushed"}, {"oid": "19f4712035438269cea3eba4135ae77f4124ad57", "url": "https://github.com/dockstore/dockstore/commit/19f4712035438269cea3eba4135ae77f4124ad57", "message": "Run git-secrets scan in circle\nTechnically if someone pushes a secret to a branch\nit will still be in the git tree, however, this\ncheck will help it keep from being merged.\n\nFix travis wget script\nAnd add git-secrets to lgtm", "committedDate": "2020-09-04T23:13:59Z", "type": "forcePushed"}, {"oid": "5154b1f49a9d0c12d004e3d56dfe1683fc133329", "url": "https://github.com/dockstore/dockstore/commit/5154b1f49a9d0c12d004e3d56dfe1683fc133329", "message": "One lgtm.yml to rule them all", "committedDate": "2020-09-05T00:28:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUyODIzNQ==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r484528235", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            of the source tree. For information on installing it on your platform check https://github.com/awslabs/git-secrets#id6 .\n          \n          \n            \n            of the source tree. For information on installing it on your platform check <https://github.com/awslabs/git-secrets#id6>.", "author": "chmreid", "createdAt": "2020-09-07T17:20:28Z", "path": "README.md", "diffHunk": "@@ -163,6 +163,13 @@ We also have a matching [checkstyle.xml](checkstyle.xml) that can be imported in\n \n For users of Intellij or comparable IDEs, we also suggest loading the checkstyle.xml with a plugin in order to display warnings and errors while coding live rather than encountering them later when running a build. \n \n+#### Installing git-secrets\n+\n+Dockstore uses git-secrets to help make sure that keys and private data stay out\n+of the source tree. For information on installing it on your platform check https://github.com/awslabs/git-secrets#id6 .", "originalCommit": "5154b1f49a9d0c12d004e3d56dfe1683fc133329", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUyOTE5Ng==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r484529196", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      name: git-secrets Scan\n          \n          \n            \n                      name: Run git-secrets scan on dockstore repository", "author": "chmreid", "createdAt": "2020-09-07T17:24:57Z", "path": ".circleci/config.yml", "diffHunk": "@@ -96,6 +110,12 @@ jobs:\n             scripts/check_migrations.sh\n           environment:\n             TESTING_PROFILE: automated-review\n+      - run:\n+          name: git-secrets Scan", "originalCommit": "5154b1f49a9d0c12d004e3d56dfe1683fc133329", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUzMDA5MA==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r484530090", "bodyText": "This should probably be a recursive scan - otherwise directories are not scanned\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        git secrets --scan\n          \n          \n            \n                        git secrets -r --scan", "author": "chmreid", "createdAt": "2020-09-07T17:29:25Z", "path": ".circleci/config.yml", "diffHunk": "@@ -96,6 +110,12 @@ jobs:\n             scripts/check_migrations.sh\n           environment:\n             TESTING_PROFILE: automated-review\n+      - run:\n+          name: git-secrets Scan\n+          # Needs to be after a build so that the correct configuration is set\n+          # by the exec-maven plugin\n+          command: |\n+            git secrets --scan", "originalCommit": "5154b1f49a9d0c12d004e3d56dfe1683fc133329", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIyMDI3Ng==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r485220276", "bodyText": "Since we aren't providing files it uses the output of git ls-files to generate the list to check. You only need the -r if you specify a directory. You can test this by seeing the output of git secrets --scan and git secrets --scan -r are identical.\nhttps://github.com/awslabs/git-secrets#id15\nI tried running git secrets . --scan -r and it scans the classes in the target directory, reports generated during builds, and entries from the .git directory itself pointing at commit hashes. I'm pretty sure that for protecting your git tree you just needs git ls-files since it will stop anything staged to the tree. Technically you can run git-secrets in the mode to look at all files, but I think it isn't useful since these changes aren't part of the source tree.", "author": "david4096", "createdAt": "2020-09-08T22:01:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUzMDA5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUyMTU3Nw==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r486521577", "bodyText": "Sounds good - thanks for checking into that.", "author": "chmreid", "createdAt": "2020-09-10T17:42:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUzMDA5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUzMDc1Mg==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r484530752", "bodyText": "It looks like you added an \"Install git-secrets\" section to this OpenAPI validation step, but no other steps use it. Was this supposed to be removed? Or is it used by the Maven stuff?", "author": "chmreid", "createdAt": "2020-09-07T17:32:37Z", "path": ".circleci/config.yml", "diffHunk": "@@ -31,6 +31,13 @@ jobs:\n             wget https://github.com/mikefarah/yq/releases/download/3.3.2/yq_linux_amd64\n             chmod a+x yq_linux_amd64\n             sudo mv yq_linux_amd64 /usr/bin/yq\n+      - run:\n+          name: Install git-secrets", "originalCommit": "5154b1f49a9d0c12d004e3d56dfe1683fc133329", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIzMTc1Mw==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r485231753", "bodyText": "Yeah, this PR makes having git-secrets on the path a build requirement even if it doesn't do the scan.", "author": "david4096", "createdAt": "2020-09-08T22:34:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUzMDc1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUzMTU4Nw==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r484531587", "bodyText": "Suggestion for future PR: add some instructions to the Readme that mentions how to install the git secret hooks locally and use the install hooks script. Then Dockstore engineers could have git secrets running/set up locally, and that step can make its way into an (the?) onboarding checklist.", "author": "chmreid", "createdAt": "2020-09-07T17:37:01Z", "path": "git-hooks/commit-msg", "diffHunk": "@@ -0,0 +1,2 @@\n+#!/usr/bin/env bash\n+git secrets --commit_msg_hook -- \"$@\"", "originalCommit": "5154b1f49a9d0c12d004e3d56dfe1683fc133329", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIzMTMzMQ==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r485231331", "bodyText": "The intention of this PR is to make it so you don't have to install the hooks. If you use the maven machinery, the hooks will be setup for this repo with the settings we advise. git-secrets just needs to be on the path somewhere for this to work, which is an improvement over having to install and manage them individually. I added instructions for that to the readme.\nIn principal you could make a maven stage that installed git-secrets to the path, but I think its generally an anti-pattern to use maven pom to do too much management of OS level dependencies, since for example, the path may be different depending on the environment.", "author": "david4096", "createdAt": "2020-09-08T22:32:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUzMTU4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUyMjg4Mg==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r486522882", "bodyText": "Okay, that clears things up, I wasn't thinking about it correctly before", "author": "chmreid", "createdAt": "2020-09-10T17:44:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUzMTU4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUzMzkwMg==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r484533902", "bodyText": "I'm a bit confused (also ignorant of how exec-maven-plugin works) - is this command running the install hooks command on this (the local CI) machine, or is the command being run on some Maven server somewhere in the cloud?", "author": "chmreid", "createdAt": "2020-09-07T17:47:48Z", "path": "pom.xml", "diffHunk": "@@ -431,9 +431,26 @@\n                     <artifactId>license-maven-plugin</artifactId>\n                     <version>2.0.0</version>\n                 </plugin>\n+                <plugin>\n+                    <artifactId>exec-maven-plugin</artifactId>\n+                    <version>1.6.0</version>\n+                    <groupId>org.codehaus.mojo</groupId>\n+                    <executions>\n+                        <execution>\n+                            <id>Install git-secrets</id>\n+                            <phase>initialize</phase>\n+                            <goals>\n+                                <goal>exec</goal>\n+                            </goals>\n+                            <configuration>\n+                                <executable>bash</executable>\n+                                <commandlineArgs>${project.parent.basedir}/scripts/install-git-hooks.sh</commandlineArgs>", "originalCommit": "5154b1f49a9d0c12d004e3d56dfe1683fc133329", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk3MzgzMw==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r484973833", "bodyText": "Should be running locally (or on CI when checked out there)", "author": "denis-yuen", "createdAt": "2020-09-08T14:40:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUzMzkwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIyNDk0Ng==", "url": "https://github.com/dockstore/dockstore/pull/3788#discussion_r485224946", "bodyText": "You can think of maven pom.xml like the setup.py or package.json for Java. It defines dependencies that need to be downloaded and allows you to control various stages of building your project (verify, install, package, etc). In this case, our settings should be set on whatever machine is running the maven intialize on developer and CI terminals.", "author": "david4096", "createdAt": "2020-09-08T22:14:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUzMzkwMg=="}], "type": "inlineReview"}, {"oid": "69227572731474dd6c43e7c61acf0b2d7615b3cc", "url": "https://github.com/dockstore/dockstore/commit/69227572731474dd6c43e7c61acf0b2d7615b3cc", "message": "One lgtm.yml to rule them all", "committedDate": "2020-09-08T22:22:41Z", "type": "forcePushed"}, {"oid": "31e8d21704e1cf92dfe25d1fac0eb4332897a16c", "url": "https://github.com/dockstore/dockstore/commit/31e8d21704e1cf92dfe25d1fac0eb4332897a16c", "message": "One lgtm.yml to rule them all", "committedDate": "2020-09-08T22:24:52Z", "type": "forcePushed"}, {"oid": "ce09b2bee0f0a5f0d7d13b7c2a10b5a29c9fda4d", "url": "https://github.com/dockstore/dockstore/commit/ce09b2bee0f0a5f0d7d13b7c2a10b5a29c9fda4d", "message": "One lgtm.yml to rule them all", "committedDate": "2020-09-08T22:29:26Z", "type": "forcePushed"}, {"oid": "bd2590e86513a4cf1c51899427a4089b2449f9fb", "url": "https://github.com/dockstore/dockstore/commit/bd2590e86513a4cf1c51899427a4089b2449f9fb", "message": "One lgtm.yml to rule them all", "committedDate": "2020-09-08T22:37:50Z", "type": "forcePushed"}, {"oid": "1e377c81c2359c5ee54592510890004d040e8c1f", "url": "https://github.com/dockstore/dockstore/commit/1e377c81c2359c5ee54592510890004d040e8c1f", "message": "One lgtm.yml to rule them all", "committedDate": "2020-09-08T22:59:00Z", "type": "forcePushed"}, {"oid": "0daa58e8e4a784ae9cd07d12bfc38dda67a0aa54", "url": "https://github.com/dockstore/dockstore/commit/0daa58e8e4a784ae9cd07d12bfc38dda67a0aa54", "message": "Use preferred hidden lgtm yml", "committedDate": "2020-09-10T17:42:36Z", "type": "forcePushed"}, {"oid": "d5bd882f47aaff523a89243c5ffcc06afa49d13d", "url": "https://github.com/dockstore/dockstore/commit/d5bd882f47aaff523a89243c5ffcc06afa49d13d", "message": "Travis failures need a new commit\nSomething is failing when a build is rerun and a coveralls\nsupport has already been submitted. Trying a workaround of\njust making a new commit to rerun the tests. This will rerun\nall the tests. Sorry :/", "committedDate": "2020-09-10T23:48:32Z", "type": "forcePushed"}, {"oid": "86611b06ba2a27749ad97514ed3d53f8e45165f4", "url": "https://github.com/dockstore/dockstore/commit/86611b06ba2a27749ad97514ed3d53f8e45165f4", "message": "Add an exec plugin that sets git config during initialize\nSet up git secrets AWS provider\nMake sure we don't set extra configs", "committedDate": "2020-09-11T16:40:01Z", "type": "commit"}, {"oid": "71c2dc2f6555ad99f30602172c913b9e2c25bc4e", "url": "https://github.com/dockstore/dockstore/commit/71c2dc2f6555ad99f30602172c913b9e2c25bc4e", "message": "Move installation to a bash script", "committedDate": "2020-09-11T16:40:01Z", "type": "commit"}, {"oid": "70469fedcaf8ac6a050bd4abfaf38abfb1e4e8c2", "url": "https://github.com/dockstore/dockstore/commit/70469fedcaf8ac6a050bd4abfaf38abfb1e4e8c2", "message": "Clear false positives in current source", "committedDate": "2020-09-11T16:40:01Z", "type": "commit"}, {"oid": "c8245fa2c6defda85c43779c9e04cccc31c06d0f", "url": "https://github.com/dockstore/dockstore/commit/c8245fa2c6defda85c43779c9e04cccc31c06d0f", "message": "Add readme, comments to .gitallowed", "committedDate": "2020-09-11T16:40:01Z", "type": "commit"}, {"oid": "e14f38ff70f63edcb4d770ab2722f3d5d7c4ee03", "url": "https://github.com/dockstore/dockstore/commit/e14f38ff70f63edcb4d770ab2722f3d5d7c4ee03", "message": "Move script, simplify, set bash flags", "committedDate": "2020-09-11T16:40:01Z", "type": "commit"}, {"oid": "42d2b914a95f27a8f41ccaed803ee3f413818a25", "url": "https://github.com/dockstore/dockstore/commit/42d2b914a95f27a8f41ccaed803ee3f413818a25", "message": "Install git-secrets in CI", "committedDate": "2020-09-11T16:40:01Z", "type": "commit"}, {"oid": "64e37ea003301dbd12fc3fe895c5a896decd09d5", "url": "https://github.com/dockstore/dockstore/commit/64e37ea003301dbd12fc3fe895c5a896decd09d5", "message": "Change gitallowed to be more paranoid", "committedDate": "2020-09-11T16:40:01Z", "type": "commit"}, {"oid": "62158e6e135064684d2bf69b98264497b1e04b05", "url": "https://github.com/dockstore/dockstore/commit/62158e6e135064684d2bf69b98264497b1e04b05", "message": "Run git-secrets scan in circle\nTechnically if someone pushes a secret to a branch\nit will still be in the git tree, however, this\ncheck will help it keep from being merged.\n\nFix travis wget script\nAnd add git-secrets to lgtm", "committedDate": "2020-09-11T16:40:01Z", "type": "commit"}, {"oid": "a4e4629cae5a8a34743affaf19a632e92cfe691a", "url": "https://github.com/dockstore/dockstore/commit/a4e4629cae5a8a34743affaf19a632e92cfe691a", "message": "Clean up .gitallowed", "committedDate": "2020-09-11T16:40:01Z", "type": "commit"}, {"oid": "21f01619c3b1329c6f6e5df13a71bd46437fefaf", "url": "https://github.com/dockstore/dockstore/commit/21f01619c3b1329c6f6e5df13a71bd46437fefaf", "message": "One lgtm.yml to rule them all", "committedDate": "2020-09-11T16:40:01Z", "type": "commit"}, {"oid": "2cf9534cfc1dc0c318099988e3fc17dbdc2bcb7c", "url": "https://github.com/dockstore/dockstore/commit/2cf9534cfc1dc0c318099988e3fc17dbdc2bcb7c", "message": "Accepted suggestions by @chmreid", "committedDate": "2020-09-11T16:40:01Z", "type": "commit"}, {"oid": "a44490f350a83d0f33183928336a948b61604594", "url": "https://github.com/dockstore/dockstore/commit/a44490f350a83d0f33183928336a948b61604594", "message": "Use preferred hidden lgtm yml", "committedDate": "2020-09-11T16:40:01Z", "type": "commit"}, {"oid": "a94013aeb6171a54d0d571e3591ea1d4f878e982", "url": "https://github.com/dockstore/dockstore/commit/a94013aeb6171a54d0d571e3591ea1d4f878e982", "message": "Travis failures need a new commit\nSomething is failing when a build is rerun and a coveralls\nsupport has already been submitted. Trying a workaround of\njust making a new commit to rerun the tests. This will rerun\nall the tests. Sorry :/", "committedDate": "2020-09-11T16:40:01Z", "type": "commit"}, {"oid": "a94013aeb6171a54d0d571e3591ea1d4f878e982", "url": "https://github.com/dockstore/dockstore/commit/a94013aeb6171a54d0d571e3591ea1d4f878e982", "message": "Travis failures need a new commit\nSomething is failing when a build is rerun and a coveralls\nsupport has already been submitted. Trying a workaround of\njust making a new commit to rerun the tests. This will rerun\nall the tests. Sorry :/", "committedDate": "2020-09-11T16:40:01Z", "type": "forcePushed"}]}