{"pr_number": 3163, "pr_title": "Hook up Galaxy as a pf4j plugin", "pr_createdAt": "2020-01-17T21:16:46Z", "pr_url": "https://github.com/dockstore/dockstore/pull/3163", "timeline": [{"oid": "42fee38cef80106d4099753441f761c587bf135e", "url": "https://github.com/dockstore/dockstore/commit/42fee38cef80106d4099753441f761c587bf135e", "message": "[skip ci]\n\nBeginnings of generic language support for tools and DAG.", "committedDate": "2019-12-13T04:49:21Z", "type": "commit"}, {"oid": "2a153d50f1e2fe7807ed86a45ed1c4c2891479f2", "url": "https://github.com/dockstore/dockstore/commit/2a153d50f1e2fe7807ed86a45ed1c4c2891479f2", "message": "Make interface compile", "committedDate": "2019-12-17T16:33:00Z", "type": "commit"}, {"oid": "04ceb27938a295bbb46309f51256196deb829448", "url": "https://github.com/dockstore/dockstore/commit/04ceb27938a295bbb46309f51256196deb829448", "message": "Add listing files inteface method to help with rate limit", "committedDate": "2019-12-17T17:11:46Z", "type": "commit"}, {"oid": "50eeead2fd71fe73b61ecd7e23fb642ed9dfc91e", "url": "https://github.com/dockstore/dockstore/commit/50eeead2fd71fe73b61ecd7e23fb642ed9dfc91e", "message": "Has 3.6.7 python disappeared?", "committedDate": "2019-12-17T17:26:12Z", "type": "commit"}, {"oid": "bd01556b8347dcb33c5c892f505aa9d03a627be5", "url": "https://github.com/dockstore/dockstore/commit/bd01556b8347dcb33c5c892f505aa9d03a627be5", "message": "fix migration from prod", "committedDate": "2019-12-17T20:36:24Z", "type": "commit"}, {"oid": "711dc979e132b12c8a4440c919871613336fa48f", "url": "https://github.com/dockstore/dockstore/commit/711dc979e132b12c8a4440c919871613336fa48f", "message": "WIP for galaxy integration work", "committedDate": "2019-12-17T23:41:27Z", "type": "commit"}, {"oid": "72808daa7948209904e858e26ce3d5f853faf2e1", "url": "https://github.com/dockstore/dockstore/commit/72808daa7948209904e858e26ce3d5f853faf2e1", "message": "Iterate version numbers", "committedDate": "2019-12-18T21:42:59Z", "type": "commit"}, {"oid": "8869f064641052e13efb2e7ebe2f7ffb683fc380", "url": "https://github.com/dockstore/dockstore/commit/8869f064641052e13efb2e7ebe2f7ffb683fc380", "message": "Compiles", "committedDate": "2019-12-18T21:51:21Z", "type": "commit"}, {"oid": "f9e64c8268548ccaf3176ebcea352949292b3fe7", "url": "https://github.com/dockstore/dockstore/commit/f9e64c8268548ccaf3176ebcea352949292b3fe7", "message": "Working on release [skip ci]", "committedDate": "2019-12-18T22:48:05Z", "type": "commit"}, {"oid": "6e0887712ee7490d4e4c50321aa4cdd9037f9081", "url": "https://github.com/dockstore/dockstore/commit/6e0887712ee7490d4e4c50321aa4cdd9037f9081", "message": "[maven-release-plugin] prepare release 1.8.0-alpha.3-GALAXYEXP", "committedDate": "2019-12-18T22:51:47Z", "type": "commit"}, {"oid": "c45a73e8707c4b1623cceaaa845e2ff3baf3e866", "url": "https://github.com/dockstore/dockstore/commit/c45a73e8707c4b1623cceaaa845e2ff3baf3e866", "message": "[maven-release-plugin] prepare for next development iteration", "committedDate": "2019-12-18T22:51:53Z", "type": "commit"}, {"oid": "886f208f1a09a8921222a0b09a524d23d4adafbd", "url": "https://github.com/dockstore/dockstore/commit/886f208f1a09a8921222a0b09a524d23d4adafbd", "message": "Merge branch 'develop' into feature/completelanguage", "committedDate": "2020-01-16T15:45:01Z", "type": "commit"}, {"oid": "d420514c0dba01ec1abd6d21dfdbb4199b32dd46", "url": "https://github.com/dockstore/dockstore/commit/d420514c0dba01ec1abd6d21dfdbb4199b32dd46", "message": "Superficial functional plugins framework", "committedDate": "2020-01-16T22:38:11Z", "type": "commit"}, {"oid": "e6bcbac51fce29487255768ff53c4fe86dba626b", "url": "https://github.com/dockstore/dockstore/commit/e6bcbac51fce29487255768ff53c4fe86dba626b", "message": "[maven-release-plugin] prepare release 1.9.0-alpha.0", "committedDate": "2020-01-17T16:59:00Z", "type": "commit"}, {"oid": "ddd6bca3b17b6203a156cf2e01bbb0a3b62338ec", "url": "https://github.com/dockstore/dockstore/commit/ddd6bca3b17b6203a156cf2e01bbb0a3b62338ec", "message": "[maven-release-plugin] prepare for next development iteration", "committedDate": "2020-01-17T16:59:07Z", "type": "commit"}, {"oid": "ca43cb8735e59ea417fb8f9c5f684308bf276bb4", "url": "https://github.com/dockstore/dockstore/commit/ca43cb8735e59ea417fb8f9c5f684308bf276bb4", "message": "Add tests for galaxy plugin", "committedDate": "2020-01-17T20:38:19Z", "type": "commit"}, {"oid": "6967665f4901c106397512202d8049895a5b0c8d", "url": "https://github.com/dockstore/dockstore/commit/6967665f4901c106397512202d8049895a5b0c8d", "message": "Add the actual tests", "committedDate": "2020-01-17T20:42:48Z", "type": "commit"}, {"oid": "757c414c67c498e2f0d523e5ce739278f24ba340", "url": "https://github.com/dockstore/dockstore/commit/757c414c67c498e2f0d523e5ce739278f24ba340", "message": "Merge branch 'develop' into feature/completelanguage", "committedDate": "2020-01-17T20:57:44Z", "type": "commit"}, {"oid": "1dceda83c308677115892a66abf19626467cc7c9", "url": "https://github.com/dockstore/dockstore/commit/1dceda83c308677115892a66abf19626467cc7c9", "message": "Fix merge conflict", "committedDate": "2020-01-17T21:12:32Z", "type": "commit"}, {"oid": "87e5ee59c0f6154d69c71cc7044cbaa0b5a62a5e", "url": "https://github.com/dockstore/dockstore/commit/87e5ee59c0f6154d69c71cc7044cbaa0b5a62a5e", "message": "Debug galaxy plugin in circle [skip travis]", "committedDate": "2020-01-20T17:17:16Z", "type": "commit"}, {"oid": "dbee17958b941224272be0c3eccfa5df7ac21321", "url": "https://github.com/dockstore/dockstore/commit/dbee17958b941224272be0c3eccfa5df7ac21321", "message": "Static caches causing problems when restarting DropwizardTestSupport", "committedDate": "2020-01-20T17:17:16Z", "type": "commit"}, {"oid": "dbee17958b941224272be0c3eccfa5df7ac21321", "url": "https://github.com/dockstore/dockstore/commit/dbee17958b941224272be0c3eccfa5df7ac21321", "message": "Static caches causing problems when restarting DropwizardTestSupport", "committedDate": "2020-01-20T17:17:16Z", "type": "forcePushed"}, {"oid": "548457e47c65ed48d30e69d777fcdd1c8dd056f1", "url": "https://github.com/dockstore/dockstore/commit/548457e47c65ed48d30e69d777fcdd1c8dd056f1", "message": "Appease codacy", "committedDate": "2020-01-20T17:20:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE1Nzk1NA==", "url": "https://github.com/dockstore/dockstore/pull/3163#discussion_r369157954", "bodyText": "Use LOG", "author": "coverbeck", "createdAt": "2020-01-21T18:06:04Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/DockstoreWebserviceApplication.java", "diffHunk": "@@ -227,6 +238,14 @@ private static void configureMapper(ObjectMapper objectMapper) {\n         objectMapper.enable(MapperFeature.ACCEPT_CASE_INSENSITIVE_ENUMS);\n     }\n \n+    public static File getFilePluginLocation(DockstoreWebserviceConfiguration configuration) {\n+        String userHome = System.getProperty(\"user.home\");\n+        String filename = userHome + File.separator + \".dockstore\" + File.separator + \"language-plugins\";\n+        filename = StringUtils.isEmpty(configuration.getLanguagePluginLocation()) ? filename : configuration.getLanguagePluginLocation();\n+        System.out.println(\"File plugin path set to:\" + filename);", "originalCommit": "548457e47c65ed48d30e69d777fcdd1c8dd056f1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE2MDI5Ng==", "url": "https://github.com/dockstore/dockstore/pull/3163#discussion_r369160296", "bodyText": "The description for the value is out of date -- doesn't match allowable values.", "author": "coverbeck", "createdAt": "2020-01-21T18:11:17Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Workflow.java", "diffHunk": "@@ -119,7 +119,7 @@\n     // this one is annoying since the codegen doesn't seem to pick up @JsonValue in the DescriptorLanguage enum\n     @Column(nullable = false)\n     @Convert(converter = DescriptorLanguageConverter.class)\n-    @ApiModelProperty(value = \"This is a descriptor type for the workflow, either CWL, WDL, or Nextflow (Defaults to CWL)\", required = true, position = 18, allowableValues = \"CWL, WDL, NFL, service\")\n+    @ApiModelProperty(value = \"This is a descriptor type for the workflow, either CWL, WDL, or Nextflow (Defaults to CWL)\", required = true, position = 18, allowableValues = \"CWL, WDL, NFL, gxformat2, service\")", "originalCommit": "548457e47c65ed48d30e69d777fcdd1c8dd056f1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI0MjA4Mw==", "url": "https://github.com/dockstore/dockstore/pull/3163#discussion_r369242083", "bodyText": "Do you want to expose this? It's showing up in the openapi/swagger doc.", "author": "coverbeck", "createdAt": "2020-01-21T21:04:40Z", "path": "dockstore-common/src/main/java/io/dockstore/common/DescriptorLanguage.java", "diffHunk": "@@ -30,27 +30,38 @@\n  */\n public enum DescriptorLanguage {\n     // Add new descriptor language here\n-    CWL(\"CWL\", \"Common Workflow Language\", FileType.DOCKSTORE_CWL, FileType.CWL_TEST_JSON) {\n+    CWL(\"CWL\", \"Common Workflow Language\", FileType.DOCKSTORE_CWL, FileType.CWL_TEST_JSON, false, false) {\n         @Override\n         public boolean isRelevantFileType(FileType type) {\n             return super.isRelevantFileType(type) || type == FileType.DOCKERFILE;\n         }\n     },\n-    WDL(\"WDL\", \"Workflow Description Language\", FileType.DOCKSTORE_WDL, FileType.WDL_TEST_JSON) {\n+    WDL(\"WDL\", \"Workflow Description Language\", FileType.DOCKSTORE_WDL, FileType.WDL_TEST_JSON, false, false) {\n         @Override\n         public boolean isRelevantFileType(FileType type) {\n             return super.isRelevantFileType(type) || type == FileType.DOCKERFILE;\n         }\n     },\n+    GXFORMAT2(\"gxformat2\", \"Galaxy Workflow Format 2\", FileType.DOCKSTORE_GXFORMAT2, FileType.GXFORMAT2_TEST_FILE, false, true) {\n+        @Override\n+        public boolean isRelevantFileType(FileType type) {\n+            return super.isRelevantFileType(type);\n+        }\n+    },\n     // DOCKSTORE-2428 - demo how to add new workflow language\n-    //SWL(\"SWL\", \"Silly Workflow Language\", FileType.DOCKSTORE_SWL, FileType.SWL_TEST_JSON)\n-    NEXTFLOW(\"NFL\", \"Nextflow\", FileType.NEXTFLOW_CONFIG, FileType.NEXTFLOW_TEST_PARAMS) {\n+    SWL(\"SWL\", \"Silly Workflow Language\", FileType.DOCKSTORE_SWL, FileType.SWL_TEST_JSON, false, true) {", "originalCommit": "548457e47c65ed48d30e69d777fcdd1c8dd056f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI0NzMxMg==", "url": "https://github.com/dockstore/dockstore/pull/3163#discussion_r369247312", "bodyText": "I think I need to play around with this in a new PR.\nIn discussion with @garyluu, I think it can be tricky. For type-checking reasons I think we have to expose every possible language we support in the swagger.yaml/openapi.yaml.\nWe can display dynamically at endpoints like https://dockstore.org/api/metadata/descriptorLanguageList a subset of those languages based on what is currently installed (including the languages that are supported by plugins).\nI think we want to update the example plugin for SWL based on feedback from Galaxy, so I'm thinking we keep it.", "author": "denis-yuen", "createdAt": "2020-01-21T21:17:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI0MjA4Mw=="}], "type": "inlineReview"}, {"oid": "d36905933f9dabfd06f2c1c137c04c4910eb393d", "url": "https://github.com/dockstore/dockstore/commit/d36905933f9dabfd06f2c1c137c04c4910eb393d", "message": "PR  feedback", "committedDate": "2020-01-21T21:39:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI3OTMyNg==", "url": "https://github.com/dockstore/dockstore/pull/3163#discussion_r369279326", "bodyText": "A small nit. For readability this section could use String.format in addition to the append so that we can avoid lines that are just builder.append(\"\\t\").", "author": "david4096", "createdAt": "2020-01-21T22:32:04Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/DockstoreWebserviceApplication.java", "diffHunk": "@@ -369,6 +392,36 @@ public void run(DockstoreWebserviceConfiguration configuration, Environment envi\n \n     }\n \n+    private void describeAvailableLanguagePlugins(DefaultPluginManager languagePluginManager) {\n+        List<PluginWrapper> plugins = languagePluginManager.getStartedPlugins();\n+        if (plugins.isEmpty()) {\n+            LOG.info(\"No language plugins installed\");\n+            return;\n+        }\n+        StringBuilder builder = new StringBuilder();\n+        builder.append(\"PluginId\\tPlugin Version\\tPlugin Path\\tInitial Path Pattern\\tPlugin Type(s)\\n\");", "originalCommit": "d36905933f9dabfd06f2c1c137c04c4910eb393d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTU3Njk0Ng==", "url": "https://github.com/dockstore/dockstore/pull/3163#discussion_r369576946", "bodyText": "Is this correct?", "author": "agduncan94", "createdAt": "2020-01-22T14:04:58Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/webservice/languages/GalaxyPluginIT.java", "diffHunk": "@@ -0,0 +1,137 @@\n+/*\n+ *    Copyright 2020 OICR\n+ *\n+ *    Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *    you may not use this file except in compliance with the License.\n+ *    You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *    Unless required by applicable law or agreed to in writing, software\n+ *    distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *    See the License for the specific language governing permissions and\n+ *    limitations under the License.\n+ */\n+package io.dockstore.webservice.languages;\n+\n+import java.io.IOException;\n+import java.net.URL;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.List;\n+\n+import io.dockstore.common.CommonTestUtilities;\n+import io.dockstore.common.DescriptorLanguage;\n+import io.dockstore.common.NonConfidentialTest;\n+import io.dockstore.common.TestingPostgres;\n+import io.dockstore.webservice.DockstoreWebserviceApplication;\n+import io.dockstore.webservice.DockstoreWebserviceConfiguration;\n+import io.dropwizard.testing.ConfigOverride;\n+import io.dropwizard.testing.DropwizardTestSupport;\n+import io.swagger.client.api.MetadataApi;\n+import io.swagger.client.model.DescriptorLanguageBean;\n+import org.apache.commons.io.FileUtils;\n+import org.junit.AfterClass;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.contrib.java.lang.system.ExpectedSystemExit;\n+import org.junit.contrib.java.lang.system.SystemErrRule;\n+import org.junit.contrib.java.lang.system.SystemOutRule;\n+import org.junit.experimental.categories.Category;\n+import org.junit.rules.ExpectedException;\n+import org.junit.rules.TestRule;\n+import org.junit.rules.TestWatcher;\n+import org.junit.runner.Description;\n+\n+import static io.dockstore.common.CommonTestUtilities.getWebClient;\n+\n+/**\n+ * This test does not require confidential data.\n+ * These tests are a bit weird because we're testing the webservice running with the Galaxy language plugin installed.\n+ *\n+ * @author gluu\n+ * @since 24/07/18", "originalCommit": "d36905933f9dabfd06f2c1c137c04c4910eb393d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTYyNjkxMw==", "url": "https://github.com/dockstore/dockstore/pull/3163#discussion_r369626913", "bodyText": "Nope", "author": "denis-yuen", "createdAt": "2020-01-22T15:26:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTU3Njk0Ng=="}], "type": "inlineReview"}, {"oid": "40e1fb49c6a13ee626ef1e1d4ec3e3c35f90f067", "url": "https://github.com/dockstore/dockstore/commit/40e1fb49c6a13ee626ef1e1d4ec3e3c35f90f067", "message": "PR feedback", "committedDate": "2020-01-22T15:28:08Z", "type": "commit"}, {"oid": "a60fb6b5bc4e03fea14f8996e75689b74a9554a5", "url": "https://github.com/dockstore/dockstore/commit/a60fb6b5bc4e03fea14f8996e75689b74a9554a5", "message": "Merge branch 'develop' into feature/completelanguage", "committedDate": "2020-01-22T15:35:16Z", "type": "commit"}]}