{"pr_number": 3789, "pr_title": "@jsonignore sourcefiles", "pr_createdAt": "2020-09-03T20:39:42Z", "pr_url": "https://github.com/dockstore/dockstore/pull/3789", "timeline": [{"oid": "2f762689923d40f7405a75d5f96b4cb410f3bc7f", "url": "https://github.com/dockstore/dockstore/commit/2f762689923d40f7405a75d5f96b4cb410f3bc7f", "message": "@jsonignore sourcefiles", "committedDate": "2020-09-03T20:31:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI4Mjg0MA==", "url": "https://github.com/dockstore/dockstore/pull/3789#discussion_r483282840", "bodyText": "probably doesn't matter, but this should not be using a workflow in my personal repo", "author": "denis-yuen", "createdAt": "2020-09-03T22:16:28Z", "path": "dockstore-webservice/src/main/resources/migrations.test.add_test_tools.xml", "diffHunk": "@@ -0,0 +1,279 @@\n+<?xml version=\"1.1\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<!--\n+  ~    Copyright 2020 OICR\n+  ~\n+  ~    Licensed under the Apache License, Version 2.0 (the \"License\");\n+  ~    you may not use this file except in compliance with the License.\n+  ~    You may obtain a copy of the License at\n+  ~\n+  ~        http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~    Unless required by applicable law or agreed to in writing, software\n+  ~    distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~    See the License for the specific language governing permissions and\n+  ~    limitations under the License.\n+  -->\n+<databaseChangeLog xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+                   xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd\"\n+                   context=\"add_test_tools\">\n+    <changeSet id=\"dockerhub_tool\" author=\"natalieperez\">\n+        <insert tableName=\"sourcefile\">\n+            <column name=\"id\" valueNumeric=\"50\"/>\n+            <column name=\"content\" value=\"cwlstuff\"/>\n+            <column name=\"path\" value=\"/dockstore.cwl\"/>\n+            <column name=\"type\" value=\"DOCKSTORE_CWL\"/>\n+        </insert>\n+        <insert tableName=\"sourcefile\">\n+            <column name=\"id\" valueNumeric=\"51\"/>\n+            <column name=\"content\" value=\"dockerstuff\"/>\n+            <column name=\"path\" value=\"/Dockerfile\"/>\n+            <column name=\"type\" value=\"DOCKERFILE\"/>\n+        </insert>\n+        <insert tableName=\"tag\">\n+            <column name=\"id\" valueNumeric=\"50\"/>\n+            <column name=\"dirtybit\" valueBoolean=\"false\"/>\n+            <column name=\"hidden\" valueBoolean=\"false\"/>\n+            <column name=\"lastmodified\" valueDate=\"2016-02-04 16:44:00.0\"/>\n+            <column name=\"name\" value=\"1.0\"/>\n+            <column name=\"reference\" value=\"master\"/>\n+            <column name=\"valid\" valueBoolean=\"true\"/>\n+            <column name=\"verified\" valueBoolean=\"false\"/>\n+            <column name=\"verifiedsource\"/>\n+            <column name=\"automated\" valueBoolean=\"true\"/>\n+            <column name=\"cwlpath\" value=\"/dockstore.cwl\"/>\n+            <column name=\"dockerfilepath\" value=\"/Dockerfile\"/>\n+            <column name=\"imageid\" value=\"123456\"/>\n+            <column name=\"size\" valueNumeric=\"108608297\"/>\n+            <column name=\"wdlpath\" value=\"/Dockstore.wdl\"/>\n+        </insert>\n+        <insert tableName=\"tool\">\n+            <column name=\"id\" valueNumeric=\"50\"/>\n+            <column name=\"author\" value=\"\"/>\n+            <column name=\"defaultversion\"/>\n+            <column name=\"description\" value=\"\"/>\n+            <column name=\"email\" value=\"\"/>\n+            <column name=\"giturl\" value=\"git@github.com:DockstoreTestUser2/dockstore-tool-imports.git\"/>\n+            <column name=\"ispublished\" valueBoolean=\"false\"/>\n+            <column name=\"lastmodified\"/>\n+            <column name=\"lastupdated\" valueDate=\"2016-03-15 15:55:38.502\"/>\n+            <column name=\"defaultcwlpath\" value=\"/dockstore.cwl\"/>\n+            <column name=\"defaultdockerfilepath\" value=\"/Dockerfile\"/>\n+            <column name=\"defaulttestcwlparameterfile\" value=\"\"/>\n+            <column name=\"defaulttestwdlparameterfile\" value=\"\"/>\n+            <column name=\"defaultwdlpath\" value=\"/Dockstore.wdl\"/>\n+            <column name=\"lastbuild\" valueDate=\"2016-02-16 17:04:59.0\"/>\n+            <column name=\"mode\" value=\"MANUAL_IMAGE_PATH\"/>\n+            <column name=\"name\" value=\"testUpdatePath\"/>\n+            <column name=\"namespace\" value=\"testPath\"/>\n+            <column name=\"path\" value=\"quay.io/dockstoretestuser2/dockstore-tool-imports\"/>\n+            <column name=\"privateaccess\" valueBoolean=\"false\"/>\n+            <column name=\"registry\" value=\"DOCKER_HUB\"/>\n+            <column name=\"toolmaintaineremail\" value=\"\"/>\n+            <column name=\"toolname\" value=\"test5\"/>\n+        </insert>\n+        <insert tableName=\"tool_tag\">\n+            <column name=\"toolid\" valueNumeric=\"50\"/>\n+            <column name=\"tagid\" valueNumeric=\"50\"/>\n+        </insert>\n+        <insert tableName=\"user_entry\">\n+            <column name=\"userid\" valueNumeric=\"1\"/>\n+            <column name=\"entryid\" valueNumeric=\"50\"/>\n+        </insert>\n+        <insert tableName=\"version_sourcefile\">\n+            <column name=\"versionid\" valueNumeric=\"50\"/>\n+            <column name=\"sourcefileid\" valueNumeric=\"50\"/>\n+        </insert>\n+        <insert tableName=\"version_sourcefile\">\n+            <column name=\"versionid\" valueNumeric=\"50\"/>\n+            <column name=\"sourcefileid\" valueNumeric=\"51\"/>\n+        </insert>\n+    </changeSet>\n+\n+    <changeSet id=\"quay_tool\" author=\"natalieperez\">\n+        <insert tableName=\"sourcefile\">\n+            <column name=\"id\" valueNumeric=\"60\"/>\n+            <column name=\"content\" value=\"cwlstuff\"/>\n+            <column name=\"path\" value=\"/dockstore.cwl\"/>\n+            <column name=\"type\" value=\"DOCKSTORE_CWL\"/>\n+        </insert>\n+        <insert tableName=\"sourcefile\">\n+            <column name=\"id\" valueNumeric=\"61\"/>\n+            <column name=\"content\" value=\"dockerstuff\"/>\n+            <column name=\"path\" value=\"/Dockerfile\"/>\n+            <column name=\"type\" value=\"DOCKERFILE\"/>\n+        </insert>\n+        <insert tableName=\"tag\">\n+            <column name=\"id\" valueNumeric=\"60\"/>\n+            <column name=\"dirtybit\" valueBoolean=\"false\"/>\n+            <column name=\"hidden\" valueBoolean=\"false\"/>\n+            <column name=\"lastmodified\" valueDate=\"2016-02-04 16:44:00.0\"/>\n+            <column name=\"name\" value=\"1.0\"/>\n+            <column name=\"reference\" value=\"master\"/>\n+            <column name=\"valid\" valueBoolean=\"true\"/>\n+            <column name=\"verified\" valueBoolean=\"false\"/>\n+            <column name=\"verifiedsource\"/>\n+            <column name=\"automated\" valueBoolean=\"true\"/>\n+            <column name=\"cwlpath\" value=\"/dockstore.cwl\"/>\n+            <column name=\"dockerfilepath\" value=\"/Dockerfile\"/>\n+            <column name=\"imageid\" value=\"123456\"/>\n+            <column name=\"size\" valueNumeric=\"108608297\"/>\n+            <column name=\"wdlpath\" value=\"/Dockstore.wdl\"/>\n+        </insert>\n+        <insert tableName=\"tool\">\n+            <column name=\"id\" valueNumeric=\"60\"/>\n+            <column name=\"author\" value=\"\"/>\n+            <column name=\"defaultversion\"/>\n+            <column name=\"description\" value=\"\"/>\n+            <column name=\"email\" value=\"\"/>\n+            <column name=\"giturl\" value=\"git@github.com:DockstoreTestUser2/dockstore-tool-imports.git\"/>\n+            <column name=\"ispublished\" valueBoolean=\"false\"/>\n+            <column name=\"lastmodified\"/>\n+            <column name=\"lastupdated\" valueDate=\"2016-03-15 15:55:38.502\"/>\n+            <column name=\"defaultcwlpath\" value=\"/dockstore.cwl\"/>\n+            <column name=\"defaultdockerfilepath\" value=\"/Dockerfile\"/>\n+            <column name=\"defaulttestcwlparameterfile\" value=\"\"/>\n+            <column name=\"defaulttestwdlparameterfile\" value=\"\"/>\n+            <column name=\"defaultwdlpath\" value=\"/Dockstore.wdl\"/>\n+            <column name=\"lastbuild\" valueDate=\"2016-02-16 17:04:59.0\"/>\n+            <column name=\"mode\" value=\"AUTO_DETECT_QUAY_TAGS_AUTOMATED_BUILDS\"/>\n+            <column name=\"name\" value=\"dockstore-tool-imports\"/>\n+            <column name=\"namespace\" value=\"dockstoretestuser2\"/>\n+            <column name=\"path\" value=\"quay.io/dockstoretestuser2/dockstore-tool-imports\"/>\n+            <column name=\"privateaccess\" valueBoolean=\"false\"/>\n+            <column name=\"registry\" value=\"QUAY_IO\"/>\n+            <column name=\"toolmaintaineremail\" value=\"\"/>\n+            <column name=\"toolname\" value=\"test5\"/>\n+        </insert>\n+        <insert tableName=\"tool_tag\">\n+            <column name=\"toolid\" valueNumeric=\"60\"/>\n+            <column name=\"tagid\" valueNumeric=\"60\"/>\n+        </insert>\n+        <insert tableName=\"user_entry\">\n+            <column name=\"userid\" valueNumeric=\"1\"/>\n+            <column name=\"entryid\" valueNumeric=\"60\"/>\n+        </insert>\n+        <insert tableName=\"version_sourcefile\">\n+            <column name=\"versionid\" valueNumeric=\"60\"/>\n+            <column name=\"sourcefileid\" valueNumeric=\"60\"/>\n+        </insert>\n+        <insert tableName=\"version_sourcefile\">\n+            <column name=\"versionid\" valueNumeric=\"60\"/>\n+            <column name=\"sourcefileid\" valueNumeric=\"61\"/>\n+        </insert>\n+    </changeSet>\n+\n+    <changeSet id=\"dockerhub_seqware_tool\" author=\"natalieperez\">\n+        <insert tableName=\"sourcefile\">\n+            <column name=\"id\" valueNumeric=\"70\"/>\n+            <column name=\"content\" value=\"cwlstuff\"/>\n+            <column name=\"path\" value=\"/dockstore.cwl\"/>\n+            <column name=\"type\" value=\"DOCKSTORE_CWL\"/>\n+        </insert>\n+        <insert tableName=\"sourcefile\">\n+            <column name=\"id\" valueNumeric=\"71\"/>\n+            <column name=\"content\" value=\"dockerstuff\"/>\n+            <column name=\"path\" value=\"/Dockerfile\"/>\n+            <column name=\"type\" value=\"DOCKERFILE\"/>\n+        </insert>\n+        <insert tableName=\"sourcefile\">\n+            <column name=\"id\" valueNumeric=\"72\"/>\n+            <column name=\"content\" value=\"testparameterstuff\"/>\n+            <column name=\"path\" value=\"/test1.json\"/>\n+            <column name=\"type\" value=\"CWL_TEST_JSON\"/>\n+        </insert>\n+        <insert tableName=\"sourcefile\">\n+            <column name=\"id\" valueNumeric=\"73\"/>\n+            <column name=\"content\" value=\"moretestparameterstuff\"/>\n+            <column name=\"path\" value=\"/test2.json\"/>\n+            <column name=\"type\" value=\"CWL_TEST_JSON\"/>\n+        </insert>\n+        <insert tableName=\"tag\">\n+            <column name=\"id\" valueNumeric=\"70\"/>\n+            <column name=\"dirtybit\" valueBoolean=\"false\"/>\n+            <column name=\"hidden\" valueBoolean=\"false\"/>\n+            <column name=\"lastmodified\" valueDate=\"2016-02-04 16:44:00.0\"/>\n+            <column name=\"name\" value=\"master\"/>\n+            <column name=\"reference\" value=\"refs/heads/master\"/>\n+            <column name=\"valid\" valueBoolean=\"true\"/>\n+            <column name=\"verified\" valueBoolean=\"false\"/>\n+            <column name=\"verifiedsource\"/>\n+            <column name=\"automated\" valueBoolean=\"true\"/>\n+            <column name=\"cwlpath\" value=\"/Dockstore.cwl\"/>\n+            <column name=\"dockerfilepath\" value=\"/Dockerfile\"/>\n+            <column name=\"imageid\" value=\"123456\"/>\n+            <column name=\"size\" valueNumeric=\"108608297\"/>\n+            <column name=\"wdlpath\" value=\"/Dockstore.wdl\"/>\n+        </insert>\n+        <insert tableName=\"tag\">\n+            <column name=\"id\" valueNumeric=\"71\"/>\n+            <column name=\"dirtybit\" valueBoolean=\"false\"/>\n+            <column name=\"hidden\" valueBoolean=\"true\"/>\n+            <column name=\"lastmodified\" valueDate=\"2016-02-04 16:44:00.0\"/>\n+            <column name=\"name\" value=\"master2\"/>\n+            <column name=\"reference\" value=\"refs/heads/master\"/>\n+            <column name=\"valid\" valueBoolean=\"true\"/>\n+            <column name=\"verified\" valueBoolean=\"false\"/>\n+            <column name=\"verifiedsource\"/>\n+            <column name=\"automated\" valueBoolean=\"true\"/>\n+            <column name=\"cwlpath\" value=\"/Dockstore.cwl\"/>\n+            <column name=\"dockerfilepath\" value=\"/Dockerfile\"/>\n+            <column name=\"imageid\" value=\"123456\"/>\n+            <column name=\"size\" valueNumeric=\"108608297\"/>\n+            <column name=\"wdlpath\" value=\"/Dockstore.wdl\"/>\n+        </insert>\n+        <insert tableName=\"tool\">\n+            <column name=\"id\" valueNumeric=\"70\"/>\n+            <column name=\"author\" value=\"\"/>\n+            <column name=\"defaultversion\"/>\n+            <column name=\"description\" value=\"\"/>\n+            <column name=\"email\" value=\"\"/>\n+            <column name=\"giturl\" value=\"git@github.com:github.com/denis-yuen/test1.git\"/>", "originalCommit": "2f762689923d40f7405a75d5f96b4cb410f3bc7f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNzk3Mg==", "url": "https://github.com/dockstore/dockstore/pull/3789#discussion_r483327972", "bodyText": "I don't understand this. Why do you have a loop on an always empty array?\nDo you expect this code to be turned back on? If so, should there be a TODO? If not, shouldn't you just delete it?", "author": "coverbeck", "createdAt": "2020-09-04T00:55:21Z", "path": "dockstore-event-consumer/src/main/java/io/dockstore/consumer/handler/DOIHandler.java", "diffHunk": "@@ -127,7 +129,9 @@ public boolean handleMessage(DOIMessage message) {\n                 // upload a new file\n                 int depositionID = returnDeposit.getId();\n                 FilesApi filesApi = new FilesApi(zenodoClient);\n-                for (SourceFile file : tag.getSourceFiles()) {\n+                // This code isn't used currently, so changing it to get around @JsonIgnore being added to sourcefiles. Previously iterated through tag.getSourcefiles()", "originalCommit": "2f762689923d40f7405a75d5f96b4cb410f3bc7f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzczNTcwOQ==", "url": "https://github.com/dockstore/dockstore/pull/3789#discussion_r483735709", "bodyText": "I think Denis said this was a concept for how you could hook up something like zenodo to dockstore, but Walt went with a different approach. I don't know if it ever be used, but figured it would be good to keep as a reference for possible future work.\nI'll comment this section out instead of changing it.", "author": "NatalieEO", "createdAt": "2020-09-04T16:36:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNzk3Mg=="}], "type": "inlineReview"}, {"oid": "4492030c9ab1a9715b0a907e52ddba1659cbbefc", "url": "https://github.com/dockstore/dockstore/commit/4492030c9ab1a9715b0a907e52ddba1659cbbefc", "message": "only add extra tools to a few test files instead of all of them. Just comment out a section in DOIHandler", "committedDate": "2020-09-04T16:57:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzg2NjU4MQ==", "url": "https://github.com/dockstore/dockstore/pull/3789#discussion_r483866581", "bodyText": "Mismatch count in the error message. You can leave the number out of our error message. It will automatically say expected 6 actual w/e", "author": "garyluu", "createdAt": "2020-09-04T22:21:19Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralIT.java", "diffHunk": "@@ -197,7 +155,7 @@ private String getPathfromDB(String type) {\n     public void testListAvailableContainers() {\n \n         final long count = testingPostgres.runSelectStatement(\"select count(*) from tool where ispublished='f'\", long.class);\n-        assertEquals(\"there should be 4 entries, there are \" + count, 4, count);\n+        assertEquals(\"there should be 4 entries, there are \" + count, 6, count);", "originalCommit": "4492030c9ab1a9715b0a907e52ddba1659cbbefc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzg2NjkzOQ==", "url": "https://github.com/dockstore/dockstore/pull/3789#discussion_r483866939", "bodyText": "error message mismatch here and everywhere", "author": "garyluu", "createdAt": "2020-09-04T22:22:57Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/SwaggerClientIT.java", "diffHunk": "@@ -512,17 +482,15 @@ public void testHidingTags() throws ApiException {\n         ApiClient client = getAdminWebClient();\n \n         ContainersApi containersApi = new ContainersApi(client);\n-        // register one more to give us something to look at\n-        DockstoreTool c = getContainer();\n-        c.getWorkflowVersions().get(0).setHidden(true);\n-        c = containersApi.registerManual(c);\n+        // Tool contains 2 versions, 1 is hidden\n+        DockstoreTool c = containersApi.getContainerByToolPath(REGISTRY_HUB_DOCKER_COM_SEQWARE_SEQWARE, null);\n \n-        assertEquals(\"should see one tag as an admin, saw \" + c.getWorkflowVersions().size(), 1, c.getWorkflowVersions().size());\n+        assertEquals(\"should see one tag as an admin, saw \" + c.getWorkflowVersions().size(), 2, c.getWorkflowVersions().size());", "originalCommit": "4492030c9ab1a9715b0a907e52ddba1659cbbefc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ad2e8ea1a79f79dcf7d2f3a65a7e5572ac3de4dd", "url": "https://github.com/dockstore/dockstore/commit/ad2e8ea1a79f79dcf7d2f3a65a7e5572ac3de4dd", "message": "update test asseartion messages, add comment", "committedDate": "2020-09-05T00:09:58Z", "type": "commit"}, {"oid": "4477d65d20620ebc2039dbb6d058947eb33035cd", "url": "https://github.com/dockstore/dockstore/commit/4477d65d20620ebc2039dbb6d058947eb33035cd", "message": "Merge branch 'develop' into feature/3644/ignoreSourceFiles", "committedDate": "2020-09-05T00:10:38Z", "type": "commit"}]}