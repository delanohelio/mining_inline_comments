{"pr_number": 3156, "pr_title": "Feature/add version to event", "pr_createdAt": "2020-01-16T17:21:25Z", "pr_url": "https://github.com/dockstore/dockstore/pull/3156", "timeline": [{"oid": "e8361c003b9de44ace2427f4db5358b40b3045a2", "url": "https://github.com/dockstore/dockstore/commit/e8361c003b9de44ace2427f4db5358b40b3045a2", "message": "Add test", "committedDate": "2020-01-16T17:34:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEzODAxNQ==", "url": "https://github.com/dockstore/dockstore/pull/3156#discussion_r368138015", "bodyText": "Nitpick: easier to read using isEmpty", "author": "denis-yuen", "createdAt": "2020-01-17T21:11:08Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/BasicIT.java", "diffHunk": "@@ -249,18 +249,19 @@ public void testVersionTagDockerhub() {\n         starRequest.setStar(true);\n         toolsApi.starEntry(tool.getId(), starRequest);\n         events = eventsApi.getEvents(EventSearchType.STARRED_ENTRIES.toString(), 10, 0);\n-        Assert.assertEquals(\"Should be an event for the tag that was automatically created for the newly registered tool\", 1, events.size());\n+        Assert.assertEquals(\"Should not be an event for the non-tag version that was automatically created for the newly registered tool\", 0, events.size());", "originalCommit": "e8361c003b9de44ace2427f4db5358b40b3045a2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEzODA2Mw==", "url": "https://github.com/dockstore/dockstore/pull/3156#discussion_r368138063", "bodyText": "Ditto", "author": "denis-yuen", "createdAt": "2020-01-17T21:11:18Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/BasicIT.java", "diffHunk": "@@ -1393,7 +1394,7 @@ public void eventResourcePaginationTest() {\n         starRequest.setStar(true);\n         toolsApi.starEntry(tool.getId(), starRequest);\n         events = eventsApi.getEvents(EventSearchType.STARRED_ENTRIES.toString(), 10, 0);\n-        Assert.assertEquals(\"Should be an event for the tag that was automatically created for the newly registered tool\", 1, events.size());\n+        Assert.assertEquals(\"Should not be an event for the non-tag version that was automatically created for the newly registered tool\", 0, events.size());", "originalCommit": "e8361c003b9de44ace2427f4db5358b40b3045a2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0MTgyMg==", "url": "https://github.com/dockstore/dockstore/pull/3156#discussion_r368141822", "bodyText": "Avoid this change", "author": "denis-yuen", "createdAt": "2020-01-17T21:23:05Z", "path": "dockstore-webservice/src/main/resources/openapi.yaml", "diffHunk": "@@ -6682,17 +6682,184 @@ components:\n         content:\n           type: string\n     BioWorkflow:\n-      allOf:\n-        - $ref: \"#/components/schemas/Workflow\"\n-        - type: object\n-          properties:\n-            parent_id:\n-              type: integer\n-              format: int64\n-              readOnly: true\n-            is_checker:\n-              type: boolean\n-          description: This describes one workflow in the dockstore\n+      type: object", "originalCommit": "e8361c003b9de44ace2427f4db5358b40b3045a2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0MTkxNw==", "url": "https://github.com/dockstore/dockstore/pull/3156#discussion_r368141917", "bodyText": "Ditto", "author": "denis-yuen", "createdAt": "2020-01-17T21:23:19Z", "path": "dockstore-webservice/src/main/resources/swagger.yaml", "diffHunk": "@@ -6262,18 +6262,209 @@ definitions:\n       content:\n         type: \"string\"\n   BioWorkflow:\n-    allOf:\n-    - $ref: \"#/definitions/Workflow\"\n-    - type: \"object\"\n-      properties:\n-        parent_id:\n-          type: \"integer\"\n-          format: \"int64\"\n-          readOnly: true\n-        is_checker:\n-          type: \"boolean\"\n-          position: 23\n-      description: \"This describes one workflow in the dockstore\"\n+    type: \"object\"", "originalCommit": "e8361c003b9de44ace2427f4db5358b40b3045a2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "60b818c6f6c74dbfaa3ec6e65f4bdc265138e783", "url": "https://github.com/dockstore/dockstore/commit/60b818c6f6c74dbfaa3ec6e65f4bdc265138e783", "message": "Update openapi/swagger", "committedDate": "2020-01-20T15:33:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODYxMDU0NQ==", "url": "https://github.com/dockstore/dockstore/pull/3156#discussion_r368610545", "bodyText": "Think this needs @JsonIgnoreProperties like the others", "author": "denis-yuen", "createdAt": "2020-01-20T15:38:27Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Event.java", "diffHunk": "@@ -80,6 +80,11 @@\n     @ApiModelProperty(value = \"User initiating the event.\", position = 6)\n     private User initiatorUser;\n \n+    @ManyToOne", "originalCommit": "60b818c6f6c74dbfaa3ec6e65f4bdc265138e783", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c0e447fc33404adbeca3020c0b222656331da872", "url": "https://github.com/dockstore/dockstore/commit/c0e447fc33404adbeca3020c0b222656331da872", "message": "Move migration to 1.9.0", "committedDate": "2020-01-20T17:15:26Z", "type": "forcePushed"}, {"oid": "673cf010897619742cef11dc87e47b4283d07e74", "url": "https://github.com/dockstore/dockstore/commit/673cf010897619742cef11dc87e47b4283d07e74", "message": "Update openapi3", "committedDate": "2020-01-20T18:26:29Z", "type": "forcePushed"}, {"oid": "849ef695fd30b66f0f902aa84b997f0b286e258c", "url": "https://github.com/dockstore/dockstore/commit/849ef695fd30b66f0f902aa84b997f0b286e258c", "message": "Update swagger/openapi", "committedDate": "2020-01-24T19:47:33Z", "type": "forcePushed"}, {"oid": "d4488c5e7c2ec1d6071339f479496e365db8463d", "url": "https://github.com/dockstore/dockstore/commit/d4488c5e7c2ec1d6071339f479496e365db8463d", "message": "Remove version related events without versions", "committedDate": "2020-01-24T20:46:09Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg0OTc3NA==", "url": "https://github.com/dockstore/dockstore/pull/3156#discussion_r370849774", "bodyText": "Should the 3rd param by byId instead of tag? Don't know Hibernate well enough to say if it matters.\nIn DockerRepoTagResource, you use byId.", "author": "coverbeck", "createdAt": "2020-01-24T21:26:58Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/DockerRepoResource.java", "diffHunk": "@@ -499,15 +498,15 @@ public Tool registerManual(@ApiParam(hidden = true) @Auth User user,\n         if (tool.isPrivateAccess() && Strings.isNullOrEmpty(tool.getToolMaintainerEmail())) {\n             throw new CustomWebApplicationException(\"Tool maintainer email is required for private tools.\", HttpStatus.SC_BAD_REQUEST);\n         }\n-        boolean releaseCreated = false;\n         // populate user in tool\n         tool.addUser(user);\n         // create dependent Tags before creating tool\n         Set<Tag> createdTags = new HashSet<>();\n         for (Tag tag : tool.getWorkflowVersions()) {\n             final long l = tagDAO.create(tag);\n-            createdTags.add(tagDAO.findById(l));\n-            releaseCreated = true;\n+            Tag byId = tagDAO.findById(l);\n+            createdTags.add(byId);\n+            this.eventDAO.createAddTagToEntryEvent(user, tool, tag);", "originalCommit": "d4488c5e7c2ec1d6071339f479496e365db8463d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "11d0dbb47e124b61798f06317fb839368c644860", "url": "https://github.com/dockstore/dockstore/commit/11d0dbb47e124b61798f06317fb839368c644860", "message": "Remove version related events without versions", "committedDate": "2020-01-24T21:34:28Z", "type": "forcePushed"}, {"oid": "ccab1840cc8806999d387f198ce2490fae179157", "url": "https://github.com/dockstore/dockstore/commit/ccab1840cc8806999d387f198ce2490fae179157", "message": "Update swagger/openapi", "committedDate": "2020-01-28T16:46:59Z", "type": "forcePushed"}, {"oid": "0046bbcc6de1d025085fe3eb09f7b8a6abf1210c", "url": "https://github.com/dockstore/dockstore/commit/0046bbcc6de1d025085fe3eb09f7b8a6abf1210c", "message": "Add version information, only create event for tags", "committedDate": "2020-01-29T14:33:01Z", "type": "commit"}, {"oid": "d5c0dfc7a355220d25ac26ff71a3e14451b2cf59", "url": "https://github.com/dockstore/dockstore/commit/d5c0dfc7a355220d25ac26ff71a3e14451b2cf59", "message": "Add migration", "committedDate": "2020-01-29T14:33:01Z", "type": "commit"}, {"oid": "9701e872e46cba881ec06766ee9b8b93bca56443", "url": "https://github.com/dockstore/dockstore/commit/9701e872e46cba881ec06766ee9b8b93bca56443", "message": "Add test", "committedDate": "2020-01-29T14:33:01Z", "type": "commit"}, {"oid": "50c1801112ea294c278163d0ff22324616f3321a", "url": "https://github.com/dockstore/dockstore/commit/50c1801112ea294c278163d0ff22324616f3321a", "message": "Fix unused variable", "committedDate": "2020-01-29T14:33:01Z", "type": "commit"}, {"oid": "3bf9ad6475744ac9d11f50e6e8be053f4c5f1290", "url": "https://github.com/dockstore/dockstore/commit/3bf9ad6475744ac9d11f50e6e8be053f4c5f1290", "message": "Test cleanup", "committedDate": "2020-01-29T14:33:01Z", "type": "commit"}, {"oid": "fc4a0eb390f351f2eadf1bfe1e0da31bf6af0946", "url": "https://github.com/dockstore/dockstore/commit/fc4a0eb390f351f2eadf1bfe1e0da31bf6af0946", "message": "Remove all collections from Event versions", "committedDate": "2020-01-29T14:33:01Z", "type": "commit"}, {"oid": "d3a5fe085aac494ba86ebc807e00a06444f72b97", "url": "https://github.com/dockstore/dockstore/commit/d3a5fe085aac494ba86ebc807e00a06444f72b97", "message": "Move migration to 1.9.0", "committedDate": "2020-01-29T14:33:01Z", "type": "commit"}, {"oid": "deeecdb743ec72585e9f525c815b408c2b3df373", "url": "https://github.com/dockstore/dockstore/commit/deeecdb743ec72585e9f525c815b408c2b3df373", "message": "Remove version related events without versions", "committedDate": "2020-01-29T14:33:01Z", "type": "commit"}, {"oid": "c8ebbb9d706d2a1e89971ea4d6329b648620188f", "url": "https://github.com/dockstore/dockstore/commit/c8ebbb9d706d2a1e89971ea4d6329b648620188f", "message": "PR change", "committedDate": "2020-01-29T14:33:01Z", "type": "commit"}, {"oid": "675e04865d7de97bb3fdb04d3ba0b55a80e81b38", "url": "https://github.com/dockstore/dockstore/commit/675e04865d7de97bb3fdb04d3ba0b55a80e81b38", "message": "Update swagger/openapi", "committedDate": "2020-01-29T14:36:40Z", "type": "commit"}, {"oid": "675e04865d7de97bb3fdb04d3ba0b55a80e81b38", "url": "https://github.com/dockstore/dockstore/commit/675e04865d7de97bb3fdb04d3ba0b55a80e81b38", "message": "Update swagger/openapi", "committedDate": "2020-01-29T14:36:40Z", "type": "forcePushed"}]}