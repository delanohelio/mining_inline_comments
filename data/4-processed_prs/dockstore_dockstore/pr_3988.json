{"pr_number": 3988, "pr_title": "Run regression tests on CircleCI machine instance type", "pr_createdAt": "2020-12-22T19:46:29Z", "pr_url": "https://github.com/dockstore/dockstore/pull/3988", "timeline": [{"oid": "ae1eba09523c26d574be6c7cf6be2a17913228f5", "url": "https://github.com/dockstore/dockstore/commit/ae1eba09523c26d574be6c7cf6be2a17913228f5", "message": "running CircleCI with machine (test)", "committedDate": "2020-12-21T17:42:15Z", "type": "commit"}, {"oid": "d44b440b003d8c7a417d9c635ca53b8b009d1cb4", "url": "https://github.com/dockstore/dockstore/commit/d44b440b003d8c7a417d9c635ca53b8b009d1cb4", "message": "check for java/mvn circle-machine defaults", "committedDate": "2020-12-21T18:13:32Z", "type": "commit"}, {"oid": "4ed37977f69ec88f29b55dd30834b6f8732f720b", "url": "https://github.com/dockstore/dockstore/commit/4ed37977f69ec88f29b55dd30834b6f8732f720b", "message": "try psql", "committedDate": "2020-12-21T18:46:41Z", "type": "commit"}, {"oid": "dbf23fa8a263816c31aba18db71b7312b7a4aa3a", "url": "https://github.com/dockstore/dockstore/commit/dbf23fa8a263816c31aba18db71b7312b7a4aa3a", "message": "try using docker-compose for PSQL & ES", "committedDate": "2020-12-21T19:59:38Z", "type": "commit"}, {"oid": "bf3818298f93296133985a8e7a2c9a606824df11", "url": "https://github.com/dockstore/dockstore/commit/bf3818298f93296133985a8e7a2c9a606824df11", "message": "log versions and try Ubuntu 16 image", "committedDate": "2020-12-21T20:37:08Z", "type": "commit"}, {"oid": "aaf03695ec984770fed9279402ddf4f146afbda8", "url": "https://github.com/dockstore/dockstore/commit/aaf03695ec984770fed9279402ddf4f146afbda8", "message": "Ubuntu 20; try using Python 3.6 in venv", "committedDate": "2020-12-21T21:04:29Z", "type": "commit"}, {"oid": "c8a4181167583d737d9d75ada39ee08be273ea6a", "url": "https://github.com/dockstore/dockstore/commit/c8a4181167583d737d9d75ada39ee08be273ea6a", "message": "forgot to run old_python", "committedDate": "2020-12-21T21:13:45Z", "type": "commit"}, {"oid": "86e044bc2f33c5bf3b0134abbb2cda2d0a240ac4", "url": "https://github.com/dockstore/dockstore/commit/86e044bc2f33c5bf3b0134abbb2cda2d0a240ac4", "message": "try using .bashrc", "committedDate": "2020-12-21T21:31:46Z", "type": "commit"}, {"oid": "61bdabd5e35e3c0843a7968887f440ca566eaf67", "url": "https://github.com/dockstore/dockstore/commit/61bdabd5e35e3c0843a7968887f440ca566eaf67", "message": "can't use `pip --user ...` in venv", "committedDate": "2020-12-21T21:44:46Z", "type": "commit"}, {"oid": "909fd3e2eff68a344f98bf0f83b00a8eeaf3b474", "url": "https://github.com/dockstore/dockstore/commit/909fd3e2eff68a344f98bf0f83b00a8eeaf3b474", "message": "include Python 3.6 headers", "committedDate": "2020-12-21T21:59:37Z", "type": "commit"}, {"oid": "578b4a57b8b62c391d131113ede7f52894b9263f", "url": "https://github.com/dockstore/dockstore/commit/578b4a57b8b62c391d131113ede7f52894b9263f", "message": "log psql container info", "committedDate": "2020-12-21T22:23:08Z", "type": "commit"}, {"oid": "27da22b80b735046890b2f468226db26924dde3d", "url": "https://github.com/dockstore/dockstore/commit/27da22b80b735046890b2f468226db26924dde3d", "message": "try using iptables", "committedDate": "2020-12-22T15:53:03Z", "type": "commit"}, {"oid": "6e860bdb31d454da998b0d328237e8ad38df88d7", "url": "https://github.com/dockstore/dockstore/commit/6e860bdb31d454da998b0d328237e8ad38df88d7", "message": "try again - no iptables for now", "committedDate": "2020-12-22T16:01:15Z", "type": "commit"}, {"oid": "0bcc83e50386c5bee254ba670e678347be236523", "url": "https://github.com/dockstore/dockstore/commit/0bcc83e50386c5bee254ba670e678347be236523", "message": "try docker-postgres 11.10", "committedDate": "2020-12-22T16:19:21Z", "type": "commit"}, {"oid": "a060f1724d89394f28143a31c955a18c40bfa7bb", "url": "https://github.com/dockstore/dockstore/commit/a060f1724d89394f28143a31c955a18c40bfa7bb", "message": "try psql 11.6 ; debug container", "committedDate": "2020-12-22T16:34:56Z", "type": "commit"}, {"oid": "3bf514eb3eed69b680e6e4ee15d2f05c38fd4b5c", "url": "https://github.com/dockstore/dockstore/commit/3bf514eb3eed69b680e6e4ee15d2f05c38fd4b5c", "message": "I think I found a bug with some postgres images", "committedDate": "2020-12-22T16:52:23Z", "type": "commit"}, {"oid": "8ca415b868fa5ec377e9fd103cdcadaf9608d224", "url": "https://github.com/dockstore/dockstore/commit/8ca415b868fa5ec377e9fd103cdcadaf9608d224", "message": "set postgres auth (that was my problem)", "committedDate": "2020-12-22T17:20:53Z", "type": "commit"}, {"oid": "65b157782c588c0de125db48278aa6c3bdb2d2d5", "url": "https://github.com/dockstore/dockstore/commit/65b157782c588c0de125db48278aa6c3bdb2d2d5", "message": "verify all tests", "committedDate": "2020-12-22T18:13:42Z", "type": "commit"}, {"oid": "72a5b656c1b7b323822d9d5365364be90b630748", "url": "https://github.com/dockstore/dockstore/commit/72a5b656c1b7b323822d9d5365364be90b630748", "message": "filter regression-tests to master & releases", "committedDate": "2020-12-22T19:13:22Z", "type": "commit"}, {"oid": "f9b78e0ee7f764b25fb6c99c2e2d688134a67a6f", "url": "https://github.com/dockstore/dockstore/commit/f9b78e0ee7f764b25fb6c99c2e2d688134a67a6f", "message": "remove regression test from travis", "committedDate": "2020-12-22T19:20:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzQ5OTkxOQ==", "url": "https://github.com/dockstore/dockstore/pull/3988#discussion_r547499919", "bodyText": "I established at release post-mortem that I don't know regression tests that well, but I thought the idea of the regression tests was to test the previous CLI version with the current web service. So shouldn't this be 1.9?", "author": "coverbeck", "createdAt": "2020-12-22T20:46:52Z", "path": ".circleci/config.yml", "diffHunk": "@@ -250,6 +266,29 @@ commands:\n           command: |\n             psql -c \"create user dockstore with password 'dockstore' createdb;\" -U postgres\n             psql -c 'create database webservice_test with owner = dockstore;' -U postgres\n+  old_python: # Need Python 3.6 for old Dockstore 1.7 requirements.txt", "originalCommit": "f9b78e0ee7f764b25fb6c99c2e2d688134a67a6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzUwMTI1OQ==", "url": "https://github.com/dockstore/dockstore/pull/3988#discussion_r547501259", "bodyText": "1.7, 1.8, & 1.9 all use the same pip requirements", "author": "GFJHogue", "createdAt": "2020-12-22T20:50:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzQ5OTkxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAxODMwNQ==", "url": "https://github.com/dockstore/dockstore/pull/3988#discussion_r548018305", "bodyText": "Confirm that machine_integration_test_exec means that only this job incurs the extra cost of running within a VM", "author": "denis-yuen", "createdAt": "2020-12-23T15:39:21Z", "path": ".circleci/config.yml", "diffHunk": "@@ -53,12 +59,22 @@ workflows:\n           <<: *common_filters\n           requires:\n             - build\n+      - regression-integration-tests:\n+          filters:\n+            branches:\n+              only:\n+                - master\n+                - /^release.*$/\n+          requires:\n+            - build\n jobs:\n   regression-integration-tests:\n-    executor: integration_test_exec\n+    executor: machine_integration_test_exec", "originalCommit": "f9b78e0ee7f764b25fb6c99c2e2d688134a67a6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAyMjY5Mw==", "url": "https://github.com/dockstore/dockstore/pull/3988#discussion_r548022693", "bodyText": "Yes, only the regression-integration-tests job will run in an Ubuntu VM", "author": "GFJHogue", "createdAt": "2020-12-23T15:48:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAxODMwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAxOTU5NQ==", "url": "https://github.com/dockstore/dockstore/pull/3988#discussion_r548019595", "bodyText": "This is a bit remarkable, only two developers for distributing Python on Ubuntu?\nhttps://github.com/deadsnakes\nWonder if there is a more popular way, maybe snap?", "author": "denis-yuen", "createdAt": "2020-12-23T15:42:23Z", "path": ".circleci/config.yml", "diffHunk": "@@ -250,6 +266,29 @@ commands:\n           command: |\n             psql -c \"create user dockstore with password 'dockstore' createdb;\" -U postgres\n             psql -c 'create database webservice_test with owner = dockstore;' -U postgres\n+  old_python: # Need Python 3.6 for old Dockstore 1.7 requirements.txt\n+    steps:\n+      - run:\n+          name: Install & use Python 3.6\n+          command: |\n+            sudo add-apt-repository ppa:deadsnakes/ppa", "originalCommit": "f9b78e0ee7f764b25fb6c99c2e2d688134a67a6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAzMTAzMQ==", "url": "https://github.com/dockstore/dockstore/pull/3988#discussion_r548031031", "bodyText": "deadsnakes/ppa indeed is the most widely referenced way to installing specific Python versions on Ubuntu (when I Google search python ubuntu, all the relevant results show this).\nFor people who frequently switch Python versions & packages, there's conda which is certainly overkill here.\nUbuntu already comes with a distribution of Python (3.8), and it's relatively rare for people to just want older releases of Python 3, so I don't think that only 2 developers is a big surprise.", "author": "GFJHogue", "createdAt": "2020-12-23T16:07:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAxOTU5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAzMzI0OQ==", "url": "https://github.com/dockstore/dockstore/pull/3988#discussion_r548033249", "bodyText": "Reminds me of https://linustechtips.com/topic/145130-the-internet-is-being-protected-by-two-guys-named-steve-heartbleed-bug/", "author": "denis-yuen", "createdAt": "2020-12-23T16:12:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAxOTU5NQ=="}], "type": "inlineReview"}]}