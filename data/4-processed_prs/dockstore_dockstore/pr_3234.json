{"pr_number": 3234, "pr_title": "Deprecate zip endpoint", "pr_createdAt": "2020-02-13T20:08:40Z", "pr_url": "https://github.com/dockstore/dockstore/pull/3234", "timeline": [{"oid": "50d7b9a74ea19afeae7cd2b0caea880e6222dc88", "url": "https://github.com/dockstore/dockstore/commit/50d7b9a74ea19afeae7cd2b0caea880e6222dc88", "message": "deprecate zip endpoint", "committedDate": "2020-02-13T18:50:05Z", "type": "commit"}, {"oid": "35d48fc978246dbdc34633d9618bb740f72ec470", "url": "https://github.com/dockstore/dockstore/commit/35d48fc978246dbdc34633d9618bb740f72ec470", "message": "fixed tabbing", "committedDate": "2020-02-13T18:55:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA5NDUxNQ==", "url": "https://github.com/dockstore/dockstore/pull/3234#discussion_r379094515", "bodyText": "name = \"bearer\" can probably be JWT_SECURITY_DEFINITION_NAME", "author": "garyluu", "createdAt": "2020-02-13T20:14:40Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/HostedWorkflowResource.java", "diffHunk": "@@ -177,10 +183,15 @@ public Workflow editHosted(User user, Long entryId, Set<SourceFile> sourceFiles)\n     @Path(\"/hostedEntry/{entryId}\")\n     @Timed\n     @UnitOfWork\n-    @ApiOperation(nickname = \"addZip\", value = \"Creates a new revision of a hosted workflow from a zip\",\n-            authorizations = {@Authorization(value = JWT_SECURITY_DEFINITION_NAME)}, response = Workflow.class)\n-    public Workflow addZip(@ApiParam(hidden = true) @Auth User user, @ApiParam(value = \"hosted entry ID\")\n-        @PathParam(\"entryId\") Long entryId,  @FormDataParam(\"file\") InputStream payload) {\n+    @ApiOperation(nickname = \"addZip\", value = \"Creates a new revision of a hosted workflow from a zip\", authorizations = {\n+        @Authorization(value = JWT_SECURITY_DEFINITION_NAME)}, response = Workflow.class)\n+    @Deprecated(since = \"1.9.0\")\n+    @Operation(operationId = \"addZip\", summary = \"Creates a new revision of a hosted workflow from a zip\", security = @SecurityRequirement(name = \"bearer\"), deprecated = true)", "originalCommit": "35d48fc978246dbdc34633d9618bb740f72ec470", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ2MjA3MQ==", "url": "https://github.com/dockstore/dockstore/pull/3234#discussion_r379462071", "bodyText": "I tried name = JWT_SECURITY_DEFINITION_NAME, but openapi.yaml doesn't seem to like that because the authorization pop up looks like this:\n.\nname = \"bearer\" looks like this:\n\nThis is probably because openapi.yaml is case-sensitive.", "author": "kathy-t", "createdAt": "2020-02-14T14:35:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA5NDUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ5NzU3OA==", "url": "https://github.com/dockstore/dockstore/pull/3234#discussion_r379497578", "bodyText": "What's the openapi.yaml diff?", "author": "garyluu", "createdAt": "2020-02-14T15:38:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA5NDUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTUxMzAyOA==", "url": "https://github.com/dockstore/dockstore/pull/3234#discussion_r379513028", "bodyText": "the only difference is that for name = \"bearer\", openapi.yaml looks like:\nsecurity:\n- bearer: []\nand for name = JWT_SECURITY_DEFINITION_NAME, openapi.yaml looks like:\nsecurity:\n- BEARER: []", "author": "kathy-t", "createdAt": "2020-02-14T16:05:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA5NDUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTUyNzA1Mg==", "url": "https://github.com/dockstore/dockstore/pull/3234#discussion_r379527052", "bodyText": "Ahh, I understand the issue now. Though this is out of the scope for the PR.\n\nThe security scheme is defined multiple times (redundantly)\nThe name is different from Swagger (slightly annoying)\nThe name is not a constant somewhere (so easy to get the case wrong).\n\nI'll make a SEAB issue later.", "author": "garyluu", "createdAt": "2020-02-14T16:32:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA5NDUxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA5NTEwMg==", "url": "https://github.com/dockstore/dockstore/pull/3234#discussion_r379095102", "bodyText": "double-check that the deprecated = true is actually needed and the @Deprecated is not enough for both", "author": "garyluu", "createdAt": "2020-02-13T20:16:04Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/HostedWorkflowResource.java", "diffHunk": "@@ -177,10 +183,15 @@ public Workflow editHosted(User user, Long entryId, Set<SourceFile> sourceFiles)\n     @Path(\"/hostedEntry/{entryId}\")\n     @Timed\n     @UnitOfWork\n-    @ApiOperation(nickname = \"addZip\", value = \"Creates a new revision of a hosted workflow from a zip\",\n-            authorizations = {@Authorization(value = JWT_SECURITY_DEFINITION_NAME)}, response = Workflow.class)\n-    public Workflow addZip(@ApiParam(hidden = true) @Auth User user, @ApiParam(value = \"hosted entry ID\")\n-        @PathParam(\"entryId\") Long entryId,  @FormDataParam(\"file\") InputStream payload) {\n+    @ApiOperation(nickname = \"addZip\", value = \"Creates a new revision of a hosted workflow from a zip\", authorizations = {\n+        @Authorization(value = JWT_SECURITY_DEFINITION_NAME)}, response = Workflow.class)\n+    @Deprecated(since = \"1.9.0\")\n+    @Operation(operationId = \"addZip\", summary = \"Creates a new revision of a hosted workflow from a zip\", security = @SecurityRequirement(name = \"bearer\"), deprecated = true)", "originalCommit": "35d48fc978246dbdc34633d9618bb740f72ec470", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTExNTcyNg==", "url": "https://github.com/dockstore/dockstore/pull/3234#discussion_r379115726", "bodyText": "To put a bit more meat on this, the question is whether @Deprecated(since = \"1.9.0\") is enough to result in a deprecation notice in the resulting openapi.yaml or whether the deprecated = true is needed.\n(I suspect the latter, but it is worth checking)", "author": "denis-yuen", "createdAt": "2020-02-13T21:00:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA5NTEwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTEyMTg3Mg==", "url": "https://github.com/dockstore/dockstore/pull/3234#discussion_r379121872", "bodyText": "I checked and it looks like @Deprecated(since = \"1.9.0\") is enough for swagger, but openapi.yaml requires deprecated = true.", "author": "kathy-t", "createdAt": "2020-02-13T21:14:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA5NTEwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTEwODM2OA==", "url": "https://github.com/dockstore/dockstore/pull/3234#discussion_r379108368", "bodyText": "MediaType.APPLICATION_JSON", "author": "garyluu", "createdAt": "2020-02-13T20:44:14Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/HostedWorkflowResource.java", "diffHunk": "@@ -177,10 +183,15 @@ public Workflow editHosted(User user, Long entryId, Set<SourceFile> sourceFiles)\n     @Path(\"/hostedEntry/{entryId}\")\n     @Timed\n     @UnitOfWork\n-    @ApiOperation(nickname = \"addZip\", value = \"Creates a new revision of a hosted workflow from a zip\",\n-            authorizations = {@Authorization(value = JWT_SECURITY_DEFINITION_NAME)}, response = Workflow.class)\n-    public Workflow addZip(@ApiParam(hidden = true) @Auth User user, @ApiParam(value = \"hosted entry ID\")\n-        @PathParam(\"entryId\") Long entryId,  @FormDataParam(\"file\") InputStream payload) {\n+    @ApiOperation(nickname = \"addZip\", value = \"Creates a new revision of a hosted workflow from a zip\", authorizations = {\n+        @Authorization(value = JWT_SECURITY_DEFINITION_NAME)}, response = Workflow.class)\n+    @Deprecated(since = \"1.9.0\")\n+    @Operation(operationId = \"addZip\", summary = \"Creates a new revision of a hosted workflow from a zip\", security = @SecurityRequirement(name = \"bearer\"), deprecated = true)\n+    @ApiResponse(responseCode = \"200\", description = \"successful operation\", content = @Content(mediaType = \"application/json\", schema = @Schema(implementation = Workflow.class)))", "originalCommit": "35d48fc978246dbdc34633d9618bb740f72ec470", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTEwOTQxMQ==", "url": "https://github.com/dockstore/dockstore/pull/3234#discussion_r379109411", "bodyText": "Also, see if you can find a responseCode String somewhere. I was not able to", "author": "garyluu", "createdAt": "2020-02-13T20:46:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTEwODM2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTExNTk1Mw==", "url": "https://github.com/dockstore/dockstore/pull/3234#discussion_r379115953", "bodyText": "I usually use HttpStatus.SC_OK", "author": "denis-yuen", "createdAt": "2020-02-13T21:01:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTEwODM2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTEzNDY0OQ==", "url": "https://github.com/dockstore/dockstore/pull/3234#discussion_r379134649", "bodyText": "Isn't that an int?", "author": "garyluu", "createdAt": "2020-02-13T21:42:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTEwODM2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE0MTA4OQ==", "url": "https://github.com/dockstore/dockstore/pull/3234#discussion_r379141089", "bodyText": "Ah, rats", "author": "denis-yuen", "createdAt": "2020-02-13T21:55:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTEwODM2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ3MTYwNg==", "url": "https://github.com/dockstore/dockstore/pull/3234#discussion_r379471606", "bodyText": "I wasn't able to find a 200 response code string anywhere too", "author": "kathy-t", "createdAt": "2020-02-14T14:52:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTEwODM2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTEwOTAyMQ==", "url": "https://github.com/dockstore/dockstore/pull/3234#discussion_r379109021", "bodyText": "Make a private static final thing for \"addZip\" and \"Creates a new revision of a hosted workflow from a zip\"", "author": "garyluu", "createdAt": "2020-02-13T20:45:38Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/HostedWorkflowResource.java", "diffHunk": "@@ -177,10 +183,15 @@ public Workflow editHosted(User user, Long entryId, Set<SourceFile> sourceFiles)\n     @Path(\"/hostedEntry/{entryId}\")\n     @Timed\n     @UnitOfWork\n-    @ApiOperation(nickname = \"addZip\", value = \"Creates a new revision of a hosted workflow from a zip\",\n-            authorizations = {@Authorization(value = JWT_SECURITY_DEFINITION_NAME)}, response = Workflow.class)\n-    public Workflow addZip(@ApiParam(hidden = true) @Auth User user, @ApiParam(value = \"hosted entry ID\")\n-        @PathParam(\"entryId\") Long entryId,  @FormDataParam(\"file\") InputStream payload) {\n+    @ApiOperation(nickname = \"addZip\", value = \"Creates a new revision of a hosted workflow from a zip\", authorizations = {\n+        @Authorization(value = JWT_SECURITY_DEFINITION_NAME)}, response = Workflow.class)\n+    @Deprecated(since = \"1.9.0\")\n+    @Operation(operationId = \"addZip\", summary = \"Creates a new revision of a hosted workflow from a zip\", security = @SecurityRequirement(name = \"bearer\"), deprecated = true)", "originalCommit": "35d48fc978246dbdc34633d9618bb740f72ec470", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6b4995e131488b345378f5ec5b446b5e9b95b550", "url": "https://github.com/dockstore/dockstore/commit/6b4995e131488b345378f5ec5b446b5e9b95b550", "message": "added and used constants for operationId, description, and mediaType", "committedDate": "2020-02-14T14:51:05Z", "type": "commit"}, {"oid": "118c2dc66e4123ef2b811ac0dc66da247c027296", "url": "https://github.com/dockstore/dockstore/commit/118c2dc66e4123ef2b811ac0dc66da247c027296", "message": "made user, entryId, and payload parameters final", "committedDate": "2020-02-14T15:52:15Z", "type": "commit"}]}