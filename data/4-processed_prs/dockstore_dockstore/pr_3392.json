{"pr_number": 3392, "pr_title": "Feature/seab 1063/500 search endpoint", "pr_createdAt": "2020-04-14T21:03:10Z", "pr_url": "https://github.com/dockstore/dockstore/pull/3392", "timeline": [{"oid": "e12ac6f2079648314fe395a25011d718d151baf4", "url": "https://github.com/dockstore/dockstore/commit/e12ac6f2079648314fe395a25011d718d151baf4", "message": "Surface ES error code", "committedDate": "2020-04-14T20:38:06Z", "type": "commit"}, {"oid": "2f9a7c9fedf4312065a2f9fb804f2edfeb3cc139", "url": "https://github.com/dockstore/dockstore/commit/2f9a7c9fedf4312065a2f9fb804f2edfeb3cc139", "message": "Remove security from endpoint", "committedDate": "2020-04-14T20:38:41Z", "type": "commit"}, {"oid": "fdcd539bf2bccae315141f2a2eb0ee9b043169a7", "url": "https://github.com/dockstore/dockstore/commit/fdcd539bf2bccae315141f2a2eb0ee9b043169a7", "message": "Update swagger/openapi", "committedDate": "2020-04-14T21:04:38Z", "type": "commit"}, {"oid": "b69b86fb624be896fac1fd7dce3b4b54f45c1bb6", "url": "https://github.com/dockstore/dockstore/commit/b69b86fb624be896fac1fd7dce3b4b54f45c1bb6", "message": "Only surface 400 errors", "committedDate": "2020-04-15T14:49:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODk4MDc4Mw==", "url": "https://github.com/dockstore/dockstore/pull/3392#discussion_r408980783", "bodyText": "We should log the exception", "author": "coverbeck", "createdAt": "2020-04-15T16:38:01Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/proposedGA4GH/ToolsApiExtendedServiceImpl.java", "diffHunk": "@@ -211,9 +213,17 @@ public Response toolsIndexSearch(String query, MultivaluedMap<String, String> qu\n                             HttpStatus.SC_INTERNAL_SERVER_ERROR);\n                 }\n                 return Response.ok().entity(get.getEntity().getContent()).build();\n-            } catch (IOException e) {\n-                LOG.error(\"Could not use elastic search index\", e);\n-                throw new CustomWebApplicationException(e.getMessage(), HttpStatus.SC_INTERNAL_SERVER_ERROR);\n+            } catch (ResponseException e) {\n+                // Only surface these codes to the user, everything else is not entirely obvious so returning 500 instead.", "originalCommit": "b69b86fb624be896fac1fd7dce3b4b54f45c1bb6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODk4MDkzNw==", "url": "https://github.com/dockstore/dockstore/pull/3392#discussion_r408980937", "bodyText": "Log the exception", "author": "coverbeck", "createdAt": "2020-04-15T16:38:14Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/proposedGA4GH/ToolsApiExtendedServiceImpl.java", "diffHunk": "@@ -211,9 +213,17 @@ public Response toolsIndexSearch(String query, MultivaluedMap<String, String> qu\n                             HttpStatus.SC_INTERNAL_SERVER_ERROR);\n                 }\n                 return Response.ok().entity(get.getEntity().getContent()).build();\n-            } catch (IOException e) {\n-                LOG.error(\"Could not use elastic search index\", e);\n-                throw new CustomWebApplicationException(e.getMessage(), HttpStatus.SC_INTERNAL_SERVER_ERROR);\n+            } catch (ResponseException e) {\n+                // Only surface these codes to the user, everything else is not entirely obvious so returning 500 instead.\n+                int[] codesToResurface = {HttpStatus.SC_BAD_REQUEST};\n+                int statusCode = e.getResponse().getStatusLine().getStatusCode();\n+                if (ArrayUtils.contains(codesToResurface, statusCode)) {\n+                    throw new CustomWebApplicationException(e.getMessage(), statusCode);\n+                } else {\n+                    throw new CustomWebApplicationException(e.getMessage(), HttpStatus.SC_INTERNAL_SERVER_ERROR);\n+                }\n+            } catch (IOException e2) {\n+                throw new CustomWebApplicationException(e2.getMessage(), HttpStatus.SC_INTERNAL_SERVER_ERROR);", "originalCommit": "b69b86fb624be896fac1fd7dce3b4b54f45c1bb6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8601d7f652a5c68e21690f142de3d8a7cec3e7d1", "url": "https://github.com/dockstore/dockstore/commit/8601d7f652a5c68e21690f142de3d8a7cec3e7d1", "message": "Log exception", "committedDate": "2020-04-15T16:54:32Z", "type": "commit"}, {"oid": "a76cad1bf8b2a2975b4510c8164e766beb1195fa", "url": "https://github.com/dockstore/dockstore/commit/a76cad1bf8b2a2975b4510c8164e766beb1195fa", "message": "Merge branch 'develop' into feature/SEAB-1063/500SearchEndpoint", "committedDate": "2020-04-15T17:10:53Z", "type": "commit"}, {"oid": "387f41d3c566cf465d1a07337c8293bdb44db75c", "url": "https://github.com/dockstore/dockstore/commit/387f41d3c566cf465d1a07337c8293bdb44db75c", "message": "Merge branch 'develop' into feature/SEAB-1063/500SearchEndpoint", "committedDate": "2020-04-20T14:01:35Z", "type": "commit"}, {"oid": "a47537aa54d0374b7366432b55e188e0014d8b50", "url": "https://github.com/dockstore/dockstore/commit/a47537aa54d0374b7366432b55e188e0014d8b50", "message": "Merge branch 'develop' into feature/SEAB-1063/500SearchEndpoint", "committedDate": "2020-04-21T14:39:01Z", "type": "commit"}]}