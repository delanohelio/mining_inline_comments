{"pr_number": 1271, "pr_title": "[DOCS] Add model memory tip for ML modules", "pr_createdAt": "2020-07-13T23:58:09Z", "pr_url": "https://github.com/elastic/stack-docs/pull/1271", "timeline": [{"oid": "e08d7c65e39d91572a3fd2aac1af083bd72645b1", "url": "https://github.com/elastic/stack-docs/commit/e08d7c65e39d91572a3fd2aac1af083bd72645b1", "message": "[DOCS] Adds discrete attribute", "committedDate": "2021-03-17T23:17:50Z", "type": "forcePushed"}, {"oid": "d71e85574e6506be5020af4b9a6a7a0051f33647", "url": "https://github.com/elastic/stack-docs/commit/d71e85574e6506be5020af4b9a6a7a0051f33647", "message": "[DOCS] Add model memory tip for ML modules", "committedDate": "2021-06-21T23:58:43Z", "type": "commit"}, {"oid": "f68bf6f146d2d5337db08682c6de18c454491bf9", "url": "https://github.com/elastic/stack-docs/commit/f68bf6f146d2d5337db08682c6de18c454491bf9", "message": "[DOCS] Adds discrete attribute", "committedDate": "2021-06-21T23:58:43Z", "type": "commit"}, {"oid": "1e322349d45cd144bf19deff9cf505e0eed22840", "url": "https://github.com/elastic/stack-docs/commit/1e322349d45cd144bf19deff9cf505e0eed22840", "message": "Add model memory detail to AD at scale", "committedDate": "2021-06-21T23:58:50Z", "type": "commit"}, {"oid": "174c8775ee96198437fc2c04bc1f8cb461fc0279", "url": "https://github.com/elastic/stack-docs/commit/174c8775ee96198437fc2c04bc1f8cb461fc0279", "message": "Refine supplied job advice", "committedDate": "2021-06-22T00:15:46Z", "type": "commit"}, {"oid": "174c8775ee96198437fc2c04bc1f8cb461fc0279", "url": "https://github.com/elastic/stack-docs/commit/174c8775ee96198437fc2c04bc1f8cb461fc0279", "message": "Refine supplied job advice", "committedDate": "2021-06-22T00:15:46Z", "type": "forcePushed"}, {"oid": "74a47ec128c3759269712ac89d222a02614ad420", "url": "https://github.com/elastic/stack-docs/commit/74a47ec128c3759269712ac89d222a02614ad420", "message": "Fixes broken links", "committedDate": "2021-06-22T15:49:17Z", "type": "commit"}, {"oid": "4d97139edf5205cb9f147ef012f8838cf10740cc", "url": "https://github.com/elastic/stack-docs/commit/4d97139edf5205cb9f147ef012f8838cf10740cc", "message": "Improves link text", "committedDate": "2021-06-22T16:02:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzM2MTA5NA==", "url": "https://github.com/elastic/stack-docs/pull/1271#discussion_r657361094", "bodyText": "It's worth adding that the cardinality estimates used by Kibana come from running aggregations against the source indices of the datafeed at the time Kibana is being used to create the job.  If these are not reflective of the cardinality the job will experience while running (for example because ingest hasn't yet started at the time the job is created) then the memory estimate will be wrong.\nIf you use the estimate anomaly detection jobs model memory API then you must provide your own cardinality estimates.", "author": "droberts195", "createdAt": "2021-06-23T18:23:50Z", "path": "docs/en/stack/ml/anomaly-detection/anomaly-detection-scale.asciidoc", "diffHunk": "@@ -159,18 +159,29 @@ start the {dfeed} for the change to be applied.\n == 7. Set the model memory limit\n \n The `model_memory_limit` job configuration option sets the approximate maximum \n-amount of memory resources required for analytical processing. If this variable \n-is set too low for the job and the limit is approached, data pruning becomes \n-more aggressive. Upon exceeding this limit, new entities are not modeled.\n-\n-Use model memory estimation to have a better picture of the memory needs of the \n-model. Model memory estimation happens automatically when you create the job in \n-{kib} or you can call the \n-{ref}/ml-estimate-model-memory.html[Estimate {anomaly-jobs} model memory API] \n-manually. The estimation is based on the analysis configuration details for the \n-job and cardinality estimates for the fields it references. You can update the \n-memory settings of an existing job, but the job must be closed.\n-\n+amount of memory resources required for analytical processing. When you create\n+an {anomaly-job} in {kib}, it provides an estimate for this limit. The estimate \n+is based on the analysis configuration details for the job and cardinality \n+estimates for the fields it references. You can also obtain this information\n+from the\n+{ref}/ml-estimate-model-memory.html[estimate {anomaly-jobs} model memory API].  ", "originalCommit": "4d97139edf5205cb9f147ef012f8838cf10740cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzQ2MjM0OA==", "url": "https://github.com/elastic/stack-docs/pull/1271#discussion_r657462348", "bodyText": "Thanks, I've interwoven those details in these paragraphs.", "author": "lcawl", "createdAt": "2021-06-23T21:08:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzM2MTA5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzM2NDAyMA==", "url": "https://github.com/elastic/stack-docs/pull/1271#discussion_r657364020", "bodyText": "You can also decrease the model memory limit while the job is closed, providing you do not reduce it below the size reported in the latest model size stats.  (The ability to reduce model memory limit was added in 6.3.)", "author": "droberts195", "createdAt": "2021-06-23T18:28:17Z", "path": "docs/en/stack/ml/anomaly-detection/anomaly-detection-scale.asciidoc", "diffHunk": "@@ -159,18 +159,29 @@ start the {dfeed} for the change to be applied.\n == 7. Set the model memory limit\n \n The `model_memory_limit` job configuration option sets the approximate maximum \n-amount of memory resources required for analytical processing. If this variable \n-is set too low for the job and the limit is approached, data pruning becomes \n-more aggressive. Upon exceeding this limit, new entities are not modeled.\n-\n-Use model memory estimation to have a better picture of the memory needs of the \n-model. Model memory estimation happens automatically when you create the job in \n-{kib} or you can call the \n-{ref}/ml-estimate-model-memory.html[Estimate {anomaly-jobs} model memory API] \n-manually. The estimation is based on the analysis configuration details for the \n-job and cardinality estimates for the fields it references. You can update the \n-memory settings of an existing job, but the job must be closed.\n-\n+amount of memory resources required for analytical processing. When you create\n+an {anomaly-job} in {kib}, it provides an estimate for this limit. The estimate \n+is based on the analysis configuration details for the job and cardinality \n+estimates for the fields it references. You can also obtain this information\n+from the\n+{ref}/ml-estimate-model-memory.html[estimate {anomaly-jobs} model memory API].  \n+\n+If you change the resources available on your {ml} nodes or the characteristics \n+of your data, the memory requirements might also change. You can increase the \n+model memory limit for an existing job while it is closed. To decrease the limit, \n+you must clone and re-run the job.", "originalCommit": "4d97139edf5205cb9f147ef012f8838cf10740cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzQ0MzYwNw==", "url": "https://github.com/elastic/stack-docs/pull/1271#discussion_r657443607", "bodyText": "Thanks!  I've tried to make that clearer in the API too via elastic/elasticsearch#74517", "author": "lcawl", "createdAt": "2021-06-23T20:37:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzM2NDAyMA=="}], "type": "inlineReview"}, {"oid": "6ff588ab54dd4196b6415171e5a73a149cfe063e", "url": "https://github.com/elastic/stack-docs/commit/6ff588ab54dd4196b6415171e5a73a149cfe063e", "message": "[DOCS] Addresses feedback", "committedDate": "2021-06-23T21:00:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzQ2MzA1NA==", "url": "https://github.com/elastic/stack-docs/pull/1271#discussion_r657463054", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If you change the resources available on your {ml} nodes or the make significant \n          \n          \n            \n            If you change the resources available on your {ml} nodes or make significant", "author": "lcawl", "createdAt": "2021-06-23T21:09:24Z", "path": "docs/en/stack/ml/anomaly-detection/anomaly-detection-scale.asciidoc", "diffHunk": "@@ -159,18 +159,33 @@ start the {dfeed} for the change to be applied.\n == 7. Set the model memory limit\n \n The `model_memory_limit` job configuration option sets the approximate maximum \n-amount of memory resources required for analytical processing. If this variable \n-is set too low for the job and the limit is approached, data pruning becomes \n-more aggressive. Upon exceeding this limit, new entities are not modeled.\n-\n-Use model memory estimation to have a better picture of the memory needs of the \n-model. Model memory estimation happens automatically when you create the job in \n-{kib} or you can call the \n-{ref}/ml-estimate-model-memory.html[Estimate {anomaly-jobs} model memory API] \n-manually. The estimation is based on the analysis configuration details for the \n-job and cardinality estimates for the fields it references. You can update the \n-memory settings of an existing job, but the job must be closed.\n-\n+amount of memory resources required for analytical processing. When you create\n+an {anomaly-job} in {kib}, it provides an estimate for this limit. The estimate \n+is based on the analysis configuration details for the job and cardinality \n+estimates, which are derived by running aggregations on the source indices as\n+they exist at that specific point in time. \n+\n+If you change the resources available on your {ml} nodes or the make significant ", "originalCommit": "6ff588ab54dd4196b6415171e5a73a149cfe063e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e737bd52c60f043e5dd18f7a7c3787686a5fa250", "url": "https://github.com/elastic/stack-docs/commit/e737bd52c60f043e5dd18f7a7c3787686a5fa250", "message": "Update docs/en/stack/ml/anomaly-detection/anomaly-detection-scale.asciidoc", "committedDate": "2021-06-23T21:09:28Z", "type": "commit"}]}