{"pr_number": 874, "pr_title": "[Docs][SIEM] Adds tuning detection rules section", "pr_createdAt": "2020-02-12T15:44:22Z", "pr_url": "https://github.com/elastic/stack-docs/pull/874", "timeline": [{"oid": "f923ae7c4dcd00d6ec28ef5d743cadba1191be27", "url": "https://github.com/elastic/stack-docs/commit/f923ae7c4dcd00d6ec28ef5d743cadba1191be27", "message": "starts adding tuning stuff", "committedDate": "2020-02-12T16:17:55Z", "type": "forcePushed"}, {"oid": "51f988805c385869a6d8082142a37fe5741cf344", "url": "https://github.com/elastic/stack-docs/commit/51f988805c385869a6d8082142a37fe5741cf344", "message": "starts adding tuning stuff", "committedDate": "2020-02-18T07:05:24Z", "type": "commit"}, {"oid": "13e06641b729d5ce33c837e4931744af13ee0372", "url": "https://github.com/elastic/stack-docs/commit/13e06641b729d5ce33c837e4931744af13ee0372", "message": "continues tuning guide", "committedDate": "2020-02-18T07:05:24Z", "type": "commit"}, {"oid": "1711c8c47c78361d37859ed8191da7f6f66f14ea", "url": "https://github.com/elastic/stack-docs/commit/1711c8c47c78361d37859ed8191da7f6f66f14ea", "message": "formatting", "committedDate": "2020-02-18T07:05:24Z", "type": "commit"}, {"oid": "0204b3d85443a5f9206efcbe89acca8e32d7287f", "url": "https://github.com/elastic/stack-docs/commit/0204b3d85443a5f9206efcbe89acca8e32d7287f", "message": "finsihes first draft", "committedDate": "2020-02-18T07:05:24Z", "type": "commit"}, {"oid": "bb57fb8d5bb6eddd0583a7f84736c77f2efa0eb5", "url": "https://github.com/elastic/stack-docs/commit/bb57fb8d5bb6eddd0583a7f84736c77f2efa0eb5", "message": "formatting", "committedDate": "2020-02-18T07:05:24Z", "type": "commit"}, {"oid": "7ee82393f00dfa32410234c1d23742c536d88463", "url": "https://github.com/elastic/stack-docs/commit/7ee82393f00dfa32410234c1d23742c536d88463", "message": "corrections.. the morning after", "committedDate": "2020-02-18T07:05:24Z", "type": "commit"}, {"oid": "ccf848d31afd56f6263a0c9eb55c37b1747df673", "url": "https://github.com/elastic/stack-docs/commit/ccf848d31afd56f6263a0c9eb55c37b1747df673", "message": "fixes mistake", "committedDate": "2020-02-18T07:05:24Z", "type": "commit"}, {"oid": "6524a478744c4413b35676db3ccc917524877d3c", "url": "https://github.com/elastic/stack-docs/commit/6524a478744c4413b35676db3ccc917524877d3c", "message": "corrects network rule error type", "committedDate": "2020-02-18T07:05:24Z", "type": "commit"}, {"oid": "6524a478744c4413b35676db3ccc917524877d3c", "url": "https://github.com/elastic/stack-docs/commit/6524a478744c4413b35676db3ccc917524877d3c", "message": "corrects network rule error type", "committedDate": "2020-02-18T07:05:24Z", "type": "forcePushed"}, {"oid": "c3e75d16b13b5f2f5fcfaf4144869d1b16c1482b", "url": "https://github.com/elastic/stack-docs/commit/c3e75d16b13b5f2f5fcfaf4144869d1b16c1482b", "message": "removes false positives term", "committedDate": "2020-02-19T14:49:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3MzI1Ng==", "url": "https://github.com/elastic/stack-docs/pull/874#discussion_r381473256", "bodyText": "to be fair, this is our logic error, the beats field is wad, whether or not the design is correct. It might be kind of unfair to say this is a beats issue.", "author": "randomuserid", "createdAt": "2020-02-19T18:48:19Z", "path": "docs/en/siem/tune-rule-signals.asciidoc", "diffHunk": "@@ -0,0 +1,230 @@\n+[[tuning-detection-signals]]\n+== Tuning detection rules\n+\n+In the {siem-app}, detection rules can be tuned to produce the best possible \n+set of actionable signals. To reduce the noise level, you can:\n+\n+* Disable detection rules when they match expected behavior, workflows, and \n+allowed policies, and when they rarely produce actionable signals.\n+* <<manage-rules-ui, Clone and modify>> detection rule queries so they ignore \n+authorized policies and workflows, thereby reducing the noise level while still \n+retaining actionable signals.\n+* Clone and modify detection rule risk scores, and use branching logic to map \n+higher risk scores to higher priority workflows.\n+\n+For details about tuning rules for specific categories, see:\n+\n+* <<tune-authorized-processes>>\n+* <<tune-windows-rules>>\n+* <<tune-network-rules>>\n+\n+IMPORTANT: Due to the different way {beats} record network traffic direction, ", "originalCommit": "c3e75d16b13b5f2f5fcfaf4144869d1b16c1482b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk4NjAxMQ==", "url": "https://github.com/elastic/stack-docs/pull/874#discussion_r381986011", "bodyText": "Removed the word issue.", "author": "benskelker", "createdAt": "2020-02-20T13:06:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3MzI1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NDcyNQ==", "url": "https://github.com/elastic/stack-docs/pull/874#discussion_r381474725", "bodyText": "can we say, \"when they rarely produce actionable signals because they match local expected behavior, workflows, or policy exceptions.\"", "author": "randomuserid", "createdAt": "2020-02-19T18:51:04Z", "path": "docs/en/siem/tune-rule-signals.asciidoc", "diffHunk": "@@ -0,0 +1,230 @@\n+[[tuning-detection-signals]]\n+== Tuning detection rules\n+\n+In the {siem-app}, detection rules can be tuned to produce the best possible \n+set of actionable signals. To reduce the noise level, you can:\n+\n+* Disable detection rules when they match expected behavior, workflows, and \n+allowed policies, and when they rarely produce actionable signals.", "originalCommit": "c3e75d16b13b5f2f5fcfaf4144869d1b16c1482b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NTI5OQ==", "url": "https://github.com/elastic/stack-docs/pull/874#discussion_r381475299", "bodyText": "would be more accurate to say \"so they align with or reflect local policy exceptions\"", "author": "randomuserid", "createdAt": "2020-02-19T18:51:54Z", "path": "docs/en/siem/tune-rule-signals.asciidoc", "diffHunk": "@@ -0,0 +1,230 @@\n+[[tuning-detection-signals]]\n+== Tuning detection rules\n+\n+In the {siem-app}, detection rules can be tuned to produce the best possible \n+set of actionable signals. To reduce the noise level, you can:\n+\n+* Disable detection rules when they match expected behavior, workflows, and \n+allowed policies, and when they rarely produce actionable signals.\n+* <<manage-rules-ui, Clone and modify>> detection rule queries so they ignore \n+authorized policies and workflows, thereby reducing the noise level while still ", "originalCommit": "c3e75d16b13b5f2f5fcfaf4144869d1b16c1482b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NTgzMA==", "url": "https://github.com/elastic/stack-docs/pull/874#discussion_r381475830", "bodyText": "this may be my bad but we should say \"Occasionally, these produce unwanted signals.\"", "author": "randomuserid", "createdAt": "2020-02-19T18:52:56Z", "path": "docs/en/siem/tune-rule-signals.asciidoc", "diffHunk": "@@ -0,0 +1,230 @@\n+[[tuning-detection-signals]]\n+== Tuning detection rules\n+\n+In the {siem-app}, detection rules can be tuned to produce the best possible \n+set of actionable signals. To reduce the noise level, you can:\n+\n+* Disable detection rules when they match expected behavior, workflows, and \n+allowed policies, and when they rarely produce actionable signals.\n+* <<manage-rules-ui, Clone and modify>> detection rule queries so they ignore \n+authorized policies and workflows, thereby reducing the noise level while still \n+retaining actionable signals.\n+* Clone and modify detection rule risk scores, and use branching logic to map \n+higher risk scores to higher priority workflows.\n+\n+For details about tuning rules for specific categories, see:\n+\n+* <<tune-authorized-processes>>\n+* <<tune-windows-rules>>\n+* <<tune-network-rules>>\n+\n+IMPORTANT: Due to the different way {beats} record network traffic direction, \n+network detection rules may produce noise. <<fix-network-rules>> explains how \n+to resolve this issue. For more background information, see the\n+{ecs-ref}/ecs-network.html[ECS network.direction field].\n+\n+[float]\n+[[filter-rule-process]]\n+=== Filter out uncommon application signals\n+\n+Organizations frequently use uncommon and in-house applications. Often, these ", "originalCommit": "c3e75d16b13b5f2f5fcfaf4144869d1b16c1482b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NjYyOA==", "url": "https://github.com/elastic/stack-docs/pull/874#discussion_r381476628", "bodyText": "I would say authorized security research  - it could be ongoing or intermittent, automated or manual.", "author": "randomuserid", "createdAt": "2020-02-19T18:54:19Z", "path": "docs/en/siem/tune-rule-signals.asciidoc", "diffHunk": "@@ -0,0 +1,230 @@\n+[[tuning-detection-signals]]\n+== Tuning detection rules\n+\n+In the {siem-app}, detection rules can be tuned to produce the best possible \n+set of actionable signals. To reduce the noise level, you can:\n+\n+* Disable detection rules when they match expected behavior, workflows, and \n+allowed policies, and when they rarely produce actionable signals.\n+* <<manage-rules-ui, Clone and modify>> detection rule queries so they ignore \n+authorized policies and workflows, thereby reducing the noise level while still \n+retaining actionable signals.\n+* Clone and modify detection rule risk scores, and use branching logic to map \n+higher risk scores to higher priority workflows.\n+\n+For details about tuning rules for specific categories, see:\n+\n+* <<tune-authorized-processes>>\n+* <<tune-windows-rules>>\n+* <<tune-network-rules>>\n+\n+IMPORTANT: Due to the different way {beats} record network traffic direction, \n+network detection rules may produce noise. <<fix-network-rules>> explains how \n+to resolve this issue. For more background information, see the\n+{ecs-ref}/ecs-network.html[ECS network.direction field].\n+\n+[float]\n+[[filter-rule-process]]\n+=== Filter out uncommon application signals\n+\n+Organizations frequently use uncommon and in-house applications. Often, these \n+can trigger unwanted signals. To stop a rule matching on an application, you \n+need to modify the rule's logic so it ignores the application's name.\n+\n+For example, to prevent the <<unusual-process-execution-temp>> rule from\n+producing signals for an in-house application named `myautomatedbuild`:\n+\n+. Go to *SIEM* -> *Detections* -> *Manage signal detection rules*.\n+. Search for the `Unusual Process Execution - Temp` rule, and then:\n+.. Click the actions icon on the rule's row (three dots).\n+.. Select _Duplicate rule_\n++\n+A duplicate rule is created, named `Unusual Process Execution - Temp [Duplicate]`.\n+. Search for the new rule, and then:\n+.. Click the actions icon on the rule's row (three dots).\n+.. Select _Edit rule settings_\n++\n+TIP: At the top of the *All rules* table, click `Custom rules` to display only \n+your rules.\n++\n+The *Edit rule settings* page is displayed.\n+[role=\"screenshot\"]\n+image::images/edit-dect-rule.png[]\n+\n+. Do *one* of these:\n+* In the _Custom query_ field, add this condition:\n++\n+`and not process.name: \"myautomatedbuild\"`\n++\n+[role=\"screenshot\"]\n+image::images/edit-dect-rule-query.png[]\n+* Click _Add filter_, and then define a `process.name is not myautomatedbuild` \n+condition.\n++\n+[role=\"screenshot\"]\n+image::images/edit-dect-rule-filter.png[]\n+. Save the new rule and disable the original rule. If you want, you can delete \n+the original rule.\n+\n+[float]\n+[[tune-authorized-processes]]\n+=== Tune rules detecting authorized processes\n+\n+Authorized security testing, system tools, management frameworks, and\n+administrative activity may trigger detection rules. These legitimate \n+activities include:\n+\n+* Ongoing and automated security testing and research.", "originalCommit": "c3e75d16b13b5f2f5fcfaf4144869d1b16c1482b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3ODEwNQ==", "url": "https://github.com/elastic/stack-docs/pull/874#discussion_r381478105", "bodyText": "I would not discuss practices at Elastic because only InfoSec are probably authorized to make public statements about this.", "author": "randomuserid", "createdAt": "2020-02-19T18:57:02Z", "path": "docs/en/siem/tune-rule-signals.asciidoc", "diffHunk": "@@ -0,0 +1,230 @@\n+[[tuning-detection-signals]]\n+== Tuning detection rules\n+\n+In the {siem-app}, detection rules can be tuned to produce the best possible \n+set of actionable signals. To reduce the noise level, you can:\n+\n+* Disable detection rules when they match expected behavior, workflows, and \n+allowed policies, and when they rarely produce actionable signals.\n+* <<manage-rules-ui, Clone and modify>> detection rule queries so they ignore \n+authorized policies and workflows, thereby reducing the noise level while still \n+retaining actionable signals.\n+* Clone and modify detection rule risk scores, and use branching logic to map \n+higher risk scores to higher priority workflows.\n+\n+For details about tuning rules for specific categories, see:\n+\n+* <<tune-authorized-processes>>\n+* <<tune-windows-rules>>\n+* <<tune-network-rules>>\n+\n+IMPORTANT: Due to the different way {beats} record network traffic direction, \n+network detection rules may produce noise. <<fix-network-rules>> explains how \n+to resolve this issue. For more background information, see the\n+{ecs-ref}/ecs-network.html[ECS network.direction field].\n+\n+[float]\n+[[filter-rule-process]]\n+=== Filter out uncommon application signals\n+\n+Organizations frequently use uncommon and in-house applications. Often, these \n+can trigger unwanted signals. To stop a rule matching on an application, you \n+need to modify the rule's logic so it ignores the application's name.\n+\n+For example, to prevent the <<unusual-process-execution-temp>> rule from\n+producing signals for an in-house application named `myautomatedbuild`:\n+\n+. Go to *SIEM* -> *Detections* -> *Manage signal detection rules*.\n+. Search for the `Unusual Process Execution - Temp` rule, and then:\n+.. Click the actions icon on the rule's row (three dots).\n+.. Select _Duplicate rule_\n++\n+A duplicate rule is created, named `Unusual Process Execution - Temp [Duplicate]`.\n+. Search for the new rule, and then:\n+.. Click the actions icon on the rule's row (three dots).\n+.. Select _Edit rule settings_\n++\n+TIP: At the top of the *All rules* table, click `Custom rules` to display only \n+your rules.\n++\n+The *Edit rule settings* page is displayed.\n+[role=\"screenshot\"]\n+image::images/edit-dect-rule.png[]\n+\n+. Do *one* of these:\n+* In the _Custom query_ field, add this condition:\n++\n+`and not process.name: \"myautomatedbuild\"`\n++\n+[role=\"screenshot\"]\n+image::images/edit-dect-rule-query.png[]\n+* Click _Add filter_, and then define a `process.name is not myautomatedbuild` \n+condition.\n++\n+[role=\"screenshot\"]\n+image::images/edit-dect-rule-filter.png[]\n+. Save the new rule and disable the original rule. If you want, you can delete \n+the original rule.\n+\n+[float]\n+[[tune-authorized-processes]]\n+=== Tune rules detecting authorized processes\n+\n+Authorized security testing, system tools, management frameworks, and\n+administrative activity may trigger detection rules. These legitimate \n+activities include:\n+\n+* Ongoing and automated security testing and research.\n+* System and software management processes running scripts, including scripts \n+that start child processes.\n+* Administrative and management frameworks that create users, schedule tasks, make `psexec` connections, and run WMI commands.\n+* Legitimate scripts using the `whoami` command.\n+* Applications that work with file shares, such as backup programs, and use the \n+server message block (SMB) protocol.\n+\n+To reduce signal noise for authorized activity, you can do any of the these:\n+\n+* Add a statement or filter to the rules that exclude specific servers, such as \n+the relevant host names, agent names, or other common identifier. \n+For example, `and not host.name : \"server-name\"`.\n+* Add a statement or filter to the rules that <<filter-rule-process, exclude specific processes>>. For example, `and not process.name : \"process-name\"`.\n+* Add a statement or filter to the rules that exclude a common user. \n+For example, `and not user.name : \"security-tester\"`.\n+\n+Another useful technique is to assign lower risk scores to rules triggered by \n+authorized activity. This enables detection while keeping the resulting signals \n+out of high-priority workflows. Use these steps:\n+\n+. Duplicate the same rule twice.\n+. In the first duplication of the rule, exclude the relevant user or process \n+names (`and not user.name : \"user-name\"` or `and not process.name : \"process-name\"`).\n+. In the second duplication of the rule:\n+* Lower the `Risk score` (*Edit rule settings* -> *About* tab).\n+* Change the rule's query or filter so it only matches the user or process \n+names excluded in the first duplication\n+(`and user.name : \"user-name\"` or `and process.name : \"process-name\"`).\n+. Disable the original rule.\n+\n+[float]\n+[[tune-windows-rules]]\n+=== Tune Windows child process and PowerShell rules\n+\n+Normal user activity may sometimes trigger one or more of these these rules:\n+\n+* <<powershell-spawning-cmd>>\n+* <<suspicious-ms-office-child-process>>\n+* <<suspicious-ms-outlook-child-process>>\n+* <<suspicious-process-spawning-from-script-interpreter>>\n+* <<suspicious-process-spawning-from-script-interpreter>>\n+* <<system-shells-via-services>>\n+* <<unusual-parent-child-relationship>>\n+* <<windows-script-executing-powershell>>\n+ \n+While all rules can be adjusted as needed, use care when adding exceptions to \n+these rules. Exceptions could result in an undetected client side execution, or \n+a persistence or malware threat going unnoticed.\n+\n+Examples of when these rules may create noise include:\n+\n+* Receiving and opening email-attached Microsoft Office files, which \n+include active content such as macros or scripts, from a trusted third-party \n+source.\n+* Authorized technical support personnel who provide remote workers with\n+scripts to gather troubleshooting information.\n+\n+In these cases, exceptions can be added to the rules using the relevant \n+`process.name`, `user.name`, and `host.name` conditions. Additionally, \n+you can create duplicate rules with lower risk scores.\n+\n+[float]\n+[[tune-network-rules]]\n+=== Tune network rules\n+\n+The definition of normal network behavior varies widely across different\n+organizations, each network conforming to different security policies, \n+standards, and regulations. When normal network activity triggers signals, \n+network rules can be disabled or modified. For example:\n+\n+* To exclude a specific source, add a `not source.ip` statement with the \n+relevant IP address, and a `destination.port` statement with the relevant port \n+number (`not source.ip : 196.1.0.12 and destination.port : 445`).\n+* To exclude source network traffic for an entire subnet, add a `not source.ip` \n+statement with the relevant CIDR notation (`not source.ip : 192.168.0.0/16`).\n+* To exclude a destination IP for a specific destination port, add a\n+`not destination.ip` statement with the IP address, and a `destination.port` \n+statement with the port number\n+(`not destination.ip : 38.160.150.31 and destination.port : 445`)\n+* To exclude a destination subnet for a specific destination port, add a\n+`not destination.ip` statement using CIDR notation, and a \u2018destination.port\u2019 \n+statement with the port number\n+(`not destination.ip : 172.16.0.0/12 and destination.port : 445`).\n+\n+[float]\n+==== Noise from common network traffic\n+\n+These network rules may need tuning to reduce noise from legitimate network\n+activity:\n+\n+[horizontal]\n+<<dns-activity-to-the-internet>>:: Personal devices, brought to work or used while working remotely, can query arbitrary DNS servers.\n+<<ftp-file-transfer-protocol-activity-to-the-internet>>:: FTP is sometimes used with external sources.\n+<<smtp-to-the-internet>>:: Marketing and business workflows often \n+use SMTP email traffic. Additionally, personal devices, brought to work or used \n+while working remotely, may use consumer email services.\n+<<sql-traffic-to-the-internet>>:: Although uncommon, accessing databases over \n+the internet may be part of development workflows.\n+<<tcp-port-8000-activity-to-the-internet>>:: Frequently used port while \n+developing and testing web services.\n+\n+[float]\n+==== Noise from common cloud-based network traffic\n+\n+In cloud-based organizations, such as Elastic, remote workers access services ", "originalCommit": "c3e75d16b13b5f2f5fcfaf4144869d1b16c1482b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk5MTg3MQ==", "url": "https://github.com/elastic/stack-docs/pull/874#discussion_r381991871", "bodyText": "I was waiting for a comment about that", "author": "benskelker", "createdAt": "2020-02-20T13:18:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3ODEwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ5ODMxOA==", "url": "https://github.com/elastic/stack-docs/pull/874#discussion_r381498318", "bodyText": "let's say \"can be modified\" ? May not be necessary to modify them all & I don't want to scare people by making it look like a mess of work", "author": "randomuserid", "createdAt": "2020-02-19T19:34:22Z", "path": "docs/en/siem/tune-rule-signals.asciidoc", "diffHunk": "@@ -0,0 +1,230 @@\n+[[tuning-detection-signals]]\n+== Tuning detection rules\n+\n+In the {siem-app}, detection rules can be tuned to produce the best possible \n+set of actionable signals. To reduce the noise level, you can:\n+\n+* Disable detection rules when they match expected behavior, workflows, and \n+allowed policies, and when they rarely produce actionable signals.\n+* <<manage-rules-ui, Clone and modify>> detection rule queries so they ignore \n+authorized policies and workflows, thereby reducing the noise level while still \n+retaining actionable signals.\n+* Clone and modify detection rule risk scores, and use branching logic to map \n+higher risk scores to higher priority workflows.\n+\n+For details about tuning rules for specific categories, see:\n+\n+* <<tune-authorized-processes>>\n+* <<tune-windows-rules>>\n+* <<tune-network-rules>>\n+\n+IMPORTANT: Due to the different way {beats} record network traffic direction, \n+network detection rules may produce noise. <<fix-network-rules>> explains how \n+to resolve this issue. For more background information, see the\n+{ecs-ref}/ecs-network.html[ECS network.direction field].\n+\n+[float]\n+[[filter-rule-process]]\n+=== Filter out uncommon application signals\n+\n+Organizations frequently use uncommon and in-house applications. Often, these \n+can trigger unwanted signals. To stop a rule matching on an application, you \n+need to modify the rule's logic so it ignores the application's name.\n+\n+For example, to prevent the <<unusual-process-execution-temp>> rule from\n+producing signals for an in-house application named `myautomatedbuild`:\n+\n+. Go to *SIEM* -> *Detections* -> *Manage signal detection rules*.\n+. Search for the `Unusual Process Execution - Temp` rule, and then:\n+.. Click the actions icon on the rule's row (three dots).\n+.. Select _Duplicate rule_\n++\n+A duplicate rule is created, named `Unusual Process Execution - Temp [Duplicate]`.\n+. Search for the new rule, and then:\n+.. Click the actions icon on the rule's row (three dots).\n+.. Select _Edit rule settings_\n++\n+TIP: At the top of the *All rules* table, click `Custom rules` to display only \n+your rules.\n++\n+The *Edit rule settings* page is displayed.\n+[role=\"screenshot\"]\n+image::images/edit-dect-rule.png[]\n+\n+. Do *one* of these:\n+* In the _Custom query_ field, add this condition:\n++\n+`and not process.name: \"myautomatedbuild\"`\n++\n+[role=\"screenshot\"]\n+image::images/edit-dect-rule-query.png[]\n+* Click _Add filter_, and then define a `process.name is not myautomatedbuild` \n+condition.\n++\n+[role=\"screenshot\"]\n+image::images/edit-dect-rule-filter.png[]\n+. Save the new rule and disable the original rule. If you want, you can delete \n+the original rule.\n+\n+[float]\n+[[tune-authorized-processes]]\n+=== Tune rules detecting authorized processes\n+\n+Authorized security testing, system tools, management frameworks, and\n+administrative activity may trigger detection rules. These legitimate \n+activities include:\n+\n+* Ongoing and automated security testing and research.\n+* System and software management processes running scripts, including scripts \n+that start child processes.\n+* Administrative and management frameworks that create users, schedule tasks, make `psexec` connections, and run WMI commands.\n+* Legitimate scripts using the `whoami` command.\n+* Applications that work with file shares, such as backup programs, and use the \n+server message block (SMB) protocol.\n+\n+To reduce signal noise for authorized activity, you can do any of the these:\n+\n+* Add a statement or filter to the rules that exclude specific servers, such as \n+the relevant host names, agent names, or other common identifier. \n+For example, `and not host.name : \"server-name\"`.\n+* Add a statement or filter to the rules that <<filter-rule-process, exclude specific processes>>. For example, `and not process.name : \"process-name\"`.\n+* Add a statement or filter to the rules that exclude a common user. \n+For example, `and not user.name : \"security-tester\"`.\n+\n+Another useful technique is to assign lower risk scores to rules triggered by \n+authorized activity. This enables detection while keeping the resulting signals \n+out of high-priority workflows. Use these steps:\n+\n+. Duplicate the same rule twice.\n+. In the first duplication of the rule, exclude the relevant user or process \n+names (`and not user.name : \"user-name\"` or `and not process.name : \"process-name\"`).\n+. In the second duplication of the rule:\n+* Lower the `Risk score` (*Edit rule settings* -> *About* tab).\n+* Change the rule's query or filter so it only matches the user or process \n+names excluded in the first duplication\n+(`and user.name : \"user-name\"` or `and process.name : \"process-name\"`).\n+. Disable the original rule.\n+\n+[float]\n+[[tune-windows-rules]]\n+=== Tune Windows child process and PowerShell rules\n+\n+Normal user activity may sometimes trigger one or more of these these rules:\n+\n+* <<powershell-spawning-cmd>>\n+* <<suspicious-ms-office-child-process>>\n+* <<suspicious-ms-outlook-child-process>>\n+* <<suspicious-process-spawning-from-script-interpreter>>\n+* <<suspicious-process-spawning-from-script-interpreter>>\n+* <<system-shells-via-services>>\n+* <<unusual-parent-child-relationship>>\n+* <<windows-script-executing-powershell>>\n+ \n+While all rules can be adjusted as needed, use care when adding exceptions to \n+these rules. Exceptions could result in an undetected client side execution, or \n+a persistence or malware threat going unnoticed.\n+\n+Examples of when these rules may create noise include:\n+\n+* Receiving and opening email-attached Microsoft Office files, which \n+include active content such as macros or scripts, from a trusted third-party \n+source.\n+* Authorized technical support personnel who provide remote workers with\n+scripts to gather troubleshooting information.\n+\n+In these cases, exceptions can be added to the rules using the relevant \n+`process.name`, `user.name`, and `host.name` conditions. Additionally, \n+you can create duplicate rules with lower risk scores.\n+\n+[float]\n+[[tune-network-rules]]\n+=== Tune network rules\n+\n+The definition of normal network behavior varies widely across different\n+organizations, each network conforming to different security policies, \n+standards, and regulations. When normal network activity triggers signals, \n+network rules can be disabled or modified. For example:\n+\n+* To exclude a specific source, add a `not source.ip` statement with the \n+relevant IP address, and a `destination.port` statement with the relevant port \n+number (`not source.ip : 196.1.0.12 and destination.port : 445`).\n+* To exclude source network traffic for an entire subnet, add a `not source.ip` \n+statement with the relevant CIDR notation (`not source.ip : 192.168.0.0/16`).\n+* To exclude a destination IP for a specific destination port, add a\n+`not destination.ip` statement with the IP address, and a `destination.port` \n+statement with the port number\n+(`not destination.ip : 38.160.150.31 and destination.port : 445`)\n+* To exclude a destination subnet for a specific destination port, add a\n+`not destination.ip` statement using CIDR notation, and a \u2018destination.port\u2019 \n+statement with the port number\n+(`not destination.ip : 172.16.0.0/12 and destination.port : 445`).\n+\n+[float]\n+==== Noise from common network traffic\n+\n+These network rules may need tuning to reduce noise from legitimate network\n+activity:\n+\n+[horizontal]\n+<<dns-activity-to-the-internet>>:: Personal devices, brought to work or used while working remotely, can query arbitrary DNS servers.\n+<<ftp-file-transfer-protocol-activity-to-the-internet>>:: FTP is sometimes used with external sources.\n+<<smtp-to-the-internet>>:: Marketing and business workflows often \n+use SMTP email traffic. Additionally, personal devices, brought to work or used \n+while working remotely, may use consumer email services.\n+<<sql-traffic-to-the-internet>>:: Although uncommon, accessing databases over \n+the internet may be part of development workflows.\n+<<tcp-port-8000-activity-to-the-internet>>:: Frequently used port while \n+developing and testing web services.\n+\n+[float]\n+==== Noise from common cloud-based network traffic\n+\n+In cloud-based organizations, such as Elastic, remote workers access services \n+over the internet. The security policies of home networks probably differ from \n+the security policies of managed corporate networks, and these rules might need \n+tuning to reduce noise from legitimate administrative activities: \n+\n+* <<rdp-remote-desktop-protocol-from-the-internet>>\n+* <<ssh-secure-shell-from-the-internet>>\n+* <<ssh-secure-shell-to-the-internet>>\n+\n+TIP: If your organization is widely distributed and the workforce travels a \n+lot, use the `windows_anomalous_user_name_ecs`, \n+`linux_anomalous_user_name_ecs`, and `suspicious_login_activity_ecs`\n+<<machine-learning, {ml}>> jobs to detect suspicious authentication activity.\n+\n+[float]\n+[[fix-network-rules]]\n+=== Reduce noise for network rules\n+\n+To reduce noise for network rules, duplicate the network rules and *either*:\n+\n+* Remove all rule index patterns, except for the `filebeat-*` index pattern.\n+* Remove the `network.direction: outbound` statement from the query. The rule\n+then relies on CIDR notation to match traffic direction. The CIDR matches \n+(`source.ip` and `destination.ip`) can be changed to match your network's \n+configuration.\n+\n+The following rules should be modified:", "originalCommit": "c3e75d16b13b5f2f5fcfaf4144869d1b16c1482b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "65f1141265ee606a25ffcf5826f44e48e57cf13f", "url": "https://github.com/elastic/stack-docs/commit/65f1141265ee606a25ffcf5826f44e48e57cf13f", "message": "corrections after review", "committedDate": "2020-02-20T13:27:09Z", "type": "commit"}, {"oid": "d5efcd84d45b49694651ab07b43bb161f43083c2", "url": "https://github.com/elastic/stack-docs/commit/d5efcd84d45b49694651ab07b43bb161f43083c2", "message": "final correction", "committedDate": "2020-02-20T13:41:03Z", "type": "commit"}]}