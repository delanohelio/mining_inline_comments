{"pr_number": 4331, "pr_title": "change upgrade path to 4.14 (from 4.13) and intensify check", "pr_createdAt": "2020-09-17T11:14:49Z", "pr_url": "https://github.com/apache/cloudstack/pull/4331", "timeline": [{"oid": "5d8d69c70146440b2d9dc3585cfe38ee818c1c2d", "url": "https://github.com/apache/cloudstack/commit/5d8d69c70146440b2d9dc3585cfe38ee818c1c2d", "message": "change upgrade path to 4.14 (from 4.13) and intensify check", "committedDate": "2020-09-17T11:07:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc2MTMzOQ==", "url": "https://github.com/apache/cloudstack/pull/4331#discussion_r490761339", "bodyText": "why is this moved to another upgrade script? it makes it harder to compare and would imply it will not be needed/used in propriatory 4.13 releases anymore", "author": "DaanHoogland", "createdAt": "2020-09-18T07:41:32Z", "path": "engine/schema/src/main/resources/META-INF/db/schema-41310to41400.sql", "diffHunk": "@@ -53,33 +53,6 @@ ALTER TABLE `cloud`.`vm_instance` ADD COLUMN `backup_offering_id` bigint unsigne\n ALTER TABLE `cloud`.`vm_instance` ADD COLUMN `backup_external_id` varchar(255) DEFAULT NULL COMMENT 'ID of external backup job or container if any';\n ALTER TABLE `cloud`.`vm_instance` ADD COLUMN `backup_volumes` text DEFAULT NULL COMMENT 'details of backedup volumes';\n \n-ALTER TABLE `cloud`.`image_store` ADD COLUMN `readonly` boolean DEFAULT false COMMENT 'defines status of image store';", "originalCommit": "5d8d69c70146440b2d9dc3585cfe38ee818c1c2d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc2NDcyMg==", "url": "https://github.com/apache/cloudstack/pull/4331#discussion_r490764722", "bodyText": "@DaanHoogland  This is related to PR#4053 which merged recently to master where the schema changes were made in old schema file.\nhttps://github.com/apache/cloudstack/pull/4053/files#r490066335", "author": "harikrishna-patnala", "createdAt": "2020-09-18T07:48:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc2MTMzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc2MjE5Mg==", "url": "https://github.com/apache/cloudstack/pull/4331#discussion_r490762192", "bodyText": "please put this condition in a boolean method with a good descriptive name.", "author": "DaanHoogland", "createdAt": "2020-09-18T07:43:18Z", "path": "services/secondary-storage/server/src/main/java/org/apache/cloudstack/storage/resource/NfsSecondaryStorageResource.java", "diffHunk": "@@ -1049,8 +1049,11 @@ protected Answer execute(CopyCommand cmd) {\n         DataTO destData = cmd.getDestTO();\n         DataStoreTO srcDataStore = srcData.getDataStore();\n         DataStoreTO destDataStore = destData.getDataStore();\n-\n-        if (DataStoreRole.Image == srcDataStore.getRole()  && DataStoreRole.Image == destDataStore.getRole()) {\n+        if (DataStoreRole.Image == srcDataStore.getRole() && DataStoreRole.Image == destDataStore.getRole() &&\n+            srcDataStore instanceof NfsTO && destDataStore instanceof NfsTO &&\n+            ((srcData.getObjectType() == DataObjectType.TEMPLATE && destData.getObjectType() == DataObjectType.TEMPLATE) ||\n+                    (srcData.getObjectType() == DataObjectType.SNAPSHOT && destData.getObjectType() == DataObjectType.SNAPSHOT) ||\n+                    (srcData.getObjectType() == DataObjectType.VOLUME && destData.getObjectType() == DataObjectType.VOLUME))) {", "originalCommit": "5d8d69c70146440b2d9dc3585cfe38ee818c1c2d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc3NzM2NQ==", "url": "https://github.com/apache/cloudstack/pull/4331#discussion_r490777365", "bodyText": "@DaanHoogland extracted the conditional", "author": "Pearl1594", "createdAt": "2020-09-18T08:11:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc2MjE5Mg=="}], "type": "inlineReview"}, {"oid": "37398376e9e2e19ba6df61362073ee0a01171d21", "url": "https://github.com/apache/cloudstack/commit/37398376e9e2e19ba6df61362073ee0a01171d21", "message": "extracted check", "committedDate": "2020-09-18T08:16:59Z", "type": "commit"}, {"oid": "37398376e9e2e19ba6df61362073ee0a01171d21", "url": "https://github.com/apache/cloudstack/commit/37398376e9e2e19ba6df61362073ee0a01171d21", "message": "extracted check", "committedDate": "2020-09-18T08:16:59Z", "type": "forcePushed"}]}