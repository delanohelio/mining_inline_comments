{"pr_number": 4323, "pr_title": "systemvm: Update novnc", "pr_createdAt": "2020-09-12T11:26:05Z", "pr_url": "https://github.com/apache/cloudstack/pull/4323", "timeline": [{"oid": "6280572c9dfc0658c9108795c7562fc1e2579fa6", "url": "https://github.com/apache/cloudstack/commit/6280572c9dfc0658c9108795c7562fc1e2579fa6", "message": "Tweaking novnc to work", "committedDate": "2020-09-12T11:26:58Z", "type": "forcePushed"}, {"oid": "2962e1f07443e1f39ce0a08c2994e6c77efba221", "url": "https://github.com/apache/cloudstack/commit/2962e1f07443e1f39ce0a08c2994e6c77efba221", "message": "Updating novnc", "committedDate": "2020-09-12T17:42:21Z", "type": "commit"}, {"oid": "cbced66db754463b3c9b0367e159b740940e5a76", "url": "https://github.com/apache/cloudstack/commit/cbced66db754463b3c9b0367e159b740940e5a76", "message": "Tweaking novnc to work", "committedDate": "2020-09-12T17:42:39Z", "type": "forcePushed"}, {"oid": "85259d252bf661fd942e6c333d30a7d30e31f03b", "url": "https://github.com/apache/cloudstack/commit/85259d252bf661fd942e6c333d30a7d30e31f03b", "message": "Tweaking novnc to work", "committedDate": "2020-09-12T18:08:26Z", "type": "forcePushed"}, {"oid": "6ce9e7a4bbc104a800b6ee53c5d40e0deaf5b5e5", "url": "https://github.com/apache/cloudstack/commit/6ce9e7a4bbc104a800b6ee53c5d40e0deaf5b5e5", "message": "Tweaking novnc to work", "committedDate": "2020-09-12T18:25:46Z", "type": "forcePushed"}, {"oid": "f92743733a001c5e57dd471db336720864626f0c", "url": "https://github.com/apache/cloudstack/commit/f92743733a001c5e57dd471db336720864626f0c", "message": "Tweaking novnc to work", "committedDate": "2020-09-12T18:31:05Z", "type": "forcePushed"}, {"oid": "d59c8a011880149b67512747c5a8c58ca46edf96", "url": "https://github.com/apache/cloudstack/commit/d59c8a011880149b67512747c5a8c58ca46edf96", "message": "Tweaking novnc to work", "committedDate": "2020-09-13T10:58:17Z", "type": "forcePushed"}, {"oid": "4c8b36035004667455973d006ab405af6cb02194", "url": "https://github.com/apache/cloudstack/commit/4c8b36035004667455973d006ab405af6cb02194", "message": "Tweaking novnc to work", "committedDate": "2020-09-13T11:40:38Z", "type": "forcePushed"}, {"oid": "d70fc6d9d28ce6d7a423844f7a813b0accba504d", "url": "https://github.com/apache/cloudstack/commit/d70fc6d9d28ce6d7a423844f7a813b0accba504d", "message": "Tweaking novnc to work", "committedDate": "2020-09-18T07:57:56Z", "type": "forcePushed"}, {"oid": "2bc0e64ef11efd290466bca07930744e4be65af8", "url": "https://github.com/apache/cloudstack/commit/2bc0e64ef11efd290466bca07930744e4be65af8", "message": "Tweaking novnc to work", "committedDate": "2020-09-18T09:38:41Z", "type": "forcePushed"}, {"oid": "5d6f120afb2506cdae54326d02bd3923c08f8105", "url": "https://github.com/apache/cloudstack/commit/5d6f120afb2506cdae54326d02bd3923c08f8105", "message": "Tweaking novnc to work", "committedDate": "2020-09-18T09:49:35Z", "type": "forcePushed"}, {"oid": "b74579e4c494474431e99e25636cf71ada8178ef", "url": "https://github.com/apache/cloudstack/commit/b74579e4c494474431e99e25636cf71ada8178ef", "message": "Tweaking novnc to work", "committedDate": "2020-09-22T04:02:04Z", "type": "commit"}, {"oid": "b74579e4c494474431e99e25636cf71ada8178ef", "url": "https://github.com/apache/cloudstack/commit/b74579e4c494474431e99e25636cf71ada8178ef", "message": "Tweaking novnc to work", "committedDate": "2020-09-22T04:02:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODEyNzAyMg==", "url": "https://github.com/apache/cloudstack/pull/4323#discussion_r588127022", "bodyText": "@davidjumani\none of our customers has issue accessing the novnc console, because scaleViewport is undefined in line 1216\nUI.rfb.scaleViewport = this.fullScreen\nBut I cannot find this change in novnc repository.\nhttps://github.com/novnc/noVNC/blob/master/app/ui.js#L1209", "author": "weizhouapache", "createdAt": "2021-03-05T08:49:32Z", "path": "systemvm/agent/noVNC/app/ui.js", "diffHunk": "@@ -1206,38 +1212,14 @@ const UI = {\n  * ------v------*/\n \n     toggleFullscreen() {\n-        if (document.fullscreenElement || // alternative standard method\n-            document.mozFullScreenElement || // currently working methods\n-            document.webkitFullscreenElement ||\n-            document.msFullscreenElement) {\n-            if (document.exitFullscreen) {\n-                document.exitFullscreen();\n-            } else if (document.mozCancelFullScreen) {\n-                document.mozCancelFullScreen();\n-            } else if (document.webkitExitFullscreen) {\n-                document.webkitExitFullscreen();\n-            } else if (document.msExitFullscreen) {\n-                document.msExitFullscreen();\n-            }\n-        } else {\n-            if (document.documentElement.requestFullscreen) {\n-                document.documentElement.requestFullscreen();\n-            } else if (document.documentElement.mozRequestFullScreen) {\n-                document.documentElement.mozRequestFullScreen();\n-            } else if (document.documentElement.webkitRequestFullscreen) {\n-                document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n-            } else if (document.body.msRequestFullscreen) {\n-                document.body.msRequestFullscreen();\n-            }\n-        }\n-        UI.updateFullscreenButton();\n+        this.fullScreen = !this.fullScreen\n+        UI.rfb.scaleViewport = this.fullScreen", "originalCommit": "b74579e4c494474431e99e25636cf71ada8178ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODgzOTM3Mw==", "url": "https://github.com/apache/cloudstack/pull/4323#discussion_r588839373", "bodyText": "@weizhouapache I've changed a bit of the novnc UI to allow fullscreen and pasting into the console.\nfullscreen is defined at line 44 and scaleViewport is defined in rfb.js", "author": "davidjumani", "createdAt": "2021-03-06T06:02:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODEyNzAyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODkyNjcyNg==", "url": "https://github.com/apache/cloudstack/pull/4323#discussion_r588926726", "bodyText": "@weizhouapache I've changed a bit of the novnc UI to allow fullscreen and pasting into the console.\nfullscreen is defined at line 44 and scaleViewport is defined in rfb.js\n\n@davidjumani\nwe do not have any problem in our testing. but that customer cannot access the console. he tried with different browsers.\nit is strange. it seem UI.rfb is not initialized.", "author": "weizhouapache", "createdAt": "2021-03-06T20:22:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODEyNzAyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4OTE1MTU2Mw==", "url": "https://github.com/apache/cloudstack/pull/4323#discussion_r589151563", "bodyText": "@weizhouapache That could be a bigger issue since rfb.js is used to communicate with the host. Did destroying and recreating the console proxy help ? Also could you check whether the customer has tweaked the novnc code in the cpvm ? Or any issue with the systemvm.iso itself ?", "author": "davidjumani", "createdAt": "2021-03-08T03:38:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODEyNzAyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MDM5ODY1Mw==", "url": "https://github.com/apache/cloudstack/pull/4323#discussion_r590398653", "bodyText": "@weizhouapache That could be a bigger issue since rfb.js is used to communicate with the host. Did destroying and recreating the console proxy help ? Also could you check whether the customer has tweaked the novnc code in the cpvm ? Or any issue with the systemvm.iso itself ?\n\n@davidjumani ignore the issue above. It happened when we enlarge the screen when websocket connection is not working. it is a bug but not critical. we are still looking for the root cause of the issue. customer uses German keyboard which is different from us.", "author": "weizhouapache", "createdAt": "2021-03-09T14:07:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODEyNzAyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTEyOTYyNA==", "url": "https://github.com/apache/cloudstack/pull/4323#discussion_r591129624", "bodyText": "@weizhouapache Fixed in #4783\nIt prevents the fullscreen button from being shown when not connected to the VM", "author": "davidjumani", "createdAt": "2021-03-10T07:01:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODEyNzAyMg=="}], "type": "inlineReview"}]}