{"pr_number": 4376, "pr_title": "server: Fix some cpuspeed issues while create service offering", "pr_createdAt": "2020-10-06T07:23:24Z", "pr_url": "https://github.com/apache/cloudstack/pull/4376", "timeline": [{"oid": "3f1e9098b449e97b3d4f51d17393383415811e18", "url": "https://github.com/apache/cloudstack/commit/3f1e9098b449e97b3d4f51d17393383415811e18", "message": "server: Fix some cpuspeed issues while create service offering\n\nOnly the following offerings are accepted\n\n(1) fixed offering:\ncpunumber, memory, must be specified.\ncpuspeed should be specified\n\nexample: create serviceoffering displaytext=offering-fix name=offering-fix cpunumber=1 memory=1024 cpuspeed=1000\n\n(should not work)\ncreate serviceoffering displaytext=offering-fix name=offering-fix cpunumber=1 memory=1024 (but works in 4.14, fixed by this commit)\n\n(2) unconstrained offering:\n\ncpunumber, memory must be null\ncpuspeed must be null\n\nexample: create serviceoffering displaytext=offering-unconstrained name=offering-unconstrained\n\n(should not work)\ncreate serviceoffering displaytext=offering-unconstrained name=offering-unconstrained cpunumber=1\ncreate serviceoffering displaytext=offering-unconstrained name=offering-unconstrained memory=1024\ncreate serviceoffering displaytext=offering-unconstrained name=offering-unconstrained cpuspeed=1000 (but works in 4.14, fixed by this commit)\n\n(3) constrained offering:\n\ncpunumber, memory must be null\nmincpunumber, maxcpunumber, minmemory, maxmemory, cpuspeed must be specified\n\nexample:create serviceoffering displaytext=offering-constrained name=offering-constrained mincpunumber=1 maxcpunumber=2 minmemory=1024 maxmemory=2048 cpuspeed=1000\n\n(should not work)\ncreate serviceoffering displaytext=offering-constrained name=offering-constrained mincpunumber=1 maxcpunumber=2 minmemory=1024 maxmemory=2048 (but works in 4.14, fixed by this commit)", "committedDate": "2020-10-06T07:13:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzNTI4OA==", "url": "https://github.com/apache/cloudstack/pull/4376#discussion_r502235288", "bodyText": "cpuSpeed null check not required here, it is always not null as per the above changes.", "author": "sureshanaparti", "createdAt": "2020-10-09T07:21:46Z", "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "diffHunk": "@@ -2319,9 +2319,9 @@ public ServiceOffering createServiceOffering(final CreateServiceOfferingCmd cmd)\n                 throw new InvalidParameterValueException(\"For creating a custom compute offering cpu and memory all should be null\");\n             }\n             // if any of them is null, then all of them shoull be null\n-            if (maxCPU == null || minCPU == null || maxMemory == null || minMemory == null) {\n-                if (maxCPU != null || minCPU != null || maxMemory != null || minMemory != null) {\n-                    throw new InvalidParameterValueException(\"For creating a custom compute offering min/max cpu and min/max memory should all be specified\");\n+            if (maxCPU == null || minCPU == null || maxMemory == null || minMemory == null || cpuSpeed == null) {\n+                if (maxCPU != null || minCPU != null || maxMemory != null || minMemory != null || cpuSpeed != null) {\n+                    throw new InvalidParameterValueException(\"For creating a custom compute offering min/max cpu and min/max memory/cpu speed should all be null or all specified\");\n                 }\n             } else {\n                 if (cpuSpeed != null && (cpuSpeed.intValue() < 0 || cpuSpeed.longValue() > Integer.MAX_VALUE)) {", "originalCommit": "3f1e9098b449e97b3d4f51d17393383415811e18", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYzMzk2MA==", "url": "https://github.com/apache/cloudstack/pull/4376#discussion_r502633960", "bodyText": "@sureshanaparti indeed, I will remove it.", "author": "weizhouapache", "createdAt": "2020-10-09T19:33:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzNTI4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzODY2OQ==", "url": "https://github.com/apache/cloudstack/pull/4376#discussion_r502238669", "bodyText": "@ustcweizhou similar cond check applicable for cpuNumber and memory if these are mandatory params? check and update accordingly.", "author": "sureshanaparti", "createdAt": "2020-10-09T07:28:51Z", "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "diffHunk": "@@ -2343,7 +2343,7 @@ public ServiceOffering createServiceOffering(final CreateServiceOfferingCmd cmd)\n             if (cpuNumber != null && (cpuNumber.intValue() <= 0 || cpuNumber.longValue() > Integer.MAX_VALUE)) {\n                 throw new InvalidParameterValueException(\"Failed to create service offering \" + offeringName + \": specify the cpu number value between 1 and \" + Integer.MAX_VALUE);\n             }\n-            if (cpuSpeed != null && (cpuSpeed.intValue() < 0 || cpuSpeed.longValue() > Integer.MAX_VALUE)) {\n+            if (cpuSpeed == null || (cpuSpeed.intValue() < 0 || cpuSpeed.longValue() > Integer.MAX_VALUE)) {", "originalCommit": "3f1e9098b449e97b3d4f51d17393383415811e18", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYzMDQ5Mw==", "url": "https://github.com/apache/cloudstack/pull/4376#discussion_r502630493", "bodyText": "@sureshanaparti cpuNumber and memory are not mandatory for dynamic offerings.\nThere are 3 types of offerings\n(1) fixed offering, cpu number, cpu speed, memory are mandatory\n(2) dynamic offering,\n(2.1) unconstrained offering, cpu number, cpu speed, memory are not required\n(2.2) constrained offerings, min/max cpu, min/max memory, and cpu speed are mandatory.", "author": "weizhouapache", "createdAt": "2020-10-09T19:25:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzODY2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQzNzA1OA==", "url": "https://github.com/apache/cloudstack/pull/4376#discussion_r503437058", "bodyText": "@weizhouapache thanks for confirming", "author": "sureshanaparti", "createdAt": "2020-10-12T17:30:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzODY2OQ=="}], "type": "inlineReview"}, {"oid": "5f2f58c0e2e2612238340caf2e3b152cbfd2872d", "url": "https://github.com/apache/cloudstack/commit/5f2f58c0e2e2612238340caf2e3b152cbfd2872d", "message": " #4376 Remove unnecessary null check on cpuSpeed", "committedDate": "2020-10-09T20:10:33Z", "type": "commit"}]}