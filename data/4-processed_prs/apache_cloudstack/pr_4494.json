{"pr_number": 4494, "pr_title": "sql: Fix Zones are returned in a random order (#3934)", "pr_createdAt": "2020-11-23T10:26:19Z", "pr_url": "https://github.com/apache/cloudstack/pull/4494", "timeline": [{"oid": "6ae6d2b73fe010a2936fdd802ccfb9a36e823924", "url": "https://github.com/apache/cloudstack/commit/6ae6d2b73fe010a2936fdd802ccfb9a36e823924", "message": "sql: Fix Zones are returned in a random order (#3934)", "committedDate": "2020-11-21T07:21:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODYyNDA3Mg==", "url": "https://github.com/apache/cloudstack/pull/4494#discussion_r528624072", "bodyText": "excuse my ignorance. why not just\nUPDATE `cloud`.`data_center` SET `sort_key` = `id` WHERE `sort_key` = 0;\n\nthis seems like it going to work as well, but i'm missing the point, i guess. at worst the first in the sortorder has to be put back at the fron, but this should be a onetime effort.", "author": "DaanHoogland", "createdAt": "2020-11-23T11:06:20Z", "path": "engine/schema/src/main/resources/META-INF/db/schema-41400to41500.sql", "diffHunk": "@@ -837,3 +837,6 @@ UPDATE `cloud`.`guest_os` SET category_id = 7 WHERE id = 275 AND display_name =\n -- Add flag 'hidden' in tables usage_ip_address and cloud_usage\n ALTER TABLE `cloud_usage`.`usage_ip_address` ADD COLUMN `is_hidden` smallint(1) NOT NULL DEFAULT '0' COMMENT 'is usage hidden';\n ALTER TABLE `cloud_usage`.`cloud_usage` ADD COLUMN `is_hidden` smallint(1) NOT NULL DEFAULT '0' COMMENT 'is usage hidden';\n+\n+-- Fix Zones are returned in a random order (#3934)\n+UPDATE `cloud`.`data_center` JOIN (SELECT COUNT(1) AS count FROM `cloud`.`data_center` WHERE `sort_key` != 0) AS tbl_tmp SET `sort_key` = `id` WHERE count = 0;", "originalCommit": "6ae6d2b73fe010a2936fdd802ccfb9a36e823924", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY1NTYzNA==", "url": "https://github.com/apache/cloudstack/pull/4494#discussion_r528655634", "bodyText": "@DaanHoogland assume the sort_key is 1,0, with your sql sort_key will be changed to 1,2.\nthe order of zones is changed by the sql.", "author": "weizhouapache", "createdAt": "2020-11-23T12:05:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODYyNDA3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY4MzUwMw==", "url": "https://github.com/apache/cloudstack/pull/4494#discussion_r528683503", "bodyText": "so in the case above, sort_key is only changed if there is no sort_key != 0. This would mean that if there are three where it is 0 and one where it is 10, nothing gets changed, does it?\nif this is at all possible btw!", "author": "DaanHoogland", "createdAt": "2020-11-23T12:56:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODYyNDA3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcxOTE3NQ==", "url": "https://github.com/apache/cloudstack/pull/4494#discussion_r528719175", "bodyText": "@DaanHoogland exactly.\nIMHO, if there is a non-zero sort_key , which mean cloudstack user might use sort_key for ordering, we will not touch it.\nif all sort_key are 0, we change sort_key to id.", "author": "weizhouapache", "createdAt": "2020-11-23T13:55:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODYyNDA3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODc1MjQzMA==", "url": "https://github.com/apache/cloudstack/pull/4494#discussion_r528752430", "bodyText": "ok, sounds reasonable.", "author": "DaanHoogland", "createdAt": "2020-11-23T14:43:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODYyNDA3Mg=="}], "type": "inlineReview"}]}