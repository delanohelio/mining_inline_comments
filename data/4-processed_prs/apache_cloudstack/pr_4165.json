{"pr_number": 4165, "pr_title": "Allow renaming cluster, host, and storage", "pr_createdAt": "2020-06-22T20:02:04Z", "pr_url": "https://github.com/apache/cloudstack/pull/4165", "timeline": [{"oid": "f5d80bbf328ff4d267fd902c193e416f29b49c52", "url": "https://github.com/apache/cloudstack/commit/f5d80bbf328ff4d267fd902c193e416f29b49c52", "message": "Update cluster name", "committedDate": "2020-06-22T05:27:18Z", "type": "commit"}, {"oid": "813ea48c1faf99800936420be3fc2d6ba9f2bc39", "url": "https://github.com/apache/cloudstack/commit/813ea48c1faf99800936420be3fc2d6ba9f2bc39", "message": "Update name of Host", "committedDate": "2020-06-22T06:39:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc5NTI2MA==", "url": "https://github.com/apache/cloudstack/pull/4165#discussion_r443795260", "bodyText": "@nvazquez can you please take a look at it?\nI changed API parameter handling from separate parameters on the method call to an object of UpdateClusterCmd class. Therefore, I needed to change this tiny piece of RollingMaintenanceManagerImpl.", "author": "GabrielBrascher", "createdAt": "2020-06-22T20:05:09Z", "path": "server/src/main/java/com/cloud/resource/RollingMaintenanceManagerImpl.java", "diffHunk": "@@ -114,12 +115,15 @@ public boolean configure(String name, Map<String, Object> params) throws Configu\n         return true;\n     }\n \n-    private void updateCluster(long clusterId, String state) {\n+    private void updateCluster(long clusterId, String allocationState) {", "originalCommit": "38e69e5afa11ba9a4d383e97609073b5ab1876d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDgyNzg1Nw==", "url": "https://github.com/apache/cloudstack/pull/4165#discussion_r444827857", "bodyText": "Thanks @GabrielBrascher, looks good to me. The change needed in RollingMaintenanceManagerImpl will be just the same as you've done below", "author": "nvazquez", "createdAt": "2020-06-24T11:29:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc5NTI2MA=="}], "type": "inlineReview"}, {"oid": "bef567f835c950aa62f4d60cf9060130d043e840", "url": "https://github.com/apache/cloudstack/commit/bef567f835c950aa62f4d60cf9060130d043e840", "message": "Fix UpdateClusterCmd for Rolling maintenance, MockResourceManager\n\nUpdate Host name handling to update instead of persist\n\nAllow update\n Storage name", "committedDate": "2020-06-22T20:07:01Z", "type": "commit"}, {"oid": "bef567f835c950aa62f4d60cf9060130d043e840", "url": "https://github.com/apache/cloudstack/commit/bef567f835c950aa62f4d60cf9060130d043e840", "message": "Fix UpdateClusterCmd for Rolling maintenance, MockResourceManager\n\nUpdate Host name handling to update instead of persist\n\nAllow update\n Storage name", "committedDate": "2020-06-22T20:07:01Z", "type": "forcePushed"}, {"oid": "91961eb8f72471c9c8a8d151a9be812bd91ffe0f", "url": "https://github.com/apache/cloudstack/commit/91961eb8f72471c9c8a8d151a9be812bd91ffe0f", "message": "add log message for updating cluster and storage pool name", "committedDate": "2020-06-22T20:18:37Z", "type": "commit"}, {"oid": "74e99009307ab7751ea175795a45fb97ed66a709", "url": "https://github.com/apache/cloudstack/commit/74e99009307ab7751ea175795a45fb97ed66a709", "message": "Prevent renaming VMware cluster as it could cause problems.", "committedDate": "2020-06-24T20:52:31Z", "type": "forcePushed"}, {"oid": "9176e290e296ced915e831dc403f5971948aa701", "url": "https://github.com/apache/cloudstack/commit/9176e290e296ced915e831dc403f5971948aa701", "message": "Prevent renaming VMware cluster as it could cause problems.", "committedDate": "2020-06-24T20:54:37Z", "type": "commit"}, {"oid": "9176e290e296ced915e831dc403f5971948aa701", "url": "https://github.com/apache/cloudstack/commit/9176e290e296ced915e831dc403f5971948aa701", "message": "Prevent renaming VMware cluster as it could cause problems.", "committedDate": "2020-06-24T20:54:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjAyODI2Nw==", "url": "https://github.com/apache/cloudstack/pull/4165#discussion_r456028267", "bodyText": "@rhtyd considering your concerns with issues caused by renaming VMware clusters I added this line.", "author": "GabrielBrascher", "createdAt": "2020-07-16T19:36:24Z", "path": "server/src/main/java/com/cloud/resource/ResourceManagerImpl.java", "diffHunk": "@@ -1026,12 +1027,26 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n \n     @Override\n     @DB\n-    public Cluster updateCluster(final Cluster clusterToUpdate, final String clusterType, final String hypervisor, final String allocationState, final String managedstate) {\n+    public Cluster updateCluster(UpdateClusterCmd cmd) {\n+        ClusterVO cluster = (ClusterVO) getCluster(cmd.getId());\n+        String clusterType = cmd.getClusterType();\n+        String hypervisor = cmd.getHypervisor();\n+        String allocationState = cmd.getAllocationState();\n+        String managedstate = cmd.getManagedstate();\n+        String name = cmd.getClusterName();\n \n-        final ClusterVO cluster = (ClusterVO)clusterToUpdate;\n         // Verify cluster information and update the cluster if needed\n         boolean doUpdate = false;\n \n+        if (org.apache.commons.lang.StringUtils.isNotBlank(name)) {\n+            if(cluster.getHypervisorType() == HypervisorType.VMware) {", "originalCommit": "9176e290e296ced915e831dc403f5971948aa701", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}