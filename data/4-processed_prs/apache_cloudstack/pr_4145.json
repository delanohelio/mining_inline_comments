{"pr_number": 4145, "pr_title": "Fixing listVirtualMachinesMetrics to extend ListVMsCmd instead of ListVMsCmdByAdmin", "pr_createdAt": "2020-06-15T06:12:22Z", "pr_url": "https://github.com/apache/cloudstack/pull/4145", "timeline": [{"oid": "902755cd02f731a13439bb5716a06a7a7d2908cb", "url": "https://github.com/apache/cloudstack/commit/902755cd02f731a13439bb5716a06a7a7d2908cb", "message": "Fixing listVirtualMachinesMetrics to extend ListVMsCmd instead of ListVMsCmdByAdmin", "committedDate": "2020-06-15T06:09:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTk5OTU2NQ==", "url": "https://github.com/apache/cloudstack/pull/4145#discussion_r439999565", "bodyText": "@davidjumani  it should be isRootAdmin instead of isAdmin", "author": "weizhouapache", "createdAt": "2020-06-15T08:07:21Z", "path": "server/src/main/java/com/cloud/api/query/QueryManagerImpl.java", "diffHunk": "@@ -781,7 +781,8 @@\n         Pair<List<UserVmJoinVO>, Integer> result = searchForUserVMsInternal(cmd);\n         ListResponse<UserVmResponse> response = new ListResponse<UserVmResponse>();\n         ResponseView respView = ResponseView.Restricted;\n-        if (cmd instanceof ListVMsCmdByAdmin) {\n+        Account caller = CallContext.current().getCallingAccount();\n+        if (_accountMgr.isAdmin(caller.getId())) {", "originalCommit": "902755cd02f731a13439bb5716a06a7a7d2908cb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA1MjU0OA==", "url": "https://github.com/apache/cloudstack/pull/4145#discussion_r440052548", "bodyText": "@weizhouapache Does it detect ListVMsCmd as ListVMsCmdByAdmin for a regular admin ?", "author": "davidjumani", "createdAt": "2020-06-15T09:38:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTk5OTU2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU3ODQ4Mg==", "url": "https://github.com/apache/cloudstack/pull/4145#discussion_r440578482", "bodyText": "@davidjumani yes, root admin. Check if isAdmin checks for only root admin, or would it pass for domain admin. The fix needed here is to check if caller is a root admin.", "author": "rhtyd", "createdAt": "2020-06-16T04:25:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTk5OTU2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU3OTMxOA==", "url": "https://github.com/apache/cloudstack/pull/4145#discussion_r440579318", "bodyText": "Nevermind, I checked and made that fix.", "author": "rhtyd", "createdAt": "2020-06-16T04:29:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTk5OTU2NQ=="}], "type": "inlineReview"}, {"oid": "a0d194ee0036c16a333b0678027c71b0c246ed95", "url": "https://github.com/apache/cloudstack/commit/a0d194ee0036c16a333b0678027c71b0c246ed95", "message": "Update QueryManagerImpl.java", "committedDate": "2020-06-16T04:28:40Z", "type": "commit"}, {"oid": "cab6a07325b99a063c36156edf3f64db98ccefba", "url": "https://github.com/apache/cloudstack/commit/cab6a07325b99a063c36156edf3f64db98ccefba", "message": "clusterid/pod/storage pool etc should not be returned to domain admin", "committedDate": "2020-06-16T04:35:28Z", "type": "commit"}]}