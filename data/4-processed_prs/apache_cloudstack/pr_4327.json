{"pr_number": 4327, "pr_title": "Re-enable IP address usage hiding", "pr_createdAt": "2020-09-14T16:11:14Z", "pr_url": "https://github.com/apache/cloudstack/pull/4327", "timeline": [{"oid": "a28dad560f96e87bddb0b57d2e19fd058ac9eff1", "url": "https://github.com/apache/cloudstack/commit/a28dad560f96e87bddb0b57d2e19fd058ac9eff1", "message": "Merge branch 'master' into hide_ip_address_usages", "committedDate": "2020-09-24T14:05:29Z", "type": "forcePushed"}, {"oid": "dfa2184f8407176647db6fa9b9fb706a931dae93", "url": "https://github.com/apache/cloudstack/commit/dfa2184f8407176647db6fa9b9fb706a931dae93", "message": "network: Re-enable IP address usage hiding\n\nWith this commit, listUsageRecords filters out usages made on\nIP addresses on networks with \"Hide IP Address Usage\". This was\npreviously introduced in #3235.\n\nThis requires a DB schema change, to introduce a flag is_hidden\nin table cloud_usage.cloud_usage.", "committedDate": "2020-10-30T10:51:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY0MTQ4MA==", "url": "https://github.com/apache/cloudstack/pull/4327#discussion_r518641480", "bodyText": "if it shouldn't happen, isn't it really an exception?", "author": "DaanHoogland", "createdAt": "2020-11-06T09:55:30Z", "path": "server/src/main/java/com/cloud/network/IpAddressManagerImpl.java", "diffHunk": "@@ -2238,4 +2245,18 @@ public boolean isIpEqualsGatewayOrNetworkOfferingsEmpty(Network network, String\n         }\n         return false;\n     }\n+\n+    @Override\n+    public boolean isUsageHidden(IPAddressVO ip) {\n+        Long networkId = ip.getAssociatedWithNetworkId();\n+        if (networkId == null) {\n+            networkId = ip.getSourceNetworkId();\n+        }\n+        if (networkId == null) {\n+            // Should not happen", "originalCommit": "dfa2184f8407176647db6fa9b9fb706a931dae93", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY2MzMyNA==", "url": "https://github.com/apache/cloudstack/pull/4327#discussion_r518663324", "bodyText": "@DaanHoogland You're right, I could certainly return a CloudRuntimeException.", "author": "olivierlemasle", "createdAt": "2020-11-06T10:35:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY0MTQ4MA=="}], "type": "inlineReview"}, {"oid": "db65fbdc36180d45a1e0705b7848be1dc99c0431", "url": "https://github.com/apache/cloudstack/commit/db65fbdc36180d45a1e0705b7848be1dc99c0431", "message": "network: Re-enable IP address usage hiding\n\nWith this commit, listUsageRecords filters out usages made on\nIP addresses on networks with \"Hide IP Address Usage\". This was\npreviously introduced in #3235.\n\nThis requires a DB schema change, to introduce a flag is_hidden\nin table cloud_usage.cloud_usage.", "committedDate": "2020-11-06T10:44:43Z", "type": "commit"}, {"oid": "db65fbdc36180d45a1e0705b7848be1dc99c0431", "url": "https://github.com/apache/cloudstack/commit/db65fbdc36180d45a1e0705b7848be1dc99c0431", "message": "network: Re-enable IP address usage hiding\n\nWith this commit, listUsageRecords filters out usages made on\nIP addresses on networks with \"Hide IP Address Usage\". This was\npreviously introduced in #3235.\n\nThis requires a DB schema change, to introduce a flag is_hidden\nin table cloud_usage.cloud_usage.", "committedDate": "2020-11-06T10:44:43Z", "type": "forcePushed"}]}