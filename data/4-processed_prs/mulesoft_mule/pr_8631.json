{"pr_number": 8631, "pr_title": "MULE-18030: Update policy aware attributes on policy change fix", "pr_createdAt": "2020-02-06T11:54:52Z", "pr_url": "https://github.com/mulesoft/mule/pull/8631", "timeline": [{"oid": "53a75cf9ac663fc6d6583740016e32c0acb42d43", "url": "https://github.com/mulesoft/mule/commit/53a75cf9ac663fc6d6583740016e32c0acb42d43", "message": "MULE-18030: Update policy aware attributes on policy change fix", "committedDate": "2020-02-06T11:50:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTgxOTgyNw==", "url": "https://github.com/mulesoft/mule/pull/8631#discussion_r375819827", "bodyText": "nice :)", "author": "elrodro83", "createdAt": "2020-02-06T13:01:37Z", "path": "modules/deployment-model-impl/src/main/java/org/mule/runtime/module/deployment/impl/internal/application/MuleApplicationPolicyProvider.java", "diffHunk": "@@ -148,13 +150,18 @@ public synchronized boolean isPoliciesAvailable() {\n \n   @Override\n   public void onPoliciesChanged(Runnable policiesChangedCallback) {\n-    this.policiesChangedCallback = policiesChangedCallback;\n+    this.policiesChangedCallback = () -> {\n+      policiesChangedCallback.run();\n+      updatePolicyAwareAttributes();\n+    };\n+  }\n \n-    sourcePolicyAwareAtributes = registeredPolicyInstanceProviders.stream()\n+  private void updatePolicyAwareAttributes() {\n+    sourcePolicyAwareAttributes = registeredPolicyInstanceProviders.stream()\n         .map(pip -> pip.getApplicationPolicyInstance().getPointcut())\n         .flatMap(pointcut -> (pointcut instanceof AttributeAwarePointcut)\n             ? ((AttributeAwarePointcut) pointcut).sourcePolicyAwareAttributes().stream()\n-            : Collections.<PolicyAwareAttribute>emptySet().stream())\n+            : Stream.empty())", "originalCommit": "53a75cf9ac663fc6d6583740016e32c0acb42d43", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "343a4dee312ff1399642755b18ba3baae19fa766", "url": "https://github.com/mulesoft/mule/commit/343a4dee312ff1399642755b18ba3baae19fa766", "message": "sonar", "committedDate": "2020-02-06T13:32:38Z", "type": "commit"}]}