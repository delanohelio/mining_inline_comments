{"pr_number": 9859, "pr_title": "MULE-19055: SampleDataProvider validator is not validating generic", "pr_createdAt": "2020-12-15T18:06:22Z", "pr_url": "https://github.com/mulesoft/mule/pull/9859", "timeline": [{"oid": "981243febff6d393e6b94647f5c4194c72d9281b", "url": "https://github.com/mulesoft/mule/commit/981243febff6d393e6b94647f5c4194c72d9281b", "message": "MULE-19055: SampleDataProvider validator is not validating generic", "committedDate": "2020-12-15T18:04:37Z", "type": "commit"}, {"oid": "32865af933d5fc68b21610cf1e77205403400331", "url": "https://github.com/mulesoft/mule/commit/32865af933d5fc68b21610cf1e77205403400331", "message": "bug fixes", "committedDate": "2020-12-15T21:27:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI3MTI4MA==", "url": "https://github.com/mulesoft/mule/pull/9859#discussion_r544271280", "bodyText": "Maybe when the type is null, and is the generic of the SampleDataProvider, we should add an error that states that the SampleDataProviderGenerics must be explicit.", "author": "ndinu", "createdAt": "2020-12-16T12:48:09Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/loader/validation/SampleDataModelValidator.java", "diffHunk": "@@ -144,6 +157,38 @@ private void validateResolver(ConnectableComponentModel model,\n     }\n   }\n \n+  private void validateGenerics(ConnectableComponentModel model, ProblemsReporter problemsReporter,\n+                                Class<? extends SampleDataProvider> providerClass) {\n+    String providerGenerics = asGenericSignature(getInterfaceGenerics(providerClass, SampleDataProvider.class));\n+    String outputGenerics = asGenericSignature(getOutputTypes(model, providerClass.getClassLoader()));\n+\n+    if (!Objects.equals(providerGenerics, outputGenerics)) {\n+      problemsReporter.addError(new Problem(model, format(\n+                                                          \"SampleDataProvider [%s] was expecting to define '%s' generics signature but '%s' was found instead\",\n+                                                          providerClass.getName(), outputGenerics, providerGenerics)));\n+    }\n+  }\n+\n+  private List<Type> getOutputTypes(ConnectableComponentModel model, ClassLoader classLoader) {\n+    return asList(JavaTypeUtils.getType(model.getOutput().getType(), classLoader),\n+                  JavaTypeUtils.getType(model.getOutputAttributes().getType(), classLoader));\n+  }\n+\n+  private String asGenericSignature(List<Type> types) {\n+    return \"<\" + types.stream()\n+        .map(this::asString)\n+        .collect(joining(\",\")) + \">\";\n+  }\n+\n+  private String asString(Type type) {\n+    if (type instanceof ParameterizedTypeImpl) {\n+      ParameterizedTypeImpl parameterizedType = (ParameterizedTypeImpl) type;\n+      return parameterizedType.getRawType().getName() + asGenericSignature(asList(parameterizedType.getActualTypeArguments()));\n+    } else {\n+      return type != null ? type.getTypeName() : Object.class.getName();", "originalCommit": "32865af933d5fc68b21610cf1e77205403400331", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTIyMDE0Mw==", "url": "https://github.com/mulesoft/mule/pull/9859#discussion_r545220143", "bodyText": "This is for cases in which one of the provider's generic types is a Map or some other parameterized type where we cannot take it upon ourselves to demand proper use of those clases", "author": "marianogonzalez", "createdAt": "2020-12-17T16:21:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI3MTI4MA=="}], "type": "inlineReview"}, {"oid": "2693efb21f443e9193eeecffb8c866f73c343ee8", "url": "https://github.com/mulesoft/mule/commit/2693efb21f443e9193eeecffb8c866f73c343ee8", "message": "bug fix", "committedDate": "2020-12-17T18:25:35Z", "type": "commit"}]}