{"pr_number": 9338, "pr_title": "MULE-18655: Decorate source response streams with data flow statistic\u2026", "pr_createdAt": "2020-09-02T01:27:42Z", "pr_url": "https://github.com/mulesoft/mule/pull/9338", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA3MjQ3MQ==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r482072471", "bodyText": "this case must account PagingProviders rather than iterators? please check with the sdk guys", "author": "elrodro83", "createdAt": "2020-09-02T13:34:11Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/source/DefaultSourceCallback.java", "diffHunk": "@@ -249,14 +252,50 @@ public void handle(Result<T, A> result, SourceCallbackContext context) {\n                                                                                      encodingParam,\n                                                                                      mimeTypeInitParam);\n \n+    T resultValue = result.getOutput();\n+\n+    Result<?, ?> decoratedResult = result;\n+\n+    if (resultValue instanceof InputStream) {\n+      decoratedResult = decorateInputStream(result, context);\n+    } else if (resultValue instanceof Iterator) {", "originalCommit": "02451804e76d185619211c56b55d16e98ef0ab71", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQwMzcwMg==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r483403702", "bodyText": "PagingProviders apply to operations.", "author": "fsgonz", "createdAt": "2020-09-04T05:59:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA3MjQ3MQ=="}], "type": "inlineReview"}, {"oid": "8b318b5334045db6cd9ffb19498df179500ebb65", "url": "https://github.com/mulesoft/mule/commit/8b318b5334045db6cd9ffb19498df179500ebb65", "message": "MULE-18655: Review.", "committedDate": "2020-09-03T17:59:14Z", "type": "forcePushed"}, {"oid": "fe027597736a93d45b59a850b22814a3c1288133", "url": "https://github.com/mulesoft/mule/commit/fe027597736a93d45b59a850b22814a3c1288133", "message": "wip", "committedDate": "2020-09-07T13:03:46Z", "type": "commit"}, {"oid": "c09a20c20a3d1557bd635d8030d1128390fe6f82", "url": "https://github.com/mulesoft/mule/commit/c09a20c20a3d1557bd635d8030d1128390fe6f82", "message": "MULE-18655: Decorate source response streams with data flow statistics decorator", "committedDate": "2020-09-07T13:03:46Z", "type": "commit"}, {"oid": "f2f6179ebf5e08a68e74defebecc9069c69a3595", "url": "https://github.com/mulesoft/mule/commit/f2f6179ebf5e08a68e74defebecc9069c69a3595", "message": "MULE-18655: Review.", "committedDate": "2020-09-07T13:03:46Z", "type": "commit"}, {"oid": "25516f1a549f402036eb4dfd98dec772a33eddac", "url": "https://github.com/mulesoft/mule/commit/25516f1a549f402036eb4dfd98dec772a33eddac", "message": "MULE-18655: New xsd for marvel.xsd and marvel.json.", "committedDate": "2020-09-07T13:03:46Z", "type": "commit"}, {"oid": "4263614651470378b562b346487bca4b37740c43", "url": "https://github.com/mulesoft/mule/commit/4263614651470378b562b346487bca4b37740c43", "message": "wip", "committedDate": "2020-09-07T13:03:46Z", "type": "commit"}, {"oid": "c647878097650a873e9d4d2c24f1bb66a4e3cfc5", "url": "https://github.com/mulesoft/mule/commit/c647878097650a873e9d4d2c24f1bb66a4e3cfc5", "message": "Refactor", "committedDate": "2020-09-07T13:03:46Z", "type": "commit"}, {"oid": "ab16727457fa780cfbfe0ee9c3625dd9dfe6baf3", "url": "https://github.com/mulesoft/mule/commit/ab16727457fa780cfbfe0ee9c3625dd9dfe6baf3", "message": "revert", "committedDate": "2020-09-07T13:03:46Z", "type": "commit"}, {"oid": "95c77f0909322fb965228380b0dc4f04175b1ffd", "url": "https://github.com/mulesoft/mule/commit/95c77f0909322fb965228380b0dc4f04175b1ffd", "message": "propagate cursor provider to source", "committedDate": "2020-09-07T13:03:46Z", "type": "commit"}, {"oid": "238bdcf754827bc847c8835d1be7d4b673107704", "url": "https://github.com/mulesoft/mule/commit/238bdcf754827bc847c8835d1be7d4b673107704", "message": "propagate cursor provider to source", "committedDate": "2020-09-07T13:03:46Z", "type": "commit"}, {"oid": "58d9daef0db151d19ae5b21b9541fb0e96ff201c", "url": "https://github.com/mulesoft/mule/commit/58d9daef0db151d19ae5b21b9541fb0e96ff201c", "message": "Review", "committedDate": "2020-09-07T13:03:46Z", "type": "commit"}, {"oid": "ed50dacca1da6b556b96ac648c2d9388b1350ca7", "url": "https://github.com/mulesoft/mule/commit/ed50dacca1da6b556b96ac648c2d9388b1350ca7", "message": "Review", "committedDate": "2020-09-07T13:03:46Z", "type": "commit"}, {"oid": "64a644ae12d62a6007bb2cd33adb518b7338c1f8", "url": "https://github.com/mulesoft/mule/commit/64a644ae12d62a6007bb2cd33adb518b7338c1f8", "message": "REview", "committedDate": "2020-09-07T13:03:46Z", "type": "commit"}, {"oid": "8f5b4c9d1521222d63afd106c081460b353e8ab5", "url": "https://github.com/mulesoft/mule/commit/8f5b4c9d1521222d63afd106c081460b353e8ab5", "message": "Move classes.", "committedDate": "2020-09-07T13:03:46Z", "type": "commit"}, {"oid": "bd8c602da26679d722a149bdefc9986b78dfb071", "url": "https://github.com/mulesoft/mule/commit/bd8c602da26679d722a149bdefc9986b78dfb071", "message": "Move classes.", "committedDate": "2020-09-07T13:03:46Z", "type": "commit"}, {"oid": "3e01fdd3aa30002f1f78dbf6b9f2c1853dc907d3", "url": "https://github.com/mulesoft/mule/commit/3e01fdd3aa30002f1f78dbf6b9f2c1853dc907d3", "message": "resolve cursors back to original settings.", "committedDate": "2020-09-07T13:03:46Z", "type": "commit"}, {"oid": "3e01fdd3aa30002f1f78dbf6b9f2c1853dc907d3", "url": "https://github.com/mulesoft/mule/commit/3e01fdd3aa30002f1f78dbf6b9f2c1853dc907d3", "message": "resolve cursors back to original settings.", "committedDate": "2020-09-07T13:03:46Z", "type": "forcePushed"}, {"oid": "5a5fe4d4ba14db9e1efb13df9ca915e0e4a9932f", "url": "https://github.com/mulesoft/mule/commit/5a5fe4d4ba14db9e1efb13df9ca915e0e4a9932f", "message": "Decoration of provider.", "committedDate": "2020-09-07T20:07:39Z", "type": "commit"}, {"oid": "c7025f78676926a79d572b64bfde1cc5ebbe70ab", "url": "https://github.com/mulesoft/mule/commit/c7025f78676926a79d572b64bfde1cc5ebbe70ab", "message": "Self review.", "committedDate": "2020-09-07T20:11:11Z", "type": "commit"}, {"oid": "b36b7c1b90bbeacf37ef6c2922aedb42d8fb9282", "url": "https://github.com/mulesoft/mule/commit/b36b7c1b90bbeacf37ef6c2922aedb42d8fb9282", "message": "Self review.", "committedDate": "2020-09-07T20:22:00Z", "type": "commit"}, {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3", "url": "https://github.com/mulesoft/mule/commit/9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3", "message": "Self review.", "committedDate": "2020-09-07T20:23:07Z", "type": "commit"}, {"oid": "a54bb398381a415a6fe8ef688d13a14ecc56a2ab", "url": "https://github.com/mulesoft/mule/commit/a54bb398381a415a6fe8ef688d13a14ecc56a2ab", "message": "Self review", "committedDate": "2020-09-07T20:39:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTEzOQ==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484561139", "bodyText": "why is this case different to the one with InputSream?", "author": "elrodro83", "createdAt": "2020-09-07T20:29:21Z", "path": "core/src/main/java/org/mule/runtime/core/api/management/stats/CursorComponentDecoratorFactory.java", "diffHunk": "@@ -67,6 +68,18 @@\n    */\n   InputStream decorateInput(InputStream decorated, String correlationId);\n \n+  /**\n+   * If statistics are enabled, decorates the provided {@link CursorStream}.\n+   * <p>\n+   * Ref: {@link PayloadStatistics#getInputByteCount()}.\n+   *\n+   * @param decorated the {@link CursorStream} to decorate.\n+   * @param correlationId information to be used in the case a detailed report needs to be obtained, allowing to match the\n+   *        measured volume to a specific execution.\n+   * @return the decorated {@link CursorStream}.\n+   */\n+  CursorStream decorateInput(CursorStream decorated, String correlationId);", "originalCommit": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2NzgwNQ==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484567805", "bodyText": "When I want to decorate a CursorProvider on openCursor I need a CursorStream as a result. PayloadStatisticsInputStream extends InputStream, not CursorStream.\nThis is the wrapper for CursorStreamProvider which returns decorated cursors:\nhttps://github.com/mulesoft/mule/pull/9338/files#diff-90fb1d0f6ef60883cd38dbf9b5bc8161R32", "author": "fsgonz", "createdAt": "2020-09-07T21:12:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTEzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTM2MA==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484561360", "bodyText": "this is not used", "author": "elrodro83", "createdAt": "2020-09-07T20:30:42Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/InputDecoratorVisitor.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+import org.mule.runtime.core.api.management.stats.CursorComponentDecoratorFactory;\n+\n+/**\n+ * Visitor that returns a decorator for input statistics.\n+ * \n+ * @since 4.4, 4.3.1\n+ */\n+public class InputDecoratorVisitor implements Visitor {\n+\n+  private final CursorComponentDecoratorFactory decoratorFactory;\n+  private final String correlationId;\n+  private boolean decorateInputStreams = true;\n+  private boolean decorateIterators = true;\n+  private boolean decorateCollections = true;\n+  private boolean decorateCursorProviders = true;\n+\n+  private InputDecoratorVisitor(CursorComponentDecoratorFactory decoratorFactory,\n+                                String correlationId,\n+                                boolean decorateInputStreams,\n+                                boolean decorateIterators,\n+                                boolean decorateCollections,\n+                                boolean decorateCursorProviders) {\n+    this.decoratorFactory = decoratorFactory;\n+    this.correlationId = correlationId;\n+    this.decorateInputStreams = decorateInputStreams;\n+    this.decorateIterators = decorateIterators;\n+    this.decorateCollections = decorateCollections;\n+    this.decorateCursorProviders = decorateCursorProviders;\n+  }\n+\n+  @Override\n+  public InputStream visitInputStream(VisitableInputStream visitable) {\n+    if (decorateInputStreams) {\n+      return decoratorFactory.decorateInput(visitable, correlationId);\n+    } else {\n+      return visitable.getDelegate();\n+    }\n+  }\n+\n+  @Override\n+  public Iterator visitIterator(VisitableIterator visitable) {\n+    if (decorateIterators) {\n+      return decoratorFactory.decorateInput(visitable.getDelegate(), correlationId);\n+    } else {\n+      return visitable.getDelegate();\n+    }\n+  }\n+\n+  @Override\n+  public Collection visitCollection(VisitableCollection visitable) {\n+    if (decorateCollections) {\n+      return decoratorFactory.decorateInput(visitable.getDelegate(), correlationId);\n+    } else {\n+      return visitable.getDelegate();\n+    }\n+  }\n+\n+  @Override\n+  public List visitList(VisitableList visitableList) {\n+    if (decorateCollections) {\n+      return (List) decoratorFactory.decorateInput(visitableList, correlationId);\n+    }\n+    return visitableList.getDelegate();\n+  }\n+\n+  @Override\n+  public Set visitSet(VisitableSet visitableSet) {\n+    if (decorateCollections) {\n+      return (Set) decoratorFactory.decorateInput(visitableSet, correlationId);\n+    }\n+    return visitableSet.getDelegate();\n+  }\n+\n+\n+  @Override\n+  public CursorStreamProvider visitCursorStreamProvider(VisitableCursorStreamProvider cursorStreamProvider) {\n+    if (decorateCursorProviders) {\n+      return new InputDecoratedCursorStreamProvider(cursorStreamProvider.getDelegate(), decoratorFactory, correlationId);\n+    }\n+\n+    return cursorStreamProvider.getDelegate();\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  public static class Builder {\n+\n+    private boolean decorateCollections = true;\n+    private boolean decorateIterators = true;\n+    private boolean decorateInputStreams = true;\n+    private boolean decorateCursorProviders = true;\n+\n+    private CursorComponentDecoratorFactory factory;\n+    private String correlationId;\n+\n+    private Builder() {}\n+\n+    public Builder decorateCollections(boolean decorateCollections) {", "originalCommit": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTM2OA==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484561368", "bodyText": "this is not used", "author": "elrodro83", "createdAt": "2020-09-07T20:30:48Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/InputDecoratorVisitor.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+import org.mule.runtime.core.api.management.stats.CursorComponentDecoratorFactory;\n+\n+/**\n+ * Visitor that returns a decorator for input statistics.\n+ * \n+ * @since 4.4, 4.3.1\n+ */\n+public class InputDecoratorVisitor implements Visitor {\n+\n+  private final CursorComponentDecoratorFactory decoratorFactory;\n+  private final String correlationId;\n+  private boolean decorateInputStreams = true;\n+  private boolean decorateIterators = true;\n+  private boolean decorateCollections = true;\n+  private boolean decorateCursorProviders = true;\n+\n+  private InputDecoratorVisitor(CursorComponentDecoratorFactory decoratorFactory,\n+                                String correlationId,\n+                                boolean decorateInputStreams,\n+                                boolean decorateIterators,\n+                                boolean decorateCollections,\n+                                boolean decorateCursorProviders) {\n+    this.decoratorFactory = decoratorFactory;\n+    this.correlationId = correlationId;\n+    this.decorateInputStreams = decorateInputStreams;\n+    this.decorateIterators = decorateIterators;\n+    this.decorateCollections = decorateCollections;\n+    this.decorateCursorProviders = decorateCursorProviders;\n+  }\n+\n+  @Override\n+  public InputStream visitInputStream(VisitableInputStream visitable) {\n+    if (decorateInputStreams) {\n+      return decoratorFactory.decorateInput(visitable, correlationId);\n+    } else {\n+      return visitable.getDelegate();\n+    }\n+  }\n+\n+  @Override\n+  public Iterator visitIterator(VisitableIterator visitable) {\n+    if (decorateIterators) {\n+      return decoratorFactory.decorateInput(visitable.getDelegate(), correlationId);\n+    } else {\n+      return visitable.getDelegate();\n+    }\n+  }\n+\n+  @Override\n+  public Collection visitCollection(VisitableCollection visitable) {\n+    if (decorateCollections) {\n+      return decoratorFactory.decorateInput(visitable.getDelegate(), correlationId);\n+    } else {\n+      return visitable.getDelegate();\n+    }\n+  }\n+\n+  @Override\n+  public List visitList(VisitableList visitableList) {\n+    if (decorateCollections) {\n+      return (List) decoratorFactory.decorateInput(visitableList, correlationId);\n+    }\n+    return visitableList.getDelegate();\n+  }\n+\n+  @Override\n+  public Set visitSet(VisitableSet visitableSet) {\n+    if (decorateCollections) {\n+      return (Set) decoratorFactory.decorateInput(visitableSet, correlationId);\n+    }\n+    return visitableSet.getDelegate();\n+  }\n+\n+\n+  @Override\n+  public CursorStreamProvider visitCursorStreamProvider(VisitableCursorStreamProvider cursorStreamProvider) {\n+    if (decorateCursorProviders) {\n+      return new InputDecoratedCursorStreamProvider(cursorStreamProvider.getDelegate(), decoratorFactory, correlationId);\n+    }\n+\n+    return cursorStreamProvider.getDelegate();\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  public static class Builder {\n+\n+    private boolean decorateCollections = true;\n+    private boolean decorateIterators = true;\n+    private boolean decorateInputStreams = true;\n+    private boolean decorateCursorProviders = true;\n+\n+    private CursorComponentDecoratorFactory factory;\n+    private String correlationId;\n+\n+    private Builder() {}\n+\n+    public Builder decorateCollections(boolean decorateCollections) {\n+      this.decorateCollections = decorateCollections;\n+      return this;\n+    }\n+\n+    public Builder decorateIterators(boolean decorateIterators) {", "originalCommit": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTM3Nw==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484561377", "bodyText": "this is not used", "author": "elrodro83", "createdAt": "2020-09-07T20:30:50Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/InputDecoratorVisitor.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+import org.mule.runtime.core.api.management.stats.CursorComponentDecoratorFactory;\n+\n+/**\n+ * Visitor that returns a decorator for input statistics.\n+ * \n+ * @since 4.4, 4.3.1\n+ */\n+public class InputDecoratorVisitor implements Visitor {\n+\n+  private final CursorComponentDecoratorFactory decoratorFactory;\n+  private final String correlationId;\n+  private boolean decorateInputStreams = true;\n+  private boolean decorateIterators = true;\n+  private boolean decorateCollections = true;\n+  private boolean decorateCursorProviders = true;\n+\n+  private InputDecoratorVisitor(CursorComponentDecoratorFactory decoratorFactory,\n+                                String correlationId,\n+                                boolean decorateInputStreams,\n+                                boolean decorateIterators,\n+                                boolean decorateCollections,\n+                                boolean decorateCursorProviders) {\n+    this.decoratorFactory = decoratorFactory;\n+    this.correlationId = correlationId;\n+    this.decorateInputStreams = decorateInputStreams;\n+    this.decorateIterators = decorateIterators;\n+    this.decorateCollections = decorateCollections;\n+    this.decorateCursorProviders = decorateCursorProviders;\n+  }\n+\n+  @Override\n+  public InputStream visitInputStream(VisitableInputStream visitable) {\n+    if (decorateInputStreams) {\n+      return decoratorFactory.decorateInput(visitable, correlationId);\n+    } else {\n+      return visitable.getDelegate();\n+    }\n+  }\n+\n+  @Override\n+  public Iterator visitIterator(VisitableIterator visitable) {\n+    if (decorateIterators) {\n+      return decoratorFactory.decorateInput(visitable.getDelegate(), correlationId);\n+    } else {\n+      return visitable.getDelegate();\n+    }\n+  }\n+\n+  @Override\n+  public Collection visitCollection(VisitableCollection visitable) {\n+    if (decorateCollections) {\n+      return decoratorFactory.decorateInput(visitable.getDelegate(), correlationId);\n+    } else {\n+      return visitable.getDelegate();\n+    }\n+  }\n+\n+  @Override\n+  public List visitList(VisitableList visitableList) {\n+    if (decorateCollections) {\n+      return (List) decoratorFactory.decorateInput(visitableList, correlationId);\n+    }\n+    return visitableList.getDelegate();\n+  }\n+\n+  @Override\n+  public Set visitSet(VisitableSet visitableSet) {\n+    if (decorateCollections) {\n+      return (Set) decoratorFactory.decorateInput(visitableSet, correlationId);\n+    }\n+    return visitableSet.getDelegate();\n+  }\n+\n+\n+  @Override\n+  public CursorStreamProvider visitCursorStreamProvider(VisitableCursorStreamProvider cursorStreamProvider) {\n+    if (decorateCursorProviders) {\n+      return new InputDecoratedCursorStreamProvider(cursorStreamProvider.getDelegate(), decoratorFactory, correlationId);\n+    }\n+\n+    return cursorStreamProvider.getDelegate();\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  public static class Builder {\n+\n+    private boolean decorateCollections = true;\n+    private boolean decorateIterators = true;\n+    private boolean decorateInputStreams = true;\n+    private boolean decorateCursorProviders = true;\n+\n+    private CursorComponentDecoratorFactory factory;\n+    private String correlationId;\n+\n+    private Builder() {}\n+\n+    public Builder decorateCollections(boolean decorateCollections) {\n+      this.decorateCollections = decorateCollections;\n+      return this;\n+    }\n+\n+    public Builder decorateIterators(boolean decorateIterators) {\n+      this.decorateIterators = decorateIterators;\n+      return this;\n+    }\n+\n+    public Builder decorateInputStreams(boolean decorateInputStreams) {", "originalCommit": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTUwMw==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484561503", "bodyText": "remove", "author": "elrodro83", "createdAt": "2020-09-07T20:31:42Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/NoOpCursorComponentDecoratorFactory.java", "diffHunk": "@@ -67,4 +68,9 @@ public InputStream decorateOutput(InputStream decorated, String correlationId) {\n   public Iterator<Result> decorateOutputResultIterator(Iterator<Result> decorated, String correlationId) {\n     return decorated;\n   }\n+\n+  @Override\n+  public CursorStream decorateInput(CursorStream decorated, String correlationId) {", "originalCommit": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2OTI2NQ==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484569265", "bodyText": "Same commnent as above concerning CursorStream.", "author": "fsgonz", "createdAt": "2020-09-07T21:22:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTUwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTcwNg==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484561706", "bodyText": "this is not used", "author": "elrodro83", "createdAt": "2020-09-07T20:33:00Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/OutputDecoratorVisitor.java", "diffHunk": "@@ -0,0 +1,127 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+import org.mule.runtime.core.api.management.stats.CursorComponentDecoratorFactory;\n+import org.mule.runtime.core.internal.management.stats.InputDecoratorVisitor.Builder;\n+\n+/**\n+ * Visitor that returns a decorator for output statistics.\n+ * \n+ * @since 4.4, 4.3.1\n+ */\n+public class OutputDecoratorVisitor implements Visitor {\n+\n+  private final CursorComponentDecoratorFactory decoratorFactory;\n+  private final String correlationId;\n+  private boolean decorateInputStreams = true;\n+  private boolean decorateIterators = true;\n+  private boolean decorateCollections = true;\n+  private boolean decorateCursorProviders = true;\n+\n+  private OutputDecoratorVisitor(CursorComponentDecoratorFactory decoratorFactory, String correlationId,\n+                                 boolean decorateInputStreams, boolean decorateIterators, boolean decorateCollections,\n+                                 boolean decorateCursorProviders) {\n+    this.decoratorFactory = decoratorFactory;\n+    this.correlationId = correlationId;\n+    this.decorateInputStreams = decorateInputStreams;\n+    this.decorateIterators = decorateIterators;\n+    this.decorateCollections = decorateCollections;\n+    this.decorateCursorProviders = decorateCursorProviders;\n+  }\n+\n+  @Override\n+  public InputStream visitInputStream(VisitableInputStream visitable) {\n+    return decoratorFactory.decorateOutput(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public Iterator visitIterator(VisitableIterator visitable) {\n+    return decoratorFactory.decorateOutput(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public Collection visitCollection(VisitableCollection visitable) {\n+    return decoratorFactory.decorateOutputResultCollection(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public List visitList(VisitableList visitableList) {\n+    return visitableList;\n+  }\n+\n+  @Override\n+  public Set visitSet(VisitableSet visitableSet) {\n+    return visitableSet;\n+  }\n+\n+  @Override\n+  public CursorStreamProvider visitCursorStreamProvider(VisitableCursorStreamProvider visitableCursorStreamProvider) {\n+    return visitableCursorStreamProvider;\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  public static class Builder {\n+\n+    private boolean decorateCollections = true;\n+    private boolean decorateIterators = true;\n+    private boolean decorateInputStreams = true;\n+    private boolean decorateCursorProviders = true;\n+\n+    private CursorComponentDecoratorFactory factory;\n+    private String correlationId;\n+\n+    private Builder() {}\n+\n+    public Builder decorateCollections(boolean decorateCollections) {\n+      this.decorateCollections = decorateCollections;\n+      return this;\n+    }\n+\n+    public Builder decorateIterators(boolean decorateIterators) {\n+      this.decorateIterators = decorateIterators;\n+      return this;\n+    }\n+\n+    public Builder decorateInputStreams(boolean decorateInputStreams) {", "originalCommit": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTcwOQ==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484561709", "bodyText": "this is not used", "author": "elrodro83", "createdAt": "2020-09-07T20:33:03Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/OutputDecoratorVisitor.java", "diffHunk": "@@ -0,0 +1,127 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+import org.mule.runtime.core.api.management.stats.CursorComponentDecoratorFactory;\n+import org.mule.runtime.core.internal.management.stats.InputDecoratorVisitor.Builder;\n+\n+/**\n+ * Visitor that returns a decorator for output statistics.\n+ * \n+ * @since 4.4, 4.3.1\n+ */\n+public class OutputDecoratorVisitor implements Visitor {\n+\n+  private final CursorComponentDecoratorFactory decoratorFactory;\n+  private final String correlationId;\n+  private boolean decorateInputStreams = true;\n+  private boolean decorateIterators = true;\n+  private boolean decorateCollections = true;\n+  private boolean decorateCursorProviders = true;\n+\n+  private OutputDecoratorVisitor(CursorComponentDecoratorFactory decoratorFactory, String correlationId,\n+                                 boolean decorateInputStreams, boolean decorateIterators, boolean decorateCollections,\n+                                 boolean decorateCursorProviders) {\n+    this.decoratorFactory = decoratorFactory;\n+    this.correlationId = correlationId;\n+    this.decorateInputStreams = decorateInputStreams;\n+    this.decorateIterators = decorateIterators;\n+    this.decorateCollections = decorateCollections;\n+    this.decorateCursorProviders = decorateCursorProviders;\n+  }\n+\n+  @Override\n+  public InputStream visitInputStream(VisitableInputStream visitable) {\n+    return decoratorFactory.decorateOutput(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public Iterator visitIterator(VisitableIterator visitable) {\n+    return decoratorFactory.decorateOutput(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public Collection visitCollection(VisitableCollection visitable) {\n+    return decoratorFactory.decorateOutputResultCollection(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public List visitList(VisitableList visitableList) {\n+    return visitableList;\n+  }\n+\n+  @Override\n+  public Set visitSet(VisitableSet visitableSet) {\n+    return visitableSet;\n+  }\n+\n+  @Override\n+  public CursorStreamProvider visitCursorStreamProvider(VisitableCursorStreamProvider visitableCursorStreamProvider) {\n+    return visitableCursorStreamProvider;\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  public static class Builder {\n+\n+    private boolean decorateCollections = true;\n+    private boolean decorateIterators = true;\n+    private boolean decorateInputStreams = true;\n+    private boolean decorateCursorProviders = true;\n+\n+    private CursorComponentDecoratorFactory factory;\n+    private String correlationId;\n+\n+    private Builder() {}\n+\n+    public Builder decorateCollections(boolean decorateCollections) {\n+      this.decorateCollections = decorateCollections;\n+      return this;\n+    }\n+\n+    public Builder decorateIterators(boolean decorateIterators) {", "originalCommit": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTcxNQ==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484561715", "bodyText": "this is not used", "author": "elrodro83", "createdAt": "2020-09-07T20:33:05Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/OutputDecoratorVisitor.java", "diffHunk": "@@ -0,0 +1,127 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+import org.mule.runtime.core.api.management.stats.CursorComponentDecoratorFactory;\n+import org.mule.runtime.core.internal.management.stats.InputDecoratorVisitor.Builder;\n+\n+/**\n+ * Visitor that returns a decorator for output statistics.\n+ * \n+ * @since 4.4, 4.3.1\n+ */\n+public class OutputDecoratorVisitor implements Visitor {\n+\n+  private final CursorComponentDecoratorFactory decoratorFactory;\n+  private final String correlationId;\n+  private boolean decorateInputStreams = true;\n+  private boolean decorateIterators = true;\n+  private boolean decorateCollections = true;\n+  private boolean decorateCursorProviders = true;\n+\n+  private OutputDecoratorVisitor(CursorComponentDecoratorFactory decoratorFactory, String correlationId,\n+                                 boolean decorateInputStreams, boolean decorateIterators, boolean decorateCollections,\n+                                 boolean decorateCursorProviders) {\n+    this.decoratorFactory = decoratorFactory;\n+    this.correlationId = correlationId;\n+    this.decorateInputStreams = decorateInputStreams;\n+    this.decorateIterators = decorateIterators;\n+    this.decorateCollections = decorateCollections;\n+    this.decorateCursorProviders = decorateCursorProviders;\n+  }\n+\n+  @Override\n+  public InputStream visitInputStream(VisitableInputStream visitable) {\n+    return decoratorFactory.decorateOutput(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public Iterator visitIterator(VisitableIterator visitable) {\n+    return decoratorFactory.decorateOutput(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public Collection visitCollection(VisitableCollection visitable) {\n+    return decoratorFactory.decorateOutputResultCollection(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public List visitList(VisitableList visitableList) {\n+    return visitableList;\n+  }\n+\n+  @Override\n+  public Set visitSet(VisitableSet visitableSet) {\n+    return visitableSet;\n+  }\n+\n+  @Override\n+  public CursorStreamProvider visitCursorStreamProvider(VisitableCursorStreamProvider visitableCursorStreamProvider) {\n+    return visitableCursorStreamProvider;\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  public static class Builder {\n+\n+    private boolean decorateCollections = true;\n+    private boolean decorateIterators = true;\n+    private boolean decorateInputStreams = true;\n+    private boolean decorateCursorProviders = true;\n+\n+    private CursorComponentDecoratorFactory factory;\n+    private String correlationId;\n+\n+    private Builder() {}\n+\n+    public Builder decorateCollections(boolean decorateCollections) {", "originalCommit": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTc4MQ==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484561781", "bodyText": "where is this class?", "author": "elrodro83", "createdAt": "2020-09-07T20:33:30Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/PayloadStatisticsCursorComponentDecoratorFactory.java", "diffHunk": "@@ -145,4 +146,13 @@ private Object decorateOutput(Object decorated, String correlationId) {\n     }\n   }\n \n+  @Override\n+  public CursorStream decorateInput(CursorStream decorated, String correlationId) {\n+    if (payloadStatistics.isEnabled()) {\n+      return new PayloadStatisticsCursorStream(decorated, payloadStatistics::addInputByteCount);", "originalCommit": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2OTMxMA==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484569310", "bodyText": "Already pushed (not originally)", "author": "fsgonz", "createdAt": "2020-09-07T21:23:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTc4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MjUzNA==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484562534", "bodyText": "put all visitor stuff in its own subpackage", "author": "elrodro83", "createdAt": "2020-09-07T20:38:01Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/VisitableCollection.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.util.Collection;\n+import java.util.Iterator;\n+\n+/**\n+ * A collection that can be visit to be decorated.\n+ *\n+ * @since 4.4, 4.3.1\n+ */\n+public class VisitableCollection implements Visitable<Collection>, Collection {", "originalCommit": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MjYxOA==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484562618", "bodyText": "this may need to implement HasSize", "author": "elrodro83", "createdAt": "2020-09-07T20:38:42Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/VisitableIterator.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.util.Iterator;\n+\n+/**\n+ * An iterator that can be visit to decorate.\n+ *\n+ * @since 4.4, 4.3.1\n+ */\n+public class VisitableIterator implements Iterator, Visitable<Iterator> {", "originalCommit": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MjcwMA==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484562700", "bodyText": "add generics to signature", "author": "elrodro83", "createdAt": "2020-09-07T20:39:13Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/Visitor.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+\n+/**\n+ * Visitor that returns an instance as a result of an operation on the visited element.\n+ */\n+public interface Visitor {\n+\n+  /**\n+   * @param visitable a visitable inputstream\n+   * @return result of the inputstream which has been visited\n+   */\n+  InputStream visitInputStream(VisitableInputStream visitable);\n+\n+  /**\n+   * @param visitable a visitable iterator\n+   * @return result of the iterator which has been visited\n+   */\n+  Iterator visitIterator(VisitableIterator visible);", "originalCommit": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MjcwNQ==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484562705", "bodyText": "add generics to signature", "author": "elrodro83", "createdAt": "2020-09-07T20:39:16Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/Visitor.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+\n+/**\n+ * Visitor that returns an instance as a result of an operation on the visited element.\n+ */\n+public interface Visitor {\n+\n+  /**\n+   * @param visitable a visitable inputstream\n+   * @return result of the inputstream which has been visited\n+   */\n+  InputStream visitInputStream(VisitableInputStream visitable);\n+\n+  /**\n+   * @param visitable a visitable iterator\n+   * @return result of the iterator which has been visited\n+   */\n+  Iterator visitIterator(VisitableIterator visible);\n+\n+  /**\n+   * @param visitable a visitable collection\n+   * @return result of the collection which has been visited\n+   */\n+  Collection visitCollection(VisitableCollection visitable);", "originalCommit": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MjczNQ==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484562735", "bodyText": "add generics to signature", "author": "elrodro83", "createdAt": "2020-09-07T20:39:25Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/Visitor.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+\n+/**\n+ * Visitor that returns an instance as a result of an operation on the visited element.\n+ */\n+public interface Visitor {\n+\n+  /**\n+   * @param visitable a visitable inputstream\n+   * @return result of the inputstream which has been visited\n+   */\n+  InputStream visitInputStream(VisitableInputStream visitable);\n+\n+  /**\n+   * @param visitable a visitable iterator\n+   * @return result of the iterator which has been visited\n+   */\n+  Iterator visitIterator(VisitableIterator visible);\n+\n+  /**\n+   * @param visitable a visitable collection\n+   * @return result of the collection which has been visited\n+   */\n+  Collection visitCollection(VisitableCollection visitable);\n+\n+  /**\n+   * @param visitable a visitable list\n+   * @return result of the list which has been visited\n+   */\n+  List visitList(VisitableList visitableList);", "originalCommit": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2Mjc1NA==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484562754", "bodyText": "add generics to signature", "author": "elrodro83", "createdAt": "2020-09-07T20:39:34Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/Visitor.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+\n+/**\n+ * Visitor that returns an instance as a result of an operation on the visited element.\n+ */\n+public interface Visitor {\n+\n+  /**\n+   * @param visitable a visitable inputstream\n+   * @return result of the inputstream which has been visited\n+   */\n+  InputStream visitInputStream(VisitableInputStream visitable);\n+\n+  /**\n+   * @param visitable a visitable iterator\n+   * @return result of the iterator which has been visited\n+   */\n+  Iterator visitIterator(VisitableIterator visible);\n+\n+  /**\n+   * @param visitable a visitable collection\n+   * @return result of the collection which has been visited\n+   */\n+  Collection visitCollection(VisitableCollection visitable);\n+\n+  /**\n+   * @param visitable a visitable list\n+   * @return result of the list which has been visited\n+   */\n+  List visitList(VisitableList visitableList);\n+\n+  /**\n+   * @param visitable a visitable set\n+   * @return result of the set which has been visited\n+   */\n+  Set visitSet(VisitableSet visitableSet);", "originalCommit": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2Mjk0OA==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484562948", "bodyText": "avoid return for one-line lambdas", "author": "elrodro83", "createdAt": "2020-09-07T20:40:39Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/objectbuilder/DefaultObjectBuilder.java", "diffHunk": "@@ -127,27 +128,23 @@ public T build(ValueResolvingContext context) throws MuleException {\n \n     for (Map.Entry<FieldSetter, ValueResolver<Object>> entry : resolvers.entrySet()) {\n       final Object resolvedValue = resolveValue(entry.getValue(), context);\n+      UnaryOperator decorateOperation = v -> {\n+        return visitable(v)", "originalCommit": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MzE1Mw==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484563153", "bodyText": "avoid return for one-line lambdas", "author": "elrodro83", "createdAt": "2020-09-07T20:41:51Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/objectbuilder/ParameterGroupObjectBuilder.java", "diffHunk": "@@ -113,15 +115,10 @@ private T doBuild(Predicate<String> hasParameter, Function<String, Object> param\n             .apply(name)), context);\n         Object value = context == null || context.resolveCursors()\n             ? resolveCursor(resolvedValue, isContent ? v -> {\n-              if (v instanceof InputStream) {\n-                return componentDecoratorFactory.decorateInput((InputStream) v, context.getEvent().getCorrelationId());\n-              } else if (v instanceof Collection) {\n-                return componentDecoratorFactory.decorateInput((Collection) v, context.getEvent().getCorrelationId());\n-              } else if (v instanceof Iterator) {\n-                return componentDecoratorFactory.decorateInput((Iterator) v, context.getEvent().getCorrelationId());\n-              } else {\n-                return v;\n-              }\n+              return visitable(v).map(visitable -> visitable", "originalCommit": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2Mzc5NQ==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484563795", "bodyText": "remove empty line", "author": "elrodro83", "createdAt": "2020-09-07T20:46:03Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/InputDecoratedCursorStreamProvider.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStream;\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+import org.mule.runtime.core.api.management.stats.CursorComponentDecoratorFactory;\n+\n+/**\n+ * A cursor stream provider that decorates its streams\n+ *\n+ * @since 4.4, 4.3.1\n+ */\n+public class InputDecoratedCursorStreamProvider implements CursorStreamProvider {\n+\n+  private CursorStreamProvider delegate;\n+  private CursorComponentDecoratorFactory decoratorFactory;\n+  private String correlationId;\n+\n+  public InputDecoratedCursorStreamProvider(CursorStreamProvider delegate, CursorComponentDecoratorFactory decoratorFactory,\n+                                            String correlationId) {\n+    this.delegate = delegate;\n+    this.decoratorFactory = decoratorFactory;\n+    this.correlationId = correlationId;\n+  }\n+\n+  @Override\n+  public CursorStream openCursor() {\n+    return decoratorFactory.decorateInput(delegate.openCursor(), correlationId);\n+  }\n+\n+  @Override\n+  public void close() {\n+    delegate.close();\n+", "originalCommit": "a54bb398381a415a6fe8ef688d13a14ecc56a2ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2Mzc5OQ==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484563799", "bodyText": "remove empty line", "author": "elrodro83", "createdAt": "2020-09-07T20:46:06Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/InputDecoratedCursorStreamProvider.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStream;\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+import org.mule.runtime.core.api.management.stats.CursorComponentDecoratorFactory;\n+\n+/**\n+ * A cursor stream provider that decorates its streams\n+ *\n+ * @since 4.4, 4.3.1\n+ */\n+public class InputDecoratedCursorStreamProvider implements CursorStreamProvider {\n+\n+  private CursorStreamProvider delegate;\n+  private CursorComponentDecoratorFactory decoratorFactory;\n+  private String correlationId;\n+\n+  public InputDecoratedCursorStreamProvider(CursorStreamProvider delegate, CursorComponentDecoratorFactory decoratorFactory,\n+                                            String correlationId) {\n+    this.delegate = delegate;\n+    this.decoratorFactory = decoratorFactory;\n+    this.correlationId = correlationId;\n+  }\n+\n+  @Override\n+  public CursorStream openCursor() {\n+    return decoratorFactory.decorateInput(delegate.openCursor(), correlationId);\n+  }\n+\n+  @Override\n+  public void close() {\n+    delegate.close();\n+\n+  }\n+\n+  @Override\n+  public void releaseResources() {\n+    delegate.releaseResources();\n+", "originalCommit": "a54bb398381a415a6fe8ef688d13a14ecc56a2ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2Mzg4NA==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484563884", "bodyText": "why is this needed intead of using the inputstream decorator?", "author": "elrodro83", "createdAt": "2020-09-07T20:46:40Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/PayloadStatisticsCursorStream.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.IOException;\n+import java.util.function.LongConsumer;\n+\n+import org.mule.runtime.api.streaming.CursorProvider;\n+import org.mule.runtime.api.streaming.bytes.CursorStream;\n+\n+final class PayloadStatisticsCursorStream extends CursorStream {", "originalCommit": "a54bb398381a415a6fe8ef688d13a14ecc56a2ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU4MjExMA==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484582110", "bodyText": "same comment as before.", "author": "fsgonz", "createdAt": "2020-09-07T23:02:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2Mzg4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MzkzNw==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484563937", "bodyText": "remove empty line", "author": "elrodro83", "createdAt": "2020-09-07T20:46:53Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/VisitableCursorStreamProvider.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStream;\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+\n+/**\n+ * A cursor stream provider that can be visit to be decorated\n+ *\n+ * @since 4.4, 4.3.1\n+ */\n+public class VisitableCursorStreamProvider implements Visitable<CursorStreamProvider>, CursorStreamProvider {\n+\n+  private CursorStreamProvider delegate;\n+\n+  public VisitableCursorStreamProvider(CursorStreamProvider delegate) {\n+    this.delegate = delegate;\n+  }\n+\n+  @Override\n+  public CursorStream openCursor() {\n+    return null;\n+  }\n+\n+  @Override\n+  public void close() {\n+    delegate.close();\n+", "originalCommit": "a54bb398381a415a6fe8ef688d13a14ecc56a2ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2Mzk1NA==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484563954", "bodyText": "remove empty line", "author": "elrodro83", "createdAt": "2020-09-07T20:46:57Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/VisitableCursorStreamProvider.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStream;\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+\n+/**\n+ * A cursor stream provider that can be visit to be decorated\n+ *\n+ * @since 4.4, 4.3.1\n+ */\n+public class VisitableCursorStreamProvider implements Visitable<CursorStreamProvider>, CursorStreamProvider {\n+\n+  private CursorStreamProvider delegate;\n+\n+  public VisitableCursorStreamProvider(CursorStreamProvider delegate) {\n+    this.delegate = delegate;\n+  }\n+\n+  @Override\n+  public CursorStream openCursor() {\n+    return null;\n+  }\n+\n+  @Override\n+  public void close() {\n+    delegate.close();\n+\n+  }\n+\n+  @Override\n+  public void releaseResources() {\n+    delegate.releaseResources();\n+", "originalCommit": "a54bb398381a415a6fe8ef688d13a14ecc56a2ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2ODc2MQ==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484568761", "bodyText": "this should delegate instead of returning null", "author": "elrodro83", "createdAt": "2020-09-07T21:19:14Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/VisitableCursorStreamProvider.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStream;\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+\n+/**\n+ * A cursor stream provider that can be visit to be decorated\n+ *\n+ * @since 4.4, 4.3.1\n+ */\n+public class VisitableCursorStreamProvider implements Visitable<CursorStreamProvider>, CursorStreamProvider {\n+\n+  private CursorStreamProvider delegate;\n+\n+  public VisitableCursorStreamProvider(CursorStreamProvider delegate) {\n+    this.delegate = delegate;\n+  }\n+\n+  @Override\n+  public CursorStream openCursor() {\n+    return null;", "originalCommit": "a54bb398381a415a6fe8ef688d13a14ecc56a2ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2729563eba0c036b13bbae1ea533ee41f477b939", "url": "https://github.com/mulesoft/mule/commit/2729563eba0c036b13bbae1ea533ee41f477b939", "message": "Review", "committedDate": "2020-09-07T21:36:54Z", "type": "commit"}, {"oid": "bf76bb79baa6c4f253bd45e79472105d17e5d99a", "url": "https://github.com/mulesoft/mule/commit/bf76bb79baa6c4f253bd45e79472105d17e5d99a", "message": "Review", "committedDate": "2020-09-07T22:51:20Z", "type": "commit"}, {"oid": "11efb01245b511495013bad7e25e1da47e65287a", "url": "https://github.com/mulesoft/mule/commit/11efb01245b511495013bad7e25e1da47e65287a", "message": "Review", "committedDate": "2020-09-07T23:01:20Z", "type": "commit"}, {"oid": "1d518d31dd922c4613b275fc6765d32631413136", "url": "https://github.com/mulesoft/mule/commit/1d518d31dd922c4613b275fc6765d32631413136", "message": "Review", "committedDate": "2020-09-07T23:17:56Z", "type": "commit"}, {"oid": "b0ad627d329c54a2e79d8b3eda5ea083c0a03d00", "url": "https://github.com/mulesoft/mule/commit/b0ad627d329c54a2e79d8b3eda5ea083c0a03d00", "message": "Formatting", "committedDate": "2020-09-07T23:19:57Z", "type": "commit"}, {"oid": "22e43119e89c00871d07b451df05ede08d7a6e17", "url": "https://github.com/mulesoft/mule/commit/22e43119e89c00871d07b451df05ede08d7a6e17", "message": "Self review.", "committedDate": "2020-09-08T00:04:57Z", "type": "commit"}, {"oid": "9b7f0c7edd0e131dc3efd0223abe65db6331742b", "url": "https://github.com/mulesoft/mule/commit/9b7f0c7edd0e131dc3efd0223abe65db6331742b", "message": "Review.", "committedDate": "2020-09-08T00:37:06Z", "type": "commit"}, {"oid": "5fd0482cfc7b3fa7b3f6a22ca3c43fb80e60465d", "url": "https://github.com/mulesoft/mule/commit/5fd0482cfc7b3fa7b3f6a22ca3c43fb80e60465d", "message": "Review.", "committedDate": "2020-09-08T00:51:47Z", "type": "commit"}, {"oid": "5af4c7336e2e73f7f434b3840d83e9b75999fa16", "url": "https://github.com/mulesoft/mule/commit/5af4c7336e2e73f7f434b3840d83e9b75999fa16", "message": "Self review", "committedDate": "2020-09-08T00:56:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg5MzAyOQ==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484893029", "bodyText": "remove extra line", "author": "elrodro83", "createdAt": "2020-09-08T12:55:38Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/visitor/OutputDecoratorVisitor.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats.visitor;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+import org.mule.runtime.core.api.management.stats.CursorComponentDecoratorFactory;\n+\n+/**\n+ * Visitor that returns a decorator for output statistics.\n+ * \n+ * @since 4.4, 4.3.1\n+ */\n+public class OutputDecoratorVisitor<T> implements Visitor<T> {\n+\n+  private final CursorComponentDecoratorFactory decoratorFactory;\n+  private final String correlationId;\n+\n+  private OutputDecoratorVisitor(CursorComponentDecoratorFactory decoratorFactory, String correlationId) {\n+    this.decoratorFactory = decoratorFactory;\n+    this.correlationId = correlationId;\n+  }\n+\n+  @Override\n+  public InputStream visitInputStream(VisitableInputStream visitable) {\n+    return decoratorFactory.decorateOutput(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public Iterator<T> visitIterator(VisitableIterator<T> visitable) {\n+    return decoratorFactory.decorateOutput(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public Collection<T> visitCollection(VisitableCollection visitable) {\n+    return decoratorFactory.decorateOutputResultCollection(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public List<T> visitList(VisitableList<T> visitableList) {\n+    return visitableList;\n+  }\n+\n+  @Override\n+  public Set<T> visitSet(VisitableSet<T> visitableSet) {\n+    return visitableSet;\n+  }\n+\n+  @Override\n+  public CursorStreamProvider visitCursorStreamProvider(VisitableCursorStreamProvider visitableCursorStreamProvider) {\n+    return visitableCursorStreamProvider;\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  public static class Builder {\n+\n+", "originalCommit": "5af4c7336e2e73f7f434b3840d83e9b75999fa16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg5MzI1OA==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484893258", "bodyText": "remove extra lines", "author": "elrodro83", "createdAt": "2020-09-08T12:56:01Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/visitor/VisitableCollection.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats.visitor;\n+\n+import java.util.Collection;\n+import java.util.Iterator;\n+\n+/**\n+ * A collection that can be visit to be decorated.\n+ *\n+ * @since 4.4, 4.3.1\n+ */\n+public class VisitableCollection<T> implements Visitable<Collection<T>>, Collection<T> {\n+\n+  private final Collection<T> delegate;\n+\n+  public VisitableCollection(Collection<T> delegate) {\n+    this.delegate = delegate;\n+  }\n+\n+  @Override\n+  public Collection<T> accept(Visitor visitor) {\n+    return visitor.visitCollection(this);\n+  }\n+\n+  @Override\n+  public int size() {\n+    return delegate.size();\n+  }\n+\n+  @Override\n+  public boolean isEmpty() {\n+    return delegate.isEmpty();\n+  }\n+\n+  @Override\n+  public boolean contains(Object o) {\n+    return delegate.contains(o);\n+  }\n+\n+  @Override\n+  public Iterator<T> iterator() {\n+    return delegate.iterator();\n+  }\n+\n+  @Override\n+  public Object[] toArray() {\n+    return delegate.toArray();\n+  }\n+\n+  @Override\n+  public <T> T[] toArray(T[] a) {\n+    return delegate.toArray(a);\n+  }\n+\n+  @Override\n+  public boolean add(T e) {\n+    return delegate.add(e);\n+  }\n+\n+  @Override\n+  public boolean remove(Object o) {\n+    return delegate.remove(o);\n+  }\n+\n+  @Override\n+  public boolean containsAll(Collection<?> c) {\n+    return delegate.containsAll(c);\n+  }\n+\n+  @Override\n+  public boolean addAll(Collection<? extends T> c) {\n+    return delegate.addAll(c);\n+  }\n+\n+  @Override\n+  public boolean removeAll(Collection<?> c) {\n+    return delegate.removeAll(c);\n+  }\n+\n+  @Override\n+  public boolean retainAll(Collection<?> c) {\n+    return delegate.retainAll(c);\n+  }\n+\n+  @Override\n+  public void clear() {\n+    delegate.clear();\n+  }\n+\n+  @Override\n+  public Collection<T> getDelegate() {\n+    return delegate;\n+  }\n+\n+", "originalCommit": "5af4c7336e2e73f7f434b3840d83e9b75999fa16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg5MzcwNw==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484893707", "bodyText": "remove extra line", "author": "elrodro83", "createdAt": "2020-09-08T12:56:44Z", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/visitor/VisitableList.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats.visitor;\n+\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.ListIterator;\n+\n+/**\n+ * A list that can be visit to be decorated.\n+ *\n+ * @since 4.4, 4.3.1\n+ */\n+public class VisitableList<T> implements Visitable<List<T>>, List<T> {\n+\n+  private final List<T> delegate;\n+\n+  public VisitableList(List<T> delegate) {\n+    this.delegate = delegate;\n+  }\n+\n+  @Override\n+  public List<T> accept(Visitor visitor) {\n+    return visitor.visitList(this);\n+  }\n+\n+  @Override\n+  public int size() {\n+    return delegate.size();\n+  }\n+\n+  @Override\n+  public boolean isEmpty() {\n+    return delegate.isEmpty();\n+  }\n+\n+  @Override\n+  public boolean contains(Object o) {\n+    return delegate.contains(o);\n+  }\n+\n+  @Override\n+  public Iterator<T> iterator() {\n+    return delegate.iterator();\n+  }\n+\n+  @Override\n+  public Object[] toArray() {\n+    return delegate.toArray();\n+  }\n+\n+  @Override\n+  public <T> T[] toArray(T[] a) {\n+    return delegate.toArray(a);\n+  }\n+\n+  @Override\n+  public boolean add(T e) {\n+    return delegate.add(e);\n+  }\n+\n+  @Override\n+  public boolean remove(Object o) {\n+    return delegate.remove(o);\n+  }\n+\n+  @Override\n+  public boolean containsAll(Collection<?> c) {\n+    return delegate.containsAll(c);\n+  }\n+\n+  @Override\n+  public boolean addAll(Collection<? extends T> c) {\n+    return delegate.addAll(c);\n+  }\n+\n+  @Override\n+  public boolean addAll(int index, Collection<? extends T> c) {\n+    return delegate.addAll(index, c);\n+  }\n+\n+  @Override\n+  public boolean removeAll(Collection<?> c) {\n+    return delegate.removeAll(c);\n+  }\n+\n+  @Override\n+  public boolean retainAll(Collection<?> c) {\n+    return delegate.retainAll(c);\n+  }\n+\n+  @Override\n+  public void clear() {\n+    delegate.clear();\n+  }\n+\n+  @Override\n+  public T get(int index) {\n+    return delegate.get(index);\n+  }\n+\n+  @Override\n+  public T set(int index, T element) {\n+    return delegate.set(index, element);\n+  }\n+\n+  @Override\n+  public void add(int index, T element) {\n+    delegate.add(index, element);\n+  }\n+\n+  @Override\n+  public T remove(int index) {\n+    return delegate.remove(index);\n+  }\n+\n+  @Override\n+  public int indexOf(Object o) {\n+    return delegate.indexOf(o);\n+  }\n+\n+  @Override\n+  public int lastIndexOf(Object o) {\n+    return delegate.lastIndexOf(o);\n+  }\n+\n+  @Override\n+  public ListIterator<T> listIterator() {\n+    return delegate.listIterator();\n+  }\n+\n+  @Override\n+  public ListIterator<T> listIterator(int index) {\n+    return delegate.listIterator(index);\n+  }\n+\n+  @Override\n+  public List<T> subList(int fromIndex, int toIndex) {\n+    return delegate.subList(fromIndex, toIndex);\n+  }\n+\n+  @Override\n+  public List<T> getDelegate() {\n+    return delegate;\n+  }\n+", "originalCommit": "5af4c7336e2e73f7f434b3840d83e9b75999fa16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg5NDQwMw==", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484894403", "bodyText": "fix format, put the second // in a new line", "author": "elrodro83", "createdAt": "2020-09-08T12:57:47Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/resolver/ResolverUtils.java", "diffHunk": "@@ -176,7 +192,8 @@ public static Object resolveCursor(TypedValue<?> typedValue, UnaryOperator value\n       if (stackedTypesModelProperty.isPresent()) {\n         resolver = stackedTypesModelProperty.get().getValueResolverFactory().getExpressionBasedValueResolver(expression,\n                                                                                                              getType(type));\n-        //TODO MULE-13518: Add support for stacked value resolvers for @Parameter inside pojos // The following \"IFs\" should be removed once implemented\n+        // TODO MULE-13518: Add support for stacked value resolvers for @Parameter inside pojos // The following \"IFs\" should be", "originalCommit": "5af4c7336e2e73f7f434b3840d83e9b75999fa16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f304a642c1295dc38b2015195d4bc1d072d58851", "url": "https://github.com/mulesoft/mule/commit/f304a642c1295dc38b2015195d4bc1d072d58851", "message": "Review", "committedDate": "2020-09-08T13:04:12Z", "type": "commit"}, {"oid": "f2fe9b4f330dcb66d8728566358591753967c969", "url": "https://github.com/mulesoft/mule/commit/f2fe9b4f330dcb66d8728566358591753967c969", "message": "extra line", "committedDate": "2020-09-08T13:13:56Z", "type": "commit"}, {"oid": "abcceff39580ac71cb9b04ef3c93f8ed74efd220", "url": "https://github.com/mulesoft/mule/commit/abcceff39580ac71cb9b04ef3c93f8ed74efd220", "message": "Extra line", "committedDate": "2020-09-08T13:25:12Z", "type": "commit"}, {"oid": "05abee92fca0ba83a8e1bea501c324e58ac18956", "url": "https://github.com/mulesoft/mule/commit/05abee92fca0ba83a8e1bea501c324e58ac18956", "message": "Fix", "committedDate": "2020-09-08T14:18:17Z", "type": "commit"}]}