{"pr_number": 8806, "pr_title": "MULE-18310: Reduce time taken by tests - part 1", "pr_createdAt": "2020-04-16T20:41:39Z", "pr_url": "https://github.com/mulesoft/mule/pull/8806", "timeline": [{"oid": "091ccf8dc45b249bc1490bb173b940f5e0b46d55", "url": "https://github.com/mulesoft/mule/commit/091ccf8dc45b249bc1490bb173b940f5e0b46d55", "message": "MULE-18310: Reduce time taken by tests - part 1", "committedDate": "2020-04-16T20:37:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg1MTgxNg==", "url": "https://github.com/mulesoft/mule/pull/8806#discussion_r409851816", "bodyText": "this breaks the feature of changing log levels at runtime", "author": "marianogonzalez", "createdAt": "2020-04-16T21:13:23Z", "path": "modules/artifact/src/main/java/org/mule/runtime/module/artifact/api/classloader/FilteringArtifactClassLoader.java", "diffHunk": "@@ -73,6 +75,12 @@ public FilteringArtifactClassLoader(ClassLoader parent, ArtifactClassLoader arti\n     this.artifactClassLoader = artifactClassLoader;\n     this.filter = filter;\n     this.exportedServices = exportedServices;\n+\n+    verboseLogging = LOGGER.isDebugEnabled() || isVerboseLoggingEnabled();", "originalCommit": "091ccf8dc45b249bc1490bb173b940f5e0b46d55", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg1Mjc4Mw==", "url": "https://github.com/mulesoft/mule/pull/8806#discussion_r409852783", "bodyText": "I find it surprising that this moves the needle, specially since this only happens ones per MuleContext, but I choose to believe", "author": "marianogonzalez", "createdAt": "2020-04-16T21:15:18Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/execution/MethodArgumentResolverDelegate.java", "diffHunk": "@@ -192,8 +192,9 @@ private void initArgumentResolvers() {\n         argumentResolver = ERROR_ARGUMENT_RESOLVER;\n       } else if (SourceCallbackContext.class.equals(parameterType)) {\n         argumentResolver = SOURCE_CALLBACK_CONTEXT_ARGUMENT_RESOLVER;\n-      } else if (isParameterContainer(annotations.keySet(), typeLoader.load(parameterType)) &&\n-          !((ParameterGroup) annotations.get(ParameterGroup.class)).showInDsl()) {\n+      } else if (annotations.keySet().contains(ParameterGroup.class)", "originalCommit": "091ccf8dc45b249bc1490bb173b940f5e0b46d55", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE5Mzg4MA==", "url": "https://github.com/mulesoft/mule/pull/8806#discussion_r410193880", "bodyText": "it avoids calling the typeLoader.load in some cases, which may be expensive.", "author": "elrodro83", "createdAt": "2020-04-17T12:38:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg1Mjc4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg1NDI4OA==", "url": "https://github.com/mulesoft/mule/pull/8806#discussion_r409854288", "bodyText": "aren't you breaking the assertions around tasks being completed and properly disposed and other shuutdown validations with this? My feat is that we reduce execution time at the expense of no longer catching potential leaks and other herbs", "author": "marianogonzalez", "createdAt": "2020-04-16T21:18:32Z", "path": "tests/unit/src/main/java/org/mule/tck/SimpleUnitTestSupportLifecycleSchedulerDecorator.java", "diffHunk": "@@ -87,16 +88,12 @@ public void execute(Runnable command) {\n \n   @Override\n   public ScheduledFuture<?> scheduleWithCronExpression(Runnable command, String cronExpression) {\n-    ScheduledFuture<?> recurrentTask = decorated.scheduleWithCronExpression(wrap(command), cronExpression);\n-    recurrentTasks.add(recurrentTask);", "originalCommit": "091ccf8dc45b249bc1490bb173b940f5e0b46d55", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE5MzMyOA==", "url": "https://github.com/mulesoft/mule/pull/8806#discussion_r410193328", "bodyText": "no, the only code where objects of this class are being built mocks these methods, so these methods were never actually being executed.", "author": "elrodro83", "createdAt": "2020-04-17T12:37:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg1NDI4OA=="}], "type": "inlineReview"}, {"oid": "b92a18b33ba3c1c1041db949025327093aef8732", "url": "https://github.com/mulesoft/mule/commit/b92a18b33ba3c1c1041db949025327093aef8732", "message": "review", "committedDate": "2020-04-17T12:55:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIyMzQ3Ng==", "url": "https://github.com/mulesoft/mule/pull/8806#discussion_r410223476", "bodyText": "invert this for better perf", "author": "marianogonzalez", "createdAt": "2020-04-17T13:30:54Z", "path": "modules/artifact/src/main/java/org/mule/runtime/module/artifact/api/classloader/FilteringArtifactClassLoader.java", "diffHunk": "@@ -76,11 +76,11 @@ public FilteringArtifactClassLoader(ClassLoader parent, ArtifactClassLoader arti\n     this.filter = filter;\n     this.exportedServices = exportedServices;\n \n-    verboseLogging = LOGGER.isDebugEnabled() || isVerboseLoggingEnabled();\n+    verboseLogging = valueOf(getProperty(MULE_LOG_VERBOSE_CLASSLOADING));\n   }\n \n-  private boolean isVerboseLoggingEnabled() {\n-    return LOGGER.isInfoEnabled() && valueOf(getProperty(MULE_LOG_VERBOSE_CLASSLOADING));\n+  private boolean isVerboseLogging() {\n+    return LOGGER.isDebugEnabled() || verboseLogging;", "originalCommit": "b92a18b33ba3c1c1041db949025327093aef8732", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIyNDAyMw==", "url": "https://github.com/mulesoft/mule/pull/8806#discussion_r410224023", "bodyText": "this is not only repeated code, but in the original version INFO level was being used whereas now you degraded it to DEBUG", "author": "marianogonzalez", "createdAt": "2020-04-17T13:31:47Z", "path": "modules/artifact/src/main/java/org/mule/runtime/module/artifact/api/classloader/FineGrainedControlClassLoader.java", "diffHunk": "@@ -56,11 +56,11 @@ public FineGrainedControlClassLoader(URL[] urls, ClassLoader parent, ClassLoader\n     super(urls, parent, new NonCachingURLStreamHandlerFactory());\n     checkArgument(lookupPolicy != null, \"Lookup policy cannot be null\");\n     this.lookupPolicy = lookupPolicy;\n-    verboseLogging = LOGGER.isDebugEnabled() || isVerboseLoggingEnabled();\n+    verboseLogging = valueOf(getProperty(MULE_LOG_VERBOSE_CLASSLOADING));\n   }\n \n-  private boolean isVerboseLoggingEnabled() {\n-    return LOGGER.isInfoEnabled() && valueOf(getProperty(MULE_LOG_VERBOSE_CLASSLOADING));\n+  private boolean isVerboseLogging() {\n+    return LOGGER.isDebugEnabled() || verboseLogging;", "originalCommit": "b92a18b33ba3c1c1041db949025327093aef8732", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIyODkxMQ==", "url": "https://github.com/mulesoft/mule/pull/8806#discussion_r410228911", "bodyText": "nope, this is in the same place but is not the same method. This does the same evaluation that was previously done in the constructor, to account for log level changes. The repeated code you mention i think is with FilteringArtifactClassLoader. There is no common superclass between the 2 to extract this logic to, and it seems overkill to extract an utils for just 2 lines (plus i would need to pass the logger around anyway)", "author": "elrodro83", "createdAt": "2020-04-17T13:39:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIyNDAyMw=="}], "type": "inlineReview"}, {"oid": "8f6e42f38cb7bc637a17e4dc838ba27dc491a211", "url": "https://github.com/mulesoft/mule/commit/8f6e42f38cb7bc637a17e4dc838ba27dc491a211", "message": "review 2", "committedDate": "2020-04-17T13:39:40Z", "type": "commit"}, {"oid": "1c0e92c15736aa365738d5e8def81b65f6389dbe", "url": "https://github.com/mulesoft/mule/commit/1c0e92c15736aa365738d5e8def81b65f6389dbe", "message": "revert scheduler thing", "committedDate": "2020-04-20T17:16:12Z", "type": "commit"}]}