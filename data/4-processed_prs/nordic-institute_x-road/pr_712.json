{"pr_number": 712, "pr_title": "XRDDEV-1319 Permission checks", "pr_createdAt": "2020-09-15T19:28:03Z", "pr_url": "https://github.com/nordic-institute/X-Road/pull/712", "timeline": [{"oid": "3ae31123f3f51e808270a73794555106b5157cd2", "url": "https://github.com/nordic-institute/X-Road/commit/3ae31123f3f51e808270a73794555106b5157cd2", "message": "XRDDEV-1319 Fix delete client permission", "committedDate": "2020-09-11T08:50:24Z", "type": "commit"}, {"oid": "cddcfa3e7099b4383aa2e17edc61d1d2d53490cb", "url": "https://github.com/nordic-institute/X-Road/commit/cddcfa3e7099b4383aa2e17edc61d1d2d53490cb", "message": "XRDDEV-1223 Split permission view_cert into two parts: view_auth_cert and view_sign_cert. Grant view_sign_cert permission to XROAD_SERVICE_ADMINISTRATOR. Ignore frontend audit error about dtsgenerator for 24h", "committedDate": "2020-09-11T13:52:28Z", "type": "commit"}, {"oid": "d1260c0e3c7d3ed585af7b64b3f6b0f8a327d7af", "url": "https://github.com/nordic-institute/X-Road/commit/d1260c0e3c7d3ed585af7b64b3f6b0f8a327d7af", "message": "XRDDEV-1319 Update permission related comments", "committedDate": "2020-09-14T12:27:41Z", "type": "commit"}, {"oid": "9c62374951867390edaa13de18eb3533429ce153", "url": "https://github.com/nordic-institute/X-Road/commit/9c62374951867390edaa13de18eb3533429ce153", "message": "XRDDEV-1319 Change restore backup to use proper permission", "committedDate": "2020-09-15T10:53:52Z", "type": "commit"}, {"oid": "334a7fb4c824e6aef71585100be4d4aa64ff02e1", "url": "https://github.com/nordic-institute/X-Road/commit/334a7fb4c824e6aef71585100be4d4aa64ff02e1", "message": "XRDDEV-1319 Add check for EDIT_SERVICE_PARAMS permission", "committedDate": "2020-09-15T10:55:33Z", "type": "commit"}, {"oid": "f053b9959a276be031e48b75b18551349f9615a7", "url": "https://github.com/nordic-institute/X-Road/commit/f053b9959a276be031e48b75b18551349f9615a7", "message": "XRDDEV-1319 Add check for EDIT_SERVICE_ACL permission", "committedDate": "2020-09-15T11:46:50Z", "type": "commit"}, {"oid": "a974ad50b287d197867355bfb7ee62548dd5fe75", "url": "https://github.com/nordic-institute/X-Road/commit/a974ad50b287d197867355bfb7ee62548dd5fe75", "message": "XRDDEV-1319 Updates to keys & certificates permission handling", "committedDate": "2020-09-15T12:01:13Z", "type": "commit"}, {"oid": "3dcc89bf1f43d43d160b48a1ec6fdc91b0b31f73", "url": "https://github.com/nordic-institute/X-Road/commit/3dcc89bf1f43d43d160b48a1ec6fdc91b0b31f73", "message": "XRDDEV-1319 Add permission view_approved_certificate_authorities for XROAD_REGISTRATION_OFFICER role", "committedDate": "2020-09-15T12:14:24Z", "type": "commit"}, {"oid": "a5e21377636f4cfc4d1b1f8dc0b127fdb5865223", "url": "https://github.com/nordic-institute/X-Road/commit/a5e21377636f4cfc4d1b1f8dc0b127fdb5865223", "message": "XRDDEV-1319 Updates to keys & certificates permission handling", "committedDate": "2020-09-15T13:18:59Z", "type": "commit"}, {"oid": "57be0e9b10d62c1ad45dc1b9f81e2105d0af97ff", "url": "https://github.com/nordic-institute/X-Road/commit/57be0e9b10d62c1ad45dc1b9f81e2105d0af97ff", "message": "XRDDEV-1319 Update permission check in csr wizard", "committedDate": "2020-09-15T13:23:29Z", "type": "commit"}, {"oid": "243e87ece4a0d16dd3aec03f79a7fec110f9a6da", "url": "https://github.com/nordic-institute/X-Road/commit/243e87ece4a0d16dd3aec03f79a7fec110f9a6da", "message": "XRDDEV-1319 Update permission checks for service endpoints", "committedDate": "2020-09-15T13:38:53Z", "type": "commit"}, {"oid": "a8592b9f716e079a5e0c0cc9588ee00db3b8d814", "url": "https://github.com/nordic-institute/X-Road/commit/a8592b9f716e079a5e0c0cc9588ee00db3b8d814", "message": "XRDDEV-1319 Fix small ui glitch", "committedDate": "2020-09-15T15:28:10Z", "type": "commit"}, {"oid": "1e3a3cc089ec8241902bf933f8526d33393edcab", "url": "https://github.com/nordic-institute/X-Road/commit/1e3a3cc089ec8241902bf933f8526d33393edcab", "message": "XRDDEV-1319 Add route permission checks for \"add client\" paths", "committedDate": "2020-09-15T16:37:04Z", "type": "commit"}, {"oid": "736b870edf9be2f7a1f5c22a647750548d60001f", "url": "https://github.com/nordic-institute/X-Road/commit/736b870edf9be2f7a1f5c22a647750548d60001f", "message": "XRDDEV-1319 Fix linter issue", "committedDate": "2020-09-15T19:13:32Z", "type": "commit"}, {"oid": "de69a4d98afaacba65cb4c951bdc03fbf3abba81", "url": "https://github.com/nordic-institute/X-Road/commit/de69a4d98afaacba65cb4c951bdc03fbf3abba81", "message": "Merge branch 'bugfix-6.24.1' into XRDDEV-1319-permission-checks\n\n# Conflicts:\n#\tsrc/proxy-ui-api/frontend/audit-resolve.json\n#\tsrc/proxy-ui-api/frontend/package-lock.json", "committedDate": "2020-09-15T19:22:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMwMTIxMg==", "url": "https://github.com/nordic-institute/X-Road/pull/712#discussion_r489301212", "bodyText": "typo", "author": "TJaakkola", "createdAt": "2020-09-16T09:34:49Z", "path": "src/proxy-ui-api/frontend/src/views/KeysAndCertificates/SignAndAuthKeys/KeysTable.vue", "diffHunk": "@@ -206,37 +204,37 @@ export default Vue.extend({\n     };\n   },\n   computed: {\n-    hasPermission(): boolean {\n+    canImportFromToken(): boolean {\n+      // Can the user import cwrtificate from hardware token", "originalCommit": "de69a4d98afaacba65cb4c951bdc03fbf3abba81", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQwNDMzMg==", "url": "https://github.com/nordic-institute/X-Road/pull/712#discussion_r489404332", "bodyText": "Fixed", "author": "Riippi", "createdAt": "2020-09-16T12:40:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMwMTIxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM4OTU3MA==", "url": "https://github.com/nordic-institute/X-Road/pull/712#discussion_r489389570", "bodyText": "Does this work OK if key does not yet have a defined usage (no CSRs have been created) and user has only generate_auth_cert_req permission, not generate_sign_cert_req? (there is no such role at the moment, though, which would hide the issue)", "author": "jansu76", "createdAt": "2020-09-16T12:15:24Z", "path": "src/proxy-ui-api/frontend/src/views/KeysAndCertificates/SignAndAuthKeys/KeyRow.vue", "diffHunk": "@@ -65,29 +63,41 @@ export default Vue.extend({\n       type: Object as Prop<Key>,\n       required: true,\n     },\n-    hasPermission: {\n-      type: Boolean,\n-    },\n     tokenLoggedIn: {\n       type: Boolean,\n     },\n   },\n-  methods: {\n-    disableGenerateCsr(key: Key): boolean {\n-      if (!this.tokenLoggedIn) {\n-        return true;\n+  computed: {\n+    showGenerateCsr(): boolean {\n+      // Check if the user has permission to see generate csr action\n+      if (this.tokenKey.usage === 'AUTHENTICATION') {\n+        return this.$store.getters.hasPermission(\n+          Permissions.GENERATE_AUTH_CERT_REQ,\n+        );\n       }\n+      // If key usage is not auth then it has to be sign\n+      return this.$store.getters.hasPermission(", "originalCommit": "de69a4d98afaacba65cb4c951bdc03fbf3abba81", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQwNDE5NQ==", "url": "https://github.com/nordic-institute/X-Road/pull/712#discussion_r489404195", "bodyText": "If the key doesn't have a usage type it ends up in UnknownKeysTable.vue. That doesn't use the KeyRow component.", "author": "Riippi", "createdAt": "2020-09-16T12:40:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM4OTU3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU4NDA1NQ==", "url": "https://github.com/nordic-institute/X-Road/pull/712#discussion_r489584055", "bodyText": "ah, gotcha \ud83d\udc4d", "author": "jansu76", "createdAt": "2020-09-16T16:54:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM4OTU3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM5MDU0Mg==", "url": "https://github.com/nordic-institute/X-Road/pull/712#discussion_r489390542", "bodyText": "Should be generate_sign_cert_req?", "author": "jansu76", "createdAt": "2020-09-16T12:17:02Z", "path": "src/proxy-ui-api/frontend/src/views/KeysAndCertificates/SignAndAuthKeys/KeysTable.vue", "diffHunk": "@@ -206,37 +204,37 @@ export default Vue.extend({\n     };\n   },\n   computed: {\n-    hasPermission(): boolean {\n+    canImportFromToken(): boolean {\n+      // Can the user import cwrtificate from hardware token\n+      return this.$store.getters.hasPermission(Permissions.IMPORT_SIGN_CERT);\n+    },\n+\n+    showRegisterCertButton(): boolean {\n+      // Decide if the user can register a certificate\n       return this.$store.getters.hasPermission(\n-        Permissions.ACTIVATE_DEACTIVATE_TOKEN,\n+        Permissions.SEND_AUTH_CERT_REG_REQ,\n       );\n     },\n-    showRegisterCertButton(): boolean {\n-      if (\n-        this.hasPermission &&\n-        this.$store.getters.hasPermission(Permissions.SEND_AUTH_CERT_REG_REQ)\n-      ) {\n-        return true;\n-      }\n-      return false;\n+\n+    canCreateAuthCsr(): boolean {\n+      return this.$store.getters.hasPermission(\n+        Permissions.GENERATE_AUTH_CERT_REQ,\n+      );\n+    },\n+    canCreateSignCsr(): boolean {\n+      return this.$store.getters.hasPermission(\n+        Permissions.GENERATE_AUTH_CERT_REQ,", "originalCommit": "de69a4d98afaacba65cb4c951bdc03fbf3abba81", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQwNjg3NA==", "url": "https://github.com/nordic-institute/X-Road/pull/712#discussion_r489406874", "bodyText": "Seems that these two methods are not used at all. This is checked in KeyRow component.", "author": "Riippi", "createdAt": "2020-09-16T12:44:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM5MDU0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQwOTM2MQ==", "url": "https://github.com/nordic-institute/X-Road/pull/712#discussion_r489409361", "bodyText": "I will remove these.", "author": "Riippi", "createdAt": "2020-09-16T12:48:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM5MDU0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM5MjA3OQ==", "url": "https://github.com/nordic-institute/X-Road/pull/712#discussion_r489392079", "bodyText": "Would method name canCreateCsr be more descriptive (and same style seems to be used elsewhere)?", "author": "jansu76", "createdAt": "2020-09-16T12:19:44Z", "path": "src/proxy-ui-api/frontend/src/views/KeysAndCertificates/SignAndAuthKeys/UnknownKeysTable.vue", "diffHunk": "@@ -94,9 +94,9 @@ export default Vue.extend({\n   },\n   computed: {\n     hasPermission(): boolean {", "originalCommit": "de69a4d98afaacba65cb4c951bdc03fbf3abba81", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQwOTAwOQ==", "url": "https://github.com/nordic-institute/X-Road/pull/712#discussion_r489409009", "bodyText": "Fixed", "author": "Riippi", "createdAt": "2020-09-16T12:47:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM5MjA3OQ=="}], "type": "inlineReview"}, {"oid": "3b34dcb3e73bf711851bb561087f64937fd551b9", "url": "https://github.com/nordic-institute/X-Road/commit/3b34dcb3e73bf711851bb561087f64937fd551b9", "message": "XRDDEV-1319 Fix PR issues", "committedDate": "2020-09-16T12:49:12Z", "type": "commit"}]}