{"pr_number": 388, "pr_title": "XRDDEV-801, XRDDEV-798, XRDDEV-809", "pr_createdAt": "2020-02-26T07:48:03Z", "pr_url": "https://github.com/nordic-institute/X-Road/pull/388", "timeline": [{"oid": "07193e4b8d196d9164c77f37f8168cdc91de7cde", "url": "https://github.com/nordic-institute/X-Road/commit/07193e4b8d196d9164c77f37f8168cdc91de7cde", "message": "XRDDEV-801: Add api for adding endpoint", "committedDate": "2020-02-17T12:10:22Z", "type": "commit"}, {"oid": "375e9936a737e1ac6f8437f578d4d56de145bc09", "url": "https://github.com/nordic-institute/X-Road/commit/375e9936a737e1ac6f8437f578d4d56de145bc09", "message": "Fix editorconfig settings for intendations", "committedDate": "2020-02-17T12:11:05Z", "type": "commit"}, {"oid": "503ccf569a09fccd1015b2a91eca9d81d75a3d75", "url": "https://github.com/nordic-institute/X-Road/commit/503ccf569a09fccd1015b2a91eca9d81d75a3d75", "message": "XRDDEV-801: Add missing license", "committedDate": "2020-02-18T12:27:21Z", "type": "commit"}, {"oid": "1cfc2cd24667722d21353b55cd4c435e4344201d", "url": "https://github.com/nordic-institute/X-Road/commit/1cfc2cd24667722d21353b55cd4c435e4344201d", "message": "XRDDEV-801: UI changes for adding new endpoint", "committedDate": "2020-02-18T12:28:53Z", "type": "commit"}, {"oid": "c2a99dba81a8b4aa7d3dba7b7f8008b173cc37ca", "url": "https://github.com/nordic-institute/X-Road/commit/c2a99dba81a8b4aa7d3dba7b7f8008b173cc37ca", "message": "XRDDEV-801: Fix create endpoint http response code", "committedDate": "2020-02-18T13:27:29Z", "type": "commit"}, {"oid": "08c806c73cbd47060ebc2cf1c84e4d7e52365e8f", "url": "https://github.com/nordic-institute/X-Road/commit/08c806c73cbd47060ebc2cf1c84e4d7e52365e8f", "message": "XRDDEV-801: Add test-data attributes for testing and remove unused markup", "committedDate": "2020-02-18T13:40:27Z", "type": "commit"}, {"oid": "fc5c66c72563b20735bfc931892dc888e7bd32ef", "url": "https://github.com/nordic-institute/X-Road/commit/fc5c66c72563b20735bfc931892dc888e7bd32ef", "message": "XRDDEV-801: Add api and ui changes for removing endpoints", "committedDate": "2020-02-19T11:50:17Z", "type": "commit"}, {"oid": "696a3c498b8f15ae293a7377c9beb25615f84e71", "url": "https://github.com/nordic-institute/X-Road/commit/696a3c498b8f15ae293a7377c9beb25615f84e71", "message": "XRDDEV-801: Add api and ui changes for removing endpoints", "committedDate": "2020-02-19T12:05:27Z", "type": "commit"}, {"oid": "51baad08a367db73324564de11a3294426f17a84", "url": "https://github.com/nordic-institute/X-Road/commit/51baad08a367db73324564de11a3294426f17a84", "message": "Merge branch 'XRDDEV-801' of github.com:nordic-institute/X-Road into XRDDEV-801", "committedDate": "2020-02-19T12:06:14Z", "type": "commit"}, {"oid": "a77c2be3ce7d6c9133cfbea9f10930c41d82652d", "url": "https://github.com/nordic-institute/X-Road/commit/a77c2be3ce7d6c9133cfbea9f10930c41d82652d", "message": "XRDDEV-801: Add changes for updating an endpoint", "committedDate": "2020-02-19T14:22:59Z", "type": "commit"}, {"oid": "acb5c163d21ec2f6231795b8bd7d7df7064d04df", "url": "https://github.com/nordic-institute/X-Road/commit/acb5c163d21ec2f6231795b8bd7d7df7064d04df", "message": "XRDDEV-801: Remove access rights linked to endpoint on endpoint removal", "committedDate": "2020-02-20T20:16:36Z", "type": "commit"}, {"oid": "efc7edf5478a26dac5a54a6c3bcad16379acdde5", "url": "https://github.com/nordic-institute/X-Road/commit/efc7edf5478a26dac5a54a6c3bcad16379acdde5", "message": "Merge branch 'develop' into XRDDEV-801", "committedDate": "2020-02-20T20:21:26Z", "type": "commit"}, {"oid": "1999f195a9ae1b86421870e1478d384a9ee037c1", "url": "https://github.com/nordic-institute/X-Road/commit/1999f195a9ae1b86421870e1478d384a9ee037c1", "message": "XRDDEV-801: Changes to endpoint handling:\n\n- Add update endpoint view\n- Add api for fetching single endpoint", "committedDate": "2020-02-24T15:41:15Z", "type": "commit"}, {"oid": "f1163d708e0c9d883167fbd7d836dbe078caef8e", "url": "https://github.com/nordic-institute/X-Road/commit/f1163d708e0c9d883167fbd7d836dbe078caef8e", "message": "XRDDEV-801: Add simple test for fetching a single endpoint", "committedDate": "2020-02-25T06:57:14Z", "type": "commit"}, {"oid": "2ed92ca29e6c44918807b5467d91d8ee77306fdf", "url": "https://github.com/nordic-institute/X-Road/commit/2ed92ca29e6c44918807b5467d91d8ee77306fdf", "message": "Remove refresh functionality from REST type service descriptions", "committedDate": "2020-02-25T07:45:40Z", "type": "commit"}, {"oid": "a629104e298d058d9730de362ce2b6cfa8ab93ac", "url": "https://github.com/nordic-institute/X-Road/commit/a629104e298d058d9730de362ce2b6cfa8ab93ac", "message": "XRDDEV-801: Remove delete button from servicedetails view and add data-test attribute to endpointdetails view", "committedDate": "2020-02-25T07:46:55Z", "type": "commit"}, {"oid": "e4f239a4f6d8cf18dc21f4e904b8dab4fbd36b4f", "url": "https://github.com/nordic-institute/X-Road/commit/e4f239a4f6d8cf18dc21f4e904b8dab4fbd36b4f", "message": "XRDDEV-801: Add check for Service Description type when adding an endpoint", "committedDate": "2020-02-25T12:01:07Z", "type": "commit"}, {"oid": "719b89730b058a619fdc1503709e4ee63db357dd", "url": "https://github.com/nordic-institute/X-Road/commit/719b89730b058a619fdc1503709e4ee63db357dd", "message": "XRDDEV-801: Refactoring", "committedDate": "2020-02-25T12:02:43Z", "type": "commit"}, {"oid": "1673a1498b1b6759b2ed1125390132133196f6e9", "url": "https://github.com/nordic-institute/X-Road/commit/1673a1498b1b6759b2ed1125390132133196f6e9", "message": "XRDDEV-801: Hide params/endpoints tabs from services of type WSDL", "committedDate": "2020-02-26T07:43:11Z", "type": "commit"}, {"oid": "dc208e8808c4d1a3f852cf03279e4a6692015d98", "url": "https://github.com/nordic-institute/X-Road/commit/dc208e8808c4d1a3f852cf03279e4a6692015d98", "message": "XRDDEV-801: Generate types from openapi3", "committedDate": "2020-02-26T07:43:30Z", "type": "commit"}, {"oid": "b75b2201fd2e416342312bb768aac19646d6bc1d", "url": "https://github.com/nordic-institute/X-Road/commit/b75b2201fd2e416342312bb768aac19646d6bc1d", "message": "XRDDEV-801: remove unused imports", "committedDate": "2020-02-26T08:04:44Z", "type": "commit"}, {"oid": "677b584d0fe3ee93dc700dd760929982d84d1b80", "url": "https://github.com/nordic-institute/X-Road/commit/677b584d0fe3ee93dc700dd760929982d84d1b80", "message": "XRDDEV-801: Add comments for service methods", "committedDate": "2020-02-26T08:35:14Z", "type": "commit"}, {"oid": "d778a24cba584f4eca0df20b48d2df4077ed3051", "url": "https://github.com/nordic-institute/X-Road/commit/d778a24cba584f4eca0df20b48d2df4077ed3051", "message": "XRDDEV-801: Move edit & access rights buttons closer to each other", "committedDate": "2020-02-26T08:44:24Z", "type": "commit"}, {"oid": "c30e19b821240c35705101e92f08635563eb9520", "url": "https://github.com/nordic-institute/X-Road/commit/c30e19b821240c35705101e92f08635563eb9520", "message": "Merge branch 'develop' into XRDDEV-801", "committedDate": "2020-02-26T12:07:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAyNzE4NA==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385027184", "bodyText": "Is there a reason to use both camelCase and snake_case in the i18n keys?", "author": "carohauta", "createdAt": "2020-02-27T10:07:22Z", "path": "src/proxy-ui-api/frontend/src/locales/en.json", "diffHunk": "@@ -171,7 +171,18 @@\n   \"endpoints\": {\n     \"addEndpoint\": \"Add Endpoint\",\n     \"path\": \"Path\",\n-    \"httpRequestMethod\": \"HTTP Request Method\"\n+    \"httpRequestMethod\": \"HTTP Request Method\",\n+    \"endpoint_help_1\": \"Paths is relative to the API base path, e.g. '/pets'. The asterisk (*) can be used as a wildcard\",\n+    \"endpoint_help_2\": \"* = match one path segment.\",\n+    \"endpoint_help_3\": \"** = match zero or more segments, e.g. '/pets/**'.\",\n+    \"endpoint_help_4\": \"Path parameters must be replaced with an asterisk, e.g. '/pets/{id}/images' => '/pets/*/images'.\",\n+    \"saveNewEndpointError\": \"Error saving new endpoint\",", "originalCommit": "c30e19b821240c35705101e92f08635563eb9520", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEyMTIzMg==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385121232", "bodyText": "No, these were copy pasted from the old ui and left accidentally like this. Fixed.", "author": "TJaakkola", "createdAt": "2020-02-27T13:21:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAyNzE4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA1NDU5Nw==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385054597", "bodyText": "Linter error Missing trailing comma", "author": "carohauta", "createdAt": "2020-02-27T10:57:44Z", "path": "src/proxy-ui-api/frontend/src/views/Clients/Services/Services.vue", "diffHunk": "@@ -270,10 +268,11 @@ export default Vue.extend({\n         params: { id: desc.id },\n       });\n     },\n-    serviceClick(service: any): void {\n+    serviceClick(serviceDescription: ServiceDescription, service: Service): void {\n       this.$router.push({\n         name: RouteName.Service,\n         params: { serviceId: service.id, clientId: this.id },\n+        query: { descriptionType: serviceDescription.type }", "originalCommit": "c30e19b821240c35705101e92f08635563eb9520", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEyMTI5OA==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385121298", "bodyText": "Fixed.", "author": "TJaakkola", "createdAt": "2020-02-27T13:22:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA1NDU5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA1NzQ2Mg==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385057462", "bodyText": "Would it make sense to add the original 10px margin in front of all the elements on the right hand side column of this dialog? Just trying to figure out a way to minimize the use of !important keyword.", "author": "carohauta", "createdAt": "2020-02-27T11:03:42Z", "path": "src/proxy-ui-api/frontend/src/views/Service/Endpoints/AddEndpointDialog.vue", "diffHunk": "@@ -0,0 +1,119 @@\n+<template>\n+  <simpleDialog\n+    :dialog=\"dialog\"\n+    :width=\"750\"\n+    title=\"endpoints.addEndpoint\"\n+    @save=\"save\"\n+    @cancel=\"cancel\"\n+    :disableSave=\"!isValid\"\n+  >\n+    <div slot=\"content\">\n+      <ValidationObserver ref=\"form\" v-slot=\"{ validate, invalid }\">\n+\n+        <div class=\"dlg-edit-row\">\n+          <div class=\"dlg-row-title long-row-title\">{{$t('endpoints.httpRequestMethod')}}</div>\n+            <v-select data-test=\"endpoint-method\" v-model=\"method\" :items=\"methods\" />\n+        </div>\n+\n+        <div class=\"dlg-edit-row\">\n+          <div class=\"dlg-row-title long-row-title\">{{$t('endpoints.path')}}</div>\n+          <ValidationProvider\n+            rules=\"required\"\n+            ref=\"path\"\n+            name=\"path\"\n+            class=\"validation-provider dlg-row-input\"\n+            v-slot=\"{ errors }\">\n+            <v-text-field\n+              v-model=\"path\"\n+              single-line\n+              :error-messages=\"errors\"\n+              name=\"path\"\n+              data-test=\"endpoint-path\"\n+            ></v-text-field>\n+          </ValidationProvider>\n+        </div>\n+\n+        <div class=\"dlg-edit-row\">\n+          <div class=\"dlg-row-title long-row-title\"></div>\n+          <div>\n+            <div>{{$t('endpoints.endpoint_help_1')}}</div>\n+            <div>{{$t('endpoints.endpoint_help_2')}}</div>\n+            <div>{{$t('endpoints.endpoint_help_3')}}</div>\n+            <div>{{$t('endpoints.endpoint_help_4')}}</div>\n+          </div>\n+        </div>\n+\n+      </ValidationObserver>\n+    </div>\n+\n+  </simpleDialog>\n+</template>\n+\n+<script lang=\"ts\">\n+  import Vue from 'vue';\n+  import {ValidationObserver, ValidationProvider} from 'vee-validate';\n+  import SimpleDialog from '@/components/ui/SimpleDialog.vue';\n+\n+  export default Vue.extend({\n+    components: {\n+      SimpleDialog, ValidationProvider, ValidationObserver,\n+    },\n+    props: {\n+      dialog: {\n+        type: Boolean,\n+        required: true,\n+      },\n+    },\n+    data(): any {\n+      return {\n+        methods: [\n+          { text: this.$t('endpoints.all'), value: '*' },\n+          { text: 'GET', value: 'GET' },\n+          { text: 'POST', value: 'POST' },\n+          { text: 'PUT', value: 'PUT' },\n+          { text: 'PATCH', value: 'PATCH' },\n+          { text: 'DELETE', value: 'DELETE' },\n+          { text: 'HEAD', value: 'HEAD' },\n+          { text: 'OPTIONS', value: 'OPTIONS' },\n+          { text: 'TRACE', value: 'TRACE' },\n+        ],\n+        method: '*',\n+        path: '/',\n+      };\n+    },\n+    computed: {\n+      isValid(): boolean {\n+        return this.path.length >= 1;\n+      },\n+    },\n+    methods: {\n+      save(): void {\n+        this.$emit('save', this.method, this.path);\n+        this.clear();\n+      },\n+      cancel(): void {\n+        this.$emit('cancel');\n+        this.clear();\n+      },\n+      clear(): void {\n+        this.path = '/';\n+        this.method = '*';\n+        (this.$refs.form as InstanceType<typeof ValidationObserver>).reset();\n+      },\n+    },\n+  });\n+\n+</script>\n+\n+<style lang=\"scss\" scoped>\n+@import '../../../assets/dialogs';\n+\n+.long-row-title {\n+  min-width: 170px !important;\n+}\n+\n+.dlg-row-input {\n+  margin-left: 0px !important;", "originalCommit": "c30e19b821240c35705101e92f08635563eb9520", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA4MjY4OA==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385082688", "bodyText": "ServiceDescription types could maybe be inside an enum", "author": "carohauta", "createdAt": "2020-02-27T11:59:57Z", "path": "src/proxy-ui-api/frontend/src/views/Service/Service.vue", "diffHunk": "@@ -2,25 +2,13 @@\n     <div class=\"xrd-tab-max-width\">\n         <subViewTitle :title=\"service.service_code\" @close=\"close\" class=\"sub-view-title-spacing\" />\n \n-        <div class=\"wrap-right delete-button-spacing\">\n-            <v-btn\n-                color=\"primary\"\n-                @click=\"removeService\"\n-                outlined\n-                rounded\n-                class=\"rounded-button elevation-0 rest-button\"\n-                data-test=\"service-delete\"\n-            >{{$t('action.delete')}}\n-            </v-btn>\n-        </div>\n-\n-        <v-tabs v-model=\"tab\" class=\"xrd-tabs\" color=\"secondary\" grow slider-size=\"4\" >\n+        <v-tabs v-if=\"$route.query.descriptionType !== 'WSDL'\" v-model=\"tab\" class=\"xrd-tabs\" color=\"secondary\" grow slider-size=\"4\" >", "originalCommit": "c30e19b821240c35705101e92f08635563eb9520", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTE0OTUxNw==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385149517", "bodyText": "I add an enum for this but it's a shame our typescript types generator library doesn't support enums horiuchi/dtsgenerator#335 as now there is union type declaration and enum for the same thing (union type is not used at all).", "author": "TJaakkola", "createdAt": "2020-02-27T14:11:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA4MjY4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA4NjQ1MQ==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385086451", "bodyText": "This should probably be HttpStatus.CREATED and also set the Location header (ApiUtil#createCreatedResponse)", "author": "carohauta", "createdAt": "2020-02-27T12:08:10Z", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/EndpointsApiController.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.openapi;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.niis.xroad.restapi.converter.EndpointConverter;\n+import org.niis.xroad.restapi.openapi.model.Endpoint;\n+import org.niis.xroad.restapi.service.ClientNotFoundException;\n+import org.niis.xroad.restapi.service.EndpointService;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.stereotype.Controller;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+\n+/**\n+ * Endpoints api\n+ */\n+@Controller\n+@RequestMapping(\"/api\")\n+@Slf4j\n+@PreAuthorize(\"denyAll\")\n+public class EndpointsApiController implements EndpointsApi {\n+\n+    private final EndpointService endpointService;\n+    private final EndpointConverter endpointConverter;\n+\n+    private static final String NOT_FOUND_ERROR_MSG = \"Endpoint not found with id\";\n+\n+    @Autowired\n+    public EndpointsApiController(\n+            EndpointService endpointService,\n+            EndpointConverter endpointConverter) {\n+        this.endpointService = endpointService;\n+        this.endpointConverter = endpointConverter;\n+    }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('VIEW_ENDPOINT')\")\n+    public ResponseEntity<Endpoint> getEndpoint(String id) {\n+        Endpoint endpoint;\n+        try {\n+            endpoint = endpointConverter.convert(endpointService.getEndpoint(id));\n+        } catch (EndpointService.EndpointNotFoundException e) {\n+            throw new ResourceNotFoundException(NOT_FOUND_ERROR_MSG + \" \" + id);\n+        }\n+        return new ResponseEntity(endpoint, HttpStatus.ACCEPTED);", "originalCommit": "c30e19b821240c35705101e92f08635563eb9520", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTE1MjM5MQ==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385152391", "bodyText": "Fixed", "author": "TJaakkola", "createdAt": "2020-02-27T14:15:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA4NjQ1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA4NjY1MA==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385086650", "bodyText": "This should probably be HttpStatus.OK", "author": "carohauta", "createdAt": "2020-02-27T12:08:33Z", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/EndpointsApiController.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.openapi;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.niis.xroad.restapi.converter.EndpointConverter;\n+import org.niis.xroad.restapi.openapi.model.Endpoint;\n+import org.niis.xroad.restapi.service.ClientNotFoundException;\n+import org.niis.xroad.restapi.service.EndpointService;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.stereotype.Controller;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+\n+/**\n+ * Endpoints api\n+ */\n+@Controller\n+@RequestMapping(\"/api\")\n+@Slf4j\n+@PreAuthorize(\"denyAll\")\n+public class EndpointsApiController implements EndpointsApi {\n+\n+    private final EndpointService endpointService;\n+    private final EndpointConverter endpointConverter;\n+\n+    private static final String NOT_FOUND_ERROR_MSG = \"Endpoint not found with id\";\n+\n+    @Autowired\n+    public EndpointsApiController(\n+            EndpointService endpointService,\n+            EndpointConverter endpointConverter) {\n+        this.endpointService = endpointService;\n+        this.endpointConverter = endpointConverter;\n+    }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('VIEW_ENDPOINT')\")\n+    public ResponseEntity<Endpoint> getEndpoint(String id) {\n+        Endpoint endpoint;\n+        try {\n+            endpoint = endpointConverter.convert(endpointService.getEndpoint(id));\n+        } catch (EndpointService.EndpointNotFoundException e) {\n+            throw new ResourceNotFoundException(NOT_FOUND_ERROR_MSG + \" \" + id);\n+        }\n+        return new ResponseEntity(endpoint, HttpStatus.ACCEPTED);\n+    }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('DELETE_ENDPOINT')\")\n+    public ResponseEntity<Void> deleteEndpoint(String id) {\n+        try {\n+            endpointService.deleteEndpoint(id);\n+        } catch (EndpointService.EndpointNotFoundException e) {\n+            throw new ResourceNotFoundException(NOT_FOUND_ERROR_MSG + \" \" + id);\n+        } catch (ClientNotFoundException e) {\n+            throw new ConflictException(\"Client not found for the given endpoint with id: \" + id);\n+        }\n+        return new ResponseEntity<>(HttpStatus.NO_CONTENT);\n+    }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('EDIT_OPENAPI3_ENDPOINT')\")\n+    public ResponseEntity<Endpoint> updateEndpoint(String id, Endpoint endpoint) {\n+        Endpoint ep;\n+        try {\n+            ep = endpointConverter.convert(endpointService.updateEndpoint(id, endpoint));\n+        } catch (EndpointService.EndpointNotFoundException e) {\n+            throw new ResourceNotFoundException(NOT_FOUND_ERROR_MSG + \" \" + id);\n+        } catch (EndpointService.IllegalGeneratedEndpointUpdateException e) {\n+            throw new ConflictException(\"Updating is not allowed for generated endpoint \" + id);\n+        }\n+\n+        return new ResponseEntity<>(ep, HttpStatus.ACCEPTED);", "originalCommit": "c30e19b821240c35705101e92f08635563eb9520", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA4NzI5Mg==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385087292", "bodyText": "Should also set the Location header. Use ApiUtil#createCreatedResponse method", "author": "carohauta", "createdAt": "2020-02-27T12:09:56Z", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/ServicesApiController.java", "diffHunk": "@@ -209,4 +216,24 @@ private ServiceType getServiceType(String id) {\n         }\n         return hasNumericId && isLocalGroup;\n     };\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('ADD_OPENAPI3_ENDPOINT')\")\n+    public ResponseEntity<Endpoint> addEndpoint(String id, Endpoint endpoint) {\n+        ServiceType serviceType = getServiceType(id);\n+\n+        if (endpoint.getId() != null) {\n+            throw new BadRequestException(\"Passing id for endpoint while creating it is not allowed\");\n+        }\n+        Endpoint ep;\n+        try {\n+            ep = endpointConverter.convert(serviceService.addEndpoint(serviceType,\n+                    endpoint.getMethod(), endpoint.getPath()));\n+        } catch (EndpointAlreadyExistsException e) {\n+            throw new ConflictException(e);\n+        } catch (ServiceDescriptionService.WrongServiceDescriptionTypeException e) {\n+            throw new BadRequestException(e);\n+        }\n+        return new ResponseEntity<>(ep, HttpStatus.CREATED);", "originalCommit": "c30e19b821240c35705101e92f08635563eb9520", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA5MDg5Mw==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385090893", "bodyText": "Save method is not declared -> does not do anything", "author": "carohauta", "createdAt": "2020-02-27T12:17:59Z", "path": "src/proxy-ui-api/frontend/src/views/Service/Endpoints/EndpointDetails.vue", "diffHunk": "@@ -0,0 +1,199 @@\n+<template>\n+  <div class=\"xrd-tab-max-width\">\n+    <div>\n+      <subViewTitle\n+        :title=\"$t('endpoints.details')\"\n+        @close=\"close\"\n+      />\n+      <div class=\"delete-wrap\">\n+        <large-button\n+          v-if=\"showDelete\"\n+          @click=\"showDeletePopup()\"\n+          outlined\n+          data-test=\"delete-endpoint\"\n+        >{{$t('action.delete')}}\n+        </large-button>\n+      </div>\n+    </div>\n+\n+    <ValidationObserver ref=\"form\" v-slot=\"{ validate, invalid }\">\n+\n+      <div class=\"dlg-edit-row\">\n+        <div class=\"dlg-row-title long-row-title\">{{$t('endpoints.httpRequestMethod')}}</div>\n+        <v-select class=\"dlg-row-input\" @input=\"touched = true\" data-test=\"endpoint-method\" v-model=\"endpoint.method\" :items=\"methods\"/>\n+      </div>\n+\n+      <div class=\"dlg-edit-row\">\n+        <div class=\"dlg-row-title long-row-title\">{{$t('endpoints.path')}}</div>\n+        <ValidationProvider\n+          rules=\"required\"\n+          ref=\"path\"\n+          name=\"path\"\n+          class=\"validation-provider dlg-row-input\"\n+          v-slot=\"{ errors }\">\n+          <v-text-field\n+            v-model=\"endpoint.path\"\n+            single-line\n+            :error-messages=\"errors\"\n+            name=\"path\"\n+            data-test=\"endpoint-path\"\n+            @input=\"touched = true\"\n+          ></v-text-field>\n+        </ValidationProvider>\n+      </div>\n+\n+      <div class=\"dlg-edit-row helper-text\">\n+        <div class=\"dlg-row-title long-row-title\"></div>\n+        <div>\n+          <div>{{$t('endpoints.endpoint_help_1')}}</div>\n+          <div>{{$t('endpoints.endpoint_help_2')}}</div>\n+          <div>{{$t('endpoints.endpoint_help_3')}}</div>\n+          <div>{{$t('endpoints.endpoint_help_4')}}</div>\n+        </div>\n+      </div>\n+\n+      <v-card flat>\n+        <div class=\"footer-button-wrap\">\n+          <large-button @click=\"close()\" outlined>{{$t('action.cancel')}}</large-button>\n+          <large-button\n+            class=\"save-button\"\n+            :loading=\"saveBusy\"\n+            @click=\"save()\"", "originalCommit": "c30e19b821240c35705101e92f08635563eb9520", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA5MzMyMQ==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385093321", "bodyText": "The method needs to be validated. Allowed values could probably be declared in the API definition but I don't think OPENAPI3 allows * as a key. One possibility would be to use the word ALL instead of * in the API definition and create an enum there. If nothing works then the validation (or enum mapping) should at least be done as close to the API as possible (maybe in the controller layer)", "author": "carohauta", "createdAt": "2020-02-27T12:23:30Z", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/ServiceService.java", "diffHunk": "@@ -159,4 +163,35 @@ public ServiceType updateService(ClientId clientId, String fullServiceCode,\n         return serviceType;\n     }\n \n+    /**\n+     * Add new endpoint to a service\n+     *\n+     * @param serviceType                                                       service where endpoint is added\n+     * @param method                                                            method\n+     * @param path                                                              path\n+     * @return\n+     * @throws EndpointAlreadyExistsException                                   equivalent endpoint already exists for\n+     *                                                                          this client\n+     * @throws ServiceDescriptionService.WrongServiceDescriptionTypeException   if trying to add endpoint to a WSDL\n+     */\n+    public EndpointType addEndpoint(ServiceType serviceType, String method, String path)\n+            throws EndpointAlreadyExistsException, ServiceDescriptionService.WrongServiceDescriptionTypeException {\n+        verifyAuthority(\"ADD_OPENAPI3_ENDPOINT\");\n+\n+        if (serviceType.getServiceDescription().getType().equals(DescriptionType.WSDL)) {\n+            throw new ServiceDescriptionService.WrongServiceDescriptionTypeException(\"Endpoint can't be added to a \"\n+                    + \"WSDL type of Service Description\");\n+        }\n+\n+        EndpointType endpointType = new EndpointType(serviceType.getServiceCode(), method, path, false);", "originalCommit": "c30e19b821240c35705101e92f08635563eb9520", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA5NzY1NA==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385097654", "bodyText": "As already commented on the controller method, this should be 200", "author": "carohauta", "createdAt": "2020-02-27T12:33:15Z", "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -2383,6 +2427,111 @@ paths:\n           description: resource requested does not exists\n         '500':\n           description: internal server error\n+  /endpoints/{id}:\n+    get:\n+      tags:\n+        - security server\n+      operationId: getEndpoint\n+      description: Administrator fetches an endpoint\n+      parameters:\n+        - in: path\n+          name: id\n+          description: id of the endpoint\n+          schema:\n+            type: string\n+            example: 102\n+            format: text\n+            minLength: 1\n+            maxLength: 255\n+      responses:\n+        '200':\n+          description: endpoint\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/Endpoint'\n+        '400':\n+          description: request was invalid\n+        '401':\n+          description: authentication credentials are missing\n+        '403':\n+          description: request has been refused\n+        '404':\n+          description: resource requested does not exists\n+        '406':\n+          description: request specified an invalid format\n+        '500':\n+          description: internal server error\n+    put:\n+      tags:\n+        - security server\n+      operationId: updateEndpoint\n+      description: Administrator updates an endpoint\n+      parameters:\n+        - in: path\n+          name: id\n+          description: id of the endpoint\n+          schema:\n+            type: string\n+            example: 102\n+            format: text\n+            minLength: 1\n+            maxLength: 255\n+      requestBody:\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/Endpoint'\n+      responses:\n+        '202':", "originalCommit": "c30e19b821240c35705101e92f08635563eb9520", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA5ODI4Mg==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385098282", "bodyText": "Remember to bump the version of the API definition", "author": "carohauta", "createdAt": "2020-02-27T12:34:40Z", "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -2261,6 +2261,50 @@ paths:\n           description: request specified an invalid format", "originalCommit": "c30e19b821240c35705101e92f08635563eb9520", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA5OTg1NQ==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385099855", "bodyText": "This throws ResourceNotFoundException, which is of the type OpenApiException, so the parsing should be done already in the controller layer.", "author": "carohauta", "createdAt": "2020-02-27T12:38:02Z", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/EndpointService.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.service;\n+\n+import ee.ria.xroad.common.conf.serverconf.model.ClientType;\n+import ee.ria.xroad.common.conf.serverconf.model.EndpointType;\n+\n+import org.niis.xroad.restapi.exceptions.ErrorDeviation;\n+import org.niis.xroad.restapi.openapi.model.Endpoint;\n+import org.niis.xroad.restapi.repository.ClientRepository;\n+import org.niis.xroad.restapi.repository.EndpointRepository;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.stereotype.Service;\n+import org.springframework.transaction.annotation.Transactional;\n+\n+import static org.niis.xroad.restapi.service.SecurityHelper.verifyAuthority;\n+import static org.niis.xroad.restapi.util.FormatUtils.parseLongIdOrThrowNotFound;\n+\n+@Service\n+@Transactional\n+@PreAuthorize(\"isAuthenticated()\")\n+public class EndpointService {\n+\n+    private final ClientRepository clientRepository;\n+    private final EndpointRepository endpointRepository;\n+\n+    @Autowired\n+    public EndpointService(ClientRepository clientRepository, EndpointRepository endpointRepository) {\n+        this.clientRepository = clientRepository;\n+        this.endpointRepository = endpointRepository;\n+    }\n+\n+    /**\n+     * Get endpoint by endpoint id\n+     *\n+     * @param id                            endpoint id\n+     * @return\n+     * @throws EndpointNotFoundException    endpoint not found with given id\n+     */\n+    public EndpointType getEndpoint(String id) throws EndpointNotFoundException {\n+        verifyAuthority(\"VIEW_ENDPOINT\");\n+        Long endpointId = parseLongIdOrThrowNotFound(id);", "originalCommit": "c30e19b821240c35705101e92f08635563eb9520", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEwMDk5NQ==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385100995", "bodyText": "This throws ResourceNotFoundException, which is of the type OpenApiException, so the parsing should be done already in the controller layer.", "author": "carohauta", "createdAt": "2020-02-27T12:40:34Z", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/EndpointService.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.service;\n+\n+import ee.ria.xroad.common.conf.serverconf.model.ClientType;\n+import ee.ria.xroad.common.conf.serverconf.model.EndpointType;\n+\n+import org.niis.xroad.restapi.exceptions.ErrorDeviation;\n+import org.niis.xroad.restapi.openapi.model.Endpoint;\n+import org.niis.xroad.restapi.repository.ClientRepository;\n+import org.niis.xroad.restapi.repository.EndpointRepository;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.stereotype.Service;\n+import org.springframework.transaction.annotation.Transactional;\n+\n+import static org.niis.xroad.restapi.service.SecurityHelper.verifyAuthority;\n+import static org.niis.xroad.restapi.util.FormatUtils.parseLongIdOrThrowNotFound;\n+\n+@Service\n+@Transactional\n+@PreAuthorize(\"isAuthenticated()\")\n+public class EndpointService {\n+\n+    private final ClientRepository clientRepository;\n+    private final EndpointRepository endpointRepository;\n+\n+    @Autowired\n+    public EndpointService(ClientRepository clientRepository, EndpointRepository endpointRepository) {\n+        this.clientRepository = clientRepository;\n+        this.endpointRepository = endpointRepository;\n+    }\n+\n+    /**\n+     * Get endpoint by endpoint id\n+     *\n+     * @param id                            endpoint id\n+     * @return\n+     * @throws EndpointNotFoundException    endpoint not found with given id\n+     */\n+    public EndpointType getEndpoint(String id) throws EndpointNotFoundException {\n+        verifyAuthority(\"VIEW_ENDPOINT\");\n+        Long endpointId = parseLongIdOrThrowNotFound(id);\n+        EndpointType endpoint = endpointRepository.getEndpoint(endpointId);\n+        if (endpoint == null) {\n+            throw new EndpointNotFoundException(endpointId.toString());\n+        }\n+        return endpoint;\n+    }\n+\n+    /**\n+     * Delete endpoint\n+     *\n+     * @param id                            endpoint id\n+     * @throws EndpointNotFoundException    endpoint not found with given id\n+     * @throws ClientNotFoundException      client for the endpoint not found\n+     */\n+    public void deleteEndpoint(String id) throws EndpointNotFoundException, ClientNotFoundException {\n+        verifyAuthority(\"DELETE_ENDPOINT\");\n+        Long endpointId = parseLongIdOrThrowNotFound(id);", "originalCommit": "c30e19b821240c35705101e92f08635563eb9520", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEwMTA5Nw==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385101097", "bodyText": "This throws ResourceNotFoundException, which is of the type OpenApiException, so the parsing should be done already in the controller layer.", "author": "carohauta", "createdAt": "2020-02-27T12:40:46Z", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/EndpointService.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.service;\n+\n+import ee.ria.xroad.common.conf.serverconf.model.ClientType;\n+import ee.ria.xroad.common.conf.serverconf.model.EndpointType;\n+\n+import org.niis.xroad.restapi.exceptions.ErrorDeviation;\n+import org.niis.xroad.restapi.openapi.model.Endpoint;\n+import org.niis.xroad.restapi.repository.ClientRepository;\n+import org.niis.xroad.restapi.repository.EndpointRepository;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.stereotype.Service;\n+import org.springframework.transaction.annotation.Transactional;\n+\n+import static org.niis.xroad.restapi.service.SecurityHelper.verifyAuthority;\n+import static org.niis.xroad.restapi.util.FormatUtils.parseLongIdOrThrowNotFound;\n+\n+@Service\n+@Transactional\n+@PreAuthorize(\"isAuthenticated()\")\n+public class EndpointService {\n+\n+    private final ClientRepository clientRepository;\n+    private final EndpointRepository endpointRepository;\n+\n+    @Autowired\n+    public EndpointService(ClientRepository clientRepository, EndpointRepository endpointRepository) {\n+        this.clientRepository = clientRepository;\n+        this.endpointRepository = endpointRepository;\n+    }\n+\n+    /**\n+     * Get endpoint by endpoint id\n+     *\n+     * @param id                            endpoint id\n+     * @return\n+     * @throws EndpointNotFoundException    endpoint not found with given id\n+     */\n+    public EndpointType getEndpoint(String id) throws EndpointNotFoundException {\n+        verifyAuthority(\"VIEW_ENDPOINT\");\n+        Long endpointId = parseLongIdOrThrowNotFound(id);\n+        EndpointType endpoint = endpointRepository.getEndpoint(endpointId);\n+        if (endpoint == null) {\n+            throw new EndpointNotFoundException(endpointId.toString());\n+        }\n+        return endpoint;\n+    }\n+\n+    /**\n+     * Delete endpoint\n+     *\n+     * @param id                            endpoint id\n+     * @throws EndpointNotFoundException    endpoint not found with given id\n+     * @throws ClientNotFoundException      client for the endpoint not found\n+     */\n+    public void deleteEndpoint(String id) throws EndpointNotFoundException, ClientNotFoundException {\n+        verifyAuthority(\"DELETE_ENDPOINT\");\n+        Long endpointId = parseLongIdOrThrowNotFound(id);\n+        ClientType clientType = clientRepository.getClientByEndpointId(endpointId);\n+        if (clientType == null) {\n+            throw new ClientNotFoundException(\"Client not found for endpoint with id: \" + endpointId.toString());\n+        }\n+        clientType.getAcl().removeIf(acl -> acl.getEndpoint().getId().equals(Long.valueOf(endpointId)));\n+        clientType.getEndpoint().removeIf(endpoint -> endpoint.getId().equals(endpointId));\n+        clientRepository.saveOrUpdate(clientType);\n+    }\n+\n+    /**\n+     * Update endpoint details\n+     *\n+     * @param id                                        endpoint id\n+     * @param endpointUpdate                            endpoint object to use for updating\n+     * @return\n+     * @throws EndpointNotFoundException                endpoint not found with given id\n+     * @throws IllegalGeneratedEndpointUpdateException  trying to update that is generated automatically\n+     */\n+    public EndpointType updateEndpoint(String id, Endpoint endpointUpdate)\n+            throws EndpointNotFoundException, IllegalGeneratedEndpointUpdateException {\n+        verifyAuthority(\"EDIT_OPENAPI3_ENDPOINT\");\n+        Long endpointId = parseLongIdOrThrowNotFound(id);", "originalCommit": "c30e19b821240c35705101e92f08635563eb9520", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTExMDUzMA==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385110530", "bodyText": "Should this be BadRequestException instead? I think that trying to update a generated endpoint is the user doing something wrong rather than the system being in a conflicted state (such as having duplicate value or missing the parent object).", "author": "carohauta", "createdAt": "2020-02-27T13:00:48Z", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/EndpointsApiController.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/**\n+ * The MIT License\n+ * Copyright (c) 2018 Estonian Information System Authority (RIA),\n+ * Nordic Institute for Interoperability Solutions (NIIS), Population Register Centre (VRK)\n+ * Copyright (c) 2015-2017 Estonian Information System Authority (RIA), Population Register Centre (VRK)\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.niis.xroad.restapi.openapi;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.niis.xroad.restapi.converter.EndpointConverter;\n+import org.niis.xroad.restapi.openapi.model.Endpoint;\n+import org.niis.xroad.restapi.service.ClientNotFoundException;\n+import org.niis.xroad.restapi.service.EndpointService;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.prepost.PreAuthorize;\n+import org.springframework.stereotype.Controller;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+\n+/**\n+ * Endpoints api\n+ */\n+@Controller\n+@RequestMapping(\"/api\")\n+@Slf4j\n+@PreAuthorize(\"denyAll\")\n+public class EndpointsApiController implements EndpointsApi {\n+\n+    private final EndpointService endpointService;\n+    private final EndpointConverter endpointConverter;\n+\n+    private static final String NOT_FOUND_ERROR_MSG = \"Endpoint not found with id\";\n+\n+    @Autowired\n+    public EndpointsApiController(\n+            EndpointService endpointService,\n+            EndpointConverter endpointConverter) {\n+        this.endpointService = endpointService;\n+        this.endpointConverter = endpointConverter;\n+    }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('VIEW_ENDPOINT')\")\n+    public ResponseEntity<Endpoint> getEndpoint(String id) {\n+        Endpoint endpoint;\n+        try {\n+            endpoint = endpointConverter.convert(endpointService.getEndpoint(id));\n+        } catch (EndpointService.EndpointNotFoundException e) {\n+            throw new ResourceNotFoundException(NOT_FOUND_ERROR_MSG + \" \" + id);\n+        }\n+        return new ResponseEntity(endpoint, HttpStatus.ACCEPTED);\n+    }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('DELETE_ENDPOINT')\")\n+    public ResponseEntity<Void> deleteEndpoint(String id) {\n+        try {\n+            endpointService.deleteEndpoint(id);\n+        } catch (EndpointService.EndpointNotFoundException e) {\n+            throw new ResourceNotFoundException(NOT_FOUND_ERROR_MSG + \" \" + id);\n+        } catch (ClientNotFoundException e) {\n+            throw new ConflictException(\"Client not found for the given endpoint with id: \" + id);\n+        }\n+        return new ResponseEntity<>(HttpStatus.NO_CONTENT);\n+    }\n+\n+    @Override\n+    @PreAuthorize(\"hasAuthority('EDIT_OPENAPI3_ENDPOINT')\")\n+    public ResponseEntity<Endpoint> updateEndpoint(String id, Endpoint endpoint) {\n+        Endpoint ep;\n+        try {\n+            ep = endpointConverter.convert(endpointService.updateEndpoint(id, endpoint));\n+        } catch (EndpointService.EndpointNotFoundException e) {\n+            throw new ResourceNotFoundException(NOT_FOUND_ERROR_MSG + \" \" + id);\n+        } catch (EndpointService.IllegalGeneratedEndpointUpdateException e) {\n+            throw new ConflictException(\"Updating is not allowed for generated endpoint \" + id);", "originalCommit": "c30e19b821240c35705101e92f08635563eb9520", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "894a7b911a397717d9e2cdb4468636a6653861ba", "url": "https://github.com/nordic-institute/X-Road/commit/894a7b911a397717d9e2cdb4468636a6653861ba", "message": "XRDDEV-801: Use camelcase consistently", "committedDate": "2020-02-27T13:36:55Z", "type": "commit"}, {"oid": "eda6e1b19573fec4fee9e25f3630878a88d73a1c", "url": "https://github.com/nordic-institute/X-Road/commit/eda6e1b19573fec4fee9e25f3630878a88d73a1c", "message": "XRDDEV-801: Changes according to review comments", "committedDate": "2020-02-27T21:03:35Z", "type": "commit"}, {"oid": "a2a33e52fa76c83d1865dd54f2b70fd46ee83d63", "url": "https://github.com/nordic-institute/X-Road/commit/a2a33e52fa76c83d1865dd54f2b70fd46ee83d63", "message": "XRDDEV-801: Prevent deleting generated endpoint via api", "committedDate": "2020-02-28T09:09:38Z", "type": "commit"}, {"oid": "2d1670c6a23b7ac399b6833f085d5d95e7b546d2", "url": "https://github.com/nordic-institute/X-Road/commit/2d1670c6a23b7ac399b6833f085d5d95e7b546d2", "message": "Merge branch 'develop' into XRDDEV-801", "committedDate": "2020-02-28T10:37:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU2NzY1MQ==", "url": "https://github.com/nordic-institute/X-Road/pull/388#discussion_r385567651", "bodyText": "Nice to see the code generator also supports asterisk as a STAR \ud83d\udc4d", "author": "carohauta", "createdAt": "2020-02-28T08:38:25Z", "path": "src/proxy-ui-api/src/main/resources/openapi-definition.yaml", "diffHunk": "@@ -4796,6 +4796,7 @@ components:\n           description: http method mapeed to this endpoint\n           example: 'GET'\n           default: '*'\n+          enum: [ '*', 'GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'HEAD', 'OPTIONS', 'TRACE' ]", "originalCommit": "eda6e1b19573fec4fee9e25f3630878a88d73a1c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}