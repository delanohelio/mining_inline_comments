{"pr_number": 414, "pr_title": "XRDDEV-886: System settings view", "pr_createdAt": "2020-03-17T07:31:18Z", "pr_url": "https://github.com/nordic-institute/X-Road/pull/414", "timeline": [{"oid": "58a69d21c44eaccbe44d06dd84fe0a50d04b97dc", "url": "https://github.com/nordic-institute/X-Road/commit/58a69d21c44eaccbe44d06dd84fe0a50d04b97dc", "message": "XRDDEV-886: initial layout", "committedDate": "2020-03-11T11:25:34Z", "type": "commit"}, {"oid": "a92f99c8372412f37e686707723ab24e71ea8b83", "url": "https://github.com/nordic-institute/X-Road/commit/a92f99c8372412f37e686707723ab24e71ea8b83", "message": "XRDDEV-886: permission handling, rest service connection for anchor and TSP", "committedDate": "2020-03-11T13:02:37Z", "type": "commit"}, {"oid": "156dd9fa666f6f9c90b7a675ce6fb8af5f0cdcb4", "url": "https://github.com/nordic-institute/X-Road/commit/156dd9fa666f6f9c90b7a675ce6fb8af5f0cdcb4", "message": "XRDDEV-886: type definitions from XRDDEV-885 branch", "committedDate": "2020-03-12T10:54:04Z", "type": "commit"}, {"oid": "db9067d9b02907c44a02ae2422fe035c83dbb16e", "url": "https://github.com/nordic-institute/X-Road/commit/db9067d9b02907c44a02ae2422fe035c83dbb16e", "message": "XRDDEV-886: linting and approved CA api call", "committedDate": "2020-03-12T11:30:49Z", "type": "commit"}, {"oid": "c4d33ae2e823fa377752b31d8542af9106c503ed", "url": "https://github.com/nordic-institute/X-Road/commit/c4d33ae2e823fa377752b31d8542af9106c503ed", "message": "XRDDEV-886: approved CA implementation", "committedDate": "2020-03-17T07:29:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzU0MDQwMw==", "url": "https://github.com/nordic-institute/X-Road/pull/414#discussion_r393540403", "bodyText": "The hearers are \"black\" or darker in the design.\nAlso some fonts seem larger or bolder compared to the design.", "author": "Riippi", "createdAt": "2020-03-17T09:21:07Z", "path": "src/proxy-ui-api/frontend/src/views/Settings/SystemParameters/SystemParameters.vue", "diffHunk": "@@ -0,0 +1,175 @@\n+<template>\n+  <div class=\"pt-2\">\n+    <v-card flat class=\"xrd-card\">\n+      <v-container>\n+        <v-row v-if=\"hasPermission(permissions.VIEW_ANCHOR)\">\n+          <v-col><h3>{{$t('systemParameters.configurationAnchor.title')}}</h3></v-col>\n+          <v-col class=\"text-right\">\n+            <large-button data-test=\"system-parameters-configuration-anchor-download-button\" outlined :requires-permission=\"permissions.DOWNLOAD_ANCHOR\">\n+              {{$t('systemParameters.configurationAnchor.action.download')}}\n+            </large-button>\n+            <large-button data-test=\"system-parameters-configuration-anchor-upload-button\" outlined :requires-permission=\"permissions.UPLOAD_ANCHOR\" class=\"ml-5\">\n+              {{$t('systemParameters.configurationAnchor.action.upload')}}\n+            </large-button>\n+          </v-col>\n+        </v-row>\n+        <v-row v-if=\"hasPermission(permissions.VIEW_ANCHOR)\">\n+          <v-col>\n+            <table class=\"xrd-table\">\n+              <thead>\n+              <tr>\n+                <th>{{$t('systemParameters.configurationAnchor.table.header.distinguishedName')}}</th>\n+                <th>{{$t('systemParameters.configurationAnchor.table.header.generated')}}</th>\n+              </tr>\n+              </thead>\n+              <tbody data-test=\"system-parameters-configuration-anchor-table-body\">\n+              <tr>\n+                <td>{{this.configuratonAnchor.hash}}</td>\n+                <td>{{this.configuratonAnchor.created_at | formatDateTime}}</td>\n+              </tr>\n+              </tbody>\n+            </table>\n+          </v-col>\n+        </v-row>\n+        <v-row class=\"mt-5\" v-if=\"hasPermission(permissions.VIEW_TSPS)\">\n+          <v-col><h3>{{$t('systemParameters.timestampingServices.title')}}</h3></v-col>\n+          <v-col class=\"text-right\">\n+            <large-button data-test=\"system-parameters-timestamping-services-add-button\" outlined :requires-permission=\"permissions.ADD_TSP\">\n+              {{$t('systemParameters.timestampingServices.action.add')}}\n+            </large-button>\n+          </v-col>\n+        </v-row>\n+        <v-row v-if=\"hasPermission(permissions.VIEW_TSPS)\">\n+          <v-col>\n+            <table class=\"xrd-table\">\n+              <thead>\n+              <tr>\n+                <th>{{$t('systemParameters.timestampingServices.table.header.certificateHash')}}</th>\n+                <th>{{$t('systemParameters.timestampingServices.table.header.serviceURL')}}</th>\n+                <th>&nbsp;</th>\n+              </tr>\n+              </thead>\n+              <tbody data-test=\"system-parameters-timestamping-services-table-body\">\n+              <tr v-for=\"timestampingService in this.configuredTimestampingServices\" :key=\"timestampingService.url\">\n+                <td>{{timestampingService.name}}</td>\n+                <td>{{timestampingService.url}}</td>\n+                <td>\n+                  <small-button data-test=\"system-parameters-timestamping-services-delete-button\" outlined :requires-permission=\"permissions.DELETE_TSP\">\n+                    {{$t('systemParameters.timestampingServices.table.action.delete')}}\n+                  </small-button>\n+                </td>\n+              </tr>\n+              </tbody>\n+            </table>\n+          </v-col>\n+        </v-row>\n+        <v-row class=\"mt-5\">\n+          <v-col><h3>{{$t('systemParameters.approvedCertificateAuthorities.title')}}</h3></v-col>\n+        </v-row>\n+        <v-row>\n+          <v-col>\n+            <table class=\"xrd-table\">\n+              <thead>\n+              <tr>\n+                <th>{{$t('systemParameters.approvedCertificateAuthorities.table.header.distinguishedName')}}</th>\n+                <th>{{$t('systemParameters.approvedCertificateAuthorities.table.header.ocspResponse')}}</th>\n+                <th>{{$t('systemParameters.approvedCertificateAuthorities.table.header.expires')}}</th>\n+              </tr>\n+              </thead>\n+              <tbody data-test=\"system-parameters-approved-ca-table-body\">\n+              <tr v-for=\"approvedCA in orderedCertificateAuthorities\" :key=\"approvedCA.path\">\n+                <td :class=\"{'interm-ca': !approvedCA.top_ca}\">{{approvedCA.subject_distinguished_name}}</td>\n+                <td v-if=\"approvedCA.top_ca\">{{$t('systemParameters.approvedCertificateAuthorities.table.ocspResponse.NOT_AVAILABLE')}}</td>\n+                <td v-if=\"!approvedCA.top_ca\">{{$t(`systemParameters.approvedCertificateAuthorities.table.ocspResponse.${approvedCA.ocsp_response}`)}}</td>\n+                <td>{{approvedCA.not_after | formatDate}}</td>\n+              </tr>\n+              </tbody>\n+            </table>\n+          </v-col>\n+        </v-row>\n+      </v-container>\n+    </v-card>\n+  </div>\n+</template>\n+\n+<script lang=\"ts\">\n+import Vue from 'vue';\n+import LargeButton from '@/components/ui/LargeButton.vue';\n+import SmallButton from '@/components/ui/SmallButton.vue';\n+import { Anchor, CertificateAuthority, TimestampingService } from '@/types';\n+import * as api from '@/util/api';\n+import { Permissions } from '@/global';\n+\n+export default Vue.extend({\n+  components: {\n+    LargeButton,\n+    SmallButton,\n+  },\n+  data() {\n+    return {\n+      configuratonAnchor: {} as Anchor,\n+      configuredTimestampingServices: [] as TimestampingService[],\n+      certificateAuthorities: [] as CertificateAuthority[],\n+      permissions: Permissions,\n+    };\n+  },\n+  computed: {\n+    orderedCertificateAuthorities(): CertificateAuthority[] {\n+      return this.certificateAuthorities.sort((authorityA, authorityB) => authorityA.path.localeCompare(authorityB.path));\n+    },\n+  },\n+  methods: {\n+    hasPermission(permission: Permissions): boolean {\n+      return this.$store.getters.hasPermission(permission);\n+    },\n+    async fetchConfigurationAnchor() {\n+      return api.get('/system/anchor')\n+        .then((resp) => this.configuratonAnchor = resp.data)\n+        .catch((error) => this.$bus.$emit('show-error', error.message));\n+    },\n+    async fetchConfiguredTimestampingServiced() {\n+      return api.get('/system/timestamping-services')\n+        .then((resp) => this.configuredTimestampingServices = resp.data)\n+        .catch((error) => this.$bus.$emit('show-error', error.message));\n+    },\n+    async fetchApprovedCertificateAuthorities() {\n+      return api.get('/certificate-authorities?include_intermediate_cas=true')\n+        .then((resp) => this.certificateAuthorities = resp.data)\n+        .catch((error) => this.$bus.$emit('show-error', error.message));\n+    },\n+  },\n+  created(): void {\n+    this.fetchConfigurationAnchor();\n+    this.fetchConfiguredTimestampingServiced();\n+    this.fetchApprovedCertificateAuthorities();\n+  },\n+});\n+</script>\n+\n+<style lang=\"scss\" scoped>\n+  @import \"../../../assets/colors\";\n+  @import '../../../assets/tables';\n+\n+  h3 {\n+    color: $XRoad-Grey60;", "originalCommit": "c4d33ae2e823fa377752b31d8542af9106c503ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzU1NzAwNw==", "url": "https://github.com/nordic-institute/X-Road/pull/414#discussion_r393557007", "bodyText": "Fixed the styling to better match the design", "author": "raits", "createdAt": "2020-03-17T09:49:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzU0MDQwMw=="}], "type": "inlineReview"}, {"oid": "906ecfde47b8a6938c808bf5e63781f8505592d5", "url": "https://github.com/nordic-institute/X-Road/commit/906ecfde47b8a6938c808bf5e63781f8505592d5", "message": "XRDDEV-886: styling fixes", "committedDate": "2020-03-17T09:48:57Z", "type": "commit"}, {"oid": "c6ec281b0c1b63067db53107c8f7f560c9941965", "url": "https://github.com/nordic-institute/X-Road/commit/c6ec281b0c1b63067db53107c8f7f560c9941965", "message": "Merge branch 'develop' into XRDDEV-886", "committedDate": "2020-03-17T09:52:36Z", "type": "commit"}]}