{"pr_number": 475, "pr_title": "XRDDEV-958", "pr_createdAt": "2020-04-24T10:41:30Z", "pr_url": "https://github.com/nordic-institute/X-Road/pull/475", "timeline": [{"oid": "d6f0fbc329d10058c394a3b39a1d2709caf5ce27", "url": "https://github.com/nordic-institute/X-Road/commit/d6f0fbc329d10058c394a3b39a1d2709caf5ce27", "message": "XRDDEV-958: Add title to Service object as it is needed in the frontend", "committedDate": "2020-04-23T18:40:27Z", "type": "commit"}, {"oid": "a9e9ab7e8ddce9fdcc51ff3e1acddaa3467fef19", "url": "https://github.com/nordic-institute/X-Road/commit/a9e9ab7e8ddce9fdcc51ff3e1acddaa3467fef19", "message": "XRDDEV-958: Implementation for adding access rights to service client", "committedDate": "2020-04-23T18:41:18Z", "type": "commit"}, {"oid": "407aa759e438d4456f9e618f3ea29bf44ea6376d", "url": "https://github.com/nordic-institute/X-Road/commit/407aa759e438d4456f9e618f3ea29bf44ea6376d", "message": "XRDDEV-958: Use default input checkbox and improve usability for adding service client access rights", "committedDate": "2020-04-24T10:40:25Z", "type": "commit"}, {"oid": "d2f5b41da40d020e093a6356adbee50b3a260fbb", "url": "https://github.com/nordic-institute/X-Road/commit/d2f5b41da40d020e093a6356adbee50b3a260fbb", "message": "XRDDEV-958: Fix minor build issues. Added typings. Improved namings.", "committedDate": "2020-04-24T11:05:46Z", "type": "commit"}, {"oid": "83eaaf6e8d03d3d9be84e7d37f57224e311824a3", "url": "https://github.com/nordic-institute/X-Road/commit/83eaaf6e8d03d3d9be84e7d37f57224e311824a3", "message": "XRDDEV-958: Use checkbox from vuetify", "committedDate": "2020-04-24T14:52:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1NjAzMQ==", "url": "https://github.com/nordic-institute/X-Road/pull/475#discussion_r416756031", "bodyText": "I suppose that there is no interface in the types for the object that this method returns.\nWould it make sense to create an interface that extends AccessRight just for the ui ?\nIf so, then this might be a good place for it\nhttps://github.com/nordic-institute/X-Road/blob/develop/src/proxy-ui-api/frontend/src/ui-types.ts", "author": "Riippi", "createdAt": "2020-04-28T16:31:26Z", "path": "src/proxy-ui-api/frontend/src/views/Clients/ServiceClients/ServiceClientAccessRights.vue", "diffHunk": "@@ -99,36 +108,83 @@ export default Vue.extend({\n     return {\n       accessRights: [] as AccessRight[],\n       serviceClient: {} as ServiceClient,\n+      isAddServiceDialogVisible: false as boolean,\n+      serviceDescriptions: [] as ServiceDescription[],\n+      services: [] as Service[],\n     };\n   },\n   methods: {\n     fetchData() {\n \n+      this.fetchAccessRights();\n+\n       api\n         .get(`/clients/${this.id}/service-clients/${this.serviceClientId}`)\n         .then( (response: any) => this.serviceClient = response.data)\n-        .catch( (error: any) =>\n-          this.$store.dispatch('showError', error));\n+        .catch( (error: any) => this.$store.dispatch('showError', error));\n \n+      api\n+        .get(`/clients/${this.id}/service-descriptions`)\n+        .then( (response: any) => {\n+          this.serviceDescriptions = response.data;\n+        })\n+        .catch( (error: any) => this.$store.dispatch('showError', error));\n+    },\n+    fetchAccessRights() {\n       api\n         .get(`/clients/${this.id}/service-clients/${this.serviceClientId}/access-rights`)\n         .then( (response: any) => this.accessRights = response.data)\n-        .catch( (error: any) =>\n-          this.$store.dispatch('showError', error));\n-\n+        .catch( (error: any) => this.$store.dispatch('showError', error));\n     },\n-    close() {\n+    close(): void {\n       this.$router.go(-1);\n     },\n-    remove() {\n-      // NOOP\n+    addService(accessRights: AccessRight[]): void {\n+      this.hideAddService();\n+\n+      const accessRightsObject: AccessRights = { items: accessRights };\n+      api\n+        .post(`/clients/${this.id}/service-clients/${this.serviceClientId}/access-rights`, accessRightsObject)\n+        .then( (response: any) => {\n+          this.$store.dispatch('showSuccess', 'serviceClients.addServiceClientAccessRightSuccess');\n+          this.fetchAccessRights();\n+        })\n+        .catch( (error: any) => this.$store.dispatch('showError', error));\n     },\n-    addService() {\n+    hideAddService(): void {\n+      this.isAddServiceDialogVisible = false;\n+    },\n+    remove(): void {\n       // NOOP\n     },\n-    removeAll() {\n+    showAddServiceDialog(): void {\n+      this.isAddServiceDialogVisible = true;\n+    },\n+    removeAll(): void {\n       // NOOP\n     },\n+    serviceCandidates(): any[] {", "originalCommit": "83eaaf6e8d03d3d9be84e7d37f57224e311824a3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc1NTg4Nw==", "url": "https://github.com/nordic-institute/X-Road/pull/475#discussion_r417755887", "bodyText": "No such file in my branch so I can't use it. Added a ServiceCandidate-type directly to ServiceClientAcccessRights.vue", "author": "TJaakkola", "createdAt": "2020-04-30T05:07:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1NjAzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1NjQ4NA==", "url": "https://github.com/nordic-institute/X-Road/pull/475#discussion_r416756484", "bodyText": "return type void ?", "author": "Riippi", "createdAt": "2020-04-28T16:32:03Z", "path": "src/proxy-ui-api/frontend/src/views/Clients/ServiceClients/ServiceClientAccessRights.vue", "diffHunk": "@@ -99,36 +108,83 @@ export default Vue.extend({\n     return {\n       accessRights: [] as AccessRight[],\n       serviceClient: {} as ServiceClient,\n+      isAddServiceDialogVisible: false as boolean,\n+      serviceDescriptions: [] as ServiceDescription[],\n+      services: [] as Service[],\n     };\n   },\n   methods: {\n     fetchData() {\n \n+      this.fetchAccessRights();\n+\n       api\n         .get(`/clients/${this.id}/service-clients/${this.serviceClientId}`)\n         .then( (response: any) => this.serviceClient = response.data)\n-        .catch( (error: any) =>\n-          this.$store.dispatch('showError', error));\n+        .catch( (error: any) => this.$store.dispatch('showError', error));\n \n+      api\n+        .get(`/clients/${this.id}/service-descriptions`)\n+        .then( (response: any) => {\n+          this.serviceDescriptions = response.data;\n+        })\n+        .catch( (error: any) => this.$store.dispatch('showError', error));\n+    },\n+    fetchAccessRights() {", "originalCommit": "83eaaf6e8d03d3d9be84e7d37f57224e311824a3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc1NTk2MA==", "url": "https://github.com/nordic-institute/X-Road/pull/475#discussion_r417755960", "bodyText": "added.", "author": "TJaakkola", "createdAt": "2020-04-30T05:07:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1NjQ4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1NjYxNQ==", "url": "https://github.com/nordic-institute/X-Road/pull/475#discussion_r416756615", "bodyText": "return type void ?", "author": "Riippi", "createdAt": "2020-04-28T16:32:13Z", "path": "src/proxy-ui-api/frontend/src/views/Clients/ServiceClients/ServiceClientAccessRights.vue", "diffHunk": "@@ -99,36 +108,83 @@ export default Vue.extend({\n     return {\n       accessRights: [] as AccessRight[],\n       serviceClient: {} as ServiceClient,\n+      isAddServiceDialogVisible: false as boolean,\n+      serviceDescriptions: [] as ServiceDescription[],\n+      services: [] as Service[],\n     };\n   },\n   methods: {\n     fetchData() {", "originalCommit": "83eaaf6e8d03d3d9be84e7d37f57224e311824a3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc1NjA0MQ==", "url": "https://github.com/nordic-institute/X-Road/pull/475#discussion_r417756041", "bodyText": "added.", "author": "TJaakkola", "createdAt": "2020-04-30T05:08:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1NjYxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1NzUxNQ==", "url": "https://github.com/nordic-institute/X-Road/pull/475#discussion_r416757515", "bodyText": "is there a reason to use any?", "author": "Riippi", "createdAt": "2020-04-28T16:33:40Z", "path": "src/proxy-ui-api/frontend/src/views/Clients/ServiceClients/AddServiceClientServiceDialog.vue", "diffHunk": "@@ -0,0 +1,115 @@\n+<template>\n+  <simpleDialog\n+    :dialog=\"dialog\"\n+    :width=\"750\"\n+    title=\"serviceClients.addService\"\n+    @save=\"save\"\n+    @cancel=\"cancel\"\n+    :disableSave=\"filterSelections().length === 0\"\n+  >\n+    <div slot=\"content\" v-if=\"this.serviceCandidates.length > 0\">\n+      <v-text-field v-model=\"search\"\n+                    :label=\"$t('serviceClients.searchPlaceHolder')\"\n+                    single-line\n+                    hide-details\n+                    data-test=\"search-service-client\"\n+                    class=\"search-input\">\n+        <v-icon slot=\"append\">mdi-magnify</v-icon>\n+      </v-text-field>\n+      <table class=\"xrd-table\">\n+        <thead>\n+        <tr>\n+          <th class=\"selection-checkbox\"></th>\n+          <th>{{$t('serviceClients.serviceCode')}}</th>\n+          <th>{{$t('serviceClients.title')}}</th>\n+        </tr>\n+        </thead>\n+        <tbody>\n+        <tr v-for=\"accessRight in searchResults()\"\n+            v-bind:key=\"accessRight.id\"\n+            class=\"service-row\"\n+            data-test=\"access-right-toggle\">\n+          <td class=\"selection-checkbox\">\n+            <div>\n+              <v-checkbox\n+                v-model=\"selections\"\n+                :value=\"accessRight\"\n+                data-test=\"access-right-checkbox-input\"\n+              /></div>\n+          </td>\n+          <td>{{accessRight.service_code}}</td>\n+          <td>{{accessRight.title}}</td>\n+        </tr>\n+        </tbody>\n+      </table>\n+    </div>\n+    <div slot=\"content\" v-else>\n+      <h3>{{$t('serviceClients.noAvailableServices')}}</h3>\n+    </div>\n+  </simpleDialog>\n+</template>\n+<script lang=\"ts\">\n+  import Vue from 'vue';\n+  import SimpleDialog from '@/components/ui/SimpleDialog.vue';\n+  import {AccessRight} from '@/types';\n+  export default Vue.extend({\n+    components: {\n+      SimpleDialog,\n+    },\n+    props: {\n+      dialog: {\n+        type: Boolean,\n+        required: true,\n+      },\n+      serviceCandidates: {\n+        type: Array,\n+        required: true,\n+      },\n+    },\n+    data() {\n+      return {\n+        selections: [] as AccessRight[],\n+        search: '' as string,\n+      };\n+    },\n+    methods: {\n+      save(): void {\n+        const items = this.selections\n+          .filter( (selection) => selection.service_code.includes(this.search))\n+          .map( (selection): AccessRight => ({service_code: selection.service_code}));\n+\n+        this.$emit('save', items);\n+        this.clear();\n+      },\n+      cancel(): void {\n+        this.$emit('cancel');\n+        this.clear();\n+      },\n+      clear(): void {\n+        this.selections = [];\n+      },\n+      searchResults(): any {", "originalCommit": "83eaaf6e8d03d3d9be84e7d37f57224e311824a3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1Nzk5OQ==", "url": "https://github.com/nordic-institute/X-Road/pull/475#discussion_r416757999", "bodyText": "also same one line down here", "author": "Riippi", "createdAt": "2020-04-28T16:34:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1NzUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc1NDAzNg==", "url": "https://github.com/nordic-institute/X-Road/pull/475#discussion_r417754036", "bodyText": "serviceCandidates is a propvalue. I haven't found a working way to type them, is there such a way?", "author": "TJaakkola", "createdAt": "2020-04-30T04:59:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1NzUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc1Njk4MQ==", "url": "https://github.com/nordic-institute/X-Road/pull/475#discussion_r417756981", "bodyText": "Just marked the return type to ServiceCandidate[]", "author": "TJaakkola", "createdAt": "2020-04-30T05:11:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1NzUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc3OTkzNg==", "url": "https://github.com/nordic-institute/X-Road/pull/475#discussion_r417779936", "bodyText": "Good question. I don't know a good way to do that either.", "author": "Riippi", "createdAt": "2020-04-30T06:21:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1NzUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc4MjI0Nw==", "url": "https://github.com/nordic-institute/X-Road/pull/475#discussion_r417782247", "bodyText": "You can use Prop so this would be:\ntype: Array as Prop<ServiceCandidate[]>", "author": "raits", "createdAt": "2020-04-30T06:27:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1NzUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg5MTU4Mw==", "url": "https://github.com/nordic-institute/X-Road/pull/475#discussion_r417891583", "bodyText": "Hmm, I think I tried that at some point. Don't remember how but it didn't work as well typings in data-block. Anyway I'll give it another shot...", "author": "TJaakkola", "createdAt": "2020-04-30T09:52:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1NzUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzkwMDUxNw==", "url": "https://github.com/nordic-institute/X-Road/pull/475#discussion_r417900517", "bodyText": "Ah I guess I tried something similar but it didn't work. But this does \ud83d\udc4d", "author": "TJaakkola", "createdAt": "2020-04-30T10:08:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc1NzUxNQ=="}], "type": "inlineReview"}, {"oid": "9538aae4992c923eb25bec7f0607dd0abca6a658", "url": "https://github.com/nordic-institute/X-Road/commit/9538aae4992c923eb25bec7f0607dd0abca6a658", "message": "XRDDEV-958: Add typings", "committedDate": "2020-04-30T05:11:00Z", "type": "commit"}, {"oid": "e3424381c36275acc594d670405fb4bd6b0cc766", "url": "https://github.com/nordic-institute/X-Road/commit/e3424381c36275acc594d670405fb4bd6b0cc766", "message": "XRDDEV-958: Fix linting errors", "committedDate": "2020-04-30T05:45:23Z", "type": "commit"}, {"oid": "30a8d6d4bfe6d970307dfc4d85fbf0f5d157c35e", "url": "https://github.com/nordic-institute/X-Road/commit/30a8d6d4bfe6d970307dfc4d85fbf0f5d157c35e", "message": "XRDDEV-958: Add typings to props & fix failing audit check", "committedDate": "2020-04-30T10:21:00Z", "type": "commit"}, {"oid": "246f5f54824be1cc60b9be11844b6a5e5ec6d166", "url": "https://github.com/nordic-institute/X-Road/commit/246f5f54824be1cc60b9be11844b6a5e5ec6d166", "message": "XRDDEV-958: Changed services to contain plain servicecode and fullservicecode", "committedDate": "2020-05-04T19:20:00Z", "type": "commit"}, {"oid": "dc856f1a5825e5070050829b6872ac5620d587c9", "url": "https://github.com/nordic-institute/X-Road/commit/dc856f1a5825e5070050829b6872ac5620d587c9", "message": "Merge branch 'develop' into XRDDEV-958", "committedDate": "2020-05-06T12:03:37Z", "type": "commit"}]}