{"pr_number": 463, "pr_title": "XRDDEV-936 diagnostics view", "pr_createdAt": "2020-04-15T10:20:47Z", "pr_url": "https://github.com/nordic-institute/X-Road/pull/463", "timeline": [{"oid": "edf34190cfbbd9035be92669b0d216db8c715f75", "url": "https://github.com/nordic-institute/X-Road/commit/edf34190cfbbd9035be92669b0d216db8c715f75", "message": "XRDDEV-936 Add skeleton view for diagnostics", "committedDate": "2020-04-02T11:33:29Z", "type": "commit"}, {"oid": "9b23854ce6e6cfcc753d50d3dc315107c794f0ff", "url": "https://github.com/nordic-institute/X-Road/commit/9b23854ce6e6cfcc753d50d3dc315107c794f0ff", "message": "Merge branch 'develop' into XRDDEV-936-diagnostics-ui", "committedDate": "2020-04-10T12:19:34Z", "type": "commit"}, {"oid": "29d7fd4b9696153999bcb885d0b7476b73fa31af", "url": "https://github.com/nordic-institute/X-Road/commit/29d7fd4b9696153999bcb885d0b7476b73fa31af", "message": "XRDDEV-936 Update types", "committedDate": "2020-04-10T12:20:48Z", "type": "commit"}, {"oid": "2d914e2469af44b08dec2db067047669fceaea7a", "url": "https://github.com/nordic-institute/X-Road/commit/2d914e2469af44b08dec2db067047669fceaea7a", "message": "XRDDEV-936 Add real backend data", "committedDate": "2020-04-14T13:55:28Z", "type": "commit"}, {"oid": "f95ea6cfa7c8d7bf86830637c23bcbd1d62d1333", "url": "https://github.com/nordic-institute/X-Road/commit/f95ea6cfa7c8d7bf86830637c23bcbd1d62d1333", "message": "Merge branch 'develop' into XRDDEV-936-diagnostics-ui", "committedDate": "2020-04-14T14:28:47Z", "type": "commit"}, {"oid": "f1c692492be520dba2c5b5631f5cacea458f8895", "url": "https://github.com/nordic-institute/X-Road/commit/f1c692492be520dba2c5b5631f5cacea458f8895", "message": "XRDDEV-936 Update types", "committedDate": "2020-04-14T16:19:02Z", "type": "commit"}, {"oid": "d1003695624261179824a8af13f3e63bfbf950f6", "url": "https://github.com/nordic-institute/X-Road/commit/d1003695624261179824a8af13f3e63bfbf950f6", "message": "XRDDEV-936 Update icons and strings", "committedDate": "2020-04-14T16:24:40Z", "type": "commit"}, {"oid": "ec14d502c6107fd612b28fb368571e3cedd55194", "url": "https://github.com/nordic-institute/X-Road/commit/ec14d502c6107fd612b28fb368571e3cedd55194", "message": "XRDDEV-936 Update localisations", "committedDate": "2020-04-15T06:16:47Z", "type": "commit"}, {"oid": "d6ceff244af1ef80aca18cf4dc3e9271c1897b10", "url": "https://github.com/nordic-institute/X-Road/commit/d6ceff244af1ef80aca18cf4dc3e9271c1897b10", "message": "XRDDEV-936 Fix date filters", "committedDate": "2020-04-15T08:34:12Z", "type": "commit"}, {"oid": "410e1dc130324f2262347e56a5905442665083b4", "url": "https://github.com/nordic-institute/X-Road/commit/410e1dc130324f2262347e56a5905442665083b4", "message": "XRDDEV-936 Fix linter errors", "committedDate": "2020-04-15T08:35:37Z", "type": "commit"}, {"oid": "15b1b745581e383fa5862e9dce215c07fd2571ef", "url": "https://github.com/nordic-institute/X-Road/commit/15b1b745581e383fa5862e9dce215c07fd2571ef", "message": "XRDDEV-936 Adjust column sizes", "committedDate": "2020-04-15T10:17:22Z", "type": "commit"}, {"oid": "dca13d4dc390f5fac38e093ebb1c51df751097bf", "url": "https://github.com/nordic-institute/X-Road/commit/dca13d4dc390f5fac38e093ebb1c51df751097bf", "message": "Merge branch 'develop' into XRDDEV-936-diagnostics-ui\n\n# Conflicts:\n#\tsrc/proxy-ui-api/frontend/src/locales/en.json\n#\tsrc/proxy-ui-api/frontend/src/types.ts", "committedDate": "2020-04-24T15:30:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc0MzY3OA==", "url": "https://github.com/nordic-institute/X-Road/pull/463#discussion_r414743678", "bodyText": "typo", "author": "TJaakkola", "createdAt": "2020-04-24T17:30:08Z", "path": "src/proxy-ui-api/frontend/src/views/Diagnostics/Diagnostics.vue", "diffHunk": "@@ -1,16 +1,216 @@\n <template>\n   <v-layout align-center justify-center column fill-height elevation-0>\n-    <div>Placeholder</div>\n+    <v-card class=\"xrd-card diagnostic-card\">\n+      <v-card-title>\n+        <span class=\"headline\">{{$t('diagnostics.globalCongiguration.title')}}</span>\n+      </v-card-title>\n+      <v-card-text class=\"pt-4\">\n+        <table class=\"xrd-table\">\n+          <thead>\n+            <tr>\n+              <th class=\"status-column\">{{$t('diagnostics.status')}}</th>\n+              <th>{{$t('diagnostics.message')}}</th>\n+              <th class=\"time-column\">{{$t('diagnostics.previousUpdate')}}</th>\n+              <th class=\"time-column\">{{$t('diagnostics.nextUpdate')}}</th>\n+            </tr>\n+          </thead>\n+          <tbody>\n+            <tr v-if=\"globalconf\">\n+              <td>\n+                <StatusIcon :status=\"statusIconType(globalconf.status_class)\" />\n+              </td>\n+\n+              <td>{{$t('diagnostics.globalCongiguration.configurationStatus.'+globalconf.status_code)}}</td>\n+              <td class=\"time-column\">{{globalconf.prev_update_at | formatHoursMins}}</td>\n+              <td class=\"time-column\">{{globalconf.next_update_at | formatHoursMins}}</td>\n+            </tr>\n+          </tbody>\n+        </table>\n+      </v-card-text>\n+    </v-card>\n+\n+    <v-card class=\"xrd-card diagnostic-card\">\n+      <v-card-title>\n+        <span class=\"headline\">{{$t('diagnostics.timestamping.title')}}</span>\n+      </v-card-title>\n+      <v-card-text class=\"pt-4\">\n+        <table class=\"xrd-table\">\n+          <thead>\n+            <tr>\n+              <th class=\"status-column\">{{$t('diagnostics.status')}}</th>\n+              <th class=\"url-column\">{{$t('diagnostics.serviceUrl')}}</th>\n+              <th>{{$t('diagnostics.message')}}</th>\n+              <th class=\"time-column\">{{$t('diagnostics.nextUpdate')}}</th>\n+            </tr>\n+          </thead>\n+          <tbody>\n+            <tr\n+              v-for=\"timestampingService in timestapmingServices\"\n+              v-bind:key=\"timestampingService.url\"\n+            >\n+              <td>\n+                <StatusIcon :status=\"statusIconType(timestampingService.status_class)\" />\n+              </td>\n+              <td class=\"url-column\" data-test=\"service-url\">{{timestampingService.url}}</td>\n+              <td>{{$t('diagnostics.timestamping.timestampingStatus.'+timestampingService.status_code)}}</td>\n+              <td class=\"time-column\">{{timestampingService.prev_update_at | formatHoursMins}}</td>\n+            </tr>\n+          </tbody>\n+        </table>\n+      </v-card-text>\n+    </v-card>\n+\n+    <v-card class=\"xrd-card diagnostic-card\">\n+      <v-card-title>\n+        <span class=\"headline\">{{$t('diagnostics.ocspResponders.title')}}</span>\n+      </v-card-title>\n+      <v-card-text class=\"pt-4\">\n+        <div\n+          v-for=\"ocspDiags in ocspResponderDiagnostics\"\n+          v-bind:key=\"ocspDiags.distinguished_name\"\n+        >\n+          <div class=\"cert-service-name\">\n+            <span>{{$t('diagnostics.ocspResponders.certificationService')}}</span>\n+            {{ocspDiags.distinguished_name}}\n+          </div>\n+          <table class=\"xrd-table\">\n+            <thead>\n+              <tr>\n+                <th class=\"status-column\">{{$t('diagnostics.status')}}</th>\n+                <th class=\"url-column\">{{$t('diagnostics.serviceUrl')}}</th>\n+                <th>{{$t('diagnostics.message')}}</th>\n+                <th class=\"time-column\">{{$t('diagnostics.previousUpdate')}}</th>\n+                <th class=\"time-column\">{{$t('diagnostics.nextUpdate')}}</th>\n+              </tr>\n+            </thead>\n+            <tbody>\n+              <tr v-for=\"ocsp in ocspDiags.ocsp_responders\" v-bind:key=\"ocsp.url\">\n+                <td>\n+                  <StatusIcon :status=\"statusIconType(ocsp.status_class)\" />\n+                </td>\n+                <td class=\"url-column\" data-test=\"service-url\">{{ocsp.url}}</td>\n+                <td>{{$t('diagnostics.ocspResponders.ocspStatus.'+ocsp.status_code)}}</td>\n+                <td class=\"time-column\">{{ocsp.prev_update_at | formatHoursMins}}</td>\n+                <td class=\"time-column\">{{ocsp.next_update_at | formatHoursMins}}</td>\n+              </tr>\n+            </tbody>\n+          </table>\n+        </div>\n+      </v-card-text>\n+    </v-card>\n   </v-layout>\n </template>\n \n <script lang=\"ts\">\n import Vue from 'vue';\n+import * as api from '@/util/api';\n+import {\n+  TimestampingServiceDiagnostics,\n+  OcspResponderDiagnostics,\n+  GlobalConfDiagnostics,\n+} from '@/types';\n+import StatusIcon from '@/components/ui/StatusIcon.vue';\n \n export default Vue.extend({\n-  data: () => ({}),\n+  components: {\n+    StatusIcon,\n+  },\n+  data: () => ({\n+    timestapmingServices: [] as TimestampingServiceDiagnostics[],", "originalCommit": "dca13d4dc390f5fac38e093ebb1c51df751097bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI3NTQwNA==", "url": "https://github.com/nordic-institute/X-Road/pull/463#discussion_r415275404", "bodyText": "Fixed", "author": "Riippi", "createdAt": "2020-04-26T10:24:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc0MzY3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc0NTIxNg==", "url": "https://github.com/nordic-institute/X-Road/pull/463#discussion_r414745216", "bodyText": "Preferably group all the style rules of a single element to same place. This width: 100%; and margin-bottom: 30px; below should stay next to each other so it'll be easier to see what rules are set for this class.", "author": "TJaakkola", "createdAt": "2020-04-24T17:32:38Z", "path": "src/proxy-ui-api/frontend/src/views/Diagnostics/Diagnostics.vue", "diffHunk": "@@ -1,16 +1,216 @@\n <template>\n   <v-layout align-center justify-center column fill-height elevation-0>\n-    <div>Placeholder</div>\n+    <v-card class=\"xrd-card diagnostic-card\">\n+      <v-card-title>\n+        <span class=\"headline\">{{$t('diagnostics.globalCongiguration.title')}}</span>\n+      </v-card-title>\n+      <v-card-text class=\"pt-4\">\n+        <table class=\"xrd-table\">\n+          <thead>\n+            <tr>\n+              <th class=\"status-column\">{{$t('diagnostics.status')}}</th>\n+              <th>{{$t('diagnostics.message')}}</th>\n+              <th class=\"time-column\">{{$t('diagnostics.previousUpdate')}}</th>\n+              <th class=\"time-column\">{{$t('diagnostics.nextUpdate')}}</th>\n+            </tr>\n+          </thead>\n+          <tbody>\n+            <tr v-if=\"globalconf\">\n+              <td>\n+                <StatusIcon :status=\"statusIconType(globalconf.status_class)\" />\n+              </td>\n+\n+              <td>{{$t('diagnostics.globalCongiguration.configurationStatus.'+globalconf.status_code)}}</td>\n+              <td class=\"time-column\">{{globalconf.prev_update_at | formatHoursMins}}</td>\n+              <td class=\"time-column\">{{globalconf.next_update_at | formatHoursMins}}</td>\n+            </tr>\n+          </tbody>\n+        </table>\n+      </v-card-text>\n+    </v-card>\n+\n+    <v-card class=\"xrd-card diagnostic-card\">\n+      <v-card-title>\n+        <span class=\"headline\">{{$t('diagnostics.timestamping.title')}}</span>\n+      </v-card-title>\n+      <v-card-text class=\"pt-4\">\n+        <table class=\"xrd-table\">\n+          <thead>\n+            <tr>\n+              <th class=\"status-column\">{{$t('diagnostics.status')}}</th>\n+              <th class=\"url-column\">{{$t('diagnostics.serviceUrl')}}</th>\n+              <th>{{$t('diagnostics.message')}}</th>\n+              <th class=\"time-column\">{{$t('diagnostics.nextUpdate')}}</th>\n+            </tr>\n+          </thead>\n+          <tbody>\n+            <tr\n+              v-for=\"timestampingService in timestapmingServices\"\n+              v-bind:key=\"timestampingService.url\"\n+            >\n+              <td>\n+                <StatusIcon :status=\"statusIconType(timestampingService.status_class)\" />\n+              </td>\n+              <td class=\"url-column\" data-test=\"service-url\">{{timestampingService.url}}</td>\n+              <td>{{$t('diagnostics.timestamping.timestampingStatus.'+timestampingService.status_code)}}</td>\n+              <td class=\"time-column\">{{timestampingService.prev_update_at | formatHoursMins}}</td>\n+            </tr>\n+          </tbody>\n+        </table>\n+      </v-card-text>\n+    </v-card>\n+\n+    <v-card class=\"xrd-card diagnostic-card\">\n+      <v-card-title>\n+        <span class=\"headline\">{{$t('diagnostics.ocspResponders.title')}}</span>\n+      </v-card-title>\n+      <v-card-text class=\"pt-4\">\n+        <div\n+          v-for=\"ocspDiags in ocspResponderDiagnostics\"\n+          v-bind:key=\"ocspDiags.distinguished_name\"\n+        >\n+          <div class=\"cert-service-name\">\n+            <span>{{$t('diagnostics.ocspResponders.certificationService')}}</span>\n+            {{ocspDiags.distinguished_name}}\n+          </div>\n+          <table class=\"xrd-table\">\n+            <thead>\n+              <tr>\n+                <th class=\"status-column\">{{$t('diagnostics.status')}}</th>\n+                <th class=\"url-column\">{{$t('diagnostics.serviceUrl')}}</th>\n+                <th>{{$t('diagnostics.message')}}</th>\n+                <th class=\"time-column\">{{$t('diagnostics.previousUpdate')}}</th>\n+                <th class=\"time-column\">{{$t('diagnostics.nextUpdate')}}</th>\n+              </tr>\n+            </thead>\n+            <tbody>\n+              <tr v-for=\"ocsp in ocspDiags.ocsp_responders\" v-bind:key=\"ocsp.url\">\n+                <td>\n+                  <StatusIcon :status=\"statusIconType(ocsp.status_class)\" />\n+                </td>\n+                <td class=\"url-column\" data-test=\"service-url\">{{ocsp.url}}</td>\n+                <td>{{$t('diagnostics.ocspResponders.ocspStatus.'+ocsp.status_code)}}</td>\n+                <td class=\"time-column\">{{ocsp.prev_update_at | formatHoursMins}}</td>\n+                <td class=\"time-column\">{{ocsp.next_update_at | formatHoursMins}}</td>\n+              </tr>\n+            </tbody>\n+          </table>\n+        </div>\n+      </v-card-text>\n+    </v-card>\n   </v-layout>\n </template>\n \n <script lang=\"ts\">\n import Vue from 'vue';\n+import * as api from '@/util/api';\n+import {\n+  TimestampingServiceDiagnostics,\n+  OcspResponderDiagnostics,\n+  GlobalConfDiagnostics,\n+} from '@/types';\n+import StatusIcon from '@/components/ui/StatusIcon.vue';\n \n export default Vue.extend({\n-  data: () => ({}),\n+  components: {\n+    StatusIcon,\n+  },\n+  data: () => ({\n+    timestapmingServices: [] as TimestampingServiceDiagnostics[],\n+    globalconf: undefined as GlobalConfDiagnostics | undefined,\n+    ocspResponderDiagnostics: [] as OcspResponderDiagnostics[],\n+  }),\n+  methods: {\n+    fetchData(): void {\n+      api\n+        .get(`/diagnostics/timestamping-services`)\n+        .then((res) => {\n+          this.timestapmingServices = res.data;\n+        })\n+        .catch((error) => {\n+          this.$store.dispatch('showError', error);\n+        });\n+\n+      api\n+        .get(`/diagnostics/globalconf`)\n+        .then((res) => {\n+          this.globalconf = res.data;\n+        })\n+        .catch((error) => {\n+          this.$store.dispatch('showError', error);\n+        });\n+\n+      api\n+        .get(`/diagnostics/ocsp-responders`)\n+        .then((res) => {\n+          this.ocspResponderDiagnostics = res.data;\n+        })\n+        .catch((error) => {\n+          this.$store.dispatch('showError', error);\n+        });\n+    },\n+\n+    statusIconType(status: string): string {\n+      if (!status) {\n+        return '';\n+      }\n+      switch (status) {\n+        case 'OK':\n+          return 'green';\n+        case 'WAITING':\n+          return 'orange-ring';\n+        case 'FAIL':\n+          return 'red';\n+        default:\n+          return 'red';\n+      }\n+    },\n+  },\n+  created() {\n+    this.fetchData();\n+  },\n });\n </script>\n \n <style lang=\"scss\" scoped>\n+@import '../../assets/shared';\n+@import '../../assets/colors';\n+@import '../../assets/tables';\n+\n+.diagnostic-card {\n+  &:first-of-type {\n+    margin-top: 40px;\n+  }\n+\n+  width: 100%;", "originalCommit": "dca13d4dc390f5fac38e093ebb1c51df751097bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI3NTM4MQ==", "url": "https://github.com/nordic-institute/X-Road/pull/463#discussion_r415275381", "bodyText": "Fixed", "author": "Riippi", "createdAt": "2020-04-26T10:24:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc0NTIxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc1MzQ3MQ==", "url": "https://github.com/nordic-institute/X-Road/pull/463#discussion_r414753471", "bodyText": "This applies to timestamping and ocsp responders -cards as well. Should there be some sort of status/infotext if no globalconf is empty for some reason? Now the table body is just empty and yet the table headers stay.", "author": "TJaakkola", "createdAt": "2020-04-24T17:46:23Z", "path": "src/proxy-ui-api/frontend/src/views/Diagnostics/Diagnostics.vue", "diffHunk": "@@ -1,16 +1,216 @@\n <template>\n   <v-layout align-center justify-center column fill-height elevation-0>\n-    <div>Placeholder</div>\n+    <v-card class=\"xrd-card diagnostic-card\">\n+      <v-card-title>\n+        <span class=\"headline\">{{$t('diagnostics.globalCongiguration.title')}}</span>\n+      </v-card-title>\n+      <v-card-text class=\"pt-4\">\n+        <table class=\"xrd-table\">\n+          <thead>\n+            <tr>\n+              <th class=\"status-column\">{{$t('diagnostics.status')}}</th>\n+              <th>{{$t('diagnostics.message')}}</th>\n+              <th class=\"time-column\">{{$t('diagnostics.previousUpdate')}}</th>\n+              <th class=\"time-column\">{{$t('diagnostics.nextUpdate')}}</th>\n+            </tr>\n+          </thead>\n+          <tbody>\n+            <tr v-if=\"globalconf\">", "originalCommit": "dca13d4dc390f5fac38e093ebb1c51df751097bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI3NjM3OQ==", "url": "https://github.com/nordic-institute/X-Road/pull/463#discussion_r415276379", "bodyText": "It might be good to have some \"no data found\" text or something like that, but there should be a one consistent way that the whole app uses. Currently a \"empty table\" is the way it's done in all other places also. This probably should be improved at some point.\nI added a loading indicator on the cards so at least the user sees if it's empty or loading.", "author": "Riippi", "createdAt": "2020-04-26T10:30:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc1MzQ3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTUwMjYxOA==", "url": "https://github.com/nordic-institute/X-Road/pull/463#discussion_r415502618", "bodyText": "Yeah, it should be improved. I've added such infotext to a couple of table views. I guess we should make a component of that.", "author": "TJaakkola", "createdAt": "2020-04-27T04:32:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc1MzQ3MQ=="}], "type": "inlineReview"}, {"oid": "3916ad16498a5119f3c4d50f9e822e946530e0d0", "url": "https://github.com/nordic-institute/X-Road/commit/3916ad16498a5119f3c4d50f9e822e946530e0d0", "message": "Merge branch 'develop' into XRDDEV-936-diagnostics-ui", "committedDate": "2020-04-25T12:58:28Z", "type": "commit"}, {"oid": "d09ea67bac10e36472c3cc2065fbfa59bb1d2f19", "url": "https://github.com/nordic-institute/X-Road/commit/d09ea67bac10e36472c3cc2065fbfa59bb1d2f19", "message": "XRDDEV-936 Fix review issues", "committedDate": "2020-04-26T10:20:41Z", "type": "commit"}]}