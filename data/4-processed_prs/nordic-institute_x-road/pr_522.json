{"pr_number": 522, "pr_title": "XRDDEV-929 initialise server", "pr_createdAt": "2020-05-28T12:37:38Z", "pr_url": "https://github.com/nordic-institute/X-Road/pull/522", "timeline": [{"oid": "ce6964f5520f31f9af95cf1aef89a4dcb9bd1d74", "url": "https://github.com/nordic-institute/X-Road/commit/ce6964f5520f31f9af95cf1aef89a4dcb9bd1d74", "message": "XRDDEV-929 Add localised strings", "committedDate": "2020-04-28T10:50:19Z", "type": "commit"}, {"oid": "ad9bad4143683b9086c2c304aecb671db2ba988c", "url": "https://github.com/nordic-institute/X-Road/commit/ad9bad4143683b9086c2c304aecb671db2ba988c", "message": "XRDDEV-929 Add wizard skeleton", "committedDate": "2020-04-28T10:51:11Z", "type": "commit"}, {"oid": "2834a174e789e770f862c2fbbf07c1ebab278461", "url": "https://github.com/nordic-institute/X-Road/commit/2834a174e789e770f862c2fbbf07c1ebab278461", "message": "Merge branch 'develop' into XRDDEV-929-initialize-server", "committedDate": "2020-04-28T11:38:22Z", "type": "commit"}, {"oid": "907b7de64e5eba3df5fa29601067022939cb16cf", "url": "https://github.com/nordic-institute/X-Road/commit/907b7de64e5eba3df5fa29601067022939cb16cf", "message": "Merge branch 'develop' into XRDDEV-929-initialize-server", "committedDate": "2020-04-29T21:00:35Z", "type": "commit"}, {"oid": "ae53d3b61f642d1a8aad0fb8ca8ce2949ee1dde3", "url": "https://github.com/nordic-institute/X-Road/commit/ae53d3b61f642d1a8aad0fb8ca8ce2949ee1dde3", "message": "XRDDEV-929 Update pin inputs", "committedDate": "2020-04-30T10:00:25Z", "type": "commit"}, {"oid": "4de1fdfb34b3702d577e53aed086589cd71d608c", "url": "https://github.com/nordic-institute/X-Road/commit/4de1fdfb34b3702d577e53aed086589cd71d608c", "message": "XRDDEV-929 Add store for init server", "committedDate": "2020-05-05T10:27:00Z", "type": "commit"}, {"oid": "64e07851ab1d65d59a5fcbf79d7f0e02bd782c28", "url": "https://github.com/nordic-institute/X-Road/commit/64e07851ab1d65d59a5fcbf79d7f0e02bd782c28", "message": "XRDDEV-929 Add anchor mode to wizard", "committedDate": "2020-05-05T14:59:20Z", "type": "commit"}, {"oid": "726e1b5679453ca744292b36e5f7c92fe1c47cf1", "url": "https://github.com/nordic-institute/X-Road/commit/726e1b5679453ca744292b36e5f7c92fe1c47cf1", "message": "XRDDEV-929 Fix anchor preview url", "committedDate": "2020-05-05T15:00:57Z", "type": "commit"}, {"oid": "a75aaff32eb7849655dec5246fe9211c0273e29e", "url": "https://github.com/nordic-institute/X-Road/commit/a75aaff32eb7849655dec5246fe9211c0273e29e", "message": "XRDDEV-929 Update wizard pages", "committedDate": "2020-05-05T15:01:37Z", "type": "commit"}, {"oid": "c7801126ac17d8350e0ae19db47fade6d7eaad05", "url": "https://github.com/nordic-institute/X-Road/commit/c7801126ac17d8350e0ae19db47fade6d7eaad05", "message": "XRDDEV-929 Rename files", "committedDate": "2020-05-11T10:11:30Z", "type": "commit"}, {"oid": "382b22f7c1014309d43f2a689eb3bca5caee8bcf", "url": "https://github.com/nordic-institute/X-Road/commit/382b22f7c1014309d43f2a689eb3bca5caee8bcf", "message": "XRDDEV-929 Update pin rules", "committedDate": "2020-05-11T11:23:44Z", "type": "commit"}, {"oid": "f6ef02616c27acac8bfdf9d00ee30fef25e8fa09", "url": "https://github.com/nordic-institute/X-Road/commit/f6ef02616c27acac8bfdf9d00ee30fef25e8fa09", "message": "Merge commit 'ebb949cc52f20b67565e667122fa8d215c7184a5' into XRDDEV-929-initialize-server\n\n# Conflicts:\n#\tsrc/proxy-ui-api/frontend/src/global.ts\n#\tsrc/proxy-ui-api/frontend/src/router.ts", "committedDate": "2020-05-14T15:47:48Z", "type": "commit"}, {"oid": "777bb41a9b672d42df6e5f0d411d049f17b58468", "url": "https://github.com/nordic-institute/X-Road/commit/777bb41a9b672d42df6e5f0d411d049f17b58468", "message": "XRDDEV-929 Update types", "committedDate": "2020-05-14T17:17:48Z", "type": "commit"}, {"oid": "1919b4f2f58c121b088c826b4da1165ec032dcbe", "url": "https://github.com/nordic-institute/X-Road/commit/1919b4f2f58c121b088c826b4da1165ec032dcbe", "message": "XRDDEV-929 Fix token pin field name", "committedDate": "2020-05-14T17:18:24Z", "type": "commit"}, {"oid": "b674a547761dfaf1e0e0456937a97dafb5c68347", "url": "https://github.com/nordic-institute/X-Road/commit/b674a547761dfaf1e0e0456937a97dafb5c68347", "message": "XRDDEV-929 Updates to wizard", "committedDate": "2020-05-14T17:25:54Z", "type": "commit"}, {"oid": "01cf257751cbe1d10a3a55913be4dd9b7c2330b6", "url": "https://github.com/nordic-institute/X-Road/commit/01cf257751cbe1d10a3a55913be4dd9b7c2330b6", "message": "Merge branch 'develop' into XRDDEV-929-initialize-server", "committedDate": "2020-05-25T08:46:39Z", "type": "commit"}, {"oid": "7d880d433eed901a01ec85bb2fb4ace34ff73bc4", "url": "https://github.com/nordic-institute/X-Road/commit/7d880d433eed901a01ec85bb2fb4ace34ff73bc4", "message": "XRDDEV-929 Remove cancel button", "committedDate": "2020-05-26T08:58:14Z", "type": "commit"}, {"oid": "4462c392e7d646e23b5b86ea06c129f7480f3d39", "url": "https://github.com/nordic-institute/X-Road/commit/4462c392e7d646e23b5b86ea06c129f7480f3d39", "message": "XRDDEV-929 Update init flow", "committedDate": "2020-05-26T17:36:04Z", "type": "commit"}, {"oid": "b36c0323c1fb5dd3671cebcffceebdce8516bfd4", "url": "https://github.com/nordic-institute/X-Road/commit/b36c0323c1fb5dd3671cebcffceebdce8516bfd4", "message": "XRDDEV-929 Cleanup", "committedDate": "2020-05-27T09:27:38Z", "type": "commit"}, {"oid": "a228feece520eed8dc16106b2a4f627377159bb4", "url": "https://github.com/nordic-institute/X-Road/commit/a228feece520eed8dc16106b2a4f627377159bb4", "message": "XRDDEV-929 Update init flow", "committedDate": "2020-05-27T13:07:17Z", "type": "commit"}, {"oid": "124debf4d125cfdb673995f99cc97dfc7d53468a", "url": "https://github.com/nordic-institute/X-Road/commit/124debf4d125cfdb673995f99cc97dfc7d53468a", "message": "XRDDEV-929 Update init flow", "committedDate": "2020-05-28T09:45:20Z", "type": "commit"}, {"oid": "a39f155f7e327392ad1c62ba54f93a345895f125", "url": "https://github.com/nordic-institute/X-Road/commit/a39f155f7e327392ad1c62ba54f93a345895f125", "message": "XRDDEV-929 Update init flow", "committedDate": "2020-05-28T11:12:45Z", "type": "commit"}, {"oid": "075862a69976779890b273207b4361386126414c", "url": "https://github.com/nordic-institute/X-Road/commit/075862a69976779890b273207b4361386126414c", "message": "Merge commit 'aa8a47b0f880bda26a02896b3b27511d95350857' into XRDDEV-929-initialize-server\n\n# Conflicts:\n#\tsrc/proxy-ui-api/frontend/src/types.ts\n#\tsrc/proxy-ui-api/frontend/src/views/Settings/SystemParameters/UploadConfigurationAnchorDialog.vue", "committedDate": "2020-05-28T11:23:38Z", "type": "commit"}, {"oid": "4e404fa30724fb6485fe6d600e6aa71d59c7555e", "url": "https://github.com/nordic-institute/X-Road/commit/4e404fa30724fb6485fe6d600e6aa71d59c7555e", "message": "XRDDEV-929 Update init flow", "committedDate": "2020-05-28T12:11:59Z", "type": "commit"}, {"oid": "04f62d9209520ac2e3568af9a18cd0f2bfc3867d", "url": "https://github.com/nordic-institute/X-Road/commit/04f62d9209520ac2e3568af9a18cd0f2bfc3867d", "message": "XRDDEV-929 Use american pronaunciation initialize in code", "committedDate": "2020-05-28T12:26:59Z", "type": "commit"}, {"oid": "6a9ec6fe597cdf829d6a3044363abaaa8795b79b", "url": "https://github.com/nordic-institute/X-Road/commit/6a9ec6fe597cdf829d6a3044363abaaa8795b79b", "message": "XRDDEV-929 Use english pronounciation initialise in localisations", "committedDate": "2020-05-28T12:27:54Z", "type": "commit"}, {"oid": "38ac5b6cc4a15a835163063c6b9982adbdf94b5b", "url": "https://github.com/nordic-institute/X-Road/commit/38ac5b6cc4a15a835163063c6b9982adbdf94b5b", "message": "XRDDEV-929 Cleanup", "committedDate": "2020-05-28T15:05:57Z", "type": "commit"}, {"oid": "8490bc368b5e9e6ade94a2ed947acb8dc945e32f", "url": "https://github.com/nordic-institute/X-Road/commit/8490bc368b5e9e6ade94a2ed947acb8dc945e32f", "message": "XRDDEV-929 Add missing localisation", "committedDate": "2020-06-01T16:03:01Z", "type": "commit"}, {"oid": "787c2b91180ce83b49f43ef4fbc7b6936517de34", "url": "https://github.com/nordic-institute/X-Road/commit/787c2b91180ce83b49f43ef4fbc7b6936517de34", "message": "XRDDEV-929 Fix typings", "committedDate": "2020-06-01T16:16:44Z", "type": "commit"}, {"oid": "65c5255ae1695d63502ae966550a70e385621866", "url": "https://github.com/nordic-institute/X-Road/commit/65c5255ae1695d63502ae966550a70e385621866", "message": "XRDDEV-929 Add route guard for init server", "committedDate": "2020-06-01T18:34:45Z", "type": "commit"}, {"oid": "6be724a73e096e4fc821c31c36c19e806a9428ec", "url": "https://github.com/nordic-institute/X-Road/commit/6be724a73e096e4fc821c31c36c19e806a9428ec", "message": "Merge commit '53e837dbb7b1e65f3f86560f49f70497e0dc62fe' into XRDDEV-929-initialize-server", "committedDate": "2020-06-01T19:44:16Z", "type": "commit"}, {"oid": "ca10b14f234772cdc51659258a9f2471776fdb1c", "url": "https://github.com/nordic-institute/X-Road/commit/ca10b14f234772cdc51659258a9f2471776fdb1c", "message": "Merge branch 'develop' into XRDDEV-929-initialize-server", "committedDate": "2020-06-03T14:36:58Z", "type": "commit"}, {"oid": "5c9b12c636ea021d32b2b220ff6731156f899563", "url": "https://github.com/nordic-institute/X-Road/commit/5c9b12c636ea021d32b2b220ff6731156f899563", "message": "Merge commit 'e0409fcd7ee9ba87e6000afeb0dde52b3da977ca' into XRDDEV-929-initialize-server\n\n# Conflicts:\n#\tsrc/proxy-ui-api/frontend/src/global.ts\n#\tsrc/proxy-ui-api/frontend/src/views/AppLogin.vue", "committedDate": "2020-06-05T12:12:25Z", "type": "commit"}, {"oid": "b311f82b732bfe66c982cf10dc091d668380046b", "url": "https://github.com/nordic-institute/X-Road/commit/b311f82b732bfe66c982cf10dc091d668380046b", "message": "XRDDEV-929 Fix linter errors", "committedDate": "2020-06-05T12:13:29Z", "type": "commit"}, {"oid": "5ad07518acfd285a62aa646cc920c5c8943bbd32", "url": "https://github.com/nordic-institute/X-Road/commit/5ad07518acfd285a62aa646cc920c5c8943bbd32", "message": "XRDDEV-929 Remove old types file", "committedDate": "2020-06-05T12:23:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIxMTkyNg==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437211926", "bodyText": "I guess this 'state' parameter and others in this file are of type State? You could add typings if this is correct.", "author": "TJaakkola", "createdAt": "2020-06-09T08:01:10Z", "path": "src/proxy-ui-api/frontend/src/store/modules/general.ts", "diffHunk": "@@ -19,6 +23,13 @@ export const getters: GetterTree<State, RootState> = {\n   memberClasses: (state) => {\n     return state.memberClasses;\n   },\n+  memberClassesCurrentInstance: (state) => {", "originalCommit": "5ad07518acfd285a62aa646cc920c5c8943bbd32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQwNDg4NA==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437404884", "bodyText": "fixed", "author": "Riippi", "createdAt": "2020-06-09T13:11:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIxMTkyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyNTQ5Nw==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437225497", "bodyText": "Now that we can use nullish coalescing operator I think using the logical OR as a way to return a default value is a bit bad habit. See those couple of paragraphs in https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_operator. Whether to make a change or not is up to you.", "author": "TJaakkola", "createdAt": "2020-06-09T08:24:08Z", "path": "src/proxy-ui-api/frontend/src/store/modules/initializeServer.ts", "diffHunk": "@@ -0,0 +1,114 @@\n+import { ActionTree, GetterTree, Module, MutationTree } from 'vuex';\n+import { RootState } from '../types';\n+import * as api from '@/util/api';\n+\n+interface InitializationStatus {\n+  is_anchor_imported: boolean;\n+  is_server_code_initialized: boolean;\n+  is_server_owner_initialized: boolean;\n+  is_software_token_initialized: boolean;\n+}\n+\n+export interface InitServerState {\n+  memberClass: string | undefined;\n+  memberCode: string | undefined;\n+  securityServerCode: string | undefined;\n+  initializationStatus: InitializationStatus | undefined;\n+}\n+\n+const getDefaultState = () => {\n+  return {\n+    memberClass: undefined,\n+    memberCode: undefined,\n+    securityServerCode: undefined,\n+    initializationStatus: undefined,\n+  };\n+};\n+\n+// Initial state. The state can be reseted with this.\n+const moduleState = getDefaultState();\n+\n+export const getters: GetterTree<InitServerState, RootState> = {\n+  initServerMemberClass(state): string | undefined {\n+    return state.memberClass;\n+  },\n+\n+  initServerMemberCode(state): string | undefined {\n+    return state.memberCode;\n+  },\n+\n+  initServerSSCode(state): string | undefined {\n+    return state.securityServerCode;\n+  },\n+\n+  isAnchorImported(state): boolean {\n+    return state.initializationStatus?.is_anchor_imported || false;", "originalCommit": "5ad07518acfd285a62aa646cc920c5c8943bbd32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQwNDgxOA==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437404818", "bodyText": "fixed", "author": "Riippi", "createdAt": "2020-06-09T13:11:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyNTQ5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyNTY1Ng==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437225656", "bodyText": "state: State as above. Several occasions in this file", "author": "TJaakkola", "createdAt": "2020-06-09T08:24:24Z", "path": "src/proxy-ui-api/frontend/src/store/modules/initializeServer.ts", "diffHunk": "@@ -0,0 +1,114 @@\n+import { ActionTree, GetterTree, Module, MutationTree } from 'vuex';\n+import { RootState } from '../types';\n+import * as api from '@/util/api';\n+\n+interface InitializationStatus {\n+  is_anchor_imported: boolean;\n+  is_server_code_initialized: boolean;\n+  is_server_owner_initialized: boolean;\n+  is_software_token_initialized: boolean;\n+}\n+\n+export interface InitServerState {\n+  memberClass: string | undefined;\n+  memberCode: string | undefined;\n+  securityServerCode: string | undefined;\n+  initializationStatus: InitializationStatus | undefined;\n+}\n+\n+const getDefaultState = () => {\n+  return {\n+    memberClass: undefined,\n+    memberCode: undefined,\n+    securityServerCode: undefined,\n+    initializationStatus: undefined,\n+  };\n+};\n+\n+// Initial state. The state can be reseted with this.\n+const moduleState = getDefaultState();\n+\n+export const getters: GetterTree<InitServerState, RootState> = {\n+  initServerMemberClass(state): string | undefined {", "originalCommit": "5ad07518acfd285a62aa646cc920c5c8943bbd32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQwNDc0OA==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437404748", "bodyText": "fixed", "author": "Riippi", "createdAt": "2020-06-09T13:11:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyNTY1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyNjMzMw==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437226333", "bodyText": "returns InitServerState -type", "author": "TJaakkola", "createdAt": "2020-06-09T08:25:28Z", "path": "src/proxy-ui-api/frontend/src/store/modules/initializeServer.ts", "diffHunk": "@@ -0,0 +1,114 @@\n+import { ActionTree, GetterTree, Module, MutationTree } from 'vuex';\n+import { RootState } from '../types';\n+import * as api from '@/util/api';\n+\n+interface InitializationStatus {\n+  is_anchor_imported: boolean;\n+  is_server_code_initialized: boolean;\n+  is_server_owner_initialized: boolean;\n+  is_software_token_initialized: boolean;\n+}\n+\n+export interface InitServerState {\n+  memberClass: string | undefined;\n+  memberCode: string | undefined;\n+  securityServerCode: string | undefined;\n+  initializationStatus: InitializationStatus | undefined;\n+}\n+\n+const getDefaultState = () => {", "originalCommit": "5ad07518acfd285a62aa646cc920c5c8943bbd32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQwNDcxNA==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437404714", "bodyText": "fixed", "author": "Riippi", "createdAt": "2020-06-09T13:11:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyNjMzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyNzQ5OQ==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437227499", "bodyText": "This isn't a computed method in a component so I guess you can just return the evaluated from the if-block expression?", "author": "TJaakkola", "createdAt": "2020-06-09T08:27:18Z", "path": "src/proxy-ui-api/frontend/src/store/modules/initializeServer.ts", "diffHunk": "@@ -0,0 +1,114 @@\n+import { ActionTree, GetterTree, Module, MutationTree } from 'vuex';\n+import { RootState } from '../types';\n+import * as api from '@/util/api';\n+\n+interface InitializationStatus {\n+  is_anchor_imported: boolean;\n+  is_server_code_initialized: boolean;\n+  is_server_owner_initialized: boolean;\n+  is_software_token_initialized: boolean;\n+}\n+\n+export interface InitServerState {\n+  memberClass: string | undefined;\n+  memberCode: string | undefined;\n+  securityServerCode: string | undefined;\n+  initializationStatus: InitializationStatus | undefined;\n+}\n+\n+const getDefaultState = () => {\n+  return {\n+    memberClass: undefined,\n+    memberCode: undefined,\n+    securityServerCode: undefined,\n+    initializationStatus: undefined,\n+  };\n+};\n+\n+// Initial state. The state can be reseted with this.\n+const moduleState = getDefaultState();\n+\n+export const getters: GetterTree<InitServerState, RootState> = {\n+  initServerMemberClass(state): string | undefined {\n+    return state.memberClass;\n+  },\n+\n+  initServerMemberCode(state): string | undefined {\n+    return state.memberCode;\n+  },\n+\n+  initServerSSCode(state): string | undefined {\n+    return state.securityServerCode;\n+  },\n+\n+  isAnchorImported(state): boolean {\n+    return state.initializationStatus?.is_anchor_imported || false;\n+  },\n+\n+  isServerOwnerInitialized(state): boolean {\n+    return state.initializationStatus?.is_server_owner_initialized || false;\n+  },\n+\n+  isServerCodeInitialized(state): boolean {\n+    return state.initializationStatus?.is_server_code_initialized || false;\n+  },\n+\n+  isSoftwareTokenInitialized(state): boolean {\n+    return state.initializationStatus?.is_software_token_initialized || false;\n+  },\n+\n+  needsInitialization: (state) => {\n+    if (", "originalCommit": "5ad07518acfd285a62aa646cc920c5c8943bbd32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQwNDY4MA==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437404680", "bodyText": "fixed", "author": "Riippi", "createdAt": "2020-06-09T13:11:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyNzQ5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyOTA0NA==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437229044", "bodyText": "We can use optional chaining here.", "author": "TJaakkola", "createdAt": "2020-06-09T08:29:45Z", "path": "src/proxy-ui-api/frontend/src/views/AppLogin.vue", "diffHunk": "@@ -119,59 +119,82 @@ export default (Vue as VueConstructor<\n       this.$refs.form.reset();\n       this.loading = true;\n \n-      this.$store\n-        .dispatch('login', loginData)\n-        .then(\n-          () => {\n-            // Auth ok. Start phase 2 (fetch user data and current security server info).\n-            this.fetchUserData();\n-            this.fetchCurrentSecurityServer();\n-            this.fetchSecurityServerVersion();\n-          },\n-          (error) => {\n-            // Display invalid username/password error in inputs\n-            if (error.response && error.response.status === 401) {\n-              // Clear inputs\n-              this.username = '';\n-              this.password = '';\n-              this.$refs.form.reset();\n+      this.$store.dispatch('login', loginData).then(\n+        () => {\n+          // Auth ok. Start phase 2 (fetch user data and current security server info).\n+          this.fetchUserData();\n+          this.fetchSecurityServerVersion();\n+        },\n+        (error) => {\n+          // Display invalid username/password error in inputs\n+          if (error.response && error.response.status === 401) {", "originalCommit": "5ad07518acfd285a62aa646cc920c5c8943bbd32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQwNDYyNQ==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437404625", "bodyText": "fixed", "author": "Riippi", "createdAt": "2020-06-09T13:11:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyOTA0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIzMTE0Mg==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437231142", "bodyText": "Seems async-functionalities aren't used here at all so you could remove the keyword from here and from fetchUserData-function. Neither of these methods return a Promise-object so it shouldn't make a difference.", "author": "TJaakkola", "createdAt": "2020-06-09T08:32:54Z", "path": "src/proxy-ui-api/frontend/src/views/AppLogin.vue", "diffHunk": "@@ -119,59 +119,82 @@ export default (Vue as VueConstructor<\n       this.$refs.form.reset();\n       this.loading = true;\n \n-      this.$store\n-        .dispatch('login', loginData)\n-        .then(\n-          () => {\n-            // Auth ok. Start phase 2 (fetch user data and current security server info).\n-            this.fetchUserData();\n-            this.fetchCurrentSecurityServer();\n-            this.fetchSecurityServerVersion();\n-          },\n-          (error) => {\n-            // Display invalid username/password error in inputs\n-            if (error.response && error.response.status === 401) {\n-              // Clear inputs\n-              this.username = '';\n-              this.password = '';\n-              this.$refs.form.reset();\n+      this.$store.dispatch('login', loginData).then(\n+        () => {\n+          // Auth ok. Start phase 2 (fetch user data and current security server info).\n+          this.fetchUserData();\n+          this.fetchSecurityServerVersion();\n+        },\n+        (error) => {\n+          // Display invalid username/password error in inputs\n+          if (error.response && error.response.status === 401) {\n+            // Clear inputs\n+            this.username = '';\n+            this.password = '';\n+            this.$refs.form.reset();\n \n-              // The whole view needs to be rendered so the \"required\" rule doesn't block\n-              // \"wrong unsername or password\" error in inputs\n-              this.$nextTick(() => {\n-                // Set inputs to error state\n-                this.$refs.form.setErrors({\n-                  username: [''],\n-                  password: [this.$t('login.errorMsg401') as string],\n-                });\n+            // The whole view needs to be rendered so the \"required\" rule doesn't block\n+            // \"wrong unsername or password\" error in inputs\n+            this.$nextTick(() => {\n+              // Set inputs to error state\n+              this.$refs.form.setErrors({\n+                username: [''],\n+                password: [this.$t('login.errorMsg401') as string],\n               });\n-            }\n-            this.$store.dispatch('showErrorMessageRaw', error.message);\n-          },\n-        )\n-        .finally(() => {\n+            });\n+          }\n+          this.$store.dispatch('showErrorMessageRaw', error.message);\n           // Clear loading state\n           this.loading = false;\n-        });\n+        },\n+      );\n     },\n     async fetchUserData() {\n       this.loading = true;\n+      this.$store.dispatch('fetchUserData').then(\n+        () => {\n+          // Check if initialization is needed\n+          this.fetchInitializationData();\n+        },\n+        (error) => {\n+          // Display error\n+          this.$store.dispatch('showErrorMessageRaw', error.message);\n+          this.loading = false;\n+        },\n+      );\n+    },\n+\n+    async fetchInitializationData() {", "originalCommit": "5ad07518acfd285a62aa646cc920c5c8943bbd32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQwNDU3Mw==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437404573", "bodyText": "fixed", "author": "Riippi", "createdAt": "2020-06-09T13:11:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIzMTE0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI0OTQ5Ng==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437249496", "bodyText": "What does this do? Couldn't this be done as an optional html-class & margin?", "author": "TJaakkola", "createdAt": "2020-06-09T09:00:26Z", "path": "src/proxy-ui-api/frontend/src/views/InitialConfiguration/ConfigurationAnchorStep.vue", "diffHunk": "@@ -0,0 +1,121 @@\n+<template>\n+  <div>\n+    <div class=\"action-row\">\n+      <div>{{ $t('initialConfiguration.anchor.info') }}</div>\n+      <upload-configuration-anchor-dialog\n+        @uploaded=\"fetchConfigurationAnchor\"\n+        initMode\n+      />\n+    </div>\n+\n+    <template v-if=\"configuratonAnchor\">\n+      <div class=\"row-wrap\">\n+        <div class=\"label\">{{ $t('initialConfiguration.anchor.hash') }}</div>\n+        <template v-if=\"configuratonAnchor\">{{\n+          configuratonAnchor.hash | colonize\n+        }}</template>\n+      </div>\n+\n+      <div class=\"row-wrap\">\n+        <div class=\"label\">\n+          {{ $t('initialConfiguration.anchor.generated') }}\n+        </div>\n+        <template v-if=\"configuratonAnchor\">{{\n+          configuratonAnchor.created_at | formatDateTime\n+        }}</template>\n+      </div>\n+    </template>\n+    <div v-else style=\"height: 120px;\"></div>", "originalCommit": "5ad07518acfd285a62aa646cc920c5c8943bbd32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQwNDQ5NQ==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437404495", "bodyText": "Idea was to keep the height same with or without anchor data, but it's not a good implementation. Fixed now.", "author": "Riippi", "createdAt": "2020-06-09T13:11:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI0OTQ5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI1MzA2Mg==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437253062", "bodyText": "I think this can be removed?", "author": "TJaakkola", "createdAt": "2020-06-09T09:04:31Z", "path": "src/proxy-ui-api/frontend/src/views/InitialConfiguration/InitialConfiguration.vue", "diffHunk": "@@ -0,0 +1,231 @@\n+<template>\n+  <div class=\"view-wrap\">\n+    <subViewTitle\n+      class=\"view-title\"\n+      :title=\"$t('initialConfiguration.title')\"\n+      :showClose=\"false\"\n+      data-test=\"wizard-title\"\n+    />\n+    <v-stepper\n+      :alt-labels=\"true\"\n+      v-model=\"currentStep\"\n+      class=\"stepper noshadow\"\n+    >\n+      <!-- Headers without anchor page -->\n+      <v-stepper-header v-if=\"isAnchorImported\" class=\"noshadow\">\n+        <v-stepper-step :complete=\"currentStep > 1\" step=\"1\">{{\n+          $t('initialConfiguration.member.title')\n+        }}</v-stepper-step>\n+        <v-divider></v-divider>\n+        <v-stepper-step :complete=\"currentStep > 2\" step=\"2\">{{\n+          $t('initialConfiguration.pin.title')\n+        }}</v-stepper-step>\n+      </v-stepper-header>\n+      <!-- Headers with anchor page -->\n+      <v-stepper-header v-else class=\"noshadow\">\n+        <v-stepper-step :complete=\"currentStep > 1\" step=\"1\">{{\n+          $t('initialConfiguration.anchor.title')\n+        }}</v-stepper-step>\n+        <v-divider></v-divider>\n+        <v-stepper-step :complete=\"currentStep > 2\" step=\"2\">{{\n+          $t('initialConfiguration.member.title')\n+        }}</v-stepper-step>\n+        <v-divider></v-divider>\n+        <v-stepper-step :complete=\"currentStep > 3\" step=\"3\">{{\n+          $t('initialConfiguration.pin.title')\n+        }}</v-stepper-step>\n+      </v-stepper-header>\n+\n+      <v-stepper-items v-if=\"isAnchorImported\" class=\"stepper-content\">\n+        <!-- Member step -->\n+        <v-stepper-content step=\"1\">\n+          <OwnerMemberStep\n+            @done=\"ownerMemberReady\"\n+            :showPreviousButton=\"false\"\n+          />\n+        </v-stepper-content>\n+        <!-- PIN step -->\n+        <v-stepper-content step=\"2\">\n+          <TokenPinStep @previous=\"currentStep = 1\" @done=\"tokenPinReady\" />\n+        </v-stepper-content>\n+      </v-stepper-items>\n+\n+      <v-stepper-items v-else class=\"stepper-content\">\n+        <!-- Anchor step -->\n+        <v-stepper-content step=\"1\">\n+          <ConfigurationAnchorStep @done=\"configAnchorReady\" />\n+        </v-stepper-content>\n+        <!-- Member step -->\n+        <v-stepper-content step=\"2\">\n+          <OwnerMemberStep\n+            @previous=\"currentStep = 1\"\n+            @done=\"ownerMemberReady\"\n+          />\n+        </v-stepper-content>\n+        <!-- PIN step -->\n+        <v-stepper-content step=\"3\">\n+          <TokenPinStep\n+            @previous=\"currentStep = 2\"\n+            @done=\"tokenPinReady\"\n+            :saveBusy=\"pinSaveBusy\"\n+          />\n+        </v-stepper-content>\n+      </v-stepper-items>\n+    </v-stepper>\n+\n+    <!-- Confirm dialog for warnings when initializing server -->\n+    <warningDialog\n+      :dialog=\"confirmInitWarning\"\n+      :warnings=\"warningInfo\"\n+      localizationParent=\"initialConfiguration.warning\"\n+      @cancel=\"confirmInitWarning = false\"\n+      @accept=\"acceptInitWarning()\"\n+    ></warningDialog>\n+  </div>\n+</template>\n+\n+<script lang=\"ts\">\n+import Vue from 'vue';\n+import { mapGetters } from 'vuex';\n+import SubViewTitle from '@/components/ui/SubViewTitle.vue';\n+import TokenPinStep from './TokenPinStep.vue';\n+import ConfigurationAnchorStep from './ConfigurationAnchorStep.vue';\n+import WarningDialog from './WarningDialog.vue';\n+import OwnerMemberStep from './OwnerMemberStep.vue';\n+import { Key, Token } from '@/openapi-types';\n+import { RouteName, UsageTypes } from '@/global';\n+import * as api from '@/util/api';\n+\n+export default Vue.extend({\n+  components: {\n+    SubViewTitle,\n+    TokenPinStep,\n+    ConfigurationAnchorStep,\n+    OwnerMemberStep,\n+    WarningDialog,\n+  },\n+  props: {},", "originalCommit": "5ad07518acfd285a62aa646cc920c5c8943bbd32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM4Mzg5NQ==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437383895", "bodyText": "fixed", "author": "Riippi", "createdAt": "2020-06-09T12:46:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI1MzA2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI1MzIxNA==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437253214", "bodyText": "typings", "author": "TJaakkola", "createdAt": "2020-06-09T09:04:40Z", "path": "src/proxy-ui-api/frontend/src/views/InitialConfiguration/InitialConfiguration.vue", "diffHunk": "@@ -0,0 +1,231 @@\n+<template>\n+  <div class=\"view-wrap\">\n+    <subViewTitle\n+      class=\"view-title\"\n+      :title=\"$t('initialConfiguration.title')\"\n+      :showClose=\"false\"\n+      data-test=\"wizard-title\"\n+    />\n+    <v-stepper\n+      :alt-labels=\"true\"\n+      v-model=\"currentStep\"\n+      class=\"stepper noshadow\"\n+    >\n+      <!-- Headers without anchor page -->\n+      <v-stepper-header v-if=\"isAnchorImported\" class=\"noshadow\">\n+        <v-stepper-step :complete=\"currentStep > 1\" step=\"1\">{{\n+          $t('initialConfiguration.member.title')\n+        }}</v-stepper-step>\n+        <v-divider></v-divider>\n+        <v-stepper-step :complete=\"currentStep > 2\" step=\"2\">{{\n+          $t('initialConfiguration.pin.title')\n+        }}</v-stepper-step>\n+      </v-stepper-header>\n+      <!-- Headers with anchor page -->\n+      <v-stepper-header v-else class=\"noshadow\">\n+        <v-stepper-step :complete=\"currentStep > 1\" step=\"1\">{{\n+          $t('initialConfiguration.anchor.title')\n+        }}</v-stepper-step>\n+        <v-divider></v-divider>\n+        <v-stepper-step :complete=\"currentStep > 2\" step=\"2\">{{\n+          $t('initialConfiguration.member.title')\n+        }}</v-stepper-step>\n+        <v-divider></v-divider>\n+        <v-stepper-step :complete=\"currentStep > 3\" step=\"3\">{{\n+          $t('initialConfiguration.pin.title')\n+        }}</v-stepper-step>\n+      </v-stepper-header>\n+\n+      <v-stepper-items v-if=\"isAnchorImported\" class=\"stepper-content\">\n+        <!-- Member step -->\n+        <v-stepper-content step=\"1\">\n+          <OwnerMemberStep\n+            @done=\"ownerMemberReady\"\n+            :showPreviousButton=\"false\"\n+          />\n+        </v-stepper-content>\n+        <!-- PIN step -->\n+        <v-stepper-content step=\"2\">\n+          <TokenPinStep @previous=\"currentStep = 1\" @done=\"tokenPinReady\" />\n+        </v-stepper-content>\n+      </v-stepper-items>\n+\n+      <v-stepper-items v-else class=\"stepper-content\">\n+        <!-- Anchor step -->\n+        <v-stepper-content step=\"1\">\n+          <ConfigurationAnchorStep @done=\"configAnchorReady\" />\n+        </v-stepper-content>\n+        <!-- Member step -->\n+        <v-stepper-content step=\"2\">\n+          <OwnerMemberStep\n+            @previous=\"currentStep = 1\"\n+            @done=\"ownerMemberReady\"\n+          />\n+        </v-stepper-content>\n+        <!-- PIN step -->\n+        <v-stepper-content step=\"3\">\n+          <TokenPinStep\n+            @previous=\"currentStep = 2\"\n+            @done=\"tokenPinReady\"\n+            :saveBusy=\"pinSaveBusy\"\n+          />\n+        </v-stepper-content>\n+      </v-stepper-items>\n+    </v-stepper>\n+\n+    <!-- Confirm dialog for warnings when initializing server -->\n+    <warningDialog\n+      :dialog=\"confirmInitWarning\"\n+      :warnings=\"warningInfo\"\n+      localizationParent=\"initialConfiguration.warning\"\n+      @cancel=\"confirmInitWarning = false\"\n+      @accept=\"acceptInitWarning()\"\n+    ></warningDialog>\n+  </div>\n+</template>\n+\n+<script lang=\"ts\">\n+import Vue from 'vue';\n+import { mapGetters } from 'vuex';\n+import SubViewTitle from '@/components/ui/SubViewTitle.vue';\n+import TokenPinStep from './TokenPinStep.vue';\n+import ConfigurationAnchorStep from './ConfigurationAnchorStep.vue';\n+import WarningDialog from './WarningDialog.vue';\n+import OwnerMemberStep from './OwnerMemberStep.vue';\n+import { Key, Token } from '@/openapi-types';\n+import { RouteName, UsageTypes } from '@/global';\n+import * as api from '@/util/api';\n+\n+export default Vue.extend({\n+  components: {\n+    SubViewTitle,\n+    TokenPinStep,\n+    ConfigurationAnchorStep,\n+    OwnerMemberStep,\n+    WarningDialog,\n+  },\n+  props: {},\n+  computed: {\n+    ...mapGetters([\n+      'isAnchorImported',\n+      'isServerOwnerInitialized',\n+      'isServerCodeInitialized',\n+    ]),\n+  },\n+  data() {\n+    return {\n+      currentStep: 1,\n+      pinSaveBusy: false,\n+      warningInfo: [],\n+      confirmInitWarning: false,\n+      requestPayload: undefined as any,", "originalCommit": "5ad07518acfd285a62aa646cc920c5c8943bbd32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM4Mzc5MQ==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437383791", "bodyText": "fixed", "author": "Riippi", "createdAt": "2020-06-09T12:45:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI1MzIxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI1NTA2Mg==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437255062", "bodyText": "How about just merging these to more generic:\nnextStep(): void { this.currentStep++; }", "author": "TJaakkola", "createdAt": "2020-06-09T09:07:03Z", "path": "src/proxy-ui-api/frontend/src/views/InitialConfiguration/InitialConfiguration.vue", "diffHunk": "@@ -0,0 +1,231 @@\n+<template>\n+  <div class=\"view-wrap\">\n+    <subViewTitle\n+      class=\"view-title\"\n+      :title=\"$t('initialConfiguration.title')\"\n+      :showClose=\"false\"\n+      data-test=\"wizard-title\"\n+    />\n+    <v-stepper\n+      :alt-labels=\"true\"\n+      v-model=\"currentStep\"\n+      class=\"stepper noshadow\"\n+    >\n+      <!-- Headers without anchor page -->\n+      <v-stepper-header v-if=\"isAnchorImported\" class=\"noshadow\">\n+        <v-stepper-step :complete=\"currentStep > 1\" step=\"1\">{{\n+          $t('initialConfiguration.member.title')\n+        }}</v-stepper-step>\n+        <v-divider></v-divider>\n+        <v-stepper-step :complete=\"currentStep > 2\" step=\"2\">{{\n+          $t('initialConfiguration.pin.title')\n+        }}</v-stepper-step>\n+      </v-stepper-header>\n+      <!-- Headers with anchor page -->\n+      <v-stepper-header v-else class=\"noshadow\">\n+        <v-stepper-step :complete=\"currentStep > 1\" step=\"1\">{{\n+          $t('initialConfiguration.anchor.title')\n+        }}</v-stepper-step>\n+        <v-divider></v-divider>\n+        <v-stepper-step :complete=\"currentStep > 2\" step=\"2\">{{\n+          $t('initialConfiguration.member.title')\n+        }}</v-stepper-step>\n+        <v-divider></v-divider>\n+        <v-stepper-step :complete=\"currentStep > 3\" step=\"3\">{{\n+          $t('initialConfiguration.pin.title')\n+        }}</v-stepper-step>\n+      </v-stepper-header>\n+\n+      <v-stepper-items v-if=\"isAnchorImported\" class=\"stepper-content\">\n+        <!-- Member step -->\n+        <v-stepper-content step=\"1\">\n+          <OwnerMemberStep\n+            @done=\"ownerMemberReady\"\n+            :showPreviousButton=\"false\"\n+          />\n+        </v-stepper-content>\n+        <!-- PIN step -->\n+        <v-stepper-content step=\"2\">\n+          <TokenPinStep @previous=\"currentStep = 1\" @done=\"tokenPinReady\" />\n+        </v-stepper-content>\n+      </v-stepper-items>\n+\n+      <v-stepper-items v-else class=\"stepper-content\">\n+        <!-- Anchor step -->\n+        <v-stepper-content step=\"1\">\n+          <ConfigurationAnchorStep @done=\"configAnchorReady\" />\n+        </v-stepper-content>\n+        <!-- Member step -->\n+        <v-stepper-content step=\"2\">\n+          <OwnerMemberStep\n+            @previous=\"currentStep = 1\"\n+            @done=\"ownerMemberReady\"\n+          />\n+        </v-stepper-content>\n+        <!-- PIN step -->\n+        <v-stepper-content step=\"3\">\n+          <TokenPinStep\n+            @previous=\"currentStep = 2\"\n+            @done=\"tokenPinReady\"\n+            :saveBusy=\"pinSaveBusy\"\n+          />\n+        </v-stepper-content>\n+      </v-stepper-items>\n+    </v-stepper>\n+\n+    <!-- Confirm dialog for warnings when initializing server -->\n+    <warningDialog\n+      :dialog=\"confirmInitWarning\"\n+      :warnings=\"warningInfo\"\n+      localizationParent=\"initialConfiguration.warning\"\n+      @cancel=\"confirmInitWarning = false\"\n+      @accept=\"acceptInitWarning()\"\n+    ></warningDialog>\n+  </div>\n+</template>\n+\n+<script lang=\"ts\">\n+import Vue from 'vue';\n+import { mapGetters } from 'vuex';\n+import SubViewTitle from '@/components/ui/SubViewTitle.vue';\n+import TokenPinStep from './TokenPinStep.vue';\n+import ConfigurationAnchorStep from './ConfigurationAnchorStep.vue';\n+import WarningDialog from './WarningDialog.vue';\n+import OwnerMemberStep from './OwnerMemberStep.vue';\n+import { Key, Token } from '@/openapi-types';\n+import { RouteName, UsageTypes } from '@/global';\n+import * as api from '@/util/api';\n+\n+export default Vue.extend({\n+  components: {\n+    SubViewTitle,\n+    TokenPinStep,\n+    ConfigurationAnchorStep,\n+    OwnerMemberStep,\n+    WarningDialog,\n+  },\n+  props: {},\n+  computed: {\n+    ...mapGetters([\n+      'isAnchorImported',\n+      'isServerOwnerInitialized',\n+      'isServerCodeInitialized',\n+    ]),\n+  },\n+  data() {\n+    return {\n+      currentStep: 1,\n+      pinSaveBusy: false,\n+      warningInfo: [],\n+      confirmInitWarning: false,\n+      requestPayload: undefined as any,\n+    };\n+  },\n+  methods: {\n+    configAnchorReady(): void {\n+      this.currentStep++;\n+    },\n+\n+    ownerMemberReady(): void {\n+      this.currentStep++;\n+    },", "originalCommit": "5ad07518acfd285a62aa646cc920c5c8943bbd32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM4MzcyNA==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437383724", "bodyText": "fixed", "author": "Riippi", "createdAt": "2020-06-09T12:45:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI1NTA2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI1NjU4MA==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437256580", "bodyText": "Perhaps add optional chaining here as it might possible that error response doesn't include 'data'", "author": "TJaakkola", "createdAt": "2020-06-09T09:09:23Z", "path": "src/proxy-ui-api/frontend/src/views/InitialConfiguration/InitialConfiguration.vue", "diffHunk": "@@ -0,0 +1,231 @@\n+<template>\n+  <div class=\"view-wrap\">\n+    <subViewTitle\n+      class=\"view-title\"\n+      :title=\"$t('initialConfiguration.title')\"\n+      :showClose=\"false\"\n+      data-test=\"wizard-title\"\n+    />\n+    <v-stepper\n+      :alt-labels=\"true\"\n+      v-model=\"currentStep\"\n+      class=\"stepper noshadow\"\n+    >\n+      <!-- Headers without anchor page -->\n+      <v-stepper-header v-if=\"isAnchorImported\" class=\"noshadow\">\n+        <v-stepper-step :complete=\"currentStep > 1\" step=\"1\">{{\n+          $t('initialConfiguration.member.title')\n+        }}</v-stepper-step>\n+        <v-divider></v-divider>\n+        <v-stepper-step :complete=\"currentStep > 2\" step=\"2\">{{\n+          $t('initialConfiguration.pin.title')\n+        }}</v-stepper-step>\n+      </v-stepper-header>\n+      <!-- Headers with anchor page -->\n+      <v-stepper-header v-else class=\"noshadow\">\n+        <v-stepper-step :complete=\"currentStep > 1\" step=\"1\">{{\n+          $t('initialConfiguration.anchor.title')\n+        }}</v-stepper-step>\n+        <v-divider></v-divider>\n+        <v-stepper-step :complete=\"currentStep > 2\" step=\"2\">{{\n+          $t('initialConfiguration.member.title')\n+        }}</v-stepper-step>\n+        <v-divider></v-divider>\n+        <v-stepper-step :complete=\"currentStep > 3\" step=\"3\">{{\n+          $t('initialConfiguration.pin.title')\n+        }}</v-stepper-step>\n+      </v-stepper-header>\n+\n+      <v-stepper-items v-if=\"isAnchorImported\" class=\"stepper-content\">\n+        <!-- Member step -->\n+        <v-stepper-content step=\"1\">\n+          <OwnerMemberStep\n+            @done=\"ownerMemberReady\"\n+            :showPreviousButton=\"false\"\n+          />\n+        </v-stepper-content>\n+        <!-- PIN step -->\n+        <v-stepper-content step=\"2\">\n+          <TokenPinStep @previous=\"currentStep = 1\" @done=\"tokenPinReady\" />\n+        </v-stepper-content>\n+      </v-stepper-items>\n+\n+      <v-stepper-items v-else class=\"stepper-content\">\n+        <!-- Anchor step -->\n+        <v-stepper-content step=\"1\">\n+          <ConfigurationAnchorStep @done=\"configAnchorReady\" />\n+        </v-stepper-content>\n+        <!-- Member step -->\n+        <v-stepper-content step=\"2\">\n+          <OwnerMemberStep\n+            @previous=\"currentStep = 1\"\n+            @done=\"ownerMemberReady\"\n+          />\n+        </v-stepper-content>\n+        <!-- PIN step -->\n+        <v-stepper-content step=\"3\">\n+          <TokenPinStep\n+            @previous=\"currentStep = 2\"\n+            @done=\"tokenPinReady\"\n+            :saveBusy=\"pinSaveBusy\"\n+          />\n+        </v-stepper-content>\n+      </v-stepper-items>\n+    </v-stepper>\n+\n+    <!-- Confirm dialog for warnings when initializing server -->\n+    <warningDialog\n+      :dialog=\"confirmInitWarning\"\n+      :warnings=\"warningInfo\"\n+      localizationParent=\"initialConfiguration.warning\"\n+      @cancel=\"confirmInitWarning = false\"\n+      @accept=\"acceptInitWarning()\"\n+    ></warningDialog>\n+  </div>\n+</template>\n+\n+<script lang=\"ts\">\n+import Vue from 'vue';\n+import { mapGetters } from 'vuex';\n+import SubViewTitle from '@/components/ui/SubViewTitle.vue';\n+import TokenPinStep from './TokenPinStep.vue';\n+import ConfigurationAnchorStep from './ConfigurationAnchorStep.vue';\n+import WarningDialog from './WarningDialog.vue';\n+import OwnerMemberStep from './OwnerMemberStep.vue';\n+import { Key, Token } from '@/openapi-types';\n+import { RouteName, UsageTypes } from '@/global';\n+import * as api from '@/util/api';\n+\n+export default Vue.extend({\n+  components: {\n+    SubViewTitle,\n+    TokenPinStep,\n+    ConfigurationAnchorStep,\n+    OwnerMemberStep,\n+    WarningDialog,\n+  },\n+  props: {},\n+  computed: {\n+    ...mapGetters([\n+      'isAnchorImported',\n+      'isServerOwnerInitialized',\n+      'isServerCodeInitialized',\n+    ]),\n+  },\n+  data() {\n+    return {\n+      currentStep: 1,\n+      pinSaveBusy: false,\n+      warningInfo: [],\n+      confirmInitWarning: false,\n+      requestPayload: undefined as any,\n+    };\n+  },\n+  methods: {\n+    configAnchorReady(): void {\n+      this.currentStep++;\n+    },\n+\n+    ownerMemberReady(): void {\n+      this.currentStep++;\n+    },\n+\n+    tokenPinReady(pin: string): void {\n+      this.pinSaveBusy = true;\n+\n+      this.requestPayload = {\n+        software_token_pin: pin,\n+        ignore_warnings: false,\n+      };\n+\n+      // If owner member is not already set up add it\n+      if (!this.isServerOwnerInitialized) {\n+        this.requestPayload.owner_member_class = this.$store.getters.initServerMemberClass;\n+        this.requestPayload.owner_member_code = this.$store.getters.initServerMemberCode;\n+      }\n+\n+      // Add security code if it's not already set up\n+      if (!this.isServerCodeInitialized) {\n+        this.requestPayload.security_server_code = this.$store.getters.initServerSSCode;\n+      }\n+\n+      this.initServer(this.requestPayload);\n+    },\n+\n+    acceptInitWarning(): void {\n+      this.requestPayload.ignore_warnings = true;\n+      this.confirmInitWarning = false;\n+      this.initServer(this.requestPayload);\n+    },\n+\n+    initServer(payload: any): void {\n+      api\n+        .post('/initialization', payload)\n+        .then((res) => {\n+          this.$store.dispatch('showSuccess', 'initialConfiguration.success');\n+          this.pinSaveBusy = false;\n+          this.fetchCurrentSecurityServer();\n+          this.$router.replace({ name: RouteName.Clients });\n+        })\n+        .catch((error) => {\n+          if (error.response.data.warnings) {", "originalCommit": "5ad07518acfd285a62aa646cc920c5c8943bbd32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM4MzY2Ng==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437383666", "bodyText": "fixed", "author": "Riippi", "createdAt": "2020-06-09T12:45:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI1NjU4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI1ODk0Mw==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437258943", "bodyText": "Do we know the type for this parameter?", "author": "TJaakkola", "createdAt": "2020-06-09T09:13:19Z", "path": "src/proxy-ui-api/frontend/src/views/InitialConfiguration/OwnerMemberStep.vue", "diffHunk": "@@ -0,0 +1,235 @@\n+<template>\n+  <div>\n+    <ValidationObserver ref=\"form1\" v-slot=\"{ validate, invalid }\">\n+      <div class=\"row-wrap\">\n+        <FormLabel\n+          labelText=\"wizard.memberName\"\n+          helpText=\"wizard.client.memberNameTooltip\"\n+        />\n+        <div v-if=\"memberName\" data-test=\"selected-member-name\">\n+          {{ memberName }}\n+        </div>\n+      </div>\n+\n+      <div class=\"row-wrap\">\n+        <FormLabel\n+          labelText=\"wizard.memberClass\"\n+          helpText=\"wizard.client.memberClassTooltip\"\n+        />\n+\n+        <ValidationProvider name=\"addClient.memberClass\" rules=\"required\">\n+          <v-select\n+            v-model=\"memberClass\"\n+            :items=\"memberClassesCurrentInstance\"\n+            :disabled=\"isServerOwnerInitialized\"\n+            data-test=\"member-class-input\"\n+            class=\"form-input\"\n+          ></v-select>\n+        </ValidationProvider>\n+      </div>\n+      <div class=\"row-wrap\">\n+        <FormLabel\n+          labelText=\"wizard.memberCode\"\n+          helpText=\"wizard.client.memberCodeTooltip\"\n+        />\n+\n+        <ValidationProvider\n+          name=\"addClient.memberCode\"\n+          rules=\"required\"\n+          v-slot=\"{ errors }\"\n+        >\n+          <v-text-field\n+            class=\"form-input\"\n+            type=\"text\"\n+            :error-messages=\"errors\"\n+            :disabled=\"isServerOwnerInitialized\"\n+            v-model=\"memberCode\"\n+            data-test=\"member-code-input\"\n+          ></v-text-field>\n+        </ValidationProvider>\n+      </div>\n+\n+      <div class=\"row-wrap\">\n+        <FormLabel\n+          labelText=\"fields.securityServerCode\"\n+          helpText=\"initialConfiguration.member.serverCodeHelp\"\n+        />\n+\n+        <ValidationProvider\n+          name=\"securityServerCode\"\n+          rules=\"required\"\n+          v-slot=\"{ errors }\"\n+        >\n+          <v-text-field\n+            class=\"form-input\"\n+            type=\"text\"\n+            :error-messages=\"errors\"\n+            :disabled=\"isServerCodeInitialized\"\n+            v-model=\"securityServerCode\"\n+            data-test=\"security-server-code-input\"\n+          ></v-text-field>\n+        </ValidationProvider>\n+      </div>\n+\n+      <div class=\"button-footer\">\n+        <v-spacer></v-spacer>\n+        <div>\n+          <large-button\n+            v-if=\"showPreviousButton\"\n+            @click=\"previous\"\n+            outlined\n+            class=\"previous-button\"\n+            data-test=\"previous-button\"\n+            >{{ $t('action.previous') }}</large-button\n+          >\n+          <large-button\n+            :disabled=\"invalid\"\n+            @click=\"done\"\n+            data-test=\"save-button\"\n+            >{{ $t(saveButtonText) }}</large-button\n+          >\n+        </div>\n+      </div>\n+    </ValidationObserver>\n+  </div>\n+</template>\n+\n+<script lang=\"ts\">\n+import Vue from 'vue';\n+import { mapGetters } from 'vuex';\n+import { ValidationProvider, ValidationObserver } from 'vee-validate';\n+import LargeButton from '@/components/ui/LargeButton.vue';\n+import FormLabel from '@/components/ui/FormLabel.vue';\n+\n+export default Vue.extend({\n+  components: {\n+    LargeButton,\n+    ValidationObserver,\n+    ValidationProvider,\n+    FormLabel,\n+  },\n+  props: {\n+    saveButtonText: {\n+      type: String,\n+      default: 'action.continue',\n+    },\n+    showPreviousButton: {\n+      type: Boolean,\n+      default: true,\n+    },\n+  },\n+  computed: {\n+    ...mapGetters([\n+      'memberClassesCurrentInstance',\n+      'initExistingMembers',\n+      'currentSecurityServer',\n+      'isServerCodeInitialized',\n+      'isServerOwnerInitialized',\n+      'memberName',\n+    ]),\n+\n+    memberClass: {\n+      get(): string {\n+        if (this.currentSecurityServer?.member_class) {\n+          return this.currentSecurityServer.member_class;\n+        }\n+        return this.$store.getters.initServerMemberClass;\n+      },\n+      set(value: string) {\n+        this.$store.commit('storeInitServerMemberClass', value);\n+      },\n+    },\n+    memberCode: {\n+      get(): string {\n+        if (this.currentSecurityServer?.member_code) {\n+          return this.currentSecurityServer.member_code;\n+        }\n+        return this.$store.getters.initServerMemberCode;\n+      },\n+      set(value: string) {\n+        this.$store.commit('storeInitServerMemberCode', value);\n+      },\n+    },\n+    securityServerCode: {\n+      get(): string {\n+        if (this.currentSecurityServer?.server_code) {\n+          return this.currentSecurityServer.server_code;\n+        }\n+        return this.$store.getters.initServerSSCode;\n+      },\n+      set(value: string) {\n+        this.$store.commit('storeInitServerSSCode', value);\n+      },\n+    },\n+  },\n+  methods: {\n+    done(): void {\n+      this.$emit('done');\n+    },\n+    previous(): void {\n+      this.$emit('previous');\n+    },\n+\n+    checkMember(): void {\n+      if (this.memberClass?.length > 0 && this.memberCode?.length > 0) {\n+        this.$store\n+          .dispatch('fetchMemberName', {\n+            memberClass: this.memberClass,\n+            memberCode: this.memberCode,\n+          })\n+          .catch((error) => {\n+            if (error.response.status === 404) {\n+              // no match found\n+              return;\n+            }\n+            this.$store.dispatch('showError', error);\n+          });\n+      }\n+    },\n+  },\n+\n+  watch: {\n+    memberClassesCurrentInstance(val) {", "originalCommit": "5ad07518acfd285a62aa646cc920c5c8943bbd32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM4MzU0Ng==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437383546", "bodyText": "yes, added the type", "author": "Riippi", "createdAt": "2020-06-09T12:45:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI1ODk0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI2MDc0Nw==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437260747", "bodyText": "data-test for buttons", "author": "TJaakkola", "createdAt": "2020-06-09T09:16:08Z", "path": "src/proxy-ui-api/frontend/src/views/InitialConfiguration/WarningDialog.vue", "diffHunk": "@@ -0,0 +1,73 @@\n+<template>\n+  <v-dialog :value=\"dialog\" persistent :max-width=\"maxWidth\">\n+    <v-card>\n+      <v-card-title class=\"headline\">{{ $t('warning') }}</v-card-title>\n+      <v-card-text>\n+        <div v-for=\"warning in warnings\" :key=\"warning.code\">\n+          <!-- create the localisation key from warning code -->\n+          <div class=\"dlg-warning-header\">\n+            {{ $t(localizationParent + '.' + warning.code) }}\n+          </div>\n+          <div v-for=\"meta in warning.metadata\" :key=\"meta\">{{ meta }}</div>\n+        </div>\n+      </v-card-text>\n+      <v-card-actions>\n+        <v-spacer></v-spacer>\n+        <v-btn color=\"primary\" text outlined @click=\"cancel()\">{{\n+          $t(cancelButtonText)\n+        }}</v-btn>\n+        <v-btn color=\"primary\" text outlined @click=\"accept()\">{{", "originalCommit": "5ad07518acfd285a62aa646cc920c5c8943bbd32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM4MzQ0Mw==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437383443", "bodyText": "added", "author": "Riippi", "createdAt": "2020-06-09T12:45:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI2MDc0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI2MjY4OQ==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437262689", "bodyText": "While you're at it you could add data-test to the input-element before this large-button. It's not a part of this PR, but for the common good :)", "author": "TJaakkola", "createdAt": "2020-06-09T09:18:09Z", "path": "src/proxy-ui-api/frontend/src/views/Settings/SystemParameters/UploadConfigurationAnchorDialog.vue", "diffHunk": "@@ -12,17 +12,23 @@\n         data-test=\"system-parameters-configuration-anchor-upload-button\"", "originalCommit": "5ad07518acfd285a62aa646cc920c5c8943bbd32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM4MzM3MQ==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437383371", "bodyText": "That input element is not visible in the UI so it can't be clicked in the e2e tests. It's part of the file upload \"magic\".", "author": "Riippi", "createdAt": "2020-06-09T12:45:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI2MjY4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI2NTQ4NA==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437265484", "bodyText": "Missing typings in this data-block", "author": "TJaakkola", "createdAt": "2020-06-09T09:21:10Z", "path": "src/proxy-ui-api/frontend/src/views/Settings/SystemParameters/UploadConfigurationAnchorDialog.vue", "diffHunk": "@@ -106,8 +110,15 @@ export default Vue.extend({\n   components: {\n     LargeButton,\n   },\n+  props: {\n+    initMode: {\n+      type: Boolean,\n+      default: false,\n+    },\n+  },\n   data() {", "originalCommit": "5ad07518acfd285a62aa646cc920c5c8943bbd32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQwMjI3NQ==", "url": "https://github.com/nordic-institute/X-Road/pull/522#discussion_r437402275", "bodyText": "fixed", "author": "Riippi", "createdAt": "2020-06-09T13:08:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI2NTQ4NA=="}], "type": "inlineReview"}, {"oid": "66df15dd77dbdd3f15f31f461766bd0dca43c28c", "url": "https://github.com/nordic-institute/X-Road/commit/66df15dd77dbdd3f15f31f461766bd0dca43c28c", "message": "Merge branch 'develop' into XRDDEV-929-initialize-server\n\n# Conflicts:\n#\tsrc/proxy-ui-api/frontend/src/store/index.ts", "committedDate": "2020-06-09T13:13:26Z", "type": "commit"}, {"oid": "b4f7f0330d4ebf98ee94a53c33ad7ad92e62a01b", "url": "https://github.com/nordic-institute/X-Road/commit/b4f7f0330d4ebf98ee94a53c33ad7ad92e62a01b", "message": "XRDDEV-929 PR fixes", "committedDate": "2020-06-09T13:16:28Z", "type": "commit"}, {"oid": "4b7824d4901f68300120e373f7fc519572217cc4", "url": "https://github.com/nordic-institute/X-Road/commit/4b7824d4901f68300120e373f7fc519572217cc4", "message": "XRDDEV-929 Remove prefilled login info", "committedDate": "2020-06-09T14:25:25Z", "type": "commit"}]}