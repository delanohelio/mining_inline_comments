{"pr_number": 452, "pr_title": "XRDDEV-960 & XRDDEV-955", "pr_createdAt": "2020-04-07T10:14:03Z", "pr_url": "https://github.com/nordic-institute/X-Road/pull/452", "timeline": [{"oid": "93be6a2e361202f0c71085eb0b5d706658fdb293", "url": "https://github.com/nordic-institute/X-Road/commit/93be6a2e361202f0c71085eb0b5d706658fdb293", "message": "XRDDEV-803: Added api for fetching accessrights for an endpoint and UI for viewing them", "committedDate": "2020-03-02T13:59:42Z", "type": "commit"}, {"oid": "07c213e90041e9e651016fcf169d61f9485424aa", "url": "https://github.com/nordic-institute/X-Road/commit/07c213e90041e9e651016fcf169d61f9485424aa", "message": "XRDDEV-803: Add backend api and ui changes for removing access rights", "committedDate": "2020-03-03T14:42:40Z", "type": "commit"}, {"oid": "35078da7363867c7c6f16e6b8ae039d75cda9be0", "url": "https://github.com/nordic-institute/X-Road/commit/35078da7363867c7c6f16e6b8ae039d75cda9be0", "message": "XRDDEV-803: Add backend api and UI for adding subjects to an endpoint", "committedDate": "2020-03-04T13:18:34Z", "type": "commit"}, {"oid": "a1bad6ef9b86f81e452dc1104bd2b034fa6386f2", "url": "https://github.com/nordic-institute/X-Road/commit/a1bad6ef9b86f81e452dc1104bd2b034fa6386f2", "message": "XRDDEV-803: Change base path for service description of type REST to be generated = true by default", "committedDate": "2020-03-05T14:54:27Z", "type": "commit"}, {"oid": "4fde80f3ed77feaee0b6c0f6f59400b9a1f8b478", "url": "https://github.com/nordic-institute/X-Road/commit/4fde80f3ed77feaee0b6c0f6f59400b9a1f8b478", "message": "XRDDEV-803: Add tests, fixes to api and UI improvements to adding access rights for an endpoint", "committedDate": "2020-03-10T08:31:10Z", "type": "commit"}, {"oid": "eb22d69b746006bcefd33bd0d051e1de003554c7", "url": "https://github.com/nordic-institute/X-Road/commit/eb22d69b746006bcefd33bd0d051e1de003554c7", "message": "Refactoring access rights backend implementations to reuse code and minor fixes to UI", "committedDate": "2020-03-10T11:10:20Z", "type": "commit"}, {"oid": "b69523a0c120a501f08783213332fa79bd838e1b", "url": "https://github.com/nordic-institute/X-Road/commit/b69523a0c120a501f08783213332fa79bd838e1b", "message": "Merge branch 'develop' into XRDDEV-803", "committedDate": "2020-03-10T11:24:03Z", "type": "commit"}, {"oid": "ce5bedf56206aae88f7d96f2865c070d2c3bba11", "url": "https://github.com/nordic-institute/X-Road/commit/ce5bedf56206aae88f7d96f2865c070d2c3bba11", "message": "XRDDEV-803: Use constant instead of repeating string to fix sonarqube issue", "committedDate": "2020-03-10T12:57:30Z", "type": "commit"}, {"oid": "0c1f4bd25ed42b57c44973f95a61874b7541110a", "url": "https://github.com/nordic-institute/X-Road/commit/0c1f4bd25ed42b57c44973f95a61874b7541110a", "message": "XRDDEV-803: Add typings to state object and rights given at -info to service parameters", "committedDate": "2020-03-26T14:42:45Z", "type": "commit"}, {"oid": "dbfad6f09697bddf34c0f2ee758edf3f405d686b", "url": "https://github.com/nordic-institute/X-Road/commit/dbfad6f09697bddf34c0f2ee758edf3f405d686b", "message": "XRDDEV-803: Remove <p> -tags from license headers", "committedDate": "2020-03-26T14:48:40Z", "type": "commit"}, {"oid": "54aa54c040a29de246a06e7975709758893dc934", "url": "https://github.com/nordic-institute/X-Road/commit/54aa54c040a29de246a06e7975709758893dc934", "message": "XRDDEV-803: remove maxLength from endpoint id in api", "committedDate": "2020-03-26T19:29:14Z", "type": "commit"}, {"oid": "31af27300ab8c732353cd52aa03b5b157b6fc830", "url": "https://github.com/nordic-institute/X-Road/commit/31af27300ab8c732353cd52aa03b5b157b6fc830", "message": "XRDDEV-803: Extract EndpointNotFoundException to an independent class", "committedDate": "2020-03-26T20:39:51Z", "type": "commit"}, {"oid": "b1436c79b5ffe314e141b10446faaf9cc13758cf", "url": "https://github.com/nordic-institute/X-Road/commit/b1436c79b5ffe314e141b10446faaf9cc13758cf", "message": "XRDDEV-803: Refactored size comparison to use isEmpty", "committedDate": "2020-03-26T20:50:30Z", "type": "commit"}, {"oid": "c33581477332e80a914b044b4e716e696618b2a5", "url": "https://github.com/nordic-institute/X-Road/commit/c33581477332e80a914b044b4e716e696618b2a5", "message": "XRDDEV-803: Changed localization keys according to pull request comments", "committedDate": "2020-03-27T07:32:50Z", "type": "commit"}, {"oid": "62dabf7285053bf334b7ab0b16f5d3a2cd5a95de", "url": "https://github.com/nordic-institute/X-Road/commit/62dabf7285053bf334b7ab0b16f5d3a2cd5a95de", "message": "XRDDEV-803: Remove duplicate code and improve method documentation", "committedDate": "2020-03-27T09:10:05Z", "type": "commit"}, {"oid": "d5c96ed5c35963f53147212ad4dab5c4410aa86c", "url": "https://github.com/nordic-institute/X-Road/commit/d5c96ed5c35963f53147212ad4dab5c4410aa86c", "message": "XRDDEV-803: Refactoring EndpointNotFoundByServiceNameException out modifying EndpointNotFoundException. Also created getBaseEndpoint -method", "committedDate": "2020-03-27T11:17:21Z", "type": "commit"}, {"oid": "39b448ef6c2bde26739e906d8ca8789e0e7b737b", "url": "https://github.com/nordic-institute/X-Road/commit/39b448ef6c2bde26739e906d8ca8789e0e7b737b", "message": "XRDDEV-803: Remove duplicate method", "committedDate": "2020-03-27T11:30:48Z", "type": "commit"}, {"oid": "6575b36e916c8b1f60a051e39fa89de46571dd20", "url": "https://github.com/nordic-institute/X-Road/commit/6575b36e916c8b1f60a051e39fa89de46571dd20", "message": "XRDDEV-803: Improving method namings and remove unnecessary verifyAuthority -checks", "committedDate": "2020-03-27T12:59:58Z", "type": "commit"}, {"oid": "7d93c8670628322780e326c6b0653b0b4327ba51", "url": "https://github.com/nordic-institute/X-Road/commit/7d93c8670628322780e326c6b0653b0b4327ba51", "message": "XRDDEV-803: Change LocalGroupNotFoundException to AccessRightNotFoundException when it's thrown in AccessRightService", "committedDate": "2020-03-27T13:53:21Z", "type": "commit"}, {"oid": "09771b4c0d38ce8b2c7f4ba7a3d105e288a7213a", "url": "https://github.com/nordic-institute/X-Road/commit/09771b4c0d38ce8b2c7f4ba7a3d105e288a7213a", "message": "XRDDEV-803: Change LocalGroupNotFoundException to AccessRightNotFoundException for improved consistency", "committedDate": "2020-03-30T08:31:14Z", "type": "commit"}, {"oid": "bee8da54e5504ec0616f0b98ecbba6e8fb306483", "url": "https://github.com/nordic-institute/X-Road/commit/bee8da54e5504ec0616f0b98ecbba6e8fb306483", "message": "XRDDEV-803 Fix code style conflicts", "committedDate": "2020-03-30T09:10:57Z", "type": "commit"}, {"oid": "31d3371aa15689e339a5711565c4d377847bd5ae", "url": "https://github.com/nordic-institute/X-Road/commit/31d3371aa15689e339a5711565c4d377847bd5ae", "message": "Merge branch 'develop' into XRDDEV-803", "committedDate": "2020-03-30T09:33:29Z", "type": "commit"}, {"oid": "59da4b69f16bd1dae2a7998e902670b31f7b9c82", "url": "https://github.com/nordic-institute/X-Road/commit/59da4b69f16bd1dae2a7998e902670b31f7b9c82", "message": "XRDDEV-803: Fix merge conflicts", "committedDate": "2020-03-30T10:38:32Z", "type": "commit"}, {"oid": "07f9ed282fe3ac58fb94ae9a9db79a4a34028355", "url": "https://github.com/nordic-institute/X-Road/commit/07f9ed282fe3ac58fb94ae9a9db79a4a34028355", "message": "XRDDEV-803: Remove duplicate markup", "committedDate": "2020-03-30T12:03:52Z", "type": "commit"}, {"oid": "ca77a8bbab12dd9ef458f86f8ac5b6c2d24be68a", "url": "https://github.com/nordic-institute/X-Road/commit/ca77a8bbab12dd9ef458f86f8ac5b6c2d24be68a", "message": "XRDDEV-960: Add for fetching client serviceclients", "committedDate": "2020-03-31T13:10:31Z", "type": "commit"}, {"oid": "489da8bad43bf4b296bb782a9f8a1dd58bff82c3", "url": "https://github.com/nordic-institute/X-Road/commit/489da8bad43bf4b296bb782a9f8a1dd58bff82c3", "message": "XRDDEV-960: return unique service clients for a client", "committedDate": "2020-04-01T06:01:50Z", "type": "commit"}, {"oid": "5535c3c61c94b4ed445cfeee76e5d7d755c8cad6", "url": "https://github.com/nordic-institute/X-Road/commit/5535c3c61c94b4ed445cfeee76e5d7d755c8cad6", "message": "XRDDEV-955: view for service clients list", "committedDate": "2020-04-01T06:02:55Z", "type": "commit"}, {"oid": "b3641b0479f24d15c22fa97d3bfe566c7693d6cf", "url": "https://github.com/nordic-institute/X-Road/commit/b3641b0479f24d15c22fa97d3bfe566c7693d6cf", "message": "XRDDEV-960: Remove unused imports", "committedDate": "2020-04-01T14:53:03Z", "type": "commit"}, {"oid": "e71f66e874923d3dc6c9dacdf0ff195fa85970ab", "url": "https://github.com/nordic-institute/X-Road/commit/e71f66e874923d3dc6c9dacdf0ff195fa85970ab", "message": "XRDDEV-960: Add tests for fetching service clients", "committedDate": "2020-04-01T14:53:45Z", "type": "commit"}, {"oid": "19a35ba8ecf4e6af855e9c0500f4eb28a7960747", "url": "https://github.com/nordic-institute/X-Road/commit/19a35ba8ecf4e6af855e9c0500f4eb28a7960747", "message": "XRDDEV-955: Fix linter errors", "committedDate": "2020-04-01T14:54:16Z", "type": "commit"}, {"oid": "b693ec93d43199f7b66724e3cb5e5c1f9282bceb", "url": "https://github.com/nordic-institute/X-Road/commit/b693ec93d43199f7b66724e3cb5e5c1f9282bceb", "message": "XRDDEV-803: Remove unnecessary VerifyAuthority calls", "committedDate": "2020-04-02T13:05:23Z", "type": "commit"}, {"oid": "9651a6b5f937ee6de0d0793b884a21a620d2bdeb", "url": "https://github.com/nordic-institute/X-Road/commit/9651a6b5f937ee6de0d0793b884a21a620d2bdeb", "message": "XRDDEV-803: Refactoring\n\nRename getBaseEndpoint to getServiceBaseEndpoint and remove client parameter as ServiceType is the only object needed to handle the functionality\nRemove duplication", "committedDate": "2020-04-02T14:22:50Z", "type": "commit"}, {"oid": "560796a5ad74523edb0d38248518424d20eae468", "url": "https://github.com/nordic-institute/X-Road/commit/560796a5ad74523edb0d38248518424d20eae468", "message": "Merge branch 'develop' into XRDDEV-803", "committedDate": "2020-04-02T14:27:49Z", "type": "commit"}, {"oid": "ff171001a550aedaa8ab26f9276be4f5be827363", "url": "https://github.com/nordic-institute/X-Road/commit/ff171001a550aedaa8ab26f9276be4f5be827363", "message": "Merge branch 'XRDDEV-803' into XRDDEV-960_XRDDEV-955", "committedDate": "2020-04-02T14:30:50Z", "type": "commit"}, {"oid": "c33b25ee3935625a1d1b179e39cd96434e437e23", "url": "https://github.com/nordic-institute/X-Road/commit/c33b25ee3935625a1d1b179e39cd96434e437e23", "message": "XRDDEV-803: Replace verifyAuthority method usage with preAuthorize-annotation", "committedDate": "2020-04-03T07:22:16Z", "type": "commit"}, {"oid": "b7126c0401691e1b5595337c51c570df052bc701", "url": "https://github.com/nordic-institute/X-Road/commit/b7126c0401691e1b5595337c51c570df052bc701", "message": "Merge branch 'XRDDEV-803' into XRDDEV-960_XRDDEV-955", "committedDate": "2020-04-03T08:29:19Z", "type": "commit"}, {"oid": "277db6af5629750d113789936e6936f563033574", "url": "https://github.com/nordic-institute/X-Road/commit/277db6af5629750d113789936e6936f563033574", "message": "Merge branch 'develop' into XRDDEV-803", "committedDate": "2020-04-06T16:01:30Z", "type": "commit"}, {"oid": "2518e59436dcc805bee8e3981d8d0560a2d908a4", "url": "https://github.com/nordic-institute/X-Road/commit/2518e59436dcc805bee8e3981d8d0560a2d908a4", "message": "XRDDEV-803: Fix exception type thrown after changed verifyAuthority to PreAuthorize", "committedDate": "2020-04-06T16:39:54Z", "type": "commit"}, {"oid": "f26a9ac692d928c9d7408ed3ebc7257e2bf825c8", "url": "https://github.com/nordic-institute/X-Road/commit/f26a9ac692d928c9d7408ed3ebc7257e2bf825c8", "message": "XRDDEV-803: Remove unused import", "committedDate": "2020-04-06T17:29:16Z", "type": "commit"}, {"oid": "9fec2ec0274709b629a666d75f349710b939bae6", "url": "https://github.com/nordic-institute/X-Road/commit/9fec2ec0274709b629a666d75f349710b939bae6", "message": "Merge branch 'XRDDEV-803' into XRDDEV-960_XRDDEV-955", "committedDate": "2020-04-07T10:20:24Z", "type": "commit"}, {"oid": "0257b6229967393850e65d58b444d3e02823481f", "url": "https://github.com/nordic-institute/X-Road/commit/0257b6229967393850e65d58b444d3e02823481f", "message": "XRDDEV-960: Fix checkstyle issue", "committedDate": "2020-04-07T11:10:24Z", "type": "commit"}, {"oid": "d1d5511015cc34c4d02c674d6efe519228d9a409", "url": "https://github.com/nordic-institute/X-Road/commit/d1d5511015cc34c4d02c674d6efe519228d9a409", "message": "Merge branch 'develop' into XRDDEV-960_XRDDEV-955", "committedDate": "2020-04-08T06:00:22Z", "type": "commit"}, {"oid": "9c65a52509b2879d5e62d2eed3339cfa2a7c66b4", "url": "https://github.com/nordic-institute/X-Road/commit/9c65a52509b2879d5e62d2eed3339cfa2a7c66b4", "message": "XRDDEV-955: Add filtering for service clients", "committedDate": "2020-04-08T14:05:28Z", "type": "commit"}, {"oid": "0374282e4059785c4b584dc515937e0886585ef6", "url": "https://github.com/nordic-institute/X-Road/commit/0374282e4059785c4b584dc515937e0886585ef6", "message": "XRDDEV-955: Remove function calls added for testing", "committedDate": "2020-04-08T14:14:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3MDgwOQ==", "url": "https://github.com/nordic-institute/X-Road/pull/452#discussion_r406170809", "bodyText": "Probably correct reaction to this, but parameter numbers warning is probably also an indication that this controller is getting too large. That's probably true, but there's not much we can do about the controller size & parameter numbers, since it is direct result of the API design.", "author": "jansu76", "createdAt": "2020-04-09T12:32:45Z", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/openapi/ClientsApiController.java", "diffHunk": "@@ -113,18 +115,20 @@\n     private final SubjectConverter subjectConverter;\n     private final TokenCertificateConverter tokenCertificateConverter;\n     private final OrphanRemovalService orphanRemovalService;\n+    private final ServiceClientConverter serviceClientConverter;\n \n     /**\n      * ClientsApiController constructor\n      */\n+    @SuppressWarnings(\"checkstyle:ParameterNumber\")", "originalCommit": "0374282e4059785c4b584dc515937e0886585ef6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIzMzk0Ng==", "url": "https://github.com/nordic-institute/X-Road/pull/452#discussion_r406233946", "bodyText": "Yeah, I don't know if we can do anything (else than refactoring api) with this(?)", "author": "TJaakkola", "createdAt": "2020-04-09T14:12:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3MDgwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3MjIyNg==", "url": "https://github.com/nordic-institute/X-Road/pull/452#discussion_r406172226", "bodyText": "Would it make sense to split AccessRightService into AccessRightService and ServiceClientService? It's quite big already.\nIf so, it probably makes sense to do it in XRDDEV-961 branch after refactoring, though.", "author": "jansu76", "createdAt": "2020-04-09T12:35:29Z", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/AccessRightService.java", "diffHunk": "@@ -96,6 +96,30 @@ public AccessRightService(LocalGroupRepository localGroupRepository, GlobalConfF\n         this.endpointService = endpointService;\n     }\n \n+    public List<AccessRightHolderDto> getAccessRightHoldersByClient(ClientId clientId)", "originalCommit": "0374282e4059785c4b584dc515937e0886585ef6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIzMzQwNA==", "url": "https://github.com/nordic-institute/X-Road/pull/452#discussion_r406233404", "bodyText": "I did think whether I should have created ServiceClientService already in this ticket (created in XRDDEV-961 -branch) but as access right logic for endpoints was also in this service class I decided to move it also here. But I guess it would sense to move the logic to ServiceClientService as this logic is a bit different.", "author": "TJaakkola", "createdAt": "2020-04-09T14:11:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3MjIyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg1OTEwNQ==", "url": "https://github.com/nordic-institute/X-Road/pull/452#discussion_r407859105", "bodyText": "Part of the service methods are moved to ServiceClientService in XRDDEV-961", "author": "TJaakkola", "createdAt": "2020-04-14T04:26:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3MjIyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3MzE3MQ==", "url": "https://github.com/nordic-institute/X-Road/pull/452#discussion_r406173171", "bodyText": "Missing javadocs, I think all public (service) methods should have ones? This one might explain the base endpoint -filtering and what it means for the caller.", "author": "jansu76", "createdAt": "2020-04-09T12:37:18Z", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/AccessRightService.java", "diffHunk": "@@ -96,6 +96,30 @@ public AccessRightService(LocalGroupRepository localGroupRepository, GlobalConfF\n         this.endpointService = endpointService;\n     }\n \n+    public List<AccessRightHolderDto> getAccessRightHoldersByClient(ClientId clientId)", "originalCommit": "0374282e4059785c4b584dc515937e0886585ef6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI3MzY3MQ==", "url": "https://github.com/nordic-institute/X-Road/pull/452#discussion_r406273671", "bodyText": "Added javadoc and also a brief definition of base endpoint. Also added base endpoint definition to EndpointType as it contains isBaseEndpoint-method. Don't know if this is the best place.", "author": "TJaakkola", "createdAt": "2020-04-09T15:07:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3MzE3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3NTA5OQ==", "url": "https://github.com/nordic-institute/X-Road/pull/452#discussion_r406175099", "bodyText": "It is quite clear when you read the code, and has a descriptive name, but it might make sense to add a tiny comment to explain what it does?", "author": "jansu76", "createdAt": "2020-04-09T12:40:53Z", "path": "src/proxy-ui-api/src/main/java/org/niis/xroad/restapi/service/AccessRightService.java", "diffHunk": "@@ -96,6 +96,30 @@ public AccessRightService(LocalGroupRepository localGroupRepository, GlobalConfF\n         this.endpointService = endpointService;\n     }\n \n+    public List<AccessRightHolderDto> getAccessRightHoldersByClient(ClientId clientId)\n+            throws ClientNotFoundException {\n+        ClientType clientType = clientRepository.getClient(clientId);\n+        if (clientType == null) {\n+            throw new ClientNotFoundException(\"Client \" + clientId.toShortString() + \" not found\");\n+        }\n+        // Filter just acls that are set to base endpoints so they are on service code level\n+        List<AccessRightType> serviceCodeLevelAcls = clientType.getAcl().stream()\n+                .filter(acl -> acl.getEndpoint().isBaseEndpoint())\n+                .collect(Collectors.toList());\n+        List<AccessRightType> distinctAccessRightTypes = distinctAccessRightTypeByXroadId(serviceCodeLevelAcls);\n+        return mapAccessRightsToAccessRightHolders(clientType, distinctAccessRightTypes);\n+    }\n+\n+    private List<AccessRightType> distinctAccessRightTypeByXroadId(List<AccessRightType> acls) {", "originalCommit": "0374282e4059785c4b584dc515937e0886585ef6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI3MzgwOQ==", "url": "https://github.com/nordic-institute/X-Road/pull/452#discussion_r406273809", "bodyText": "Added short description", "author": "TJaakkola", "createdAt": "2020-04-09T15:07:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3NTA5OQ=="}], "type": "inlineReview"}, {"oid": "a4dc2f87d667ed156ef7ec206d4f679afa65f54a", "url": "https://github.com/nordic-institute/X-Road/commit/a4dc2f87d667ed156ef7ec206d4f679afa65f54a", "message": "Merge branch 'develop' into XRDDEV-960_XRDDEV-955", "committedDate": "2020-04-09T14:35:28Z", "type": "commit"}, {"oid": "94da0cc968c568b6a76c782cdf4e021ddba9a29b", "url": "https://github.com/nordic-institute/X-Road/commit/94da0cc968c568b6a76c782cdf4e021ddba9a29b", "message": "XRDDEV-960: Add comments, Javadocs and brief definion for concept of base endpoint", "committedDate": "2020-04-09T15:10:20Z", "type": "commit"}]}