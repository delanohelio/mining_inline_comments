{"pr_number": 1223, "pr_title": "HDDS-3990. Test Kubernetes examples with acceptance tests", "pr_createdAt": "2020-07-20T10:29:48Z", "pr_url": "https://github.com/apache/ozone/pull/1223", "timeline": [{"oid": "9c596bccef667fb254dd39fbf5f3e9e2d173fd78", "url": "https://github.com/apache/ozone/commit/9c596bccef667fb254dd39fbf5f3e9e2d173fd78", "message": "HDDS-3990. Test Kubernetes examples with acceptance tests", "committedDate": "2020-07-20T10:28:34Z", "type": "commit"}, {"oid": "9144ea93bc6adbb67610b9031d6b16f09b1cf5ab", "url": "https://github.com/apache/ozone/commit/9144ea93bc6adbb67610b9031d6b16f09b1cf5ab", "message": "retrigger build with empty commit", "committedDate": "2020-07-21T08:13:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY1NzI0MA==", "url": "https://github.com/apache/ozone/pull/1223#discussion_r460657240", "bodyText": "Argument is not needed since combine_reports uses pwd instead of parameter -- applies to all test.sh scripts.", "author": "adoroszlai", "createdAt": "2020-07-27T05:40:13Z", "path": "hadoop-ozone/dist/src/main/k8s/examples/getting-started/test.sh", "diffHunk": "@@ -0,0 +1,38 @@\n+#!/usr/bin/env bash\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+export K8S_DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" >/dev/null 2>&1 && pwd )\"\n+\n+cd \"$K8S_DIR\"\n+\n+# shellcheck source=/dev/null\n+source \"../testlib.sh\"\n+\n+rm -rf result\n+\n+regenerate_resources\n+\n+start_k8s_env\n+\n+execute_robot_test scm-0 smoketest/basic/basic.robot\n+\n+combine_reports 'getting-started'", "originalCommit": "9144ea93bc6adbb67610b9031d6b16f09b1cf5ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDg0MTUzMQ==", "url": "https://github.com/apache/ozone/pull/1223#discussion_r460841531", "bodyText": "Right, thanks. Removing them.", "author": "elek", "createdAt": "2020-07-27T12:04:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY1NzI0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY2MjA2Mg==", "url": "https://github.com/apache/ozone/pull/1223#discussion_r460662062", "bodyText": "If I understand correctly, this flekszible generate call is only needed when executed from source dir (hadoop-ozone/dist/src/main/k8s) to restore source files.  I propose it to be executed as part of stop_k8s_env:\n\nI ran tests from target/..., had some errors and tried to find out what's wrong.  It was confusing to see resource files referencing non-existent docker image apache/ozone:0.6.0-SNAPSHOT (plus other differences compared to the files actually used for the test).\nAvoid possible omission in new scripts.\nReduce code duplication.\nSave some very minimal runtime cost.", "author": "adoroszlai", "createdAt": "2020-07-27T05:57:17Z", "path": "hadoop-ozone/dist/src/main/k8s/examples/getting-started/test.sh", "diffHunk": "@@ -0,0 +1,38 @@\n+#!/usr/bin/env bash\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+export K8S_DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" >/dev/null 2>&1 && pwd )\"\n+\n+cd \"$K8S_DIR\"\n+\n+# shellcheck source=/dev/null\n+source \"../testlib.sh\"\n+\n+rm -rf result\n+\n+regenerate_resources\n+\n+start_k8s_env\n+\n+execute_robot_test scm-0 smoketest/basic/basic.robot\n+\n+combine_reports 'getting-started'\n+\n+stop_k8s_env\n+\n+flekszible generate", "originalCommit": "9144ea93bc6adbb67610b9031d6b16f09b1cf5ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDg0OTYyOA==", "url": "https://github.com/apache/ozone/pull/1223#discussion_r460849628", "bodyText": "Here we have a main problem: some of the Kubernetes examples couldn't be started in the test environment. For example when the example is configured to schedule one datanode per real node, but we have only one node.\nTherefore, before the tests the resource files are heavily modified:\n\ninstead of using latest image, the current build is mounted to the /opt/ozone (similar to the docker tests)\nanti-affinity rules are removed (enable to run multiple datanode on the same node)\nreal persistence is removed\n\nThese are executed by the regenerate_resources step at the beginning of the test. Which is something like this:\nflekszible generate -t mount:hostPath=\"$OZONE_ROOT\",path=/opt/hadoop -t image:image=apache/ozone-runner:20200420-1 -t ozone/onenode\n\nAs you can see we define three new transformations on the fly:\n\n-t mount:hostPath=\"$OZONE_ROOT\",path=/opt/hadoop --> use the files from the current build\n-t image:image=apache/ozone-runner:20200420-1, use standard runner\n-t ozone/onenode enable to schedule more datanode to the same node\n\nThe line which is commented by you:\nflekszible generate\n\nIs 100% optional. After the test, it restores the original state of the files. It can be added to the stop_k8s_env (as it can always be added).\nBut based on the experience with the docker test.sh files, I would prefer to use more explicit lines in the test.sh.\nAs test.sh files are read frequently but modified only by a few times, I tend to make it slightly more verbose, but easier to understand (you can assume that stop_k8s_env stops kubernetes pods, but I wouldn't like to hide any hidden functionlaty there.\nBut theses are just my thought, as it's a beginning of new test, I am really open to modify to any direction.", "author": "elek", "createdAt": "2020-07-27T12:20:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY2MjA2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxMjMxNQ==", "url": "https://github.com/apache/ozone/pull/1223#discussion_r461012315", "bodyText": "Thanks for confirming my guess.\nI'm fine with making test.sh more verbose at the cost of some duplication.  However, I propose extracting this optional flekszible generate to a function, and let it check if it's being run from src dir, to address my first point.", "author": "adoroszlai", "createdAt": "2020-07-27T16:23:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY2MjA2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjE2NDMxMg==", "url": "https://github.com/apache/ozone/pull/1223#discussion_r462164312", "bodyText": "and let it check if it's being run from src dir, to address my first point\n\n\nI ran tests from target/..., had some errors and tried to find out what's wrong.\n\nI am not sure what was the problem in your case. It supposed to work from the target directory. In fact hadoop-ozone/dev-support/checks/kubernetes.sh executes all the tests from target by default.\napache/ozone:0.6.0-SNAPSHOT is used because during the release it becomes apache/ozone:0.6.0 which is the distributed container.\n./test.sh (with the first flekszible generation) replaces all the images with a dev version (ozone-runner + mount).\nIt seems to be working for me and passed on the github CI, but if you see any error, please let me know as it should work everywhere (do you have the latest released flekszible?)", "author": "elek", "createdAt": "2020-07-29T09:27:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY2MjA2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjIyNjc4OQ==", "url": "https://github.com/apache/ozone/pull/1223#discussion_r462226789", "bodyText": "Let me clarify: I think the script would have worked fine, but I tried to use k3d (k3s in docker) instead of plain k3s.  Since the local dir was not available in the container, it failed.\nThe confusing part was that the resource files did not mention volume mounts, since they were converted back at the end.  So only by looking at regenerate_resources in testlib did I realize what's wrong.", "author": "adoroszlai", "createdAt": "2020-07-29T11:24:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY2MjA2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg4NjkwNw==", "url": "https://github.com/apache/ozone/pull/1223#discussion_r462886907", "bodyText": "Yes, that's what came into my mind, too.\nToday, it's not possible to run test on remote clusters (k3d is a remote cluster) as local mount doesn't work.\nI can introduce some options in the future (would be great to execute tests on real environments, too).\nFor now, I will add a log message to the regenerate_resource to print a warning to the stdout.", "author": "elek", "createdAt": "2020-07-30T09:57:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY2MjA2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY2NTYwOA==", "url": "https://github.com/apache/ozone/pull/1223#discussion_r460665608", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # bats gc_opts.bats (FROM THE CURRENT DIRECTORY)\n          \n          \n            \n            # bats testlib.bats (FROM THE CURRENT DIRECTORY)", "author": "adoroszlai", "createdAt": "2020-07-27T06:09:11Z", "path": "hadoop-ozone/dist/src/main/k8s/examples/testlib.bats", "diffHunk": "@@ -0,0 +1,61 @@\n+#!/usr/bin/env bash\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+\n+\n+#\n+# Can be executed with bats (https://github.com/bats-core/bats-core)\n+# bats gc_opts.bats (FROM THE CURRENT DIRECTORY)", "originalCommit": "9144ea93bc6adbb67610b9031d6b16f09b1cf5ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY3MzI5OQ==", "url": "https://github.com/apache/ozone/pull/1223#discussion_r460673299", "bodyText": "One more: doesn't this test belong to src/test?", "author": "adoroszlai", "createdAt": "2020-07-27T06:31:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY2NTYwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY2NzQyMw==", "url": "https://github.com/apache/ozone/pull/1223#discussion_r460667423", "bodyText": "Is there any way to avoid hard-coding the image name?", "author": "adoroszlai", "createdAt": "2020-07-27T06:14:44Z", "path": "hadoop-ozone/dist/src/main/k8s/examples/testlib.sh", "diffHunk": "@@ -0,0 +1,125 @@\n+#!/usr/bin/env bash\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+retry() {\n+   n=0\n+   until [ $n -ge 30 ]\n+   do\n+      \"$@\" && break\n+      n=$[$n+1]\n+      echo \"$n '$@' is failed...\"\n+      sleep ${RETRY_SLEEP:-3}\n+   done\n+   if [ $n -eq 30 ]; then\n+      return 255\n+   fi\n+}\n+\n+grep_log() {\n+   CONTAINER=\"$1\"\n+   PATTERN=\"$2\"\n+   kubectl logs \"$1\"  | grep \"$PATTERN\"\n+}\n+\n+wait_for_startup(){\n+   print_phase \"Waiting until the k8s cluster is running\"\n+   retry all_pods_are_running\n+   retry grep_log scm-0 \"SCM exiting safe mode.\"\n+   retry grep_log om-0 \"HTTP server of ozoneManager listening\"\n+   print_phase \"Cluster is up and running\"\n+}\n+\n+all_pods_are_running() {\n+   RUNNING_COUNT=$(kubectl get pod --field-selector status.phase=Running | wc -l)\n+   ALL_COUNT=$(kubectl get pod | wc -l)\n+   RUNNING_COUNT=$((RUNNING_COUNT - 1))\n+   ALL_COUNT=$((ALL_COUNT - 1))\n+   if [ \"$RUNNING_COUNT\" -lt \"3\" ]; then\n+      echo \"$RUNNING_COUNT pods are running. Waiting for more.\"\n+      return 1\n+   elif [ \"$RUNNING_COUNT\" -ne \"$ALL_COUNT\" ]; then\n+      echo \"$RUNNING_COUNT pods are running out from the $ALL_COUNT\"\n+      return 2\n+   else\n+      STARTED=true\n+      return 0\n+   fi\n+}\n+\n+start_k8s_env() {\n+   print_phase \"Deleting existing k8s resources\"\n+   #reset environment\n+   kubectl delete pvc --all\n+   kubectl delete pv --all\n+   kubectl delete statefulset --all\n+   kubectl delete daemonset --all\n+   kubectl delete deployment --all\n+   kubectl delete service --all\n+   kubectl delete configmap --all\n+   kubectl delete pod --all\n+\n+   print_phase \"Applying k8s resources from $1\"\n+   kubectl apply -f .\n+   wait_for_startup\n+}\n+\n+stop_k8s_env() {\n+   if [ ! \"$KEEP_RUNNING\" ]; then\n+     kubectl delete -f .\n+   fi\n+}\n+\n+regenerate_resources() {\n+  PARENT_OF_PARENT=$(realpath ../..)\n+\n+  if [ $(basename $PARENT_OF_PARENT) == \"k8s\" ]; then\n+    #running from src dir\n+    OZONE_ROOT=$(realpath ../../../../../target/ozone-0.6.0-SNAPSHOT)\n+  else\n+    #running from dist\n+    OZONE_ROOT=$(realpath ../../..)\n+  fi\n+\n+  flekszible generate -t mount:hostPath=\"$OZONE_ROOT\",path=/opt/hadoop -t image:image=apache/ozone-runner:20200420-1 -t ozone/onenode", "originalCommit": "9144ea93bc6adbb67610b9031d6b16f09b1cf5ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDg0Mzc2NQ==", "url": "https://github.com/apache/ozone/pull/1223#discussion_r460843765", "bodyText": "It can be replaced easily during build time, but today it's possible to execute the tests from src/min/k8s, which makes it harder. I can parse it from the pom.xml but it's only for development.\nI am not sure what is the most simple solution...", "author": "elek", "createdAt": "2020-07-27T12:08:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY2NzQyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAwMzU4MA==", "url": "https://github.com/apache/ozone/pull/1223#discussion_r461003580", "bodyText": "OK, I'm fine with including it here.  Maybe a note near the version property in pom.xml would be nice to avoid someone forgetting to update this.", "author": "adoroszlai", "createdAt": "2020-07-27T16:10:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY2NzQyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY2ODEzMA==", "url": "https://github.com/apache/ozone/pull/1223#discussion_r460668130", "bodyText": "$RANDOM: TIL, thanks. \ud83d\udc4d", "author": "adoroszlai", "createdAt": "2020-07-27T06:16:52Z", "path": "hadoop-ozone/dist/src/main/k8s/examples/testlib.sh", "diffHunk": "@@ -0,0 +1,125 @@\n+#!/usr/bin/env bash\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+retry() {\n+   n=0\n+   until [ $n -ge 30 ]\n+   do\n+      \"$@\" && break\n+      n=$[$n+1]\n+      echo \"$n '$@' is failed...\"\n+      sleep ${RETRY_SLEEP:-3}\n+   done\n+   if [ $n -eq 30 ]; then\n+      return 255\n+   fi\n+}\n+\n+grep_log() {\n+   CONTAINER=\"$1\"\n+   PATTERN=\"$2\"\n+   kubectl logs \"$1\"  | grep \"$PATTERN\"\n+}\n+\n+wait_for_startup(){\n+   print_phase \"Waiting until the k8s cluster is running\"\n+   retry all_pods_are_running\n+   retry grep_log scm-0 \"SCM exiting safe mode.\"\n+   retry grep_log om-0 \"HTTP server of ozoneManager listening\"\n+   print_phase \"Cluster is up and running\"\n+}\n+\n+all_pods_are_running() {\n+   RUNNING_COUNT=$(kubectl get pod --field-selector status.phase=Running | wc -l)\n+   ALL_COUNT=$(kubectl get pod | wc -l)\n+   RUNNING_COUNT=$((RUNNING_COUNT - 1))\n+   ALL_COUNT=$((ALL_COUNT - 1))\n+   if [ \"$RUNNING_COUNT\" -lt \"3\" ]; then\n+      echo \"$RUNNING_COUNT pods are running. Waiting for more.\"\n+      return 1\n+   elif [ \"$RUNNING_COUNT\" -ne \"$ALL_COUNT\" ]; then\n+      echo \"$RUNNING_COUNT pods are running out from the $ALL_COUNT\"\n+      return 2\n+   else\n+      STARTED=true\n+      return 0\n+   fi\n+}\n+\n+start_k8s_env() {\n+   print_phase \"Deleting existing k8s resources\"\n+   #reset environment\n+   kubectl delete pvc --all\n+   kubectl delete pv --all\n+   kubectl delete statefulset --all\n+   kubectl delete daemonset --all\n+   kubectl delete deployment --all\n+   kubectl delete service --all\n+   kubectl delete configmap --all\n+   kubectl delete pod --all\n+\n+   print_phase \"Applying k8s resources from $1\"\n+   kubectl apply -f .\n+   wait_for_startup\n+}\n+\n+stop_k8s_env() {\n+   if [ ! \"$KEEP_RUNNING\" ]; then\n+     kubectl delete -f .\n+   fi\n+}\n+\n+regenerate_resources() {\n+  PARENT_OF_PARENT=$(realpath ../..)\n+\n+  if [ $(basename $PARENT_OF_PARENT) == \"k8s\" ]; then\n+    #running from src dir\n+    OZONE_ROOT=$(realpath ../../../../../target/ozone-0.6.0-SNAPSHOT)\n+  else\n+    #running from dist\n+    OZONE_ROOT=$(realpath ../../..)\n+  fi\n+\n+  flekszible generate -t mount:hostPath=\"$OZONE_ROOT\",path=/opt/hadoop -t image:image=apache/ozone-runner:20200420-1 -t ozone/onenode\n+}\n+\n+execute_robot_test() {\n+   print_phase \"Executing robot tests $@\"\n+   mkdir -p result\n+\n+   CONTAINER=\"$1\"\n+   shift 1 #Remove first argument which was the container name\n+\n+   # shellcheck disable=SC2206\n+   ARGUMENTS=($@)\n+\n+   kubectl exec -it \"${CONTAINER}\" -- bash -c 'rm -rf /tmp/report'\n+   kubectl exec -it \"${CONTAINER}\" -- bash -c 'mkdir -p  /tmp/report'\n+   kubectl exec -it \"${CONTAINER}\" -- robot --nostatusrc -d /tmp/report ${ARGUMENTS[@]} || true\n+   kubectl cp \"${CONTAINER}\":/tmp/report/output.xml \"result/$CONTAINER-$RANDOM.xml\" || true", "originalCommit": "9144ea93bc6adbb67610b9031d6b16f09b1cf5ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY2ODQ5NQ==", "url": "https://github.com/apache/ozone/pull/1223#discussion_r460668495", "bodyText": "Nit:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  - name: insstall robotframework\n          \n          \n            \n                  - name: install robotframework", "author": "adoroszlai", "createdAt": "2020-07-27T06:17:54Z", "path": ".github/workflows/post-commit.yml", "diffHunk": "@@ -224,3 +224,60 @@ jobs:\n          with:\n            name: coverage\n            path: target/coverage\n+  kubernetes:\n+    name: kubernetes\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - uses: actions/cache@v2\n+        with:\n+          path: ~/.m2/repository\n+          key: maven-repo-${{ hashFiles('**/pom.xml') }}\n+      - uses: actions/cache@v2\n+        with:\n+          path: |\n+            ~/.pnpm-store\n+            **/node_modules\n+          key: ${{ runner.os }}-pnpm-${{ hashFiles('**/pnpm-lock.yaml') }}\n+          restore-keys: |\n+            ${{ runner.os }}-pnpm-\n+      - name: checkout to /mnt/ozone\n+        run: |\n+          sudo chmod 777 /mnt\n+          git clone https://github.com/${GITHUB_REPOSITORY}.git /mnt/ozone\n+          cd /mnt/ozone\n+          git fetch origin \"${GITHUB_REF}\"\n+          git checkout FETCH_HEAD\n+          git reset --hard\n+      - name: insstall robotframework", "originalCommit": "9144ea93bc6adbb67610b9031d6b16f09b1cf5ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "81c68f5e85c3b41d83cc2bd391298e9fb60eaa53", "url": "https://github.com/apache/ozone/commit/81c68f5e85c3b41d83cc2bd391298e9fb60eaa53", "message": "remove parameter of combine_reports", "committedDate": "2020-07-27T12:04:11Z", "type": "commit"}, {"oid": "17afb8d013cde6c7dbc84b5e366922c1f497a353", "url": "https://github.com/apache/ozone/commit/17afb8d013cde6c7dbc84b5e366922c1f497a353", "message": "move bats to the tests (and fix test name)", "committedDate": "2020-07-27T12:06:54Z", "type": "commit"}, {"oid": "eb308b09c264689b332e929d337d4555ff40ee19", "url": "https://github.com/apache/ozone/commit/eb308b09c264689b332e929d337d4555ff40ee19", "message": "typo in post-commit (insstall)", "committedDate": "2020-07-27T12:09:30Z", "type": "commit"}, {"oid": "4bd1e910b26f14c26e0bac53ae2c44f0e5c82252", "url": "https://github.com/apache/ozone/commit/4bd1e910b26f14c26e0bac53ae2c44f0e5c82252", "message": "Merge remote-tracking branch 'origin/master' into HDDS-3990", "committedDate": "2020-07-27T12:22:22Z", "type": "commit"}, {"oid": "473a02e9ab9c4d680e81c4db840376c57a98d356", "url": "https://github.com/apache/ozone/commit/473a02e9ab9c4d680e81c4db840376c57a98d356", "message": "Merge remote-tracking branch 'elek/HDDS-3990' into HDDS-3990", "committedDate": "2020-07-27T12:22:54Z", "type": "commit"}, {"oid": "ddce73e1d051ed82902d311e2469c8fff2278aeb", "url": "https://github.com/apache/ozone/commit/ddce73e1d051ed82902d311e2469c8fff2278aeb", "message": "Merge remote-tracking branch 'origin/master' into HDDS-3990", "committedDate": "2020-07-29T09:20:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ2MTA1Mg==", "url": "https://github.com/apache/ozone/pull/1223#discussion_r462461052", "bodyText": "Can you please update this with the fix from fd47f91?", "author": "adoroszlai", "createdAt": "2020-07-29T17:19:46Z", "path": ".github/workflows/post-commit.yml", "diffHunk": "@@ -238,3 +238,61 @@ jobs:\n            name: coverage\n            path: target/coverage\n          continue-on-error: true\n+  kubernetes:\n+    name: kubernetes\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - uses: actions/cache@v2\n+        with:\n+          path: ~/.m2/repository\n+          key: maven-repo-${{ hashFiles('**/pom.xml') }}\n+      - uses: actions/cache@v2\n+        with:\n+          path: |\n+            ~/.pnpm-store\n+            **/node_modules\n+          key: ${{ runner.os }}-pnpm-${{ hashFiles('**/pnpm-lock.yaml') }}\n+          restore-keys: |\n+            ${{ runner.os }}-pnpm-\n+      - name: checkout to /mnt/ozone\n+        run: |\n+          sudo chmod 777 /mnt\n+          git clone https://github.com/${GITHUB_REPOSITORY}.git /mnt/ozone\n+          cd /mnt/ozone\n+          git fetch origin \"${GITHUB_REF}\"\n+          git checkout FETCH_HEAD", "originalCommit": "ddce73e1d051ed82902d311e2469c8fff2278aeb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5NzAxMA==", "url": "https://github.com/apache/ozone/pull/1223#discussion_r462897010", "bodyText": "fair point. Replaced with the new version. (One more reason to move checkout logic to a separated script like https://github.com/elek/hadoop-ozone/blob/smart-checkout/.github/checkout.sh)", "author": "elek", "createdAt": "2020-07-30T10:16:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ2MTA1Mg=="}], "type": "inlineReview"}, {"oid": "6f15bb4c5ddff5d74fa7fda23fb2d5b13f7006d6", "url": "https://github.com/apache/ozone/commit/6f15bb4c5ddff5d74fa7fda23fb2d5b13f7006d6", "message": "adjust debug log and wrap final generation", "committedDate": "2020-07-30T10:11:32Z", "type": "commit"}, {"oid": "8fe4e59fbd7b941cfff16f1f216fa34991904a35", "url": "https://github.com/apache/ozone/commit/8fe4e59fbd7b941cfff16f1f216fa34991904a35", "message": "Use updated checkout logic", "committedDate": "2020-07-30T10:12:54Z", "type": "commit"}, {"oid": "28e150fdb228a1bd5bb4bfb5eee5435142bde6d4", "url": "https://github.com/apache/ozone/commit/28e150fdb228a1bd5bb4bfb5eee5435142bde6d4", "message": "Add names for each new build step", "committedDate": "2020-07-30T10:15:22Z", "type": "commit"}, {"oid": "118d26b8c8dfa6a02accde3b4281a462397acbff", "url": "https://github.com/apache/ozone/commit/118d26b8c8dfa6a02accde3b4281a462397acbff", "message": "Merge remote-tracking branch 'origin/master' into HDDS-3990", "committedDate": "2020-07-30T10:17:53Z", "type": "commit"}, {"oid": "04fd34457dc40241bae6dcf6c3af4f280df5a294", "url": "https://github.com/apache/ozone/commit/04fd34457dc40241bae6dcf6c3af4f280df5a294", "message": "fix bats", "committedDate": "2020-07-30T10:19:53Z", "type": "commit"}]}