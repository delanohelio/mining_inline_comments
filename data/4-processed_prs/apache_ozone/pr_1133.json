{"pr_number": 1133, "pr_title": "HDDS-3875. Package classpath files to the jar files instead of uploading them as artifacts", "pr_createdAt": "2020-06-26T15:43:48Z", "pr_url": "https://github.com/apache/ozone/pull/1133", "timeline": [{"oid": "84064091cb628862c7385f4430daa00eb59ff9f0", "url": "https://github.com/apache/ozone/commit/84064091cb628862c7385f4430daa00eb59ff9f0", "message": "HDDS-3875. Package classpath files to the jar files instead of uploading them as artifacts", "committedDate": "2020-06-26T11:01:50Z", "type": "commit"}, {"oid": "332773c421d73e503cb727ce801f394af15249c3", "url": "https://github.com/apache/ozone/commit/332773c421d73e503cb727ce801f394af15249c3", "message": "fix recon assembly", "committedDate": "2020-06-26T11:55:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU1NjA1Nw==", "url": "https://github.com/apache/ozone/pull/1133#discussion_r447556057", "bodyText": "Maven outputs a warning for each submodule:\nThe expression ${pom.artifactId} is deprecated. Please use ${project.artifactId} instead.\n\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          <outputFile>${project.build.outputDirectory}/${pom.artifactId}.classpath</outputFile>\n          \n          \n            \n                          <outputFile>${project.build.outputDirectory}/${project.artifactId}.classpath</outputFile>", "author": "adoroszlai", "createdAt": "2020-06-30T09:46:46Z", "path": "hadoop-hdds/pom.xml", "diffHunk": "@@ -279,41 +279,19 @@ https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n         <executions>\n           <execution>\n             <id>add-classpath-descriptor</id>\n-            <phase>package</phase>\n+            <phase>prepare-package</phase>\n             <goals>\n               <goal>build-classpath</goal>\n             </goals>\n             <configuration>\n-              <outputFile>${project.build.directory}/classpath</outputFile>\n+              <outputFile>${project.build.outputDirectory}/${pom.artifactId}.classpath</outputFile>", "originalCommit": "332773c421d73e503cb727ce801f394af15249c3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU1OTA1OA==", "url": "https://github.com/apache/ozone/pull/1133#discussion_r447559058", "bodyText": "Fix me if I'm wrong, but ozone classpath now lists several modules that were previously omitted.\nPreviously:\n$ ozone classpath\nUsage: ozone classpath <ARTIFACTNAME>\nWhere the artifact name is one of:\n\nhadoop-hdds-server-scm\nhadoop-hdds-tools\nhadoop-ozone-common\nhadoop-ozone-csi\nhadoop-ozone-datanode\nhadoop-ozone-filesystem\nhadoop-ozone-insight\nhadoop-ozone-ozone-manager\nhadoop-ozone-recon\nhadoop-ozone-s3gateway\nhadoop-ozone-tools\nhadoop-ozone-upgrade\n\nWith patch:\n$ ozone classpath\nUsage: ozone classpath <ARTIFACTNAME>\nWhere the artifact name is one of:\n\nhadoop-hdds-client\nhadoop-hdds-common\nhadoop-hdds-config\nhadoop-hdds-container-service\nhadoop-hdds-docs\nhadoop-hdds-hadoop-dependency-client\nhadoop-hdds-hadoop-dependency-server\nhadoop-hdds-interface-admin\nhadoop-hdds-interface-client\nhadoop-hdds-interface-server\nhadoop-hdds-server-framework\nhadoop-hdds-server-scm\nhadoop-hdds-tools\nhadoop-ozone-client\nhadoop-ozone-common\nhadoop-ozone-csi\nhadoop-ozone-datanode\nhadoop-ozone-filesystem-common\nhadoop-ozone-filesystem\nhadoop-ozone-insight\nhadoop-ozone-interface-client\nhadoop-ozone-ozone-manager\nhadoop-ozone-recon\nhadoop-ozone-reconcodegen\nhadoop-ozone-s3gateway\nhadoop-ozone-tools\nhadoop-ozone-upgrade\n\nInvoking ozone classpath for the extra modules results in an error (which is the same on master):\n$ ozone classpath hadoop-hdds-config\nError: Could not find or load main class org.apache.hadoop.util.Classpath\nCaused by: java.lang.ClassNotFoundException: org.apache.hadoop.util.Classpath", "author": "adoroszlai", "createdAt": "2020-06-30T09:51:34Z", "path": "hadoop-ozone/dist/pom.xml", "diffHunk": "@@ -41,103 +41,13 @@\n             <id>copy-classpath-files</id>\n             <phase>prepare-package</phase>\n             <goals>\n-              <goal>copy</goal>\n+              <goal>unpack-dependencies</goal>\n             </goals>\n             <configuration>\n               <outputDirectory>\n                 target/ozone-${ozone.version}/share/ozone/classpath\n               </outputDirectory>\n-              <artifactItems>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-hdds-server-scm</artifactId>\n-                  <version>${hdds.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-hdds-server-scm.classpath</destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-hdds-tools</artifactId>\n-                  <version>${hdds.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-hdds-tools.classpath</destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-ozone-s3gateway</artifactId>\n-                  <version>${ozone.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-ozone-s3gateway.classpath</destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-ozone-csi</artifactId>\n-                  <version>${ozone.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-ozone-csi.classpath</destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-ozone-ozone-manager</artifactId>\n-                  <version>${ozone.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-ozone-ozone-manager.classpath\n-                  </destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-ozone-tools</artifactId>\n-                  <version>${ozone.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-ozone-tools.classpath</destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-ozone-filesystem</artifactId>\n-                  <version>${ozone.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-ozone-filesystem.classpath</destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-ozone-common</artifactId>\n-                  <version>${ozone.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-ozone-common.classpath</destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-ozone-datanode</artifactId>\n-                  <version>${ozone.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-ozone-datanode.classpath</destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-ozone-upgrade</artifactId>\n-                  <version>${ozone.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-ozone-upgrade.classpath</destFileName>\n-                </artifactItem>\n-                <artifactItem>\n-                  <groupId>org.apache.hadoop</groupId>\n-                  <artifactId>hadoop-ozone-insight</artifactId>\n-                  <version>${ozone.version}</version>\n-                  <classifier>classpath</classifier>\n-                  <type>cp</type>\n-                  <destFileName>hadoop-ozone-insight.classpath</destFileName>\n-                </artifactItem>\n-              </artifactItems>\n+              <includes>*.classpath</includes>", "originalCommit": "332773c421d73e503cb727ce801f394af15249c3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzYwMDMxNA==", "url": "https://github.com/apache/ozone/pull/1133#discussion_r447600314", "bodyText": "Nice catch. I did a grep for OZONE_RUN_ARTIFACT_NAME in ozone shell script and selected only those artifacts.", "author": "elek", "createdAt": "2020-06-30T11:06:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU1OTA1OA=="}], "type": "inlineReview"}, {"oid": "3f74d8b598150b7ff4faaa0afcdaf72177bd1d64", "url": "https://github.com/apache/ozone/commit/3f74d8b598150b7ff4faaa0afcdaf72177bd1d64", "message": "Use project.artifactId instead of pom.artifactId\n\nCo-authored-by: Doroszlai, Attila <6454655+adoroszlai@users.noreply.github.com>", "committedDate": "2020-06-30T10:34:00Z", "type": "commit"}, {"oid": "2be9bf38b2dd958e643dd37f6bec47ad6dce3cf6", "url": "https://github.com/apache/ozone/commit/2be9bf38b2dd958e643dd37f6bec47ad6dce3cf6", "message": "extract classpath files only from the selected list of artifacts", "committedDate": "2020-06-30T11:04:28Z", "type": "commit"}]}