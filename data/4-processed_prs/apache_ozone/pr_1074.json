{"pr_number": 1074, "pr_title": "HDDS-3793. Use Hadoop 2.7.3 for ozone-mr/hadoop27 acceptance tests", "pr_createdAt": "2020-06-14T13:56:21Z", "pr_url": "https://github.com/apache/ozone/pull/1074", "timeline": [{"oid": "5b2fd840eb687c06f93c58c5173850ee38744bb4", "url": "https://github.com/apache/ozone/commit/5b2fd840eb687c06f93c58c5173850ee38744bb4", "message": "HDDS-3793. Use Hadoop 2.7.3 for ozone-mr/hadoop27 acceptance tests", "committedDate": "2020-06-14T12:20:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE1NjY2MA==", "url": "https://github.com/apache/ozone/pull/1074#discussion_r440156660", "bodyText": "This part can be removed. IMHO.\ndocker run flokkr/hadoop:2.7.3 robot --version\nFlokkr launcher script 1.1-18-g58a3efc\n\n===== Plugin is activated ENVTOCONF =====\n======================================\n*** Launching \"robot --version\"\nRobot Framework 3.1.2 (Python 3.6.8 on linux)", "author": "elek", "createdAt": "2020-06-15T12:58:30Z", "path": "hadoop-ozone/dist/src/main/compose/ozone-mr/hadoop27/test.sh", "diffHunk": "@@ -27,8 +27,8 @@ execute_robot_test scm createmrenv.robot\n \n \n #rm is the container name (resource manager) and not the rm command\n-execute_command_in_container rm sudo -E apk add --update py-pip\n-execute_command_in_container rm sudo -E pip install robotframework\n+execute_command_in_container rm sudo -E yum install -y python3-pip", "originalCommit": "5b2fd840eb687c06f93c58c5173850ee38744bb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE1ODI5Mg==", "url": "https://github.com/apache/ozone/pull/1074#discussion_r440158292", "bodyText": "Thanks, I'll remove it.", "author": "adoroszlai", "createdAt": "2020-06-15T13:01:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE1NjY2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE1Njc5MQ==", "url": "https://github.com/apache/ozone/pull/1074#discussion_r440156791", "bodyText": "What's wrong with OzFS? Based on my understanding ozonefs-hadoop2 project includes an OzFs implementation which is the same as BasicOzFs.\nIs there any motivation behind this change?", "author": "elek", "createdAt": "2020-06-15T12:58:46Z", "path": "hadoop-ozone/dist/src/main/compose/ozone-mr/hadoop27/docker-config", "diffHunk": "@@ -14,7 +14,7 @@\n # See the License for the specific language governing permissions and\n # limitations under the License.\n \n-CORE-SITE.xml_fs.AbstractFileSystem.o3fs.impl=org.apache.hadoop.fs.ozone.OzFs", "originalCommit": "5b2fd840eb687c06f93c58c5173850ee38744bb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE1NzY4MQ==", "url": "https://github.com/apache/ozone/pull/1074#discussion_r440157681", "bodyText": "Is there any motivation behind this change?\n\nYes, with OzFs I ran into Invalid path name Wrong FS (HDDS-3482).", "author": "adoroszlai", "createdAt": "2020-06-15T13:00:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE1Njc5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI3MzQ1NA==", "url": "https://github.com/apache/ozone/pull/1074#discussion_r440273454", "bodyText": "Got it. In that case it's my fault, the fix should be added to the hadoop2 specific OzFs.\nOne important point of the new structure is that we don't need to use different classes (like BasicOzFs) we can use the same FS names all the time.\nIf it's not a big deal, can you please add the workaround instead of changing the name of the AbstractFileSystem implementation?\ndiff --git hadoop-ozone/ozonefs-hadoop2/src/main/java/org/apache/hadoop/fs/ozone/OzFs.java hadoop-ozone/ozonefs-hadoop2/src/main/java/org/apache/hadoop/fs/ozone/OzFs.java\nindex 914832e2c..b5012f95c 100644\n--- hadoop-ozone/ozonefs-hadoop2/src/main/java/org/apache/hadoop/fs/ozone/OzFs.java\n+++ hadoop-ozone/ozonefs-hadoop2/src/main/java/org/apache/hadoop/fs/ozone/OzFs.java\n@@ -40,4 +40,9 @@ public OzFs(URI theUri, Configuration conf)\n     super(theUri, new OzoneFileSystem(), conf,\n         OzoneConsts.OZONE_URI_SCHEME, false);\n   }\n+\n+  @Override\n+  public int getUriDefaultPort() {\n+    return -1;\n+  }\n }\nTested and worked well.", "author": "elek", "createdAt": "2020-06-15T15:48:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE1Njc5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ0NTM3Mw==", "url": "https://github.com/apache/ozone/pull/1074#discussion_r440445373", "bodyText": "Thanks for the hint, workaround added.", "author": "adoroszlai", "createdAt": "2020-06-15T21:02:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE1Njc5MQ=="}], "type": "inlineReview"}, {"oid": "3856c0b3b5bc54159c0414eaeaec90949ee3a6ad", "url": "https://github.com/apache/ozone/commit/3856c0b3b5bc54159c0414eaeaec90949ee3a6ad", "message": "HDDS-3793. Remove unnecessary install steps", "committedDate": "2020-06-15T16:16:19Z", "type": "commit"}, {"oid": "949a2d51b4ce5d66915dec1546dfce6d78b1ca9d", "url": "https://github.com/apache/ozone/commit/949a2d51b4ce5d66915dec1546dfce6d78b1ca9d", "message": "HDDS-3793. Apply HDDS-3482 to OzFs, too", "committedDate": "2020-06-15T16:19:20Z", "type": "commit"}, {"oid": "ab250a258813623694c5cc6227c721554e4b19e6", "url": "https://github.com/apache/ozone/commit/ab250a258813623694c5cc6227c721554e4b19e6", "message": "trigger new CI check", "committedDate": "2020-06-15T19:21:29Z", "type": "commit"}, {"oid": "6ba4054f68e9594099b773edcaeebfc5af05093e", "url": "https://github.com/apache/ozone/commit/6ba4054f68e9594099b773edcaeebfc5af05093e", "message": "Actually use OzFs", "committedDate": "2020-06-15T21:04:31Z", "type": "commit"}, {"oid": "d203c71c76973fc5a92e2bdd275bb6fb5771bbbe", "url": "https://github.com/apache/ozone/commit/d203c71c76973fc5a92e2bdd275bb6fb5771bbbe", "message": "trigger new CI check", "committedDate": "2020-06-15T22:36:20Z", "type": "commit"}]}