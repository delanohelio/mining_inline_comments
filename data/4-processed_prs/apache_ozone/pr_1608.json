{"pr_number": 1608, "pr_title": "HDDS-4481. With HA OM can send deletion blocks to SCM multiple times.", "pr_createdAt": "2020-11-21T00:02:53Z", "pr_url": "https://github.com/apache/ozone/pull/1608", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTUyNzg5Ng==", "url": "https://github.com/apache/ozone/pull/1608#discussion_r529527896", "bodyText": "createWriteRaftClientRequest was creating a request with the same callId. Is that the bug here?\nIf that is the case we would also need to make changes in this function so that callId is different for every request.", "author": "lokeshj1703", "createdAt": "2020-11-24T13:02:32Z", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/ratis/OzoneManagerRatisServer.java", "diffHunk": "@@ -126,15 +126,32 @@ private static long nextCallId() {\n   public OMResponse submitRequest(OMRequest omRequest) throws ServiceException {\n     RaftClientRequest raftClientRequest =\n         createWriteRaftClientRequest(omRequest);", "originalCommit": "cfa857aab6d1f6822cf809a7226e7e86b049a021", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTgzMzk2MA==", "url": "https://github.com/apache/ozone/pull/1608#discussion_r529833960", "bodyText": "When called from Client, Server.getCallID() will not return constant value RpcConstants.INVALID_RETRY_COUNT.\nWhere as when keydeletingService is called it is not coming thru RpcClient, directly calling server API submitRequest, so CallID will be same for each call.\nSo it is fine use createWriteRaftClientRequest for normal flow of requests, and the values ClientID and CallID can be fetched from Server.getClientID and Server.getCallID().", "author": "bharatviswa504", "createdAt": "2020-11-24T19:43:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTUyNzg5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDExNTk2OQ==", "url": "https://github.com/apache/ozone/pull/1608#discussion_r530115969", "bodyText": "Can we add an assertion to check that Server.getCallID() is not returning RpcConstants.INVALID_CALL_ID and Server.getClientId() is not returning RpcConstants.DUMMY_CLIENT_ID?", "author": "lokeshj1703", "createdAt": "2020-11-25T05:26:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTUyNzg5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDEyODkxNw==", "url": "https://github.com/apache/ozone/pull/1608#discussion_r530128917", "bodyText": "Done.", "author": "bharatviswa504", "createdAt": "2020-11-25T06:11:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTUyNzg5Ng=="}], "type": "inlineReview"}, {"oid": "f0bd744115d244a75bda510427b50c1ba09cb63f", "url": "https://github.com/apache/ozone/commit/f0bd744115d244a75bda510427b50c1ba09cb63f", "message": "HDDS-4481. With HA OM can send deletion blocks to SCM multiple times.", "committedDate": "2020-11-24T17:31:14Z", "type": "commit"}, {"oid": "5b7757290ff4c672088a29e3095aef3a787a14bc", "url": "https://github.com/apache/ozone/commit/5b7757290ff4c672088a29e3095aef3a787a14bc", "message": "change unnecessarily moved code", "committedDate": "2020-11-24T17:31:15Z", "type": "commit"}, {"oid": "e031b6221bbcc860dd2de67df5445ffb615ee895", "url": "https://github.com/apache/ozone/commit/e031b6221bbcc860dd2de67df5445ffb615ee895", "message": "change back to debug", "committedDate": "2020-11-24T17:31:16Z", "type": "commit"}, {"oid": "5a4207731b41820ab6b85e93fa7f66fcd9d0682f", "url": "https://github.com/apache/ozone/commit/5a4207731b41820ab6b85e93fa7f66fcd9d0682f", "message": "fix cs and make clientID static, so that until OM is stopped it will have same value", "committedDate": "2020-11-24T17:31:16Z", "type": "commit"}, {"oid": "acde8eab1e0462ddcbee7df76d4a9cc4841d2a65", "url": "https://github.com/apache/ozone/commit/acde8eab1e0462ddcbee7df76d4a9cc4841d2a65", "message": "fix rat", "committedDate": "2020-11-24T17:31:16Z", "type": "commit"}, {"oid": "acde8eab1e0462ddcbee7df76d4a9cc4841d2a65", "url": "https://github.com/apache/ozone/commit/acde8eab1e0462ddcbee7df76d4a9cc4841d2a65", "message": "fix rat", "committedDate": "2020-11-24T17:31:16Z", "type": "forcePushed"}, {"oid": "3ac48bf0811910eb7c0e7317e7292dbec53b6bb0", "url": "https://github.com/apache/ozone/commit/3ac48bf0811910eb7c0e7317e7292dbec53b6bb0", "message": "review comment", "committedDate": "2020-11-25T06:11:18Z", "type": "commit"}]}