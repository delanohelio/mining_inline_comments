{"pr_number": 1290, "pr_title": "HDDS-4064. Show container verbose info with verbose option", "pr_createdAt": "2020-08-05T09:46:45Z", "pr_url": "https://github.com/apache/ozone/pull/1290", "timeline": [{"oid": "142947da936c8c99242a1242c39a5702da4b66cc", "url": "https://github.com/apache/ozone/commit/142947da936c8c99242a1242c39a5702da4b66cc", "message": "HDDS-4064. Show container verbose info with verbose option", "committedDate": "2020-08-05T09:42:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgwODI5MQ==", "url": "https://github.com/apache/ozone/pull/1290#discussion_r466808291", "bodyText": "Can we leverage the existing \"--verbose\" option defined in parent class GenericCli here?", "author": "xiaoyuyao", "createdAt": "2020-08-07T04:03:13Z", "path": "hadoop-hdds/tools/src/main/java/org/apache/hadoop/hdds/scm/cli/container/InfoSubcommand.java", "diffHunk": "@@ -52,6 +53,10 @@\n   @Parameters(description = \"Decimal id of the container.\")\n   private long containerID;\n \n+  @CommandLine.Option(names = {\"--verbose\"},", "originalCommit": "142947da936c8c99242a1242c39a5702da4b66cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA5MTMxMw==", "url": "https://github.com/apache/ozone/pull/1290#discussion_r467091313", "bodyText": "@xiaoyuyao\nboolean verbose = false;\nif (parent.getParent() instanceof GenericCli) {\n        if (((GenericCli) parent.getParent()).isVerbose()) {\n            verbose = true;\n        }\n}\nDo you mean that i should add this code to L66", "author": "maobaolong", "createdAt": "2020-08-07T14:52:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgwODI5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE4MzU0Mg==", "url": "https://github.com/apache/ozone/pull/1290#discussion_r469183542", "bodyText": "Note that parent --verbose also enables exception stack trace logging in case of failures.  Thus for non-existent container, we would not only get the error message, but the complete stack trace:\n$ ozone admin --verbose container info 1\norg.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hdds.scm.container.ContainerNotFoundException): Container with id #1 not found.\n\tat org.apache.hadoop.hdds.scm.container.states.ContainerStateMap.checkIfContainerExist(ContainerStateMap.java:542)\n\tat org.apache.hadoop.hdds.scm.container.states.ContainerStateMap.getContainerInfo(ContainerStateMap.java:188)\n\tat org.apache.hadoop.hdds.scm.container.ContainerStateManager.getContainer(ContainerStateManager.java:499)\n\tat org.apache.hadoop.hdds.scm.container.SCMContainerManager.getContainer(SCMContainerManager.java:201)\n\tat org.apache.hadoop.hdds.scm.server.SCMClientProtocolServer.getContainerWithPipelineCommon(SCMClientProtocolServer.java:227)\n\tat org.apache.hadoop.hdds.scm.server.SCMClientProtocolServer.getContainerWithPipeline(SCMClientProtocolServer.java:267)\n\tat org.apache.hadoop.hdds.scm.protocol.StorageContainerLocationProtocolServerSideTranslatorPB.getContainerWithPipeline(StorageContainerLocationProtocolServerSideTranslatorPB.java:307)\n\tat org.apache.hadoop.hdds.scm.protocol.StorageContainerLocationProtocolServerSideTranslatorPB.processRequest(StorageContainerLocationProtocolServerSideTranslatorPB.java:154)\n\tat org.apache.hadoop.hdds.server.OzoneProtocolMessageDispatcher.processRequest(OzoneProtocolMessageDispatcher.java:74)\n\tat org.apache.hadoop.hdds.scm.protocol.StorageContainerLocationProtocolServerSideTranslatorPB.submitRequest(StorageContainerLocationProtocolServerSideTranslatorPB.java:128)\n\tat org.apache.hadoop.hdds.protocol.proto.StorageContainerLocationProtocolProtos$StorageContainerLocationProtocolService$2.callBlockingMethod(StorageContainerLocationProtocolProtos.java:35691)\n\tat org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:528)\n\tat org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1070)\n\tat org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:999)\n\tat org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:927)\n\tat java.base/java.security.AccessController.doPrivileged(Native Method)\n\tat java.base/javax.security.auth.Subject.doAs(Subject.java:423)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1730)\n\tat org.apache.hadoop.ipc.Server$Handler.run(Server.java:2915)\n\n\tat org.apache.hadoop.ipc.Client.getRpcResponse(Client.java:1545)\n\tat org.apache.hadoop.ipc.Client.call(Client.java:1491)\n\tat org.apache.hadoop.ipc.Client.call(Client.java:1388)\n\tat org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:233)\n\tat org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:118)\n\tat com.sun.proxy.$Proxy15.submitRequest(Unknown Source)\n\tat org.apache.hadoop.hdds.scm.protocolPB.StorageContainerLocationProtocolClientSideTranslatorPB.submitRpcRequest(StorageContainerLocationProtocolClientSideTranslatorPB.java:130)\n\tat org.apache.hadoop.hdds.scm.protocolPB.StorageContainerLocationProtocolClientSideTranslatorPB.submitRequest(StorageContainerLocationProtocolClientSideTranslatorPB.java:121)\n\tat org.apache.hadoop.hdds.scm.protocolPB.StorageContainerLocationProtocolClientSideTranslatorPB.getContainerWithPipeline(StorageContainerLocationProtocolClientSideTranslatorPB.java:195)\n\tat org.apache.hadoop.hdds.scm.cli.ContainerOperationClient.getContainerWithPipeline(ContainerOperationClient.java:440)\n\tat org.apache.hadoop.hdds.scm.cli.container.InfoSubcommand.call(InfoSubcommand.java:61)\n\tat org.apache.hadoop.hdds.scm.cli.container.InfoSubcommand.call(InfoSubcommand.java:41)\n\tat picocli.CommandLine.execute(CommandLine.java:1173)\n\tat picocli.CommandLine.access$800(CommandLine.java:141)\n\tat picocli.CommandLine$RunLast.handle(CommandLine.java:1367)\n\tat picocli.CommandLine$RunLast.handle(CommandLine.java:1335)\n\tat picocli.CommandLine$AbstractParseResultHandler.handleParseResult(CommandLine.java:1243)\n\tat picocli.CommandLine.parseWithHandlers(CommandLine.java:1526)\n\tat picocli.CommandLine.parseWithHandler(CommandLine.java:1465)\n\tat org.apache.hadoop.hdds.cli.GenericCli.execute(GenericCli.java:96)\n\tat org.apache.hadoop.hdds.cli.GenericCli.run(GenericCli.java:87)\n\tat org.apache.hadoop.ozone.admin.OzoneAdmin.main(OzoneAdmin.java:96)\n\nIn case you still want to leverage it, I suggest this:\n      boolean verbose = parent.getParent() instanceof GenericParentCommand &&\n          ((GenericParentCommand) parent.getParent()).isVerbose();\n\nIn addition to being simpler, it also uses the GenericParentCommand interface, which defines isVerbose(), instead of the concrete GenericCli class.", "author": "adoroszlai", "createdAt": "2020-08-12T11:14:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgwODI5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzMDk5Ng==", "url": "https://github.com/apache/ozone/pull/1290#discussion_r470930996", "bodyText": "I agree uses GenericParentCommand seems better. Also, I would suggest we change printError to printStackTrace only if there is no meaningful error message? This way, we will have a clean verbose output as long as the error message is meaningful.", "author": "xiaoyuyao", "createdAt": "2020-08-15T03:21:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgwODI5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODA2MTU1Mg==", "url": "https://github.com/apache/ozone/pull/1290#discussion_r478061552", "bodyText": "@adoroszlai Thanks for your tips, I commit a new PR, PTAL.", "author": "maobaolong", "createdAt": "2020-08-27T03:50:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgwODI5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODMzODg4OA==", "url": "https://github.com/apache/ozone/pull/1290#discussion_r478338888", "bodyText": "Also, I would suggest we change printError to printStackTrace only if there is no meaningful error message? This way, we will have a clean verbose output as long as the error message is meaningful.\n\nGood idea @xiaoyuyao.  I think we can split this to a separate improvement issue, so I created HDDS-4160.", "author": "adoroszlai", "createdAt": "2020-08-27T11:13:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgwODI5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM5OTMzMg==", "url": "https://github.com/apache/ozone/pull/1290#discussion_r484399332", "bodyText": "Ping @xiaoyuyao.\nPlease let me know if you are happy with this approach.", "author": "elek", "createdAt": "2020-09-07T12:23:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgwODI5MQ=="}], "type": "inlineReview"}, {"oid": "b175bc5a251c0a1a46c67dcc67819ccc690f7214", "url": "https://github.com/apache/ozone/commit/b175bc5a251c0a1a46c67dcc67819ccc690f7214", "message": "Use GenericParentCommand to get the verbose mode", "committedDate": "2020-08-27T03:51:57Z", "type": "commit"}, {"oid": "33c9d499316a8df60ca765bc7b42e95a6c3a3560", "url": "https://github.com/apache/ozone/commit/33c9d499316a8df60ca765bc7b42e95a6c3a3560", "message": "Use GenericParentCommand to get the verbose mode", "committedDate": "2020-08-27T04:26:01Z", "type": "commit"}, {"oid": "f4c0dda81cf26cdc03cab8d6c5241a4350a29a78", "url": "https://github.com/apache/ozone/commit/f4c0dda81cf26cdc03cab8d6c5241a4350a29a78", "message": "Merge remote-tracking branch 'origin/master' into infocontainer", "committedDate": "2020-08-27T10:52:42Z", "type": "commit"}, {"oid": "738c83485905bbfb617638c17cae3dff545e1f1b", "url": "https://github.com/apache/ozone/commit/738c83485905bbfb617638c17cae3dff545e1f1b", "message": "HDDS-4064. Add robot test for verbose mode", "committedDate": "2020-08-27T10:53:21Z", "type": "commit"}, {"oid": "ee4b45c3c930544bd9c0c2e6d62a7879fec6042f", "url": "https://github.com/apache/ozone/commit/ee4b45c3c930544bd9c0c2e6d62a7879fec6042f", "message": "HDDS-4064. Fix checkstyle", "committedDate": "2020-08-27T11:14:38Z", "type": "commit"}, {"oid": "4dffd17eae06881e9b8487201f417a5ba29c45f3", "url": "https://github.com/apache/ozone/commit/4dffd17eae06881e9b8487201f417a5ba29c45f3", "message": "trigger new CI check", "committedDate": "2020-08-27T14:11:27Z", "type": "commit"}, {"oid": "1d0550470ddc7f0002b4ce36bc70f1dac9f58904", "url": "https://github.com/apache/ozone/commit/1d0550470ddc7f0002b4ce36bc70f1dac9f58904", "message": "Merge remote-tracking branch 'upstream' into infocontainer", "committedDate": "2020-08-28T22:50:54Z", "type": "commit"}]}