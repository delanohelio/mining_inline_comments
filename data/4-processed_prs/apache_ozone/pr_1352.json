{"pr_number": 1352, "pr_title": "HDDS-4147. Add OFS to FileSystem META-INF", "pr_createdAt": "2020-08-25T23:15:33Z", "pr_url": "https://github.com/apache/ozone/pull/1352", "timeline": [{"oid": "2572e01c831a1591d963dc96f4d1b74e416343a4", "url": "https://github.com/apache/ozone/commit/2572e01c831a1591d963dc96f4d1b74e416343a4", "message": "[Experimental] Remove all explicit fs.o3fs.impl and fs.ofs.impl config.\nShould solely rely on META-INF to get the correct HCFS FileSystem class.\nAlso sets all defaultFS in docker compose to ofs://.\n\n(cherry picked from commit 389a45fd600fb620c71daf900be61e058ffe7288)", "committedDate": "2020-08-25T23:12:23Z", "type": "commit"}, {"oid": "4593e8ae425db0c59eaaed04ebb64ef9f8648ce5", "url": "https://github.com/apache/ozone/commit/4593e8ae425db0c59eaaed04ebb64ef9f8648ce5", "message": "Set fs.defaultFS to OFS in docker-config.\n\n(cherry picked from commit ba080fc9e6ef4391864417ac1daf0d2953712aae)", "committedDate": "2020-08-25T23:12:43Z", "type": "commit"}, {"oid": "9670c6e6a34f96c8ce6599800b06ccb145f9af0b", "url": "https://github.com/apache/ozone/commit/9670c6e6a34f96c8ce6599800b06ccb145f9af0b", "message": "trigger new CI check", "committedDate": "2020-08-26T08:00:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyNjk1Mw==", "url": "https://github.com/apache/ozone/pull/1352#discussion_r477226953", "bodyText": "Why is this line required to use META-INF based discovery?", "author": "elek", "createdAt": "2020-08-26T11:24:22Z", "path": "hadoop-ozone/dist/src/main/compose/ozone-csi/docker-config", "diffHunk": "@@ -14,6 +14,8 @@\n # See the License for the specific language governing permissions and\n # limitations under the License.\n \n+CORE-SITE.XML_fs.defaultFS=ofs://om", "originalCommit": "9670c6e6a34f96c8ce6599800b06ccb145f9af0b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQ2NzI2Mg==", "url": "https://github.com/apache/ozone/pull/1352#discussion_r477467262", "bodyText": "Hi @elek , in most automated robot tests fs.defaultFS isn't really used.\nMostly it improves QoL when user logs into the docker-compose cluster and manually checks for something (e.g. docker-compose exec om /bin/bash then ozone fs -ls /).\nI can remove them from this PR.", "author": "smengcl", "createdAt": "2020-08-26T17:26:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyNjk1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODM4ODM5MQ==", "url": "https://github.com/apache/ozone/pull/1352#discussion_r478388391", "bodyText": "Mostly it improves QoL when user logs into the docker-compose cluster and manually checks for something (e.g. docker-compose exec om /bin/bash then ozone fs -ls /).\n\nGood point. And I agree to support debug ofs is better choice as all the volumes are visible by default.", "author": "elek", "createdAt": "2020-08-27T12:42:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyNjk1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYwNzU5NA==", "url": "https://github.com/apache/ozone/pull/1352#discussion_r478607594", "bodyText": "Thanks @elek . I will file another jira to add those trivial docker-config changes then.", "author": "smengcl", "createdAt": "2020-08-27T18:15:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyNjk1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYxMjc5OA==", "url": "https://github.com/apache/ozone/pull/1352#discussion_r478612798", "bodyText": "Filed https://issues.apache.org/jira/browse/HDDS-4161", "author": "smengcl", "createdAt": "2020-08-27T18:25:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyNjk1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyNzczNQ==", "url": "https://github.com/apache/ozone/pull/1352#discussion_r477227735", "bodyText": "Why do we need this line to use META-INF services based discovery?", "author": "elek", "createdAt": "2020-08-26T11:25:51Z", "path": "hadoop-ozone/dist/src/main/compose/ozone-om-ha/docker-config", "diffHunk": "@@ -14,8 +14,8 @@\n # See the License for the specific language governing permissions and\n # limitations under the License.\n \n-CORE-SITE.XML_fs.o3fs.impl=org.apache.hadoop.fs.ozone.OzoneFileSystem\n-CORE-SITE.XML_fs.defaultFS=o3fs://bucket1.volume1.omservice\n+CORE-SITE.XML_fs.defaultFS=ofs://omservice", "originalCommit": "9670c6e6a34f96c8ce6599800b06ccb145f9af0b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM4NDU3OQ==", "url": "https://github.com/apache/ozone/pull/1352#discussion_r477384579", "bodyText": "I think only MR tests (ozone-mr and ozonesecure-mr) use defaultFS when setting up MR environment:\nhttps://github.com/apache/hadoop-ozone/blob/8102ac799816f417e096873b6f351fd531f7bfbf/hadoop-ozone/dist/src/main/smoketest/createmrenv.robot#L46-L47\nChanging defaultFS to ofs:// in these environments can help validate the META-INF changes.\nChanging/adding defaultFS in the other ones is not needed IMO.", "author": "adoroszlai", "createdAt": "2020-08-26T15:20:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyNzczNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODM5MTg0OQ==", "url": "https://github.com/apache/ozone/pull/1352#discussion_r478391849", "bodyText": "AFAIK these are just helper lines, not really the test of the file system. META-INF/services are already tested as test.sh is modified to do both o3fs/ofs tests.\nI am fine to replace all the defaultFS just let's agree first what do we need to test. Do we need different MR test with both kind of defaultFs?\nOr is it enough to test o3fs/ofs low level functionality and MR can use just one of them?\n(And you see it's a different discussion, that's the reason why I suggested to do it in a separated PR. But can be included if you think it's better.)", "author": "elek", "createdAt": "2020-08-27T12:47:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyNzczNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODM5OTI3Mw==", "url": "https://github.com/apache/ozone/pull/1352#discussion_r478399273", "bodyText": "META-INF/services are already tested as test.sh is modified to do both o3fs/ofs tests.\n\nGot it.\n\nDo we need different MR test with both kind of defaultFs?\n\nI'm doing that in HDDS-3840.  I'll pass it via -D command-line option, as different value is needed for each test in the same cluster.\nI guess I can retain the cluster-level config for convenience.", "author": "adoroszlai", "createdAt": "2020-08-27T12:59:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyNzczNQ=="}], "type": "inlineReview"}, {"oid": "06eda6195df0242a560cf94bf2ac6fc803952949", "url": "https://github.com/apache/ozone/commit/06eda6195df0242a560cf94bf2ac6fc803952949", "message": "Revert \"Set fs.defaultFS to OFS in docker-config.\"\n\nThis reverts commit 4593e8ae425db0c59eaaed04ebb64ef9f8648ce5.\n\nChange-Id: I089c067cfdc450502701557ff174d87861fd8532", "committedDate": "2020-08-26T19:02:48Z", "type": "commit"}, {"oid": "0e5ed8004e4c84e4b21fb9a8ff636e8802674ffe", "url": "https://github.com/apache/ozone/commit/0e5ed8004e4c84e4b21fb9a8ff636e8802674ffe", "message": "Revert docker-config fs.defaultFS changes.\n\nChange-Id: I96fde1f02397764866d89d23fd81c47237abf636", "committedDate": "2020-08-26T19:04:44Z", "type": "commit"}, {"oid": "e2086f9bc8e3a95cf90afb03fdf76ad923e633ab", "url": "https://github.com/apache/ozone/commit/e2086f9bc8e3a95cf90afb03fdf76ad923e633ab", "message": "Recheck\n\nChange-Id: I8f3608f5d182a557a2d0eb3eff27e83abddcec9c", "committedDate": "2020-08-26T20:32:42Z", "type": "commit"}]}