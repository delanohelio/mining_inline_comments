{"pr_number": 1102, "pr_title": "HDDS-3825. Show rule status of SCM safemode", "pr_createdAt": "2020-06-20T13:21:53Z", "pr_url": "https://github.com/apache/ozone/pull/1102", "timeline": [{"oid": "fa92eecf4d4c9dfef9e6bb8b9ed1a562574a0b7f", "url": "https://github.com/apache/ozone/commit/fa92eecf4d4c9dfef9e6bb8b9ed1a562574a0b7f", "message": "HDDS-3825. Show rule status of safemode", "committedDate": "2020-06-20T13:54:59Z", "type": "commit"}, {"oid": "fa92eecf4d4c9dfef9e6bb8b9ed1a562574a0b7f", "url": "https://github.com/apache/ozone/commit/fa92eecf4d4c9dfef9e6bb8b9ed1a562574a0b7f", "message": "HDDS-3825. Show rule status of safemode", "committedDate": "2020-06-20T13:54:59Z", "type": "forcePushed"}, {"oid": "854fd7ca585b056cd41591c82c83c4ccbdcde558", "url": "https://github.com/apache/ozone/commit/854fd7ca585b056cd41591c82c83c4ccbdcde558", "message": "trigger new ci check", "committedDate": "2020-06-20T23:36:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI5NDQ2Mw==", "url": "https://github.com/apache/ozone/pull/1102#discussion_r443294463", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    + \" should >= safeModeCutoff \" + this.safeModeCutoff;\n          \n          \n            \n                    + \" >= safeModeCutoff \" + this.safeModeCutoff;", "author": "dineshchitlangia", "createdAt": "2020-06-22T02:53:15Z", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/ContainerSafeModeRule.java", "diffHunk": "@@ -125,4 +125,10 @@ protected void process(NodeRegistrationContainerReport reportsProto) {\n   protected void cleanup() {\n     containerMap.clear();\n   }\n+\n+  @Override\n+  public String getStatusText() {\n+    return \"currentContainerThreshold \" + getCurrentContainerThreshold()\n+        + \" should >= safeModeCutoff \" + this.safeModeCutoff;", "originalCommit": "854fd7ca585b056cd41591c82c83c4ccbdcde558", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI5NDUxOA==", "url": "https://github.com/apache/ozone/pull/1102#discussion_r443294518", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            }\n          \n          \n            \n            }", "author": "dineshchitlangia", "createdAt": "2020-06-22T02:53:33Z", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/ContainerSafeModeRule.java", "diffHunk": "@@ -125,4 +125,10 @@ protected void process(NodeRegistrationContainerReport reportsProto) {\n   protected void cleanup() {\n     containerMap.clear();\n   }\n+\n+  @Override\n+  public String getStatusText() {\n+    return \"currentContainerThreshold \" + getCurrentContainerThreshold()\n+        + \" should >= safeModeCutoff \" + this.safeModeCutoff;\n+  }\n }", "originalCommit": "854fd7ca585b056cd41591c82c83c4ccbdcde558", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI5NDYwMw==", "url": "https://github.com/apache/ozone/pull/1102#discussion_r443294603", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                return \"registeredDns \" + this.registeredDns + \" should >= requiredDns \"\n          \n          \n            \n                return \"registeredDns \" + this.registeredDns + \" >= requiredDns \"", "author": "dineshchitlangia", "createdAt": "2020-06-22T02:54:08Z", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/DataNodeSafeModeRule.java", "diffHunk": "@@ -79,4 +79,10 @@ protected void process(NodeRegistrationContainerReport reportsProto) {\n   protected void cleanup() {\n     registeredDnSet.clear();\n   }\n+\n+  @Override\n+  public String getStatusText() {\n+    return \"registeredDns \" + this.registeredDns + \" should >= requiredDns \"", "originalCommit": "854fd7ca585b056cd41591c82c83c4ccbdcde558", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI5NDYyMA==", "url": "https://github.com/apache/ozone/pull/1102#discussion_r443294620", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            }\n          \n          \n            \n            }", "author": "dineshchitlangia", "createdAt": "2020-06-22T02:54:16Z", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/DataNodeSafeModeRule.java", "diffHunk": "@@ -79,4 +79,10 @@ protected void process(NodeRegistrationContainerReport reportsProto) {\n   protected void cleanup() {\n     registeredDnSet.clear();\n   }\n+\n+  @Override\n+  public String getStatusText() {\n+    return \"registeredDns \" + this.registeredDns + \" should >= requiredDns \"\n+        + this.requiredDns;\n+  }\n }", "originalCommit": "854fd7ca585b056cd41591c82c83c4ccbdcde558", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI5NDY4Mw==", "url": "https://github.com/apache/ozone/pull/1102#discussion_r443294683", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    + \" should >= healthyPipelineThresholdCount \"\n          \n          \n            \n                    + \" >= healthyPipelineThresholdCount \"", "author": "dineshchitlangia", "createdAt": "2020-06-22T02:54:33Z", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/HealthyPipelineSafeModeRule.java", "diffHunk": "@@ -150,4 +150,11 @@ public int getCurrentHealthyPipelineCount() {\n   public int getHealthyPipelineThresholdCount() {\n     return healthyPipelineThresholdCount;\n   }\n+\n+  @Override\n+  public String getStatusText() {\n+    return \"currentHealthyPipelineCount \" + this.currentHealthyPipelineCount\n+        + \" should >= healthyPipelineThresholdCount \"", "originalCommit": "854fd7ca585b056cd41591c82c83c4ccbdcde558", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI5NDY5Ng==", "url": "https://github.com/apache/ozone/pull/1102#discussion_r443294696", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            }\n          \n          \n            \n            }", "author": "dineshchitlangia", "createdAt": "2020-06-22T02:54:38Z", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/HealthyPipelineSafeModeRule.java", "diffHunk": "@@ -150,4 +150,11 @@ public int getCurrentHealthyPipelineCount() {\n   public int getHealthyPipelineThresholdCount() {\n     return healthyPipelineThresholdCount;\n   }\n+\n+  @Override\n+  public String getStatusText() {\n+    return \"currentHealthyPipelineCount \" + this.currentHealthyPipelineCount\n+        + \" should >= healthyPipelineThresholdCount \"\n+        + this.healthyPipelineThresholdCount;\n+  }\n }", "originalCommit": "854fd7ca585b056cd41591c82c83c4ccbdcde558", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI5NDc0MA==", "url": "https://github.com/apache/ozone/pull/1102#discussion_r443294740", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    + this.currentReportedPipelineCount + \" should >= thresholdCount \"\n          \n          \n            \n                    + this.currentReportedPipelineCount + \" >= thresholdCount \"", "author": "dineshchitlangia", "createdAt": "2020-06-22T02:54:51Z", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/OneReplicaPipelineSafeModeRule.java", "diffHunk": "@@ -134,4 +134,11 @@ public int getThresholdCount() {\n   public int getCurrentReportedPipelineCount() {\n     return currentReportedPipelineCount;\n   }\n+\n+  @Override\n+  public String getStatusText() {\n+    return \"currentReportedPipelineCount \"\n+        + this.currentReportedPipelineCount + \" should >= thresholdCount \"", "originalCommit": "854fd7ca585b056cd41591c82c83c4ccbdcde558", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI5NDc3Ng==", "url": "https://github.com/apache/ozone/pull/1102#discussion_r443294776", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            }\n          \n          \n            \n            }", "author": "dineshchitlangia", "createdAt": "2020-06-22T02:55:00Z", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/OneReplicaPipelineSafeModeRule.java", "diffHunk": "@@ -134,4 +134,11 @@ public int getThresholdCount() {\n   public int getCurrentReportedPipelineCount() {\n     return currentReportedPipelineCount;\n   }\n+\n+  @Override\n+  public String getStatusText() {\n+    return \"currentReportedPipelineCount \"\n+        + this.currentReportedPipelineCount + \" should >= thresholdCount \"\n+        + this.thresholdCount;\n+  }\n }", "originalCommit": "854fd7ca585b056cd41591c82c83c4ccbdcde558", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI5NDk1MQ==", "url": "https://github.com/apache/ozone/pull/1102#discussion_r443294951", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                Map<String, Pair<Boolean, String>> map =\n          \n          \n            \n                    new HashMap<>();\n          \n          \n            \n                Map<String, Pair<Boolean, String>> map = new HashMap<>();", "author": "dineshchitlangia", "createdAt": "2020-06-22T02:55:56Z", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/SCMSafeModeManager.java", "diffHunk": "@@ -272,6 +273,21 @@ public boolean getInSafeMode() {\n     return inSafeMode.get();\n   }\n \n+  /**\n+   * Get the safe mode statuses of each rules.\n+   *\n+   * @return map of rule statuses.\n+   */\n+  public Map<String, Pair<Boolean, String>> getRuleStatus() {\n+    Map<String, Pair<Boolean, String>> map =\n+        new HashMap<>();", "originalCommit": "854fd7ca585b056cd41591c82c83c4ccbdcde558", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI5NTEzMQ==", "url": "https://github.com/apache/ozone/pull/1102#discussion_r443295131", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Return's the status text of this rule.\n          \n          \n            \n               * Returns the status text of the rule.", "author": "dineshchitlangia", "createdAt": "2020-06-22T02:56:41Z", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/SafeModeExitRule.java", "diffHunk": "@@ -111,4 +111,9 @@ protected SafeModeMetrics getSafeModeMetrics() {\n     return safeModeManager.getSafeModeMetrics();\n   }\n \n+  /**\n+   * Return's the status text of this rule.", "originalCommit": "854fd7ca585b056cd41591c82c83c4ccbdcde558", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI5NTI5Ng==", "url": "https://github.com/apache/ozone/pull/1102#discussion_r443295296", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Get the safe mode statuses of each rules.\n          \n          \n            \n               * Get the safe mode status of all rules.", "author": "dineshchitlangia", "createdAt": "2020-06-22T02:57:37Z", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/StorageContainerManager.java", "diffHunk": "@@ -1110,4 +1111,13 @@ public SCMMetadataStore getScmMetadataStore() {\n   public NetworkTopology getClusterMap() {\n     return this.clusterMap;\n   }\n+\n+  /**\n+   * Get the safe mode statuses of each rules.", "originalCommit": "854fd7ca585b056cd41591c82c83c4ccbdcde558", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI5NTQxOQ==", "url": "https://github.com/apache/ozone/pull/1102#discussion_r443295419", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  description = \"More verbose output. Show the status of rules.\")\n          \n          \n            \n                  description = \"Show detailed status of rules.\")", "author": "dineshchitlangia", "createdAt": "2020-06-22T02:58:20Z", "path": "hadoop-hdds/tools/src/main/java/org/apache/hadoop/hdds/scm/cli/SafeModeCheckSubcommand.java", "diffHunk": "@@ -43,6 +46,10 @@\n   @ParentCommand\n   private SafeModeCommands parent;\n \n+  @CommandLine.Option(names = {\"--verbose\"},\n+      description = \"More verbose output. Show the status of rules.\")", "originalCommit": "854fd7ca585b056cd41591c82c83c4ccbdcde558", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI5NTU3MA==", "url": "https://github.com/apache/ozone/pull/1102#discussion_r443295570", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Get the safe mode statuses of each rules.\n          \n          \n            \n               * Get the safe mode status of all rules.", "author": "dineshchitlangia", "createdAt": "2020-06-22T02:59:14Z", "path": "hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/SCMSafeModeManager.java", "diffHunk": "@@ -272,6 +273,21 @@ public boolean getInSafeMode() {\n     return inSafeMode.get();\n   }\n \n+  /**\n+   * Get the safe mode statuses of each rules.", "originalCommit": "854fd7ca585b056cd41591c82c83c4ccbdcde558", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI5NTgxMg==", "url": "https://github.com/apache/ozone/pull/1102#discussion_r443295812", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Get the safe mode statuses of each rules.\n          \n          \n            \n               * Get the safe mode status of all rules.", "author": "dineshchitlangia", "createdAt": "2020-06-22T03:00:32Z", "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/client/ScmClient.java", "diffHunk": "@@ -210,6 +212,15 @@ Pipeline createReplicationPipeline(HddsProtos.ReplicationType type,\n    */\n   boolean inSafeMode() throws IOException;\n \n+  /**\n+   * Get the safe mode statuses of each rules.", "originalCommit": "854fd7ca585b056cd41591c82c83c4ccbdcde558", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2aae4dcbb77a2b9ed8ad360a8e3ccc321caa184e", "url": "https://github.com/apache/ozone/commit/2aae4dcbb77a2b9ed8ad360a8e3ccc321caa184e", "message": "Update hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/client/ScmClient.java\n\nCo-authored-by: Dinesh Chitlangia <dineshchitlangia@gmail.com>", "committedDate": "2020-06-22T03:14:20Z", "type": "commit"}, {"oid": "ebf98af9d7a9e74e73f8adc70f1b4470f11426a6", "url": "https://github.com/apache/ozone/commit/ebf98af9d7a9e74e73f8adc70f1b4470f11426a6", "message": "Update hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/SCMSafeModeManager.java\n\nCo-authored-by: Dinesh Chitlangia <dineshchitlangia@gmail.com>", "committedDate": "2020-06-22T03:14:36Z", "type": "commit"}, {"oid": "7a306ea0c0277559efa2c1e27aaea571d2d06b9a", "url": "https://github.com/apache/ozone/commit/7a306ea0c0277559efa2c1e27aaea571d2d06b9a", "message": "Update hadoop-hdds/tools/src/main/java/org/apache/hadoop/hdds/scm/cli/SafeModeCheckSubcommand.java\n\nCo-authored-by: Dinesh Chitlangia <dineshchitlangia@gmail.com>", "committedDate": "2020-06-22T03:15:12Z", "type": "commit"}, {"oid": "6749930996a16a9da3deb95c5f7f00cb2fae14ae", "url": "https://github.com/apache/ozone/commit/6749930996a16a9da3deb95c5f7f00cb2fae14ae", "message": "Update hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/StorageContainerManager.java\n\nCo-authored-by: Dinesh Chitlangia <dineshchitlangia@gmail.com>", "committedDate": "2020-06-22T03:15:24Z", "type": "commit"}, {"oid": "7826b82eb7f9b75a584bd565b8c8670de8f3a063", "url": "https://github.com/apache/ozone/commit/7826b82eb7f9b75a584bd565b8c8670de8f3a063", "message": "Update hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/SafeModeExitRule.java\n\nCo-authored-by: Dinesh Chitlangia <dineshchitlangia@gmail.com>", "committedDate": "2020-06-22T03:15:33Z", "type": "commit"}, {"oid": "8b5b57a51de11600913d7523b360afa350698102", "url": "https://github.com/apache/ozone/commit/8b5b57a51de11600913d7523b360afa350698102", "message": "Update hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/HealthyPipelineSafeModeRule.java\n\nCo-authored-by: Dinesh Chitlangia <dineshchitlangia@gmail.com>", "committedDate": "2020-06-22T03:15:43Z", "type": "commit"}, {"oid": "0707f07e630c5088a52f39e52231b90de65fd146", "url": "https://github.com/apache/ozone/commit/0707f07e630c5088a52f39e52231b90de65fd146", "message": "Update hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/DataNodeSafeModeRule.java\n\nCo-authored-by: Dinesh Chitlangia <dineshchitlangia@gmail.com>", "committedDate": "2020-06-22T03:15:56Z", "type": "commit"}, {"oid": "f1dcf3ad06dfaf68a0f54d8b8937949b7e979f1e", "url": "https://github.com/apache/ozone/commit/f1dcf3ad06dfaf68a0f54d8b8937949b7e979f1e", "message": "Update hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/DataNodeSafeModeRule.java\n\nCo-authored-by: Dinesh Chitlangia <dineshchitlangia@gmail.com>", "committedDate": "2020-06-22T03:16:06Z", "type": "commit"}, {"oid": "6437a2056e2c537e6ca5d1d26cf0021a09a81ce2", "url": "https://github.com/apache/ozone/commit/6437a2056e2c537e6ca5d1d26cf0021a09a81ce2", "message": "Update hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/ContainerSafeModeRule.java\n\nCo-authored-by: Dinesh Chitlangia <dineshchitlangia@gmail.com>", "committedDate": "2020-06-22T03:16:14Z", "type": "commit"}, {"oid": "e687b002e3e650ad930f8d5d149d9cf8ebb17052", "url": "https://github.com/apache/ozone/commit/e687b002e3e650ad930f8d5d149d9cf8ebb17052", "message": "Update hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/ContainerSafeModeRule.java\n\nCo-authored-by: Dinesh Chitlangia <dineshchitlangia@gmail.com>", "committedDate": "2020-06-22T03:16:22Z", "type": "commit"}, {"oid": "d213113314febacb57b799ce81a2fe418fd0c54b", "url": "https://github.com/apache/ozone/commit/d213113314febacb57b799ce81a2fe418fd0c54b", "message": "Update hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/OneReplicaPipelineSafeModeRule.java\n\nCo-authored-by: Dinesh Chitlangia <dineshchitlangia@gmail.com>", "committedDate": "2020-06-22T03:16:43Z", "type": "commit"}, {"oid": "0bbdd059cb85adf073914e820e557d92f914cc85", "url": "https://github.com/apache/ozone/commit/0bbdd059cb85adf073914e820e557d92f914cc85", "message": "Update hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/safemode/SCMSafeModeManager.java\n\nCo-authored-by: Dinesh Chitlangia <dineshchitlangia@gmail.com>", "committedDate": "2020-06-22T03:17:09Z", "type": "commit"}]}