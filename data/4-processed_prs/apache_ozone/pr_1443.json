{"pr_number": 1443, "pr_title": "HDDS-4270. Add more reusable byteman scripts to debug ofs/o3fs performance", "pr_createdAt": "2020-09-23T12:04:28Z", "pr_url": "https://github.com/apache/ozone/pull/1443", "timeline": [{"oid": "1cdeeac79aca034964ce1093d219f3947f5e1e40", "url": "https://github.com/apache/ozone/commit/1cdeeac79aca034964ce1093d219f3947f5e1e40", "message": "HDDS-4270. Add more reusable byteman scripts to debug ofs/o3fs performance", "committedDate": "2020-09-23T12:02:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY5NDU2OA==", "url": "https://github.com/apache/ozone/pull/1443#discussion_r493694568", "bodyText": "Seems to be leftover comment from ratis-no-flush.btm.", "author": "adoroszlai", "createdAt": "2020-09-23T15:39:19Z", "path": "dev-support/byteman/ratis-flush.btm", "diffHunk": "@@ -0,0 +1,35 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Turn of flush for Raits log", "originalCommit": "1cdeeac79aca034964ce1093d219f3947f5e1e40", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcyMDgyOQ==", "url": "https://github.com/apache/ozone/pull/1443#discussion_r493720829", "bodyText": "To be able to use multiple scripts, we need to avoid conflict of rule name:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            RULE FileSystem.close\n          \n          \n            \n            RULE hcfs-read-FileSystem.close", "author": "adoroszlai", "createdAt": "2020-09-23T16:16:21Z", "path": "dev-support/byteman/hcfs-read.btm", "diffHunk": "@@ -0,0 +1,67 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Measure time spent in HCFS read implementations\n+\n+RULE FileSystem.close", "originalCommit": "1cdeeac79aca034964ce1093d219f3947f5e1e40", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcyMTAzMQ==", "url": "https://github.com/apache/ozone/pull/1443#discussion_r493721031", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            RULE FileSystem.close\n          \n          \n            \n            RULE watchforcommit_all-FileSystem.close", "author": "adoroszlai", "createdAt": "2020-09-23T16:16:39Z", "path": "dev-support/byteman/watchforcommit_all.btm", "diffHunk": "@@ -0,0 +1,47 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Measure overall time spent in Watch for commit calls\n+\n+RULE FileSystem.close", "originalCommit": "1cdeeac79aca034964ce1093d219f3947f5e1e40", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcyNDA3Mg==", "url": "https://github.com/apache/ozone/pull/1443#discussion_r493724072", "bodyText": "I assume one would not use both watchforcommit scripts at the same time.  If we did, rule name would need to be unique.", "author": "adoroszlai", "createdAt": "2020-09-23T16:21:11Z", "path": "dev-support/byteman/watchforcommit_all.btm", "diffHunk": "@@ -0,0 +1,47 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Measure overall time spent in Watch for commit calls\n+\n+RULE FileSystem.close\n+CLASS org.apache.hadoop.fs.FileSystem\n+METHOD close\n+IF TRUE\n+DO\n+  System.out.println(\"Closing file system instance: \" + System.identityHashCode($0));\n+  System.out.println(\"   watchForCommit.call: \" + readCounter(\"watchForCommit.call\"));\n+  System.out.println(\"   watchForCommit.allTime: \" + readCounter(\"watchForCommit.allTime\"))\n+\n+ENDRULE\n+\n+RULE BlockOutputStream.watchForCommit.Entry", "originalCommit": "1cdeeac79aca034964ce1093d219f3947f5e1e40", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDIzOTkxNg==", "url": "https://github.com/apache/ozone/pull/1443#discussion_r494239916", "bodyText": "Yes, the chance is low, but let me add the same prefix to here, just to be on the safe side...", "author": "elek", "createdAt": "2020-09-24T11:31:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcyNDA3Mg=="}], "type": "inlineReview"}, {"oid": "cee5eee13396a36f770478d60107fc9d68d4400d", "url": "https://github.com/apache/ozone/commit/cee5eee13396a36f770478d60107fc9d68d4400d", "message": "Apply suggestions from code review\n\nCo-authored-by: Doroszlai, Attila <6454655+adoroszlai@users.noreply.github.com>", "committedDate": "2020-09-24T11:16:34Z", "type": "commit"}, {"oid": "2eb0ef300750bfb8a38cca8d1c4216f6f22a5e4b", "url": "https://github.com/apache/ozone/commit/2eb0ef300750bfb8a38cca8d1c4216f6f22a5e4b", "message": "Fix docs", "committedDate": "2020-09-24T11:29:10Z", "type": "commit"}, {"oid": "e8ee97b0bf98ac70d778e5e77975ebdcca587a94", "url": "https://github.com/apache/ozone/commit/e8ee97b0bf98ac70d778e5e77975ebdcca587a94", "message": "Merge remote-tracking branch 'elek/HDDS-4270' into HDDS-4270", "committedDate": "2020-09-24T11:29:17Z", "type": "commit"}, {"oid": "9897ecb4696b362a55fbacabc47d8ab2021b7dba", "url": "https://github.com/apache/ozone/commit/9897ecb4696b362a55fbacabc47d8ab2021b7dba", "message": "prefix BOS.watchForCommit", "committedDate": "2020-09-24T11:31:21Z", "type": "commit"}]}