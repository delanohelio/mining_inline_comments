{"pr_number": 1381, "pr_title": "HDDS-4201. Improve the performance of OmKeyLocationInfoGroup", "pr_createdAt": "2020-09-03T02:51:04Z", "pr_url": "https://github.com/apache/ozone/pull/1381", "timeline": [{"oid": "f0a7bb60622e9f60c435e39eeaebba2af6a7d5e9", "url": "https://github.com/apache/ozone/commit/f0a7bb60622e9f60c435e39eeaebba2af6a7d5e9", "message": "HDDS-4201. Improve the performance of OmKeyLocationInfoGroup", "committedDate": "2020-09-03T02:06:09Z", "type": "commit"}, {"oid": "f0a7bb60622e9f60c435e39eeaebba2af6a7d5e9", "url": "https://github.com/apache/ozone/commit/f0a7bb60622e9f60c435e39eeaebba2af6a7d5e9", "message": "HDDS-4201. Improve the performance of OmKeyLocationInfoGroup", "committedDate": "2020-09-03T02:06:09Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzAwNTE0MQ==", "url": "https://github.com/apache/ozone/pull/1381#discussion_r483005141", "bodyText": "I think we can avoid two map lookups (and long autoboxing) by using computeIfAbsent:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  if (!locationVersionMap.containsKey(info.getCreateVersion())) {\n          \n          \n            \n                    locationVersionMap.put(info.getCreateVersion(), new ArrayList<>());\n          \n          \n            \n                  }\n          \n          \n            \n                  locationVersionMap.get(info.getCreateVersion()).add(info);\n          \n          \n            \n                  locationVersionMap\n          \n          \n            \n                      .computeIfAbsent(info.getCreateVersion(), v -> new ArrayList<>())\n          \n          \n            \n                      .add(info);", "author": "adoroszlai", "createdAt": "2020-09-03T14:06:40Z", "path": "hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/om/helpers/OmKeyLocationInfoGroup.java", "diffHunk": "@@ -36,8 +36,13 @@\n   public OmKeyLocationInfoGroup(long version,\n                                 List<OmKeyLocationInfo> locations) {\n     this.version = version;\n-    this.locationVersionMap = locations.stream()\n-        .collect(Collectors.groupingBy(OmKeyLocationInfo::getCreateVersion));\n+    locationVersionMap = new HashMap<>();\n+    for (OmKeyLocationInfo info : locations) {\n+      if (!locationVersionMap.containsKey(info.getCreateVersion())) {\n+        locationVersionMap.put(info.getCreateVersion(), new ArrayList<>());\n+      }\n+      locationVersionMap.get(info.getCreateVersion()).add(info);", "originalCommit": "f0a7bb60622e9f60c435e39eeaebba2af6a7d5e9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cb05747c494f014d086b0e162ce687db1dbf7ea3", "url": "https://github.com/apache/ozone/commit/cb05747c494f014d086b0e162ce687db1dbf7ea3", "message": "Update hadoop-ozone/common/src/main/java/org/apache/hadoop/ozone/om/helpers/OmKeyLocationInfoGroup.java\n\nCo-authored-by: Doroszlai, Attila <6454655+adoroszlai@users.noreply.github.com>", "committedDate": "2020-09-03T23:43:59Z", "type": "commit"}]}