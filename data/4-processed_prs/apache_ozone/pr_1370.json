{"pr_number": 1370, "pr_title": "HDDS-4176. Fix failed UT: test2WayCommitForTimeoutException", "pr_createdAt": "2020-09-01T01:58:39Z", "pr_url": "https://github.com/apache/ozone/pull/1370", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDc5NDg1NA==", "url": "https://github.com/apache/ozone/pull/1370#discussion_r480794854", "bodyText": "This logic looks right to me.\nCan you bump up the number of DN to make tests run against higher number DN: https://github.com/apache/hadoop-ozone/blob/34ee8311b0d0a37878fe1fd2e5d8c1b91aa8cc8f/hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/client/rpc/Test2WayCommitInRatis.java#L109\nWhich seems will cover your change?", "author": "amaliujia", "createdAt": "2020-09-01T04:44:03Z", "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/client/rpc/TestWatchForCommit.java", "diffHunk": "@@ -297,9 +298,11 @@ public void test2WayCommitForTimeoutException() throws Exception {\n             xceiverClient.getPipeline()));\n     reply.getResponse().get();\n     Assert.assertEquals(3, ratisClient.getCommitInfoMap().size());\n+    List<DatanodeDetails> datanodeDetails = pipeline.getNodes();\n     for (HddsDatanodeService dn : cluster.getHddsDatanodes()) {\n       // shutdown the ratis follower\n-      if (ContainerTestHelper.isRatisFollower(dn, pipeline)) {\n+      if (datanodeDetails.contains(dn.getDatanodeDetails())\n+          && ContainerTestHelper.isRatisFollower(dn, pipeline)) {", "originalCommit": "e9d0ddc89ae1f4c1f8088cade45d7a7705b272a8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDgzMTE4Ng==", "url": "https://github.com/apache/ozone/pull/1370#discussion_r480831186", "bodyText": "@amaliujia Thanks for your review. TestWatchForCommit already startCluster with 9 nodes, maybe it is enough.\nhttps://github.com/apache/hadoop-ozone/blob/master/hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/client/rpc/TestWatchForCommit.java#L124", "author": "runzhiwang", "createdAt": "2020-09-01T05:27:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDc5NDg1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDg4MTE5MA==", "url": "https://github.com/apache/ozone/pull/1370#discussion_r480881190", "bodyText": "Oops. You are right. I was looking at a wrong file.", "author": "amaliujia", "createdAt": "2020-09-01T06:41:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDc5NDg1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQyNjUwNg==", "url": "https://github.com/apache/ozone/pull/1370#discussion_r481426506", "bodyText": "Nit: nodesInPipeline may be a better name.", "author": "adoroszlai", "createdAt": "2020-09-01T20:56:53Z", "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/client/rpc/TestWatchForCommit.java", "diffHunk": "@@ -297,9 +298,11 @@ public void test2WayCommitForTimeoutException() throws Exception {\n             xceiverClient.getPipeline()));\n     reply.getResponse().get();\n     Assert.assertEquals(3, ratisClient.getCommitInfoMap().size());\n+    List<DatanodeDetails> datanodeDetails = pipeline.getNodes();", "originalCommit": "e9d0ddc89ae1f4c1f8088cade45d7a7705b272a8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQ5MzE1Mg==", "url": "https://github.com/apache/ozone/pull/1370#discussion_r481493152", "bodyText": "@adoroszlai Thanks for review. I have updated the patch.", "author": "runzhiwang", "createdAt": "2020-09-01T23:47:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQyNjUwNg=="}], "type": "inlineReview"}, {"oid": "491c95625617a68cae2970a1a29b8a54c47251a6", "url": "https://github.com/apache/ozone/commit/491c95625617a68cae2970a1a29b8a54c47251a6", "message": "HDDS-4176. Fix failed UT: test2WayCommitForTimeoutException", "committedDate": "2020-09-01T23:45:25Z", "type": "commit"}, {"oid": "391ef3d8741aee6e83dc8c4a29563510c495ff7e", "url": "https://github.com/apache/ozone/commit/391ef3d8741aee6e83dc8c4a29563510c495ff7e", "message": "fix code review", "committedDate": "2020-09-01T23:46:04Z", "type": "commit"}, {"oid": "391ef3d8741aee6e83dc8c4a29563510c495ff7e", "url": "https://github.com/apache/ozone/commit/391ef3d8741aee6e83dc8c4a29563510c495ff7e", "message": "fix code review", "committedDate": "2020-09-01T23:46:04Z", "type": "forcePushed"}]}