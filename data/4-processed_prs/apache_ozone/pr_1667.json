{"pr_number": 1667, "pr_title": "HDDS-4525. Replace Hadoop variables and functions in Ozone shell scripts with Ozone-specific ones", "pr_createdAt": "2020-12-07T13:43:36Z", "pr_url": "https://github.com/apache/ozone/pull/1667", "timeline": [{"oid": "71eee7ab9c42a871b6c687a2d0805cd1810f5241", "url": "https://github.com/apache/ozone/commit/71eee7ab9c42a871b6c687a2d0805cd1810f5241", "message": "HDDS-4525. Replace Hadoop variables and functions in Ozone shell scripts with Ozone-specific ones", "committedDate": "2020-12-04T14:53:29Z", "type": "commit"}, {"oid": "52dcf871f10b3c7dee333e68cd2aa384592c9fc2", "url": "https://github.com/apache/ozone/commit/52dcf871f10b3c7dee333e68cd2aa384592c9fc2", "message": "Run envvars CLI test", "committedDate": "2020-12-05T07:09:17Z", "type": "commit"}, {"oid": "71be10e91c297258231a3e42ed3c9bf9bde6898d", "url": "https://github.com/apache/ozone/commit/71be10e91c297258231a3e42ed3c9bf9bde6898d", "message": "Add test for ozone classpath", "committedDate": "2020-12-06T17:24:29Z", "type": "commit"}, {"oid": "4b75cb364a56b3a13cc8ac84c4419a3946423e8a", "url": "https://github.com/apache/ozone/commit/4b75cb364a56b3a13cc8ac84c4419a3946423e8a", "message": "remove assertion about output", "committedDate": "2020-12-06T17:27:08Z", "type": "commit"}, {"oid": "6299ac0eebb537f93420d94be95916423c49f49c", "url": "https://github.com/apache/ozone/commit/6299ac0eebb537f93420d94be95916423c49f49c", "message": "set +e", "committedDate": "2020-12-06T18:01:24Z", "type": "commit"}, {"oid": "5341926a9df84ea8b9377deb96b0e4778faccd70", "url": "https://github.com/apache/ozone/commit/5341926a9df84ea8b9377deb96b0e4778faccd70", "message": "avoid deprecation warning in compose environments", "committedDate": "2020-12-07T07:57:50Z", "type": "commit"}, {"oid": "f2f14aec0aeb79a668408bc7104f3518561293f5", "url": "https://github.com/apache/ozone/commit/f2f14aec0aeb79a668408bc7104f3518561293f5", "message": "Fix classpath test", "committedDate": "2020-12-07T08:17:12Z", "type": "commit"}, {"oid": "3c2945537c2d514966e6f0d8dc52236b942b06a3", "url": "https://github.com/apache/ozone/commit/3c2945537c2d514966e6f0d8dc52236b942b06a3", "message": "allow creating files in dist/target", "committedDate": "2020-12-07T09:24:24Z", "type": "commit"}, {"oid": "268ea6dc05b3e534e4e1f2b1ca7e7c1b9463fe40", "url": "https://github.com/apache/ozone/commit/268ea6dc05b3e534e4e1f2b1ca7e7c1b9463fe40", "message": "rename OZONE_CONF_DIR to OZONE_CONFIG_DIR", "committedDate": "2020-12-07T09:35:35Z", "type": "commit"}, {"oid": "bd662394ca66a0c23b8403f079b7321430bc3afa", "url": "https://github.com/apache/ozone/commit/bd662394ca66a0c23b8403f079b7321430bc3afa", "message": "fix perm", "committedDate": "2020-12-07T10:17:58Z", "type": "commit"}, {"oid": "7fde59bf504d4f7d383adfd9399232e73c89b8bc", "url": "https://github.com/apache/ozone/commit/7fde59bf504d4f7d383adfd9399232e73c89b8bc", "message": "Revert \"allow creating files in dist/target\"\n\nThis reverts commit 3c2945537c2d514966e6f0d8dc52236b942b06a3.", "committedDate": "2020-12-07T10:31:07Z", "type": "commit"}, {"oid": "afa19d8f2b5a96e0989c3ec82b05f2dc74d54ad1", "url": "https://github.com/apache/ozone/commit/afa19d8f2b5a96e0989c3ec82b05f2dc74d54ad1", "message": "Add compatibility test for command-line options", "committedDate": "2020-12-08T06:13:22Z", "type": "commit"}, {"oid": "3a820c60422974e2738c8c0e5200d444f4056cfb", "url": "https://github.com/apache/ozone/commit/3a820c60422974e2738c8c0e5200d444f4056cfb", "message": "trigger new CI check", "committedDate": "2020-12-08T07:35:56Z", "type": "commit"}, {"oid": "8767d83ff0f365800df5733f5fbf97b0e59028d9", "url": "https://github.com/apache/ozone/commit/8767d83ff0f365800df5733f5fbf97b0e59028d9", "message": "trigger new CI check", "committedDate": "2020-12-08T13:36:34Z", "type": "commit"}, {"oid": "d767e1bf9d87e78ab30c5e5c618f464aa1ee6b8f", "url": "https://github.com/apache/ozone/commit/d767e1bf9d87e78ab30c5e5c618f464aa1ee6b8f", "message": "trigger new CI check", "committedDate": "2020-12-10T12:04:27Z", "type": "commit"}, {"oid": "e54c4390bcc8374970baa120b6c6d9b5a375ff1d", "url": "https://github.com/apache/ozone/commit/e54c4390bcc8374970baa120b6c6d9b5a375ff1d", "message": "Merge remote-tracking branch 'origin/master' into HDDS-4525", "committedDate": "2020-12-12T11:51:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTcxMzI3Mg==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r541713272", "bodyText": "Should be OZONE_CONFIG_DIR? nvm", "author": "smengcl", "createdAt": "2020-12-12T18:30:39Z", "path": "hadoop-hdds/framework/src/main/java/org/apache/hadoop/hdds/utils/db/DBConfigFromFile.java", "diffHunk": "@@ -65,7 +65,7 @@ public static File getConfigLocation() throws IOException {\n \n     if (StringUtil.isBlank(path)) {\n       LOG.debug(\"Unable to find the configuration directory. \"\n-          + \"Please make sure that HADOOP_CONF_DIR is setup correctly.\");\n+          + \"Please make sure that \" + CONFIG_DIR + \" is setup correctly.\");", "originalCommit": "d767e1bf9d87e78ab30c5e5c618f464aa1ee6b8f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyODQ2Mg==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543028462", "bodyText": "start-dfs.sh is mentioned two times here, can you please rephrase this comment, and the next which mentions it to point to start-ozone.sh, and to mention Ozone roles?", "author": "fapifta", "createdAt": "2020-12-15T04:01:11Z", "path": "hadoop-hdds/common/src/main/conf/ozone-env.sh", "diffHunk": "@@ -0,0 +1,280 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Set Ozone-specific environment variables here.\n+\n+# Enable core dump when crash in C++\n+ulimit -c unlimited\n+\n+# Many of the options here are built from the perspective that users\n+# may want to provide OVERWRITING values on the command line.\n+# For example:\n+#\n+#  JAVA_HOME=/usr/java/testing hdfs dfs -ls\n+#\n+# Therefore, the vast majority (BUT NOT ALL!) of these defaults\n+# are configured for substitution and not append.  If append\n+# is preferable, modify this file accordingly.\n+\n+###\n+# Generic settings\n+###\n+\n+# Technically, the only required environment variable is JAVA_HOME.\n+# All others are optional.  However, the defaults are probably not\n+# preferred.  Many sites configure these options outside of Ozone,\n+# such as in /etc/profile.d\n+\n+# The java implementation to use. By default, this environment\n+# variable is REQUIRED on ALL platforms except OS X!\n+# export JAVA_HOME=\n+\n+# Location of Ozone.  By default, Ozone will attempt to determine\n+# this location based upon its execution path.\n+# export OZONE_HOME=\n+\n+# Location of Ozone's configuration information.  i.e., where this\n+# file is living. If this is not defined, Ozone will attempt to\n+# locate it based upon its execution path.\n+#\n+# NOTE: It is recommend that this variable not be set here but in\n+# /etc/profile.d or equivalent.  Some options (such as\n+# --config) may react strangely otherwise.\n+#\n+# export OZONE_CONFIG_DIR=${OZONE_HOME}/etc/hadoop\n+\n+# The maximum amount of heap to use (Java -Xmx).  If no unit\n+# is provided, it will be converted to MB.  Daemons will\n+# prefer any Xmx setting in their respective _OPT variable.\n+# There is no default; the JVM will autoscale based upon machine\n+# memory size.\n+# export OZONE_HEAPSIZE_MAX=\n+\n+# The minimum amount of heap to use (Java -Xms).  If no unit\n+# is provided, it will be converted to MB.  Daemons will\n+# prefer any Xms setting in their respective _OPT variable.\n+# There is no default; the JVM will autoscale based upon machine\n+# memory size.\n+# export OZONE_HEAPSIZE_MIN=\n+\n+# Extra Java runtime options for all Ozone commands. We don't support\n+# IPv6 yet/still, so by default the preference is set to IPv4.\n+# export OZONE_OPTS=\"-Djava.net.preferIPv4Stack=true\"\n+# For Kerberos debugging, an extended option set logs more information\n+# export OZONE_OPTS=\"-Djava.net.preferIPv4Stack=true -Dsun.security.krb5.debug=true -Dsun.security.spnego.debug\"\n+\n+# Some parts of the shell code may do special things dependent upon\n+# the operating system.  We have to set this here. See the next\n+# section as to why....\n+export OZONE_OS_TYPE=${OZONE_OS_TYPE:-$(uname -s)}\n+\n+# Extra Java runtime options for some Ozone commands\n+# and clients (i.e., hdfs dfs -blah).  These get appended to OZONE_OPTS for\n+# such commands.  In most cases, # this should be left empty and\n+# let users supply it on the command line.\n+# export OZONE_CLIENT_OPTS=\"\"\n+\n+#\n+# A note about classpaths.\n+#\n+# By default, Apache Ozone overrides Java's CLASSPATH\n+# environment variable.  It is configured such\n+# that it starts out blank with new entries added after passing\n+# a series of checks (file/dir exists, not already listed aka\n+# de-deduplication).  During de-deduplication, wildcards and/or\n+# directories are *NOT* expanded to keep it simple. Therefore,\n+# if the computed classpath has two specific mentions of\n+# awesome-methods-1.0.jar, only the first one added will be seen.\n+# If two directories are in the classpath that both contain\n+# awesome-methods-1.0.jar, then Java will pick up both versions.\n+\n+# An additional, custom CLASSPATH. Site-wide configs should be\n+# handled via the shellprofile functionality, utilizing the\n+# ozone_add_classpath function for greater control and much\n+# harder for apps/end-users to accidentally override.\n+# Similarly, end users should utilize ${HOME}/.ozonerc .\n+# This variable should ideally only be used as a short-cut,\n+# interactive way for temporary additions on the command line.\n+# export OZONE_CLASSPATH=\"/some/cool/path/on/your/machine\"\n+\n+# Should OZONE_CLASSPATH be first in the official CLASSPATH?\n+# export OZONE_USER_CLASSPATH_FIRST=\"yes\"\n+\n+# If OZONE_USE_CLIENT_CLASSLOADER is set, OZONE_CLASSPATH and\n+# OZONE_USER_CLASSPATH_FIRST are ignored.\n+# export OZONE_USE_CLIENT_CLASSLOADER=true\n+\n+###\n+# Options for remote shell connectivity\n+###\n+\n+# There are some optional components of hadoop that allow for", "originalCommit": "e54c4390bcc8374970baa120b6c6d9b5a375ff1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzExODE2Mw==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543118163", "bodyText": "Thanks.", "author": "adoroszlai", "createdAt": "2020-12-15T07:49:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyODQ2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyODUxNg==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543028516", "bodyText": "We should refer to Ozone roles here.", "author": "fapifta", "createdAt": "2020-12-15T04:01:22Z", "path": "hadoop-hdds/common/src/main/conf/ozone-env.sh", "diffHunk": "@@ -0,0 +1,280 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Set Ozone-specific environment variables here.\n+\n+# Enable core dump when crash in C++\n+ulimit -c unlimited\n+\n+# Many of the options here are built from the perspective that users\n+# may want to provide OVERWRITING values on the command line.\n+# For example:\n+#\n+#  JAVA_HOME=/usr/java/testing hdfs dfs -ls\n+#\n+# Therefore, the vast majority (BUT NOT ALL!) of these defaults\n+# are configured for substitution and not append.  If append\n+# is preferable, modify this file accordingly.\n+\n+###\n+# Generic settings\n+###\n+\n+# Technically, the only required environment variable is JAVA_HOME.\n+# All others are optional.  However, the defaults are probably not\n+# preferred.  Many sites configure these options outside of Ozone,\n+# such as in /etc/profile.d\n+\n+# The java implementation to use. By default, this environment\n+# variable is REQUIRED on ALL platforms except OS X!\n+# export JAVA_HOME=\n+\n+# Location of Ozone.  By default, Ozone will attempt to determine\n+# this location based upon its execution path.\n+# export OZONE_HOME=\n+\n+# Location of Ozone's configuration information.  i.e., where this\n+# file is living. If this is not defined, Ozone will attempt to\n+# locate it based upon its execution path.\n+#\n+# NOTE: It is recommend that this variable not be set here but in\n+# /etc/profile.d or equivalent.  Some options (such as\n+# --config) may react strangely otherwise.\n+#\n+# export OZONE_CONFIG_DIR=${OZONE_HOME}/etc/hadoop\n+\n+# The maximum amount of heap to use (Java -Xmx).  If no unit\n+# is provided, it will be converted to MB.  Daemons will\n+# prefer any Xmx setting in their respective _OPT variable.\n+# There is no default; the JVM will autoscale based upon machine\n+# memory size.\n+# export OZONE_HEAPSIZE_MAX=\n+\n+# The minimum amount of heap to use (Java -Xms).  If no unit\n+# is provided, it will be converted to MB.  Daemons will\n+# prefer any Xms setting in their respective _OPT variable.\n+# There is no default; the JVM will autoscale based upon machine\n+# memory size.\n+# export OZONE_HEAPSIZE_MIN=\n+\n+# Extra Java runtime options for all Ozone commands. We don't support\n+# IPv6 yet/still, so by default the preference is set to IPv4.\n+# export OZONE_OPTS=\"-Djava.net.preferIPv4Stack=true\"\n+# For Kerberos debugging, an extended option set logs more information\n+# export OZONE_OPTS=\"-Djava.net.preferIPv4Stack=true -Dsun.security.krb5.debug=true -Dsun.security.spnego.debug\"\n+\n+# Some parts of the shell code may do special things dependent upon\n+# the operating system.  We have to set this here. See the next\n+# section as to why....\n+export OZONE_OS_TYPE=${OZONE_OS_TYPE:-$(uname -s)}\n+\n+# Extra Java runtime options for some Ozone commands\n+# and clients (i.e., hdfs dfs -blah).  These get appended to OZONE_OPTS for\n+# such commands.  In most cases, # this should be left empty and\n+# let users supply it on the command line.\n+# export OZONE_CLIENT_OPTS=\"\"\n+\n+#\n+# A note about classpaths.\n+#\n+# By default, Apache Ozone overrides Java's CLASSPATH\n+# environment variable.  It is configured such\n+# that it starts out blank with new entries added after passing\n+# a series of checks (file/dir exists, not already listed aka\n+# de-deduplication).  During de-deduplication, wildcards and/or\n+# directories are *NOT* expanded to keep it simple. Therefore,\n+# if the computed classpath has two specific mentions of\n+# awesome-methods-1.0.jar, only the first one added will be seen.\n+# If two directories are in the classpath that both contain\n+# awesome-methods-1.0.jar, then Java will pick up both versions.\n+\n+# An additional, custom CLASSPATH. Site-wide configs should be\n+# handled via the shellprofile functionality, utilizing the\n+# ozone_add_classpath function for greater control and much\n+# harder for apps/end-users to accidentally override.\n+# Similarly, end users should utilize ${HOME}/.ozonerc .\n+# This variable should ideally only be used as a short-cut,\n+# interactive way for temporary additions on the command line.\n+# export OZONE_CLASSPATH=\"/some/cool/path/on/your/machine\"\n+\n+# Should OZONE_CLASSPATH be first in the official CLASSPATH?\n+# export OZONE_USER_CLASSPATH_FIRST=\"yes\"\n+\n+# If OZONE_USE_CLIENT_CLASSLOADER is set, OZONE_CLASSPATH and\n+# OZONE_USER_CLASSPATH_FIRST are ignored.\n+# export OZONE_USE_CLIENT_CLASSLOADER=true\n+\n+###\n+# Options for remote shell connectivity\n+###\n+\n+# There are some optional components of hadoop that allow for\n+# command and control of remote hosts.  For example,\n+# start-dfs.sh will attempt to bring up all NNs, DNS, etc.\n+\n+# Options to pass to SSH when one of the \"log into a host and\n+# start/stop daemons\" scripts is executed\n+# export OZONE_SSH_OPTS=\"-o BatchMode=yes -o StrictHostKeyChecking=no -o ConnectTimeout=10s\"\n+\n+# The built-in ssh handler will limit itself to 10 simultaneous connections.\n+# For pdsh users, this sets the fanout size ( -f )\n+# Change this to increase/decrease as necessary.\n+# export OZONE_SSH_PARALLEL=10\n+\n+# Filename which contains all of the hosts for any remote execution\n+# helper scripts # such as workers.sh, start-dfs.sh, etc.\n+# export OZONE_WORKERS=\"${OZONE_CONFIG_DIR}/workers\"\n+\n+###\n+# Options for all daemons\n+###\n+#\n+\n+#\n+# Many options may also be specified as Java properties.  It is\n+# very common, and in many cases, desirable, to hard-set these\n+# in daemon _OPTS variables.  Where applicable, the appropriate\n+# Java property is also identified.  Note that many are re-used\n+# or set differently in certain contexts (e.g., secure vs\n+# non-secure)\n+#\n+\n+# Where (primarily) daemon log files are stored.\n+# ${OZONE_HOME}/logs by default.\n+# Java property: hadoop.log.dir\n+# export OZONE_LOG_DIR=${OZONE_HOME}/logs\n+\n+# A string representing this instance of hadoop. $USER by default.\n+# This is used in writing log and pid files, so keep that in mind!\n+# Java property: hadoop.id.str\n+# export OZONE_IDENT_STRING=$USER\n+\n+# How many seconds to pause after stopping a daemon\n+# export OZONE_STOP_TIMEOUT=5\n+\n+# Where pid files are stored.  /tmp by default.\n+# export OZONE_PID_DIR=/tmp\n+\n+# Default log4j setting for interactive commands\n+# Java property: hadoop.root.logger\n+# export OZONE_ROOT_LOGGER=INFO,console\n+\n+# Default log4j setting for daemons spawned explicitly by\n+# --daemon option of hadoop, hdfs, mapred and yarn command.\n+# Java property: hadoop.root.logger\n+# export OZONE_DAEMON_ROOT_LOGGER=INFO,RFA\n+\n+# Default log level and output location for security-related messages.\n+# You will almost certainly want to change this on a per-daemon basis via\n+# the Java property (i.e., -Dhadoop.security.logger=foo). (Note that the\n+# defaults for the NN and 2NN override this by default.)", "originalCommit": "e54c4390bcc8374970baa120b6c6d9b5a375ff1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEyMDYyMw==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543120623", "bodyText": "Thanks.", "author": "adoroszlai", "createdAt": "2020-12-15T07:53:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyODUxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyODU1Nw==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543028557", "bodyText": "We should refer ozone-functions.sh here.", "author": "fapifta", "createdAt": "2020-12-15T04:01:27Z", "path": "hadoop-hdds/common/src/main/conf/ozone-env.sh", "diffHunk": "@@ -0,0 +1,280 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Set Ozone-specific environment variables here.\n+\n+# Enable core dump when crash in C++\n+ulimit -c unlimited\n+\n+# Many of the options here are built from the perspective that users\n+# may want to provide OVERWRITING values on the command line.\n+# For example:\n+#\n+#  JAVA_HOME=/usr/java/testing hdfs dfs -ls\n+#\n+# Therefore, the vast majority (BUT NOT ALL!) of these defaults\n+# are configured for substitution and not append.  If append\n+# is preferable, modify this file accordingly.\n+\n+###\n+# Generic settings\n+###\n+\n+# Technically, the only required environment variable is JAVA_HOME.\n+# All others are optional.  However, the defaults are probably not\n+# preferred.  Many sites configure these options outside of Ozone,\n+# such as in /etc/profile.d\n+\n+# The java implementation to use. By default, this environment\n+# variable is REQUIRED on ALL platforms except OS X!\n+# export JAVA_HOME=\n+\n+# Location of Ozone.  By default, Ozone will attempt to determine\n+# this location based upon its execution path.\n+# export OZONE_HOME=\n+\n+# Location of Ozone's configuration information.  i.e., where this\n+# file is living. If this is not defined, Ozone will attempt to\n+# locate it based upon its execution path.\n+#\n+# NOTE: It is recommend that this variable not be set here but in\n+# /etc/profile.d or equivalent.  Some options (such as\n+# --config) may react strangely otherwise.\n+#\n+# export OZONE_CONFIG_DIR=${OZONE_HOME}/etc/hadoop\n+\n+# The maximum amount of heap to use (Java -Xmx).  If no unit\n+# is provided, it will be converted to MB.  Daemons will\n+# prefer any Xmx setting in their respective _OPT variable.\n+# There is no default; the JVM will autoscale based upon machine\n+# memory size.\n+# export OZONE_HEAPSIZE_MAX=\n+\n+# The minimum amount of heap to use (Java -Xms).  If no unit\n+# is provided, it will be converted to MB.  Daemons will\n+# prefer any Xms setting in their respective _OPT variable.\n+# There is no default; the JVM will autoscale based upon machine\n+# memory size.\n+# export OZONE_HEAPSIZE_MIN=\n+\n+# Extra Java runtime options for all Ozone commands. We don't support\n+# IPv6 yet/still, so by default the preference is set to IPv4.\n+# export OZONE_OPTS=\"-Djava.net.preferIPv4Stack=true\"\n+# For Kerberos debugging, an extended option set logs more information\n+# export OZONE_OPTS=\"-Djava.net.preferIPv4Stack=true -Dsun.security.krb5.debug=true -Dsun.security.spnego.debug\"\n+\n+# Some parts of the shell code may do special things dependent upon\n+# the operating system.  We have to set this here. See the next\n+# section as to why....\n+export OZONE_OS_TYPE=${OZONE_OS_TYPE:-$(uname -s)}\n+\n+# Extra Java runtime options for some Ozone commands\n+# and clients (i.e., hdfs dfs -blah).  These get appended to OZONE_OPTS for\n+# such commands.  In most cases, # this should be left empty and\n+# let users supply it on the command line.\n+# export OZONE_CLIENT_OPTS=\"\"\n+\n+#\n+# A note about classpaths.\n+#\n+# By default, Apache Ozone overrides Java's CLASSPATH\n+# environment variable.  It is configured such\n+# that it starts out blank with new entries added after passing\n+# a series of checks (file/dir exists, not already listed aka\n+# de-deduplication).  During de-deduplication, wildcards and/or\n+# directories are *NOT* expanded to keep it simple. Therefore,\n+# if the computed classpath has two specific mentions of\n+# awesome-methods-1.0.jar, only the first one added will be seen.\n+# If two directories are in the classpath that both contain\n+# awesome-methods-1.0.jar, then Java will pick up both versions.\n+\n+# An additional, custom CLASSPATH. Site-wide configs should be\n+# handled via the shellprofile functionality, utilizing the\n+# ozone_add_classpath function for greater control and much\n+# harder for apps/end-users to accidentally override.\n+# Similarly, end users should utilize ${HOME}/.ozonerc .\n+# This variable should ideally only be used as a short-cut,\n+# interactive way for temporary additions on the command line.\n+# export OZONE_CLASSPATH=\"/some/cool/path/on/your/machine\"\n+\n+# Should OZONE_CLASSPATH be first in the official CLASSPATH?\n+# export OZONE_USER_CLASSPATH_FIRST=\"yes\"\n+\n+# If OZONE_USE_CLIENT_CLASSLOADER is set, OZONE_CLASSPATH and\n+# OZONE_USER_CLASSPATH_FIRST are ignored.\n+# export OZONE_USE_CLIENT_CLASSLOADER=true\n+\n+###\n+# Options for remote shell connectivity\n+###\n+\n+# There are some optional components of hadoop that allow for\n+# command and control of remote hosts.  For example,\n+# start-dfs.sh will attempt to bring up all NNs, DNS, etc.\n+\n+# Options to pass to SSH when one of the \"log into a host and\n+# start/stop daemons\" scripts is executed\n+# export OZONE_SSH_OPTS=\"-o BatchMode=yes -o StrictHostKeyChecking=no -o ConnectTimeout=10s\"\n+\n+# The built-in ssh handler will limit itself to 10 simultaneous connections.\n+# For pdsh users, this sets the fanout size ( -f )\n+# Change this to increase/decrease as necessary.\n+# export OZONE_SSH_PARALLEL=10\n+\n+# Filename which contains all of the hosts for any remote execution\n+# helper scripts # such as workers.sh, start-dfs.sh, etc.\n+# export OZONE_WORKERS=\"${OZONE_CONFIG_DIR}/workers\"\n+\n+###\n+# Options for all daemons\n+###\n+#\n+\n+#\n+# Many options may also be specified as Java properties.  It is\n+# very common, and in many cases, desirable, to hard-set these\n+# in daemon _OPTS variables.  Where applicable, the appropriate\n+# Java property is also identified.  Note that many are re-used\n+# or set differently in certain contexts (e.g., secure vs\n+# non-secure)\n+#\n+\n+# Where (primarily) daemon log files are stored.\n+# ${OZONE_HOME}/logs by default.\n+# Java property: hadoop.log.dir\n+# export OZONE_LOG_DIR=${OZONE_HOME}/logs\n+\n+# A string representing this instance of hadoop. $USER by default.\n+# This is used in writing log and pid files, so keep that in mind!\n+# Java property: hadoop.id.str\n+# export OZONE_IDENT_STRING=$USER\n+\n+# How many seconds to pause after stopping a daemon\n+# export OZONE_STOP_TIMEOUT=5\n+\n+# Where pid files are stored.  /tmp by default.\n+# export OZONE_PID_DIR=/tmp\n+\n+# Default log4j setting for interactive commands\n+# Java property: hadoop.root.logger\n+# export OZONE_ROOT_LOGGER=INFO,console\n+\n+# Default log4j setting for daemons spawned explicitly by\n+# --daemon option of hadoop, hdfs, mapred and yarn command.\n+# Java property: hadoop.root.logger\n+# export OZONE_DAEMON_ROOT_LOGGER=INFO,RFA\n+\n+# Default log level and output location for security-related messages.\n+# You will almost certainly want to change this on a per-daemon basis via\n+# the Java property (i.e., -Dhadoop.security.logger=foo). (Note that the\n+# defaults for the NN and 2NN override this by default.)\n+# Java property: hadoop.security.logger\n+# export OZONE_SECURITY_LOGGER=INFO,NullAppender\n+\n+# Default process priority level\n+# Note that sub-processes will also run at this level!\n+# export OZONE_NICENESS=0\n+\n+# Default name for the service level authorization file\n+# Java property: hadoop.policy.file\n+# export OZONE_POLICYFILE=\"hadoop-policy.xml\"\n+\n+#\n+# NOTE: this is not used by default!  <-----\n+# You can define variables right here and then re-use them later on.\n+# For example, it is common to use the same garbage collection settings\n+# for all the daemons.  So one could define:\n+#\n+# export OZONE_GC_SETTINGS=\"-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps\"\n+#\n+# .. and then use it as per the b option under the namenode.\n+\n+###\n+# Secure/privileged execution\n+###\n+\n+#\n+# Out of the box, Ozone uses jsvc from Apache Commons to launch daemons\n+# on privileged ports.  This functionality can be replaced by providing\n+# custom functions.  See hadoop-functions.sh for more information.", "originalCommit": "e54c4390bcc8374970baa120b6c6d9b5a375ff1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEyMDc2NA==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543120764", "bodyText": "Thanks.", "author": "adoroszlai", "createdAt": "2020-12-15T07:53:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyODU1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyODU4NQ==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543028585", "bodyText": "It is maybe out of scope for this PR, but shouldn't we have OZONE_RECON_OPTS, and OZONE_S3GW_OPTS similarly?", "author": "fapifta", "createdAt": "2020-12-15T04:01:34Z", "path": "hadoop-hdds/common/src/main/conf/ozone-env.sh", "diffHunk": "@@ -0,0 +1,280 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Set Ozone-specific environment variables here.\n+\n+# Enable core dump when crash in C++\n+ulimit -c unlimited\n+\n+# Many of the options here are built from the perspective that users\n+# may want to provide OVERWRITING values on the command line.\n+# For example:\n+#\n+#  JAVA_HOME=/usr/java/testing hdfs dfs -ls\n+#\n+# Therefore, the vast majority (BUT NOT ALL!) of these defaults\n+# are configured for substitution and not append.  If append\n+# is preferable, modify this file accordingly.\n+\n+###\n+# Generic settings\n+###\n+\n+# Technically, the only required environment variable is JAVA_HOME.\n+# All others are optional.  However, the defaults are probably not\n+# preferred.  Many sites configure these options outside of Ozone,\n+# such as in /etc/profile.d\n+\n+# The java implementation to use. By default, this environment\n+# variable is REQUIRED on ALL platforms except OS X!\n+# export JAVA_HOME=\n+\n+# Location of Ozone.  By default, Ozone will attempt to determine\n+# this location based upon its execution path.\n+# export OZONE_HOME=\n+\n+# Location of Ozone's configuration information.  i.e., where this\n+# file is living. If this is not defined, Ozone will attempt to\n+# locate it based upon its execution path.\n+#\n+# NOTE: It is recommend that this variable not be set here but in\n+# /etc/profile.d or equivalent.  Some options (such as\n+# --config) may react strangely otherwise.\n+#\n+# export OZONE_CONFIG_DIR=${OZONE_HOME}/etc/hadoop\n+\n+# The maximum amount of heap to use (Java -Xmx).  If no unit\n+# is provided, it will be converted to MB.  Daemons will\n+# prefer any Xmx setting in their respective _OPT variable.\n+# There is no default; the JVM will autoscale based upon machine\n+# memory size.\n+# export OZONE_HEAPSIZE_MAX=\n+\n+# The minimum amount of heap to use (Java -Xms).  If no unit\n+# is provided, it will be converted to MB.  Daemons will\n+# prefer any Xms setting in their respective _OPT variable.\n+# There is no default; the JVM will autoscale based upon machine\n+# memory size.\n+# export OZONE_HEAPSIZE_MIN=\n+\n+# Extra Java runtime options for all Ozone commands. We don't support\n+# IPv6 yet/still, so by default the preference is set to IPv4.\n+# export OZONE_OPTS=\"-Djava.net.preferIPv4Stack=true\"\n+# For Kerberos debugging, an extended option set logs more information\n+# export OZONE_OPTS=\"-Djava.net.preferIPv4Stack=true -Dsun.security.krb5.debug=true -Dsun.security.spnego.debug\"\n+\n+# Some parts of the shell code may do special things dependent upon\n+# the operating system.  We have to set this here. See the next\n+# section as to why....\n+export OZONE_OS_TYPE=${OZONE_OS_TYPE:-$(uname -s)}\n+\n+# Extra Java runtime options for some Ozone commands\n+# and clients (i.e., hdfs dfs -blah).  These get appended to OZONE_OPTS for\n+# such commands.  In most cases, # this should be left empty and\n+# let users supply it on the command line.\n+# export OZONE_CLIENT_OPTS=\"\"\n+\n+#\n+# A note about classpaths.\n+#\n+# By default, Apache Ozone overrides Java's CLASSPATH\n+# environment variable.  It is configured such\n+# that it starts out blank with new entries added after passing\n+# a series of checks (file/dir exists, not already listed aka\n+# de-deduplication).  During de-deduplication, wildcards and/or\n+# directories are *NOT* expanded to keep it simple. Therefore,\n+# if the computed classpath has two specific mentions of\n+# awesome-methods-1.0.jar, only the first one added will be seen.\n+# If two directories are in the classpath that both contain\n+# awesome-methods-1.0.jar, then Java will pick up both versions.\n+\n+# An additional, custom CLASSPATH. Site-wide configs should be\n+# handled via the shellprofile functionality, utilizing the\n+# ozone_add_classpath function for greater control and much\n+# harder for apps/end-users to accidentally override.\n+# Similarly, end users should utilize ${HOME}/.ozonerc .\n+# This variable should ideally only be used as a short-cut,\n+# interactive way for temporary additions on the command line.\n+# export OZONE_CLASSPATH=\"/some/cool/path/on/your/machine\"\n+\n+# Should OZONE_CLASSPATH be first in the official CLASSPATH?\n+# export OZONE_USER_CLASSPATH_FIRST=\"yes\"\n+\n+# If OZONE_USE_CLIENT_CLASSLOADER is set, OZONE_CLASSPATH and\n+# OZONE_USER_CLASSPATH_FIRST are ignored.\n+# export OZONE_USE_CLIENT_CLASSLOADER=true\n+\n+###\n+# Options for remote shell connectivity\n+###\n+\n+# There are some optional components of hadoop that allow for\n+# command and control of remote hosts.  For example,\n+# start-dfs.sh will attempt to bring up all NNs, DNS, etc.\n+\n+# Options to pass to SSH when one of the \"log into a host and\n+# start/stop daemons\" scripts is executed\n+# export OZONE_SSH_OPTS=\"-o BatchMode=yes -o StrictHostKeyChecking=no -o ConnectTimeout=10s\"\n+\n+# The built-in ssh handler will limit itself to 10 simultaneous connections.\n+# For pdsh users, this sets the fanout size ( -f )\n+# Change this to increase/decrease as necessary.\n+# export OZONE_SSH_PARALLEL=10\n+\n+# Filename which contains all of the hosts for any remote execution\n+# helper scripts # such as workers.sh, start-dfs.sh, etc.\n+# export OZONE_WORKERS=\"${OZONE_CONFIG_DIR}/workers\"\n+\n+###\n+# Options for all daemons\n+###\n+#\n+\n+#\n+# Many options may also be specified as Java properties.  It is\n+# very common, and in many cases, desirable, to hard-set these\n+# in daemon _OPTS variables.  Where applicable, the appropriate\n+# Java property is also identified.  Note that many are re-used\n+# or set differently in certain contexts (e.g., secure vs\n+# non-secure)\n+#\n+\n+# Where (primarily) daemon log files are stored.\n+# ${OZONE_HOME}/logs by default.\n+# Java property: hadoop.log.dir\n+# export OZONE_LOG_DIR=${OZONE_HOME}/logs\n+\n+# A string representing this instance of hadoop. $USER by default.\n+# This is used in writing log and pid files, so keep that in mind!\n+# Java property: hadoop.id.str\n+# export OZONE_IDENT_STRING=$USER\n+\n+# How many seconds to pause after stopping a daemon\n+# export OZONE_STOP_TIMEOUT=5\n+\n+# Where pid files are stored.  /tmp by default.\n+# export OZONE_PID_DIR=/tmp\n+\n+# Default log4j setting for interactive commands\n+# Java property: hadoop.root.logger\n+# export OZONE_ROOT_LOGGER=INFO,console\n+\n+# Default log4j setting for daemons spawned explicitly by\n+# --daemon option of hadoop, hdfs, mapred and yarn command.\n+# Java property: hadoop.root.logger\n+# export OZONE_DAEMON_ROOT_LOGGER=INFO,RFA\n+\n+# Default log level and output location for security-related messages.\n+# You will almost certainly want to change this on a per-daemon basis via\n+# the Java property (i.e., -Dhadoop.security.logger=foo). (Note that the\n+# defaults for the NN and 2NN override this by default.)\n+# Java property: hadoop.security.logger\n+# export OZONE_SECURITY_LOGGER=INFO,NullAppender\n+\n+# Default process priority level\n+# Note that sub-processes will also run at this level!\n+# export OZONE_NICENESS=0\n+\n+# Default name for the service level authorization file\n+# Java property: hadoop.policy.file\n+# export OZONE_POLICYFILE=\"hadoop-policy.xml\"\n+\n+#\n+# NOTE: this is not used by default!  <-----\n+# You can define variables right here and then re-use them later on.\n+# For example, it is common to use the same garbage collection settings\n+# for all the daemons.  So one could define:\n+#\n+# export OZONE_GC_SETTINGS=\"-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps\"\n+#\n+# .. and then use it as per the b option under the namenode.\n+\n+###\n+# Secure/privileged execution\n+###\n+\n+#\n+# Out of the box, Ozone uses jsvc from Apache Commons to launch daemons\n+# on privileged ports.  This functionality can be replaced by providing\n+# custom functions.  See hadoop-functions.sh for more information.\n+#\n+\n+# The jsvc implementation to use. Jsvc is required to run secure datanodes\n+# that bind to privileged ports to provide authentication of data transfer\n+# protocol.  Jsvc is not required if SASL is configured for authentication of\n+# data transfer protocol using non-privileged ports.\n+# export JSVC_HOME=/usr/bin\n+\n+#\n+# This directory contains pids for secure and privileged processes.\n+#export OZONE_SECURE_PID_DIR=${OZONE_PID_DIR}\n+\n+#\n+# This directory contains the logs for secure and privileged processes.\n+# Java property: hadoop.log.dir\n+# export OZONE_SECURE_LOG=${OZONE_LOG_DIR}\n+\n+#\n+# When running a secure daemon, the default value of OZONE_IDENT_STRING\n+# ends up being a bit bogus.  Therefore, by default, the code will\n+# replace OZONE_IDENT_STRING with OZONE_xx_SECURE_USER.  If one wants\n+# to keep OZONE_IDENT_STRING untouched, then uncomment this line.\n+# export OZONE_SECURE_IDENT_PRESERVE=\"true\"\n+\n+###\n+# Ozone Manager specific parameters\n+###\n+# Specify the JVM options to be used when starting the Ozone Manager.\n+# These options will be appended to the options specified as OZONE_OPTS\n+# and therefore may override any similar flags set in OZONE_OPTS\n+#\n+# export OZONE_OM_OPTS=\"\"\n+\n+###\n+# Ozone DataNode specific parameters\n+###\n+# Specify the JVM options to be used when starting Ozone DataNodes.\n+# These options will be appended to the options specified as OZONE_OPTS\n+# and therefore may override any similar flags set in OZONE_OPTS\n+#\n+# export OZONE_DATANODE_OPTS=\"\"\n+\n+###\n+# HDFS StorageContainerManager specific parameters\n+###\n+# Specify the JVM options to be used when starting the HDFS Storage Container Manager.\n+# These options will be appended to the options specified as OZONE_OPTS\n+# and therefore may override any similar flags set in OZONE_OPTS\n+#\n+# export OZONE_SCM_OPTS=\"\"\n+", "originalCommit": "e54c4390bcc8374970baa120b6c6d9b5a375ff1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEyMDkwMg==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543120902", "bodyText": "Agree, out of scope. ;)", "author": "adoroszlai", "createdAt": "2020-12-15T07:53:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyODU4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyODY2MA==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543028660", "bodyText": "Does this remain here on purpose?", "author": "fapifta", "createdAt": "2020-12-15T04:01:44Z", "path": "hadoop-hdds/common/src/main/conf/ozone-env.sh", "diffHunk": "@@ -0,0 +1,280 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Set Ozone-specific environment variables here.\n+\n+# Enable core dump when crash in C++\n+ulimit -c unlimited\n+\n+# Many of the options here are built from the perspective that users\n+# may want to provide OVERWRITING values on the command line.\n+# For example:\n+#\n+#  JAVA_HOME=/usr/java/testing hdfs dfs -ls\n+#\n+# Therefore, the vast majority (BUT NOT ALL!) of these defaults\n+# are configured for substitution and not append.  If append\n+# is preferable, modify this file accordingly.\n+\n+###\n+# Generic settings\n+###\n+\n+# Technically, the only required environment variable is JAVA_HOME.\n+# All others are optional.  However, the defaults are probably not\n+# preferred.  Many sites configure these options outside of Ozone,\n+# such as in /etc/profile.d\n+\n+# The java implementation to use. By default, this environment\n+# variable is REQUIRED on ALL platforms except OS X!\n+# export JAVA_HOME=\n+\n+# Location of Ozone.  By default, Ozone will attempt to determine\n+# this location based upon its execution path.\n+# export OZONE_HOME=\n+\n+# Location of Ozone's configuration information.  i.e., where this\n+# file is living. If this is not defined, Ozone will attempt to\n+# locate it based upon its execution path.\n+#\n+# NOTE: It is recommend that this variable not be set here but in\n+# /etc/profile.d or equivalent.  Some options (such as\n+# --config) may react strangely otherwise.\n+#\n+# export OZONE_CONFIG_DIR=${OZONE_HOME}/etc/hadoop\n+\n+# The maximum amount of heap to use (Java -Xmx).  If no unit\n+# is provided, it will be converted to MB.  Daemons will\n+# prefer any Xmx setting in their respective _OPT variable.\n+# There is no default; the JVM will autoscale based upon machine\n+# memory size.\n+# export OZONE_HEAPSIZE_MAX=\n+\n+# The minimum amount of heap to use (Java -Xms).  If no unit\n+# is provided, it will be converted to MB.  Daemons will\n+# prefer any Xms setting in their respective _OPT variable.\n+# There is no default; the JVM will autoscale based upon machine\n+# memory size.\n+# export OZONE_HEAPSIZE_MIN=\n+\n+# Extra Java runtime options for all Ozone commands. We don't support\n+# IPv6 yet/still, so by default the preference is set to IPv4.\n+# export OZONE_OPTS=\"-Djava.net.preferIPv4Stack=true\"\n+# For Kerberos debugging, an extended option set logs more information\n+# export OZONE_OPTS=\"-Djava.net.preferIPv4Stack=true -Dsun.security.krb5.debug=true -Dsun.security.spnego.debug\"\n+\n+# Some parts of the shell code may do special things dependent upon\n+# the operating system.  We have to set this here. See the next\n+# section as to why....\n+export OZONE_OS_TYPE=${OZONE_OS_TYPE:-$(uname -s)}\n+\n+# Extra Java runtime options for some Ozone commands\n+# and clients (i.e., hdfs dfs -blah).  These get appended to OZONE_OPTS for\n+# such commands.  In most cases, # this should be left empty and\n+# let users supply it on the command line.\n+# export OZONE_CLIENT_OPTS=\"\"\n+\n+#\n+# A note about classpaths.\n+#\n+# By default, Apache Ozone overrides Java's CLASSPATH\n+# environment variable.  It is configured such\n+# that it starts out blank with new entries added after passing\n+# a series of checks (file/dir exists, not already listed aka\n+# de-deduplication).  During de-deduplication, wildcards and/or\n+# directories are *NOT* expanded to keep it simple. Therefore,\n+# if the computed classpath has two specific mentions of\n+# awesome-methods-1.0.jar, only the first one added will be seen.\n+# If two directories are in the classpath that both contain\n+# awesome-methods-1.0.jar, then Java will pick up both versions.\n+\n+# An additional, custom CLASSPATH. Site-wide configs should be\n+# handled via the shellprofile functionality, utilizing the\n+# ozone_add_classpath function for greater control and much\n+# harder for apps/end-users to accidentally override.\n+# Similarly, end users should utilize ${HOME}/.ozonerc .\n+# This variable should ideally only be used as a short-cut,\n+# interactive way for temporary additions on the command line.\n+# export OZONE_CLASSPATH=\"/some/cool/path/on/your/machine\"\n+\n+# Should OZONE_CLASSPATH be first in the official CLASSPATH?\n+# export OZONE_USER_CLASSPATH_FIRST=\"yes\"\n+\n+# If OZONE_USE_CLIENT_CLASSLOADER is set, OZONE_CLASSPATH and\n+# OZONE_USER_CLASSPATH_FIRST are ignored.\n+# export OZONE_USE_CLIENT_CLASSLOADER=true\n+\n+###\n+# Options for remote shell connectivity\n+###\n+\n+# There are some optional components of hadoop that allow for\n+# command and control of remote hosts.  For example,\n+# start-dfs.sh will attempt to bring up all NNs, DNS, etc.\n+\n+# Options to pass to SSH when one of the \"log into a host and\n+# start/stop daemons\" scripts is executed\n+# export OZONE_SSH_OPTS=\"-o BatchMode=yes -o StrictHostKeyChecking=no -o ConnectTimeout=10s\"\n+\n+# The built-in ssh handler will limit itself to 10 simultaneous connections.\n+# For pdsh users, this sets the fanout size ( -f )\n+# Change this to increase/decrease as necessary.\n+# export OZONE_SSH_PARALLEL=10\n+\n+# Filename which contains all of the hosts for any remote execution\n+# helper scripts # such as workers.sh, start-dfs.sh, etc.\n+# export OZONE_WORKERS=\"${OZONE_CONFIG_DIR}/workers\"\n+\n+###\n+# Options for all daemons\n+###\n+#\n+\n+#\n+# Many options may also be specified as Java properties.  It is\n+# very common, and in many cases, desirable, to hard-set these\n+# in daemon _OPTS variables.  Where applicable, the appropriate\n+# Java property is also identified.  Note that many are re-used\n+# or set differently in certain contexts (e.g., secure vs\n+# non-secure)\n+#\n+\n+# Where (primarily) daemon log files are stored.\n+# ${OZONE_HOME}/logs by default.\n+# Java property: hadoop.log.dir\n+# export OZONE_LOG_DIR=${OZONE_HOME}/logs\n+\n+# A string representing this instance of hadoop. $USER by default.\n+# This is used in writing log and pid files, so keep that in mind!\n+# Java property: hadoop.id.str\n+# export OZONE_IDENT_STRING=$USER\n+\n+# How many seconds to pause after stopping a daemon\n+# export OZONE_STOP_TIMEOUT=5\n+\n+# Where pid files are stored.  /tmp by default.\n+# export OZONE_PID_DIR=/tmp\n+\n+# Default log4j setting for interactive commands\n+# Java property: hadoop.root.logger\n+# export OZONE_ROOT_LOGGER=INFO,console\n+\n+# Default log4j setting for daemons spawned explicitly by\n+# --daemon option of hadoop, hdfs, mapred and yarn command.\n+# Java property: hadoop.root.logger\n+# export OZONE_DAEMON_ROOT_LOGGER=INFO,RFA\n+\n+# Default log level and output location for security-related messages.\n+# You will almost certainly want to change this on a per-daemon basis via\n+# the Java property (i.e., -Dhadoop.security.logger=foo). (Note that the\n+# defaults for the NN and 2NN override this by default.)\n+# Java property: hadoop.security.logger\n+# export OZONE_SECURITY_LOGGER=INFO,NullAppender\n+\n+# Default process priority level\n+# Note that sub-processes will also run at this level!\n+# export OZONE_NICENESS=0\n+\n+# Default name for the service level authorization file\n+# Java property: hadoop.policy.file\n+# export OZONE_POLICYFILE=\"hadoop-policy.xml\"\n+\n+#\n+# NOTE: this is not used by default!  <-----\n+# You can define variables right here and then re-use them later on.\n+# For example, it is common to use the same garbage collection settings\n+# for all the daemons.  So one could define:\n+#\n+# export OZONE_GC_SETTINGS=\"-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps\"\n+#\n+# .. and then use it as per the b option under the namenode.\n+\n+###\n+# Secure/privileged execution\n+###\n+\n+#\n+# Out of the box, Ozone uses jsvc from Apache Commons to launch daemons\n+# on privileged ports.  This functionality can be replaced by providing\n+# custom functions.  See hadoop-functions.sh for more information.\n+#\n+\n+# The jsvc implementation to use. Jsvc is required to run secure datanodes\n+# that bind to privileged ports to provide authentication of data transfer\n+# protocol.  Jsvc is not required if SASL is configured for authentication of\n+# data transfer protocol using non-privileged ports.\n+# export JSVC_HOME=/usr/bin\n+\n+#\n+# This directory contains pids for secure and privileged processes.\n+#export OZONE_SECURE_PID_DIR=${OZONE_PID_DIR}\n+\n+#\n+# This directory contains the logs for secure and privileged processes.\n+# Java property: hadoop.log.dir\n+# export OZONE_SECURE_LOG=${OZONE_LOG_DIR}\n+\n+#\n+# When running a secure daemon, the default value of OZONE_IDENT_STRING\n+# ends up being a bit bogus.  Therefore, by default, the code will\n+# replace OZONE_IDENT_STRING with OZONE_xx_SECURE_USER.  If one wants\n+# to keep OZONE_IDENT_STRING untouched, then uncomment this line.\n+# export OZONE_SECURE_IDENT_PRESERVE=\"true\"\n+\n+###\n+# Ozone Manager specific parameters\n+###\n+# Specify the JVM options to be used when starting the Ozone Manager.\n+# These options will be appended to the options specified as OZONE_OPTS\n+# and therefore may override any similar flags set in OZONE_OPTS\n+#\n+# export OZONE_OM_OPTS=\"\"\n+\n+###\n+# Ozone DataNode specific parameters\n+###\n+# Specify the JVM options to be used when starting Ozone DataNodes.\n+# These options will be appended to the options specified as OZONE_OPTS\n+# and therefore may override any similar flags set in OZONE_OPTS\n+#\n+# export OZONE_DATANODE_OPTS=\"\"\n+\n+###\n+# HDFS StorageContainerManager specific parameters\n+###\n+# Specify the JVM options to be used when starting the HDFS Storage Container Manager.\n+# These options will be appended to the options specified as OZONE_OPTS\n+# and therefore may override any similar flags set in OZONE_OPTS\n+#\n+# export OZONE_SCM_OPTS=\"\"\n+\n+###\n+# Advanced Users Only!\n+###\n+\n+#\n+# When building Ozone, one can add the class paths to the commands\n+# via this special env var:\n+# export OZONE_ENABLE_BUILD_PATHS=\"true\"\n+\n+#\n+# To prevent accidents, shell commands be (superficially) locked\n+# to only allow certain users to execute certain subcommands.\n+# It uses the format of (command)_(subcommand)_USER.\n+#\n+# For example, to limit who can execute the namenode command,\n+# export HDFS_NAMENODE_USER=hdfs", "originalCommit": "e54c4390bcc8374970baa120b6c6d9b5a375ff1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEyMTAxNQ==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543121015", "bodyText": "No, thanks.", "author": "adoroszlai", "createdAt": "2020-12-15T07:54:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyODY2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyODY5OA==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543028698", "bodyText": "We duplicate this if statement here, first to write a debug level log message second to return null, can we pull the two together, and also change the log message here, and state the reason why we fail by saying something like:\nCONFIG_DIR + \" variable is empty, please make sure it is setup correctly!\"", "author": "fapifta", "createdAt": "2020-12-15T04:01:52Z", "path": "hadoop-hdds/framework/src/main/java/org/apache/hadoop/hdds/utils/db/DBConfigFromFile.java", "diffHunk": "@@ -65,7 +65,7 @@ public static File getConfigLocation() throws IOException {\n \n     if (StringUtil.isBlank(path)) {", "originalCommit": "e54c4390bcc8374970baa120b6c6d9b5a375ff1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEyMTMwNw==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543121307", "bodyText": "Not introduced by this change, but thanks for pointing out, let's fix it anyway.", "author": "adoroszlai", "createdAt": "2020-12-15T07:54:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyODY5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyODcyMw==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543028723", "bodyText": "For all these replacements, shouldn't we still provide ${OZONE_OPTS} to the environment as we did with HADOOP_OPTS before? We specify the coverage related options via this variable in test_all.sh for example.", "author": "fapifta", "createdAt": "2020-12-15T04:02:01Z", "path": "hadoop-ozone/dist/src/main/compose/ozone-csi/docker-compose.yaml", "diffHunk": "@@ -24,7 +24,7 @@ services:\n     env_file:\n       - docker-config\n     environment:\n-      HADOOP_OPTS: ${HADOOP_OPTS}\n+      OZONE_OPTS:", "originalCommit": "e54c4390bcc8374970baa120b6c6d9b5a375ff1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA4MTIyNw==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543081227", "bodyText": "Environment variables with only a key are resolved to their values on the machine Compose is running on\n\nhttps://docs.docker.com/compose/compose-file/#environment\nSo repeating the variable name is unnecessary.", "author": "adoroszlai", "createdAt": "2020-12-15T06:31:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyODcyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ3NTQ4NQ==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r544475485", "bodyText": "neat!", "author": "smengcl", "createdAt": "2020-12-16T17:13:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyODcyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyODc3NQ==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543028775", "bodyText": "Shouldn't we rename this envvar also to OZONE_OM_OPTS?", "author": "fapifta", "createdAt": "2020-12-15T04:02:11Z", "path": "hadoop-ozone/dist/src/main/smoketest/compatibility/om.robot", "diffHunk": "@@ -0,0 +1,27 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+*** Settings ***\n+Documentation       Test om compatibility\n+Library             BuiltIn\n+Resource            ../lib/os.robot\n+Test Timeout        5 minutes\n+\n+*** Test Cases ***\n+Picks up command line options\n+    Pass Execution If    '%{HDFS_OM_OPTS}' == ''    Command-line option required for process check", "originalCommit": "e54c4390bcc8374970baa120b6c6d9b5a375ff1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA3ODk1OQ==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543078959", "bodyText": "No, these tests intentionaly use old names to verify compatibility with old scripts.  Some of the variables (eg. HDFS_OM_OPTS and HDFS_STORAGECONTAINERMANAGER_OPTS) were already deprecated before this change, but I changed the function that deprecates them.\n\n  \n    \n      ozone/hadoop-ozone/dist/src/shell/ozone/ozone\n    \n    \n         Line 160\n      in\n      dfd2aaf\n    \n    \n    \n    \n\n        \n          \n           hadoop_deprecate_envvar HDFS_OM_OPTS OZONE_OM_OPTS", "author": "adoroszlai", "createdAt": "2020-12-15T06:26:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyODc3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyODg4MQ==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543028881", "bodyText": "Should we rename this envvar also to OZONE_SCM_OPTS or OZONE_STORAGECONTAINERMANAGER_OPTS?", "author": "fapifta", "createdAt": "2020-12-15T04:02:18Z", "path": "hadoop-ozone/dist/src/main/smoketest/compatibility/scm.robot", "diffHunk": "@@ -0,0 +1,27 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+*** Settings ***\n+Documentation       Test scm compatibility\n+Library             BuiltIn\n+Resource            ../lib/os.robot\n+Test Timeout        5 minutes\n+\n+*** Test Cases ***\n+Picks up command line options\n+    Pass Execution If    '%{HDFS_STORAGECONTAINERMANAGER_OPTS}' == ''    Command-line option required for process check", "originalCommit": "e54c4390bcc8374970baa120b6c6d9b5a375ff1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA3OTE5Mw==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543079193", "bodyText": "Same as above.", "author": "adoroszlai", "createdAt": "2020-12-15T06:26:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyODg4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyOTAwMA==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543029000", "bodyText": "This seems to be a strange one here...\nSo in line 45 if ozone_bootstrap is not declared, we error out because ozone-functions.sh could not be loaded.\nAs I understand here we check for the exit status of ozone_bootstrap function, and if it is false we exit because we can not find ozone-config.sh. Why we need this second check? As I see the ozone_bootstrap function is not doing anything that should fail, but maybe my eye slipped through something.\nThis same we do in hadoop-ozone/dist/src/shell/ozone/ozone, in hadoop-ozone/dist/src/shell/ozone/start-ozone.sh and in hadoop-ozone/dist/src/shell/ozone/stop-ozone.sh files as well", "author": "fapifta", "createdAt": "2020-12-15T04:02:43Z", "path": "hadoop-ozone/dist/src/shell/hdds/workers.sh", "diffHunk": "@@ -20,40 +20,43 @@\n #\n # Environment Variables\n #\n-#   HADOOP_WORKERS    File naming remote hosts.\n-#     Default is ${HADOOP_CONF_DIR}/workers.\n-#   HADOOP_CONF_DIR  Alternate conf dir. Default is ${HADOOP_HOME}/conf.\n-#   HADOOP_WORKER_SLEEP Seconds to sleep between spawning remote commands.\n-#   HADOOP_SSH_OPTS Options passed to ssh when running remote commands.\n+#   OZONE_WORKERS    File naming remote hosts.\n+#     Default is ${OZONE_CONFIG_DIR}/workers.\n+#   OZONE_CONFIG_DIR  Alternate conf dir. Default is ${OZONE_HOME}/conf.\n+#   OZONE_WORKER_SLEEP Seconds to sleep between spawning remote commands.\n+#   OZONE_SSH_OPTS Options passed to ssh when running remote commands.\n ##\n \n-function hadoop_usage\n+function ozone_usage\n {\n   echo \"Usage: workers.sh [--config confdir] command...\"\n }\n \n-# let's locate libexec...\n-if [[ -n \"${HADOOP_HOME}\" ]]; then\n-  HADOOP_DEFAULT_LIBEXEC_DIR=\"${HADOOP_HOME}/libexec\"\n-else\n-  this=\"${BASH_SOURCE-$0}\"\n-  bin=$(cd -P -- \"$(dirname -- \"${this}\")\" >/dev/null && pwd -P)\n-  HADOOP_DEFAULT_LIBEXEC_DIR=\"${bin}/../libexec\"\n+# load functions\n+for dir in \"${OZONE_LIBEXEC_DIR}\" \"${OZONE_HOME}/libexec\" \"${HADOOP_LIBEXEC_DIR}\" \"${HADOOP_HOME}/libexec\" \"${bin}/../libexec\"; do\n+  if [[ -e \"${dir}/ozone-functions.sh\" ]]; then\n+    . \"${dir}/ozone-functions.sh\"\n+    if declare -F ozone_bootstrap >& /dev/null; then\n+      break\n+    fi\n+  fi\n+done\n+\n+if ! declare -F ozone_bootstrap >& /dev/null; then\n+  echo \"ERROR: Cannot find ozone-functions.sh.\" 2>&1\n+  exit 1\n fi\n \n-HADOOP_LIBEXEC_DIR=\"${HADOOP_LIBEXEC_DIR:-$HADOOP_DEFAULT_LIBEXEC_DIR}\"\n-# shellcheck disable=SC2034\n-HADOOP_NEW_CONFIG=true\n-if [[ -f \"${HADOOP_LIBEXEC_DIR}/hadoop-config.sh\" ]]; then\n-  . \"${HADOOP_LIBEXEC_DIR}/hadoop-config.sh\"\n-else\n-  echo \"ERROR: Cannot execute ${HADOOP_LIBEXEC_DIR}/hadoop-config.sh.\" 2>&1\n+if ! ozone_bootstrap; then", "originalCommit": "e54c4390bcc8374970baa120b6c6d9b5a375ff1d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyOTY1NA==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543029654", "bodyText": "Is this changed intentionally from accumulation to a set? Probably, but I wanted to be sure, and even so if this is the first place where we can safely set if this runs in just a pure context, this variable may have an initial value in some workflow which makes it worth to preserve the external value even at the first assignment?", "author": "fapifta", "createdAt": "2020-12-15T04:04:44Z", "path": "hadoop-ozone/dist/src/shell/ozone/start-ozone.sh", "diffHunk": "@@ -64,68 +63,53 @@ if [[ $# -ge 1 ]]; then\n       dataStartOpt=\"$startOpt\"\n     ;;\n     *)\n-      hadoop_exit_with_usage 1\n+      ozone_exit_with_usage 1\n     ;;\n   esac\n fi\n \n #Add other possible options\n nameStartOpt=\"$nameStartOpt $*\"\n \n-SECURITY_ENABLED=$(\"${HADOOP_HDFS_HOME}/bin/ozone\" getconf -confKey hadoop.security.authentication | tr '[:upper:]' '[:lower:]' 2>&-)\n-SECURITY_AUTHORIZATION_ENABLED=$(\"${HADOOP_HDFS_HOME}/bin/ozone\" getconf -confKey hadoop.security.authorization | tr '[:upper:]' '[:lower:]' 2>&-)\n-\n-#if [[ ${SECURITY_ENABLED} == \"kerberos\" || ${SECURITY_AUTHORIZATION_ENABLED}\n-# == \"true\" ]]; then\n-#  echo \"Ozone is not supported in a security enabled cluster.\"\n-#  exit 1\n-#fi\n-\n-#SECURITY_ENABLED=$(\"${HADOOP_HDFS_HOME}/bin/ozone\" getozoneconf -confKey hadoop.security.authentication | tr '[:upper:]' '[:lower:]' 2>&-)\n-#SECURITY_AUTHORIZATION_ENABLED=$(\"${HADOOP_HDFS_HOME}/bin/ozone\" getozoneconf -confKey hadoop.security.authorization | tr '[:upper:]' '[:lower:]' 2>&-)\n-#if [[ ${SECURITY_ENABLED} == \"kerberos\" || ${SECURITY_AUTHORIZATION_ENABLED} == \"true\" ]]; then\n-#  echo \"Ozone is not supported in a security enabled cluster.\"\n-#  exit 1\n-#fi\n+SECURITY_ENABLED=$(\"${OZONE_HOME}/bin/ozone\" getconf -confKey hadoop.security.authentication | tr '[:upper:]' '[:lower:]' 2>&-)\n+SECURITY_AUTHORIZATION_ENABLED=$(\"${OZONE_HOME}/bin/ozone\" getconf -confKey hadoop.security.authorization | tr '[:upper:]' '[:lower:]' 2>&-)\n \n # datanodes (using default workers file)\n \n echo \"Starting datanodes\"\n-hadoop_uservar_su hdfs datanode \"${HADOOP_HDFS_HOME}/bin/ozone\" \\\n+ozone_uservar_su hdfs datanode \"${OZONE_HOME}/bin/ozone\" \\\n     --workers \\\n-    --config \"${HADOOP_CONF_DIR}\" \\\n+    --config \"${OZONE_CONFIG_DIR}\" \\\n     --daemon start \\\n     datanode ${dataStartOpt}\n-(( HADOOP_JUMBO_RETCOUNTER=HADOOP_JUMBO_RETCOUNTER + $? ))\n+OZONE_JUMBO_RETCOUNTER=$?", "originalCommit": "e54c4390bcc8374970baa120b6c6d9b5a375ff1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA2MTI1Ng==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r543061256", "bodyText": "Yes, this is intentional, please see item 4 in PR description:\n\nit was incremented for the first and third commands and unconditionally set for the second one, so the result of the first command was lost.  It should be set for the first one instead.", "author": "adoroszlai", "createdAt": "2020-12-15T05:39:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyOTY1NA=="}], "type": "inlineReview"}, {"oid": "aab17a2ad1eb1a94acd843520da14337b8b3d664", "url": "https://github.com/apache/ozone/commit/aab17a2ad1eb1a94acd843520da14337b8b3d664", "message": "Remove duplicate `if`", "committedDate": "2020-12-15T06:34:24Z", "type": "commit"}, {"oid": "f12aca5019391deb746cdff09734d98366406c5a", "url": "https://github.com/apache/ozone/commit/f12aca5019391deb746cdff09734d98366406c5a", "message": "Some leftover references to Hadoop stuff in comments", "committedDate": "2020-12-15T07:56:18Z", "type": "commit"}, {"oid": "9719e2b1539e767ce586be9bc2d2f555c3357140", "url": "https://github.com/apache/ozone/commit/9719e2b1539e767ce586be9bc2d2f555c3357140", "message": "Remove some leftover HDFS/YARN/MAPRED variables", "committedDate": "2020-12-15T07:56:18Z", "type": "commit"}, {"oid": "476cdd2e9e6c8e3b084f910359809dd30091304b", "url": "https://github.com/apache/ozone/commit/476cdd2e9e6c8e3b084f910359809dd30091304b", "message": "Rename HDFS_OM_SH_OPTS to OZONE_SH_OPTS", "committedDate": "2020-12-15T07:56:18Z", "type": "commit"}, {"oid": "a992588bf942f8f93fd7e1efebbbaa1d8b877120", "url": "https://github.com/apache/ozone/commit/a992588bf942f8f93fd7e1efebbbaa1d8b877120", "message": "Remove HDFS_SCM_CLI_OPTS from `ozone insight`\n\nUsage of this variable was introduced as leftover from copy-paste (of\n`scmcli` subcommand, which was above the new `insight` case at that\ntime).", "committedDate": "2020-12-15T07:56:18Z", "type": "commit"}, {"oid": "ca031fdce6e0b33b5643fd58de23bfed69771b0b", "url": "https://github.com/apache/ozone/commit/ca031fdce6e0b33b5643fd58de23bfed69771b0b", "message": "simplify ozone_bootstrap call", "committedDate": "2020-12-15T10:43:52Z", "type": "commit"}, {"oid": "1241e1ef77fb95ec19207cf8651a4b88497a70e6", "url": "https://github.com/apache/ozone/commit/1241e1ef77fb95ec19207cf8651a4b88497a70e6", "message": "Rename OZONE_CONFIG_DIR to OZONE_CONF_DIR", "committedDate": "2020-12-16T07:32:32Z", "type": "commit"}, {"oid": "2036228561e6811b9364fefd874d6b5a85a3c440", "url": "https://github.com/apache/ozone/commit/2036228561e6811b9364fefd874d6b5a85a3c440", "message": "HDDS-4601. envtoconf broken for .conf and few other formats", "committedDate": "2020-12-16T09:15:06Z", "type": "commit"}, {"oid": "a8f619a24981666cbb0dc43cec1d28a24530ce0d", "url": "https://github.com/apache/ozone/commit/a8f619a24981666cbb0dc43cec1d28a24530ce0d", "message": "workaround for HDDS-4601 and HADOOP-17436", "committedDate": "2020-12-16T12:57:14Z", "type": "commit"}, {"oid": "a70def928eca460dcf5abb3b0dfe87f01cec29e5", "url": "https://github.com/apache/ozone/commit/a70def928eca460dcf5abb3b0dfe87f01cec29e5", "message": "Merge remote-tracking branch 'origin/master' into HDDS-4525", "committedDate": "2020-12-16T18:23:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3MzEwMw==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r542773103", "bodyText": "Does hadoop-config.sh and hadoop-functions.sh have any useful env variables? (e.g. HADOOP_OPTS)\nTODO: Check ozone-config.sh and ozone-functions.sh later.", "author": "smengcl", "createdAt": "2020-12-14T20:54:01Z", "path": "hadoop-ozone/dist/dev-support/bin/dist-layout-stitching", "diffHunk": "@@ -103,10 +93,8 @@ run cp -r \"${ROOT}/hadoop-ozone/dist/src/main/dockerlibexec/.\" \"libexec/\"\n run cp \"${ROOT}/hadoop-ozone/dist/src/shell/ozone/ozone\" \"bin/\"\n \n \n-run cp \"${ROOT}/hadoop-ozone/dist/src/shell/hdds/hadoop-config.sh\" \"libexec/\"\n-run cp \"${ROOT}/hadoop-ozone/dist/src/shell/hdds/hadoop-config.cmd\" \"libexec/\"\n-run cp \"${ROOT}/hadoop-ozone/dist/src/shell/hdds/hadoop-functions.sh\" \"libexec/\"", "originalCommit": "e54c4390bcc8374970baa120b6c6d9b5a375ff1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDU0Mzc2MA==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r544543760", "bodyText": "Yes we have OZONE_OPTS, but not sure if HADOOP_OPTS will be picked up when OZONE_OPTS right now. Probably not?", "author": "smengcl", "createdAt": "2020-12-16T18:55:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3MzEwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ3Nzc2Mw==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r544477763", "bodyText": "Is OZONE_CLASSPATH a placeholder here? Or we are setting it to empty on purpose.", "author": "smengcl", "createdAt": "2020-12-16T17:17:03Z", "path": "hadoop-ozone/dist/src/main/compose/ozone-mr/hadoop27/docker-config", "diffHunk": "@@ -18,4 +18,7 @@ CORE-SITE.xml_fs.AbstractFileSystem.o3fs.impl=org.apache.hadoop.fs.ozone.OzFs\n CORE-SITE.xml_fs.AbstractFileSystem.ofs.impl=org.apache.hadoop.fs.ozone.RootedOzFs\n MAPRED-SITE.XML_mapreduce.application.classpath=/opt/hadoop/share/hadoop/mapreduce/*:/opt/hadoop/share/hadoop/mapreduce/lib/*:/opt/ozone/share/ozone/lib/hadoop-ozone-filesystem-hadoop2-@project.version@.jar\n \n+HADOOP_CLASSPATH=/opt/ozone/share/ozone/lib/hadoop-ozone-filesystem-hadoop2-@project.version@.jar\n+OZONE_CLASSPATH=", "originalCommit": "e54c4390bcc8374970baa120b6c6d9b5a375ff1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDYxMDE2OQ==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r544610169", "bodyText": "setting it to empty on purpose\n\nExactly: without it HADOOP_CLASSPATH containing OzoneFS jar would be picked up, which is bad for Ozone's health.  Actually, this is the primary motivation for this entire change.  From description of HDDS-4525:\n\nsevere problem happens if we would like to access Ozone filesystem both via ozone and hadoop commands.  The latter needs shaded Ozone FS JAR in HADOOP_CLASSPATH.  The same HADOOP_CLASSPATH results in ClassNotFound for ozone.", "author": "adoroszlai", "createdAt": "2020-12-16T20:44:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ3Nzc2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ3ODE0Mg==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r544478142", "bodyText": "Same here.", "author": "smengcl", "createdAt": "2020-12-16T17:17:32Z", "path": "hadoop-ozone/dist/src/main/compose/ozone-mr/hadoop31/docker-config", "diffHunk": "@@ -18,4 +18,7 @@ CORE-SITE.xml_fs.AbstractFileSystem.o3fs.impl=org.apache.hadoop.fs.ozone.OzFs\n CORE-SITE.xml_fs.AbstractFileSystem.ofs.impl=org.apache.hadoop.fs.ozone.RootedOzFs\n MAPRED-SITE.XML_mapreduce.application.classpath=/opt/hadoop/share/hadoop/mapreduce/*:/opt/hadoop/share/hadoop/mapreduce/lib/*:/opt/ozone/share/ozone/lib/hadoop-ozone-filesystem-hadoop3-@project.version@.jar\n \n+HADOOP_CLASSPATH=/opt/ozone/share/ozone/lib/hadoop-ozone-filesystem-hadoop3-@project.version@.jar\n+OZONE_CLASSPATH=", "originalCommit": "e54c4390bcc8374970baa120b6c6d9b5a375ff1d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ3ODI2Nw==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r544478267", "bodyText": "Same", "author": "smengcl", "createdAt": "2020-12-16T17:17:42Z", "path": "hadoop-ozone/dist/src/main/compose/ozone-mr/hadoop32/docker-config", "diffHunk": "@@ -18,4 +18,7 @@ CORE-SITE.xml_fs.AbstractFileSystem.o3fs.impl=org.apache.hadoop.fs.ozone.OzFs\n CORE-SITE.xml_fs.AbstractFileSystem.ofs.impl=org.apache.hadoop.fs.ozone.RootedOzFs\n MAPRED-SITE.XML_mapreduce.application.classpath=/opt/hadoop/share/hadoop/mapreduce/*:/opt/hadoop/share/hadoop/mapreduce/lib/*:/opt/ozone/share/ozone/lib/hadoop-ozone-filesystem-hadoop3-@project.version@.jar\n \n+HADOOP_CLASSPATH=/opt/ozone/share/ozone/lib/hadoop-ozone-filesystem-hadoop3-@project.version@.jar\n+OZONE_CLASSPATH=", "originalCommit": "e54c4390bcc8374970baa120b6c6d9b5a375ff1d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ4MjAyMw==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r544482023", "bodyText": "nice. btw do we pick up HADOOP_OPTS when OZONE_OPTS is not set as well?", "author": "smengcl", "createdAt": "2020-12-16T17:22:44Z", "path": "hadoop-ozone/dist/src/main/smoketest/cli/classpath.robot", "diffHunk": "@@ -0,0 +1,46 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+*** Settings ***\n+Documentation       Test ozone classpath command\n+Library             BuiltIn\n+Resource            ../lib/os.robot\n+Resource            ../ozone-lib/shell.robot\n+Test Timeout        5 minutes\n+Suite Setup         Find Jars Dir\n+\n+*** Test Cases ***\n+Ignores HADOOP_CLASSPATH if OZONE_CLASSPATH is set", "originalCommit": "e54c4390bcc8374970baa120b6c6d9b5a375ff1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDYxNDY3OA==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r544614678", "bodyText": "Yes.  There is a compatibility test for this.  We define some old OPTS:\n\n  \n    \n      ozone/hadoop-ozone/dist/src/main/compose/compatibility/docker-config\n    \n    \n        Lines 31 to 34\n      in\n      a70def9\n    \n    \n    \n    \n\n        \n          \n           HADOOP_OPTS=\"-Dhadoop.opts=test\" \n        \n\n        \n          \n           HDFS_STORAGECONTAINERMANAGER_OPTS=\"-Dhdfs.scm.opts=test\" \n        \n\n        \n          \n           HDFS_OM_OPTS=\"-Dhdfs.om.opts=test\" \n        \n\n        \n          \n           HDDS_DN_OPTS=\"-Dhdds.dn.opts=test\" \n        \n    \n  \n\n\nand then check if these are passed to the java process that ozone om command starts:\n\n  \n    \n      ozone/hadoop-ozone/dist/src/main/smoketest/compatibility/om.robot\n    \n    \n        Lines 23 to 27\n      in\n      e54c439\n    \n    \n    \n    \n\n        \n          \n           Picks up command line options \n        \n\n        \n          \n               Pass Execution If    '%{HDFS_OM_OPTS}' == ''    Command-line option required for process check \n        \n\n        \n          \n               ${processes} =    List All Processes \n        \n\n        \n          \n               Should Contain    ${processes}   %{HDFS_OM_OPTS} \n        \n\n        \n          \n               Should Contain    ${processes}   %{HADOOP_OPTS} \n        \n    \n  \n\n\n(Similar test exists for other components.)", "author": "adoroszlai", "createdAt": "2020-12-16T20:52:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ4MjAyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQ4NTQyNQ==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r551485425", "bodyText": "awesome. thanks!", "author": "smengcl", "createdAt": "2021-01-04T18:20:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ4MjAyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDUwNDY1MA==", "url": "https://github.com/apache/ozone/pull/1667#discussion_r544504650", "bodyText": "Unrelated to this patch but CMS is removed in JDK 14 and on and UseConcMarkSweepGC will be ignored by those higher version JVMs. We might want to come up with a new set of GC params soon.", "author": "smengcl", "createdAt": "2020-12-16T17:55:20Z", "path": "hadoop-ozone/dist/src/test/shell/gc_opts.bats", "diffHunk": "@@ -19,24 +19,32 @@\n # bats gc_opts.bats\n #\n \n-load ../../shell/hdds/hadoop-functions.sh\n-@test \"Setting Hadoop GC parameters: add GC params for server\" {\n-  export HADOOP_SUBCMD_SUPPORTDAEMONIZATION=true\n-  export HADOOP_OPTS=\"Test\"\n-  hadoop_add_default_gc_opts\n-  [[ \"$HADOOP_OPTS\" =~ \"UseConcMarkSweepGC\" ]]\n+load ozone-functions_test_helper\n+\n+@test \"Setting GC parameters: add GC params for server\" {\n+  export OZONE_SUBCMD_SUPPORTDAEMONIZATION=true\n+  export OZONE_OPTS=\"Test\"\n+\n+  ozone_add_default_gc_opts\n+\n+  echo $OZONE_OPTS\n+  [[ \"$OZONE_OPTS\" =~ \"UseConcMarkSweepGC\" ]]\n }\n \n-@test \"Setting Hadoop GC parameters: disabled for client\" {\n-  export HADOOP_SUBCMD_SUPPORTDAEMONIZATION=false\n-  export HADOOP_OPTS=\"Test\"\n-  hadoop_add_default_gc_opts\n-  [[ ! \"$HADOOP_OPTS\" =~ \"UseConcMarkSweepGC\" ]]\n+@test \"Setting GC parameters: disabled for client\" {\n+  export OZONE_SUBCMD_SUPPORTDAEMONIZATION=false\n+  export OZONE_OPTS=\"Test\"\n+\n+  ozone_add_default_gc_opts\n+\n+  [[ ! \"$OZONE_OPTS\" =~ \"UseConcMarkSweepGC\" ]]\n }\n \n-@test \"Setting Hadoop GC parameters: disabled if GC params are customized\" {\n-  export HADOOP_SUBCMD_SUPPORTDAEMONIZATION=true\n-  export HADOOP_OPTS=\"-XX:++UseG1GC -Xmx512\"\n-  hadoop_add_default_gc_opts\n-  [[ ! \"$HADOOP_OPTS\" =~ \"UseConcMarkSweepGC\" ]]\n+@test \"Setting GC parameters: disabled if GC params are customized\" {\n+  export OZONE_SUBCMD_SUPPORTDAEMONIZATION=true\n+  export OZONE_OPTS=\"-XX:++UseG1GC -Xmx512\"\n+\n+  ozone_add_default_gc_opts\n+\n+  [[ ! \"$OZONE_OPTS\" =~ \"UseConcMarkSweepGC\" ]]", "originalCommit": "e54c4390bcc8374970baa120b6c6d9b5a375ff1d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "15192d34ec13fb9bc7c22089842a9a372e59ecc8", "url": "https://github.com/apache/ozone/commit/15192d34ec13fb9bc7c22089842a9a372e59ecc8", "message": "Merge remote-tracking branch 'origin/master' into HDDS-4525", "committedDate": "2021-01-04T14:38:00Z", "type": "commit"}, {"oid": "464bf0f32a921a9928e7789d8578f09228d9020e", "url": "https://github.com/apache/ozone/commit/464bf0f32a921a9928e7789d8578f09228d9020e", "message": "Merge remote-tracking branch 'origin/master' into HDDS-4525", "committedDate": "2021-01-21T17:17:06Z", "type": "commit"}]}