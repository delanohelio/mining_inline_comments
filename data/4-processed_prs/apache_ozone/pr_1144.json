{"pr_number": 1144, "pr_title": "HDDS-3803. [OFS] Add User Guide", "pr_createdAt": "2020-06-29T04:21:52Z", "pr_url": "https://github.com/apache/ozone/pull/1144", "timeline": [{"oid": "5f25ca0d4a25d68e3a2831ee8e3e954151267db3", "url": "https://github.com/apache/ozone/commit/5f25ca0d4a25d68e3a2831ee8e3e954151267db3", "message": "Update ofs.md.\n\nChange-Id: Ib6c6181170e6f45cd24cfa7b6371d4de85fbdaa8", "committedDate": "2020-06-29T04:19:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMxNTYxOQ==", "url": "https://github.com/apache/ozone/pull/1144#discussion_r447315619", "bodyText": "I think we could add a separate admin command called provisionTmp to hide these details. This can be a separate JIRA.", "author": "xiaoyuyao", "createdAt": "2020-06-29T23:27:09Z", "path": "hadoop-hdds/docs/content/design/ofs.md", "diffHunk": "@@ -22,12 +22,140 @@ author: Siyao Meng\n \n # Abstract\n \n-  Existing scheme: o3fs://bucket.volume/key/../...\n+  Scheme: ofs://<Hostname[:Port] or Service ID>/[<volumeName>/<bucketName>/path/to/key]\n+\n+# The Basics\n+\n+Examples of valid OFS paths:\n+\n+```\n+ofs://om1/\n+ofs://om3:9862/\n+ofs://omservice/\n+ofs://omservice/volume1/\n+ofs://omservice/volume1/bucket1/\n+ofs://omservice/volume1/bucket1/dir1\n+ofs://omservice/volume1/bucket1/dir1/key1\n+\n+ofs://omservice/tmp/\n+ofs://omservice/tmp/key1\n+```\n+\n+Volumes and mount(s) are located at the root level of an OFS Filesystem.\n+Buckets are listed naturally under volumes.\n+Keys and directories are under each buckets.\n+\n+Note that for mounts, only temp mount `/tmp` is supported at the moment.\n+\n+# Differences from existing o3fs\n+\n+## Creating files\n+\n+OFS doesn't allow creating keys(files) directly under root or volumes.\n+Users will receive an error message when they try to do that:\n+\n+```\n+$ ozone fs -touch /volume1/key1\n+touch: Cannot create file under root or volume.\n+```\n+\n+## Simplify fs.defaultFS\n+\n+With OFS, fs.defaultFS (in core-site.xml) no longer needs to have a specific\n+volume and bucket in its path like o3fs did.\n+Simply put the OM host or service ID:\n+\n+```\n+<property>\n+<name>fs.defaultFS</name>\n+<value>ofs://omservice</value>\n+</property>\n+```\n+\n+The client would then be able to access every volume and bucket on the cluster\n+without specifying the hostname or service ID.\n+\n+```\n+$ ozone fs -mkdir -p /volume1/bucket1\n+```\n+\n+## Volume and bucket management directly from FileSystem shell\n+\n+Admins can create and delete volumes and buckets easily with Hadoop FS shell.\n+Volumes and buckets are treated similar to directories so they will be created\n+if they don't exist with `-p`:\n+\n+```\n+$ ozone fs -mkdir -p ofs://omservice/volume1/bucket1/dir1/\n+```\n+\n+Note that the supported volume and bucket name character set rule still applies.\n+For instance, bucket and volume names don't take underscore(`_`):\n+\n+```\n+$ ozone fs -mkdir -p /volume_1\n+mkdir: Bucket or Volume name has an unsupported character : _\n+```\n+\n+# Mounts\n+\n+In order to be compatible with legacy Hadoop applications that use /tmp/,\n+we have a special temp mount located at the root of the FS.\n+This feature may be expanded in the feature to support custom mount paths.\n+\n+Important: To use it, first, an **admin** needs to create the volume tmp\n+(the volume name is hardcoded for now) and set its ACL to world ALL access.\n+Namely:\n+\n+```\n+$ ozone sh volume create tmp", "originalCommit": "5f25ca0d4a25d68e3a2831ee8e3e954151267db3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQxMTA1OQ==", "url": "https://github.com/apache/ozone/pull/1144#discussion_r447411059", "bodyText": "Good idea. Filed HDDS-3901", "author": "smengcl", "createdAt": "2020-06-30T05:03:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMxNTYxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMxNjIyNg==", "url": "https://github.com/apache/ozone/pull/1144#discussion_r447316226", "bodyText": "NIT: can we rename this to \"Delete with trash enabled\"", "author": "xiaoyuyao", "createdAt": "2020-06-29T23:29:19Z", "path": "hadoop-hdds/docs/content/design/ofs.md", "diffHunk": "@@ -22,12 +22,140 @@ author: Siyao Meng\n \n # Abstract\n \n-  Existing scheme: o3fs://bucket.volume/key/../...\n+  Scheme: ofs://<Hostname[:Port] or Service ID>/[<volumeName>/<bucketName>/path/to/key]\n+\n+# The Basics\n+\n+Examples of valid OFS paths:\n+\n+```\n+ofs://om1/\n+ofs://om3:9862/\n+ofs://omservice/\n+ofs://omservice/volume1/\n+ofs://omservice/volume1/bucket1/\n+ofs://omservice/volume1/bucket1/dir1\n+ofs://omservice/volume1/bucket1/dir1/key1\n+\n+ofs://omservice/tmp/\n+ofs://omservice/tmp/key1\n+```\n+\n+Volumes and mount(s) are located at the root level of an OFS Filesystem.\n+Buckets are listed naturally under volumes.\n+Keys and directories are under each buckets.\n+\n+Note that for mounts, only temp mount `/tmp` is supported at the moment.\n+\n+# Differences from existing o3fs\n+\n+## Creating files\n+\n+OFS doesn't allow creating keys(files) directly under root or volumes.\n+Users will receive an error message when they try to do that:\n+\n+```\n+$ ozone fs -touch /volume1/key1\n+touch: Cannot create file under root or volume.\n+```\n+\n+## Simplify fs.defaultFS\n+\n+With OFS, fs.defaultFS (in core-site.xml) no longer needs to have a specific\n+volume and bucket in its path like o3fs did.\n+Simply put the OM host or service ID:\n+\n+```\n+<property>\n+<name>fs.defaultFS</name>\n+<value>ofs://omservice</value>\n+</property>\n+```\n+\n+The client would then be able to access every volume and bucket on the cluster\n+without specifying the hostname or service ID.\n+\n+```\n+$ ozone fs -mkdir -p /volume1/bucket1\n+```\n+\n+## Volume and bucket management directly from FileSystem shell\n+\n+Admins can create and delete volumes and buckets easily with Hadoop FS shell.\n+Volumes and buckets are treated similar to directories so they will be created\n+if they don't exist with `-p`:\n+\n+```\n+$ ozone fs -mkdir -p ofs://omservice/volume1/bucket1/dir1/\n+```\n+\n+Note that the supported volume and bucket name character set rule still applies.\n+For instance, bucket and volume names don't take underscore(`_`):\n+\n+```\n+$ ozone fs -mkdir -p /volume_1\n+mkdir: Bucket or Volume name has an unsupported character : _\n+```\n+\n+# Mounts\n+\n+In order to be compatible with legacy Hadoop applications that use /tmp/,\n+we have a special temp mount located at the root of the FS.\n+This feature may be expanded in the feature to support custom mount paths.\n+\n+Important: To use it, first, an **admin** needs to create the volume tmp\n+(the volume name is hardcoded for now) and set its ACL to world ALL access.\n+Namely:\n+\n+```\n+$ ozone sh volume create tmp\n+$ ozone sh volume setacl tmp -al world::a\n+```\n+\n+These commands only needs to be done **once per cluster**.\n+\n+Then, **each user** needs to mkdir first to initialize their own temp bucket\n+once.\n+\n+```\n+$ ozone fs -mkdir /tmp\n+2020-06-04 00:00:00,050 [main] INFO rpc.RpcClient: Creating Bucket: tmp/0238 ...\n+```\n+\n+After that they can write to it just like they would do to a regular\n+directory. e.g.:\n+\n+```\n+$ ozone fs -touch /tmp/key1\n+```\n+\n+# Delete to trash", "originalCommit": "5f25ca0d4a25d68e3a2831ee8e3e954151267db3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQxMTgzNQ==", "url": "https://github.com/apache/ozone/pull/1144#discussion_r447411835", "bodyText": "done", "author": "smengcl", "createdAt": "2020-06-30T05:05:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMxNjIyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMxNjMyOA==", "url": "https://github.com/apache/ozone/pull/1144#discussion_r447316328", "bodyText": "deleted to trash=> deleted with trash enabled", "author": "xiaoyuyao", "createdAt": "2020-06-29T23:29:42Z", "path": "hadoop-hdds/docs/content/design/ofs.md", "diffHunk": "@@ -22,12 +22,140 @@ author: Siyao Meng\n \n # Abstract\n \n-  Existing scheme: o3fs://bucket.volume/key/../...\n+  Scheme: ofs://<Hostname[:Port] or Service ID>/[<volumeName>/<bucketName>/path/to/key]\n+\n+# The Basics\n+\n+Examples of valid OFS paths:\n+\n+```\n+ofs://om1/\n+ofs://om3:9862/\n+ofs://omservice/\n+ofs://omservice/volume1/\n+ofs://omservice/volume1/bucket1/\n+ofs://omservice/volume1/bucket1/dir1\n+ofs://omservice/volume1/bucket1/dir1/key1\n+\n+ofs://omservice/tmp/\n+ofs://omservice/tmp/key1\n+```\n+\n+Volumes and mount(s) are located at the root level of an OFS Filesystem.\n+Buckets are listed naturally under volumes.\n+Keys and directories are under each buckets.\n+\n+Note that for mounts, only temp mount `/tmp` is supported at the moment.\n+\n+# Differences from existing o3fs\n+\n+## Creating files\n+\n+OFS doesn't allow creating keys(files) directly under root or volumes.\n+Users will receive an error message when they try to do that:\n+\n+```\n+$ ozone fs -touch /volume1/key1\n+touch: Cannot create file under root or volume.\n+```\n+\n+## Simplify fs.defaultFS\n+\n+With OFS, fs.defaultFS (in core-site.xml) no longer needs to have a specific\n+volume and bucket in its path like o3fs did.\n+Simply put the OM host or service ID:\n+\n+```\n+<property>\n+<name>fs.defaultFS</name>\n+<value>ofs://omservice</value>\n+</property>\n+```\n+\n+The client would then be able to access every volume and bucket on the cluster\n+without specifying the hostname or service ID.\n+\n+```\n+$ ozone fs -mkdir -p /volume1/bucket1\n+```\n+\n+## Volume and bucket management directly from FileSystem shell\n+\n+Admins can create and delete volumes and buckets easily with Hadoop FS shell.\n+Volumes and buckets are treated similar to directories so they will be created\n+if they don't exist with `-p`:\n+\n+```\n+$ ozone fs -mkdir -p ofs://omservice/volume1/bucket1/dir1/\n+```\n+\n+Note that the supported volume and bucket name character set rule still applies.\n+For instance, bucket and volume names don't take underscore(`_`):\n+\n+```\n+$ ozone fs -mkdir -p /volume_1\n+mkdir: Bucket or Volume name has an unsupported character : _\n+```\n+\n+# Mounts\n+\n+In order to be compatible with legacy Hadoop applications that use /tmp/,\n+we have a special temp mount located at the root of the FS.\n+This feature may be expanded in the feature to support custom mount paths.\n+\n+Important: To use it, first, an **admin** needs to create the volume tmp\n+(the volume name is hardcoded for now) and set its ACL to world ALL access.\n+Namely:\n+\n+```\n+$ ozone sh volume create tmp\n+$ ozone sh volume setacl tmp -al world::a\n+```\n+\n+These commands only needs to be done **once per cluster**.\n+\n+Then, **each user** needs to mkdir first to initialize their own temp bucket\n+once.\n+\n+```\n+$ ozone fs -mkdir /tmp\n+2020-06-04 00:00:00,050 [main] INFO rpc.RpcClient: Creating Bucket: tmp/0238 ...\n+```\n+\n+After that they can write to it just like they would do to a regular\n+directory. e.g.:\n+\n+```\n+$ ozone fs -touch /tmp/key1\n+```\n+\n+# Delete to trash\n+\n+When keys are deleted to trash, they are moved to a trash directory under", "originalCommit": "5f25ca0d4a25d68e3a2831ee8e3e954151267db3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0ee78167b8bf32cc64c0bc1f2ea7c2f77d97b51d", "url": "https://github.com/apache/ozone/commit/0ee78167b8bf32cc64c0bc1f2ea7c2f77d97b51d", "message": "Update doc.\n\nChange-Id: I9e6a192d28ad9947bae19ccefe3466511cd7886a", "committedDate": "2020-06-30T05:07:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgyODI3Nw==", "url": "https://github.com/apache/ozone/pull/1144#discussion_r447828277", "bodyText": "can we update the date given the status changed below?", "author": "xiaoyuyao", "createdAt": "2020-06-30T16:42:38Z", "path": "hadoop-hdds/docs/content/design/ofs.md", "diffHunk": "@@ -3,7 +3,7 @@ title: Implement new Ozone FileSystem scheme ofs://\n summary: A new schema structure for Hadoop compatible file system\n date: 2019-12-05", "originalCommit": "0ee78167b8bf32cc64c0bc1f2ea7c2f77d97b51d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkwMDgyOQ==", "url": "https://github.com/apache/ozone/pull/1144#discussion_r447900829", "bodyText": "no problem", "author": "smengcl", "createdAt": "2020-06-30T18:40:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgyODI3Nw=="}], "type": "inlineReview"}, {"oid": "57a567e9c4c078cdb7c9d6a07b0e5ea68a6a769f", "url": "https://github.com/apache/ozone/commit/57a567e9c4c078cdb7c9d6a07b0e5ea68a6a769f", "message": "Update date.\n\nChange-Id: I047ae8448d31a1cb418f2d9a17d5fcb38c80b105", "committedDate": "2020-06-30T18:45:29Z", "type": "commit"}]}