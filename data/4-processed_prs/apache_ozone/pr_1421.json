{"pr_number": 1421, "pr_title": "HDDS-4174. Add current HDDS layout version to Datanode heartbeat/registration", "pr_createdAt": "2020-09-14T06:20:49Z", "pr_url": "https://github.com/apache/ozone/pull/1421", "timeline": [{"oid": "e1133014c77bf68b805d1eb7c83ad8dcddc1f637", "url": "https://github.com/apache/ozone/commit/e1133014c77bf68b805d1eb7c83ad8dcddc1f637", "message": "HDDS-4174. Add current HDDS layout version to Datanode heartbeat/registration.", "committedDate": "2020-09-14T06:17:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxNjUwNA==", "url": "https://github.com/apache/ozone/pull/1421#discussion_r487716504", "bodyText": "What is the use case the command where this flag=false. Is it a no-op request?", "author": "elek", "createdAt": "2020-09-14T07:49:37Z", "path": "hadoop-hdds/interface-server/src/main/proto/ScmServerDatanodeHeartbeatProtocol.proto", "diffHunk": "@@ -390,6 +404,14 @@ message ClosePipelineCommandProto {\n   required int64 cmdId = 2;\n }\n \n+/**\n+ * This command asks the DataNode to finalize a new HDDS layout version.\n+ */\n+message FinalizeNewLayoutVersionCommandProto {\n+  required bool finalizeNewHDDSLayoutVersion = 1 [default = false];", "originalCommit": "e1133014c77bf68b805d1eb7c83ad8dcddc1f637", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0OTczMw==", "url": "https://github.com/apache/ozone/pull/1421#discussion_r488049733", "bodyText": "yes, that would be a no op request.", "author": "prashantpogde", "createdAt": "2020-09-14T16:04:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxNjUwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTk1MzUwNg==", "url": "https://github.com/apache/ozone/pull/1421#discussion_r491953506", "bodyText": "Is there any use case for this noop request? Will it be used by somebody? Why do we need this field?", "author": "elek", "createdAt": "2020-09-21T10:57:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxNjUwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxOTU1Mw==", "url": "https://github.com/apache/ozone/pull/1421#discussion_r487719553", "bodyText": "Why not this be a required field? when Datanode firstly register on SCM, it should have its own HDDS layout version.", "author": "linyiqun", "createdAt": "2020-09-14T07:54:59Z", "path": "hadoop-hdds/interface-server/src/main/proto/ScmServerDatanodeHeartbeatProtocol.proto", "diffHunk": "@@ -92,6 +101,7 @@ message SCMRegisterRequestProto {\n   required NodeReportProto nodeReport = 2;\n   required ContainerReportsProto containerReport = 3;\n   required PipelineReportsProto pipelineReports = 4;\n+  optional HDDSLayoutVersionProto dataNodeLayoutVersion = 5;", "originalCommit": "e1133014c77bf68b805d1eb7c83ad8dcddc1f637", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA1MTI4Nw==", "url": "https://github.com/apache/ozone/pull/1421#discussion_r488051287", "bodyText": "Datanode need not pass the HDDSLaoutVersionProto information during registration.", "author": "prashantpogde", "createdAt": "2020-09-14T16:06:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxOTU1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODE2NjM2MA==", "url": "https://github.com/apache/ozone/pull/1421#discussion_r488166360", "bodyText": "All new fields added should be optional for backward compatibility.", "author": "prashantpogde", "createdAt": "2020-09-14T19:21:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxOTU1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0OTM5NA==", "url": "https://github.com/apache/ozone/pull/1421#discussion_r488049394", "bodyText": "Why not use a single line: optional FinalizeNewLayoutVersionCommandProto=9?", "author": "amaliujia", "createdAt": "2020-09-14T16:04:04Z", "path": "hadoop-hdds/interface-server/src/main/proto/ScmServerDatanodeHeartbeatProtocol.proto", "diffHunk": "@@ -303,6 +315,8 @@ message SCMCommandProto {\n   optional ReplicateContainerCommandProto replicateContainerCommandProto = 6;\n   optional CreatePipelineCommandProto createPipelineCommandProto = 7;\n   optional ClosePipelineCommandProto closePipelineCommandProto = 8;\n+  optional FinalizeNewLayoutVersionCommandProto\n+  finalizeNewLayoutVersionCommandProto = 9;", "originalCommit": "e1133014c77bf68b805d1eb7c83ad8dcddc1f637", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA1MjEwNw==", "url": "https://github.com/apache/ozone/pull/1421#discussion_r488052107", "bodyText": "80 columns", "author": "prashantpogde", "createdAt": "2020-09-14T16:07:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0OTM5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA1NDc5Nw==", "url": "https://github.com/apache/ozone/pull/1421#discussion_r488054797", "bodyText": "Ah I see. Didn't know Ozone also enforce that in proto files (very common that message name is very long).", "author": "amaliujia", "createdAt": "2020-09-14T16:11:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0OTM5NA=="}], "type": "inlineReview"}, {"oid": "95ae42af5c201d4c5da8e9746c58743b439b4b10", "url": "https://github.com/apache/ozone/commit/95ae42af5c201d4c5da8e9746c58743b439b4b10", "message": "HDDS-4174. Addressing review comments.", "committedDate": "2020-09-14T19:22:39Z", "type": "commit"}]}