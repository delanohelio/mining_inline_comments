{"pr_number": 1571, "pr_title": "HDDS-4441. Add metrics for ACL related operations.", "pr_createdAt": "2020-11-11T06:01:12Z", "pr_url": "https://github.com/apache/ozone/pull/1571", "timeline": [{"oid": "5accb019bf1e0560e40a19b688e112d995f4df37", "url": "https://github.com/apache/ozone/commit/5accb019bf1e0560e40a19b688e112d995f4df37", "message": "HDDS-4441. Add metrics for ACL related operations.", "committedDate": "2020-11-11T05:59:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU2ODUyNA==", "url": "https://github.com/apache/ozone/pull/1571#discussion_r521568524", "bodyText": "I wonder if it is really necessary to call this again and again. Doesn't look needed.", "author": "jojochuang", "createdAt": "2020-11-11T18:50:30Z", "path": "hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/om/TestOmMetrics.java", "diffHunk": "@@ -318,6 +326,42 @@ public void testKeyOps() throws IOException {\n \n   }\n \n+  @Test\n+  public void testAclOperations() throws IOException {\n+    try {\n+      // Create a volume.\n+      cluster.getClient().getObjectStore().createVolume(\"volumeacl\");\n+\n+      OzoneObj volObj = new OzoneObjInfo.Builder().setVolumeName(\"volumeacl\")\n+          .setResType(VOLUME).setStoreType(OZONE).build();\n+\n+      // Test getAcl\n+      List<OzoneAcl> acls = ozoneManager.getAcl(volObj);\n+      MetricsRecordBuilder omMetrics = getMetrics(\"OMMetrics\");\n+      assertCounter(\"NumGetAcl\", 1L, omMetrics);\n+\n+      // Test addAcl\n+      ozoneManager.addAcl(volObj,\n+          new OzoneAcl(IAccessAuthorizer.ACLIdentityType.USER, \"ozoneuser\",\n+              IAccessAuthorizer.ACLType.ALL, ACCESS));\n+      omMetrics = getMetrics(\"OMMetrics\");\n+      assertCounter(\"NumAddAcl\", 1L, omMetrics);\n+\n+      // Test setAcl\n+      ozoneManager.setAcl(volObj, acls);\n+      omMetrics = getMetrics(\"OMMetrics\");\n+      assertCounter(\"NumSetAcl\", 1L, omMetrics);\n+\n+      // Test removeAcl\n+      ozoneManager.removeAcl(volObj, acls.get(0));\n+      omMetrics = getMetrics(\"OMMetrics\");", "originalCommit": "5accb019bf1e0560e40a19b688e112d995f4df37", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY5ODg1MQ==", "url": "https://github.com/apache/ozone/pull/1571#discussion_r521698851", "bodyText": "Well, I also thought the same, it should be required only once, But my test itself fails without that. If you observe the tests above. testVolumeOps, testBucketOps and testKeyOps they too are also calling getMetrics(\"OMMetrics\"); before asserting.\nThe getMetrics seems to fetch the values and keep it. it doesn't seems to be updating.", "author": "ayushtkn", "createdAt": "2020-11-11T23:23:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU2ODUyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTcxODAxNw==", "url": "https://github.com/apache/ozone/pull/1571#discussion_r521718017", "bodyText": "ok thx for the clarification", "author": "jojochuang", "createdAt": "2020-11-12T00:05:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU2ODUyNA=="}], "type": "inlineReview"}]}