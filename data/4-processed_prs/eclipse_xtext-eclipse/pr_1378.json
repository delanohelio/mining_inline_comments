{"pr_number": 1378, "pr_title": "restored old api of SingleHoverShowingHyperlinkPresenter", "pr_createdAt": "2020-03-23T12:34:02Z", "pr_url": "https://github.com/eclipse/xtext-eclipse/pull/1378", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQyMjY2NA==", "url": "https://github.com/eclipse/xtext-eclipse/pull/1378#discussion_r396422664", "bodyText": "I'm still not a big fan of streams where the forEach modified some captured instance, e.g. the nullSafeList.\nA old-school for loop may have been the better choice.\nSince it looks correct though, I'll approve", "author": "szarnekow", "createdAt": "2020-03-23T12:44:40Z", "path": "org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/hyperlinking/SingleHoverShowingHyperlinkPresenter.java", "diffHunk": "@@ -55,37 +56,38 @@ public SingleHoverShowingHyperlinkPresenter(MultipleHyperlinkPresenter delegate)\n \n \t@Override\n \tpublic Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n-\t\tif (method.getName().startsWith(\"showHyperlinks\") && (args.length >= 1) && (args[0] instanceof IHyperlink[])) {\n-\t\t\tList<IHyperlink> nullsafe = makeNullsafe(Arrays.asList((IHyperlink[]) args[0]));\n-\t\t\tif (!nullsafe.isEmpty()) {\n+\t\tif (method.getName().startsWith(\"showHyperlinks\") && args.length >= 1 && args[0] instanceof IHyperlink[]) {\n+\t\t\tIHyperlink[] nullsafe = this.makeNullsafe((IHyperlink[]) args[0]);\n+\t\t\tif (nullsafe.length > 0) {\n \t\t\t\targs[0] = nullsafe;\n-\t\t\t\tObject result = method.invoke(delegate, args);\n-\t\t\t\tList<IHyperlink> activeHyperlinks = nullsafe;\n-\t\t\t\tif (activeHyperlinks.size() == 1) {\n-\t\t\t\t\tIHyperlink singleHyperlink = activeHyperlinks.get(0);\n-\t\t\t\t\tif (Objects.equals(SHOW_ALWAYS, singleHyperlink.getTypeLabel())) {\n+\t\t\t\tObject result = method.invoke(this.delegate, args);\n+\t\t\t\tIHyperlink[] activeHyperlinks = nullsafe;\n+\t\t\t\tif (activeHyperlinks.length == 1) {\n+\t\t\t\t\tIHyperlink singleHyperlink = activeHyperlinks[0];\n+\t\t\t\t\tif (SingleHoverShowingHyperlinkPresenter.SHOW_ALWAYS.equals(singleHyperlink.getTypeLabel())) {\n \t\t\t\t\t\tint start = singleHyperlink.getHyperlinkRegion().getOffset();\n \t\t\t\t\t\tint end = start + singleHyperlink.getHyperlinkRegion().getLength();\n \t\t\t\t\t\treflect.set(delegate, \"fSubjectRegion\", new Region(start, end - start));\n-\t\t\t\t\t\treflect.set(delegate, \"fCursorOffset\",\n-\t\t\t\t\t\t\t\tInteger.valueOf(JFaceTextUtil.getOffsetForCursorLocation(reflect.get(delegate, \"fTextViewer\"))));\n+\t\t\t\t\t\treflect.set(delegate, \"fCursorOffset\", Integer.valueOf(\n+\t\t\t\t\t\t\t\tJFaceTextUtil.getOffsetForCursorLocation(reflect.get(delegate, \"fTextViewer\"))));\n \t\t\t\t\t\t((AbstractInformationControlManager) reflect.get(delegate, \"fManager\")).showInformation();\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t\treturn result;\n \t\t\t}\n-\t\t\treturn null; // showHyperlinks returns void \n+\t\t\treturn null;\n \t\t}\n-\t\treturn method.invoke(delegate, args);\n+\t\treturn method.invoke(this.delegate, args);\n+\n \t}\n \n \t/**\n \t * @since 2.9\n \t */\n-\tprotected List<IHyperlink> makeNullsafe(List<IHyperlink> hyperlinks) {\n-\t\tif (hyperlinks.stream().anyMatch(hyperLink -> (hyperLink == null || hyperLink.getHyperlinkRegion() == null))) {\n+\tprotected IHyperlink[] makeNullsafe(IHyperlink[] hyperlinks) {\n+\t\tif (Arrays.stream(hyperlinks).anyMatch(hyperLink -> (hyperLink == null || hyperLink.getHyperlinkRegion() == null))) {\n \t\t\tList<IHyperlink> nullSafeList = new ArrayList<>();\n-\t\t\thyperlinks.forEach(hyperLink -> {\n+\t\t\tArrays.stream(hyperlinks).forEach(hyperLink -> {", "originalCommit": "6e7efa12ded54ac5885e9722305f2accfcb55f95", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "97764cf1dd08e47046656ef9e184e1458b38db4a", "url": "https://github.com/eclipse/xtext-eclipse/commit/97764cf1dd08e47046656ef9e184e1458b38db4a", "message": "restored old api of SingleHoverShowingHyperlinkPresenter\n\nSigned-off-by: Christian Dietrich <christian.dietrich@itemis.de>", "committedDate": "2020-03-23T13:13:19Z", "type": "commit"}, {"oid": "97764cf1dd08e47046656ef9e184e1458b38db4a", "url": "https://github.com/eclipse/xtext-eclipse/commit/97764cf1dd08e47046656ef9e184e1458b38db4a", "message": "restored old api of SingleHoverShowingHyperlinkPresenter\n\nSigned-off-by: Christian Dietrich <christian.dietrich@itemis.de>", "committedDate": "2020-03-23T13:13:19Z", "type": "forcePushed"}]}