{"pr_number": 1855, "pr_title": "Log-adjusted backoff logic.", "pr_createdAt": "2020-08-05T15:24:11Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/1855", "timeline": [{"oid": "8e5d80e2ffa7e6b2f475b0c1f2f25aabea6adce9", "url": "https://github.com/firebase/firebase-android-sdk/commit/8e5d80e2ffa7e6b2f475b0c1f2f25aabea6adce9", "message": "Log-adjusted backoff logic.\n\nThe effect of the change is that initial attempts with small delay\nare spread out in time more, which increases the overall time that\nevents are stored.", "committedDate": "2020-08-05T15:20:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU2MjkyNw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1855#discussion_r466562927", "bodyText": "I know this algorithm is being used just because it works out the way we want - but it would help to have some commentary about why we're using this rather complex logic, for anyone down the line wondering why this was chosen.", "author": "mrwillis21", "createdAt": "2020-08-06T17:15:43Z", "path": "transport/transport-runtime/src/main/java/com/google/android/datatransport/runtime/scheduling/jobscheduling/SchedulerConfig.java", "diffHunk": "@@ -135,10 +137,20 @@ public long getScheduleDelay(Priority priority, long minTimestamp, int attemptNu\n     long timeDiff = minTimestamp - getClock().getTime();\n     ConfigValue config = getValues().get(priority);\n \n-    long delay = Math.max(((long) Math.pow(2, attemptNumber - 1)) * config.getDelta(), timeDiff);\n+    long delay = Math.max(adjustedExponentialBackoff(attemptNumber, config.getDelta()), timeDiff);\n     return Math.min(delay, config.getMaxAllowedDelay());\n   }\n \n+  private long adjustedExponentialBackoff(int attemptNumber, long delta) {", "originalCommit": "8e5d80e2ffa7e6b2f475b0c1f2f25aabea6adce9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU3ODA1Nw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1855#discussion_r466578057", "bodyText": "Oops, I saw your comment after merging. I can create a follow up PR, but fwiw the explanation is present in the commit message.", "author": "vkryachko", "createdAt": "2020-08-06T17:38:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU2MjkyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY1MTM3Nw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1855#discussion_r466651377", "bodyText": "Right, but when just looking at the code in the future, it would be nice not to have to do a git blame to figure out the intent. :)", "author": "mrwillis21", "createdAt": "2020-08-06T19:55:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU2MjkyNw=="}], "type": "inlineReview"}]}