{"pr_number": 1916, "pr_title": "Handling AssertionError thrown by JsonReader causing Play Games app-crashes.", "pr_createdAt": "2020-08-24T22:37:11Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/1916", "timeline": [{"oid": "be0db4fbab4fd68d7573d2e00ed0600098149d31", "url": "https://github.com/firebase/firebase-android-sdk/commit/be0db4fbab4fd68d7573d2e00ed0600098149d31", "message": "Handling AssertionError thrown by JsonReader causing Play Games app\ncrashes.", "committedDate": "2020-08-24T22:34:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkzNTYyNg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1916#discussion_r475935626", "bodyText": "Can we add a TODO to remove this code duplication (from above)?", "author": "andirayo", "createdAt": "2020-08-24T22:46:32Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -394,7 +394,7 @@ public TokenResult generateAuthToken(\n         logBadConfigError();\n \n         return TokenResult.builder().setResponseCode(TokenResult.ResponseCode.BAD_CONFIG).build();\n-      } catch (IOException ignored) {\n+      } catch (AssertionError | IOException ignored) {", "originalCommit": "be0db4fbab4fd68d7573d2e00ed0600098149d31", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk0MDQwNg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1916#discussion_r475940406", "bodyText": "Added a TODO and created a tracker https://b.corp.google.com/issues/166168291 for removing code duplication. Thanks.", "author": "ankitaj224", "createdAt": "2020-08-24T23:00:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkzNTYyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkzNTc2MQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1916#discussion_r475935761", "bodyText": "Same as above. Seems like we still have sections of code duplications.", "author": "andirayo", "createdAt": "2020-08-24T22:46:57Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -486,10 +489,13 @@ private InstallationResponse readCreateResponse(HttpURLConnection conn) throws I\n   }\n \n   // Read the response from the generateAuthToken FirebaseInstallation API.\n-  private TokenResult readGenerateAuthTokenResponse(HttpURLConnection conn) throws IOException {\n+  private TokenResult readGenerateAuthTokenResponse(HttpURLConnection conn)\n+      throws AssertionError, IOException {\n     InputStream inputStream = conn.getInputStream();\n     JsonReader reader = new JsonReader(new InputStreamReader(inputStream, UTF_8));\n     TokenResult.Builder builder = TokenResult.builder();\n+    // JsonReader.peek will sometimes throw AssertionErrors in Android 8.0 and above. See\n+    // https://b.corp.google.com/issues/79920590 for details.", "originalCommit": "be0db4fbab4fd68d7573d2e00ed0600098149d31", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b7b7452aeecd20ea14cdf3563d3ff3c1a67a5aaf", "url": "https://github.com/firebase/firebase-android-sdk/commit/b7b7452aeecd20ea14cdf3563d3ff3c1a67a5aaf", "message": "Addressing rayo's comments", "committedDate": "2020-08-24T22:59:35Z", "type": "commit"}]}