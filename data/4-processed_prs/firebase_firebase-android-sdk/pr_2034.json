{"pr_number": 2034, "pr_title": "Remove protobuf dependency from RC SDK.", "pr_createdAt": "2020-10-02T17:43:19Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/2034", "timeline": [{"oid": "2f452e33f73029e0a7970cfef57589df715a98c4", "url": "https://github.com/firebase/firebase-android-sdk/commit/2f452e33f73029e0a7970cfef57589df715a98c4", "message": "Remove protobuf dependency from RC SDK.", "committedDate": "2020-10-02T15:02:51Z", "type": "commit"}, {"oid": "80a11f37561d7358f9cd3661983f62126e609405", "url": "https://github.com/firebase/firebase-android-sdk/commit/80a11f37561d7358f9cd3661983f62126e609405", "message": "Specify proto as compileOnly.", "committedDate": "2020-10-02T20:12:13Z", "type": "commit"}, {"oid": "b0ee992c438025e92350b00b6101db762a63ad06", "url": "https://github.com/firebase/firebase-android-sdk/commit/b0ee992c438025e92350b00b6101db762a63ad06", "message": "googleJavaFormat", "committedDate": "2020-10-02T20:29:07Z", "type": "commit"}, {"oid": "50db692700869cfb28dfb7c40fb708b161715a82", "url": "https://github.com/firebase/firebase-android-sdk/commit/50db692700869cfb28dfb7c40fb708b161715a82", "message": "Merge master.", "committedDate": "2020-10-05T17:53:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDM2NTg4MQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2034#discussion_r500365881", "bodyText": "afaict I don't think that is accurate, instead ABT has protos used by fiam and RC, can you please double check that?", "author": "vkryachko", "createdAt": "2020-10-06T15:02:20Z", "path": "firebase-config/firebase-config.gradle", "diffHunk": "@@ -24,6 +24,8 @@ firebaseLibrary {\n     publishSources = true\n }\n \n+// Compile Protobuf definition files. Remote Config does not depend on Protobuf but includes\n+// definitions used by the ABT and FIAM SDKs.", "originalCommit": "50db692700869cfb28dfb7c40fb708b161715a82", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI1MjUxMg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2034#discussion_r501252512", "bodyText": "ABT only exposes experiment_payload proto, which is only used in RC in the class removed in this PR. There are other mentions in the configs proto, but it's as bytes\nhttps://osscs.corp.google.com/firebase-sdk/firebase-android-sdk/+/master:firebase-config/src/proto/com/google/android/gms/config/proto/config_persistence.proto;l=42?q=experiment%20payload&ss=firebase-sdk%2Ffirebase-android-sdk:firebase-config%2F\nFIAM does depend on the class\nhttps://osscs.corp.google.com/firebase-sdk/firebase-android-sdk/+/master:firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/internal/AbtIntegrationHelper.java;l=57?q=experimentpayload&ss=firebase-sdk%2Ffirebase-android-sdk:firebase-inappmessaging%2F from ABT", "author": "rlazo", "createdAt": "2020-10-07T19:18:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDM2NTg4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDM2NjQxNA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2034#discussion_r500366414", "bodyText": "I think this one is needed as implementation, otherwise it will cause build failures if firebase-abt is used alone in an app", "author": "vkryachko", "createdAt": "2020-10-06T15:02:53Z", "path": "firebase-abt/firebase-abt.gradle", "diffHunk": "@@ -87,4 +86,5 @@ dependencies {\n     testImplementation 'io.grpc:grpc-testing:1.12.0'\n     testImplementation 'androidx.test.espresso:espresso-core:3.2.0'\n \n+    compileOnly \"com.google.protobuf:protobuf-javalite:$javaliteVersion\"", "originalCommit": "50db692700869cfb28dfb7c40fb708b161715a82", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDM2NjkzNQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2034#discussion_r500366935", "bodyText": "This file also contains the following todo comment:\nTODO(issue/568): Remove this once legacy logic is removed from Remote Config.\n\nShould this be done with this change?", "author": "vkryachko", "createdAt": "2020-10-06T15:03:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDM2NjQxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI1Mjc4Ng==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2034#discussion_r501252786", "bodyText": "AFAIK firebase-abt cannot be used stand alone. Can it?", "author": "rlazo", "createdAt": "2020-10-07T19:19:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDM2NjQxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI4NzE3OQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2034#discussion_r501287179", "bodyText": "ABT can't be used alone (since you have to run the ABT test on something else) but we should update the comment if we don't move the proto definition into FIAM.", "author": "danasilver", "createdAt": "2020-10-07T20:23:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDM2NjQxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI1NTA0OA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2034#discussion_r501255048", "bodyText": "from the javadoc seems like the only usefulness of the method was for use with the LegacyConfigsHandler, is it still needed?", "author": "rlazo", "createdAt": "2020-10-07T19:23:12Z", "path": "firebase-config/src/main/java/com/google/firebase/remoteconfig/RemoteConfigComponent.java", "diffHunk": "@@ -209,11 +205,7 @@ private ConfigCacheClient getCacheClient(String namespace, String configStoreTyp\n     return getCacheClient(context, appId, namespace, configStoreType);\n   }\n \n-  /**\n-   * The {@link LegacyConfigsHandler} needs access to multiple cache clients, and the simplest way\n-   * to provide it access is to keep this method public and static.\n-   */\n-  public static ConfigCacheClient getCacheClient(\n+  private ConfigCacheClient getCacheClient(", "originalCommit": "50db692700869cfb28dfb7c40fb708b161715a82", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI4MTczOA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2034#discussion_r501281738", "bodyText": "Ah yeah - don't need this method and the one above.", "author": "danasilver", "createdAt": "2020-10-07T20:13:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI1NTA0OA=="}], "type": "inlineReview"}, {"oid": "80a95f48506ac8178e0788c79cd9a157ac0a3fc1", "url": "https://github.com/firebase/firebase-android-sdk/commit/80a95f48506ac8178e0788c79cd9a157ac0a3fc1", "message": "Remove unused getCacheClient method.", "committedDate": "2020-10-07T20:16:57Z", "type": "commit"}, {"oid": "14625500292eefbf03710c1ff1299ad383c2c47d", "url": "https://github.com/firebase/firebase-android-sdk/commit/14625500292eefbf03710c1ff1299ad383c2c47d", "message": "Move RC and ABT protos to FIAM.", "committedDate": "2020-10-07T23:38:03Z", "type": "commit"}, {"oid": "a14110e45b85edbcd3ec0241176f1b67c17f7c83", "url": "https://github.com/firebase/firebase-android-sdk/commit/a14110e45b85edbcd3ec0241176f1b67c17f7c83", "message": "Move ExperimentPayload proto to FIAM package.", "committedDate": "2020-10-08T23:06:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYwMDEyOA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2034#discussion_r502600128", "bodyText": "Will there be any issues with serialization if we change the package name as I assume there could be a similar proto used at server side?", "author": "eldhosembabu", "createdAt": "2020-10-09T18:20:08Z", "path": "firebase-inappmessaging/src/proto/firebase/inappmessaging/proto/experiment_payload.proto", "diffHunk": "@@ -13,9 +13,11 @@\n // limitations under the License.\n \n syntax = \"proto3\";\n-package developers.mobile.abt;\n \n-option java_outer_classname = \"FirebaseAbt\";\n+package firebase.inappmessaging;", "originalCommit": "a14110e45b85edbcd3ec0241176f1b67c17f7c83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYxMzI1OA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2034#discussion_r502613258", "bodyText": "nope, there should not be any issues", "author": "vkryachko", "createdAt": "2020-10-09T18:47:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYwMDEyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU1NzU1Mg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2034#discussion_r503557552", "bodyText": "Thanks for clarifying...I saw another proto from targeting inside FIAM maintaining the targeting package structure(.../firebase-inappmessaging/src/proto/developers/mobile/targeting/proto/client_signals.proto)...so was a little confused and added this question.", "author": "eldhosembabu", "createdAt": "2020-10-12T22:05:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYwMDEyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU2Mzk5Mw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2034#discussion_r503563993", "bodyText": "Ah yeah I saw that but decided to keep it as-is since it was already in FIAM.", "author": "danasilver", "createdAt": "2020-10-12T22:24:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYwMDEyOA=="}], "type": "inlineReview"}]}