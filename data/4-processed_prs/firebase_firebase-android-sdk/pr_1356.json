{"pr_number": 1356, "pr_title": "Crashlytics ndk datatransport", "pr_createdAt": "2020-03-17T13:04:31Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/1356", "timeline": [{"oid": "fed40829cf9bca2740f51bb012d56a7f6e6345cb", "url": "https://github.com/firebase/firebase-android-sdk/commit/fed40829cf9bca2740f51bb012d56a7f6e6345cb", "message": "Refactor datatransport abstractions to support polymorphic handling of session parts", "committedDate": "2020-03-17T13:05:44Z", "type": "forcePushed"}, {"oid": "15f091c2982ae62be7028eb2b81413bb7f90e285", "url": "https://github.com/firebase/firebase-android-sdk/commit/15f091c2982ae62be7028eb2b81413bb7f90e285", "message": "Refactor datatransport abstractions to support polymorphic handling of session parts", "committedDate": "2020-03-17T13:07:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY4NTY2MA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393685660", "bodyText": "Shouldn't we reuse getStream here?", "author": "mrwillis21", "createdAt": "2020-03-17T13:39:41Z", "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/FileBackedNativeSessionFile.java", "diffHunk": "@@ -0,0 +1,77 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.crashlytics.internal.common;\n+\n+import com.google.firebase.crashlytics.internal.model.CrashlyticsReport;\n+import java.io.ByteArrayOutputStream;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.charset.Charset;\n+\n+/** A {@link NativeSessionFile} backed by a {@link File} currently on disk. */\n+class FileBackedNativeSessionFile implements NativeSessionFile {\n+  private static final Charset UTF_8 = Charset.forName(\"UTF-8\");\n+\n+  private final File f;\n+  private final String name;\n+\n+  FileBackedNativeSessionFile(String name, File f) {\n+    this.name = name;\n+    this.f = f;\n+  }\n+\n+  public String getName() {\n+    return this.name;\n+  }\n+\n+  @Override\n+  public InputStream getStream() {\n+    try {\n+      return new FileInputStream(f);\n+    } catch (FileNotFoundException f) {\n+      return null;\n+    }\n+  }\n+\n+  @Override\n+  public CrashlyticsReport.FilesPayload.File asFilePayload() {\n+    byte[] bytes = asBytes();\n+    return bytes != null\n+        ? CrashlyticsReport.FilesPayload.File.builder()\n+            .setContents(asBytes())\n+            .setFilename(name)\n+            .build()\n+        : null;\n+  }\n+\n+  private byte[] asBytes() {\n+    final byte[] readBuffer = new byte[8192];\n+    final ByteArrayOutputStream bos = new ByteArrayOutputStream();\n+    try (InputStream stream = new FileInputStream(f)) {", "originalCommit": "15f091c2982ae62be7028eb2b81413bb7f90e285", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNzk3Nw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393727977", "bodyText": "It was originally this, but then we have to null check the stream because getStream() returns a nullable.", "author": "jakeouellette", "createdAt": "2020-03-17T14:38:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY4NTY2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc4MjkwOA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393782908", "bodyText": "I think it would be more consistent, since getStream is the underlying API. Besides, you're already re-catching the FNFException in this method.\nIf your concern is the try-with-resources, it works with nullable AutoCloseables, you'd just need to check that stream is non-null inside the try block.", "author": "mrwillis21", "createdAt": "2020-03-17T15:52:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY4NTY2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY4NTk4OQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393685989", "bodyText": "Why not just return bos.toByteArray()?", "author": "mrwillis21", "createdAt": "2020-03-17T13:40:13Z", "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/FileBackedNativeSessionFile.java", "diffHunk": "@@ -0,0 +1,77 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.crashlytics.internal.common;\n+\n+import com.google.firebase.crashlytics.internal.model.CrashlyticsReport;\n+import java.io.ByteArrayOutputStream;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.charset.Charset;\n+\n+/** A {@link NativeSessionFile} backed by a {@link File} currently on disk. */\n+class FileBackedNativeSessionFile implements NativeSessionFile {\n+  private static final Charset UTF_8 = Charset.forName(\"UTF-8\");\n+\n+  private final File f;\n+  private final String name;\n+\n+  FileBackedNativeSessionFile(String name, File f) {\n+    this.name = name;\n+    this.f = f;\n+  }\n+\n+  public String getName() {\n+    return this.name;\n+  }\n+\n+  @Override\n+  public InputStream getStream() {\n+    try {\n+      return new FileInputStream(f);\n+    } catch (FileNotFoundException f) {\n+      return null;\n+    }\n+  }\n+\n+  @Override\n+  public CrashlyticsReport.FilesPayload.File asFilePayload() {\n+    byte[] bytes = asBytes();\n+    return bytes != null\n+        ? CrashlyticsReport.FilesPayload.File.builder()\n+            .setContents(asBytes())\n+            .setFilename(name)\n+            .build()\n+        : null;\n+  }\n+\n+  private byte[] asBytes() {\n+    final byte[] readBuffer = new byte[8192];\n+    final ByteArrayOutputStream bos = new ByteArrayOutputStream();\n+    try (InputStream stream = new FileInputStream(f)) {\n+      int read;\n+      while ((read = stream.read(readBuffer)) > 0) {\n+        bos.write(readBuffer, 0, read);\n+      }\n+      return new String(bos.toByteArray(), UTF_8).getBytes();", "originalCommit": "15f091c2982ae62be7028eb2b81413bb7f90e285", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczMDU1Ng==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393730556", "bodyText": "This code was copied from https://github.com/firebase/firebase-android-sdk/blob/master/firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/persistence/CrashlyticsReportPersistence.java#L370 , any idea why that one doesn't?", "author": "jakeouellette", "createdAt": "2020-03-17T14:42:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY4NTk4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3NzgxMQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393777811", "bodyText": "Because that's returning the read-in bytes as a UTF-8 String, you just need to return the read-in bytes here, no?", "author": "mrwillis21", "createdAt": "2020-03-17T15:45:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY4NTk4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc4NjU2Mg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393786562", "bodyText": "Updated this one to be just toByteArray!", "author": "jakeouellette", "createdAt": "2020-03-17T15:57:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY4NTk4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY4OTU0Mw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393689543", "bodyText": "Shouldn't we keep the serialization method separate from this API? I.e. rather than have this class know how to serialize itself to a FilesPayload, shouldn't we have a FilesPayloadSerializer? What if we wanted to add other serialization methods later?", "author": "mrwillis21", "createdAt": "2020-03-17T13:45:27Z", "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/NativeSessionFile.java", "diffHunk": "@@ -0,0 +1,40 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.crashlytics.internal.common;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import com.google.firebase.crashlytics.internal.model.CrashlyticsReport;\n+import java.io.InputStream;\n+\n+/**\n+ * An abstraction of a \"File\" resource sent to the Crashlytics backend when an NDK Crash has\n+ * occurred.\n+ */\n+interface NativeSessionFile {\n+  /** Shortname of the file, e.g., \"logs\" */\n+  @NonNull\n+  String getName();\n+\n+  /** Representation of the NativeSessionFile as a stream */\n+  @Nullable\n+  InputStream getStream();\n+\n+  /**\n+   * Representation of the NativeSessionFile as {@link CrashlyticsReport.FilesPayload.File} object.\n+   */\n+  @Nullable\n+  CrashlyticsReport.FilesPayload.File asFilePayload();", "originalCommit": "15f091c2982ae62be7028eb2b81413bb7f90e285", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc2NzYwOA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393767608", "bodyText": "Short answer: Eventually getStream() will go away because this class will not have the old codepath, and this will just be the FilesPayloadSerializer.\nLong answer:\nYeah, I went back and forth on this a little bit myself. I didn't want to build the datatransport code on getStream() because it results in a double copy of a byte stream into a new byte stream.\n(wearing OOP nerd hat) There's actually a way to solve this where you separate out the data (bytes, files) and behavior (gzip from stream of bytes, gzip from filestream, datatransport from bytes of files or bytes of bytes).\nThe way is multiple dispatch. On java though, multiple dispatch has to be implemented via visitor pattern (implement a stream converter that visits the bytes / files, then converts to a stream, implement a filepayloadconverter that visits the bytes / files, and converts them to bytes). Doing so is pretty verbose. Since the API for getStream() is going away, I decided it was okay to just flatten them into this api, but if you wanted, I can switch to visitor.\nThis whole multiple dispatch challenge, for what it is worth, is called the \"expression problem\" https://eli.thegreenplace.net/2016/the-expression-problem-and-its-solutions/", "author": "jakeouellette", "createdAt": "2020-03-17T15:32:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY4OTU0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3ODY3Ng==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393778676", "bodyText": "\ud83e\udd13 alright, leave it the way it is. \ud83d\ude1d", "author": "mrwillis21", "createdAt": "2020-03-17T15:47:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY4OTU0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyMzY2Nw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393723667", "bodyText": "We should probably use 8192 here, as above.", "author": "mrwillis21", "createdAt": "2020-03-17T14:32:58Z", "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/NativeSessionFileGzipper.java", "diffHunk": "@@ -0,0 +1,69 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.crashlytics.internal.common;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.List;\n+import java.util.zip.GZIPOutputStream;\n+\n+/** Copies {@link NativeSessionFile} into gzipped files within a provided path. */\n+class NativeSessionFileGzipper {\n+\n+  static void processNativeSessions(File nativeSessionDirectory, List<NativeSessionFile> streams)\n+      throws IOException {\n+\n+    for (NativeSessionFile stream : streams) {\n+      InputStream inputStream = null;\n+      try {\n+        inputStream = stream.getStream();\n+        if (inputStream == null) {\n+          continue;\n+        }\n+        gzipInputStream(inputStream, new File(nativeSessionDirectory, stream.getName()));\n+      } catch (Exception e) {\n+        // Skip invalid files.\n+      } finally {\n+        CommonUtils.closeQuietly(inputStream);\n+      }\n+    }\n+  }\n+\n+  private static void gzipInputStream(@Nullable InputStream input, @NonNull File output)\n+      throws IOException {\n+    if (input == null) {\n+      return;\n+    }\n+    byte[] buffer = new byte[1024];", "originalCommit": "15f091c2982ae62be7028eb2b81413bb7f90e285", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc2OTMyMw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393769323", "bodyText": "This was copypasta of the other place where we were zipping, happy to switch it (I assumed each was set for domain-specific reasons of the objects they were serializing)", "author": "jakeouellette", "createdAt": "2020-03-17T15:35:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyMzY2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3OTIyOA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393779228", "bodyText": "Understood, yeah, no good reason for it.", "author": "mrwillis21", "createdAt": "2020-03-17T15:47:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyMzY2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNDIxNQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393724215", "bodyText": "Minor stylistic request: Can we call this finalizeSessionWithNativeEvent, passing the session ID and the native files?", "author": "mrwillis21", "createdAt": "2020-03-17T14:33:38Z", "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/SessionReportingCoordinator.java", "diffHunk": "@@ -130,6 +132,27 @@ public void persistNonFatalEvent(Throwable event, Thread thread, long timestamp)\n     persistEvent(event, thread, EVENT_TYPE_LOGGED, timestamp, false);\n   }\n \n+  public void finalizeNativeEvent(", "originalCommit": "15f091c2982ae62be7028eb2b81413bb7f90e285", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc2OTc5OQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393769799", "bodyText": "sure", "author": "jakeouellette", "createdAt": "2020-03-17T15:35:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNDIxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNDk4NQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393724985", "bodyText": "Same as above, can we call this finalizeSessionWithNativeEvent(sessionID, reportData, filesPayload)", "author": "mrwillis21", "createdAt": "2020-03-17T14:34:38Z", "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/SessionReportingCoordinator.java", "diffHunk": "@@ -130,6 +132,27 @@ public void persistNonFatalEvent(Throwable event, Thread thread, long timestamp)\n     persistEvent(event, thread, EVENT_TYPE_LOGGED, timestamp, false);\n   }\n \n+  public void finalizeNativeEvent(\n+      @NonNull List<NativeSessionFile> nativeSessionFiles, String sessionId) {\n+    try {\n+      FilesPayload.Builder filesPayloadBuilder = FilesPayload.builder();\n+      ArrayList<FilesPayload.File> nativeFiles = new ArrayList<>();\n+      for (NativeSessionFile nativeSessionFile : nativeSessionFiles) {\n+        FilesPayload.File filePayload = nativeSessionFile.asFilePayload();\n+        if (filePayload != null) {\n+          nativeFiles.add(filePayload);\n+        }\n+      }\n+\n+      filesPayloadBuilder.setFiles(ImmutableList.from(nativeFiles));\n+\n+      reportPersistence.finalizeNativeEvent(", "originalCommit": "15f091c2982ae62be7028eb2b81413bb7f90e285", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc2OTk1MA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393769950", "bodyText": "sure", "author": "jakeouellette", "createdAt": "2020-03-17T15:35:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNDk4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNTQxNg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393725416", "bodyText": "Is there any concern that we might have a situation where this is null, but session is as well?", "author": "mrwillis21", "createdAt": "2020-03-17T14:35:15Z", "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/model/CrashlyticsReport.java", "diffHunk": "@@ -98,6 +97,10 @@ public static Builder builder() {\n    */\n   @NonNull\n   public CrashlyticsReport withEvents(@NonNull ImmutableList<Event> events) {\n+    if (this.getNdkPayload() != null) {", "originalCommit": "15f091c2982ae62be7028eb2b81413bb7f90e285", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3MDU1MA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393770550", "bodyText": "I see what you mean, so check for getSession() == null and do illegal state then? sounds good", "author": "jakeouellette", "createdAt": "2020-03-17T15:36:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNTQxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3OTU4NA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393779584", "bodyText": "\ud83d\udc4d", "author": "mrwillis21", "createdAt": "2020-03-17T15:48:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNTQxNg=="}], "type": "inlineReview"}, {"oid": "2d6252b863a367b7696a5f7e7aac03c4b0f03be5", "url": "https://github.com/firebase/firebase-android-sdk/commit/2d6252b863a367b7696a5f7e7aac03c4b0f03be5", "message": "Add tests", "committedDate": "2020-03-17T19:05:51Z", "type": "forcePushed"}, {"oid": "8139b0aa148b9068b7c86f7ff9f05827f3eccf6e", "url": "https://github.com/firebase/firebase-android-sdk/commit/8139b0aa148b9068b7c86f7ff9f05827f3eccf6e", "message": "Interleave native and non-native high priority sessions", "committedDate": "2020-03-17T20:57:31Z", "type": "forcePushed"}, {"oid": "54ab6545c4bf0a2a52d2a79630b0b7ec9b6f79de", "url": "https://github.com/firebase/firebase-android-sdk/commit/54ab6545c4bf0a2a52d2a79630b0b7ec9b6f79de", "message": "Add FilesPayload for NDK reports", "committedDate": "2020-03-18T15:11:25Z", "type": "commit"}, {"oid": "3a1d179ddb49d2bb937bf1e25a25c266a08530fb", "url": "https://github.com/firebase/firebase-android-sdk/commit/3a1d179ddb49d2bb937bf1e25a25c266a08530fb", "message": "WIP", "committedDate": "2020-03-18T15:11:25Z", "type": "commit"}, {"oid": "9d5bc027f5675fca6cdca5d7c933095ebc009210", "url": "https://github.com/firebase/firebase-android-sdk/commit/9d5bc027f5675fca6cdca5d7c933095ebc009210", "message": "Implement strategy pattern for native sessions", "committedDate": "2020-03-18T15:11:25Z", "type": "commit"}, {"oid": "aae16420f4f23782c14ee9298ec073ce07a08cb3", "url": "https://github.com/firebase/firebase-android-sdk/commit/aae16420f4f23782c14ee9298ec073ce07a08cb3", "message": "Prep for next iteration", "committedDate": "2020-03-18T15:11:25Z", "type": "commit"}, {"oid": "84c793c03e316968bd20c0c09ae984338ff6cdb9", "url": "https://github.com/firebase/firebase-android-sdk/commit/84c793c03e316968bd20c0c09ae984338ff6cdb9", "message": "Refactor datatransport abstractions to support polymorphic handling of session parts", "committedDate": "2020-03-18T15:11:25Z", "type": "commit"}, {"oid": "70be19a14f940cc469e4fcb9e19be047204680b0", "url": "https://github.com/firebase/firebase-android-sdk/commit/70be19a14f940cc469e4fcb9e19be047204680b0", "message": "Address feedback", "committedDate": "2020-03-18T15:11:25Z", "type": "commit"}, {"oid": "867e464beb19b6fad67b7f0dd45fbf07cf388f1b", "url": "https://github.com/firebase/firebase-android-sdk/commit/867e464beb19b6fad67b7f0dd45fbf07cf388f1b", "message": "style", "committedDate": "2020-03-18T15:11:25Z", "type": "commit"}, {"oid": "89e196ed14647c69ed38df9a7eb3baef8dfac3c0", "url": "https://github.com/firebase/firebase-android-sdk/commit/89e196ed14647c69ed38df9a7eb3baef8dfac3c0", "message": "remove UTF-8", "committedDate": "2020-03-18T15:11:25Z", "type": "commit"}, {"oid": "8371820f3cf15b02ce3d71055630c9b08a206d63", "url": "https://github.com/firebase/firebase-android-sdk/commit/8371820f3cf15b02ce3d71055630c9b08a206d63", "message": "Add test classes", "committedDate": "2020-03-18T15:11:25Z", "type": "commit"}, {"oid": "7a76a10228271a0ae57044d552b6d7938ef5dc85", "url": "https://github.com/firebase/firebase-android-sdk/commit/7a76a10228271a0ae57044d552b6d7938ef5dc85", "message": "Add tests", "committedDate": "2020-03-18T15:11:25Z", "type": "commit"}, {"oid": "745cd569d9c476b9c98b785c632d74f5e8119c08", "url": "https://github.com/firebase/firebase-android-sdk/commit/745cd569d9c476b9c98b785c632d74f5e8119c08", "message": "Add tests and serialization of ndkpayload", "committedDate": "2020-03-18T15:11:25Z", "type": "commit"}, {"oid": "1d1610639ce521e790fa38d1154c550fe0c8a7d1", "url": "https://github.com/firebase/firebase-android-sdk/commit/1d1610639ce521e790fa38d1154c550fe0c8a7d1", "message": "Add settings field for NDK sessions through DataTransport", "committedDate": "2020-03-18T15:11:25Z", "type": "commit"}, {"oid": "d533e8bcc1d0dca81ec95d5fb186db242e922d52", "url": "https://github.com/firebase/firebase-android-sdk/commit/d533e8bcc1d0dca81ec95d5fb186db242e922d52", "message": "Wire up settings to send procedure", "committedDate": "2020-03-18T15:11:25Z", "type": "commit"}, {"oid": "a924bb24db040740ae866a957ae5f7cdb7d89c4b", "url": "https://github.com/firebase/firebase-android-sdk/commit/a924bb24db040740ae866a957ae5f7cdb7d89c4b", "message": "Interleave native and non-native high priority sessions", "committedDate": "2020-03-18T15:11:25Z", "type": "commit"}, {"oid": "fcc5426d6d4e030e940021096132a12fef460b35", "url": "https://github.com/firebase/firebase-android-sdk/commit/fcc5426d6d4e030e940021096132a12fef460b35", "message": "Add session ID abstraction to facilitate deleting NDK reports", "committedDate": "2020-03-18T15:11:25Z", "type": "commit"}, {"oid": "fcc5426d6d4e030e940021096132a12fef460b35", "url": "https://github.com/firebase/firebase-android-sdk/commit/fcc5426d6d4e030e940021096132a12fef460b35", "message": "Add session ID abstraction to facilitate deleting NDK reports", "committedDate": "2020-03-18T15:11:25Z", "type": "forcePushed"}, {"oid": "1796c160b784f9bcdf3aee34f283f83c235b83a8", "url": "https://github.com/firebase/firebase-android-sdk/commit/1796c160b784f9bcdf3aee34f283f83c235b83a8", "message": "Add tests for session coordinator and report persistence", "committedDate": "2020-03-18T17:27:49Z", "type": "commit"}, {"oid": "bcacb59e53266a695a4589d587fd02caa381e82f", "url": "https://github.com/firebase/firebase-android-sdk/commit/bcacb59e53266a695a4589d587fd02caa381e82f", "message": "Make Firebase session ID for native sessions", "committedDate": "2020-03-18T17:30:22Z", "type": "commit"}, {"oid": "56a4eeb2a96517c01f25c15ab61f892407124b6d", "url": "https://github.com/firebase/firebase-android-sdk/commit/56a4eeb2a96517c01f25c15ab61f892407124b6d", "message": "Add support for sending/deleting native crashes based on the settings values", "committedDate": "2020-03-18T19:30:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU5MzcwMw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r394593703", "bodyText": "Add a test here?", "author": "mrwillis21", "createdAt": "2020-03-18T19:37:19Z", "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/DataTransportState.java", "diffHunk": "@@ -0,0 +1,46 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.crashlytics.internal.common;\n+\n+import com.google.firebase.crashlytics.internal.settings.model.AppSettingsData;\n+\n+public enum DataTransportState {\n+  NONE,\n+  JAVA_ONLY,\n+  ALL;\n+\n+  // Used to determine whether to upload reports through the legacy reports endpoint\n+  static final int REPORT_UPLOAD_VARIANT_LEGACY = 1;\n+  // Used to determine whether to upload reports through the new DataTransport API.\n+  static final int REPORT_UPLOAD_VARIANT_DATATRANSPORT = 2;\n+\n+  static DataTransportState getState(boolean dataTransportState, boolean dataTransportNativeState) {\n+    if (!dataTransportState) {\n+      return NONE;\n+    }\n+    if (!dataTransportNativeState) {\n+      return JAVA_ONLY;\n+    }\n+    return ALL;\n+  }\n+\n+  static DataTransportState getState(AppSettingsData appSettingsData) {", "originalCommit": "56a4eeb2a96517c01f25c15ab61f892407124b6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "75257bfd39dd76c03ef92ade5d44d212fd7e6df2", "url": "https://github.com/firebase/firebase-android-sdk/commit/75257bfd39dd76c03ef92ade5d44d212fd7e6df2", "message": "Cleanup", "committedDate": "2020-03-18T19:56:48Z", "type": "commit"}, {"oid": "21313d7ab286e22f474715cde5d957068b3f5899", "url": "https://github.com/firebase/firebase-android-sdk/commit/21313d7ab286e22f474715cde5d957068b3f5899", "message": "Remove undone testS", "committedDate": "2020-03-18T19:57:35Z", "type": "commit"}, {"oid": "9173669d33fc89a5ebabe9777b69d681b031188d", "url": "https://github.com/firebase/firebase-android-sdk/commit/9173669d33fc89a5ebabe9777b69d681b031188d", "message": "Cleanup", "committedDate": "2020-03-18T20:59:00Z", "type": "commit"}, {"oid": "3d231e27995766513f71a266ba4d38ca65251a03", "url": "https://github.com/firebase/firebase-android-sdk/commit/3d231e27995766513f71a266ba4d38ca65251a03", "message": "Base ndk sessions on non-ndk sessions", "committedDate": "2020-03-18T21:25:32Z", "type": "commit"}, {"oid": "365d77322c64e6d307c1733ff6300ab5166ed11c", "url": "https://github.com/firebase/firebase-android-sdk/commit/365d77322c64e6d307c1733ff6300ab5166ed11c", "message": "Update paths to allow firelog to go to a different filename.\n\n- Update logs to prevent confusion around whether logs were sent", "committedDate": "2020-03-19T15:46:20Z", "type": "commit"}, {"oid": "cba4bff7bd8abcc9cd7bbb8b0a5bcff469a8cbde", "url": "https://github.com/firebase/firebase-android-sdk/commit/cba4bff7bd8abcc9cd7bbb8b0a5bcff469a8cbde", "message": "Make try { } catches less wide", "committedDate": "2020-03-19T19:57:26Z", "type": "commit"}, {"oid": "8d54a9cf35e9e75e2a19b22331267b82645cac95", "url": "https://github.com/firebase/firebase-android-sdk/commit/8d54a9cf35e9e75e2a19b22331267b82645cac95", "message": "Remove old withUserId method", "committedDate": "2020-03-19T20:01:13Z", "type": "commit"}, {"oid": "f2f3db36fd62ec519a5b87692d3aaf1385ddf89d", "url": "https://github.com/firebase/firebase-android-sdk/commit/f2f3db36fd62ec519a5b87692d3aaf1385ddf89d", "message": "Add null check for withSessionEndFields", "committedDate": "2020-03-19T20:11:14Z", "type": "commit"}, {"oid": "5c3f488a98c848755e2995af1489d6bbe9c663d6", "url": "https://github.com/firebase/firebase-android-sdk/commit/5c3f488a98c848755e2995af1489d6bbe9c663d6", "message": "Replace builder with simpler create method", "committedDate": "2020-03-19T20:45:38Z", "type": "commit"}]}