{"pr_number": 1404, "pr_title": "Pre-gzip the crashlytics payloads before sending them up", "pr_createdAt": "2020-03-31T19:35:35Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/1404", "timeline": [{"oid": "d049ede88a8c3778f2c36b76ba5b1f3b0c585194", "url": "https://github.com/firebase/firebase-android-sdk/commit/d049ede88a8c3778f2c36b76ba5b1f3b0c585194", "message": "Pre-gzip the crashlytics payloads before sending them up the firelog pipeline", "committedDate": "2020-03-31T18:39:54Z", "type": "commit"}, {"oid": "b552ced3bdc3c6a6d4b556726fcfff453ed24ae9", "url": "https://github.com/firebase/firebase-android-sdk/commit/b552ced3bdc3c6a6d4b556726fcfff453ed24ae9", "message": "Add tests", "committedDate": "2020-03-31T21:09:46Z", "type": "commit"}, {"oid": "b01fe64e5feb61d268285b68a5c3c3ae35dc18d4", "url": "https://github.com/firebase/firebase-android-sdk/commit/b01fe64e5feb61d268285b68a5c3c3ae35dc18d4", "message": "formatting try catches", "committedDate": "2020-03-31T21:21:22Z", "type": "forcePushed"}, {"oid": "63e7b54d060405b615301746a28b467a8a79258b", "url": "https://github.com/firebase/firebase-android-sdk/commit/63e7b54d060405b615301746a28b467a8a79258b", "message": "formatting try catches", "committedDate": "2020-03-31T21:23:34Z", "type": "commit"}, {"oid": "63e7b54d060405b615301746a28b467a8a79258b", "url": "https://github.com/firebase/firebase-android-sdk/commit/63e7b54d060405b615301746a28b467a8a79258b", "message": "formatting try catches", "committedDate": "2020-03-31T21:23:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI1NTY3MQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1404#discussion_r401255671", "bodyText": "This now becomes possibly nullable, where it was not before. Was that intended?", "author": "mrwillis21", "createdAt": "2020-03-31T22:36:51Z", "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/BytesBackedNativeSessionFile.java", "diffHunk": "@@ -53,12 +56,24 @@ public InputStream getStream() {\n     return isEmpty()\n         ? null\n         : CrashlyticsReport.FilesPayload.File.builder()\n-            .setContents(bytes)\n+            .setContents(asGzippedBytes())", "originalCommit": "63e7b54d060405b615301746a28b467a8a79258b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI1NjI2Nw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1404#discussion_r401256267", "bodyText": "Can we call this gzipToRawBytes, or inflateGzip or somesuch?", "author": "mrwillis21", "createdAt": "2020-03-31T22:38:28Z", "path": "firebase-crashlytics/src/androidTest/java/com/google/firebase/crashlytics/internal/common/TestUtils.java", "diffHunk": "@@ -33,4 +35,15 @@ public static void writeStringToFile(String s, File f) throws IOException {\n       }\n     }\n   }\n+\n+  public static byte[] gzipToBytes(byte[] compressed, int numBytes) {", "originalCommit": "63e7b54d060405b615301746a28b467a8a79258b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI1NjcwNw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1404#discussion_r401256707", "bodyText": "Also, using a ByteArrayOutputStream would allow you to not have to pass in the number of bytes of the uncompressed output.", "author": "mrwillis21", "createdAt": "2020-03-31T22:39:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI1NjI2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI1Njk3OA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1404#discussion_r401256978", "bodyText": "Is there value in using the same gzip function in both classes, so as to be assured that they, in fact, work the same way?", "author": "mrwillis21", "createdAt": "2020-03-31T22:40:18Z", "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/BytesBackedNativeSessionFile.java", "diffHunk": "@@ -53,12 +56,24 @@ public InputStream getStream() {\n     return isEmpty()\n         ? null\n         : CrashlyticsReport.FilesPayload.File.builder()\n-            .setContents(bytes)\n+            .setContents(asGzippedBytes())\n             .setFilename(dataTransportFilename)\n             .build();\n   }\n \n   private boolean isEmpty() {\n     return bytes == null || bytes.length == 0;\n   }\n+\n+  @Nullable\n+  private byte[] asGzippedBytes() {\n+    try (ByteArrayOutputStream bos = new ByteArrayOutputStream();", "originalCommit": "63e7b54d060405b615301746a28b467a8a79258b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI1OTg0OQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1404#discussion_r401259849", "bodyText": "Talked about this offline. Decided it's fine.", "author": "mrwillis21", "createdAt": "2020-03-31T22:48:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI1Njk3OA=="}], "type": "inlineReview"}, {"oid": "746e3896811fd708a25343e36c5c547a665d57bb", "url": "https://github.com/firebase/firebase-android-sdk/commit/746e3896811fd708a25343e36c5c547a665d57bb", "message": "Address feedback from matt", "committedDate": "2020-04-01T00:08:13Z", "type": "commit"}]}