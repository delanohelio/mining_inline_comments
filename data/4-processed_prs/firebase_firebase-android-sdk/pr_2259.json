{"pr_number": 2259, "pr_title": "Added FirebaseMlException and Logging round 1.", "pr_createdAt": "2020-12-15T19:37:32Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/2259", "timeline": [{"oid": "fc4307b700eebb7f9c34f41760610d41f71294a4", "url": "https://github.com/firebase/firebase-android-sdk/commit/fc4307b700eebb7f9c34f41760610d41f71294a4", "message": "Added FirebaseMlException and Logging round 1.", "committedDate": "2020-12-15T18:58:34Z", "type": "commit"}, {"oid": "2b496949b69f82787ce1913f1d0c5bf9c57fdbf4", "url": "https://github.com/firebase/firebase-android-sdk/commit/2b496949b69f82787ce1913f1d0c5bf9c57fdbf4", "message": "Updating files per failed tests.", "committedDate": "2020-12-15T19:54:06Z", "type": "commit"}, {"oid": "5cae37486065c0738a57e917600f133ff5cd24d4", "url": "https://github.com/firebase/firebase-android-sdk/commit/5cae37486065c0738a57e917600f133ff5cd24d4", "message": "Fixing to single junit.", "committedDate": "2020-12-15T20:42:02Z", "type": "commit"}, {"oid": "7c80a09c9a626a10cca11d7da57bd50c4db301a9", "url": "https://github.com/firebase/firebase-android-sdk/commit/7c80a09c9a626a10cca11d7da57bd50c4db301a9", "message": "Updates FirebaseMlLogEvent ModelOption name to Options to make internal proto. This allows for proper json to proto conversion and in local tests messages now reach the spanner queue.", "committedDate": "2020-12-17T20:32:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAxODY3OA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2259#discussion_r552018678", "bodyText": "add option 'lite' (see firebase-firestore.gradle )", "author": "rlazo", "createdAt": "2021-01-05T15:50:44Z", "path": "firebase-ml-modeldownloader/firebase-ml-modeldownloader.gradle", "diffHunk": "@@ -14,13 +14,29 @@\n \n plugins {\n     id 'firebase-library'\n+    id 'com.google.protobuf'\n }\n \n firebaseLibrary {\n     testLab.enabled = false\n     publishJavadoc = false\n }\n \n+protobuf {\n+    // Configure the protoc executable\n+    protoc {\n+        // Download from repositories\n+        artifact = \"com.google.protobuf:protoc:$protocVersion\"\n+    }\n+    generateProtoTasks {\n+        all().each { task ->\n+            task.builtins {\n+                java { }", "originalCommit": "7c80a09c9a626a10cca11d7da57bd50c4db301a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjA2Nzk3Mg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2259#discussion_r552067972", "bodyText": "If I add that then - JsonFormat.parser().merge fails (based on testLogRequest_jsontToProto) which doesn't use lite option. Can you suggest an alternative?", "author": "annzimmer", "createdAt": "2021-01-05T17:06:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAxODY3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjEzMTI2Ng==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2259#discussion_r552131266", "bodyText": "Also note - the proto is only for testing and shouldn't affect the sdk sizing.", "author": "annzimmer", "createdAt": "2021-01-05T19:00:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAxODY3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjE0MzE3MQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2259#discussion_r552143171", "bodyText": "Oh, right. JsonFormat parser actually requires the full runtime to work. Since it's used for tests, I think you can do the same crashlytics is doing https://github.com/firebase/firebase-android-sdk/blob/master/firebase-crashlytics/firebase-crashlytics.gradle#L88\njust use testImplementation instead of androidTestImplementation", "author": "rlazo", "createdAt": "2021-01-05T19:23:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAxODY3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjE4MzkxMw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2259#discussion_r552183913", "bodyText": "removed all the androidTestImplementation - these were not used. The encoding was already there for the regular implementation level (and validated it is needed at that level)", "author": "annzimmer", "createdAt": "2021-01-05T20:45:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAxODY3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjI5NTczMA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2259#discussion_r552295730", "bodyText": "AFAIK you can just get rid of the whole generateProtoTasks sections.", "author": "rlazo", "createdAt": "2021-01-06T00:51:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAxODY3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjY4NDMxMA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2259#discussion_r552684310", "bodyText": "Appears required - gives error when removed:\nExecution failed for task ':firebase-ml-modeldownloader:generateDebugUnitTestProto'.\nprotoc: stdout: . stderr: Missing output directives.", "author": "annzimmer", "createdAt": "2021-01-06T14:52:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAxODY3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjcwNjQ4MQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2259#discussion_r552706481", "bodyText": "Got it. Thanks for following through!", "author": "rlazo", "createdAt": "2021-01-06T15:18:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAxODY3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAxODk1Nw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2259#discussion_r552018957", "bodyText": "any reason to move away from the common version?", "author": "rlazo", "createdAt": "2021-01-05T15:51:11Z", "path": "firebase-ml-modeldownloader/firebase-ml-modeldownloader.gradle", "diffHunk": "@@ -43,25 +59,39 @@ android {\n }\n \n dependencies {\n+    implementation project(':encoders:firebase-encoders')\n+    implementation project(':encoders:firebase-encoders-json')\n     implementation project(':firebase-common')\n     implementation project(':firebase-components')\n+    implementation project(':firebase-datatransport')\n     implementation project(':firebase-installations-interop')\n+    implementation project(':transport:transport-api')\n+    implementation project(':transport:transport-runtime')\n     runtimeOnly project(':firebase-installations')\n \n+    implementation 'androidx.annotation:annotation:1.1.0'\n     implementation 'com.google.android.gms:play-services-tasks:17.2.0'\n     implementation 'com.google.auto.service:auto-service-annotations:1.0-rc6'\n     implementation 'javax.inject:javax.inject:1'\n \n     compileOnly \"com.google.auto.value:auto-value-annotations:1.6.6\"\n     annotationProcessor \"com.google.auto.value:auto-value:1.6.5\"\n+    annotationProcessor project(\":encoders:firebase-encoders-processor\")\n \n     testImplementation 'androidx.test:core:1.3.0'\n     testImplementation 'com.github.tomakehurst:wiremock-standalone:2.26.3'\n-    testImplementation \"com.google.truth:truth:$googleTruthVersion\"\n-    testImplementation 'junit:junit:4.13.1'\n+    testImplementation \"com.google.truth:truth:1.0.1\"", "originalCommit": "7c80a09c9a626a10cca11d7da57bd50c4db301a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjA2ODA1MQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2259#discussion_r552068051", "bodyText": "fixed", "author": "annzimmer", "createdAt": "2021-01-05T17:07:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAxODk1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAzNjk1NQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2259#discussion_r552036955", "bodyText": "missing javadoc", "author": "rlazo", "createdAt": "2021-01-05T16:18:09Z", "path": "firebase-ml-modeldownloader/src/main/java/com/google/firebase/ml/modeldownloader/internal/SharedPreferencesUtil.java", "diffHunk": "@@ -244,6 +250,68 @@ public synchronized void clearModelDetails(@NonNull String modelName) {\n     return customModels;\n   }\n \n+  /**\n+   * Should Firelog logging be enabled.\n+   *\n+   * @return whether or not firelog events should be logged. Default to true.\n+   */\n+  public synchronized boolean getCustomModelStatsCollectionFlag() {\n+    return getSharedPreferences()\n+        .getBoolean(\n+            String.format(EVENT_LOGGING_ENABLED_PATTERN, CUSTOM_MODEL_LIB, persistenceKey), true);\n+  }\n+\n+  /**\n+   * Set whether firelog logging should be enabled. When not explicitly set, the default is true.\n+   *\n+   * @param enable - False to turn off logging. True to turn on logging.\n+   */\n+  public synchronized void setCustomModelStatsCollectionEnabled(boolean enable) {\n+    getSharedPreferences()\n+        .edit()\n+        .putBoolean(\n+            String.format(EVENT_LOGGING_ENABLED_PATTERN, CUSTOM_MODEL_LIB, persistenceKey), enable)\n+        .apply();\n+  }\n+\n+  public synchronized long getModelDownloadBeginTimeMs(@NonNull CustomModel customModel) {", "originalCommit": "7c80a09c9a626a10cca11d7da57bd50c4db301a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjA2ODI0MQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2259#discussion_r552068241", "bodyText": "done", "author": "annzimmer", "createdAt": "2021-01-05T17:07:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAzNjk1NQ=="}], "type": "inlineReview"}, {"oid": "3b1e244e6bc85495170b7ddd0e4d9a3f7df13eb0", "url": "https://github.com/firebase/firebase-android-sdk/commit/3b1e244e6bc85495170b7ddd0e4d9a3f7df13eb0", "message": "Add ability to get download id for file progress tracking.", "committedDate": "2021-01-05T17:05:23Z", "type": "commit"}, {"oid": "6aa3bb1ac4cb992695524a359ef2135f1cf2dd5b", "url": "https://github.com/firebase/firebase-android-sdk/commit/6aa3bb1ac4cb992695524a359ef2135f1cf2dd5b", "message": "removing androidTestImplementation - these are not used.", "committedDate": "2021-01-05T20:42:20Z", "type": "commit"}, {"oid": "f4d85e8a4d69f8c9cbe3a132a155d6792c8b3fd9", "url": "https://github.com/firebase/firebase-android-sdk/commit/f4d85e8a4d69f8c9cbe3a132a155d6792c8b3fd9", "message": "Merge branch 'master' into mlLogging2", "committedDate": "2021-01-06T17:32:50Z", "type": "commit"}]}