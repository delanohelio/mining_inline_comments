{"pr_number": 1458, "pr_title": "Removing try-with-resources", "pr_createdAt": "2020-04-13T23:31:29Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/1458", "timeline": [{"oid": "4283a2bb3b4434510e061a0d9c4b080595658c2a", "url": "https://github.com/firebase/firebase-android-sdk/commit/4283a2bb3b4434510e061a0d9c4b080595658c2a", "message": "Dropping guava and appcompat dependency from FIS SDK.", "committedDate": "2020-02-06T17:59:09Z", "type": "commit"}, {"oid": "984884cd6f9a90a8172d0957bd13e68e3f06db2f", "url": "https://github.com/firebase/firebase-android-sdk/commit/984884cd6f9a90a8172d0957bd13e68e3f06db2f", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-02-06T18:16:08Z", "type": "commit"}, {"oid": "a82387701d2549bb5fc3b5dc2530a83ed0680d02", "url": "https://github.com/firebase/firebase-android-sdk/commit/a82387701d2549bb5fc3b5dc2530a83ed0680d02", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-02-11T18:58:16Z", "type": "commit"}, {"oid": "afcb14c913c8dedd87faf6b71fdc7dd4384a6c39", "url": "https://github.com/firebase/firebase-android-sdk/commit/afcb14c913c8dedd87faf6b71fdc7dd4384a6c39", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-02-13T23:37:48Z", "type": "commit"}, {"oid": "5574e30b8e3f6c9d09bfca149a6f7853c4141d25", "url": "https://github.com/firebase/firebase-android-sdk/commit/5574e30b8e3f6c9d09bfca149a6f7853c4141d25", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-05T16:49:33Z", "type": "commit"}, {"oid": "a5dd4dc54f2b7941ffe4b5cd76b6c8ab5764f7a1", "url": "https://github.com/firebase/firebase-android-sdk/commit/a5dd4dc54f2b7941ffe4b5cd76b6c8ab5764f7a1", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-09T16:31:08Z", "type": "commit"}, {"oid": "45312e68fe8516dc4d48a2bfdb422f5023c1241b", "url": "https://github.com/firebase/firebase-android-sdk/commit/45312e68fe8516dc4d48a2bfdb422f5023c1241b", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-10T18:13:59Z", "type": "commit"}, {"oid": "f0be4fa07222c687044f66d8cb2859e156611896", "url": "https://github.com/firebase/firebase-android-sdk/commit/f0be4fa07222c687044f66d8cb2859e156611896", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-10T21:55:48Z", "type": "commit"}, {"oid": "ac0397ba816265b24da3eca4645761a37d4b46b6", "url": "https://github.com/firebase/firebase-android-sdk/commit/ac0397ba816265b24da3eca4645761a37d4b46b6", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-11T18:14:18Z", "type": "commit"}, {"oid": "8f6b46e3346cad5d3a4128ad1316e9e0831c0a2b", "url": "https://github.com/firebase/firebase-android-sdk/commit/8f6b46e3346cad5d3a4128ad1316e9e0831c0a2b", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-12T19:40:52Z", "type": "commit"}, {"oid": "686a998ab40a6c855d81b30f7686ef20aef1713c", "url": "https://github.com/firebase/firebase-android-sdk/commit/686a998ab40a6c855d81b30f7686ef20aef1713c", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-16T17:31:01Z", "type": "commit"}, {"oid": "3bf7c24892fc6d66b4b33cb943ac2fe9e3e11598", "url": "https://github.com/firebase/firebase-android-sdk/commit/3bf7c24892fc6d66b4b33cb943ac2fe9e3e11598", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-18T21:05:27Z", "type": "commit"}, {"oid": "07ff7ddc966270c28df8d123ef95e63a9f058494", "url": "https://github.com/firebase/firebase-android-sdk/commit/07ff7ddc966270c28df8d123ef95e63a9f058494", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-30T21:58:00Z", "type": "commit"}, {"oid": "f982f2d752d3567a1164b6f3bb00a1dfc601ab91", "url": "https://github.com/firebase/firebase-android-sdk/commit/f982f2d752d3567a1164b6f3bb00a1dfc601ab91", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-31T22:05:19Z", "type": "commit"}, {"oid": "672526aca799c55e7f83aaa0f08c7e698be388ed", "url": "https://github.com/firebase/firebase-android-sdk/commit/672526aca799c55e7f83aaa0f08c7e698be388ed", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-04-05T05:34:09Z", "type": "commit"}, {"oid": "1adf4a2621f9367521f806ea893770921713e49f", "url": "https://github.com/firebase/firebase-android-sdk/commit/1adf4a2621f9367521f806ea893770921713e49f", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-04-07T20:56:39Z", "type": "commit"}, {"oid": "4435ed00d6c6d59ae1dd2442e034c75873bf8ed8", "url": "https://github.com/firebase/firebase-android-sdk/commit/4435ed00d6c6d59ae1dd2442e034c75873bf8ed8", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-04-10T21:22:37Z", "type": "commit"}, {"oid": "99f1f827dac599f04bd69eea5a49c1596eadf49a", "url": "https://github.com/firebase/firebase-android-sdk/commit/99f1f827dac599f04bd69eea5a49c1596eadf49a", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-04-13T22:51:18Z", "type": "commit"}, {"oid": "1b123ce745f7555a47c5f6288f7e882db1a47b6d", "url": "https://github.com/firebase/firebase-android-sdk/commit/1b123ce745f7555a47c5f6288f7e882db1a47b6d", "message": "Removing try-with-resources", "committedDate": "2020-04-13T23:30:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwODUxMA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r407808510", "bodyText": "2 Questions:\na) Do we want to catch the IOExceptions here?\nThought process is this:\nIf an IOException is thrown during closing, do we really want to interrupt the normal process of FIS?\nb) If your answer to (a) is \"no\", could you please add a comment explaining your decision?", "author": "andirayo", "createdAt": "2020-04-14T01:14:50Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -205,13 +205,16 @@ private void writeFIDCreateRequestBodyToOutputStream(\n \n   private static void writeRequestBodyToOutputStream(URLConnection urlConnection, byte[] jsonBytes)\n       throws IOException {\n-    try (OutputStream outputStream = urlConnection.getOutputStream()) {\n-      if (outputStream == null) {\n-        throw new IOException(\"Cannot send request to FIS servers. No OutputStream available.\");\n-      }\n-      try (GZIPOutputStream gzipOutputStream = new GZIPOutputStream(outputStream)) {\n-        gzipOutputStream.write(jsonBytes);\n-      }\n+    OutputStream outputStream = urlConnection.getOutputStream();\n+    if (outputStream == null) {\n+      throw new IOException(\"Cannot send request to FIS servers. No OutputStream available.\");\n+    }\n+    GZIPOutputStream gzipOutputStream = new GZIPOutputStream(outputStream);\n+    try {\n+      gzipOutputStream.write(jsonBytes);\n+    } finally {\n+      gzipOutputStream.close();\n+      outputStream.close();", "originalCommit": "1b123ce745f7555a47c5f6288f7e882db1a47b6d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMxNjg3MQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r408316871", "bodyText": "Caught the exception. But, I hate these checks and code. It was so much cleaner and easy to maintain before.", "author": "ankitaj224", "createdAt": "2020-04-14T17:38:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwODUxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwODg1Mw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r407808853", "bodyText": "This can throw an IOException, yeah?\nNot sure, but I think you should do the following:\nBuffered reader = null;\ntry {\n reader = new BufferedReader(new InputStreamReader(conn.getErrorStream(), UTF_8));", "author": "andirayo", "createdAt": "2020-04-14T01:16:18Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -525,8 +528,8 @@ private static void logFisCommunicationError(HttpURLConnection conn) {\n   // Read the error message from the response.\n   @Nullable\n   private static String readErrorResponse(HttpURLConnection conn) {\n-    try (BufferedReader reader =\n-        new BufferedReader(new InputStreamReader(conn.getErrorStream(), UTF_8))) {\n+    BufferedReader reader = new BufferedReader(new InputStreamReader(conn.getErrorStream(), UTF_8));", "originalCommit": "1b123ce745f7555a47c5f6288f7e882db1a47b6d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyMzYyNg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r408323626", "bodyText": "Buffer reader creation can't. It could throw null pointer exception which is handled. PTAL.", "author": "ankitaj224", "createdAt": "2020-04-14T17:49:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwODg1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwOTA0MA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r407809040", "bodyText": "I recommend pulling the if-clause around the try-clause.", "author": "andirayo", "createdAt": "2020-04-14T01:17:01Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -536,6 +539,14 @@ private static String readErrorResponse(HttpURLConnection conn) {\n           conn.getResponseCode(), conn.getResponseMessage(), response);\n     } catch (IOException ignored) {\n       return null;\n+    } finally {\n+      try {\n+        if (reader != null) {", "originalCommit": "1b123ce745f7555a47c5f6288f7e882db1a47b6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ba699db7773bf149c9d1bba7f1b94092e6878454", "url": "https://github.com/firebase/firebase-android-sdk/commit/ba699db7773bf149c9d1bba7f1b94092e6878454", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk into fixTry", "committedDate": "2020-04-14T17:20:59Z", "type": "commit"}, {"oid": "d7a81975fe28d521138a8a4905c7b7f7ad775bb3", "url": "https://github.com/firebase/firebase-android-sdk/commit/d7a81975fe28d521138a8a4905c7b7f7ad775bb3", "message": "Fix for Rayo's comments", "committedDate": "2020-04-14T17:45:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyNjE1Mg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r408326152", "bodyText": "Probably an unrelated question, feel free to just acknowledge:\nCan this ever be NULL, similar to outputStream above?\nProbably not, huh?", "author": "andirayo", "createdAt": "2020-04-14T17:53:06Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -205,12 +205,19 @@ private void writeFIDCreateRequestBodyToOutputStream(\n \n   private static void writeRequestBodyToOutputStream(URLConnection urlConnection, byte[] jsonBytes)\n       throws IOException {\n-    try (OutputStream outputStream = urlConnection.getOutputStream()) {\n-      if (outputStream == null) {\n-        throw new IOException(\"Cannot send request to FIS servers. No OutputStream available.\");\n-      }\n-      try (GZIPOutputStream gzipOutputStream = new GZIPOutputStream(outputStream)) {\n-        gzipOutputStream.write(jsonBytes);\n+    OutputStream outputStream = urlConnection.getOutputStream();\n+    if (outputStream == null) {\n+      throw new IOException(\"Cannot send request to FIS servers. No OutputStream available.\");\n+    }\n+    GZIPOutputStream gzipOutputStream = new GZIPOutputStream(outputStream);", "originalCommit": "d7a81975fe28d521138a8a4905c7b7f7ad775bb3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzMjU2Mw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r408332563", "bodyText": "It cant be null. I validated that. It throw NPE or returns a valid GzipOutputStream.", "author": "ankitaj224", "createdAt": "2020-04-14T18:03:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyNjE1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyNzc2NQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r408327765", "bodyText": "nice!", "author": "andirayo", "createdAt": "2020-04-14T17:55:39Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -525,8 +532,12 @@ private static void logFisCommunicationError(HttpURLConnection conn) {\n   // Read the error message from the response.\n   @Nullable\n   private static String readErrorResponse(HttpURLConnection conn) {\n-    try (BufferedReader reader =\n-        new BufferedReader(new InputStreamReader(conn.getErrorStream(), UTF_8))) {\n+    InputStream errorStream = conn.getErrorStream();\n+    if (errorStream == null) {\n+      return null;\n+    }", "originalCommit": "d7a81975fe28d521138a8a4905c7b7f7ad775bb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}