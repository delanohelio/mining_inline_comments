{"pr_number": 1644, "pr_title": "feat(storage-ktx): destructure ListResult and TaskSnapshots", "pr_createdAt": "2020-06-11T20:35:10Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/1644", "timeline": [{"oid": "2259a356f233ebfe85221dac5be5d46fd5b08cdc", "url": "https://github.com/firebase/firebase-android-sdk/commit/2259a356f233ebfe85221dac5be5d46fd5b08cdc", "message": "feat(storage-ktx): destructure ListResult and TaskSnapshots", "committedDate": "2020-06-11T20:06:06Z", "type": "commit"}, {"oid": "e39ca86cb68a1fae49cb83f8f4cdee53e5df6960", "url": "https://github.com/firebase/firebase-android-sdk/commit/e39ca86cb68a1fae49cb83f8f4cdee53e5df6960", "message": "test(storage-ktx): add unit tests for destructured classes", "committedDate": "2020-06-15T15:33:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY5MTM3OQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1644#discussion_r453691379", "bodyText": "Should the developers be able to mutate the list or can we return just List<StorageReference> here?\ncc @schmidt-sebastian", "author": "vkryachko", "createdAt": "2020-07-13T14:29:36Z", "path": "firebase-storage/ktx/src/main/kotlin/com/google/firebase/storage/ktx/Storage.kt", "diffHunk": "@@ -45,6 +50,90 @@ fun storageMetadata(init: StorageMetadata.Builder.() -> Unit): StorageMetadata {\n     return builder.build()\n }\n \n+/**\n+ * Destructuring declaration for [UploadTask.TaskSnapshot] to provide bytesTransferred\n+ *\n+ * @return the bytesTransferred of the [UploadTask.TaskSnapshot]\n+ */\n+operator fun UploadTask.TaskSnapshot.component1() = bytesTransferred\n+\n+/**\n+ * Destructuring declaration for [UploadTask.TaskSnapshot] to provide totalByteCount\n+ *\n+ * @return the totalByteCount of the [UploadTask.TaskSnapshot]\n+ */\n+operator fun UploadTask.TaskSnapshot.component2() = totalByteCount\n+\n+/**\n+ * Destructuring declaration for [UploadTask.TaskSnapshot] to provide its metadata\n+ *\n+ * @return the metadata of the [UploadTask.TaskSnapshot]\n+ */\n+operator fun UploadTask.TaskSnapshot.component3() = metadata\n+\n+/**\n+ * Destructuring declaration for [UploadTask.TaskSnapshot] to provide its uploadSessionUri\n+ *\n+ * @return the uploadSessionUri of the [UploadTask.TaskSnapshot]\n+ */\n+operator fun UploadTask.TaskSnapshot.component4() = uploadSessionUri\n+\n+/**\n+ * Destructuring declaration for [StreamDownloadTask.TaskSnapshot] to provide bytesTransferred\n+ *\n+ * @return the bytesTransferred of the [StreamDownloadTask.TaskSnapshot]\n+ */\n+operator fun StreamDownloadTask.TaskSnapshot.component1() = bytesTransferred\n+\n+/**\n+ * Destructuring declaration for [StreamDownloadTask.TaskSnapshot] to provide totalByteCount\n+ *\n+ * @return the totalByteCount of the [StreamDownloadTask.TaskSnapshot]\n+ */\n+operator fun StreamDownloadTask.TaskSnapshot.component2() = totalByteCount\n+\n+/**\n+ * Destructuring declaration for [StreamDownloadTask.TaskSnapshot] to provide its stream\n+ *\n+ * @return the stream of the [StreamDownloadTask.TaskSnapshot]\n+ */\n+operator fun StreamDownloadTask.TaskSnapshot.component3() = stream\n+\n+/**\n+ * Destructuring declaration for [FileDownloadTask.TaskSnapshot] to provide bytesTransferred\n+ *\n+ * @return the bytesTransferred of the [FileDownloadTask.TaskSnapshot]\n+ */\n+operator fun FileDownloadTask.TaskSnapshot.component1() = bytesTransferred\n+\n+/**\n+ * Destructuring declaration for [FileDownloadTask.TaskSnapshot] to provide totalByteCount\n+ *\n+ * @return the totalByteCount of the [FileDownloadTask.TaskSnapshot]\n+ */\n+operator fun FileDownloadTask.TaskSnapshot.component2() = totalByteCount\n+\n+/**\n+ * Destructuring declaration for [ListResult] to provide its items\n+ *\n+ * @return the items of the [ListResult]\n+ */\n+operator fun ListResult.component1(): MutableList<StorageReference> = items", "originalCommit": "2259a356f233ebfe85221dac5be5d46fd5b08cdc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzczMzY0OA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1644#discussion_r453733648", "bodyText": "@vkryachko Seems like you're right. The java code does return an immutable list:\n\n  \n    \n      firebase-android-sdk/firebase-storage/src/main/java/com/google/firebase/storage/ListResult.java\n    \n    \n        Lines 86 to 89\n      in\n      334aa44\n    \n    \n    \n    \n\n        \n          \n           @NonNull \n        \n\n        \n          \n           public List<StorageReference> getItems() { \n        \n\n        \n          \n             return items; \n        \n\n        \n          \n           } \n        \n    \n  \n\n\nThe MutableList return type was  mistakenly added by the IDE when auto-fixing this lint warning:", "author": "thatfiredev", "createdAt": "2020-07-13T15:27:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY5MTM3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc3OTA2Mw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1644#discussion_r453779063", "bodyText": "List<StorageReference> is the correct return type.", "author": "schmidt-sebastian", "createdAt": "2020-07-13T16:33:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY5MTM3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc4NDI1MA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1644#discussion_r453784250", "bodyText": "Thanks for the confirmation @schmidt-sebastian\nPushed a new commit with the update.", "author": "thatfiredev", "createdAt": "2020-07-13T16:42:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY5MTM3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY5MTQ0NA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1644#discussion_r453691444", "bodyText": "same question here?", "author": "vkryachko", "createdAt": "2020-07-13T14:29:43Z", "path": "firebase-storage/ktx/src/main/kotlin/com/google/firebase/storage/ktx/Storage.kt", "diffHunk": "@@ -45,6 +50,90 @@ fun storageMetadata(init: StorageMetadata.Builder.() -> Unit): StorageMetadata {\n     return builder.build()\n }\n \n+/**\n+ * Destructuring declaration for [UploadTask.TaskSnapshot] to provide bytesTransferred\n+ *\n+ * @return the bytesTransferred of the [UploadTask.TaskSnapshot]\n+ */\n+operator fun UploadTask.TaskSnapshot.component1() = bytesTransferred\n+\n+/**\n+ * Destructuring declaration for [UploadTask.TaskSnapshot] to provide totalByteCount\n+ *\n+ * @return the totalByteCount of the [UploadTask.TaskSnapshot]\n+ */\n+operator fun UploadTask.TaskSnapshot.component2() = totalByteCount\n+\n+/**\n+ * Destructuring declaration for [UploadTask.TaskSnapshot] to provide its metadata\n+ *\n+ * @return the metadata of the [UploadTask.TaskSnapshot]\n+ */\n+operator fun UploadTask.TaskSnapshot.component3() = metadata\n+\n+/**\n+ * Destructuring declaration for [UploadTask.TaskSnapshot] to provide its uploadSessionUri\n+ *\n+ * @return the uploadSessionUri of the [UploadTask.TaskSnapshot]\n+ */\n+operator fun UploadTask.TaskSnapshot.component4() = uploadSessionUri\n+\n+/**\n+ * Destructuring declaration for [StreamDownloadTask.TaskSnapshot] to provide bytesTransferred\n+ *\n+ * @return the bytesTransferred of the [StreamDownloadTask.TaskSnapshot]\n+ */\n+operator fun StreamDownloadTask.TaskSnapshot.component1() = bytesTransferred\n+\n+/**\n+ * Destructuring declaration for [StreamDownloadTask.TaskSnapshot] to provide totalByteCount\n+ *\n+ * @return the totalByteCount of the [StreamDownloadTask.TaskSnapshot]\n+ */\n+operator fun StreamDownloadTask.TaskSnapshot.component2() = totalByteCount\n+\n+/**\n+ * Destructuring declaration for [StreamDownloadTask.TaskSnapshot] to provide its stream\n+ *\n+ * @return the stream of the [StreamDownloadTask.TaskSnapshot]\n+ */\n+operator fun StreamDownloadTask.TaskSnapshot.component3() = stream\n+\n+/**\n+ * Destructuring declaration for [FileDownloadTask.TaskSnapshot] to provide bytesTransferred\n+ *\n+ * @return the bytesTransferred of the [FileDownloadTask.TaskSnapshot]\n+ */\n+operator fun FileDownloadTask.TaskSnapshot.component1() = bytesTransferred\n+\n+/**\n+ * Destructuring declaration for [FileDownloadTask.TaskSnapshot] to provide totalByteCount\n+ *\n+ * @return the totalByteCount of the [FileDownloadTask.TaskSnapshot]\n+ */\n+operator fun FileDownloadTask.TaskSnapshot.component2() = totalByteCount\n+\n+/**\n+ * Destructuring declaration for [ListResult] to provide its items\n+ *\n+ * @return the items of the [ListResult]\n+ */\n+operator fun ListResult.component1(): MutableList<StorageReference> = items\n+\n+/**\n+ * Destructuring declaration for [ListResult] to provide its prefixes\n+ *\n+ * @return the prefixes of the [ListResult]\n+ */\n+operator fun ListResult.component2(): MutableList<StorageReference> = prefixes", "originalCommit": "2259a356f233ebfe85221dac5be5d46fd5b08cdc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e3db26784ba71654eff9289ffcf1b5e525a69631", "url": "https://github.com/firebase/firebase-android-sdk/commit/e3db26784ba71654eff9289ffcf1b5e525a69631", "message": "MutableList --> List", "committedDate": "2020-07-13T16:19:40Z", "type": "commit"}, {"oid": "8e2e55453063e06f60cf42c51e01cc0d9b4b6e36", "url": "https://github.com/firebase/firebase-android-sdk/commit/8e2e55453063e06f60cf42c51e01cc0d9b4b6e36", "message": "Merge branch 'master' of https://github.com/firebase/firebase-android-sdk into rpf-storage-ktx-desctructure\n\n\u0001 Conflicts:\n\u0001\tfirebase-storage/ktx/src/main/kotlin/com/google/firebase/storage/ktx/Storage.kt", "committedDate": "2020-07-13T16:20:17Z", "type": "commit"}, {"oid": "6676660c1fecbfcb6eceda48f979f7016a944827", "url": "https://github.com/firebase/firebase-android-sdk/commit/6676660c1fecbfcb6eceda48f979f7016a944827", "message": "Merge branch 'master' of https://github.com/firebase/firebase-android-sdk into rpf-storage-ktx-desctructure\n\n\u0001 Conflicts:\n\u0001\tfirebase-storage/ktx/src/main/kotlin/com/google/firebase/storage/ktx/Storage.kt", "committedDate": "2020-07-13T16:45:28Z", "type": "commit"}, {"oid": "6a9ead603152d5a3ee43d0ee9c2cf8a1718b495b", "url": "https://github.com/firebase/firebase-android-sdk/commit/6a9ead603152d5a3ee43d0ee9c2cf8a1718b495b", "message": "Merge remote-tracking branch 'origin/rpf-storage-ktx-desctructure' into rpf-storage-ktx-desctructure\n\n# Conflicts:\n#\tfirebase-storage/ktx/src/main/kotlin/com/google/firebase/storage/ktx/Storage.kt", "committedDate": "2020-07-13T16:46:11Z", "type": "commit"}, {"oid": "5dec4e421348fefab8a8affb87e9d0e347e31b45", "url": "https://github.com/firebase/firebase-android-sdk/commit/5dec4e421348fefab8a8affb87e9d0e347e31b45", "message": "remove duplicated imports", "committedDate": "2020-07-13T16:47:32Z", "type": "commit"}, {"oid": "b08685b6016e85b96270f164d9792045f8d68917", "url": "https://github.com/firebase/firebase-android-sdk/commit/b08685b6016e85b96270f164d9792045f8d68917", "message": "style: re-organize imports", "committedDate": "2020-07-13T17:36:25Z", "type": "commit"}, {"oid": "2ac8d829d868584a4c1929061c85c226669ceb52", "url": "https://github.com/firebase/firebase-android-sdk/commit/2ac8d829d868584a4c1929061c85c226669ceb52", "message": "Merge branch 'rpf-storage-ktx-destructure-tests' of https://github.com/rosariopfernandes/firebase-android-sdk into rpf-storage-ktx-desctructure\n\n\u0001 Conflicts:\n\u0001\tfirebase-storage/ktx/src/test/kotlin/com/google/firebase/storage/ktx/StorageTest.kt", "committedDate": "2020-07-15T10:52:57Z", "type": "commit"}, {"oid": "d031aae20c8eba7318dba69c18f2130108278abb", "url": "https://github.com/firebase/firebase-android-sdk/commit/d031aae20c8eba7318dba69c18f2130108278abb", "message": "test(storage-ktx): add tests for destructuring declarations", "committedDate": "2020-07-15T11:09:20Z", "type": "commit"}, {"oid": "aae2a90585146c1547136ace7d6113401438d64b", "url": "https://github.com/firebase/firebase-android-sdk/commit/aae2a90585146c1547136ace7d6113401438d64b", "message": "style: remove wildcard import", "committedDate": "2020-07-15T11:31:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzk1NDgxMA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1644#discussion_r467954810", "bodyText": "Add a period at the end of the sentence, here and below.", "author": "rlazo", "createdAt": "2020-08-10T14:45:23Z", "path": "firebase-storage/ktx/src/main/kotlin/com/google/firebase/storage/ktx/Storage.kt", "diffHunk": "@@ -44,6 +49,90 @@ fun storageMetadata(init: StorageMetadata.Builder.() -> Unit): StorageMetadata {\n     return builder.build()\n }\n \n+/**\n+ * Destructuring declaration for [UploadTask.TaskSnapshot] to provide bytesTransferred", "originalCommit": "aae2a90585146c1547136ace7d6113401438d64b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzk2MjQwOA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1644#discussion_r467962408", "bodyText": "You're mocking the final class ListResult, which ends up requiring the use of mock-maker-inline which according to the docs is still incubating.\nFor this particular case, you can create a helper class in the package com.google.firebase.storage that can access  the package private constructor directly. We've already done something similar in\nhttps://github.com/firebase/firebase-android-sdk/blob/master/firebase-firestore/ktx/src/test/java/com/google/firebase/firestore/TestUtil.java", "author": "rlazo", "createdAt": "2020-08-10T14:55:45Z", "path": "firebase-storage/ktx/src/test/kotlin/com/google/firebase/storage/ktx/StorageTest.kt", "diffHunk": "@@ -105,6 +113,64 @@ class StorageTests : BaseTestCase() {\n         assertThat(metadata.getContentType()).isEqualTo(\"text/html\")\n         assertThat(metadata.getCacheControl()).isEqualTo(\"no-cache\")\n     }\n+\n+    @Test\n+    fun `ListResult destructuring declarations work`() {\n+        val mockListResult = Mockito.mock(ListResult::class.java)", "originalCommit": "aae2a90585146c1547136ace7d6113401438d64b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAxMzgwMg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1644#discussion_r468013802", "bodyText": "@rlazo the package com.google.firebase.storage already had a TestUtil class, so I added a listResult() method in that same class. PTAL and let me know if that's ok", "author": "thatfiredev", "createdAt": "2020-08-10T16:02:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzk2MjQwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAxNTM0NQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1644#discussion_r468015345", "bodyText": "\ud83d\udc4d", "author": "rlazo", "createdAt": "2020-08-10T16:05:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzk2MjQwOA=="}], "type": "inlineReview"}, {"oid": "3cc477801930d9026bd33616e75c6a4eae9f14b1", "url": "https://github.com/firebase/firebase-android-sdk/commit/3cc477801930d9026bd33616e75c6a4eae9f14b1", "message": "test: create TestUtl.listResult() for ktx tests", "committedDate": "2020-08-10T15:58:56Z", "type": "commit"}, {"oid": "ff2b0b94eeb99caf739296c6ca8c331106795e8a", "url": "https://github.com/firebase/firebase-android-sdk/commit/ff2b0b94eeb99caf739296c6ca8c331106795e8a", "message": "chore: add dots to kdocs comments", "committedDate": "2020-08-10T16:00:53Z", "type": "commit"}, {"oid": "47f485e1570223d7a74036cea2bdef0ba1abb2eb", "url": "https://github.com/firebase/firebase-android-sdk/commit/47f485e1570223d7a74036cea2bdef0ba1abb2eb", "message": "style: explicitly set listOf() type", "committedDate": "2020-08-10T16:14:21Z", "type": "commit"}, {"oid": "eaa905f03eed12db95e123aa9d8bd69d98c8dbaf", "url": "https://github.com/firebase/firebase-android-sdk/commit/eaa905f03eed12db95e123aa9d8bd69d98c8dbaf", "message": "refactor: move TestUtil.listResult to separate package", "committedDate": "2020-08-10T17:29:29Z", "type": "commit"}, {"oid": "e1d6aef4d0e238faaa1626927519583e10e0806b", "url": "https://github.com/firebase/firebase-android-sdk/commit/e1d6aef4d0e238faaa1626927519583e10e0806b", "message": "chore: add copyright to /src/test/kotlin/TestUtil.java", "committedDate": "2020-08-10T17:48:31Z", "type": "commit"}, {"oid": "294de57a982b52cc54e403aeb2695e7401330d36", "url": "https://github.com/firebase/firebase-android-sdk/commit/294de57a982b52cc54e403aeb2695e7401330d36", "message": "refactor: google java format", "committedDate": "2020-08-10T18:09:20Z", "type": "commit"}, {"oid": "919bba596e727eddab78163163ff2a3f39b730f7", "url": "https://github.com/firebase/firebase-android-sdk/commit/919bba596e727eddab78163163ff2a3f39b730f7", "message": "refactor: move TestUtil from /test/kotlin to /testUtil/java", "committedDate": "2020-08-10T19:31:34Z", "type": "commit"}, {"oid": "77b48091484c3ad1001e7144b3bc27e583501d11", "url": "https://github.com/firebase/firebase-android-sdk/commit/77b48091484c3ad1001e7144b3bc27e583501d11", "message": "style: google java format", "committedDate": "2020-08-10T19:41:23Z", "type": "commit"}, {"oid": "ee5e5ebc41c30bae999aa8d936697370724f9283", "url": "https://github.com/firebase/firebase-android-sdk/commit/ee5e5ebc41c30bae999aa8d936697370724f9283", "message": "TestUtil --> KtxTestUtil", "committedDate": "2020-08-10T20:51:14Z", "type": "commit"}, {"oid": "6ead3900027a453bf73e5bc6e89f16cd05f1bad1", "url": "https://github.com/firebase/firebase-android-sdk/commit/6ead3900027a453bf73e5bc6e89f16cd05f1bad1", "message": "chore(firebase-storage-ktx): add java 8", "committedDate": "2020-08-10T21:11:51Z", "type": "commit"}]}