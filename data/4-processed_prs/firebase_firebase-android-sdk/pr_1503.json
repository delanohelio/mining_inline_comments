{"pr_number": 1503, "pr_title": "feat: Implement firebase-crashlytics-ktx", "pr_createdAt": "2020-04-27T03:51:03Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/1503", "timeline": [{"oid": "b7dd5cff6104cfce13f39bd29d443403f103469a", "url": "https://github.com/firebase/firebase-android-sdk/commit/b7dd5cff6104cfce13f39bd29d443403f103469a", "message": "feat: Implement firebase-crashlytics-ktx", "committedDate": "2020-04-27T03:50:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIwNjI0Nw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1503#discussion_r416206247", "bodyText": "const val APP_ID = \"1:1234567890:android:321abc456def7890\"\nconst val API_KEY = \"AIzaSyDOCAbC123dEf456GhI789jKl012-MnO\"\nI recommend using values for fake Firebase options that could pass simple checks for validity in order to prevent tests failing for future initialization checks.", "author": "andirayo", "createdAt": "2020-04-27T23:00:05Z", "path": "firebase-crashlytics/ktx/src/test/java/com/google/firebase/crashlytics/ktx/CrashlyticsTests.kt", "diffHunk": "@@ -0,0 +1,83 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.crashlytics.ktx\n+\n+import com.google.common.truth.Truth.assertThat\n+import com.google.firebase.FirebaseApp\n+import com.google.firebase.FirebaseOptions\n+import com.google.firebase.crashlytics.FirebaseCrashlytics\n+import com.google.firebase.ktx.Firebase\n+import com.google.firebase.ktx.app\n+import com.google.firebase.ktx.initialize\n+import com.google.firebase.platforminfo.UserAgentPublisher\n+import org.junit.After\n+import org.junit.Before\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+import org.robolectric.RobolectricTestRunner\n+import org.robolectric.RuntimeEnvironment\n+\n+const val APP_ID = \"APP_ID\"\n+const val API_KEY = \"API_KEY\"", "originalCommit": "b7dd5cff6104cfce13f39bd29d443403f103469a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIyMTc3OQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1503#discussion_r416221779", "bodyText": "@andirayo  Thank you! I've updated these values", "author": "thatfiredev", "createdAt": "2020-04-27T23:38:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIwNjI0Nw=="}], "type": "inlineReview"}, {"oid": "0df4720722219257ba1eebe52c4e97193c0073f6", "url": "https://github.com/firebase/firebase-android-sdk/commit/0df4720722219257ba1eebe52c4e97193c0073f6", "message": "test(crashlytics-ktx): update APP_ID and API_KEY", "committedDate": "2020-04-27T23:20:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY5NTY4Ng==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1503#discussion_r416695686", "bodyText": "This is definitely an improvement compared to using plain java api, a few considerations though:\n\nSome other ktx sdks use dsl-like notation for similar use-cases, e.g. Firebase.analytics.logEvent, so it might make sense to something similar here for the sake of consistency. The dsl could even support infix notation like Pair does(not sure if it would be a good idea though).\nThe dsl would also be more type-safe, i.e. there won't be a need for IllegalArgumentException below, as the block can be made to only have the methods with argument types crashlytics supports.\n\nSo I would suggest something along the lines of:\ncrashlytics.setCustomKeys {\n  key(\"foo\", \"bar\")\n  key(\"int\", 42)\n  // or\n  \"foo\" to \"bar\" // this might not be a good idea as it shadows the Pair constructor function.\n}\nwdyt?", "author": "vkryachko", "createdAt": "2020-04-28T15:13:20Z", "path": "firebase-crashlytics/ktx/src/main/kotlin/com/google/firebase/crashlytics/ktx/FirebaseCrashlytics.kt", "diffHunk": "@@ -0,0 +1,53 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.crashlytics.ktx\n+\n+import androidx.annotation.Keep\n+import com.google.firebase.FirebaseApp\n+import com.google.firebase.components.Component\n+import com.google.firebase.components.ComponentRegistrar\n+import com.google.firebase.crashlytics.FirebaseCrashlytics\n+import com.google.firebase.ktx.Firebase\n+import com.google.firebase.platforminfo.LibraryVersionComponent\n+\n+/** Returns the [FirebaseCrashlytics] instance of the default [FirebaseApp]. */\n+val Firebase.crashlytics: FirebaseCrashlytics\n+    get() = FirebaseCrashlytics.getInstance()\n+\n+fun FirebaseCrashlytics.setCustomKeys(vararg pairs: Pair<String, Any>) {", "originalCommit": "0df4720722219257ba1eebe52c4e97193c0073f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYwMjM0Nw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1503#discussion_r417602347", "bodyText": "@vkryachko since analytics.logEvent uses DSL, I think we should maintain consistency. Ive updated the code to match your suggestion. PTAL", "author": "thatfiredev", "createdAt": "2020-04-29T20:49:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY5NTY4Ng=="}], "type": "inlineReview"}, {"oid": "2e1fba291ca4ae980ef3051277f9cdd733e8d04c", "url": "https://github.com/firebase/firebase-android-sdk/commit/2e1fba291ca4ae980ef3051277f9cdd733e8d04c", "message": "refactor(crashlytics-ktx): use DSL syntax on crashlytics.setCustomKeys()", "committedDate": "2020-04-29T20:48:25Z", "type": "commit"}, {"oid": "ed4998ddd382d4bb7d5e200ebedc0c75200f5a30", "url": "https://github.com/firebase/firebase-android-sdk/commit/ed4998ddd382d4bb7d5e200ebedc0c75200f5a30", "message": "chore(crashlytics-ktx): regenerate the api.txt file", "committedDate": "2020-04-29T20:51:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEyMTAxNA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1503#discussion_r423121014", "bodyText": "Please, rename it to FirebaseCrashlyticsKtxRegistrar (here and in the manifest). All our registrars except FDL use that convention :-) and that got fixed on #1543", "author": "rlazo", "createdAt": "2020-05-11T15:24:03Z", "path": "firebase-crashlytics/ktx/src/main/kotlin/com/google/firebase/crashlytics/ktx/FirebaseCrashlytics.kt", "diffHunk": "@@ -0,0 +1,44 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.crashlytics.ktx\n+\n+import androidx.annotation.Keep\n+import com.google.firebase.FirebaseApp\n+import com.google.firebase.components.Component\n+import com.google.firebase.components.ComponentRegistrar\n+import com.google.firebase.crashlytics.FirebaseCrashlytics\n+import com.google.firebase.ktx.Firebase\n+import com.google.firebase.platforminfo.LibraryVersionComponent\n+\n+/** Returns the [FirebaseCrashlytics] instance of the default [FirebaseApp]. */\n+val Firebase.crashlytics: FirebaseCrashlytics\n+    get() = FirebaseCrashlytics.getInstance()\n+\n+/**\n+ * Associates all key-value parameters with the reports\n+ */\n+fun FirebaseCrashlytics.setCustomKeys(init: KeyValueBuilder.() -> Unit) {\n+    val builder = KeyValueBuilder(this)\n+    builder.init()\n+}\n+\n+internal const val LIBRARY_NAME: String = \"fire-cls-ktx\"\n+\n+/** @suppress */\n+@Keep\n+class FirebaseCrashlyticsRegistrar : ComponentRegistrar {", "originalCommit": "ed4998ddd382d4bb7d5e200ebedc0c75200f5a30", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4MDgzNw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1503#discussion_r423280837", "bodyText": "Oops! Done :)", "author": "thatfiredev", "createdAt": "2020-05-11T19:52:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEyMTAxNA=="}], "type": "inlineReview"}, {"oid": "2087dff8d41bdce1ee23c8a5600201074660ce05", "url": "https://github.com/firebase/firebase-android-sdk/commit/2087dff8d41bdce1ee23c8a5600201074660ce05", "message": "FirebaseCrashlyticsRegistrar --> FirebaseCrashlyticsKtxRegistrar", "committedDate": "2020-05-11T19:52:18Z", "type": "commit"}]}