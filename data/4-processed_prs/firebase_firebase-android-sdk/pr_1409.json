{"pr_number": 1409, "pr_title": "Support AGP 3.6+ in the iid compatibility check.", "pr_createdAt": "2020-04-01T14:09:58Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/1409", "timeline": [{"oid": "35d2d8a1535882aee66a15aab7eabfe5bd918dc9", "url": "https://github.com/firebase/firebase-android-sdk/commit/35d2d8a1535882aee66a15aab7eabfe5bd918dc9", "message": "Support AGP 3.6+ in the iid compatibility check.\n\nAGP 3.6 introduced a breaking change to lint-api making the check fail.\nThe change switch to use reflection to support both versions of the api.\n\nAdditionally the change makes the check failures more developer friendly\nto make sure this check does not cause failures in upcoming AGP\nversions.\n\nVersions tested: 3.2 through 4.1.0-alpha04\n\nFixes #1407", "committedDate": "2020-04-01T14:08:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTY5MTAzNg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1409#discussion_r401691036", "bodyText": "Worth unit testing", "author": "ashwinraghav", "createdAt": "2020-04-01T15:10:09Z", "path": "firebase-installations/customer-lint-checks/src/main/java/com/google/firebase/installations/lint/IncompatibleIidVersionDetector.kt", "diffHunk": "@@ -68,18 +81,45 @@ class IncompatibleIidVersionDetector : Detector() {\n         }\n     }\n \n+    private fun getVariants(project: Project): List<Variant> {\n+        if (!project.isGradleProject) {\n+            return listOf()\n+        }\n+\n+        // using reflection here due to breaking change in lint-api 26.6.0 that changed the return type\n+        // of getGradleProject()\n+        val method = project.javaClass.getMethod(\"getGradleProjectModel\")\n+        method.isAccessible = true\n+        val model = method.invoke(project)\n+        val variantsMethod = model.javaClass.getMethod(\"getVariants\")\n+        variantsMethod.isAccessible = true\n+        return variantsMethod.invoke(model) as List<Variant>\n+    }\n+\n     private fun isCompatibleVersion(coordinates: MavenCoordinates): Boolean {\n         val versionComponents = coordinates.version.split('.', limit = 3).toTypedArray()\n \n         // Incompatible if major version is before v20\n-        if (20 > versionComponents.get(0).toInt()) {", "originalCommit": "35d2d8a1535882aee66a15aab7eabfe5bd918dc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTgwNTE3Ng==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1409#discussion_r401805176", "bodyText": "Done", "author": "vkryachko", "createdAt": "2020-04-01T17:59:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTY5MTAzNg=="}], "type": "inlineReview"}, {"oid": "e59fa4913bd1a922c1f3d5ae1dfa92aa4ce71a2d", "url": "https://github.com/firebase/firebase-android-sdk/commit/e59fa4913bd1a922c1f3d5ae1dfa92aa4ce71a2d", "message": "Cleanup, unittests for version logic", "committedDate": "2020-04-01T17:58:27Z", "type": "commit"}]}