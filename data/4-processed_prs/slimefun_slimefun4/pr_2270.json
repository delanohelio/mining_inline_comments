{"pr_number": 2270, "pr_title": "Fixes #2265 <Tested>", "pr_createdAt": "2020-08-31T14:31:52Z", "pr_url": "https://github.com/Slimefun/Slimefun4/pull/2270", "timeline": [{"oid": "e2c93c54e5d0abc45685c4dc5f0decfb0a1d1188", "url": "https://github.com/Slimefun/Slimefun4/commit/e2c93c54e5d0abc45685c4dc5f0decfb0a1d1188", "message": "Fixes #2265 <Tested>", "committedDate": "2020-08-31T14:28:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5NDE3NA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2270#discussion_r480194174", "bodyText": "Please give this variable a more meaningful name. nextBlock maybe?", "author": "TheBusyBiscuit", "createdAt": "2020-08-31T15:08:09Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/electric/machines/FluidPump.java", "diffHunk": "@@ -127,31 +127,39 @@ protected void tick(Block b) {\n                     if (!menu.fits(bucket.get(), getOutputSlots())) {\n                         return;\n                     }\n-\n+                    \n+                    Block consume = findFluid(fluid);", "originalCommit": "e2c93c54e5d0abc45685c4dc5f0decfb0a1d1188", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5NDM4OA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2270#discussion_r480194388", "bodyText": "findNextFluid might be better here", "author": "TheBusyBiscuit", "createdAt": "2020-08-31T15:08:31Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/electric/machines/FluidPump.java", "diffHunk": "@@ -127,31 +127,39 @@ protected void tick(Block b) {\n                     if (!menu.fits(bucket.get(), getOutputSlots())) {\n                         return;\n                     }\n-\n+                    \n+                    Block consume = findFluid(fluid);\n+                    if (consume == null) return;\n+              \n                     removeCharge(b.getLocation(), ENERGY_CONSUMPTION);\n                     menu.consumeItem(slot);\n                     menu.pushItem(bucket.get().clone(), getOutputSlots());\n-                    consumeFluid(fluid);\n-\n+                    consume.setType(Material.AIR);\n                     return;\n                 }\n             }\n         }\n     }\n \n-    private void consumeFluid(Block fluid) {\n-        if (fluid.isLiquid()) {\n-            if (fluid.getType() == Material.WATER || fluid.getType() == Material.BUBBLE_COLUMN) {\n-                // With water we can be sure to find an infinite source whenever we go\n-                // further than 2 blocks, so we can just remove the water here and save\n-                // outselves all of that computing...\n-                fluid.setType(Material.AIR);\n-            }\n-            else {\n-                List<Block> list = Vein.find(fluid, RANGE, block -> isLiquid(block) && block.getType() == fluid.getType());\n-                list.get(list.size() - 1).setType(Material.AIR);\n+    private Block findFluid(Block fluid) {", "originalCommit": "e2c93c54e5d0abc45685c4dc5f0decfb0a1d1188", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5NTQ2Mw==", "url": "https://github.com/Slimefun/Slimefun4/pull/2270#discussion_r480195463", "bodyText": "We should probably also do an isSource check for fluid here now that I think about it...\nOtherwise people will have infinite water sources, even if the water source isn't infinite.\nSimply checking whether the block below (fluid) is a source block should be fine though.", "author": "TheBusyBiscuit", "createdAt": "2020-08-31T15:10:14Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/electric/machines/FluidPump.java", "diffHunk": "@@ -127,31 +127,39 @@ protected void tick(Block b) {\n                     if (!menu.fits(bucket.get(), getOutputSlots())) {\n                         return;\n                     }\n-\n+                    \n+                    Block consume = findFluid(fluid);\n+                    if (consume == null) return;\n+              \n                     removeCharge(b.getLocation(), ENERGY_CONSUMPTION);\n                     menu.consumeItem(slot);\n                     menu.pushItem(bucket.get().clone(), getOutputSlots());\n-                    consumeFluid(fluid);\n-\n+                    consume.setType(Material.AIR);\n                     return;\n                 }\n             }\n         }\n     }\n \n-    private void consumeFluid(Block fluid) {\n-        if (fluid.isLiquid()) {\n-            if (fluid.getType() == Material.WATER || fluid.getType() == Material.BUBBLE_COLUMN) {\n-                // With water we can be sure to find an infinite source whenever we go\n-                // further than 2 blocks, so we can just remove the water here and save\n-                // outselves all of that computing...\n-                fluid.setType(Material.AIR);\n-            }\n-            else {\n-                List<Block> list = Vein.find(fluid, RANGE, block -> isLiquid(block) && block.getType() == fluid.getType());\n-                list.get(list.size() - 1).setType(Material.AIR);\n+    private Block findFluid(Block fluid) {\n+        if (fluid.getType() == Material.WATER || fluid.getType() == Material.BUBBLE_COLUMN) {\n+            // With water we can be sure to find an infinite source whenever we go\n+            // further than 2 blocks, so we can just remove the water here and save\n+            // ourselves all of that computing...\n+            return fluid;\n+        }", "originalCommit": "e2c93c54e5d0abc45685c4dc5f0decfb0a1d1188", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5NTU5Mw==", "url": "https://github.com/Slimefun/Slimefun4/pull/2270#discussion_r480195593", "bodyText": "else if", "author": "TheBusyBiscuit", "createdAt": "2020-08-31T15:10:26Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/electric/machines/FluidPump.java", "diffHunk": "@@ -127,31 +127,39 @@ protected void tick(Block b) {\n                     if (!menu.fits(bucket.get(), getOutputSlots())) {\n                         return;\n                     }\n-\n+                    \n+                    Block consume = findFluid(fluid);\n+                    if (consume == null) return;\n+              \n                     removeCharge(b.getLocation(), ENERGY_CONSUMPTION);\n                     menu.consumeItem(slot);\n                     menu.pushItem(bucket.get().clone(), getOutputSlots());\n-                    consumeFluid(fluid);\n-\n+                    consume.setType(Material.AIR);\n                     return;\n                 }\n             }\n         }\n     }\n \n-    private void consumeFluid(Block fluid) {\n-        if (fluid.isLiquid()) {\n-            if (fluid.getType() == Material.WATER || fluid.getType() == Material.BUBBLE_COLUMN) {\n-                // With water we can be sure to find an infinite source whenever we go\n-                // further than 2 blocks, so we can just remove the water here and save\n-                // outselves all of that computing...\n-                fluid.setType(Material.AIR);\n-            }\n-            else {\n-                List<Block> list = Vein.find(fluid, RANGE, block -> isLiquid(block) && block.getType() == fluid.getType());\n-                list.get(list.size() - 1).setType(Material.AIR);\n+    private Block findFluid(Block fluid) {\n+        if (fluid.getType() == Material.WATER || fluid.getType() == Material.BUBBLE_COLUMN) {\n+            // With water we can be sure to find an infinite source whenever we go\n+            // further than 2 blocks, so we can just remove the water here and save\n+            // ourselves all of that computing...\n+            return fluid;\n+        }\n+        \n+        if (fluid.getType() == Material.LAVA) {", "originalCommit": "e2c93c54e5d0abc45685c4dc5f0decfb0a1d1188", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5NjA4OA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2270#discussion_r480196088", "bodyText": "Why not Block#isLiquid() ?", "author": "TheBusyBiscuit", "createdAt": "2020-08-31T15:11:11Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/electric/machines/FluidPump.java", "diffHunk": "@@ -166,21 +174,21 @@ else if (fluid.getType() == Material.WATER || fluid.getType() == Material.BUBBLE\n         }\n     }\n \n-    private boolean isLiquid(Block block) {\n-        if (block.isLiquid()) {\n+    private boolean isSource(Block block) {\n+        if (isLiquid(block.getType())) {", "originalCommit": "e2c93c54e5d0abc45685c4dc5f0decfb0a1d1188", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIyMDA3Nw==", "url": "https://github.com/Slimefun/Slimefun4/pull/2270#discussion_r480220077", "bodyText": "That only returns true to lava and water. But we also want true for bubble columns.", "author": "LinoxGH", "createdAt": "2020-08-31T15:45:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5NjA4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIyODIxOQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2270#discussion_r480228219", "bodyText": "Block#isLiquid() returns true for WATER, LAVA and BUBBLE_COLUMN.\nIt does the exact same like your method, only that it is a wrapper for NMS code which checks a flag. But that flag is set to true for all three.", "author": "TheBusyBiscuit", "createdAt": "2020-08-31T15:59:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5NjA4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIzMjAzNQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2270#discussion_r480232035", "bodyText": "Well then spigot javadocs aren't complete...", "author": "LinoxGH", "createdAt": "2020-08-31T16:05:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5NjA4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIzMzcyMA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2270#discussion_r480233720", "bodyText": "To be honest... Does that really surprise you? :LUL:", "author": "TheBusyBiscuit", "createdAt": "2020-08-31T16:08:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5NjA4OA=="}], "type": "inlineReview"}, {"oid": "fa01e8217931f62f6b8d7887ae2ea34797146940", "url": "https://github.com/Slimefun/Slimefun4/commit/fa01e8217931f62f6b8d7887ae2ea34797146940", "message": "Did the requested changes.", "committedDate": "2020-08-31T15:51:21Z", "type": "commit"}, {"oid": "4346d374d8ac51fc96baa5f1dd6d6406672b2ecf", "url": "https://github.com/Slimefun/Slimefun4/commit/4346d374d8ac51fc96baa5f1dd6d6406672b2ecf", "message": "Update CHANGELOG.md", "committedDate": "2020-08-31T15:57:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIyODU2OQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2270#discussion_r480228569", "bodyText": "Please follow the existing formatting, the else if should go on the next line.", "author": "TheBusyBiscuit", "createdAt": "2020-08-31T16:00:00Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/electric/machines/FluidPump.java", "diffHunk": "@@ -127,31 +127,40 @@ protected void tick(Block b) {\n                     if (!menu.fits(bucket.get(), getOutputSlots())) {\n                         return;\n                     }\n-\n+                    \n+                    Block nextFluid = findNextFluid(fluid);\n+                    if (nextFluid == null) return;\n+              \n                     removeCharge(b.getLocation(), ENERGY_CONSUMPTION);\n                     menu.consumeItem(slot);\n                     menu.pushItem(bucket.get().clone(), getOutputSlots());\n-                    consumeFluid(fluid);\n-\n+                    nextFluid.setType(Material.AIR);\n                     return;\n                 }\n             }\n         }\n     }\n \n-    private void consumeFluid(Block fluid) {\n-        if (fluid.isLiquid()) {\n-            if (fluid.getType() == Material.WATER || fluid.getType() == Material.BUBBLE_COLUMN) {\n-                // With water we can be sure to find an infinite source whenever we go\n-                // further than 2 blocks, so we can just remove the water here and save\n-                // outselves all of that computing...\n-                fluid.setType(Material.AIR);\n+    private Block findNextFluid(Block fluid) {\n+        if (fluid.getType() == Material.WATER || fluid.getType() == Material.BUBBLE_COLUMN) {\n+            // With water we can be sure to find an infinite source whenever we go\n+            // further than 2 blocks, so we can just remove the water here and save\n+            // ourselves all of that computing...\n+            if (isSource(fluid)) {\n+                return fluid;\n             }\n-            else {\n-                List<Block> list = Vein.find(fluid, RANGE, block -> isLiquid(block) && block.getType() == fluid.getType());\n-                list.get(list.size() - 1).setType(Material.AIR);\n+            \n+        } else if (fluid.getType() == Material.LAVA) {", "originalCommit": "4346d374d8ac51fc96baa5f1dd6d6406672b2ecf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIzMDAzNg==", "url": "https://github.com/Slimefun/Slimefun4/pull/2270#discussion_r480230036", "bodyText": "Ugh none of the changes I contributed to the plugin had else's in next lines lol But sure.", "author": "LinoxGH", "createdAt": "2020-08-31T16:02:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIyODU2OQ=="}], "type": "inlineReview"}, {"oid": "f740cc7850c6eeeed5ebe089ab7500786c01eadb", "url": "https://github.com/Slimefun/Slimefun4/commit/f740cc7850c6eeeed5ebe089ab7500786c01eadb", "message": "Did the requested change.", "committedDate": "2020-08-31T16:04:23Z", "type": "commit"}, {"oid": "d95049db275421676a2791be50769d57ae399a7b", "url": "https://github.com/Slimefun/Slimefun4/commit/d95049db275421676a2791be50769d57ae399a7b", "message": "Did the requested change.", "committedDate": "2020-08-31T16:13:23Z", "type": "commit"}, {"oid": "6dba662d4b5161ca7cf60f040902343d1c5e8427", "url": "https://github.com/Slimefun/Slimefun4/commit/6dba662d4b5161ca7cf60f040902343d1c5e8427", "message": "Merge branch 'master' into master", "committedDate": "2020-08-31T17:34:15Z", "type": "commit"}]}