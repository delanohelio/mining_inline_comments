{"pr_number": 2264, "pr_title": "Fixes #2263", "pr_createdAt": "2020-08-30T14:55:36Z", "pr_url": "https://github.com/Slimefun/Slimefun4/pull/2264", "timeline": [{"oid": "e0914af6d9c7d1372b659b18ef1d5762ab011338", "url": "https://github.com/Slimefun/Slimefun4/commit/e0914af6d9c7d1372b659b18ef1d5762ab011338", "message": "Fixes #2263", "committedDate": "2020-08-30T14:53:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc4MDQxMg==", "url": "https://github.com/Slimefun/Slimefun4/pull/2264#discussion_r479780412", "bodyText": "You can remove the \"EntityDamageEvent\" here, it's already imported.", "author": "TheBusyBiscuit", "createdAt": "2020-08-30T15:00:41Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/CoolerListener.java", "diffHunk": "@@ -47,14 +49,29 @@ public void onHungerLoss(FoodLevelChangeEvent e) {\n         Player p = (Player) e.getEntity();\n \n         if (e.getFoodLevel() < p.getFoodLevel()) {\n-            for (ItemStack item : p.getInventory().getContents()) {\n-                if (cooler.isItem(item)) {\n-                    if (Slimefun.hasUnlocked(p, cooler, true)) {\n-                        takeJuiceFromCooler(p, item);\n-                    }\n-                    else {\n-                        return;\n-                    }\n+            checkAndConsume(p);\n+        }\n+    }\n+    \n+    @EventHandler\n+    public void onHungerDamage(EntityDamageEvent e) {\n+        if (cooler == null || cooler.isDisabled()) {\n+            return;\n+        }\n+        \n+        if (e.getCause() == EntityDamageEvent.DamageCause.STARVATION) {", "originalCommit": "e0914af6d9c7d1372b659b18ef1d5762ab011338", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc4MDQzNw==", "url": "https://github.com/Slimefun/Slimefun4/pull/2264#discussion_r479780437", "bodyText": "You will need to check whether the Entity is actually a Player first before casting.", "author": "TheBusyBiscuit", "createdAt": "2020-08-30T15:00:58Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/CoolerListener.java", "diffHunk": "@@ -47,14 +49,29 @@ public void onHungerLoss(FoodLevelChangeEvent e) {\n         Player p = (Player) e.getEntity();\n \n         if (e.getFoodLevel() < p.getFoodLevel()) {\n-            for (ItemStack item : p.getInventory().getContents()) {\n-                if (cooler.isItem(item)) {\n-                    if (Slimefun.hasUnlocked(p, cooler, true)) {\n-                        takeJuiceFromCooler(p, item);\n-                    }\n-                    else {\n-                        return;\n-                    }\n+            checkAndConsume(p);\n+        }\n+    }\n+    \n+    @EventHandler\n+    public void onHungerDamage(EntityDamageEvent e) {\n+        if (cooler == null || cooler.isDisabled()) {\n+            return;\n+        }\n+        \n+        if (e.getCause() == EntityDamageEvent.DamageCause.STARVATION) {\n+            checkAndConsume((Player) e.getEntity());", "originalCommit": "e0914af6d9c7d1372b659b18ef1d5762ab011338", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cdb6eeab968a957f544f45c9f0e33e513690df47", "url": "https://github.com/Slimefun/Slimefun4/commit/cdb6eeab968a957f544f45c9f0e33e513690df47", "message": "Did the requested changes.", "committedDate": "2020-08-30T15:13:45Z", "type": "commit"}, {"oid": "3d0c642477622f9d2487b81d4a8a22f49152f63c", "url": "https://github.com/Slimefun/Slimefun4/commit/3d0c642477622f9d2487b81d4a8a22f49152f63c", "message": "Added an additional check for Wind Staff", "committedDate": "2020-08-30T15:14:39Z", "type": "commit"}, {"oid": "a8f6f51724b3ce37435ad00e67b6df7ac66a66a9", "url": "https://github.com/Slimefun/Slimefun4/commit/a8f6f51724b3ce37435ad00e67b6df7ac66a66a9", "message": "Added a new message.", "committedDate": "2020-08-30T15:15:31Z", "type": "commit"}, {"oid": "e8498f8c0c3daf85b84906cb841a6d56eabec72e", "url": "https://github.com/Slimefun/Slimefun4/commit/e8498f8c0c3daf85b84906cb841a6d56eabec72e", "message": "Update CHANGELOG.md", "committedDate": "2020-08-30T15:15:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc4MjE2NA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2264#discussion_r479782164", "bodyText": "I don't think we should send a message here, if the FoodLevelChangeEvent was cancelled, then we should simply not consume any hunger points. The wind staff itself did not fail, if the event was cancelled, this is most likely because that server doesn't use the hunger system...", "author": "TheBusyBiscuit", "createdAt": "2020-08-30T15:17:44Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/magical/WindStaff.java", "diffHunk": "@@ -31,6 +31,11 @@ public ItemUseHandler getItemHandler() {\n                 if (p.getInventory().getItemInMainHand().getType() != Material.SHEARS && p.getGameMode() != GameMode.CREATIVE) {\n                     FoodLevelChangeEvent event = new FoodLevelChangeEvent(p, p.getFoodLevel() - 2);\n                     Bukkit.getPluginManager().callEvent(event);\n+                    \n+                    if (event.isCancelled()) {\n+                        SlimefunPlugin.getLocalization().sendMessage(p, \"messages.wind-staff-fail\", true);\n+                        return;\n+                    }", "originalCommit": "e8498f8c0c3daf85b84906cb841a6d56eabec72e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "dffc5758e28c0a00c193f76bf6d0347e6b30b5ae", "url": "https://github.com/Slimefun/Slimefun4/commit/dffc5758e28c0a00c193f76bf6d0347e6b30b5ae", "message": "Fixed compilation error.", "committedDate": "2020-08-30T15:21:50Z", "type": "commit"}, {"oid": "305dd57b3950670ad1b2e6ce0580ed84da613d3b", "url": "https://github.com/Slimefun/Slimefun4/commit/305dd57b3950670ad1b2e6ce0580ed84da613d3b", "message": "Did the requested change.", "committedDate": "2020-08-30T15:25:08Z", "type": "commit"}, {"oid": "bfc84d03b27169f8fd7e4411e60d2ef75904be1b", "url": "https://github.com/Slimefun/Slimefun4/commit/bfc84d03b27169f8fd7e4411e60d2ef75904be1b", "message": "Undid the changes to language files.", "committedDate": "2020-08-30T15:26:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc4MzUyOQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2264#discussion_r479783529", "bodyText": "\"or an\", not \"and a\"", "author": "TheBusyBiscuit", "createdAt": "2020-08-30T15:31:42Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/CoolerListener.java", "diffHunk": "@@ -19,10 +21,11 @@\n import me.mrCookieSlime.Slimefun.api.Slimefun;\n \n /**\n- * This {@link Listener} listens for a {@link FoodLevelChangeEvent} and consumes a {@link Juice}\n- * from any {@link Cooler} that can be found in the {@link Inventory} of the given {@link Player}.\n+ * This {@link Listener} listens for a {@link FoodLevelChangeEvent} and a {@link EntityDamageEvent} for starvation damage", "originalCommit": "bfc84d03b27169f8fd7e4411e60d2ef75904be1b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "918edbeeb1bfdb7e441fbb5fac0731835f7ab69b", "url": "https://github.com/Slimefun/Slimefun4/commit/918edbeeb1bfdb7e441fbb5fac0731835f7ab69b", "message": "Fixed the javadocs.", "committedDate": "2020-08-30T15:42:57Z", "type": "commit"}]}