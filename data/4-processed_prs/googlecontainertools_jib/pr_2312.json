{"pr_number": 2312, "pr_title": "Container Build Plan specification", "pr_createdAt": "2020-02-26T23:32:26Z", "pr_url": "https://github.com/GoogleContainerTools/jib/pull/2312", "timeline": [{"oid": "fdfcaab3ca103ee251cb60e0c19da7f3dd242537", "url": "https://github.com/GoogleContainerTools/jib/commit/fdfcaab3ca103ee251cb60e0c19da7f3dd242537", "message": "Container Build Plan Specification", "committedDate": "2020-02-26T22:34:54Z", "type": "commit"}, {"oid": "136ad827b17d9c7a32d097cc97e7e716c1ceeeb4", "url": "https://github.com/GoogleContainerTools/jib/commit/136ad827b17d9c7a32d097cc97e7e716c1ceeeb4", "message": "update", "committedDate": "2020-02-26T22:37:54Z", "type": "commit"}, {"oid": "65505a4ae1a17c2a08323f2094e97409e9e1c53c", "url": "https://github.com/GoogleContainerTools/jib/commit/65505a4ae1a17c2a08323f2094e97409e9e1c53c", "message": "update", "committedDate": "2020-02-26T23:31:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg0ODAwOQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2312#discussion_r387848009", "bodyText": "should we allow passthrough from the baseImage env?\nCould path be \"PATH:$PATH\" ?", "author": "loosebazooka", "createdAt": "2020-03-04T18:20:33Z", "path": "proposals/container-build-plan-spec.md", "diffHunk": "@@ -0,0 +1,176 @@\n+# Container Build Plan Specification\n+\n+Specification for building a container image.\n+\n+Although looking similar, the structure and semantics of similary named properties are different from the Docker/[OCI Image Configuration](https://github.com/opencontainers/image-spec/blob/master/config.md).\n+\n+## Example\n+\n+```\n+{\n+  \"baseImage\": \"gcr.io/distroless/java@sha256:b715126ebd36e5d5c2fd730f46a5b3c3b760e82dc18dffff7f5498d0151137c9\",\n+  \"architecture\": \"amd64\",\n+  \"os\": \"linux\",\n+  \"format\": \"Docker\",\n+  \"created\": \"2011-12-03T22:42:05Z\",\n+\n+  \"config\": {\n+    \"env\": {\n+      \"KEY\": \"value\",\n+      \"PATH\": \"/usr/sbin:/usr/bin:/sbin:/bin\",", "originalCommit": "65505a4ae1a17c2a08323f2094e97409e9e1c53c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE0MTY1OQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2312#discussion_r389141659", "bodyText": "As discussed, we will consider such extension in the future.", "author": "chanseokoh", "createdAt": "2020-03-06T21:00:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg0ODAwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg0OTU3Ng==", "url": "https://github.com/GoogleContainerTools/jib/pull/2312#discussion_r387849576", "bodyText": "files is not documented anywhere?", "author": "loosebazooka", "createdAt": "2020-03-04T18:23:23Z", "path": "proposals/container-build-plan-spec.md", "diffHunk": "@@ -0,0 +1,176 @@\n+# Container Build Plan Specification\n+\n+Specification for building a container image.\n+\n+Although looking similar, the structure and semantics of similary named properties are different from the Docker/[OCI Image Configuration](https://github.com/opencontainers/image-spec/blob/master/config.md).\n+\n+## Example\n+\n+```\n+{\n+  \"baseImage\": \"gcr.io/distroless/java@sha256:b715126ebd36e5d5c2fd730f46a5b3c3b760e82dc18dffff7f5498d0151137c9\",\n+  \"architecture\": \"amd64\",\n+  \"os\": \"linux\",\n+  \"format\": \"Docker\",\n+  \"created\": \"2011-12-03T22:42:05Z\",\n+\n+  \"config\": {\n+    \"env\": {\n+      \"KEY\": \"value\",\n+      \"PATH\": \"/usr/sbin:/usr/bin:/sbin:/bin\",\n+      \"HOME\": \"/home/guest\"\n+    },\n+    \"labels\": {\n+      \"com.example.department.some-label-key\": \"avocado explosion\",\n+      \"com.example.system.xml\": \"<message>delivered</message>\"\n+    },\n+    \"volumes\": [\"/mnt/shared\", \"/tmp\"]\n+    \"exposedPorts\": [\"8080\", \"53/udp\", \"80/tcp\"]\n+    \"user\": \":12345\",\n+    \"workingDir\": \"/\n+    \"entrypoint\": [\"/bin/bash\", \"-c\"],\n+    \"cmd\": [\n+      \"-x\",\n+      \"set -o errexit ; echo \\\"\\$0=$0 \\$1=$1\\\" ; echo \\\"\\$PATH=${PATH}\\\" ; exit 0\",\n+      \"my-shell-name\",\n+      \"first shell arg\"\n+    ],\n+  },\n+\n+  \"layers\": [\n+    {\n+      \"entries\": [\n+        {\n+          \"src\": \"/home/jane/workspace/bin/Main.class\",\n+          \"dest\": \"/app/classes/Main.class\",\n+          \"modificationTime\": \"2019-07-15T10:15:30+09:00\",\n+          \"permissions\": \"600\",\n+        },\n+        {\n+          \"src\": \"/home/jane/libs/util-1.0.jar\",\n+          \"dest\": \"/app/jars/util.jar\",\n+          \"modificationTime\": \"2011-12-03T22:42:05Z\",\n+        }\n+      ]\n+    },\n+    {\n+      \"archive\": {\n+        \"mediaType\": \"...\",\n+        \"path\": \"/home/jane/misc/cacerts.tar\",\n+      }\n+    },\n+    {\n+      \"files\": [", "originalCommit": "65505a4ae1a17c2a08323f2094e97409e9e1c53c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEzNzk3OA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2312#discussion_r389137978", "bodyText": "Oops. Should have been entries.", "author": "chanseokoh", "createdAt": "2020-03-06T20:52:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg0OTU3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg1MTc1Mg==", "url": "https://github.com/GoogleContainerTools/jib/pull/2312#discussion_r387851752", "bodyText": "should each \"layers\" entry have a type and name?\ncould it be\n\"layers\": [\n  {\n    \"type\": \"entries/v1\"\n    \"name\": \"application classes\"\n    \"values\": [\n      {\n        ...\n      },\n      {\n        ...\n      },\n     ]\n  },\n  {\n    \"type\": \"archive/v1\"\n    \"name\": \"ca-certs\"\n    \"values\": {\n      \"mediaType\": \"....\"\n      \"path\": \"/hasdfasdfafs/cacerts.tar\"\n    }\n  }\n}", "author": "loosebazooka", "createdAt": "2020-03-04T18:27:22Z", "path": "proposals/container-build-plan-spec.md", "diffHunk": "@@ -0,0 +1,176 @@\n+# Container Build Plan Specification\n+\n+Specification for building a container image.\n+\n+Although looking similar, the structure and semantics of similary named properties are different from the Docker/[OCI Image Configuration](https://github.com/opencontainers/image-spec/blob/master/config.md).\n+\n+## Example\n+\n+```\n+{\n+  \"baseImage\": \"gcr.io/distroless/java@sha256:b715126ebd36e5d5c2fd730f46a5b3c3b760e82dc18dffff7f5498d0151137c9\",\n+  \"architecture\": \"amd64\",\n+  \"os\": \"linux\",\n+  \"format\": \"Docker\",\n+  \"created\": \"2011-12-03T22:42:05Z\",\n+\n+  \"config\": {\n+    \"env\": {\n+      \"KEY\": \"value\",\n+      \"PATH\": \"/usr/sbin:/usr/bin:/sbin:/bin\",\n+      \"HOME\": \"/home/guest\"\n+    },\n+    \"labels\": {\n+      \"com.example.department.some-label-key\": \"avocado explosion\",\n+      \"com.example.system.xml\": \"<message>delivered</message>\"\n+    },\n+    \"volumes\": [\"/mnt/shared\", \"/tmp\"]\n+    \"exposedPorts\": [\"8080\", \"53/udp\", \"80/tcp\"]\n+    \"user\": \":12345\",\n+    \"workingDir\": \"/\n+    \"entrypoint\": [\"/bin/bash\", \"-c\"],\n+    \"cmd\": [\n+      \"-x\",\n+      \"set -o errexit ; echo \\\"\\$0=$0 \\$1=$1\\\" ; echo \\\"\\$PATH=${PATH}\\\" ; exit 0\",\n+      \"my-shell-name\",\n+      \"first shell arg\"\n+    ],\n+  },\n+\n+  \"layers\": [", "originalCommit": "65505a4ae1a17c2a08323f2094e97409e9e1c53c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE0MTAzMA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2312#discussion_r389141030", "bodyText": "Done. I didn't include name, since it's not used for building a layer. In jib-core, we use a layer name for the comment property in a history entry. But in this spec, I'm leaving the history part up to a builder implementation.", "author": "chanseokoh", "createdAt": "2020-03-06T20:59:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg1MTc1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg1MTk5NQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2312#discussion_r387851995", "bodyText": "should we allow blob wildcards in here?", "author": "loosebazooka", "createdAt": "2020-03-04T18:27:51Z", "path": "proposals/container-build-plan-spec.md", "diffHunk": "@@ -0,0 +1,176 @@\n+# Container Build Plan Specification\n+\n+Specification for building a container image.\n+\n+Although looking similar, the structure and semantics of similary named properties are different from the Docker/[OCI Image Configuration](https://github.com/opencontainers/image-spec/blob/master/config.md).\n+\n+## Example\n+\n+```\n+{\n+  \"baseImage\": \"gcr.io/distroless/java@sha256:b715126ebd36e5d5c2fd730f46a5b3c3b760e82dc18dffff7f5498d0151137c9\",\n+  \"architecture\": \"amd64\",\n+  \"os\": \"linux\",\n+  \"format\": \"Docker\",\n+  \"created\": \"2011-12-03T22:42:05Z\",\n+\n+  \"config\": {\n+    \"env\": {\n+      \"KEY\": \"value\",\n+      \"PATH\": \"/usr/sbin:/usr/bin:/sbin:/bin\",\n+      \"HOME\": \"/home/guest\"\n+    },\n+    \"labels\": {\n+      \"com.example.department.some-label-key\": \"avocado explosion\",\n+      \"com.example.system.xml\": \"<message>delivered</message>\"\n+    },\n+    \"volumes\": [\"/mnt/shared\", \"/tmp\"]\n+    \"exposedPorts\": [\"8080\", \"53/udp\", \"80/tcp\"]\n+    \"user\": \":12345\",\n+    \"workingDir\": \"/\n+    \"entrypoint\": [\"/bin/bash\", \"-c\"],\n+    \"cmd\": [\n+      \"-x\",\n+      \"set -o errexit ; echo \\\"\\$0=$0 \\$1=$1\\\" ; echo \\\"\\$PATH=${PATH}\\\" ; exit 0\",\n+      \"my-shell-name\",\n+      \"first shell arg\"\n+    ],\n+  },\n+\n+  \"layers\": [\n+    {\n+      \"entries\": [\n+        {\n+          \"src\": \"/home/jane/workspace/bin/Main.class\",", "originalCommit": "65505a4ae1a17c2a08323f2094e97409e9e1c53c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5NDAzMw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2312#discussion_r388494033", "bodyText": "glob*", "author": "loosebazooka", "createdAt": "2020-03-05T18:54:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg1MTk5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE0MTQ2MA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2312#discussion_r389141460", "bodyText": "As discussed, we will consider such extension in the future.", "author": "chanseokoh", "createdAt": "2020-03-06T21:00:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg1MTk5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM1OTA4OQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2312#discussion_r390359089", "bodyText": "Just to finish this comment chain, I misunderstood the purpose of this design. Glob support should come as a layer above this.", "author": "loosebazooka", "createdAt": "2020-03-10T14:34:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg1MTk5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg1MjgyMA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2312#discussion_r387852820", "bodyText": "could we have nested file-permission/owner configs? like in go/cbsp?", "author": "loosebazooka", "createdAt": "2020-03-04T18:29:23Z", "path": "proposals/container-build-plan-spec.md", "diffHunk": "@@ -0,0 +1,176 @@\n+# Container Build Plan Specification\n+\n+Specification for building a container image.\n+\n+Although looking similar, the structure and semantics of similary named properties are different from the Docker/[OCI Image Configuration](https://github.com/opencontainers/image-spec/blob/master/config.md).\n+\n+## Example\n+\n+```\n+{\n+  \"baseImage\": \"gcr.io/distroless/java@sha256:b715126ebd36e5d5c2fd730f46a5b3c3b760e82dc18dffff7f5498d0151137c9\",\n+  \"architecture\": \"amd64\",\n+  \"os\": \"linux\",\n+  \"format\": \"Docker\",\n+  \"created\": \"2011-12-03T22:42:05Z\",\n+\n+  \"config\": {\n+    \"env\": {\n+      \"KEY\": \"value\",\n+      \"PATH\": \"/usr/sbin:/usr/bin:/sbin:/bin\",\n+      \"HOME\": \"/home/guest\"\n+    },\n+    \"labels\": {\n+      \"com.example.department.some-label-key\": \"avocado explosion\",\n+      \"com.example.system.xml\": \"<message>delivered</message>\"\n+    },\n+    \"volumes\": [\"/mnt/shared\", \"/tmp\"]\n+    \"exposedPorts\": [\"8080\", \"53/udp\", \"80/tcp\"]\n+    \"user\": \":12345\",\n+    \"workingDir\": \"/\n+    \"entrypoint\": [\"/bin/bash\", \"-c\"],\n+    \"cmd\": [\n+      \"-x\",\n+      \"set -o errexit ; echo \\\"\\$0=$0 \\$1=$1\\\" ; echo \\\"\\$PATH=${PATH}\\\" ; exit 0\",\n+      \"my-shell-name\",\n+      \"first shell arg\"\n+    ],\n+  },\n+\n+  \"layers\": [\n+    {\n+      \"entries\": [\n+        {", "originalCommit": "65505a4ae1a17c2a08323f2094e97409e9e1c53c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE0MTQyOQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2312#discussion_r389141429", "bodyText": "As discussed, we will consider such extension in the future.", "author": "chanseokoh", "createdAt": "2020-03-06T21:00:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg1MjgyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM1OTIyNA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2312#discussion_r390359224", "bodyText": "Again, at a different layer.", "author": "loosebazooka", "createdAt": "2020-03-10T14:34:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg1MjgyMA=="}], "type": "inlineReview"}, {"oid": "8ef257e49fad8509b9f0d816b48b3179c4a9f0d9", "url": "https://github.com/GoogleContainerTools/jib/commit/8ef257e49fad8509b9f0d816b48b3179c4a9f0d9", "message": "Covert layer to use polymorphic type", "committedDate": "2020-03-06T20:51:36Z", "type": "commit"}, {"oid": "3760b8c829ce9d9592e8d7e7f55fd38482db7c13", "url": "https://github.com/GoogleContainerTools/jib/commit/3760b8c829ce9d9592e8d7e7f55fd38482db7c13", "message": "Update container-build-plan-spec.md", "committedDate": "2020-03-11T23:22:34Z", "type": "commit"}]}