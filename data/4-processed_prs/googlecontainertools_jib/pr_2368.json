{"pr_number": 2368, "pr_title": "Set up extension API sub-project for Jib Maven plugin", "pr_createdAt": "2020-03-27T15:11:32Z", "pr_url": "https://github.com/GoogleContainerTools/jib/pull/2368", "timeline": [{"oid": "a816ec7e8c89b9fdb7b48b23a8725e83d7e82168", "url": "https://github.com/GoogleContainerTools/jib/commit/a816ec7e8c89b9fdb7b48b23a8725e83d7e82168", "message": "Set up jib-maven-plugin-extension-api subproject", "committedDate": "2020-03-27T15:03:16Z", "type": "commit"}, {"oid": "1ef7a06e69ab26b6e12d127cb42043072f3da4d0", "url": "https://github.com/GoogleContainerTools/jib/commit/1ef7a06e69ab26b6e12d127cb42043072f3da4d0", "message": "cleanup", "committedDate": "2020-03-27T15:06:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMzNjYxNg==", "url": "https://github.com/GoogleContainerTools/jib/pull/2368#discussion_r399336616", "bodyText": "Should I apply java-library to use the api dependencies?", "author": "chanseokoh", "createdAt": "2020-03-27T15:12:17Z", "path": "build.gradle", "diffHunk": "@@ -21,6 +21,10 @@ idea.project.settings {\n \n import net.ltgt.gradle.errorprone.CheckSeverity\n \n+project('jib-maven-plugin-extension-api') {\n+  apply plugin: 'java-library'", "originalCommit": "1ef7a06e69ab26b6e12d127cb42043072f3da4d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQwODM0Mg==", "url": "https://github.com/GoogleContainerTools/jib/pull/2368#discussion_r399408342", "bodyText": "I mean if java lets you define api dependencies, then maybe this is unnecessary?", "author": "loosebazooka", "createdAt": "2020-03-27T16:57:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMzNjYxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUwNTUyNQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2368#discussion_r400505525", "bodyText": "java doesn't define api. java-library is necessary.", "author": "chanseokoh", "createdAt": "2020-03-30T21:29:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMzNjYxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTcwNDIwOA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2368#discussion_r401704208", "bodyText": "yeah I dunno if there's a better way to do this, I don't like applying these plugins conditionally in some parent. But maybe this is okay for now.", "author": "loosebazooka", "createdAt": "2020-04-01T15:27:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMzNjYxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTczNTcxMQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2368#discussion_r401735711", "bodyText": "Oh, maybe I should put this in jib-maven-plugin-extension-api instead at root.", "author": "chanseokoh", "createdAt": "2020-04-01T16:10:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMzNjYxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTczNjg1NA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2368#discussion_r401736854", "bodyText": "Nah, there was a reason I put it at root. Looks like java-library needs to be applied before java.\nAn exception occurred applying plugin request [id: 'java-library']\n> Failed to apply plugin [id 'org.gradle.java-library']\n   > Cannot create variant 'classes' after configuration ':jib-maven-plugin-extension-api:apiElements' has been resolved", "author": "chanseokoh", "createdAt": "2020-04-01T16:12:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMzNjYxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc2MzcyMg==", "url": "https://github.com/GoogleContainerTools/jib/pull/2368#discussion_r401763722", "bodyText": "oh yeah I agree, I think maybe there's a consequence to us putting so much in the root buildfile :/", "author": "loosebazooka", "createdAt": "2020-04-01T16:53:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMzNjYxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQwNzYzMA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2368#discussion_r399407630", "bodyText": "So I think this part is weird... We don't actually want a direct dependency on the source like this do we?\nIn the end we should depend on the publicly available jib-build-plan obviously we can't do that now since we never released anything.", "author": "loosebazooka", "createdAt": "2020-03-27T16:56:20Z", "path": "jib-maven-plugin-extension-api/build.gradle", "diffHunk": "@@ -0,0 +1,40 @@\n+plugins {\n+  id 'net.researchgate.release'\n+  id 'maven-publish'\n+}\n+\n+dependencies {\n+  api project(':jib-build-plan')", "originalCommit": "1ef7a06e69ab26b6e12d127cb42043072f3da4d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ5NzUzNQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2368#discussion_r399497535", "bodyText": "If we assume we published com.google.cloud.tools:jib-build-plan:0.1.0, I think api 'com.google.cloud.tools:jib-build-plan:0.1.0' is the correct way to go, right? Because the extension dev should be able to access and use those classes in jib-build-plan, isn't it? (I assume the dev will only declare this dependency of this Maven extension API, after which I expect the dev can make use of all the classes in both jib-build-plan and jib-maven-plugin-extension-api plus the maven-core API.) Am I getting this right?\nSo, given that we haven't released jib-build-plan, what do you think is best to move forward at the moment, maybe a temporary measure for the sake of moving forward?", "author": "chanseokoh", "createdAt": "2020-03-27T19:36:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQwNzYzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQwODgxMA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2368#discussion_r399408810", "bodyText": "this one too, I'm unsure of, should we depend on what's publicly available?", "author": "loosebazooka", "createdAt": "2020-03-27T16:58:07Z", "path": "jib-maven-plugin/build.gradle", "diffHunk": "@@ -11,6 +11,7 @@ dependencies {\n   sourceProject project(':jib-build-plan')\n   sourceProject project(':jib-core')\n   sourceProject project(':jib-plugins-common')\n+  sourceProject project(':jib-maven-plugin-extension-api')", "originalCommit": "1ef7a06e69ab26b6e12d127cb42043072f3da4d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ5ODg3NA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2368#discussion_r399498874", "bodyText": "Hmm... yeah, I think we should use a published one. But haven't someone said if we don't make a breaking change in jib-maven-plugin-extension-api, then including source will be acceptable?\nHow should we proceed at the moment?", "author": "chanseokoh", "createdAt": "2020-03-27T19:39:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQwODgxMA=="}], "type": "inlineReview"}, {"oid": "6253a7d261421d88cc1298ff356f20abe0726147", "url": "https://github.com/GoogleContainerTools/jib/commit/6253a7d261421d88cc1298ff356f20abe0726147", "message": "Add extension-common sub-project", "committedDate": "2020-03-30T21:14:53Z", "type": "commit"}, {"oid": "197cebcb886ff9ac9618544e332b5b0421b6424c", "url": "https://github.com/GoogleContainerTools/jib/commit/197cebcb886ff9ac9618544e332b5b0421b6424c", "message": "Update project description", "committedDate": "2020-03-30T21:18:37Z", "type": "commit"}, {"oid": "6f5e9fe35fb59cfaacc895975fee0c7f6dc4723e", "url": "https://github.com/GoogleContainerTools/jib/commit/6f5e9fe35fb59cfaacc895975fee0c7f6dc4723e", "message": "Update dependency declarations in projects", "committedDate": "2020-03-30T21:23:53Z", "type": "commit"}, {"oid": "8972d324b432e3aecbec25c458b9dcc2832d172a", "url": "https://github.com/GoogleContainerTools/jib/commit/8972d324b432e3aecbec25c458b9dcc2832d172a", "message": "Remove ignoreSnapshotDependencies release settings for extension sub-projects because we will eventually not include their class files", "committedDate": "2020-03-30T21:25:24Z", "type": "commit"}, {"oid": "b9c6d16cc8aad9d73eef23b9b937882dc1c916ed", "url": "https://github.com/GoogleContainerTools/jib/commit/b9c6d16cc8aad9d73eef23b9b937882dc1c916ed", "message": "sourceProject jib-maven-plugin-extension-api", "committedDate": "2020-03-31T16:15:05Z", "type": "commit"}, {"oid": "07c78ce07495bd13c26cbb49e8b23ecaa32b4be3", "url": "https://github.com/GoogleContainerTools/jib/commit/07c78ce07495bd13c26cbb49e8b23ecaa32b4be3", "message": "Fix jib-gradle-plugin setup", "committedDate": "2020-03-31T16:29:57Z", "type": "commit"}, {"oid": "9bf50e2bada4f6b4f30696b1d9b210c8e2439a4f", "url": "https://github.com/GoogleContainerTools/jib/commit/9bf50e2bada4f6b4f30696b1d9b210c8e2439a4f", "message": "Merge branch 'master' into plugin-extension", "committedDate": "2020-03-31T18:40:05Z", "type": "commit"}, {"oid": "baf75f1b57e07601f5350fc1f509d00996de0e4c", "url": "https://github.com/GoogleContainerTools/jib/commit/baf75f1b57e07601f5350fc1f509d00996de0e4c", "message": "Merge branch 'master' into plugin-extension", "committedDate": "2020-03-31T23:32:14Z", "type": "commit"}, {"oid": "f919223b40c346d16eb69e0a7804d2b3088f53d2", "url": "https://github.com/GoogleContainerTools/jib/commit/f919223b40c346d16eb69e0a7804d2b3088f53d2", "message": "Fix dependency ordering", "committedDate": "2020-03-31T23:34:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTcwNTEwMg==", "url": "https://github.com/GoogleContainerTools/jib/pull/2368#discussion_r401705102", "bodyText": "I guess we expose maven core api in our api huh.", "author": "loosebazooka", "createdAt": "2020-04-01T15:28:56Z", "path": "jib-maven-plugin-extension-api/build.gradle", "diffHunk": "@@ -0,0 +1,41 @@\n+plugins {\n+  id 'net.researchgate.release'\n+  id 'maven-publish'\n+}\n+\n+dependencies {\n+  api project(':jib-build-plan')\n+  api project(':jib-plugins-extension-common')\n+  api \"org.apache.maven:maven-core:${dependencyVersions.MAVEN_API}\"", "originalCommit": "f919223b40c346d16eb69e0a7804d2b3088f53d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTczMzAyNA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2368#discussion_r401733024", "bodyText": "The API method signature will be like extend(ContainerBuildPlan, MavenProject, MavenSession, ...), so I guess we need to expose the maven-core, unless there's something else workable?", "author": "chanseokoh", "createdAt": "2020-04-01T16:06:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTcwNTEwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTcwNTkyOQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2368#discussion_r401705929", "bodyText": "I feel like this file shouldn't be here.", "author": "loosebazooka", "createdAt": "2020-04-01T15:29:59Z", "path": "jib-plugins-extension-common/settings.gradle", "diffHunk": "@@ -0,0 +1 @@\n+rootProject.name = 'jib-plugins-extension-common'", "originalCommit": "f919223b40c346d16eb69e0a7804d2b3088f53d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTczNDU0Mg==", "url": "https://github.com/GoogleContainerTools/jib/pull/2368#discussion_r401734542", "bodyText": "I still don't know what this file is for. Is this required for releasing? We need to publish this sub-project.\nRemoved per #2377.", "author": "chanseokoh", "createdAt": "2020-04-01T16:09:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTcwNTkyOQ=="}], "type": "inlineReview"}, {"oid": "384d5f99a9e5a36f23e2588b9f5a3a73079901d4", "url": "https://github.com/GoogleContainerTools/jib/commit/384d5f99a9e5a36f23e2588b9f5a3a73079901d4", "message": "Remove settings.gradle files", "committedDate": "2020-04-01T19:22:50Z", "type": "commit"}]}