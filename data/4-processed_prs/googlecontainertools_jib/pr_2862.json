{"pr_number": 2862, "pr_title": "Compute entrypoint for a standard jar in exploded mode.", "pr_createdAt": "2020-10-24T01:25:22Z", "pr_url": "https://github.com/GoogleContainerTools/jib/pull/2862", "timeline": [{"oid": "7f4e83fdc2217d258ab9d3d4ba59ceff4759a90f", "url": "https://github.com/GoogleContainerTools/jib/commit/7f4e83fdc2217d258ab9d3d4ba59ceff4759a90f", "message": "Add method to compute entrypoint for standard jar in exploded mode", "committedDate": "2020-10-24T01:21:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk4NDg5Mw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r511984893", "bodyText": "I remember this used to be caught by the formatter. Maybe not anymore.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Compute the entrypoint for a standard jar in exploded mode.\n          \n          \n            \n               * Computes the entrypoint for a standard jar in exploded mode.", "author": "chanseokoh", "createdAt": "2020-10-26T14:05:20Z", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,42 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Compute the entrypoint for a standard jar in exploded mode.", "originalCommit": "7f4e83fdc2217d258ab9d3d4ba59ceff4759a90f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk4ODE3Mw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r511988173", "bodyText": "Just so you know, if you don't need a nested directory or multiple directories, you can use the root: temporaryFolder.getRoot().toPath().", "author": "chanseokoh", "createdAt": "2020-10-26T14:09:45Z", "path": "jib-cli/src/test/java/com/google/cloud/tools/jib/cli/jar/JarProcessorTest.java", "diffHunk": "@@ -281,4 +282,46 @@ public void testExplodeMode_standard_withoutClassPathInManifest_containsOnlyClas\n             AbsoluteUnixPath.get(\"/app/explodedJar/class1.class\"),\n             AbsoluteUnixPath.get(\"/app/explodedJar/class2.class\"));\n   }\n+\n+  @Test\n+  public void testExplodeMode_standard_computeEntrypoint_allLayersPresent()\n+      throws IOException, URISyntaxException {\n+    Path standardJar =\n+        Paths.get(Resources.getResource(STANDARD_JAR_WITH_CLASS_PATH_MANIFEST).toURI());\n+    Path destDir = temporaryFolder.newFolder().toPath();", "originalCommit": "7f4e83fdc2217d258ab9d3d4ba59ceff4759a90f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk4OTI3OA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r511989278", "bodyText": "Using _ is only accepted in test method names. computeEntrypointForExplodedStandard()?\nAnd I don't know who will require this method, but you should always double-checking if a method may have a narrower access scope. (Just don't habitually make everything public until necessary.)", "author": "chanseokoh", "createdAt": "2020-10-26T14:11:11Z", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,42 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Compute the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   * @throws IllegalArgumentException if main class is not found in the jar manifest\n+   */\n+  public static ImmutableList<String> computeEntrypoint_explodedStandard(", "originalCommit": "7f4e83fdc2217d258ab9d3d4ba59ceff4759a90f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwMTg0OA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512301848", "bodyText": "oops I keep mixing up the naming with python convention\nOh good point. Changed this method and explodeStandardJar to protected since they will be accessed from within the same package (specifically in the class that will be used to take a jar and convert it into a JibContainerBuilder -- next pr).", "author": "mpeddada1", "createdAt": "2020-10-26T22:16:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk4OTI3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk5MzA0Ng==", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r511993046", "bodyText": "I admit we don't have a good established policy around throwing, handling, and reporting exceptions and errors. We have not done well so far. But at least the situation for Jib CLI is not so grim, as it is not a library but a CLI. So I think throwing a runtime exception to crash for this type of errors is more or less acceptable.\nAnyways, what I wanted to say is that, I think it's fine to not specify IllegalStateException (or IllegalArgumentException). Also in the Javadoc.", "author": "chanseokoh", "createdAt": "2020-10-26T14:16:25Z", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,42 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Compute the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   * @throws IllegalArgumentException if main class is not found in the jar manifest\n+   */\n+  public static ImmutableList<String> computeEntrypoint_explodedStandard(\n+      Path jarPath, Path tempDirPath, List<FileEntriesLayer> layers)\n+      throws IOException, IllegalStateException {", "originalCommit": "7f4e83fdc2217d258ab9d3d4ba59ceff4759a90f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk5NTkwNw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r511995907", "bodyText": "The CLI will crash with this message. And providing a clear message implying an actionable fix increases the chance of the user understanding and fixing the issue on their own, resulting in less frustrated getting-started experience (which is important to increase the chance of adoption). It also reduces our workload by reducing the likelyhood of multiple user opening the same issue.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  throw new IllegalArgumentException(\"Main-Class not found in jar's manifest.\");\n          \n          \n            \n                  throw new IllegalArgumentException(\"'Main-Class:' attribute to define an application main class not defined in the input JAR's manifest ('META-INF/MANIFEST.MF` in the JAR).\");", "author": "chanseokoh", "createdAt": "2020-10-26T14:20:19Z", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,42 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Compute the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   * @throws IllegalArgumentException if main class is not found in the jar manifest\n+   */\n+  public static ImmutableList<String> computeEntrypoint_explodedStandard(\n+      Path jarPath, Path tempDirPath, List<FileEntriesLayer> layers)\n+      throws IOException, IllegalStateException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+\n+    String mainClass = null;\n+    try (JarFile jarFile = new JarFile(jarPath.toFile())) {\n+      mainClass = jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.MAIN_CLASS);\n+    }\n+    if (mainClass == null) {\n+      throw new IllegalArgumentException(\"Main-Class not found in jar's manifest.\");", "originalCommit": "7f4e83fdc2217d258ab9d3d4ba59ceff4759a90f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwMTUzNQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512301535", "bodyText": "Ah you're right. Better error messaging is certainly helpful especially with something that causes the code to crash. Thanks.", "author": "mpeddada1", "createdAt": "2020-10-26T22:15:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk5NTkwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAwMzQwOQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512003409", "bodyText": "At least this should be\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    classpath.add(APP_ROOT.resolve(\"dependencies\").toString());\n          \n          \n            \n                    classpath.add(APP_ROOT + \"/dependencies/*\");\n          \n      \n    \n    \n  \n\nJust so you know, there's an issue with the order of loading jars (like #1871 for Jib build plugins), but I think there's nothing we can do about it for a standard jar.", "author": "chanseokoh", "createdAt": "2020-10-26T14:29:44Z", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,42 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Compute the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   * @throws IllegalArgumentException if main class is not found in the jar manifest\n+   */\n+  public static ImmutableList<String> computeEntrypoint_explodedStandard(\n+      Path jarPath, Path tempDirPath, List<FileEntriesLayer> layers)\n+      throws IOException, IllegalStateException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+\n+    String mainClass = null;\n+    try (JarFile jarFile = new JarFile(jarPath.toFile())) {\n+      mainClass = jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.MAIN_CLASS);\n+    }\n+    if (mainClass == null) {\n+      throw new IllegalArgumentException(\"Main-Class not found in jar's manifest.\");\n+    }\n+    List<String> classpath = new ArrayList<>();\n+    for (FileEntriesLayer layer : layers) {\n+      if (layer.getName().equals(DEPENDENCIES) || layer.getName().equals(SNAPSHOT_DEPENDENCIES)) {\n+        classpath.add(APP_ROOT.resolve(\"dependencies\").toString());", "originalCommit": "7f4e83fdc2217d258ab9d3d4ba59ceff4759a90f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwMjU3OA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512302578", "bodyText": "is the ordering issue not a problem for a standard jar atm?", "author": "mpeddada1", "createdAt": "2020-10-26T22:18:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAwMzQwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAwNjkyNA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512006924", "bodyText": "Considering the order of loading classes, explodedJar should come before dependencies. That said, how about going simple? It's okay to put a non-existing directory. I think the level of code reduction is worth.\nString classpath = APP_ROOT + \"/explodedJar:\" + APP_ROOT + \"/dependencies/*\";", "author": "chanseokoh", "createdAt": "2020-10-26T14:34:07Z", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,42 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Compute the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   * @throws IllegalArgumentException if main class is not found in the jar manifest\n+   */\n+  public static ImmutableList<String> computeEntrypoint_explodedStandard(\n+      Path jarPath, Path tempDirPath, List<FileEntriesLayer> layers)\n+      throws IOException, IllegalStateException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+\n+    String mainClass = null;\n+    try (JarFile jarFile = new JarFile(jarPath.toFile())) {\n+      mainClass = jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.MAIN_CLASS);\n+    }\n+    if (mainClass == null) {\n+      throw new IllegalArgumentException(\"Main-Class not found in jar's manifest.\");\n+    }\n+    List<String> classpath = new ArrayList<>();\n+    for (FileEntriesLayer layer : layers) {\n+      if (layer.getName().equals(DEPENDENCIES) || layer.getName().equals(SNAPSHOT_DEPENDENCIES)) {\n+        classpath.add(APP_ROOT.resolve(\"dependencies\").toString());\n+        break;\n+      }\n+    }\n+    classpath.add(APP_ROOT.resolve(\"explodedJar\").toString());\n+    String classPathString = String.join(\":\", classpath);", "originalCommit": "7f4e83fdc2217d258ab9d3d4ba59ceff4759a90f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fd9300c82f0b330eec4d0a1e380f0bca1246f239", "url": "https://github.com/GoogleContainerTools/jib/commit/fd9300c82f0b330eec4d0a1e380f0bca1246f239", "message": " improve error messaging, narrow down scope of method", "committedDate": "2020-10-26T22:18:34Z", "type": "commit"}, {"oid": "f61293e5301784f83c8a86c8c87fbc7b1b187466", "url": "https://github.com/GoogleContainerTools/jib/commit/f61293e5301784f83c8a86c8c87fbc7b1b187466", "message": "use getRoot instead of newFolder in test", "committedDate": "2020-10-26T22:27:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwNzM3OA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512307378", "bodyText": "Perhaps this can be package-private?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              protected static List<FileEntriesLayer> explodeStandardJar(Path jarPath, Path tempDirPath)\n          \n          \n            \n              static List<FileEntriesLayer> explodeStandardJar(Path jarPath, Path tempDirPath)\n          \n      \n    \n    \n  \n\nAnd if this needs to be package-private only to be able to call from tests (i.e., it should have been private if not for the tests), add @VisibleForTesting.", "author": "chanseokoh", "createdAt": "2020-10-26T22:29:15Z", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -76,7 +81,7 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n    * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n    *     provided doesn't exist\n    */\n-  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath, Path tempDirPath)\n+  protected static List<FileEntriesLayer> explodeStandardJar(Path jarPath, Path tempDirPath)", "originalCommit": "f61293e5301784f83c8a86c8c87fbc7b1b187466", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwODI4Ng==", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512308286", "bodyText": "Sorry, I think this reads better:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      \"`Main-Class:` attribute to define an application main class not defined in the input Jar's manifest (`META-INF/MANIFEST.MF` in the JAR).\");\n          \n          \n            \n                      \"`Main-Class:` attribute for an application main class not defined in the input Jar's manifest (`META-INF/MANIFEST.MF` in the Jar).\");", "author": "chanseokoh", "createdAt": "2020-10-26T22:31:23Z", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,33 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Computes the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   */\n+  protected static ImmutableList<String> computeEntrypointForExplodedStandard(\n+      Path jarPath, Path tempDirPath, List<FileEntriesLayer> layers) throws IOException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+\n+    String mainClass = null;\n+    try (JarFile jarFile = new JarFile(jarPath.toFile())) {\n+      mainClass = jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.MAIN_CLASS);\n+    }\n+    if (mainClass == null) {\n+      throw new IllegalArgumentException(\n+          \"`Main-Class:` attribute to define an application main class not defined in the input Jar's manifest (`META-INF/MANIFEST.MF` in the JAR).\");", "originalCommit": "f61293e5301784f83c8a86c8c87fbc7b1b187466", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwODg5NA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512308894", "bodyText": "Oh, actually, I remember unzipping a jar somewhere else too. Are we unzipping it multiple times? We should unzip only once for efficiency.", "author": "chanseokoh", "createdAt": "2020-10-26T22:33:11Z", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,33 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Computes the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   */\n+  protected static ImmutableList<String> computeEntrypointForExplodedStandard(\n+      Path jarPath, Path tempDirPath, List<FileEntriesLayer> layers) throws IOException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);", "originalCommit": "f61293e5301784f83c8a86c8c87fbc7b1b187466", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY2NDczMw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512664733", "bodyText": "Actually, I think there is no need to unzip a jar?", "author": "chanseokoh", "createdAt": "2020-10-27T12:51:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwODg5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1ODEyNA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512758124", "bodyText": "Cleaned this up a bit.", "author": "mpeddada1", "createdAt": "2020-10-27T14:49:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwODg5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwOTQ5OA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512309498", "bodyText": "Nit: I think this code block is super fast, so it's good to put everything in to the try-resource block.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                try (JarFile jarFile = new JarFile(jarPath.toFile())) {\n          \n          \n            \n                  mainClass = jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.MAIN_CLASS);\n          \n          \n            \n                }\n          \n          \n            \n                try (JarFile jarFile = new JarFile(jarPath.toFile())) {\n          \n          \n            \n                  String mainClass = jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.MAIN_CLASS);\n          \n          \n            \n                  if (mainClass == null)\n          \n          \n            \n                  ...\n          \n          \n            \n                  return ...\n          \n          \n            \n                }", "author": "chanseokoh", "createdAt": "2020-10-26T22:34:43Z", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,33 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Computes the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   */\n+  protected static ImmutableList<String> computeEntrypointForExplodedStandard(\n+      Path jarPath, Path tempDirPath, List<FileEntriesLayer> layers) throws IOException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+\n+    String mainClass = null;\n+    try (JarFile jarFile = new JarFile(jarPath.toFile())) {\n+      mainClass = jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.MAIN_CLASS);\n+    }", "originalCommit": "f61293e5301784f83c8a86c8c87fbc7b1b187466", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1NzcwMA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512757700", "bodyText": "Done.", "author": "mpeddada1", "createdAt": "2020-10-27T14:49:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwOTQ5OA=="}], "type": "inlineReview"}, {"oid": "037672a28d0887d4aa21004ff67b4f7f6a8f65f3", "url": "https://github.com/GoogleContainerTools/jib/commit/037672a28d0887d4aa21004ff67b4f7f6a8f65f3", "message": "fix parameters", "committedDate": "2020-10-27T14:24:59Z", "type": "commit"}, {"oid": "3dcc8f0ef8ed2cb25c679249864a42203686833f", "url": "https://github.com/GoogleContainerTools/jib/commit/3dcc8f0ef8ed2cb25c679249864a42203686833f", "message": "making methods package-private", "committedDate": "2020-10-27T14:28:43Z", "type": "commit"}, {"oid": "188717e569d99024208d3b77e2d801ec3f43f886", "url": "https://github.com/GoogleContainerTools/jib/commit/188717e569d99024208d3b77e2d801ec3f43f886", "message": "modify try-resource block", "committedDate": "2020-10-27T14:35:27Z", "type": "commit"}, {"oid": "5cbcd621d97d066b830e5ac08cf2ffdf898623a3", "url": "https://github.com/GoogleContainerTools/jib/commit/5cbcd621d97d066b830e5ac08cf2ffdf898623a3", "message": "minor formatting", "committedDate": "2020-10-27T14:37:13Z", "type": "commit"}, {"oid": "e8f1968f6d65365ba74734a4796367768dbfd27b", "url": "https://github.com/GoogleContainerTools/jib/commit/e8f1968f6d65365ba74734a4796367768dbfd27b", "message": "modifying tests", "committedDate": "2020-10-27T14:43:00Z", "type": "commit"}]}