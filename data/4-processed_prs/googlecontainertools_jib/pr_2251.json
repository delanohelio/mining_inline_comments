{"pr_number": 2251, "pr_title": "Add scripts to update GCS with latest version string", "pr_createdAt": "2020-01-27T17:55:55Z", "pr_url": "https://github.com/GoogleContainerTools/jib/pull/2251", "timeline": [{"oid": "c60b66350c56d33a62d9166f8aa55fe3acd77f89", "url": "https://github.com/GoogleContainerTools/jib/commit/c60b66350c56d33a62d9166f8aa55fe3acd77f89", "message": "Add scripts to update GCS with latest version string", "committedDate": "2020-01-27T17:52:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM5MjQ3NA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2251#discussion_r371392474", "bodyText": "Q: I put the GCS update stuff in a separate script since the maven release process takes some time. Should we just combine the scripts anyway and not worry about GCS reporting an unrelease version for a few minutes/hours?", "author": "TadCordle", "createdAt": "2020-01-27T17:57:16Z", "path": "jib-maven-plugin/scripts/prepare_release.sh", "diffHunk": "@@ -58,3 +58,4 @@ EchoGreen 'File a PR for the new release branch:'\n echo https://github.com/GoogleContainerTools/jib/pull/new/${BRANCH}\n \n EchoGreen \"Merge the PR after the plugin is released.\"\n+EchoGreen \"Run './scripts/update_gcs_latest ${VERSION}' when the release is complete to update the latest version string on GCS.\"", "originalCommit": "c60b66350c56d33a62d9166f8aa55fe3acd77f89", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM5NDgzOA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2251#discussion_r371394838", "bodyText": "I think we should update the version only after we verify a new release is available for consumption for both Gradle and Maven.\nAdd .sh.", "author": "chanseokoh", "createdAt": "2020-01-27T18:02:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM5MjQ3NA=="}], "type": "inlineReview"}, {"oid": "5c17fa310ecdfa1388d3e1b10a366bd337d8a6e9", "url": "https://github.com/GoogleContainerTools/jib/commit/5c17fa310ecdfa1388d3e1b10a366bd337d8a6e9", "message": "Less repeated strings", "committedDate": "2020-01-27T18:00:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM5MzQyNw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2251#discussion_r371393427", "bodyText": "update_gcs_latest.sh (add .sh)", "author": "chanseokoh", "createdAt": "2020-01-27T17:59:15Z", "path": "jib-gradle-plugin/scripts/prepare_release.sh", "diffHunk": "@@ -59,3 +59,4 @@ echo https://github.com/GoogleContainerTools/jib/pull/new/${BRANCH}\n \n EchoGreen \"Once approved, checkout the 'v${VERSION}-gradle' tag and run './gradlew jib-gradle-plugin:publishPlugins'.\"\n EchoGreen \"Merge the PR after the plugin is released.\"\n+EchoGreen \"Run './scripts/update_gcs_latest ${VERSION}' when the release is complete to update the latest version string on GCS.\"", "originalCommit": "c60b66350c56d33a62d9166f8aa55fe3acd77f89", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM5NTc4OA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2251#discussion_r371395788", "bodyText": "I believe this is unnecessary and the file will be overwritten. This is safer in the case gsutil cp fails.", "author": "chanseokoh", "createdAt": "2020-01-27T18:04:04Z", "path": "jib-gradle-plugin/scripts/update_gcs_latest.sh", "diffHunk": "@@ -0,0 +1,42 @@\n+#!/bin/bash -\n+# Usage: ./scripts/update_gcs_latest.sh <release version>\n+\n+set -e\n+\n+EchoRed() {\n+\techo \"$(tput setaf 1; tput bold)$1$(tput sgr0)\"\n+}\n+EchoGreen() {\n+\techo \"$(tput setaf 2; tput bold)$1$(tput sgr0)\"\n+}\n+\n+Die() {\n+\tEchoRed \"$1\"\n+\texit 1\n+}\n+\n+# Usage: CheckVersion <version>\n+CheckVersion() {\n+    [[ $1 =~ ^[0-9]+\\.[0-9]+\\.[0-9]+(-[0-9A-Za-z]+)?$ ]] || Die \"Version: $1 not in ###.###.###[-XXX] format.\"\n+}\n+\n+[ $# -ne 1 ] && Die \"Usage: ./scripts/update_gcs_latest.sh <release version>\"\n+\n+CheckVersion $1\n+\n+versionString=\"{\\\"latest\\\":\\\"$1\\\"}\"\n+destination=\"gs://jib-versions/jib-gradle\"\n+\n+echo $versionString > jib-gradle\n+gsutil rm $destination", "originalCommit": "5c17fa310ecdfa1388d3e1b10a366bd337d8a6e9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4dd400a18f83d5f8639ceac1f3869599d297aacb", "url": "https://github.com/GoogleContainerTools/jib/commit/4dd400a18f83d5f8639ceac1f3869599d297aacb", "message": "Feedback", "committedDate": "2020-01-27T20:12:32Z", "type": "commit"}]}