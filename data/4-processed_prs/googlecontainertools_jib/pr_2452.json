{"pr_number": 2452, "pr_title": "Add maven extra directory target configuration", "pr_createdAt": "2020-05-05T22:53:38Z", "pr_url": "https://github.com/GoogleContainerTools/jib/pull/2452", "timeline": [{"oid": "6548c75efefe3fa793c6dc3b7fd1b44b36d3547e", "url": "https://github.com/GoogleContainerTools/jib/commit/6548c75efefe3fa793c6dc3b7fd1b44b36d3547e", "message": "Minor refactoring to prepare for extra directory targets", "committedDate": "2020-04-28T15:52:51Z", "type": "commit"}, {"oid": "48dc792779ffd77ecc8c54a7539ae08559818292", "url": "https://github.com/GoogleContainerTools/jib/commit/48dc792779ffd77ecc8c54a7539ae08559818292", "message": "Merge branch 'master' of github.com:GoogleContainerTools/jib into 1581-extra-dir-target-refactor", "committedDate": "2020-04-28T15:57:59Z", "type": "commit"}, {"oid": "b1dd2fe6c8afcb2b1934d42435cc0b516c742465", "url": "https://github.com/GoogleContainerTools/jib/commit/b1dd2fe6c8afcb2b1934d42435cc0b516c742465", "message": "Merge branch 'master' of github.com:GoogleContainerTools/jib into i1581-extra-dir-target-maven", "committedDate": "2020-05-05T19:18:20Z", "type": "commit"}, {"oid": "fe0565e0b73f11cd154e43a93e3c273456ef38b4", "url": "https://github.com/GoogleContainerTools/jib/commit/fe0565e0b73f11cd154e43a93e3c273456ef38b4", "message": "Merge", "committedDate": "2020-05-05T19:20:20Z", "type": "commit"}, {"oid": "9b0d0e1c3728777b52f9f5596c5182cc1ae22373", "url": "https://github.com/GoogleContainerTools/jib/commit/9b0d0e1c3728777b52f9f5596c5182cc1ae22373", "message": "Add maven extra directory target configuration", "committedDate": "2020-05-05T19:25:39Z", "type": "commit"}, {"oid": "068af40b825bba8969fddf3748f6d7bbd128ea4c", "url": "https://github.com/GoogleContainerTools/jib/commit/068af40b825bba8969fddf3748f6d7bbd128ea4c", "message": "Progress", "committedDate": "2020-05-05T22:09:18Z", "type": "commit"}, {"oid": "7013fc8c647164288ecfeec5ee9e4328a953b32d", "url": "https://github.com/GoogleContainerTools/jib/commit/7013fc8c647164288ecfeec5ee9e4328a953b32d", "message": "Fix git/refactor confusion", "committedDate": "2020-05-05T22:29:13Z", "type": "commit"}, {"oid": "35ceb7f7dd2df8d75c82bb6c6f289828e3fb8e72", "url": "https://github.com/GoogleContainerTools/jib/commit/35ceb7f7dd2df8d75c82bb6c6f289828e3fb8e72", "message": "More fix", "committedDate": "2020-05-05T22:31:48Z", "type": "commit"}, {"oid": "0d9cdee787a44534b99cc7eadf450156aab70ebb", "url": "https://github.com/GoogleContainerTools/jib/commit/0d9cdee787a44534b99cc7eadf450156aab70ebb", "message": "More fix", "committedDate": "2020-05-05T22:32:38Z", "type": "commit"}, {"oid": "9046468963609b0c5c972f44cdf6e2adaaf69c74", "url": "https://github.com/GoogleContainerTools/jib/commit/9046468963609b0c5c972f44cdf6e2adaaf69c74", "message": "Format", "committedDate": "2020-05-05T22:54:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkxODUzMg==", "url": "https://github.com/GoogleContainerTools/jib/pull/2452#discussion_r420918532", "bodyText": "I think we can remove unmodifiableList for consistency. It's weird to sometimes return a modifiable list (line 242) and other times an unmodifiable one.", "author": "chanseokoh", "createdAt": "2020-05-06T16:17:18Z", "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/skaffold/FilesMojoV2.java", "diffHunk": "@@ -251,7 +252,17 @@ public void execute() throws MojoExecutionException, MojoFailureException {\n           Xpp3Dom paths = extraDirectoriesConfiguration.getChild(\"paths\");\n           if (paths != null) {\n             // <extraDirectories><paths><path>...</path><path>...</path></paths></extraDirectories>\n-            return xpp3ToList(paths, Paths::get);\n+            // paths can contain either strings or ExtraDirectory objects\n+            List<Path> pathList = new ArrayList<>();\n+            for (Xpp3Dom path : paths.getChildren()) {\n+              Xpp3Dom from = path.getChild(\"from\");\n+              if (from != null) {\n+                pathList.add(Paths.get(from.getValue()));\n+              } else {\n+                pathList.add(Paths.get(path.getValue()));\n+              }\n+            }\n+            return Collections.unmodifiableList(pathList);", "originalCommit": "9046468963609b0c5c972f44cdf6e2adaaf69c74", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk1MzE4Ng==", "url": "https://github.com/GoogleContainerTools/jib/pull/2452#discussion_r420953186", "bodyText": "I think errorprone (?) complained about this same inconsistency before I added this. I thought Collections.singletonList and Collectors.toList were unmodifiable?", "author": "TadCordle", "createdAt": "2020-05-06T17:09:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkxODUzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk1NTkwOA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2452#discussion_r420955908", "bodyText": "Ah, singletonList() is immutable according to the Javadoc. And for Collectors.toList(), its Javadoc says,\n\nThere are no guarantees on the type, mutability, serializability, or thread-safety of the List returned\n\nI think we're good.", "author": "chanseokoh", "createdAt": "2020-05-06T17:14:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkxODUzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkyMDU3MA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2452#discussion_r420920570", "bodyText": "Are we comparing instances of this class? Where? If not, we should probably remove equals and hashCode?", "author": "chanseokoh", "createdAt": "2020-05-06T16:20:28Z", "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/ExtraDirectory.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package com.google.cloud.tools.jib.maven;\n+\n+import java.io.File;\n+import java.nio.file.Path;\n+import java.util.Objects;\n+import org.apache.maven.plugins.annotations.Parameter;\n+\n+/** A bean that configures the source and destination of an extra directory. */\n+public class ExtraDirectory {\n+\n+  @Parameter private File from = new File(\"\");\n+  @Parameter private String into = \"/\";\n+\n+  // Need default constructor for Maven\n+  public ExtraDirectory() {}\n+\n+  public ExtraDirectory(File from, String into) {\n+    this.from = from;\n+    this.into = into;\n+  }\n+\n+  // Allows <path>source</path> shorthand instead of forcing\n+  // <path><from>source</from><into>/</into></path>\n+  public void set(File path) {\n+    this.from = path;\n+    this.into = \"/\";\n+  }\n+\n+  public Path getFrom() {\n+    return from.toPath();\n+  }\n+\n+  public void setFrom(File from) {\n+    this.from = from;\n+  }\n+\n+  String getInto() {\n+    return into;\n+  }\n+\n+  @Override\n+  public boolean equals(Object other) {", "originalCommit": "9046468963609b0c5c972f44cdf6e2adaaf69c74", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk1MTYzMQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2452#discussion_r420951631", "bodyText": "In tests, yes.", "author": "TadCordle", "createdAt": "2020-05-06T17:07:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkyMDU3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk1NzQzMg==", "url": "https://github.com/GoogleContainerTools/jib/pull/2452#discussion_r420957432", "bodyText": "Aha. Although it's going to be more lines for test code, I prefer removing these.", "author": "chanseokoh", "createdAt": "2020-05-06T17:16:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkyMDU3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkyMzcwNw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2452#discussion_r420923707", "bodyText": "Can we name this ExtraDirectoryParameters and move it to JibPluginConfiguration for consistency?", "author": "chanseokoh", "createdAt": "2020-05-06T16:25:00Z", "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/ExtraDirectory.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package com.google.cloud.tools.jib.maven;\n+\n+import java.io.File;\n+import java.nio.file.Path;\n+import java.util.Objects;\n+import org.apache.maven.plugins.annotations.Parameter;\n+\n+/** A bean that configures the source and destination of an extra directory. */\n+public class ExtraDirectory {", "originalCommit": "9046468963609b0c5c972f44cdf6e2adaaf69c74", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4e11ceb2f60c80b9363a50d5869765705f23e600", "url": "https://github.com/GoogleContainerTools/jib/commit/4e11ceb2f60c80b9363a50d5869765705f23e600", "message": "Feedback and changelog", "committedDate": "2020-05-06T18:01:22Z", "type": "commit"}, {"oid": "36770d8be18f6fdcf721cb8c96658727c52e468e", "url": "https://github.com/GoogleContainerTools/jib/commit/36770d8be18f6fdcf721cb8c96658727c52e468e", "message": "Make sure source directory is set", "committedDate": "2020-05-06T18:08:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk5MzY2Ng==", "url": "https://github.com/GoogleContainerTools/jib/pull/2452#discussion_r420993666", "bodyText": "Not necessary, but import ... JibPluginConfiguration.ExtraDirectoryParameters to import the nested type may work?", "author": "chanseokoh", "createdAt": "2020-05-06T18:12:59Z", "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MojoCommon.java", "diffHunk": "@@ -94,15 +94,25 @@ static void finishUpdateChecker(\n    * @param jibPluginConfiguration the build configuration\n    * @return the list of resolved extra directories\n    */\n-  static List<Path> getExtraDirectories(JibPluginConfiguration jibPluginConfiguration) {\n-    List<Path> paths = jibPluginConfiguration.getExtraDirectories();\n-    if (!paths.isEmpty()) {\n-      return paths;\n+  static List<JibPluginConfiguration.ExtraDirectoryParameters> getExtraDirectories(", "originalCommit": "36770d8be18f6fdcf721cb8c96658727c52e468e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a2d95068bd2a91accf6217e13c96a82be78bb1c2", "url": "https://github.com/GoogleContainerTools/jib/commit/a2d95068bd2a91accf6217e13c96a82be78bb1c2", "message": "Import", "committedDate": "2020-05-06T18:18:56Z", "type": "commit"}]}