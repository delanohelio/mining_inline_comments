{"pr_number": 2959, "pr_title": "remove dependency on testkit in jibcli", "pr_createdAt": "2020-12-22T23:03:04Z", "pr_url": "https://github.com/GoogleContainerTools/jib/pull/2959", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1NjUzMw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2959#discussion_r547556533", "bodyText": "Shouldn't this be removed?", "author": "chanseokoh", "createdAt": "2020-12-22T23:31:06Z", "path": "jib-cli/src/integration-test/resources/jarTest/spring-boot/spring-boot/build.gradle", "diffHunk": "@@ -0,0 +1,26 @@\n+plugins {\n+    id 'org.springframework.boot' version '2.3.7.RELEASE'\n+    id 'io.spring.dependency-management' version '1.0.10.RELEASE'\n+    id 'java'\n+}\n+\n+sourceCompatibility = '1.8'\n+\n+bootJar {\n+    layered {\n+        enabled = true\n+    }\n+}", "originalCommit": "6fe9e4b806465243be51faf5133e17294cb6a5c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU2ODAxMw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2959#discussion_r547568013", "bodyText": "Hrm interesting, yes, but then it doesn't seem to matter if the build is layered or not", "author": "loosebazooka", "createdAt": "2020-12-23T00:15:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1NjUzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU3MDM0Nw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2959#discussion_r547570347", "bodyText": "I wonder why  assertThat(jarFile.getEntry(\"BOOT-INF/layers.idx\")).isNull(); doesn't fail when we have it.", "author": "mpeddada1", "createdAt": "2020-12-23T00:24:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1NjUzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAwMDIxOQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2959#discussion_r548000219", "bodyText": "@loosebazooka are you running the ./gradlew integT task? They don't run in non-integration tests.", "author": "chanseokoh", "createdAt": "2020-12-23T15:01:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1NjUzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAyNzA2NA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2959#discussion_r548027064", "bodyText": "pretty sure I am, is it failing for you?", "author": "loosebazooka", "createdAt": "2020-12-23T15:58:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1NjUzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAyOTY1NQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2959#discussion_r548029655", "bodyText": "oh that directory isn't used. It was some artifact of the copy. Sorry.", "author": "loosebazooka", "createdAt": "2020-12-23T16:04:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1NjUzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1NjgxNw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2959#discussion_r547556817", "bodyText": "This can be chained? new Command(cmd).setWorkingDir(...).run()", "author": "chanseokoh", "createdAt": "2020-12-22T23:32:12Z", "path": "jib-cli/src/integration-test/java/com/google/cloud/tools/jib/cli/cli2/TestProject.java", "diffHunk": "@@ -74,13 +73,15 @@ protected void before() throws Throwable {\n \n     projectRoot = newFolder().toPath();\n     copyProject(testProjectName, projectRoot);\n-\n-    gradleRunner =\n-        GradleRunner.create().withGradleVersion(gradleVersion).withProjectDir(projectRoot.toFile());\n   }\n \n-  public BuildResult build(String... gradleArguments) {\n-    return gradleRunner.withArguments(gradleArguments).build();\n+  public void build(String... gradleArguments) throws IOException, InterruptedException {\n+    List<String> cmd = new ArrayList<>();\n+    cmd.add(\"./gradlew\");\n+    cmd.addAll(Arrays.asList(gradleArguments));\n+    Command command = new Command(cmd);\n+    command.setWorkingDir(projectRoot);\n+    command.run();", "originalCommit": "6fe9e4b806465243be51faf5133e17294cb6a5c2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU2MjY4Ng==", "url": "https://github.com/GoogleContainerTools/jib/pull/2959#discussion_r547562686", "bodyText": "we can remove this since it's for a non-layered spring-boot jar", "author": "mpeddada1", "createdAt": "2020-12-22T23:54:04Z", "path": "jib-cli/src/integration-test/resources/jarTest/spring-boot/spring-boot/build.gradle", "diffHunk": "@@ -0,0 +1,26 @@\n+plugins {\n+    id 'org.springframework.boot' version '2.3.7.RELEASE'\n+    id 'io.spring.dependency-management' version '1.0.10.RELEASE'\n+    id 'java'\n+}\n+\n+sourceCompatibility = '1.8'\n+\n+bootJar {\n+    layered {\n+        enabled = true\n+    }\n+}", "originalCommit": "6fe9e4b806465243be51faf5133e17294cb6a5c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU2MzI2NA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2959#discussion_r547563264", "bodyText": "oh oops, forgot to hit refresh.", "author": "mpeddada1", "createdAt": "2020-12-22T23:56:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU2MjY4Ng=="}], "type": "inlineReview"}, {"oid": "6d4fcda0f02e4b88bd689bb5b30727561f118c35", "url": "https://github.com/GoogleContainerTools/jib/commit/6d4fcda0f02e4b88bd689bb5b30727561f118c35", "message": "remove dependency on testkit in jibcli", "committedDate": "2020-12-23T16:06:17Z", "type": "commit"}, {"oid": "d8dc98f3b2f648f8245dfda88fc31608f9833901", "url": "https://github.com/GoogleContainerTools/jib/commit/d8dc98f3b2f648f8245dfda88fc31608f9833901", "message": "cleanup", "committedDate": "2020-12-23T16:06:17Z", "type": "commit"}, {"oid": "d8dc98f3b2f648f8245dfda88fc31608f9833901", "url": "https://github.com/GoogleContainerTools/jib/commit/d8dc98f3b2f648f8245dfda88fc31608f9833901", "message": "cleanup", "committedDate": "2020-12-23T16:06:17Z", "type": "forcePushed"}, {"oid": "5dc5ea6172d23d935a48e2c3e7b08da0d05dd186", "url": "https://github.com/GoogleContainerTools/jib/commit/5dc5ea6172d23d935a48e2c3e7b08da0d05dd186", "message": "formatting", "committedDate": "2020-12-23T16:28:37Z", "type": "commit"}]}