{"pr_number": 2420, "pr_title": "Add and enable new plugin extension configuration in Maven", "pr_createdAt": "2020-04-20T17:40:01Z", "pr_url": "https://github.com/GoogleContainerTools/jib/pull/2420", "timeline": [{"oid": "705d5cc7d43c57dbbcfac4255b6222bce7dbcb23", "url": "https://github.com/GoogleContainerTools/jib/commit/705d5cc7d43c57dbbcfac4255b6222bce7dbcb23", "message": "Add extension configuration option for Maven", "committedDate": "2020-04-16T20:54:10Z", "type": "commit"}, {"oid": "f505261172994a087507db82ae5eb9c202549144", "url": "https://github.com/GoogleContainerTools/jib/commit/f505261172994a087507db82ae5eb9c202549144", "message": "Move plugin extension tests to a new class", "committedDate": "2020-04-16T21:10:47Z", "type": "commit"}, {"oid": "f1dc3625ce8cc64a6f1443a17d8c257f01c066b7", "url": "https://github.com/GoogleContainerTools/jib/commit/f1dc3625ce8cc64a6f1443a17d8c257f01c066b7", "message": "Merge branch 'refactor-tests' into plugin-extension-java-src-new-config", "committedDate": "2020-04-16T21:17:14Z", "type": "commit"}, {"oid": "bb65ebdf93b98f560a73d524c3d15ecab76c3f27", "url": "https://github.com/GoogleContainerTools/jib/commit/bb65ebdf93b98f560a73d524c3d15ecab76c3f27", "message": "Iterator over configs instead of extension list", "committedDate": "2020-04-16T22:42:29Z", "type": "commit"}, {"oid": "e6f4532355926cf30280e82329582b1242fe1227", "url": "https://github.com/GoogleContainerTools/jib/commit/e6f4532355926cf30280e82329582b1242fe1227", "message": "Update and add tests", "committedDate": "2020-04-17T15:41:15Z", "type": "commit"}, {"oid": "ca9e84e47c6dd3c5294dd048c917fbbb17f9aad4", "url": "https://github.com/GoogleContainerTools/jib/commit/ca9e84e47c6dd3c5294dd048c917fbbb17f9aad4", "message": "Update test", "committedDate": "2020-04-17T17:56:42Z", "type": "commit"}, {"oid": "8032a6a3fb01f04a2913e55df2ca21156ff313b1", "url": "https://github.com/GoogleContainerTools/jib/commit/8032a6a3fb01f04a2913e55df2ca21156ff313b1", "message": "Update tests", "committedDate": "2020-04-17T21:50:20Z", "type": "commit"}, {"oid": "94c63403bab9d278c7811a281f93e68f86cfbc0c", "url": "https://github.com/GoogleContainerTools/jib/commit/94c63403bab9d278c7811a281f93e68f86cfbc0c", "message": "Add test", "committedDate": "2020-04-20T16:06:13Z", "type": "commit"}, {"oid": "38fc005824636ad18495e84714150f114cb50235", "url": "https://github.com/GoogleContainerTools/jib/commit/38fc005824636ad18495e84714150f114cb50235", "message": "Merge remote-tracking branch 'origin/master' into plugin-extension-java-src-new-config", "committedDate": "2020-04-20T16:08:59Z", "type": "commit"}, {"oid": "0084c2c5b2079d73f1e475b6a2b9e93ed18cd65b", "url": "https://github.com/GoogleContainerTools/jib/commit/0084c2c5b2079d73f1e475b6a2b9e93ed18cd65b", "message": "Merge branch 'master' into plugin-extension-java-src-new-config", "committedDate": "2020-04-22T16:22:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYyMjEzNA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2420#discussion_r414622134", "bodyText": "Just curious? Do we have to modify raw configuration if we're already calling back into ProjectProperties?", "author": "loosebazooka", "createdAt": "2020-04-24T14:31:44Z", "path": "jib-plugins-common/src/main/java/com/google/cloud/tools/jib/plugins/common/RawConfiguration.java", "diffHunk": "@@ -30,6 +30,13 @@\n  */\n public interface RawConfiguration {", "originalCommit": "0084c2c5b2079d73f1e475b6a2b9e93ed18cd65b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY0Nzc2MQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2420#discussion_r414647761", "bodyText": "Good question. It's a viable option that I've considered too. There are pros and cons. ProjectProperties doesn't have access to configuration values. Therefore, we need to change the constructor of MavenProjectProperties and pass extension config values from each MOJO (such as BuildImageMojo) where it instantiate ProjectProperties. Then we can think of a few ways to pass the information:\n\nPass JibPluginConfiguration. But this seems weird considering that there's already a higher abstraction of RawConfiguration. I don't like the divergence and incoherence in passing around config values. Also too much information and power given to ProjectProperties.\nPass MavenRawConfiguration. Requires modifying it anyway. Better than passing JibPluginConfiguration, but it still feels like passing RawConfiguration in the constructor unnecessarily provides too much information. It only needs the extension config.\nEach MOJO passes only ExecutionConfiguration. Seems better than previous options, but I thought perhaps it's better to maintain consistency in obtaining config values from the common interface (RawConfiguration) that serves as the source of truth.\nConsiderable refactoring as to who runs extensions: don't run extensions in ProjectProperties. runPluginExtensions don't use any instance values of ProjectProperties, so in fact, each MOJO can directly run extensions. The only reason its in ProjectProperties is enable the common PluginConfigurationProcess to call Maven- and Gradle-specific extension execution routine. If you remember, I briefly mentioned this kind of refactoring a while ago, as it was related to whether I should have a common API base project or not; I eventually decided to have PluginConfigurationProcess call the routine instead of each MOJO runs executions, as one of the downsides was a considerable amount of refactoring.", "author": "chanseokoh", "createdAt": "2020-04-24T15:05:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYyMjEzNA=="}], "type": "inlineReview"}, {"oid": "1131bbb6567fcd8c1293cb1b0df8a51e3918f1cf", "url": "https://github.com/GoogleContainerTools/jib/commit/1131bbb6567fcd8c1293cb1b0df8a51e3918f1cf", "message": "Nullable", "committedDate": "2020-04-24T15:55:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkxMzIzMQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2420#discussion_r414913231", "bodyText": "This line seems a little crazy to me.\nShould we just be using <? extends ExtensionConfiguration> everywhere?", "author": "loosebazooka", "createdAt": "2020-04-24T23:15:21Z", "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenRawConfiguration.java", "diffHunk": "@@ -204,4 +204,11 @@ public Path getImageIdOutputPath() {\n   public Path getImageJsonOutputPath() {\n     return jibPluginConfiguration.getImageJsonOutputPath();\n   }\n+\n+  @SuppressWarnings(\"unchecked\")\n+  @Override\n+  public List<ExtensionConfiguration> getPluginExtensions() {\n+    return (List<ExtensionConfiguration>)", "originalCommit": "1131bbb6567fcd8c1293cb1b0df8a51e3918f1cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e4fc278e5f462890a622ef3471b62de5db706a6e", "url": "https://github.com/GoogleContainerTools/jib/commit/e4fc278e5f462890a622ef3471b62de5db706a6e", "message": "List<? extends ExtensionConfiguration>", "committedDate": "2020-04-27T17:16:00Z", "type": "commit"}]}