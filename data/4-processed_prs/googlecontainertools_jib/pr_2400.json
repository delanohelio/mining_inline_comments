{"pr_number": 2400, "pr_title": "Set up sub-project for Gradle plugin extension and define extension API", "pr_createdAt": "2020-04-13T23:08:31Z", "pr_url": "https://github.com/GoogleContainerTools/jib/pull/2400", "timeline": [{"oid": "03026f5e5573383f2cb847100612a35362cee4e1", "url": "https://github.com/GoogleContainerTools/jib/commit/03026f5e5573383f2cb847100612a35362cee4e1", "message": "Set up Gradle extension module and API", "committedDate": "2020-04-13T22:54:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzc3MDc4Mg==", "url": "https://github.com/GoogleContainerTools/jib/pull/2400#discussion_r407770782", "bodyText": "Is there an elegant way to merge this with the Maven block below?", "author": "chanseokoh", "createdAt": "2020-04-13T23:09:17Z", "path": "build.gradle", "diffHunk": "@@ -21,6 +21,9 @@ idea.project.settings {\n \n import net.ltgt.gradle.errorprone.CheckSeverity\n \n+project('jib-gradle-plugin-extension-api') {\n+  apply plugin: 'java-library'\n+}", "originalCommit": "03026f5e5573383f2cb847100612a35362cee4e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwNTQ2OQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2400#discussion_r407805469", "bodyText": "you could do something like?\n[\"jib-gradle-plugin-extension\", \"jib-maven-plugin-extension\"].each { projectName ->\n  project(projectName) {\n    apply plugin: 'java-library'\n  }\n}\n\nor some variation of this? I think you can call apply direction on the Project object? Nothing great I can think of.\nMaybe in the subprojects section below you can check\nif(project in [extension-api-projects list]) { \n  apply plugin: 'java-library' \n}", "author": "loosebazooka", "createdAt": "2020-04-14T01:03:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzc3MDc4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIwMjc4OA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2400#discussion_r408202788", "bodyText": "The if check in the subprojects sections didn't work. I can go with the first suggestion.", "author": "chanseokoh", "createdAt": "2020-04-14T14:55:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzc3MDc4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI3MDc5Mg==", "url": "https://github.com/GoogleContainerTools/jib/pull/2400#discussion_r408270792", "bodyText": "Hrmm... this is what worked for me in the end:\nif ([rootProject.project('jib-maven-plugin-extension-api')].contains(project)) {\n  apply plugin: 'java-library'\n}\n\nbut in the end, I mean they're all kinda gross :\\", "author": "loosebazooka", "createdAt": "2020-04-14T16:26:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzc3MDc4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwNTcwNg==", "url": "https://github.com/GoogleContainerTools/jib/pull/2400#discussion_r407805706", "bodyText": "I don't think you need to apply the plugin, I think you can use gradleApi() directly in the dependencies block? (that still makes them provided dependencies though)", "author": "loosebazooka", "createdAt": "2020-04-14T01:04:42Z", "path": "jib-gradle-plugin-extension-api/build.gradle", "diffHunk": "@@ -0,0 +1,42 @@\n+plugins {\n+  // Is this the only option? Can't we do something simiar to Maven Extension API?\n+  id 'java-gradle-plugin'", "originalCommit": "03026f5e5573383f2cb847100612a35362cee4e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIwNDU0MQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2400#discussion_r408204541", "bodyText": "Tried gradleApi() in dependencies{}, but it doesn't even allow me to see a Gradle Project object in .java source files.", "author": "chanseokoh", "createdAt": "2020-04-14T14:57:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwNTcwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMxNDIwMQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2400#discussion_r408314201", "bodyText": "That's weird, I feel like it should work.\nhttps://docs.gradle.org/current/javadoc/org/gradle/api/artifacts/dsl/DependencyHandler.html#gradleApi--", "author": "loosebazooka", "createdAt": "2020-04-14T17:33:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwNTcwNg=="}], "type": "inlineReview"}, {"oid": "8f928b2cbc5c7491ae41f4b02c7103bb5c2b84ea", "url": "https://github.com/GoogleContainerTools/jib/commit/8f928b2cbc5c7491ae41f4b02c7103bb5c2b84ea", "message": "another way to apply java-library", "committedDate": "2020-04-14T16:47:27Z", "type": "commit"}, {"oid": "e901e6db16e0cfb552ba6e532a5b782084b3ebaa", "url": "https://github.com/GoogleContainerTools/jib/commit/e901e6db16e0cfb552ba6e532a5b782084b3ebaa", "message": "api gradleApi()", "committedDate": "2020-04-14T18:11:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTEzNzQzNA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2400#discussion_r409137434", "bodyText": "should this go in the /* RELEASE */ section?", "author": "loosebazooka", "createdAt": "2020-04-15T21:13:43Z", "path": "jib-gradle-plugin-extension-api/build.gradle", "diffHunk": "@@ -0,0 +1,41 @@\n+plugins {\n+  id 'net.researchgate.release'\n+  id 'maven-publish'\n+}\n+\n+dependencies {\n+  api project(':jib-build-plan')\n+  api project(':jib-plugins-extension-common')\n+  api gradleApi()\n+}\n+\n+jar {\n+  manifest {\n+    attributes 'Implementation-Version': version\n+    attributes 'Automatic-Module-Name': 'com.google.cloud.tools.jib.gradle.extension'\n+\n+    // OSGi metadata\n+    attributes 'Bundle-SymbolicName': 'com.google.cloud.tools.jib.gradle.extension'\n+    attributes 'Bundle-Name': 'Extension API for Jib Gradle Plugin'\n+    attributes 'Bundle-Vendor': 'Google LLC'\n+    attributes 'Bundle-DocURL': 'https://github.com/GoogleContainerTools/jib'\n+    attributes 'Bundle-License': 'https://www.apache.org/licenses/LICENSE-2.0'\n+    attributes 'Export-Package': 'com.google.cloud.tools.jib.gradle.extension'\n+  }\n+}\n+\n+configureMavenRelease()", "originalCommit": "e901e6db16e0cfb552ba6e532a5b782084b3ebaa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b15f5b876336f56813e9ce2f7bb1a1a0d22a6823", "url": "https://github.com/GoogleContainerTools/jib/commit/b15f5b876336f56813e9ce2f7bb1a1a0d22a6823", "message": "Move comments in build.gradle", "committedDate": "2020-04-16T13:52:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYyMzA3OA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2400#discussion_r409623078", "bodyText": "oh haha, didn't realize this was a mistake I created :D", "author": "loosebazooka", "createdAt": "2020-04-16T14:55:10Z", "path": "jib-build-plan/build.gradle", "diffHunk": "@@ -29,9 +29,9 @@ jar {\n   }\n }\n \n+/* RELEASE */\n configureMavenRelease()", "originalCommit": "b15f5b876336f56813e9ce2f7bb1a1a0d22a6823", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}