{"pr_number": 2835, "pr_title": "Proposal for Jib CLI Jar Processing", "pr_createdAt": "2020-10-16T20:22:54Z", "pr_url": "https://github.com/GoogleContainerTools/jib/pull/2835", "timeline": [{"oid": "3df4207c45685a110903f2687df9185a9bfbcdea", "url": "https://github.com/GoogleContainerTools/jib/commit/3df4207c45685a110903f2687df9185a9bfbcdea", "message": "Proposal for Jib CLI Jar Processing", "committedDate": "2020-10-16T19:37:28Z", "type": "commit"}, {"oid": "30ed3139ce39703cce53e7a61c57ee0bf3a86da4", "url": "https://github.com/GoogleContainerTools/jib/commit/30ed3139ce39703cce53e7a61c57ee0bf3a86da4", "message": "clean up", "committedDate": "2020-10-16T20:11:27Z", "type": "commit"}, {"oid": "4fee7a23e3e3b3b78577a5633f8d1566a0675736", "url": "https://github.com/GoogleContainerTools/jib/commit/4fee7a23e3e3b3b78577a5633f8d1566a0675736", "message": "more clean up", "committedDate": "2020-10-16T20:15:58Z", "type": "commit"}, {"oid": "38498904718d4a61354563ccf2de2788d5f9b328", "url": "https://github.com/GoogleContainerTools/jib/commit/38498904718d4a61354563ccf2de2788d5f9b328", "message": "remove extra spacing", "committedDate": "2020-10-16T20:18:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc3NzY4OQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2835#discussion_r506777689", "bodyText": "also with a jib.yaml jib-cli buildfile?", "author": "loosebazooka", "createdAt": "2020-10-17T01:22:14Z", "path": "proposals/cli-jar-processing.md", "diffHunk": "@@ -0,0 +1,48 @@\n+# Proposal : Jib CLI Jar Processing \n+\n+Relevant Issue: [#2796](https://github.com/GoogleContainerTools/jib/issues/2796)\n+\n+# Motivation \n+Allow users to containerize arbitrary jar files without having to integrate Jib into java build tools (maven and gradle).", "originalCommit": "38498904718d4a61354563ccf2de2788d5f9b328", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc3OTI0Ng==", "url": "https://github.com/GoogleContainerTools/jib/pull/2835#discussion_r506779246", "bodyText": "So I think in packaged mode, a fat jar should just be dropped into the container as is. Though we highly recommend against this, the fat jar does not contain an original jar -- it contains classes/resources.", "author": "loosebazooka", "createdAt": "2020-10-17T01:37:53Z", "path": "proposals/cli-jar-processing.md", "diffHunk": "@@ -0,0 +1,48 @@\n+# Proposal : Jib CLI Jar Processing \n+\n+Relevant Issue: [#2796](https://github.com/GoogleContainerTools/jib/issues/2796)\n+\n+# Motivation \n+Allow users to containerize arbitrary jar files without having to integrate Jib into java build tools (maven and gradle).\n+\n+# Proposal Changes\n+\n+## Standard Jar \n+A standard jar can be containerized in two modes, exploded or packaged. \n+\n+### Exploded Mode\n+Achieved by calling `jib jar ${JAR_NAME}.jar --to ${TARGET_REGISTRY}`\n+The default mode for containerizing a jar. It will explode a jar into the following layers:  \n+- Dependencies Layer: Contains dependencies derived from `Class-Path` in jar manifest. Note that this layer will not be created if `Class-Path` is not present in the manifest.\n+- Resources Layer: Contains resources parsed from jar file. Note that it will also include `MANIFEST.MF`.\n+- Classes Layer: Contains classes parsed from jar file. \n+\n+**Entrypoint** : `java -cp /app/dependencies/ /app/explodedJar/ ${MAIN_CLASS}`\n+\n+### Packaged Mode\n+Achieved by calling `jib jar ${JAR_NAME}.jar --to ${TARGET_REGISTRY} --mode packaged`.\n+This will result in the following layers on the container:\n+- Dependencies:  Contains the dependencies derived from `Class-Path` in jar manifest. Note that this layer will not be created if `Class-Path` is not present in the manifest.\n+- Jar Layer: Contains the original jar.\n+\n+**Entrypoint** : `java -jar ${JAR_NAME}.jar`\n+\n+## Spring-Boot Fat Jar\n+A Spring-Boot Fat Jar can be containerized in two modes, exploded or packaged. \n+\n+### Exploded Mode\n+Achieved by calling `jib jar ${JAR_NAME}.jar --to ${TARGET_REGISTRY}`\n+The default mode for containerizing a jar. It will explode a jar into the following layers:  \n+- Dependencies Layer: Contains dependencies derived from the `BOOT-INF/libs` directory in the jar.\n+- Resources Layer: Contains resources parsed from the jar. Note that it will also include `MANIFEST.MF`.\n+- Classes Layer: Contains classes parsed from the jar.\n+\n+**Entrypoint** : `java -cp . org.springframework.boot.loader.JarLauncher`\n+\n+### Packaged Mode\n+Achieved by calling `jib jar ${JAR_NAME}.jar --to ${TARGET_REGISTRY} --mode packaged`", "originalCommit": "38498904718d4a61354563ccf2de2788d5f9b328", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc3OTI2NQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2835#discussion_r506779265", "bodyText": "I think we should try to parse a layers.idx if we find one: https://spring.io/blog/2020/08/14/creating-efficient-docker-images-with-spring-boot-2-3", "author": "loosebazooka", "createdAt": "2020-10-17T01:38:06Z", "path": "proposals/cli-jar-processing.md", "diffHunk": "@@ -0,0 +1,48 @@\n+# Proposal : Jib CLI Jar Processing \n+\n+Relevant Issue: [#2796](https://github.com/GoogleContainerTools/jib/issues/2796)\n+\n+# Motivation \n+Allow users to containerize arbitrary jar files without having to integrate Jib into java build tools (maven and gradle).\n+\n+# Proposal Changes\n+\n+## Standard Jar \n+A standard jar can be containerized in two modes, exploded or packaged. \n+\n+### Exploded Mode\n+Achieved by calling `jib jar ${JAR_NAME}.jar --to ${TARGET_REGISTRY}`\n+The default mode for containerizing a jar. It will explode a jar into the following layers:  \n+- Dependencies Layer: Contains dependencies derived from `Class-Path` in jar manifest. Note that this layer will not be created if `Class-Path` is not present in the manifest.\n+- Resources Layer: Contains resources parsed from jar file. Note that it will also include `MANIFEST.MF`.\n+- Classes Layer: Contains classes parsed from jar file. \n+\n+**Entrypoint** : `java -cp /app/dependencies/ /app/explodedJar/ ${MAIN_CLASS}`\n+\n+### Packaged Mode\n+Achieved by calling `jib jar ${JAR_NAME}.jar --to ${TARGET_REGISTRY} --mode packaged`.\n+This will result in the following layers on the container:\n+- Dependencies:  Contains the dependencies derived from `Class-Path` in jar manifest. Note that this layer will not be created if `Class-Path` is not present in the manifest.\n+- Jar Layer: Contains the original jar.\n+\n+**Entrypoint** : `java -jar ${JAR_NAME}.jar`\n+\n+## Spring-Boot Fat Jar\n+A Spring-Boot Fat Jar can be containerized in two modes, exploded or packaged. \n+\n+### Exploded Mode\n+Achieved by calling `jib jar ${JAR_NAME}.jar --to ${TARGET_REGISTRY}`", "originalCommit": "38498904718d4a61354563ccf2de2788d5f9b328", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU4MTU3MQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2835#discussion_r508581571", "bodyText": "Oh nice.", "author": "mpeddada1", "createdAt": "2020-10-20T14:56:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc3OTI2NQ=="}], "type": "inlineReview"}, {"oid": "01f8e7e3528e59f911bfba3c081a343f9cb4ac06", "url": "https://github.com/GoogleContainerTools/jib/commit/01f8e7e3528e59f911bfba3c081a343f9cb4ac06", "message": "modify motivation and info on spring-boot jars", "committedDate": "2020-10-20T14:48:23Z", "type": "commit"}, {"oid": "06bd242363e23412947babd70c196455a92282e0", "url": "https://github.com/GoogleContainerTools/jib/commit/06bd242363e23412947babd70c196455a92282e0", "message": "description edit", "committedDate": "2020-10-20T14:55:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU4NjU2Mg==", "url": "https://github.com/GoogleContainerTools/jib/pull/2835#discussion_r508586562", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            **Entrypoint** : `java -cp /app/dependencies/ /app/explodedJar/ ${MAIN_CLASS}`\n          \n          \n            \n            **Entrypoint** : `java -cp /app/dependencies/:/app/explodedJar/ ${MAIN_CLASS}`\n          \n      \n    \n    \n  \n\nWould be ; instead of : on Windows, but we don't support creating Windows images anyway.", "author": "chanseokoh", "createdAt": "2020-10-20T15:02:23Z", "path": "proposals/cli-jar-processing.md", "diffHunk": "@@ -0,0 +1,48 @@\n+# Proposal : Jib CLI Jar Processing \n+\n+Relevant Issue: [#2796](https://github.com/GoogleContainerTools/jib/issues/2796)\n+\n+# Motivation \n+Allow users to containerize arbitrary jar files without having to integrate Jib into java build tools (maven and gradle) or use a `.yaml` jib cli buildfile.\n+\n+# Proposal Changes\n+\n+## Standard Jar \n+A standard jar can be containerized in two modes, exploded or packaged. \n+\n+### Exploded Mode\n+Achieved by calling `jib jar ${JAR_NAME}.jar --to ${TARGET_REGISTRY}`\n+The default mode for containerizing a jar. It will explode a jar into the following layers:  \n+- Dependencies Layer: Contains dependencies derived from `Class-Path` in jar manifest. Note that this layer will not be created if `Class-Path` is not present in the manifest.\n+- Resources Layer: Contains resources parsed from jar file. Note that it will also include `MANIFEST.MF`.\n+- Classes Layer: Contains classes parsed from jar file. \n+\n+**Entrypoint** : `java -cp /app/dependencies/ /app/explodedJar/ ${MAIN_CLASS}`", "originalCommit": "06bd242363e23412947babd70c196455a92282e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU4ODcwNg==", "url": "https://github.com/GoogleContainerTools/jib/pull/2835#discussion_r508588706", "bodyText": "We can also create a snapshot dep layer in the non-Spring Boot case.", "author": "chanseokoh", "createdAt": "2020-10-20T15:05:07Z", "path": "proposals/cli-jar-processing.md", "diffHunk": "@@ -0,0 +1,48 @@\n+# Proposal : Jib CLI Jar Processing \n+\n+Relevant Issue: [#2796](https://github.com/GoogleContainerTools/jib/issues/2796)\n+\n+# Motivation \n+Allow users to containerize arbitrary jar files without having to integrate Jib into java build tools (maven and gradle) or use a `.yaml` jib cli buildfile.\n+\n+# Proposal Changes\n+\n+## Standard Jar \n+A standard jar can be containerized in two modes, exploded or packaged. \n+\n+### Exploded Mode\n+Achieved by calling `jib jar ${JAR_NAME}.jar --to ${TARGET_REGISTRY}`\n+The default mode for containerizing a jar. It will explode a jar into the following layers:  \n+- Dependencies Layer: Contains dependencies derived from `Class-Path` in jar manifest. Note that this layer will not be created if `Class-Path` is not present in the manifest.\n+- Resources Layer: Contains resources parsed from jar file. Note that it will also include `MANIFEST.MF`.\n+- Classes Layer: Contains classes parsed from jar file. \n+\n+**Entrypoint** : `java -cp /app/dependencies/ /app/explodedJar/ ${MAIN_CLASS}`\n+\n+### Packaged Mode\n+Achieved by calling `jib jar ${JAR_NAME}.jar --to ${TARGET_REGISTRY} --mode packaged`.\n+It will result in the following layers on the container:\n+- Dependencies Layer: Contains the dependencies derived from `Class-Path` in jar manifest. Note that this layer will not be created if `Class-Path` is not present in the manifest.\n+- Jar Layer: Contains the original jar.\n+\n+**Entrypoint** : `java -jar ${JAR_NAME}.jar`\n+\n+## Spring-Boot Fat Jar\n+A Spring-Boot Fat Jar can be containerized in two modes, exploded or packaged. \n+\n+### Exploded Mode\n+Achieved by calling `jib jar ${JAR_NAME}.jar --to ${TARGET_REGISTRY}`\n+The default mode for containerizing a jar. It will explode a jar according to what is specified in the `layers.idx` file of the jar, if present, or according to following format:\n+- Dependencies Layer: For a dependency whose version does not contain `SNAPSHOT`.\n+- Spring-Boot-Loader Layer: Contains jar loader classes.\n+- Snapshot-Dependencies Layer: For a dependency whose version contains `SNAPSHOT`.", "originalCommit": "06bd242363e23412947babd70c196455a92282e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODYyNDcyOA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2835#discussion_r508624728", "bodyText": "That is an interesting idea. I modified the standard jar description to include a snapshot dep layer. Will create an issue for this.", "author": "mpeddada1", "createdAt": "2020-10-20T15:40:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU4ODcwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODYyODc0OA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2835#discussion_r508628748", "bodyText": "Actually now that I'm looking at this again, what is the advantage of having a separate snapshot dependencies layer?", "author": "mpeddada1", "createdAt": "2020-10-20T15:44:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU4ODcwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODY5OTMzOA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2835#discussion_r508699338", "bodyText": "SNAPSHOT layers are generally those that are created from a non-release build of a project (like nightly). They could be built locally from a project (like we do for people testing jib in our CONTRIBUTING.md), or they could be something like a nightly build from a project between releases.\nAs a consequence snapshot dependencies are \"mutable\" in a sense (1.0-SNAPSHOT could be built every day with different results), they can change between builds. If we have frequently changing dependencies in the regular dependencies layer then that layer changes on every build and we have to push all dependencies up.\nIf we separate out snapshot dependencies, then we can isolate them from the more stable other regular dependencies and only rebuild/repush a snapshot layer.", "author": "loosebazooka", "createdAt": "2020-10-20T17:10:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU4ODcwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU5MjA0OQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2835#discussion_r508592049", "bodyText": "Maybe\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            **Entrypoint** : `java -cp . org.springframework.boot.loader.JarLauncher`\n          \n          \n            \n            **Entrypoint** : `java -cp /app org.springframework.boot.loader.JarLauncher`\n          \n      \n    \n    \n  \n\n?", "author": "chanseokoh", "createdAt": "2020-10-20T15:09:19Z", "path": "proposals/cli-jar-processing.md", "diffHunk": "@@ -0,0 +1,48 @@\n+# Proposal : Jib CLI Jar Processing \n+\n+Relevant Issue: [#2796](https://github.com/GoogleContainerTools/jib/issues/2796)\n+\n+# Motivation \n+Allow users to containerize arbitrary jar files without having to integrate Jib into java build tools (maven and gradle) or use a `.yaml` jib cli buildfile.\n+\n+# Proposal Changes\n+\n+## Standard Jar \n+A standard jar can be containerized in two modes, exploded or packaged. \n+\n+### Exploded Mode\n+Achieved by calling `jib jar ${JAR_NAME}.jar --to ${TARGET_REGISTRY}`\n+The default mode for containerizing a jar. It will explode a jar into the following layers:  \n+- Dependencies Layer: Contains dependencies derived from `Class-Path` in jar manifest. Note that this layer will not be created if `Class-Path` is not present in the manifest.\n+- Resources Layer: Contains resources parsed from jar file. Note that it will also include `MANIFEST.MF`.\n+- Classes Layer: Contains classes parsed from jar file. \n+\n+**Entrypoint** : `java -cp /app/dependencies/ /app/explodedJar/ ${MAIN_CLASS}`\n+\n+### Packaged Mode\n+Achieved by calling `jib jar ${JAR_NAME}.jar --to ${TARGET_REGISTRY} --mode packaged`.\n+It will result in the following layers on the container:\n+- Dependencies Layer: Contains the dependencies derived from `Class-Path` in jar manifest. Note that this layer will not be created if `Class-Path` is not present in the manifest.\n+- Jar Layer: Contains the original jar.\n+\n+**Entrypoint** : `java -jar ${JAR_NAME}.jar`\n+\n+## Spring-Boot Fat Jar\n+A Spring-Boot Fat Jar can be containerized in two modes, exploded or packaged. \n+\n+### Exploded Mode\n+Achieved by calling `jib jar ${JAR_NAME}.jar --to ${TARGET_REGISTRY}`\n+The default mode for containerizing a jar. It will explode a jar according to what is specified in the `layers.idx` file of the jar, if present, or according to following format:\n+- Dependencies Layer: For a dependency whose version does not contain `SNAPSHOT`.\n+- Spring-Boot-Loader Layer: Contains jar loader classes.\n+- Snapshot-Dependencies Layer: For a dependency whose version contains `SNAPSHOT`.\n+- Resources Layer: Contains resources parsed from `BOOT-INF/classes/` in the jar and `META-INF/`.\n+- Classes Layer: Contains classes parsed from `BOOT-INF/classes/` in the jar.\n+\n+**Entrypoint** : `java -cp . org.springframework.boot.loader.JarLauncher`", "originalCommit": "06bd242363e23412947babd70c196455a92282e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3165491055d02195db182279ab7bb972e3357ebb", "url": "https://github.com/GoogleContainerTools/jib/commit/3165491055d02195db182279ab7bb972e3357ebb", "message": "modify entrypoint and add snapshot-dependencies layer for non-spring-boot jar", "committedDate": "2020-10-20T15:37:43Z", "type": "commit"}]}