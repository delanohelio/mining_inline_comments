{"pr_number": 2643, "pr_title": "Use explicit interface instead of BiFunction  ", "pr_createdAt": "2020-07-29T23:08:52Z", "pr_url": "https://github.com/GoogleContainerTools/jib/pull/2643", "timeline": [{"oid": "69edeecf10b963686b53740cb07c27ea65e582cf", "url": "https://github.com/GoogleContainerTools/jib/commit/69edeecf10b963686b53740cb07c27ea65e582cf", "message": "replace bifunction with explicit interface", "committedDate": "2020-07-29T19:05:45Z", "type": "commit"}, {"oid": "7845399cf0a5cd50f3ce75f8da7d9ce1dbc42141", "url": "https://github.com/GoogleContainerTools/jib/commit/7845399cf0a5cd50f3ce75f8da7d9ce1dbc42141", "message": "modify javadoc for deprecated methods", "committedDate": "2020-07-29T19:25:59Z", "type": "commit"}, {"oid": "eb6394a75b49c9f5cf03fc476e27a2dda8ff5820", "url": "https://github.com/GoogleContainerTools/jib/commit/eb6394a75b49c9f5cf03fc476e27a2dda8ff5820", "message": "fix commenting", "committedDate": "2020-07-29T19:31:40Z", "type": "commit"}, {"oid": "7e9e21c76a5e1114583886e44761c1df3571203d", "url": "https://github.com/GoogleContainerTools/jib/commit/7e9e21c76a5e1114583886e44761c1df3571203d", "message": "mark bifunction as deprecated", "committedDate": "2020-07-29T19:45:49Z", "type": "commit"}, {"oid": "a3afcd47a46b7f54ce863607503cfc22ec1dd7ab", "url": "https://github.com/GoogleContainerTools/jib/commit/a3afcd47a46b7f54ce863607503cfc22ec1dd7ab", "message": "marking another bifunction as deprecated", "committedDate": "2020-07-29T19:48:02Z", "type": "commit"}, {"oid": "31455a887f581391d1b1af181f11b476724c1ead", "url": "https://github.com/GoogleContainerTools/jib/commit/31455a887f581391d1b1af181f11b476724c1ead", "message": "formatting edit", "committedDate": "2020-07-29T19:49:28Z", "type": "commit"}, {"oid": "793fe7d5a421c4da5b2428187ac4e6a69c2385f0", "url": "https://github.com/GoogleContainerTools/jib/commit/793fe7d5a421c4da5b2428187ac4e6a69c2385f0", "message": "refactoring", "committedDate": "2020-07-29T20:05:08Z", "type": "commit"}, {"oid": "c68073e315a85486bbcb231cd15bc39730ebe767", "url": "https://github.com/GoogleContainerTools/jib/commit/c68073e315a85486bbcb231cd15bc39730ebe767", "message": "add todo to rename newly added methods", "committedDate": "2020-07-29T20:18:46Z", "type": "commit"}, {"oid": "550e667030002dd67cccf9fd534673eaae777b9b", "url": "https://github.com/GoogleContainerTools/jib/commit/550e667030002dd67cccf9fd534673eaae777b9b", "message": "moving method down", "committedDate": "2020-07-29T21:50:16Z", "type": "commit"}, {"oid": "55706239e3ba4a97f1a9646598c820e9ae2f6779", "url": "https://github.com/GoogleContainerTools/jib/commit/55706239e3ba4a97f1a9646598c820e9ae2f6779", "message": "modifying comments", "committedDate": "2020-07-29T22:20:26Z", "type": "commit"}, {"oid": "ebed29f985b67e988558462f530ecaebf90220bf", "url": "https://github.com/GoogleContainerTools/jib/commit/ebed29f985b67e988558462f530ecaebf90220bf", "message": "small javadoc fix", "committedDate": "2020-07-29T22:22:50Z", "type": "commit"}, {"oid": "41a9ea91204dc0a085c464f29ce35a5af0abd4da", "url": "https://github.com/GoogleContainerTools/jib/commit/41a9ea91204dc0a085c464f29ce35a5af0abd4da", "message": "format fix", "committedDate": "2020-07-29T22:53:59Z", "type": "commit"}, {"oid": "dd353ca9f37a3dff9b1dae2f27194b269dad6fc9", "url": "https://github.com/GoogleContainerTools/jib/commit/dd353ca9f37a3dff9b1dae2f27194b269dad6fc9", "message": "comment edit", "committedDate": "2020-07-29T23:02:08Z", "type": "commit"}, {"oid": "5b10c3bcde112818ac8058d09902b48b7405dee9", "url": "https://github.com/GoogleContainerTools/jib/commit/5b10c3bcde112818ac8058d09902b48b7405dee9", "message": "applying formatter", "committedDate": "2020-07-29T23:06:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzExNzU1Mw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2643#discussion_r463117553", "bodyText": "I'm not sure we have to deprecate everything in here. If the new methods do the same thing, there is no reason to make the new methods.\nWe might only want to really change the methods that expose the bifunction in the api?", "author": "loosebazooka", "createdAt": "2020-07-30T16:22:17Z", "path": "jib-build-plan/src/main/java/com/google/cloud/tools/jib/api/buildplan/FileEntriesLayer.java", "diffHunk": "@@ -89,7 +89,9 @@ public Builder addEntry(FileEntry entry) {\n      * @param pathInContainer the path in the container file system corresponding to the {@code\n      *     sourceFile}\n      * @return this\n+     * @deprecated Use {@link #newAddEntry(Path, AbsoluteUnixPath)}\n      */\n+    @Deprecated", "originalCommit": "5b10c3bcde112818ac8058d09902b48b7405dee9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzExODIwOQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2643#discussion_r463118209", "bodyText": "In general we try not to do this: Create a new method with a new name and change the name when deprecating an old method. Someone trying to use this new api will inevitably have to change their code again when we rename.", "author": "loosebazooka", "createdAt": "2020-07-30T16:23:22Z", "path": "jib-build-plan/src/main/java/com/google/cloud/tools/jib/api/buildplan/FileEntriesLayer.java", "diffHunk": "@@ -300,6 +315,170 @@ public Builder addEntryRecursive(\n       return this;\n     }\n \n+    /**\n+     * Adds an entry to the layer. Only adds the single source file to the exact path in the\n+     * container file system.\n+     *\n+     * <p>For example, {@code newAddEntry(Paths.get(\"myfile\"),\n+     * AbsoluteUnixPath.get(\"/path/in/container\"))} adds a file {@code myfile} to the container file\n+     * system at {@code /path/in/container}.\n+     *\n+     * <p>For example, {@code newAddEntry(Paths.get(\"mydirectory\"),\n+     * AbsoluteUnixPath.get(\"/path/in/container\"))} adds a directory {@code mydirectory/} to the\n+     * container file system at {@code /path/in/container/}. This does <b>not</b> add the contents\n+     * of {@code mydirectory}.\n+     *\n+     * @param sourceFile the source file to add to the layer\n+     * @param pathInContainer the path in the container file system corresponding to the {@code\n+     *     sourceFile}\n+     * @return this\n+     */\n+    // TODO: Rename this method once deprecated methods have been removed.\n+    public Builder newAddEntry(Path sourceFile, AbsoluteUnixPath pathInContainer) {", "originalCommit": "5b10c3bcde112818ac8058d09902b48b7405dee9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI4NDUyNw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2643#discussion_r463284527", "bodyText": "Ah that is good to know. Agreed, this would be a hassle for the user of the method.", "author": "mpeddada1", "createdAt": "2020-07-30T21:34:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzExODIwOQ=="}], "type": "inlineReview"}, {"oid": "ffad982bb74b8d03929b853db9d75d6fb498aaa9", "url": "https://github.com/GoogleContainerTools/jib/commit/ffad982bb74b8d03929b853db9d75d6fb498aaa9", "message": "merging in changes from remote master", "committedDate": "2020-08-03T15:26:39Z", "type": "commit"}, {"oid": "a36edbfc8b5cd5df6d3782ce4b4f46edfbf6d62d", "url": "https://github.com/GoogleContainerTools/jib/commit/a36edbfc8b5cd5df6d3782ce4b4f46edfbf6d62d", "message": "remove deprecated annotation and replace bifunction with interface", "committedDate": "2020-08-03T15:54:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUxMTU0NA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2643#discussion_r464511544", "bodyText": "addEntry(Path, AbsoluteUnixPath, Instant) is currently not used. Should it still remain in the class?", "author": "mpeddada1", "createdAt": "2020-08-03T16:07:02Z", "path": "jib-build-plan/src/main/java/com/google/cloud/tools/jib/api/buildplan/FileEntriesLayer.java", "diffHunk": "@@ -133,7 +132,7 @@ public Builder addEntry(\n       return addEntry(\n           sourceFile,", "originalCommit": "a36edbfc8b5cd5df6d3782ce4b4f46edfbf6d62d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUxNjA2MA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2643#discussion_r464516060", "bodyText": "I'd say yes. c.g.c.t.j.api.buildplan is the public API of the \"Container Build Plan\" library. We may not use the method internally, but external users may be using it (and they always do).", "author": "chanseokoh", "createdAt": "2020-08-03T16:14:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUxMTU0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU5NTU2Ng==", "url": "https://github.com/GoogleContainerTools/jib/pull/2643#discussion_r464595566", "bodyText": "Oh I see! Thanks for the explanation:)", "author": "mpeddada1", "createdAt": "2020-08-03T18:42:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUxMTU0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUyMDcwNw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2643#discussion_r464520707", "bodyText": "Now I think the name getFilePermissions() is redundant and we can just go with FilePermissionsProvider.get(). I've seen this naming pattern in many places. @loosebazooka WDYT?", "author": "chanseokoh", "createdAt": "2020-08-03T16:23:13Z", "path": "jib-build-plan/src/main/java/com/google/cloud/tools/jib/api/buildplan/FileEntriesLayer.java", "diffHunk": "@@ -94,7 +93,7 @@ public Builder addEntry(Path sourceFile, AbsoluteUnixPath pathInContainer) {\n       return addEntry(\n           sourceFile,\n           pathInContainer,\n-          DEFAULT_FILE_PERMISSIONS_PROVIDER.apply(sourceFile, pathInContainer));\n+          DEFAULT_FILE_PERMISSIONS_PROVIDER.getFilePermissions(sourceFile, pathInContainer));", "originalCommit": "a36edbfc8b5cd5df6d3782ce4b4f46edfbf6d62d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU5MTc5MQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2643#discussion_r464591791", "bodyText": "Yeah get makes sense to me.", "author": "loosebazooka", "createdAt": "2020-08-03T18:34:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUyMDcwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU5MjQwNA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2643#discussion_r464592404", "bodyText": "Lets put that change in here and then merge the PR.", "author": "loosebazooka", "createdAt": "2020-08-03T18:35:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUyMDcwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU5NDg5OA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2643#discussion_r464594898", "bodyText": "That's a good idea.", "author": "mpeddada1", "createdAt": "2020-08-03T18:40:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUyMDcwNw=="}], "type": "inlineReview"}, {"oid": "c64d6cd8ecb939a56ec64c9e7b64d52cf8840995", "url": "https://github.com/GoogleContainerTools/jib/commit/c64d6cd8ecb939a56ec64c9e7b64d52cf8840995", "message": "rename method in permissions provider", "committedDate": "2020-08-03T18:37:31Z", "type": "commit"}, {"oid": "ec67df4d2f653aa6ba1ec04521b474721da87ec1", "url": "https://github.com/GoogleContainerTools/jib/commit/ec67df4d2f653aa6ba1ec04521b474721da87ec1", "message": "renaming methods in other interfaces", "committedDate": "2020-08-03T18:46:38Z", "type": "commit"}]}