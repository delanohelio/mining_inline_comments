{"pr_number": 1025, "pr_title": "Write test results to CSV", "pr_createdAt": "2020-09-04T03:45:33Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1025", "timeline": [{"oid": "6c351111e89c89181fd627fb22396f3f2f3f5aaa", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/6c351111e89c89181fd627fb22396f3f2f3f5aaa", "message": "Add support to send test results to ests kusto cluster", "committedDate": "2020-08-17T18:44:32Z", "type": "commit"}, {"oid": "ce6ae185c3379e8d8932c4570422568a01dec3db", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/ce6ae185c3379e8d8932c4570422568a01dec3db", "message": "Merge branch 'dev' into shahzaibj/kusto-logging", "committedDate": "2020-08-17T19:10:08Z", "type": "commit"}, {"oid": "6079e89fddb8094310b244bf073908a70522cd95", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/6079e89fddb8094310b244bf073908a70522cd95", "message": "Use junit version from root project", "committedDate": "2020-08-17T19:23:16Z", "type": "commit"}, {"oid": "f2680d6e7a855eaad670be8a99aa355f9e4a04c1", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/f2680d6e7a855eaad670be8a99aa355f9e4a04c1", "message": "Use latest version of csv writer", "committedDate": "2020-08-17T19:36:50Z", "type": "commit"}, {"oid": "248d8d7e10213989bfa9c28b095308acbe89d2de", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/248d8d7e10213989bfa9c28b095308acbe89d2de", "message": "Attempt at fixing build from subproject", "committedDate": "2020-08-17T19:52:39Z", "type": "commit"}, {"oid": "05629abe02991b3cabd78edea473a728973c09c3", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/05629abe02991b3cabd78edea473a728973c09c3", "message": "Second attempt at fixing build from subproject", "committedDate": "2020-08-17T21:08:38Z", "type": "commit"}, {"oid": "a0854338f2c543567859fe2673b643e71dbc2849", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/a0854338f2c543567859fe2673b643e71dbc2849", "message": "Exclude gson from kusto dep", "committedDate": "2020-08-17T21:16:52Z", "type": "commit"}, {"oid": "8f317b55224c2a8b1d54a12ae763969edabc1829", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/8f317b55224c2a8b1d54a12ae763969edabc1829", "message": "Save test result file to user home location", "committedDate": "2020-08-17T22:23:12Z", "type": "commit"}, {"oid": "ea5f4b295c3f11b11d085d8d4a89ce46fbb2d5fb", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/ea5f4b295c3f11b11d085d8d4a89ce46fbb2d5fb", "message": "Add javadoc to new source files", "committedDate": "2020-08-18T01:06:28Z", "type": "commit"}, {"oid": "c04ae0c20dc477516709ddd4d35698ac2781f9a2", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/c04ae0c20dc477516709ddd4d35698ac2781f9a2", "message": "Add missing licenses", "committedDate": "2020-08-18T01:07:58Z", "type": "commit"}, {"oid": "e4d1acc5b35a9293ff15d17098135179def19698", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/e4d1acc5b35a9293ff15d17098135179def19698", "message": "Add comments to build.gradle", "committedDate": "2020-08-18T01:15:18Z", "type": "commit"}, {"oid": "b4b89cfb3e2998e0bea9c047a354e1155b5d99b7", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/b4b89cfb3e2998e0bea9c047a354e1155b5d99b7", "message": "Configure sending test results to Kusto via boolean p param", "committedDate": "2020-08-18T01:26:46Z", "type": "commit"}, {"oid": "f368f7faccf25734dddede25f49af8c43a9854f4", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/f368f7faccf25734dddede25f49af8c43a9854f4", "message": "Don't abort on lint for testutils", "committedDate": "2020-08-19T16:40:11Z", "type": "commit"}, {"oid": "d5cba7ef2983db78fdcc4a4e07a2631e157c3dbb", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/d5cba7ef2983db78fdcc4a4e07a2631e157c3dbb", "message": "Merge branch 'dev' into shahzaibj/kusto-logging", "committedDate": "2020-08-19T16:41:19Z", "type": "commit"}, {"oid": "1b5aad164a937860176421ca35187f383159b07d", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/1b5aad164a937860176421ca35187f383159b07d", "message": "Downgrade csv writer version", "committedDate": "2020-08-19T17:34:09Z", "type": "commit"}, {"oid": "2fa1694ab4128143e52b929464557a8aa4528b0c", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/2fa1694ab4128143e52b929464557a8aa4528b0c", "message": "Add package base name to shadow jar", "committedDate": "2020-08-20T01:47:01Z", "type": "commit"}, {"oid": "f37abd23bd6e397a4d8eb4402860ac475873105b", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/f37abd23bd6e397a4d8eb4402860ac475873105b", "message": "Address comments", "committedDate": "2020-08-20T01:51:12Z", "type": "commit"}, {"oid": "325e550d9b82c4a3e9ccc12c730e7360e422c3e0", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/325e550d9b82c4a3e9ccc12c730e7360e422c3e0", "message": "Merge branch 'dev' into shahzaibj/kusto-logging", "committedDate": "2020-08-23T17:47:34Z", "type": "commit"}, {"oid": "ca11e720da170b47a38552abc672d7473ce3ecd8", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/ca11e720da170b47a38552abc672d7473ce3ecd8", "message": "Disable connectedCheck for testutils", "committedDate": "2020-08-25T01:47:11Z", "type": "commit"}, {"oid": "1becd2a04b0ee7a3a856264caccfbcfa4fede54d", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/1becd2a04b0ee7a3a856264caccfbcfa4fede54d", "message": "Refactor Kusto Utils to config based model", "committedDate": "2020-08-25T01:47:52Z", "type": "commit"}, {"oid": "2316c6bdf9e9d360e77691751ad86d3c2c208ef5", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/2316c6bdf9e9d360e77691751ad86d3c2c208ef5", "message": "Remove repackaged kusto client", "committedDate": "2020-09-03T23:27:56Z", "type": "commit"}, {"oid": "03fd441142aa0f4cf387fb1c917b676e22f2ca8b", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/03fd441142aa0f4cf387fb1c917b676e22f2ca8b", "message": "Use custom csv writer to avoid dex error", "committedDate": "2020-09-04T03:24:05Z", "type": "commit"}, {"oid": "cc0ce59e9c1e7adb392d774ca281ca24ec7303b2", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/cc0ce59e9c1e7adb392d774ca281ca24ec7303b2", "message": "Merge branch 'dev' into shahzaibj/kusto-removed", "committedDate": "2020-09-04T03:35:07Z", "type": "commit"}, {"oid": "4b75dcbd8295cc3571f1007eea05e7b23401246c", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/4b75dcbd8295cc3571f1007eea05e7b23401246c", "message": "Remove shadow plugin", "committedDate": "2020-09-04T03:38:04Z", "type": "commit"}, {"oid": "f04b38166a6bdcc867155aa7a40359727b6e4ef5", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/f04b38166a6bdcc867155aa7a40359727b6e4ef5", "message": "Rename variable for write test results to CSV", "committedDate": "2020-09-04T03:41:42Z", "type": "commit"}, {"oid": "a2eb86b954ec3ebf493ec1516b65eecc3b62d31c", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/a2eb86b954ec3ebf493ec1516b65eecc3b62d31c", "message": "Revert don't abort on lint for testutils", "committedDate": "2020-09-04T03:44:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc0NTc0Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1025#discussion_r483745747", "bodyText": "Maybe close in a finally block.  Android studio might be able to desugar a try-with-resources for you, which would be nice.", "author": "AdamBJohnsonx", "createdAt": "2020-09-04T16:54:34Z", "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/kusto/TestResultFileUtils.java", "diffHunk": "@@ -0,0 +1,70 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.internal.testutils.kusto;\n+\n+import androidx.annotation.NonNull;\n+\n+import java.io.File;\n+import java.io.FileWriter;\n+import java.io.IOException;\n+\n+/**\n+ * Utilities to interact with test result file during android tests.\n+ */\n+public class TestResultFileUtils {\n+\n+    public final static String TEST_RESULT_FILE_NAME = \"test-results.csv\";\n+\n+    /**\n+     * Get the file containing the android test results.\n+     *\n+     * @return a File object containing the android test results\n+     */\n+    public static File getTestResultFile() {\n+        final File parent = new File(System.getProperty(\"user.home\"));\n+        return new File(parent, TEST_RESULT_FILE_NAME);\n+    }\n+\n+    /**\n+     * Write android client test results to a csv file.\n+     *\n+     * @param data the test data that needs to be written to csv\n+     */\n+    public static void writeTestResultsToCsv(@NonNull final EstsKustoClientTestTableData data) {\n+        final File testResultFile = getTestResultFile();\n+        try {\n+            // create FileWriter object with file as parameter\n+            final FileWriter outputFile = new FileWriter(testResultFile, true);\n+\n+            // create CSVWriter object with FileWriter object as parameter\n+            final KustoTableDataCsvWriter writer = new KustoTableDataCsvWriter(outputFile);\n+\n+            writer.writeNext(data);\n+\n+            // closing writer connection\n+            writer.close();", "originalCommit": "a2eb86b954ec3ebf493ec1516b65eecc3b62d31c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc0ODgwNg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1025#discussion_r483748806", "bodyText": "Even that would have to wrapped in a try catch block then I think because close throws an IOException", "author": "shahzaibj", "createdAt": "2020-09-04T17:01:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc0NTc0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc1MTQ0Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1025#discussion_r483751442", "bodyText": "That's why innumerable people have written closeSafely methods that just catch and swallow those things.  IIt doesn't really matter, though, I suppose.  Nothing is going to flag the resource leak here.", "author": "AdamBJohnsonx", "createdAt": "2020-09-04T17:07:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc0NTc0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc2MDQ2NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1025#discussion_r483760465", "bodyText": "nit: if we're OK with 1 and Y also being true things, then this can all be s == null ? false : s.toBoolean()", "author": "AdamBJohnsonx", "createdAt": "2020-09-04T17:28:48Z", "path": "testutils/build.gradle", "diffHunk": "@@ -54,8 +61,17 @@ dependencies {\n     implementation \"com.google.code.gson:gson:$rootProject.ext.gsonVersion\"\n     implementation \"com.nimbusds:nimbus-jose-jwt:$rootProject.ext.nimbusVersion\"\n     implementation 'androidx.appcompat:appcompat:1.0.2'\n-    testImplementation 'junit:junit:4.12'\n-    testImplementation \"org.robolectric:robolectric:$rootProject.ext.robolectricVersion\"\n-    androidTestImplementation 'androidx.test:runner:1.2.0'\n-    androidTestImplementation 'androidx.test.espresso:espresso-core:3.2.0'\n+    implementation \"junit:junit:$rootProject.ext.junitVersion\"\n+    compileOnly \"org.projectlombok:lombok:$rootProject.ext.lombokVersion\"\n+    annotationProcessor \"org.projectlombok:lombok:$rootProject.ext.lombokVersion\"\n+}\n+\n+static boolean getBoolean(final String s) {\n+    if (s == null || s == \"\") {\n+        return false;\n+    } else if (s.equalsIgnoreCase(\"true\")) {\n+        return true;\n+    } else {\n+        return false;\n+    }", "originalCommit": "a2eb86b954ec3ebf493ec1516b65eecc3b62d31c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc2NDEyMA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1025#discussion_r483764120", "bodyText": "Addressed here: fbb60c3", "author": "shahzaibj", "createdAt": "2020-09-04T17:37:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc2MDQ2NQ=="}], "type": "inlineReview"}, {"oid": "fbb60c3d1c0a0b26a56653f03c05e7a2e60a56e7", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/fbb60c3d1c0a0b26a56653f03c05e7a2e60a56e7", "message": "Address comment", "committedDate": "2020-09-04T17:36:46Z", "type": "commit"}, {"oid": "eccce91257016785a2b2b4031464583002543dd1", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/eccce91257016785a2b2b4031464583002543dd1", "message": "Merge branch 'dev' into shahzaibj/kusto-removed", "committedDate": "2020-09-04T17:37:19Z", "type": "commit"}]}