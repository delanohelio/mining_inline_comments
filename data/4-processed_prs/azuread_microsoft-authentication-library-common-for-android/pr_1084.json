{"pr_number": 1084, "pr_title": "Android/update versions gradle", "pr_createdAt": "2020-10-12T22:03:02Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1084", "timeline": [{"oid": "5517017c54669c86e8810c80596602e355204d3b", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/5517017c54669c86e8810c80596602e355204d3b", "message": "Updates for new gradle version", "committedDate": "2020-10-12T19:05:26Z", "type": "commit"}, {"oid": "8dc3487e4a011b27c36bd783fdd6c4806f21d19a", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/8dc3487e4a011b27c36bd783fdd6c4806f21d19a", "message": "Updating versioning approach", "committedDate": "2020-10-12T20:13:24Z", "type": "commit"}, {"oid": "f89d156b172134366542f52f3d66c51338aa75bc", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/f89d156b172134366542f52f3d66c51338aa75bc", "message": "Updated travis", "committedDate": "2020-10-28T17:51:11Z", "type": "commit"}, {"oid": "00b5ce79f04e4423ca26d5b5037d636aab217f23", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/00b5ce79f04e4423ca26d5b5037d636aab217f23", "message": "Merge branch 'dev' into android/update-versions-gradle", "committedDate": "2020-10-28T19:44:53Z", "type": "commit"}, {"oid": "c134bc27f30958b29331d1a3bc538bbafcc12731", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/c134bc27f30958b29331d1a3bc538bbafcc12731", "message": "Merge branch 'dev' into android/update-versions-gradle", "committedDate": "2020-10-30T15:14:29Z", "type": "commit"}, {"oid": "3b7b774ecfe4048e6ea22a6ba1ff5f39eba36581", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/3b7b774ecfe4048e6ea22a6ba1ff5f39eba36581", "message": "Ignore failing test", "committedDate": "2020-10-30T17:49:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM0MjY4OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1084#discussion_r515342688", "bodyText": "can add new line at end of file", "author": "shahzaibj", "createdAt": "2020-10-30T19:49:10Z", "path": ".travis.yml", "diffHunk": "@@ -1,52 +1,50 @@\n-language: android\n-jdk: oraclejdk8\n-\n-# Don't use the Travis Container-Based Infrastructure\n-sudo: true\n+# ./travis.yml for MSAL android\n+dist: bionic\n \n # Build Variables\n env:\n   global:\n-    - BUILD_TOOLS_VERSION=28.0.3\n-    - COMPILE_SDK_VERSION=28\n-    - EMULATOR_API_VERSION=21\n-\n-    # This is to guarantee a clean gradle log\n-    - TERM=dumb\n-\n-android:\n-  components:\n-    - tools\n-    - platform-tools\n-    - build-tools-$BUILD_TOOLS_VERSION\n-    - android-$COMPILE_SDK_VERSION\n-    - extra-google-m2repository\n-\n-    ## Emulator config ##\n-    # The SDK version used for the emulator\n-    - android-$EMULATOR_API_VERSION\n-\n-    #system images\n-    - sys-img-armeabi-v7a-android-$EMULATOR_API_VERSION\n+    - BUILD_TOOLS_VERSION=29.0.3\n+    - API_VERSION=29\n+    - ANDROID_TOOLS=commandlinetools-linux-6609375_latest.zip\n+    - ARCH=x86_64\n \n before_install:\n+  # download and unzip Android SDK command line tools\n+  - sudo apt install openjdk-8-jdk\n+  - export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64 \n+  - echo $JAVA_HOME\n+  #- sudo update-alternatives --set java /usr/lib/jvm/java-8-openjdk-amd64/jre/bin/java\n+  - wget -nv https://dl.google.com/android/repository/$ANDROID_TOOLS\n+  - unzip -q $ANDROID_TOOLS -d $HOME/sdk\n+  # set SDK tools path variable and ANDROID_HOME\n+  - export ANDROID_BIN=$HOME/sdk/tools/bin\n+  - export ANDROID_HOME=$HOME/sdk\n+  - export ANDROID_SDK_ROOT=$HOME/sdk\n+  # create empty cfg file to prevent sdkmanager warning message\n+  - mkdir -p $HOME/.android && touch $HOME/.android/repositories.cfg\n   - chmod +x gradlew\n-\n-before_cache:\n-  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock\n-  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/\n-cache:\n-  directories:\n-    - $HOME/.gradle/caches/\n-    - $HOME/.gradle/wrapper/\n-    - $HOME/.android/build-cache\n+  - $ANDROID_BIN/sdkmanager --update --sdk_root=$ANDROID_HOME --no_https --verbose\n+  - yes | $ANDROID_BIN/sdkmanager --install \"tools\" --sdk_root=$ANDROID_HOME --no_https --verbose | grep -v = || true\n+  - yes | $ANDROID_BIN/sdkmanager --install \"platforms;android-29\" --sdk_root=$ANDROID_HOME --no_https --verbose | grep -v = || true\n+  - yes | $ANDROID_BIN/sdkmanager --install \"build-tools;29.0.3\" --sdk_root=$ANDROID_HOME --no_https --verbose | grep -v = || true\n+  - yes | $ANDROID_BIN/sdkmanager --install \"system-images;android-29;default;x86_64\" --sdk_root=$ANDROID_HOME --no_https --verbose | grep -v = || true\n+  - $ANDROID_BIN/sdkmanager --update --sdk_root=$ANDROID_HOME --no_https --verbose\n+    \n+    # Set up KVM on linux for hardware acceleration. Manually here so it only happens for emulator tests, takes ~30s\n+  - travis_retry sudo -E apt-get -yq --no-install-suggests --no-install-recommends install bridge-utils libpulse0 libvirt-bin qemu-kvm virtinst ubuntu-vm-builder\n+  - sudo adduser $USER libvirt\n+  - sudo adduser $USER kvm\n+\n+  #Create emulator\n+  - echo no | $ANDROID_BIN/avdmanager create avd --force -n test -k \"system-images;android-29;default;x86_64\"\n+  - sudo $ANDROID_HOME/platform-tools/adb start-server\n+  - sudo -E sudo -u $USER -E bash -c \"$ANDROID_HOME/emulator/emulator -avd test -no-audio -no-window &\"\n \n before_script:\n-  - android list targets\n-  - echo no | android create avd --force -n test -t android-$EMULATOR_API_VERSION --abi armeabi-v7a\n-  - emulator -avd test -no-audio -no-window &\n-  - android-wait-for-emulator\n-  - adb shell input keyevent 82 &\n+  - $ANDROID_HOME/platform-tools/adb wait-for-device\n+  - $ANDROID_HOME/platform-tools/adb shell input keyevent 82 & \n \n script:\n-  - travis_wait 30 ./gradlew clean build connectedCheck\n+  - cd $PWD\n+  - travis_wait 30 ./gradlew clean build connectedCheck", "originalCommit": "3b7b774ecfe4048e6ea22a6ba1ff5f39eba36581", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM0Mjc4Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1084#discussion_r515342786", "bodyText": "new line ending", "author": "shahzaibj", "createdAt": "2020-10-30T19:49:21Z", "path": "gradle.properties", "diffHunk": "@@ -1,18 +1,18 @@\n-# Project-wide Gradle settings.\n+ariaTenantTokenProd=\"b6618d4b5d24466a9d2d0d8cde8cd6e4-ddcec952-23e9-4765-b4fb-f823ec69c6e3-7966\"\n+ariaTenantTokenTest=\"1e8435186fa849b28b1a402fb5074ff1-0b91a9ec-efad-440c-b92c-ac4cb55ba0ff-7490\"\n \n-# IDE (e.g. Android Studio) users:\n-# Gradle settings configured through the IDE *will override*\n-# any settings specified in this file.\n+android.useAndroidX=true\n+android.enableJetifier=false\n \n-# For more details on how to configure your build environment visit\n-# http://www.gradle.org/docs/current/userguide/build_environment.html\n+# https://office.visualstudio.com/Outlook%20Mobile/_wiki/wikis/Outlook-Mobile.wiki/3780/Android-Studio-Gradle-Performance-tips-and-tricks\n+org.gradle.parallel=true\n+org.gradle.daemon=true\n \n-# Specifies the JVM arguments used for the daemon process.\n-# The setting is particularly useful for tweaking memory settings.\n-org.gradle.jvmargs=-Xmx1536m\n-org.gradle.configureondemand=false\n+# See https://stackoverflow.com/questions/56075455/expiring-daemon-because-jvm-heap-space-is-exhausted\n+org.gradle.jvmargs=-Xmx4g -XX:MaxPermSize=2048m -Dkotlin.daemon.jvm.options\\=\"-Xmx2048M\" -XX:ReservedCodeCacheSize=512m\n \n-# When configured, Gradle will run in incubating parallel mode.\n-# This option should only be used with decoupled projects. More details, visit\n-# http://www.gradle.org/docs/current/userguide/multi_project_builds.html#sec:decoupled_projects\n-# org.gradle.parallel=true\n+# This the TSL versionName...\n+versionName=1.5.9\n+\n+# For OneAuth default abiSelection\n+abiSelection=x86", "originalCommit": "3b7b774ecfe4048e6ea22a6ba1ff5f39eba36581", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM0Mjg3Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1084#discussion_r515342877", "bodyText": "new line ending", "author": "shahzaibj", "createdAt": "2020-10-30T19:49:33Z", "path": "gradle/versions.gradle", "diffHunk": "@@ -41,4 +42,24 @@ ext {\n     // TODO: adal automation test app.\n     supportLibraryVersion = \"27.1.+\"\n     adalLegacy = \"1.15.0\"\n+    adalSnapshot = \"3.1.1-SNAPSHOT\"\n+    adalLatest = \"3.1.1\"\n+\n+\n+    //#### The following are TSL version variables - BEGIN\n+    projectCompileSdkVersion = 29\n+    projectBuildToolsVersion = '28.0.3'\n+    projectMinSdkVersion = 14\n+    projectTargetSdkVersion = 29\n+\n+    projectVersionCode = 1\n+    projectVersionName = \"1.5.9\"\n+\n+    junitLibraryVersion = \"4.12\"\n+    androidSupportLibraryVersion = \"28.0.0\"\n+    gsonLibraryVersion = \"2.8.0\"\n+    supportTestLibraryVersion = \"0.4.1\"\n+    mockitoLibraryVersion = \"1.2\"\n+    dexMakerLibraryVersion = \"1.2\"\n+    //#### The ABOVE are TSL version variables - END\n }", "originalCommit": "3b7b774ecfe4048e6ea22a6ba1ff5f39eba36581", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}