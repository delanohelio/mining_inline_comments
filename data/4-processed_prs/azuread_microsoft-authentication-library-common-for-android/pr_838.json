{"pr_number": 838, "pr_title": "Fix fragment state issue", "pr_createdAt": "2020-03-06T00:49:26Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/838", "timeline": [{"oid": "59d0720547fa36728ebf118e04a6ef921de04549", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/59d0720547fa36728ebf118e04a6ef921de04549", "message": "Finish and return from fragment if state not available", "committedDate": "2020-03-06T00:48:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAzMTU0MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/838#discussion_r389031540", "bodyText": "Should we do this in the base class?", "author": "rpdome", "createdAt": "2020-03-06T17:11:53Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/BrowserAuthorizationFragment.java", "diffHunk": "@@ -94,6 +94,12 @@ public void onSaveInstanceState(@NonNull Bundle outState) {\n \n     @Override\n     void extractState(final Bundle state){\n+        if (state == null) {", "originalCommit": "59d0720547fa36728ebf118e04a6ef921de04549", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAzMTg3OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/838#discussion_r389031878", "bodyText": "It is already done there but is not sufficient as that method returns back here", "author": "shahzaibj", "createdAt": "2020-03-06T17:12:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAzMTU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAzMjI4Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/838#discussion_r389032282", "bodyText": "super is called first, which does this logic and returns. Then we are back here, try to use the state param, it is NULL and we get NPE", "author": "shahzaibj", "createdAt": "2020-03-06T17:13:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAzMTU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAzMzM2Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/838#discussion_r389033367", "bodyText": "ahh okay.\nIn the base class, can we move the logic to onCreate instead? (before extractState is called).\nThanks for catching the bug btw.", "author": "rpdome", "createdAt": "2020-03-06T17:15:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAzMTU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAzNTYwMw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/838#discussion_r389035603", "bodyText": "Why do you want to finish in the onCreate? The state param in onCreate could be NULL and is currently handled by the mInstanceState instance variable. See this: \n  \n    \n      microsoft-authentication-library-common-for-android/common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/AuthorizationFragment.java\n    \n    \n        Lines 84 to 101\n      in\n      744fb75\n    \n    \n    \n    \n\n        \n          \n           public void onCreate(@Nullable Bundle savedInstanceState) { \n        \n\n        \n          \n               final String methodName = \"#onCreate\"; \n        \n\n        \n          \n               super.onCreate(savedInstanceState); \n        \n\n        \n          \n            \n        \n\n        \n          \n               // Register Broadcast receiver to cancel the auth request \n        \n\n        \n          \n               // if another incoming request is launched by the app \n        \n\n        \n          \n               LocalBroadcastManager.getInstance(getContext()).registerReceiver(mCancelRequestReceiver, \n        \n\n        \n          \n                       new IntentFilter(CANCEL_INTERACTIVE_REQUEST)); \n        \n\n        \n          \n            \n        \n\n        \n          \n               if (savedInstanceState == null) { \n        \n\n        \n          \n                   Logger.verbose(TAG + methodName, \"Extract state from the intent bundle.\"); \n        \n\n        \n          \n                   extractState(mInstanceState); \n        \n\n        \n          \n               } else { \n        \n\n        \n          \n                   // If activity is killed by the os, savedInstance will be the saved bundle. \n        \n\n        \n          \n                   Logger.verbose(TAG + methodName, \"Extract state from the saved bundle.\"); \n        \n\n        \n          \n                   extractState(savedInstanceState); \n        \n\n        \n          \n               } \n        \n\n        \n          \n           }", "author": "shahzaibj", "createdAt": "2020-03-06T17:19:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAzMTU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA0MTQ3MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/838#discussion_r389041470", "bodyText": "We could make extractState() takes NonNull parameter only, and then put the check inside onCreate(). We're already doing half the check there (if savedInstanceState==null) anyway.\nI just prefer having the check in one place - it's easier to maintain.", "author": "rpdome", "createdAt": "2020-03-06T17:31:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAzMTU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA5ODEwNw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/838#discussion_r389098107", "bodyText": "Addressed", "author": "shahzaibj", "createdAt": "2020-03-06T19:29:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAzMTU0MA=="}], "type": "inlineReview"}, {"oid": "e4b5d6d83f4ec062bd4dd75ee38bb9eeffb55cbf", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/e4b5d6d83f4ec062bd4dd75ee38bb9eeffb55cbf", "message": "Address comments", "committedDate": "2020-03-06T19:28:54Z", "type": "commit"}]}