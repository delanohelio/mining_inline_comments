{"pr_number": 957, "pr_title": "Closes #956 - Catches JsonSyntaxException while performing ADAL -> MSAL migration", "pr_createdAt": "2020-07-08T19:08:02Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/957", "timeline": [{"oid": "3857a40ba18c09d58914e3ac596384f45da5a816", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/3857a40ba18c09d58914e3ac596384f45da5a816", "message": "Closes #956", "committedDate": "2020-07-08T19:06:38Z", "type": "commit"}, {"oid": "7ad92ac9b6279811ca9e37851070a63b4fac06c4", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/7ad92ac9b6279811ca9e37851070a63b4fac06c4", "message": "Adding unit test", "committedDate": "2020-07-08T20:15:45Z", "type": "commit"}, {"oid": "ec8a54a076c94806cc2d2dda551534f1e899aaa5", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/ec8a54a076c94806cc2d2dda551534f1e899aaa5", "message": "Making tests more extensible", "committedDate": "2020-07-08T20:47:32Z", "type": "commit"}, {"oid": "5730a5fde968cb1c612fb3e4633c81c30808559a", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/5730a5fde968cb1c612fb3e4633c81c30808559a", "message": "Minor formatting", "committedDate": "2020-07-08T20:48:26Z", "type": "commit"}, {"oid": "cd911750bd6cad70ae7632aae78b88c6abc53533", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/cd911750bd6cad70ae7632aae78b88c6abc53533", "message": "Cleaning up annots", "committedDate": "2020-07-08T20:57:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgyMjg3Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/957#discussion_r451822877", "bodyText": "You know I love parameterized tests, but the question I would ask is that with only 2 permutations here is it clearer to just have the two methods?", "author": "AdamBJohnsonx", "createdAt": "2020-07-08T21:01:18Z", "path": "common/src/androidTest/java/com/microsoft/identity/common/internal/migration/AdalMigrationAdapterDeserializationTest.java", "diffHunk": "@@ -0,0 +1,139 @@\n+//  Copyright (c) Microsoft Corporation.\n+//  All rights reserved.\n+//\n+//  This code is licensed under the MIT License.\n+//\n+//  Permission is hereby granted, free of charge, to any person obtaining a copy\n+//  of this software and associated documentation files(the \"Software\"), to deal\n+//  in the Software without restriction, including without limitation the rights\n+//  to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+//  copies of the Software, and to permit persons to whom the Software is\n+//  furnished to do so, subject to the following conditions :\n+//\n+//  The above copyright notice and this permission notice shall be included in\n+//  all copies or substantial portions of the Software.\n+//\n+//  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+//  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+//  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+//  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+//  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+//  THE SOFTWARE.\n+package com.microsoft.identity.common.internal.migration;\n+\n+import android.content.Context;\n+\n+import androidx.annotation.NonNull;\n+import androidx.test.platform.app.InstrumentationRegistry;\n+\n+import com.google.gson.Gson;\n+import com.microsoft.identity.common.internal.cache.ADALTokenCacheItem;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+@RunWith(Parameterized.class)\n+public class AdalMigrationAdapterDeserializationTest {\n+\n+    private static final String AUTHORITY = \"https://login.microsoftonline.com/common\";\n+    private static final String CLIENT_ID = \"a_client_id\";\n+    private static final String TENANT_ID = \"a_tenant_id\";\n+    public static final String CACHE_KEY = \"a_cache_key\";\n+\n+    private interface DeserializationValidator {\n+        void onDeserializationFinished(Map<String, ADALTokenCacheItem> result);\n+    }\n+\n+    private AdalMigrationAdapter mMigrationAdapter;\n+\n+    private Map<String, String> mDeserializationInput;\n+    private DeserializationValidator mValidator;\n+\n+    @Parameterized.Parameters\n+    public static Iterable<Object[]> testParams() {\n+        return Arrays.asList(\n+                new Object[]{\n+                        getAdalCacheItemInput(),\n+                        getDeserializationValidator()\n+                },\n+                new Object[]{\n+                        getMalformedCacheItemInput(),\n+                        getDeserializationValidator()\n+                }\n+        );\n+    }", "originalCommit": "cd911750bd6cad70ae7632aae78b88c6abc53533", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgyMzUxNA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/957#discussion_r451823514", "bodyText": "Originally had exactly that, and expanded upon it:\n7ad92ac\nSo reverting this is trivial, your call on which you want", "author": "iambmelt", "createdAt": "2020-07-08T21:02:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgyMjg3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgyNTg4Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/957#discussion_r451825882", "bodyText": "I'm not concerned with it, really.  An name parameter would be nice, but I doubt that your class arguments give useful toString values.", "author": "AdamBJohnsonx", "createdAt": "2020-07-08T21:07:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgyMjg3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgzMDM1Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/957#discussion_r451830357", "bodyText": "Added a name param via the 0th param: 81f02b1", "author": "iambmelt", "createdAt": "2020-07-08T21:16:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgyMjg3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgyODA5Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/957#discussion_r451828097", "bodyText": "Does it need to be an instrumented test? Wouldn't a JVM test be more efficient?", "author": "shahzaibj", "createdAt": "2020-07-08T21:11:56Z", "path": "common/src/androidTest/java/com/microsoft/identity/common/internal/migration/AdalMigrationAdapterDeserializationTest.java", "diffHunk": "@@ -0,0 +1,139 @@\n+//  Copyright (c) Microsoft Corporation.\n+//  All rights reserved.\n+//\n+//  This code is licensed under the MIT License.\n+//\n+//  Permission is hereby granted, free of charge, to any person obtaining a copy\n+//  of this software and associated documentation files(the \"Software\"), to deal\n+//  in the Software without restriction, including without limitation the rights\n+//  to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+//  copies of the Software, and to permit persons to whom the Software is\n+//  furnished to do so, subject to the following conditions :\n+//\n+//  The above copyright notice and this permission notice shall be included in\n+//  all copies or substantial portions of the Software.\n+//\n+//  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+//  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+//  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+//  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+//  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+//  THE SOFTWARE.\n+package com.microsoft.identity.common.internal.migration;\n+\n+import android.content.Context;\n+\n+import androidx.annotation.NonNull;\n+import androidx.test.platform.app.InstrumentationRegistry;\n+\n+import com.google.gson.Gson;\n+import com.microsoft.identity.common.internal.cache.ADALTokenCacheItem;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+@RunWith(Parameterized.class)\n+public class AdalMigrationAdapterDeserializationTest {", "originalCommit": "cd911750bd6cad70ae7632aae78b88c6abc53533", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgyOTI2OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/957#discussion_r451829268", "bodyText": "Need a context", "author": "iambmelt", "createdAt": "2020-07-08T21:14:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgyODA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgzODA0Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/957#discussion_r451838043", "bodyText": "You can get a context in JVM based tests. ApplicationProvider.getApplicationContext() - it's an AndroidX API\nAll of our E2E Robolectric tests need a context as well and we get it like that and run the tests in JVM", "author": "shahzaibj", "createdAt": "2020-07-08T21:33:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgyODA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgzODkwMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/957#discussion_r451838902", "bodyText": "Instrumented test is fine too....it's just that we've been trying to move to Robolectric test as a team, with possibly moving our existing Instrumented test to Robolectric in the future....adding more instrumented tests would just make that more difficult to happen", "author": "shahzaibj", "createdAt": "2020-07-08T21:35:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgyODA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTg0MjUxNQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/957#discussion_r451842515", "bodyText": "e143f6d", "author": "iambmelt", "createdAt": "2020-07-08T21:44:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgyODA5Nw=="}], "type": "inlineReview"}, {"oid": "81f02b1f98dd4f78c46c65940bd42826ad2f607f", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/81f02b1f98dd4f78c46c65940bd42826ad2f607f", "message": "Naming tests", "committedDate": "2020-07-08T21:15:48Z", "type": "commit"}, {"oid": "e143f6dbbdd0787210be518e3bfdda4180635ae6", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/e143f6dbbdd0787210be518e3bfdda4180635ae6", "message": "Making a robotest", "committedDate": "2020-07-08T21:43:13Z", "type": "commit"}]}