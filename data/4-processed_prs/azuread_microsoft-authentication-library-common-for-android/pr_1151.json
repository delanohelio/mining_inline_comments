{"pr_number": 1151, "pr_title": "Allow the lab secret to not come from testUtils' BuildConfig", "pr_createdAt": "2020-12-07T21:38:51Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151", "timeline": [{"oid": "0ea72a157309cae70d62c1eea5747e9861237ad2", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/0ea72a157309cae70d62c1eea5747e9861237ad2", "message": "Add backup strategy for finding lab secret, enable LabUserHelper to reset the value", "committedDate": "2020-12-07T21:39:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkwMzI3Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r537903272", "bodyText": "Can we collapse these into one catch block?", "author": "shahzaibj", "createdAt": "2020-12-07T23:11:12Z", "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/ConfidentialClientHelper.java", "diffHunk": "@@ -60,6 +68,35 @@ abstract TokenRequest createTokenRequest()\n             throws CertificateException, UnrecoverableKeyException, NoSuchAlgorithmException,\n             KeyStoreException, NoSuchProviderException, IOException;\n \n+    protected synchronized static String getBuildConfigSecretFromClasspath() {\n+        if (sClasspathSecret != null) {\n+            return sClasspathSecret;\n+        }\n+        final Reflections r = new Reflections(\"com.microsoft\");\n+        final Set<Class<?>> allClasses = r.getSubTypesOf(Object.class);\n+        for (final Class<?> clazz : allClasses) {\n+            if (clazz.getSimpleName() == \"BuildConfig\") {\n+                try {\n+                    final Field labField = clazz.getDeclaredField(\"LAB_CLIENT_SECRET\");\n+                    if (labField != null) {\n+                        String secret = (String) labField.get(null);\n+                        if (!TextUtils.isEmpty(secret)) {\n+                            Logger.info(\"LabAuthenticationHelper:init\", \"Found lab secret on class with name \" + clazz.getCanonicalName());\n+                            sClasspathSecret = secret;\n+                            return secret;\n+                        }\n+                    }\n+                    //Swallow all exceptions.\n+                } catch (final NoSuchFieldException e) {\n+                } catch (final IllegalAccessException e) {\n+                } catch (final ClassCastException e) {", "originalCommit": "c3b830d1d18361a30b73c6e9d82db5c39d4e863f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkyMzIyMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r537923222", "bodyText": "Yes, just not the way I have my studio set up.  I'll fix it.", "author": "AdamBJohnsonx", "createdAt": "2020-12-07T23:50:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkwMzI3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkwMzQ1MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r537903450", "bodyText": "Why not null?", "author": "shahzaibj", "createdAt": "2020-12-07T23:11:35Z", "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/ConfidentialClientHelper.java", "diffHunk": "@@ -60,6 +68,35 @@ abstract TokenRequest createTokenRequest()\n             throws CertificateException, UnrecoverableKeyException, NoSuchAlgorithmException,\n             KeyStoreException, NoSuchProviderException, IOException;\n \n+    protected synchronized static String getBuildConfigSecretFromClasspath() {\n+        if (sClasspathSecret != null) {\n+            return sClasspathSecret;\n+        }\n+        final Reflections r = new Reflections(\"com.microsoft\");\n+        final Set<Class<?>> allClasses = r.getSubTypesOf(Object.class);\n+        for (final Class<?> clazz : allClasses) {\n+            if (clazz.getSimpleName() == \"BuildConfig\") {\n+                try {\n+                    final Field labField = clazz.getDeclaredField(\"LAB_CLIENT_SECRET\");\n+                    if (labField != null) {\n+                        String secret = (String) labField.get(null);\n+                        if (!TextUtils.isEmpty(secret)) {\n+                            Logger.info(\"LabAuthenticationHelper:init\", \"Found lab secret on class with name \" + clazz.getCanonicalName());\n+                            sClasspathSecret = secret;\n+                            return secret;\n+                        }\n+                    }\n+                    //Swallow all exceptions.\n+                } catch (final NoSuchFieldException e) {\n+                } catch (final IllegalAccessException e) {\n+                } catch (final ClassCastException e) {\n+                }\n+            }\n+        }\n+        sClasspathSecret = \"\";", "originalCommit": "c3b830d1d18361a30b73c6e9d82db5c39d4e863f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkyNzU0OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r537927549", "bodyText": "to distinguish the case where I've already searched the class path and not found anything from the one where I have not yet looked through everything.", "author": "AdamBJohnsonx", "createdAt": "2020-12-08T00:00:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkwMzQ1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkwMzk1Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r537903957", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private TokenRequest createTokenRequestWithClientSecret(String secret) {\n          \n          \n            \n                private TokenRequest createTokenRequestWithClientSecret(@NonNull final String secret) {", "author": "shahzaibj", "createdAt": "2020-12-07T23:12:40Z", "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/KeyVaultAuthHelper.java", "diffHunk": "@@ -67,18 +86,26 @@ public void setupApiClientWithAccessToken(final String accessToken) {\n \n     @Override\n     public TokenRequest createTokenRequest() throws CertificateException, UnrecoverableKeyException, NoSuchAlgorithmException, KeyStoreException, NoSuchProviderException, IOException {\n-        final String labClientSecret = com.microsoft.identity.internal.testutils.BuildConfig.LAB_CLIENT_SECRET;\n-        if (TextUtils.isEmpty(labClientSecret)) {\n+        if (TextUtils.isEmpty(mSecret)) {\n             return createTokenRequestWithClientAssertion();\n         } else {\n-            return createTokenRequestWithClientSecret();\n+            return createTokenRequestWithClientSecret(mSecret);\n         }\n     }\n \n     private TokenRequest createTokenRequestWithClientSecret() {\n         TokenRequest tr = new MicrosoftStsTokenRequest();\n \n-        tr.setClientSecret(com.microsoft.identity.internal.testutils.BuildConfig.LAB_CLIENT_SECRET);\n+        tr.setClientSecret(mSecret);\n+        tr.setClientId(CLIENT_ID);\n+        tr.setScope(SCOPE);\n+        return tr;\n+    }\n+\n+    private TokenRequest createTokenRequestWithClientSecret(String secret) {", "originalCommit": "c3b830d1d18361a30b73c6e9d82db5c39d4e863f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkwNDEzMw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r537904133", "bodyText": "Is this constructor being used anywhere?", "author": "shahzaibj", "createdAt": "2020-12-07T23:13:01Z", "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/KeyVaultAuthHelper.java", "diffHunk": "@@ -49,10 +50,28 @@\n     private final static String MSSTS_CLIENT_ASSERTION_AUDIENCE = \"https://login.microsoftonline.com/microsoft.com/oauth2/v2.0/token\";\n \n     private static KeyVaultAuthHelper sKeyVaultAuthHelper;\n+    private final String mSecret;\n+\n+    private KeyVaultAuthHelper(final String secret) {\n+        mSecret = secret;\n+    }", "originalCommit": "c3b830d1d18361a30b73c6e9d82db5c39d4e863f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkyNDIyOA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r537924228", "bodyText": "In the static getInstanceWithSecret factory.", "author": "AdamBJohnsonx", "createdAt": "2020-12-07T23:53:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkwNDEzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkwNzg1NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r537907855", "bodyText": "Can we just get from classpath directly? without first checking for it in test utils", "author": "shahzaibj", "createdAt": "2020-12-07T23:20:44Z", "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/KeyVaultAuthHelper.java", "diffHunk": "@@ -49,10 +50,28 @@\n     private final static String MSSTS_CLIENT_ASSERTION_AUDIENCE = \"https://login.microsoftonline.com/microsoft.com/oauth2/v2.0/token\";\n \n     private static KeyVaultAuthHelper sKeyVaultAuthHelper;\n+    private final String mSecret;\n+\n+    private KeyVaultAuthHelper(final String secret) {\n+        mSecret = secret;\n+    }\n \n     private KeyVaultAuthHelper() {\n+        String secret = com.microsoft.identity.internal.testutils.BuildConfig.LAB_CLIENT_SECRET;\n+        if (TextUtils.isEmpty(secret)) {\n+            secret = getBuildConfigSecretFromClasspath()\n+        }", "originalCommit": "c3b830d1d18361a30b73c6e9d82db5c39d4e863f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkyMzg5Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r537923892", "bodyText": "I want to give testUtils some sense of priority, to avoid disrupting anything that's currently in use.  If you're currently consuming testUtils as source, and aren't overriding the behavior by calling the methods that use the secret directly, then it should work just like it used to.", "author": "AdamBJohnsonx", "createdAt": "2020-12-07T23:52:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkwNzg1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODY4NDk2Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r538684966", "bodyText": "And I can't find it in the class path anyway, without making build changes I'm not willing to make.", "author": "AdamBJohnsonx", "createdAt": "2020-12-08T18:16:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkwNzg1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkxMzcyNw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r537913727", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private LabAuthenticationHelper(String keyVaultSecret) {\n          \n          \n            \n                private LabAuthenticationHelper(final String keyVaultSecret) {", "author": "shahzaibj", "createdAt": "2020-12-07T23:28:32Z", "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabAuthenticationHelper.java", "diffHunk": "@@ -37,15 +41,38 @@\n \n     private String mAppId;\n     private String mAppSecret;\n+    private final String mKeyVaultSecret;\n \n     private static LabAuthenticationHelper sLabAuthHelper;\n \n+    private LabAuthenticationHelper(String keyVaultSecret) {", "originalCommit": "c3b830d1d18361a30b73c6e9d82db5c39d4e863f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6af6591c80ac0c3e4ee6f4df8a5d689217e90e24", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/6af6591c80ac0c3e4ee6f4df8a5d689217e90e24", "message": "Remove unused and not-present import", "committedDate": "2020-12-08T22:45:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ5NzkwOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r539497909", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void resetWithSecret(final String secret) {\n          \n          \n            \n                public static void resetWithSecret(final String secret) {", "author": "AdamBJohnsonx", "createdAt": "2020-12-09T17:22:24Z", "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java", "diffHunk": "@@ -40,10 +40,15 @@\n public class LabUserHelper {\n \n     private static final Map<LabUserQuery, LabConfig> sLabConfigCache = new HashMap<>();\n+    private volatile static ConfidentialClientHelper instance = LabAuthenticationHelper.getInstance();\n \n-    static List<ConfigInfo> getConfigInfos(LabUserQuery query) {\n+    public void resetWithSecret(final String secret) {", "originalCommit": "6af6591c80ac0c3e4ee6f4df8a5d689217e90e24", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTU2NTI4OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r539565288", "bodyText": "Does this actually reset the LabAuthenticationHelper instance? It seems like getInstance(String keyVaultSecret) only uses the secret provided if the instance is null, otherwise it simply returns the old instance back.", "author": "irving-as", "createdAt": "2020-12-09T18:57:40Z", "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java", "diffHunk": "@@ -40,10 +40,15 @@\n public class LabUserHelper {\n \n     private static final Map<LabUserQuery, LabConfig> sLabConfigCache = new HashMap<>();\n+    private volatile static ConfidentialClientHelper instance = LabAuthenticationHelper.getInstance();\n \n-    static List<ConfigInfo> getConfigInfos(LabUserQuery query) {\n+    public static void resetWithSecret(final String secret) {", "originalCommit": "abc99d840d1e6d5dcd07708e219554d893e331e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTY2NTY3Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r539665677", "bodyText": "Good catch.  We must not be using it elsewhere in the tests, otherwise my attempt would not have worked.", "author": "AdamBJohnsonx", "createdAt": "2020-12-09T21:35:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTU2NTI4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTY5OTI1Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r539699257", "bodyText": "8342a62", "author": "AdamBJohnsonx", "createdAt": "2020-12-09T22:34:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTU2NTI4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTcxMzc3Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r539713772", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if(findProject(\":keyVault\") != null) {\n          \n          \n            \n                if(findProject(\":labapi\") != null) {", "author": "shahzaibj", "createdAt": "2020-12-09T23:03:58Z", "path": "testutils/build.gradle", "diffHunk": "@@ -124,9 +124,16 @@ project.afterEvaluate{\n \n dependencies {\n     implementation fileTree(dir: 'libs', include: ['*.jar'])\n-\n-    implementation project(':keyvault')\n-    implementation project(':labapi')\n+    if(findProject(\":keyVault\") != null) {\n+        implementation project(path: ':keyvault')\n+    } else {\n+        implementation project(\":keyvault\")\n+    }\n+    if(findProject(\":keyVault\") != null) {", "originalCommit": "8342a626a3aef4c3bbdd064b1956e925bdf6b61a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTcxMzgzNA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r539713834", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if(findProject(\":keyVault\") != null) {\n          \n          \n            \n                if(findProject(\":keyvault\") != null) {", "author": "shahzaibj", "createdAt": "2020-12-09T23:04:06Z", "path": "testutils/build.gradle", "diffHunk": "@@ -124,9 +124,16 @@ project.afterEvaluate{\n \n dependencies {\n     implementation fileTree(dir: 'libs', include: ['*.jar'])\n-\n-    implementation project(':keyvault')\n-    implementation project(':labapi')\n+    if(findProject(\":keyVault\") != null) {", "originalCommit": "8342a626a3aef4c3bbdd064b1956e925bdf6b61a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTczMzg5OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r539733898", "bodyText": "removed", "author": "AdamBJohnsonx", "createdAt": "2020-12-09T23:46:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTcxMzgzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTcxNDA3OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r539714078", "bodyText": "What is this logic for? OneAuth?", "author": "shahzaibj", "createdAt": "2020-12-09T23:04:34Z", "path": "testutils/build.gradle", "diffHunk": "@@ -124,9 +124,16 @@ project.afterEvaluate{\n \n dependencies {\n     implementation fileTree(dir: 'libs', include: ['*.jar'])\n-\n-    implementation project(':keyvault')\n-    implementation project(':labapi')\n+    if(findProject(\":keyVault\") != null) {\n+        implementation project(path: ':keyvault')\n+    } else {\n+        implementation project(\":keyvault\")\n+    }\n+    if(findProject(\":keyVault\") != null) {\n+        implementation project(path: ':labapi')\n+    } else {\n+        implementation project(':labapi')\n+    }", "originalCommit": "8342a626a3aef4c3bbdd064b1956e925bdf6b61a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTcxNDY2NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r539714665", "bodyText": "Yes.  I'm amazed it worked - let me try removing it, since it seems to be completely wrong.", "author": "AdamBJohnsonx", "createdAt": "2020-12-09T23:05:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTcxNDA3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTcxNDU5Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r539714593", "bodyText": "These two lines can be collapsed into one", "author": "shahzaibj", "createdAt": "2020-12-09T23:05:34Z", "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabAuthenticationHelper.java", "diffHunk": "@@ -37,15 +42,32 @@\n \n     private String mAppId;\n     private String mAppSecret;\n+    private final String mKeyVaultSecret;\n \n     private static LabAuthenticationHelper sLabAuthHelper;\n \n+    private LabAuthenticationHelper(final String keyVaultSecret) {\n+        mAppId = null;\n+        mAppSecret = null;\n+        this.mKeyVaultSecret = keyVaultSecret;\n+    }\n+\n     private LabAuthenticationHelper() {\n         mAppId = null;\n         mAppSecret = null;\n+        String buildConfigSecret = com.microsoft.identity.internal.testutils.BuildConfig.LAB_CLIENT_SECRET;\n+        mKeyVaultSecret = buildConfigSecret;", "originalCommit": "8342a626a3aef4c3bbdd064b1956e925bdf6b61a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTczMzk4Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r539733987", "bodyText": "done", "author": "AdamBJohnsonx", "createdAt": "2020-12-09T23:46:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTcxNDU5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTcxNTQxMQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r539715411", "bodyText": "What is this method for?", "author": "shahzaibj", "createdAt": "2020-12-09T23:07:12Z", "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java", "diffHunk": "@@ -40,10 +40,15 @@\n public class LabUserHelper {\n \n     private static final Map<LabUserQuery, LabConfig> sLabConfigCache = new HashMap<>();\n+    private volatile static ConfidentialClientHelper instance = LabAuthenticationHelper.getInstance();\n \n-    static List<ConfigInfo> getConfigInfos(LabUserQuery query) {\n+    public static void resetWithSecret(final String secret) {", "originalCommit": "8342a626a3aef4c3bbdd064b1956e925bdf6b61a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTczMjUzMA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r539732530", "bodyText": "Better?", "author": "AdamBJohnsonx", "createdAt": "2020-12-09T23:43:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTcxNTQxMQ=="}], "type": "inlineReview"}, {"oid": "75ef0cf1d6e95a88d2b15595fcbf5b4c99b2a310", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/75ef0cf1d6e95a88d2b15595fcbf5b4c99b2a310", "message": "Checkpoint", "committedDate": "2020-12-09T23:40:03Z", "type": "commit"}, {"oid": "7d87654f3f9fd5634e5f169dfbfecd542ea47ac0", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/7d87654f3f9fd5634e5f169dfbfecd542ea47ac0", "message": "Add backup strategy for finding lab secret, enable LabUserHelper to reset the value", "committedDate": "2020-12-09T23:40:03Z", "type": "commit"}, {"oid": "47b6f2b5ebecbe42c22363e89bb5e9647a953fb9", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/47b6f2b5ebecbe42c22363e89bb5e9647a953fb9", "message": "Don't trust the static initialziation", "committedDate": "2020-12-09T23:40:04Z", "type": "commit"}, {"oid": "6b9222f345c1c34c5a04c268904161966aa02131", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/6b9222f345c1c34c5a04c268904161966aa02131", "message": "Some more instances", "committedDate": "2020-12-09T23:40:04Z", "type": "commit"}, {"oid": "ee8ea686d82ff2b8c4ead57024a5c05cbf6b2a66", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/ee8ea686d82ff2b8c4ead57024a5c05cbf6b2a66", "message": "Pull up classpath scan", "committedDate": "2020-12-09T23:40:04Z", "type": "commit"}, {"oid": "329adb8fb4f846ff7abcc4600c76e5c0b312f4e5", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/329adb8fb4f846ff7abcc4600c76e5c0b312f4e5", "message": "Simplify KeyVaultAuthHelper logiv", "committedDate": "2020-12-09T23:40:04Z", "type": "commit"}, {"oid": "869232a61d0f1d781f8e2461126c36897113cb5c", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/869232a61d0f1d781f8e2461126c36897113cb5c", "message": "Add a semicolon", "committedDate": "2020-12-09T23:40:04Z", "type": "commit"}, {"oid": "08ba104079ecc8430fffbf88ff29c0b396d6824d", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/08ba104079ecc8430fffbf88ff29c0b396d6824d", "message": "Update testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/KeyVaultAuthHelper.java\n\nCo-authored-by: Shahzaib <37125644+shahzaibj@users.noreply.github.com>", "committedDate": "2020-12-09T23:40:04Z", "type": "commit"}, {"oid": "fe5715b98cf99160889ee4fa4720691aec0dda98", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/fe5715b98cf99160889ee4fa4720691aec0dda98", "message": "Update testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabAuthenticationHelper.java\n\nCo-authored-by: Shahzaib <37125644+shahzaibj@users.noreply.github.com>", "committedDate": "2020-12-09T23:40:04Z", "type": "commit"}, {"oid": "73cb4e8fa899295c84c47254fb9cccb66c3655d7", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/73cb4e8fa899295c84c47254fb9cccb66c3655d7", "message": "Fix silly string equals mistake", "committedDate": "2020-12-09T23:40:04Z", "type": "commit"}, {"oid": "80207fdda7d5f2030f4e8bca769cbd005d95dc77", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/80207fdda7d5f2030f4e8bca769cbd005d95dc77", "message": "Add an explanation", "committedDate": "2020-12-09T23:40:04Z", "type": "commit"}, {"oid": "5401c7fe82cc92622fb819714289d3edf286abf0", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/5401c7fe82cc92622fb819714289d3edf286abf0", "message": "Remove classpath inspection attempt", "committedDate": "2020-12-09T23:40:04Z", "type": "commit"}, {"oid": "bbc64c850622aba5a3f1df88f6bb00e7736533be", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/bbc64c850622aba5a3f1df88f6bb00e7736533be", "message": "Remove unused and not-present import", "committedDate": "2020-12-09T23:40:04Z", "type": "commit"}, {"oid": "5719f5017b96913cea047372d51420cc9aab45db", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/5719f5017b96913cea047372d51420cc9aab45db", "message": "Update testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java", "committedDate": "2020-12-09T23:40:04Z", "type": "commit"}, {"oid": "7c64359b6a7779ba26e5df36fc57c119f6aada8e", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/7c64359b6a7779ba26e5df36fc57c119f6aada8e", "message": "Add changes to allow for module overriding", "committedDate": "2020-12-09T23:40:04Z", "type": "commit"}, {"oid": "a4ede9b2dc9b9ab73065609f95cd6a7c01edd78c", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/a4ede9b2dc9b9ab73065609f95cd6a7c01edd78c", "message": "Check that the lab secret is different and then reset the authhelper instance", "committedDate": "2020-12-09T23:40:04Z", "type": "commit"}, {"oid": "f1f0989d8039171f7bd450677d38bc5e3272bdfd", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/f1f0989d8039171f7bd450677d38bc5e3272bdfd", "message": "Remove needless gradle change, add documentation", "committedDate": "2020-12-09T23:40:04Z", "type": "commit"}, {"oid": "77ab38ef9f87b1ab2102a12063f5863e85e09579", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/77ab38ef9f87b1ab2102a12063f5863e85e09579", "message": "Inline lines.  Add function to wipe cache.", "committedDate": "2020-12-09T23:40:04Z", "type": "commit"}, {"oid": "77ab38ef9f87b1ab2102a12063f5863e85e09579", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/77ab38ef9f87b1ab2102a12063f5863e85e09579", "message": "Inline lines.  Add function to wipe cache.", "committedDate": "2020-12-09T23:40:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTczMDk3NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r539730974", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n                  implementation project(':keyvault')\n          \n          \n            \n                  implementation project(':labapi')", "author": "AdamBJohnsonx", "createdAt": "2020-12-09T23:41:20Z", "path": "testutils/build.gradle", "diffHunk": "@@ -125,9 +125,6 @@ project.afterEvaluate{\n dependencies {\n     implementation fileTree(dir: 'libs', include: ['*.jar'])\n ", "originalCommit": "77ab38ef9f87b1ab2102a12063f5863e85e09579", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "56cf968235f38339fabe2cde836e582711de0960", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/56cf968235f38339fabe2cde836e582711de0960", "message": "Update testutils/build.gradle", "committedDate": "2020-12-09T23:41:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTczMTczNQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r539731735", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  implementation project(':keyvault')\n          \n          \n            \n                  implementation project(':labapi')\n          \n          \n            \n            \n          \n          \n            \n                  implementation project(':keyvault')\n          \n          \n            \n                  implementation project(':labapi')", "author": "AdamBJohnsonx", "createdAt": "2020-12-09T23:42:30Z", "path": "testutils/build.gradle", "diffHunk": "@@ -124,10 +124,8 @@ project.afterEvaluate{\n \n dependencies {\n     implementation fileTree(dir: 'libs', include: ['*.jar'])\n-\n-    implementation project(':keyvault')\n-    implementation project(':labapi')\n-\n+      implementation project(':keyvault')\n+      implementation project(':labapi')", "originalCommit": "56cf968235f38339fabe2cde836e582711de0960", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "40dde77fef98897a812aac29614602d2c058a063", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/40dde77fef98897a812aac29614602d2c058a063", "message": "Update testutils/build.gradle", "committedDate": "2020-12-09T23:42:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTczMjA4Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1151#discussion_r539732082", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  implementation project(':keyvault')\n          \n          \n            \n                  implementation project(':labapi')\n          \n          \n            \n                implementation project(':keyvault')\n          \n          \n            \n                implementation project(':labapi')", "author": "AdamBJohnsonx", "createdAt": "2020-12-09T23:43:02Z", "path": "testutils/build.gradle", "diffHunk": "@@ -125,8 +125,8 @@ project.afterEvaluate{\n dependencies {\n     implementation fileTree(dir: 'libs', include: ['*.jar'])\n \n-    implementation project(':keyvault')\n-    implementation project(':labapi')\n+      implementation project(':keyvault')\n+      implementation project(':labapi')", "originalCommit": "40dde77fef98897a812aac29614602d2c058a063", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a57083efaf7221dcaa1752b5a817f28051e52ab7", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/a57083efaf7221dcaa1752b5a817f28051e52ab7", "message": "Update testutils/build.gradle", "committedDate": "2020-12-09T23:43:07Z", "type": "commit"}]}