{"pr_number": 1177, "pr_title": "Add PRT storage support for MSAL-CPP", "pr_createdAt": "2020-12-28T09:38:38Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177", "timeline": [{"oid": "dadacfccebc12a96f4ee6e6007eef1c252915207", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/dadacfccebc12a96f4ee6e6007eef1c252915207", "message": "Update changelog.txt", "committedDate": "2020-12-28T09:41:24Z", "type": "forcePushed"}, {"oid": "615fdb829d260c124955129e31a85064cd09f7bd", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/615fdb829d260c124955129e31a85064cd09f7bd", "message": "Add PRT storage support", "committedDate": "2020-12-28T13:39:31Z", "type": "forcePushed"}, {"oid": "7b6d670601520f3901118a84aef725916b939a2e", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/7b6d670601520f3901118a84aef725916b939a2e", "message": "Update changelog.txt", "committedDate": "2021-01-06T05:13:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjg5MDExMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r552890112", "bodyText": "At a glance, this doesn't look correct.... IIRC RefreshToken credential types set \"\" as the realm, my suspicion is that PRTs should be cached according to the same rules. This should be confirmed with the iOS team for consistency", "author": "iambmelt", "createdAt": "2021-01-06T18:30:38Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/cache/CacheKeyValueDelegate.java", "diffHunk": "@@ -183,6 +185,10 @@ public String generateCacheKey(Credential credential) {\n             final IdTokenRecord idToken = (IdTokenRecord) credential;\n             cacheKey = cacheKey.replace(REALM, sanitizeNull(idToken.getRealm()));\n             cacheKey = cacheKey.replace(TARGET, \"\");\n+        } else if (credential instanceof PrimaryRefreshTokenRecord) {\n+            final PrimaryRefreshTokenRecord primaryRefreshTokenRecord = (PrimaryRefreshTokenRecord) credential;\n+            cacheKey = cacheKey.replace(REALM, sanitizeNull(primaryRefreshTokenRecord.getRealm()));", "originalCommit": "7b6d670601520f3901118a84aef725916b939a2e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDc5NDMyNg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r560794326", "bodyText": "Thanks. Changed REALM to \"\". And also do we need to set client_id to \"\" as well for PRT ?", "author": "richard1122", "createdAt": "2021-01-20T09:05:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjg5MDExMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTI2NjAyMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r561266022", "bodyText": "@richard1122 please confirm the desired cache-key behavior with @oldalton and write your tests accordingly", "author": "iambmelt", "createdAt": "2021-01-20T20:26:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjg5MDExMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjg5Mzk2Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r552893963", "bodyText": "nit: the format, as I understand it, will be something like \"3.0\", not \"V3\"", "author": "iambmelt", "createdAt": "2021-01-06T18:38:16Z", "path": "common/src/androidTest/java/com/microsoft/identity/common/MsalOAuth2TokenCacheTest.java", "diffHunk": "@@ -190,6 +195,20 @@\n             mGeneratedIdToken.setClientId(clientId);\n             mGeneratedIdToken.setSecret(idTokenSecret);\n             mGeneratedIdToken.setAuthority(\"https://sts.windows.net/0287f963-2d72-4363-9e3a-5705c5b0f031/\");\n+\n+            mGeneratedPrimaryRefreshToken = new PrimaryRefreshTokenRecord();\n+            mGeneratedPrimaryRefreshToken.setSecret(rtSecret);\n+            mGeneratedPrimaryRefreshToken.setTarget(target);\n+            mGeneratedPrimaryRefreshToken.setHomeAccountId(homeAccountId);\n+            mGeneratedPrimaryRefreshToken.setEnvironment(environment);\n+            mGeneratedPrimaryRefreshToken.setCredentialType(PrimaryRefreshToken.name());\n+            mGeneratedPrimaryRefreshToken.setClientId(clientId);\n+            mGeneratedPrimaryRefreshToken.setFamilyId(familyId);\n+            mGeneratedPrimaryRefreshToken.setRealm(realm);\n+            mGeneratedPrimaryRefreshToken.setExpiresOn(expiresOn);\n+            mGeneratedPrimaryRefreshToken.setCachedAt(cacheAt);\n+            mGeneratedPrimaryRefreshToken.setSessionKey(prtSessionKey);\n+            mGeneratedPrimaryRefreshToken.setPrtProtocolVersion(\"V3\");", "originalCommit": "7b6d670601520f3901118a84aef725916b939a2e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjg5NDM2MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r552894360", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            }else {\n          \n          \n            \n                            } else {", "author": "iambmelt", "createdAt": "2021-01-06T18:39:07Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/cache/SharedPreferencesAccountCredentialCache.java", "diffHunk": "@@ -430,7 +430,10 @@ public static CredentialType getCredentialTypeForCredentialCacheKey(@NonNull fin\n                 } else if (CredentialType.V1IdToken.name().equalsIgnoreCase(credentialTypeStr)) {\n                     type = CredentialType.V1IdToken;\n                     break;\n-                } else {\n+                } else if (CredentialType.PrimaryRefreshToken.name().equalsIgnoreCase(credentialTypeStr)) {\n+                    type = CredentialType.PrimaryRefreshToken;\n+                    break;\n+                }else {", "originalCommit": "7b6d670601520f3901118a84aef725916b939a2e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7306af07e96b9d2aae1f37a90659c16fc72cd401", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/7306af07e96b9d2aae1f37a90659c16fc72cd401", "message": "Update version, tweak", "committedDate": "2021-01-20T09:44:46Z", "type": "forcePushed"}, {"oid": "3fd76bb2c3c0a90371da53e62fa3dd9023a92670", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/3fd76bb2c3c0a90371da53e62fa3dd9023a92670", "message": "Add PRT cache key tests", "committedDate": "2021-01-21T06:10:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTYzNTEyMQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r561635121", "bodyText": "Hi @jbzdarkid, could you help review this?", "author": "richard1122", "createdAt": "2021-01-21T06:42:00Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/WebViewAuthorizationFragment.java", "diffHunk": "@@ -139,14 +140,11 @@ public void onPageLoaded() {\n                         // Inject the javascript string from testing. This should only be evaluated if we haven't sent\n                         // an auth result already.\n                         if (mAuthResultSent == false && !StringExtensions.isNullOrBlank(mPostPageLoadedJavascript)) {\n-                            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {\n-                                mWebView.evaluateJavascript(mPostPageLoadedJavascript, null);\n-                            } else {\n-                                // On earlier versions of Android, javascript has to be loaded with a custom scheme.\n-                                // In these cases, Android will helpfully unescape any octects it finds. Unfortunately,\n-                                // our javascript may contain the '%' character, so we escape it again, to undo that.\n-                                mWebView.loadUrl(\"javascript:\" + mPostPageLoadedJavascript.replace(\"%\", \"%25\"));\n-                            }\n+                            // TODO: #1268511 use EvaluteJavascript after tests are stable.", "originalCommit": "3fd76bb2c3c0a90371da53e62fa3dd9023a92670", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTY3NDI1OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r561674259", "bodyText": "Can you explain what part of this wasn't working? I saw no issues with evaluateJavascript in the tests that Brian & I ran.", "author": "jbzdarkid", "createdAt": "2021-01-21T08:11:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTYzNTEyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTY4NjE3Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r561686176", "bodyText": "In the WIP PR to enable InteractivePrtApiTests: https://github.com/AzureAD/microsoft-authentication-library-for-cpp/pull/1836/files#diff-a8ca4d4dabdc4dd14163d2252bf0d0f7db2cdf9bc7627e2e7c4dd61a7a6b09adR269\nThe webview will stuck at signin page, and after connected devtools, I saw endless requests canceled. Added some captures.\nhttps://identitydivision.visualstudio.com/DevEx/_workitems/edit/1268511/", "author": "richard1122", "createdAt": "2021-01-21T08:31:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTYzNTEyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTYzNTY5OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r561635698", "bodyText": "Hi @oldalton, this is cache key for PRT.\nNow it only constructed from HOME_ACCOUNT_ID, ENVIRONMENT and CREDENTIAL_TYPE.\nTests add primaryRefreshTokenCacheKeyComplete", "author": "richard1122", "createdAt": "2021-01-21T06:43:52Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/cache/CacheKeyValueDelegate.java", "diffHunk": "@@ -163,6 +164,8 @@ public String generateCacheKey(Credential credential) {\n             }\n \n             cacheKey = cacheKey.replace(CLIENT_ID, familyIdForCacheKey);\n+        } else if (credential instanceof PrimaryRefreshTokenRecord) {\n+            cacheKey = cacheKey.replace(CLIENT_ID, \"\");", "originalCommit": "3fd76bb2c3c0a90371da53e62fa3dd9023a92670", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjE1MTYyMA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r562151620", "bodyText": "Hi, please follow the schema as described here: https://identitydivision.visualstudio.com/DevEx/_git/AuthLibrariesApiReview?path=%2FSSO%2FSchema.md (Primary refresh token schema section)\nKey should contain home account id, environment, credential type, and clientId in a specific order.", "author": "oldalton", "createdAt": "2021-01-21T19:44:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTYzNTY5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjU5OTg3Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r562599877", "bodyText": "Thanks, please help review again..", "author": "richard1122", "createdAt": "2021-01-22T12:31:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTYzNTY5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjEwNQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r562966105", "bodyText": "I don't understand this. Why is this value being set to \"\"? Can you point me towards where this is outlined in the schema spec?", "author": "iambmelt", "createdAt": "2021-01-22T23:14:31Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/cache/CacheKeyValueDelegate.java", "diffHunk": "@@ -192,6 +196,9 @@ public String generateCacheKey(Credential credential) {\n             final IdTokenRecord idToken = (IdTokenRecord) credential;\n             cacheKey = cacheKey.replace(REALM, sanitizeNull(idToken.getRealm()));\n             cacheKey = cacheKey.replace(TARGET, \"\");\n+        } else if (credential instanceof PrimaryRefreshTokenRecord) {\n+            cacheKey = cacheKey.replace(REALM, \"\");", "originalCommit": "06913bcd582bd5147bb724836af056ec8aecb3cb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2ODM4NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r562968385", "bodyText": "OK -  I believe this comes from here - can you please update the implementation of AbstractAccountCredentialCache#getCredentialsFilteredByInternal() to ensure this is handled correctly when filtering serialized records? It looks like PRT lookups need to behave like wildcards when filtering by realm and target. See uses of mustMatchOnRealm and mustMatchOnTarget", "author": "iambmelt", "createdAt": "2021-01-22T23:21:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjEwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzQ2OTc2OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r563469768", "bodyText": "Just looked mustMatchOnTarget, mustMatchOnRealm, it works as wildcard for PRT.", "author": "richard1122", "createdAt": "2021-01-25T05:25:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjEwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzUxMjA4Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r563512086", "bodyText": "Also updated mustMatchOnClientId to not filter by client_id for PRT, and added two tests.", "author": "richard1122", "createdAt": "2021-01-25T07:38:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjEwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NzkyNzE3NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r577927174", "bodyText": "Also updated mustMatchOnClientId to not filter by client_id for PRT, and added two tests.\n\n@richard1122 I no longer see these changes in this PR. Not needed?", "author": "iambmelt", "createdAt": "2021-02-17T20:38:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjEwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODA3NDUzNA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r578074534", "bodyText": "Hi @iambmelt , from discussion here, we will continue support filter by client id, and let caller decide.", "author": "richard1122", "createdAt": "2021-02-18T02:04:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjEwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODA3NjU3Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r578076572", "bodyText": "ACK, resolved", "author": "iambmelt", "createdAt": "2021-02-18T02:09:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjEwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjE2NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r562966164", "bodyText": "Same here.... I don't understand this. Why is this value being set to \"\"? Can you point me towards where this is outlined in the schema spec?", "author": "iambmelt", "createdAt": "2021-01-22T23:14:44Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/cache/CacheKeyValueDelegate.java", "diffHunk": "@@ -192,6 +196,9 @@ public String generateCacheKey(Credential credential) {\n             final IdTokenRecord idToken = (IdTokenRecord) credential;\n             cacheKey = cacheKey.replace(REALM, sanitizeNull(idToken.getRealm()));\n             cacheKey = cacheKey.replace(TARGET, \"\");\n+        } else if (credential instanceof PrimaryRefreshTokenRecord) {\n+            cacheKey = cacheKey.replace(REALM, \"\");\n+            cacheKey = cacheKey.replace(TARGET, \"\");", "originalCommit": "06913bcd582bd5147bb724836af056ec8aecb3cb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2ODc4Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r562968786", "bodyText": "OK - I think is same as here, please see this comment re: updating filter logic used for serialized instances", "author": "iambmelt", "createdAt": "2021-01-22T23:23:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjE2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjY0MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r562966640", "bodyText": "What is meant here by \"reversed\"? This naming unclear to me", "author": "iambmelt", "createdAt": "2021-01-22T23:16:12Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/cache/CacheKeyValueDelegate.java", "diffHunk": "@@ -72,6 +73,7 @@\n      */\n     public static final String CACHE_VALUE_SEPARATOR = \"-\";\n     private static final String FOCI_PREFIX = \"foci-\";\n+    private static final String REVERSED_PRT_CLIENT_ID = \"1\";", "originalCommit": "06913bcd582bd5147bb724836af056ec8aecb3cb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzQ3MzA1Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r563473057", "bodyText": "It's typo. Updated to RESERVED_PRT_CLIENT_ID.\nJust like windows code", "author": "richard1122", "createdAt": "2021-01-25T05:37:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjY0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mzk4MDEwMw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r563980103", "bodyText": "Should we use the actual clientId that you're using for PRT acquisition?", "author": "oldalton", "createdAt": "2021-01-25T19:17:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjY0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDE0ODE4OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564148188", "bodyText": "Should we use the actual clientId that you're using for PRT acquisition?\n\nSame question", "author": "iambmelt", "createdAt": "2021-01-26T01:14:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjY0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDE0ODk4NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564148985", "bodyText": "We can change it, but then we'd have to update code on other platforms too. I don't know if we want to make that step before we have to.", "author": "jbzdarkid", "createdAt": "2021-01-26T01:17:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjY0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDE1MDM5OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564150399", "bodyText": "(It looks like this is by-design: is it documented though?)", "author": "iambmelt", "createdAt": "2021-01-26T01:20:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjY0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDE3ODI5NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564178294", "bodyText": "I have no idea. It's same as windows code. Let me know your decision.", "author": "richard1122", "createdAt": "2021-01-26T02:39:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjY0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDE4NTAwMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564185002", "bodyText": "Gotcha, thanks @richard1122\n@oldalton What's your take on this? This seems to run counter to the schema's definition of client_id with respect to PrimaryRefreshTokens. Personally, I'm not sure I'd have done it this way: I may have used the caller's real client_id and then had lookup logic that can handle either the id or a wildcarded value (meaning \"any\")\n/cc @jbzdarkid", "author": "iambmelt", "createdAt": "2021-01-26T03:01:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjY0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDE4NjY5Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564186693", "bodyText": "I agree - we use real broker clientId in iOS and macOS broker as well for PRT storage, so this is inconsistent with it. However, if it would be a breaking SSO change and it doesn't conflict with other PRT storages, then agree with @jbzdarkid that we might not want to do it. If it's not a breaking SSO change though, let's make the change now rather than after we ship.", "author": "oldalton", "createdAt": "2021-01-26T03:07:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjY0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDE4NzcwNQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564187705", "bodyText": "OK, so we are going to:\n\nSave real client id in cache key\nFetch by real client id or (wildcard -- any), caller decide\n\nI'll make the change and update tests.", "author": "richard1122", "createdAt": "2021-01-26T03:10:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjY0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDE5MTA4MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564191080", "bodyText": "Update, please help review, thanks !", "author": "richard1122", "createdAt": "2021-01-26T03:23:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjk2NjY0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDE0OTE3Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564149177", "bodyText": "Could we instead move this logic 'up' such that its more like\nfinal boolean mustMatchOnClientId = !StringExtensions.isNullOrBlank(clientId) && !(credential instanceof PrimaryRefreshTokenRecord) ;", "author": "iambmelt", "createdAt": "2021-01-26T01:17:43Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/cache/AbstractAccountCredentialCache.java", "diffHunk": "@@ -176,7 +180,7 @@\n                 matches = matches && equalsIgnoreCaseTrim(credentialType.name(), credential.getCredentialType());\n             }\n \n-            if (mustMatchOnClientId) {\n+            if (mustMatchOnClientId && !(credential instanceof PrimaryRefreshTokenRecord)) {", "originalCommit": "47c6a5746e68b3d1cb366e3d001e67e83c55f23b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDE4MDA2MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564180060", "bodyText": "Thanks, updated.", "author": "richard1122", "createdAt": "2021-01-26T02:44:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDE0OTE3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDE1NDIxOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564154219", "bodyText": "This now appears unused... do we need a property to track the realm? If not, can this be removed?\nIt would be great to understand whether the PRT needs to be associated with a realm\n\nFundamentally, it has a realm component of its cache key, but its always \"\" -- can we safely assume we will never need to lookup a PRT by realm?", "author": "iambmelt", "createdAt": "2021-01-26T01:27:40Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/dto/PrimaryRefreshTokenRecord.java", "diffHunk": "@@ -0,0 +1,256 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common.internal.dto;\n+\n+import com.google.gson.annotations.SerializedName;\n+\n+import java.util.Calendar;\n+import java.util.Date;\n+import java.util.concurrent.TimeUnit;\n+\n+import static com.microsoft.identity.common.internal.dto.PrimaryRefreshTokenRecord.SerializedNames.*;\n+\n+public class PrimaryRefreshTokenRecord extends Credential {\n+\n+    public static class SerializedNames extends Credential.SerializedNames {\n+        /**\n+         * String of family id.\n+         */\n+        public static final String FAMILY_ID = \"family_id\";\n+        /**\n+         * String of realm.\n+         */\n+        public static final String REALM = \"realm\";", "originalCommit": "47c6a5746e68b3d1cb366e3d001e67e83c55f23b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDE3NDkwNg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564174906", "bodyText": "From this doc, realm is not needed in PRT. I'll delete this field.", "author": "richard1122", "createdAt": "2021-01-26T02:28:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDE1NDIxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDE4MDEwMw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564180103", "bodyText": "Deleted", "author": "richard1122", "createdAt": "2021-01-26T02:45:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDE1NDIxOQ=="}], "type": "inlineReview"}, {"oid": "f71dd1edf124d7fe840a0f1ec2634905ea203321", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/f71dd1edf124d7fe840a0f1ec2634905ea203321", "message": "Delete REALM from PRT record", "committedDate": "2021-01-26T02:42:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDg4Nzg3OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564887879", "bodyText": "Can this be a value class? We'd (potentially) have to write an InstanceCreator, but we wouldn't need to worry about those setter methods, nor about making sure anything using it was properly synchronized w.r.t. creation.", "author": "AdamBJohnsonx", "createdAt": "2021-01-26T22:48:53Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/dto/PrimaryRefreshTokenRecord.java", "diffHunk": "@@ -0,0 +1,252 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common.internal.dto;\n+\n+import com.google.gson.annotations.SerializedName;\n+\n+import java.util.Calendar;\n+import java.util.Date;\n+import java.util.concurrent.TimeUnit;\n+\n+import static com.microsoft.identity.common.internal.dto.PrimaryRefreshTokenRecord.SerializedNames.*;\n+\n+public class PrimaryRefreshTokenRecord extends Credential {", "originalCommit": "fff151f2090532efcca75f0deeec220ac9426eaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDg5NzE0Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564897142", "bodyText": "OK, that might be too much, because it's inheritance level is deep.", "author": "AdamBJohnsonx", "createdAt": "2021-01-26T23:03:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDg4Nzg3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDg5MzExMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564893112", "bodyText": "Extra lines", "author": "AdamBJohnsonx", "createdAt": "2021-01-26T22:59:28Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/dto/PrimaryRefreshTokenRecord.java", "diffHunk": "@@ -0,0 +1,252 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common.internal.dto;\n+\n+import com.google.gson.annotations.SerializedName;\n+\n+import java.util.Calendar;\n+import java.util.Date;\n+import java.util.concurrent.TimeUnit;\n+\n+import static com.microsoft.identity.common.internal.dto.PrimaryRefreshTokenRecord.SerializedNames.*;\n+\n+public class PrimaryRefreshTokenRecord extends Credential {\n+\n+    public static class SerializedNames extends Credential.SerializedNames {\n+        /**\n+         * String of family id.\n+         */\n+        public static final String FAMILY_ID = \"family_id\";\n+\n+        /**\n+         * String of session_key.\n+         */\n+        public static final String SESSION_KEY = \"session_key\";\n+\n+        /**\n+         * String of session_key_rolling_date.\n+         */\n+        public static final String SESSION_KEY_ROLLING_DATE = \"session_key_rolling_date\";\n+\n+        /**\n+         * String of prt_protocol_version.\n+         */\n+        public static final String PRT_PROTOCOL_VERSION = \"prt_protocol_version\";\n+    }\n+\n+    /**\n+     * 1st Party Application Family ID.\n+     */\n+    @SerializedName(FAMILY_ID)\n+    private String mFamilyId;\n+\n+    /**\n+     * PRT expiry time.\u202fThis value is returned from the server as refresh_token_expires_in that\n+     * should be added to local time.\n+     */\n+    @SerializedName(EXPIRES_ON)\n+    private String mExpiresOn;\n+\n+    /**\n+     * Session key of PRT.\n+     */\n+    @SerializedName(SESSION_KEY)\n+    private String mSessionKey;\n+\n+    /**\n+     * The version of the PRT Protocol being used, version 3 supports no device_id.\n+     */\n+    @SerializedName(PRT_PROTOCOL_VERSION)\n+    private String mPrtProtocolVersion;\n+\n+    /**\n+     * Session key expiry time.\u202fThis value is determined by the client and set to 60 days after the\n+     * session key was initally issued\n+     */\n+    @SerializedName(SESSION_KEY_ROLLING_DATE)\n+    private String mSessionKeyRollingDate;\n+\n+    /**\n+     * Gets the family_id.\n+     *\n+     * @return The family_id to get.\n+     */\n+    public String getFamilyId() {\n+        return mFamilyId;\n+    }\n+\n+    /**\n+     * Sets the family_id.\n+     *\n+     * @param familyId The family_id to set.\n+     */\n+    public void setFamilyId(final String familyId) {\n+        mFamilyId = familyId;\n+    }\n+\n+    public boolean isExpired(final String expires) {\n+        // Init a Calendar for the current time/date\n+        final Calendar calendar = Calendar.getInstance();\n+        final Date validity = calendar.getTime();\n+        // Init a Date for the accessToken's expiry\n+        long epoch = Long.valueOf(expires);\n+        final Date expiresOn = new Date(\n+                TimeUnit.SECONDS.toMillis(epoch)\n+        );\n+        return expiresOn.before(validity);\n+    }\n+\n+    @Override\n+    public boolean isExpired() {\n+        return isExpired(getExpiresOn());\n+    }\n+\n+    /**\n+     * Gets the expires_on.\n+     * @return The expires_on to get.\n+     */\n+    public String getExpiresOn() {\n+        return mExpiresOn;\n+    }\n+\n+    /**\n+     * Sets the expires_on.\n+     * @param expiresOn The expires_on to set.\n+     */\n+    public void setExpiresOn(String expiresOn) {\n+        mExpiresOn = expiresOn;\n+    }\n+\n+    /**\n+     * Gets the session_key.\n+     * @return The session_key to get.\n+     */\n+    public String getSessionKey() {\n+        return mSessionKey;\n+    }\n+\n+    /**\n+     * Sets the session_key.\n+     *\n+     * @param sessionKey The session_key to set.\n+     */\n+    public void setSessionKey(String sessionKey) {\n+        mSessionKey = sessionKey;\n+    }\n+\n+    /**\n+     * Gets the prt_protocol_version.\n+     *\n+     * @return The prt_protocol_version to get.\n+     */\n+    public String getPrtProtocolVersion() {\n+        return mPrtProtocolVersion;\n+    }\n+\n+    /**\n+     * Sets the prt_protocol_version.\n+     *\n+     * @param prtProtocolVersion The prt_protocol_version to set.\n+     */\n+    public void setPrtProtocolVersion(String prtProtocolVersion) {\n+        mPrtProtocolVersion = prtProtocolVersion;\n+    }\n+\n+    /**\n+     * Gets the session_key_rolling_date.\n+     *\n+     * @return The session_key_rolling_date to get.\n+     */\n+    public String getSessionKeyRollingDate() {\n+        return mSessionKeyRollingDate;\n+    }\n+\n+    /**\n+     * Sets the session_key_rolling_date.\n+     * @param sessionKeyRollingDate The session_key_rolling_date to set.\n+     */\n+    public void setSessionKeyRollingDate(String sessionKeyRollingDate) {\n+        mSessionKeyRollingDate = sessionKeyRollingDate;\n+    }\n+\n+    //CHECKSTYLE:OFF\n+    // This method is generated. Checkstyle and/or PMD has been disabled.\n+    // This method *must* be regenerated if the class' structural definition changes through the\n+    // addition/subtraction of fields.\n+    @SuppressWarnings(\"PMD\")\n+    @Override\n+    public boolean equals(Object o) {\n+        if (this == o) return true;\n+        if (o == null || getClass() != o.getClass()) return false;\n+        if (!super.equals(o)) return false;\n+\n+        PrimaryRefreshTokenRecord that = (PrimaryRefreshTokenRecord) o;\n+\n+        if (mFamilyId != null ? !mFamilyId.equals(that.mFamilyId) : that.mFamilyId != null)\n+            return false;\n+        if (mExpiresOn != null ? !mExpiresOn.equals(that.mExpiresOn) : that.mExpiresOn != null)\n+            return false;\n+        if (mSessionKey != null ? !mSessionKey.equals(that.mSessionKey) : that.mSessionKey != null)\n+            return false;\n+        if (mPrtProtocolVersion != null ? !mPrtProtocolVersion.equals(that.mPrtProtocolVersion) : that.mPrtProtocolVersion != null)\n+            return false;\n+        return mSessionKeyRollingDate != null ? mSessionKeyRollingDate.equals(that.mSessionKeyRollingDate) : that.mSessionKeyRollingDate == null;\n+    }\n+    //CHECKSTYLE:ON\n+\n+", "originalCommit": "fff151f2090532efcca75f0deeec220ac9426eaa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDg5NjI1Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564896257", "bodyText": "Can we just pick these up with @EqualsAndHashCode?", "author": "AdamBJohnsonx", "createdAt": "2021-01-26T23:02:13Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/dto/PrimaryRefreshTokenRecord.java", "diffHunk": "@@ -0,0 +1,252 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common.internal.dto;\n+\n+import com.google.gson.annotations.SerializedName;\n+\n+import java.util.Calendar;\n+import java.util.Date;\n+import java.util.concurrent.TimeUnit;\n+\n+import static com.microsoft.identity.common.internal.dto.PrimaryRefreshTokenRecord.SerializedNames.*;\n+\n+public class PrimaryRefreshTokenRecord extends Credential {\n+\n+    public static class SerializedNames extends Credential.SerializedNames {\n+        /**\n+         * String of family id.\n+         */\n+        public static final String FAMILY_ID = \"family_id\";\n+\n+        /**\n+         * String of session_key.\n+         */\n+        public static final String SESSION_KEY = \"session_key\";\n+\n+        /**\n+         * String of session_key_rolling_date.\n+         */\n+        public static final String SESSION_KEY_ROLLING_DATE = \"session_key_rolling_date\";\n+\n+        /**\n+         * String of prt_protocol_version.\n+         */\n+        public static final String PRT_PROTOCOL_VERSION = \"prt_protocol_version\";\n+    }\n+\n+    /**\n+     * 1st Party Application Family ID.\n+     */\n+    @SerializedName(FAMILY_ID)\n+    private String mFamilyId;\n+\n+    /**\n+     * PRT expiry time.\u202fThis value is returned from the server as refresh_token_expires_in that\n+     * should be added to local time.\n+     */\n+    @SerializedName(EXPIRES_ON)\n+    private String mExpiresOn;\n+\n+    /**\n+     * Session key of PRT.\n+     */\n+    @SerializedName(SESSION_KEY)\n+    private String mSessionKey;\n+\n+    /**\n+     * The version of the PRT Protocol being used, version 3 supports no device_id.\n+     */\n+    @SerializedName(PRT_PROTOCOL_VERSION)\n+    private String mPrtProtocolVersion;\n+\n+    /**\n+     * Session key expiry time.\u202fThis value is determined by the client and set to 60 days after the\n+     * session key was initally issued\n+     */\n+    @SerializedName(SESSION_KEY_ROLLING_DATE)\n+    private String mSessionKeyRollingDate;\n+\n+    /**\n+     * Gets the family_id.\n+     *\n+     * @return The family_id to get.\n+     */\n+    public String getFamilyId() {\n+        return mFamilyId;\n+    }\n+\n+    /**\n+     * Sets the family_id.\n+     *\n+     * @param familyId The family_id to set.\n+     */\n+    public void setFamilyId(final String familyId) {\n+        mFamilyId = familyId;\n+    }\n+\n+    public boolean isExpired(final String expires) {\n+        // Init a Calendar for the current time/date\n+        final Calendar calendar = Calendar.getInstance();\n+        final Date validity = calendar.getTime();\n+        // Init a Date for the accessToken's expiry\n+        long epoch = Long.valueOf(expires);\n+        final Date expiresOn = new Date(\n+                TimeUnit.SECONDS.toMillis(epoch)\n+        );\n+        return expiresOn.before(validity);\n+    }\n+\n+    @Override\n+    public boolean isExpired() {\n+        return isExpired(getExpiresOn());\n+    }\n+\n+    /**\n+     * Gets the expires_on.\n+     * @return The expires_on to get.\n+     */\n+    public String getExpiresOn() {\n+        return mExpiresOn;\n+    }\n+\n+    /**\n+     * Sets the expires_on.\n+     * @param expiresOn The expires_on to set.\n+     */\n+    public void setExpiresOn(String expiresOn) {\n+        mExpiresOn = expiresOn;\n+    }\n+\n+    /**\n+     * Gets the session_key.\n+     * @return The session_key to get.\n+     */\n+    public String getSessionKey() {\n+        return mSessionKey;\n+    }\n+\n+    /**\n+     * Sets the session_key.\n+     *\n+     * @param sessionKey The session_key to set.\n+     */\n+    public void setSessionKey(String sessionKey) {\n+        mSessionKey = sessionKey;\n+    }\n+\n+    /**\n+     * Gets the prt_protocol_version.\n+     *\n+     * @return The prt_protocol_version to get.\n+     */\n+    public String getPrtProtocolVersion() {\n+        return mPrtProtocolVersion;\n+    }\n+\n+    /**\n+     * Sets the prt_protocol_version.\n+     *\n+     * @param prtProtocolVersion The prt_protocol_version to set.\n+     */\n+    public void setPrtProtocolVersion(String prtProtocolVersion) {\n+        mPrtProtocolVersion = prtProtocolVersion;\n+    }\n+\n+    /**\n+     * Gets the session_key_rolling_date.\n+     *\n+     * @return The session_key_rolling_date to get.\n+     */\n+    public String getSessionKeyRollingDate() {\n+        return mSessionKeyRollingDate;\n+    }\n+\n+    /**\n+     * Sets the session_key_rolling_date.\n+     * @param sessionKeyRollingDate The session_key_rolling_date to set.\n+     */\n+    public void setSessionKeyRollingDate(String sessionKeyRollingDate) {\n+        mSessionKeyRollingDate = sessionKeyRollingDate;\n+    }\n+\n+    //CHECKSTYLE:OFF\n+    // This method is generated. Checkstyle and/or PMD has been disabled.\n+    // This method *must* be regenerated if the class' structural definition changes through the\n+    // addition/subtraction of fields.\n+    @SuppressWarnings(\"PMD\")\n+    @Override\n+    public boolean equals(Object o) {\n+        if (this == o) return true;\n+        if (o == null || getClass() != o.getClass()) return false;\n+        if (!super.equals(o)) return false;\n+\n+        PrimaryRefreshTokenRecord that = (PrimaryRefreshTokenRecord) o;\n+\n+        if (mFamilyId != null ? !mFamilyId.equals(that.mFamilyId) : that.mFamilyId != null)\n+            return false;\n+        if (mExpiresOn != null ? !mExpiresOn.equals(that.mExpiresOn) : that.mExpiresOn != null)\n+            return false;\n+        if (mSessionKey != null ? !mSessionKey.equals(that.mSessionKey) : that.mSessionKey != null)\n+            return false;\n+        if (mPrtProtocolVersion != null ? !mPrtProtocolVersion.equals(that.mPrtProtocolVersion) : that.mPrtProtocolVersion != null)\n+            return false;\n+        return mSessionKeyRollingDate != null ? mSessionKeyRollingDate.equals(that.mSessionKeyRollingDate) : that.mSessionKeyRollingDate == null;\n+    }\n+    //CHECKSTYLE:ON", "originalCommit": "fff151f2090532efcca75f0deeec220ac9426eaa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDg5ODkwMA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564898900", "bodyText": "Could this just be Long.valueOf(expires) * 1000 <  System.currentTimeMillis?", "author": "AdamBJohnsonx", "createdAt": "2021-01-26T23:04:56Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/dto/PrimaryRefreshTokenRecord.java", "diffHunk": "@@ -0,0 +1,252 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common.internal.dto;\n+\n+import com.google.gson.annotations.SerializedName;\n+\n+import java.util.Calendar;\n+import java.util.Date;\n+import java.util.concurrent.TimeUnit;\n+\n+import static com.microsoft.identity.common.internal.dto.PrimaryRefreshTokenRecord.SerializedNames.*;\n+\n+public class PrimaryRefreshTokenRecord extends Credential {\n+\n+    public static class SerializedNames extends Credential.SerializedNames {\n+        /**\n+         * String of family id.\n+         */\n+        public static final String FAMILY_ID = \"family_id\";\n+\n+        /**\n+         * String of session_key.\n+         */\n+        public static final String SESSION_KEY = \"session_key\";\n+\n+        /**\n+         * String of session_key_rolling_date.\n+         */\n+        public static final String SESSION_KEY_ROLLING_DATE = \"session_key_rolling_date\";\n+\n+        /**\n+         * String of prt_protocol_version.\n+         */\n+        public static final String PRT_PROTOCOL_VERSION = \"prt_protocol_version\";\n+    }\n+\n+    /**\n+     * 1st Party Application Family ID.\n+     */\n+    @SerializedName(FAMILY_ID)\n+    private String mFamilyId;\n+\n+    /**\n+     * PRT expiry time.\u202fThis value is returned from the server as refresh_token_expires_in that\n+     * should be added to local time.\n+     */\n+    @SerializedName(EXPIRES_ON)\n+    private String mExpiresOn;\n+\n+    /**\n+     * Session key of PRT.\n+     */\n+    @SerializedName(SESSION_KEY)\n+    private String mSessionKey;\n+\n+    /**\n+     * The version of the PRT Protocol being used, version 3 supports no device_id.\n+     */\n+    @SerializedName(PRT_PROTOCOL_VERSION)\n+    private String mPrtProtocolVersion;\n+\n+    /**\n+     * Session key expiry time.\u202fThis value is determined by the client and set to 60 days after the\n+     * session key was initally issued\n+     */\n+    @SerializedName(SESSION_KEY_ROLLING_DATE)\n+    private String mSessionKeyRollingDate;\n+\n+    /**\n+     * Gets the family_id.\n+     *\n+     * @return The family_id to get.\n+     */\n+    public String getFamilyId() {\n+        return mFamilyId;\n+    }\n+\n+    /**\n+     * Sets the family_id.\n+     *\n+     * @param familyId The family_id to set.\n+     */\n+    public void setFamilyId(final String familyId) {\n+        mFamilyId = familyId;\n+    }\n+\n+    public boolean isExpired(final String expires) {\n+        // Init a Calendar for the current time/date\n+        final Calendar calendar = Calendar.getInstance();\n+        final Date validity = calendar.getTime();\n+        // Init a Date for the accessToken's expiry\n+        long epoch = Long.valueOf(expires);\n+        final Date expiresOn = new Date(\n+                TimeUnit.SECONDS.toMillis(epoch)\n+        );\n+        return expiresOn.before(validity);", "originalCommit": "fff151f2090532efcca75f0deeec220ac9426eaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTk1OTExMA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r565959110", "bodyText": "Updated, thanks", "author": "richard1122", "createdAt": "2021-01-28T09:55:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDg5ODkwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDg5OTY0OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564899649", "bodyText": "can we put the units in the name of this argument?  expirationTimeEpochSeconds?", "author": "AdamBJohnsonx", "createdAt": "2021-01-26T23:06:31Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/dto/PrimaryRefreshTokenRecord.java", "diffHunk": "@@ -0,0 +1,252 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common.internal.dto;\n+\n+import com.google.gson.annotations.SerializedName;\n+\n+import java.util.Calendar;\n+import java.util.Date;\n+import java.util.concurrent.TimeUnit;\n+\n+import static com.microsoft.identity.common.internal.dto.PrimaryRefreshTokenRecord.SerializedNames.*;\n+\n+public class PrimaryRefreshTokenRecord extends Credential {\n+\n+    public static class SerializedNames extends Credential.SerializedNames {\n+        /**\n+         * String of family id.\n+         */\n+        public static final String FAMILY_ID = \"family_id\";\n+\n+        /**\n+         * String of session_key.\n+         */\n+        public static final String SESSION_KEY = \"session_key\";\n+\n+        /**\n+         * String of session_key_rolling_date.\n+         */\n+        public static final String SESSION_KEY_ROLLING_DATE = \"session_key_rolling_date\";\n+\n+        /**\n+         * String of prt_protocol_version.\n+         */\n+        public static final String PRT_PROTOCOL_VERSION = \"prt_protocol_version\";\n+    }\n+\n+    /**\n+     * 1st Party Application Family ID.\n+     */\n+    @SerializedName(FAMILY_ID)\n+    private String mFamilyId;\n+\n+    /**\n+     * PRT expiry time.\u202fThis value is returned from the server as refresh_token_expires_in that\n+     * should be added to local time.\n+     */\n+    @SerializedName(EXPIRES_ON)\n+    private String mExpiresOn;\n+\n+    /**\n+     * Session key of PRT.\n+     */\n+    @SerializedName(SESSION_KEY)\n+    private String mSessionKey;\n+\n+    /**\n+     * The version of the PRT Protocol being used, version 3 supports no device_id.\n+     */\n+    @SerializedName(PRT_PROTOCOL_VERSION)\n+    private String mPrtProtocolVersion;\n+\n+    /**\n+     * Session key expiry time.\u202fThis value is determined by the client and set to 60 days after the\n+     * session key was initally issued\n+     */\n+    @SerializedName(SESSION_KEY_ROLLING_DATE)\n+    private String mSessionKeyRollingDate;\n+\n+    /**\n+     * Gets the family_id.\n+     *\n+     * @return The family_id to get.\n+     */\n+    public String getFamilyId() {\n+        return mFamilyId;\n+    }\n+\n+    /**\n+     * Sets the family_id.\n+     *\n+     * @param familyId The family_id to set.\n+     */\n+    public void setFamilyId(final String familyId) {\n+        mFamilyId = familyId;\n+    }\n+\n+    public boolean isExpired(final String expires) {", "originalCommit": "fff151f2090532efcca75f0deeec220ac9426eaa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDkwMTQ0Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r564901443", "bodyText": "Can we put the units in the parameter name, since I think this is epoch seconds.", "author": "AdamBJohnsonx", "createdAt": "2021-01-26T23:10:33Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/dto/PrimaryRefreshTokenRecord.java", "diffHunk": "@@ -0,0 +1,252 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common.internal.dto;\n+\n+import com.google.gson.annotations.SerializedName;\n+\n+import java.util.Calendar;\n+import java.util.Date;\n+import java.util.concurrent.TimeUnit;\n+\n+import static com.microsoft.identity.common.internal.dto.PrimaryRefreshTokenRecord.SerializedNames.*;\n+\n+public class PrimaryRefreshTokenRecord extends Credential {\n+\n+    public static class SerializedNames extends Credential.SerializedNames {\n+        /**\n+         * String of family id.\n+         */\n+        public static final String FAMILY_ID = \"family_id\";\n+\n+        /**\n+         * String of session_key.\n+         */\n+        public static final String SESSION_KEY = \"session_key\";\n+\n+        /**\n+         * String of session_key_rolling_date.\n+         */\n+        public static final String SESSION_KEY_ROLLING_DATE = \"session_key_rolling_date\";\n+\n+        /**\n+         * String of prt_protocol_version.\n+         */\n+        public static final String PRT_PROTOCOL_VERSION = \"prt_protocol_version\";\n+    }\n+\n+    /**\n+     * 1st Party Application Family ID.\n+     */\n+    @SerializedName(FAMILY_ID)\n+    private String mFamilyId;\n+\n+    /**\n+     * PRT expiry time.\u202fThis value is returned from the server as refresh_token_expires_in that\n+     * should be added to local time.\n+     */\n+    @SerializedName(EXPIRES_ON)\n+    private String mExpiresOn;\n+\n+    /**\n+     * Session key of PRT.\n+     */\n+    @SerializedName(SESSION_KEY)\n+    private String mSessionKey;\n+\n+    /**\n+     * The version of the PRT Protocol being used, version 3 supports no device_id.\n+     */\n+    @SerializedName(PRT_PROTOCOL_VERSION)\n+    private String mPrtProtocolVersion;\n+\n+    /**\n+     * Session key expiry time.\u202fThis value is determined by the client and set to 60 days after the\n+     * session key was initally issued\n+     */\n+    @SerializedName(SESSION_KEY_ROLLING_DATE)\n+    private String mSessionKeyRollingDate;\n+\n+    /**\n+     * Gets the family_id.\n+     *\n+     * @return The family_id to get.\n+     */\n+    public String getFamilyId() {\n+        return mFamilyId;\n+    }\n+\n+    /**\n+     * Sets the family_id.\n+     *\n+     * @param familyId The family_id to set.\n+     */\n+    public void setFamilyId(final String familyId) {\n+        mFamilyId = familyId;\n+    }\n+\n+    public boolean isExpired(final String expires) {\n+        // Init a Calendar for the current time/date\n+        final Calendar calendar = Calendar.getInstance();\n+        final Date validity = calendar.getTime();\n+        // Init a Date for the accessToken's expiry\n+        long epoch = Long.valueOf(expires);\n+        final Date expiresOn = new Date(\n+                TimeUnit.SECONDS.toMillis(epoch)\n+        );\n+        return expiresOn.before(validity);\n+    }\n+\n+    @Override\n+    public boolean isExpired() {\n+        return isExpired(getExpiresOn());\n+    }\n+\n+    /**\n+     * Gets the expires_on.\n+     * @return The expires_on to get.\n+     */\n+    public String getExpiresOn() {\n+        return mExpiresOn;\n+    }\n+\n+    /**\n+     * Sets the expires_on.\n+     * @param expiresOn The expires_on to set.\n+     */\n+    public void setExpiresOn(String expiresOn) {", "originalCommit": "fff151f2090532efcca75f0deeec220ac9426eaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTk2MDU2MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r565960561", "bodyText": "It's same as AccessTokenRecord, we can just leave it?", "author": "richard1122", "createdAt": "2021-01-28T09:57:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDkwMTQ0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjQwMzEzOA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r566403138", "bodyText": "Eh.  I'd like to change it everywhere, if I could.  Since it's a String, it doesn't tell the developer anything about what's in it - for all a programmer knows without looking at the implementation it's an ISO date string.  Not a huge issue, just something that could be better.", "author": "AdamBJohnsonx", "createdAt": "2021-01-28T20:59:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDkwMTQ0Mw=="}], "type": "inlineReview"}, {"oid": "a1f79f2c35e4e1b058befc5bdf92f6254704209f", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/a1f79f2c35e4e1b058befc5bdf92f6254704209f", "message": "Update PrimaryRefreshTokenRecord.java", "committedDate": "2021-01-28T09:53:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTk2Mjk0NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r565962944", "bodyText": "@jbzdarkid Hi, I keep your evaluateJavascript here. It should not cause test unstable. I'll try more after this PR merged.", "author": "richard1122", "createdAt": "2021-01-28T10:00:20Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/WebViewAuthorizationFragment.java", "diffHunk": "@@ -138,7 +139,7 @@ public void onPageLoaded() {\n \n                         // Inject the javascript string from testing. This should only be evaluated if we haven't sent\n                         // an auth result already.\n-                        if (mAuthResultSent == false && !StringExtensions.isNullOrBlank(mPostPageLoadedJavascript)) {\n+                        if (!mAuthResultSent && !StringExtensions.isNullOrBlank(mPostPageLoadedJavascript)) {\n                             if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {\n                                 mWebView.evaluateJavascript(mPostPageLoadedJavascript, null);", "originalCommit": "e2053682ece7828b06366616988ce60f0dc1ab7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjM5MTI1OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r566391259", "bodyText": "<3 Thank you, I'm happy to help you with investigation if you need.", "author": "jbzdarkid", "createdAt": "2021-01-28T20:37:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTk2Mjk0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjM5NTM2MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r566395361", "bodyText": "Auth scheme shouldn't apply here -- please confirm this test passes with null as its param as well. This criteria doesn't apply to PRTs", "author": "iambmelt", "createdAt": "2021-01-28T20:45:38Z", "path": "common/src/androidTest/java/com/microsoft/identity/common/SharedPreferencesAccountCredentialCacheTest.java", "diffHunk": "@@ -1466,6 +1469,75 @@ public void getCredentialsNoHomeAccountIdNoTarget() {\n         assertEquals(2, credentials.size());\n     }\n \n+    @Test\n+    public void getCredentialsPRTNoClientId() {\n+        final PrimaryRefreshTokenRecord primaryRefreshToken = new PrimaryRefreshTokenRecord();\n+        primaryRefreshToken.setHomeAccountId(HOME_ACCOUNT_ID);\n+        primaryRefreshToken.setEnvironment(ENVIRONMENT);\n+        primaryRefreshToken.setCredentialType(CredentialType.PrimaryRefreshToken.name().toLowerCase(Locale.US));\n+        primaryRefreshToken.setClientId(CLIENT_ID);\n+        primaryRefreshToken.setSessionKey(SESSION_KEY);\n+\n+        mSharedPreferencesAccountCredentialCache.saveCredential(primaryRefreshToken);\n+\n+        List<Credential> credentials = mSharedPreferencesAccountCredentialCache.getCredentialsFilteredBy(\n+                HOME_ACCOUNT_ID,\n+                ENVIRONMENT,\n+                CredentialType.PrimaryRefreshToken,\n+                null, /* client id */\n+                null,\n+                null,\n+                BEARER_AUTHENTICATION_SCHEME.getName()", "originalCommit": "e2053682ece7828b06366616988ce60f0dc1ab7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NzU2NTI1Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r577565256", "bodyText": "Thanks, deleted.", "author": "richard1122", "createdAt": "2021-02-17T12:19:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjM5NTM2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjM5NTU4OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r566395589", "bodyText": "Same here - scheme should only apply to ATs", "author": "iambmelt", "createdAt": "2021-01-28T20:46:02Z", "path": "common/src/androidTest/java/com/microsoft/identity/common/SharedPreferencesAccountCredentialCacheTest.java", "diffHunk": "@@ -1466,6 +1469,75 @@ public void getCredentialsNoHomeAccountIdNoTarget() {\n         assertEquals(2, credentials.size());\n     }\n \n+    @Test\n+    public void getCredentialsPRTNoClientId() {\n+        final PrimaryRefreshTokenRecord primaryRefreshToken = new PrimaryRefreshTokenRecord();\n+        primaryRefreshToken.setHomeAccountId(HOME_ACCOUNT_ID);\n+        primaryRefreshToken.setEnvironment(ENVIRONMENT);\n+        primaryRefreshToken.setCredentialType(CredentialType.PrimaryRefreshToken.name().toLowerCase(Locale.US));\n+        primaryRefreshToken.setClientId(CLIENT_ID);\n+        primaryRefreshToken.setSessionKey(SESSION_KEY);\n+\n+        mSharedPreferencesAccountCredentialCache.saveCredential(primaryRefreshToken);\n+\n+        List<Credential> credentials = mSharedPreferencesAccountCredentialCache.getCredentialsFilteredBy(\n+                HOME_ACCOUNT_ID,\n+                ENVIRONMENT,\n+                CredentialType.PrimaryRefreshToken,\n+                null, /* client id */\n+                null,\n+                null,\n+                BEARER_AUTHENTICATION_SCHEME.getName()\n+        );\n+        assertEquals(1, credentials.size());\n+    }\n+\n+    @Test\n+    public void getCredentialsPRTClientId() {\n+        final PrimaryRefreshTokenRecord primaryRefreshToken = new PrimaryRefreshTokenRecord();\n+        primaryRefreshToken.setHomeAccountId(HOME_ACCOUNT_ID);\n+        primaryRefreshToken.setEnvironment(ENVIRONMENT);\n+        primaryRefreshToken.setCredentialType(CredentialType.PrimaryRefreshToken.name().toLowerCase(Locale.US));\n+        primaryRefreshToken.setClientId(CLIENT_ID);\n+        primaryRefreshToken.setSessionKey(SESSION_KEY);\n+\n+        mSharedPreferencesAccountCredentialCache.saveCredential(primaryRefreshToken);\n+\n+        List<Credential> credentials = mSharedPreferencesAccountCredentialCache.getCredentialsFilteredBy(\n+                HOME_ACCOUNT_ID,\n+                ENVIRONMENT,\n+                CredentialType.PrimaryRefreshToken,\n+                CLIENT_ID,\n+                null,\n+                null,\n+                BEARER_AUTHENTICATION_SCHEME.getName()", "originalCommit": "e2053682ece7828b06366616988ce60f0dc1ab7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NzU2NTMwOA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r577565308", "bodyText": "Thanks, deleted.", "author": "richard1122", "createdAt": "2021-02-17T12:19:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjM5NTU4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjQwMjQ2Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r566402467", "bodyText": "Let's include the format of this value. I'm guessing it's probably epoch seconds? Would be good to have this info in the javadoc", "author": "iambmelt", "createdAt": "2021-01-28T20:58:37Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/dto/PrimaryRefreshTokenRecord.java", "diffHunk": "@@ -0,0 +1,203 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common.internal.dto;\n+\n+import com.google.gson.annotations.SerializedName;\n+\n+import java.util.Calendar;\n+import java.util.Date;\n+import java.util.concurrent.TimeUnit;\n+\n+import lombok.EqualsAndHashCode;\n+\n+import static com.microsoft.identity.common.internal.dto.PrimaryRefreshTokenRecord.SerializedNames.*;\n+\n+@EqualsAndHashCode(callSuper = true, doNotUseGetters = true)\n+public class PrimaryRefreshTokenRecord extends Credential {\n+\n+    public static class SerializedNames extends Credential.SerializedNames {\n+        /**\n+         * String of family id.\n+         */\n+        public static final String FAMILY_ID = \"family_id\";\n+\n+        /**\n+         * String of session_key.\n+         */\n+        public static final String SESSION_KEY = \"session_key\";\n+\n+        /**\n+         * String of session_key_rolling_date.\n+         */\n+        public static final String SESSION_KEY_ROLLING_DATE = \"session_key_rolling_date\";\n+\n+        /**\n+         * String of prt_protocol_version.\n+         */\n+        public static final String PRT_PROTOCOL_VERSION = \"prt_protocol_version\";\n+    }\n+\n+    /**\n+     * 1st Party Application Family ID.\n+     */\n+    @SerializedName(FAMILY_ID)\n+    private String mFamilyId;\n+\n+    /**\n+     * PRT expiry time.\u202fThis value is returned from the server as refresh_token_expires_in that\n+     * should be added to local time.\n+     */\n+    @SerializedName(EXPIRES_ON)\n+    private String mExpiresOn;\n+\n+    /**\n+     * Session key of PRT.\n+     */\n+    @SerializedName(SESSION_KEY)\n+    private String mSessionKey;\n+\n+    /**\n+     * The version of the PRT Protocol being used, version 3 supports no device_id.\n+     */\n+    @SerializedName(PRT_PROTOCOL_VERSION)\n+    private String mPrtProtocolVersion;\n+\n+    /**\n+     * Session key expiry time.\u202fThis value is determined by the client and set to 60 days after the\n+     * session key was initally issued\n+     */\n+    @SerializedName(SESSION_KEY_ROLLING_DATE)\n+    private String mSessionKeyRollingDate;\n+\n+    /**\n+     * Gets the family_id.\n+     *\n+     * @return The family_id to get.\n+     */\n+    public String getFamilyId() {\n+        return mFamilyId;\n+    }\n+\n+    /**\n+     * Sets the family_id.\n+     *\n+     * @param familyId The family_id to set.\n+     */\n+    public void setFamilyId(final String familyId) {\n+        mFamilyId = familyId;\n+    }\n+\n+    public boolean isExpired(final String expirationTimeEpochSeconds) {\n+        return Long.parseLong(expirationTimeEpochSeconds) * 1000 < System.currentTimeMillis();\n+    }\n+\n+    @Override\n+    public boolean isExpired() {\n+        return isExpired(getExpiresOn());\n+    }\n+\n+    /**\n+     * Gets the expires_on.\n+     * @return The expires_on to get.\n+     */\n+    public String getExpiresOn() {\n+        return mExpiresOn;\n+    }\n+\n+    /**\n+     * Sets the expires_on.\n+     * @param expiresOn The expires_on to set.\n+     */\n+    public void setExpiresOn(String expiresOn) {\n+        mExpiresOn = expiresOn;\n+    }\n+\n+    /**\n+     * Gets the session_key.\n+     * @return The session_key to get.\n+     */\n+    public String getSessionKey() {\n+        return mSessionKey;\n+    }\n+\n+    /**\n+     * Sets the session_key.\n+     *\n+     * @param sessionKey The session_key to set.\n+     */\n+    public void setSessionKey(String sessionKey) {\n+        mSessionKey = sessionKey;\n+    }\n+\n+    /**\n+     * Gets the prt_protocol_version.\n+     *\n+     * @return The prt_protocol_version to get.\n+     */\n+    public String getPrtProtocolVersion() {\n+        return mPrtProtocolVersion;\n+    }\n+\n+    /**\n+     * Sets the prt_protocol_version.\n+     *\n+     * @param prtProtocolVersion The prt_protocol_version to set.\n+     */\n+    public void setPrtProtocolVersion(String prtProtocolVersion) {\n+        mPrtProtocolVersion = prtProtocolVersion;\n+    }\n+\n+    /**\n+     * Gets the session_key_rolling_date.", "originalCommit": "e2053682ece7828b06366616988ce60f0dc1ab7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NzU2NTU1Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r577565552", "bodyText": "Thanks, Comments and format updated.", "author": "richard1122", "createdAt": "2021-02-17T12:19:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjQwMjQ2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjQwMjYwMQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r566402601", "bodyText": "Same here.... format?", "author": "iambmelt", "createdAt": "2021-01-28T20:58:51Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/dto/PrimaryRefreshTokenRecord.java", "diffHunk": "@@ -0,0 +1,203 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common.internal.dto;\n+\n+import com.google.gson.annotations.SerializedName;\n+\n+import java.util.Calendar;\n+import java.util.Date;\n+import java.util.concurrent.TimeUnit;\n+\n+import lombok.EqualsAndHashCode;\n+\n+import static com.microsoft.identity.common.internal.dto.PrimaryRefreshTokenRecord.SerializedNames.*;\n+\n+@EqualsAndHashCode(callSuper = true, doNotUseGetters = true)\n+public class PrimaryRefreshTokenRecord extends Credential {\n+\n+    public static class SerializedNames extends Credential.SerializedNames {\n+        /**\n+         * String of family id.\n+         */\n+        public static final String FAMILY_ID = \"family_id\";\n+\n+        /**\n+         * String of session_key.\n+         */\n+        public static final String SESSION_KEY = \"session_key\";\n+\n+        /**\n+         * String of session_key_rolling_date.\n+         */\n+        public static final String SESSION_KEY_ROLLING_DATE = \"session_key_rolling_date\";\n+\n+        /**\n+         * String of prt_protocol_version.\n+         */\n+        public static final String PRT_PROTOCOL_VERSION = \"prt_protocol_version\";\n+    }\n+\n+    /**\n+     * 1st Party Application Family ID.\n+     */\n+    @SerializedName(FAMILY_ID)\n+    private String mFamilyId;\n+\n+    /**\n+     * PRT expiry time.\u202fThis value is returned from the server as refresh_token_expires_in that\n+     * should be added to local time.\n+     */\n+    @SerializedName(EXPIRES_ON)\n+    private String mExpiresOn;\n+\n+    /**\n+     * Session key of PRT.\n+     */\n+    @SerializedName(SESSION_KEY)\n+    private String mSessionKey;\n+\n+    /**\n+     * The version of the PRT Protocol being used, version 3 supports no device_id.\n+     */\n+    @SerializedName(PRT_PROTOCOL_VERSION)\n+    private String mPrtProtocolVersion;\n+\n+    /**\n+     * Session key expiry time.\u202fThis value is determined by the client and set to 60 days after the\n+     * session key was initally issued\n+     */\n+    @SerializedName(SESSION_KEY_ROLLING_DATE)\n+    private String mSessionKeyRollingDate;\n+\n+    /**\n+     * Gets the family_id.\n+     *\n+     * @return The family_id to get.\n+     */\n+    public String getFamilyId() {\n+        return mFamilyId;\n+    }\n+\n+    /**\n+     * Sets the family_id.\n+     *\n+     * @param familyId The family_id to set.\n+     */\n+    public void setFamilyId(final String familyId) {\n+        mFamilyId = familyId;\n+    }\n+\n+    public boolean isExpired(final String expirationTimeEpochSeconds) {\n+        return Long.parseLong(expirationTimeEpochSeconds) * 1000 < System.currentTimeMillis();\n+    }\n+\n+    @Override\n+    public boolean isExpired() {\n+        return isExpired(getExpiresOn());\n+    }\n+\n+    /**\n+     * Gets the expires_on.\n+     * @return The expires_on to get.\n+     */\n+    public String getExpiresOn() {\n+        return mExpiresOn;\n+    }\n+\n+    /**\n+     * Sets the expires_on.\n+     * @param expiresOn The expires_on to set.\n+     */\n+    public void setExpiresOn(String expiresOn) {\n+        mExpiresOn = expiresOn;\n+    }\n+\n+    /**\n+     * Gets the session_key.\n+     * @return The session_key to get.\n+     */\n+    public String getSessionKey() {\n+        return mSessionKey;\n+    }\n+\n+    /**\n+     * Sets the session_key.\n+     *\n+     * @param sessionKey The session_key to set.\n+     */\n+    public void setSessionKey(String sessionKey) {\n+        mSessionKey = sessionKey;\n+    }\n+\n+    /**\n+     * Gets the prt_protocol_version.\n+     *\n+     * @return The prt_protocol_version to get.\n+     */\n+    public String getPrtProtocolVersion() {\n+        return mPrtProtocolVersion;\n+    }\n+\n+    /**\n+     * Sets the prt_protocol_version.\n+     *\n+     * @param prtProtocolVersion The prt_protocol_version to set.\n+     */\n+    public void setPrtProtocolVersion(String prtProtocolVersion) {\n+        mPrtProtocolVersion = prtProtocolVersion;\n+    }\n+\n+    /**\n+     * Gets the session_key_rolling_date.\n+     *\n+     * @return The session_key_rolling_date to get.\n+     */\n+    public String getSessionKeyRollingDate() {\n+        return mSessionKeyRollingDate;\n+    }\n+\n+    /**\n+     * Sets the session_key_rolling_date.", "originalCommit": "e2053682ece7828b06366616988ce60f0dc1ab7e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjQwMzAxNg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r566403016", "bodyText": "Increasing the patch version?", "author": "iambmelt", "createdAt": "2021-01-28T20:59:35Z", "path": "common/versioning/version.properties", "diffHunk": "@@ -1,4 +1,4 @@\n-#Wed Jan 27 23:18:25 UTC 2021\n-versionName=3.0.9\n+#Mon Jan 27 18:00:00 UTC 2021\n+versionName=3.0.10", "originalCommit": "e2053682ece7828b06366616988ce60f0dc1ab7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NzU2NTcxNA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r577565714", "bodyText": "Updated to 3.1.1", "author": "richard1122", "createdAt": "2021-02-17T12:19:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjQwMzAxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjQwMzMyMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r566403322", "bodyText": "Did we ever close on storing this value elsewhere?\n/cc @AdamBJohnsonx @hieunguyenmsft", "author": "iambmelt", "createdAt": "2021-01-28T21:00:05Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/dto/PrimaryRefreshTokenRecord.java", "diffHunk": "@@ -0,0 +1,203 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common.internal.dto;\n+\n+import com.google.gson.annotations.SerializedName;\n+\n+import java.util.Calendar;\n+import java.util.Date;\n+import java.util.concurrent.TimeUnit;\n+\n+import lombok.EqualsAndHashCode;\n+\n+import static com.microsoft.identity.common.internal.dto.PrimaryRefreshTokenRecord.SerializedNames.*;\n+\n+@EqualsAndHashCode(callSuper = true, doNotUseGetters = true)\n+public class PrimaryRefreshTokenRecord extends Credential {\n+\n+    public static class SerializedNames extends Credential.SerializedNames {\n+        /**\n+         * String of family id.\n+         */\n+        public static final String FAMILY_ID = \"family_id\";\n+\n+        /**\n+         * String of session_key.\n+         */\n+        public static final String SESSION_KEY = \"session_key\";\n+\n+        /**\n+         * String of session_key_rolling_date.\n+         */\n+        public static final String SESSION_KEY_ROLLING_DATE = \"session_key_rolling_date\";\n+\n+        /**\n+         * String of prt_protocol_version.\n+         */\n+        public static final String PRT_PROTOCOL_VERSION = \"prt_protocol_version\";\n+    }\n+\n+    /**\n+     * 1st Party Application Family ID.\n+     */\n+    @SerializedName(FAMILY_ID)\n+    private String mFamilyId;\n+\n+    /**\n+     * PRT expiry time.\u202fThis value is returned from the server as refresh_token_expires_in that\n+     * should be added to local time.\n+     */\n+    @SerializedName(EXPIRES_ON)\n+    private String mExpiresOn;\n+\n+    /**\n+     * Session key of PRT.\n+     */\n+    @SerializedName(SESSION_KEY)\n+    private String mSessionKey;\n+\n+    /**\n+     * The version of the PRT Protocol being used, version 3 supports no device_id.\n+     */\n+    @SerializedName(PRT_PROTOCOL_VERSION)\n+    private String mPrtProtocolVersion;\n+\n+    /**\n+     * Session key expiry time.\u202fThis value is determined by the client and set to 60 days after the\n+     * session key was initally issued\n+     */\n+    @SerializedName(SESSION_KEY_ROLLING_DATE)\n+    private String mSessionKeyRollingDate;\n+\n+    /**\n+     * Gets the family_id.\n+     *\n+     * @return The family_id to get.\n+     */\n+    public String getFamilyId() {\n+        return mFamilyId;\n+    }\n+\n+    /**\n+     * Sets the family_id.\n+     *\n+     * @param familyId The family_id to set.\n+     */\n+    public void setFamilyId(final String familyId) {\n+        mFamilyId = familyId;\n+    }\n+\n+    public boolean isExpired(final String expirationTimeEpochSeconds) {\n+        return Long.parseLong(expirationTimeEpochSeconds) * 1000 < System.currentTimeMillis();\n+    }\n+\n+    @Override\n+    public boolean isExpired() {\n+        return isExpired(getExpiresOn());\n+    }\n+\n+    /**\n+     * Gets the expires_on.\n+     * @return The expires_on to get.\n+     */\n+    public String getExpiresOn() {\n+        return mExpiresOn;\n+    }\n+\n+    /**\n+     * Sets the expires_on.\n+     * @param expiresOn The expires_on to set.\n+     */\n+    public void setExpiresOn(String expiresOn) {\n+        mExpiresOn = expiresOn;\n+    }\n+\n+    /**\n+     * Gets the session_key.\n+     * @return The session_key to get.\n+     */\n+    public String getSessionKey() {", "originalCommit": "e2053682ece7828b06366616988ce60f0dc1ab7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjQwNTEwMQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r566405101", "bodyText": "As far as I'm aware of, no.  We should be able to abstract away whether this is a key or key identifier.", "author": "AdamBJohnsonx", "createdAt": "2021-01-28T21:03:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjQwMzMyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3Nzc4ODY2Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r577788662", "bodyText": "Sorry @iambmelt I missed this notificatio :( In iOS the session_key is stored in keychain storage + in memory.", "author": "hieunguyenmsft", "createdAt": "2021-02-17T17:08:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjQwMzMyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODA3NzU4MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r578077581", "bodyText": "Continuing this discussion below, with @AdamBJohnsonx", "author": "iambmelt", "createdAt": "2021-02-18T02:12:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjQwMzMyMg=="}], "type": "inlineReview"}, {"oid": "a76009aafd4d02b52ad05cc8b07e9cb8165764c5", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/a76009aafd4d02b52ad05cc8b07e9cb8165764c5", "message": "Revert evaluateJavascript", "committedDate": "2021-02-17T12:01:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3Nzk1NTE0MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r577955140", "bodyText": "Can we go ahead and adopt my change to indicate whether this session key value is a literal session key or a key alias by adding a column here that could say this thing?", "author": "AdamBJohnsonx", "createdAt": "2021-02-17T21:25:30Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/dto/PrimaryRefreshTokenRecord.java", "diffHunk": "@@ -0,0 +1,207 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common.internal.dto;\n+\n+import com.google.gson.annotations.SerializedName;\n+\n+import java.util.Calendar;\n+import java.util.Date;\n+import java.util.concurrent.TimeUnit;\n+\n+import lombok.EqualsAndHashCode;\n+\n+import static com.microsoft.identity.common.internal.dto.PrimaryRefreshTokenRecord.SerializedNames.*;\n+\n+@EqualsAndHashCode(callSuper = true, doNotUseGetters = true)\n+public class PrimaryRefreshTokenRecord extends Credential {\n+\n+    public static class SerializedNames extends Credential.SerializedNames {\n+        /**\n+         * String of family id.\n+         */\n+        public static final String FAMILY_ID = \"family_id\";\n+\n+        /**\n+         * String of session_key.\n+         */\n+        public static final String SESSION_KEY = \"session_key\";\n+\n+        /**\n+         * String of session_key_rolling_date.\n+         */\n+        public static final String SESSION_KEY_ROLLING_DATE = \"session_key_rolling_date\";\n+\n+        /**\n+         * String of prt_protocol_version.\n+         */\n+        public static final String PRT_PROTOCOL_VERSION = \"prt_protocol_version\";\n+    }\n+\n+    /**\n+     * 1st Party Application Family ID.\n+     */\n+    @SerializedName(FAMILY_ID)\n+    private String mFamilyId;\n+\n+    /**\n+     * PRT expiry time.\u202fThis value is returned from the server as refresh_token_expires_in that\n+     * should be added to local time. Measured in milliseconds from epoch (1970).\n+     */\n+    @SerializedName(EXPIRES_ON)\n+    private String mExpiresOn;\n+\n+    /**\n+     * Session key of PRT.\n+     */\n+    @SerializedName(SESSION_KEY)\n+    private String mSessionKey;", "originalCommit": "9892c79952ddbbfd2266c1e90c87196349ada101", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3Nzk1NzY3MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r577957670", "bodyText": "It's kind-of less important because the broker should never be able to read this cache and <->.  I'd prefer to handle these keys as an interface that doesn't ever expose the key material to a cavalier user rather than as the key itself, but that detail will be in the cpp code review.", "author": "AdamBJohnsonx", "createdAt": "2021-02-17T21:29:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3Nzk1NTE0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3Nzk2NTM1NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r577965355", "bodyText": "Can we go ahead and adopt my change to indicate whether this session key value is a literal session key or a key alias by adding a column here that could say this thing?\n\n@AdamBJohnsonx @oldalton and I have signed off on this PR, assuming you have no other outstanding design items I am of the impression we can consider this design approved should you want to move forward with it\nhttps://identitydivision.visualstudio.com/DevEx/_git/AuthLibrariesApiReview/pullrequest/2654", "author": "iambmelt", "createdAt": "2021-02-17T21:43:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3Nzk1NTE0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3Nzk3ODQ0NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r577978444", "bodyText": "I've added a sample to the doc as requested", "author": "AdamBJohnsonx", "createdAt": "2021-02-17T22:06:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3Nzk1NTE0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3Nzk4MDIyMQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r577980221", "bodyText": "I don't see anything to add other than that unless somebody wants to hate the name.  I've marked it as complete, then.", "author": "AdamBJohnsonx", "createdAt": "2021-02-17T22:10:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3Nzk1NTE0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODA3ODIzNw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r578078237", "bodyText": "Thanks @AdamBJohnsonx\n@richard1122 Overall your changes LGTM, as Adam is going to be building some of his implementation off of this work, please review his proposal above and determine if it makes sense to include in this work. Apart from this, I am prepared to sign off on this implementation", "author": "iambmelt", "createdAt": "2021-02-18T02:14:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3Nzk1NTE0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODA3OTczNA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1177#discussion_r578079734", "bodyText": "Thanks @iambmelt , @AdamBJohnsonx . I suggest we take the hardware-backed session key into another new PR. Let's discuss in my PR in MSAL-CPP. See if we can move some encryption/decryption methods into commons. (I'd like to open another PR if needed)", "author": "richard1122", "createdAt": "2021-02-18T02:19:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3Nzk1NTE0MA=="}], "type": "inlineReview"}, {"oid": "fcbd6dc893589597cda9c3ef3518484129aa1590", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/fcbd6dc893589597cda9c3ef3518484129aa1590", "message": "Add PRT storage support", "committedDate": "2021-02-18T02:09:22Z", "type": "commit"}, {"oid": "0707e205d2df19eb1e8892b6f1141296d8ceb76b", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/0707e205d2df19eb1e8892b6f1141296d8ceb76b", "message": "Update changelog.txt", "committedDate": "2021-02-18T02:09:48Z", "type": "commit"}, {"oid": "fe0499a1583df8fc2fc9120640020c7ad3e1799f", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/fe0499a1583df8fc2fc9120640020c7ad3e1799f", "message": "Revert EvaluteJavascript", "committedDate": "2021-02-18T02:09:48Z", "type": "commit"}, {"oid": "f3e19560c0058dbe9dba4177fd270464c4d9a0b9", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/f3e19560c0058dbe9dba4177fd270464c4d9a0b9", "message": "Update version, tweak", "committedDate": "2021-02-18T02:09:48Z", "type": "commit"}, {"oid": "d757e5005b34d10283594cc497c9b4e99c12c5ed", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/d757e5005b34d10283594cc497c9b4e99c12c5ed", "message": "Tests update", "committedDate": "2021-02-18T02:09:48Z", "type": "commit"}, {"oid": "261d70c259a5daf93669df0513bcdb1597e1cba9", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/261d70c259a5daf93669df0513bcdb1597e1cba9", "message": "Storage folling up fix", "committedDate": "2021-02-18T02:09:49Z", "type": "commit"}, {"oid": "dc85aed80a9555eab380cb5c75192d9259c2079b", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/dc85aed80a9555eab380cb5c75192d9259c2079b", "message": "Cache key update", "committedDate": "2021-02-18T02:09:49Z", "type": "commit"}, {"oid": "a33b57a75e622f022a5b2be7f715d247acc6d2c2", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/a33b57a75e622f022a5b2be7f715d247acc6d2c2", "message": "Add comments", "committedDate": "2021-02-18T02:09:49Z", "type": "commit"}, {"oid": "eb862611e0d6571fa611f304614daf060861c114", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/eb862611e0d6571fa611f304614daf060861c114", "message": "Add PRT cache key tests", "committedDate": "2021-02-18T02:09:49Z", "type": "commit"}, {"oid": "e1a5d8f216f0386a9d3a72d8a9900ec5f24f6b4f", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/e1a5d8f216f0386a9d3a72d8a9900ec5f24f6b4f", "message": "Follow PRT docs", "committedDate": "2021-02-18T02:09:49Z", "type": "commit"}, {"oid": "175c1d3afe9244470dc85cce42c8ed224267444a", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/175c1d3afe9244470dc85cce42c8ed224267444a", "message": "Add family_id back", "committedDate": "2021-02-18T02:09:49Z", "type": "commit"}, {"oid": "afffbdb0cd4655e54b628fef08484e7fe68ff25f", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/afffbdb0cd4655e54b628fef08484e7fe68ff25f", "message": "Typo", "committedDate": "2021-02-18T02:09:50Z", "type": "commit"}, {"oid": "a4cba035e2ab047c8ce195339cf0d758e42548d1", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/a4cba035e2ab047c8ce195339cf0d758e42548d1", "message": "Filter PRT without client id", "committedDate": "2021-02-18T02:09:50Z", "type": "commit"}, {"oid": "4a307d420da8e088e33c38a8850fce1051ba1eea", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/4a307d420da8e088e33c38a8850fce1051ba1eea", "message": "Move mustMatchOnClientId logic", "committedDate": "2021-02-18T02:09:50Z", "type": "commit"}, {"oid": "d3c97fb6116d2fbd809b5dd2f563b6517c31b6d2", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/d3c97fb6116d2fbd809b5dd2f563b6517c31b6d2", "message": "Delete REALM from PRT record", "committedDate": "2021-02-18T02:09:50Z", "type": "commit"}, {"oid": "1c1e6e52d9d757194ade62418f2b4f19e8cff2a4", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/1c1e6e52d9d757194ade62418f2b4f19e8cff2a4", "message": "Use real client id for cache key", "committedDate": "2021-02-18T02:09:50Z", "type": "commit"}, {"oid": "41d253ec937ef7e70f2ba55ef1c5781f571cf4f6", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/41d253ec937ef7e70f2ba55ef1c5781f571cf4f6", "message": "Update PrimaryRefreshTokenRecord.java", "committedDate": "2021-02-18T02:09:51Z", "type": "commit"}, {"oid": "a880cf8b4f7cad0850920706680e62c6d1833ecd", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/a880cf8b4f7cad0850920706680e62c6d1833ecd", "message": "Revert evaluateJavascript", "committedDate": "2021-02-18T02:09:51Z", "type": "commit"}, {"oid": "d2391b5fbcb33eb62fb5865b1b0e46e294b47d5b", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/d2391b5fbcb33eb62fb5865b1b0e46e294b47d5b", "message": "Comments, tests, version update", "committedDate": "2021-02-18T02:10:23Z", "type": "commit"}, {"oid": "d2391b5fbcb33eb62fb5865b1b0e46e294b47d5b", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/d2391b5fbcb33eb62fb5865b1b0e46e294b47d5b", "message": "Comments, tests, version update", "committedDate": "2021-02-18T02:10:23Z", "type": "forcePushed"}]}