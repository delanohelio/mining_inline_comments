{"pr_number": 1158, "pr_title": "Update deprecated HttpRequest.sendGet to use new HttpClient - Closes #1038", "pr_createdAt": "2020-12-11T14:23:41Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158", "timeline": [{"oid": "0e767a3c6a1ae90306ffb4ec1e784264d7ddb432", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/0e767a3c6a1ae90306ffb4ec1e784264d7ddb432", "message": "Update usage of deprecated HttpRequest.sendGet\n\nFixes #1038", "committedDate": "2020-12-11T16:57:26Z", "type": "commit"}, {"oid": "ffc5bf9ecb2247be2e49c80116946c07bda4d7f6", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/ffc5bf9ecb2247be2e49c80116946c07bda4d7f6", "message": "Update changelog.txt", "committedDate": "2020-12-11T16:57:51Z", "type": "commit"}, {"oid": "8eac46d67be5498dc248a4bec6bda6894061c685", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/8eac46d67be5498dc248a4bec6bda6894061c685", "message": "Update formatting", "committedDate": "2020-12-11T16:57:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5MjA4OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541092089", "bodyText": "on 1 line?", "author": "AdamBJohnsonx", "createdAt": "2020-12-11T17:01:27Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/azureactivedirectory/AzureActiveDirectory.java", "diffHunk": "@@ -179,13 +181,12 @@ public static synchronized void performCloudDiscovery() throws IOException {\n                 .appendQueryParameter(AUTHORIZATION_ENDPOINT, AUTHORIZATION_ENDPOINT_VALUE)\n                 .build();\n \n-        Map<String, String> headers = new HashMap<>();\n+        final UrlConnectionHttpClient httpClient = UrlConnectionHttpClient.getDefaultInstance();\n \n-        // Suppressing deprecation warnings due to the deprecated method HttpRequest.sendGet(). Raised issue https://github.com/AzureAD/microsoft-authentication-library-common-for-android/issues/1038\n-        @SuppressWarnings(WarningType.deprecation_warning)\n-        HttpResponse response = HttpRequest.sendGet(\n-                new URL(instanceDiscoveryRequestUri.toString()),\n-                headers\n+        final Map<String, String> headers = new HashMap<>();\n+\n+        final HttpResponse response = httpClient.get(\n+                new URL(instanceDiscoveryRequestUri.toString()), headers", "originalCommit": "8eac46d67be5498dc248a4bec6bda6894061c685", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5MzYxMw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541093613", "bodyText": "I've updated. Thanks.", "author": "gitaumoses4", "createdAt": "2020-12-11T17:04:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5MjA4OQ=="}], "type": "inlineReview"}, {"oid": "397793f2d323cc70e362b3991025e9d820808314", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/397793f2d323cc70e362b3991025e9d820808314", "message": "Update formatting", "committedDate": "2020-12-11T17:01:59Z", "type": "forcePushed"}, {"oid": "63531c4b9697f63f7f24c1662466d1fccc2c3da3", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/63531c4b9697f63f7f24c1662466d1fccc2c3da3", "message": "Update formatting", "committedDate": "2020-12-11T17:03:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5Mzk5MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541093990", "bodyText": "This can be a field.", "author": "AdamBJohnsonx", "createdAt": "2020-12-11T17:04:36Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/azureactivedirectory/AzureActiveDirectory.java", "diffHunk": "@@ -179,14 +181,11 @@ public static synchronized void performCloudDiscovery() throws IOException {\n                 .appendQueryParameter(AUTHORIZATION_ENDPOINT, AUTHORIZATION_ENDPOINT_VALUE)\n                 .build();\n \n-        Map<String, String> headers = new HashMap<>();\n+        final UrlConnectionHttpClient httpClient = UrlConnectionHttpClient.getDefaultInstance();", "originalCommit": "63531c4b9697f63f7f24c1662466d1fccc2c3da3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5Njk0OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541096948", "bodyText": "Oh yes, that's right.", "author": "gitaumoses4", "createdAt": "2020-12-11T17:09:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5Mzk5MA=="}], "type": "inlineReview"}, {"oid": "32b1f52456e836f19bb3d0151385bb7394e52775", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/32b1f52456e836f19bb3d0151385bb7394e52775", "message": "Update formatting", "committedDate": "2020-12-11T17:08:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5ODY2MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541098660", "bodyText": "If we don't do anything with the header reference, can we just pass a new HashMap to the get call?", "author": "AdamBJohnsonx", "createdAt": "2020-12-11T17:12:12Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/OpenIdProviderConfigurationClient.java", "diffHunk": "@@ -139,9 +141,9 @@ public synchronized OpenIdProviderConfiguration loadOpenIdProviderConfiguration(\n                     \"Using request URL: \" + configUrl\n             );\n \n-            // Suppressing deprecation warnings due to the deprecated method HttpRequest.sendGet(). Raised issue https://github.com/AzureAD/microsoft-authentication-library-common-for-android/issues/1038\n-            @SuppressWarnings(WarningType.deprecation_warning)\n-            final HttpResponse providerConfigResponse = HttpRequest.sendGet(configUrl, new HashMap<String, String>());\n+            final Map<String, String> headers = new HashMap<>();\n+\n+            final HttpResponse providerConfigResponse = httpClient.get(configUrl, headers);", "originalCommit": "32b1f52456e836f19bb3d0151385bb7394e52775", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5OTEyNg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541099126", "bodyText": "ditto comment about inlining the header reference.", "author": "AdamBJohnsonx", "createdAt": "2020-12-11T17:12:53Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/azureactivedirectory/AzureActiveDirectory.java", "diffHunk": "@@ -179,14 +182,9 @@ public static synchronized void performCloudDiscovery() throws IOException {\n                 .appendQueryParameter(AUTHORIZATION_ENDPOINT, AUTHORIZATION_ENDPOINT_VALUE)\n                 .build();\n \n-        Map<String, String> headers = new HashMap<>();\n+        final Map<String, String> headers = new HashMap<>();\n \n-        // Suppressing deprecation warnings due to the deprecated method HttpRequest.sendGet(). Raised issue https://github.com/AzureAD/microsoft-authentication-library-common-for-android/issues/1038\n-        @SuppressWarnings(WarningType.deprecation_warning)\n-        HttpResponse response = HttpRequest.sendGet(\n-                new URL(instanceDiscoveryRequestUri.toString()),\n-                headers\n-        );\n+        final HttpResponse response = httpClient.get(new URL(instanceDiscoveryRequestUri.toString()), headers);", "originalCommit": "32b1f52456e836f19bb3d0151385bb7394e52775", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5OTQ4NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541099484", "bodyText": "Can this just be an HttpClient?", "author": "AdamBJohnsonx", "createdAt": "2020-12-11T17:13:32Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/azureactivedirectory/AzureActiveDirectory.java", "diffHunk": "@@ -72,6 +74,7 @@\n     private static ConcurrentMap<String, AzureActiveDirectoryCloud> sAadClouds = new ConcurrentHashMap<>();\n     private static boolean sIsInitialized = false;\n     private static Environment sEnvironment = Environment.Production;\n+    private static final UrlConnectionHttpClient httpClient = UrlConnectionHttpClient.getDefaultInstance();", "originalCommit": "32b1f52456e836f19bb3d0151385bb7394e52775", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5OTcwMA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541099700", "bodyText": "Can this type just be HttpClient?", "author": "AdamBJohnsonx", "createdAt": "2020-12-11T17:13:51Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/OpenIdProviderConfigurationClient.java", "diffHunk": "@@ -54,6 +55,7 @@\n     private static final String sWellKnownConfig = \"/.well-known/openid-configuration\";\n     private static final ExecutorService sBackgroundExecutor = Executors.newCachedThreadPool();\n     private static final Map<URL, OpenIdProviderConfiguration> sConfigCache = new HashMap<>();\n+    private static final UrlConnectionHttpClient httpClient = UrlConnectionHttpClient.getDefaultInstance();", "originalCommit": "32b1f52456e836f19bb3d0151385bb7394e52775", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTEwMDM0MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541100341", "bodyText": "Oh yes, thanks for this.", "author": "gitaumoses4", "createdAt": "2020-12-11T17:14:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5OTcwMA=="}], "type": "inlineReview"}, {"oid": "44addd132da6029d9343b5333938f9b478c64c40", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/44addd132da6029d9343b5333938f9b478c64c40", "message": "Update formatting", "committedDate": "2020-12-11T17:21:19Z", "type": "commit"}, {"oid": "44addd132da6029d9343b5333938f9b478c64c40", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/44addd132da6029d9343b5333938f9b478c64c40", "message": "Update formatting", "committedDate": "2020-12-11T17:21:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTExMzg3Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541113876", "bodyText": "We should set some parameters here - how many writers do we expect for this CHM?", "author": "AdamBJohnsonx", "createdAt": "2020-12-11T17:37:09Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/azureactivedirectory/AzureActiveDirectory.java", "diffHunk": "@@ -72,6 +74,7 @@\n     private static ConcurrentMap<String, AzureActiveDirectoryCloud> sAadClouds = new ConcurrentHashMap<>();", "originalCommit": "44addd132da6029d9343b5333938f9b478c64c40", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTExNTczNQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541115735", "bodyText": "I'm not following. Kindly elaborate, what's CHM?", "author": "gitaumoses4", "createdAt": "2020-12-11T17:40:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTExMzg3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTExODM2MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541118360", "bodyText": "ConcurrentHashMap.  By default, there are 16 shards here in the map, but if we only respect a single writer to this map, we don't need them.  the standard initialization parameters would be (16, 0.75f, 16) - We could take (16, 0.75f, 1) if we don't expect a lot of concurrent writes.", "author": "AdamBJohnsonx", "createdAt": "2020-12-11T17:44:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTExMzg3Ng=="}], "type": "inlineReview"}]}