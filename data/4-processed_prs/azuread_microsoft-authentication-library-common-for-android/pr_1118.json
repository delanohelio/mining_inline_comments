{"pr_number": 1118, "pr_title": "Adding config to publish uiautomation utilities", "pr_createdAt": "2020-11-09T19:50:12Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1118", "timeline": [{"oid": "8a6405175f3bf9c3fd59a2f7fa7f2f4e951326a7", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/8a6405175f3bf9c3fd59a2f7fa7f2f4e951326a7", "message": "Adding config to publish uiautomation utilities", "committedDate": "2020-11-09T19:48:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4NjA1OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1118#discussion_r520086058", "bodyText": "should we supply this as a function?", "author": "AdamBJohnsonx", "createdAt": "2020-11-09T20:02:48Z", "path": "uiautomationutilities/build.gradle", "diffHunk": "@@ -44,14 +53,78 @@ android {\n \n }\n \n+\n+task sourcesJar(type: Jar) {\n+    from android.sourceSets.main.java.srcDirs\n+}\n+\n+tasks.whenTaskAdded { task ->\n+    if (task.name == 'assembleDebug' || task.name == 'assembleRelease') {\n+        task.dependsOn 'sourcesJar'\n+    }\n+}\n+\n+project.afterEvaluate{\n+    publishing {\n+        publications {\n+            aar(MavenPublication) {\n+                artifact sourcesJar\n+                groupId 'com.microsoft.identity'\n+                artifactId = 'uiautomationutilities'\n+                version = getAppVersionName()\n+\n+                pom.withXml {\n+\n+                    // Dependencies\n+                    def dependenciesNode = asNode().appendNode('dependencies')\n+\n+                    //Iterate over the implementation dependencies (we don't want the test ones), adding a <dependency> node for each\n+                    configurations.implementation.allDependencies.each {\n+                        if (it.group != null && it.name != null) {\n+                            def dependencyNode = dependenciesNode.appendNode('dependency')\n+                            if(it.group == 's'){\n+                                dependencyNode.appendNode('groupId', groupId)\n+                            }else{\n+                                dependencyNode.appendNode('groupId', it.group)\n+                            }", "originalCommit": "8a6405175f3bf9c3fd59a2f7fa7f2f4e951326a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDIyMDg5Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1118#discussion_r520220897", "bodyText": "Going to see if I can resolve this in a different way.", "author": "shoatman", "createdAt": "2020-11-10T01:08:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4NjA1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4NzY0OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1118#discussion_r520087648", "bodyText": "I'm not sure what this comment means?", "author": "shahzaibj", "createdAt": "2020-11-09T20:05:55Z", "path": "uiautomationutilities/build.gradle", "diffHunk": "@@ -44,14 +53,78 @@ android {\n \n }\n \n+\n+task sourcesJar(type: Jar) {\n+    from android.sourceSets.main.java.srcDirs\n+}\n+\n+tasks.whenTaskAdded { task ->\n+    if (task.name == 'assembleDebug' || task.name == 'assembleRelease') {\n+        task.dependsOn 'sourcesJar'\n+    }\n+}\n+\n+project.afterEvaluate{\n+    publishing {\n+        publications {\n+            aar(MavenPublication) {\n+                artifact sourcesJar\n+                groupId 'com.microsoft.identity'\n+                artifactId = 'uiautomationutilities'\n+                version = getAppVersionName()\n+\n+                pom.withXml {\n+\n+                    // Dependencies\n+                    def dependenciesNode = asNode().appendNode('dependencies')\n+\n+                    //Iterate over the implementation dependencies (we don't want the test ones), adding a <dependency> node for each\n+                    configurations.implementation.allDependencies.each {\n+                        if (it.group != null && it.name != null) {\n+                            def dependencyNode = dependenciesNode.appendNode('dependency')\n+                            if(it.group == 's'){\n+                                dependencyNode.appendNode('groupId', groupId)\n+                            }else{\n+                                dependencyNode.appendNode('groupId', it.group)\n+                            }\n+                            dependencyNode.appendNode('artifactId', it.name)\n+                            dependencyNode.appendNode('version', it.version)\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n+        repositories {\n+            maven {\n+                name \"vsts-maven-adal-android\"\n+                url \"https://identitydivision.pkgs.visualstudio.com/_packaging/AndroidADAL/maven/v1\"\n+                credentials {\n+                    username project.ext.vstsUsername\n+                    password project.ext.vstsPassword\n+                }\n+            }\n+        }\n+    }\n+}\n+\n dependencies {\n     implementation fileTree(dir: 'libs', include: ['*.jar'])\n     implementation \"androidx.appcompat:appcompat:$rootProject.ext.appCompatVersion\"\n     implementation 'junit:junit:4.13'\n     implementation \"androidx.test.uiautomator:uiautomator:$rootProject.ext.uiAutomatorVersion\"\n     implementation \"androidx.test:monitor:$rootProject.ext.androidxTestMonitorVersion\"\n     implementation \"androidx.test:core:$rootProject.ext.androidxTestCoreVersion\"\n-    implementation project(':testutils')\n+    // keyvault per product flavor", "originalCommit": "8a6405175f3bf9c3fd59a2f7fa7f2f4e951326a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDIyMDk3NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1118#discussion_r520220974", "bodyText": "Yep.  Copy pasta", "author": "shoatman", "createdAt": "2020-11-10T01:08:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4NzY0OA=="}], "type": "inlineReview"}, {"oid": "597624c0c8266f92c010885a695471000401ddce", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/597624c0c8266f92c010885a695471000401ddce", "message": "Feedback and adding root project name for common.  Root project name because group id during publishing", "committedDate": "2020-11-10T01:37:53Z", "type": "commit"}, {"oid": "a7b529179176905f9d14d13388333e7233036c88", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/a7b529179176905f9d14d13388333e7233036c88", "message": "Merge branch 'dev' into shoatman/publish-uitautomationutilities", "committedDate": "2020-11-10T01:39:16Z", "type": "commit"}, {"oid": "4132eed8f3fa7d5959939f59b0d60cd28f4262c7", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/4132eed8f3fa7d5959939f59b0d60cd28f4262c7", "message": "Merge branch 'dev' into shoatman/publish-uitautomationutilities", "committedDate": "2020-11-10T01:46:09Z", "type": "commit"}]}