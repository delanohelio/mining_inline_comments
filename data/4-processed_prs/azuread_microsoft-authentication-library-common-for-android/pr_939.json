{"pr_number": 939, "pr_title": "Add UI Test Utilities for B2C", "pr_createdAt": "2020-06-22T17:14:58Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939", "timeline": [{"oid": "ccd3765f8d70a2ed27501c1a071954e8d025d0ec", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/ccd3765f8d70a2ed27501c1a071954e8d025d0ec", "message": "Add prompt handlers for B2C", "committedDate": "2020-06-19T23:47:18Z", "type": "commit"}, {"oid": "4a2d860a79120effff08e0fc58cef3dccb958c88", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/4a2d860a79120effff08e0fc58cef3dccb958c88", "message": "Add javadoc to new B2C test utility classes", "committedDate": "2020-06-22T17:12:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzcxODQwNA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r443718404", "bodyText": "Is there a reason that these are not anonymous implementations created via static methods? i.e. B2CProvider.local(), etc.", "author": "AdamBJohnsonx", "createdAt": "2020-06-22T17:31:28Z", "path": "uiautomationutilities/src/main/java/com/microsoft/identity/client/ui/automation/interaction/b2c/B2CProvider.java", "diffHunk": "@@ -0,0 +1,96 @@\n+//  Copyright (c) Microsoft Corporation.\n+//  All rights reserved.\n+//\n+//  This code is licensed under the MIT License.\n+//\n+//  Permission is hereby granted, free of charge, to any person obtaining a copy\n+//  of this software and associated documentation files(the \"Software\"), to deal\n+//  in the Software without restriction, including without limitation the rights\n+//  to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+//  copies of the Software, and to permit persons to whom the Software is\n+//  furnished to do so, subject to the following conditions :\n+//\n+//  The above copyright notice and this permission notice shall be included in\n+//  all copies or substantial portions of the Software.\n+//\n+//  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+//  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+//  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+//  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+//  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+//  THE SOFTWARE.\n+package com.microsoft.identity.client.ui.automation.interaction.b2c;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.microsoft.identity.internal.testutils.labutils.LabConstants;\n+\n+import lombok.Getter;\n+\n+/**\n+ * A class modeling a B2C Provider that is being used during a B2C UI Test\n+ */\n+@Getter\n+public abstract class B2CProvider {\n+\n+    @NonNull\n+    private String providerName;\n+\n+    @Nullable // should be null for LOCAL B2C provider\n+    private String idpSelectionBtnResourceId;\n+\n+    @Nullable // should be null for LOCAL B2C provider\n+    private String domainHint; // this can be used as query param to /authorize endpoint\n+\n+    public B2CProvider(@NonNull final String providerName,\n+                       @Nullable final String idpSelectionBtnResourceId,\n+                       @Nullable final String domainHint) {\n+        this.providerName = providerName;\n+        this.idpSelectionBtnResourceId = idpSelectionBtnResourceId;\n+        this.domainHint = domainHint;\n+    }\n+\n+    /**\n+     * Indicates if the B2C Provider is a non-local IdP\n+     *\n+     * @return a boolean indicating if B2C Provider is an external IdP\n+     */\n+    protected boolean isExternalIdp() {\n+        return !(this instanceof Local);\n+    }\n+\n+    public static class Local extends B2CProvider {", "originalCommit": "4a2d860a79120effff08e0fc58cef3dccb958c88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzczMzUyOA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r443733528", "bodyText": "Actually, looking at #1074, would this be better as an enumeration?", "author": "AdamBJohnsonx", "createdAt": "2020-06-22T17:59:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzcxODQwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI1NDkzMA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r445254930", "bodyText": "I need them to be classes as I've put data on them", "author": "shahzaibj", "createdAt": "2020-06-25T01:14:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzcxODQwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI1OTgyNQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r445259825", "bodyText": "I don't follow.  Do you mutate the data post-construction?", "author": "AdamBJohnsonx", "createdAt": "2020-06-25T01:33:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzcxODQwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM4MDkzOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r446380939", "bodyText": "Changed to enum here: ccb06be", "author": "shahzaibj", "createdAt": "2020-06-26T19:53:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzcxODQwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzcyMzE3MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r443723171", "bodyText": "Why not just override the method for the LOCAL implementation and have it return true otherwise?", "author": "AdamBJohnsonx", "createdAt": "2020-06-22T17:40:37Z", "path": "uiautomationutilities/src/main/java/com/microsoft/identity/client/ui/automation/interaction/b2c/B2CProvider.java", "diffHunk": "@@ -0,0 +1,96 @@\n+//  Copyright (c) Microsoft Corporation.\n+//  All rights reserved.\n+//\n+//  This code is licensed under the MIT License.\n+//\n+//  Permission is hereby granted, free of charge, to any person obtaining a copy\n+//  of this software and associated documentation files(the \"Software\"), to deal\n+//  in the Software without restriction, including without limitation the rights\n+//  to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+//  copies of the Software, and to permit persons to whom the Software is\n+//  furnished to do so, subject to the following conditions :\n+//\n+//  The above copyright notice and this permission notice shall be included in\n+//  all copies or substantial portions of the Software.\n+//\n+//  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+//  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+//  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+//  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+//  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+//  THE SOFTWARE.\n+package com.microsoft.identity.client.ui.automation.interaction.b2c;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.microsoft.identity.internal.testutils.labutils.LabConstants;\n+\n+import lombok.Getter;\n+\n+/**\n+ * A class modeling a B2C Provider that is being used during a B2C UI Test\n+ */\n+@Getter\n+public abstract class B2CProvider {\n+\n+    @NonNull\n+    private String providerName;\n+\n+    @Nullable // should be null for LOCAL B2C provider\n+    private String idpSelectionBtnResourceId;\n+\n+    @Nullable // should be null for LOCAL B2C provider\n+    private String domainHint; // this can be used as query param to /authorize endpoint\n+\n+    public B2CProvider(@NonNull final String providerName,\n+                       @Nullable final String idpSelectionBtnResourceId,\n+                       @Nullable final String domainHint) {\n+        this.providerName = providerName;\n+        this.idpSelectionBtnResourceId = idpSelectionBtnResourceId;\n+        this.domainHint = domainHint;\n+    }\n+\n+    /**\n+     * Indicates if the B2C Provider is a non-local IdP\n+     *\n+     * @return a boolean indicating if B2C Provider is an external IdP\n+     */\n+    protected boolean isExternalIdp() {\n+        return !(this instanceof Local);", "originalCommit": "4a2d860a79120effff08e0fc58cef3dccb958c88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM4MDcyMw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r446380723", "bodyText": "Removed the method completely as not really needed", "author": "shahzaibj", "createdAt": "2020-06-26T19:53:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzcyMzE3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzcyNzIyMQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r443727221", "bodyText": "|| ?", "author": "AdamBJohnsonx", "createdAt": "2020-06-22T17:48:07Z", "path": "uiautomationutilities/src/main/java/com/microsoft/identity/client/ui/automation/interaction/b2c/IdLabB2cSisoPolicyPromptHandler.java", "diffHunk": "@@ -0,0 +1,79 @@\n+//  Copyright (c) Microsoft Corporation.\n+//  All rights reserved.\n+//\n+//  This code is licensed under the MIT License.\n+//\n+//  Permission is hereby granted, free of charge, to any person obtaining a copy\n+//  of this software and associated documentation files(the \"Software\"), to deal\n+//  in the Software without restriction, including without limitation the rights\n+//  to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+//  copies of the Software, and to permit persons to whom the Software is\n+//  furnished to do so, subject to the following conditions :\n+//\n+//  The above copyright notice and this permission notice shall be included in\n+//  all copies or substantial portions of the Software.\n+//\n+//  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+//  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+//  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+//  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+//  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+//  THE SOFTWARE.\n+package com.microsoft.identity.client.ui.automation.interaction.b2c;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.microsoft.identity.client.ui.automation.interaction.AadLoginComponentHandler;\n+import com.microsoft.identity.client.ui.automation.interaction.AbstractPromptHandler;\n+import com.microsoft.identity.client.ui.automation.interaction.ILoginComponentHandler;\n+import com.microsoft.identity.client.ui.automation.utils.UiAutomatorUtils;\n+import com.microsoft.identity.internal.testutils.labutils.LabConstants;\n+\n+/**\n+ * A Prompt handler for MSIDLAB B2C SISO Policy\n+ */\n+public class IdLabB2cSisoPolicyPromptHandler extends AbstractPromptHandler {\n+\n+    public IdLabB2cSisoPolicyPromptHandler(@NonNull final B2CPromptHandlerParameters parameters) {\n+        super(getAppropriateLoginComponentHandler(parameters), parameters);\n+    }\n+\n+    @Override\n+    public void handlePrompt(@NonNull final String username, @NonNull final String password) {\n+        final B2CPromptHandlerParameters b2CPromptHandlerParameters =\n+                (B2CPromptHandlerParameters) parameters;\n+\n+        final B2CProvider b2CProvider = b2CPromptHandlerParameters.getB2cProvider();\n+\n+        if (b2CProvider.isExternalIdp()) {\n+            assert b2CProvider.getIdpSelectionBtnResourceId() != null;\n+            UiAutomatorUtils.handleButtonClick(b2CProvider.getIdpSelectionBtnResourceId());\n+        }\n+\n+        if (!b2CProvider.isExternalIdp() && !parameters.isLoginHintProvided()) {\n+            loginComponentHandler.handleEmailField(username);\n+        } else if (b2CProvider.isExternalIdp() && !parameters.isSessionExpected()) {\n+            loginComponentHandler.handleEmailField(username);\n+        }", "originalCommit": "4a2d860a79120effff08e0fc58cef3dccb958c88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI1NTAzMQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r445255031", "bodyText": "It needs to be an && (at least for this policy)", "author": "shahzaibj", "createdAt": "2020-06-25T01:15:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzcyNzIyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI1ODkyOA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r445258928", "bodyText": "What I was saying here was:\nif((!b2CProvider.isExternalIdp() && !parameters.isLoginHintProvided()) ||\n(b2CProvider.isExternalIdp() && !parameters.isSessionExpected())) {\nloginComponentHandler.handleEmailField(username);\n}", "author": "AdamBJohnsonx", "createdAt": "2020-06-25T01:29:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzcyNzIyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM4MTkwOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r446381909", "bodyText": "Addressed here: 87dcc74", "author": "shahzaibj", "createdAt": "2020-06-26T19:56:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzcyNzIyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4MzY0MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r443883641", "bodyText": "should this be called explicitly?", "author": "rpdome", "createdAt": "2020-06-22T23:46:07Z", "path": "uiautomationutilities/src/main/java/com/microsoft/identity/client/ui/automation/interaction/b2c/B2CIdLabLocalLoginComponentHandler.java", "diffHunk": "@@ -0,0 +1,80 @@\n+//  Copyright (c) Microsoft Corporation.\n+//  All rights reserved.\n+//\n+//  This code is licensed under the MIT License.\n+//\n+//  Permission is hereby granted, free of charge, to any person obtaining a copy\n+//  of this software and associated documentation files(the \"Software\"), to deal\n+//  in the Software without restriction, including without limitation the rights\n+//  to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+//  copies of the Software, and to permit persons to whom the Software is\n+//  furnished to do so, subject to the following conditions :\n+//\n+//  The above copyright notice and this permission notice shall be included in\n+//  all copies or substantial portions of the Software.\n+//\n+//  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+//  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+//  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+//  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+//  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+//  THE SOFTWARE.\n+package com.microsoft.identity.client.ui.automation.interaction.b2c;\n+\n+import androidx.annotation.NonNull;\n+import androidx.test.uiautomator.UiObject;\n+\n+import com.microsoft.identity.client.ui.automation.interaction.ILoginComponentHandler;\n+import com.microsoft.identity.client.ui.automation.utils.UiAutomatorUtils;\n+\n+/**\n+ * A login component handler for B2C Local IdP\n+ */\n+public class B2CIdLabLocalLoginComponentHandler implements ILoginComponentHandler {\n+\n+    @Override\n+    public void handleEmailField(@NonNull final String username) {\n+        UiAutomatorUtils.handleInput(\"logonIdentifier\", username);\n+    }\n+\n+    @Override\n+    public void handlePasswordField(@NonNull final String password) {\n+        UiAutomatorUtils.handleInput(\"password\", password);\n+        handleNextButton();", "originalCommit": "4a2d860a79120effff08e0fc58cef3dccb958c88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI1NTMwMw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r445255303", "bodyText": "It doesn't have to be, but I've done it in this way so the caller doesn't have to decide if they need to handle next btn or not depending on the IdP. The caller just needs to handle the email / password fields.", "author": "shahzaibj", "createdAt": "2020-06-25T01:16:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4MzY0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4NzM2Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r443887362", "bodyText": "nit: suggest renaming to MSA (an internal term for outlook/hotmail/live account).", "author": "rpdome", "createdAt": "2020-06-22T23:59:05Z", "path": "uiautomationutilities/src/main/java/com/microsoft/identity/client/ui/automation/interaction/b2c/B2CProvider.java", "diffHunk": "@@ -0,0 +1,96 @@\n+//  Copyright (c) Microsoft Corporation.\n+//  All rights reserved.\n+//\n+//  This code is licensed under the MIT License.\n+//\n+//  Permission is hereby granted, free of charge, to any person obtaining a copy\n+//  of this software and associated documentation files(the \"Software\"), to deal\n+//  in the Software without restriction, including without limitation the rights\n+//  to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+//  copies of the Software, and to permit persons to whom the Software is\n+//  furnished to do so, subject to the following conditions :\n+//\n+//  The above copyright notice and this permission notice shall be included in\n+//  all copies or substantial portions of the Software.\n+//\n+//  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+//  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+//  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+//  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+//  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+//  THE SOFTWARE.\n+package com.microsoft.identity.client.ui.automation.interaction.b2c;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.microsoft.identity.internal.testutils.labutils.LabConstants;\n+\n+import lombok.Getter;\n+\n+/**\n+ * A class modeling a B2C Provider that is being used during a B2C UI Test\n+ */\n+@Getter\n+public abstract class B2CProvider {\n+\n+    @NonNull\n+    private String providerName;\n+\n+    @Nullable // should be null for LOCAL B2C provider\n+    private String idpSelectionBtnResourceId;\n+\n+    @Nullable // should be null for LOCAL B2C provider\n+    private String domainHint; // this can be used as query param to /authorize endpoint\n+\n+    public B2CProvider(@NonNull final String providerName,\n+                       @Nullable final String idpSelectionBtnResourceId,\n+                       @Nullable final String domainHint) {\n+        this.providerName = providerName;\n+        this.idpSelectionBtnResourceId = idpSelectionBtnResourceId;\n+        this.domainHint = domainHint;\n+    }\n+\n+    /**\n+     * Indicates if the B2C Provider is a non-local IdP\n+     *\n+     * @return a boolean indicating if B2C Provider is an external IdP\n+     */\n+    protected boolean isExternalIdp() {\n+        return !(this instanceof Local);\n+    }\n+\n+    public static class Local extends B2CProvider {\n+        public Local() {\n+            super(LabConstants.B2CProvider.LOCAL, null, null);\n+        }\n+    }\n+\n+    public static class Google extends B2CProvider {\n+        public Google() {\n+            super(LabConstants.B2CProvider.GOOGLE,\n+                    \"GoogleExchange\",\n+                    \"google.com\"\n+            );\n+        }\n+    }\n+\n+    public static class Facebook extends B2CProvider {\n+        public Facebook() {\n+            super(LabConstants.B2CProvider.FACEBOOK,\n+                    \"FacebookExchange\",\n+                    \"facebook.com\"\n+            );\n+        }\n+    }\n+\n+    public static class Microsoft extends B2CProvider {", "originalCommit": "4a2d860a79120effff08e0fc58cef3dccb958c88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI1NTU5NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r445255594", "bodyText": "I'm using the same name that is provided by the LAB API (so it easier to keep track of the mapping)", "author": "shahzaibj", "createdAt": "2020-06-25T01:17:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4NzM2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4OTEyNA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r443889124", "bodyText": "should 62-71 be a function in UiAutomatorUtils? (That takes in a class type and label)", "author": "rpdome", "createdAt": "2020-06-23T00:04:55Z", "path": "uiautomationutilities/src/main/java/com/microsoft/identity/client/ui/automation/interaction/b2c/FacebookLoginComponentHandler.java", "diffHunk": "@@ -0,0 +1,101 @@\n+//  Copyright (c) Microsoft Corporation.\n+//  All rights reserved.\n+//\n+//  This code is licensed under the MIT License.\n+//\n+//  Permission is hereby granted, free of charge, to any person obtaining a copy\n+//  of this software and associated documentation files(the \"Software\"), to deal\n+//  in the Software without restriction, including without limitation the rights\n+//  to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+//  copies of the Software, and to permit persons to whom the Software is\n+//  furnished to do so, subject to the following conditions :\n+//\n+//  The above copyright notice and this permission notice shall be included in\n+//  all copies or substantial portions of the Software.\n+//\n+//  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+//  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+//  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+//  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+//  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+//  THE SOFTWARE.\n+package com.microsoft.identity.client.ui.automation.interaction.b2c;\n+\n+import android.widget.Button;\n+\n+import androidx.annotation.NonNull;\n+import androidx.test.platform.app.InstrumentationRegistry;\n+import androidx.test.uiautomator.UiDevice;\n+import androidx.test.uiautomator.UiObject;\n+import androidx.test.uiautomator.UiObjectNotFoundException;\n+import androidx.test.uiautomator.UiSelector;\n+\n+import com.microsoft.identity.client.ui.automation.interaction.ILoginComponentHandler;\n+import com.microsoft.identity.client.ui.automation.utils.UiAutomatorUtils;\n+\n+import org.junit.Assert;\n+\n+/**\n+ * A login component handler for Facebook IdP\n+ */\n+public class FacebookLoginComponentHandler implements ILoginComponentHandler {\n+\n+    @Override\n+    public void handleEmailField(@NonNull final String username) {\n+        UiAutomatorUtils.handleInput(\"m_login_email\", username);\n+    }\n+\n+    @Override\n+    public void handlePasswordField(@NonNull final String password) {\n+        UiAutomatorUtils.handleInput(\"m_login_password\", password);\n+        handleNextButton();\n+    }\n+\n+    @Override\n+    public void handleBackButton() {\n+        UiAutomatorUtils.pressBack();\n+    }\n+\n+    @Override\n+    public void handleNextButton() {\n+        final UiDevice device = UiDevice.getInstance(InstrumentationRegistry.getInstrumentation());", "originalCommit": "4a2d860a79120effff08e0fc58cef3dccb958c88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI1ODY4NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r445258685", "bodyText": "Okay, I've simplified it a bit and moved most of the logic to UiAutomatorUtils", "author": "shahzaibj", "createdAt": "2020-06-25T01:29:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4OTEyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4OTcyMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r443889722", "bodyText": "why do we have to do 51-58 here (but we don't have to in FB's case?)", "author": "rpdome", "createdAt": "2020-06-23T00:07:05Z", "path": "uiautomationutilities/src/main/java/com/microsoft/identity/client/ui/automation/interaction/b2c/GoogleLoginComponentHandler.java", "diffHunk": "@@ -0,0 +1,108 @@\n+//  Copyright (c) Microsoft Corporation.\n+//  All rights reserved.\n+//\n+//  This code is licensed under the MIT License.\n+//\n+//  Permission is hereby granted, free of charge, to any person obtaining a copy\n+//  of this software and associated documentation files(the \"Software\"), to deal\n+//  in the Software without restriction, including without limitation the rights\n+//  to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+//  copies of the Software, and to permit persons to whom the Software is\n+//  furnished to do so, subject to the following conditions :\n+//\n+//  The above copyright notice and this permission notice shall be included in\n+//  all copies or substantial portions of the Software.\n+//\n+//  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+//  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+//  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+//  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+//  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+//  THE SOFTWARE.\n+package com.microsoft.identity.client.ui.automation.interaction.b2c;\n+\n+import android.widget.EditText;\n+\n+import androidx.annotation.NonNull;\n+import androidx.test.uiautomator.UiObject;\n+import androidx.test.uiautomator.UiObjectNotFoundException;\n+import androidx.test.uiautomator.UiSelector;\n+\n+import com.microsoft.identity.client.ui.automation.interaction.ILoginComponentHandler;\n+import com.microsoft.identity.client.ui.automation.utils.UiAutomatorUtils;\n+\n+import org.junit.Assert;\n+\n+/**\n+ * A login component handler for Google IdP\n+ */\n+public class GoogleLoginComponentHandler implements ILoginComponentHandler {\n+\n+    @Override\n+    public void handleEmailField(@NonNull final String username) {\n+        UiAutomatorUtils.handleInput(\"identifierId\", username);\n+        handleNextButton();\n+    }\n+\n+    @Override\n+    public void handlePasswordField(@NonNull final String password) {\n+        UiAutomatorUtils.handleInput(\"password\", password);\n+        final UiObject passwordBox = UiAutomatorUtils.obtainUiObjectWithResourceId(\"password\");", "originalCommit": "4a2d860a79120effff08e0fc58cef3dccb958c88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI1NjMwOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r445256309", "bodyText": "FB, thankfully declared a resource id for each of the edit text fields, however, google didn't. In this case, Google instead has a resource id assigned to parent outer level password box that contains a label for the inner password edit text field. The actual inner edit text field doesn't contain any resource id....hence we need to do this logic to find the actual element for the password field.", "author": "shahzaibj", "createdAt": "2020-06-25T01:19:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4OTcyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzkwMTc1OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r443901758", "bodyText": "These messages need to say Google instead of Local", "author": "shahzaibj", "createdAt": "2020-06-23T00:52:46Z", "path": "uiautomationutilities/src/main/java/com/microsoft/identity/client/ui/automation/interaction/b2c/GoogleLoginComponentHandler.java", "diffHunk": "@@ -0,0 +1,108 @@\n+//  Copyright (c) Microsoft Corporation.\n+//  All rights reserved.\n+//\n+//  This code is licensed under the MIT License.\n+//\n+//  Permission is hereby granted, free of charge, to any person obtaining a copy\n+//  of this software and associated documentation files(the \"Software\"), to deal\n+//  in the Software without restriction, including without limitation the rights\n+//  to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+//  copies of the Software, and to permit persons to whom the Software is\n+//  furnished to do so, subject to the following conditions :\n+//\n+//  The above copyright notice and this permission notice shall be included in\n+//  all copies or substantial portions of the Software.\n+//\n+//  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+//  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+//  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+//  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+//  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+//  THE SOFTWARE.\n+package com.microsoft.identity.client.ui.automation.interaction.b2c;\n+\n+import android.widget.EditText;\n+\n+import androidx.annotation.NonNull;\n+import androidx.test.uiautomator.UiObject;\n+import androidx.test.uiautomator.UiObjectNotFoundException;\n+import androidx.test.uiautomator.UiSelector;\n+\n+import com.microsoft.identity.client.ui.automation.interaction.ILoginComponentHandler;\n+import com.microsoft.identity.client.ui.automation.utils.UiAutomatorUtils;\n+\n+import org.junit.Assert;\n+\n+/**\n+ * A login component handler for Google IdP\n+ */\n+public class GoogleLoginComponentHandler implements ILoginComponentHandler {\n+\n+    @Override\n+    public void handleEmailField(@NonNull final String username) {\n+        UiAutomatorUtils.handleInput(\"identifierId\", username);\n+        handleNextButton();\n+    }\n+\n+    @Override\n+    public void handlePasswordField(@NonNull final String password) {\n+        UiAutomatorUtils.handleInput(\"password\", password);\n+        final UiObject passwordBox = UiAutomatorUtils.obtainUiObjectWithResourceId(\"password\");\n+\n+        try {\n+            final UiObject passwordInput = passwordBox.getChild(\n+                    new UiSelector().className(EditText.class)\n+            );\n+\n+            passwordInput.setText(password);\n+        } catch (UiObjectNotFoundException e) {\n+            Assert.fail(e.getMessage());\n+        }\n+\n+        handleNextButton();\n+    }\n+\n+    @Override\n+    public void handleBackButton() {\n+        UiAutomatorUtils.pressBack();\n+    }\n+\n+    @Override\n+    public void handleNextButton() {\n+        final UiObject nextBtn = UiAutomatorUtils.obtainUiObjectWithText(\"Next\");\n+        try {\n+            nextBtn.click();\n+        } catch (UiObjectNotFoundException e) {\n+            Assert.fail(e.getMessage());\n+        }\n+    }\n+\n+    @Override\n+    public void handleAccountPicker(@NonNull final String username) {\n+        throw new UnsupportedOperationException(\"Not supported for B2C Local Provider\");\n+    }\n+\n+    private UiObject getConsentScreen() {\n+        return UiAutomatorUtils.obtainUiObjectWithResourceId(\"consentHeader\");\n+    }\n+\n+    @Override\n+    public void confirmConsentPageReceived() {\n+        throw new UnsupportedOperationException(\"Not supported for B2C Local Provider\");\n+    }\n+\n+    @Override\n+    public void acceptConsent() {\n+        throw new UnsupportedOperationException(\"Not supported for B2C Local Provider\");\n+    }\n+\n+    public void declineConsent() {\n+        throw new UnsupportedOperationException(\"Not supported for B2C Local Provider\");\n+    }\n+\n+    @Override\n+    public void handleSpeedBump() {\n+        throw new UnsupportedOperationException(\"Not supported for B2C Local Provider\");\n+    }\n+}", "originalCommit": "4a2d860a79120effff08e0fc58cef3dccb958c88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI1ODQ1OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r445258458", "bodyText": "Could they be in an abstract class that calls into an abstract getName() method so we don't have to write it in every case?", "author": "AdamBJohnsonx", "createdAt": "2020-06-25T01:28:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzkwMTc1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM4MTUyNg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r446381526", "bodyText": "Addressed here: 8d08d26", "author": "shahzaibj", "createdAt": "2020-06-26T19:55:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzkwMTc1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzkwMTgzMA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r443901830", "bodyText": "These messages need to say Facebook instead of Local", "author": "shahzaibj", "createdAt": "2020-06-23T00:53:02Z", "path": "uiautomationutilities/src/main/java/com/microsoft/identity/client/ui/automation/interaction/b2c/FacebookLoginComponentHandler.java", "diffHunk": "@@ -0,0 +1,101 @@\n+//  Copyright (c) Microsoft Corporation.\n+//  All rights reserved.\n+//\n+//  This code is licensed under the MIT License.\n+//\n+//  Permission is hereby granted, free of charge, to any person obtaining a copy\n+//  of this software and associated documentation files(the \"Software\"), to deal\n+//  in the Software without restriction, including without limitation the rights\n+//  to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+//  copies of the Software, and to permit persons to whom the Software is\n+//  furnished to do so, subject to the following conditions :\n+//\n+//  The above copyright notice and this permission notice shall be included in\n+//  all copies or substantial portions of the Software.\n+//\n+//  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+//  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+//  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+//  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+//  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+//  THE SOFTWARE.\n+package com.microsoft.identity.client.ui.automation.interaction.b2c;\n+\n+import android.widget.Button;\n+\n+import androidx.annotation.NonNull;\n+import androidx.test.platform.app.InstrumentationRegistry;\n+import androidx.test.uiautomator.UiDevice;\n+import androidx.test.uiautomator.UiObject;\n+import androidx.test.uiautomator.UiObjectNotFoundException;\n+import androidx.test.uiautomator.UiSelector;\n+\n+import com.microsoft.identity.client.ui.automation.interaction.ILoginComponentHandler;\n+import com.microsoft.identity.client.ui.automation.utils.UiAutomatorUtils;\n+\n+import org.junit.Assert;\n+\n+/**\n+ * A login component handler for Facebook IdP\n+ */\n+public class FacebookLoginComponentHandler implements ILoginComponentHandler {\n+\n+    @Override\n+    public void handleEmailField(@NonNull final String username) {\n+        UiAutomatorUtils.handleInput(\"m_login_email\", username);\n+    }\n+\n+    @Override\n+    public void handlePasswordField(@NonNull final String password) {\n+        UiAutomatorUtils.handleInput(\"m_login_password\", password);\n+        handleNextButton();\n+    }\n+\n+    @Override\n+    public void handleBackButton() {\n+        UiAutomatorUtils.pressBack();\n+    }\n+\n+    @Override\n+    public void handleNextButton() {\n+        final UiDevice device = UiDevice.getInstance(InstrumentationRegistry.getInstrumentation());\n+        final UiObject nextBtn = device.findObject(\n+                new UiSelector().className(Button.class).text(\"Log In\")\n+        );\n+\n+        try {\n+            nextBtn.click();\n+        } catch (UiObjectNotFoundException e) {\n+            Assert.fail(e.getMessage());\n+        }\n+    }\n+\n+    @Override\n+    public void handleAccountPicker(@NonNull final String username) {\n+        throw new UnsupportedOperationException(\"Not supported for B2C Local Provider\");\n+    }\n+\n+    private UiObject getConsentScreen() {\n+        return UiAutomatorUtils.obtainUiObjectWithResourceId(\"consentHeader\");\n+    }\n+\n+    @Override\n+    public void confirmConsentPageReceived() {\n+        throw new UnsupportedOperationException(\"Not supported for B2C Local Provider\");\n+    }\n+\n+    @Override\n+    public void acceptConsent() {\n+        throw new UnsupportedOperationException(\"Not supported for B2C Local Provider\");\n+    }\n+\n+    public void declineConsent() {\n+        throw new UnsupportedOperationException(\"Not supported for B2C Local Provider\");\n+    }\n+\n+    @Override\n+    public void handleSpeedBump() {\n+        throw new UnsupportedOperationException(\"Not supported for B2C Local Provider\");\n+    }\n+}", "originalCommit": "4a2d860a79120effff08e0fc58cef3dccb958c88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM4MTY2OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/939#discussion_r446381668", "bodyText": "Addressed here: 8d08d26", "author": "shahzaibj", "createdAt": "2020-06-26T19:55:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzkwMTgzMA=="}], "type": "inlineReview"}, {"oid": "337f4444f0ae357a94fb6dc839f7907a5d6589ae", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/337f4444f0ae357a94fb6dc839f7907a5d6589ae", "message": "Address comments", "committedDate": "2020-06-25T01:28:22Z", "type": "commit"}, {"oid": "87dcc7432872aa5b19ce4d88d395c9c28f79a591", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/87dcc7432872aa5b19ce4d88d395c9c28f79a591", "message": "Address comment\n\nUse or instead of if else", "committedDate": "2020-06-25T22:10:23Z", "type": "commit"}, {"oid": "ccb06beca76861d363c1502e7c2cb7270737775f", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/ccb06beca76861d363c1502e7c2cb7270737775f", "message": "Convert B2C Provider to enum", "committedDate": "2020-06-26T19:35:17Z", "type": "commit"}, {"oid": "8d08d2646d79e6e2d044a047b4ec44b2ba9f8f6c", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/8d08d2646d79e6e2d044a047b4ec44b2ba9f8f6c", "message": "Create abstract b2c login component handler", "committedDate": "2020-06-26T19:54:54Z", "type": "commit"}, {"oid": "c557fe0b4cd105fff82e9e15c60752b2dce8bbdd", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/c557fe0b4cd105fff82e9e15c60752b2dce8bbdd", "message": "Merge branch 'dev' into shahzaibj/b2c-test-ui-handler", "committedDate": "2020-06-26T20:02:41Z", "type": "commit"}]}