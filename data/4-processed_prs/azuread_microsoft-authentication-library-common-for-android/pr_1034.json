{"pr_number": 1034, "pr_title": "Adding Enum of MSALCPP in SdkType", "pr_createdAt": "2020-09-14T22:40:34Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034", "timeline": [{"oid": "f3dde5379d7e5b9ecdbbefdff641debf506ebbaa", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/f3dde5379d7e5b9ecdbbefdff641debf506ebbaa", "message": "Adding Enum of MSALCPP in SdkType\n\nAdding Enum of MSALCPP in SdkType, to help defferentiate between MSAL and MSALCPP.\n\nAnother aspect is to remove teh dependency on Device.java, for teh purpose of using dynamic x-client-SKU and x-client-Ver Values, which are to be passed around from CommandParameter and BrokerRequest", "committedDate": "2020-09-14T22:39:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODI4NDM5NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r488284394", "bodyText": "Move this to Authentication Constants", "author": "kreedula", "createdAt": "2020-09-14T23:00:06Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/request/SdkType.java", "diffHunk": "@@ -27,5 +27,19 @@\n  */\n public enum SdkType {\n     ADAL,\n-    MSAL\n+    MSAL,\n+    MSALCPP;\n+\n+    private final String PRODUCT_NAME_MSAL = \"MSAL.Android\";\n+\n+    private final String PRODUCT_NAME_MSAL_CPP = \"MSAL.xplat.Android\";", "originalCommit": "f3dde5379d7e5b9ecdbbefdff641debf506ebbaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3ODgxMw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r488878813", "bodyText": "45fba56", "author": "tanmaymanolkar1", "createdAt": "2020-09-15T18:31:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODI4NDM5NA=="}], "type": "inlineReview"}, {"oid": "45fba567fbf3c42c2a50bb4229b00b969db134b4", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/45fba567fbf3c42c2a50bb4229b00b969db134b4", "message": "updating the location of constants", "committedDate": "2020-09-15T00:16:01Z", "type": "commit"}, {"oid": "d7bc007a81c32056b501cb8b9e5c9a99c223c630", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/d7bc007a81c32056b501cb8b9e5c9a99c223c630", "message": "Update BaseController.java to fix the bug addressing chossing ADAL sdktype", "committedDate": "2020-09-15T00:48:45Z", "type": "commit"}, {"oid": "1ea47df09466297a1c30de9a0654d31d5dc14043", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/1ea47df09466297a1c30de9a0654d31d5dc14043", "message": "Added metadata to Diagnostic Context and replacing Device.java call locations", "committedDate": "2020-09-16T21:58:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4MDAxNg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r489780016", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    final static String CLIENT_SDKTYPE = \"client_sdktype\";\n          \n          \n            \n                    final static String CLIENT_SDK_TYPE = \"client_sdk_type\";", "author": "shahzaibj", "createdAt": "2020-09-16T22:03:58Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/broker/BrokerRequest.java", "diffHunk": "@@ -53,6 +54,7 @@\n         final static String CLIENT_APP_NAME = \"client_app_name\";\n         final static String CLIENT_APP_VERSION = \"client_app_version\";\n         final static String CLIENT_VERSION = \"client_version\";\n+        final static String CLIENT_SDKTYPE = \"client_sdktype\";", "originalCommit": "1ea47df09466297a1c30de9a0654d31d5dc14043", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc3MDg5MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r494770890", "bodyText": "798ca9f", "author": "tanmaymanolkar1", "createdAt": "2020-09-25T06:20:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4MDAxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4MDU0NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r489780544", "bodyText": "Do we actually need to send this to the Broker? IIRC, MSAL / ADAL we don't need to send it based on the current design around adapters. Perhaps it is need for CPP?", "author": "shahzaibj", "createdAt": "2020-09-16T22:05:20Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/broker/BrokerRequest.java", "diffHunk": "@@ -53,6 +54,7 @@\n         final static String CLIENT_APP_NAME = \"client_app_name\";\n         final static String CLIENT_APP_VERSION = \"client_app_version\";\n         final static String CLIENT_VERSION = \"client_version\";\n+        final static String CLIENT_SDKTYPE = \"client_sdktype\";", "originalCommit": "1ea47df09466297a1c30de9a0654d31d5dc14043", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4MTk3MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r489781970", "bodyText": "Yes it is need for CPP.", "author": "tanmaymanolkar1", "createdAt": "2020-09-16T22:09:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4MDU0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4MjM5Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r489782393", "bodyText": "It wasn't sent initially because Android.MSAL value was being hardcoded on the receiving end.", "author": "tanmaymanolkar1", "createdAt": "2020-09-16T22:10:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4MDU0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4MjYyNw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r489782627", "bodyText": "Can you share CPP model for sending/unpacking broker request? Are they not using (custom) adapters?", "author": "shahzaibj", "createdAt": "2020-09-16T22:10:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4MDU0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc5NzQ1Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r489797456", "bodyText": "@shahzaibj  CPP will need to set SdkType as MSALCPP here and version too. Tanmay should make the changes there after this.\nbroker request will send this to broker (it will be MSAL or MSALCPP based on the library)", "author": "kreedula", "createdAt": "2020-09-16T22:53:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4MDU0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTgwMTc3OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r489801778", "bodyText": "@kreedula I'm looking for the code where Broker will unpack the BrokerRequest that was sent to it via MSALCPP.\nIn broker, we currently have the IBrokerRequestAdapter, and we have implementations of it for ADAL/MSAL, but I don't see one for MSALCPP. Which adapter does MSALCPP use?", "author": "shahzaibj", "createdAt": "2020-09-16T23:07:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4MDU0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTgwNDQ2Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r489804467", "bodyText": "it's the same format , i.e. common sends the request to broker . MSAL CPP just uses BrokerMSALController\" to call acquireTokenoracquireTokenSilent`", "author": "kreedula", "createdAt": "2020-09-16T23:15:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4MDU0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4MTM2OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r489781369", "bodyText": "What's being attached to DiagnosticContext here? As far as I can see nothing.....and I think this method could easily stay inside Device.java. Is there a specific reason for moving it here?", "author": "shahzaibj", "createdAt": "2020-09-16T22:07:25Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/logging/DiagnosticContext.java", "diffHunk": "@@ -85,4 +94,30 @@ private static boolean hasThreadId() {\n     public static void clear() {\n         REQUEST_CONTEXT_THREAD_LOCAL.remove();\n     }\n+\n+    /**\n+     * Function previously resided in Device.java, contains Constants\n+     * Attaching the constants to Diagnostic Context, for the purpose of having them in one place.", "originalCommit": "1ea47df09466297a1c30de9a0654d31d5dc14043", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4NTMyMw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r489785323", "bodyText": "There could be some more code optimizations done, and having all the constants in a single place would help. It would be then easier to have these constants accessible from a single place. Hence setting it up for the later use. @kreedula anything I missed?", "author": "tanmaymanolkar1", "createdAt": "2020-09-16T22:18:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4MTM2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc5NTQwOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r489795409", "bodyText": "Well I would like to keep all of it in Device.java and use it in DiagonisticContext to put all the parameters inside this. And later , you get the map from DiagnosticContext.", "author": "kreedula", "createdAt": "2020-09-16T22:47:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4MTM2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4MTc1NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r489781754", "bodyText": "Add new line at end of file", "author": "shahzaibj", "createdAt": "2020-09-16T22:08:29Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/request/SdkType.java", "diffHunk": "@@ -22,10 +22,24 @@\n // THE SOFTWARE.\n package com.microsoft.identity.common.internal.request;\n \n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\n+\n /**\n  * Enum to indicate if the request came from an app hosting Adal or Msal Sdk\n  */\n public enum SdkType {\n     ADAL,\n-    MSAL\n+    MSAL,\n+    MSALCPP;\n+\n+\n+\n+    public String getProductName() {\n+        if ((SdkType.ADAL == this) || (SdkType.MSAL == this)) {\n+            return AuthenticationConstants.SdkPlatformFields.PRODUCT_NAME_MSAL;\n+        } else {\n+            return AuthenticationConstants.SdkPlatformFields.PRODUCT_NAME_MSAL_CPP;\n+        }\n+\n+    }\n }", "originalCommit": "1ea47df09466297a1c30de9a0654d31d5dc14043", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc3MTQ4Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r494771482", "bodyText": "798ca9f", "author": "tanmaymanolkar1", "createdAt": "2020-09-25T06:22:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc4MTc1NA=="}], "type": "inlineReview"}, {"oid": "3e90fb46a9f42762e4b37ea69ec5ef3c6d8ac6d0", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/3e90fb46a9f42762e4b37ea69ec5ef3c6d8ac6d0", "message": "Merge branch 'dev' into tamanolk/adding-new-enum-type-of-MSALCPP", "committedDate": "2020-09-16T22:26:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc5NTk0MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r489795941", "bodyText": "headers.put(AuthenticationConstants.SdkPlatformFields.PRODUCT, DiagnosticContext.getRequestContext().get(AuthenticationConstants.SdkPlatformFields.PRODUCT));\nheaders.put(AuthenticationConstants.SdkPlatformFields.VERSION,DiagnosticContext.getRequestContext().get(AuthenticationConstants.SdkPlatformFields.VERSION));\nthese can be part of DiagnosticContext.getPlatformIdParameters() as well right , why adding it seperately", "author": "kreedula", "createdAt": "2020-09-16T22:49:01Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/OAuth2Strategy.java", "diffHunk": "@@ -182,11 +182,13 @@ protected HttpResponse performTokenRequest(final GenericTokenRequest request) th\n         if (request instanceof MicrosoftTokenRequest &&\n                 !TextUtils.isEmpty(((MicrosoftTokenRequest) request).getBrokerVersion())) {\n             headers.put(\n-                    Device.PlatformIdParameters.BROKER_VERSION,\n+                    AuthenticationConstants.PlatformIdParameters.BROKER_VERSION,\n                     ((MicrosoftTokenRequest) request).getBrokerVersion()\n             );\n         }\n-        headers.putAll(Device.getPlatformIdParameters());\n+        headers.putAll(DiagnosticContext.getPlatformIdParameters());\n+        headers.put(AuthenticationConstants.SdkPlatformFields.PRODUCT, DiagnosticContext.getRequestContext().get(AuthenticationConstants.SdkPlatformFields.PRODUCT));", "originalCommit": "1ea47df09466297a1c30de9a0654d31d5dc14043", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc5NjA1MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r489796050", "bodyText": "same comment as below", "author": "kreedula", "createdAt": "2020-09-16T22:49:21Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/microsoftsts/MicrosoftStsOAuth2Strategy.java", "diffHunk": "@@ -468,7 +464,9 @@ private HttpResponse performPKeyAuthRequest(\n         final String requestBody = ObjectMapper.serializeObjectToFormUrlEncoded(request);\n         final Map<String, String> headers = new TreeMap<>();\n         headers.put(\"client-request-id\", DiagnosticContext.getRequestContext().get(DiagnosticContext.CORRELATION_ID));\n-        headers.putAll(Device.getPlatformIdParameters());\n+        headers.putAll(DiagnosticContext.getPlatformIdParameters());\n+        headers.put(AuthenticationConstants.SdkPlatformFields.PRODUCT, DiagnosticContext.getRequestContext().get(AuthenticationConstants.SdkPlatformFields.PRODUCT));\n+        headers.put(AuthenticationConstants.SdkPlatformFields.VERSION,DiagnosticContext.getRequestContext().get(AuthenticationConstants.SdkPlatformFields.VERSION));", "originalCommit": "1ea47df09466297a1c30de9a0654d31d5dc14043", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ccc740b9f38b51d5be20fa2759bb91cb43df855a", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/ccc740b9f38b51d5be20fa2759bb91cb43df855a", "message": "Merge branch 'dev' into tamanolk/adding-new-enum-type-of-MSALCPP", "committedDate": "2020-09-25T06:16:11Z", "type": "commit"}, {"oid": "798ca9f7d8e3a969707905150533c290ff12eb97", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/798ca9f7d8e3a969707905150533c290ff12eb97", "message": "Undone device.java and updated with mentioned changes", "committedDate": "2020-09-25T06:17:40Z", "type": "commit"}, {"oid": "c42255e20357b9faecf68962af2ddebfe43e2ab1", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/c42255e20357b9faecf68962af2ddebfe43e2ab1", "message": "Undone device.java and updated with mentioned changes", "committedDate": "2020-09-29T01:07:50Z", "type": "forcePushed"}, {"oid": "670ebe717b98ccdfdcd42551e0e567b871cea762", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/670ebe717b98ccdfdcd42551e0e567b871cea762", "message": "Adding Enum of MSALCPP in SdkType\n\nAdding Enum of MSALCPP in SdkType, to help defferentiate between MSAL and MSALCPP.\n\nAnother aspect is to remove teh dependency on Device.java, for teh purpose of using dynamic x-client-SKU and x-client-Ver Values, which are to be passed around from CommandParameter and BrokerRequest", "committedDate": "2020-10-01T19:19:21Z", "type": "commit"}, {"oid": "335c130751dab63b1400e5620b12dbc2a5ab1d01", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/335c130751dab63b1400e5620b12dbc2a5ab1d01", "message": "updating the location of constants", "committedDate": "2020-10-01T19:19:21Z", "type": "commit"}, {"oid": "10251fde275d76c91506c61ea2ca721c5f2486b0", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/10251fde275d76c91506c61ea2ca721c5f2486b0", "message": "Update BaseController.java to fix the bug addressing chossing ADAL sdktype", "committedDate": "2020-10-01T19:19:21Z", "type": "commit"}, {"oid": "6df0c88e26681dde4c13acc02ea78fb8202aaaf5", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/6df0c88e26681dde4c13acc02ea78fb8202aaaf5", "message": "Added metadata to Diagnostic Context and replacing Device.java call locations", "committedDate": "2020-10-01T19:27:43Z", "type": "commit"}, {"oid": "55eca58b39298fe9e971d2f189da8a4fd22df413", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/55eca58b39298fe9e971d2f189da8a4fd22df413", "message": "Undone device.java and updated with mentioned changes", "committedDate": "2020-10-01T19:27:49Z", "type": "commit"}, {"oid": "4d1946ad0683feb36c1959a804b883222919ee5e", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/4d1946ad0683feb36c1959a804b883222919ee5e", "message": "Fixing git conflicts", "committedDate": "2020-10-01T19:27:49Z", "type": "commit"}, {"oid": "fa9137d083b3edb33bf32b26e4e11606a5ff773b", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/fa9137d083b3edb33bf32b26e4e11606a5ff773b", "message": "adding a new line at EOF", "committedDate": "2020-10-01T19:27:49Z", "type": "commit"}, {"oid": "fa9137d083b3edb33bf32b26e4e11606a5ff773b", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/fa9137d083b3edb33bf32b26e4e11606a5ff773b", "message": "adding a new line at EOF", "committedDate": "2020-10-01T19:27:49Z", "type": "forcePushed"}, {"oid": "be7e733abef844cf748587e829b998ff7de5a316", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/be7e733abef844cf748587e829b998ff7de5a316", "message": "Updating AuthenticationConstants.java", "committedDate": "2020-10-01T19:44:56Z", "type": "commit"}, {"oid": "16bf052bb4bff67c98af8344cd10733af0d30f3b", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/16bf052bb4bff67c98af8344cd10733af0d30f3b", "message": "Merge branch 'dev' into tamanolk/adding-new-enum-type-of-MSALCPP", "committedDate": "2020-10-01T21:46:52Z", "type": "commit"}, {"oid": "bdedb49a296db9f46e9dc73f7e0ffb41ce52caca", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/bdedb49a296db9f46e9dc73f7e0ffb41ce52caca", "message": "Updating the branch and teh submodule", "committedDate": "2020-10-01T23:31:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM5ODU2OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r496398569", "bodyText": "you can actually put this in the enum itself, since each of them is a class underneath.  Give the whole thing either an abstract method or a method returning whatever we're agreeing on for \"I don't know what this is that's calling me\" and then override it as appropriate for each of the values in your enumeration, and you'll be done, with no crazy branches.", "author": "AdamBJohnsonx", "createdAt": "2020-09-29T04:54:55Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/request/SdkType.java", "diffHunk": "@@ -22,10 +22,24 @@\n // THE SOFTWARE.\n package com.microsoft.identity.common.internal.request;\n \n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\n+\n /**\n  * Enum to indicate if the request came from an app hosting Adal or Msal Sdk\n  */\n public enum SdkType {\n     ADAL,\n-    MSAL\n-}\n\\ No newline at end of file\n+    MSAL,\n+    MSALCPP;\n+\n+\n+\n+    public String getProductName() {\n+        if ((SdkType.ADAL == this) || (SdkType.MSAL == this)) {\n+            return AuthenticationConstants.SdkPlatformFields.PRODUCT_NAME_MSAL;\n+        } else {\n+            return AuthenticationConstants.SdkPlatformFields.PRODUCT_NAME_MSAL_CPP;\n+        }\n+\n+    }", "originalCommit": "77ef07157bf5e5b62df64f1e6d3e4736dad2cf83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5ODYzNw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r499098637", "bodyText": "Same comment mentioned applies here as well, since we are hardcoding the values in every request, there isnt a way where we could encounter any funny values, and hence only the values used in the enum would be considered for getProductName.", "author": "tanmaymanolkar1", "createdAt": "2020-10-03T00:41:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM5ODU2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ3NTE5MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r500475190", "bodyText": "This enumeration looks like it exists on the interface between broker and MSAL - is that correct?", "author": "AdamBJohnsonx", "createdAt": "2020-10-06T17:31:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM5ODU2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ4MzExOA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r500483118", "bodyText": "This means that at some point this exists as a series of bytes in IPC.  You do not know what is going to land on the other side, since it can be newer or older than what you expect.  We're going to decouple this layer in the broker to allow for us to pivot the serialization mechanisms more smoothly, but this means that there will be cases where you will not be able to put the SDKType into a bucket with which you are familiar. What will you do in that case?", "author": "AdamBJohnsonx", "createdAt": "2020-10-06T17:45:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM5ODU2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY2ODI1Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r500668256", "bodyText": "@AdamBJohnsonx In this case, this wont be a blocker since, for the mentioned cases :\n\n\nnew MSAL - old broker : the old broker wont have the sdktype and even if the new MSAL sends the new sdktype (msal.cpp) the broker will neglect it and use the hardcoded value of sdktype (msal)\n\n\nold msal - new broker : since old msal wont be sending the sdktype, the new broker has a default value of selecting msal as sdktype.\n\n\nold msal - old broker : working fine\n\n\nnew msal - new broker : working fine\n\n\nI am going to be testing these e2e scenarios just to make sure, we see the flow we are expecting to see, I would post the results here.", "author": "tanmaymanolkar1", "createdAt": "2020-10-07T00:23:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM5ODU2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE1Mjc4NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r501152785", "bodyText": "Why is it OK if the old broker cannot accurately report the sdk type?", "author": "AdamBJohnsonx", "createdAt": "2020-10-07T16:34:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM5ODU2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE4NTgxNA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r501185814", "bodyText": "Since the old broker is already deployed and is in production(the current implementation) is using the common which uses the hardcoded value? I mean to say, this added new functionality wont break the functionality of the broker versions already in the market today not having this change.", "author": "tanmaymanolkar1", "createdAt": "2020-10-07T17:26:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM5ODU2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM5MDE5Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r501390197", "bodyText": "Let's just make sure that having the divergence won't crash the broker in the event of an either-way-mismatch, and you're good to go after that.  We'll take on making this forwards-compatible for the next SDK addition later, and revisit any parameter that's similarly dangerous.", "author": "AdamBJohnsonx", "createdAt": "2020-10-08T00:53:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM5ODU2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM5ODkwNA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r496398904", "bodyText": "space after comma?", "author": "AdamBJohnsonx", "createdAt": "2020-09-29T04:55:20Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/OAuth2Strategy.java", "diffHunk": "@@ -198,6 +198,8 @@ protected HttpResponse performTokenRequest(final GenericTokenRequest request) th\n             );\n         }\n         headers.putAll(Device.getPlatformIdParameters());\n+        headers.put(AuthenticationConstants.SdkPlatformFields.PRODUCT, DiagnosticContext.getRequestContext().get(AuthenticationConstants.SdkPlatformFields.PRODUCT));\n+        headers.put(AuthenticationConstants.SdkPlatformFields.VERSION,DiagnosticContext.getRequestContext().get(AuthenticationConstants.SdkPlatformFields.VERSION));", "originalCommit": "77ef07157bf5e5b62df64f1e6d3e4736dad2cf83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5OTM3MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r499099370", "bodyText": "26cfa7e", "author": "tanmaymanolkar1", "createdAt": "2020-10-03T00:46:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM5ODkwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM5OTAwOA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r496399008", "bodyText": "space after comma?", "author": "AdamBJohnsonx", "createdAt": "2020-09-29T04:55:30Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/microsoftsts/MicrosoftStsOAuth2Strategy.java", "diffHunk": "@@ -469,6 +465,8 @@ private HttpResponse performPKeyAuthRequest(\n         final Map<String, String> headers = new TreeMap<>();\n         headers.put(\"client-request-id\", DiagnosticContext.getRequestContext().get(DiagnosticContext.CORRELATION_ID));\n         headers.putAll(Device.getPlatformIdParameters());\n+        headers.put(AuthenticationConstants.SdkPlatformFields.PRODUCT, DiagnosticContext.getRequestContext().get(AuthenticationConstants.SdkPlatformFields.PRODUCT));\n+        headers.put(AuthenticationConstants.SdkPlatformFields.VERSION,DiagnosticContext.getRequestContext().get(AuthenticationConstants.SdkPlatformFields.VERSION));", "originalCommit": "77ef07157bf5e5b62df64f1e6d3e4736dad2cf83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5OTQwMw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r499099403", "bodyText": "26cfa7e", "author": "tanmaymanolkar1", "createdAt": "2020-10-03T00:46:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM5OTAwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM5OTQ5MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r496399491", "bodyText": "factor out a local command.getParameters()?", "author": "AdamBJohnsonx", "createdAt": "2020-09-29T04:56:10Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/controllers/CommandDispatcher.java", "diffHunk": "@@ -426,7 +427,9 @@ public static void beginInteractive(final InteractiveTokenCommand command) {\n                 @Override\n                 public void run() {\n                     final String correlationId = initializeDiagnosticContext(\n-                            command.getParameters().getCorrelationId()\n+                            command.getParameters().getCorrelationId(),", "originalCommit": "77ef07157bf5e5b62df64f1e6d3e4736dad2cf83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY2MjkxMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r500662912", "bodyText": "Is it alright if I resolve this @AdamBJohnsonx , since we had a discussion about the thread local context?", "author": "tanmaymanolkar1", "createdAt": "2020-10-07T00:05:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM5OTQ5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE1MjM1NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r501152355", "bodyText": "I don't see that they're related?", "author": "AdamBJohnsonx", "createdAt": "2020-10-07T16:33:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM5OTQ5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM4NDU0OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r501384548", "bodyText": "Oh my bad @AdamBJohnsonx ! I misconstrued the comment, I will factor out the command.getParameters()", "author": "tanmaymanolkar1", "createdAt": "2020-10-08T00:32:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM5OTQ5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTkzMzI4NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r501933284", "bodyText": "71971f7", "author": "tanmaymanolkar1", "createdAt": "2020-10-08T18:36:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM5OTQ5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQwMDQ2Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r496400462", "bodyText": "could I make a plug here for adding an UNKNOWN value here.  But if we're going to fail things because they don't know the magic string, then we could at least log what the heck they sent us.", "author": "AdamBJohnsonx", "createdAt": "2020-09-29T04:57:27Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/commands/parameters/BrokerSilentTokenCommandParameters.java", "diffHunk": "@@ -89,7 +89,7 @@ public void validate() throws ArgumentException {\n                     \"mCallerPackageName\", \"Caller package name is not set\"\n             );\n         }\n-        if (SdkType.MSAL == getSdkType() &&\n+        if ((SdkType.MSAL == getSdkType() || SdkType.MSALCPP == getSdkType()) &&", "originalCommit": "77ef07157bf5e5b62df64f1e6d3e4736dad2cf83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5MjA4MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r499092080", "bodyText": "The sdktype is hardcoded in the logic when creating the requests, so technically we should only encounter one of these values.", "author": "tanmaymanolkar1", "createdAt": "2020-10-02T23:52:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQwMDQ2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5ODgwNQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r499098805", "bodyText": "Sure.  Now.  But that might not be true forever.", "author": "AdamBJohnsonx", "createdAt": "2020-10-03T00:42:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQwMDQ2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkzOTkzNg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r499939936", "bodyText": "For now, this is an enum so I don't expect it to be anything other than the values currently declared in the SdkType.java. @AdamBJohnsonx not clear to me how this could be an unknow value....are you anticipating something specific?", "author": "shahzaibj", "createdAt": "2020-10-06T00:18:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQwMDQ2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA4NzI1Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r499087257", "bodyText": "Can we clear the diagnostic context at the end of execution state?", "author": "AdamBJohnsonx", "createdAt": "2020-10-02T23:25:33Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/controllers/CommandDispatcher.java", "diffHunk": "@@ -606,6 +609,8 @@ public static String initializeDiagnosticContext(@Nullable final String requestC\n         final com.microsoft.identity.common.internal.logging.RequestContext rc =\n                 new com.microsoft.identity.common.internal.logging.RequestContext();\n         rc.put(DiagnosticContext.CORRELATION_ID, correlationId);\n+        rc.put(AuthenticationConstants.SdkPlatformFields.PRODUCT, sdkType);\n+        rc.put(AuthenticationConstants.SdkPlatformFields.VERSION, sdkVersion);", "originalCommit": "bdedb49a296db9f46e9dc73f7e0ffb41ce52caca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5OTA2Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r499099066", "bodyText": "26cfa7e", "author": "tanmaymanolkar1", "createdAt": "2020-10-03T00:44:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA4NzI1Nw=="}], "type": "inlineReview"}, {"oid": "26cfa7eb0a274713270351aede7d18c256f05eef", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/26cfa7eb0a274713270351aede7d18c256f05eef", "message": "addressing the comments and making changes", "committedDate": "2020-10-03T00:43:29Z", "type": "commit"}, {"oid": "e691df293c1295281ab6ee6c9758a557b18a0e07", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/e691df293c1295281ab6ee6c9758a557b18a0e07", "message": "Added a function for sdktype condition check", "committedDate": "2020-10-06T01:05:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2NjY5Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r500466697", "bodyText": "needs javadoc", "author": "shahzaibj", "createdAt": "2020-10-06T17:18:31Z", "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java", "diffHunk": "@@ -1567,4 +1567,24 @@\n \n         public static final String USER_SIGNED_OUT_FROM_SHARED_DEVICE = \"user_signed_out_from_shared_device\";\n     }\n+\n+    public static final class SdkPlatformFields {\n+        /**\n+         * The String representing the sdk platform.\n+         */\n+        public static final String PRODUCT = \"x-client-SKU\";\n+\n+        /**\n+         * The String representing the sdk version.\n+         */\n+        public static final String VERSION = \"x-client-Ver\";\n+\n+        /**\n+         * The Strings representing SdkType\n+         */\n+        public static final String PRODUCT_NAME_MSAL = \"MSAL.Android\";\n+\n+        public static final String PRODUCT_NAME_MSAL_CPP = \"MSAL.xplat.Android\";", "originalCommit": "e691df293c1295281ab6ee6c9758a557b18a0e07", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2NjkxNg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r500466916", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                     * The Strings representing SdkType\n          \n          \n            \n                     * The String representing the MSAL SdkType.", "author": "shahzaibj", "createdAt": "2020-10-06T17:18:51Z", "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java", "diffHunk": "@@ -1567,4 +1567,24 @@\n \n         public static final String USER_SIGNED_OUT_FROM_SHARED_DEVICE = \"user_signed_out_from_shared_device\";\n     }\n+\n+    public static final class SdkPlatformFields {\n+        /**\n+         * The String representing the sdk platform.\n+         */\n+        public static final String PRODUCT = \"x-client-SKU\";\n+\n+        /**\n+         * The String representing the sdk version.\n+         */\n+        public static final String VERSION = \"x-client-Ver\";\n+\n+        /**\n+         * The Strings representing SdkType", "originalCommit": "e691df293c1295281ab6ee6c9758a557b18a0e07", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2NzE5Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r500467196", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Sdk Type\n          \n          \n            \n                 * Sdk Type.", "author": "shahzaibj", "createdAt": "2020-10-06T17:19:16Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/broker/BrokerRequest.java", "diffHunk": "@@ -168,6 +170,13 @@\n     @SerializedName(SerializedNames.CLIENT_VERSION)\n     private String mMsalVersion;\n \n+    /**\n+     * Sdk Type", "originalCommit": "e691df293c1295281ab6ee6c9758a557b18a0e07", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2Nzg5NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r500467894", "bodyText": "I believe this javadoc needs to be updated......and actually probably needs to be a comment instead of javadoc", "author": "shahzaibj", "createdAt": "2020-10-06T17:20:26Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/commands/parameters/BrokerSilentTokenCommandParameters.java", "diffHunk": "@@ -89,7 +89,11 @@ public void validate() throws ArgumentException {\n                     \"mCallerPackageName\", \"Caller package name is not set\"\n             );\n         }\n-        if (SdkType.MSAL == getSdkType() &&\n+        /**\n+         * The check for SdkType.MSALCPP is added to ensure\n+         * the uniformity of logic with SdkType.MSAL\n+         */", "originalCommit": "e691df293c1295281ab6ee6c9758a557b18a0e07", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ3MDkzOA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r500470938", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if ((this == SdkType.MSAL) || (this == SdkType.MSALCPP)) {\n          \n          \n            \n                        return true;\n          \n          \n            \n                    }\n          \n          \n            \n                    return false;\n          \n          \n            \n                    return (this == SdkType.MSAL) || (this == SdkType.MSALCPP);", "author": "shahzaibj", "createdAt": "2020-10-06T17:25:24Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/request/SdkType.java", "diffHunk": "@@ -22,10 +22,30 @@\n // THE SOFTWARE.\n package com.microsoft.identity.common.internal.request;\n \n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\n+\n /**\n  * Enum to indicate if the request came from an app hosting Adal or Msal Sdk\n  */\n public enum SdkType {\n     ADAL,\n-    MSAL\n-}\n\\ No newline at end of file\n+    MSAL,\n+    MSALCPP;\n+\n+\n+    public String getProductName() {\n+        if ((SdkType.ADAL == this) || (SdkType.MSAL == this)) {\n+            return AuthenticationConstants.SdkPlatformFields.PRODUCT_NAME_MSAL;\n+        } else {\n+            return AuthenticationConstants.SdkPlatformFields.PRODUCT_NAME_MSAL_CPP;\n+        }\n+\n+    }\n+\n+    public boolean isCapableOfMSA() {\n+        if ((this == SdkType.MSAL) || (this == SdkType.MSALCPP)) {\n+            return true;\n+        }\n+        return false;", "originalCommit": "e691df293c1295281ab6ee6c9758a557b18a0e07", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "807a8d36d68e13a8c22239d1b62b1995c7f1d0e6", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/807a8d36d68e13a8c22239d1b62b1995c7f1d0e6", "message": "resolving comments and updating javadocs", "committedDate": "2020-10-06T19:08:38Z", "type": "commit"}, {"oid": "0690b2edaf6ac5954eb83dead6abee06b4f3ef7b", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/0690b2edaf6ac5954eb83dead6abee06b4f3ef7b", "message": "Merge branch 'dev' into tamanolk/adding-new-enum-type-of-MSALCPP", "committedDate": "2020-10-06T19:08:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2NDU3Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r500564573", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                     * Sdk Type\n          \n          \n            \n                     * Sdk Type.", "author": "shahzaibj", "createdAt": "2020-10-06T20:06:53Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/broker/BrokerRequest.java", "diffHunk": "@@ -468,6 +484,16 @@ public boolean isPowerOptCheckEnabled(){\n             return this;\n         }\n \n+        /**\n+         * Sdk Type", "originalCommit": "0690b2edaf6ac5954eb83dead6abee06b4f3ef7b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2NDg3MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r500564871", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // isCapableOfMSA() to ensure there is uniformity of logic with SdkType.MSALCPP and SdkType.MSAL\n          \n          \n            \n                    // Check if SDK is capable of MSA to ensure there is uniformity of logic with SdkType.MSALCPP and SdkType.MSAL", "author": "shahzaibj", "createdAt": "2020-10-06T20:07:30Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/commands/parameters/BrokerSilentTokenCommandParameters.java", "diffHunk": "@@ -89,7 +89,9 @@ public void validate() throws ArgumentException {\n                     \"mCallerPackageName\", \"Caller package name is not set\"\n             );\n         }\n-        if (SdkType.MSAL == getSdkType() &&\n+\n+        // isCapableOfMSA() to ensure there is uniformity of logic with SdkType.MSALCPP and SdkType.MSAL", "originalCommit": "0690b2edaf6ac5954eb83dead6abee06b4f3ef7b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2NTI0NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r500565245", "bodyText": "Needs a better javadoc", "author": "shahzaibj", "createdAt": "2020-10-06T20:08:11Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/request/SdkType.java", "diffHunk": "@@ -22,10 +22,31 @@\n // THE SOFTWARE.\n package com.microsoft.identity.common.internal.request;\n \n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\n+\n /**\n  * Enum to indicate if the request came from an app hosting Adal or Msal Sdk\n  */\n public enum SdkType {\n     ADAL,\n-    MSAL\n-}\n\\ No newline at end of file\n+    MSAL,\n+    MSALCPP;\n+\n+\n+    public String getProductName() {\n+        if ((SdkType.ADAL == this) || (SdkType.MSAL == this)) {\n+            return AuthenticationConstants.SdkPlatformFields.PRODUCT_NAME_MSAL;\n+        } else {\n+            return AuthenticationConstants.SdkPlatformFields.PRODUCT_NAME_MSAL_CPP;\n+        }\n+\n+    }\n+\n+    /**\n+     * The check for SdkType.MSALCPP is added to ensure\n+     * the uniformity of logic with SdkType.MSAL", "originalCommit": "0690b2edaf6ac5954eb83dead6abee06b4f3ef7b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2NjkwNQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r500566905", "bodyText": "Something along the lines of Determines if the Sdk supports Microsoft Personal Accounts.", "author": "shahzaibj", "createdAt": "2020-10-06T20:11:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2NTI0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2ODQ4Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r500568482", "bodyText": "any specific suggestions for the change?\nHow about something on lines of needed check to ensure the request is for a MSA account.", "author": "tanmaymanolkar1", "createdAt": "2020-10-06T20:14:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2NTI0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU3MzgwMw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r500573803", "bodyText": "addressed", "author": "tanmaymanolkar1", "createdAt": "2020-10-06T20:24:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2NTI0NQ=="}], "type": "inlineReview"}, {"oid": "3ba4ae518c3603f10d8f8d08390c1fd4b041f2de", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/3ba4ae518c3603f10d8f8d08390c1fd4b041f2de", "message": "Addressing comments", "committedDate": "2020-10-06T20:21:15Z", "type": "commit"}, {"oid": "29bd5dce68b4ce9071b278caa5a96a89d85013fc", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/29bd5dce68b4ce9071b278caa5a96a89d85013fc", "message": "Merge branch 'dev' into tamanolk/adding-new-enum-type-of-MSALCPP", "committedDate": "2020-10-06T23:51:15Z", "type": "commit"}, {"oid": "02f680150240786615f9e57e294a760c3e6307ee", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/02f680150240786615f9e57e294a760c3e6307ee", "message": "Merge branch 'dev' into tamanolk/adding-new-enum-type-of-MSALCPP", "committedDate": "2020-10-07T22:42:19Z", "type": "commit"}, {"oid": "e36b822168f1b04f11a04095d9397c8f62d0b8a6", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/e36b822168f1b04f11a04095d9397c8f62d0b8a6", "message": "Merge branch 'dev' into tamanolk/adding-new-enum-type-of-MSALCPP", "committedDate": "2020-10-08T18:14:09Z", "type": "commit"}, {"oid": "71971f7aba6ef749710983fa8508b9ebb864d48a", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/71971f7aba6ef749710983fa8508b9ebb864d48a", "message": "Update CommandDispatcher.java", "committedDate": "2020-10-08T18:35:39Z", "type": "commit"}, {"oid": "dc9cfacf88e651ef49160d5cd7186d65c46eb4d7", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/dc9cfacf88e651ef49160d5cd7186d65c46eb4d7", "message": "Merge branch 'dev' into tamanolk/adding-new-enum-type-of-MSALCPP", "committedDate": "2020-10-09T18:07:41Z", "type": "commit"}, {"oid": "32a93406742ec8a5e4bed582f75cd4de8889e032", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/32a93406742ec8a5e4bed582f75cd4de8889e032", "message": "Updates to cover teh case of old MSAL and new Broker", "committedDate": "2020-10-09T18:09:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYwNzA4Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502607087", "bodyText": "Do you need to get rid of this annotation?", "author": "AdamBJohnsonx", "createdAt": "2020-10-09T18:34:36Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/commands/parameters/CommandParameters.java", "diffHunk": "@@ -60,9 +60,8 @@\n     @Expose()\n     private String requiredBrokerProtocolVersion;\n \n-    @Builder.Default\n     @Expose()\n-    private SdkType sdkType = SdkType.MSAL;", "originalCommit": "32a93406742ec8a5e4bed582f75cd4de8889e032", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYyMjU3Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502622572", "bodyText": "yes because this was preventing picking up the value when I checked using the delombok'd code.", "author": "tanmaymanolkar1", "createdAt": "2020-10-09T19:07:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYwNzA4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYyMzQwOA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502623408", "bodyText": "Do we know why it wasn't being picked up? because you said earlier that when null was passed then the default was working as expected and setting it to MSAL -- so in what cases does it not work? and why?", "author": "shahzaibj", "createdAt": "2020-10-09T19:09:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYwNzA4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcyMTk0Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502721942", "bodyText": "I meant that if the field is not sent over the wire, we have nothing to compare against null on the receiving end. The annotation as well wasn't a good addition, it was a part of an experimentation which I was trying out, and missed out on actually servicing it.", "author": "tanmaymanolkar1", "createdAt": "2020-10-10T00:34:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYwNzA4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczNTMyNw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502735327", "bodyText": "But if there is nothing, isn't there the initial value of null for all java objects? I mean the default should be kicking in whether you pass null to the builder or pass nothing", "author": "shahzaibj", "createdAt": "2020-10-10T02:34:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYwNzA4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIwNTEzMw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r504205133", "bodyText": "Is this coming through Parcelable?", "author": "AdamBJohnsonx", "createdAt": "2020-10-13T19:31:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYwNzA4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk4NDc5NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r507984795", "bodyText": "The Builder.Default is broken according to Some, and seems like people are recommending against using it. This might explain the builder not picking up the value passed.\nprojectlombok/lombok#1347", "author": "tanmaymanolkar1", "createdAt": "2020-10-19T18:47:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYwNzA4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk4NzEwMw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r507987103", "bodyText": "@AdamBJohnsonx  I dont think its coming through parcelable.", "author": "tanmaymanolkar1", "createdAt": "2020-10-19T18:51:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYwNzA4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYyMzY5NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502623695", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Determines if the Sdk supports Microsoft Personal Accounts\n          \n          \n            \n                 * Determines if the Sdk supports Microsoft Personal Accounts.", "author": "shahzaibj", "createdAt": "2020-10-09T19:09:53Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/request/SdkType.java", "diffHunk": "@@ -22,10 +22,30 @@\n // THE SOFTWARE.\n package com.microsoft.identity.common.internal.request;\n \n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\n+\n /**\n  * Enum to indicate if the request came from an app hosting Adal or Msal Sdk\n  */\n public enum SdkType {\n     ADAL,\n-    MSAL\n-}\n\\ No newline at end of file\n+    MSAL,\n+    MSALCPP;\n+\n+\n+    public String getProductName() {\n+        if ((SdkType.ADAL == this) || (SdkType.MSAL == this)) {\n+            return AuthenticationConstants.SdkPlatformFields.PRODUCT_NAME_MSAL;\n+        } else {\n+            return AuthenticationConstants.SdkPlatformFields.PRODUCT_NAME_MSAL_CPP;\n+        }\n+\n+    }\n+\n+    /**\n+     * Determines if the Sdk supports Microsoft Personal Accounts", "originalCommit": "32a93406742ec8a5e4bed582f75cd4de8889e032", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYyMzgzMA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502623830", "bodyText": "Also need javadoc for return type here", "author": "shahzaibj", "createdAt": "2020-10-09T19:10:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYyMzY5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcxODM2MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502718360", "bodyText": "9b05ccd", "author": "tanmaymanolkar1", "createdAt": "2020-10-10T00:09:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYyMzY5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYyMzkwMA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502623900", "bodyText": "Javadoc", "author": "shahzaibj", "createdAt": "2020-10-09T19:10:19Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/request/SdkType.java", "diffHunk": "@@ -22,10 +22,30 @@\n // THE SOFTWARE.\n package com.microsoft.identity.common.internal.request;\n \n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\n+\n /**\n  * Enum to indicate if the request came from an app hosting Adal or Msal Sdk\n  */\n public enum SdkType {\n     ADAL,\n-    MSAL\n-}\n\\ No newline at end of file\n+    MSAL,\n+    MSALCPP;\n+\n+\n+    public String getProductName() {", "originalCommit": "32a93406742ec8a5e4bed582f75cd4de8889e032", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjY0NzY3MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502647671", "bodyText": "170586b", "author": "tanmaymanolkar1", "createdAt": "2020-10-09T20:06:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYyMzkwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYyNDc2Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502624767", "bodyText": "Some javadoc for this public class would be good", "author": "shahzaibj", "createdAt": "2020-10-09T19:12:22Z", "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java", "diffHunk": "@@ -1567,4 +1567,27 @@\n \n         public static final String USER_SIGNED_OUT_FROM_SHARED_DEVICE = \"user_signed_out_from_shared_device\";\n     }\n+\n+    public static final class SdkPlatformFields {", "originalCommit": "32a93406742ec8a5e4bed582f75cd4de8889e032", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjY0NzY0MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502647640", "bodyText": "170586b", "author": "tanmaymanolkar1", "createdAt": "2020-10-09T20:06:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjYyNDc2Nw=="}], "type": "inlineReview"}, {"oid": "4b98a718b0424f63196b82762caa7aecd44914d0", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/4b98a718b0424f63196b82762caa7aecd44914d0", "message": "Merge branch 'dev' into tamanolk/adding-new-enum-type-of-MSALCPP", "committedDate": "2020-10-09T19:47:25Z", "type": "commit"}, {"oid": "170586b9a106a1bdbe3d038b2d59e9ec96a10510", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/170586b9a106a1bdbe3d038b2d59e9ec96a10510", "message": "Updates for Javadocs", "committedDate": "2020-10-09T20:02:57Z", "type": "commit"}, {"oid": "9861111a9e6e7abcecf3cf23bc8a6f6180cb45ac", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/9861111a9e6e7abcecf3cf23bc8a6f6180cb45ac", "message": "Update javadocs", "committedDate": "2020-10-09T20:05:20Z", "type": "commit"}, {"oid": "9b05ccd63b46b2e99747543afec6a72bf9fcbcc9", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/9b05ccd63b46b2e99747543afec6a72bf9fcbcc9", "message": "Updates for making sure the CI test case doesnt fail\n\nThe CI test case constructs a CommandParameter object with null values for every field. hence commandParameters.getSdkType().getProductName() was breaking the CI build.", "committedDate": "2020-10-10T00:08:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcxODY0Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502718646", "bodyText": "Are there any other cases where this could happen (besides the test)? and should we pick a better default value for such scenarios?", "author": "shahzaibj", "createdAt": "2020-10-10T00:10:38Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/controllers/CommandDispatcher.java", "diffHunk": "@@ -165,7 +165,7 @@ public static void submitSilent(@SuppressWarnings(WarningType.rawtype_warning) @\n                 public void run() {\n                     try {\n                         final CommandParameters commandParameters = command.getParameters();\n-                        final String correlationId = initializeDiagnosticContext(commandParameters.getCorrelationId(), commandParameters.getSdkType().getProductName(), commandParameters.getSdkVersion());\n+                        final String correlationId = initializeDiagnosticContext(commandParameters.getCorrelationId(), commandParameters.getSdkType() == null ? \"\" : commandParameters.getSdkType().getProductName(), commandParameters.getSdkVersion());", "originalCommit": "9b05ccd63b46b2e99747543afec6a72bf9fcbcc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcxOTExNg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502719116", "bodyText": "Realistically, we should accept any String that a client sends us and choose to sanitize it accordingly.  If that means accepting anything of a given pattern and converting everything else to UNKNOWN and pushing the transmitted value over telemetry as unknownClientSpecifier = , that's perfect.", "author": "AdamBJohnsonx", "createdAt": "2020-10-10T00:13:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcxODY0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcxOTE3Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502719177", "bodyText": "No, there wouldn't be any such scenarios, since these values are coded when the requests are being spawned. These exist only in the test case. and with this implementation the test cases are also taken care of and are executed successfully.", "author": "tanmaymanolkar1", "createdAt": "2020-10-10T00:13:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcxODY0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcxOTMxMQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502719311", "bodyText": "There is also an additional null check for this field on the broker side, when rebuilding the CommandParameters from the BrokerRequest.", "author": "tanmaymanolkar1", "createdAt": "2020-10-10T00:14:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcxODY0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcyMDMwMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502720302", "bodyText": "I've made a bug to remove type-sharing from this interface, since it's just a problem waiting to happen.", "author": "AdamBJohnsonx", "createdAt": "2020-10-10T00:21:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcxODY0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcyMTEwNw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502721107", "bodyText": "@AdamBJohnsonx yes I agree, since this field is not exposed to user input, hence it is safeguarded by that. And like you suggested there is a refactor task needed with certain fields involved in interaction over wire and once things settle down we can club in this change as well", "author": "tanmaymanolkar1", "createdAt": "2020-10-10T00:27:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcxODY0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcyNjYzNQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502726635", "bodyText": "@tanmaymanolkar1 - don't be so trusting. You could get anything over that interface and it shouldn't crash you.", "author": "AdamBJohnsonx", "createdAt": "2020-10-10T01:15:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcxODY0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczNTYwOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502735609", "bodyText": "@tanmaymanolkar1 I think you can create a constant for unknown and use that here....I don't personally like the empty string", "author": "shahzaibj", "createdAt": "2020-10-10T02:36:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcxODY0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczNTY3Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502735677", "bodyText": "Did we mean to do this or not? If not, then let's remove the comment.", "author": "shahzaibj", "createdAt": "2020-10-10T02:37:47Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/controllers/CommandDispatcher.java", "diffHunk": "@@ -216,6 +219,7 @@ public void run() {\n                             }\n                             finalFuture.setCleanedUp();\n                         }\n+                        //DiagnosticContext.clear();", "originalCommit": "9b05ccd63b46b2e99747543afec6a72bf9fcbcc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ1OTM5OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r503459399", "bodyText": "38b8d70", "author": "tanmaymanolkar1", "createdAt": "2020-10-12T18:14:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczNTY3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczNTcwMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502735702", "bodyText": "Same comment as above about empty string", "author": "shahzaibj", "createdAt": "2020-10-10T02:38:05Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/controllers/CommandDispatcher.java", "diffHunk": "@@ -426,48 +430,55 @@ public static void beginInteractive(final InteractiveTokenCommand command) {\n             sInteractiveExecutor.execute(new Runnable() {\n                 @Override\n                 public void run() {\n-                    final String correlationId = initializeDiagnosticContext(\n-                            command.getParameters().getCorrelationId()\n-                    );\n-\n-                    // set correlation id on parameters as it may not already be set\n-                    command.getParameters().setCorrelationId(correlationId);\n+                    try {\n+                        final CommandParameters commandParameters = command.getParameters();\n+                        final String correlationId = initializeDiagnosticContext(\n+                                commandParameters.getCorrelationId(),\n+                                commandParameters.getSdkType() == null ? \"\" : commandParameters.getSdkType().getProductName(),", "originalCommit": "9b05ccd63b46b2e99747543afec6a72bf9fcbcc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ1OTQzOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r503459439", "bodyText": "38b8d70", "author": "tanmaymanolkar1", "createdAt": "2020-10-12T18:14:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczNTcwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczNTgwNg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502735806", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                MSALCPP;\n          \n          \n            \n                MSAL_CPP;\n          \n      \n    \n    \n  \n\nI think that may be more readable", "author": "shahzaibj", "createdAt": "2020-10-10T02:39:25Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/request/SdkType.java", "diffHunk": "@@ -22,10 +22,34 @@\n // THE SOFTWARE.\n package com.microsoft.identity.common.internal.request;\n \n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\n+\n /**\n  * Enum to indicate if the request came from an app hosting Adal or Msal Sdk\n  */\n public enum SdkType {\n     ADAL,\n-    MSAL\n-}\n\\ No newline at end of file\n+    MSAL,\n+    MSALCPP;", "originalCommit": "9b05ccd63b46b2e99747543afec6a72bf9fcbcc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ1OTUxMQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r503459511", "bodyText": "38b8d70", "author": "tanmaymanolkar1", "createdAt": "2020-10-12T18:14:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczNTgwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczNTgyNw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502735827", "bodyText": "Functions in java are called as methods", "author": "shahzaibj", "createdAt": "2020-10-10T02:39:42Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/request/SdkType.java", "diffHunk": "@@ -22,10 +22,34 @@\n // THE SOFTWARE.\n package com.microsoft.identity.common.internal.request;\n \n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\n+\n /**\n  * Enum to indicate if the request came from an app hosting Adal or Msal Sdk\n  */\n public enum SdkType {\n     ADAL,\n-    MSAL\n-}\n\\ No newline at end of file\n+    MSAL,\n+    MSALCPP;\n+\n+    /**\n+     * Function for mapping the SdkType to appropriate String", "originalCommit": "9b05ccd63b46b2e99747543afec6a72bf9fcbcc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ1OTU0NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r503459544", "bodyText": "38b8d70", "author": "tanmaymanolkar1", "createdAt": "2020-10-12T18:14:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczNTgyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczNTkzNw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r502735937", "bodyText": "needs formatting", "author": "shahzaibj", "createdAt": "2020-10-10T02:40:59Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/request/SdkType.java", "diffHunk": "@@ -22,10 +22,34 @@\n // THE SOFTWARE.\n package com.microsoft.identity.common.internal.request;\n \n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\n+\n /**\n  * Enum to indicate if the request came from an app hosting Adal or Msal Sdk\n  */\n public enum SdkType {\n     ADAL,\n-    MSAL\n-}\n\\ No newline at end of file\n+    MSAL,\n+    MSALCPP;\n+\n+    /**\n+     * Function for mapping the SdkType to appropriate String\n+     * for the purpose of sending it to the telemetry.\n+     */\n+    public String getProductName() {\n+        if ((SdkType.ADAL == this) || (SdkType.MSAL == this)) {\n+            return AuthenticationConstants.SdkPlatformFields.PRODUCT_NAME_MSAL;\n+        } else {\n+            return AuthenticationConstants.SdkPlatformFields.PRODUCT_NAME_MSAL_CPP;\n+        }\n+\n+    }\n+\n+    /**\n+     * Determines if the Sdk supports Microsoft Personal Accounts.\n+     * @return True if Sdk supports Microsoft Personal Accounts, false otherwise.", "originalCommit": "9b05ccd63b46b2e99747543afec6a72bf9fcbcc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ1OTU5MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r503459591", "bodyText": "38b8d70", "author": "tanmaymanolkar1", "createdAt": "2020-10-12T18:14:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczNTkzNw=="}], "type": "inlineReview"}, {"oid": "38b8d704207fb078d883d644a73e0835fa8ded39", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/38b8d704207fb078d883d644a73e0835fa8ded39", "message": "Added an SdkType of UNKNOWN to map the empty string", "committedDate": "2020-10-12T18:10:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk5MTU3MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r507991571", "bodyText": "Aren't we using default of unknown in this case?", "author": "shahzaibj", "createdAt": "2020-10-19T18:58:10Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/request/SdkType.java", "diffHunk": "@@ -22,10 +22,39 @@\n // THE SOFTWARE.\n package com.microsoft.identity.common.internal.request;\n \n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\n+\n /**\n  * Enum to indicate if the request came from an app hosting Adal or Msal Sdk\n  */\n public enum SdkType {\n     ADAL,\n-    MSAL\n-}\n\\ No newline at end of file\n+    MSAL,\n+    MSAL_CPP,\n+    UNKNOWN;\n+\n+    /**\n+     * Method for mapping the SdkType to appropriate String\n+     * for the purpose of sending it to the telemetry.\n+     */\n+    public String getProductName() {\n+        if ((SdkType.ADAL == this) || (SdkType.MSAL == this)) {\n+            return AuthenticationConstants.SdkPlatformFields.PRODUCT_NAME_MSAL;\n+        } else if ((SdkType.MSAL_CPP == this)) {\n+            return AuthenticationConstants.SdkPlatformFields.PRODUCT_NAME_MSAL_CPP;\n+        } else {\n+            // value is intended for test-cases, eg. CommandDispatcherTest.java.\n+            return \"\";", "originalCommit": "38b8d704207fb078d883d644a73e0835fa8ded39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAxNTI4Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r508015286", "bodyText": "yes, we are using it in CommandDispatcher.java for submitSilent and beginInteractive methods. this field is primarily used to adhere to already written test-cases.", "author": "tanmaymanolkar1", "createdAt": "2020-10-19T19:39:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk5MTU3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk5MTY0OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r507991649", "bodyText": "return not documented", "author": "shahzaibj", "createdAt": "2020-10-19T18:58:20Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/request/SdkType.java", "diffHunk": "@@ -22,10 +22,39 @@\n // THE SOFTWARE.\n package com.microsoft.identity.common.internal.request;\n \n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\n+\n /**\n  * Enum to indicate if the request came from an app hosting Adal or Msal Sdk\n  */\n public enum SdkType {\n     ADAL,\n-    MSAL\n-}\n\\ No newline at end of file\n+    MSAL,\n+    MSAL_CPP,\n+    UNKNOWN;\n+\n+    /**\n+     * Method for mapping the SdkType to appropriate String\n+     * for the purpose of sending it to the telemetry.\n+     */", "originalCommit": "38b8d704207fb078d883d644a73e0835fa8ded39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAxNTcxNg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1034#discussion_r508015716", "bodyText": "c361c63", "author": "tanmaymanolkar1", "createdAt": "2020-10-19T19:39:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk5MTY0OQ=="}], "type": "inlineReview"}, {"oid": "c361c635cdbd853343a0ed18cc0b426d9c508037", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/c361c635cdbd853343a0ed18cc0b426d9c508037", "message": "Update SdkType.java", "committedDate": "2020-10-19T19:37:18Z", "type": "commit"}]}