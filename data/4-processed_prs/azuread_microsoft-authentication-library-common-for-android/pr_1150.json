{"pr_number": 1150, "pr_title": "Android/update versions gradle", "pr_createdAt": "2020-12-07T17:03:52Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150", "timeline": [{"oid": "145e08016ec9acbbcd42fda0315eed91068d62b2", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/145e08016ec9acbbcd42fda0315eed91068d62b2", "message": "Updates for java 8 compat, mockito latest, api 30", "committedDate": "2020-12-07T01:30:59Z", "type": "commit"}, {"oid": "ecbbc01ce67b12174ca1e155a4c88ecabedff941", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/ecbbc01ce67b12174ca1e155a4c88ecabedff941", "message": "Update testutils and uiautomationutils for java 8 compat", "committedDate": "2020-12-07T17:02:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY5MTE3Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r537691173", "bodyText": "Why comment this out?", "author": "AdamBJohnsonx", "createdAt": "2020-12-07T17:30:10Z", "path": "common/build.gradle", "diffHunk": "@@ -57,8 +67,8 @@ android {\n             minifyEnabled false\n             debuggable false\n             testCoverageEnabled true\n-            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n-            consumerProguardFiles 'consumer-rules.pro'\n+            //proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n+            //consumerProguardFiles 'consumer-rules.pro'", "originalCommit": "ecbbc01ce67b12174ca1e155a4c88ecabedff941", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY5MTg2MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r537691861", "bodyText": "Good catch.  That was an investigation and turned out to be a red herring.", "author": "shoatman", "createdAt": "2020-12-07T17:31:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY5MTE3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY5NDg1MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r537694851", "bodyText": "fixed", "author": "shoatman", "createdAt": "2020-12-07T17:35:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY5MTE3Mw=="}], "type": "inlineReview"}, {"oid": "4c823ff19a135bf9ec8be34a735f7435a6c2f2ec", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/4c823ff19a135bf9ec8be34a735f7435a6c2f2ec", "message": "address feedback and hardcoded version", "committedDate": "2020-12-07T17:35:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY5NDczNw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r537694737", "bodyText": "should this still be commented out?  Probably remove the comment or attach a work item to fix whatever is wrong with the versions file.", "author": "AdamBJohnsonx", "createdAt": "2020-12-07T17:35:23Z", "path": "common/build.gradle", "diffHunk": "@@ -18,7 +18,16 @@ def bothTestType = \"BothTest\"\n project.ext.vstsUsername = System.getenv(\"ENV_VSTS_MVN_ANDROIDCOMMON_USERNAME\") != null ? System.getenv(\"ENV_VSTS_MVN_ANDROIDCOMMON_USERNAME\") : project.findProperty(\"vstsUsername\")\n project.ext.vstsPassword = System.getenv(\"ENV_VSTS_MVN_ANDROIDCOMMON_ACCESSTOKEN\") != null ? System.getenv(\"ENV_VSTS_MVN_ANDROIDCOMMON_ACCESSTOKEN\") : project.findProperty(\"vstsMavenAccessToken\")\n android {\n-    compileSdkVersion rootProject.ext.compileSdkVersion\n+\n+    compileOptions {\n+        // Flag to enable support for the new language APIs\n+        coreLibraryDesugaringEnabled true\n+        // Sets Java compatibility to Java 8\n+        sourceCompatibility JavaVersion.VERSION_1_8\n+        targetCompatibility JavaVersion.VERSION_1_8\n+    }\n+\n+    compileSdkVersion 30//rootProject.ext.compileSdkVersion", "originalCommit": "ecbbc01ce67b12174ca1e155a4c88ecabedff941", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY5NTA3Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r537695076", "bodyText": "Nope.  I fixed.", "author": "shoatman", "createdAt": "2020-12-07T17:35:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY5NDczNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY5NTIxMA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r537695210", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            abiSelection=x86_64\n          \n          \n            \n            abiSelection=x86_64", "author": "AdamBJohnsonx", "createdAt": "2020-12-07T17:36:03Z", "path": "gradle.properties", "diffHunk": "@@ -15,4 +15,4 @@ org.gradle.jvmargs=-Xmx4g -XX:MaxPermSize=2048m -Dkotlin.daemon.jvm.options\\=\"-X\n versionName=1.5.9\n \n # For OneAuth default abiSelection\n-abiSelection=x86\n\\ No newline at end of file\n+abiSelection=x86_64", "originalCommit": "4c823ff19a135bf9ec8be34a735f7435a6c2f2ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY5NTc1OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r537695759", "bodyText": "Yay!", "author": "AdamBJohnsonx", "createdAt": "2020-12-07T17:36:51Z", "path": "common/build.gradle", "diffHunk": "@@ -18,6 +18,15 @@ def bothTestType = \"BothTest\"\n project.ext.vstsUsername = System.getenv(\"ENV_VSTS_MVN_ANDROIDCOMMON_USERNAME\") != null ? System.getenv(\"ENV_VSTS_MVN_ANDROIDCOMMON_USERNAME\") : project.findProperty(\"vstsUsername\")\n project.ext.vstsPassword = System.getenv(\"ENV_VSTS_MVN_ANDROIDCOMMON_ACCESSTOKEN\") != null ? System.getenv(\"ENV_VSTS_MVN_ANDROIDCOMMON_ACCESSTOKEN\") : project.findProperty(\"vstsMavenAccessToken\")\n android {\n+\n+    compileOptions {\n+        // Flag to enable support for the new language APIs\n+        coreLibraryDesugaringEnabled true", "originalCommit": "4c823ff19a135bf9ec8be34a735f7435a6c2f2ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY5Njk5Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r537696996", "bodyText": "Any way we can axe this, since it's going to get overridden by the new versions of Gradle anyway?  Specifically the buildToolsVersion.", "author": "AdamBJohnsonx", "createdAt": "2020-12-07T17:38:31Z", "path": "uiautomationutilities/build.gradle", "diffHunk": "@@ -10,6 +10,15 @@ project.ext.vstsPassword = System.getenv(\"ENV_VSTS_MVN_ANDROIDCOMMON_ACCESSTOKEN\n \n \n android {\n+\n+    compileOptions {\n+        // Flag to enable support for the new language APIs\n+        coreLibraryDesugaringEnabled true\n+        // Sets Java compatibility to Java 8\n+        sourceCompatibility JavaVersion.VERSION_1_8\n+        targetCompatibility JavaVersion.VERSION_1_8\n+    }\n+\n     compileSdkVersion rootProject.ext.compileSdkVersion\n     buildToolsVersion rootProject.ext.buildToolsVersion", "originalCommit": "4c823ff19a135bf9ec8be34a735f7435a6c2f2ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzcwMDg0Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r537700842", "bodyText": "I don't see why not.", "author": "shoatman", "createdAt": "2020-12-07T17:43:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY5Njk5Ng=="}], "type": "inlineReview"}, {"oid": "5151fc159b1dce15bab60b7f51f12085bbd0d380", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/5151fc159b1dce15bab60b7f51f12085bbd0d380", "message": "remove unused manifest", "committedDate": "2020-12-07T18:47:47Z", "type": "commit"}, {"oid": "b37b7904048dc9a5ff981335122de3228ac8ce39", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/b37b7904048dc9a5ff981335122de3228ac8ce39", "message": "Merge branch 'dev' into android/update-versions-gradle", "committedDate": "2020-12-07T19:47:34Z", "type": "commit"}, {"oid": "de2d09f0264b8e9eeccf296495b5b81bd57fe1fa", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/de2d09f0264b8e9eeccf296495b5b81bd57fe1fa", "message": "Updated labapi dependencies", "committedDate": "2020-12-08T02:27:57Z", "type": "commit"}, {"oid": "244c1bd965ecb96a00847d14a104481b68566ed5", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/244c1bd965ecb96a00847d14a104481b68566ed5", "message": "Complete merge", "committedDate": "2020-12-08T02:28:22Z", "type": "commit"}, {"oid": "578bb3eab98ffc2a690156a765354e4f1e5ab736", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/578bb3eab98ffc2a690156a765354e4f1e5ab736", "message": "fix jacoco crashing tests", "committedDate": "2020-12-08T03:43:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NDQ5MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r540674491", "bodyText": "interesting", "author": "shahzaibj", "createdAt": "2020-12-11T04:03:17Z", "path": "common/build.gradle", "diffHunk": "@@ -5,9 +5,12 @@ apply plugin: 'maven-publish'\n apply from: 'versioning/version_tasks.gradle'\n apply plugin: 'jacoco'\n \n-// To include Robolectric tests in the Jacoco report, flag -> \"includeNolocationClasses\" is set to true\n+//To include Robolectric tests in the Jacoco report, flag -> \"includeNolocationClasses\" is set to true\n tasks.withType(Test) {\n     jacoco.includeNoLocationClasses = true\n+    //This needs to be excluded for JDK 11\n+    //SEE: https://support.circleci.com/hc/en-us/articles/360047926852-Android-Builds-Fail-with-java-lang-ClassNotFoundException-jdk-internal-reflect-GeneratedSerializationConstructorAccessor1-\n+    jacoco.excludes = ['jdk.internal.*']", "originalCommit": "578bb3eab98ffc2a690156a765354e4f1e5ab736", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NDY0MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r540674641", "bodyText": "The version can go in the version file", "author": "shahzaibj", "createdAt": "2020-12-11T04:03:53Z", "path": "common/build.gradle", "diffHunk": "@@ -103,6 +120,9 @@ android {\n }\n \n dependencies {\n+    //Java 8 - Desugaring\n+    coreLibraryDesugaring 'com.android.tools:desugar_jdk_libs:1.0.9'", "originalCommit": "578bb3eab98ffc2a690156a765354e4f1e5ab736", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTgyMDkxNA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r549820914", "bodyText": "Done.", "author": "shoatman", "createdAt": "2020-12-29T19:26:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NDY0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NDcwNA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r540674704", "bodyText": "new line needed", "author": "shahzaibj", "createdAt": "2020-12-11T04:04:09Z", "path": "common/src/androidTest/AndroidManifest.xml", "diffHunk": "@@ -0,0 +1,35 @@\n+<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    package=\"com.microsoft.identity.common\">\n+\n+    <uses-sdk\n+        android:minSdkVersion=\"26\"\n+        android:targetSdkVersion=\"30\" />\n+\n+    <uses-permission android:name=\"android.permission.INTERNET\" />\n+    <uses-permission android:name=\"android.permission.ACCESS_NETWORK_STATE\" />\n+\n+    <application\n+        android:label=\"Common Test App\"\n+        android:allowBackup=\"false\">\n+        <uses-library android:name=\"android.test.runner\" />\n+\n+    </application>\n+\n+    <!-- Required for API Level 30 to make sure we can detect browsers and other apps we want to\n+         be able to talk to.-->\n+    <!--https://developer.android.com/training/basics/intents/package-visibility-use-cases-->\n+    <queries>\n+        <!-- Required for API Level 30 to make sure we can detect browsers\n+        (that don't support custom tabs) -->\n+        <intent>\n+            <action android:name=\"android.intent.action.VIEW\" />\n+        </intent>\n+        <!-- Required for API Level 30 to make sure we can detect browsers that support custom tabs -->\n+        <!-- https://developers.google.com/web/updates/2020/07/custom-tabs-android-11#detecting_browsers_that_support_custom_tabs -->\n+        <intent>\n+            <action android:name=\n+                \"android.support.customtabs.action.CustomTabsService\" />\n+        </intent>\n+    </queries>\n+\n+</manifest>", "originalCommit": "578bb3eab98ffc2a690156a765354e4f1e5ab736", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTgyMjEzMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r549822132", "bodyText": "I didn't understand this one.  Am resolving for now please re-open if necessary.", "author": "shoatman", "createdAt": "2020-12-29T19:30:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NDcwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NDk0Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r540674943", "bodyText": "Can you add a note why this was needed? Because as far as I know the one in common main dir should be being used already", "author": "shahzaibj", "createdAt": "2020-12-11T04:04:50Z", "path": "common/src/androidTest/AndroidManifest.xml", "diffHunk": "@@ -0,0 +1,35 @@\n+<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"", "originalCommit": "578bb3eab98ffc2a690156a765354e4f1e5ab736", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTgyMTE2OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r549821168", "bodyText": "I would if I could remember.  I'm going to leave for now since it doesn't have anything in it.", "author": "shoatman", "createdAt": "2020-12-29T19:27:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NDk0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NTM0NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r540675345", "bodyText": "Why are these needed?", "author": "shahzaibj", "createdAt": "2020-12-11T04:06:16Z", "path": "labapi/build.gradle", "diffHunk": "@@ -50,6 +50,10 @@ publishing {\n dependencies {\n     implementation fileTree(dir: 'libs', include: ['*.jar'])\n     implementation 'io.swagger:swagger-annotations:1.5.17'\n+    implementation group: 'javax.xml.bind', name: 'jaxb-api', version: '2.3.0'\n+    implementation group: 'com.sun.xml.bind', name: 'jaxb-core', version: '2.3.0'\n+    implementation group: 'com.sun.xml.bind', name: 'jaxb-impl', version: '2.3.0'\n+    implementation group: 'javax.annotation', name: 'javax.annotation-api', version: '1.3.2'", "originalCommit": "578bb3eab98ffc2a690156a765354e4f1e5ab736", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTEyMTMyMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r541121322", "bodyText": "They've been removed from java 11's default packaging.", "author": "AdamBJohnsonx", "createdAt": "2020-12-11T17:49:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NTM0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NTUwOA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r540675508", "bodyText": "The version can go in version file", "author": "shahzaibj", "createdAt": "2020-12-11T04:06:44Z", "path": "uiautomationutilities/build.gradle", "diffHunk": "@@ -122,6 +132,9 @@ project.afterEvaluate{\n }\n \n dependencies {\n+    //Java 8 - Desugaring\n+    coreLibraryDesugaring 'com.android.tools:desugar_jdk_libs:1.0.9'", "originalCommit": "578bb3eab98ffc2a690156a765354e4f1e5ab736", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NTU0Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r540675546", "bodyText": "The version can go in version file", "author": "shahzaibj", "createdAt": "2020-12-11T04:06:50Z", "path": "testutils/build.gradle", "diffHunk": "@@ -123,6 +132,10 @@ project.afterEvaluate{\n }\n \n dependencies {\n+\n+    //Java 8 - Desugaring\n+    coreLibraryDesugaring 'com.android.tools:desugar_jdk_libs:1.0.9'", "originalCommit": "578bb3eab98ffc2a690156a765354e4f1e5ab736", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTEyMDI4NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1150#discussion_r541120284", "bodyText": "nit: extra lines", "author": "AdamBJohnsonx", "createdAt": "2020-12-11T17:47:34Z", "path": "common/build.gradle", "diffHunk": "@@ -17,7 +20,19 @@ def bothTestType = \"BothTest\"\n \n project.ext.vstsUsername = System.getenv(\"ENV_VSTS_MVN_ANDROIDCOMMON_USERNAME\") != null ? System.getenv(\"ENV_VSTS_MVN_ANDROIDCOMMON_USERNAME\") : project.findProperty(\"vstsUsername\")\n project.ext.vstsPassword = System.getenv(\"ENV_VSTS_MVN_ANDROIDCOMMON_ACCESSTOKEN\") != null ? System.getenv(\"ENV_VSTS_MVN_ANDROIDCOMMON_ACCESSTOKEN\") : project.findProperty(\"vstsMavenAccessToken\")\n+\n android {\n+\n+", "originalCommit": "578bb3eab98ffc2a690156a765354e4f1e5ab736", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bcd12efcf09ed2e8d2882d809e795b0d60a8cf83", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/bcd12efcf09ed2e8d2882d809e795b0d60a8cf83", "message": "Merge branch 'dev' into android/update-versions-gradle", "committedDate": "2020-12-22T18:55:44Z", "type": "commit"}, {"oid": "be568e058ea2a2354fef0fc8c27a8e5ac2ae0026", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/be568e058ea2a2354fef0fc8c27a8e5ac2ae0026", "message": "Address review feedback", "committedDate": "2020-12-29T20:41:17Z", "type": "commit"}, {"oid": "e4848d9729af22d3679454054ee0aec571e7e4fb", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/e4848d9729af22d3679454054ee0aec571e7e4fb", "message": "Merge branch 'dev' into android/update-versions-gradle", "committedDate": "2020-12-29T20:58:37Z", "type": "commit"}]}