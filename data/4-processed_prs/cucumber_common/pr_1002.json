{"pr_number": 1002, "pr_title": "Add library to handle creation of the Meta message", "pr_createdAt": "2020-05-18T05:06:03Z", "pr_url": "https://github.com/cucumber/common/pull/1002", "timeline": [{"oid": "7788251b16c8edf4062c2878abece3ba59ca8121", "url": "https://github.com/cucumber/common/commit/7788251b16c8edf4062c2878abece3ba59ca8121", "message": "Start library create-meta: take JS version from fake-cucumber", "committedDate": "2020-05-18T04:43:40Z", "type": "commit"}, {"oid": "8d15978f77ea57e07f683af732dff06ead66d1f5", "url": "https://github.com/cucumber/common/commit/8d15978f77ea57e07f683af732dff06ead66d1f5", "message": "Use @cucumber/create-meta to generate the Meta message", "committedDate": "2020-05-18T04:58:00Z", "type": "commit"}, {"oid": "9decd4bc852f8d83f9bb9fd4ff57436b58caeb1f", "url": "https://github.com/cucumber/common/commit/9decd4bc852f8d83f9bb9fd4ff57436b58caeb1f", "message": "Use @cucumber/create-meta to generate the Meta message", "committedDate": "2020-05-18T05:02:06Z", "type": "commit"}, {"oid": "ee1673b7523a62033b22c713782567cab5ee0e4d", "url": "https://github.com/cucumber/common/commit/ee1673b7523a62033b22c713782567cab5ee0e4d", "message": "Include create-meta in base Makefile and CI jobs", "committedDate": "2020-05-18T05:11:29Z", "type": "commit"}, {"oid": "d52744ef9ed6407b3136cbafc5d365e3da1394a3", "url": "https://github.com/cucumber/common/commit/d52744ef9ed6407b3136cbafc5d365e3da1394a3", "message": "Also add a Ruby implementation for create-meta", "committedDate": "2020-05-18T05:37:34Z", "type": "commit"}, {"oid": "016ef545695e6b8ddc0ed34b1cc283599226f166", "url": "https://github.com/cucumber/common/commit/016ef545695e6b8ddc0ed34b1cc283599226f166", "message": "Enable CI for create-meta/ruby", "committedDate": "2020-05-18T05:39:25Z", "type": "commit"}, {"oid": "cbcc873bf12c33ae9125c27a3f4e47d475bbdcd3", "url": "https://github.com/cucumber/common/commit/cbcc873bf12c33ae9125c27a3f4e47d475bbdcd3", "message": "Add createMeta java version", "committedDate": "2020-05-18T07:13:43Z", "type": "commit"}, {"oid": "7d9b34b9486c28665bf8506167c4dded66c55f72", "url": "https://github.com/cucumber/common/commit/7d9b34b9486c28665bf8506167c4dded66c55f72", "message": "Enable createMeta/java on CI", "committedDate": "2020-05-18T07:15:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQzODE0NA==", "url": "https://github.com/cucumber/common/pull/1002#discussion_r426438144", "bodyText": "This will result in a rather annoying upgrade cycle. For every version of messages well have to release a new version of meta.\nI'd suggest creating only the meta object here and copying the fields over to the message in JVM.", "author": "mpkorstanje", "createdAt": "2020-05-18T08:02:56Z", "path": "create-meta/java/pom.xml", "diffHunk": "@@ -0,0 +1,63 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <parent>\n+        <groupId>io.cucumber</groupId>\n+        <artifactId>cucumber-parent</artifactId>\n+        <version>2.1.0</version>\n+    </parent>\n+\n+    <artifactId>create-meta</artifactId>\n+    <version>1.0.0-SNAPSHOT</version>\n+    <packaging>jar</packaging>\n+    <name>Cucumber create meta</name>\n+    <description>Produce the meta message for Cucumber Java</description>\n+    <url>https://github.com/cucumber/create-meta-java</url>\n+\n+    <properties>\n+        <project.Automatic-Module-Name>io.cucumber.createmeta</project.Automatic-Module-Name>\n+    </properties>\n+\n+    <scm>\n+        <connection>scm:git:git://github.com/cucumber/create-meta-java.git</connection>\n+        <developerConnection>scm:git:git@github.com:cucumber/create-meta-java.git</developerConnection>\n+        <url>git://github.com/cucumber/create-meta-java.git</url>\n+    </scm>\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-compiler-plugin</artifactId>\n+                <version>3.8.1</version>\n+            </plugin>\n+        </plugins>\n+    </build>\n+\n+    <dependencies>\n+        <dependency>\n+            <groupId>org.hamcrest</groupId>\n+            <artifactId>hamcrest</artifactId>\n+            <version>2.2</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.junit.jupiter</groupId>\n+            <artifactId>junit-jupiter-engine</artifactId>\n+            <version>5.6.1</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.junit.jupiter</groupId>\n+            <artifactId>junit-jupiter-params</artifactId>\n+            <version>5.6.1</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>io.cucumber</groupId>\n+            <artifactId>messages</artifactId>", "originalCommit": "7d9b34b9486c28665bf8506167c4dded66c55f72", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY0NDQxNw==", "url": "https://github.com/cucumber/common/pull/1002#discussion_r439644417", "bodyText": "What if we moved createMeta to the messages module? That solves the upgrade cycle problem.", "author": "aslakhellesoy", "createdAt": "2020-06-12T21:12:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQzODE0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY0NDQ4MA==", "url": "https://github.com/cucumber/common/pull/1002#discussion_r439644480", "bodyText": "The code looks great @vincent-psarga!", "author": "aslakhellesoy", "createdAt": "2020-06-12T21:12:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQzODE0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY0OTMwMQ==", "url": "https://github.com/cucumber/common/pull/1002#discussion_r439649301", "bodyText": "It would break the upgrade cycle but would also make the messages lib heavier.\nIt is actually the same problem with Gherkin. And we don't solve that by pushing Gherkin into messages either.\nSeperating the message and code that derives the information would be the best way.\nPushing down would be worse then keeping it as is.", "author": "mpkorstanje", "createdAt": "2020-06-12T21:27:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQzODE0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDExNjEzNg==", "url": "https://github.com/cucumber/common/pull/1002#discussion_r440116136", "bodyText": "I'd suggest creating only the meta object here and copying the fields over to the message in JVM.\n\n@mpkorstanje are you suggesting keeping the createMeta function in a separate module (create-meta), but decouple it from the messages module?\nThat works for me.", "author": "aslakhellesoy", "createdAt": "2020-06-15T11:42:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQzODE0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE1NjEwOQ==", "url": "https://github.com/cucumber/common/pull/1002#discussion_r440156109", "bodyText": "I don't really see the point in decoupling to be honest. Can't we simply declare a minimum supported version of messages for the library.\nTo give an example, we release messages version 14.0 and create-meta version 1.0 (which relies on messages v14.0 minimum).\nWhen we do a new release of messages but do not change the Meta message, we don't have anything to do in create-meta and no release needed.\nWhen we do change the Meta message (adding a field or whatever), we'll need anyway to update the code of create-meta to handle those changes and populate the added field.\nWhen we do a change in create-meta (for example extracting new CI information), we don't have to bump the minimum version of messages supported.\nI'm pretty sure I'm wrong somehow, but I don't see why :D", "author": "vincent-psarga", "createdAt": "2020-06-15T12:57:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQzODE0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxNTY0Mw==", "url": "https://github.com/cucumber/common/pull/1002#discussion_r441015643", "bodyText": "We'll have to fix the bit of code that removes version ranges when releasing the java modules.", "author": "mpkorstanje", "createdAt": "2020-06-16T17:18:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQzODE0NA=="}], "type": "inlineReview"}, {"oid": "df27023184d2254d7bd7317794863747b31fc2f7", "url": "https://github.com/cucumber/common/commit/df27023184d2254d7bd7317794863747b31fc2f7", "message": "Add EnvVariable to Meta message", "committedDate": "2020-05-18T09:44:56Z", "type": "commit"}, {"oid": "6497962aac3333a3c7f7189ff1f3af5d72e6f82b", "url": "https://github.com/cucumber/common/commit/6497962aac3333a3c7f7189ff1f3af5d72e6f82b", "message": "Replace EnvVariable by CI and more predictable data", "committedDate": "2020-05-18T12:43:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDY4NDAxOQ==", "url": "https://github.com/cucumber/common/pull/1002#discussion_r440684019", "bodyText": "I'm not sure this is the right name or abstraction. Git-specific information should be in a Git message I think. That way we can add support for other source control systems later if needed\nI'm not sure what name represents, or where it comes from. Same for projectName.\nHow about:\nmessage Git {\n  string remote = 2;\n  string revision = 3;\n  string branch = 4;\n  string tag = 5;\n}\n\nThe branch and tag fields should possibly be repeated since it's possible to have many.\nIn practice there will probably only be one, taken from common CI systems' environment variables.", "author": "aslakhellesoy", "createdAt": "2020-06-16T08:39:57Z", "path": "messages/dotnet/messages.proto", "diffHunk": "@@ -63,14 +63,26 @@ message Meta {\n \n   // 386, arm, amd64 etc\n   Product cpu = 5;\n-  \n+\n+  // CI environment\n+  CI ci = 6;\n+\n   // A product has a name and a version\n   message Product {\n     // The product name\n     string name = 1;\n     // The product version\n     string version = 2;\n   }\n+\n+  message CI {", "originalCommit": "6497962aac3333a3c7f7189ff1f3af5d72e6f82b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDcyNzg4NA==", "url": "https://github.com/cucumber/common/pull/1002#discussion_r440727884", "bodyText": "That seems a right level of abstraction. I guess notions like the projectName (it would be cucumber or cucumber-ruby in our case for example) could be extracted from those information.\nSo something like:\nmessage Git {\n  string remote = 1;\n  string revision = 2;\n  string branch = 3;\n  string tag = 4;\n}\n\nmessage CI {\n  string name = 1;\n  string buildId =1;\n}\n\nI'm not sure about repeating the branch/tags, even if a commit may belong to multiple tags and branch, generally we execute from a given branch or tag.", "author": "vincent-psarga", "createdAt": "2020-06-16T09:51:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDY4NDAxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAxNzg1Nw==", "url": "https://github.com/cucumber/common/pull/1002#discussion_r441017857", "bodyText": "Maybe we should make it clear that this isn't the git info but CI provided git info.", "author": "mpkorstanje", "createdAt": "2020-06-16T17:22:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDY4NDAxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE5MTM0MQ==", "url": "https://github.com/cucumber/common/pull/1002#discussion_r441191341", "bodyText": "Yes that's a good point. I think that would be made clear by nesting the Git message inside CI.", "author": "aslakhellesoy", "createdAt": "2020-06-16T23:09:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDY4NDAxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE5NDM0NQ==", "url": "https://github.com/cucumber/common/pull/1002#discussion_r441194345", "bodyText": "I think I'd prefer a hyperlink instead of a buildId. We could name it url - it would point to the CI build.\nI think we should remove name - it can be derived from remote", "author": "aslakhellesoy", "createdAt": "2020-06-16T23:19:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDY4NDAxOQ=="}], "type": "inlineReview"}, {"oid": "b7077371a009cce7cd93ef02a027e8b083d5c7ca", "url": "https://github.com/cucumber/common/commit/b7077371a009cce7cd93ef02a027e8b083d5c7ca", "message": "Merge branch 'master' into add-create-meta-lib", "committedDate": "2020-06-18T21:57:31Z", "type": "commit"}, {"oid": "77d152f01dae882e735085c0cca0d4d736011bed", "url": "https://github.com/cucumber/common/commit/77d152f01dae882e735085c0cca0d4d736011bed", "message": "Generate ci message in meta", "committedDate": "2020-06-21T21:46:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcwMDM2Nw==", "url": "https://github.com/cucumber/common/pull/1002#discussion_r444700367", "bodyText": "shouldn't it be CIDict, CISystem etc ? (with a capital I ) - although it might make the variable names a bit weird later in the code :/", "author": "vincent-psarga", "createdAt": "2020-06-24T07:33:32Z", "path": "create-meta/javascript/src/createMeta.ts", "diffHunk": "@@ -0,0 +1,129 @@\n+import os from 'os'\n+import { messages, version as protocolVersion } from '@cucumber/messages'\n+import defaultCiDict from './ciDict.json'\n+\n+export type CiDict = { [name: string]: CiSystem }", "originalCommit": "77d152f01dae882e735085c0cca0d4d736011bed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcxMTU3OQ==", "url": "https://github.com/cucumber/common/pull/1002#discussion_r444711579", "bodyText": "I prefer it as is. My personal favorite: XMLHTTPRequest, reads much better when written as XmlHttpRequest.", "author": "mpkorstanje", "createdAt": "2020-06-24T07:55:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcwMDM2Nw=="}], "type": "inlineReview"}, {"oid": "f4acf6ad03b2163a5693339285b0e1888b864038", "url": "https://github.com/cucumber/common/commit/f4acf6ad03b2163a5693339285b0e1888b864038", "message": "Merge master", "committedDate": "2020-06-24T09:57:15Z", "type": "commit"}, {"oid": "c97ec349902f98b2673312a104ffafd4c886c259", "url": "https://github.com/cucumber/common/commit/c97ec349902f98b2673312a104ffafd4c886c259", "message": "Copy the ciDict to all implementations", "committedDate": "2020-06-24T11:11:13Z", "type": "commit"}, {"oid": "9bc2148968397871d6992df382fd85eb05617e17", "url": "https://github.com/cucumber/common/commit/9bc2148968397871d6992df382fd85eb05617e17", "message": "Move test data", "committedDate": "2020-06-24T11:13:39Z", "type": "commit"}, {"oid": "8ba7bff4eece7ac64303d1767a6dbac234e950ca", "url": "https://github.com/cucumber/common/commit/8ba7bff4eece7ac64303d1767a6dbac234e950ca", "message": "createMeta java implementation produces CI", "committedDate": "2020-06-24T22:20:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4OTY4Mw==", "url": "https://github.com/cucumber/common/pull/1002#discussion_r445389683", "bodyText": "Can we avoid this dependency or only use it in test scope? When using the mvn exec:java plugin you can execute code in test scope. This way we don't need to include the main method in the jar that is distributed.", "author": "mpkorstanje", "createdAt": "2020-06-25T08:22:27Z", "path": "create-meta/java/pom.xml", "diffHunk": "@@ -25,39 +25,38 @@\n         <url>git://github.com/cucumber/create-meta-java.git</url>\n     </scm>\n \n-    <build>\n-        <plugins>\n-            <plugin>\n-                <groupId>org.apache.maven.plugins</groupId>\n-                <artifactId>maven-compiler-plugin</artifactId>\n-                <version>3.8.1</version>\n-            </plugin>\n-        </plugins>\n-    </build>\n-\n     <dependencies>\n+        <dependency>\n+            <groupId>io.cucumber</groupId>\n+            <artifactId>messages</artifactId>\n+            <version>12.1.2-SNAPSHOT</version>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>com.eclipsesource.minimal-json</groupId>\n+            <artifactId>minimal-json</artifactId>\n+            <version>0.9.5</version>", "originalCommit": "8ba7bff4eece7ac64303d1767a6dbac234e950ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ0NTc5Nw==", "url": "https://github.com/cucumber/common/pull/1002#discussion_r445445797", "bodyText": "The library needs to read ciDict.json at runtime. I was going to shade it like it's done elsewhere.\nDo you have a different suggestion @mpkorstanje?", "author": "aslakhellesoy", "createdAt": "2020-06-25T09:58:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4OTY4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTUxMzcyMw==", "url": "https://github.com/cucumber/common/pull/1002#discussion_r445513723", "bodyText": "Never-mind. I saw it used in the main method and figured that was it. Shading will have to do.", "author": "mpkorstanje", "createdAt": "2020-06-25T12:17:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM4OTY4Mw=="}], "type": "inlineReview"}, {"oid": "4cffcc5df27513f85bd59655f809ce40eea65794", "url": "https://github.com/cucumber/common/commit/4cffcc5df27513f85bd59655f809ce40eea65794", "message": "Merge master", "committedDate": "2020-06-25T09:47:01Z", "type": "commit"}, {"oid": "c4b8d2b7efdd572fe8196de69fda508e504d7a4f", "url": "https://github.com/cucumber/common/commit/c4b8d2b7efdd572fe8196de69fda508e504d7a4f", "message": "Merge branch 'master' into add-create-meta-lib", "committedDate": "2020-06-25T09:55:00Z", "type": "commit"}, {"oid": "a69debc0c5c432a0038408f63d53df2ab97f4df0", "url": "https://github.com/cucumber/common/commit/a69debc0c5c432a0038408f63d53df2ab97f4df0", "message": "Set explicit implementations", "committedDate": "2020-06-25T09:55:53Z", "type": "commit"}, {"oid": "400a131065a82f8a85db6a2d3a3d26b4b96e4aaf", "url": "https://github.com/cucumber/common/commit/400a131065a82f8a85db6a2d3a3d26b4b96e4aaf", "message": "Shade minimal-json", "committedDate": "2020-06-25T12:35:39Z", "type": "commit"}, {"oid": "1fe4887ba5f5fddca787ec8638074c6c5be0508a", "url": "https://github.com/cucumber/common/commit/1fe4887ba5f5fddca787ec8638074c6c5be0508a", "message": "Merge branch 'master' into add-create-meta-lib", "committedDate": "2020-06-26T09:45:42Z", "type": "commit"}, {"oid": "014bd43b53593287224f03579b99cc20cdfc88bb", "url": "https://github.com/cucumber/common/commit/014bd43b53593287224f03579b99cc20cdfc88bb", "message": "Merge branch 'master' into add-create-meta-lib", "committedDate": "2020-06-26T11:14:12Z", "type": "commit"}, {"oid": "ed74fb5b0238aa00189d2e05ec676078c6a7fa7c", "url": "https://github.com/cucumber/common/commit/ed74fb5b0238aa00189d2e05ec676078c6a7fa7c", "message": "createMeta for ruby", "committedDate": "2020-06-26T12:43:23Z", "type": "commit"}]}