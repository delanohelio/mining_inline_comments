{"pr_number": 1280, "pr_title": "Verify HTML reports with puppeteer", "pr_createdAt": "2020-12-18T12:27:08Z", "pr_url": "https://github.com/cucumber/common/pull/1280", "timeline": [{"oid": "0b53d8c21064c700b539db0e8b6084f1a910eec0", "url": "https://github.com/cucumber/common/commit/0b53d8c21064c700b539db0e8b6084f1a910eec0", "message": "Release html-formatter v11.0.2", "committedDate": "2020-12-17T16:49:44Z", "type": "commit"}, {"oid": "ae5b3a77ad93844f049376205262cf24aa9136dd", "url": "https://github.com/cucumber/common/commit/ae5b3a77ad93844f049376205262cf24aa9136dd", "message": "Downgrade from webpack 5 to 4", "committedDate": "2020-12-17T21:53:54Z", "type": "commit"}, {"oid": "992717249d00641768825daf5af807b78bd09e53", "url": "https://github.com/cucumber/common/commit/992717249d00641768825daf5af807b78bd09e53", "message": "Check all generated HTML files with puppeteer", "committedDate": "2020-12-18T12:24:25Z", "type": "commit"}, {"oid": "790c061866ffe2b2ae3b1eec3230db59e45bf60d", "url": "https://github.com/cucumber/common/commit/790c061866ffe2b2ae3b1eec3230db59e45bf60d", "message": "Change references", "committedDate": "2020-12-18T12:28:18Z", "type": "commit"}, {"oid": "b243e28ffed2cdfc6b990519a938f1099daac832", "url": "https://github.com/cucumber/common/commit/b243e28ffed2cdfc6b990519a938f1099daac832", "message": "Capture puppeteer errors", "committedDate": "2020-12-18T12:49:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTgwOTM4Nw==", "url": "https://github.com/cucumber/common/pull/1280#discussion_r545809387", "bodyText": "What purpose does the PDF generation serve?", "author": "davidjgoss", "createdAt": "2020-12-18T12:47:35Z", "path": "html-formatter/javascript/check.js", "diffHunk": "@@ -0,0 +1,22 @@\n+const fs = require('fs')\n+const path = process.argv[2]\n+const html = fs.readFileSync(path, 'utf-8')\n+const puppeteer = require('puppeteer');\n+\n+(async () => {\n+  const browser = await puppeteer.launch();\n+  const page = await browser.newPage();\n+  await page.setContent(html)\n+  await page.pdf({path: 'hn.pdf', format: 'A4'});", "originalCommit": "790c061866ffe2b2ae3b1eec3230db59e45bf60d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTgxMjYxMw==", "url": "https://github.com/cucumber/common/pull/1280#discussion_r545812613", "bodyText": "re: pdf. Copy paste error - removed", "author": "aslakhellesoy", "createdAt": "2020-12-18T12:54:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTgwOTM4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTgxMDQ3Mw==", "url": "https://github.com/cucumber/common/pull/1280#discussion_r545810473", "bodyText": "Not sure if there could be errors in lower components (e.g. markdown) but the root one still render enough for this to pass?\nTo solve a similar problem before I've queried the console for errors - I could always do a follow up if you think it's a good idea.", "author": "davidjgoss", "createdAt": "2020-12-18T12:49:37Z", "path": "html-formatter/javascript/check.js", "diffHunk": "@@ -0,0 +1,22 @@\n+const fs = require('fs')\n+const path = process.argv[2]\n+const html = fs.readFileSync(path, 'utf-8')\n+const puppeteer = require('puppeteer');\n+\n+(async () => {\n+  const browser = await puppeteer.launch();\n+  const page = await browser.newPage();\n+  await page.setContent(html)\n+  await page.pdf({path: 'hn.pdf', format: 'A4'});\n+  const dynamicHTML = await page.evaluate(() => {\n+    const content = document.querySelector('.cucumber-react')", "originalCommit": "790c061866ffe2b2ae3b1eec3230db59e45bf60d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTgxMzQzMA==", "url": "https://github.com/cucumber/common/pull/1280#discussion_r545813430", "bodyText": "Yes, inspecting console errors could be useful too. This check does not guarantee absence of errors, but it does detect presence of errors. I think that's a good start.\nBut we have a problem with CircleCI launching puppeteer.....", "author": "aslakhellesoy", "createdAt": "2020-12-18T12:55:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTgxMDQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTgyMzg2Mg==", "url": "https://github.com/cucumber/common/pull/1280#discussion_r545823862", "bodyText": "I've seen this before. They started requiring some libraries on the host system from 3.0.0 inc. libgbm.", "author": "davidjgoss", "createdAt": "2020-12-18T13:15:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTgxMDQ3Mw=="}], "type": "inlineReview"}, {"oid": "b09797d94562bfe756a4426f3c35c773f3ce7e31", "url": "https://github.com/cucumber/common/commit/b09797d94562bfe756a4426f3c35c773f3ce7e31", "message": "Remove pdf", "committedDate": "2020-12-18T12:53:48Z", "type": "commit"}, {"oid": "97e254739e946c352ea529758a08d87cb5905d8d", "url": "https://github.com/cucumber/common/commit/97e254739e946c352ea529758a08d87cb5905d8d", "message": "Tweak puppeteer environment and settings", "committedDate": "2020-12-18T13:10:40Z", "type": "commit"}, {"oid": "9e4a2b129a7592057a7d49b94a583247eddb8492", "url": "https://github.com/cucumber/common/commit/9e4a2b129a7592057a7d49b94a583247eddb8492", "message": "Only do integrity check when package.json points to released modules", "committedDate": "2020-12-18T15:35:27Z", "type": "commit"}]}