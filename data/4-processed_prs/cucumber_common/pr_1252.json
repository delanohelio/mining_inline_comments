{"pr_number": 1252, "pr_title": "include offending line in error message", "pr_createdAt": "2020-11-19T12:53:01Z", "pr_url": "https://github.com/cucumber/common/pull/1252", "timeline": [{"oid": "d4b3221513b38d13b5631197355ca9dd2285da81", "url": "https://github.com/cucumber/common/commit/d4b3221513b38d13b5631197355ca9dd2285da81", "message": "include offending line in error message", "committedDate": "2020-11-19T12:51:07Z", "type": "commit"}, {"oid": "47c65c0880a0758562e16e252137f36fd2735edc", "url": "https://github.com/cucumber/common/commit/47c65c0880a0758562e16e252137f36fd2735edc", "message": "Fix JavaScript impl", "committedDate": "2020-11-19T13:27:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg4NTQ2OQ==", "url": "https://github.com/cucumber/common/pull/1252#discussion_r526885469", "bodyText": "Perhaps also include the original error and stack trace? That way we know what the parser was complaining about.", "author": "mpkorstanje", "createdAt": "2020-11-19T13:33:03Z", "path": "messages/javascript/src/NdjsonToMessageStream.ts", "diffHunk": "@@ -43,7 +43,7 @@ export default class NdjsonToMessageStream<T> extends Transform {\n         const object = JSON.parse(this.buffer)\n         this.push(this.fromObject(object))\n       } catch (err) {\n-        return callback(err)\n+        return callback(new Error(`Not JSONs: ${this.buffer}`))", "originalCommit": "47c65c0880a0758562e16e252137f36fd2735edc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkwODUyMg==", "url": "https://github.com/cucumber/common/pull/1252#discussion_r526908522", "bodyText": "That's not easily done in JavaScript - exceptions can't have references to other exceptsions like in Java. I don't think it's needed either.", "author": "aslakhellesoy", "createdAt": "2020-11-19T14:00:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg4NTQ2OQ=="}], "type": "inlineReview"}, {"oid": "ef84fd895f200e5bedd5a1ae4d150b97eaa86326", "url": "https://github.com/cucumber/common/commit/ef84fd895f200e5bedd5a1ae4d150b97eaa86326", "message": "Merge branch 'master' into messages-include-line-in-error", "committedDate": "2020-11-19T13:55:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkwNTY3Ng==", "url": "https://github.com/cucumber/common/pull/1252#discussion_r526905676", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    throw new RuntimeException(String.format(\"Not JSON: %s\", line));\n          \n          \n            \n                                    throw new RuntimeException(String.format(\"Not JSON: %s\", line), e);", "author": "mpkorstanje", "createdAt": "2020-11-19T13:56:37Z", "path": "messages/java/src/main/java/io/cucumber/messages/NdjsonToMessageIterable.java", "diffHunk": "@@ -37,7 +38,11 @@ public boolean hasNext() {\n                         return hasNext();\n                     }\n                     Messages.Envelope.Builder builder = Messages.Envelope.newBuilder();\n-                    JSON_PARSER.merge(line, builder);\n+                    try {\n+                        JSON_PARSER.merge(line, builder);\n+                    } catch(InvalidProtocolBufferException e) {\n+                        throw new RuntimeException(String.format(\"Not JSON: %s\", line));", "originalCommit": "ef84fd895f200e5bedd5a1ae4d150b97eaa86326", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "104dc913e10fb7507b3f2c2c5b07677146de6be8", "url": "https://github.com/cucumber/common/commit/104dc913e10fb7507b3f2c2c5b07677146de6be8", "message": "Update messages/java/src/main/java/io/cucumber/messages/NdjsonToMessageIterable.java\n\nCo-authored-by: M.P. Korstanje <mpkorstanje@users.noreply.github.com>", "committedDate": "2020-11-19T14:01:01Z", "type": "commit"}]}