{"pr_number": 3167, "pr_title": "GH-3155: Add support for Java DSL extensions", "pr_createdAt": "2020-02-05T16:05:30Z", "pr_url": "https://github.com/spring-projects/spring-integration/pull/3167", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA3MTUxNw==", "url": "https://github.com/spring-projects/spring-integration/pull/3167#discussion_r376071517", "bodyText": "s/allow to extend an existing.../allow extension of the existing Java DSL with custom or composed.../", "author": "garyrussell", "createdAt": "2020-02-06T20:43:51Z", "path": "src/reference/asciidoc/dsl.adoc", "diffHunk": "@@ -1202,3 +1202,63 @@ That `errorRecovererFlow` can be used as follows:\n private Function<String, String> errorRecovererFlowGateway;\n ----\n ====\n+\n+[[java-dsl-extensions]]\n+=== DSL Extensions\n+\n+Starting with version 5.3, an `IntegrationFlowExtension` has been introduced to allow to extend an existing Java DSL to any possible custom or composed EIP-operators.", "originalCommit": "e1053e8a287e1d35c3ea2cd31e42e9efe82e605c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA3MjA5Mg==", "url": "https://github.com/spring-projects/spring-integration/pull/3167#discussion_r376072092", "bodyText": "All that is needed is an extension of this class that provides methods which can be used in...", "author": "garyrussell", "createdAt": "2020-02-06T20:45:06Z", "path": "src/reference/asciidoc/dsl.adoc", "diffHunk": "@@ -1202,3 +1202,63 @@ That `errorRecovererFlow` can be used as follows:\n private Function<String, String> errorRecovererFlowGateway;\n ----\n ====\n+\n+[[java-dsl-extensions]]\n+=== DSL Extensions\n+\n+Starting with version 5.3, an `IntegrationFlowExtension` has been introduced to allow to extend an existing Java DSL to any possible custom or composed EIP-operators.\n+There is only enough to extend this class and write methods which are going to be used in the `IntegrationFlow` bean definitions.", "originalCommit": "e1053e8a287e1d35c3ea2cd31e42e9efe82e605c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA3Mjc4Mw==", "url": "https://github.com/spring-projects/spring-integration/pull/3167#discussion_r376072783", "bodyText": "return s/an/the/ extension", "author": "garyrussell", "createdAt": "2020-02-06T20:46:39Z", "path": "src/reference/asciidoc/dsl.adoc", "diffHunk": "@@ -1202,3 +1202,63 @@ That `errorRecovererFlow` can be used as follows:\n private Function<String, String> errorRecovererFlowGateway;\n ----\n ====\n+\n+[[java-dsl-extensions]]\n+=== DSL Extensions\n+\n+Starting with version 5.3, an `IntegrationFlowExtension` has been introduced to allow to extend an existing Java DSL to any possible custom or composed EIP-operators.\n+There is only enough to extend this class and write methods which are going to be used in the `IntegrationFlow` bean definitions.\n+The extension class can also be used for custom `IntegrationComponentSpec` configuration; for example, missed or default options can be implemented in the existing `IntegrationComponentSpec` extension.\n+The sample below demonstrates a composite custom operator and usage of an `AggregatorSpec` extension for a default custom `outputProcessor`:\n+\n+====\n+[source,java]\n+----\n+public class CustomIntegrationFlowDefinition\n+        extends IntegrationFlowExtension<CustomIntegrationFlowDefinition> {\n+\n+    public CustomIntegrationFlowDefinition upperCaseAfterSplit() {\n+        return split()\n+                .transform(\"payload.toUpperCase()\");\n+    }\n+\n+    public CustomIntegrationFlowDefinition customAggregate(Consumer<CustomAggregatorSpec> aggregator) {\n+        return register(new CustomAggregatorSpec(), aggregator);\n+    }\n+\n+}\n+\n+public class CustomAggregatorSpec extends AggregatorSpec {\n+\n+    CustomAggregatorSpec() {\n+        outputProcessor(group ->\n+                group.getMessages()\n+                        .stream()\n+                        .map(Message::getPayload)\n+                        .map(String.class::cast)\n+                        .collect(Collectors.joining(\", \")));\n+    }\n+\n+}\n+----\n+====\n+\n+For a method chain flow the new DSL operator in these extensions must return an extension class.", "originalCommit": "e1053e8a287e1d35c3ea2cd31e42e9efe82e605c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA3MzEzOA==", "url": "https://github.com/spring-projects/spring-integration/pull/3167#discussion_r376073138", "bodyText": "s/will look naturally with/will work with/", "author": "garyrussell", "createdAt": "2020-02-06T20:47:26Z", "path": "src/reference/asciidoc/dsl.adoc", "diffHunk": "@@ -1202,3 +1202,63 @@ That `errorRecovererFlow` can be used as follows:\n private Function<String, String> errorRecovererFlowGateway;\n ----\n ====\n+\n+[[java-dsl-extensions]]\n+=== DSL Extensions\n+\n+Starting with version 5.3, an `IntegrationFlowExtension` has been introduced to allow to extend an existing Java DSL to any possible custom or composed EIP-operators.\n+There is only enough to extend this class and write methods which are going to be used in the `IntegrationFlow` bean definitions.\n+The extension class can also be used for custom `IntegrationComponentSpec` configuration; for example, missed or default options can be implemented in the existing `IntegrationComponentSpec` extension.\n+The sample below demonstrates a composite custom operator and usage of an `AggregatorSpec` extension for a default custom `outputProcessor`:\n+\n+====\n+[source,java]\n+----\n+public class CustomIntegrationFlowDefinition\n+        extends IntegrationFlowExtension<CustomIntegrationFlowDefinition> {\n+\n+    public CustomIntegrationFlowDefinition upperCaseAfterSplit() {\n+        return split()\n+                .transform(\"payload.toUpperCase()\");\n+    }\n+\n+    public CustomIntegrationFlowDefinition customAggregate(Consumer<CustomAggregatorSpec> aggregator) {\n+        return register(new CustomAggregatorSpec(), aggregator);\n+    }\n+\n+}\n+\n+public class CustomAggregatorSpec extends AggregatorSpec {\n+\n+    CustomAggregatorSpec() {\n+        outputProcessor(group ->\n+                group.getMessages()\n+                        .stream()\n+                        .map(Message::getPayload)\n+                        .map(String.class::cast)\n+                        .collect(Collectors.joining(\", \")));\n+    }\n+\n+}\n+----\n+====\n+\n+For a method chain flow the new DSL operator in these extensions must return an extension class.\n+This way a target `IntegrationFlow` definition will look naturally with new and existing DSL operators:", "originalCommit": "e1053e8a287e1d35c3ea2cd31e42e9efe82e605c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA3MzYzNA==", "url": "https://github.com/spring-projects/spring-integration/pull/3167#discussion_r376073634", "bodyText": "Same change as first comment in adoc above.", "author": "garyrussell", "createdAt": "2020-02-06T20:48:27Z", "path": "src/reference/asciidoc/whats-new.adoc", "diffHunk": "@@ -27,18 +27,20 @@ See its JavaDocs and <<./graph.adoc#integration-graph,Integration Graph>> for mo\n The `ReactiveMessageHandler` is now natively supported in the framework.\n See <<./reactive-streams.adoc/reactive-message-handler,ReactiveMessageHandler>> for more information.\n \n+[[x5.3-java-dsl-extensions]]\n+==== Java DSL Extensions\n+\n+A new `IntegrationFlowExtension` API has been introduced to allow to extend an existing Java DSL for custom and composite EIP-operators.", "originalCommit": "e1053e8a287e1d35c3ea2cd31e42e9efe82e605c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA3Mzc2Mg==", "url": "https://github.com/spring-projects/spring-integration/pull/3167#discussion_r376073762", "bodyText": "can be used to introduce customizers...", "author": "garyrussell", "createdAt": "2020-02-06T20:48:47Z", "path": "src/reference/asciidoc/whats-new.adoc", "diffHunk": "@@ -27,18 +27,20 @@ See its JavaDocs and <<./graph.adoc#integration-graph,Integration Graph>> for mo\n The `ReactiveMessageHandler` is now natively supported in the framework.\n See <<./reactive-streams.adoc/reactive-message-handler,ReactiveMessageHandler>> for more information.\n \n+[[x5.3-java-dsl-extensions]]\n+==== Java DSL Extensions\n+\n+A new `IntegrationFlowExtension` API has been introduced to allow to extend an existing Java DSL for custom and composite EIP-operators.\n+This also can be used for introduction customizers for any out-of-the-box `IntegrationComponentSpec` extensions.", "originalCommit": "e1053e8a287e1d35c3ea2cd31e42e9efe82e605c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA3NDA2Mw==", "url": "https://github.com/spring-projects/spring-integration/pull/3167#discussion_r376074063", "bodyText": "matches the header in the first message of the group.", "author": "garyrussell", "createdAt": "2020-02-06T20:49:27Z", "path": "src/reference/asciidoc/whats-new.adoc", "diffHunk": "@@ -48,6 +50,9 @@ See <<./gateway.adoc/gateway-calling-default-methods,Invoking `default` Methods>\n Internal components (such as `_org.springframework.integration.errorLogger`) now have a shortened name when they are represented in the integration graph.\n See <<./graph.adoc#integration-graph,Integration Graph>> for more information.\n \n+In the aggregator, when the `MessageGroupProcessor` returns a `Message`, the `MessageBuilder.popSequenceDetails()` is performed on the output message if the `sequenceDetails` matches with first message of group.\n+See <<./aggregator.adoc#aggregator-api,Aggregator Programming Model>> for more information.", "originalCommit": "e1053e8a287e1d35c3ea2cd31e42e9efe82e605c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8ceb433d8ba2dbdbd2cc35c3c3a36cf884d34deb", "url": "https://github.com/spring-projects/spring-integration/commit/8ceb433d8ba2dbdbd2cc35c3c3a36cf884d34deb", "message": "GH-3155: Add support for Java DSL extensions\n\nFixes https://github.com/spring-projects/spring-integration/issues/3155\n\nProvide an `IntegrationFlowExtension` for possible custom EI-operators\nin the target project use-cases.", "committedDate": "2020-02-06T21:56:37Z", "type": "commit"}, {"oid": "53a45650eb32f6ee5124c51d7c67664babf633de", "url": "https://github.com/spring-projects/spring-integration/commit/53a45650eb32f6ee5124c51d7c67664babf633de", "message": "* Move `IntegrationFlowExtension` tests ot its own test class\n* Make all the `IntegrationComponentSpec` ctors as `protected` for possible custom extensions\n* Make some `BaseIntegrationFlowDefinition` methods and properties as `protected` to get them\naccess from the `IntegrationFlowExtension` implementations\n* Document the feature", "committedDate": "2020-02-06T21:57:03Z", "type": "commit"}, {"oid": "41e01869584c715f47a0a6ed5f61a0f9cee6a44b", "url": "https://github.com/spring-projects/spring-integration/commit/41e01869584c715f47a0a6ed5f61a0f9cee6a44b", "message": "* Fix language and typos in docs", "committedDate": "2020-02-06T22:03:59Z", "type": "commit"}, {"oid": "41e01869584c715f47a0a6ed5f61a0f9cee6a44b", "url": "https://github.com/spring-projects/spring-integration/commit/41e01869584c715f47a0a6ed5f61a0f9cee6a44b", "message": "* Fix language and typos in docs", "committedDate": "2020-02-06T22:03:59Z", "type": "forcePushed"}, {"oid": "f2e9d63bb061205e0c40be6e66ea3ad4aba8050c", "url": "https://github.com/spring-projects/spring-integration/commit/f2e9d63bb061205e0c40be6e66ea3ad4aba8050c", "message": "* Add `protected` to one more `GatewayEndpointSpec` ctor\n* Add JavaDocs to `GatewayEndpointSpec` methods", "committedDate": "2020-02-07T16:52:54Z", "type": "commit"}, {"oid": "5ce41b88b82cdadaf493375de78e3873c29b795d", "url": "https://github.com/spring-projects/spring-integration/commit/5ce41b88b82cdadaf493375de78e3873c29b795d", "message": "* Add `protected` to one more `JmsPollableMessageChannelSpec` ctor", "committedDate": "2020-02-07T17:52:28Z", "type": "commit"}]}