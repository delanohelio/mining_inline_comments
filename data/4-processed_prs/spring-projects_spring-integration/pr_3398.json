{"pr_number": 3398, "pr_title": "GH-3396: Add Docs for Micrometer MeterFilters", "pr_createdAt": "2020-10-02T16:20:40Z", "pr_url": "https://github.com/spring-projects/spring-integration/pull/3398", "timeline": [{"oid": "1cac3192972617ffdcebff020683d15c4fe1d1f8", "url": "https://github.com/spring-projects/spring-integration/commit/1cac3192972617ffdcebff020683d15c4fe1d1f8", "message": "GH-3396: Add Docs for Micrometer MeterFilters\n\nResolves https://github.com/spring-projects/spring-integration/issues/3396", "committedDate": "2020-10-02T16:19:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkzODM0OQ==", "url": "https://github.com/spring-projects/spring-integration/pull/3398#discussion_r498938349", "bodyText": "Any chances to have some sample how to disable metrics for example for myChannel bean?", "author": "artembilan", "createdAt": "2020-10-02T16:55:15Z", "path": "src/reference/asciidoc/metrics.adoc", "diffHunk": "@@ -118,3 +120,11 @@ and\n * `tag`: `type:channel`\n * `tag`: `name:<componentName>`\n * `description`: `The remaining capacity of the queue channel`\n+\n+===== Disabling Meters\n+\n+With the <<legacy-metrics>> (which have now been removed), you could specify which integration components would collect metrics.\n+By default, all meters are registered when first used.\n+Now, with Micrometer, you can add `MeterFilter` s to the `MeterRegistry` to prevent some or all from being registered.\n+You can filter out (deny) meters by any of the properties provided, `name`, `tag`, etc.\n+See https://micrometer.io/docs/concepts#_meter_filters[Meter Filters] in the Micrometer documentation for more information.", "originalCommit": "1cac3192972617ffdcebff020683d15c4fe1d1f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "06e60ca6362a556ce141fb31a3cf01a7bd580b90", "url": "https://github.com/spring-projects/spring-integration/commit/06e60ca6362a556ce141fb31a3cf01a7bd580b90", "message": "Add example.", "committedDate": "2020-10-02T17:57:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk3MjMzNA==", "url": "https://github.com/spring-projects/spring-integration/pull/3398#discussion_r498972334", "bodyText": "Probably writing this test you were going to add something to docs.\nAren't you?", "author": "artembilan", "createdAt": "2020-10-02T18:06:40Z", "path": "spring-integration-core/src/test/java/org/springframework/integration/support/management/micrometer/MicrometerMetricsTests.java", "diffHunk": "@@ -264,7 +275,11 @@ public void testMicrometerMetrics() {\n \n \t\t@Bean\n \t\tpublic static MeterRegistry meterRegistry() {\n-\t\t\treturn new SimpleMeterRegistry();\n+\t\t\tSimpleMeterRegistry registry = new SimpleMeterRegistry();\n+\t\t\tregistry.config().meterFilter(MeterFilter.deny(id ->\n+\t\t\t\t\t\"channel\".equals(id.getTag(\"type\")) &&\n+\t\t\t\t\t\"noMeters\".equals(id.getTag(\"name\"))));", "originalCommit": "06e60ca6362a556ce141fb31a3cf01a7bd580b90", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "37319e92b26a5a5c1d8d0da0fa0a727324bfc811", "url": "https://github.com/spring-projects/spring-integration/commit/37319e92b26a5a5c1d8d0da0fa0a727324bfc811", "message": "Commit unsaved editor changes.", "committedDate": "2020-10-02T18:18:50Z", "type": "commit"}]}