{"pr_number": 3402, "pr_title": "GH-3356: Add the way to not load mail message", "pr_createdAt": "2020-10-12T19:55:11Z", "pr_url": "https://github.com/spring-projects/spring-integration/pull/3402", "timeline": [{"oid": "48b9323872a6adc487305581634694876ec3bc4b", "url": "https://github.com/spring-projects/spring-integration/commit/48b9323872a6adc487305581634694876ec3bc4b", "message": "GH-3356: Add the way to not load mail message\n\nFixes https://github.com/spring-projects/spring-integration/issues/3356\n\nIn some cases it is not necessary to have a whole mail message to be load\nwhen it could be filtered out downstream\n\n* Treat \"no eager load\" for `MimeMessage` in the `AbstractMailReceiver`\nwhen no `headerMapper`, not `simpleContent` and no `autoCloseFolder`", "committedDate": "2020-10-12T19:54:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUwNzIzNg==", "url": "https://github.com/spring-projects/spring-integration/pull/3402#discussion_r503507236", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            These functionality is possible with these options combination: no `headerMapper` provided, the `simpleContent` is disabled and the `autoCloseFolder` is turned off.\n          \n          \n            \n            This functionality is enabled with this combination of options: no `headerMapper` provided, the `simpleContent` property is `false` and the `autoCloseFolder` property is `false`.", "author": "garyrussell", "createdAt": "2020-10-12T20:04:58Z", "path": "src/reference/asciidoc/mail.adoc", "diffHunk": "@@ -128,13 +128,17 @@ Closeable closeableResource = StaticMessageHeaderAccessor.getCloseableResource(m\n if (closeableResource != null) {\n     closeableResource.close();\n }\n-\n ----\n ====\n \n Keeping the folder open is useful in cases where communication with the server is needed during parsing multipart content of the email with attachments.\n The `close()` on the `IntegrationMessageHeaderAccessor.CLOSEABLE_RESOURCE` header delegates to the `AbstractMailReceiver` to close the folder with `expunge` option if `shouldDeleteMessages` is configured respectively on the `AbstractMailReceiver`.\n \n+Starting with version 5.4, it is possible now to return a `MimeMessage` as is without any conversion or eager content loading.\n+These functionality is possible with these options combination: no `headerMapper` provided, the `simpleContent` is disabled and the `autoCloseFolder` is turned off.", "originalCommit": "48b9323872a6adc487305581634694876ec3bc4b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUwODE0MA==", "url": "https://github.com/spring-projects/spring-integration/pull/3402#discussion_r503508140", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The whole `MimeMessage` is present as a payload of the Spring message to produce.\n          \n          \n            \n            The `MimeMessage` is present as the payload of the Spring message produced.", "author": "garyrussell", "createdAt": "2020-10-12T20:07:14Z", "path": "src/reference/asciidoc/mail.adoc", "diffHunk": "@@ -128,13 +128,17 @@ Closeable closeableResource = StaticMessageHeaderAccessor.getCloseableResource(m\n if (closeableResource != null) {\n     closeableResource.close();\n }\n-\n ----\n ====\n \n Keeping the folder open is useful in cases where communication with the server is needed during parsing multipart content of the email with attachments.\n The `close()` on the `IntegrationMessageHeaderAccessor.CLOSEABLE_RESOURCE` header delegates to the `AbstractMailReceiver` to close the folder with `expunge` option if `shouldDeleteMessages` is configured respectively on the `AbstractMailReceiver`.\n \n+Starting with version 5.4, it is possible now to return a `MimeMessage` as is without any conversion or eager content loading.\n+These functionality is possible with these options combination: no `headerMapper` provided, the `simpleContent` is disabled and the `autoCloseFolder` is turned off.\n+The whole `MimeMessage` is present as a payload of the Spring message to produce.", "originalCommit": "48b9323872a6adc487305581634694876ec3bc4b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUwOTA0OA==", "url": "https://github.com/spring-projects/spring-integration/pull/3402#discussion_r503509048", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Only a header presented is the mentioned above `IntegrationMessageHeaderAccessor.CLOSEABLE_RESOURCE` for the folder to close when done with the `MimeMessage` processing.\n          \n          \n            \n            In this case, the only header populated is the above mentioned `IntegrationMessageHeaderAccessor.CLOSEABLE_RESOURCE` for the folder which must be closed when processing of the the `MimeMessage` is complete.", "author": "garyrussell", "createdAt": "2020-10-12T20:09:25Z", "path": "src/reference/asciidoc/mail.adoc", "diffHunk": "@@ -128,13 +128,17 @@ Closeable closeableResource = StaticMessageHeaderAccessor.getCloseableResource(m\n if (closeableResource != null) {\n     closeableResource.close();\n }\n-\n ----\n ====\n \n Keeping the folder open is useful in cases where communication with the server is needed during parsing multipart content of the email with attachments.\n The `close()` on the `IntegrationMessageHeaderAccessor.CLOSEABLE_RESOURCE` header delegates to the `AbstractMailReceiver` to close the folder with `expunge` option if `shouldDeleteMessages` is configured respectively on the `AbstractMailReceiver`.\n \n+Starting with version 5.4, it is possible now to return a `MimeMessage` as is without any conversion or eager content loading.\n+These functionality is possible with these options combination: no `headerMapper` provided, the `simpleContent` is disabled and the `autoCloseFolder` is turned off.\n+The whole `MimeMessage` is present as a payload of the Spring message to produce.\n+Only a header presented is the mentioned above `IntegrationMessageHeaderAccessor.CLOSEABLE_RESOURCE` for the folder to close when done with the `MimeMessage` processing.", "originalCommit": "48b9323872a6adc487305581634694876ec3bc4b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUxMDY3Nw==", "url": "https://github.com/spring-projects/spring-integration/pull/3402#discussion_r503510677", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Starting with version 5.4, when no `headerMapper`, no `autoCloseFolder` and no `simpleContent`, the `MimeMessage` is returned as is in the payload of produced Spring message.\n          \n          \n            \n            This way a content of the `MimeMessage` is loaded on demand.\n          \n          \n            \n            All the mentioned above transformations are still valid.\n          \n          \n            \n            Starting with version 5.4, when no `headerMapper` is provided, `autoCloseFolder` is `false` and `simpleContent` is `false`, the `MimeMessage` is returned as-is in the payload of the Spring message produced.\n          \n          \n            \n            This way, the content of the `MimeMessage` is loaded on demand when referenced, later in the flow.\n          \n          \n            \n            All of the mentioned above transformations are still valid.", "author": "garyrussell", "createdAt": "2020-10-12T20:13:11Z", "path": "src/reference/asciidoc/mail.adoc", "diffHunk": "@@ -210,6 +214,10 @@ Starting with version 4.3, the transformer handles embedded `Part` instances (as\n The transformer is a subclass of `AbstractMailTransformer` that maps the address and subject headers from the preceding list.\n If you wish to perform some other transformation on the message, consider subclassing `AbstractMailTransformer`.\n \n+Starting with version 5.4, when no `headerMapper`, no `autoCloseFolder` and no `simpleContent`, the `MimeMessage` is returned as is in the payload of produced Spring message.\n+This way a content of the `MimeMessage` is loaded on demand.\n+All the mentioned above transformations are still valid.", "originalCommit": "48b9323872a6adc487305581634694876ec3bc4b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUxMTI1NQ==", "url": "https://github.com/spring-projects/spring-integration/pull/3402#discussion_r503511255", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The `AbstractMailReceiver` now can produce `MimeMessage` as is without eager fetching for its content.\n          \n          \n            \n            The `AbstractMailReceiver` can now produce the `MimeMessage` as-is without eager fetching its content.", "author": "garyrussell", "createdAt": "2020-10-12T20:14:25Z", "path": "src/reference/asciidoc/whats-new.adoc", "diffHunk": "@@ -86,3 +87,9 @@ See <<./amqp.adoc#alternative-confirms-returns,Alternative Mechanism for Publish\n \n A new `BatchMode.EXTRACT_PAYLOAD_WITH_HEADERS` is supported by the `AmqpInboundChannelAdapter`.\n See <<./amqp.adoc#amqp-inbound-channel-adapter,Inbound Channel Adapter>> for more information.\n+\n+[[x5.4-mail]]\n+=== Mail Changes\n+\n+The `AbstractMailReceiver` now can produce `MimeMessage` as is without eager fetching for its content.", "originalCommit": "48b9323872a6adc487305581634694876ec3bc4b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "236e28aab3af1b0f9205a78474ea0d16a83bf241", "url": "https://github.com/spring-projects/spring-integration/commit/236e28aab3af1b0f9205a78474ea0d16a83bf241", "message": "Fix language in Docs\n\nCo-authored-by: Gary Russell <grussell@vmware.com>", "committedDate": "2020-10-12T20:21:00Z", "type": "commit"}]}