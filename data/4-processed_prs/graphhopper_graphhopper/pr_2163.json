{"pr_number": 2163, "pr_title": "add turn cost example for Java API", "pr_createdAt": "2020-10-25T16:13:35Z", "pr_url": "https://github.com/graphhopper/graphhopper/pull/2163", "timeline": [{"oid": "d1cbe190a8f23153ef59cd2e087092fb0e237abd", "url": "https://github.com/graphhopper/graphhopper/commit/d1cbe190a8f23153ef59cd2e087092fb0e237abd", "message": "added turn cost example", "committedDate": "2020-10-24T13:12:54Z", "type": "commit"}, {"oid": "d051e23237f3f2b3acad98a0fefef21809e58efe", "url": "https://github.com/graphhopper/graphhopper/commit/d051e23237f3f2b3acad98a0fefef21809e58efe", "message": "Merge branch 'master' into tc_example", "committedDate": "2020-11-03T10:11:54Z", "type": "commit"}, {"oid": "f496d4160783bca5bcf27fb94790f0e40530efb5", "url": "https://github.com/graphhopper/graphhopper/commit/f496d4160783bca5bcf27fb94790f0e40530efb5", "message": "Trying to improve example", "committedDate": "2020-11-03T11:03:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4NTU0NQ==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516585545", "bodyText": "I ran into this while working on the example? How is this meant to work? Currently Helper.round(1040.02125359, -2) returns 1000.", "author": "easbar", "createdAt": "2020-11-03T11:04:53Z", "path": "api/src/test/java/com/graphhopper/util/HelperTest.java", "diffHunk": "@@ -55,6 +55,8 @@ public void testRound() {\n         assertEquals(100.94, Helper.round(100.94, 2), 1e-7);\n         assertEquals(100.9, Helper.round(100.94, 1), 1e-7);\n         assertEquals(101.0, Helper.round(100.95, 1), 1e-7);\n+        // todonow\n+        assertEquals(1040.02, Helper.round(1040.02125359, -2), 1.e-7);", "originalCommit": "f496d4160783bca5bcf27fb94790f0e40530efb5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU5MzUxOA==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516593518", "bodyText": "Ah now I get it: -2 means the decimal point is shifted to the left (by two). Rather counter-intuitive if you ask me because setting the exponent to -2 I would expect the precision to be 10^-2, not 10^2`.", "author": "easbar", "createdAt": "2020-11-03T11:19:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4NTU0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjYwMzk5Nw==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516603997", "bodyText": "Hmmh, not sure why I did it that way for Helper. Should we can change it?", "author": "karussell", "createdAt": "2020-11-03T11:39:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4NTU0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjYwNjkzOA==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516606938", "bodyText": "Hm for me its fine like this (now that I know it \ud83d\ude04 ). Rounding to 2 means 'two decimal places', from this point of view it makes sense?", "author": "easbar", "createdAt": "2020-11-03T11:44:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4NTU0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjYyODQ3Mg==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516628472", "bodyText": "Yes, makes a bit sense :)", "author": "karussell", "createdAt": "2020-11-03T12:25:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4NTU0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4NjMwMg==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516586302", "bodyText": "I added these time checks to see the difference when changing u-turn costs.", "author": "easbar", "createdAt": "2020-11-03T11:06:13Z", "path": "example/src/main/java/com/graphhopper/example/RoutingExampleTC.java", "diffHunk": "@@ -8,55 +8,81 @@\n import com.graphhopper.config.CHProfile;\n import com.graphhopper.config.Profile;\n import com.graphhopper.reader.osm.GraphHopperOSM;\n-import com.graphhopper.routing.util.CarFlagEncoder;\n import com.graphhopper.routing.util.EncodingManager;\n-import com.graphhopper.routing.util.FlagEncoder;\n-import com.graphhopper.util.Helper;\n-import com.graphhopper.util.PMap;\n+import com.graphhopper.util.Parameters;\n \n import java.util.Arrays;\n \n import static com.graphhopper.util.Parameters.Curbsides.CURBSIDE_ANY;\n import static com.graphhopper.util.Parameters.Curbsides.CURBSIDE_RIGHT;\n \n /**\n- * Routing with turn costs\n+ * Routing with turn costs. Also see {@link RoutingExample} for more details.\n  */\n public class RoutingExampleTC {\n     public static void main(String[] args) {\n         String relDir = args.length == 1 ? args[0] : \"\";\n         GraphHopper hopper = createGraphHopperInstance(relDir + \"core/files/andorra.osm.pbf\");\n-        routing(hopper);\n+        routeWithTurnCosts(hopper);\n+        routeWithTurnCostsAndCurbsides(hopper);\n+        routeWithTurnCostsAndOtherUTurnCosts(hopper);\n     }\n \n-    // see RoutingExample for more details\n-    public static void routing(GraphHopper hopper) {\n-        GHRequest req = new GHRequest(42.50822, 1.533966, 42.506899,1.525372).\n+    public static void routeWithTurnCosts(GraphHopper hopper) {\n+        GHRequest req = new GHRequest(42.50822, 1.533966, 42.506899, 1.525372).\n+                setProfile(\"car\");\n+        route(hopper, req, 1038, 63_000);\n+    }\n+\n+    public static void routeWithTurnCostsAndCurbsides(GraphHopper hopper) {\n+        GHRequest req = new GHRequest(42.50822, 1.533966, 42.506899, 1.525372).\n                 setCurbsides(Arrays.asList(CURBSIDE_ANY, CURBSIDE_RIGHT)).\n                 setProfile(\"car\");\n-        GHResponse rsp = hopper.route(req);\n+        route(hopper, req, 1730, 112_000);\n+    }\n \n+    public static void routeWithTurnCostsAndOtherUTurnCosts(GraphHopper hopper) {\n+        GHRequest req = new GHRequest(42.50822, 1.533966, 42.506899, 1.525372).\n+                setCurbsides(Arrays.asList(CURBSIDE_ANY, CURBSIDE_RIGHT)).\n+                putHint(Parameters.CH.DISABLE, true).\n+                setProfile(\"car\");\n+        route(hopper, req.putHint(Parameters.Routing.U_TURN_COSTS, 10), 1370, 100_000);\n+        route(hopper, req.putHint(Parameters.Routing.U_TURN_COSTS, 15), 1370, 105_000);\n+    }\n+\n+    private static void route(GraphHopper hopper, GHRequest req, int expectedDistance, int expectedTime) {\n+        GHResponse rsp = hopper.route(req);\n         // handle errors\n         if (rsp.hasErrors())\n             // if you get: Impossible curbside constraint: 'curbside=right'\n             // you either specify 'curbside=any' or Parameters.Routing.FORCE_CURBSIDE=false to ignore this situation\n             throw new RuntimeException(rsp.getErrors().toString());\n-\n         ResponsePath path = rsp.getBest();\n-        assert Helper.round(path.getDistance(), -2) == 1700;\n+        assert Math.abs(expectedDistance - path.getDistance()) < 1 : \"unexpected distance : \" + path.getDistance() + \" vs. \" + expectedDistance;\n+        assert Math.abs(expectedTime - path.getTime()) < 1000 : \"unexpected time : \" + path.getTime() + \" vs. \" + expectedTime;", "originalCommit": "f496d4160783bca5bcf27fb94790f0e40530efb5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4NjQ2Mw==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516586463", "bodyText": "setting u_turn_costs on the encoder has no effect (?!). also I think for the example its better to use |turn_costs=true instead of max_turn_costs=1 since its easier to understand (we either make or do not make use of the OSM turn restrictions)", "author": "easbar", "createdAt": "2020-11-03T11:06:31Z", "path": "example/src/main/java/com/graphhopper/example/RoutingExampleTC.java", "diffHunk": "@@ -8,55 +8,81 @@\n import com.graphhopper.config.CHProfile;\n import com.graphhopper.config.Profile;\n import com.graphhopper.reader.osm.GraphHopperOSM;\n-import com.graphhopper.routing.util.CarFlagEncoder;\n import com.graphhopper.routing.util.EncodingManager;\n-import com.graphhopper.routing.util.FlagEncoder;\n-import com.graphhopper.util.Helper;\n-import com.graphhopper.util.PMap;\n+import com.graphhopper.util.Parameters;\n \n import java.util.Arrays;\n \n import static com.graphhopper.util.Parameters.Curbsides.CURBSIDE_ANY;\n import static com.graphhopper.util.Parameters.Curbsides.CURBSIDE_RIGHT;\n \n /**\n- * Routing with turn costs\n+ * Routing with turn costs. Also see {@link RoutingExample} for more details.\n  */\n public class RoutingExampleTC {\n     public static void main(String[] args) {\n         String relDir = args.length == 1 ? args[0] : \"\";\n         GraphHopper hopper = createGraphHopperInstance(relDir + \"core/files/andorra.osm.pbf\");\n-        routing(hopper);\n+        routeWithTurnCosts(hopper);\n+        routeWithTurnCostsAndCurbsides(hopper);\n+        routeWithTurnCostsAndOtherUTurnCosts(hopper);\n     }\n \n-    // see RoutingExample for more details\n-    public static void routing(GraphHopper hopper) {\n-        GHRequest req = new GHRequest(42.50822, 1.533966, 42.506899,1.525372).\n+    public static void routeWithTurnCosts(GraphHopper hopper) {\n+        GHRequest req = new GHRequest(42.50822, 1.533966, 42.506899, 1.525372).\n+                setProfile(\"car\");\n+        route(hopper, req, 1038, 63_000);\n+    }\n+\n+    public static void routeWithTurnCostsAndCurbsides(GraphHopper hopper) {\n+        GHRequest req = new GHRequest(42.50822, 1.533966, 42.506899, 1.525372).\n                 setCurbsides(Arrays.asList(CURBSIDE_ANY, CURBSIDE_RIGHT)).\n                 setProfile(\"car\");\n-        GHResponse rsp = hopper.route(req);\n+        route(hopper, req, 1730, 112_000);\n+    }\n \n+    public static void routeWithTurnCostsAndOtherUTurnCosts(GraphHopper hopper) {\n+        GHRequest req = new GHRequest(42.50822, 1.533966, 42.506899, 1.525372).\n+                setCurbsides(Arrays.asList(CURBSIDE_ANY, CURBSIDE_RIGHT)).\n+                putHint(Parameters.CH.DISABLE, true).\n+                setProfile(\"car\");\n+        route(hopper, req.putHint(Parameters.Routing.U_TURN_COSTS, 10), 1370, 100_000);\n+        route(hopper, req.putHint(Parameters.Routing.U_TURN_COSTS, 15), 1370, 105_000);\n+    }\n+\n+    private static void route(GraphHopper hopper, GHRequest req, int expectedDistance, int expectedTime) {\n+        GHResponse rsp = hopper.route(req);\n         // handle errors\n         if (rsp.hasErrors())\n             // if you get: Impossible curbside constraint: 'curbside=right'\n             // you either specify 'curbside=any' or Parameters.Routing.FORCE_CURBSIDE=false to ignore this situation\n             throw new RuntimeException(rsp.getErrors().toString());\n-\n         ResponsePath path = rsp.getBest();\n-        assert Helper.round(path.getDistance(), -2) == 1700;\n+        assert Math.abs(expectedDistance - path.getDistance()) < 1 : \"unexpected distance : \" + path.getDistance() + \" vs. \" + expectedDistance;\n+        assert Math.abs(expectedTime - path.getTime()) < 1000 : \"unexpected time : \" + path.getTime() + \" vs. \" + expectedTime;\n     }\n \n     // see RoutingExample for more details\n     static GraphHopper createGraphHopperInstance(String ghLoc) {\n         GraphHopper hopper = new GraphHopperOSM().forServer();\n         hopper.setDataReaderFile(ghLoc);\n         hopper.setGraphHopperLocation(\"target/routing-tc-graph-cache\");\n-        // to enable turn restriction and curbside support ensure that FlagEncoder and profile supports turn costs\n-        FlagEncoder car = new CarFlagEncoder(new PMap().\n-                putObject(\"u_turn_costs\", 3).putObject(\"max_turn_costs\", 1));", "originalCommit": "f496d4160783bca5bcf27fb94790f0e40530efb5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjYwMzMxMQ==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516603311", "bodyText": "setting u_turn_costs on the encoder has no effect (?!)\n\nUps. Now I start confusing profiles with encoders already myself :D\n\nalso I think for the example its better to use |turn_costs=true\n\nOk, sure.", "author": "karussell", "createdAt": "2020-11-03T11:37:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4NjQ2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4Nzc5NA==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516587794", "bodyText": "This is a bit ugly because we do not get an error if CH is still enabled. When we change the u-turn costs (and CH is enabled) this change is simply ignored without throwing an error or something.", "author": "easbar", "createdAt": "2020-11-03T11:09:03Z", "path": "example/src/main/java/com/graphhopper/example/RoutingExampleTC.java", "diffHunk": "@@ -8,55 +8,81 @@\n import com.graphhopper.config.CHProfile;\n import com.graphhopper.config.Profile;\n import com.graphhopper.reader.osm.GraphHopperOSM;\n-import com.graphhopper.routing.util.CarFlagEncoder;\n import com.graphhopper.routing.util.EncodingManager;\n-import com.graphhopper.routing.util.FlagEncoder;\n-import com.graphhopper.util.Helper;\n-import com.graphhopper.util.PMap;\n+import com.graphhopper.util.Parameters;\n \n import java.util.Arrays;\n \n import static com.graphhopper.util.Parameters.Curbsides.CURBSIDE_ANY;\n import static com.graphhopper.util.Parameters.Curbsides.CURBSIDE_RIGHT;\n \n /**\n- * Routing with turn costs\n+ * Routing with turn costs. Also see {@link RoutingExample} for more details.\n  */\n public class RoutingExampleTC {\n     public static void main(String[] args) {\n         String relDir = args.length == 1 ? args[0] : \"\";\n         GraphHopper hopper = createGraphHopperInstance(relDir + \"core/files/andorra.osm.pbf\");\n-        routing(hopper);\n+        routeWithTurnCosts(hopper);\n+        routeWithTurnCostsAndCurbsides(hopper);\n+        routeWithTurnCostsAndOtherUTurnCosts(hopper);\n     }\n \n-    // see RoutingExample for more details\n-    public static void routing(GraphHopper hopper) {\n-        GHRequest req = new GHRequest(42.50822, 1.533966, 42.506899,1.525372).\n+    public static void routeWithTurnCosts(GraphHopper hopper) {\n+        GHRequest req = new GHRequest(42.50822, 1.533966, 42.506899, 1.525372).\n+                setProfile(\"car\");\n+        route(hopper, req, 1038, 63_000);\n+    }\n+\n+    public static void routeWithTurnCostsAndCurbsides(GraphHopper hopper) {\n+        GHRequest req = new GHRequest(42.50822, 1.533966, 42.506899, 1.525372).\n                 setCurbsides(Arrays.asList(CURBSIDE_ANY, CURBSIDE_RIGHT)).\n                 setProfile(\"car\");\n-        GHResponse rsp = hopper.route(req);\n+        route(hopper, req, 1730, 112_000);\n+    }\n \n+    public static void routeWithTurnCostsAndOtherUTurnCosts(GraphHopper hopper) {\n+        GHRequest req = new GHRequest(42.50822, 1.533966, 42.506899, 1.525372).\n+                setCurbsides(Arrays.asList(CURBSIDE_ANY, CURBSIDE_RIGHT)).\n+                putHint(Parameters.CH.DISABLE, true).", "originalCommit": "f496d4160783bca5bcf27fb94790f0e40530efb5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjYwMzI1Mg==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516603252", "bodyText": "We can start to be more restrictive here and throw errors for curbside&noneCH? But this might break clients. Or we have a strict mode (default) and legacy mode ;)", "author": "karussell", "createdAt": "2020-11-03T11:37:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4Nzc5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjYwNzkxMQ==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516607911", "bodyText": "There is this todo here: \n  \n    \n      graphhopper/core/src/main/java/com/graphhopper/routing/Router.java\n    \n    \n        Lines 230 to 233\n      in\n      ff85f03\n    \n    \n    \n    \n\n        \n          \n           private Weighting createWeighting(Profile profile, PMap requestHints, List<GHPoint> points, boolean forCH) { \n        \n\n        \n          \n               if (forCH) { \n        \n\n        \n          \n                   // todo: do not allow things like short_fastest.distance_factor or u_turn_costs unless CH is disabled \n        \n\n        \n          \n                   // and only under certain conditions for LM \n        \n    \n  \n\n\nAnd yes I think we did not do this for some backward-compatibility reasons. Not sure what the exact implications are if we change this.", "author": "easbar", "createdAt": "2020-11-03T11:46:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4Nzc5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjYwODkzNg==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516608936", "bodyText": "and throw errors for curbside&noneCH\n\ncurbsides+nonCH is not the problem. But what is not possible is changing the u-turn costs with CH.\n\nOr we have a strict mode (default) and legacy mode ;)\n\nHm this sounds complicated? Or do you mean some flag that controls this somehow (ignore or throw error).", "author": "easbar", "createdAt": "2020-11-03T11:48:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4Nzc5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjYzMDcwMA==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516630700", "bodyText": "curbsides+nonCH is not the problem.\n\nAh, due to the request properties thought you mean the problem that this parameter combination does not work for node-based yet ...\n\nOr do you mean some flag that controls this somehow (ignore or throw error).\n\nYes. But not sure how ugly the code would get with that.", "author": "karussell", "createdAt": "2020-11-03T12:29:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4Nzc5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjYzNDE0OA==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516634148", "bodyText": "Honestly, as long as their is no complaint I do not really feel like changing anything here :) Adding some ignore parameter makes it more complicated and maybe at some point we no longer need the backward-compatibility here?", "author": "easbar", "createdAt": "2020-11-03T12:35:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4Nzc5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjkwOTM4NQ==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516909385", "bodyText": "Adding some ignore parameter makes it more complicated\n\nYes, I also do not like it.\n\nmaybe at some point we no longer need the backward-compatibility here?\n\nUnfortunately this goes not away the longer we wait. Instead it is more the opposite. Maybe we introduce restrictions step by step ... have no hard opinion here but it is tricky.", "author": "karussell", "createdAt": "2020-11-03T19:35:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4Nzc5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjkxMTU2OQ==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516911569", "bodyText": "We would have to figure out how many requests there are that use u_turn_costs=<some value> but do not use ch.disable=true. (and similar with short_fastest.time/distance_factor. And yes its probably true. The longer edge-based CH, turn costs and u-turn costs are around the more requests of this kind there might be. Specifically the u-turn costs parameter is problematic anyway since we hopefully will not just use one value for u-turn costs for all u-turns in the future (but be more specific depending on the road type etc.). Right now I would go as far as saying that this parameter is not even supported officially (it isn't documented for the API either).", "author": "easbar", "createdAt": "2020-11-03T19:39:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4Nzc5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjkxNDk3Nw==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516914977", "bodyText": "Ah and then there might be a problem with ProfileResolver, i.e. when u_turn_costs is given but no profile is specified. Before we had profiles we used u_turn_costs to determine which CH preparation shall be used in case there are multiple ones using the same vehicle/weighting, but different u_turn_costs.", "author": "easbar", "createdAt": "2020-11-03T19:45:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4Nzc5NA=="}], "type": "inlineReview"}, {"oid": "de05a7ffb4b8c67f19e5e6b16c66205685c7ac39", "url": "https://github.com/graphhopper/graphhopper/commit/de05a7ffb4b8c67f19e5e6b16c66205685c7ac39", "message": "Add comment", "committedDate": "2020-11-03T11:11:30Z", "type": "commit"}, {"oid": "03b3685460e29683f5a10f94a7238f34199f2853", "url": "https://github.com/graphhopper/graphhopper/commit/03b3685460e29683f5a10f94a7238f34199f2853", "message": "Fix rounding test", "committedDate": "2020-11-03T11:21:27Z", "type": "commit"}, {"oid": "922dde0ed455d7479e5982352a647bd0fffaaa60", "url": "https://github.com/graphhopper/graphhopper/commit/922dde0ed455d7479e5982352a647bd0fffaaa60", "message": "Fix docs for Helper.round", "committedDate": "2020-11-03T11:54:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjYxMjE4NA==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516612184", "bodyText": "Maybe this is what confused me, does this make it more clear?", "author": "easbar", "createdAt": "2020-11-03T11:54:55Z", "path": "api/src/main/java/com/graphhopper/util/Helper.java", "diffHunk": "@@ -318,10 +318,11 @@ public static double keepIn(double value, double min, double max) {\n     }\n \n     /**\n-     * Round the value to the specified exponent\n+     * Round the value to the specified number of decimal places, i.e. decimalPlaces=2 means we round to two decimal\n+     * places. Using negative values like decimalPlaces=-2 means we round to two places before the decimal point.", "originalCommit": "922dde0ed455d7479e5982352a647bd0fffaaa60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjYzNTQ1Ng==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516635456", "bodyText": "Yes", "author": "karussell", "createdAt": "2020-11-03T12:38:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjYxMjE4NA=="}], "type": "inlineReview"}, {"oid": "9d24bf632dfcd1e81589dc1948e5b5659c9bc486", "url": "https://github.com/graphhopper/graphhopper/commit/9d24bf632dfcd1e81589dc1948e5b5659c9bc486", "message": "Fix comment in test", "committedDate": "2020-11-03T11:55:59Z", "type": "commit"}, {"oid": "ac2cf249ec429f127473fc9b07c011f610014dd4", "url": "https://github.com/graphhopper/graphhopper/commit/ac2cf249ec429f127473fc9b07c011f610014dd4", "message": "Use round for round2/4/6", "committedDate": "2020-11-03T11:57:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjYxNDEzNw==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516614137", "bodyText": "Was there any reason these methods did not delegate to round() before?", "author": "easbar", "createdAt": "2020-11-03T11:58:30Z", "path": "api/src/main/java/com/graphhopper/util/Helper.java", "diffHunk": "@@ -318,23 +318,24 @@ public static double keepIn(double value, double min, double max) {\n     }\n \n     /**\n-     * Round the value to the specified exponent\n+     * Round the value to the specified number of decimal places, i.e. decimalPlaces=2 means we round to two decimal\n+     * places. Using negative values like decimalPlaces=-2 means we round to two places before the decimal point.\n      */\n-    public static double round(double value, int exponent) {\n-        double factor = Math.pow(10, exponent);\n+    public static double round(double value, int decimalPlaces) {\n+        double factor = Math.pow(10, decimalPlaces);\n         return Math.round(value * factor) / factor;\n     }\n \n     public static double round6(double value) {\n-        return Math.round(value * 1e6) / 1e6;\n+        return round(value, 6);", "originalCommit": "ac2cf249ec429f127473fc9b07c011f610014dd4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjYzMTg0Mg==", "url": "https://github.com/graphhopper/graphhopper/pull/2163#discussion_r516631842", "bodyText": "No, I think I initially thought two methods (round4 and round6) would be sufficient. But not 100% sure.", "author": "karussell", "createdAt": "2020-11-03T12:31:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjYxNDEzNw=="}], "type": "inlineReview"}, {"oid": "936b7cfcb25c20c7f427f24d23ecb793878ebc88", "url": "https://github.com/graphhopper/graphhopper/commit/936b7cfcb25c20c7f427f24d23ecb793878ebc88", "message": "fix comment once more", "committedDate": "2020-11-03T12:01:48Z", "type": "commit"}]}