{"pr_number": 2168, "pr_title": "TransportationMode refactoring", "pr_createdAt": "2020-10-27T11:06:59Z", "pr_url": "https://github.com/graphhopper/graphhopper/pull/2168", "timeline": [{"oid": "f6e0f87b4fc4aaf964741eaded9f3d97a48e7e72", "url": "https://github.com/graphhopper/graphhopper/commit/f6e0f87b4fc4aaf964741eaded9f3d97a48e7e72", "message": "refactored TransportationMode", "committedDate": "2020-10-21T21:54:17Z", "type": "commit"}, {"oid": "f41bc1fe05d690059214980c6ea9e36c27399c2a", "url": "https://github.com/graphhopper/graphhopper/commit/f41bc1fe05d690059214980c6ea9e36c27399c2a", "message": "removing it from FlagEncoder", "committedDate": "2020-10-21T22:23:26Z", "type": "commit"}, {"oid": "f0c11abc96cefca98d8bb688df84f159ec1d759d", "url": "https://github.com/graphhopper/graphhopper/commit/f0c11abc96cefca98d8bb688df84f159ec1d759d", "message": "back to enums but with isMotorVehicle", "committedDate": "2020-10-22T20:43:38Z", "type": "commit"}, {"oid": "5a37323d64bfdf5512d613b0b5853dd7c87017ad", "url": "https://github.com/graphhopper/graphhopper/commit/5a37323d64bfdf5512d613b0b5853dd7c87017ad", "message": "minor", "committedDate": "2020-10-22T20:45:38Z", "type": "commit"}, {"oid": "6096fbea8db19ee280632c0c955c32134d122b58", "url": "https://github.com/graphhopper/graphhopper/commit/6096fbea8db19ee280632c0c955c32134d122b58", "message": "Merge branch 'master' into tra_mo_refactoring", "committedDate": "2020-10-27T11:07:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYwNTM5Mw==", "url": "https://github.com/graphhopper/graphhopper/pull/2168#discussion_r512605393", "bodyText": "I'd argue that the restrictions are a defining property of a TransportationMode and would move them to the Enum.", "author": "otbutz", "createdAt": "2020-10-27T11:14:46Z", "path": "core/src/main/java/com/graphhopper/routing/util/parsers/OSMRoadAccessParser.java", "diffHunk": "@@ -60,10 +60,32 @@ public IntsRef handleWayTags(IntsRef edgeFlags, ReaderWay readerWay, boolean fer\n         SpatialRuleSet spatialRuleSet = readerWay.getTag(\"spatial_rule_set\", null);\n         if (spatialRuleSet != null && spatialRuleSet != SpatialRuleSet.EMPTY) {\n             RoadClass roadClass = RoadClass.find(readerWay.getTag(\"highway\", \"\"));\n-            accessValue = spatialRuleSet.getAccess(roadClass, TransportationMode.MOTOR_VEHICLE, YES);\n+            accessValue = spatialRuleSet.getAccess(roadClass, TransportationMode.CAR, YES);\n         }\n-            \n+\n         roadAccessEnc.setEnum(false, edgeFlags, accessValue);\n         return edgeFlags;\n     }\n+\n+    public static List<String> toOSMRestrictions(TransportationMode mode) {\n+        switch (mode) {\n+            case FOOT:\n+                return Arrays.asList(\"foot\", \"access\");", "originalCommit": "6096fbea8db19ee280632c0c955c32134d122b58", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYwNjkyNA==", "url": "https://github.com/graphhopper/graphhopper/pull/2168#discussion_r512606924", "bodyText": "But only for OSM data. If you use the transportation mode with anything else, these values might be different?", "author": "boldtrn", "createdAt": "2020-10-27T11:17:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYwNTM5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYwNzAzMQ==", "url": "https://github.com/graphhopper/graphhopper/pull/2168#discussion_r512607031", "bodyText": "The naming is IMO OSM-specific and should be in the parser", "author": "karussell", "createdAt": "2020-10-27T11:17:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYwNTM5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYxMDMwNA==", "url": "https://github.com/graphhopper/graphhopper/pull/2168#discussion_r512610304", "bodyText": "OSM-specific\n\nGood point", "author": "otbutz", "createdAt": "2020-10-27T11:23:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYwNTM5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYxMjI1Nw==", "url": "https://github.com/graphhopper/graphhopper/pull/2168#discussion_r512612257", "bodyText": "Also some restrictions could be not existent in the TransportationMode that exist in OSM", "author": "karussell", "createdAt": "2020-10-27T11:26:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYwNTM5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYzNzc3NQ==", "url": "https://github.com/graphhopper/graphhopper/pull/2168#discussion_r512637775", "bodyText": "Shouldn't we add a case for each mode and throw an exception in default? We could add a unittest to ensure that all TransportationModes return a value for toOSMRestrictions()", "author": "otbutz", "createdAt": "2020-10-27T12:05:59Z", "path": "core/src/main/java/com/graphhopper/routing/util/parsers/OSMRoadAccessParser.java", "diffHunk": "@@ -60,10 +60,32 @@ public IntsRef handleWayTags(IntsRef edgeFlags, ReaderWay readerWay, boolean fer\n         SpatialRuleSet spatialRuleSet = readerWay.getTag(\"spatial_rule_set\", null);\n         if (spatialRuleSet != null && spatialRuleSet != SpatialRuleSet.EMPTY) {\n             RoadClass roadClass = RoadClass.find(readerWay.getTag(\"highway\", \"\"));\n-            accessValue = spatialRuleSet.getAccess(roadClass, TransportationMode.MOTOR_VEHICLE, YES);\n+            accessValue = spatialRuleSet.getAccess(roadClass, TransportationMode.CAR, YES);\n         }\n-            \n+\n         roadAccessEnc.setEnum(false, edgeFlags, accessValue);\n         return edgeFlags;\n     }\n+\n+    public static List<String> toOSMRestrictions(TransportationMode mode) {\n+        switch (mode) {\n+            case FOOT:\n+                return Arrays.asList(\"foot\", \"access\");\n+            case VEHICLE:\n+                return Arrays.asList(\"vehicle\", \"access\");\n+            case BIKE:\n+                return Arrays.asList(\"bicycle\", \"vehicle\", \"access\");\n+            case MOTOR_VEHICLE:\n+                return Arrays.asList(\"motor_vehicle\", \"vehicle\", \"access\");\n+            case CAR:\n+                return Arrays.asList(\"motorcar\", \"motor_vehicle\", \"vehicle\", \"access\");\n+            case MOTORCYCLE:\n+                return Arrays.asList(\"motorcycle\", \"motor_vehicle\", \"vehicle\", \"access\");\n+            case HGV:\n+                return Arrays.asList(\"hgv\", \"motor_vehicle\", \"vehicle\", \"access\");\n+            default:\n+                return mode.isMotorVehicle() ?", "originalCommit": "6096fbea8db19ee280632c0c955c32134d122b58", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU0MjkwMA==", "url": "https://github.com/graphhopper/graphhopper/pull/2168#discussion_r513542900", "bodyText": "Good question. Having this default might make it easier for forks but forcing a complete list of TransportationModes also sounds good.", "author": "karussell", "createdAt": "2020-10-28T15:33:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYzNzc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU1NTA1MQ==", "url": "https://github.com/graphhopper/graphhopper/pull/2168#discussion_r513555051", "bodyText": "I'd argue that if a fork wants to extend TransportMode they need think about what restrictions are appropriate.", "author": "otbutz", "createdAt": "2020-10-28T15:48:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYzNzc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU3ODg2MQ==", "url": "https://github.com/graphhopper/graphhopper/pull/2168#discussion_r513578861", "bodyText": "The problem is, that if you can't change this when using GraphHopper as a lib, you would actually have to fork it.", "author": "boldtrn", "createdAt": "2020-10-28T16:18:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYzNzc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU4NDMwNg==", "url": "https://github.com/graphhopper/graphhopper/pull/2168#discussion_r513584306", "bodyText": "I do not see a big problem that this is not customizable (it wasn't before and there are currently no use cases known that need this).", "author": "karussell", "createdAt": "2020-10-28T16:25:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYzNzc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU4ODI0MQ==", "url": "https://github.com/graphhopper/graphhopper/pull/2168#discussion_r513588241", "bodyText": "TransportationMode is an enum so it can't be extended by library users without creating a fork?", "author": "otbutz", "createdAt": "2020-10-28T16:30:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYzNzc3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU2Njg5OA==", "url": "https://github.com/graphhopper/graphhopper/pull/2168#discussion_r513566898", "bodyText": "Do we want to keep the hierarchy here?\ne.g\n    OTHER()\n    FOOT(OTHER)\n    VEHICLE(OTHER)\n    BIKE(VEHICLE),\n    MOTOR_VEHICLE(VEHICLE),\n    CAR(MOTOR_VEHICLE),\n    MOTORCYCLE(MOTOR_VEHICLE),\n    HGV(MOTOR_VEHICLE);\n\n    TransportationMode(TransporationMode parent) {\n         // ...\nThis would allow for constructs like this:\n    HGV.is(VEHICLE) == true", "author": "otbutz", "createdAt": "2020-10-28T16:02:57Z", "path": "core/src/main/java/com/graphhopper/routing/util/TransportationMode.java", "diffHunk": "@@ -15,28 +15,26 @@\n  *  See the License for the specific language governing permissions and\n  *  limitations under the License.\n  */\n-package com.graphhopper.routing.util.spatialrules;\n+package com.graphhopper.routing.util;\n \n /**\n- * Defining different types of transportation.\n- * <p>\n- * We started with a subset of the definition found in the OSM Wiki\n- * https://wiki.openstreetmap.org/wiki/Key:access#Land-based_transportation\n+ * Define different types of transportation that are used to create and populate our encoded values from a data source\n+ * like OpenStreetMap.\n  *\n  * @author Robin Boldt\n+ * @author Peter Karich\n  */\n public enum TransportationMode {\n+    OTHER(false), FOOT(false), VEHICLE(false), BIKE(false),\n+    MOTOR_VEHICLE(true), CAR(true), MOTORCYCLE(true), HGV(true);\n \n-    OTHER(0), MOTOR_VEHICLE(1), BICYCLE(2), FOOT(3);\n+    private final boolean motorVehicle;\n \n-    private final int value;\n-\n-    TransportationMode(int value) {", "originalCommit": "6096fbea8db19ee280632c0c955c32134d122b58", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU3NDQ3Mg==", "url": "https://github.com/graphhopper/graphhopper/pull/2168#discussion_r513574472", "bodyText": "Not sure. We could also create a second method isVehicle ... I even had this in the enum before but removed it as I did not find a meaningful use case.", "author": "karussell", "createdAt": "2020-10-28T16:12:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU2Njg5OA=="}], "type": "inlineReview"}, {"oid": "0a9cc978a1f8a95874a2621035de97fe91b692e2", "url": "https://github.com/graphhopper/graphhopper/commit/0a9cc978a1f8a95874a2621035de97fe91b692e2", "message": "throw exception", "committedDate": "2020-11-04T08:00:38Z", "type": "commit"}, {"oid": "93db1c840f6289dd4d2e4fd8066eb1ef23b0de07", "url": "https://github.com/graphhopper/graphhopper/commit/93db1c840f6289dd4d2e4fd8066eb1ef23b0de07", "message": "Merge branch 'master' into tra_mo_refactoring", "committedDate": "2020-11-04T08:01:00Z", "type": "commit"}]}