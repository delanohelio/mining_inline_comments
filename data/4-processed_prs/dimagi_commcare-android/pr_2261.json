{"pr_number": 2261, "pr_title": "Set latest CC version from Heartbeat response", "pr_createdAt": "2020-06-03T08:01:40Z", "pr_url": "https://github.com/dimagi/commcare-android/pull/2261", "timeline": [{"oid": "5fb318b8953ffbb731a6fbab1bf881710db2eeae", "url": "https://github.com/dimagi/commcare-android/commit/5fb318b8953ffbb731a6fbab1bf881710db2eeae", "message": "Set latest commcate version from heartbeat response", "committedDate": "2020-06-03T07:55:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mjc5OTQxNg==", "url": "https://github.com/dimagi/commcare-android/pull/2261#discussion_r662799416", "bodyText": "@shubham1g5 Just noticed one thing. This particular method parseUpdateToPrompt is being called from both attemptCczUpdateParse and attemptApkUpdateParse.\nBut for both of them we're using setLatestCommcareVersion when we should've used setLatestAppVersion as well.\nI'm not sure about the actual impact of this bug, but seems like we should fix this in this release. Can you please check?", "author": "ShivamPokhriyal", "createdAt": "2021-07-02T07:29:29Z", "path": "app/src/org/commcare/heartbeat/HeartbeatRequester.java", "diffHunk": "@@ -156,6 +156,7 @@ private static void parseUpdateToPrompt(JSONObject latestVersionInfo, UpdateToPr\n                     if (latestVersionInfo.has(\"force\")) {\n                         forceString = latestVersionInfo.getString(\"force\");\n                     }\n+                    HiddenPreferences.setLatestCommcareVersion(versionValue);", "originalCommit": "5fb318b8953ffbb731a6fbab1bf881710db2eeae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MjgwNzY1OQ==", "url": "https://github.com/dimagi/commcare-android/pull/2261#discussion_r662807659", "bodyText": "ahh good catch. We should wrap this setter in a updateType check. The impact would not have been noticeable as no one is using the recovery feature it's used in currently.  Also can we also set this latest version info from the playstore update API for in-app updates ?", "author": "shubham1g5", "createdAt": "2021-07-02T07:43:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mjc5OTQxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MjgxNjM4NA==", "url": "https://github.com/dimagi/commcare-android/pull/2261#discussion_r662816384", "bodyText": "can we also set this latest version info from the playstore update API for in-app updates?\n\nYeah, I think we can get the versionCode from the playstore api https://developer.android.com/reference/com/google/android/play/core/appupdate/AppUpdateInfo#availableVersionCode(), but not the version name.", "author": "ShivamPokhriyal", "createdAt": "2021-07-02T07:57:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mjc5OTQxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mjg1MTkzNg==", "url": "https://github.com/dimagi/commcare-android/pull/2261#discussion_r662851936", "bodyText": "ok we do need the version name here to be compatible with the surrounding code.", "author": "shubham1g5", "createdAt": "2021-07-02T08:51:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mjc5OTQxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mjg5NTg0Mw==", "url": "https://github.com/dimagi/commcare-android/pull/2261#discussion_r662895843", "bodyText": "#2509", "author": "shubham1g5", "createdAt": "2021-07-02T10:01:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mjc5OTQxNg=="}], "type": "inlineReview"}]}