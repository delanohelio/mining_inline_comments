{"pr_number": 2338, "pr_title": "[2.48.10 hotfix] Update retry time overflow fix", "pr_createdAt": "2020-09-04T12:31:23Z", "pr_url": "https://github.com/dimagi/commcare-android/pull/2338", "timeline": [{"oid": "df043ef96c2d86ad53319c26b3891da067037361", "url": "https://github.com/dimagi/commcare-android/commit/df043ef96c2d86ad53319c26b3891da067037361", "message": "Port crashlytics debug fix", "committedDate": "2020-09-04T12:22:34Z", "type": "commit"}, {"oid": "56371f0a95b73cd40c61f73f14424154c1671919", "url": "https://github.com/dimagi/commcare-android/commit/56371f0a95b73cd40c61f73f14424154c1671919", "message": "fixes calculation for exponential delay to not overflow", "committedDate": "2020-09-04T12:23:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI0MDE1MA==", "url": "https://github.com/dimagi/commcare-android/pull/2338#discussion_r484240150", "bodyText": "A comment would be helpful for future reference. Are there no tests for this code?", "author": "snopoke", "createdAt": "2020-09-07T07:42:08Z", "path": "app/src/org/commcare/engine/resource/AndroidResourceManager.java", "diffHunk": "@@ -287,11 +287,11 @@ private static boolean canUpdateRetryRun() {\n      * @param numberOfRestarts used as the exponent for the delay calculation\n      * @return delay in MS, which grows exponentially over the number of restarts.\n      */\n-    private long exponentionalRetryDelay(int numberOfRestarts) {\n+    private static long exponentionalRetryDelay(int numberOfRestarts) {\n         final Double base = 10 * (1.78);\n         final long thirtySeconds = 30 * 1000;\n-        long exponentialDelay = thirtySeconds + (long)Math.pow(base, numberOfRestarts);\n-        return Math.min(exponentialDelay, MAX_UPDATE_RETRY_DELAY_IN_MS);\n+        long exponentialDelay = numberOfRestarts < 6 ? thirtySeconds + (long)Math.pow(base, numberOfRestarts) : MAX_UPDATE_RETRY_DELAY_IN_MS;", "originalCommit": "56371f0a95b73cd40c61f73f14424154c1671919", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI2MDIwMQ==", "url": "https://github.com/dimagi/commcare-android/pull/2338#discussion_r484260201", "bodyText": "@snopoke yeah unfortunately there were no tests for this code. I have not added any in this PR since this code is no longer present in newer mobile releases and now we are instead relying on Android framework to determine the retry timing.", "author": "shubham1g5", "createdAt": "2020-09-07T08:03:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI0MDE1MA=="}], "type": "inlineReview"}]}