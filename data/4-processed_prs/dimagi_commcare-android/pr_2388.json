{"pr_number": 2388, "pr_title": "Add Tiles test", "pr_createdAt": "2020-10-22T12:58:40Z", "pr_url": "https://github.com/dimagi/commcare-android/pull/2388", "timeline": [{"oid": "ea3b81667d8d55a355e71fd4f55029d8f2be054f", "url": "https://github.com/dimagi/commcare-android/commit/ea3b81667d8d55a355e71fd4f55029d8f2be054f", "message": "Add structure for tiles test", "committedDate": "2020-10-22T13:20:52Z", "type": "commit"}, {"oid": "ea3b81667d8d55a355e71fd4f55029d8f2be054f", "url": "https://github.com/dimagi/commcare-android/commit/ea3b81667d8d55a355e71fd4f55029d8f2be054f", "message": "Add structure for tiles test", "committedDate": "2020-10-22T13:20:52Z", "type": "forcePushed"}, {"oid": "0b12d7611ec80f061957727553622b1c2cab7919", "url": "https://github.com/dimagi/commcare-android/commit/0b12d7611ec80f061957727553622b1c2cab7919", "message": "Fix Failed resolution of: Lkotlin/collections/ArraysKt;", "committedDate": "2020-10-23T04:14:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDcxMjc4Ng==", "url": "https://github.com/dimagi/commcare-android/pull/2388#discussion_r510712786", "bodyText": "Does these make more sense as the Matcher Extension rather than an array extension ? For eg. defining a isArrayDisplayed(items: array) as a matcher extension. I think so because the primary purpose of these methods is to match the text in arrays and I would classify these methods to be part of Matcher rather than Array, but would like to know if there is a particular benefit of keeping them as Array extensions ?", "author": "shubham1g5", "createdAt": "2020-10-23T08:15:02Z", "path": "app/instrumentation-tests/src/org/commcare/utils/Array+Extension.kt", "diffHunk": "@@ -0,0 +1,15 @@\n+package org.commcare.utils\n+\n+import androidx.test.espresso.matcher.ViewMatchers.withText\n+\n+fun Array<String>.areDisplayed() {", "originalCommit": "0b12d7611ec80f061957727553622b1c2cab7919", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDc2NDg5Nw==", "url": "https://github.com/dimagi/commcare-android/pull/2388#discussion_r510764897", "bodyText": "I don't think isArrayDisplayed(items: array) can be used as an extension. It'll be more like a utility method where we'll have to call it InstrumentationUtiility.isArrayDisplayed(items).\nI wanted to make use of extension here merely because of the way it will be used. Like we can simply call items.areDisplayed() and that's it. And it is kinda more readable this way.", "author": "ShivamPokhriyal", "createdAt": "2020-10-23T09:43:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDcxMjc4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI0NTEzNQ==", "url": "https://github.com/dimagi/commcare-android/pull/2388#discussion_r513245135", "bodyText": "Makes sense. Thanks for the explanation.", "author": "shubham1g5", "createdAt": "2020-10-28T08:05:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDcxMjc4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDcxNDA3NA==", "url": "https://github.com/dimagi/commcare-android/pull/2388#discussion_r510714074", "bodyText": "Wondering if these methods should be based on the text of the module/form rather than position ? It's more clear to anyone reading code that way.", "author": "shubham1g5", "createdAt": "2020-10-23T08:17:13Z", "path": "app/instrumentation-tests/src/org/commcare/androidTests/TilesTest.kt", "diffHunk": "@@ -0,0 +1,183 @@\n+package org.commcare.androidTests\n+\n+import androidx.test.espresso.Espresso\n+import androidx.test.espresso.Espresso.onView\n+import androidx.test.espresso.action.ViewActions.click\n+import androidx.test.espresso.matcher.ViewMatchers.*\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.filters.LargeTest\n+import androidx.test.platform.app.InstrumentationRegistry\n+import org.commcare.CommCareInstrumentationTestApplication\n+import org.commcare.activities.EntitySelectActivity\n+import org.commcare.dalvik.R\n+import org.commcare.utils.*\n+import org.junit.Before\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+\n+@RunWith(AndroidJUnit4::class)\n+@LargeTest\n+class TilesTest: BaseTest() {\n+\n+    companion object {\n+        const val CCZ_NAME = \"tiles.ccz\"\n+        const val APP_NAME = \"Case Tile Tests\"\n+        var caseDetails = arrayOf(\"Sex F\", \"Date: 01/07/17\")\n+        var caseDetailsExpanded = caseDetails + arrayOf(\"Secret\")\n+    }\n+\n+    @Before\n+    fun setup() {\n+        installApp(APP_NAME, CCZ_NAME)\n+        InstrumentationUtility.login(\"tile.test\", \"123\")\n+    }\n+\n+    @Test\n+    fun testNoTile() {\n+        InstrumentationUtility.openModule(0)", "originalCommit": "0b12d7611ec80f061957727553622b1c2cab7919", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDc2MjEzMQ==", "url": "https://github.com/dimagi/commcare-android/pull/2388#discussion_r510762131", "bodyText": "Yeah makes sense. Will update it.", "author": "ShivamPokhriyal", "createdAt": "2020-10-23T09:38:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDcxNDA3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDcxNjM1NA==", "url": "https://github.com/dimagi/commcare-android/pull/2388#discussion_r510716354", "bodyText": "Step missing", "author": "shubham1g5", "createdAt": "2020-10-23T08:21:13Z", "path": "app/instrumentation-tests/src/org/commcare/androidTests/TilesTest.kt", "diffHunk": "@@ -0,0 +1,183 @@\n+package org.commcare.androidTests\n+\n+import androidx.test.espresso.Espresso\n+import androidx.test.espresso.Espresso.onView\n+import androidx.test.espresso.action.ViewActions.click\n+import androidx.test.espresso.matcher.ViewMatchers.*\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.filters.LargeTest\n+import androidx.test.platform.app.InstrumentationRegistry\n+import org.commcare.CommCareInstrumentationTestApplication\n+import org.commcare.activities.EntitySelectActivity\n+import org.commcare.dalvik.R\n+import org.commcare.utils.*\n+import org.junit.Before\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+\n+@RunWith(AndroidJUnit4::class)\n+@LargeTest\n+class TilesTest: BaseTest() {\n+\n+    companion object {\n+        const val CCZ_NAME = \"tiles.ccz\"\n+        const val APP_NAME = \"Case Tile Tests\"\n+        var caseDetails = arrayOf(\"Sex F\", \"Date: 01/07/17\")\n+        var caseDetailsExpanded = caseDetails + arrayOf(\"Secret\")\n+    }\n+\n+    @Before\n+    fun setup() {\n+        installApp(APP_NAME, CCZ_NAME)\n+        InstrumentationUtility.login(\"tile.test\", \"123\")\n+    }\n+\n+    @Test\n+    fun testNoTile() {\n+        InstrumentationUtility.openModule(0)\n+\n+        caseDetails.areDisplayed()\n+\n+        onView(withText(\"Sally Ride\"))\n+                .perform(click())\n+        withId(R.id.com_tile_holder_btn_open).doesNotExist()\n+        withText(\"Sex F\").doesNotExist()\n+\n+        onView(withText(\"Continue\"))\n+                .perform(click())\n+        onView(withText(\"Placeholder\"))", "originalCommit": "0b12d7611ec80f061957727553622b1c2cab7919", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDc2MjMyMQ==", "url": "https://github.com/dimagi/commcare-android/pull/2388#discussion_r510762321", "bodyText": "Thanks for pointing it.", "author": "ShivamPokhriyal", "createdAt": "2020-10-23T09:38:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDcxNjM1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDcyNjkwNg==", "url": "https://github.com/dimagi/commcare-android/pull/2388#discussion_r510726906", "bodyText": "Missing ?", "author": "shubham1g5", "createdAt": "2020-10-23T08:39:08Z", "path": "app/instrumentation-tests/src/org/commcare/androidTests/TilesTest.kt", "diffHunk": "@@ -0,0 +1,183 @@\n+package org.commcare.androidTests\n+\n+import androidx.test.espresso.Espresso\n+import androidx.test.espresso.Espresso.onView\n+import androidx.test.espresso.action.ViewActions.click\n+import androidx.test.espresso.matcher.ViewMatchers.*\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.filters.LargeTest\n+import androidx.test.platform.app.InstrumentationRegistry\n+import org.commcare.CommCareInstrumentationTestApplication\n+import org.commcare.activities.EntitySelectActivity\n+import org.commcare.dalvik.R\n+import org.commcare.utils.*\n+import org.junit.Before\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+\n+@RunWith(AndroidJUnit4::class)\n+@LargeTest\n+class TilesTest: BaseTest() {\n+\n+    companion object {\n+        const val CCZ_NAME = \"tiles.ccz\"\n+        const val APP_NAME = \"Case Tile Tests\"\n+        var caseDetails = arrayOf(\"Sex F\", \"Date: 01/07/17\")\n+        var caseDetailsExpanded = caseDetails + arrayOf(\"Secret\")\n+    }\n+\n+    @Before\n+    fun setup() {\n+        installApp(APP_NAME, CCZ_NAME)\n+        InstrumentationUtility.login(\"tile.test\", \"123\")\n+    }\n+\n+    @Test\n+    fun testNoTile() {\n+        InstrumentationUtility.openModule(0)\n+\n+        caseDetails.areDisplayed()\n+\n+        onView(withText(\"Sally Ride\"))\n+                .perform(click())\n+        withId(R.id.com_tile_holder_btn_open).doesNotExist()\n+        withText(\"Sex F\").doesNotExist()\n+\n+        onView(withText(\"Continue\"))\n+                .perform(click())\n+        onView(withText(\"Placeholder\"))\n+                .perform(click())\n+\n+        withText(\"Inside\").isDisplayed()\n+        withText(\"Sally Ride\").doesNotExist()\n+    }\n+\n+    @Test\n+    fun testPersistentTile_withDropDown() {\n+        InstrumentationUtility.openModule(3)\n+\n+        onView(withText(\"Sally Ride\"))\n+                .perform(click())\n+\n+        caseDetails.areDisplayed()\n+        withText(\"Placeholder\").isDisplayed()\n+        withId(R.id.com_tile_holder_btn_open).isDisplayed()\n+\n+        // Expand tile\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        caseDetailsExpanded.areDisplayed()\n+\n+        // Close expanded list using the same button\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        withText(\"Secret\").doesNotExist()\n+\n+        // Use back button to close the expanded list\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        caseDetailsExpanded.areDisplayed()\n+        Espresso.pressBack()\n+        caseDetails.areDisplayed()\n+        withText(\"Secret\").doesNotExist()\n+\n+        // Confirm on pressing back we're in EntitySelectActivity\n+        Espresso.pressBack()\n+        val application = InstrumentationRegistry.getInstrumentation().targetContext.applicationContext\n+                as CommCareInstrumentationTestApplication\n+        var activity = application.currentActivity\n+        InstrumentationUtility.assert(activity is EntitySelectActivity, \"Current Activity is ${activity.localClassName}\")\n+\n+        onView(withText(\"Sally Ride\"))\n+                .perform(click())\n+        caseDetails.areDisplayed()\n+        withId(R.id.com_tile_holder_btn_open).isDisplayed()\n+\n+        // Go to form screen\n+        onView(withText(\"Placeholder\"))\n+                .perform(click())\n+\n+        withText(\"Inside\").isDisplayed()\n+        caseDetails.areDisplayed()\n+\n+        // Expand tile\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        caseDetailsExpanded.areDisplayed()\n+\n+        //Close expanded list\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        caseDetails.areDisplayed()\n+        withText(\"Secret\").doesNotExist()", "originalCommit": "0b12d7611ec80f061957727553622b1c2cab7919", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDcyODE2MA==", "url": "https://github.com/dimagi/commcare-android/pull/2388#discussion_r510728160", "bodyText": "Missing ?", "author": "shubham1g5", "createdAt": "2020-10-23T08:41:12Z", "path": "app/instrumentation-tests/src/org/commcare/androidTests/TilesTest.kt", "diffHunk": "@@ -0,0 +1,183 @@\n+package org.commcare.androidTests\n+\n+import androidx.test.espresso.Espresso\n+import androidx.test.espresso.Espresso.onView\n+import androidx.test.espresso.action.ViewActions.click\n+import androidx.test.espresso.matcher.ViewMatchers.*\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.filters.LargeTest\n+import androidx.test.platform.app.InstrumentationRegistry\n+import org.commcare.CommCareInstrumentationTestApplication\n+import org.commcare.activities.EntitySelectActivity\n+import org.commcare.dalvik.R\n+import org.commcare.utils.*\n+import org.junit.Before\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+\n+@RunWith(AndroidJUnit4::class)\n+@LargeTest\n+class TilesTest: BaseTest() {\n+\n+    companion object {\n+        const val CCZ_NAME = \"tiles.ccz\"\n+        const val APP_NAME = \"Case Tile Tests\"\n+        var caseDetails = arrayOf(\"Sex F\", \"Date: 01/07/17\")\n+        var caseDetailsExpanded = caseDetails + arrayOf(\"Secret\")\n+    }\n+\n+    @Before\n+    fun setup() {\n+        installApp(APP_NAME, CCZ_NAME)\n+        InstrumentationUtility.login(\"tile.test\", \"123\")\n+    }\n+\n+    @Test\n+    fun testNoTile() {\n+        InstrumentationUtility.openModule(0)\n+\n+        caseDetails.areDisplayed()\n+\n+        onView(withText(\"Sally Ride\"))\n+                .perform(click())\n+        withId(R.id.com_tile_holder_btn_open).doesNotExist()\n+        withText(\"Sex F\").doesNotExist()\n+\n+        onView(withText(\"Continue\"))\n+                .perform(click())\n+        onView(withText(\"Placeholder\"))\n+                .perform(click())\n+\n+        withText(\"Inside\").isDisplayed()\n+        withText(\"Sally Ride\").doesNotExist()\n+    }\n+\n+    @Test\n+    fun testPersistentTile_withDropDown() {\n+        InstrumentationUtility.openModule(3)\n+\n+        onView(withText(\"Sally Ride\"))\n+                .perform(click())\n+\n+        caseDetails.areDisplayed()\n+        withText(\"Placeholder\").isDisplayed()\n+        withId(R.id.com_tile_holder_btn_open).isDisplayed()\n+\n+        // Expand tile\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        caseDetailsExpanded.areDisplayed()\n+\n+        // Close expanded list using the same button\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        withText(\"Secret\").doesNotExist()\n+\n+        // Use back button to close the expanded list\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        caseDetailsExpanded.areDisplayed()\n+        Espresso.pressBack()\n+        caseDetails.areDisplayed()\n+        withText(\"Secret\").doesNotExist()\n+\n+        // Confirm on pressing back we're in EntitySelectActivity\n+        Espresso.pressBack()\n+        val application = InstrumentationRegistry.getInstrumentation().targetContext.applicationContext\n+                as CommCareInstrumentationTestApplication\n+        var activity = application.currentActivity\n+        InstrumentationUtility.assert(activity is EntitySelectActivity, \"Current Activity is ${activity.localClassName}\")\n+\n+        onView(withText(\"Sally Ride\"))\n+                .perform(click())\n+        caseDetails.areDisplayed()\n+        withId(R.id.com_tile_holder_btn_open).isDisplayed()\n+\n+        // Go to form screen\n+        onView(withText(\"Placeholder\"))\n+                .perform(click())\n+\n+        withText(\"Inside\").isDisplayed()\n+        caseDetails.areDisplayed()\n+\n+        // Expand tile\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        caseDetailsExpanded.areDisplayed()\n+\n+        //Close expanded list\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        caseDetails.areDisplayed()\n+        withText(\"Secret\").doesNotExist()\n+    }\n+\n+    @Test\n+    fun testPersistentTile_withDetail() {\n+        InstrumentationUtility.openModule(1)\n+\n+        // Clicking this opens all the case details including the expanded ones.\n+        onView(withText(\"Sally Ride\"))\n+                .perform(click())\n+        caseDetailsExpanded.areDisplayed()\n+\n+        // And we don't see the expand button\n+        withId(R.id.com_tile_holder_btn_open).isNotDisplayed()\n+\n+        onView(withText(\"Continue\"))\n+                .perform(click())\n+\n+        caseDetails.areDisplayed()\n+        withText(\"Placeholder\").isDisplayed()\n+        withId(R.id.com_tile_holder_btn_open).isNotDisplayed()\n+\n+        // Open form\n+        onView(withText(\"Placeholder\"))\n+                .perform(click())\n+\n+        // We can still see the case details.\n+        caseDetails.areDisplayed()", "originalCommit": "0b12d7611ec80f061957727553622b1c2cab7919", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDcyOTkzNA==", "url": "https://github.com/dimagi/commcare-android/pull/2388#discussion_r510729934", "bodyText": "Step missing", "author": "shubham1g5", "createdAt": "2020-10-23T08:44:06Z", "path": "app/instrumentation-tests/src/org/commcare/androidTests/TilesTest.kt", "diffHunk": "@@ -0,0 +1,183 @@\n+package org.commcare.androidTests\n+\n+import androidx.test.espresso.Espresso\n+import androidx.test.espresso.Espresso.onView\n+import androidx.test.espresso.action.ViewActions.click\n+import androidx.test.espresso.matcher.ViewMatchers.*\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.filters.LargeTest\n+import androidx.test.platform.app.InstrumentationRegistry\n+import org.commcare.CommCareInstrumentationTestApplication\n+import org.commcare.activities.EntitySelectActivity\n+import org.commcare.dalvik.R\n+import org.commcare.utils.*\n+import org.junit.Before\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+\n+@RunWith(AndroidJUnit4::class)\n+@LargeTest\n+class TilesTest: BaseTest() {\n+\n+    companion object {\n+        const val CCZ_NAME = \"tiles.ccz\"\n+        const val APP_NAME = \"Case Tile Tests\"\n+        var caseDetails = arrayOf(\"Sex F\", \"Date: 01/07/17\")\n+        var caseDetailsExpanded = caseDetails + arrayOf(\"Secret\")\n+    }\n+\n+    @Before\n+    fun setup() {\n+        installApp(APP_NAME, CCZ_NAME)\n+        InstrumentationUtility.login(\"tile.test\", \"123\")\n+    }\n+\n+    @Test\n+    fun testNoTile() {\n+        InstrumentationUtility.openModule(0)\n+\n+        caseDetails.areDisplayed()\n+\n+        onView(withText(\"Sally Ride\"))\n+                .perform(click())\n+        withId(R.id.com_tile_holder_btn_open).doesNotExist()\n+        withText(\"Sex F\").doesNotExist()\n+\n+        onView(withText(\"Continue\"))\n+                .perform(click())\n+        onView(withText(\"Placeholder\"))\n+                .perform(click())\n+\n+        withText(\"Inside\").isDisplayed()\n+        withText(\"Sally Ride\").doesNotExist()\n+    }\n+\n+    @Test\n+    fun testPersistentTile_withDropDown() {\n+        InstrumentationUtility.openModule(3)\n+\n+        onView(withText(\"Sally Ride\"))\n+                .perform(click())\n+\n+        caseDetails.areDisplayed()\n+        withText(\"Placeholder\").isDisplayed()\n+        withId(R.id.com_tile_holder_btn_open).isDisplayed()\n+\n+        // Expand tile\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        caseDetailsExpanded.areDisplayed()\n+\n+        // Close expanded list using the same button\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        withText(\"Secret\").doesNotExist()\n+\n+        // Use back button to close the expanded list\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        caseDetailsExpanded.areDisplayed()\n+        Espresso.pressBack()\n+        caseDetails.areDisplayed()\n+        withText(\"Secret\").doesNotExist()\n+\n+        // Confirm on pressing back we're in EntitySelectActivity\n+        Espresso.pressBack()\n+        val application = InstrumentationRegistry.getInstrumentation().targetContext.applicationContext\n+                as CommCareInstrumentationTestApplication\n+        var activity = application.currentActivity\n+        InstrumentationUtility.assert(activity is EntitySelectActivity, \"Current Activity is ${activity.localClassName}\")\n+\n+        onView(withText(\"Sally Ride\"))\n+                .perform(click())\n+        caseDetails.areDisplayed()\n+        withId(R.id.com_tile_holder_btn_open).isDisplayed()\n+\n+        // Go to form screen\n+        onView(withText(\"Placeholder\"))\n+                .perform(click())\n+\n+        withText(\"Inside\").isDisplayed()\n+        caseDetails.areDisplayed()\n+\n+        // Expand tile\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        caseDetailsExpanded.areDisplayed()\n+\n+        //Close expanded list\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        caseDetails.areDisplayed()\n+        withText(\"Secret\").doesNotExist()\n+    }\n+\n+    @Test\n+    fun testPersistentTile_withDetail() {\n+        InstrumentationUtility.openModule(1)\n+\n+        // Clicking this opens all the case details including the expanded ones.\n+        onView(withText(\"Sally Ride\"))\n+                .perform(click())\n+        caseDetailsExpanded.areDisplayed()\n+\n+        // And we don't see the expand button\n+        withId(R.id.com_tile_holder_btn_open).isNotDisplayed()\n+\n+        onView(withText(\"Continue\"))\n+                .perform(click())\n+\n+        caseDetails.areDisplayed()\n+        withText(\"Placeholder\").isDisplayed()\n+        withId(R.id.com_tile_holder_btn_open).isNotDisplayed()\n+\n+        // Open form\n+        onView(withText(\"Placeholder\"))\n+                .perform(click())\n+\n+        // We can still see the case details.\n+        caseDetails.areDisplayed()\n+        withId(R.id.com_tile_holder_btn_open).isNotDisplayed()\n+    }\n+\n+    @Test\n+    fun testPersistentTile_noDetail_noInline() {\n+        InstrumentationUtility.openModule(2)\n+\n+        onView(withText(\"Sally Ride\"))\n+                .perform(click())\n+        caseDetails.areDisplayed()\n+        withText(\"Placeholder\").isDisplayed()\n+        withText(\"Secret\").doesNotExist()\n+        withId(R.id.com_tile_holder_btn_open).isNotDisplayed()\n+\n+        // go to form and you can still see the case details.\n+        onView(withText(\"Placeholder\"))\n+                .perform(click())\n+\n+        caseDetails.areDisplayed()", "originalCommit": "0b12d7611ec80f061957727553622b1c2cab7919", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDczMjU2Mw==", "url": "https://github.com/dimagi/commcare-android/pull/2388#discussion_r510732563", "bodyText": "This and that are not present", "author": "shubham1g5", "createdAt": "2020-10-23T08:48:07Z", "path": "app/instrumentation-tests/src/org/commcare/androidTests/TilesTest.kt", "diffHunk": "@@ -0,0 +1,183 @@\n+package org.commcare.androidTests\n+\n+import androidx.test.espresso.Espresso\n+import androidx.test.espresso.Espresso.onView\n+import androidx.test.espresso.action.ViewActions.click\n+import androidx.test.espresso.matcher.ViewMatchers.*\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.filters.LargeTest\n+import androidx.test.platform.app.InstrumentationRegistry\n+import org.commcare.CommCareInstrumentationTestApplication\n+import org.commcare.activities.EntitySelectActivity\n+import org.commcare.dalvik.R\n+import org.commcare.utils.*\n+import org.junit.Before\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+\n+@RunWith(AndroidJUnit4::class)\n+@LargeTest\n+class TilesTest: BaseTest() {\n+\n+    companion object {\n+        const val CCZ_NAME = \"tiles.ccz\"\n+        const val APP_NAME = \"Case Tile Tests\"\n+        var caseDetails = arrayOf(\"Sex F\", \"Date: 01/07/17\")\n+        var caseDetailsExpanded = caseDetails + arrayOf(\"Secret\")\n+    }\n+\n+    @Before\n+    fun setup() {\n+        installApp(APP_NAME, CCZ_NAME)\n+        InstrumentationUtility.login(\"tile.test\", \"123\")\n+    }\n+\n+    @Test\n+    fun testNoTile() {\n+        InstrumentationUtility.openModule(0)\n+\n+        caseDetails.areDisplayed()\n+\n+        onView(withText(\"Sally Ride\"))\n+                .perform(click())\n+        withId(R.id.com_tile_holder_btn_open).doesNotExist()\n+        withText(\"Sex F\").doesNotExist()\n+\n+        onView(withText(\"Continue\"))\n+                .perform(click())\n+        onView(withText(\"Placeholder\"))\n+                .perform(click())\n+\n+        withText(\"Inside\").isDisplayed()\n+        withText(\"Sally Ride\").doesNotExist()\n+    }\n+\n+    @Test\n+    fun testPersistentTile_withDropDown() {\n+        InstrumentationUtility.openModule(3)\n+\n+        onView(withText(\"Sally Ride\"))\n+                .perform(click())\n+\n+        caseDetails.areDisplayed()\n+        withText(\"Placeholder\").isDisplayed()\n+        withId(R.id.com_tile_holder_btn_open).isDisplayed()\n+\n+        // Expand tile\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        caseDetailsExpanded.areDisplayed()\n+\n+        // Close expanded list using the same button\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        withText(\"Secret\").doesNotExist()\n+\n+        // Use back button to close the expanded list\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        caseDetailsExpanded.areDisplayed()\n+        Espresso.pressBack()\n+        caseDetails.areDisplayed()\n+        withText(\"Secret\").doesNotExist()\n+\n+        // Confirm on pressing back we're in EntitySelectActivity\n+        Espresso.pressBack()\n+        val application = InstrumentationRegistry.getInstrumentation().targetContext.applicationContext\n+                as CommCareInstrumentationTestApplication\n+        var activity = application.currentActivity\n+        InstrumentationUtility.assert(activity is EntitySelectActivity, \"Current Activity is ${activity.localClassName}\")\n+\n+        onView(withText(\"Sally Ride\"))\n+                .perform(click())\n+        caseDetails.areDisplayed()\n+        withId(R.id.com_tile_holder_btn_open).isDisplayed()\n+\n+        // Go to form screen\n+        onView(withText(\"Placeholder\"))\n+                .perform(click())\n+\n+        withText(\"Inside\").isDisplayed()\n+        caseDetails.areDisplayed()\n+\n+        // Expand tile\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        caseDetailsExpanded.areDisplayed()\n+\n+        //Close expanded list\n+        onView(withId(R.id.com_tile_holder_btn_open))\n+                .perform(click())\n+        caseDetails.areDisplayed()\n+        withText(\"Secret\").doesNotExist()\n+    }\n+\n+    @Test\n+    fun testPersistentTile_withDetail() {\n+        InstrumentationUtility.openModule(1)\n+\n+        // Clicking this opens all the case details including the expanded ones.\n+        onView(withText(\"Sally Ride\"))\n+                .perform(click())\n+        caseDetailsExpanded.areDisplayed()\n+\n+        // And we don't see the expand button\n+        withId(R.id.com_tile_holder_btn_open).isNotDisplayed()\n+\n+        onView(withText(\"Continue\"))\n+                .perform(click())\n+\n+        caseDetails.areDisplayed()\n+        withText(\"Placeholder\").isDisplayed()\n+        withId(R.id.com_tile_holder_btn_open).isNotDisplayed()\n+\n+        // Open form\n+        onView(withText(\"Placeholder\"))\n+                .perform(click())\n+\n+        // We can still see the case details.\n+        caseDetails.areDisplayed()\n+        withId(R.id.com_tile_holder_btn_open).isNotDisplayed()\n+    }\n+\n+    @Test\n+    fun testPersistentTile_noDetail_noInline() {\n+        InstrumentationUtility.openModule(2)\n+\n+        onView(withText(\"Sally Ride\"))\n+                .perform(click())\n+        caseDetails.areDisplayed()\n+        withText(\"Placeholder\").isDisplayed()\n+        withText(\"Secret\").doesNotExist()\n+        withId(R.id.com_tile_holder_btn_open).isNotDisplayed()\n+\n+        // go to form and you can still see the case details.\n+        onView(withText(\"Placeholder\"))\n+                .perform(click())\n+\n+        caseDetails.areDisplayed()\n+        withText(\"Secret\").doesNotExist()\n+        withId(R.id.com_tile_holder_btn_open).isNotDisplayed()\n+    }\n+\n+    @Test\n+    fun testBreadcrumb() {", "originalCommit": "0b12d7611ec80f061957727553622b1c2cab7919", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7f0153737dd25ff9fb054a61ffc9487d2fd6f3ff", "url": "https://github.com/dimagi/commcare-android/commit/7f0153737dd25ff9fb054a61ffc9487d2fd6f3ff", "message": "PR suggestions", "committedDate": "2020-10-28T07:58:34Z", "type": "commit"}]}