{"pr_number": 2379, "pr_title": "Add form settings test", "pr_createdAt": "2020-10-19T05:58:15Z", "pr_url": "https://github.com/dimagi/commcare-android/pull/2379", "timeline": [{"oid": "42226dbfd8a741e55c1f5c0652d0b4484e1e91f6", "url": "https://github.com/dimagi/commcare-android/commit/42226dbfd8a741e55c1f5c0652d0b4484e1e91f6", "message": "Add form settings test", "committedDate": "2020-10-19T05:54:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU4ODgxMA==", "url": "https://github.com/dimagi/commcare-android/pull/2379#discussion_r507588810", "bodyText": "Should we have a similar check as L118 for checking if the size changed to medium or not ?", "author": "shubham1g5", "createdAt": "2020-10-19T09:06:02Z", "path": "app/instrumentation-tests/src/org/commcare/androidTests/FormSettingsTest.kt", "diffHunk": "@@ -0,0 +1,139 @@\n+package org.commcare.androidTests\n+\n+import androidx.annotation.IdRes\n+import androidx.test.espresso.Espresso\n+import androidx.test.espresso.Espresso.*\n+import androidx.test.espresso.action.ViewActions.click\n+import androidx.test.espresso.action.ViewActions.typeText\n+import androidx.test.espresso.assertion.ViewAssertions.doesNotExist\n+import androidx.test.espresso.assertion.ViewAssertions.matches\n+import androidx.test.espresso.matcher.ViewMatchers.*\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.filters.LargeTest\n+import androidx.test.platform.app.InstrumentationRegistry\n+import org.commcare.dalvik.R\n+import org.commcare.utils.CustomMatchers\n+import org.commcare.utils.InstrumentationUtility\n+import org.hamcrest.Matchers.*\n+import org.junit.Before\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+\n+@RunWith(AndroidJUnit4::class)\n+@LargeTest\n+class FormSettingsTest: BaseTest() {\n+\n+    companion object {\n+        const val CCZ_NAME = \"settings_sheet_tests.ccz\"\n+        const val APP_NAME = \"App for Settings Sheet\"\n+    }\n+\n+    @Before\n+    fun setup() {\n+        installApp(APP_NAME, CCZ_NAME)\n+        InstrumentationUtility.login(\"settings.test\", \"123\")\n+    }\n+\n+    @Test\n+    fun testSaveFormSetting() {\n+        InstrumentationUtility.openForm(0, 1)\n+        onView(withId(R.id.nav_btn_next))\n+                .perform(click())\n+        onView(withClassName(endsWith(\"EditText\")))\n+                .perform(typeText(\"Test Value 123\"))\n+        Espresso.closeSoftKeyboard()\n+        selectSetting(R.string.save_all_answers)\n+\n+        Espresso.pressBack()\n+        onView(withText(R.string.do_not_save))\n+                .perform(click())\n+        InstrumentationUtility.gotoHome()\n+\n+        InstrumentationUtility.openFirstIncompleteForm()\n+        onView(withText(\"Test Value 123\"))\n+                .check(matches(isDisplayed()))\n+    }\n+\n+    @Test\n+    fun testGoToPromptSetting() {\n+        InstrumentationUtility.openForm(0, 1)\n+        selectSetting(R.string.view_hierarchy)\n+\n+        // Confirm you're seeing all the options.\n+        onView(withId(R.id.jumpPreviousButton))\n+                .check(matches(isDisplayed()))\n+        onView(withId(R.id.jumpBeginningButton))\n+                .check(matches(isDisplayed()))\n+        onView(withId(R.id.jumpEndButton))\n+                .check(matches(isDisplayed()))\n+\n+        // Click go to end\n+        onView(withId(R.id.jumpEndButton))\n+                .perform(click())\n+\n+        // Confirm you can see the finish button\n+        onView(withId(R.id.nav_btn_finish))\n+                .check(matches(isDisplayed()))\n+    }\n+\n+    @Test\n+    fun testChangeLanguageSetting() {\n+        InstrumentationUtility.openForm(0, 1 )\n+        selectSetting(R.string.change_language)\n+        // We see 2 choices::\n+        onView(withId(R.id.choices_list_view))\n+                .check(matches(CustomMatchers.matchListSize(2)))\n+        // English and Hindi\n+        onView(withText(\"English\"))\n+                .check(matches(isDisplayed()))\n+        onView(withText(\"\u0939\u093f\u0902\u0926\u0940\"))\n+                .check(matches(isDisplayed()))\n+\n+        onView(withText(\"\u0939\u093f\u0902\u0926\u0940\"))\n+                .perform(click())\n+\n+        onView(withText(startsWith(\"HINDI TRANSLATION\")))\n+                .check(matches(isDisplayed()))\n+        selectSetting(R.string.change_language)\n+        // Again we see 2 choices\n+        onView(withId(R.id.choices_list_view))\n+                .check(matches(CustomMatchers.matchListSize(2)))\n+\n+        onView(withText(\"English\"))\n+                .perform(click())\n+        onView(withText(startsWith(\"HINDI TRANSLATION\")))\n+                .check(doesNotExist())\n+    }\n+\n+    @Test\n+    fun testTextSizeSetting() {\n+        InstrumentationUtility.openForm(0, 1 )\n+        val context = InstrumentationRegistry.getInstrumentation().targetContext\n+        val fontNames = context.resources.getStringArray(R.array.font_size_entries)\n+        val fontValues = context.resources.getStringArray(R.array.font_size_entry_values)\n+\n+        // Change font size to extra small and confirm if the question text size changes\n+        val extraSmallFontIndex = fontNames.size - 1\n+        changeFontSize(fontNames[extraSmallFontIndex])\n+        onView(withText(startsWith(\"The following questions\")))\n+                .check(matches(CustomMatchers.withFontSize(fontValues[extraSmallFontIndex].toFloat())))\n+\n+        val mediumFontIndex = 2\n+        changeFontSize(fontNames[mediumFontIndex])", "originalCommit": "42226dbfd8a741e55c1f5c0652d0b4484e1e91f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYxNDE4Nw==", "url": "https://github.com/dimagi/commcare-android/pull/2379#discussion_r507614187", "bodyText": "Sounds good, will add the check for it.", "author": "ShivamPokhriyal", "createdAt": "2020-10-19T09:45:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU4ODgxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU4OTU2OQ==", "url": "https://github.com/dimagi/commcare-android/pull/2379#discussion_r507589569", "bodyText": "nice work implementing this.", "author": "shubham1g5", "createdAt": "2020-10-19T09:07:08Z", "path": "app/instrumentation-tests/src/org/commcare/utils/CustomMatchers.kt", "diffHunk": "@@ -105,4 +107,22 @@ object CustomMatchers {\n         }\n     }\n \n+    fun withFontSize(expectedSize: Float): Matcher<View> {", "originalCommit": "42226dbfd8a741e55c1f5c0652d0b4484e1e91f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9700bf853976d55b7d5cc56ac759c615e0a16e64", "url": "https://github.com/dimagi/commcare-android/commit/9700bf853976d55b7d5cc56ac759c615e0a16e64", "message": "Add check for font size medium", "committedDate": "2020-10-19T09:57:30Z", "type": "commit"}, {"oid": "aae53509aa473b281c2fe37f46ff57d846622415", "url": "https://github.com/dimagi/commcare-android/commit/aae53509aa473b281c2fe37f46ff57d846622415", "message": "Merge branch 'master' into form-setting-test", "committedDate": "2020-10-19T11:40:16Z", "type": "commit"}]}