{"pr_number": 1664, "pr_title": "Multi await feature for intentional blocking", "pr_createdAt": "2020-04-20T08:27:48Z", "pr_url": "https://github.com/oracle/helidon/pull/1664", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE5MjcyMA==", "url": "https://github.com/oracle/helidon/pull/1664#discussion_r411192720", "bodyText": "final", "author": "akarnokd", "createdAt": "2020-04-20T08:31:15Z", "path": "common/reactive/src/main/java/io/helidon/common/reactive/MultiCompletionStage.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright (c)  2020 Oracle and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package io.helidon.common.reactive;\n+\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.CompletionException;\n+import java.util.concurrent.CompletionStage;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+/**\n+ * CompletionStage with await functions, to achieve intentional blocking without checked exceptions.\n+ */\n+public interface MultiCompletionStage extends CompletionStage<Void> {\n+\n+    static MultiCompletableFuture createFuture() {\n+        return new MultiCompletableFuture();\n+    }\n+\n+    /**\n+     * Block until stage is completed, throws only unchecked exceptions.\n+     *\n+     * @throws java.util.concurrent.CancellationException if the computation was cancelled\n+     * @throws CompletionException                        if this future completed\n+     */\n+    default void await() {\n+        this.toCompletableFuture().join();\n+    }\n+\n+    /**\n+     * Block until stage is completed, throws only unchecked exceptions.\n+     *\n+     * @param timeout the maximum time to wait\n+     * @param unit    the time unit of the timeout argument\n+     * @return the result value\n+     * @throws java.util.concurrent.CancellationException if this future was cancelled\n+     * @throws CompletionException                        if this future completed exceptionally,\n+     *                                                    was interrupted while waiting or the wait timed out\n+     */\n+    default void await(long timeout, TimeUnit unit) {\n+        try {\n+            this.toCompletableFuture().get(timeout, unit);\n+        } catch (InterruptedException | ExecutionException | TimeoutException e) {\n+            throw new CompletionException(e);\n+        }\n+    }\n+\n+    class MultiCompletableFuture extends CompletableFuture<Void> implements MultiCompletionStage {", "originalCommit": "454d3e2768ab0a2fda52671623ae732d63bafca4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjkwOTkwNA==", "url": "https://github.com/oracle/helidon/pull/1664#discussion_r412909904", "bodyText": "fixed", "author": "danielkec", "createdAt": "2020-04-22T11:45:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE5MjcyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE5Mzg0Nw==", "url": "https://github.com/oracle/helidon/pull/1664#discussion_r411193847", "bodyText": "I'd definitely add cancellation support to this. AutoCloseable perhaps.", "author": "akarnokd", "createdAt": "2020-04-20T08:33:04Z", "path": "common/reactive/src/main/java/io/helidon/common/reactive/Multi.java", "diffHunk": "@@ -843,9 +843,13 @@\n      *\n      * @param consumer consumer to be invoked for each item\n      */\n-    default void forEach(Consumer<? super T> consumer) {\n-        FunctionalSubscriber<T> subscriber = new FunctionalSubscriber<>(consumer, null, null, null);\n+    default MultiCompletionStage forEach(Consumer<? super T> consumer) {", "originalCommit": "454d3e2768ab0a2fda52671623ae732d63bafca4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjkxMDcwMw==", "url": "https://github.com/oracle/helidon/pull/1664#discussion_r412910703", "bodyText": "That's pretty cool! \ud83d\udc4d", "author": "danielkec", "createdAt": "2020-04-22T11:46:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE5Mzg0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE5NDU4MQ==", "url": "https://github.com/oracle/helidon/pull/1664#discussion_r411194581", "bodyText": "I'd unwrap ExecutionException here.", "author": "akarnokd", "createdAt": "2020-04-20T08:34:09Z", "path": "common/reactive/src/main/java/io/helidon/common/reactive/MultiCompletionStage.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * Copyright (c)  2020 Oracle and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package io.helidon.common.reactive;\n+\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.CompletionException;\n+import java.util.concurrent.CompletionStage;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+/**\n+ * CompletionStage with await functions, to achieve intentional blocking without checked exceptions.\n+ */\n+public interface MultiCompletionStage extends CompletionStage<Void> {\n+\n+    /**\n+     * Create new MultiCompletableFuture.\n+     *\n+     * @return MultiCompletableFuture\n+     */\n+    static MultiCompletableFuture createFuture() {\n+        return new MultiCompletableFuture();\n+    }\n+\n+    /**\n+     * Block until stage is completed, throws only unchecked exceptions.\n+     *\n+     * @throws java.util.concurrent.CancellationException if the computation was cancelled\n+     * @throws CompletionException                        if this future completed\n+     */\n+    default void await() {\n+        this.toCompletableFuture().join();\n+    }\n+\n+    /**\n+     * Block until stage is completed, throws only unchecked exceptions.\n+     *\n+     * @param timeout the maximum time to wait\n+     * @param unit    the time unit of the timeout argument\n+     * @throws java.util.concurrent.CancellationException if this future was cancelled\n+     * @throws CompletionException                        if this future completed exceptionally,\n+     *                                                    was interrupted while waiting or the wait timed out\n+     */\n+    default void await(long timeout, TimeUnit unit) {\n+        try {\n+            this.toCompletableFuture().get(timeout, unit);\n+        } catch (InterruptedException | ExecutionException | TimeoutException e) {\n+            throw new CompletionException(e);", "originalCommit": "677aaa575eb8a569e0b59cf3d06e5e590cf7477a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjkxMDg2NA==", "url": "https://github.com/oracle/helidon/pull/1664#discussion_r412910864", "bodyText": "thx", "author": "danielkec", "createdAt": "2020-04-22T11:47:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE5NDU4MQ=="}], "type": "inlineReview"}, {"oid": "2b41f5c414b3aae906531ed6027fa138cc50208b", "url": "https://github.com/oracle/helidon/commit/2b41f5c414b3aae906531ed6027fa138cc50208b", "message": "Single implementing CompletionStage\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-04-24T16:26:40Z", "type": "forcePushed"}, {"oid": "cb8e7d5f69802a9238cb87139db449327b0b8125", "url": "https://github.com/oracle/helidon/commit/cb8e7d5f69802a9238cb87139db449327b0b8125", "message": "Multi await feature for intentional blocking\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-04-24T16:26:40Z", "type": "commit"}, {"oid": "5db808e37034a375370c9ebfdfeba5ddd60facc7", "url": "https://github.com/oracle/helidon/commit/5db808e37034a375370c9ebfdfeba5ddd60facc7", "message": "Auto-closeable forEach\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-04-24T16:26:40Z", "type": "commit"}, {"oid": "2b41f5c414b3aae906531ed6027fa138cc50208b", "url": "https://github.com/oracle/helidon/commit/2b41f5c414b3aae906531ed6027fa138cc50208b", "message": "Single implementing CompletionStage\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-04-24T16:26:40Z", "type": "commit"}, {"oid": "82f71b081961dac5101fd975b0cf15f2c0f3b5cd", "url": "https://github.com/oracle/helidon/commit/82f71b081961dac5101fd975b0cf15f2c0f3b5cd", "message": "Remove obsolete MultiCompletionStage\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-05-05T20:10:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ0OTU2OA==", "url": "https://github.com/oracle/helidon/pull/1664#discussion_r420449568", "bodyText": "Wrong javadoc for return type", "author": "tomas-langer", "createdAt": "2020-05-05T22:41:55Z", "path": "common/reactive/src/main/java/io/helidon/common/reactive/Multi.java", "diffHunk": "@@ -842,10 +855,23 @@\n      * Terminal stage, invokes provided consumer for every item in the stream.\n      *\n      * @param consumer consumer to be invoked for each item\n-     */\n-    default void forEach(Consumer<? super T> consumer) {\n-        FunctionalSubscriber<T> subscriber = new FunctionalSubscriber<>(consumer, null, null, null);\n+     * @return MultiCompletionStage", "originalCommit": "82f71b081961dac5101fd975b0cf15f2c0f3b5cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ0OTgxMA==", "url": "https://github.com/oracle/helidon/pull/1664#discussion_r420449810", "bodyText": "Also the type is clearly visible from Javadoc already, this should describe behavior, not type", "author": "tomas-langer", "createdAt": "2020-05-05T22:42:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ0OTU2OA=="}], "type": "inlineReview"}, {"oid": "4bc3dce720b1ada9b97182a494a27441ba12214b", "url": "https://github.com/oracle/helidon/commit/4bc3dce720b1ada9b97182a494a27441ba12214b", "message": "Review issues 1\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-05-06T08:21:11Z", "type": "commit"}, {"oid": "6c70d0d022af05ddb8bff2ffffc6d92112028620", "url": "https://github.com/oracle/helidon/commit/6c70d0d022af05ddb8bff2ffffc6d92112028620", "message": "Review issues 2\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-05-06T08:46:21Z", "type": "commit"}, {"oid": "13446eff5504c64e5f6471c1dce40946c8ff3c16", "url": "https://github.com/oracle/helidon/commit/13446eff5504c64e5f6471c1dce40946c8ff3c16", "message": "Review issues 3\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-05-06T14:08:05Z", "type": "commit"}, {"oid": "13a1b6ad905a455ff146445557e015e4948478d9", "url": "https://github.com/oracle/helidon/commit/13a1b6ad905a455ff146445557e015e4948478d9", "message": "Make the chain of CompletionStage methods preserve await", "committedDate": "2020-05-07T13:21:22Z", "type": "commit"}, {"oid": "bbd9cfc73b472956b5a5f7966701aebe50816b45", "url": "https://github.com/oracle/helidon/commit/bbd9cfc73b472956b5a5f7966701aebe50816b45", "message": "Checkstyle\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-05-08T07:01:06Z", "type": "commit"}, {"oid": "3a8a45c867346ff70f4b6d7f9131cc306ca3f083", "url": "https://github.com/oracle/helidon/commit/3a8a45c867346ff70f4b6d7f9131cc306ca3f083", "message": "Hamcrestination", "committedDate": "2020-05-11T15:30:37Z", "type": "commit"}]}