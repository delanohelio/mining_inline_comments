{"pr_number": 1982, "pr_title": "New DB archetype for SE", "pr_createdAt": "2020-06-11T19:12:11Z", "pr_url": "https://github.com/oracle/helidon/pull/1982", "timeline": [{"oid": "c66908df5f7036769d56c630bba13c7fb3569af8", "url": "https://github.com/oracle/helidon/commit/c66908df5f7036769d56c630bba13c7fb3569af8", "message": "Initial version of DB SE example for new archetype.\n\nSigned-off-by: Santiago Pericasgeertsen <santiago.pericasgeertsen@oracle.com>", "committedDate": "2020-06-11T18:58:01Z", "type": "commit"}, {"oid": "af8b4891bda74b17f989011dafeb29162a293985", "url": "https://github.com/oracle/helidon/commit/af8b4891bda74b17f989011dafeb29162a293985", "message": "New example for DB SE archetype.\n\nSigned-off-by: Santiago Pericasgeertsen <santiago.pericasgeertsen@oracle.com>", "committedDate": "2020-06-11T18:58:01Z", "type": "commit"}, {"oid": "9955ea7d046b385da066f76dc2d8fa6783d08001", "url": "https://github.com/oracle/helidon/commit/9955ea7d046b385da066f76dc2d8fa6783d08001", "message": "Created new archetype from example.\n\nSigned-off-by: Santiago Pericasgeertsen <santiago.pericasgeertsen@oracle.com>", "committedDate": "2020-06-11T19:02:34Z", "type": "commit"}, {"oid": "60410b76a5939ef650b64a49379188cfce5c862d", "url": "https://github.com/oracle/helidon/commit/60410b76a5939ef650b64a49379188cfce5c862d", "message": "Removed example from pom.\n\nSigned-off-by: Santiago Pericasgeertsen <santiago.pericasgeertsen@oracle.com>", "committedDate": "2020-06-11T19:04:11Z", "type": "commit"}, {"oid": "a7a77608e4770053a05930651b90056751e3d7d9", "url": "https://github.com/oracle/helidon/commit/a7a77608e4770053a05930651b90056751e3d7d9", "message": "Updated catalog and archetypes pom.\n\nSigned-off-by: Santiago Pericasgeertsen <santiago.pericasgeertsen@oracle.com>", "committedDate": "2020-06-11T19:08:22Z", "type": "commit"}, {"oid": "c097244c1d9f4bc3f223b9ce93783e11ce972634", "url": "https://github.com/oracle/helidon/commit/c097244c1d9f4bc3f223b9ce93783e11ce972634", "message": "Removed native-image directory.\n\nSigned-off-by: Santiago Pericasgeertsen <santiago.pericasgeertsen@oracle.com>", "committedDate": "2020-06-11T19:15:20Z", "type": "commit"}, {"oid": "ddfac62d83bb8e132f5bbd776cfaac4768ced0e9", "url": "https://github.com/oracle/helidon/commit/ddfac62d83bb8e132f5bbd776cfaac4768ced0e9", "message": "Renamed main class and fixed other minor issues.\n\nSigned-off-by: Santiago Pericasgeertsen <santiago.pericasgeertsen@oracle.com>", "committedDate": "2020-06-12T14:31:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU1NDIyNg==", "url": "https://github.com/oracle/helidon/pull/1982#discussion_r439554226", "bodyText": "Double semi colon", "author": "romain-grecourt", "createdAt": "2020-06-12T17:33:34Z", "path": "archetypes/database-se/src/main/resources/src/main/java/__pkg__/PokemonService.java.mustache", "diffHunk": "@@ -0,0 +1,155 @@\n+\n+package {{package}};\n+\n+import java.util.List;\n+import java.util.concurrent.CompletionException;\n+import java.util.concurrent.ExecutionException;\n+import java.util.logging.Level;\n+import java.util.logging.Logger;;", "originalCommit": "ddfac62d83bb8e132f5bbd776cfaac4768ced0e9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "985dbf8f0317781ab110bc7efbc14ad9163ad538", "url": "https://github.com/oracle/helidon/commit/985dbf8f0317781ab110bc7efbc14ad9163ad538", "message": "Removed double semi colon", "committedDate": "2020-06-12T18:36:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYwMTIyMw==", "url": "https://github.com/oracle/helidon/pull/1982#discussion_r439601223", "bodyText": "Other archetypes seem to use a different pattern:\n\n  \n    \n      helidon/archetypes/bare-se/src/main/resources/src/main/java/__pkg__/Main.java.mustache\n    \n    \n        Lines 55 to 68\n      in\n      6e4e3aa\n    \n    \n    \n    \n\n        \n          \n                   // Try to start the server. If successful, print some info and arrange to \n        \n\n        \n          \n                   // print a message at shutdown. If unsuccessful, print the exception. \n        \n\n        \n          \n                   server.start() \n        \n\n        \n          \n                           .thenAccept(ws -> { \n        \n\n        \n          \n                               System.out.println( \n        \n\n        \n          \n                                       \"WEB server is up! http://localhost:\" + ws.port() + \"/greet\"); \n        \n\n        \n          \n                               ws.whenShutdown().thenRun(() \n        \n\n        \n          \n                                       -> System.out.println(\"WEB server is DOWN. Good bye!\")); \n        \n\n        \n          \n                           }) \n        \n\n        \n          \n                           .exceptionally(t -> { \n        \n\n        \n          \n                               System.err.println(\"Startup failed: \" + t.getMessage()); \n        \n\n        \n          \n                               t.printStackTrace(System.err); \n        \n\n        \n          \n                               return null; \n        \n\n        \n          \n                           }); \n        \n    \n  \n\n\nWe should probably be consistent unless it makes sense otherwise.", "author": "tjquinno", "createdAt": "2020-06-12T19:18:56Z", "path": "archetypes/database-se/src/main/resources/src/main/java/__pkg__/Main.java.mustache", "diffHunk": "@@ -0,0 +1,96 @@\n+\n+package {{package}};\n+\n+import java.io.IOException;\n+import java.util.logging.LogManager;\n+\n+import io.helidon.config.Config;\n+import io.helidon.dbclient.DbClient;\n+import io.helidon.dbclient.health.DbClientHealthCheck;\n+import io.helidon.health.HealthSupport;\n+import io.helidon.media.jsonb.JsonbSupport;\n+import io.helidon.media.jsonp.JsonpSupport;\n+import io.helidon.metrics.MetricsSupport;\n+import io.helidon.webserver.Routing;\n+import io.helidon.webserver.WebServer;\n+\n+/**\n+ * Main class that starts up server and registers Pokemon services.\n+ */\n+public final class Main {\n+\n+    /**\n+     * Cannot be instantiated.\n+     */\n+    private Main() {\n+    }\n+\n+    /**\n+     * Application main entry point.\n+     *\n+     * @param args command line arguments\n+     * @throws java.io.IOException if there are problems reading logging properties\n+     */\n+    public static void main(final String[] args) throws IOException {\n+        startServer();\n+    }\n+\n+    /**\n+     * Start the server.\n+     *\n+     * @return the created {@link io.helidon.webserver.WebServer} instance\n+     * @throws java.io.IOException if there are problems reading logging properties\n+     */\n+    static WebServer startServer() throws IOException {\n+        // Load logging configuration\n+        LogManager.getLogManager().readConfiguration(Main.class.getResourceAsStream(\"/logging.properties\"));\n+\n+        // By default this will pick up application.yaml from the classpath\n+        Config config = Config.create();\n+\n+        // Prepare routing and build server\n+        Routing routing = createRouting(config);\n+        WebServer server = WebServer.builder(routing)\n+                .addMediaSupport(JsonpSupport.create())\n+                .addMediaSupport(JsonbSupport.create())\n+                .config(config.get(\"server\"))\n+                .build();\n+\n+        // Start the server and print some info\n+        server.start()\n+                .thenAccept(ws -> System.out.println(\"WEB server is up! http://localhost:\" + ws.port() + \"/\"));\n+\n+        // Server threads are not daemon\n+        server.whenShutdown()\n+                .thenRun(() -> System.out.println(\"WEB server is DOWN. Good bye!\"));\n+", "originalCommit": "ddfac62d83bb8e132f5bbd776cfaac4768ced0e9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fa16a740f842b80e13f26832da8ec1f84034409c", "url": "https://github.com/oracle/helidon/commit/fa16a740f842b80e13f26832da8ec1f84034409c", "message": "Make server startup/shutdown consistent with other archetypes.\n\nSigned-off-by: Santiago Pericasgeertsen <santiago.pericasgeertsen@oracle.com>", "committedDate": "2020-06-12T19:41:44Z", "type": "commit"}]}