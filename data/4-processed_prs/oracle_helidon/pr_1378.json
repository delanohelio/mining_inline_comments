{"pr_number": 1378, "pr_title": "Adds a default send(Throwable) method to ServerResponse.java as the first step in providing an easy facility for reporting exceptions during HTTP processing", "pr_createdAt": "2020-02-12T21:43:16Z", "pr_url": "https://github.com/oracle/helidon/pull/1378", "timeline": [{"oid": "2bcdde56cc346805e7635d2fae3a189e16155f9b", "url": "https://github.com/oracle/helidon/commit/2bcdde56cc346805e7635d2fae3a189e16155f9b", "message": "Adds a default send(Throwable) method to ServerResponse.java as the first step in providing an easy facility for reporting exceptions during HTTP processing.\n\nSigned-off-by: Laird Nelson <laird.nelson@oracle.com>", "committedDate": "2020-02-12T21:40:23Z", "type": "commit"}, {"oid": "8d2b36b5e745ad20aa38ecd87fafc749f0ce700c", "url": "https://github.com/oracle/helidon/commit/8d2b36b5e745ad20aa38ecd87fafc749f0ce700c", "message": "Interim squashable commit; added Javadoc comment to satisfy checkstyle\n\nSigned-off-by: Laird Nelson <laird.nelson@oracle.com>", "committedDate": "2020-02-12T21:50:02Z", "type": "commit"}, {"oid": "dc876262aa94e05d68fded0cdc9654ae1fb28ff0", "url": "https://github.com/oracle/helidon/commit/dc876262aa94e05d68fded0cdc9654ae1fb28ff0", "message": "Interim squashable commit; adds ThrowableBodyWriter.java\n\nSigned-off-by: Laird Nelson <laird.nelson@oracle.com>", "committedDate": "2020-02-12T23:11:11Z", "type": "commit"}, {"oid": "3a41844095c634bdc960a7df97339241ae176762", "url": "https://github.com/oracle/helidon/commit/3a41844095c634bdc960a7df97339241ae176762", "message": "Interim squashable commit; adds another create() method in ThrowableBodyWriter.java\n\nSigned-off-by: Laird Nelson <laird.nelson@oracle.com>", "committedDate": "2020-02-12T23:13:16Z", "type": "commit"}, {"oid": "d7096ed998cfafa8cc189193a73e8c6370495556", "url": "https://github.com/oracle/helidon/commit/d7096ed998cfafa8cc189193a73e8c6370495556", "message": "Interim squashable commit; incorporated discussion outcome with Romain\n\nSigned-off-by: Laird Nelson <laird.nelson@oracle.com>", "committedDate": "2020-02-13T22:14:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE2NDA1Mw==", "url": "https://github.com/oracle/helidon/pull/1378#discussion_r379164053", "bodyText": "Function<T, Publisher<DataChunk> is the old style of writer that is deprecated, we don't need that.", "author": "romain-grecourt", "createdAt": "2020-02-13T22:51:26Z", "path": "media/common/src/main/java/io/helidon/media/common/ContentWriters.java", "diffHunk": "@@ -147,4 +187,18 @@ private ContentWriters() {\n     public static Function<ReadableByteChannel, Publisher<DataChunk>> byteChannelWriter() {\n         return byteChannelWriter(null);\n     }\n+\n+    /**\n+     * Returns a writer function for a {@link Throwable}'s stack trace.\n+     *\n+     * @param context a {@link MessageBodyWriterContext}\n+     * @param setContentLength whether {@link MessageBodyWriterContext#contentLength(long)} should be called\n+     * @return a {@link Throwable} writer\n+     * @see #writeStackTrace(Throwable, MessageBodyWriterContext, boolean)\n+     */\n+    public static Function<Throwable, Publisher<DataChunk>> stackTraceWriter(MessageBodyWriterContext context,", "originalCommit": "d7096ed998cfafa8cc189193a73e8c6370495556", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE2NzY1OA==", "url": "https://github.com/oracle/helidon/pull/1378#discussion_r379167658", "bodyText": "OK; will remove these.  (The other ones: should they be @Deprecated?)", "author": "ljnelson", "createdAt": "2020-02-13T23:01:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE2NDA1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE2NTMxMA==", "url": "https://github.com/oracle/helidon/pull/1378#discussion_r379165310", "bodyText": "With the addition the context as parameter, this methods differs from all the other ones in ContentWriters.\nLets not over do it and stick with just ThrowableBodyWriter.", "author": "romain-grecourt", "createdAt": "2020-02-13T22:54:57Z", "path": "media/common/src/main/java/io/helidon/media/common/ContentWriters.java", "diffHunk": "@@ -81,6 +83,44 @@ private ContentWriters() {\n         return Single.just(DataChunk.create(false, buffer.encode(charset)));\n     }\n \n+    /**\n+     * Create a a publisher {@link DataChunk} with the given\n+     * {@link Throwable} / {@link Charset} and return a {@link Single}.\n+     *\n+     * @param throwable the {@link Throwable}\n+     * @param context a {@link MessageBodyWriterContext}\n+     * @param setContentLength whether {@link MessageBodyWriterContext#contentLength(long)} should be called\n+     * @return Single\n+     */\n+    public static Single<DataChunk> writeStackTrace(Throwable throwable,\n+                                                    MessageBodyWriterContext context,", "originalCommit": "d7096ed998cfafa8cc189193a73e8c6370495556", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE2NzUwMQ==", "url": "https://github.com/oracle/helidon/pull/1378#discussion_r379167501", "bodyText": "OK; note that the content length issue is one that will be faced by the CharSequence-related methods as well, so if it's OK to remove content length concerns then I can accept what they do.  WDYT?", "author": "ljnelson", "createdAt": "2020-02-13T23:01:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE2NTMxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE2NTk4NQ==", "url": "https://github.com/oracle/helidon/pull/1378#discussion_r379165985", "bodyText": "Lets not use a default method here.\nThe API and implementation come together, so there isn't much benefit to having a default method implementation right ?", "author": "romain-grecourt", "createdAt": "2020-02-13T22:56:51Z", "path": "webserver/webserver/src/main/java/io/helidon/webserver/ServerResponse.java", "diffHunk": "@@ -100,6 +100,27 @@ default ServerResponse status(int statusCode) throws AlreadyCompletedException {\n      */\n     MessageBodyWriterContext writerContext();\n \n+    /**\n+     * Send a {@link Throwable} and close the response.\n+     *\n+     * @param content the {@link Throwable} to send\n+     * @return {@code null} when invoked\n+     * @throws IllegalArgumentException if there is no registered writer for a given type\n+     * @throws IllegalStateException if any {@code send(...)} method was already called\n+     * @see #send(Object)\n+     */\n+    default Void send(Throwable content) {", "originalCommit": "d7096ed998cfafa8cc189193a73e8c6370495556", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE2NzE0Nw==", "url": "https://github.com/oracle/helidon/pull/1378#discussion_r379167147", "bodyText": "OK; will change to an interface here and then will move its contents to {checks notes} Response.java.", "author": "ljnelson", "createdAt": "2020-02-13T23:00:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE2NTk4NQ=="}], "type": "inlineReview"}, {"oid": "199f84c896785a382fce7cebd040ef388ea25109", "url": "https://github.com/oracle/helidon/commit/199f84c896785a382fce7cebd040ef388ea25109", "message": "Interim squashable commit; moved send(Throwable) to Response.java per discussion\n\nSigned-off-by: Laird Nelson <laird.nelson@oracle.com>", "committedDate": "2020-02-13T23:06:35Z", "type": "commit"}, {"oid": "c079f8cca7a50a8137f26474c0183b9d9827e2a4", "url": "https://github.com/oracle/helidon/commit/c079f8cca7a50a8137f26474c0183b9d9827e2a4", "message": "Interim squashable commit; removed apparently deprecated style of writer-furnishing method in ContentWriters.java per discussion\n\nSigned-off-by: Laird Nelson <laird.nelson@oracle.com>", "committedDate": "2020-02-13T23:08:37Z", "type": "commit"}, {"oid": "27566c861698e2807766d65e2570bb1216b99e57", "url": "https://github.com/oracle/helidon/commit/27566c861698e2807766d65e2570bb1216b99e57", "message": "Interim squashable commit; removed content length concerns from writeStackTrace method in ContentWriters.java per discussion\n\nSigned-off-by: Laird Nelson <laird.nelson@oracle.com>", "committedDate": "2020-02-13T23:19:22Z", "type": "commit"}, {"oid": "b6682c2a80c9b949de5c2a848e3116cfbba1e26c", "url": "https://github.com/oracle/helidon/commit/b6682c2a80c9b949de5c2a848e3116cfbba1e26c", "message": "Interim squashable commit; fixing style\n\nSigned-off-by: Laird Nelson <laird.nelson@oracle.com>", "committedDate": "2020-02-13T23:21:36Z", "type": "commit"}, {"oid": "070053ececf06f1b5576b25cf7760b5b21f52fa2", "url": "https://github.com/oracle/helidon/commit/070053ececf06f1b5576b25cf7760b5b21f52fa2", "message": "Interim squashable commit; removed null check in ThrowableBodyWriter per direction\n\nSigned-off-by: Laird Nelson <laird.nelson@oracle.com>", "committedDate": "2020-02-13T23:24:41Z", "type": "commit"}, {"oid": "3136982a6268195c2b7e30adf5cd62ca5a0745b6", "url": "https://github.com/oracle/helidon/commit/3136982a6268195c2b7e30adf5cd62ca5a0745b6", "message": "Interim squashable commit; moved media type assignment out of the mapper and into the write method per instruction\n\nSigned-off-by: Laird Nelson <laird.nelson@oracle.com>", "committedDate": "2020-02-13T23:30:45Z", "type": "commit"}, {"oid": "908308af5d219422a0d16951fab365f16fe2e7f7", "url": "https://github.com/oracle/helidon/commit/908308af5d219422a0d16951fab365f16fe2e7f7", "message": "Interim squashable commit; removed another super() call\n\nSigned-off-by: Laird Nelson <laird.nelson@oracle.com>", "committedDate": "2020-02-13T23:43:40Z", "type": "commit"}]}