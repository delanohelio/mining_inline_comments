{"pr_number": 2310, "pr_title": "Helidon SE OIDC Security provider guide", "pr_createdAt": "2020-09-01T15:09:45Z", "pr_url": "https://github.com/oracle/helidon/pull/2310", "timeline": [{"oid": "c0cc7fec1f2f80ef1daac4ed1325d9a2b4a6cd72", "url": "https://github.com/oracle/helidon/commit/c0cc7fec1f2f80ef1daac4ed1325d9a2b4a6cd72", "message": "Helidon SE Security OIDC provider guide\n\nSigned-off-by: tvallin <thibault.vallin@oracle.com>", "committedDate": "2020-09-01T14:46:06Z", "type": "commit"}, {"oid": "a1d7bee27ce4b90b47b118d43f1f77219a90d048", "url": "https://github.com/oracle/helidon/commit/a1d7bee27ce4b90b47b118d43f1f77219a90d048", "message": "Update Helidon SE : OIDC Security provider guide\n\nSigned-off-by: tvallin <thibault.vallin@oracle.com>", "committedDate": "2020-09-15T09:27:00Z", "type": "commit"}, {"oid": "6e08a5b746da5f409b12bdf33699656b03709941", "url": "https://github.com/oracle/helidon/commit/6e08a5b746da5f409b12bdf33699656b03709941", "message": "Update Helidon SE : Miss click correction\n\nSigned-off-by: tvallin <thibault.vallin@oracle.com>", "committedDate": "2020-09-22T07:58:23Z", "type": "commit"}, {"oid": "7a135d68a50003d0eb42a1d2e47619aadc2932c6", "url": "https://github.com/oracle/helidon/commit/7a135d68a50003d0eb42a1d2e47619aadc2932c6", "message": "Update Helidon SE : Update plan + link bullet list\n\nSigned-off-by: tvallin <thibault.vallin@oracle.com>", "committedDate": "2020-09-25T07:11:55Z", "type": "commit"}, {"oid": "0f0452a21ef0b61d08095b262c68a8b9604074a8", "url": "https://github.com/oracle/helidon/commit/0f0452a21ef0b61d08095b262c68a8b9604074a8", "message": "Update Helidon SE : tests passing + roles validation\n\nSigned-off-by: tvallin <thibault.vallin@oracle.com>", "committedDate": "2020-10-05T07:09:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQ2MjQ5OQ==", "url": "https://github.com/oracle/helidon/pull/2310#discussion_r499462499", "bodyText": "If you select realm name with some capital letters (for example myRealm as mentioned above as example name), you have to set correct name to the url. Login link should be here http://localhost:8080/auth/realms/myRealm/account because you have mentioned myRealm as an example name.", "author": "Verdent", "createdAt": "2020-10-05T09:27:32Z", "path": "docs/se/guides/05_security_oidc.adoc", "diffHunk": "@@ -0,0 +1,529 @@\n+///////////////////////////////////////////////////////////////////////////////\n+\n+    Copyright (c) 2020 Oracle and/or its affiliates.\n+\n+    Licensed under the Apache License, Version 2.0 (the \"License\");\n+    you may not use this file except in compliance with the License.\n+    You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+///////////////////////////////////////////////////////////////////////////////\n+\n+= Helidon SE OIDC Security Provider Guide\n+:h1Prefix: SE\n+:description: Helidon OIDC Security Provider\n+:keywords: helidon, security, guide, oidc, provider\n+\n+This guide describes how to set up Keycloak and Helidon\n+to secure your application with OIDC security provider.\n+\n+== What you need\n+\n+[width=50%,role=\"flex, sm7\"]\n+|===\n+|About 20 minutes\n+|<<about/03_prerequisites.adoc,Helidon Prerequisites>>\n+|===\n+\n+* <<Keycloak Installation,Keycloak Installation>>\n+* <<Set up Keycloak,Set up Keycloak>>\n+* <<Set up Helidon,Set up Helidon>>\n+* <<Restrict access to a specific role,Restrict access to a specific role>>\n+\n+=== Keycloak Installation\n+\n+==== On Docker\n+\n+To install Keycloak with Docker, open a terminal and make sure the port 8080 is free.\n+\n+[source,bash]\n+.Enter the following command\n+----\n+docker run -p 8080:8080 -e KEYCLOAK_USER=admin -e KEYCLOAK_PASSWORD=admin quay.io/keycloak/keycloak:11.0.2\n+----\n+\n+This will start Keycloak on local port 8080. It will create the admin user with username `admin` and password `admin`\n+Feel free to modify 11.0.2 by any keycloak version of your wish.\n+If you are running docker behind a proxy server, make sure it is either configured into docker or\n+disable it. Otherwise, you might face a connection timeout because docker cannot download the required data.\n+\n+To verify that Keycloak is running correctly, go to the admin console : http://localhost:8080/auth/admin\n+Log in using the username and password mentioned above: `admin`.\n+\n+You should be logged in successfully, and it prompts the admin console.\n+\n+==== On JDK\n+\n+Download the last version of Keycloak from Keycloak website : https://www.keycloak.org/downloads\n+In the table Server choose Standalone server distribution. ZIP or Tar format are available, click on either\n+to download Keycloak.\n+\n+After extracting the archive file, you should have a directory named keycloak followed by the version. For example,\n+if you chose version 11.0.2, the folder must be named keycloak-11.0.2.\n+\n+Open keycloak folder to make it your current directory.\n+[source,bash]\n+.Run this command from command prompt to open the directory:\n+----\n+cd keycloak-11.0.2\n+----\n+\n+===== Start Keycloak\n+\n+To start keycloak and have it ready for further steps, run the following command.\n+\n+[source,bash]\n+.On Linux run:\n+----\n+bin/standalone.sh\n+----\n+\n+[source,bash]\n+.On Windows run:\n+----\n+bin/standalone.bat\n+----\n+\n+Keycloak runs on localhost:8080 by default.\n+\n+===== Create an admin user\n+\n+You need to create an admin user because it does not come by default when installing Keycloak.\n+To do this, open  http://localhost:8080/auth in your favorite browser.\n+\n+A window `Welcome to Keycloak` should be prompted. If not, check if any error appear in the terminal.\n+\n+Fill the form by adding Username and Password. Click on `Create` to create the admin user.\n+\n+Above Administration Console should be printed \"User created\" in a green rectangle.\n+\n+To check that the admin user was created correctly, click on Administration user which should redirect you\n+to a Login form. Enter the Username and Password created earlier to log in.\n+\n+After successfully logged in, the admin console is prompted.\n+\n+=== Set up Keycloak\n+\n+To set up Keycloak properly, go to the admin console: http://localhost:8080/auth/admin\n+\n+If you are using Docker, use Username `admin` and password `admin` as it is the default admin user.\n+Otherwise, use the username and password you used to create the admin user.\n+\n+==== Create a realm\n+\n+A realm is the place where groups of applications, and their environment, can be created. It gathers :\n+\n+- One or several applications\n+- One or several users\n+- Sessions\n+- Events\n+- Clients and their scopes\n+\n+By default, there is a realm called `Master`. It is used to manage Keycloak. It is not recommended to associate your\n+application with this realm as it could disturb Keycloak functioning.\n+\n+To create a new realm to manage your application:\n+\n+. Open Keycloak admin console http://localhost:8080/auth/admin.\n+. Hover the mouse over the dropdown in the top-left corner where it says `Master`, and press `Add realm`.\n+. Fill the form by adding the realm name, `myRealm` for example.\n+. Click on `Create` to create the new realm.\n+\n+To verify that your realm is created, on the top-left corner where it said `Master` previously\n+should be now your realm name or `myRealm` is you followed the example.\n+\n+To switch from a realm to another, hover the realm name, and the other realm created appear in the dropdown.\n+Click on any realm name to change the current realm. Make sure all configuration or modification are saved before changing\n+the current realm or be subject to lose your configuration.\n+\n+==== Create a user\n+\n+Initially there are no users in a new realm. An unlimited number of user can be created per realm.\n+A realm contains resources such as client which can be accessed by users.\n+\n+To create a new user:\n+\n+. Open the Keycloak admin console: http://localhost:8080/auth/admin\n+. Click on `Users` in the left menu\n+. Press `Add user`\n+. Fill the form (Username is the only mendatory field) with this value Username: `myUser`\n+. Click `Save`\n+\n+A new user is just created but it needs a password to be able to login. To initialize it, do this:\n+\n+. Click on `Credentials` at the top of the page, under `Myuser`.\n+. Fill `Password` and `Password confirmation` with the user password of your choice.\n+. If the `Temporary` field is set to `ON`, the user has to  update password on next login. Click `ON`\n+to make it `OFF` and prevent it.\n+. Press `Set Password`.\n+. A pop-up window is popping off. Click on `Set Password` to confirm the new password.\n+\n+To verify that the new user is created correctly:\n+\n+. Open the Keycloak account console: http://localhost:8080/auth/realms/myrealm/account.", "originalCommit": "0f0452a21ef0b61d08095b262c68a8b9604074a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQ2NzI0NQ==", "url": "https://github.com/oracle/helidon/pull/2310#discussion_r499467245", "bodyText": "Access type field has been accessible for me after saving of the new client and not while creation time.", "author": "Verdent", "createdAt": "2020-10-05T09:34:51Z", "path": "docs/se/guides/05_security_oidc.adoc", "diffHunk": "@@ -0,0 +1,529 @@\n+///////////////////////////////////////////////////////////////////////////////\n+\n+    Copyright (c) 2020 Oracle and/or its affiliates.\n+\n+    Licensed under the Apache License, Version 2.0 (the \"License\");\n+    you may not use this file except in compliance with the License.\n+    You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+///////////////////////////////////////////////////////////////////////////////\n+\n+= Helidon SE OIDC Security Provider Guide\n+:h1Prefix: SE\n+:description: Helidon OIDC Security Provider\n+:keywords: helidon, security, guide, oidc, provider\n+\n+This guide describes how to set up Keycloak and Helidon\n+to secure your application with OIDC security provider.\n+\n+== What you need\n+\n+[width=50%,role=\"flex, sm7\"]\n+|===\n+|About 20 minutes\n+|<<about/03_prerequisites.adoc,Helidon Prerequisites>>\n+|===\n+\n+* <<Keycloak Installation,Keycloak Installation>>\n+* <<Set up Keycloak,Set up Keycloak>>\n+* <<Set up Helidon,Set up Helidon>>\n+* <<Restrict access to a specific role,Restrict access to a specific role>>\n+\n+=== Keycloak Installation\n+\n+==== On Docker\n+\n+To install Keycloak with Docker, open a terminal and make sure the port 8080 is free.\n+\n+[source,bash]\n+.Enter the following command\n+----\n+docker run -p 8080:8080 -e KEYCLOAK_USER=admin -e KEYCLOAK_PASSWORD=admin quay.io/keycloak/keycloak:11.0.2\n+----\n+\n+This will start Keycloak on local port 8080. It will create the admin user with username `admin` and password `admin`\n+Feel free to modify 11.0.2 by any keycloak version of your wish.\n+If you are running docker behind a proxy server, make sure it is either configured into docker or\n+disable it. Otherwise, you might face a connection timeout because docker cannot download the required data.\n+\n+To verify that Keycloak is running correctly, go to the admin console : http://localhost:8080/auth/admin\n+Log in using the username and password mentioned above: `admin`.\n+\n+You should be logged in successfully, and it prompts the admin console.\n+\n+==== On JDK\n+\n+Download the last version of Keycloak from Keycloak website : https://www.keycloak.org/downloads\n+In the table Server choose Standalone server distribution. ZIP or Tar format are available, click on either\n+to download Keycloak.\n+\n+After extracting the archive file, you should have a directory named keycloak followed by the version. For example,\n+if you chose version 11.0.2, the folder must be named keycloak-11.0.2.\n+\n+Open keycloak folder to make it your current directory.\n+[source,bash]\n+.Run this command from command prompt to open the directory:\n+----\n+cd keycloak-11.0.2\n+----\n+\n+===== Start Keycloak\n+\n+To start keycloak and have it ready for further steps, run the following command.\n+\n+[source,bash]\n+.On Linux run:\n+----\n+bin/standalone.sh\n+----\n+\n+[source,bash]\n+.On Windows run:\n+----\n+bin/standalone.bat\n+----\n+\n+Keycloak runs on localhost:8080 by default.\n+\n+===== Create an admin user\n+\n+You need to create an admin user because it does not come by default when installing Keycloak.\n+To do this, open  http://localhost:8080/auth in your favorite browser.\n+\n+A window `Welcome to Keycloak` should be prompted. If not, check if any error appear in the terminal.\n+\n+Fill the form by adding Username and Password. Click on `Create` to create the admin user.\n+\n+Above Administration Console should be printed \"User created\" in a green rectangle.\n+\n+To check that the admin user was created correctly, click on Administration user which should redirect you\n+to a Login form. Enter the Username and Password created earlier to log in.\n+\n+After successfully logged in, the admin console is prompted.\n+\n+=== Set up Keycloak\n+\n+To set up Keycloak properly, go to the admin console: http://localhost:8080/auth/admin\n+\n+If you are using Docker, use Username `admin` and password `admin` as it is the default admin user.\n+Otherwise, use the username and password you used to create the admin user.\n+\n+==== Create a realm\n+\n+A realm is the place where groups of applications, and their environment, can be created. It gathers :\n+\n+- One or several applications\n+- One or several users\n+- Sessions\n+- Events\n+- Clients and their scopes\n+\n+By default, there is a realm called `Master`. It is used to manage Keycloak. It is not recommended to associate your\n+application with this realm as it could disturb Keycloak functioning.\n+\n+To create a new realm to manage your application:\n+\n+. Open Keycloak admin console http://localhost:8080/auth/admin.\n+. Hover the mouse over the dropdown in the top-left corner where it says `Master`, and press `Add realm`.\n+. Fill the form by adding the realm name, `myRealm` for example.\n+. Click on `Create` to create the new realm.\n+\n+To verify that your realm is created, on the top-left corner where it said `Master` previously\n+should be now your realm name or `myRealm` is you followed the example.\n+\n+To switch from a realm to another, hover the realm name, and the other realm created appear in the dropdown.\n+Click on any realm name to change the current realm. Make sure all configuration or modification are saved before changing\n+the current realm or be subject to lose your configuration.\n+\n+==== Create a user\n+\n+Initially there are no users in a new realm. An unlimited number of user can be created per realm.\n+A realm contains resources such as client which can be accessed by users.\n+\n+To create a new user:\n+\n+. Open the Keycloak admin console: http://localhost:8080/auth/admin\n+. Click on `Users` in the left menu\n+. Press `Add user`\n+. Fill the form (Username is the only mendatory field) with this value Username: `myUser`\n+. Click `Save`\n+\n+A new user is just created but it needs a password to be able to login. To initialize it, do this:\n+\n+. Click on `Credentials` at the top of the page, under `Myuser`.\n+. Fill `Password` and `Password confirmation` with the user password of your choice.\n+. If the `Temporary` field is set to `ON`, the user has to  update password on next login. Click `ON`\n+to make it `OFF` and prevent it.\n+. Press `Set Password`.\n+. A pop-up window is popping off. Click on `Set Password` to confirm the new password.\n+\n+To verify that the new user is created correctly:\n+\n+. Open the Keycloak account console: http://localhost:8080/auth/realms/myrealm/account.\n+. Login with `myuser` and password chosen earlier.\n+\n+You should now be logged-in to the account console where users can manage their accounts.\n+\n+==== Create a Client\n+\n+To create your first client:\n+\n+. Navigate to the left menu, into configure section, click on `Clients`. This window displays a table with every client\n+from the realm.\n+. Click on `Create`\n+. Fill the following:\n+. `Client ID` : `myClientID`.\n+.. `Client Protocol` : `openid-connect`\n+.. `Access type` : `confidential`", "originalCommit": "0f0452a21ef0b61d08095b262c68a8b9604074a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQ3MzgxOA==", "url": "https://github.com/oracle/helidon/pull/2310#discussion_r499473818", "bodyText": "I think you should mention here, that they have to replace {helidon-version} with the version of Helidon they want to use.", "author": "Verdent", "createdAt": "2020-10-05T09:46:10Z", "path": "docs/se/guides/05_security_oidc.adoc", "diffHunk": "@@ -0,0 +1,529 @@\n+///////////////////////////////////////////////////////////////////////////////\n+\n+    Copyright (c) 2020 Oracle and/or its affiliates.\n+\n+    Licensed under the Apache License, Version 2.0 (the \"License\");\n+    you may not use this file except in compliance with the License.\n+    You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+///////////////////////////////////////////////////////////////////////////////\n+\n+= Helidon SE OIDC Security Provider Guide\n+:h1Prefix: SE\n+:description: Helidon OIDC Security Provider\n+:keywords: helidon, security, guide, oidc, provider\n+\n+This guide describes how to set up Keycloak and Helidon\n+to secure your application with OIDC security provider.\n+\n+== What you need\n+\n+[width=50%,role=\"flex, sm7\"]\n+|===\n+|About 20 minutes\n+|<<about/03_prerequisites.adoc,Helidon Prerequisites>>\n+|===\n+\n+* <<Keycloak Installation,Keycloak Installation>>\n+* <<Set up Keycloak,Set up Keycloak>>\n+* <<Set up Helidon,Set up Helidon>>\n+* <<Restrict access to a specific role,Restrict access to a specific role>>\n+\n+=== Keycloak Installation\n+\n+==== On Docker\n+\n+To install Keycloak with Docker, open a terminal and make sure the port 8080 is free.\n+\n+[source,bash]\n+.Enter the following command\n+----\n+docker run -p 8080:8080 -e KEYCLOAK_USER=admin -e KEYCLOAK_PASSWORD=admin quay.io/keycloak/keycloak:11.0.2\n+----\n+\n+This will start Keycloak on local port 8080. It will create the admin user with username `admin` and password `admin`\n+Feel free to modify 11.0.2 by any keycloak version of your wish.\n+If you are running docker behind a proxy server, make sure it is either configured into docker or\n+disable it. Otherwise, you might face a connection timeout because docker cannot download the required data.\n+\n+To verify that Keycloak is running correctly, go to the admin console : http://localhost:8080/auth/admin\n+Log in using the username and password mentioned above: `admin`.\n+\n+You should be logged in successfully, and it prompts the admin console.\n+\n+==== On JDK\n+\n+Download the last version of Keycloak from Keycloak website : https://www.keycloak.org/downloads\n+In the table Server choose Standalone server distribution. ZIP or Tar format are available, click on either\n+to download Keycloak.\n+\n+After extracting the archive file, you should have a directory named keycloak followed by the version. For example,\n+if you chose version 11.0.2, the folder must be named keycloak-11.0.2.\n+\n+Open keycloak folder to make it your current directory.\n+[source,bash]\n+.Run this command from command prompt to open the directory:\n+----\n+cd keycloak-11.0.2\n+----\n+\n+===== Start Keycloak\n+\n+To start keycloak and have it ready for further steps, run the following command.\n+\n+[source,bash]\n+.On Linux run:\n+----\n+bin/standalone.sh\n+----\n+\n+[source,bash]\n+.On Windows run:\n+----\n+bin/standalone.bat\n+----\n+\n+Keycloak runs on localhost:8080 by default.\n+\n+===== Create an admin user\n+\n+You need to create an admin user because it does not come by default when installing Keycloak.\n+To do this, open  http://localhost:8080/auth in your favorite browser.\n+\n+A window `Welcome to Keycloak` should be prompted. If not, check if any error appear in the terminal.\n+\n+Fill the form by adding Username and Password. Click on `Create` to create the admin user.\n+\n+Above Administration Console should be printed \"User created\" in a green rectangle.\n+\n+To check that the admin user was created correctly, click on Administration user which should redirect you\n+to a Login form. Enter the Username and Password created earlier to log in.\n+\n+After successfully logged in, the admin console is prompted.\n+\n+=== Set up Keycloak\n+\n+To set up Keycloak properly, go to the admin console: http://localhost:8080/auth/admin\n+\n+If you are using Docker, use Username `admin` and password `admin` as it is the default admin user.\n+Otherwise, use the username and password you used to create the admin user.\n+\n+==== Create a realm\n+\n+A realm is the place where groups of applications, and their environment, can be created. It gathers :\n+\n+- One or several applications\n+- One or several users\n+- Sessions\n+- Events\n+- Clients and their scopes\n+\n+By default, there is a realm called `Master`. It is used to manage Keycloak. It is not recommended to associate your\n+application with this realm as it could disturb Keycloak functioning.\n+\n+To create a new realm to manage your application:\n+\n+. Open Keycloak admin console http://localhost:8080/auth/admin.\n+. Hover the mouse over the dropdown in the top-left corner where it says `Master`, and press `Add realm`.\n+. Fill the form by adding the realm name, `myRealm` for example.\n+. Click on `Create` to create the new realm.\n+\n+To verify that your realm is created, on the top-left corner where it said `Master` previously\n+should be now your realm name or `myRealm` is you followed the example.\n+\n+To switch from a realm to another, hover the realm name, and the other realm created appear in the dropdown.\n+Click on any realm name to change the current realm. Make sure all configuration or modification are saved before changing\n+the current realm or be subject to lose your configuration.\n+\n+==== Create a user\n+\n+Initially there are no users in a new realm. An unlimited number of user can be created per realm.\n+A realm contains resources such as client which can be accessed by users.\n+\n+To create a new user:\n+\n+. Open the Keycloak admin console: http://localhost:8080/auth/admin\n+. Click on `Users` in the left menu\n+. Press `Add user`\n+. Fill the form (Username is the only mendatory field) with this value Username: `myUser`\n+. Click `Save`\n+\n+A new user is just created but it needs a password to be able to login. To initialize it, do this:\n+\n+. Click on `Credentials` at the top of the page, under `Myuser`.\n+. Fill `Password` and `Password confirmation` with the user password of your choice.\n+. If the `Temporary` field is set to `ON`, the user has to  update password on next login. Click `ON`\n+to make it `OFF` and prevent it.\n+. Press `Set Password`.\n+. A pop-up window is popping off. Click on `Set Password` to confirm the new password.\n+\n+To verify that the new user is created correctly:\n+\n+. Open the Keycloak account console: http://localhost:8080/auth/realms/myrealm/account.\n+. Login with `myuser` and password chosen earlier.\n+\n+You should now be logged-in to the account console where users can manage their accounts.\n+\n+==== Create a Client\n+\n+To create your first client:\n+\n+. Navigate to the left menu, into configure section, click on `Clients`. This window displays a table with every client\n+from the realm.\n+. Click on `Create`\n+. Fill the following:\n+. `Client ID` : `myClientID`.\n+.. `Client Protocol` : `openid-connect`\n+.. `Access type` : `confidential`\n+.. `Valid Redirect URIs` : http://localhost:7987/*\n+. Press `Save`\n+\n+A new tab named `Credentials` is created. Click on it to access this new tab.\n+\n+- `Client Authenticator` : `Client ID and Secret`\n+- Click on `generate secret` to generate client secret.\n+\n+Keycloak is now configured and ready. Keep keycloak running on your terminal and open a new tab to\n+set up Helidon.\n+\n+=== Set up Helidon\n+\n+Use the Helidon SE Maven archetype to create a simple project. It will be used as an example\n+to show how to set up Helidon.\n+\n+[source,bash,subs=\"attributes+\"]\n+.Run the Maven archetype\n+----\n+mvn -U archetype:generate -DinteractiveMode=false \\\n+    -DarchetypeGroupId=io.helidon.archetypes \\\n+    -DarchetypeArtifactId=helidon-quickstart-se \\\n+    -DarchetypeVersion={helidon-version} \\", "originalCommit": "0f0452a21ef0b61d08095b262c68a8b9604074a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQ3Njg3NA==", "url": "https://github.com/oracle/helidon/pull/2310#discussion_r499476874", "bodyText": "Should be myRealm as mentioned above.", "author": "Verdent", "createdAt": "2020-10-05T09:51:26Z", "path": "docs/se/guides/05_security_oidc.adoc", "diffHunk": "@@ -0,0 +1,529 @@\n+///////////////////////////////////////////////////////////////////////////////\n+\n+    Copyright (c) 2020 Oracle and/or its affiliates.\n+\n+    Licensed under the Apache License, Version 2.0 (the \"License\");\n+    you may not use this file except in compliance with the License.\n+    You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+///////////////////////////////////////////////////////////////////////////////\n+\n+= Helidon SE OIDC Security Provider Guide\n+:h1Prefix: SE\n+:description: Helidon OIDC Security Provider\n+:keywords: helidon, security, guide, oidc, provider\n+\n+This guide describes how to set up Keycloak and Helidon\n+to secure your application with OIDC security provider.\n+\n+== What you need\n+\n+[width=50%,role=\"flex, sm7\"]\n+|===\n+|About 20 minutes\n+|<<about/03_prerequisites.adoc,Helidon Prerequisites>>\n+|===\n+\n+* <<Keycloak Installation,Keycloak Installation>>\n+* <<Set up Keycloak,Set up Keycloak>>\n+* <<Set up Helidon,Set up Helidon>>\n+* <<Restrict access to a specific role,Restrict access to a specific role>>\n+\n+=== Keycloak Installation\n+\n+==== On Docker\n+\n+To install Keycloak with Docker, open a terminal and make sure the port 8080 is free.\n+\n+[source,bash]\n+.Enter the following command\n+----\n+docker run -p 8080:8080 -e KEYCLOAK_USER=admin -e KEYCLOAK_PASSWORD=admin quay.io/keycloak/keycloak:11.0.2\n+----\n+\n+This will start Keycloak on local port 8080. It will create the admin user with username `admin` and password `admin`\n+Feel free to modify 11.0.2 by any keycloak version of your wish.\n+If you are running docker behind a proxy server, make sure it is either configured into docker or\n+disable it. Otherwise, you might face a connection timeout because docker cannot download the required data.\n+\n+To verify that Keycloak is running correctly, go to the admin console : http://localhost:8080/auth/admin\n+Log in using the username and password mentioned above: `admin`.\n+\n+You should be logged in successfully, and it prompts the admin console.\n+\n+==== On JDK\n+\n+Download the last version of Keycloak from Keycloak website : https://www.keycloak.org/downloads\n+In the table Server choose Standalone server distribution. ZIP or Tar format are available, click on either\n+to download Keycloak.\n+\n+After extracting the archive file, you should have a directory named keycloak followed by the version. For example,\n+if you chose version 11.0.2, the folder must be named keycloak-11.0.2.\n+\n+Open keycloak folder to make it your current directory.\n+[source,bash]\n+.Run this command from command prompt to open the directory:\n+----\n+cd keycloak-11.0.2\n+----\n+\n+===== Start Keycloak\n+\n+To start keycloak and have it ready for further steps, run the following command.\n+\n+[source,bash]\n+.On Linux run:\n+----\n+bin/standalone.sh\n+----\n+\n+[source,bash]\n+.On Windows run:\n+----\n+bin/standalone.bat\n+----\n+\n+Keycloak runs on localhost:8080 by default.\n+\n+===== Create an admin user\n+\n+You need to create an admin user because it does not come by default when installing Keycloak.\n+To do this, open  http://localhost:8080/auth in your favorite browser.\n+\n+A window `Welcome to Keycloak` should be prompted. If not, check if any error appear in the terminal.\n+\n+Fill the form by adding Username and Password. Click on `Create` to create the admin user.\n+\n+Above Administration Console should be printed \"User created\" in a green rectangle.\n+\n+To check that the admin user was created correctly, click on Administration user which should redirect you\n+to a Login form. Enter the Username and Password created earlier to log in.\n+\n+After successfully logged in, the admin console is prompted.\n+\n+=== Set up Keycloak\n+\n+To set up Keycloak properly, go to the admin console: http://localhost:8080/auth/admin\n+\n+If you are using Docker, use Username `admin` and password `admin` as it is the default admin user.\n+Otherwise, use the username and password you used to create the admin user.\n+\n+==== Create a realm\n+\n+A realm is the place where groups of applications, and their environment, can be created. It gathers :\n+\n+- One or several applications\n+- One or several users\n+- Sessions\n+- Events\n+- Clients and their scopes\n+\n+By default, there is a realm called `Master`. It is used to manage Keycloak. It is not recommended to associate your\n+application with this realm as it could disturb Keycloak functioning.\n+\n+To create a new realm to manage your application:\n+\n+. Open Keycloak admin console http://localhost:8080/auth/admin.\n+. Hover the mouse over the dropdown in the top-left corner where it says `Master`, and press `Add realm`.\n+. Fill the form by adding the realm name, `myRealm` for example.\n+. Click on `Create` to create the new realm.\n+\n+To verify that your realm is created, on the top-left corner where it said `Master` previously\n+should be now your realm name or `myRealm` is you followed the example.\n+\n+To switch from a realm to another, hover the realm name, and the other realm created appear in the dropdown.\n+Click on any realm name to change the current realm. Make sure all configuration or modification are saved before changing\n+the current realm or be subject to lose your configuration.\n+\n+==== Create a user\n+\n+Initially there are no users in a new realm. An unlimited number of user can be created per realm.\n+A realm contains resources such as client which can be accessed by users.\n+\n+To create a new user:\n+\n+. Open the Keycloak admin console: http://localhost:8080/auth/admin\n+. Click on `Users` in the left menu\n+. Press `Add user`\n+. Fill the form (Username is the only mendatory field) with this value Username: `myUser`\n+. Click `Save`\n+\n+A new user is just created but it needs a password to be able to login. To initialize it, do this:\n+\n+. Click on `Credentials` at the top of the page, under `Myuser`.\n+. Fill `Password` and `Password confirmation` with the user password of your choice.\n+. If the `Temporary` field is set to `ON`, the user has to  update password on next login. Click `ON`\n+to make it `OFF` and prevent it.\n+. Press `Set Password`.\n+. A pop-up window is popping off. Click on `Set Password` to confirm the new password.\n+\n+To verify that the new user is created correctly:\n+\n+. Open the Keycloak account console: http://localhost:8080/auth/realms/myrealm/account.\n+. Login with `myuser` and password chosen earlier.\n+\n+You should now be logged-in to the account console where users can manage their accounts.\n+\n+==== Create a Client\n+\n+To create your first client:\n+\n+. Navigate to the left menu, into configure section, click on `Clients`. This window displays a table with every client\n+from the realm.\n+. Click on `Create`\n+. Fill the following:\n+. `Client ID` : `myClientID`.\n+.. `Client Protocol` : `openid-connect`\n+.. `Access type` : `confidential`\n+.. `Valid Redirect URIs` : http://localhost:7987/*\n+. Press `Save`\n+\n+A new tab named `Credentials` is created. Click on it to access this new tab.\n+\n+- `Client Authenticator` : `Client ID and Secret`\n+- Click on `generate secret` to generate client secret.\n+\n+Keycloak is now configured and ready. Keep keycloak running on your terminal and open a new tab to\n+set up Helidon.\n+\n+=== Set up Helidon\n+\n+Use the Helidon SE Maven archetype to create a simple project. It will be used as an example\n+to show how to set up Helidon.\n+\n+[source,bash,subs=\"attributes+\"]\n+.Run the Maven archetype\n+----\n+mvn -U archetype:generate -DinteractiveMode=false \\\n+    -DarchetypeGroupId=io.helidon.archetypes \\\n+    -DarchetypeArtifactId=helidon-quickstart-se \\\n+    -DarchetypeVersion={helidon-version} \\\n+    -DgroupId=io.helidon.examples \\\n+    -DartifactId=helidon-quickstart-se \\\n+    -Dpackage=io.helidon.examples.quickstart.se\n+----\n+\n+[source,bash]\n+.The project will be built and run from the helidon-quickstart-se directory:\n+----\n+cd helidon-quickstart-se\n+----\n+\n+==== Update project dependencies\n+\n+Update the pom.xml file and add the following Helidon dependency to the `<dependencies>` section.\n+\n+[source,xml]\n+.Add the following dependency to `pom.xml`:\n+----\n+<dependency>\n+    <groupId>io.helidon.security.providers</groupId>\n+    <artifactId>helidon-security-providers-oidc</artifactId>\n+</dependency>\n+----\n+\n+==== Add OIDC security properties\n+\n+The OIDC security provider properties can be joined to helidon property file.\n+So it can be easily used to configure the web server without modifying application code.\n+\n+[source,yaml]\n+.Add the following line to application.yaml\n+----\n+security:\n+  providers:\n+  - abac:\n+      # Adds ABAC Provider - it does not require any configuration\n+  - oidc:\n+      client-id: \"myClientID\" // <1>\n+      client-secret: \"Client secret generated into Keycloak client credential\"\n+      identity-uri: \"http://localhost:8080/auth/realms/myrealm\" // <2>", "originalCommit": "0f0452a21ef0b61d08095b262c68a8b9604074a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQ4MzMwNw==", "url": "https://github.com/oracle/helidon/pull/2310#discussion_r499483307", "bodyText": "I think that calling it configuration instead of properties is better here since you are adding OIDC security provider configuration and you are adding those to helidon configuration file. This time it is .yaml. And I might also suggest to add here some note where this application.yaml is located.", "author": "Verdent", "createdAt": "2020-10-05T10:01:54Z", "path": "docs/se/guides/05_security_oidc.adoc", "diffHunk": "@@ -0,0 +1,529 @@\n+///////////////////////////////////////////////////////////////////////////////\n+\n+    Copyright (c) 2020 Oracle and/or its affiliates.\n+\n+    Licensed under the Apache License, Version 2.0 (the \"License\");\n+    you may not use this file except in compliance with the License.\n+    You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+///////////////////////////////////////////////////////////////////////////////\n+\n+= Helidon SE OIDC Security Provider Guide\n+:h1Prefix: SE\n+:description: Helidon OIDC Security Provider\n+:keywords: helidon, security, guide, oidc, provider\n+\n+This guide describes how to set up Keycloak and Helidon\n+to secure your application with OIDC security provider.\n+\n+== What you need\n+\n+[width=50%,role=\"flex, sm7\"]\n+|===\n+|About 20 minutes\n+|<<about/03_prerequisites.adoc,Helidon Prerequisites>>\n+|===\n+\n+* <<Keycloak Installation,Keycloak Installation>>\n+* <<Set up Keycloak,Set up Keycloak>>\n+* <<Set up Helidon,Set up Helidon>>\n+* <<Restrict access to a specific role,Restrict access to a specific role>>\n+\n+=== Keycloak Installation\n+\n+==== On Docker\n+\n+To install Keycloak with Docker, open a terminal and make sure the port 8080 is free.\n+\n+[source,bash]\n+.Enter the following command\n+----\n+docker run -p 8080:8080 -e KEYCLOAK_USER=admin -e KEYCLOAK_PASSWORD=admin quay.io/keycloak/keycloak:11.0.2\n+----\n+\n+This will start Keycloak on local port 8080. It will create the admin user with username `admin` and password `admin`\n+Feel free to modify 11.0.2 by any keycloak version of your wish.\n+If you are running docker behind a proxy server, make sure it is either configured into docker or\n+disable it. Otherwise, you might face a connection timeout because docker cannot download the required data.\n+\n+To verify that Keycloak is running correctly, go to the admin console : http://localhost:8080/auth/admin\n+Log in using the username and password mentioned above: `admin`.\n+\n+You should be logged in successfully, and it prompts the admin console.\n+\n+==== On JDK\n+\n+Download the last version of Keycloak from Keycloak website : https://www.keycloak.org/downloads\n+In the table Server choose Standalone server distribution. ZIP or Tar format are available, click on either\n+to download Keycloak.\n+\n+After extracting the archive file, you should have a directory named keycloak followed by the version. For example,\n+if you chose version 11.0.2, the folder must be named keycloak-11.0.2.\n+\n+Open keycloak folder to make it your current directory.\n+[source,bash]\n+.Run this command from command prompt to open the directory:\n+----\n+cd keycloak-11.0.2\n+----\n+\n+===== Start Keycloak\n+\n+To start keycloak and have it ready for further steps, run the following command.\n+\n+[source,bash]\n+.On Linux run:\n+----\n+bin/standalone.sh\n+----\n+\n+[source,bash]\n+.On Windows run:\n+----\n+bin/standalone.bat\n+----\n+\n+Keycloak runs on localhost:8080 by default.\n+\n+===== Create an admin user\n+\n+You need to create an admin user because it does not come by default when installing Keycloak.\n+To do this, open  http://localhost:8080/auth in your favorite browser.\n+\n+A window `Welcome to Keycloak` should be prompted. If not, check if any error appear in the terminal.\n+\n+Fill the form by adding Username and Password. Click on `Create` to create the admin user.\n+\n+Above Administration Console should be printed \"User created\" in a green rectangle.\n+\n+To check that the admin user was created correctly, click on Administration user which should redirect you\n+to a Login form. Enter the Username and Password created earlier to log in.\n+\n+After successfully logged in, the admin console is prompted.\n+\n+=== Set up Keycloak\n+\n+To set up Keycloak properly, go to the admin console: http://localhost:8080/auth/admin\n+\n+If you are using Docker, use Username `admin` and password `admin` as it is the default admin user.\n+Otherwise, use the username and password you used to create the admin user.\n+\n+==== Create a realm\n+\n+A realm is the place where groups of applications, and their environment, can be created. It gathers :\n+\n+- One or several applications\n+- One or several users\n+- Sessions\n+- Events\n+- Clients and their scopes\n+\n+By default, there is a realm called `Master`. It is used to manage Keycloak. It is not recommended to associate your\n+application with this realm as it could disturb Keycloak functioning.\n+\n+To create a new realm to manage your application:\n+\n+. Open Keycloak admin console http://localhost:8080/auth/admin.\n+. Hover the mouse over the dropdown in the top-left corner where it says `Master`, and press `Add realm`.\n+. Fill the form by adding the realm name, `myRealm` for example.\n+. Click on `Create` to create the new realm.\n+\n+To verify that your realm is created, on the top-left corner where it said `Master` previously\n+should be now your realm name or `myRealm` is you followed the example.\n+\n+To switch from a realm to another, hover the realm name, and the other realm created appear in the dropdown.\n+Click on any realm name to change the current realm. Make sure all configuration or modification are saved before changing\n+the current realm or be subject to lose your configuration.\n+\n+==== Create a user\n+\n+Initially there are no users in a new realm. An unlimited number of user can be created per realm.\n+A realm contains resources such as client which can be accessed by users.\n+\n+To create a new user:\n+\n+. Open the Keycloak admin console: http://localhost:8080/auth/admin\n+. Click on `Users` in the left menu\n+. Press `Add user`\n+. Fill the form (Username is the only mendatory field) with this value Username: `myUser`\n+. Click `Save`\n+\n+A new user is just created but it needs a password to be able to login. To initialize it, do this:\n+\n+. Click on `Credentials` at the top of the page, under `Myuser`.\n+. Fill `Password` and `Password confirmation` with the user password of your choice.\n+. If the `Temporary` field is set to `ON`, the user has to  update password on next login. Click `ON`\n+to make it `OFF` and prevent it.\n+. Press `Set Password`.\n+. A pop-up window is popping off. Click on `Set Password` to confirm the new password.\n+\n+To verify that the new user is created correctly:\n+\n+. Open the Keycloak account console: http://localhost:8080/auth/realms/myrealm/account.\n+. Login with `myuser` and password chosen earlier.\n+\n+You should now be logged-in to the account console where users can manage their accounts.\n+\n+==== Create a Client\n+\n+To create your first client:\n+\n+. Navigate to the left menu, into configure section, click on `Clients`. This window displays a table with every client\n+from the realm.\n+. Click on `Create`\n+. Fill the following:\n+. `Client ID` : `myClientID`.\n+.. `Client Protocol` : `openid-connect`\n+.. `Access type` : `confidential`\n+.. `Valid Redirect URIs` : http://localhost:7987/*\n+. Press `Save`\n+\n+A new tab named `Credentials` is created. Click on it to access this new tab.\n+\n+- `Client Authenticator` : `Client ID and Secret`\n+- Click on `generate secret` to generate client secret.\n+\n+Keycloak is now configured and ready. Keep keycloak running on your terminal and open a new tab to\n+set up Helidon.\n+\n+=== Set up Helidon\n+\n+Use the Helidon SE Maven archetype to create a simple project. It will be used as an example\n+to show how to set up Helidon.\n+\n+[source,bash,subs=\"attributes+\"]\n+.Run the Maven archetype\n+----\n+mvn -U archetype:generate -DinteractiveMode=false \\\n+    -DarchetypeGroupId=io.helidon.archetypes \\\n+    -DarchetypeArtifactId=helidon-quickstart-se \\\n+    -DarchetypeVersion={helidon-version} \\\n+    -DgroupId=io.helidon.examples \\\n+    -DartifactId=helidon-quickstart-se \\\n+    -Dpackage=io.helidon.examples.quickstart.se\n+----\n+\n+[source,bash]\n+.The project will be built and run from the helidon-quickstart-se directory:\n+----\n+cd helidon-quickstart-se\n+----\n+\n+==== Update project dependencies\n+\n+Update the pom.xml file and add the following Helidon dependency to the `<dependencies>` section.\n+\n+[source,xml]\n+.Add the following dependency to `pom.xml`:\n+----\n+<dependency>\n+    <groupId>io.helidon.security.providers</groupId>\n+    <artifactId>helidon-security-providers-oidc</artifactId>\n+</dependency>\n+----\n+\n+==== Add OIDC security properties\n+\n+The OIDC security provider properties can be joined to helidon property file.", "originalCommit": "0f0452a21ef0b61d08095b262c68a8b9604074a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQ4NTA2OA==", "url": "https://github.com/oracle/helidon/pull/2310#discussion_r499485068", "bodyText": "Not an MP environment :-) Replace it please to reflect application.yaml you used before.", "author": "Verdent", "createdAt": "2020-10-05T10:04:56Z", "path": "docs/se/guides/05_security_oidc.adoc", "diffHunk": "@@ -0,0 +1,529 @@\n+///////////////////////////////////////////////////////////////////////////////\n+\n+    Copyright (c) 2020 Oracle and/or its affiliates.\n+\n+    Licensed under the Apache License, Version 2.0 (the \"License\");\n+    you may not use this file except in compliance with the License.\n+    You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+///////////////////////////////////////////////////////////////////////////////\n+\n+= Helidon SE OIDC Security Provider Guide\n+:h1Prefix: SE\n+:description: Helidon OIDC Security Provider\n+:keywords: helidon, security, guide, oidc, provider\n+\n+This guide describes how to set up Keycloak and Helidon\n+to secure your application with OIDC security provider.\n+\n+== What you need\n+\n+[width=50%,role=\"flex, sm7\"]\n+|===\n+|About 20 minutes\n+|<<about/03_prerequisites.adoc,Helidon Prerequisites>>\n+|===\n+\n+* <<Keycloak Installation,Keycloak Installation>>\n+* <<Set up Keycloak,Set up Keycloak>>\n+* <<Set up Helidon,Set up Helidon>>\n+* <<Restrict access to a specific role,Restrict access to a specific role>>\n+\n+=== Keycloak Installation\n+\n+==== On Docker\n+\n+To install Keycloak with Docker, open a terminal and make sure the port 8080 is free.\n+\n+[source,bash]\n+.Enter the following command\n+----\n+docker run -p 8080:8080 -e KEYCLOAK_USER=admin -e KEYCLOAK_PASSWORD=admin quay.io/keycloak/keycloak:11.0.2\n+----\n+\n+This will start Keycloak on local port 8080. It will create the admin user with username `admin` and password `admin`\n+Feel free to modify 11.0.2 by any keycloak version of your wish.\n+If you are running docker behind a proxy server, make sure it is either configured into docker or\n+disable it. Otherwise, you might face a connection timeout because docker cannot download the required data.\n+\n+To verify that Keycloak is running correctly, go to the admin console : http://localhost:8080/auth/admin\n+Log in using the username and password mentioned above: `admin`.\n+\n+You should be logged in successfully, and it prompts the admin console.\n+\n+==== On JDK\n+\n+Download the last version of Keycloak from Keycloak website : https://www.keycloak.org/downloads\n+In the table Server choose Standalone server distribution. ZIP or Tar format are available, click on either\n+to download Keycloak.\n+\n+After extracting the archive file, you should have a directory named keycloak followed by the version. For example,\n+if you chose version 11.0.2, the folder must be named keycloak-11.0.2.\n+\n+Open keycloak folder to make it your current directory.\n+[source,bash]\n+.Run this command from command prompt to open the directory:\n+----\n+cd keycloak-11.0.2\n+----\n+\n+===== Start Keycloak\n+\n+To start keycloak and have it ready for further steps, run the following command.\n+\n+[source,bash]\n+.On Linux run:\n+----\n+bin/standalone.sh\n+----\n+\n+[source,bash]\n+.On Windows run:\n+----\n+bin/standalone.bat\n+----\n+\n+Keycloak runs on localhost:8080 by default.\n+\n+===== Create an admin user\n+\n+You need to create an admin user because it does not come by default when installing Keycloak.\n+To do this, open  http://localhost:8080/auth in your favorite browser.\n+\n+A window `Welcome to Keycloak` should be prompted. If not, check if any error appear in the terminal.\n+\n+Fill the form by adding Username and Password. Click on `Create` to create the admin user.\n+\n+Above Administration Console should be printed \"User created\" in a green rectangle.\n+\n+To check that the admin user was created correctly, click on Administration user which should redirect you\n+to a Login form. Enter the Username and Password created earlier to log in.\n+\n+After successfully logged in, the admin console is prompted.\n+\n+=== Set up Keycloak\n+\n+To set up Keycloak properly, go to the admin console: http://localhost:8080/auth/admin\n+\n+If you are using Docker, use Username `admin` and password `admin` as it is the default admin user.\n+Otherwise, use the username and password you used to create the admin user.\n+\n+==== Create a realm\n+\n+A realm is the place where groups of applications, and their environment, can be created. It gathers :\n+\n+- One or several applications\n+- One or several users\n+- Sessions\n+- Events\n+- Clients and their scopes\n+\n+By default, there is a realm called `Master`. It is used to manage Keycloak. It is not recommended to associate your\n+application with this realm as it could disturb Keycloak functioning.\n+\n+To create a new realm to manage your application:\n+\n+. Open Keycloak admin console http://localhost:8080/auth/admin.\n+. Hover the mouse over the dropdown in the top-left corner where it says `Master`, and press `Add realm`.\n+. Fill the form by adding the realm name, `myRealm` for example.\n+. Click on `Create` to create the new realm.\n+\n+To verify that your realm is created, on the top-left corner where it said `Master` previously\n+should be now your realm name or `myRealm` is you followed the example.\n+\n+To switch from a realm to another, hover the realm name, and the other realm created appear in the dropdown.\n+Click on any realm name to change the current realm. Make sure all configuration or modification are saved before changing\n+the current realm or be subject to lose your configuration.\n+\n+==== Create a user\n+\n+Initially there are no users in a new realm. An unlimited number of user can be created per realm.\n+A realm contains resources such as client which can be accessed by users.\n+\n+To create a new user:\n+\n+. Open the Keycloak admin console: http://localhost:8080/auth/admin\n+. Click on `Users` in the left menu\n+. Press `Add user`\n+. Fill the form (Username is the only mendatory field) with this value Username: `myUser`\n+. Click `Save`\n+\n+A new user is just created but it needs a password to be able to login. To initialize it, do this:\n+\n+. Click on `Credentials` at the top of the page, under `Myuser`.\n+. Fill `Password` and `Password confirmation` with the user password of your choice.\n+. If the `Temporary` field is set to `ON`, the user has to  update password on next login. Click `ON`\n+to make it `OFF` and prevent it.\n+. Press `Set Password`.\n+. A pop-up window is popping off. Click on `Set Password` to confirm the new password.\n+\n+To verify that the new user is created correctly:\n+\n+. Open the Keycloak account console: http://localhost:8080/auth/realms/myrealm/account.\n+. Login with `myuser` and password chosen earlier.\n+\n+You should now be logged-in to the account console where users can manage their accounts.\n+\n+==== Create a Client\n+\n+To create your first client:\n+\n+. Navigate to the left menu, into configure section, click on `Clients`. This window displays a table with every client\n+from the realm.\n+. Click on `Create`\n+. Fill the following:\n+. `Client ID` : `myClientID`.\n+.. `Client Protocol` : `openid-connect`\n+.. `Access type` : `confidential`\n+.. `Valid Redirect URIs` : http://localhost:7987/*\n+. Press `Save`\n+\n+A new tab named `Credentials` is created. Click on it to access this new tab.\n+\n+- `Client Authenticator` : `Client ID and Secret`\n+- Click on `generate secret` to generate client secret.\n+\n+Keycloak is now configured and ready. Keep keycloak running on your terminal and open a new tab to\n+set up Helidon.\n+\n+=== Set up Helidon\n+\n+Use the Helidon SE Maven archetype to create a simple project. It will be used as an example\n+to show how to set up Helidon.\n+\n+[source,bash,subs=\"attributes+\"]\n+.Run the Maven archetype\n+----\n+mvn -U archetype:generate -DinteractiveMode=false \\\n+    -DarchetypeGroupId=io.helidon.archetypes \\\n+    -DarchetypeArtifactId=helidon-quickstart-se \\\n+    -DarchetypeVersion={helidon-version} \\\n+    -DgroupId=io.helidon.examples \\\n+    -DartifactId=helidon-quickstart-se \\\n+    -Dpackage=io.helidon.examples.quickstart.se\n+----\n+\n+[source,bash]\n+.The project will be built and run from the helidon-quickstart-se directory:\n+----\n+cd helidon-quickstart-se\n+----\n+\n+==== Update project dependencies\n+\n+Update the pom.xml file and add the following Helidon dependency to the `<dependencies>` section.\n+\n+[source,xml]\n+.Add the following dependency to `pom.xml`:\n+----\n+<dependency>\n+    <groupId>io.helidon.security.providers</groupId>\n+    <artifactId>helidon-security-providers-oidc</artifactId>\n+</dependency>\n+----\n+\n+==== Add OIDC security properties\n+\n+The OIDC security provider properties can be joined to helidon property file.\n+So it can be easily used to configure the web server without modifying application code.\n+\n+[source,yaml]\n+.Add the following line to application.yaml\n+----\n+security:\n+  providers:\n+  - abac:\n+      # Adds ABAC Provider - it does not require any configuration\n+  - oidc:\n+      client-id: \"myClientID\" // <1>\n+      client-secret: \"Client secret generated into Keycloak client credential\"\n+      identity-uri: \"http://localhost:8080/auth/realms/myrealm\" // <2>\n+      audience: \"account\"\n+      # proxy-host should be defined if you operate behind a proxy, can be removed otherwise\n+      proxy-host: \"\"\n+      frontend-uri: \"http://localhost:7987\" // <3>\n+      server-type: \"oidc\"\n+  web-server:\n+    # protected paths on the web server\n+    paths:  // <4>\n+      - path: \"/greet\"\n+        methods: [\"get\"]\n+        authenticate: true\n+----\n+<1> `client-id` must be the same as the one configure in keycloak.\n+<2> `identity-uri` is used to redirect the user to keycloak.\n+<3> `frontend-uri` will direct you back to the application.\n+<4> `paths` section defines the protected application's path.\n+\n+Make sure keycloak and the application are not running on the same port.\n+The application port value can be changed into application.yaml.\n+\n+[source,yaml]\n+.Change these properties to configure the server host and port\n+----\n+server:\n+  port: 7987\n+  host: localhost\n+----\n+\n+If the port 7987 is already used, check what port is free on your machine.\n+\n+[source,properties]\n+.Replace the old port into microprofile-config.properties\n+----\n+server.port=\"Your new port\"\n+----", "originalCommit": "0f0452a21ef0b61d08095b262c68a8b9604074a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTUxNzU4OQ==", "url": "https://github.com/oracle/helidon/pull/2310#discussion_r499517589", "bodyText": "I might suggest to add some note as in client-id etc. that user should insert that generated hash here.", "author": "Verdent", "createdAt": "2020-10-05T11:07:30Z", "path": "docs/se/guides/05_security_oidc.adoc", "diffHunk": "@@ -0,0 +1,529 @@\n+///////////////////////////////////////////////////////////////////////////////\n+\n+    Copyright (c) 2020 Oracle and/or its affiliates.\n+\n+    Licensed under the Apache License, Version 2.0 (the \"License\");\n+    you may not use this file except in compliance with the License.\n+    You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+///////////////////////////////////////////////////////////////////////////////\n+\n+= Helidon SE OIDC Security Provider Guide\n+:h1Prefix: SE\n+:description: Helidon OIDC Security Provider\n+:keywords: helidon, security, guide, oidc, provider\n+\n+This guide describes how to set up Keycloak and Helidon\n+to secure your application with OIDC security provider.\n+\n+== What you need\n+\n+[width=50%,role=\"flex, sm7\"]\n+|===\n+|About 20 minutes\n+|<<about/03_prerequisites.adoc,Helidon Prerequisites>>\n+|===\n+\n+* <<Keycloak Installation,Keycloak Installation>>\n+* <<Set up Keycloak,Set up Keycloak>>\n+* <<Set up Helidon,Set up Helidon>>\n+* <<Restrict access to a specific role,Restrict access to a specific role>>\n+\n+=== Keycloak Installation\n+\n+==== On Docker\n+\n+To install Keycloak with Docker, open a terminal and make sure the port 8080 is free.\n+\n+[source,bash]\n+.Enter the following command\n+----\n+docker run -p 8080:8080 -e KEYCLOAK_USER=admin -e KEYCLOAK_PASSWORD=admin quay.io/keycloak/keycloak:11.0.2\n+----\n+\n+This will start Keycloak on local port 8080. It will create the admin user with username `admin` and password `admin`\n+Feel free to modify 11.0.2 by any keycloak version of your wish.\n+If you are running docker behind a proxy server, make sure it is either configured into docker or\n+disable it. Otherwise, you might face a connection timeout because docker cannot download the required data.\n+\n+To verify that Keycloak is running correctly, go to the admin console : http://localhost:8080/auth/admin\n+Log in using the username and password mentioned above: `admin`.\n+\n+You should be logged in successfully, and it prompts the admin console.\n+\n+==== On JDK\n+\n+Download the last version of Keycloak from Keycloak website : https://www.keycloak.org/downloads\n+In the table Server choose Standalone server distribution. ZIP or Tar format are available, click on either\n+to download Keycloak.\n+\n+After extracting the archive file, you should have a directory named keycloak followed by the version. For example,\n+if you chose version 11.0.2, the folder must be named keycloak-11.0.2.\n+\n+Open keycloak folder to make it your current directory.\n+[source,bash]\n+.Run this command from command prompt to open the directory:\n+----\n+cd keycloak-11.0.2\n+----\n+\n+===== Start Keycloak\n+\n+To start keycloak and have it ready for further steps, run the following command.\n+\n+[source,bash]\n+.On Linux run:\n+----\n+bin/standalone.sh\n+----\n+\n+[source,bash]\n+.On Windows run:\n+----\n+bin/standalone.bat\n+----\n+\n+Keycloak runs on localhost:8080 by default.\n+\n+===== Create an admin user\n+\n+You need to create an admin user because it does not come by default when installing Keycloak.\n+To do this, open  http://localhost:8080/auth in your favorite browser.\n+\n+A window `Welcome to Keycloak` should be prompted. If not, check if any error appear in the terminal.\n+\n+Fill the form by adding Username and Password. Click on `Create` to create the admin user.\n+\n+Above Administration Console should be printed \"User created\" in a green rectangle.\n+\n+To check that the admin user was created correctly, click on Administration user which should redirect you\n+to a Login form. Enter the Username and Password created earlier to log in.\n+\n+After successfully logged in, the admin console is prompted.\n+\n+=== Set up Keycloak\n+\n+To set up Keycloak properly, go to the admin console: http://localhost:8080/auth/admin\n+\n+If you are using Docker, use Username `admin` and password `admin` as it is the default admin user.\n+Otherwise, use the username and password you used to create the admin user.\n+\n+==== Create a realm\n+\n+A realm is the place where groups of applications, and their environment, can be created. It gathers :\n+\n+- One or several applications\n+- One or several users\n+- Sessions\n+- Events\n+- Clients and their scopes\n+\n+By default, there is a realm called `Master`. It is used to manage Keycloak. It is not recommended to associate your\n+application with this realm as it could disturb Keycloak functioning.\n+\n+To create a new realm to manage your application:\n+\n+. Open Keycloak admin console http://localhost:8080/auth/admin.\n+. Hover the mouse over the dropdown in the top-left corner where it says `Master`, and press `Add realm`.\n+. Fill the form by adding the realm name, `myRealm` for example.\n+. Click on `Create` to create the new realm.\n+\n+To verify that your realm is created, on the top-left corner where it said `Master` previously\n+should be now your realm name or `myRealm` is you followed the example.\n+\n+To switch from a realm to another, hover the realm name, and the other realm created appear in the dropdown.\n+Click on any realm name to change the current realm. Make sure all configuration or modification are saved before changing\n+the current realm or be subject to lose your configuration.\n+\n+==== Create a user\n+\n+Initially there are no users in a new realm. An unlimited number of user can be created per realm.\n+A realm contains resources such as client which can be accessed by users.\n+\n+To create a new user:\n+\n+. Open the Keycloak admin console: http://localhost:8080/auth/admin\n+. Click on `Users` in the left menu\n+. Press `Add user`\n+. Fill the form (Username is the only mendatory field) with this value Username: `myUser`\n+. Click `Save`\n+\n+A new user is just created but it needs a password to be able to login. To initialize it, do this:\n+\n+. Click on `Credentials` at the top of the page, under `Myuser`.\n+. Fill `Password` and `Password confirmation` with the user password of your choice.\n+. If the `Temporary` field is set to `ON`, the user has to  update password on next login. Click `ON`\n+to make it `OFF` and prevent it.\n+. Press `Set Password`.\n+. A pop-up window is popping off. Click on `Set Password` to confirm the new password.\n+\n+To verify that the new user is created correctly:\n+\n+. Open the Keycloak account console: http://localhost:8080/auth/realms/myrealm/account.\n+. Login with `myuser` and password chosen earlier.\n+\n+You should now be logged-in to the account console where users can manage their accounts.\n+\n+==== Create a Client\n+\n+To create your first client:\n+\n+. Navigate to the left menu, into configure section, click on `Clients`. This window displays a table with every client\n+from the realm.\n+. Click on `Create`\n+. Fill the following:\n+. `Client ID` : `myClientID`.\n+.. `Client Protocol` : `openid-connect`\n+.. `Access type` : `confidential`\n+.. `Valid Redirect URIs` : http://localhost:7987/*\n+. Press `Save`\n+\n+A new tab named `Credentials` is created. Click on it to access this new tab.\n+\n+- `Client Authenticator` : `Client ID and Secret`\n+- Click on `generate secret` to generate client secret.\n+\n+Keycloak is now configured and ready. Keep keycloak running on your terminal and open a new tab to\n+set up Helidon.\n+\n+=== Set up Helidon\n+\n+Use the Helidon SE Maven archetype to create a simple project. It will be used as an example\n+to show how to set up Helidon.\n+\n+[source,bash,subs=\"attributes+\"]\n+.Run the Maven archetype\n+----\n+mvn -U archetype:generate -DinteractiveMode=false \\\n+    -DarchetypeGroupId=io.helidon.archetypes \\\n+    -DarchetypeArtifactId=helidon-quickstart-se \\\n+    -DarchetypeVersion={helidon-version} \\\n+    -DgroupId=io.helidon.examples \\\n+    -DartifactId=helidon-quickstart-se \\\n+    -Dpackage=io.helidon.examples.quickstart.se\n+----\n+\n+[source,bash]\n+.The project will be built and run from the helidon-quickstart-se directory:\n+----\n+cd helidon-quickstart-se\n+----\n+\n+==== Update project dependencies\n+\n+Update the pom.xml file and add the following Helidon dependency to the `<dependencies>` section.\n+\n+[source,xml]\n+.Add the following dependency to `pom.xml`:\n+----\n+<dependency>\n+    <groupId>io.helidon.security.providers</groupId>\n+    <artifactId>helidon-security-providers-oidc</artifactId>\n+</dependency>\n+----\n+\n+==== Add OIDC security properties\n+\n+The OIDC security provider properties can be joined to helidon property file.\n+So it can be easily used to configure the web server without modifying application code.\n+\n+[source,yaml]\n+.Add the following line to application.yaml\n+----\n+security:\n+  providers:\n+  - abac:\n+      # Adds ABAC Provider - it does not require any configuration\n+  - oidc:\n+      client-id: \"myClientID\" // <1>\n+      client-secret: \"Client secret generated into Keycloak client credential\"", "originalCommit": "0f0452a21ef0b61d08095b262c68a8b9604074a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTUxODkyOQ==", "url": "https://github.com/oracle/helidon/pull/2310#discussion_r499518929", "bodyText": "If this is meant to be used only in tests, please add <scope>test</scope>", "author": "Verdent", "createdAt": "2020-10-05T11:10:00Z", "path": "docs/se/guides/05_security_oidc.adoc", "diffHunk": "@@ -0,0 +1,529 @@\n+///////////////////////////////////////////////////////////////////////////////\n+\n+    Copyright (c) 2020 Oracle and/or its affiliates.\n+\n+    Licensed under the Apache License, Version 2.0 (the \"License\");\n+    you may not use this file except in compliance with the License.\n+    You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+///////////////////////////////////////////////////////////////////////////////\n+\n+= Helidon SE OIDC Security Provider Guide\n+:h1Prefix: SE\n+:description: Helidon OIDC Security Provider\n+:keywords: helidon, security, guide, oidc, provider\n+\n+This guide describes how to set up Keycloak and Helidon\n+to secure your application with OIDC security provider.\n+\n+== What you need\n+\n+[width=50%,role=\"flex, sm7\"]\n+|===\n+|About 20 minutes\n+|<<about/03_prerequisites.adoc,Helidon Prerequisites>>\n+|===\n+\n+* <<Keycloak Installation,Keycloak Installation>>\n+* <<Set up Keycloak,Set up Keycloak>>\n+* <<Set up Helidon,Set up Helidon>>\n+* <<Restrict access to a specific role,Restrict access to a specific role>>\n+\n+=== Keycloak Installation\n+\n+==== On Docker\n+\n+To install Keycloak with Docker, open a terminal and make sure the port 8080 is free.\n+\n+[source,bash]\n+.Enter the following command\n+----\n+docker run -p 8080:8080 -e KEYCLOAK_USER=admin -e KEYCLOAK_PASSWORD=admin quay.io/keycloak/keycloak:11.0.2\n+----\n+\n+This will start Keycloak on local port 8080. It will create the admin user with username `admin` and password `admin`\n+Feel free to modify 11.0.2 by any keycloak version of your wish.\n+If you are running docker behind a proxy server, make sure it is either configured into docker or\n+disable it. Otherwise, you might face a connection timeout because docker cannot download the required data.\n+\n+To verify that Keycloak is running correctly, go to the admin console : http://localhost:8080/auth/admin\n+Log in using the username and password mentioned above: `admin`.\n+\n+You should be logged in successfully, and it prompts the admin console.\n+\n+==== On JDK\n+\n+Download the last version of Keycloak from Keycloak website : https://www.keycloak.org/downloads\n+In the table Server choose Standalone server distribution. ZIP or Tar format are available, click on either\n+to download Keycloak.\n+\n+After extracting the archive file, you should have a directory named keycloak followed by the version. For example,\n+if you chose version 11.0.2, the folder must be named keycloak-11.0.2.\n+\n+Open keycloak folder to make it your current directory.\n+[source,bash]\n+.Run this command from command prompt to open the directory:\n+----\n+cd keycloak-11.0.2\n+----\n+\n+===== Start Keycloak\n+\n+To start keycloak and have it ready for further steps, run the following command.\n+\n+[source,bash]\n+.On Linux run:\n+----\n+bin/standalone.sh\n+----\n+\n+[source,bash]\n+.On Windows run:\n+----\n+bin/standalone.bat\n+----\n+\n+Keycloak runs on localhost:8080 by default.\n+\n+===== Create an admin user\n+\n+You need to create an admin user because it does not come by default when installing Keycloak.\n+To do this, open  http://localhost:8080/auth in your favorite browser.\n+\n+A window `Welcome to Keycloak` should be prompted. If not, check if any error appear in the terminal.\n+\n+Fill the form by adding Username and Password. Click on `Create` to create the admin user.\n+\n+Above Administration Console should be printed \"User created\" in a green rectangle.\n+\n+To check that the admin user was created correctly, click on Administration user which should redirect you\n+to a Login form. Enter the Username and Password created earlier to log in.\n+\n+After successfully logged in, the admin console is prompted.\n+\n+=== Set up Keycloak\n+\n+To set up Keycloak properly, go to the admin console: http://localhost:8080/auth/admin\n+\n+If you are using Docker, use Username `admin` and password `admin` as it is the default admin user.\n+Otherwise, use the username and password you used to create the admin user.\n+\n+==== Create a realm\n+\n+A realm is the place where groups of applications, and their environment, can be created. It gathers :\n+\n+- One or several applications\n+- One or several users\n+- Sessions\n+- Events\n+- Clients and their scopes\n+\n+By default, there is a realm called `Master`. It is used to manage Keycloak. It is not recommended to associate your\n+application with this realm as it could disturb Keycloak functioning.\n+\n+To create a new realm to manage your application:\n+\n+. Open Keycloak admin console http://localhost:8080/auth/admin.\n+. Hover the mouse over the dropdown in the top-left corner where it says `Master`, and press `Add realm`.\n+. Fill the form by adding the realm name, `myRealm` for example.\n+. Click on `Create` to create the new realm.\n+\n+To verify that your realm is created, on the top-left corner where it said `Master` previously\n+should be now your realm name or `myRealm` is you followed the example.\n+\n+To switch from a realm to another, hover the realm name, and the other realm created appear in the dropdown.\n+Click on any realm name to change the current realm. Make sure all configuration or modification are saved before changing\n+the current realm or be subject to lose your configuration.\n+\n+==== Create a user\n+\n+Initially there are no users in a new realm. An unlimited number of user can be created per realm.\n+A realm contains resources such as client which can be accessed by users.\n+\n+To create a new user:\n+\n+. Open the Keycloak admin console: http://localhost:8080/auth/admin\n+. Click on `Users` in the left menu\n+. Press `Add user`\n+. Fill the form (Username is the only mendatory field) with this value Username: `myUser`\n+. Click `Save`\n+\n+A new user is just created but it needs a password to be able to login. To initialize it, do this:\n+\n+. Click on `Credentials` at the top of the page, under `Myuser`.\n+. Fill `Password` and `Password confirmation` with the user password of your choice.\n+. If the `Temporary` field is set to `ON`, the user has to  update password on next login. Click `ON`\n+to make it `OFF` and prevent it.\n+. Press `Set Password`.\n+. A pop-up window is popping off. Click on `Set Password` to confirm the new password.\n+\n+To verify that the new user is created correctly:\n+\n+. Open the Keycloak account console: http://localhost:8080/auth/realms/myrealm/account.\n+. Login with `myuser` and password chosen earlier.\n+\n+You should now be logged-in to the account console where users can manage their accounts.\n+\n+==== Create a Client\n+\n+To create your first client:\n+\n+. Navigate to the left menu, into configure section, click on `Clients`. This window displays a table with every client\n+from the realm.\n+. Click on `Create`\n+. Fill the following:\n+. `Client ID` : `myClientID`.\n+.. `Client Protocol` : `openid-connect`\n+.. `Access type` : `confidential`\n+.. `Valid Redirect URIs` : http://localhost:7987/*\n+. Press `Save`\n+\n+A new tab named `Credentials` is created. Click on it to access this new tab.\n+\n+- `Client Authenticator` : `Client ID and Secret`\n+- Click on `generate secret` to generate client secret.\n+\n+Keycloak is now configured and ready. Keep keycloak running on your terminal and open a new tab to\n+set up Helidon.\n+\n+=== Set up Helidon\n+\n+Use the Helidon SE Maven archetype to create a simple project. It will be used as an example\n+to show how to set up Helidon.\n+\n+[source,bash,subs=\"attributes+\"]\n+.Run the Maven archetype\n+----\n+mvn -U archetype:generate -DinteractiveMode=false \\\n+    -DarchetypeGroupId=io.helidon.archetypes \\\n+    -DarchetypeArtifactId=helidon-quickstart-se \\\n+    -DarchetypeVersion={helidon-version} \\\n+    -DgroupId=io.helidon.examples \\\n+    -DartifactId=helidon-quickstart-se \\\n+    -Dpackage=io.helidon.examples.quickstart.se\n+----\n+\n+[source,bash]\n+.The project will be built and run from the helidon-quickstart-se directory:\n+----\n+cd helidon-quickstart-se\n+----\n+\n+==== Update project dependencies\n+\n+Update the pom.xml file and add the following Helidon dependency to the `<dependencies>` section.\n+\n+[source,xml]\n+.Add the following dependency to `pom.xml`:\n+----\n+<dependency>\n+    <groupId>io.helidon.security.providers</groupId>\n+    <artifactId>helidon-security-providers-oidc</artifactId>\n+</dependency>\n+----\n+\n+==== Add OIDC security properties\n+\n+The OIDC security provider properties can be joined to helidon property file.\n+So it can be easily used to configure the web server without modifying application code.\n+\n+[source,yaml]\n+.Add the following line to application.yaml\n+----\n+security:\n+  providers:\n+  - abac:\n+      # Adds ABAC Provider - it does not require any configuration\n+  - oidc:\n+      client-id: \"myClientID\" // <1>\n+      client-secret: \"Client secret generated into Keycloak client credential\"\n+      identity-uri: \"http://localhost:8080/auth/realms/myrealm\" // <2>\n+      audience: \"account\"\n+      # proxy-host should be defined if you operate behind a proxy, can be removed otherwise\n+      proxy-host: \"\"\n+      frontend-uri: \"http://localhost:7987\" // <3>\n+      server-type: \"oidc\"\n+  web-server:\n+    # protected paths on the web server\n+    paths:  // <4>\n+      - path: \"/greet\"\n+        methods: [\"get\"]\n+        authenticate: true\n+----\n+<1> `client-id` must be the same as the one configure in keycloak.\n+<2> `identity-uri` is used to redirect the user to keycloak.\n+<3> `frontend-uri` will direct you back to the application.\n+<4> `paths` section defines the protected application's path.\n+\n+Make sure keycloak and the application are not running on the same port.\n+The application port value can be changed into application.yaml.\n+\n+[source,yaml]\n+.Change these properties to configure the server host and port\n+----\n+server:\n+  port: 7987\n+  host: localhost\n+----\n+\n+If the port 7987 is already used, check what port is free on your machine.\n+\n+[source,properties]\n+.Replace the old port into microprofile-config.properties\n+----\n+server.port=\"Your new port\"\n+----\n+\n+[source,yaml]\n+.Replace the old port into application.yaml\n+----\n+frontend-uri: \"http://localhost:Your new port\"\n+----\n+\n+==== Configure web server\n+\n+Once the properties are added, the web server must be set up.\n+The `Main.createRouting` method gather all configuration properties.\n+\n+[source,java]\n+.Add the following to `Main.createRouting` method\n+----\n+import io.helidon.security.Security;\n+import io.helidon.security.integration.webserver.WebSecurity;\n+import io.helidon.security.providers.oidc.OidcSupport;\n+...\n+Security security = Security.create(config.get(\"security\"));    // <1>\n+\n+return Routing.builder()\n+                .register(WebSecurity.create(security,config.get(\"security\"))) // <2>\n+                .register(OidcSupport.create(config))   // <3>\n+                ...\n+----\n+<1> Create the Helidon `Security` instance using configuration.\n+<2> Register Helidon `WebSecurity` instance using security instance and configuration.\n+<3> Register Helidon `OidcSupport` instance.\n+\n+That code is extracting security properties from application.yaml into two steps.\n+First the Security instance is used to bootstrap security, so the WebSecurity instance\n+can integrate security into Web Server.\n+Then, OidcSupport instance registers the endpoint to which OIDC redirects browser after a successful login.\n+\n+Helidon sample is now set up and ready.\n+\n+==== Try it !\n+\n+[source,bash]\n+.Build the application, skipping unit tests, then run it:\n+----\n+mvn package -DskipTests=true\n+java -jar target/helidon-quickstart-se.jar\n+----\n+\n+The tests must be skipped, otherwise it produces test failure. As the `/greet` endpoint for GET request is\n+now protected, its access is limited, and the tests are not built to take oidc security in account.\n+\n+. Open your favourite browser and try to access `http://localhost:7987/greet/Michael`.\n+. You should not be redirected and receive greeting from the application.\n+. Enter the following into URL : `http://localhost:7987/greet`.\n+. Keycloak redirect you to its login page.\n+. Enter the username and associated password:\n+.. `Username` : `myUser`\n+.. `Password`: `password`\n+. After successful log in, keycloak redirect you to the `http://localhost:7987/greet` endpoint and print Hello word.\n+\n+From the actual settings, the user needs to log in only once, then Keycloak saves all the connection data.\n+\n+==== Update tests to the secure environment\n+\n+At this stage of the application, tests cannot pass because of OIDC security. The only way to authenticate a user is\n+through the front end of that server which can be accessed with the browser for example.\n+\n+In order to keep security and test the application locally, a new security provider must be set up. By adding specific\n+configuration to the tests, it is possible to override the application configuration.\n+\n+The following explains how to set a basic authentication instead of oidc security provider only for the tests. Which means,\n+at the end of this guide, the application will be secured by oidc security provider, and the tests will use basic authentication.\n+\n+[source,xml]\n+.Add the following dependency to `pom.xml`:\n+----\n+<dependency>\n+    <groupId>io.helidon.security.providers</groupId>\n+    <artifactId>helidon-security-providers-http-auth</artifactId>\n+</dependency>", "originalCommit": "0f0452a21ef0b61d08095b262c68a8b9604074a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTUyMDM5Nw==", "url": "https://github.com/oracle/helidon/pull/2310#discussion_r499520397", "bodyText": "MainTest.java", "author": "Verdent", "createdAt": "2020-10-05T11:12:43Z", "path": "docs/se/guides/05_security_oidc.adoc", "diffHunk": "@@ -0,0 +1,529 @@\n+///////////////////////////////////////////////////////////////////////////////\n+\n+    Copyright (c) 2020 Oracle and/or its affiliates.\n+\n+    Licensed under the Apache License, Version 2.0 (the \"License\");\n+    you may not use this file except in compliance with the License.\n+    You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+///////////////////////////////////////////////////////////////////////////////\n+\n+= Helidon SE OIDC Security Provider Guide\n+:h1Prefix: SE\n+:description: Helidon OIDC Security Provider\n+:keywords: helidon, security, guide, oidc, provider\n+\n+This guide describes how to set up Keycloak and Helidon\n+to secure your application with OIDC security provider.\n+\n+== What you need\n+\n+[width=50%,role=\"flex, sm7\"]\n+|===\n+|About 20 minutes\n+|<<about/03_prerequisites.adoc,Helidon Prerequisites>>\n+|===\n+\n+* <<Keycloak Installation,Keycloak Installation>>\n+* <<Set up Keycloak,Set up Keycloak>>\n+* <<Set up Helidon,Set up Helidon>>\n+* <<Restrict access to a specific role,Restrict access to a specific role>>\n+\n+=== Keycloak Installation\n+\n+==== On Docker\n+\n+To install Keycloak with Docker, open a terminal and make sure the port 8080 is free.\n+\n+[source,bash]\n+.Enter the following command\n+----\n+docker run -p 8080:8080 -e KEYCLOAK_USER=admin -e KEYCLOAK_PASSWORD=admin quay.io/keycloak/keycloak:11.0.2\n+----\n+\n+This will start Keycloak on local port 8080. It will create the admin user with username `admin` and password `admin`\n+Feel free to modify 11.0.2 by any keycloak version of your wish.\n+If you are running docker behind a proxy server, make sure it is either configured into docker or\n+disable it. Otherwise, you might face a connection timeout because docker cannot download the required data.\n+\n+To verify that Keycloak is running correctly, go to the admin console : http://localhost:8080/auth/admin\n+Log in using the username and password mentioned above: `admin`.\n+\n+You should be logged in successfully, and it prompts the admin console.\n+\n+==== On JDK\n+\n+Download the last version of Keycloak from Keycloak website : https://www.keycloak.org/downloads\n+In the table Server choose Standalone server distribution. ZIP or Tar format are available, click on either\n+to download Keycloak.\n+\n+After extracting the archive file, you should have a directory named keycloak followed by the version. For example,\n+if you chose version 11.0.2, the folder must be named keycloak-11.0.2.\n+\n+Open keycloak folder to make it your current directory.\n+[source,bash]\n+.Run this command from command prompt to open the directory:\n+----\n+cd keycloak-11.0.2\n+----\n+\n+===== Start Keycloak\n+\n+To start keycloak and have it ready for further steps, run the following command.\n+\n+[source,bash]\n+.On Linux run:\n+----\n+bin/standalone.sh\n+----\n+\n+[source,bash]\n+.On Windows run:\n+----\n+bin/standalone.bat\n+----\n+\n+Keycloak runs on localhost:8080 by default.\n+\n+===== Create an admin user\n+\n+You need to create an admin user because it does not come by default when installing Keycloak.\n+To do this, open  http://localhost:8080/auth in your favorite browser.\n+\n+A window `Welcome to Keycloak` should be prompted. If not, check if any error appear in the terminal.\n+\n+Fill the form by adding Username and Password. Click on `Create` to create the admin user.\n+\n+Above Administration Console should be printed \"User created\" in a green rectangle.\n+\n+To check that the admin user was created correctly, click on Administration user which should redirect you\n+to a Login form. Enter the Username and Password created earlier to log in.\n+\n+After successfully logged in, the admin console is prompted.\n+\n+=== Set up Keycloak\n+\n+To set up Keycloak properly, go to the admin console: http://localhost:8080/auth/admin\n+\n+If you are using Docker, use Username `admin` and password `admin` as it is the default admin user.\n+Otherwise, use the username and password you used to create the admin user.\n+\n+==== Create a realm\n+\n+A realm is the place where groups of applications, and their environment, can be created. It gathers :\n+\n+- One or several applications\n+- One or several users\n+- Sessions\n+- Events\n+- Clients and their scopes\n+\n+By default, there is a realm called `Master`. It is used to manage Keycloak. It is not recommended to associate your\n+application with this realm as it could disturb Keycloak functioning.\n+\n+To create a new realm to manage your application:\n+\n+. Open Keycloak admin console http://localhost:8080/auth/admin.\n+. Hover the mouse over the dropdown in the top-left corner where it says `Master`, and press `Add realm`.\n+. Fill the form by adding the realm name, `myRealm` for example.\n+. Click on `Create` to create the new realm.\n+\n+To verify that your realm is created, on the top-left corner where it said `Master` previously\n+should be now your realm name or `myRealm` is you followed the example.\n+\n+To switch from a realm to another, hover the realm name, and the other realm created appear in the dropdown.\n+Click on any realm name to change the current realm. Make sure all configuration or modification are saved before changing\n+the current realm or be subject to lose your configuration.\n+\n+==== Create a user\n+\n+Initially there are no users in a new realm. An unlimited number of user can be created per realm.\n+A realm contains resources such as client which can be accessed by users.\n+\n+To create a new user:\n+\n+. Open the Keycloak admin console: http://localhost:8080/auth/admin\n+. Click on `Users` in the left menu\n+. Press `Add user`\n+. Fill the form (Username is the only mendatory field) with this value Username: `myUser`\n+. Click `Save`\n+\n+A new user is just created but it needs a password to be able to login. To initialize it, do this:\n+\n+. Click on `Credentials` at the top of the page, under `Myuser`.\n+. Fill `Password` and `Password confirmation` with the user password of your choice.\n+. If the `Temporary` field is set to `ON`, the user has to  update password on next login. Click `ON`\n+to make it `OFF` and prevent it.\n+. Press `Set Password`.\n+. A pop-up window is popping off. Click on `Set Password` to confirm the new password.\n+\n+To verify that the new user is created correctly:\n+\n+. Open the Keycloak account console: http://localhost:8080/auth/realms/myrealm/account.\n+. Login with `myuser` and password chosen earlier.\n+\n+You should now be logged-in to the account console where users can manage their accounts.\n+\n+==== Create a Client\n+\n+To create your first client:\n+\n+. Navigate to the left menu, into configure section, click on `Clients`. This window displays a table with every client\n+from the realm.\n+. Click on `Create`\n+. Fill the following:\n+. `Client ID` : `myClientID`.\n+.. `Client Protocol` : `openid-connect`\n+.. `Access type` : `confidential`\n+.. `Valid Redirect URIs` : http://localhost:7987/*\n+. Press `Save`\n+\n+A new tab named `Credentials` is created. Click on it to access this new tab.\n+\n+- `Client Authenticator` : `Client ID and Secret`\n+- Click on `generate secret` to generate client secret.\n+\n+Keycloak is now configured and ready. Keep keycloak running on your terminal and open a new tab to\n+set up Helidon.\n+\n+=== Set up Helidon\n+\n+Use the Helidon SE Maven archetype to create a simple project. It will be used as an example\n+to show how to set up Helidon.\n+\n+[source,bash,subs=\"attributes+\"]\n+.Run the Maven archetype\n+----\n+mvn -U archetype:generate -DinteractiveMode=false \\\n+    -DarchetypeGroupId=io.helidon.archetypes \\\n+    -DarchetypeArtifactId=helidon-quickstart-se \\\n+    -DarchetypeVersion={helidon-version} \\\n+    -DgroupId=io.helidon.examples \\\n+    -DartifactId=helidon-quickstart-se \\\n+    -Dpackage=io.helidon.examples.quickstart.se\n+----\n+\n+[source,bash]\n+.The project will be built and run from the helidon-quickstart-se directory:\n+----\n+cd helidon-quickstart-se\n+----\n+\n+==== Update project dependencies\n+\n+Update the pom.xml file and add the following Helidon dependency to the `<dependencies>` section.\n+\n+[source,xml]\n+.Add the following dependency to `pom.xml`:\n+----\n+<dependency>\n+    <groupId>io.helidon.security.providers</groupId>\n+    <artifactId>helidon-security-providers-oidc</artifactId>\n+</dependency>\n+----\n+\n+==== Add OIDC security properties\n+\n+The OIDC security provider properties can be joined to helidon property file.\n+So it can be easily used to configure the web server without modifying application code.\n+\n+[source,yaml]\n+.Add the following line to application.yaml\n+----\n+security:\n+  providers:\n+  - abac:\n+      # Adds ABAC Provider - it does not require any configuration\n+  - oidc:\n+      client-id: \"myClientID\" // <1>\n+      client-secret: \"Client secret generated into Keycloak client credential\"\n+      identity-uri: \"http://localhost:8080/auth/realms/myrealm\" // <2>\n+      audience: \"account\"\n+      # proxy-host should be defined if you operate behind a proxy, can be removed otherwise\n+      proxy-host: \"\"\n+      frontend-uri: \"http://localhost:7987\" // <3>\n+      server-type: \"oidc\"\n+  web-server:\n+    # protected paths on the web server\n+    paths:  // <4>\n+      - path: \"/greet\"\n+        methods: [\"get\"]\n+        authenticate: true\n+----\n+<1> `client-id` must be the same as the one configure in keycloak.\n+<2> `identity-uri` is used to redirect the user to keycloak.\n+<3> `frontend-uri` will direct you back to the application.\n+<4> `paths` section defines the protected application's path.\n+\n+Make sure keycloak and the application are not running on the same port.\n+The application port value can be changed into application.yaml.\n+\n+[source,yaml]\n+.Change these properties to configure the server host and port\n+----\n+server:\n+  port: 7987\n+  host: localhost\n+----\n+\n+If the port 7987 is already used, check what port is free on your machine.\n+\n+[source,properties]\n+.Replace the old port into microprofile-config.properties\n+----\n+server.port=\"Your new port\"\n+----\n+\n+[source,yaml]\n+.Replace the old port into application.yaml\n+----\n+frontend-uri: \"http://localhost:Your new port\"\n+----\n+\n+==== Configure web server\n+\n+Once the properties are added, the web server must be set up.\n+The `Main.createRouting` method gather all configuration properties.\n+\n+[source,java]\n+.Add the following to `Main.createRouting` method\n+----\n+import io.helidon.security.Security;\n+import io.helidon.security.integration.webserver.WebSecurity;\n+import io.helidon.security.providers.oidc.OidcSupport;\n+...\n+Security security = Security.create(config.get(\"security\"));    // <1>\n+\n+return Routing.builder()\n+                .register(WebSecurity.create(security,config.get(\"security\"))) // <2>\n+                .register(OidcSupport.create(config))   // <3>\n+                ...\n+----\n+<1> Create the Helidon `Security` instance using configuration.\n+<2> Register Helidon `WebSecurity` instance using security instance and configuration.\n+<3> Register Helidon `OidcSupport` instance.\n+\n+That code is extracting security properties from application.yaml into two steps.\n+First the Security instance is used to bootstrap security, so the WebSecurity instance\n+can integrate security into Web Server.\n+Then, OidcSupport instance registers the endpoint to which OIDC redirects browser after a successful login.\n+\n+Helidon sample is now set up and ready.\n+\n+==== Try it !\n+\n+[source,bash]\n+.Build the application, skipping unit tests, then run it:\n+----\n+mvn package -DskipTests=true\n+java -jar target/helidon-quickstart-se.jar\n+----\n+\n+The tests must be skipped, otherwise it produces test failure. As the `/greet` endpoint for GET request is\n+now protected, its access is limited, and the tests are not built to take oidc security in account.\n+\n+. Open your favourite browser and try to access `http://localhost:7987/greet/Michael`.\n+. You should not be redirected and receive greeting from the application.\n+. Enter the following into URL : `http://localhost:7987/greet`.\n+. Keycloak redirect you to its login page.\n+. Enter the username and associated password:\n+.. `Username` : `myUser`\n+.. `Password`: `password`\n+. After successful log in, keycloak redirect you to the `http://localhost:7987/greet` endpoint and print Hello word.\n+\n+From the actual settings, the user needs to log in only once, then Keycloak saves all the connection data.\n+\n+==== Update tests to the secure environment\n+\n+At this stage of the application, tests cannot pass because of OIDC security. The only way to authenticate a user is\n+through the front end of that server which can be accessed with the browser for example.\n+\n+In order to keep security and test the application locally, a new security provider must be set up. By adding specific\n+configuration to the tests, it is possible to override the application configuration.\n+\n+The following explains how to set a basic authentication instead of oidc security provider only for the tests. Which means,\n+at the end of this guide, the application will be secured by oidc security provider, and the tests will use basic authentication.\n+\n+[source,xml]\n+.Add the following dependency to `pom.xml`:\n+----\n+<dependency>\n+    <groupId>io.helidon.security.providers</groupId>\n+    <artifactId>helidon-security-providers-http-auth</artifactId>\n+</dependency>\n+----\n+\n+In the test folder `helidon-quickstart-se/src/test`:\n+\n+[source,bash]\n+.Create a new directory and another one inside\n+----\n+mkdir resources\n+cd resources\n+touch application.yaml\n+----\n+\n+Open the application.yaml file\n+\n+[source,yaml]\n+.Copy these properties into application.yaml\n+----\n+app:\n+  greeting: \"Hello\"\n+\n+server:\n+  port: 7987\n+  host: localhost\n+\n+security:\n+  providers:\n+    - abac:\n+      # Adds ABAC Provider - it does not require any configuration\n+    - http-basic-auth:\n+        users:\n+          - login: \"jack\"\n+            password: \"jackIsGreat\"\n+    - oidc:\n+        client-id: \"Your client ID\"\n+        client-secret: \"Your client secret\"\n+        identity-uri: \"http://localhost:8080/auth/realms/myrealm\"\n+        audience: \"account\"\n+        frontend-uri: \"http://localhost:7987\"\n+        server-type: \"oidc\"\n+  web-server:\n+    # protected paths on the web server - do not include paths served by Jersey, as those are protected directly\n+    paths:\n+      - path: \"/greet\"\n+        methods: [\"get\"]\n+        authenticate: true\n+----\n+\n+Add the `http-basic-auth` properties in the security -> providers property section. This configuration will be used\n+by the tests instead of the `java/resources/application.yaml`.\n+\n+In the `Maintest.java` file, tests need to be modified to check the application security when accessing `/greet` path with a", "originalCommit": "0f0452a21ef0b61d08095b262c68a8b9604074a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d445a3988b3cb4998c70d910525c49a605c7171d", "url": "https://github.com/oracle/helidon/commit/d445a3988b3cb4998c70d910525c49a605c7171d", "message": "Update Helidon SE : Modification Verdent review\n\nSigned-off-by: tvallin <thibault.vallin@oracle.com>", "committedDate": "2020-10-12T09:38:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTIxMDIzMg==", "url": "https://github.com/oracle/helidon/pull/2310#discussion_r509210232", "bodyText": "This is also the case for renaming to reflect proper name isn't it?", "author": "Verdent", "createdAt": "2020-10-21T11:45:58Z", "path": "docs/se/guides/05_security_oidc.adoc", "diffHunk": "@@ -0,0 +1,532 @@\n+///////////////////////////////////////////////////////////////////////////////\n+\n+    Copyright (c) 2020 Oracle and/or its affiliates.\n+\n+    Licensed under the Apache License, Version 2.0 (the \"License\");\n+    you may not use this file except in compliance with the License.\n+    You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+    Unless required by applicable law or agreed to in writing, software\n+    distributed under the License is distributed on an \"AS IS\" BASIS,\n+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+    See the License for the specific language governing permissions and\n+    limitations under the License.\n+\n+///////////////////////////////////////////////////////////////////////////////\n+\n+= Helidon SE OIDC Security Provider Guide\n+:h1Prefix: SE\n+:description: Helidon OIDC Security Provider\n+:keywords: helidon, security, guide, oidc, provider\n+\n+This guide describes how to set up Keycloak and Helidon\n+to secure your application with OIDC security provider.\n+\n+== What you need\n+\n+[width=50%,role=\"flex, sm7\"]\n+|===\n+|About 20 minutes\n+|<<about/03_prerequisites.adoc,Helidon Prerequisites>>\n+|===\n+\n+* <<Keycloak Installation,Keycloak Installation>>\n+* <<Set up Keycloak,Set up Keycloak>>\n+* <<Set up Helidon,Set up Helidon>>\n+* <<Restrict access to a specific role,Restrict access to a specific role>>\n+\n+=== Keycloak Installation\n+\n+==== On Docker\n+\n+To install Keycloak with Docker, open a terminal and make sure the port 8080 is free.\n+\n+[source,bash]\n+.Enter the following command\n+----\n+docker run -p 8080:8080 -e KEYCLOAK_USER=admin -e KEYCLOAK_PASSWORD=admin quay.io/keycloak/keycloak:11.0.2\n+----\n+\n+This will start Keycloak on local port 8080. It will create the admin user with username `admin` and password `admin`\n+Feel free to modify 11.0.2 by any keycloak version of your wish.\n+If you are running docker behind a proxy server, make sure it is either configured into docker or\n+disable it. Otherwise, you might face a connection timeout because docker cannot download the required data.\n+\n+To verify that Keycloak is running correctly, go to the admin console : http://localhost:8080/auth/admin\n+Log in using the username and password mentioned above: `admin`.\n+\n+You should be logged in successfully, and it prompts the admin console.\n+\n+==== On JDK\n+\n+Download the last version of Keycloak from Keycloak website : https://www.keycloak.org/downloads\n+In the table Server choose Standalone server distribution. ZIP or Tar format are available, click on either\n+to download Keycloak.\n+\n+After extracting the archive file, you should have a directory named keycloak followed by the version. For example,\n+if you chose version 11.0.2, the folder must be named keycloak-11.0.2.\n+\n+Open keycloak folder to make it your current directory.\n+[source,bash]\n+.Run this command from command prompt to open the directory:\n+----\n+cd keycloak-11.0.2\n+----\n+\n+===== Start Keycloak\n+\n+To start keycloak and have it ready for further steps, run the following command.\n+\n+[source,bash]\n+.On Linux run:\n+----\n+bin/standalone.sh\n+----\n+\n+[source,bash]\n+.On Windows run:\n+----\n+bin/standalone.bat\n+----\n+\n+Keycloak runs on localhost:8080 by default.\n+\n+===== Create an admin user\n+\n+You need to create an admin user because it does not come by default when installing Keycloak.\n+To do this, open  http://localhost:8080/auth in your favorite browser.\n+\n+A window `Welcome to Keycloak` should be prompted. If not, check if any error appear in the terminal.\n+\n+Fill the form by adding Username and Password. Click on `Create` to create the admin user.\n+\n+Above Administration Console should be printed \"User created\" in a green rectangle.\n+\n+To check that the admin user was created correctly, click on Administration user which should redirect you\n+to a Login form. Enter the Username and Password created earlier to log in.\n+\n+After successfully logged in, the admin console is prompted.\n+\n+=== Set up Keycloak\n+\n+To set up Keycloak properly, go to the admin console: http://localhost:8080/auth/admin\n+\n+If you are using Docker, use Username `admin` and password `admin` as it is the default admin user.\n+Otherwise, use the username and password you used to create the admin user.\n+\n+==== Create a realm\n+\n+A realm is the place where groups of applications, and their environment, can be created. It gathers :\n+\n+- One or several applications\n+- One or several users\n+- Sessions\n+- Events\n+- Clients and their scopes\n+\n+By default, there is a realm called `Master`. It is used to manage Keycloak. It is not recommended to associate your\n+application with this realm as it could disturb Keycloak functioning.\n+\n+To create a new realm to manage your application:\n+\n+. Open Keycloak admin console http://localhost:8080/auth/admin.\n+. Hover the mouse over the dropdown in the top-left corner where it says `Master`, and press `Add realm`.\n+. Fill the form by adding the realm name, `myRealm` for example.\n+. Click on `Create` to create the new realm.\n+\n+To verify that your realm is created, on the top-left corner where it said `Master` previously\n+should be now your realm name or `myRealm` is you followed the example.\n+\n+To switch from a realm to another, hover the realm name, and the other realm created appear in the dropdown.\n+Click on any realm name to change the current realm. Make sure all configuration or modification are saved before changing\n+the current realm or be subject to lose your configuration.\n+\n+==== Create a user\n+\n+Initially there are no users in a new realm. An unlimited number of user can be created per realm.\n+A realm contains resources such as client which can be accessed by users.\n+\n+To create a new user:\n+\n+. Open the Keycloak admin console: http://localhost:8080/auth/admin\n+. Click on `Users` in the left menu\n+. Press `Add user`\n+. Fill the form (Username is the only mendatory field) with this value Username: `myUser`\n+. Click `Save`\n+\n+A new user is just created but it needs a password to be able to login. To initialize it, do this:\n+\n+. Click on `Credentials` at the top of the page, under `Myuser`.\n+. Fill `Password` and `Password confirmation` with the user password of your choice.\n+. If the `Temporary` field is set to `ON`, the user has to  update password on next login. Click `ON`\n+to make it `OFF` and prevent it.\n+. Press `Set Password`.\n+. A pop-up window is popping off. Click on `Set Password` to confirm the new password.\n+\n+To verify that the new user is created correctly:\n+\n+. Open the Keycloak account console: `http://localhost:8080/auth/realms/myRealm/account`.\n+. Login with `myuser` and password chosen earlier.\n+\n+You should now be logged-in to the account console where users can manage their accounts.\n+\n+==== Create a Client\n+\n+To create your first client:\n+\n+. Navigate to the left menu, into configure section, click on `Clients`. This window displays a table with every client\n+from the realm.\n+. Click on `Create`\n+. Fill the following:\n+.. `Client ID` : `myClientID`.\n+.. `Client Protocol` : `openid-connect`\n+. Press `Save`\n+.. Modify `Access type` : `confidential`\n+.. Update `Valid Redirect URIs` : http://localhost:7987/*\n+. Click on `Save`\n+\n+A new tab named `Credentials` is created. Click on it to access this new tab.\n+\n+- `Client Authenticator` : `Client ID and Secret`\n+- Click on `generate secret` to generate client secret.\n+\n+Keycloak is now configured and ready. Keep keycloak running on your terminal and open a new tab to\n+set up Helidon.\n+\n+=== Set up Helidon\n+\n+Use the Helidon SE Maven archetype to create a simple project. It will be used as an example\n+to show how to set up Helidon. Replace `{helidon-version}` by the latest helidon version.\n+\n+[source,bash,subs=\"attributes+\"]\n+.Run the Maven archetype\n+----\n+mvn -U archetype:generate -DinteractiveMode=false \\\n+    -DarchetypeGroupId=io.helidon.archetypes \\\n+    -DarchetypeArtifactId=helidon-quickstart-se \\\n+    -DarchetypeVersion={helidon-version} \\\n+    -DgroupId=io.helidon.examples \\\n+    -DartifactId=helidon-quickstart-se \\\n+    -Dpackage=io.helidon.examples.quickstart.se\n+----\n+\n+[source,bash]\n+.The project will be built and run from the helidon-quickstart-se directory:\n+----\n+cd helidon-quickstart-se\n+----\n+\n+==== Update project dependencies\n+\n+Update the pom.xml file and add the following Helidon dependency to the `<dependencies>` section.\n+\n+[source,xml]\n+.Add the following dependency to `pom.xml`:\n+----\n+<dependency>\n+    <groupId>io.helidon.security.providers</groupId>\n+    <artifactId>helidon-security-providers-oidc</artifactId>\n+</dependency>\n+----\n+\n+==== Add OIDC security properties\n+\n+The OIDC security provider configuration can be joined to helidon configuration file.\n+This file is located here: `src/main/resources/application.yaml`. It can be easily used to configure the web server\n+without modifying application code.\n+\n+[source,yaml]\n+.Add the following line to application.yaml\n+----\n+security:\n+  providers:\n+  - abac:\n+      # Adds ABAC Provider - it does not require any configuration\n+  - oidc:\n+      client-id: \"myClientID\" // <1>\n+      client-secret: \"Client secret generated into Keycloak client credential\" // <2>\n+      identity-uri: \"http://localhost:8080/auth/realms/myRealm\" // <3>\n+      audience: \"account\"\n+      # proxy-host should be defined if you operate behind a proxy, can be removed otherwise\n+      proxy-host: \"\"\n+      frontend-uri: \"http://localhost:7987\" // <4>\n+      server-type: \"oidc\"\n+  web-server:\n+    # protected paths on the web server\n+    paths:  // <5>\n+      - path: \"/greet\"\n+        methods: [\"get\"]\n+        authenticate: true\n+----\n+<1> `client-id` must be the same as the one configure in keycloak.\n+<2> The client secret generate by Keycloak during `Create a client` section.\n+<3> `identity-uri` is used to redirect the user to keycloak.\n+<4> `frontend-uri` will direct you back to the application.\n+<5> `paths` section defines the protected application's path.\n+\n+Make sure keycloak and the application are not running on the same port.\n+The application port value can be changed into application.yaml.\n+\n+[source,yaml]\n+.Change these properties to configure the server host and port\n+----\n+server:\n+  port: 7987\n+  host: localhost\n+----\n+\n+If the port 7987 is already used, check what port is free on your machine.\n+\n+[source,yaml]\n+.Replace the old port into application.yaml\n+----\n+server:\n+  port: \"{Your-new-port}\"\n+\n+...\n+\n+frontend-uri: \"http://localhost:{Your-new-port}\"\n+----\n+\n+==== Configure web server\n+\n+Once the properties are added, the web server must be set up.\n+The `Main.createRouting` method gather all configuration properties.\n+\n+[source,java]\n+.Add the following to `Main.createRouting` method\n+----\n+import io.helidon.security.Security;\n+import io.helidon.security.integration.webserver.WebSecurity;\n+import io.helidon.security.providers.oidc.OidcSupport;\n+...\n+Security security = Security.create(config.get(\"security\"));    // <1>\n+\n+return Routing.builder()\n+                .register(WebSecurity.create(security,config.get(\"security\"))) // <2>\n+                .register(OidcSupport.create(config))   // <3>\n+                ...\n+----\n+<1> Create the Helidon `Security` instance using configuration.\n+<2> Register Helidon `WebSecurity` instance using security instance and configuration.\n+<3> Register Helidon `OidcSupport` instance.\n+\n+That code is extracting security properties from application.yaml into two steps.\n+First the Security instance is used to bootstrap security, so the WebSecurity instance\n+can integrate security into Web Server.\n+Then, OidcSupport instance registers the endpoint to which OIDC redirects browser after a successful login.\n+\n+Helidon sample is now set up and ready.\n+\n+==== Try it !\n+\n+[source,bash]\n+.Build the application, skipping unit tests, then run it:\n+----\n+mvn package -DskipTests=true\n+java -jar target/helidon-quickstart-se.jar\n+----\n+\n+The tests must be skipped, otherwise it produces test failure. As the `/greet` endpoint for GET request is\n+now protected, its access is limited, and the tests are not built to take oidc security in account.\n+\n+. Open your favourite browser and try to access `http://localhost:7987/greet/Michael`.\n+. You should not be redirected and receive greeting from the application.\n+. Enter the following into URL : `http://localhost:7987/greet`.\n+. Keycloak redirect you to its login page.\n+. Enter the username and associated password:\n+.. `Username` : `myUser`\n+.. `Password`: `password`\n+. After successful log in, keycloak redirect you to the `http://localhost:7987/greet` endpoint and print Hello word.\n+\n+From the actual settings, the user needs to log in only once, then Keycloak saves all the connection data.\n+\n+==== Update tests to the secure environment\n+\n+At this stage of the application, tests cannot pass because of OIDC security. The only way to authenticate a user is\n+through the front end of that server which can be accessed with the browser for example.\n+\n+In order to keep security and test the application locally, a new security provider must be set up. By adding specific\n+configuration to the tests, it is possible to override the application configuration.\n+\n+The following explains how to set a basic authentication instead of oidc security provider only for the tests. Which means,\n+at the end of this guide, the application will be secured by oidc security provider, and the tests will use basic authentication.\n+\n+[source,xml]\n+.Add the following dependency to `pom.xml`:\n+----\n+<dependency>\n+    <groupId>io.helidon.security.providers</groupId>\n+    <artifactId>helidon-security-providers-http-auth</artifactId>\n+    <scope>test</scope>\n+</dependency>\n+----\n+\n+In the test folder `helidon-quickstart-se/src/test`:\n+\n+[source,bash]\n+.Create a new directory and another one inside\n+----\n+mkdir resources\n+cd resources\n+touch application.yaml\n+----\n+\n+Open the application.yaml file\n+\n+[source,yaml]\n+.Copy these properties into application.yaml\n+----\n+app:\n+  greeting: \"Hello\"\n+\n+server:\n+  port: 7987\n+  host: localhost\n+\n+security:\n+  providers:\n+    - abac:\n+      # Adds ABAC Provider - it does not require any configuration\n+    - http-basic-auth:\n+        users:\n+          - login: \"jack\"\n+            password: \"jackIsGreat\"\n+    - oidc:\n+        client-id: \"Your client ID\"\n+        client-secret: \"Your client secret\"\n+        identity-uri: \"http://localhost:8080/auth/realms/myrealm\"", "originalCommit": "d445a3988b3cb4998c70d910525c49a605c7171d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1628e95206c4ee8ae64fb38899b4bc7049fd773b", "url": "https://github.com/oracle/helidon/commit/1628e95206c4ee8ae64fb38899b4bc7049fd773b", "message": "Update Helidon SE : Check up from beginning\n\nSigned-off-by: tvallin <thibault.vallin@oracle.com>", "committedDate": "2020-10-22T11:10:11Z", "type": "commit"}]}