{"pr_number": 2543, "pr_title": "Jms connector SE api ", "pr_createdAt": "2020-11-24T10:18:09Z", "pr_url": "https://github.com/oracle/helidon/pull/2543", "timeline": [{"oid": "ed2535abe99f1c22ac8f25772c1fca4acfdb15b0", "url": "https://github.com/oracle/helidon/commit/ed2535abe99f1c22ac8f25772c1fca4acfdb15b0", "message": "JMS connector SE api\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-11-23T13:28:43Z", "type": "commit"}, {"oid": "efb076439c3453ad25197f8fbee7b056428f0fb3", "url": "https://github.com/oracle/helidon/commit/efb076439c3453ad25197f8fbee7b056428f0fb3", "message": "Doc for JMS connector in SE flavor\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-11-24T10:21:02Z", "type": "commit"}, {"oid": "1feca78ea3e0efc443bb716b893f290fd355e1f4", "url": "https://github.com/oracle/helidon/commit/1feca78ea3e0efc443bb716b893f290fd355e1f4", "message": "Checkstyle fix\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-11-24T10:43:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjI2MzQ0MQ==", "url": "https://github.com/oracle/helidon/pull/2543#discussion_r532263441", "bodyText": "This class should use a builder. If we need a separate constructor for CDI, so be it, but there should be a constructor with a builder, that allows explicit configuration of everything that can be configured through config.\nIn SE, there is always a choice for developer - either build everything by hand, or use a config, or a combination\nFor example the executor services must be configurable, as user may want to reuse an executor service for multiple components", "author": "tomas-langer", "createdAt": "2020-11-29T20:42:27Z", "path": "messaging/connectors/jms/src/main/java/io/helidon/messaging/connectors/jms/JmsConnector.java", "diffHunk": "@@ -122,6 +122,34 @@\n     private final ExecutorService executor;\n     private final Map<String, SessionMetadata> sessionRegister = new HashMap<>();\n \n+    /**\n+     * Creates a new instance of JmsConnector with the required configuration.\n+     *\n+     * @param config Helidon {@link io.helidon.config.Config config}\n+     * @return the new instance\n+     */\n+    public static JmsConnector create(io.helidon.config.Config config) {", "originalCommit": "1feca78ea3e0efc443bb716b893f290fd355e1f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUwMjU5Mw==", "url": "https://github.com/oracle/helidon/pull/2543#discussion_r532502593", "bodyText": "Great idea, fixed", "author": "danielkec", "createdAt": "2020-11-30T10:44:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjI2MzQ0MQ=="}], "type": "inlineReview"}, {"oid": "eb40fa513b83fb9c0efc5d1beb1f90757076f191", "url": "https://github.com/oracle/helidon/commit/eb40fa513b83fb9c0efc5d1beb1f90757076f191", "message": "SE JmsConnector builder\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-11-30T10:39:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE1MTA5OQ==", "url": "https://github.com/oracle/helidon/pull/2543#discussion_r533151099", "bodyText": "The Builder should be a static inner class of JmsConnector, not a standalone class - is there a reason for breaking this rule?", "author": "tomas-langer", "createdAt": "2020-12-01T08:27:14Z", "path": "messaging/connectors/jms/src/main/java/io/helidon/messaging/connectors/jms/JmsConnector.java", "diffHunk": "@@ -116,20 +116,24 @@\n     static final String TYPE_PROP_DEFAULT = \"queue\";\n     static final String JNDI_JMS_FACTORY_DEFAULT = \"ConnectionFactory\";\n \n+    static final String SCHEDULER_THREAD_NAME_PREFIX = \"jms-poll-\";\n+    static final String EXECUTOR_THREAD_NAME_PREFIX = \"jms-\";\n+\n     private final Instance<ConnectionFactory> connectionFactories;\n \n     private final ScheduledExecutorService scheduler;\n     private final ExecutorService executor;\n     private final Map<String, SessionMetadata> sessionRegister = new HashMap<>();\n+    private Map<String, ConnectionFactory> connectionFactoryMap;\n \n     /**\n-     * Creates a new instance of JmsConnector with the required configuration.\n+     * Provides a {@link io.helidon.messaging.connectors.jms.JmsConnectorBuilder} for creating\n+     * a {@link io.helidon.messaging.connectors.jms.JmsConnector} instance.\n      *\n-     * @param config Helidon {@link io.helidon.config.Config config}\n-     * @return the new instance\n+     * @return new Builder instance\n      */\n-    public static JmsConnector create(io.helidon.config.Config config) {\n-        return new JmsConnector(config, null);\n+    public static JmsConnectorBuilder builder() {", "originalCommit": "eb40fa513b83fb9c0efc5d1beb1f90757076f191", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzI3ODg1MA==", "url": "https://github.com/oracle/helidon/pull/2543#discussion_r533278850", "bodyText": "no reason, fixed", "author": "danielkec", "createdAt": "2020-12-01T10:17:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE1MTA5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE1MTYzMA==", "url": "https://github.com/oracle/helidon/pull/2543#discussion_r533151630", "bodyText": "Please also add methods for Supplier<ExecutorService> (and Supplier<ScheduledExecutorServer> below) so we can pass our ThreadPoolSupplier directly.", "author": "tomas-langer", "createdAt": "2020-12-01T08:28:13Z", "path": "messaging/connectors/jms/src/main/java/io/helidon/messaging/connectors/jms/JmsConnectorBuilder.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Copyright (c)  2020 Oracle and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.helidon.messaging.connectors.jms;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.ScheduledExecutorService;\n+\n+import javax.jms.ConnectionFactory;\n+\n+import io.helidon.common.Builder;\n+import io.helidon.common.configurable.ScheduledThreadPoolSupplier;\n+import io.helidon.common.configurable.ThreadPoolSupplier;\n+import io.helidon.config.Config;\n+\n+/**\n+ * Builder for {@link io.helidon.messaging.connectors.jms.JmsConnector}.\n+ */\n+public class JmsConnectorBuilder implements Builder<JmsConnector> {\n+\n+    private final Map<String, ConnectionFactory> connectionFactoryMap = new HashMap<>();\n+    private ScheduledExecutorService scheduler;\n+    private ExecutorService executor;\n+    private Config config;\n+\n+    /**\n+     * Add custom {@link javax.jms.ConnectionFactory ConnectionFactory} referencable by supplied name with\n+     * {@link JmsConnector#NAMED_FACTORY_ATTRIBUTE}.\n+     *\n+     * @param name              referencable connection factory name\n+     * @param connectionFactory custom connection factory\n+     * @return this builder\n+     */\n+    public JmsConnectorBuilder connectionFactory(String name, ConnectionFactory connectionFactory) {\n+        connectionFactoryMap.put(name, connectionFactory);\n+        return this;\n+    }\n+\n+    /**\n+     * Custom configuration for connector.\n+     *\n+     * @param config custom config\n+     * @return this builder\n+     */\n+    public JmsConnectorBuilder config(Config config) {\n+        this.config = config;\n+        return this;\n+    }\n+\n+    /**\n+     * Custom executor for asynchronous operations like acknowledgement.\n+     *\n+     * @param executor custom executor service\n+     * @return this builder\n+     */\n+    public JmsConnectorBuilder executor(ExecutorService executor) {", "originalCommit": "eb40fa513b83fb9c0efc5d1beb1f90757076f191", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzI3OTAzMQ==", "url": "https://github.com/oracle/helidon/pull/2543#discussion_r533279031", "bodyText": "added", "author": "danielkec", "createdAt": "2020-12-01T10:17:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE1MTYzMA=="}], "type": "inlineReview"}, {"oid": "0fdf68c2b7e3fc65855bfebd6fe25e4811af2eca", "url": "https://github.com/oracle/helidon/commit/0fdf68c2b7e3fc65855bfebd6fe25e4811af2eca", "message": "Move JMSConnector builder to inner class\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-12-01T10:14:43Z", "type": "commit"}, {"oid": "11658fb1412a56c7d6b61f942e6d8c55736d0b54", "url": "https://github.com/oracle/helidon/commit/11658fb1412a56c7d6b61f942e6d8c55736d0b54", "message": "Javadoc fix\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-12-01T12:36:46Z", "type": "commit"}, {"oid": "77753d39f422a7b0b9d4b71cf8ff1edc2a7ffc2c", "url": "https://github.com/oracle/helidon/commit/77753d39f422a7b0b9d4b71cf8ff1edc2a7ffc2c", "message": "AQ SE api\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-12-02T10:00:19Z", "type": "commit"}, {"oid": "95c47f1e47667c3696da8158b9f3b86ff7bd80ee", "url": "https://github.com/oracle/helidon/commit/95c47f1e47667c3696da8158b9f3b86ff7bd80ee", "message": "AQ SE tests\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-12-02T10:01:00Z", "type": "commit"}, {"oid": "8b25baa0a98a7400b0b07a50da3ca429abe5b443", "url": "https://github.com/oracle/helidon/commit/8b25baa0a98a7400b0b07a50da3ca429abe5b443", "message": "Jms example fix\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-12-02T12:15:13Z", "type": "commit"}, {"oid": "ac75ee059b23e47481b5f05d3084d2583a4b18f6", "url": "https://github.com/oracle/helidon/commit/ac75ee059b23e47481b5f05d3084d2583a4b18f6", "message": "Jakarta JTA instead of Javax\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-12-02T17:05:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDExNDgzMA==", "url": "https://github.com/oracle/helidon/pull/2543#discussion_r534114830", "bodyText": "This should be require static as well", "author": "tomas-langer", "createdAt": "2020-12-02T12:03:09Z", "path": "messaging/connectors/aq/src/main/java/module-info.java", "diffHunk": "@@ -18,6 +18,7 @@\n     requires transitive io.helidon.messaging.connectors.jms;\n     requires java.logging;\n     requires javax.jms.api;\n+    requires io.helidon.config.mp;", "originalCommit": "95c47f1e47667c3696da8158b9f3b86ff7bd80ee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzEwMDY0OQ==", "url": "https://github.com/oracle/helidon/pull/2543#discussion_r537100649", "bodyText": "There is already version.lib.transaction-api - this is a different version and naming. This seems wrong", "author": "tomas-langer", "createdAt": "2020-12-06T18:52:36Z", "path": "dependencies/pom.xml", "diffHunk": "@@ -79,6 +79,7 @@\n         <version.lib.jsonb-api>1.0.2</version.lib.jsonb-api>\n         <version.lib.jsonp-api>1.1.6</version.lib.jsonp-api>\n         <version.lib.jsonp-impl>1.1.6</version.lib.jsonp-impl>\n+        <version.lib.jta>1.1</version.lib.jta>", "originalCommit": "ac75ee059b23e47481b5f05d3084d2583a4b18f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzEwNzAxNg==", "url": "https://github.com/oracle/helidon/pull/2543#discussion_r537107016", "bodyText": "yay thx thats leftover", "author": "danielkec", "createdAt": "2020-12-06T19:30:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzEwMDY0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzEwMTUwMw==", "url": "https://github.com/oracle/helidon/pull/2543#discussion_r537101503", "bodyText": "Using Config.create() may not be correct - do you really want to add environment variables, system properties and the default configuration source (such as application.yaml) to this configuration instance?", "author": "tomas-langer", "createdAt": "2020-12-06T18:57:38Z", "path": "messaging/connectors/aq/src/main/java/io/helidon/messaging/connectors/aq/AqConnector.java", "diffHunk": "@@ -12,152 +12,172 @@\n  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n- *\n  */\n \n package io.helidon.messaging.connectors.aq;\n \n-import java.util.Optional;\n-import java.util.concurrent.Executor;\n-import java.util.function.BiConsumer;\n-\n-import javax.enterprise.context.ApplicationScoped;\n-import javax.enterprise.inject.Instance;\n-import javax.enterprise.inject.literal.NamedLiteral;\n-import javax.enterprise.inject.spi.CDI;\n-import javax.inject.Inject;\n-import javax.jms.ConnectionFactory;\n-import javax.jms.JMSException;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.ScheduledExecutorService;\n+\n import javax.sql.DataSource;\n \n-import io.helidon.config.Config;\n-import io.helidon.config.ConfigValue;\n-import io.helidon.messaging.MessagingException;\n-import io.helidon.messaging.connectors.jms.ConnectionContext;\n-import io.helidon.messaging.connectors.jms.JmsConnector;\n-import io.helidon.messaging.connectors.jms.JmsMessage;\n-import io.helidon.messaging.connectors.jms.SessionMetadata;\n+import io.helidon.common.Builder;\n+import io.helidon.common.configurable.ScheduledThreadPoolSupplier;\n+import io.helidon.common.configurable.ThreadPoolSupplier;\n \n-import oracle.jms.AQjmsConnectionFactory;\n-import org.eclipse.microprofile.reactive.messaging.Message;\n-import org.eclipse.microprofile.reactive.messaging.spi.Connector;\n+import org.eclipse.microprofile.reactive.messaging.spi.ConnectorFactory;\n \n /**\n- * MicroProfile Reactive Messaging Oracle AQ connector.\n+ * Reactive Messaging Oracle AQ connector.\n  */\n-@ApplicationScoped\n-@Connector(AqConnector.CONNECTOR_NAME)\n-public class AqConnector extends JmsConnector {\n+public interface AqConnector extends ConnectorFactory {\n \n     /**\n-     * Microprofile messaging Oracle AQ connector name.\n+     * Oracle AQ connector name.\n      */\n-    public static final String CONNECTOR_NAME = \"helidon-aq\";\n+    String CONNECTOR_NAME = \"helidon-aq\";\n \n-    private static final String DATASOURCE_ATTRIBUTE = \"data-source\";\n-    private static final String URL_ATTRIBUTE = \"url\";\n+    /**\n+     * Configuration key for data source identifier.\n+     */\n+    String DATASOURCE_ATTRIBUTE = \"data-source\";\n \n-    private final Instance<AQjmsConnectionFactory> connectionFactories;\n+    /**\n+     * Configuration key for Oracle db connection string.\n+     */\n+    String URL_ATTRIBUTE = \"url\";\n \n     /**\n-     * Create new AQConnector.\n-     *\n-     * @param config root config for thread context\n+     * Configuration key for thread name prefix used for asynchronous operations like acknowledgement.\n      */\n-    @Inject\n-    AqConnector(Config config, Instance<AQjmsConnectionFactory> connectionFactories) {\n-        super(config, null);\n-        this.connectionFactories = connectionFactories;\n-    }\n+    String EXECUTOR_THREAD_NAME_PREFIX = \"aq-\";\n \n-    @Override\n-    protected Optional<? extends ConnectionFactory> getFactory(ConnectionContext ctx) {\n-\n-        // Named factory\n-        ConfigValue<String> factoryName = ctx.config().get(NAMED_FACTORY_ATTRIBUTE).asString();\n-        if (factoryName.isPresent()) {\n-            Config factory = ctx.config().get(\"factory\").get(factoryName.get());\n-            if (factory.exists()) {\n-                // from config\n-                try {\n-                    return Optional.of(createAqFactory(factory));\n-                } catch (JMSException e) {\n-                    throw new MessagingException(\"Error when preparing AQjmsConnectionFactory \" + factoryName.get(), e);\n-                }\n-            } else {\n-                // or named bean\n-                return Optional.ofNullable(connectionFactories)\n-                        .flatMap(s -> s.stream().findFirst());\n-            }\n-        }\n+    /**\n+     * Configuration key for thread name prefix used for polling.\n+     */\n+    String SCHEDULER_THREAD_NAME_PREFIX = \"aq-poll-\";\n \n-        // per channel config\n-        if (ctx.config().get(URL_ATTRIBUTE).exists() || ctx.config().get(DATASOURCE_ATTRIBUTE).exists()) {\n-            try {\n-                return Optional.of(createAqFactory(ctx.config()));\n-            } catch (JMSException e) {\n-                throw new MessagingException(\"Error when preparing AQjmsConnectionFactory\", e);\n-            }\n-        }\n+    /**\n+     * Provides a {@link io.helidon.messaging.connectors.jms.JmsConnector.JmsConnectorBuilder} for creating\n+     * a {@link io.helidon.messaging.connectors.jms.JmsConnector} instance.\n+     *\n+     * @return new Builder instance\n+     */\n+    static AqConnectorBuilder builder() {\n+        return new AqConnectorBuilder();\n+    }\n \n-        // Check out not named beans\n-        return Optional.ofNullable(connectionFactories)\n-                .flatMap(s -> s.stream()\n-                        .filter(AQjmsConnectionFactory.class::isInstance)\n-                        .findFirst()\n-                );\n+    /**\n+     * Custom config builder for AQ connector.\n+     *\n+     * @return new AQ specific config builder\n+     */\n+    static AqConfigBuilder configBuilder() {\n+        return new AqConfigBuilder();\n     }\n \n-    private AQjmsConnectionFactory createAqFactory(Config c) throws JMSException {\n-        ConfigValue<String> user = c.get(USERNAME_ATTRIBUTE).asString();\n-        ConfigValue<String> password = c.get(PASSWORD_ATTRIBUTE).asString();\n-        ConfigValue<String> url = c.get(URL_ATTRIBUTE).asString();\n-        ConfigValue<String> dataSourceName = c.get(DATASOURCE_ATTRIBUTE).asString();\n-        AQjmsConnectionFactory fact = new AQjmsConnectionFactory();\n-        if (dataSourceName.isPresent()) {\n-            if (user.isPresent()) {\n-                throw new MessagingException(\"When \" + DATASOURCE_ATTRIBUTE + \" is set, properties \"\n-                        + String.join(\", \", USERNAME_ATTRIBUTE, PASSWORD_ATTRIBUTE, URL_ATTRIBUTE)\n-                        + \" are forbidden!\");\n-            }\n+    /**\n+     * Builder for {@link AqConnectorImpl}.\n+     */\n+    class AqConnectorBuilder implements Builder<AqConnectorImpl> {\n+\n+        private final Map<String, DataSource> dataSourceMap = new HashMap<>();\n+        private ScheduledExecutorService scheduler;\n+        private ExecutorService executor;\n+        private io.helidon.config.Config config;\n+\n+        /**\n+         * Add custom {@link javax.jms.ConnectionFactory ConnectionFactory} referencable by supplied name with\n+         * {@link io.helidon.messaging.connectors.jms.JmsConnector#NAMED_FACTORY_ATTRIBUTE}.\n+         *\n+         * @param name       referencable connection factory name\n+         * @param dataSource custom connection factory\n+         * @return this builder\n+         */\n+        public AqConnectorBuilder dataSource(String name, DataSource dataSource) {\n+            dataSourceMap.put(name, dataSource);\n+            return this;\n+        }\n \n-            Instance<DataSource> dataSources = CDI.current().select(DataSource.class, NamedLiteral.of(dataSourceName.get()));\n-            if (dataSources.isResolvable()) {\n-                fact.setDatasource(dataSources.get());\n-            } else {\n-                throw new MessagingException(\"Datasource \" + dataSourceName.get()\n-                        + (dataSources.isAmbiguous() ? \" is ambiguous!\" : \" not found!\"));\n-            }\n+        /**\n+         * Custom configuration for connector.\n+         *\n+         * @param config custom config\n+         * @return this builder\n+         */\n+        public AqConnectorBuilder config(io.helidon.config.Config config) {\n+            this.config = config;\n+            return this;\n         }\n-        if (url.isPresent()) {\n-            fact.setJdbcURL(url.get());\n+\n+        /**\n+         * Custom executor for asynchronous operations like acknowledgement.\n+         *\n+         * @param executor custom executor service\n+         * @return this builder\n+         */\n+        public AqConnectorBuilder executor(ExecutorService executor) {\n+            this.executor = executor;\n+            return this;\n         }\n-        if (user.isPresent()) {\n-            fact.setUsername(user.get());\n+\n+        /**\n+         * Custom executor for loop pulling messages from JMS.\n+         *\n+         * @param scheduler custom scheduled executor service\n+         * @return this builder\n+         */\n+        public AqConnectorBuilder scheduler(ScheduledExecutorService scheduler) {\n+            this.scheduler = scheduler;\n+            return this;\n         }\n-        if (password.isPresent()) {\n-            fact.setPassword(password.get());\n+\n+        /**\n+         * Custom executor supplier for asynchronous operations like acknowledgement.\n+         *\n+         * @param executorSupplier custom executor service\n+         * @return this builder\n+         */\n+        public AqConnectorBuilder executor(ThreadPoolSupplier executorSupplier) {\n+            this.executor = executorSupplier.get();\n+            return this;\n         }\n-        return fact;\n-    }\n \n+        /**\n+         * Custom executor supplier for loop pulling messages from JMS.\n+         *\n+         * @param schedulerPoolSupplier custom scheduled executor service\n+         * @return this builder\n+         */\n+        public AqConnectorBuilder scheduler(ScheduledThreadPoolSupplier schedulerPoolSupplier) {\n+            this.scheduler = schedulerPoolSupplier.get();\n+            return this;\n+        }\n \n-    @Override\n-    protected JmsMessage<?> createMessage(javax.jms.Message message,\n-                                          Executor executor,\n-                                          SessionMetadata sessionMetadata) {\n-        return new AqMessageImpl<>(super.createMessage(message, executor, sessionMetadata), sessionMetadata);\n-    }\n+        @Override\n+        public AqConnectorImpl build() {\n+            if (config == null) {\n+                config = io.helidon.config.Config.create();", "originalCommit": "ac75ee059b23e47481b5f05d3084d2583a4b18f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzEwNTU1MQ==", "url": "https://github.com/oracle/helidon/pull/2543#discussion_r537105551", "bodyText": "That was the idea, connector without any configuration is useless", "author": "danielkec", "createdAt": "2020-12-06T19:22:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzEwMTUwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODEyMjA2MA==", "url": "https://github.com/oracle/helidon/pull/2543#discussion_r538122060", "bodyText": "We have agreed to use empty config, as that is the expectation by user. Config.create() may pick up unexpected configuration files.", "author": "tomas-langer", "createdAt": "2020-12-08T08:10:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzEwMTUwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzEwMTgyOQ==", "url": "https://github.com/oracle/helidon/pull/2543#discussion_r537101829", "bodyText": "The map should be final", "author": "tomas-langer", "createdAt": "2020-12-06T18:59:45Z", "path": "messaging/connectors/jms/src/main/java/io/helidon/messaging/connectors/jms/JmsConnector.java", "diffHunk": "@@ -116,11 +117,43 @@\n     static final String TYPE_PROP_DEFAULT = \"queue\";\n     static final String JNDI_JMS_FACTORY_DEFAULT = \"ConnectionFactory\";\n \n+    static final String SCHEDULER_THREAD_NAME_PREFIX = \"jms-poll-\";\n+    static final String EXECUTOR_THREAD_NAME_PREFIX = \"jms-\";\n+\n     private final Instance<ConnectionFactory> connectionFactories;\n \n     private final ScheduledExecutorService scheduler;\n     private final ExecutorService executor;\n     private final Map<String, SessionMetadata> sessionRegister = new HashMap<>();\n+    private Map<String, ConnectionFactory> connectionFactoryMap;", "originalCommit": "ac75ee059b23e47481b5f05d3084d2583a4b18f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzExODQ5NQ==", "url": "https://github.com/oracle/helidon/pull/2543#discussion_r537118495", "bodyText": "fixed", "author": "danielkec", "createdAt": "2020-12-06T20:36:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzEwMTgyOQ=="}], "type": "inlineReview"}, {"oid": "d6d868832505c4e73b4dae0d5610097547dbb349", "url": "https://github.com/oracle/helidon/commit/d6d868832505c4e73b4dae0d5610097547dbb349", "message": "Review issues 2\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-12-06T20:36:33Z", "type": "commit"}, {"oid": "a69084b936e55e19818fd6131ddbeed490adc653", "url": "https://github.com/oracle/helidon/commit/a69084b936e55e19818fd6131ddbeed490adc653", "message": "Review issues 3\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-12-07T20:27:55Z", "type": "commit"}]}