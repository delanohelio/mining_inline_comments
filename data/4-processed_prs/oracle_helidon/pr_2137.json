{"pr_number": 2137, "pr_title": "Create cli-data for snapshot builds", "pr_createdAt": "2020-07-06T19:57:54Z", "pr_url": "https://github.com/oracle/helidon/pull/2137", "timeline": [{"oid": "23150818c2aba65e09631c5aee17f849665b21ba", "url": "https://github.com/oracle/helidon/commit/23150818c2aba65e09631c5aee17f849665b21ba", "message": "Create cli-data for snapshot builds.", "committedDate": "2020-07-06T19:56:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ2NjE3NQ==", "url": "https://github.com/oracle/helidon/pull/2137#discussion_r450466175", "bodyText": "This plugin version needs to be managed in the top level pom.", "author": "romain-grecourt", "createdAt": "2020-07-06T20:36:46Z", "path": "archetypes/catalog/pom.xml", "diffHunk": "@@ -67,4 +67,95 @@\n             <optional>true</optional>\n         </dependency>\n     </dependencies>\n+\n+    <properties>\n+        <!-- support command-line overrides -->\n+        <build.tools.version>${version.plugin.helidon-build-tools}</build.tools.version>\n+    </properties>\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>io.helidon.build-tools</groupId>\n+                <artifactId>helidon-stager-maven-plugin</artifactId>\n+                <version>${version.plugin.helidon-build-tools}</version>\n+                <executions>\n+                    <execution>\n+                        <phase>install</phase>\n+                        <goals>\n+                            <goal>stage</goal>\n+                        </goals>\n+                        <configuration>\n+                            <directories>\n+                                <directory target=\"${project.build.directory}\">\n+                                    <archives>\n+                                        <archive target=\"cli-data/${project.version}/cli-data.zip\">\n+                                            <unpack-artifacts>\n+                                                <unpack-artifact groupId=\"io.helidon.archetypes\"\n+                                                                 artifactId=\"helidon-archetype-catalog\"\n+                                                                 version=\"${project.version}\"\n+                                                                 type=\"zip\"\n+                                                                 target=\".\"/>\n+                                            </unpack-artifacts>\n+                                            <templates>\n+                                                <template source=\"cli-metadata.properties.mustache\"\n+                                                          target=\"metadata.properties\">\n+                                                    <variables>\n+                                                        <variable name=\"buildtoolsVersion\"\n+                                                                  value=\"${build.tools.version}\"/>\n+                                                        <variable name=\"cliVersion\"\n+                                                                  value=\"${version.plugin.helidon-build-tools}\"/>\n+                                                    </variables>\n+                                                </template>\n+                                            </templates>\n+                                        </archive>\n+                                    </archives>\n+                                    <files>\n+                                        <file target=\"cli-data/latest\">${project.version}</file>\n+                                    </files>\n+                                </directory>\n+                            </directories>\n+                        </configuration>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>com.soebes.maven.plugins</groupId>\n+                <artifactId>echo-maven-plugin</artifactId>\n+                <version>0.4.0</version>", "originalCommit": "23150818c2aba65e09631c5aee17f849665b21ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ2OTEyNw==", "url": "https://github.com/oracle/helidon/pull/2137#discussion_r450469127", "bodyText": "There is nothing to do unless one wants to test the archetypes. Can you change the beginning of this sentence to provide some context ? E.g. You can test the archetypes locally with the Helidon CLI using the following arguments:\nAlso, the version is not always snapshot. E.g. if you build a tag.", "author": "romain-grecourt", "createdAt": "2020-07-06T20:43:04Z", "path": "archetypes/catalog/pom.xml", "diffHunk": "@@ -67,4 +67,95 @@\n             <optional>true</optional>\n         </dependency>\n     </dependencies>\n+\n+    <properties>\n+        <!-- support command-line overrides -->\n+        <build.tools.version>${version.plugin.helidon-build-tools}</build.tools.version>\n+    </properties>\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>io.helidon.build-tools</groupId>\n+                <artifactId>helidon-stager-maven-plugin</artifactId>\n+                <version>${version.plugin.helidon-build-tools}</version>\n+                <executions>\n+                    <execution>\n+                        <phase>install</phase>\n+                        <goals>\n+                            <goal>stage</goal>\n+                        </goals>\n+                        <configuration>\n+                            <directories>\n+                                <directory target=\"${project.build.directory}\">\n+                                    <archives>\n+                                        <archive target=\"cli-data/${project.version}/cli-data.zip\">\n+                                            <unpack-artifacts>\n+                                                <unpack-artifact groupId=\"io.helidon.archetypes\"\n+                                                                 artifactId=\"helidon-archetype-catalog\"\n+                                                                 version=\"${project.version}\"\n+                                                                 type=\"zip\"\n+                                                                 target=\".\"/>\n+                                            </unpack-artifacts>\n+                                            <templates>\n+                                                <template source=\"cli-metadata.properties.mustache\"\n+                                                          target=\"metadata.properties\">\n+                                                    <variables>\n+                                                        <variable name=\"buildtoolsVersion\"\n+                                                                  value=\"${build.tools.version}\"/>\n+                                                        <variable name=\"cliVersion\"\n+                                                                  value=\"${version.plugin.helidon-build-tools}\"/>\n+                                                    </variables>\n+                                                </template>\n+                                            </templates>\n+                                        </archive>\n+                                    </archives>\n+                                    <files>\n+                                        <file target=\"cli-data/latest\">${project.version}</file>\n+                                    </files>\n+                                </directory>\n+                            </directories>\n+                        </configuration>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>com.soebes.maven.plugins</groupId>\n+                <artifactId>echo-maven-plugin</artifactId>\n+                <version>0.4.0</version>\n+                <executions>\n+                    <execution>\n+                        <phase>install</phase>\n+                        <goals>\n+                            <goal>echo</goal>\n+                        </goals>\n+                    </execution>\n+                </executions>\n+                <configuration>\n+                    <echos>\n+                        <echo> |</echo>\n+                        <echo> |                      /')    </echo>\n+                        <echo> |               ////  /' )'   </echo>\n+                        <echo> |              @   \\/'  )'    </echo>\n+                        <echo> |  { note }   &lt; (  (_...)' </echo>\n+                        <echo> |               \\      )      </echo>\n+                        <echo> |                \\,,,,/       </echo>\n+                        <echo> |                 _|_         </echo>\n+                        <echo> |</echo>\n+                        <echo> |  You must add the following arguments to the CLI to use these snapshot archetypes:</echo>", "originalCommit": "23150818c2aba65e09631c5aee17f849665b21ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ3MTYyNw==", "url": "https://github.com/oracle/helidon/pull/2137#discussion_r450471627", "bodyText": "Can you use the same name of in helidon-site ? I.e. cli.maven.plugin.version\nI know we have build.tools.version in metadata.properties, but IMO this is too confusing to expose as property.\nE.g. The line below has ${version.plugin.helidon-build-tools}\nI would like to use cli.maven.plugin.version onwards and look at renaming the property inside metadata.properties (even if that means having code that support both properties to maintain backward compatibility).\nAlso this property needs to have a default value since this stager plugin execution is added by default.\nYou should define the property with a default value in the top level pom:\n<cli.maven.plugin.version>${version.plugin.helidon-build-tools}</cli.maven.plugin.version>", "author": "romain-grecourt", "createdAt": "2020-07-06T20:48:11Z", "path": "archetypes/catalog/pom.xml", "diffHunk": "@@ -67,4 +67,95 @@\n             <optional>true</optional>\n         </dependency>\n     </dependencies>\n+\n+    <properties>\n+        <!-- support command-line overrides -->\n+        <build.tools.version>${version.plugin.helidon-build-tools}</build.tools.version>\n+    </properties>\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>io.helidon.build-tools</groupId>\n+                <artifactId>helidon-stager-maven-plugin</artifactId>\n+                <version>${version.plugin.helidon-build-tools}</version>\n+                <executions>\n+                    <execution>\n+                        <phase>install</phase>\n+                        <goals>\n+                            <goal>stage</goal>\n+                        </goals>\n+                        <configuration>\n+                            <directories>\n+                                <directory target=\"${project.build.directory}\">\n+                                    <archives>\n+                                        <archive target=\"cli-data/${project.version}/cli-data.zip\">\n+                                            <unpack-artifacts>\n+                                                <unpack-artifact groupId=\"io.helidon.archetypes\"\n+                                                                 artifactId=\"helidon-archetype-catalog\"\n+                                                                 version=\"${project.version}\"\n+                                                                 type=\"zip\"\n+                                                                 target=\".\"/>\n+                                            </unpack-artifacts>\n+                                            <templates>\n+                                                <template source=\"cli-metadata.properties.mustache\"\n+                                                          target=\"metadata.properties\">\n+                                                    <variables>\n+                                                        <variable name=\"buildtoolsVersion\"\n+                                                                  value=\"${build.tools.version}\"/>", "originalCommit": "23150818c2aba65e09631c5aee17f849665b21ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ5MjMxNQ==", "url": "https://github.com/oracle/helidon/pull/2137#discussion_r450492315", "bodyText": "cli.maven.plugin.version bothers me first because it doesn't following the normal naming convention version.plugin.* and second because there is no actual corresponding cli artifact; I didn't change it to better match the metadata property name. (Also, I still think we should be using this value when we generate from the archetypes, and then this name would be accurate.)\nBut I will change it just to make you happy ;-).", "author": "batsatt", "createdAt": "2020-07-06T21:35:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ3MTYyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ5MjQxMA==", "url": "https://github.com/oracle/helidon/pull/2137#discussion_r450492410", "bodyText": "", "author": "batsatt", "createdAt": "2020-07-06T21:35:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ3MTYyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAyOTM3OA==", "url": "https://github.com/oracle/helidon/pull/2137#discussion_r451029378", "bodyText": "My main issue with build-tools.version is that it's too generic. cli.maven.plugin.version does not follow the convention so you could use version.plugin.helidon.cli, or since as you point out there is no such maven artifact, you can use the existing property used to drive the helidon maven plugin: version.plugin.helidon-build-tools.", "author": "romain-grecourt", "createdAt": "2020-07-07T17:30:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ3MTYyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAzMjI3Ng==", "url": "https://github.com/oracle/helidon/pull/2137#discussion_r451032276", "bodyText": "The changes are already in to switch to cli.maven.plugin.version.", "author": "batsatt", "createdAt": "2020-07-07T17:35:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ3MTYyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA0NjAwNA==", "url": "https://github.com/oracle/helidon/pull/2137#discussion_r451046004", "bodyText": "Right, but as you noted there it does not follow the current convention and does not really point to a maven artifact.", "author": "romain-grecourt", "createdAt": "2020-07-07T17:59:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ3MTYyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE1MTIwOA==", "url": "https://github.com/oracle/helidon/pull/2137#discussion_r451151208", "bodyText": "We agreed on cli.build.tools.version and that change has been pushed.", "author": "batsatt", "createdAt": "2020-07-07T21:22:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ3MTYyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ3MjY3OA==", "url": "https://github.com/oracle/helidon/pull/2137#discussion_r450472678", "bodyText": "This is a continuation of my previous comment.\nI think it would be more explicit using cli.maven.plugin.version as the property name:\nmvn clean install -Dcli.maven.plugin.version=2.0.3-SNAPSHOT", "author": "romain-grecourt", "createdAt": "2020-07-06T20:50:26Z", "path": "archetypes/catalog/pom.xml", "diffHunk": "@@ -67,4 +67,95 @@\n             <optional>true</optional>\n         </dependency>\n     </dependencies>\n+\n+    <properties>\n+        <!-- support command-line overrides -->\n+        <build.tools.version>${version.plugin.helidon-build-tools}</build.tools.version>\n+    </properties>\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>io.helidon.build-tools</groupId>\n+                <artifactId>helidon-stager-maven-plugin</artifactId>\n+                <version>${version.plugin.helidon-build-tools}</version>\n+                <executions>\n+                    <execution>\n+                        <phase>install</phase>\n+                        <goals>\n+                            <goal>stage</goal>\n+                        </goals>\n+                        <configuration>\n+                            <directories>\n+                                <directory target=\"${project.build.directory}\">\n+                                    <archives>\n+                                        <archive target=\"cli-data/${project.version}/cli-data.zip\">\n+                                            <unpack-artifacts>\n+                                                <unpack-artifact groupId=\"io.helidon.archetypes\"\n+                                                                 artifactId=\"helidon-archetype-catalog\"\n+                                                                 version=\"${project.version}\"\n+                                                                 type=\"zip\"\n+                                                                 target=\".\"/>\n+                                            </unpack-artifacts>\n+                                            <templates>\n+                                                <template source=\"cli-metadata.properties.mustache\"\n+                                                          target=\"metadata.properties\">\n+                                                    <variables>\n+                                                        <variable name=\"buildtoolsVersion\"\n+                                                                  value=\"${build.tools.version}\"/>\n+                                                        <variable name=\"cliVersion\"\n+                                                                  value=\"${version.plugin.helidon-build-tools}\"/>\n+                                                    </variables>\n+                                                </template>\n+                                            </templates>\n+                                        </archive>\n+                                    </archives>\n+                                    <files>\n+                                        <file target=\"cli-data/latest\">${project.version}</file>\n+                                    </files>\n+                                </directory>\n+                            </directories>\n+                        </configuration>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>com.soebes.maven.plugins</groupId>\n+                <artifactId>echo-maven-plugin</artifactId>\n+                <version>0.4.0</version>\n+                <executions>\n+                    <execution>\n+                        <phase>install</phase>\n+                        <goals>\n+                            <goal>echo</goal>\n+                        </goals>\n+                    </execution>\n+                </executions>\n+                <configuration>\n+                    <echos>\n+                        <echo> |</echo>\n+                        <echo> |                      /')    </echo>\n+                        <echo> |               ////  /' )'   </echo>\n+                        <echo> |              @   \\/'  )'    </echo>\n+                        <echo> |  { note }   &lt; (  (_...)' </echo>\n+                        <echo> |               \\      )      </echo>\n+                        <echo> |                \\,,,,/       </echo>\n+                        <echo> |                 _|_         </echo>\n+                        <echo> |</echo>\n+                        <echo> |  You must add the following arguments to the CLI to use these snapshot archetypes:</echo>\n+                        <echo> |</echo>\n+                        <echo> |     --reset --url file://${project.build.directory}/cli-data</echo>\n+                        <echo> |</echo>\n+                        <echo> |  For example:</echo>\n+                        <echo> |</echo>\n+                        <echo> |     helidon init --batch --reset --url file://${project.build.directory}/cli-data</echo>\n+                        <echo> |</echo>\n+                        <echo> |  To use a build tools snapshot, specify the version when building this project, e.g.:</echo>\n+                        <echo> |</echo>\n+                        <echo> |     mvn clean install -Dbuild.tools.version=2.0.3-SNAPSHOT</echo>", "originalCommit": "23150818c2aba65e09631c5aee17f849665b21ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ3MjkwMA==", "url": "https://github.com/oracle/helidon/pull/2137#discussion_r450472900", "bodyText": "Not really a comment, but what's the ascii art ?", "author": "romain-grecourt", "createdAt": "2020-07-06T20:51:00Z", "path": "archetypes/catalog/pom.xml", "diffHunk": "@@ -67,4 +67,95 @@\n             <optional>true</optional>\n         </dependency>\n     </dependencies>\n+\n+    <properties>\n+        <!-- support command-line overrides -->\n+        <build.tools.version>${version.plugin.helidon-build-tools}</build.tools.version>\n+    </properties>\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>io.helidon.build-tools</groupId>\n+                <artifactId>helidon-stager-maven-plugin</artifactId>\n+                <version>${version.plugin.helidon-build-tools}</version>\n+                <executions>\n+                    <execution>\n+                        <phase>install</phase>\n+                        <goals>\n+                            <goal>stage</goal>\n+                        </goals>\n+                        <configuration>\n+                            <directories>\n+                                <directory target=\"${project.build.directory}\">\n+                                    <archives>\n+                                        <archive target=\"cli-data/${project.version}/cli-data.zip\">\n+                                            <unpack-artifacts>\n+                                                <unpack-artifact groupId=\"io.helidon.archetypes\"\n+                                                                 artifactId=\"helidon-archetype-catalog\"\n+                                                                 version=\"${project.version}\"\n+                                                                 type=\"zip\"\n+                                                                 target=\".\"/>\n+                                            </unpack-artifacts>\n+                                            <templates>\n+                                                <template source=\"cli-metadata.properties.mustache\"\n+                                                          target=\"metadata.properties\">\n+                                                    <variables>\n+                                                        <variable name=\"buildtoolsVersion\"\n+                                                                  value=\"${build.tools.version}\"/>\n+                                                        <variable name=\"cliVersion\"\n+                                                                  value=\"${version.plugin.helidon-build-tools}\"/>\n+                                                    </variables>\n+                                                </template>\n+                                            </templates>\n+                                        </archive>\n+                                    </archives>\n+                                    <files>\n+                                        <file target=\"cli-data/latest\">${project.version}</file>\n+                                    </files>\n+                                </directory>\n+                            </directories>\n+                        </configuration>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <plugin>\n+                <groupId>com.soebes.maven.plugins</groupId>\n+                <artifactId>echo-maven-plugin</artifactId>\n+                <version>0.4.0</version>\n+                <executions>\n+                    <execution>\n+                        <phase>install</phase>\n+                        <goals>\n+                            <goal>echo</goal>\n+                        </goals>\n+                    </execution>\n+                </executions>\n+                <configuration>\n+                    <echos>\n+                        <echo> |</echo>\n+                        <echo> |                      /')    </echo>", "originalCommit": "23150818c2aba65e09631c5aee17f849665b21ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ5MzAzMA==", "url": "https://github.com/oracle/helidon/pull/2137#discussion_r450493030", "bodyText": "see above", "author": "batsatt", "createdAt": "2020-07-06T21:36:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ3MjkwMA=="}], "type": "inlineReview"}, {"oid": "dd1f591f5ad59d96e1aaeae5fd978fa009e5aec5", "url": "https://github.com/oracle/helidon/commit/dd1f591f5ad59d96e1aaeae5fd978fa009e5aec5", "message": "Cleanup.", "committedDate": "2020-07-06T21:35:47Z", "type": "commit"}, {"oid": "7e4af03278ca929b8792fb68b50472869c710ac7", "url": "https://github.com/oracle/helidon/commit/7e4af03278ca929b8792fb68b50472869c710ac7", "message": "Merge branch 'master' into snapshot-cli-data", "committedDate": "2020-07-07T16:37:19Z", "type": "commit"}, {"oid": "ea2982a582d93592f70aabc862cd30f8343fb25c", "url": "https://github.com/oracle/helidon/commit/ea2982a582d93592f70aabc862cd30f8343fb25c", "message": "Add plugins to pluginManagement.", "committedDate": "2020-07-07T18:07:43Z", "type": "commit"}, {"oid": "6742c031533c9a55d88cc7780745c671e4dd48f2", "url": "https://github.com/oracle/helidon/commit/6742c031533c9a55d88cc7780745c671e4dd48f2", "message": "Tweak override property name.", "committedDate": "2020-07-07T21:21:19Z", "type": "commit"}]}