{"pr_number": 3298, "pr_title": "Wip/6.0 HHH 13756 Entity graph implementation", "pr_createdAt": "2020-03-12T20:55:36Z", "pr_url": "https://github.com/hibernate/hibernate-orm/pull/3298", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg4OTYzOQ==", "url": "https://github.com/hibernate/hibernate-orm/pull/3298#discussion_r391889639", "bodyText": "The boolean parameter to denote whether we are exploring 'keySubGraph' is important to disambiguate in entity graph implementing, so I changed Consumer to BiConsumer.", "author": "NathanQingyangXu", "createdAt": "2020-03-12T20:57:09Z", "path": "hibernate-core/src/main/java/org/hibernate/loader/ast/internal/LoaderSelectBuilder.java", "diffHunk": "@@ -366,36 +382,33 @@ private void applyOrdering(TableGroup tableGroup, PluralAttributeMapping pluralA\n \t\t}\n \t}\n \n-\tprivate void applyOrdering(\n-\t\t\tTableGroup tableGroup,\n-\t\t\tOrderByFragment orderByFragment) {\n+\tprivate void applyOrdering(TableGroup tableGroup, OrderByFragment orderByFragment) {\n \t\tif ( orderByFragments == null ) {\n \t\t\torderByFragments = new LinkedHashMap<>();\n \t\t}\n \t\torderByFragments.put( orderByFragment, tableGroup );\n \t}\n \n-\tprivate int fetchDepth = 0;\n-\n \tprivate List<Fetch> visitFetches(FetchParent fetchParent, QuerySpec querySpec, LoaderSqlAstCreationState creationState) {\n \t\tlog.tracef( \"Starting visitation of FetchParent's Fetchables : %s\", fetchParent.getNavigablePath() );\n \n \t\tfinal List<Fetch> fetches = new ArrayList<>();\n \n-\t\tfinal Consumer<Fetchable> processor = createFetchableConsumer( fetchParent, querySpec, creationState, fetches );\n+\t\tfinal BiConsumer<Fetchable, Boolean> processor = createFetchableBiConsumer( fetchParent, querySpec, creationState, fetches );\n \n \t\tfinal FetchableContainer referencedMappingContainer = fetchParent.getReferencedMappingContainer();\n-\t\treferencedMappingContainer.visitKeyFetchables( processor, null );\n-\t\treferencedMappingContainer.visitFetchables( processor, null );\n+\t\treferencedMappingContainer.visitKeyFetchables( fetchable -> processor.accept( fetchable, true ), null );\n+\t\treferencedMappingContainer.visitFetchables( fetchable -> processor.accept( fetchable, false ), null );", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg5MDI0MQ==", "url": "https://github.com/hibernate/hibernate-orm/pull/3298#discussion_r391890241", "bodyText": "I moved the field here for best practice. Also, it seems we don't need to set default value here.", "author": "NathanQingyangXu", "createdAt": "2020-03-12T20:58:34Z", "path": "hibernate-core/src/main/java/org/hibernate/query/sqm/sql/internal/StandardSqmSelectTranslator.java", "diffHunk": "@@ -86,7 +85,9 @@\n \t// prepare for 10 root selections to avoid list growth in most cases\n \tprivate final List<DomainResult> domainResults = CollectionHelper.arrayList( 10 );\n \n-\tprivate GraphImplementor<?> currentJpaGraphNode;\n+\tprivate final EntityGraphNavigator entityGraphNavigator;\n+\n+\tprivate int fetchDepth;", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "be251de56021176596c16b9a09af439fcc416cd8", "url": "https://github.com/hibernate/hibernate-orm/commit/be251de56021176596c16b9a09af439fcc416cd8", "message": "HHH-13756 implement entity graph in v6", "committedDate": "2020-03-18T15:08:32Z", "type": "commit"}, {"oid": "bd01841ebf1b32c0ce8e3b1d68cdc93c726a6802", "url": "https://github.com/hibernate/hibernate-orm/commit/bd01841ebf1b32c0ce8e3b1d68cdc93c726a6802", "message": "HHH-13756 rename 'NavigateResult' class name to 'Navigation'", "committedDate": "2020-03-18T15:08:32Z", "type": "commit"}, {"oid": "f30f0bf982d3d95a6f333c211ffe3ff170c8cdfa", "url": "https://github.com/hibernate/hibernate-orm/commit/f30f0bf982d3d95a6f333c211ffe3ff170c8cdfa", "message": "HHH-13756 add a hql testing skeleton", "committedDate": "2020-03-18T15:08:32Z", "type": "commit"}, {"oid": "d190b59a48a49b8d95bc20785868b30139035d69", "url": "https://github.com/hibernate/hibernate-orm/commit/d190b59a48a49b8d95bc20785868b30139035d69", "message": "HHH-13756 enrich hql testing class", "committedDate": "2020-03-18T15:08:32Z", "type": "commit"}, {"oid": "dcfd288522677f3012810cb4461ba9637a8c3a69", "url": "https://github.com/hibernate/hibernate-orm/commit/dcfd288522677f3012810cb4461ba9637a8c3a69", "message": "HHH-13756 fix some bug in EmbeddableFetchImpl", "committedDate": "2020-03-18T15:09:45Z", "type": "commit"}, {"oid": "c3fd948564e6ce2ebcded88d171e6c795f592bc6", "url": "https://github.com/hibernate/hibernate-orm/commit/c3fd948564e6ce2ebcded88d171e6c795f592bc6", "message": "HHH-13756 simplify EntityGraphNavigator's navigate() to never return null value", "committedDate": "2020-03-18T15:09:45Z", "type": "commit"}, {"oid": "df9a96fc0d48c066c7d4081897c5a19472823db6", "url": "https://github.com/hibernate/hibernate-orm/commit/df9a96fc0d48c066c7d4081897c5a19472823db6", "message": "finish both 'loader' and 'HQL' testing", "committedDate": "2020-03-18T15:09:45Z", "type": "commit"}, {"oid": "03fb438000b5842e7309622d6398e52d2646fba7", "url": "https://github.com/hibernate/hibernate-orm/commit/03fb438000b5842e7309622d6398e52d2646fba7", "message": "add 'Criteria' testing", "committedDate": "2020-03-18T15:09:45Z", "type": "commit"}, {"oid": "313f6a5ac3b45e51ea0d15c08a83d84872a179cd", "url": "https://github.com/hibernate/hibernate-orm/commit/313f6a5ac3b45e51ea0d15c08a83d84872a179cd", "message": "make use of JUnit5's ParameterizedTest to avoid some testing code duplication", "committedDate": "2020-03-18T15:09:45Z", "type": "commit"}, {"oid": "411fc2d71e752df9b7dd81539040014561f7fcdf", "url": "https://github.com/hibernate/hibernate-orm/commit/411fc2d71e752df9b7dd81539040014561f7fcdf", "message": "HHH-13756 renaming and internal implementation tweaking", "committedDate": "2020-03-18T15:09:46Z", "type": "commit"}, {"oid": "411fc2d71e752df9b7dd81539040014561f7fcdf", "url": "https://github.com/hibernate/hibernate-orm/commit/411fc2d71e752df9b7dd81539040014561f7fcdf", "message": "HHH-13756 renaming and internal implementation tweaking", "committedDate": "2020-03-18T15:09:46Z", "type": "forcePushed"}]}