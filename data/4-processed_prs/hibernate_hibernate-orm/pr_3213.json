{"pr_number": 3213, "pr_title": "Binary literals", "pr_createdAt": "2020-02-02T03:11:59Z", "pr_url": "https://github.com/hibernate/hibernate-orm/pull/3213", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgxNTg2NA==", "url": "https://github.com/hibernate/hibernate-orm/pull/3213#discussion_r373815864", "bodyText": "This old code wasn't consistent with how JDBC drivers handle the conversion from unsigned to signed bytes.", "author": "gavinking", "createdAt": "2020-02-02T03:13:10Z", "path": "hibernate-core/src/main/java/org/hibernate/type/descriptor/java/ByteArrayTypeDescriptor.java", "diffHunk": "@@ -67,7 +67,7 @@ public String toString(Byte[] bytes) {\n \t\tByte[] bytes = new Byte[string.length() / 2];\n \t\tfor ( int i = 0; i < bytes.length; i++ ) {\n \t\t\tfinal String hexStr = string.substring( i * 2, (i + 1) * 2 );\n-\t\t\tbytes[i] = (byte) ( Integer.parseInt( hexStr, 16 ) + Byte.MIN_VALUE );\n+\t\t\tbytes[i] = (byte) Integer.parseInt( hexStr, 16 );", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgxNTg3OQ==", "url": "https://github.com/hibernate/hibernate-orm/pull/3213#discussion_r373815879", "bodyText": "This old code wasn't consistent with how JDBC drivers handle the conversion from unsigned to signed bytes.", "author": "gavinking", "createdAt": "2020-02-02T03:13:37Z", "path": "hibernate-core/src/main/java/org/hibernate/type/descriptor/java/PrimitiveByteArrayTypeDescriptor.java", "diffHunk": "@@ -73,7 +73,7 @@ public String extractLoggableRepresentation(byte[] value) {\n \t\tbyte[] bytes = new byte[string.length() / 2];\n \t\tfor ( int i = 0; i < bytes.length; i++ ) {\n \t\t\tfinal String hexStr = string.substring( i * 2, (i + 1) * 2 );\n-\t\t\tbytes[i] = (byte) (Integer.parseInt(hexStr, 16) + Byte.MIN_VALUE);\n+\t\t\tbytes[i] = (byte) Integer.parseInt( hexStr, 16 );", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgxNTkxNg==", "url": "https://github.com/hibernate/hibernate-orm/pull/3213#discussion_r373815916", "bodyText": "I think this is the best thing to do on PostgreSQL, though I'm not 100% certain.", "author": "gavinking", "createdAt": "2020-02-02T03:14:32Z", "path": "hibernate-core/src/main/java/org/hibernate/dialect/PostgreSQLDialect.java", "diffHunk": "@@ -691,6 +691,11 @@ public String translateExtractField(TemporalUnit unit) {\n \t\t}\n \t}\n \n+\t@Override\n+\tpublic String formatBinaryliteral(byte[] bytes) {\n+\t\treturn \"bytea '\\\\x\" + StandardBasicTypes.BINARY.toString( bytes ) + \"'\";", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTI2NzcwMg==", "url": "https://github.com/hibernate/hibernate-orm/pull/3213#discussion_r375267702", "bodyText": "Can we use BINARY_LITERAL instead?  It's 3 extra characters and so much more immediately understandable.", "author": "sebersole", "createdAt": "2020-02-05T13:55:28Z", "path": "hibernate-core/src/main/antlr/org/hibernate/grammars/hql/HqlLexer.g4", "diffHunk": "@@ -93,6 +93,10 @@ UNICODE_ESCAPE\n \t: 'u' HEX_DIGIT HEX_DIGIT HEX_DIGIT HEX_DIGIT\n \t;\n \n+BIN_LITERAL", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTI4NDM5NQ==", "url": "https://github.com/hibernate/hibernate-orm/pull/3213#discussion_r375284395", "bodyText": "Sure.", "author": "gavinking", "createdAt": "2020-02-05T14:24:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTI2NzcwMg=="}], "type": "inlineReview"}, {"oid": "470cbc488b07ce6b5678c64c5c7f8ea0ae8ba521", "url": "https://github.com/hibernate/hibernate-orm/commit/470cbc488b07ce6b5678c64c5c7f8ea0ae8ba521", "message": "Add hexadecimal binary literals with standard SQL syntax\n\nAnd fix up the parsing and formatting in VarbinaryTypeDescriptor which\nwas inconsistent with how the JDBC drivers handle the conversion to\nsigned bytes.", "committedDate": "2020-02-05T14:34:30Z", "type": "commit"}, {"oid": "470cbc488b07ce6b5678c64c5c7f8ea0ae8ba521", "url": "https://github.com/hibernate/hibernate-orm/commit/470cbc488b07ce6b5678c64c5c7f8ea0ae8ba521", "message": "Add hexadecimal binary literals with standard SQL syntax\n\nAnd fix up the parsing and formatting in VarbinaryTypeDescriptor which\nwas inconsistent with how the JDBC drivers handle the conversion to\nsigned bytes.", "committedDate": "2020-02-05T14:34:30Z", "type": "forcePushed"}, {"oid": "3376468cec2b12060d48705bc4cf49f4cb4826e6", "url": "https://github.com/hibernate/hibernate-orm/commit/3376468cec2b12060d48705bc4cf49f4cb4826e6", "message": "Allow binary literals to be specified in a Java byte-array-like format\n\nAllow you to write x'DEADBEEF' as {0xDE, 0xAD, 0xBE, 0xEF}.\n\nFor now I'm being quite restrictive here:\n\n- byte literals must be written in hexadecimal not in decimal\n- they must be exactly two digits in length\n\n(I would like to allow decimal format but I think that would start to\ncollide with other rules with braces in the grammar.)", "committedDate": "2020-02-05T15:04:53Z", "type": "commit"}]}