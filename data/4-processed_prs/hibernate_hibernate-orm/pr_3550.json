{"pr_number": 3550, "pr_title": "HHH-14201 fixup", "pr_createdAt": "2020-09-14T12:38:04Z", "pr_url": "https://github.com/hibernate/hibernate-orm/pull/3550", "timeline": [{"oid": "31117153d1801bca13674e03f1be2745d37d60db", "url": "https://github.com/hibernate/hibernate-orm/commit/31117153d1801bca13674e03f1be2745d37d60db", "message": "HHH-14148 Fix ANTLR grammar non-determinism", "committedDate": "2020-09-14T10:35:33Z", "type": "commit"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkxMTA5Nw==", "url": "https://github.com/hibernate/hibernate-orm/pull/3550#discussion_r487911097", "bodyText": "I might be wrong. It seems the SQL_TOKEN usually implies null ordDir and ordNul. Also, you might need to update the comment as well.", "author": "NathanQingyangXu", "createdAt": "2020-09-14T13:27:28Z", "path": "hibernate-core/src/main/antlr/sql-gen.g", "diffHunk": "@@ -191,18 +191,15 @@ whereClauseExpr\n \t| booleanExpr[ false ]\n \t;\n \n-orderBySqlFragmentOrExprs\n-\t: sqlToken // for the purpose of mapping-defined orderBy SQL fragment\n-\t| orderExprs\n-\t;\n-\n orderExprs { String ordExp = null; String ordDir = null; String ordNul = null; }\n \t// TODO: remove goofy space before the comma when we don't have to regression test anymore.\n \t// Dialect is provided a hook to render each ORDER BY element, so the expression is being captured instead of\n \t// printing to the SQL output directly. See Dialect#renderOrderByElement(String, String, String, NullPrecedence).\n-\t: { captureExpressionStart(); } ( expr ) { captureExpressionFinish(); ordExp = resetCapture(); }\n+\t: { captureExpressionStart(); } ( e:expr ) { captureExpressionFinish(); ordExp = resetCapture(); }\n \t    (dir:orderDirection { ordDir = #dir.getText(); })? (ordNul=nullOrdering)?\n-\t        { out( renderOrderByElement( ordExp, ordDir, ordNul ) ); }\n+\t    // SQL Tokens without a direction and null ordering can be passed through as-is.\n+\t    // These tokens could be mapping defined order by fragments which are already rendered via the dialect hook\n+\t        { out( #e.getType() == SQL_TOKEN && ordDir == null && ordNul == null ? ordExp : renderOrderByElement( ordExp, ordDir, ordNul ) ); }", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkxOTg4Mg==", "url": "https://github.com/hibernate/hibernate-orm/pull/3550#discussion_r487919882", "bodyText": "You are right! Thanks for the hint", "author": "beikov", "createdAt": "2020-09-14T13:36:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkxMTA5Nw=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk0MDYzNw==", "url": "https://github.com/hibernate/hibernate-orm/pull/3550#discussion_r487940637", "bodyText": "so the above comment only applies in HQL. Now we allow for another possibility that \"printing to the SQL output directly\". We need to add more explanation to the comment above, for it is not accurate any more.", "author": "NathanQingyangXu", "createdAt": "2020-09-14T13:56:08Z", "path": "hibernate-core/src/main/antlr/sql-gen.g", "diffHunk": "@@ -191,18 +191,15 @@ whereClauseExpr\n \t| booleanExpr[ false ]\n \t;\n \n-orderBySqlFragmentOrExprs\n-\t: sqlToken // for the purpose of mapping-defined orderBy SQL fragment\n-\t| orderExprs\n-\t;\n-\n orderExprs { String ordExp = null; String ordDir = null; String ordNul = null; }\n \t// TODO: remove goofy space before the comma when we don't have to regression test anymore.\n \t// Dialect is provided a hook to render each ORDER BY element, so the expression is being captured instead of\n \t// printing to the SQL output directly. See Dialect#renderOrderByElement(String, String, String, NullPrecedence).", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6e337b60ef70e30ab50ef615651b88bca331e595", "url": "https://github.com/hibernate/hibernate-orm/commit/6e337b60ef70e30ab50ef615651b88bca331e595", "message": "HHH-14201 Fix test issues of NaturalIdDereferenceTest", "committedDate": "2020-09-14T14:12:14Z", "type": "commit"}, {"oid": "6e337b60ef70e30ab50ef615651b88bca331e595", "url": "https://github.com/hibernate/hibernate-orm/commit/6e337b60ef70e30ab50ef615651b88bca331e595", "message": "HHH-14201 Fix test issues of NaturalIdDereferenceTest", "committedDate": "2020-09-14T14:12:14Z", "type": "forcePushed"}]}