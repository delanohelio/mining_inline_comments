{"pr_number": 3457, "pr_title": "HHH 13214 DML batch delete re-firing SQL from previous calls", "pr_createdAt": "2020-07-09T12:40:56Z", "pr_url": "https://github.com/hibernate/hibernate-orm/pull/3457", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQyNzI2Mg==", "url": "https://github.com/hibernate/hibernate-orm/pull/3457#discussion_r452427262", "bodyText": "Do we allow the returned value to be mutable? If not, returning Collections.emptyList() would be more efficient and less confusing. The same suggestion applies for the later empty collection returned. Minor compared to the issue solved in this PR.", "author": "NathanQingyangXu", "createdAt": "2020-07-09T19:00:12Z", "path": "hibernate-core/src/main/java/org/hibernate/hql/spi/id/inline/AbstractInlineIdsDeleteHandlerImpl.java", "diffHunk": "@@ -42,6 +43,9 @@ public AbstractInlineIdsDeleteHandlerImpl(\n \n \t@Override\n \tpublic String[] getSqlStatements() {\n+\t\tif ( deletes.isEmpty() ) {\n+\t\t\treturn new String[0];", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3ODk4Nw==", "url": "https://github.com/hibernate/hibernate-orm/pull/3457#discussion_r453178987", "bodyText": "we method return type is an array", "author": "dreab8", "createdAt": "2020-07-11T09:59:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQyNzI2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE5NjEwNQ==", "url": "https://github.com/hibernate/hibernate-orm/pull/3457#discussion_r453196105", "bodyText": "my fault. we might use ArrayHelper.EMPTY_STRING_ARRAY, though not a big deal.", "author": "NathanQingyangXu", "createdAt": "2020-07-11T13:39:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQyNzI2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwMjc2OA==", "url": "https://github.com/hibernate/hibernate-orm/pull/3457#discussion_r453202768", "bodyText": "done and thanks a lot for the review :)", "author": "dreab8", "createdAt": "2020-07-11T14:56:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQyNzI2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQxOTM3OQ==", "url": "https://github.com/hibernate/hibernate-orm/pull/3457#discussion_r454419379", "bodyText": "If we're nitpickin for optimisations, I might add that it's even faster to remove the if check  ;)", "author": "Sanne", "createdAt": "2020-07-14T14:55:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQyNzI2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQyMDUxMg==", "url": "https://github.com/hibernate/hibernate-orm/pull/3457#discussion_r454420512", "bodyText": "I'm joking, but let me clarify why: it's because I would not expect the deleted list to ever be empty, so the check is redundant.", "author": "Sanne", "createdAt": "2020-07-14T14:57:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQyNzI2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQyOTY4Mg==", "url": "https://github.com/hibernate/hibernate-orm/pull/3457#discussion_r452429682", "bodyText": "Is there possibility that deletes is null here? Then a NPE would be thrown.", "author": "NathanQingyangXu", "createdAt": "2020-07-09T19:04:59Z", "path": "hibernate-core/src/main/java/org/hibernate/hql/spi/id/inline/AbstractInlineIdsDeleteHandlerImpl.java", "diffHunk": "@@ -42,6 +43,9 @@ public AbstractInlineIdsDeleteHandlerImpl(\n \n \t@Override\n \tpublic String[] getSqlStatements() {\n+\t\tif ( deletes.isEmpty() ) {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3ODgyMA==", "url": "https://github.com/hibernate/hibernate-orm/pull/3457#discussion_r453178820", "bodyText": "solved thanks @NathanQingyangXu", "author": "dreab8", "createdAt": "2020-07-11T09:56:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQyOTY4Mg=="}], "type": "inlineReview"}, {"oid": "6f7ca34a30236d37f25492a9e448bd68640a7ea8", "url": "https://github.com/hibernate/hibernate-orm/commit/6f7ca34a30236d37f25492a9e448bd68640a7ea8", "message": "HHH-13214 Delete re-firing SQL from previous calls", "committedDate": "2020-07-11T09:53:44Z", "type": "commit"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "d54f93d3cdd1866fb89b2032daeccf94743fe6b9", "url": "https://github.com/hibernate/hibernate-orm/commit/d54f93d3cdd1866fb89b2032daeccf94743fe6b9", "message": "HHH-13214 Delete re-firing SQL from previous calls", "committedDate": "2020-07-11T14:55:43Z", "type": "commit"}, {"oid": "d54f93d3cdd1866fb89b2032daeccf94743fe6b9", "url": "https://github.com/hibernate/hibernate-orm/commit/d54f93d3cdd1866fb89b2032daeccf94743fe6b9", "message": "HHH-13214 Delete re-firing SQL from previous calls", "committedDate": "2020-07-11T14:55:43Z", "type": "forcePushed"}]}