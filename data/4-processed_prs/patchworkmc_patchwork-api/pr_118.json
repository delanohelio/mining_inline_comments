{"pr_number": 118, "pr_title": "Impl PlayerChangedDimensionEvent, PlayerRespawnEvent and PlayerLoggedOutEvent", "pr_createdAt": "2020-07-10T19:11:28Z", "pr_url": "https://github.com/PatchworkMC/patchwork-api/pull/118", "timeline": [{"oid": "b8e2552547a0b9caf18412e9ecc044b5fa9a4bd9", "url": "https://github.com/PatchworkMC/patchwork-api/commit/b8e2552547a0b9caf18412e9ecc044b5fa9a4bd9", "message": "Impl PlayerChangedDimensionEvent, PlayerRespawnEvent and\nPlayerLoggedOutEvent", "committedDate": "2020-07-10T19:10:50Z", "type": "commit"}, {"oid": "17f948820f4271ef207fe4c80684b81f4b013add", "url": "https://github.com/PatchworkMC/patchwork-api/commit/17f948820f4271ef207fe4c80684b81f4b013add", "message": "Impl ItemPickupEvent, ItemCraftedEvent, ItemSmeltedEvent in PlayerEvent", "committedDate": "2020-07-10T19:55:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY0NDYzOQ==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/118#discussion_r456644639", "bodyText": "This indentation seems a bit odd, but I'm guessing it's correct based on checkstyle passing...", "author": "leo60228", "createdAt": "2020-07-17T19:52:49Z", "path": "patchwork-events-entity/src/main/java/net/patchworkmc/mixin/event/entity/MixinCraftingResultSlot.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Minecraft Forge, Patchwork Project\n+ * Copyright (c) 2016-2020, 2019-2020\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.patchworkmc.mixin.event.entity;\n+\n+import org.spongepowered.asm.mixin.Final;\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+import org.spongepowered.asm.mixin.injection.At.Shift;\n+\n+import net.minecraft.container.CraftingResultSlot;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.inventory.CraftingInventory;\n+import net.minecraft.item.ItemStack;\n+\n+import net.patchworkmc.impl.event.entity.PlayerEvents;\n+\n+@Mixin(CraftingResultSlot.class)\n+public abstract class MixinCraftingResultSlot {\n+\t@Shadow\n+\t@Final\n+\tprivate PlayerEntity player;\n+\n+\t@Shadow\n+\t@Final\n+\tprivate CraftingInventory craftingInv;\n+\n+\t@Inject(method = \"onCrafted(Lnet/minecraft/item/ItemStack;)V\",\n+\t\t\tat = @At(\n+\t\t\t\t\tvalue = \"INVOKE\",\n+\t\t\t\t\tshift = Shift.AFTER,\n+\t\t\t\t\tordinal = 0,\n+\t\t\t\t\ttarget = \"net/minecraft/item/ItemStack.onCraft(Lnet/minecraft/world/World;Lnet/minecraft/entity/player/PlayerEntity;I)V\"\n+\t\t\t\t\t)", "originalCommit": "17f948820f4271ef207fe4c80684b81f4b013add", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc1ODYyNA==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/118#discussion_r456758624", "bodyText": "I dont want to squash tooo much thing on a single line, this may be easier to read and understand", "author": "rikka0w0", "createdAt": "2020-07-18T06:54:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY0NDYzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc2NDU0MA==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/118#discussion_r456764540", "bodyText": "i think what leo is getting at is that the indentation is a bit inconsistent, specifically the closing brace that was selected for this comment. i.e. I'd probably write it as either:\n    @Inject(\n        method = \"onCrafted(Lnet/minecraft/item/ItemStack;)V\",\n\t\tat = @At(\n\t\t\tvalue = \"INVOKE\",\n\t\t\tshift = Shift.AFTER,\n\t\t\tordinal = 0,\n\t\t\ttarget = \"net/minecraft/item/ItemStack.onCraft(Lnet/minecraft/world/World;Lnet/minecraft/entity/player/PlayerEntity;I)V\"\n\t\t)\n    )\nor:\n    @Inject(method = \"onCrafted(Lnet/minecraft/item/ItemStack;)V\", at = @At(\n\t\tvalue = \"INVOKE\",\n\t\tshift = Shift.AFTER,\n\t\tordinal = 0,\n\t\ttarget = \"net/minecraft/item/ItemStack.onCraft(Lnet/minecraft/world/World;Lnet/minecraft/entity/player/PlayerEntity;I)V\"\n\t))", "author": "kitlith", "createdAt": "2020-07-18T08:12:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY0NDYzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY0NDg4Mw==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/118#discussion_r456644883", "bodyText": "This method name is a bit strange. Maybe onStackCrafted?", "author": "leo60228", "createdAt": "2020-07-17T19:53:26Z", "path": "patchwork-events-entity/src/main/java/net/patchworkmc/mixin/event/entity/MixinCraftingResultSlot.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Minecraft Forge, Patchwork Project\n+ * Copyright (c) 2016-2020, 2019-2020\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.patchworkmc.mixin.event.entity;\n+\n+import org.spongepowered.asm.mixin.Final;\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+import org.spongepowered.asm.mixin.injection.At.Shift;\n+\n+import net.minecraft.container.CraftingResultSlot;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.inventory.CraftingInventory;\n+import net.minecraft.item.ItemStack;\n+\n+import net.patchworkmc.impl.event.entity.PlayerEvents;\n+\n+@Mixin(CraftingResultSlot.class)\n+public abstract class MixinCraftingResultSlot {\n+\t@Shadow\n+\t@Final\n+\tprivate PlayerEntity player;\n+\n+\t@Shadow\n+\t@Final\n+\tprivate CraftingInventory craftingInv;\n+\n+\t@Inject(method = \"onCrafted(Lnet/minecraft/item/ItemStack;)V\",\n+\t\t\tat = @At(\n+\t\t\t\t\tvalue = \"INVOKE\",\n+\t\t\t\t\tshift = Shift.AFTER,\n+\t\t\t\t\tordinal = 0,\n+\t\t\t\t\ttarget = \"net/minecraft/item/ItemStack.onCraft(Lnet/minecraft/world/World;Lnet/minecraft/entity/player/PlayerEntity;I)V\"\n+\t\t\t\t\t)\n+\t)\n+\tprivate void onCrafted_stack_onCraft(ItemStack stack, CallbackInfo ci) {", "originalCommit": "17f948820f4271ef207fe4c80684b81f4b013add", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY0NTQ1OQ==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/118#discussion_r456645459", "bodyText": "See above, maybe onCraftingFinished?", "author": "leo60228", "createdAt": "2020-07-17T19:54:49Z", "path": "patchwork-events-entity/src/main/java/net/patchworkmc/mixin/event/entity/MixinFurnaceOutputSlot.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Minecraft Forge, Patchwork Project\n+ * Copyright (c) 2016-2020, 2019-2020\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.patchworkmc.mixin.event.entity;\n+\n+import org.spongepowered.asm.mixin.Final;\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+\n+import net.minecraft.container.FurnaceOutputSlot;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.item.ItemStack;\n+\n+import net.patchworkmc.impl.event.entity.PlayerEvents;\n+\n+@Mixin(FurnaceOutputSlot.class)\n+public abstract class MixinFurnaceOutputSlot {\n+\t@Shadow\n+\t@Final\n+\tprivate PlayerEntity player;\n+\n+\t@Inject(method = \"onCrafted(Lnet/minecraft/item/ItemStack;)V\",\n+\t\t\tat = @At(\"RETURN\")\n+\t)\n+\tprivate void onCrafted_return(ItemStack stack, CallbackInfo ci) {", "originalCommit": "17f948820f4271ef207fe4c80684b81f4b013add", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY0NTY1OA==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/118#discussion_r456645658", "bodyText": "This indentation is really weird...", "author": "leo60228", "createdAt": "2020-07-17T19:55:11Z", "path": "patchwork-events-entity/src/main/java/net/patchworkmc/mixin/event/entity/MixinItemEntity.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Minecraft Forge, Patchwork Project\n+ * Copyright (c) 2016-2020, 2019-2020\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.patchworkmc.mixin.event.entity;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+import org.spongepowered.asm.mixin.injection.At.Shift;\n+\n+import net.minecraft.entity.ItemEntity;\n+import net.minecraft.entity.player.PlayerEntity;\n+\n+import net.patchworkmc.impl.event.entity.PlayerEvents;\n+\n+@Mixin(ItemEntity.class)\n+public abstract class MixinItemEntity {\n+\t@Inject(method = \"onPlayerCollision\",\n+\t\t\tat = @At(\n+\t\t\t\t\tvalue = \"INVOKE\",", "originalCommit": "17f948820f4271ef207fe4c80684b81f4b013add", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIwMjI2MQ==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/118#discussion_r458202261", "bodyText": "() is treated as {}, it took some effort to pass the style check /w\\", "author": "rikka0w0", "createdAt": "2020-07-21T15:48:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY0NTY1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY0NjA5MQ==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/118#discussion_r456646091", "bodyText": "See above, don't have a great idea for this one though. If using underscores is just the style for this kind of inject it's reasonable enough, though it's not very descriptive about what exactly it's doing.", "author": "leo60228", "createdAt": "2020-07-17T19:56:15Z", "path": "patchwork-events-entity/src/main/java/net/patchworkmc/mixin/event/entity/MixinItemEntity.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Minecraft Forge, Patchwork Project\n+ * Copyright (c) 2016-2020, 2019-2020\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.patchworkmc.mixin.event.entity;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+import org.spongepowered.asm.mixin.injection.At.Shift;\n+\n+import net.minecraft.entity.ItemEntity;\n+import net.minecraft.entity.player.PlayerEntity;\n+\n+import net.patchworkmc.impl.event.entity.PlayerEvents;\n+\n+@Mixin(ItemEntity.class)\n+public abstract class MixinItemEntity {\n+\t@Inject(method = \"onPlayerCollision\",\n+\t\t\tat = @At(\n+\t\t\t\t\tvalue = \"INVOKE\",\n+\t\t\t\t\tshift = Shift.BEFORE,\n+\t\t\t\t\tordinal = 0,\n+\t\t\t\t\ttarget = \"net/minecraft/item/ItemStack.isEmpty()Z\"\n+\t\t\t\t\t)\n+\t)\n+\tprivate void onPlayerCollision_isEmpty(PlayerEntity player, CallbackInfo ci) {", "originalCommit": "17f948820f4271ef207fe4c80684b81f4b013add", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY0NjQxNQ==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/118#discussion_r456646415", "bodyText": "Does this need to be a thread local?", "author": "leo60228", "createdAt": "2020-07-17T19:56:55Z", "path": "patchwork-events-entity/src/main/java/net/patchworkmc/mixin/event/entity/MixinServerPlayerEntity.java", "diffHunk": "@@ -49,4 +58,52 @@ private void hookCopyFromForCloneEvent(ServerPlayerEntity oldPlayer, boolean ali\n \t\tServerPlayerEntity speThis = (ServerPlayerEntity) (Object) this;\n \t\tMinecraftForge.EVENT_BUS.post(new PlayerEvent.Clone(speThis, oldPlayer, !alive));\n \t}\n+\n+\t////////////////////////////////////\n+\t// PlayerChangedDimensionEvent\n+\t////////////////////////////////////\n+\t@Inject(method = \"teleport\",\n+\t\t\tat = @At(\n+\t\t\t\t\tvalue = \"INVOKE\",\n+\t\t\t\t\tshift = Shift.AFTER,\n+\t\t\t\t\tordinal = 0,\n+\t\t\t\t\ttarget = \"net/minecraft/server/PlayerManager.method_14594(Lnet/minecraft/server/network/ServerPlayerEntity;)V\"\n+\t\t\t\t\t),\n+\t\t\tlocals = LocalCapture.CAPTURE_FAILHARD\n+\t) // PlayerManager.method_14594 -> sendInventory\n+\tprivate void teleport_sendInventory(ServerWorld targetWorld, double x, double y, double z, float yaw, float pitch, CallbackInfo info, ServerWorld serverWorld, LevelProperties levelProperties) {\n+\t\tServerPlayerEntity me = (ServerPlayerEntity) (Object) this;\n+\t\tPlayerEvents.firePlayerChangedDimensionEvent(me, serverWorld.dimension.getType(), me.dimension);\n+\t}\n+\n+\t@Unique\n+\tprivate static final ThreadLocal<DimensionType> changeDimension_from = new ThreadLocal<>();", "originalCommit": "17f948820f4271ef207fe4c80684b81f4b013add", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY1OTUyOQ==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/118#discussion_r456659529", "bodyText": "In case the same method is called at the same time on different threads, especially since it's being stored as a static variable instead of a variable on the class itself, i believe.", "author": "kitlith", "createdAt": "2020-07-17T20:28:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY0NjQxNQ=="}], "type": "inlineReview"}, {"oid": "757a8d17f1ac9b3f86eb4d7acdf76eaf80fdedbf", "url": "https://github.com/PatchworkMC/patchwork-api/commit/757a8d17f1ac9b3f86eb4d7acdf76eaf80fdedbf", "message": "Merge remote-tracking branch 'origin/master' into feature/playerevent\n\nConflicts:\n\tpatchwork-events-entity/src/main/java/net/patchworkmc/impl/event/entity/EntityEvents.java", "committedDate": "2020-07-22T13:41:46Z", "type": "commit"}, {"oid": "8241ab25288811009d812151fe84e6577793d025", "url": "https://github.com/PatchworkMC/patchwork-api/commit/8241ab25288811009d812151fe84e6577793d025", "message": "Add methods to the god class", "committedDate": "2020-07-22T13:55:20Z", "type": "commit"}, {"oid": "1941e941b6006b933cd4c47a0c39a4c898c5d5cb", "url": "https://github.com/PatchworkMC/patchwork-api/commit/1941e941b6006b933cd4c47a0c39a4c898c5d5cb", "message": "Apply leo60228's suggestion", "committedDate": "2020-07-29T08:31:56Z", "type": "commit"}]}