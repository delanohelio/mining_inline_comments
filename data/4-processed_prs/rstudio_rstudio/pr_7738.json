{"pr_number": 7738, "pr_title": "implement simple selection-based transformations for visual mode", "pr_createdAt": "2020-09-04T22:27:02Z", "pr_url": "https://github.com/rstudio/rstudio/pull/7738", "timeline": [{"oid": "e5ec48ed4db1d3d10fccbfc50f41009621b0956f", "url": "https://github.com/rstudio/rstudio/commit/e5ec48ed4db1d3d10fccbfc50f41009621b0956f", "message": "scaffolding for rstudio api requests / responses", "committedDate": "2020-09-03T23:09:28Z", "type": "commit"}, {"oid": "2182d81a9a0b4e56d7d3522ad1e5bb7dda5dcad3", "url": "https://github.com/rstudio/rstudio/commit/2182d81a9a0b4e56d7d3522ad1e5bb7dda5dcad3", "message": "wired through API for getting selection", "committedDate": "2020-09-04T00:27:22Z", "type": "commit"}, {"oid": "a3a6b44b3564a52caf1ae1f3bec7d503a9c676d0", "url": "https://github.com/rstudio/rstudio/commit/a3a6b44b3564a52caf1ae1f3bec7d503a9c676d0", "message": "implement selection setter", "committedDate": "2020-09-04T21:29:02Z", "type": "commit"}, {"oid": "f64fdb592bc24eafe3f7cf03e98661c7c9913420", "url": "https://github.com/rstudio/rstudio/commit/f64fdb592bc24eafe3f7cf03e98661c7c9913420", "message": "preserve previous selection if any", "committedDate": "2020-09-04T21:55:38Z", "type": "commit"}, {"oid": "ab95e44a2ac617b2ab8b0c48c94bc76f31086388", "url": "https://github.com/rstudio/rstudio/commit/ab95e44a2ac617b2ab8b0c48c94bc76f31086388", "message": "tweaks", "committedDate": "2020-09-04T21:57:40Z", "type": "commit"}, {"oid": "4f94e96361410de5251fd6bffaa3ead5ff1f1d96", "url": "https://github.com/rstudio/rstudio/commit/4f94e96361410de5251fd6bffaa3ead5ff1f1d96", "message": "allow 'insertText' API to work as-is when no range set", "committedDate": "2020-09-04T22:01:18Z", "type": "commit"}, {"oid": "aa844f5b8c4855fecd73d726ef972690a2cba2d6", "url": "https://github.com/rstudio/rstudio/commit/aa844f5b8c4855fecd73d726ef972690a2cba2d6", "message": "wire through document id in APIs", "committedDate": "2020-09-04T22:26:48Z", "type": "commit"}, {"oid": "2f21f621d83233184052d6c6aa56ba4e743af1bc", "url": "https://github.com/rstudio/rstudio/commit/2f21f621d83233184052d6c6aa56ba4e743af1bc", "message": "ensure session always receives response", "committedDate": "2020-09-04T22:31:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk1OTYyMw==", "url": "https://github.com/rstudio/rstudio/pull/7738#discussion_r483959623", "bodyText": "In order to preserve the selection's marks here you want to do this:\nconst tr = this.view.state.tr;\nconst selectionMarks = tr.selection.$from.marks();\ntr.replaceSelectionWith(state.schema.text(value, selectionMarks), false);\nthis.view.dispatch(tr);", "author": "jjallaire", "createdAt": "2020-09-05T15:13:26Z", "path": "src/gwt/panmirror/src/editor/src/editor/editor.ts", "diffHunk": "@@ -627,6 +627,33 @@ export class Editor {\n     return this.getMarkdownCode(tr, options);\n   }\n \n+  public getSelectedText(): string {\n+    \n+    return this.state.doc.textBetween(\n+      this.state.selection.from,\n+      this.state.selection.to\n+    );\n+\n+  }\n+\n+  public replaceSelection(value: string): void {\n+\n+    // retrieve properties we need from selection\n+    let {from, empty} = this.view.state.selection;\n+\n+    // insert text", "originalCommit": "2f21f621d83233184052d6c6aa56ba4e743af1bc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2c1e248bdf8303629f8248fa22cfc88b7dd374bb", "url": "https://github.com/rstudio/rstudio/commit/2c1e248bdf8303629f8248fa22cfc88b7dd374bb", "message": "tidying up", "committedDate": "2020-09-07T15:46:06Z", "type": "commit"}, {"oid": "cbba1c0556a51cdd16b66149a137b782bd51a5a9", "url": "https://github.com/rstudio/rstudio/commit/cbba1c0556a51cdd16b66149a137b782bd51a5a9", "message": "preserve marks", "committedDate": "2020-09-08T16:49:20Z", "type": "commit"}, {"oid": "6f681a5071ae78e012bad63c9b5251d19c3f99a8", "url": "https://github.com/rstudio/rstudio/commit/6f681a5071ae78e012bad63c9b5251d19c3f99a8", "message": "Merge branch 'master' into feature/visual-mode-rstudioapi-selection-apis", "committedDate": "2020-09-08T19:43:38Z", "type": "commit"}]}