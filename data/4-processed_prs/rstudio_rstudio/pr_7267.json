{"pr_number": 7267, "pr_title": "Parallelize Windows Builds", "pr_createdAt": "2020-07-03T01:09:47Z", "pr_url": "https://github.com/rstudio/rstudio/pull/7267", "timeline": [{"oid": "565520edce116da83e7b7ebe0dc53bc73cb96126", "url": "https://github.com/rstudio/rstudio/commit/565520edce116da83e7b7ebe0dc53bc73cb96126", "message": "install ninja in the windows docker container", "committedDate": "2020-07-02T20:02:19Z", "type": "commit"}, {"oid": "41a7975ef3e008cf0569537951d50cf2bad93d35", "url": "https://github.com/rstudio/rstudio/commit/41a7975ef3e008cf0569537951d50cf2bad93d35", "message": "install ninja on the windows docker image", "committedDate": "2020-07-02T21:46:36Z", "type": "commit"}, {"oid": "f53eeeb694b2823e4672802b31e3a0fbd5829292", "url": "https://github.com/rstudio/rstudio/commit/f53eeeb694b2823e4672802b31e3a0fbd5829292", "message": "change the generation tool and build with ninja instead of nmake", "committedDate": "2020-07-02T21:47:05Z", "type": "commit"}, {"oid": "d8feca9b4f9af546332af1a69ab1f2339d561925", "url": "https://github.com/rstudio/rstudio/commit/d8feca9b4f9af546332af1a69ab1f2339d561925", "message": "correctly invoke the vsdevcmd.bat script", "committedDate": "2020-07-03T01:02:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM4MDcwNA==", "url": "https://github.com/rstudio/rstudio/pull/7267#discussion_r449380704", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              choco install -y ninja --verion \"Ninja 1.10.0\"\n          \n          \n            \n              choco install -y ninja --version \"Ninja 1.10.0\"", "author": "kevinushey", "createdAt": "2020-07-03T05:21:18Z", "path": "docker/jenkins/Dockerfile.windows", "diffHunk": "@@ -22,11 +22,12 @@ RUN choco install -y cmake --installargs 'ADD_CMAKE_TO_PATH=\"\"System\"\"' --fail-o\n   choco install -y -i ant; `\n   choco install -y windows-sdk-10.1 --version 10.1.17134.12; `\n   choco install -y 7zip; `\n-  choco install -y nsis\n-  \n+  choco install -y nsis; `\n+  choco install -y ninja --verion \"Ninja 1.10.0\"", "originalCommit": "d8feca9b4f9af546332af1a69ab1f2339d561925", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM4MTE3Mg==", "url": "https://github.com/rstudio/rstudio/pull/7267#discussion_r449381172", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            cmake --build . %MAKEFLAGS% --config %CMAKE_BUILD_TYPE% --target install || goto :error\n          \n          \n            \n            cmake --build . --config %CMAKE_BUILD_TYPE% --target install -- %MAKEFLAGS% || goto :error\n          \n      \n    \n    \n  \n\nIIRC, CMake usually expects flags that will be passed to the underlying build tool at the end, following --.", "author": "kevinushey", "createdAt": "2020-07-03T05:23:09Z", "path": "package/win32/make-install-win32.bat", "diffHunk": "@@ -18,14 +18,17 @@ cd %WIN32_BUILD_PATH%\n if exist CMakeCache.txt del CMakeCache.txt\n \n REM Build the project\n-cmake -G\"Visual Studio 15 2017\" ^\n-      -T host=x86 ^\n+call \"%ProgramFiles(x86)%\\Microsoft Visual Studio\\2017\\BuildTools\\Common7\\Tools\\VsDevCmd.bat\" -clean_env -no_logo || goto :error\n+call \"%ProgramFiles(x86)%\\Microsoft Visual Studio\\2017\\BuildTools\\Common7\\Tools\\VsDevCmd.bat\" -arch=x86 -startdir=none -host_arch=x86 -winsdk=10.0.17134.0 -no_logo || goto :error\n+cmake -G \"Ninja\" ^\n       -DCMAKE_INSTALL_PREFIX:String=%INSTALL_PATH% ^\n       -DCMAKE_BUILD_TYPE=%CMAKE_BUILD_TYPE% ^\n       -DRSTUDIO_TARGET=SessionWin32 ^\n       -DRSTUDIO_PACKAGE_BUILD=1 ^\n+      -DCMAKE_C_COMPILER=cl.exe ^\n+      -DCMAKE_CXX_COMPILER=cl.exe ^\n       ..\\..\\.. || goto :error\n-cmake --build . --config %CMAKE_BUILD_TYPE% --target install || goto :error\n+cmake --build . %MAKEFLAGS% --config %CMAKE_BUILD_TYPE% --target install || goto :error", "originalCommit": "d8feca9b4f9af546332af1a69ab1f2339d561925", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM4MTMxNA==", "url": "https://github.com/rstudio/rstudio/pull/7267#discussion_r449381314", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            cmake --build . %MAKEFLAGS% --config %CMAKE_BUILD_TYPE% || goto :error\n          \n          \n            \n            cmake --build . --config %CMAKE_BUILD_TYPE% -- %MAKEFLAGS% || goto :error", "author": "kevinushey", "createdAt": "2020-07-03T05:23:55Z", "path": "package/win32/make-package.bat", "diffHunk": "@@ -39,21 +39,22 @@ if exist \"%BUILD_DIR%/_CPack_Packages\" rmdir /s /q \"%BUILD_DIR%\\_CPack_Packages\"\n \n REM Configure and build the project. (Note that Windows / MSVC builds require\n REM that we specify the build type both at configure time and at build time)\n-cmake -G\"Visual Studio 15 2017 Win64\" ^\n-      -T host=x64 ^\n+call \"%ProgramFiles(x86)%\\Microsoft Visual Studio\\2017\\BuildTools\\Common7\\Tools\\VsDevCmd.bat\" -clean_env -no_logo || goto :error\n+call \"%ProgramFiles(x86)%\\Microsoft Visual Studio\\2017\\BuildTools\\Common7\\Tools\\VsDevCmd.bat\" -arch=amd64 -startdir=none -host_arch=amd64 -winsdk=10.0.17134.0 -no_logo || goto :error\n+cmake -G \"Ninja\" ^\n       -DRSTUDIO_TARGET=Desktop ^\n       -DCMAKE_BUILD_TYPE=%CMAKE_BUILD_TYPE% ^\n       -DRSTUDIO_PACKAGE_BUILD=1 ^\n+      -DCMAKE_C_COMPILER=cl ^\n+      -DCMAKE_CXX_COMPILER=cl ^\n       ..\\..\\.. || goto :error\n-cmake --build . --config %CMAKE_BUILD_TYPE% || goto :error\n+cmake --build . %MAKEFLAGS% --config %CMAKE_BUILD_TYPE% || goto :error", "originalCommit": "d8feca9b4f9af546332af1a69ab1f2339d561925", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1101d801f8997c3710c06a97ec5d289bc014395c", "url": "https://github.com/rstudio/rstudio/commit/1101d801f8997c3710c06a97ec5d289bc014395c", "message": "Update package/win32/make-install-win32.bat\n\nCo-authored-by: Kevin Ushey <kevin@rstudio.com>", "committedDate": "2020-07-06T19:27:31Z", "type": "commit"}, {"oid": "cd84eb374561c6f42c40cb40ddbed42421e6bd34", "url": "https://github.com/rstudio/rstudio/commit/cd84eb374561c6f42c40cb40ddbed42421e6bd34", "message": "move makeflags after --\n\nCo-authored-by: Kevin Ushey <kevin@rstudio.com>", "committedDate": "2020-07-06T19:27:55Z", "type": "commit"}, {"oid": "6c42dca5bbfc339b19f1da7d2e39ddf8462fa462", "url": "https://github.com/rstudio/rstudio/commit/6c42dca5bbfc339b19f1da7d2e39ddf8462fa462", "message": "fix a type (verion -> version)\n\nCo-authored-by: Kevin Ushey <kevin@rstudio.com>", "committedDate": "2020-07-06T19:28:17Z", "type": "commit"}, {"oid": "e4bf41c00c39d1942a2b441f9a227ab94359c0be", "url": "https://github.com/rstudio/rstudio/commit/e4bf41c00c39d1942a2b441f9a227ab94359c0be", "message": "also look for community tools", "committedDate": "2020-07-08T00:28:45Z", "type": "commit"}, {"oid": "c6ab8136acd3990cd581955d2acb0a878424a256", "url": "https://github.com/rstudio/rstudio/commit/c6ab8136acd3990cd581955d2acb0a878424a256", "message": "Merge remote-tracking branch 'origin/feature/parallel-windows-builds' into feature/parallel-windows-builds", "committedDate": "2020-07-08T00:28:59Z", "type": "commit"}]}