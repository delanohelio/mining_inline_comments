{"pr_number": 7558, "pr_title": "Fix issues with Console handling of inverted color mode", "pr_createdAt": "2020-08-10T00:30:29Z", "pr_url": "https://github.com/rstudio/rstudio/pull/7558", "timeline": [{"oid": "95e2dd9ba100c2211b0336dcb650323e6cc8af40", "url": "https://github.com/rstudio/rstudio/commit/95e2dd9ba100c2211b0336dcb650323e6cc8af40", "message": "Fix issues with Console handling of invert sequences\n\n- Fixes #7250", "committedDate": "2020-08-09T23:52:49Z", "type": "commit"}, {"oid": "c156281381c1edfe674ad356bbdaae6856aa2c66", "url": "https://github.com/rstudio/rstudio/commit/c156281381c1edfe674ad356bbdaae6856aa2c66", "message": "Fix issues with inverting using 256-color mode\n\n- Fixes #7557", "committedDate": "2020-08-10T17:33:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMwNzczNA==", "url": "https://github.com/rstudio/rstudio/pull/7558#discussion_r468307734", "bodyText": "Totally up to you but I find these statements easier to read without the negation (i.e. if (inverted_) { ... )", "author": "jmcphers", "createdAt": "2020-08-11T03:39:14Z", "path": "src/gwt/src/org/rstudio/core/client/AnsiCode.java", "diffHunk": "@@ -421,25 +467,45 @@ else if (codeVal == STRIKETHROUGH_OFF)\n          }\n          else if (Color.isFgColorCode(codeVal))\n          {\n-            currentColor_.setCode(codeVal);\n-            resetForeground();\n-            clazzes_.add(clazzForColor(codeVal));\n+            if (!inverted_)\n+               setForegroundColor(codeVal);\n+            else\n+               setBackgroundColor(Color.fgToBgColor(codeVal));\n          }\n          else if (Color.isBgColorCode(codeVal))\n          {\n-            currentBgColor_ = new Color(false, codeVal);\n-            resetBackground();\n-            clazzes_.add(clazzForBgColor(codeVal));\n+            if (!inverted_)\n+               setBackgroundColor(codeVal);\n+            else\n+               setForegroundColor(Color.bgToFgColor(codeVal));\n          }\n          else if (codeVal == RESET_FOREGROUND)\n          {\n-            currentColor_.reset();\n-            resetForeground();\n+            if (!inverted_)\n+            {\n+               currentColor_.reset();\n+               resetForeground();\n+            }\n+            else\n+            {\n+               currentBgColor_.reset();\n+               resetBackground();\n+               clazzes_.add(INVERSE_BG_STYLE);\n+            }\n          }\n          else if (codeVal == RESET_BACKGROUND)\n          {\n-            currentBgColor_.reset();\n-            resetBackground();\n+            if (!inverted_)", "originalCommit": "c156281381c1edfe674ad356bbdaae6856aa2c66", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMxMTcyNA==", "url": "https://github.com/rstudio/rstudio/pull/7558#discussion_r468311724", "bodyText": "I actually had it that way originally but I  kept misreading it (my brain was expecting the \u201cnormal\u201d case to be first, it seemed).", "author": "gtritchie", "createdAt": "2020-08-11T03:55:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMwNzczNA=="}], "type": "inlineReview"}]}