{"pr_number": 7027, "pr_title": "Rainbow parentheses feature", "pr_createdAt": "2020-06-02T20:38:23Z", "pr_url": "https://github.com/rstudio/rstudio/pull/7027", "timeline": [{"oid": "7ec038a8cdb9787b0a9eb1dfb7066fc1c3e46e80", "url": "https://github.com/rstudio/rstudio/commit/7ec038a8cdb9787b0a9eb1dfb7066fc1c3e46e80", "message": "initial rainbow parentheses implementation", "committedDate": "2020-06-01T23:26:19Z", "type": "commit"}, {"oid": "5065fb775ad2aff835e02912d47bbb6dc338e3a3", "url": "https://github.com/rstudio/rstudio/commit/5065fb775ad2aff835e02912d47bbb6dc338e3a3", "message": "regenerate themes with parentheses colors", "committedDate": "2020-06-02T19:51:40Z", "type": "commit"}, {"oid": "74e002b682ee65fd6223020b5e25fc01c890f7b5", "url": "https://github.com/rstudio/rstudio/commit/74e002b682ee65fd6223020b5e25fc01c890f7b5", "message": "just use the standard nomenclature of rainbow parentheses to in user facing settings", "committedDate": "2020-06-02T20:29:41Z", "type": "commit"}, {"oid": "b9bc1cd591af0d72f06b91e39ca5226e59d0ae80", "url": "https://github.com/rstudio/rstudio/commit/b9bc1cd591af0d72f06b91e39ca5226e59d0ae80", "message": "remove debug code and re-enable sync rainbow editor setting", "committedDate": "2020-06-02T20:45:45Z", "type": "commit"}, {"oid": "6a27746f7145e833a214a5ecb88ebfe906073b7d", "url": "https://github.com/rstudio/rstudio/commit/6a27746f7145e833a214a5ecb88ebfe906073b7d", "message": "add NEWS entry", "committedDate": "2020-06-02T20:58:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc3NzkzMg==", "url": "https://github.com/rstudio/rstudio/pull/7027#discussion_r434777932", "bodyText": "spelling: \"parantheses\", but correct in user-prefs-schema.json, so just need to rerun generate-prefs.R", "author": "gtritchie", "createdAt": "2020-06-03T18:42:06Z", "path": "src/cpp/session/include/session/prefs/UserPrefValues.hpp", "diffHunk": "@@ -773,6 +774,12 @@ class UserPrefValues: public Preferences\n    bool highlightRFunctionCalls();\n    core::Error setHighlightRFunctionCalls(bool val);\n \n+   /**\n+    * Whether to highlight parantheses (and other bracketed characters) in various colors", "originalCommit": "6a27746f7145e833a214a5ecb88ebfe906073b7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ0MTYyNg==", "url": "https://github.com/rstudio/rstudio/pull/7027#discussion_r435441626", "bodyText": "\ud83d\udc4d", "author": "adamconroy", "createdAt": "2020-06-04T17:52:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc3NzkzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc3ODM5MQ==", "url": "https://github.com/rstudio/rstudio/pull/7027#discussion_r434778391", "bodyText": "Same as earlier comment about \"parantheses\"", "author": "gtritchie", "createdAt": "2020-06-03T18:42:56Z", "path": "src/cpp/session/prefs/UserPrefValues.cpp", "diffHunk": "@@ -933,6 +933,19 @@ core::Error UserPrefValues::setHighlightRFunctionCalls(bool val)\n    return writePref(\"highlight_r_function_calls\", val);\n }\n \n+/**\n+ * Whether to highlight parantheses (and other bracketed characters) in various colors", "originalCommit": "6a27746f7145e833a214a5ecb88ebfe906073b7d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc4MjE3MA==", "url": "https://github.com/rstudio/rstudio/pull/7027#discussion_r434782170", "bodyText": "This matches [, (, { via the RainbowParenHighlightRules and then adds in < (and equivalent closing symbols)? Just checking my understanding.", "author": "gtritchie", "createdAt": "2020-06-03T18:49:57Z", "path": "src/gwt/acesupport/acemode/c_cpp_highlight_rules.js", "diffHunk": "@@ -181,24 +182,16 @@ var c_cppHighlightRules = function() {\n             token : \"keyword.punctuation.operator\",\n             merge : false,\n             regex : \"\\\\?|\\\\:|\\\\,|\\\\;|\\\\.|\\\\\\\\\"\n-         }, {", "originalCommit": "6a27746f7145e833a214a5ecb88ebfe906073b7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ0MzM3MA==", "url": "https://github.com/rstudio/rstudio/pull/7027#discussion_r435443370", "bodyText": "Yeah, the rainbow rules don't work with <> and if you see the removed regex it apples to all of the characters so separated it as <> doesn't work the same in non-CPP languages. We could add an interface for custom regexes but I think not coloring <> differently in CPP looks better anyway as it's not something that you nest.", "author": "adamconroy", "createdAt": "2020-06-04T17:55:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc4MjE3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc4NTgxMw==", "url": "https://github.com/rstudio/rstudio/pull/7027#discussion_r434785813", "bodyText": "Curious, why is the added checking now required?", "author": "gtritchie", "createdAt": "2020-06-03T18:56:51Z", "path": "src/gwt/acesupport/acemode/c_cpp.js", "diffHunk": "@@ -157,7 +157,13 @@ oop.inherits(Mode, TextMode);\n \n    this.inRLanguageMode = function(state)\n    {\n-      return state.match(/^r-/);\n+     if (!state)", "originalCommit": "6a27746f7145e833a214a5ecb88ebfe906073b7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ0NDk5OQ==", "url": "https://github.com/rstudio/rstudio/pull/7027#discussion_r435444999", "bodyText": "The type of state is variable. In fact it's actually normally an array in custom onMatch code (see: yaml_highlight_rules.js). Our code here was making an assumption about the type that is naive.", "author": "adamconroy", "createdAt": "2020-06-04T17:58:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc4NTgxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc4NzI4MQ==", "url": "https://github.com/rstudio/rstudio/pull/7027#discussion_r434787281", "bodyText": "Can you resubmit this without the indentation changes? Makes it very hard to review. If the indentation change is important, then maybe do a whitespace-only change and commit that, then make your changes?", "author": "gtritchie", "createdAt": "2020-06-03T18:59:25Z", "path": "src/gwt/acesupport/acemode/r_highlight_rules.js", "diffHunk": "@@ -17,491 +17,473 @@\n  * AGPL (http://www.gnu.org/licenses/agpl-3.0.txt) for more details.\n  *\n  */\n-\n var $colorFunctionCalls = false;\n \n define(\"mode/r_highlight_rules\", [\"require\", \"exports\", \"module\"], function(require, exports, module)\n {\n-   function include(rules) {\n-      var result = new Array(rules.length);\n-      for (var i = 0; i < rules.length; i++) {\n-         result[i] = {include: rules[i]};\n+  function include(rules) {", "originalCommit": "6a27746f7145e833a214a5ecb88ebfe906073b7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ0NjU2MQ==", "url": "https://github.com/rstudio/rstudio/pull/7027#discussion_r435446561", "bodyText": "Sorry this was IntelliJ just doing its thing, I didn't even see this change. JS files should be changed to 2 spaces instead of 3 but I didn't intend for it here. For this case here you can just click the gear at the top and click \"hide whitespace changes\" or append ?w=1 to the URL for easier viewing.", "author": "adamconroy", "createdAt": "2020-06-04T18:01:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc4NzI4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ1MjQ3MQ==", "url": "https://github.com/rstudio/rstudio/pull/7027#discussion_r435452471", "bodyText": "Ah, I didn't know about that option to hide whitespace changes. Nifty!", "author": "gtritchie", "createdAt": "2020-06-04T18:11:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc4NzI4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc4ODgyOA==", "url": "https://github.com/rstudio/rstudio/pull/7027#discussion_r434788828", "bodyText": "Switch to our new \"current-year only\" format.", "author": "gtritchie", "createdAt": "2020-06-03T19:02:20Z", "path": "src/gwt/acesupport/acemode/rainbow_paren_highlight_rules.js", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * rainbow_paren_highlight_rules.js\n+ *\n+ * Copyright (C) 2009-20 by RStudio, PBC", "originalCommit": "6a27746f7145e833a214a5ecb88ebfe906073b7d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc5MTc0MQ==", "url": "https://github.com/rstudio/rstudio/pull/7027#discussion_r434791741", "bodyText": "Does everything in this pane still fit (vertically)? Noticed this pane is getting very full. I ran into a problem adding a checkbox to the Code / Display pane in #7030 and had to remove some other spacing or it was slightly clipped at the bottom", "author": "gtritchie", "createdAt": "2020-06-03T19:07:44Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/prefs/views/EditingPreferencesPane.java", "diffHunk": "@@ -77,6 +77,7 @@ public EditingPreferencesPane(UserPrefs prefs,\n             \"When enabled, the indentation for documents not part of an RStudio project \" +\n             \"will be automatically detected.\"));\n       editingPanel.add(checkboxPref(\"Insert matching parens/quotes\", prefs_.insertMatching()));\n+      editingPanel.add(checkboxPref(\"Rainbow parentheses\", prefs_.rainbowParentheses()));", "originalCommit": "6a27746f7145e833a214a5ecb88ebfe906073b7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzgwNzM5OQ==", "url": "https://github.com/rstudio/rstudio/pull/7027#discussion_r437807399", "bodyText": "It does, there's still room for like...one more checkbox. It's definitely cramped though. We are in the situation where we want to start thinking about a different format for our options panel.", "author": "adamconroy", "createdAt": "2020-06-10T01:20:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc5MTc0MQ=="}], "type": "inlineReview"}, {"oid": "71822819932c55dde958826074c8c3fe3ab7a78f", "url": "https://github.com/rstudio/rstudio/commit/71822819932c55dde958826074c8c3fe3ab7a78f", "message": "Merge branch 'master' into feature/rainbow-parens", "committedDate": "2020-06-10T00:30:30Z", "type": "commit"}, {"oid": "04342f33550e4720ec6ec9aa91bec491c7f10fb5", "url": "https://github.com/rstudio/rstudio/commit/04342f33550e4720ec6ec9aa91bec491c7f10fb5", "message": "pr feedback", "committedDate": "2020-06-10T01:57:44Z", "type": "commit"}, {"oid": "275c94109c4f703120ba9ee74ff0ce883d84cf58", "url": "https://github.com/rstudio/rstudio/commit/275c94109c4f703120ba9ee74ff0ce883d84cf58", "message": "Merge branch 'feature/rainbow-parens' of https://github.com/rstudio/rstudio into feature/rainbow-parens", "committedDate": "2020-06-10T16:30:35Z", "type": "commit"}, {"oid": "0d5106ca67dd292f28c2e194c2527c3450d4ebb4", "url": "https://github.com/rstudio/rstudio/commit/0d5106ca67dd292f28c2e194c2527c3450d4ebb4", "message": "pr feedback, update user pref for new interface", "committedDate": "2020-06-11T23:25:11Z", "type": "commit"}, {"oid": "89d7ddfb848b0c67dd307a70175bff94e87aa67e", "url": "https://github.com/rstudio/rstudio/commit/89d7ddfb848b0c67dd307a70175bff94e87aa67e", "message": "make token cursor paren matching consistent", "committedDate": "2020-06-15T19:26:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQyODM2Ng==", "url": "https://github.com/rstudio/rstudio/pull/7027#discussion_r440428366", "bodyText": "Add a title to this (and regenerate prefs) so it can be set from the Command palette.", "author": "jmcphers", "createdAt": "2020-06-15T20:29:14Z", "path": "src/cpp/session/resources/schema/user-prefs-schema.json", "diffHunk": "@@ -515,6 +515,11 @@\n             \"title\": \"Highlight R function calls\",\n             \"description\": \"Whether to highlight R function calls in the code editor.\"\n         },\n+        \"rainbow_parentheses\": {\n+            \"type\": \"boolean\",\n+            \"default\": false,", "originalCommit": "89d7ddfb848b0c67dd307a70175bff94e87aa67e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQzMjUyNw==", "url": "https://github.com/rstudio/rstudio/pull/7027#discussion_r440432527", "bodyText": "(note you'll probably have to merge master into your branch to get this capability)", "author": "jmcphers", "createdAt": "2020-06-15T20:37:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQyODM2Ng=="}], "type": "inlineReview"}, {"oid": "efae97f2439aac4f8c290083b1c0d8f2f784c28e", "url": "https://github.com/rstudio/rstudio/commit/efae97f2439aac4f8c290083b1c0d8f2f784c28e", "message": "merge", "committedDate": "2020-06-17T05:58:37Z", "type": "commit"}, {"oid": "241740fcb57d71f5dd894381d48ac755a51cb902", "url": "https://github.com/rstudio/rstudio/commit/241740fcb57d71f5dd894381d48ac755a51cb902", "message": "move paren_color style from rsthemes to themeStyles.css, update rainbow_parens UserPref", "committedDate": "2020-06-17T20:41:08Z", "type": "commit"}, {"oid": "db44549d2864d0fe113cecee38373eb3e0a86c42", "url": "https://github.com/rstudio/rstudio/commit/db44549d2864d0fe113cecee38373eb3e0a86c42", "message": "remove ace_paren from rstheme tests", "committedDate": "2020-06-17T21:40:54Z", "type": "commit"}, {"oid": "c956b7eeed17443ef8b932b6c3dd0b8fdbf0047f", "url": "https://github.com/rstudio/rstudio/commit/c956b7eeed17443ef8b932b6c3dd0b8fdbf0047f", "message": "Merge branch 'master' of https://github.com/rstudio/rstudio into feature/rainbow-parens", "committedDate": "2020-06-17T21:41:55Z", "type": "commit"}]}