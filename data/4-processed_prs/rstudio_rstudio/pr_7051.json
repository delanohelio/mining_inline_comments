{"pr_number": 7051, "pr_title": "Ensure toolbar updates when changing YAML to notebook", "pr_createdAt": "2020-06-05T23:10:23Z", "pr_url": "https://github.com/rstudio/rstudio/pull/7051", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYxNTE4NQ==", "url": "https://github.com/rstudio/rstudio/pull/7051#discussion_r437615185", "bodyText": "I think we should be a bit more careful in this check, since IIUC this would trigger if html_notebook were mentioned anywhere in the document (even outside the YAML header).\n\n\nCould we parse and check the YAML directly for the output type? (Can we assume the document's YAML header is in a \"good\" / parseable state here?) This would also protect us from the myriad of ways users might decide to encode the YAML string here (quoted vs unquoted and so on).\n\n\nCould we use a regular expression to more specifically check for output: html_notebook in the document (handling the arbitrary whitespace separating the tokens)? That would at least be safer than just checking for this string only. We might also want to be robust against usages like output: rmarkdown::html_notebook or output: \"html_notebook\".", "author": "kevinushey", "createdAt": "2020-06-09T17:56:04Z", "path": "src/cpp/session/modules/rmarkdown/SessionRMarkdown.cpp", "diffHunk": "@@ -928,7 +928,14 @@ std::string onDetectRmdSourceType(\n                                        \"<!-- rmarkdown v1 -->\") &&\n           rmarkdownPackageAvailable())\n       {\n-         return \"rmarkdown\";\n+         if (boost::algorithm::icontains(pDoc->contents(), \"html_notebook\"))", "originalCommit": "e7b1f109c846560f71942a99b762fe63921186eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUwNjMzNg==", "url": "https://github.com/rstudio/rstudio/pull/7051#discussion_r440506336", "bodyText": "That's a good point. I don't think we want to be as aggressive as actually parsing YAML here since this runs so frequently. I've updated this so it only looks in the YAML header. (This is congruent with how we e.g. detect runtime: shiny documents.) The odds of having html_notebook in your YAML header if it's not a notebook are vanishingly small.", "author": "jmcphers", "createdAt": "2020-06-15T23:45:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYxNTE4NQ=="}], "type": "inlineReview"}, {"oid": "c01af95b9125976130f651348e64b08479bc7db1", "url": "https://github.com/rstudio/rstudio/commit/c01af95b9125976130f651348e64b08479bc7db1", "message": "give html_notebook its own extended type\n\nonly look for html_notebook in yaml header", "committedDate": "2020-06-16T16:01:45Z", "type": "forcePushed"}, {"oid": "b9a49a0624e1242f31779e0d65ea8ee0afe14787", "url": "https://github.com/rstudio/rstudio/commit/b9a49a0624e1242f31779e0d65ea8ee0afe14787", "message": "give html_notebook its own extended type\n\nonly look for html_notebook in yaml header", "committedDate": "2020-06-16T16:03:45Z", "type": "forcePushed"}, {"oid": "65772ce3005f0bee20884b0210aff8b13f4ec35c", "url": "https://github.com/rstudio/rstudio/commit/65772ce3005f0bee20884b0210aff8b13f4ec35c", "message": "give html_notebook its own extended type\n\nonly look for html_notebook in yaml header", "committedDate": "2020-06-16T16:13:10Z", "type": "commit"}, {"oid": "65772ce3005f0bee20884b0210aff8b13f4ec35c", "url": "https://github.com/rstudio/rstudio/commit/65772ce3005f0bee20884b0210aff8b13f4ec35c", "message": "give html_notebook its own extended type\n\nonly look for html_notebook in yaml header", "committedDate": "2020-06-16T16:13:10Z", "type": "forcePushed"}]}