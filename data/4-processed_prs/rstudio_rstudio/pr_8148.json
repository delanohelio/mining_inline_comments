{"pr_number": 8148, "pr_title": "Fix a race condition when displaying the R error page", "pr_createdAt": "2020-10-22T01:44:28Z", "pr_url": "https://github.com/rstudio/rstudio/pull/8148", "timeline": [{"oid": "517a436c8b4ca0821c2544a191e5868f45b3008c", "url": "https://github.com/rstudio/rstudio/commit/517a436c8b4ca0821c2544a191e5868f45b3008c", "message": "ensure R Suicide message is sent to the R Session stderr", "committedDate": "2020-10-22T01:33:34Z", "type": "commit"}, {"oid": "57eeee9598024e617c4ca5904bba51704f586650", "url": "https://github.com/rstudio/rstudio/commit/57eeee9598024e617c4ca5904bba51704f586650", "message": "resolve race condition between error and cannot connect pages", "committedDate": "2020-10-22T01:36:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMxMTg1Nw==", "url": "https://github.com/rstudio/rstudio/pull/8148#discussion_r510311857", "bodyText": "Could you add a comment here indicating why we're emitting this to stderr and logging it?", "author": "jmcphers", "createdAt": "2020-10-22T16:49:11Z", "path": "src/cpp/r/session/RStdCallbacks.cpp", "diffHunk": "@@ -613,6 +615,7 @@ void Raddhistory(SEXP call, SEXP op, SEXP args, SEXP env)\n // NOTE: Win32 doesn't receive this callback\n void RSuicide(const char* s)\n {\n+   std::cerr << s << std::endl;", "originalCommit": "57eeee9598024e617c4ca5904bba51704f586650", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMxMjMzOA==", "url": "https://github.com/rstudio/rstudio/pull/8148#discussion_r510312338", "bodyText": "Nit: I think the whole template rendering bit should be in here since none of it is meaningful work if the error is already displayed.", "author": "jmcphers", "createdAt": "2020-10-22T16:49:52Z", "path": "src/cpp/desktop/DesktopMainWindow.cpp", "diffHunk": "@@ -663,10 +673,15 @@ void MainWindow::onLoadFinished(bool ok)\n    std::ostringstream oss;\n    Error error = text::renderTemplate(options().resourcesPath().completePath(\"html/connect.html\"),\n                                       vars, oss);\n-   if (error)\n-      LOG_ERROR(error);\n-   else\n-      loadHtml(QString::fromStdString(oss.str()));\n+\n+   LOCK_MUTEX(mutex_)\n+   {\n+      if (error)\n+         LOG_ERROR(error);\n+      else if (!isErrorDisplayed_)\n+         loadHtml(QString::fromStdString(oss.str()));", "originalCommit": "57eeee9598024e617c4ca5904bba51704f586650", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2c9cef23a69ce7ac9ff959e803e538906e3f3549", "url": "https://github.com/rstudio/rstudio/commit/2c9cef23a69ce7ac9ff959e803e538906e3f3549", "message": "add comment re: code review feedback", "committedDate": "2020-10-22T18:54:15Z", "type": "commit"}, {"oid": "de172daa3dada353d785d3cf0f0e9973ebab9a7c", "url": "https://github.com/rstudio/rstudio/commit/de172daa3dada353d785d3cf0f0e9973ebab9a7c", "message": "don't generate html if unnecessary", "committedDate": "2020-10-22T19:00:13Z", "type": "commit"}]}