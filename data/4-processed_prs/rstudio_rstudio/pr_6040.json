{"pr_number": 6040, "pr_title": "Add Package Source to Find In Files include options", "pr_createdAt": "2020-01-16T22:16:49Z", "pr_url": "https://github.com/rstudio/rstudio/pull/6040", "timeline": [{"oid": "7803a4ddae43b2883f67c182e49fbe561a9bf002", "url": "https://github.com/rstudio/rstudio/commit/7803a4ddae43b2883f67c182e49fbe561a9bf002", "message": "update the UI so a user cannot input file patterns when using git exclusions\nas git grep doesn't have an equivalent to grep's --include", "committedDate": "2020-01-08T22:59:15Z", "type": "commit"}, {"oid": "2d7059c81c36c388ef67ecffd4533b63d13d5581", "url": "https://github.com/rstudio/rstudio/commit/2d7059c81c36c388ef67ecffd4533b63d13d5581", "message": "add include option for R packages (R/ src/ tests/)", "committedDate": "2020-01-09T02:06:09Z", "type": "commit"}, {"oid": "23c69b18ec6a9104853731e0c4b50c1b18c9161f", "url": "https://github.com/rstudio/rstudio/commit/23c69b18ec6a9104853731e0c4b50c1b18c9161f", "message": "fix spacing and add error checking for when a user tries to search a package while not in a\npackage session", "committedDate": "2020-01-09T20:17:09Z", "type": "commit"}, {"oid": "9ee1ca83af5561bbc2ebd1dcf479d9b79adb4bd3", "url": "https://github.com/rstudio/rstudio/commit/9ee1ca83af5561bbc2ebd1dcf479d9b79adb4bd3", "message": "update state name", "committedDate": "2020-01-10T01:49:03Z", "type": "commit"}, {"oid": "cac983631da2f51d35b5cfe5568c6e4cb5f1b8c4", "url": "https://github.com/rstudio/rstudio/commit/cac983631da2f51d35b5cfe5568c6e4cb5f1b8c4", "message": "update the UI so a user cannot input file patterns when using git exclusions\nas git grep doesn't have an equivalent to grep's --include", "committedDate": "2020-01-14T00:02:30Z", "type": "commit"}, {"oid": "b446c85fe3bc8c31ddf7611f5343bafb219960af", "url": "https://github.com/rstudio/rstudio/commit/b446c85fe3bc8c31ddf7611f5343bafb219960af", "message": "rename functions using retrieve because we are not fetching\nupdate include/exclude file patterns to use enums for readability\ndisable the Git option when git is not installed", "committedDate": "2020-01-14T00:03:50Z", "type": "commit"}, {"oid": "b02744c1a5292e0403f0a32965f4dbde8535c629", "url": "https://github.com/rstudio/rstudio/commit/b02744c1a5292e0403f0a32965f4dbde8535c629", "message": "fix issue where in rare cases ReplaceOperationEndedEvent wasn't getting called and the progress bar\nwas visible after the replace had completed\n- removed code unnsuccesfully trying to fix this", "committedDate": "2020-01-14T00:03:50Z", "type": "commit"}, {"oid": "8988227b65a5ac2f92cadbaaccdfd84887c02a29", "url": "https://github.com/rstudio/rstudio/commit/8988227b65a5ac2f92cadbaaccdfd84887c02a29", "message": "disable Standard Git Exclusions selection when git is not installed or a git repo isn't selected\nadd value change handler to Find In Files directory chooser, on changes check if the new directory\nis a git repository and if git is installed\nadd new Files Server operation to check if a directory is a git directory", "committedDate": "2020-01-14T00:03:50Z", "type": "commit"}, {"oid": "4da19f30bc83bba7f492781e0c9aefafb450c028", "url": "https://github.com/rstudio/rstudio/commit/4da19f30bc83bba7f492781e0c9aefafb450c028", "message": "add include option for user to filter by package source code\nadd new RPC to check if a directory is a package, only display the package source option for package\ndirectories", "committedDate": "2020-01-14T00:03:50Z", "type": "commit"}, {"oid": "1c158214d1b7cb337026bed8baeedf2ec2d92da4", "url": "https://github.com/rstudio/rstudio/commit/1c158214d1b7cb337026bed8baeedf2ec2d92da4", "message": "only allow includes that don't require the grep --include parameter when filtering with git", "committedDate": "2020-01-14T21:32:54Z", "type": "commit"}, {"oid": "ceb218b2a0b36ad4fd47aa3863e6226b2d166f7a", "url": "https://github.com/rstudio/rstudio/commit/ceb218b2a0b36ad4fd47aa3863e6226b2d166f7a", "message": "allow user to filter by package source and follow standard git exclusions", "committedDate": "2020-01-15T00:38:38Z", "type": "commit"}, {"oid": "0d277db4376dd4c482af64f88967829db017b46b", "url": "https://github.com/rstudio/rstudio/commit/0d277db4376dd4c482af64f88967829db017b46b", "message": "Merge branch 'feature/replace-git-ignore' of https://github.com/rstudio/rstudio into feature/find-in-package-src", "committedDate": "2020-01-16T00:00:05Z", "type": "commit"}, {"oid": "852c6e6d5c7b731110d97e3345240b2a68efc2ae", "url": "https://github.com/rstudio/rstudio/commit/852c6e6d5c7b731110d97e3345240b2a68efc2ae", "message": "rename enums for readability\nfix issue where Git and Package states weren't preserved", "committedDate": "2020-01-16T00:51:42Z", "type": "commit"}, {"oid": "285a581ac72308a9a0ac541889b2a4d84324568d", "url": "https://github.com/rstudio/rstudio/commit/285a581ac72308a9a0ac541889b2a4d84324568d", "message": "Merge branch 'master' of https://github.com/rstudio/rstudio into feature/find-in-package-src", "committedDate": "2020-01-16T20:55:22Z", "type": "commit"}, {"oid": "26bf1c7db70f8685b96ab5675632b3dbd25a2448", "url": "https://github.com/rstudio/rstudio/commit/26bf1c7db70f8685b96ab5675632b3dbd25a2448", "message": "add include options to GrepOptions class", "committedDate": "2020-01-16T22:02:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODA5NTczMg==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r368095732", "bodyText": "Nit: This should only happen if there's a bug in the front-end, right? If that's the case I think LOG_DEBUG_MESSAGE makes sense more than LOG_WARNING_MESSAGE. (The same for above in processExcludeFlags)", "author": "MariaSemple", "createdAt": "2020-01-17T19:19:42Z", "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -1074,6 +1089,23 @@ class GrepOptions : public boost::noncopyable\n          }\n       }\n    }\n+\n+   void processIncludeFilePatterns()\n+   {\n+      packageFlag_ = false;\n+      for (json::Value filePattern : includeFilePatterns_)\n+      {\n+         if (filePattern.getType() != json::Type::STRING)\n+            LOG_WARNING_MESSAGE(\"Include files contain non-string value\");", "originalCommit": "26bf1c7db70f8685b96ab5675632b3dbd25a2448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE2MTI1Nw==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r368161257", "bodyText": "Done :)", "author": "melissa-barca", "createdAt": "2020-01-17T22:23:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODA5NTczMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODA5ODAyNw==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r368098027", "bodyText": "Do you intend to go back to EscapeAll before you add all the directories to the command? Why switch to EscapeFilesOnly at all? If you just wanted -- to not be escaped, I think it would read clearer if you changed EscapeFilesOnly to EscapeNone (assuming that's an option - if not maybe a comment would help).", "author": "MariaSemple", "createdAt": "2020-01-17T19:24:58Z", "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -1095,6 +1127,23 @@ struct ReplaceOptions\n    const std::string replacePattern;\n };\n \n+void addPackageDirectoriesToCommand(const FilePath& directoryPath, shell_utils::ShellCommand* pCmd)\n+{\n+   FilePath rPath(string_utils::utf8ToSystem(directoryPath.getAbsolutePath() + \"/R\"));\n+   FilePath srcPath(string_utils::utf8ToSystem(directoryPath.getAbsolutePath() + \"/src\"));\n+   FilePath testsPath(string_utils::utf8ToSystem(directoryPath.getAbsolutePath() + \"/tests\"));\n+\n+   *pCmd << shell_utils::EscapeFilesOnly << \"--\" << shell_utils::EscapeAll;", "originalCommit": "26bf1c7db70f8685b96ab5675632b3dbd25a2448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0NTgzNQ==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r368145835", "bodyText": "To be honest this is pulled from the existing code, but my understanding is that it exists to prevent the -- from being escaped. There is no EscapeNone option but I can add a comment.", "author": "melissa-barca", "createdAt": "2020-01-17T21:35:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODA5ODAyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEwMDM5OA==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r368100398", "bodyText": "How would you feel about it if this function was called addDirectoriesToCommand and took bool packageFlag, const FilePath& dirPath, ShellCommand* pCmd as parameters and handled the if so you only need that cmd << shell_utils::EscapeFilesOnly << \"--\" << shell_utils::EscapeAll; line in one place?", "author": "MariaSemple", "createdAt": "2020-01-17T19:30:18Z", "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -1191,14 +1240,18 @@ core::Error runGrepOperation(const GrepOptions& grepOptions, const ReplaceOption\n       cmd << tempFile;\n       if (!grepOptions.asRegex())\n          cmd << \"-F\";\n-\n-      for (json::Value filePattern : grepOptions.includeFilePatterns())\n-         cmd << \"--include=\" + filePattern.getString();\n+      for (std::string arg : grepOptions.includeArgs())\n+         cmd << arg;\n       for (std::string arg : grepOptions.excludeArgs())\n          cmd << arg;\n \n-      cmd << shell_utils::EscapeFilesOnly << \"--\" << shell_utils::EscapeAll;\n-      cmd << string_utils::utf8ToSystem(dirPath.getAbsolutePath());\n+      if (grepOptions.packageFlag())\n+         addPackageDirectoriesToCommand(dirPath, &cmd);", "originalCommit": "26bf1c7db70f8685b96ab5675632b3dbd25a2448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE2MTM1NA==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r368161354", "bodyText": "I like it, updated the code.", "author": "melissa-barca", "createdAt": "2020-01-17T22:24:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEwMDM5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEwNDIwOA==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r368104208", "bodyText": "Is it not possible to both set the search directories and add include arguments when using git grep? What does the UI look like in that case?", "author": "MariaSemple", "createdAt": "2020-01-17T19:39:44Z", "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -1169,11 +1218,11 @@ core::Error runGrepOperation(const GrepOptions& grepOptions, const ReplaceOption\n       cmd << tempFile;\n       if (!grepOptions.asRegex())\n          cmd << \"-F\";\n-      for (json::Value filePattern : grepOptions.includeFilePatterns())\n-      {\n-         cmd << shell_utils::EscapeFilesOnly << \"--\" << shell_utils::EscapeAll;\n-         cmd << filePattern.getString();\n-      }\n+      if (grepOptions.packageFlag())\n+         addPackageDirectoriesToCommand(dirPath, &cmd);\n+      else\n+         for (std::string arg : grepOptions.includeArgs())\n+            cmd << arg;", "originalCommit": "26bf1c7db70f8685b96ab5675632b3dbd25a2448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0MDU3MQ==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r368140571", "bodyText": "Actually git grep doesn't have an equivalent include argument so Package Source is the only include option available when git exclusions is selected (the other options become greyed out and disabled) so this else can be removed.", "author": "melissa-barca", "createdAt": "2020-01-17T21:19:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEwNDIwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0MDkxNg==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r368140916", "bodyText": "I think I'll add an else if to check if grepOptions.includeArgs is empty and log a debug message if it's not.", "author": "melissa-barca", "createdAt": "2020-01-17T21:20:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEwNDIwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE2MTQyMw==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r368161423", "bodyText": "Updated \ud83d\udc4d", "author": "melissa-barca", "createdAt": "2020-01-17T22:24:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEwNDIwOA=="}], "type": "inlineReview"}, {"oid": "e2054d70781b71d76ff46d659f70987b3c0c3c5b", "url": "https://github.com/rstudio/rstudio/commit/e2054d70781b71d76ff46d659f70987b3c0c3c5b", "message": "change warning to debug messages since they should be prevented by the frontend\nrefactor addDirectories function to avoid repeating code", "committedDate": "2020-01-17T22:22:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3NTIzOQ==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r370275239", "bodyText": "We don't typically commit TODOs since we have no mechanism for ensuring that they get resolved. If the PR contains unfinished work items, open an issue to track them instead (and optionally refer to it in a comment).", "author": "jmcphers", "createdAt": "2020-01-23T18:11:47Z", "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -1095,6 +1127,30 @@ struct ReplaceOptions\n    const std::string replacePattern;\n };\n \n+void addDirectoriesToCommand(\n+   bool packageFlag, const FilePath& directoryPath, shell_utils::ShellCommand* pCmd)\n+{\n+   // TODO: review if switching to EscapeFilesOnly is necessay", "originalCommit": "e2054d70781b71d76ff46d659f70987b3c0c3c5b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM4NjIzNw==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r370386237", "bodyText": "I suggested to add a TODO or a comment here because it works as-is and whatever the outcome of the review, it should continue to work. The only benefit of the change is removing a single line of code, which didn't seem significant enough to warrant a git issue. I just though it would be good to have a note in the code that if someone happens to be looking here and they happen to know the answer, they can make this change or update the comment.", "author": "MariaSemple", "createdAt": "2020-01-23T22:21:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3NTIzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ5MTM1MA==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r371491350", "bodyText": "Makes sense but I think it's unlikely in practice. We usually use TODO as a way to help flag things that need to be resolved before commit, so having TODO in committed code adds noise. Let's leave the comment and rephrase it without TODO.", "author": "jmcphers", "createdAt": "2020-01-27T21:26:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3NTIzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUxNzAyNg==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r371517026", "bodyText": "Ok, I updated the comment", "author": "melissa-barca", "createdAt": "2020-01-27T22:24:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3NTIzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3NjI5OA==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r370276298", "bodyText": "I think this should just be a warning, and should include the directory in which we expected to find package folders but didn't.", "author": "jmcphers", "createdAt": "2020-01-23T18:14:11Z", "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -1095,6 +1127,30 @@ struct ReplaceOptions\n    const std::string replacePattern;\n };\n \n+void addDirectoriesToCommand(\n+   bool packageFlag, const FilePath& directoryPath, shell_utils::ShellCommand* pCmd)\n+{\n+   // TODO: review if switching to EscapeFilesOnly is necessay\n+   *pCmd << shell_utils::EscapeFilesOnly << \"--\" << shell_utils::EscapeAll;\n+   if (!packageFlag)\n+      *pCmd << string_utils::utf8ToSystem(directoryPath.getAbsolutePath());\n+   else\n+   {\n+      FilePath rPath(string_utils::utf8ToSystem(directoryPath.getAbsolutePath() + \"/R\"));\n+      FilePath srcPath(string_utils::utf8ToSystem(directoryPath.getAbsolutePath() + \"/src\"));\n+      FilePath testsPath(string_utils::utf8ToSystem(directoryPath.getAbsolutePath() + \"/tests\"));\n+   \n+      if (rPath.exists())\n+         *pCmd << rPath; \n+      if (srcPath.exists())\n+         *pCmd << srcPath;\n+      if (testsPath.exists())\n+         *pCmd << testsPath;\n+      else if (!rPath.exists() && !srcPath.exists())\n+         LOG_ERROR_MESSAGE(\"Package directories not found\");", "originalCommit": "e2054d70781b71d76ff46d659f70987b3c0c3c5b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI4MTk3Nw==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r370281977", "bodyText": "(For reference, and this should be clearer in the coding standards, you typically only log an error when an operation cannot proceed. In this case we're clearly proceeding as though nothing happened, so it's a warning.)", "author": "jmcphers", "createdAt": "2020-01-23T18:26:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3NjI5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM4MDg3NQ==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r370380875", "bodyText": "done!", "author": "melissa-barca", "createdAt": "2020-01-23T22:08:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3NjI5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3ODAyMw==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r370278023", "bodyText": "Here and elsewhere: this is verbose and somewhat difficult to read. How about adding something like DomUtils.setOptionDisabled(element, ordinal, disabled)?", "author": "jmcphers", "createdAt": "2020-01-23T18:17:41Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/output/find/FindInFilesDialog.java", "diffHunk": "@@ -249,32 +265,58 @@ private void manageExcludeFilePattern()\n       if (!gitStatus_ ||\n           !session_.getSessionInfo().isVcsAvailable(VCSConstants.GIT_ID))\n       {\n-         ((Element) listPresetExcludeFilePatterns_.getElement().getChild(1))\n+         ((Element) listPresetExcludeFilePatterns_.getElement().getChild(\n+               Exclude.StandardGit.ordinal()))\n             .setAttribute(\"disabled\", \"disabled\");\n          if (listPresetExcludeFilePatterns_.getSelectedIndex() ==\n-             ExcludeFilePatterns.StandardGit.ordinal())\n-            listPresetExcludeFilePatterns_.setSelectedIndex(ExcludeFilePatterns.None.ordinal());\n+             Exclude.StandardGit.ordinal())\n+            listPresetExcludeFilePatterns_.setSelectedIndex(Exclude.None.ordinal());\n       }\n       else\n-         ((Element) listPresetExcludeFilePatterns_.getElement().getChild(1))\n-            .removeAttribute(\"disabled\");\n-\n+         ((Element) listPresetExcludeFilePatterns_.getElement().getChild(\n+            Exclude.StandardGit.ordinal())).removeAttribute(\"disabled\");\n \n       // disable custom filter text box when 'Custom Filter' is not selected\n       divExcludeCustomFilter_.getStyle().setDisplay(\n             listPresetExcludeFilePatterns_.getSelectedIndex() == \n-            ExcludeFilePatterns.CustomFilter.ordinal()\n+            Exclude.CustomFilter.ordinal()\n             ? Style.Display.BLOCK\n             : Style.Display.NONE);\n \n       // user cannot specify include patterns when using git grep\n       if (listPresetExcludeFilePatterns_.getSelectedIndex() != \n-          ExcludeFilePatterns.StandardGit.ordinal())\n-         listPresetFilePatterns_.setEnabled(true);\n+          Exclude.StandardGit.ordinal())\n+      {\n+         ((Element) listPresetFilePatterns_.getElement().getChild(\n+            Include.CommonRSourceFiles.ordinal())).removeAttribute(\"disabled\");\n+         ((Element) listPresetFilePatterns_.getElement().getChild(\n+            Include.RScripts.ordinal())).removeAttribute(\"disabled\");\n+         ((Element) listPresetFilePatterns_.getElement().getChild(\n+            Include.CustomFilter.ordinal())).removeAttribute(\"disabled\");\n+      }\n       else\n       {\n-         listPresetFilePatterns_.setEnabled(false);\n-         listPresetFilePatterns_.setSelectedIndex(IncludeFilePatterns.AllFiles.ordinal());\n+         // when using standard git exclusions we don't have the option to search recursively and\n+         // specify file types\n+         ((Element) listPresetFilePatterns_.getElement().getChild(", "originalCommit": "e2054d70781b71d76ff46d659f70987b3c0c3c5b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM4MDc3Ng==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r370380776", "bodyText": "done!", "author": "melissa-barca", "createdAt": "2020-01-23T22:07:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3ODAyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI4MTI4MQ==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r370281281", "bodyText": "This is also very verbose. I think all that's needed to simplify this is a method to select the index with the given value. I feel like we already have something like this (and if we don't it should be pretty easy to add!)", "author": "jmcphers", "createdAt": "2020-01-23T18:24:32Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/output/find/FindInFilesDialog.java", "diffHunk": "@@ -374,28 +416,41 @@ public void setState(State dialogState)\n       checkboxRegex_.setValue(dialogState.isRegex());\n       dirChooser_.setText(dialogState.getPath());\n \n-      // indexes refer to corresponding enums, but left as ints for readability\n       String includeFilePatterns = StringUtil.join(\n             Arrays.asList(dialogState.getFilePatterns()), \", \");\n-      if (listPresetFilePatterns_.getValue(0) == includeFilePatterns)\n-         listPresetFilePatterns_.setSelectedIndex(0);\n-      else if (listPresetFilePatterns_.getValue(1) == includeFilePatterns)\n-         listPresetFilePatterns_.setSelectedIndex(1);\n-      else if (listPresetFilePatterns_.getValue(2) == includeFilePatterns)\n-         listPresetFilePatterns_.setSelectedIndex(2);\n+      if (includeFilePatterns == \n+          listPresetFilePatterns_.getValue(Include.AllFiles.ordinal()))", "originalCommit": "e2054d70781b71d76ff46d659f70987b3c0c3c5b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM3MzAyOA==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r370373028", "bodyText": "AFAIK there is no existing method to handle this. Where do you think would be the best place to add this function? listPresetFilePatterns_ is a gwt ListBox object - we currently have one object that inherits from it -- FormListBox that only has one method void setElementId(id) - would this be a good place?", "author": "melissa-barca", "createdAt": "2020-01-23T21:48:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI4MTI4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ5MDI2Nw==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r371490267", "bodyText": "Yes, I think that'd be a good spot!", "author": "jmcphers", "createdAt": "2020-01-27T21:24:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI4MTI4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUxNzE1MQ==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r371517151", "bodyText": "Alright, ready for review again \ud83d\udc4d", "author": "melissa-barca", "createdAt": "2020-01-27T22:24:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI4MTI4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI4MjE3Mg==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r370282172", "bodyText": "Maybe worth logging what arguments we received that we didn't expect?", "author": "jmcphers", "createdAt": "2020-01-23T18:26:32Z", "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -1169,11 +1225,10 @@ core::Error runGrepOperation(const GrepOptions& grepOptions, const ReplaceOption\n       cmd << tempFile;\n       if (!grepOptions.asRegex())\n          cmd << \"-F\";\n-      for (json::Value filePattern : grepOptions.includeFilePatterns())\n-      {\n-         cmd << shell_utils::EscapeFilesOnly << \"--\" << shell_utils::EscapeAll;\n-         cmd << filePattern.getString();\n-      }\n+      addDirectoriesToCommand(grepOptions.packageFlag(), dirPath, &cmd);\n+\n+      if (grepOptions.packageFlag() && !grepOptions.includeArgs().empty())\n+         LOG_DEBUG_MESSAGE(\"Unknown include argument(s)\");", "originalCommit": "e2054d70781b71d76ff46d659f70987b3c0c3c5b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM4NDExMg==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r370384112", "bodyText": "done :)", "author": "melissa-barca", "createdAt": "2020-01-23T22:15:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI4MjE3Mg=="}], "type": "inlineReview"}, {"oid": "5f301b22a1a8d2cb1d7d761b244e82397ea2c410", "url": "https://github.com/rstudio/rstudio/commit/5f301b22a1a8d2cb1d7d761b244e82397ea2c410", "message": "clean up warning message\nimplement and use dom utility to disable or an enable an option", "committedDate": "2020-01-23T22:07:25Z", "type": "commit"}, {"oid": "5a2d90e7930a464661cfe6ffdc7a1638dfd11245", "url": "https://github.com/rstudio/rstudio/commit/5a2d90e7930a464661cfe6ffdc7a1638dfd11245", "message": "add specifics to debug message", "committedDate": "2020-01-23T22:15:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ5MTkwOA==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r371491908", "bodyText": "Doxygen style params should be either documented (i.e. explain what each one is) or omitted.", "author": "jmcphers", "createdAt": "2020-01-27T21:27:54Z", "path": "src/gwt/src/org/rstudio/core/client/dom/DomUtils.java", "diffHunk": "@@ -1152,6 +1152,21 @@ public static void setPlaceholder(TextBox w, String placeholder)\n       setPlaceholder(w.getElement(), placeholder);\n    }\n \n+   /**\n+    * Set disabled attribute on an element's child\n+    * @param element\n+    * @param ordinal\n+    * @param disable", "originalCommit": "5a2d90e7930a464661cfe6ffdc7a1638dfd11245", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUxNzIzMg==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r371517232", "bodyText": "Updated", "author": "melissa-barca", "createdAt": "2020-01-27T22:25:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ5MTkwOA=="}], "type": "inlineReview"}, {"oid": "ce40ab9d46b2dfec6143eaf33610d18646b3b27e", "url": "https://github.com/rstudio/rstudio/commit/ce40ab9d46b2dfec6143eaf33610d18646b3b27e", "message": "move getIndexFromValue to FormListBox and switch find in files dialog to use FormListBox.\nWhen Package Source is selected and the user selects a non-package directory,\nswitch include option to All Files", "committedDate": "2020-01-27T22:16:50Z", "type": "commit"}, {"oid": "bdcf2da42727e147f7535ab2ab55208d7ceaec81", "url": "https://github.com/rstudio/rstudio/commit/bdcf2da42727e147f7535ab2ab55208d7ceaec81", "message": "comment the parameters in function", "committedDate": "2020-01-27T22:22:07Z", "type": "commit"}, {"oid": "3f0982867404b8f22f0fd19fe9cc8aaea7d3005d", "url": "https://github.com/rstudio/rstudio/commit/3f0982867404b8f22f0fd19fe9cc8aaea7d3005d", "message": "change TODO to normal comment", "committedDate": "2020-01-27T22:24:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUyNTU0MQ==", "url": "https://github.com/rstudio/rstudio/pull/6040#discussion_r371525541", "bodyText": "Nit: to avoid cluttering the logs for each unexpected argument, could it make sense to log \"Unknown include argument(s): \" + boost::join(grepOptions.includeArgs(), \", \") instead?", "author": "MariaSemple", "createdAt": "2020-01-27T22:46:00Z", "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -1169,10 +1225,12 @@ core::Error runGrepOperation(const GrepOptions& grepOptions, const ReplaceOption\n       cmd << tempFile;\n       if (!grepOptions.asRegex())\n          cmd << \"-F\";\n-      for (json::Value filePattern : grepOptions.includeFilePatterns())\n+      addDirectoriesToCommand(grepOptions.packageFlag(), dirPath, &cmd);\n+\n+      if (grepOptions.packageFlag() && !grepOptions.includeArgs().empty())\n       {\n-         cmd << shell_utils::EscapeFilesOnly << \"--\" << shell_utils::EscapeAll;\n-         cmd << filePattern.getString();\n+         for (std::string arg : grepOptions.includeArgs())\n+            LOG_DEBUG_MESSAGE(\"Unknown include argument: \" + arg);", "originalCommit": "3f0982867404b8f22f0fd19fe9cc8aaea7d3005d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1599f4506b6a863995b08eb870f6e1465c58854b", "url": "https://github.com/rstudio/rstudio/commit/1599f4506b6a863995b08eb870f6e1465c58854b", "message": "simplify comment", "committedDate": "2020-01-27T22:53:34Z", "type": "commit"}]}