{"pr_number": 5973, "pr_title": "Scan R Markdown YAML header for dependencies", "pr_createdAt": "2020-01-07T22:44:50Z", "pr_url": "https://github.com/rstudio/rstudio/pull/5973", "timeline": [{"oid": "663144569d8f8b44150c732bc8d2a9d50305221e", "url": "https://github.com/rstudio/rstudio/commit/663144569d8f8b44150c732bc8d2a9d50305221e", "message": "scan R Markdown YAML header for dependencies", "committedDate": "2020-01-07T22:41:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk5MjM5OQ==", "url": "https://github.com/rstudio/rstudio/pull/5973#discussion_r363992399", "bodyText": "Is it possible that some users might want to reference unexported functions here; e.g. pkg:::bar?", "author": "kevinushey", "createdAt": "2020-01-07T22:56:52Z", "path": "src/cpp/session/modules/SessionCodeTools.R", "diffHunk": "@@ -2122,8 +2114,58 @@\n       return(character())\n \n    }\n-   \n+\n    discoveries <- new.env(parent = emptyenv())\n+\n+   # for R Markdown docs, scan the YAML header (requires the YAML package, a dependency of\n+   # rmarkdown)\n+   if (requireNamespace(\"yaml\", quietly = TRUE))\n+   {\n+      # split document into sections based on the YAML header delimter\n+      sections <- unlist(strsplit(contents, \"---\", fixed = TRUE))\n+      if (length(sections) > 2)\n+      {\n+         front <- yaml::read_yaml(text = sections[[2]])\n+\n+         # start with an empty output\n+         output <- NULL\n+\n+         if (!is.null(names(front$output)))\n+         {\n+            # if the output key has children, it will appear as a list name\n+            # output:\n+            #   pkg_name::out_fmt:\n+            #     foo: bar\n+            output <- names(front$output)[[1]]\n+         }\n+         else if (is.character(front$output))\n+         {\n+            # if the output key doesn't have children, it will appear as a plain character\n+            #\n+            # output: pkg_name::out_fmt\n+            output <- front$output\n+         }\n+\n+         # check for references to an R package in output format\n+         if (!is.null(output))\n+         {\n+            format <- unlist(strsplit(output, \"::\"))", "originalCommit": "663144569d8f8b44150c732bc8d2a9d50305221e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk5NjM1NA==", "url": "https://github.com/rstudio/rstudio/pull/5973#discussion_r363996354", "bodyText": "That's a good question. It is ill-advised and extremely unlikely (and if they do then I think it's okay that autodiscovery doesn't work!)", "author": "jmcphers", "createdAt": "2020-01-07T23:10:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk5MjM5OQ=="}], "type": "inlineReview"}]}