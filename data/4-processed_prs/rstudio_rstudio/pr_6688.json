{"pr_number": 6688, "pr_title": "Show metadata summary for tibbles in R Notebooks", "pr_createdAt": "2020-04-17T18:27:38Z", "pr_url": "https://github.com/rstudio/rstudio/pull/6688", "timeline": [{"oid": "00f71f7b10aae5bcddb0ee4735d2108a99f5b84e", "url": "https://github.com/rstudio/rstudio/commit/00f71f7b10aae5bcddb0ee4735d2108a99f5b84e", "message": "initial plumbing for tibble metadata", "committedDate": "2020-04-16T23:51:49Z", "type": "commit"}, {"oid": "76e04d93d1a0799305392c4502384ebf016f86c3", "url": "https://github.com/rstudio/rstudio/commit/76e04d93d1a0799305392c4502384ebf016f86c3", "message": "better treatment for metadata", "committedDate": "2020-04-17T17:57:46Z", "type": "commit"}, {"oid": "dc8af59e0bc865d03740ce92a97ae40f9dbbbada", "url": "https://github.com/rstudio/rstudio/commit/dc8af59e0bc865d03740ce92a97ae40f9dbbbada", "message": "run prettier on javascript", "committedDate": "2020-04-17T18:21:30Z", "type": "commit"}, {"oid": "c6a5ff3349905c57235b95b7c6b29297721ed8fd", "url": "https://github.com/rstudio/rstudio/commit/c6a5ff3349905c57235b95b7c6b29297721ed8fd", "message": "update NEWS", "committedDate": "2020-04-17T18:30:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjU5NDU0NA==", "url": "https://github.com/rstudio/rstudio/pull/6688#discussion_r412594544", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if (isNamespaceLoaded(\"tibble\"))\n          \n          \n            \n                if (\"tibble\" %in% loadedNamespaces())\n          \n      \n    \n    \n  \n\nisNamespaceLoaded() was added in R 3.2.0, and so is a bit too new for us to use.", "author": "kevinushey", "createdAt": "2020-04-22T01:05:24Z", "path": "src/cpp/session/modules/NotebookData.R", "diffHunk": "@@ -92,9 +92,16 @@\n       options,\n       file = output)\n \n-    .Call(\"rs_recordData\", output, list(classes = className,\n-                                        nrow = nRow, \n-                                        ncol = nCol))\n+    # standard metadata\n+    metadata <- list(classes = className, nrow = nRow, ncol = nCol, summary = list())\n+\n+    # if tibble is loaded, use it to create a summary of the object\n+    if (isNamespaceLoaded(\"tibble\"))", "originalCommit": "c6a5ff3349905c57235b95b7c6b29297721ed8fd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjU5NDY0NA==", "url": "https://github.com/rstudio/rstudio/pull/6688#discussion_r412594644", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                .Call(\"rs_recordData\", output, metadata)\n          \n          \n            \n                .Call(\"rs_recordData\", output, metadata, PACKAGE = \"(embedding)\")", "author": "kevinushey", "createdAt": "2020-04-22T01:05:40Z", "path": "src/cpp/session/modules/NotebookData.R", "diffHunk": "@@ -92,9 +92,16 @@\n       options,\n       file = output)\n \n-    .Call(\"rs_recordData\", output, list(classes = className,\n-                                        nrow = nRow, \n-                                        ncol = nCol))\n+    # standard metadata\n+    metadata <- list(classes = className, nrow = nRow, ncol = nCol, summary = list())\n+\n+    # if tibble is loaded, use it to create a summary of the object\n+    if (isNamespaceLoaded(\"tibble\"))\n+    {\n+       metadata$summary <- as.list(tibble::tbl_sum(original))\n+    }\n+\n+    .Call(\"rs_recordData\", output, metadata)", "originalCommit": "c6a5ff3349905c57235b95b7c6b29297721ed8fd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjU5NjEzOQ==", "url": "https://github.com/rstudio/rstudio/pull/6688#discussion_r412596139", "bodyText": "This check feels a bit awkward, since I don't think there's any real guarantee that two empty objects are identical:\n$ node\nWelcome to Node.js v13.13.0.\nType \".help\" for more information.\n> {} === {}\nfalse\n\nMaybe instead check for the length of Object.keys(options.metadata)?", "author": "kevinushey", "createdAt": "2020-04-22T01:10:18Z", "path": "src/cpp/session/resources/pagedtable/pagedtable.js", "diffHunk": "@@ -525,6 +528,36 @@ var PagedTable = function (pagedTable) {\n \n     var fragment = document.createDocumentFragment();\n \n+    // show metadata on top of header\n+    if (options.metadata !== {}) {", "originalCommit": "00f71f7b10aae5bcddb0ee4735d2108a99f5b84e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE1ODEzNw==", "url": "https://github.com/rstudio/rstudio/pull/6688#discussion_r413158137", "bodyText": "I did exactly this last week in 76e04d9 -- no idea why GH showed you the old diff!", "author": "jmcphers", "createdAt": "2020-04-22T17:03:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjU5NjEzOQ=="}], "type": "inlineReview"}, {"oid": "2f644f29defc3f81baffc6cdc988e4698dbd9aaa", "url": "https://github.com/rstudio/rstudio/commit/2f644f29defc3f81baffc6cdc988e4698dbd9aaa", "message": "Apply suggestions from code review\n\nCo-Authored-By: Kevin Ushey <kevin@rstudio.com>", "committedDate": "2020-04-22T17:00:10Z", "type": "commit"}, {"oid": "6a664d069c4fcc2cd7ce697545b0014809eefe90", "url": "https://github.com/rstudio/rstudio/commit/6a664d069c4fcc2cd7ce697545b0014809eefe90", "message": "Merge remote-tracking branch 'origin/master' into feature/notebook-chunk-metadata", "committedDate": "2020-04-22T17:01:46Z", "type": "commit"}]}