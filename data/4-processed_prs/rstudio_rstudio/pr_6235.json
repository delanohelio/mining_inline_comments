{"pr_number": 6235, "pr_title": "Fix global replace on Windows", "pr_createdAt": "2020-02-14T22:28:50Z", "pr_url": "https://github.com/rstudio/rstudio/pull/6235", "timeline": [{"oid": "b14e9ec73c46d6e18ca46400161aeb334e6b13bf", "url": "https://github.com/rstudio/rstudio/commit/b14e9ec73c46d6e18ca46400161aeb334e6b13bf", "message": "show error message if completeFileReplace fails", "committedDate": "2020-02-14T21:17:03Z", "type": "commit"}, {"oid": "594c424949d499f42f92886d391ba2256f3e610c", "url": "https://github.com/rstudio/rstudio/commit/594c424949d499f42f92886d391ba2256f3e610c", "message": "Do not perform final testWritePermissions on Windows", "committedDate": "2020-02-14T22:21:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTY3ODMyMg==", "url": "https://github.com/rstudio/rstudio/pull/6235#discussion_r379678322", "bodyText": "I think we should wrap the whole test in the ifndef; the rest of the code is a guaranteed no-op on other platforms since there will never be an error.", "author": "jmcphers", "createdAt": "2020-02-14T22:45:50Z", "path": "src/cpp/session/modules/SessionFind.cpp", "diffHunk": "@@ -517,17 +517,27 @@ class GrepOperation : public boost::enable_shared_from_this<GrepOperation>\n       }\n    }\n \n-   Error completeFileReplace()\n+   Error completeFileReplace(std::set<std::string>* pErrorMessage)\n    {\n       if (fileSuccess_)\n       {\n          if (!currentFile_.empty() &&\n              !tempReplaceFile_.getAbsolutePath().empty() &&\n              outputStream_->good())\n          {\n-            Error error = FilePath(currentFile_).testWritePermissions();\n+             Error error;\n+             // For Windows we ignore this additional safety check\n+             // it will always fail because we have inputStream_ reading the file\n+#ifndef _WIN32", "originalCommit": "594c424949d499f42f92886d391ba2256f3e610c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTY4NjQwOQ==", "url": "https://github.com/rstudio/rstudio/pull/6235#discussion_r379686409", "bodyText": "Good point, I fixed this and found another situation where we weren't returning a proper error message if the move failed so I fixed that too.", "author": "melissa-barca", "createdAt": "2020-02-14T23:20:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTY3ODMyMg=="}], "type": "inlineReview"}, {"oid": "69ed8e500078f3cd854a3a725812d356dabc8e81", "url": "https://github.com/rstudio/rstudio/commit/69ed8e500078f3cd854a3a725812d356dabc8e81", "message": "wrap full testWritePermissions test in ifndef, return errors if the move command fails", "committedDate": "2020-02-14T23:18:59Z", "type": "commit"}]}