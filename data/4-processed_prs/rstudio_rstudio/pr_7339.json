{"pr_number": 7339, "pr_title": "Add new UI for additional source columns and remove feature flag", "pr_createdAt": "2020-07-13T20:44:21Z", "pr_url": "https://github.com/rstudio/rstudio/pull/7339", "timeline": [{"oid": "bca2acfdb3c2a01370fa4ccdc6725a634f765dfc", "url": "https://github.com/rstudio/rstudio/commit/bca2acfdb3c2a01370fa4ccdc6725a634f765dfc", "message": "remove enable additional columns user pref and update add columns UI", "committedDate": "2020-07-13T17:48:38Z", "type": "commit"}, {"oid": "9c87f32a9a709360b1186dc908dcb85946463fdf", "url": "https://github.com/rstudio/rstudio/commit/9c87f32a9a709360b1186dc908dcb85946463fdf", "message": "remove unused function", "committedDate": "2020-07-13T17:51:00Z", "type": "commit"}, {"oid": "5e46fa8b7f1a698cb950bc680f6eb7bcbcdb561a", "url": "https://github.com/rstudio/rstudio/commit/5e46fa8b7f1a698cb950bc680f6eb7bcbcdb561a", "message": "Merge branch 'master' of https://github.com/rstudio/rstudio into feature/columns-options", "committedDate": "2020-07-13T19:14:03Z", "type": "commit"}, {"oid": "3dcba1f6abec568cca78e145bae54e7f9e5d48ab", "url": "https://github.com/rstudio/rstudio/commit/3dcba1f6abec568cca78e145bae54e7f9e5d48ab", "message": "clean up consolidate function", "committedDate": "2020-07-13T20:32:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkzMzk5MA==", "url": "https://github.com/rstudio/rstudio/pull/7339#discussion_r453933990", "bodyText": "What do you think about leaving this option in and just changing the default to true? The reason I suggest this is that it's come up at least once in conversation that in some environments we might actually want to constrain the UI (e.g. in a tutorial mode where we need to preserve the \"only one file is open\" invariant). We could use the option to do this since you've already done the wiring, though we might want to rename it to something more specific.", "author": "jmcphers", "createdAt": "2020-07-13T21:08:40Z", "path": "src/cpp/session/resources/schema/user-prefs-schema.json", "diffHunk": "@@ -210,12 +210,6 @@\n             },\n             \"description\": \"Layout of panes in the RStudio workbench.\"\n         },\n-        \"enable_additional_columns\": {\n-           \"type\": \"boolean\",\n-           \"default\": false,", "originalCommit": "3dcba1f6abec568cca78e145bae54e7f9e5d48ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDAxMzQzOA==", "url": "https://github.com/rstudio/rstudio/pull/7339#discussion_r454013438", "bodyText": "Done! I added \"Allow Source Columns\" which defaults to true.", "author": "melissa-barca", "createdAt": "2020-07-13T23:49:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkzMzk5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDAxNzAzOQ==", "url": "https://github.com/rstudio/rstudio/pull/7339#discussion_r454017039", "bodyText": "Anything to worry about if a user has added source columns, then switches off this preference? Do existing source columns get closed or do they continue to function, that sort of thing?", "author": "gtritchie", "createdAt": "2020-07-14T00:00:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkzMzk5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDAxOTA4Nw==", "url": "https://github.com/rstudio/rstudio/pull/7339#discussion_r454019087", "bodyText": "The columns will persist until the user refreshes the browser, then any open tabs are moved to the main source column. The Remove Column button in Global Options is still enabled after the option is turned off so the user could go there to remove columns. Removing them as soon as the option is set to Off seems jarring.", "author": "melissa-barca", "createdAt": "2020-07-14T00:07:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkzMzk5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDAyMjA3NQ==", "url": "https://github.com/rstudio/rstudio/pull/7339#discussion_r454022075", "bodyText": "Not suggesting we remove them when option is turned off, was just curious how it behaves.", "author": "gtritchie", "createdAt": "2020-07-14T00:18:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkzMzk5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkzNTAwNQ==", "url": "https://github.com/rstudio/rstudio/pull/7339#discussion_r453935005", "bodyText": "Maybe personal preference but I think it looks a little odd to have square corners (from the options dropdowns) right up against these rounded ones. Can we tone these borders down a little (just a dark gray) and reduce the radius?", "author": "jmcphers", "createdAt": "2020-07-13T21:10:40Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/prefs/views/PreferencesDialog.css", "diffHunk": "@@ -27,16 +27,28 @@\n    margin-bottom: 11px;\n }\n \n+.paneLayoutTable {\n+   height: 160px;\n+}\n+\n .paneLayoutTable td.paneLayoutTable {\n    background-color: white;\n-   height: 200px;\n    vertical-align: top;\n-   padding-top: 0px;\n+   padding: 0px;\n+   border: 1px solid #1e77bc;", "originalCommit": "3dcba1f6abec568cca78e145bae54e7f9e5d48ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDAxMzk5OQ==", "url": "https://github.com/rstudio/rstudio/pull/7339#discussion_r454013999", "bodyText": "I changed the border and added a screenshot to this PR's description.", "author": "melissa-barca", "createdAt": "2020-07-13T23:50:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkzNTAwNQ=="}], "type": "inlineReview"}, {"oid": "e15244bd5db875a184694f20b0b35d8e38230826", "url": "https://github.com/rstudio/rstudio/commit/e15244bd5db875a184694f20b0b35d8e38230826", "message": "add Allow Source Columns user pref so adding source columns can be disabled", "committedDate": "2020-07-13T23:41:52Z", "type": "commit"}, {"oid": "eb7ae4c3c46a09246ce1d868d36cbfb8d9b8b32c", "url": "https://github.com/rstudio/rstudio/commit/eb7ae4c3c46a09246ce1d868d36cbfb8d9b8b32c", "message": "tone down borders", "committedDate": "2020-07-13T23:48:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDAzMzA4Ng==", "url": "https://github.com/rstudio/rstudio/pull/7339#discussion_r454033086", "bodyText": "Recommend giving this table an accessible name; this is a cheap but effective accessibility improvement for screen reader users.\n     Roles.getGridRole().setAriaLabelProperty(grid_.getElement(), \"Columns and Panes Layout\");", "author": "gtritchie", "createdAt": "2020-07-14T00:53:05Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/prefs/views/PaneLayoutPreferencesPane.java", "diffHunk": "@@ -320,13 +331,121 @@ else if (!otherIndices.get(i))\n       updateTabSetLabels();\n    }\n \n+   private String updateTable(int newCount)\n+   {\n+      // nothing has changed since the last update\n+      if (grid_ != null && displayColumnCount_ == newCount)\n+         return \"\";\n+\n+      // cells will be twice a wide as columns to preserve space\n+      double columnCount = newCount + (2 * GRID_PANE_COUNT);\n+      double columnWidthValue = (double)TABLE_WIDTH / columnCount;\n+      double cellWidthValue = columnWidthValue * GRID_PANE_COUNT;\n+\n+      // If the column width is bigger than MAX_COLUMN_WIDTH, give space back to the panes\n+      if (newCount > 0 && Math.min(columnWidthValue, MAX_COLUMN_WIDTH) != columnWidthValue)\n+      {\n+         double extra = (newCount * (columnWidthValue - MAX_COLUMN_WIDTH)) / GRID_PANE_COUNT;\n+         cellWidthValue += extra;\n+         columnWidthValue = MAX_COLUMN_WIDTH;\n+      }\n+      cellWidthValue -= (GRID_CELL_SPACING + GRID_CELL_PADDING);\n+      columnWidthValue -= (GRID_CELL_SPACING + GRID_CELL_PADDING);\n+\n+      final String columnWidth = columnWidthValue + \"px\";\n+      final String cellWidth = cellWidthValue + \"px\";\n+      leftTop_.setWidth(cellWidth);\n+      leftBottom_.setWidth(cellWidth);\n+      rightTop_.setWidth(cellWidth);\n+      rightBottom_.setWidth(cellWidth);\n+\n+      // create grid\n+      if (grid_ == null)\n+      {\n+         grid_ = new FlexTable();\n+         grid_.addStyleName(res_.styles().paneLayoutTable());\n+         grid_.setCellSpacing(GRID_CELL_SPACING);\n+         grid_.setCellPadding(GRID_CELL_PADDING);\n+", "originalCommit": "eb7ae4c3c46a09246ce1d868d36cbfb8d9b8b32c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "144eb6fee2105f5a7fb4526a0877a0a8e4b7d764", "url": "https://github.com/rstudio/rstudio/commit/144eb6fee2105f5a7fb4526a0877a0a8e4b7d764", "message": "add accessibility name to grid", "committedDate": "2020-07-14T03:26:36Z", "type": "commit"}, {"oid": "f2ddbf9906d05360650c24da899f5662781c414a", "url": "https://github.com/rstudio/rstudio/commit/f2ddbf9906d05360650c24da899f5662781c414a", "message": "move 'Source' label to top of column, increase padding around drop downs,\ndisable/enable column buttons depending on the current display", "committedDate": "2020-07-14T18:29:02Z", "type": "commit"}, {"oid": "a3d282e4c104e20dced8b4e4207d8d2e6dca2a92", "url": "https://github.com/rstudio/rstudio/commit/a3d282e4c104e20dced8b4e4207d8d2e6dca2a92", "message": "Merge branches 'feature/columns-options' and 'master' of https://github.com/rstudio/rstudio into feature/columns-options\n\n\u0001 Conflicts:\n\u0001\tsrc/gwt/src/org/rstudio/studio/client/workbench/prefs/views/PaneLayoutPreferencesPane.java", "committedDate": "2020-07-15T23:35:23Z", "type": "commit"}]}