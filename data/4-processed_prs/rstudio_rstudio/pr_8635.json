{"pr_number": 8635, "pr_title": "Always report startup configuration related errors to stderr, even if not connected to a terminal", "pr_createdAt": "2020-12-18T15:34:50Z", "pr_url": "https://github.com/rstudio/rstudio/pull/8635", "timeline": [{"oid": "48243d96f391716d931eaab0e968a1dcb9a35130", "url": "https://github.com/rstudio/rstudio/commit/48243d96f391716d931eaab0e968a1dcb9a35130", "message": "Always report startup configuration related errors to stderr, even if\nnot connected to a terminal.\n\nThis is done because when installing on CentOS, we want to see these error\nmessages. However, due to how that process works, the terminal is not actually\nconnected to the installing rserver process. Any errors encountered will be logged\nto syslog, but they will not directly be shown to the user. Forcing these writes\nto stderr ensures they show up.\n\nFixes https://github.com/rstudio/rstudio-pro/issues/2214.", "committedDate": "2020-12-18T15:28:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjgzMjcxNg==", "url": "https://github.com/rstudio/rstudio/pull/8635#discussion_r546832716", "bodyText": "Prior to this change, reportError would always log the error -- now many errors won't be logged if stderr is a terminal. Is that intentional?", "author": "jmcphers", "createdAt": "2020-12-21T17:25:23Z", "path": "src/cpp/core/ProgramOptions.cpp", "diffHunk": "@@ -54,21 +54,42 @@ bool validateOptionsProvided(const variables_map& vm,\n \n }\n \n-void reportError(const Error& error, const ErrorLocation& location)\n+void reportError(const Error& error, const ErrorLocation& location, bool forceStderr)\n {\n    std::string description = error.getProperty(\"description\");\n    if (core::system::stderrIsTerminal() && !description.empty())\n+   {\n       std::cerr << description << std::endl;\n+   }\n+   else\n+   {\n+      // in some cases, we may need to force stderr to be written\n+      // for example, during installation on RedHat systems, stderr\n+      // is not properly hooked up to a terminal when checking configuration during post install scripts\n+      // which would cause error output to go only to syslog and be hidden from view during install\n+      if (forceStderr && !description.empty())\n+         std::cerr << description << std::endl;\n+\n+      core::log::logError(error, location);", "originalCommit": "48243d96f391716d931eaab0e968a1dcb9a35130", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njk5NjYyMQ==", "url": "https://github.com/rstudio/rstudio/pull/8635#discussion_r546996621", "bodyText": "@kfeinauer, since you're OOO I made this change --- f54f851. LMK if that doesn't look correct.", "author": "jmcphers", "createdAt": "2020-12-22T00:16:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjgzMjcxNg=="}], "type": "inlineReview"}, {"oid": "f54f85170c024ebf0521a4ffd0e8e292e4e05d88", "url": "https://github.com/rstudio/rstudio/commit/f54f85170c024ebf0521a4ffd0e8e292e4e05d88", "message": "always log to syslog, too", "committedDate": "2020-12-22T00:10:47Z", "type": "commit"}, {"oid": "37a5402708736b45c18a97ea0782da44db43aed6", "url": "https://github.com/rstudio/rstudio/commit/37a5402708736b45c18a97ea0782da44db43aed6", "message": "update NEWS", "committedDate": "2020-12-22T00:12:33Z", "type": "commit"}]}