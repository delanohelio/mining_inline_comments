{"pr_number": 8226, "pr_title": "handle UTF-8 paths when opening projects via API", "pr_createdAt": "2020-10-29T18:04:54Z", "pr_url": "https://github.com/rstudio/rstudio/pull/8226", "timeline": [{"oid": "1e7e0f26540e3eb9798db280c4df15572069a0a8", "url": "https://github.com/rstudio/rstudio/commit/1e7e0f26540e3eb9798db280c4df15572069a0a8", "message": "handle UTF-8 paths when opening projects via API", "committedDate": "2020-10-29T18:01:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU3Nzg3OQ==", "url": "https://github.com/rstudio/rstudio/pull/8226#discussion_r514577879", "bodyText": "nit: should we do this in an on.exit so that an error condition doesn't leave the altered path as a side effect?", "author": "jmcphers", "createdAt": "2020-10-29T21:26:42Z", "path": "src/cpp/r/R/Api.R", "diffHunk": "@@ -65,11 +65,14 @@\n    # attempt to initialize a project within that directory\n    .rs.ensureDirectory(path)\n    \n-   # check to see if a .Rproj file already exists in that directory;\n-   # if so, then we don't need to re-initialize\n-   rProjFiles <- list.files(path, \n-                            pattern = \"[.]Rproj$\",\n-                            full.names = TRUE)\n+   # NOTE: list.files() will fail on Windows for paths containing\n+   # characters not representable in the current locale, so we instead\n+   # change to the requested directory, list files, and then build the\n+   # full paths\n+   owd <- setwd(path)\n+   rProjFiles <- list.files(pattern = \"[.]Rproj$\")\n+   rProjFiles <- normalizePath(rProjFiles, winslash = \"/\", mustWork = TRUE)\n+   setwd(owd)", "originalCommit": "1e7e0f26540e3eb9798db280c4df15572069a0a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a8643ca7d46838b305056887d7b11b4c45d79e37", "url": "https://github.com/rstudio/rstudio/commit/a8643ca7d46838b305056887d7b11b4c45d79e37", "message": "use on.exit() to ensure working directory restored", "committedDate": "2020-10-29T23:32:00Z", "type": "commit"}]}