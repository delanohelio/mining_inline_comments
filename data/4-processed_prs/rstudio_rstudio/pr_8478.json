{"pr_number": 8478, "pr_title": "be compatible with UCRT builds of R", "pr_createdAt": "2020-11-24T23:07:25Z", "pr_url": "https://github.com/rstudio/rstudio/pull/8478", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzY1Mjc1Ng==", "url": "https://github.com/rstudio/rstudio/pull/8478#discussion_r533652756", "bodyText": "\ud83e\udd2e", "author": "jmcphers", "createdAt": "2020-12-01T19:04:27Z", "path": "src/cpp/r/session/REmbeddedWin32.cpp", "diffHunk": "@@ -104,6 +106,74 @@ int askYesNoCancel(const char* question)\n    }\n }\n \n+bool initializeMaxMemoryDangerously()\n+{\n+   Error error;\n+\n+   void* pLibrary = nullptr;\n+   error = core::system::loadLibrary(\"R.dll\", &pLibrary);\n+   if (error)\n+      return false;\n+\n+   // first, see if we can load the 'R_max_memory' symbol directly\n+   size_t* p_R_max_memory = nullptr;\n+   error = core::system::loadSymbol(\n+            pLibrary,\n+            \"R_max_memory\",\n+            (void**) &p_R_max_memory);\n+\n+   if (error)\n+   {\n+      // terrible, terrible hack -- for typical builds of R from CRAN,\n+      // the memory address for R_max_memory lies just before the\n+      // Rwin_graphicsx symbol, so find that symbol, and compute the\n+      // position of R_max_memory offset from that\n+      char* p_Rwin_graphicsx = nullptr;\n+      error = core::system::loadSymbol(\n+               pLibrary,\n+               \"Rwin_graphicsx\",\n+               (void**) &p_Rwin_graphicsx);\n+\n+      if (error)\n+         return false;\n+\n+      // get memory address for R_max_memory\n+      p_R_max_memory = (size_t*) (p_Rwin_graphicsx - sizeof(size_t));", "originalCommit": "f09e8a739448e109a4de58c02d2ae25e711be37a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "902d98f0325f54e58584d074913bcc245302e91c", "url": "https://github.com/rstudio/rstudio/commit/902d98f0325f54e58584d074913bcc245302e91c", "message": "be compatible with UCRT builds of R", "committedDate": "2020-12-01T23:20:25Z", "type": "commit"}, {"oid": "902d98f0325f54e58584d074913bcc245302e91c", "url": "https://github.com/rstudio/rstudio/commit/902d98f0325f54e58584d074913bcc245302e91c", "message": "be compatible with UCRT builds of R", "committedDate": "2020-12-01T23:20:25Z", "type": "forcePushed"}]}