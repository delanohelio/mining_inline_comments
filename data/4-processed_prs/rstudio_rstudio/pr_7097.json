{"pr_number": 7097, "pr_title": "require system libclang on macOS", "pr_createdAt": "2020-06-10T22:29:17Z", "pr_url": "https://github.com/rstudio/rstudio/pull/7097", "timeline": [{"oid": "67b7dc5c446f51736d0c57cb8d19ae19d2d85296", "url": "https://github.com/rstudio/rstudio/commit/67b7dc5c446f51736d0c57cb8d19ae19d2d85296", "message": "reformat", "committedDate": "2020-06-10T22:12:26Z", "type": "commit"}, {"oid": "6d11e200aa65ff50938d71f1cb31fc6571cec4ce", "url": "https://github.com/rstudio/rstudio/commit/6d11e200aa65ff50938d71f1cb31fc6571cec4ce", "message": "use RSTUDIO_LIBCLANG_PATH to request specific version of libclang", "committedDate": "2020-06-10T22:13:05Z", "type": "commit"}, {"oid": "3cc5c7e69b0c8b28ab6e0456f1b2124180ea6573", "url": "https://github.com/rstudio/rstudio/commit/3cc5c7e69b0c8b28ab6e0456f1b2124180ea6573", "message": "require command-line-tools version of libclang", "committedDate": "2020-06-10T22:26:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQ2ODY0OA==", "url": "https://github.com/rstudio/rstudio/pull/7097#discussion_r438468648", "bodyText": "Did something change to make it so we now require the do/while(0) idiom for the macro, or just doing as a best practice? Obviously fine to have it just curious.", "author": "gtritchie", "createdAt": "2020-06-10T23:53:36Z", "path": "src/cpp/core/libclang/LibClang.cpp", "diffHunk": "@@ -20,22 +20,27 @@\n \n #include <boost/regex.hpp>\n \n-#include <core/Log.hpp>\n #include <shared_core/FilePath.hpp>\n-#include <core/RegexUtils.hpp>\n #include <shared_core/SafeConvert.hpp>\n \n+#include <core/Log.hpp>\n+#include <core/RegexUtils.hpp>\n+#include <core/system/Environment.hpp>\n #include <core/system/LibraryLoader.hpp>\n \n-#define LOAD_CLANG_SYMBOL(name) \\\n-   error = core::system::loadSymbol(pLib_, \"clang_\" #name, (void**)&name); \\\n-   if (error) \\\n-   { \\\n-      Error unloadError = unload(); \\\n-      if (unloadError) \\\n-         LOG_ERROR(unloadError); \\\n-      return error; \\\n-   }\n+#define LOAD_CLANG_SYMBOL(name)                                                \\\n+   do                                                                          \\\n+   {                                                                           \\\n+      Error error =                                                            \\\n+         core::system::loadSymbol(pLib_, \"clang_\" #name, (void**) &name);      \\\n+      if (error)                                                               \\\n+      {                                                                        \\\n+         Error unloadError = unload();                                         \\\n+         if (unloadError)                                                      \\\n+            LOG_ERROR(unloadError);                                            \\\n+         return error;                                                         \\\n+      }                                                                        \\\n+   } while (0);", "originalCommit": "3cc5c7e69b0c8b28ab6e0456f1b2124180ea6573", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk5MjE3OA==", "url": "https://github.com/rstudio/rstudio/pull/7097#discussion_r438992178", "bodyText": "Nothing changed here -- just clang-format + best practice for hygienic macros.", "author": "kevinushey", "createdAt": "2020-06-11T18:35:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQ2ODY0OA=="}], "type": "inlineReview"}]}