{"pr_number": 9040, "pr_title": "BAEL-3852 - A Guide to Foreign Memory Access API in Java 14", "pr_createdAt": "2020-04-05T17:53:45Z", "pr_url": "https://github.com/eugenp/tutorials/pull/9040", "timeline": [{"oid": "f2c00851e72640e24b7512b1483616c0ad36ab77", "url": "https://github.com/eugenp/tutorials/commit/f2c00851e72640e24b7512b1483616c0ad36ab77", "message": "Code sample for Java Hexagonal architecture", "committedDate": "2019-09-20T06:43:13Z", "type": "commit"}, {"oid": "e1123cc9ffd692e65415222c5b81bc3bb6090a8a", "url": "https://github.com/eugenp/tutorials/commit/e1123cc9ffd692e65415222c5b81bc3bb6090a8a", "message": "BAEL-3838 Capturing a Java Thread Dump", "committedDate": "2020-02-26T21:56:59Z", "type": "commit"}, {"oid": "01af6fa3791b63189f5792f3300814568e024b3a", "url": "https://github.com/eugenp/tutorials/commit/01af6fa3791b63189f5792f3300814568e024b3a", "message": "Merge branch 'master' of github.com:musibs/tutorials", "committedDate": "2020-04-05T17:10:12Z", "type": "commit"}, {"oid": "57dda319006e3cd1adcfb85ac4d58895737d5d0f", "url": "https://github.com/eugenp/tutorials/commit/57dda319006e3cd1adcfb85ac4d58895737d5d0f", "message": "BAEL-3852 Foreign memory api in Java", "committedDate": "2020-04-05T17:49:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTMyMDgwMQ==", "url": "https://github.com/eugenp/tutorials/pull/9040#discussion_r405320801", "bodyText": "Missing   between {} and {", "author": "ashleyfrieze", "createdAt": "2020-04-08T07:42:44Z", "path": "core-java-modules/core-java-14/src/test/java/com/baeldung/java14/foreign/api/ForeignMemoryUnitTest.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package com.baeldung.java14.foreign.api;\n+\n+import jdk.incubator.foreign.*;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.BlockJUnit4ClassRunner;\n+\n+import java.lang.invoke.VarHandle;\n+import java.nio.ByteOrder;\n+\n+import static org.hamcrest.core.Is.*;\n+import static org.hamcrest.core.Is.is;\n+import static org.junit.Assert.*;\n+import static org.junit.Assert.assertThat;\n+\n+public class ForeignMemoryUnitTest {\n+\n+    @Test\n+    public void whenValueIsSetThenAccessTheValue(){", "originalCommit": "57dda319006e3cd1adcfb85ac4d58895737d5d0f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU5MTc5OA==", "url": "https://github.com/eugenp/tutorials/pull/9040#discussion_r406591798", "bodyText": "Added space between () and { in all unit test methods.", "author": "musibs", "createdAt": "2020-04-10T03:58:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTMyMDgwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTMyMTkyMA==", "url": "https://github.com/eugenp/tutorials/pull/9040#discussion_r405321920", "bodyText": "Unit tests with names that start test often don't explain themselves well. Let's stick with the given_when_then style. Maybe whenSetValuesWithMemoryLayout_thenTheyCanBeRetrieved", "author": "ashleyfrieze", "createdAt": "2020-04-08T07:44:38Z", "path": "core-java-modules/core-java-14/src/test/java/com/baeldung/java14/foreign/api/ForeignMemoryUnitTest.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package com.baeldung.java14.foreign.api;\n+\n+import jdk.incubator.foreign.*;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.BlockJUnit4ClassRunner;\n+\n+import java.lang.invoke.VarHandle;\n+import java.nio.ByteOrder;\n+\n+import static org.hamcrest.core.Is.*;\n+import static org.hamcrest.core.Is.is;\n+import static org.junit.Assert.*;\n+import static org.junit.Assert.assertThat;\n+\n+public class ForeignMemoryUnitTest {\n+\n+    @Test\n+    public void whenValueIsSetThenAccessTheValue(){\n+        long value = 10;\n+        MemoryAddress memoryAddress = MemorySegment.allocateNative(8).baseAddress();\n+        VarHandle varHandle = MemoryHandles.varHandle(long.class, ByteOrder.nativeOrder());\n+        varHandle.set(memoryAddress, value);\n+        assertThat(varHandle.get(memoryAddress), is(value));\n+    }\n+\n+    @Test\n+    public void whenMultipleValuesAreSetThenAccessAll(){\n+        VarHandle varHandle = MemoryHandles.varHandle(int.class, ByteOrder.nativeOrder());\n+        try(MemorySegment memorySegment = MemorySegment.allocateNative(100)){\n+            MemoryAddress base = memorySegment.baseAddress();\n+            for(int i=0; i<25; i++){\n+                varHandle.set(base.addOffset((i*4)), i);\n+            }\n+\n+            for(int i=0; i<25; i++){\n+                assertThat(varHandle.get(base.addOffset((i*4))), is(i));\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void testMemoryLayout(){", "originalCommit": "57dda319006e3cd1adcfb85ac4d58895737d5d0f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU5MjA1OA==", "url": "https://github.com/eugenp/tutorials/pull/9040#discussion_r406592058", "bodyText": "Updated all the unit test method names with the given_when_then  style.", "author": "musibs", "createdAt": "2020-04-10T03:59:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTMyMTkyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTMyMjA0MQ==", "url": "https://github.com/eugenp/tutorials/pull/9040#discussion_r405322041", "bodyText": "Similar test naming issue here.", "author": "ashleyfrieze", "createdAt": "2020-04-08T07:44:51Z", "path": "core-java-modules/core-java-14/src/test/java/com/baeldung/java14/foreign/api/ForeignMemoryUnitTest.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package com.baeldung.java14.foreign.api;\n+\n+import jdk.incubator.foreign.*;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.BlockJUnit4ClassRunner;\n+\n+import java.lang.invoke.VarHandle;\n+import java.nio.ByteOrder;\n+\n+import static org.hamcrest.core.Is.*;\n+import static org.hamcrest.core.Is.is;\n+import static org.junit.Assert.*;\n+import static org.junit.Assert.assertThat;\n+\n+public class ForeignMemoryUnitTest {\n+\n+    @Test\n+    public void whenValueIsSetThenAccessTheValue(){\n+        long value = 10;\n+        MemoryAddress memoryAddress = MemorySegment.allocateNative(8).baseAddress();\n+        VarHandle varHandle = MemoryHandles.varHandle(long.class, ByteOrder.nativeOrder());\n+        varHandle.set(memoryAddress, value);\n+        assertThat(varHandle.get(memoryAddress), is(value));\n+    }\n+\n+    @Test\n+    public void whenMultipleValuesAreSetThenAccessAll(){\n+        VarHandle varHandle = MemoryHandles.varHandle(int.class, ByteOrder.nativeOrder());\n+        try(MemorySegment memorySegment = MemorySegment.allocateNative(100)){\n+            MemoryAddress base = memorySegment.baseAddress();\n+            for(int i=0; i<25; i++){\n+                varHandle.set(base.addOffset((i*4)), i);\n+            }\n+\n+            for(int i=0; i<25; i++){\n+                assertThat(varHandle.get(base.addOffset((i*4))), is(i));\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void testMemoryLayout(){\n+        SequenceLayout sequenceLayout = MemoryLayout.ofSequence(25, MemoryLayout.ofValueBits(64, ByteOrder.nativeOrder()));\n+        VarHandle varHandle = sequenceLayout.varHandle(long.class, MemoryLayout.PathElement.sequenceElement());\n+        try(MemorySegment memorySegment = MemorySegment.allocateNative(sequenceLayout)){\n+            MemoryAddress base = memorySegment.baseAddress();\n+            for(long i=0; i<sequenceLayout.elementCount().getAsLong(); i++){\n+                varHandle.set(base, i, i);\n+            }\n+\n+            for(long i=0; i<sequenceLayout.elementCount().getAsLong(); i++){\n+                assertThat(varHandle.get(base, i), is(i));\n+            }\n+        }\n+    }\n+\n+    @Test\n+    public void testSlicingOfMemorySegment(){", "originalCommit": "57dda319006e3cd1adcfb85ac4d58895737d5d0f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU5MjE2NA==", "url": "https://github.com/eugenp/tutorials/pull/9040#discussion_r406592164", "bodyText": "Updated all the unit test method names with the given_when_then style.", "author": "musibs", "createdAt": "2020-04-10T04:00:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTMyMjA0MQ=="}], "type": "inlineReview"}, {"oid": "e7fa33ab4340e734b16e37f4e5ea596c0251bfd0", "url": "https://github.com/eugenp/tutorials/commit/e7fa33ab4340e734b16e37f4e5ea596c0251bfd0", "message": "BAEL-3852 - Review changes of A Guide to Foreign Memory Access API in Java 14", "committedDate": "2020-04-10T03:56:59Z", "type": "commit"}, {"oid": "b68267071e350b63084c0c6ae02a5b3a3b3e0235", "url": "https://github.com/eugenp/tutorials/commit/b68267071e350b63084c0c6ae02a5b3a3b3e0235", "message": "BAEL-3852 - Additional review changes for A Guide to Foreign Memory Access API in Java 14", "committedDate": "2020-04-10T09:55:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzExNzQwNQ==", "url": "https://github.com/eugenp/tutorials/pull/9040#discussion_r407117405", "bodyText": "FWIW, I find this harder to read than if it were:\n        MemoryAddress memoryAddress = \n            MemorySegment.allocateNative(8)\n                .baseAddress();\nThe reason is that the hanging MemorySegment on the original, is lost from my memory when I read the following line", "author": "ashleyfrieze", "createdAt": "2020-04-11T22:22:55Z", "path": "core-java-modules/core-java-14/src/test/java/com/baeldung/java14/foreign/api/ForeignMemoryUnitTest.java", "diffHunk": "@@ -0,0 +1,84 @@\n+package com.baeldung.java14.foreign.api;\n+\n+import jdk.incubator.foreign.*;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.BlockJUnit4ClassRunner;\n+\n+import java.lang.invoke.VarHandle;\n+import java.nio.ByteOrder;\n+\n+import static org.hamcrest.core.Is.*;\n+import static org.hamcrest.core.Is.is;\n+import static org.junit.Assert.*;\n+import static org.junit.Assert.assertThat;\n+\n+public class ForeignMemoryUnitTest {\n+\n+    @Test\n+    public void whenAValueIsSet_thenAccessTheValue() {\n+        long value = 10;\n+        MemoryAddress memoryAddress = MemorySegment\n+                .allocateNative(8).baseAddress();", "originalCommit": "b68267071e350b63084c0c6ae02a5b3a3b3e0235", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzE2MjE5Mg==", "url": "https://github.com/eugenp/tutorials/pull/9040#discussion_r407162192", "bodyText": "I have aligned the code snippets as per your suggestion.", "author": "musibs", "createdAt": "2020-04-12T07:56:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzExNzQwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzExNzU3MA==", "url": "https://github.com/eugenp/tutorials/pull/9040#discussion_r407117570", "bodyText": "Why is this here?", "author": "ashleyfrieze", "createdAt": "2020-04-11T22:24:52Z", "path": "core-java-modules/core-java-perf/src/main/java/com/baeldung/threaddump/ThreadDump.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.baeldung.threaddump;\n+\n+import java.io.IOException;\n+import java.lang.management.ManagementFactory;\n+import java.lang.management.ThreadInfo;\n+import java.lang.management.ThreadMXBean;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+public class ThreadDump {\n+    \n+    public static void main(String[] args) throws IOException {\n+        threadDump(true, true);\n+    }\n+    \n+    private static void threadDump(boolean lockedMonitors, boolean lockedSynchronizers) throws IOException {\n+        Path threadDumpFile = Paths.get(\"ThreadDump.txt\");\n+        \n+        StringBuffer threadDump = new StringBuffer(System.lineSeparator());\n+        ThreadMXBean threadMXBean = ManagementFactory.getThreadMXBean();\n+        for(ThreadInfo threadInfo : threadMXBean.dumpAllThreads(lockedMonitors, lockedSynchronizers)) {\n+            threadDump.append(threadInfo.toString());\n+        }\n+        Files.write(threadDumpFile, threadDump.toString().getBytes());\n+    }", "originalCommit": "b68267071e350b63084c0c6ae02a5b3a3b3e0235", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzE2MjEyNg==", "url": "https://github.com/eugenp/tutorials/pull/9040#discussion_r407162126", "bodyText": "This commit has accidentally become part of this pull request. It was for my previous article. I have deleted the file and committed the changes.", "author": "musibs", "createdAt": "2020-04-12T07:55:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzExNzU3MA=="}], "type": "inlineReview"}, {"oid": "373be297884202ab6bf1f2032db6aca492f0b8a6", "url": "https://github.com/eugenp/tutorials/commit/373be297884202ab6bf1f2032db6aca492f0b8a6", "message": "Review changes for alignment and class removal", "committedDate": "2020-04-12T07:53:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc5MDY3OQ==", "url": "https://github.com/eugenp/tutorials/pull/9040#discussion_r409790679", "bodyText": "indentation.", "author": "sinsuren", "createdAt": "2020-04-16T19:16:12Z", "path": "core-java-modules/core-java/src/main/java/com/baeldung/java/hexagonal/DefaultUserService.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package com.baeldung.java.hexagonal;\n+\n+import java.util.Collection;\n+import java.util.Optional;\n+\n+/**\n+ *  Default implementation of user service \n+ */\n+public class DefaultUserService implements UserService{", "originalCommit": "373be297884202ab6bf1f2032db6aca492f0b8a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk5NTI2OQ==", "url": "https://github.com/eugenp/tutorials/pull/9040#discussion_r410995269", "bodyText": "These changes are tab indented and should not be in this PR. Please revert them.", "author": "ashleyfrieze", "createdAt": "2020-04-19T21:28:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc5MDY3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc0MjIzOQ==", "url": "https://github.com/eugenp/tutorials/pull/9040#discussion_r412742239", "bodyText": "@sinsuren and @ashleyfrieze\nThanks for the review. These files are part of my first demo article and accidentally part of this PR. I have now removed the complete package. I'll be careful and verify the commits part of the PR.", "author": "musibs", "createdAt": "2020-04-22T07:33:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc5MDY3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc5MTM0OQ==", "url": "https://github.com/eugenp/tutorials/pull/9040#discussion_r409791349", "bodyText": "UserRepository {", "author": "sinsuren", "createdAt": "2020-04-16T19:17:26Z", "path": "core-java-modules/core-java/src/main/java/com/baeldung/java/hexagonal/InMemoryUserRepositoryImpl.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package com.baeldung.java.hexagonal;\n+\n+/**\n+ * An in-memory implementation of the UserRepository\n+ */\n+import java.util.Collection;\n+import java.util.Optional;\n+\n+public class InMemoryUserRepositoryImpl implements UserRepository{", "originalCommit": "373be297884202ab6bf1f2032db6aca492f0b8a6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc5MTYyNg==", "url": "https://github.com/eugenp/tutorials/pull/9040#discussion_r409791626", "bodyText": "space indentation is also not uniform across files.", "author": "sinsuren", "createdAt": "2020-04-16T19:17:55Z", "path": "core-java-modules/core-java/src/main/java/com/baeldung/java/hexagonal/InMemoryUserRepositoryImpl.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package com.baeldung.java.hexagonal;\n+\n+/**\n+ * An in-memory implementation of the UserRepository\n+ */\n+import java.util.Collection;\n+import java.util.Optional;\n+\n+public class InMemoryUserRepositoryImpl implements UserRepository{\n+\n+\t@Override\n+\tpublic User save(User user) {\n+\t\treturn null;", "originalCommit": "373be297884202ab6bf1f2032db6aca492f0b8a6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ccc9fd2a237c0371262939a55e639df9a51001e2", "url": "https://github.com/eugenp/tutorials/commit/ccc9fd2a237c0371262939a55e639df9a51001e2", "message": "Removed incorrectly added old files from the PR", "committedDate": "2020-04-22T07:29:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTAzOTMzMQ==", "url": "https://github.com/eugenp/tutorials/pull/9040#discussion_r419039331", "bodyText": "Indentation guidelines prescribe a 4-space indent for nested blocks and 2-space indent for continuation lines. Please adjust the indentation in this file accordingly.", "author": "KevinGilmore", "createdAt": "2020-05-03T03:11:02Z", "path": "core-java-modules/core-java-14/src/test/java/com/baeldung/java14/foreign/api/ForeignMemoryUnitTest.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package com.baeldung.java14.foreign.api;\n+\n+import jdk.incubator.foreign.*;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.BlockJUnit4ClassRunner;\n+\n+import java.lang.invoke.VarHandle;\n+import java.nio.ByteOrder;\n+\n+import static org.hamcrest.core.Is.*;\n+import static org.hamcrest.core.Is.is;\n+import static org.junit.Assert.*;\n+import static org.junit.Assert.assertThat;\n+\n+public class ForeignMemoryUnitTest {\n+\n+    @Test\n+    public void whenAValueIsSet_thenAccessTheValue() {\n+        long value = 10;\n+        MemoryAddress memoryAddress =\n+                MemorySegment.allocateNative(8)", "originalCommit": "ccc9fd2a237c0371262939a55e639df9a51001e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA0Mzg3NQ==", "url": "https://github.com/eugenp/tutorials/pull/9040#discussion_r419043875", "bodyText": "Thanks for the review and the feedback. I've incorporated the changes as asked. Kindly review,", "author": "musibs", "createdAt": "2020-05-03T04:08:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTAzOTMzMQ=="}], "type": "inlineReview"}, {"oid": "9c4d71732c1dc254dfe07abb31013ac5dc119680", "url": "https://github.com/eugenp/tutorials/commit/9c4d71732c1dc254dfe07abb31013ac5dc119680", "message": "Indentation changes", "committedDate": "2020-05-03T04:07:10Z", "type": "commit"}]}