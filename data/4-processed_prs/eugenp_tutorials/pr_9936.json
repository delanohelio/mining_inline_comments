{"pr_number": 9936, "pr_title": "BAEL-4448: Added examples for setting TLS version in HttpClient", "pr_createdAt": "2020-08-28T18:42:07Z", "pr_url": "https://github.com/eugenp/tutorials/pull/9936", "timeline": [{"oid": "4be1fd44684e364e5652349a310266c911c7fd62", "url": "https://github.com/eugenp/tutorials/commit/4be1fd44684e364e5652349a310266c911c7fd62", "message": "[BAEL-4448] Added examples for setting TLS version in HttpClient\n\n(cherry picked from commit f4d40fc3f3140fd046ed957030e9a54582bd4a67)", "committedDate": "2020-08-28T18:40:56Z", "type": "commit"}, {"oid": "1c10860a70ec5127ce8113faa0da01ace101af68", "url": "https://github.com/eugenp/tutorials/commit/1c10860a70ec5127ce8113faa0da01ace101af68", "message": "[BAEL-4448] Simplified the code for one example", "committedDate": "2020-09-02T20:34:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM1NjMwNw==", "url": "https://github.com/eugenp/tutorials/pull/9936#discussion_r487356307", "bodyText": "The file should be named as a .java file, and the package should be specific to the article, e.g. com.baeldung.tlsversion", "author": "KevinGilmore", "createdAt": "2020-09-12T02:31:37Z", "path": "httpclient/src/main/java/com/baeldung/ClientTlsVersionExamples", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.baeldung", "originalCommit": "1c10860a70ec5127ce8113faa0da01ace101af68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0NTEyOQ==", "url": "https://github.com/eugenp/tutorials/pull/9936#discussion_r488045129", "bodyText": "Moved to com.baeldung.tlsversion", "author": "joe-boudreau", "createdAt": "2020-09-14T15:57:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM1NjMwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM1NjM4Ng==", "url": "https://github.com/eugenp/tutorials/pull/9936#discussion_r487356386", "bodyText": "these should indent only two spaces from where the code in line 19 begins", "author": "KevinGilmore", "createdAt": "2020-09-12T02:32:33Z", "path": "httpclient/src/main/java/com/baeldung/ClientTlsVersionExamples", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.baeldung\n+\n+import org.apache.http.HttpEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.conn.ssl.SSLConnectionSocketFactory;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.ssl.SSLContexts;\n+import org.apache.http.util.EntityUtils;\n+\n+import javax.net.ssl.SSLSocket;\n+import java.net.InetSocketAddress;\n+import java.net.SocketAddress;\n+\n+public class ClientTlsVersionExmaples{\n+\n+    public static CloseableHttpClient setViaSocketFactory(){\n+        SSLConnectionSocketFactory sslsf = new SSLConnectionSocketFactory(\n+                SSLContexts.createDefault(),\n+                new String[] {\"TLSv1.2\", \"TLSv1.3\"},\n+                null,\n+                SSLConnectionSocketFactory.getDefaultHostnameVerifier());", "originalCommit": "1c10860a70ec5127ce8113faa0da01ace101af68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0NTI5NQ==", "url": "https://github.com/eugenp/tutorials/pull/9936#discussion_r488045295", "bodyText": "fixed throughout file", "author": "joe-boudreau", "createdAt": "2020-09-14T15:57:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM1NjM4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM1NzYyMA==", "url": "https://github.com/eugenp/tutorials/pull/9936#discussion_r487357620", "bodyText": "Do you really need a nested try-with-resources inside a try?", "author": "KevinGilmore", "createdAt": "2020-09-12T02:46:29Z", "path": "httpclient/src/main/java/com/baeldung/ClientTlsVersionExamples", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.baeldung\n+\n+import org.apache.http.HttpEntity;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.conn.ssl.SSLConnectionSocketFactory;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.ssl.SSLContexts;\n+import org.apache.http.util.EntityUtils;\n+\n+import javax.net.ssl.SSLSocket;\n+import java.net.InetSocketAddress;\n+import java.net.SocketAddress;\n+\n+public class ClientTlsVersionExmaples{\n+\n+    public static CloseableHttpClient setViaSocketFactory(){\n+        SSLConnectionSocketFactory sslsf = new SSLConnectionSocketFactory(\n+                SSLContexts.createDefault(),\n+                new String[] {\"TLSv1.2\", \"TLSv1.3\"},\n+                null,\n+                SSLConnectionSocketFactory.getDefaultHostnameVerifier());\n+\n+        return HttpClients.custom().setSSLSocketFactory(sslsf).build();\n+    }\n+\n+    public static CloseableHttpClient setTlsVersionPerConnection() {\n+        SSLConnectionSocketFactory sslsf = new SSLConnectionSocketFactory(SSLContexts.createDefault()){\n+\n+            @Override\n+            protected void prepareSocket(SSLSocket socket) {\n+\n+                String hostname = socket.getInetAddress().getHostName();\n+                if (hostname.endsWith(\"internal.system.com\")){\n+                    socket.setEnabledProtocols(new String[] { \"TLSv1\", \"TLSv1.1\", \"TLSv1.2\", \"TLSv1.3\" });\n+                }\n+                else {\n+                    socket.setEnabledProtocols(new String[] {\"TLSv1.3\"});\n+                }\n+            }\n+        };\n+\n+        return HttpClients.custom().setSSLSocketFactory(sslsf).build();\n+    }\n+\n+    //To configure the TLS versions for the client, set the https.protocols system property during runtime.\n+    //For example: java -Dhttps.protocols=TLSv1.1,TLSv1.2,TLSv1.3 -jar webClient.jar\n+    public static CloseableHttpClient setViaSystemProperties(){\n+        return HttpClients.createSystem();\n+        //alternatively\n+        //return HttpClients.custom().useSystemProperties().build();\n+    }\n+\n+    public static void main(String[] args) throws Exception {\n+\n+        CloseableHttpClient httpClient = setTlsVersionPerConnection();\n+        //HttpClient httpClient = setViaSocketFactory();\n+        //HttpClient httpClient = setViaSystemProperties();\n+\n+        try {\n+            try (CloseableHttpResponse response = httpClient.execute(new HttpGet(\"https://httpbin.org/\"))) {\n+                HttpEntity entity = response.getEntity();\n+                EntityUtils.consume(entity);\n+            }", "originalCommit": "1c10860a70ec5127ce8113faa0da01ace101af68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0NjI4Mw==", "url": "https://github.com/eugenp/tutorials/pull/9936#discussion_r488046283", "bodyText": "I did it so I could have the instantiation of the httpClient separated and I could show the two other ways of creating the client right beside it (but commented out). I changed it to a multi-line try-with-resources instead like you suggested", "author": "joe-boudreau", "createdAt": "2020-09-14T15:59:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM1NzYyMA=="}], "type": "inlineReview"}, {"oid": "42cdb9a395d2973afa484e0c74b1edbbb0ff88ff", "url": "https://github.com/eugenp/tutorials/commit/42cdb9a395d2973afa484e0c74b1edbbb0ff88ff", "message": "[BAEL-4448] Formatting fixes and moved to new package", "committedDate": "2020-09-14T15:51:41Z", "type": "commit"}, {"oid": "14b6f1cc4cc660839c86aa8390168938ac748bc2", "url": "https://github.com/eugenp/tutorials/commit/14b6f1cc4cc660839c86aa8390168938ac748bc2", "message": "[BAEL-4448] Forgot an import and fixed class name typo", "committedDate": "2020-09-21T12:56:25Z", "type": "commit"}, {"oid": "4e38b3a4f00370ebf545152aac2bab17c4abfe29", "url": "https://github.com/eugenp/tutorials/commit/4e38b3a4f00370ebf545152aac2bab17c4abfe29", "message": "[BAEL-4448] Created second module for httpclient and moved article code", "committedDate": "2020-09-21T21:47:01Z", "type": "commit"}]}