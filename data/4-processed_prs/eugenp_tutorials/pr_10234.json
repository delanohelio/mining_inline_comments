{"pr_number": 10234, "pr_title": "BAEL-4460: Java AES encryption and decryption", "pr_createdAt": "2020-11-04T11:02:53Z", "pr_url": "https://github.com/eugenp/tutorials/pull/10234", "timeline": [{"oid": "fb74711055a02f187112dd8ab6fd520004c36818", "url": "https://github.com/eugenp/tutorials/commit/fb74711055a02f187112dd8ab6fd520004c36818", "message": "add test file", "committedDate": "2020-11-04T10:58:06Z", "type": "commit"}, {"oid": "c98d8050fd2fdccf5dd91e6c3a841a8dac8df675", "url": "https://github.com/eugenp/tutorials/commit/c98d8050fd2fdccf5dd91e6c3a841a8dac8df675", "message": "update assertj version", "committedDate": "2020-11-04T10:58:12Z", "type": "commit"}, {"oid": "ec724579ee7a4714adc777cc37dbbe58c8d82731", "url": "https://github.com/eugenp/tutorials/commit/ec724579ee7a4714adc777cc37dbbe58c8d82731", "message": "add aes main source", "committedDate": "2020-11-04T10:58:17Z", "type": "commit"}, {"oid": "6f32d4758d472b9b1cc2ad8dfc31ea7a7c323c7e", "url": "https://github.com/eugenp/tutorials/commit/6f32d4758d472b9b1cc2ad8dfc31ea7a7c323c7e", "message": "update README file", "committedDate": "2020-11-04T10:58:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTM4MjU1Mw==", "url": "https://github.com/eugenp/tutorials/pull/10234#discussion_r519382553", "bodyText": "Let's revert the changes to the README.md - The editorial team will take care of this change.", "author": "JonCook", "createdAt": "2020-11-08T12:30:38Z", "path": "core-java-modules/core-java-security-2/README.md", "diffHunk": "@@ -12,4 +12,5 @@ This module contains articles about core Java Security\n - [How to Read PEM File to Get Public and Private Keys](https://www.baeldung.com/java-read-pem-file-keys)\n - [Listing the Available Cipher Algorithms](https://www.baeldung.com/java-list-cipher-algorithms)\n - [Get a List of Trusted Certificates in Java](https://www.baeldung.com/java-list-trusted-certificates)\n+- [Java AES encryption and decryption](https://www.baeldung.com/)", "originalCommit": "6f32d4758d472b9b1cc2ad8dfc31ea7a7c323c7e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTM4NTEwOQ==", "url": "https://github.com/eugenp/tutorials/pull/10234#discussion_r519385109", "bodyText": "If you want to break the method line over two lines, I think the comma on the second line should go after iv e.g\npublic static void encryptFile(String algorithm, SecretKey key, IvParameterSpec iv,\n    File inputFile, File outputFile) throws IOException {\n\nI also think the indentation isn't quite right, it seems to be 8 spaces?\nFeel free to take a look at our eclipse formatter if that helps:\n\nhttps://github.com/eugenp/tutorials/blob/master/eclipse/formatter.xml\n\nHowever, the exception formatting looks quite nice and the eclipse formatter won't respect that.", "author": "JonCook", "createdAt": "2020-11-08T12:37:43Z", "path": "core-java-modules/core-java-security-2/src/main/java/com/baeldung/aes/AESUtil.java", "diffHunk": "@@ -0,0 +1,183 @@\n+package com.baeldung.crypto;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import javax.crypto.*;\n+import javax.crypto.spec.IvParameterSpec;\n+import javax.crypto.spec.PBEKeySpec;\n+import javax.crypto.spec.SecretKeySpec;\n+import java.io.*;\n+import java.security.InvalidAlgorithmParameterException;\n+import java.security.InvalidKeyException;\n+import java.security.NoSuchAlgorithmException;\n+import java.security.SecureRandom;\n+import java.security.spec.InvalidKeySpecException;\n+import java.security.spec.KeySpec;\n+import java.util.Base64;\n+\n+public class AESUtil {\n+    static Logger logger = LoggerFactory.getLogger(AESUtil.class);\n+\n+    public static String encrypt(String algorithm, String input, SecretKey key, IvParameterSpec iv) {\n+        try {\n+            Cipher cipher = Cipher.getInstance(algorithm);\n+            cipher.init(Cipher.ENCRYPT_MODE, key, iv);\n+            byte[] cipherText = cipher.doFinal(input.getBytes());\n+            return Base64.getEncoder().encodeToString(cipherText);\n+        } catch (NoSuchAlgorithmException | NoSuchPaddingException\n+                | InvalidKeyException | InvalidAlgorithmParameterException\n+                | IllegalBlockSizeException | BadPaddingException exp) {\n+            logger.error(exp.getMessage());\n+        }\n+        return null;\n+    }\n+\n+    public static String decrypt(String algorithm, String cipherText, SecretKey key, IvParameterSpec iv) {\n+        try {\n+            Cipher cipher = Cipher.getInstance(algorithm);\n+            cipher.init(Cipher.DECRYPT_MODE, key, iv);\n+            byte[] plainText = cipher.doFinal(Base64.getDecoder().decode(cipherText));\n+            return new String(plainText);\n+        } catch (NoSuchAlgorithmException | NoSuchPaddingException\n+                | InvalidKeyException | InvalidAlgorithmParameterException\n+                | IllegalBlockSizeException | BadPaddingException exp) {\n+            logger.error(exp.getMessage());\n+        }\n+        return null;\n+    }\n+\n+    public static SecretKey generateKey(int n) throws NoSuchAlgorithmException {\n+        KeyGenerator keyGenerator = KeyGenerator.getInstance(\"AES\");\n+        keyGenerator.init(n);\n+        SecretKey key = keyGenerator.generateKey();\n+        return key;\n+    }\n+\n+    public static SecretKey getKeyFromPassword(String password, String salt)\n+            throws NoSuchAlgorithmException, InvalidKeySpecException {\n+        SecretKeyFactory factory = SecretKeyFactory.getInstance(\"PBKDF2WithHmacSHA256\");\n+        KeySpec spec = new PBEKeySpec(password.toCharArray(), salt.getBytes(), 65536, 256);\n+        SecretKey secret = new SecretKeySpec(factory.generateSecret(spec).getEncoded(), \"AES\");\n+        return secret;\n+    }\n+\n+    public static IvParameterSpec generateIv() {\n+        byte[] iv = new byte[16];\n+        new SecureRandom().nextBytes(iv);\n+        return new IvParameterSpec(iv);\n+    }\n+\n+    public static void encryptFile(String algorithm, SecretKey key, IvParameterSpec iv\n+            , File inputFile, File outputFile) throws IOException {", "originalCommit": "6f32d4758d472b9b1cc2ad8dfc31ea7a7c323c7e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTM4NTIyMQ==", "url": "https://github.com/eugenp/tutorials/pull/10234#discussion_r519385221", "bodyText": "I guess we can make the logger private and final as well and have it in capitals?", "author": "JonCook", "createdAt": "2020-11-08T12:38:09Z", "path": "core-java-modules/core-java-security-2/src/main/java/com/baeldung/aes/AESUtil.java", "diffHunk": "@@ -0,0 +1,183 @@\n+package com.baeldung.crypto;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import javax.crypto.*;\n+import javax.crypto.spec.IvParameterSpec;\n+import javax.crypto.spec.PBEKeySpec;\n+import javax.crypto.spec.SecretKeySpec;\n+import java.io.*;\n+import java.security.InvalidAlgorithmParameterException;\n+import java.security.InvalidKeyException;\n+import java.security.NoSuchAlgorithmException;\n+import java.security.SecureRandom;\n+import java.security.spec.InvalidKeySpecException;\n+import java.security.spec.KeySpec;\n+import java.util.Base64;\n+\n+public class AESUtil {\n+    static Logger logger = LoggerFactory.getLogger(AESUtil.class);", "originalCommit": "6f32d4758d472b9b1cc2ad8dfc31ea7a7c323c7e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTM4NTMwNg==", "url": "https://github.com/eugenp/tutorials/pull/10234#discussion_r519385306", "bodyText": "Let's also avoid global imports.", "author": "JonCook", "createdAt": "2020-11-08T12:38:24Z", "path": "core-java-modules/core-java-security-2/src/main/java/com/baeldung/aes/AESUtil.java", "diffHunk": "@@ -0,0 +1,183 @@\n+package com.baeldung.crypto;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import javax.crypto.*;\n+import javax.crypto.spec.IvParameterSpec;\n+import javax.crypto.spec.PBEKeySpec;\n+import javax.crypto.spec.SecretKeySpec;\n+import java.io.*;", "originalCommit": "6f32d4758d472b9b1cc2ad8dfc31ea7a7c323c7e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTM4NTQyNw==", "url": "https://github.com/eugenp/tutorials/pull/10234#discussion_r519385427", "bodyText": "Again, let's remove global imports", "author": "JonCook", "createdAt": "2020-11-08T12:38:52Z", "path": "core-java-modules/core-java-security-2/src/test/java/com/baeldung/aes/AESUtilUnitTest.java", "diffHunk": "@@ -0,0 +1,89 @@\n+package com.baeldung.crypto;\n+\n+import org.assertj.core.api.WithAssertions;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+\n+import javax.crypto.*;", "originalCommit": "6f32d4758d472b9b1cc2ad8dfc31ea7a7c323c7e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTM4NTYzMA==", "url": "https://github.com/eugenp/tutorials/pull/10234#discussion_r519385630", "bodyText": "Let's also remove this unused annotation for Spring Boot.", "author": "JonCook", "createdAt": "2020-11-08T12:39:22Z", "path": "core-java-modules/core-java-security-2/src/test/java/com/baeldung/aes/AESUtilUnitTest.java", "diffHunk": "@@ -0,0 +1,89 @@\n+package com.baeldung.crypto;\n+\n+import org.assertj.core.api.WithAssertions;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+\n+import javax.crypto.*;\n+import javax.crypto.spec.IvParameterSpec;\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Paths;\n+import java.security.NoSuchAlgorithmException;\n+import java.security.spec.InvalidKeySpecException;\n+\n+//@SpringBootTest", "originalCommit": "6f32d4758d472b9b1cc2ad8dfc31ea7a7c323c7e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTM4NTc4MQ==", "url": "https://github.com/eugenp/tutorials/pull/10234#discussion_r519385781", "bodyText": "Do we need this empty test?", "author": "JonCook", "createdAt": "2020-11-08T12:39:44Z", "path": "core-java-modules/core-java-security-2/src/test/java/com/baeldung/aes/AESUtilUnitTest.java", "diffHunk": "@@ -0,0 +1,89 @@\n+package com.baeldung.crypto;\n+\n+import org.assertj.core.api.WithAssertions;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+\n+import javax.crypto.*;\n+import javax.crypto.spec.IvParameterSpec;\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Paths;\n+import java.security.NoSuchAlgorithmException;\n+import java.security.spec.InvalidKeySpecException;\n+\n+//@SpringBootTest\n+class AESUtilUnitTest implements WithAssertions {\n+\n+    @Test\n+    void contextLoads() {", "originalCommit": "6f32d4758d472b9b1cc2ad8dfc31ea7a7c323c7e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTM4NjcxNw==", "url": "https://github.com/eugenp/tutorials/pull/10234#discussion_r519386717", "bodyText": "How about using a try/with resources for these streams or include a finally block. In your example, if there is an exception the streams aren't closed.", "author": "JonCook", "createdAt": "2020-11-08T12:42:29Z", "path": "core-java-modules/core-java-security-2/src/main/java/com/baeldung/aes/AESUtil.java", "diffHunk": "@@ -0,0 +1,183 @@\n+package com.baeldung.crypto;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import javax.crypto.*;\n+import javax.crypto.spec.IvParameterSpec;\n+import javax.crypto.spec.PBEKeySpec;\n+import javax.crypto.spec.SecretKeySpec;\n+import java.io.*;\n+import java.security.InvalidAlgorithmParameterException;\n+import java.security.InvalidKeyException;\n+import java.security.NoSuchAlgorithmException;\n+import java.security.SecureRandom;\n+import java.security.spec.InvalidKeySpecException;\n+import java.security.spec.KeySpec;\n+import java.util.Base64;\n+\n+public class AESUtil {\n+    static Logger logger = LoggerFactory.getLogger(AESUtil.class);\n+\n+    public static String encrypt(String algorithm, String input, SecretKey key, IvParameterSpec iv) {\n+        try {\n+            Cipher cipher = Cipher.getInstance(algorithm);\n+            cipher.init(Cipher.ENCRYPT_MODE, key, iv);\n+            byte[] cipherText = cipher.doFinal(input.getBytes());\n+            return Base64.getEncoder().encodeToString(cipherText);\n+        } catch (NoSuchAlgorithmException | NoSuchPaddingException\n+                | InvalidKeyException | InvalidAlgorithmParameterException\n+                | IllegalBlockSizeException | BadPaddingException exp) {\n+            logger.error(exp.getMessage());\n+        }\n+        return null;\n+    }\n+\n+    public static String decrypt(String algorithm, String cipherText, SecretKey key, IvParameterSpec iv) {\n+        try {\n+            Cipher cipher = Cipher.getInstance(algorithm);\n+            cipher.init(Cipher.DECRYPT_MODE, key, iv);\n+            byte[] plainText = cipher.doFinal(Base64.getDecoder().decode(cipherText));\n+            return new String(plainText);\n+        } catch (NoSuchAlgorithmException | NoSuchPaddingException\n+                | InvalidKeyException | InvalidAlgorithmParameterException\n+                | IllegalBlockSizeException | BadPaddingException exp) {\n+            logger.error(exp.getMessage());\n+        }\n+        return null;\n+    }\n+\n+    public static SecretKey generateKey(int n) throws NoSuchAlgorithmException {\n+        KeyGenerator keyGenerator = KeyGenerator.getInstance(\"AES\");\n+        keyGenerator.init(n);\n+        SecretKey key = keyGenerator.generateKey();\n+        return key;\n+    }\n+\n+    public static SecretKey getKeyFromPassword(String password, String salt)\n+            throws NoSuchAlgorithmException, InvalidKeySpecException {\n+        SecretKeyFactory factory = SecretKeyFactory.getInstance(\"PBKDF2WithHmacSHA256\");\n+        KeySpec spec = new PBEKeySpec(password.toCharArray(), salt.getBytes(), 65536, 256);\n+        SecretKey secret = new SecretKeySpec(factory.generateSecret(spec).getEncoded(), \"AES\");\n+        return secret;\n+    }\n+\n+    public static IvParameterSpec generateIv() {\n+        byte[] iv = new byte[16];\n+        new SecureRandom().nextBytes(iv);\n+        return new IvParameterSpec(iv);\n+    }\n+\n+    public static void encryptFile(String algorithm, SecretKey key, IvParameterSpec iv\n+            , File inputFile, File outputFile) throws IOException {\n+        try {\n+            Cipher cipher = Cipher.getInstance(algorithm);\n+            cipher.init(Cipher.ENCRYPT_MODE, key, iv);\n+            FileInputStream inputStream = new FileInputStream(inputFile);\n+            FileOutputStream outputStream = new FileOutputStream(outputFile);\n+            byte[] buffer = new byte[64];\n+            int bytesRead;\n+            while ((bytesRead = inputStream.read(buffer)) != -1) {\n+                byte[] output = cipher.update(buffer, 0, bytesRead);\n+                if (output != null) {\n+                    outputStream.write(output);\n+                }\n+            }\n+            byte[] outputBytes = cipher.doFinal();\n+            if (outputBytes != null) {\n+                outputStream.write(outputBytes);\n+            }\n+            inputStream.close();\n+            outputStream.close();\n+        } catch (InvalidAlgorithmParameterException | NoSuchAlgorithmException\n+                | NoSuchPaddingException | BadPaddingException\n+                | IllegalBlockSizeException | InvalidKeyException exp) {\n+            logger.error(exp.getMessage());\n+        }\n+    }\n+\n+    public static void decryptFile(String algorithm, SecretKey key, IvParameterSpec iv\n+            , File encryptedFile, File decryptedFile) throws IOException {\n+        try {\n+            Cipher cipher = Cipher.getInstance(algorithm);\n+            cipher.init(Cipher.DECRYPT_MODE, key, iv);\n+            FileInputStream inputStream = new FileInputStream(encryptedFile);", "originalCommit": "6f32d4758d472b9b1cc2ad8dfc31ea7a7c323c7e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTM4NjgyNg==", "url": "https://github.com/eugenp/tutorials/pull/10234#discussion_r519386826", "bodyText": "This method seems to be deprecated, is there an alternative we can use?", "author": "JonCook", "createdAt": "2020-11-08T12:42:52Z", "path": "core-java-modules/core-java-security-2/src/test/java/com/baeldung/aes/AESUtilUnitTest.java", "diffHunk": "@@ -0,0 +1,89 @@\n+package com.baeldung.crypto;\n+\n+import org.assertj.core.api.WithAssertions;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+\n+import javax.crypto.*;\n+import javax.crypto.spec.IvParameterSpec;\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Paths;\n+import java.security.NoSuchAlgorithmException;\n+import java.security.spec.InvalidKeySpecException;\n+\n+//@SpringBootTest\n+class AESUtilUnitTest implements WithAssertions {\n+\n+    @Test\n+    void contextLoads() {\n+    }\n+\n+    @Test\n+    void givenString_whenEncrypt_thenSuccess() throws NoSuchAlgorithmException {\n+        // given\n+        String input = \"baeldung\";\n+        SecretKey key = AESUtil.generateKey(128);\n+        IvParameterSpec ivParameterSpec = AESUtil.generateIv();\n+        String algorithm = \"AES/CBC/PKCS5Padding\";\n+\n+        // when\n+        String cipherText = AESUtil.encrypt(algorithm, input, key, ivParameterSpec);\n+        String plainText = AESUtil.decrypt(algorithm, cipherText, key, ivParameterSpec);\n+\n+        // then\n+        Assertions.assertEquals(input, plainText);\n+    }\n+\n+    @Test\n+    void givenFile_whenEncrypt_thenSuccess() throws NoSuchAlgorithmException, IOException {\n+        // given\n+        SecretKey key = AESUtil.generateKey(128);\n+        String algorithm = \"AES/CBC/PKCS5Padding\";\n+        IvParameterSpec ivParameterSpec = AESUtil.generateIv();\n+        File inputFile = Paths.get(\"src/test/resources/baeldung.txt\").toFile();\n+        File encryptedFile = new File(\"classpath:baeldung.encrypted\");\n+        File decryptedFile = new File(\"document.decrypted\");\n+\n+        // when\n+        AESUtil.encryptFile(algorithm, key, ivParameterSpec, inputFile, encryptedFile);\n+        AESUtil.decryptFile(algorithm, key, ivParameterSpec, encryptedFile, decryptedFile);\n+\n+        // then\n+        assertThat(inputFile).hasSameTextualContentAs(decryptedFile);\n+    }\n+\n+    @Test\n+    void givenObject_whenEncrypt_thenSuccess() throws NoSuchAlgorithmException {\n+        // given\n+        Student student = new Student(\"Baeldung\", 20);\n+        SecretKey key = AESUtil.generateKey(128);\n+        IvParameterSpec ivParameterSpec = AESUtil.generateIv();\n+        String algorithm = \"AES/CBC/PKCS5Padding\";\n+\n+        // when\n+        SealedObject sealedObject = AESUtil.encryptObject(algorithm, student, key, ivParameterSpec);\n+        Student object = (Student) AESUtil.decryptObject(algorithm, sealedObject, key, ivParameterSpec);\n+\n+        // then\n+        assertThat(student).isEqualToComparingFieldByField(object);", "originalCommit": "6f32d4758d472b9b1cc2ad8dfc31ea7a7c323c7e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "108c23795f2bfce0038af8e523b71a4cff844042", "url": "https://github.com/eugenp/tutorials/commit/108c23795f2bfce0038af8e523b71a4cff844042", "message": "Revert \"update README file\"\n\nThis reverts commit 6f32d475", "committedDate": "2020-11-08T13:48:20Z", "type": "commit"}, {"oid": "04bb7449970ac84f1d5ea8fb2b53ae44a670b563", "url": "https://github.com/eugenp/tutorials/commit/04bb7449970ac84f1d5ea8fb2b53ae44a670b563", "message": "add equals method", "committedDate": "2020-11-12T10:36:53Z", "type": "commit"}, {"oid": "b2b8ad97097b1d9b3297f940e1caee5f3c1fccad", "url": "https://github.com/eugenp/tutorials/commit/b2b8ad97097b1d9b3297f940e1caee5f3c1fccad", "message": "add clean up files\nimprove code quality", "committedDate": "2020-11-12T10:38:02Z", "type": "commit"}, {"oid": "f860d885317a9b9b8c8b20524dfa73c7d8ea6a9d", "url": "https://github.com/eugenp/tutorials/commit/f860d885317a9b9b8c8b20524dfa73c7d8ea6a9d", "message": "edit logger code\nimprove code quality", "committedDate": "2020-11-12T10:38:44Z", "type": "commit"}, {"oid": "e0896445acdd8952decbd357e9e5e7604a94a9d7", "url": "https://github.com/eugenp/tutorials/commit/e0896445acdd8952decbd357e9e5e7604a94a9d7", "message": "correct the package name", "committedDate": "2020-11-17T05:44:33Z", "type": "commit"}, {"oid": "ef87edfab635cc49ed3d084c6ee1934de8da5f03", "url": "https://github.com/eugenp/tutorials/commit/ef87edfab635cc49ed3d084c6ee1934de8da5f03", "message": "improve import package names", "committedDate": "2020-11-17T06:00:20Z", "type": "commit"}, {"oid": "12bbd7424914d446fe62812ce969a4cf26faf300", "url": "https://github.com/eugenp/tutorials/commit/12bbd7424914d446fe62812ce969a4cf26faf300", "message": "remove try/catch block and add throw clause", "committedDate": "2020-11-29T08:16:11Z", "type": "commit"}, {"oid": "c1d36f8a66578848c6095c6380534c6558c434ab", "url": "https://github.com/eugenp/tutorials/commit/c1d36f8a66578848c6095c6380534c6558c434ab", "message": "add throw clause", "committedDate": "2020-11-29T08:16:34Z", "type": "commit"}]}