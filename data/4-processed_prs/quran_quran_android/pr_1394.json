{"pr_number": 1394, "pr_title": "Support split screen age and translation on tablet", "pr_createdAt": "2020-07-05T13:19:04Z", "pr_url": "https://github.com/quran/quran_android/pull/1394", "timeline": [{"oid": "3b515716d8d4ac48edb53a1b504ec7cd48fed1c7", "url": "https://github.com/quran/quran_android/commit/3b515716d8d4ac48edb53a1b504ec7cd48fed1c7", "message": "add preferences to enable/disable quran-translation split screen view", "committedDate": "2020-07-05T12:37:27Z", "type": "commit"}, {"oid": "106f1a1c7d52fd9350eec3715028cfef93026046", "url": "https://github.com/quran/quran_android/commit/106f1a1c7d52fd9350eec3715028cfef93026046", "message": "add split mode support", "committedDate": "2020-07-05T12:37:27Z", "type": "commit"}, {"oid": "6dcb7b1f90edd6636f9ce3e09f31a63c9037aa43", "url": "https://github.com/quran/quran_android/commit/6dcb7b1f90edd6636f9ce3e09f31a63c9037aa43", "message": "fix crash because of null controller in split mode", "committedDate": "2020-07-05T12:37:27Z", "type": "commit"}, {"oid": "d972386142eb554b42d8dfff2c53f3b9ea263660", "url": "https://github.com/quran/quran_android/commit/d972386142eb554b42d8dfff2c53f3b9ea263660", "message": "fix Quran page count when split mode and translation/Quran mode", "committedDate": "2020-07-05T12:37:27Z", "type": "commit"}, {"oid": "6af11428bbb0a3681267df8131613c0b22b0a922", "url": "https://github.com/quran/quran_android/commit/6af11428bbb0a3681267df8131613c0b22b0a922", "message": "fix switch between Quran and translation in split mode", "committedDate": "2020-07-05T12:37:27Z", "type": "commit"}, {"oid": "fe285f5dabb769052879a4fb011e3757e1c30670", "url": "https://github.com/quran/quran_android/commit/fe285f5dabb769052879a4fb011e3757e1c30670", "message": "fix Quran playback when in split mode", "committedDate": "2020-07-05T12:40:06Z", "type": "commit"}, {"oid": "1a06e38e29eeff83736c6ec6800c6c61e07ed377", "url": "https://github.com/quran/quran_android/commit/1a06e38e29eeff83736c6ec6800c6c61e07ed377", "message": "fix unit tests after rebase", "committedDate": "2020-07-05T12:44:16Z", "type": "commit"}, {"oid": "e87d9237477442db1a2fec81110a71bbca0a27b0", "url": "https://github.com/quran/quran_android/commit/e87d9237477442db1a2fec81110a71bbca0a27b0", "message": "remove unused import", "committedDate": "2020-07-05T12:48:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQyOTUxNw==", "url": "https://github.com/quran/quran_android/pull/1394#discussion_r458429517", "bodyText": "this isn't right for cases where we are tablet in translation mode without the split setting - in that case, we should still treat it as 2 pages whereas this code will treat it as 1.", "author": "ahmedre", "createdAt": "2020-07-21T22:38:53Z", "path": "app/src/main/java/com/quran/labs/androidquran/util/AudioUtils.kt", "diffHunk": "@@ -107,17 +107,25 @@ constructor(private val quranInfo: QuranInfo, private val quranFileUtils: QuranF\n     return quranFileUtils.gaplessDatabaseRootUrl + \"/\" + dbName\n   }\n \n-  fun getLastAyahToPlay(startAyah: SuraAyah,\n-                        currentPage: Int,\n-                        mode: Int,\n-                        isDualPages: Boolean): SuraAyah? {\n-    val page = if (isDualPages && mode == LookAheadAmount.PAGE && currentPage % 2 == 1) {\n-      // if we download page by page and we are currently in tablet mode\n-      // and playing from the right page, get the left page as well.\n-      currentPage + 1\n-    } else {\n-      currentPage\n-    }\n+  fun getLastAyahToPlay(\n+    startAyah: SuraAyah,\n+    currentPage: Int,\n+    mode: Int,\n+    isDualPages: Boolean,\n+    isNotSplitOrShowingTranslation: Boolean\n+  ): SuraAyah? {\n+    val page =\n+      if (isDualPages &&\n+        isNotSplitOrShowingTranslation &&", "originalCommit": "e87d9237477442db1a2fec81110a71bbca0a27b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDExNjM2MQ==", "url": "https://github.com/quran/quran_android/pull/1394#discussion_r460116361", "bodyText": "Will have a look this weekend Insha Allah. Same for all the other comments.", "author": "Korogba", "createdAt": "2020-07-24T15:13:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQyOTUxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY0OTY5MQ==", "url": "https://github.com/quran/quran_android/pull/1394#discussion_r479649691", "bodyText": "Salaam walaikum, I finally got around to this \ud83d\ude05.\nI changed this function along with others with a similar signature to depend on a single boolean that determines if two/one page(s) are/is displayed - 7024698.", "author": "Korogba", "createdAt": "2020-08-29T13:25:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQyOTUxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQyOTY1Nw==", "url": "https://github.com/quran/quran_android/pull/1394#discussion_r458429657", "bodyText": "same comment as above", "author": "ahmedre", "createdAt": "2020-07-21T22:39:13Z", "path": "common/data/src/main/java/com/quran/data/core/QuranInfo.kt", "diffHunk": "@@ -160,16 +160,26 @@ class QuranInfo @Inject constructor(quranDataSource: QuranDataSource) {\n     return if (sura < 1 || sura > NUMBER_OF_SURAS) -1 else suraNumAyahs[sura - 1]\n   }\n \n-  fun getPageFromPosition(position: Int, dual: Boolean): Int {\n-    return if (dual) {\n+  fun getPageFromPosition(\n+    position: Int,\n+    dual: Boolean,\n+    isSplitScreen: Boolean,\n+    isShowingTranslation: Boolean", "originalCommit": "e87d9237477442db1a2fec81110a71bbca0a27b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQyOTc2Mg==", "url": "https://github.com/quran/quran_android/pull/1394#discussion_r458429762", "bodyText": "here also", "author": "ahmedre", "createdAt": "2020-07-21T22:39:31Z", "path": "common/data/src/main/java/com/quran/data/core/QuranInfo.kt", "diffHunk": "@@ -160,16 +160,26 @@ class QuranInfo @Inject constructor(quranDataSource: QuranDataSource) {\n     return if (sura < 1 || sura > NUMBER_OF_SURAS) -1 else suraNumAyahs[sura - 1]\n   }\n \n-  fun getPageFromPosition(position: Int, dual: Boolean): Int {\n-    return if (dual) {\n+  fun getPageFromPosition(\n+    position: Int,\n+    dual: Boolean,\n+    isSplitScreen: Boolean,\n+    isShowingTranslation: Boolean\n+  ): Int {\n+    return if (dual && (!isSplitScreen || !isShowingTranslation)) {\n       (numberOfPagesDual - position) * 2\n     } else {\n       numberOfPages - position\n     }\n   }\n \n-  fun getPositionFromPage(page: Int, dual: Boolean): Int {\n-    return if (dual) {\n+  fun getPositionFromPage(\n+    page: Int,\n+    dual: Boolean,\n+    isSplitScreen: Boolean,\n+    isShowingTranslation: Boolean", "originalCommit": "e87d9237477442db1a2fec81110a71bbca0a27b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQzMDU1OQ==", "url": "https://github.com/quran/quran_android/pull/1394#discussion_r458430559", "bodyText": "can we unify some code by making this an int - numberOfActualPagesVisible for example that's set to 1 for single page (or dual page with split turned on) and is 2 for dual mode (irrespective of translation on or off?)", "author": "ahmedre", "createdAt": "2020-07-21T22:41:34Z", "path": "app/src/main/java/com/quran/labs/androidquran/ui/PagerActivity.java", "diffHunk": "@@ -203,6 +202,7 @@\n   private int numberOfPages;\n   private int numberOfPagesDual;\n   private int defaultNavigationBarColor;\n+  private boolean isSplitScreen = false;", "originalCommit": "e87d9237477442db1a2fec81110a71bbca0a27b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY1MDA2MQ==", "url": "https://github.com/quran/quran_android/pull/1394#discussion_r479650061", "bodyText": "I left this boolean because it is useful to save the preferences value once but the usage is modified so we now have a function that determines if dual page or not. Since this value changes each time the user turns translation on/off, most of the use for this boolean is replaced by a function - isDualPageVisible(). See 7024698 and 70544ae.", "author": "Korogba", "createdAt": "2020-08-29T13:30:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQzMDU1OQ=="}], "type": "inlineReview"}, {"oid": "70544ae4d691e9e341872170fa5dca4878c9d2c7", "url": "https://github.com/quran/quran_android/commit/70544ae4d691e9e341872170fa5dca4878c9d2c7", "message": "simplify logic and rename isNotSplitOrShowingTranslation to isNotSplitAndShowingTranslation", "committedDate": "2020-07-28T07:58:40Z", "type": "commit"}, {"oid": "702469884a9d289c237c974edda1aa66bceaf896", "url": "https://github.com/quran/quran_android/commit/702469884a9d289c237c974edda1aa66bceaf896", "message": "simplify logic to determine if dual pages is shown", "committedDate": "2020-08-29T13:04:27Z", "type": "commit"}, {"oid": "9552d020cd4d7ca117149e3fd208406022cf23fc", "url": "https://github.com/quran/quran_android/commit/9552d020cd4d7ca117149e3fd208406022cf23fc", "message": "merge dual page settings into a separate category", "committedDate": "2020-08-29T13:20:47Z", "type": "commit"}, {"oid": "890f1b70dc4b0d28f683605c6e491bf0810a9148", "url": "https://github.com/quran/quran_android/commit/890f1b70dc4b0d28f683605c6e491bf0810a9148", "message": "Merge remote-tracking branch 'upstream/master' into 759-support-split-screen-page-and-translation-on-tablet\n\nConflicts:\n\tapp/src/main/java/com/quran/labs/androidquran/ui/PagerActivity.java\n\tapp/src/main/res/xml/quran_preferences.xml", "committedDate": "2020-08-29T13:50:04Z", "type": "commit"}]}