{"pr_number": 1515, "pr_title": "Add a fallback url for when main urls don't work", "pr_createdAt": "2020-12-27T13:28:36Z", "pr_url": "https://github.com/quran/quran_android/pull/1515", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTE4NTcwMA==", "url": "https://github.com/quran/quran_android/pull/1515#discussion_r549185700", "bodyText": "You could directly use replace without if block/check, because with contains and replace you are doing double look-up anyway.", "author": "ozbek", "createdAt": "2020-12-28T01:18:32Z", "path": "app/src/main/java/com/quran/labs/androidquran/service/QuranDownloadService.java", "diffHunk": "@@ -464,10 +466,11 @@ private boolean downloadFileWrapper(String urlString, String destination,\n       }\n \n       String url = urlString;\n-      if (i > 0) {\n-        // let's try http instead of https?\n-        if (urlString.contains(\"quran.com\") || urlString.contains(\"quranicaudio.com\")) {\n-          url = urlString.replace(\"https://\", \"http://\");\n+      if (fallbackByDefault || i > 0) {\n+        if (urlString.contains(\"android.quran.com\")) {", "originalCommit": "cff2450970199f94d17426d4c23d3e4b144524d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc2NDAxMg==", "url": "https://github.com/quran/quran_android/pull/1515#discussion_r549764012", "bodyText": "jazakAllah khairan - done", "author": "ahmedre", "createdAt": "2020-12-29T16:18:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTE4NTcwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTE4NTkzMQ==", "url": "https://github.com/quran/quran_android/pull/1515#discussion_r549185931", "bodyText": "Elsewhere you are replaceing on error, here a separate variable. Maybe use a common convention?\nActually, I personally would prefer to have a single utility class/method for all replacements :)", "author": "ozbek", "createdAt": "2020-12-28T01:21:11Z", "path": "app/src/main/java/com/quran/labs/androidquran/pageselect/PageSelectPresenter.kt", "diffHunk": "@@ -42,8 +43,10 @@ class PageSelectPresenter @Inject\n         } else if (!downloadingSet.contains(it.key)){\n           downloadingSet.add(it.key)\n           val url = \"$baseUrl/${it.key}.png\"\n+          val backupUrl = \"$backupBaseUrl/${it.key}.png\"\n           compositeDisposable.add(\n               imageUtil.downloadImage(url, previewImage)\n+                  .onErrorResumeNext(imageUtil.downloadImage(backupUrl, previewImage))", "originalCommit": "cff2450970199f94d17426d4c23d3e4b144524d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc2NDAzOQ==", "url": "https://github.com/quran/quran_android/pull/1515#discussion_r549764039", "bodyText": "jazakAllah khairan - done", "author": "ahmedre", "createdAt": "2020-12-29T16:18:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTE4NTkzMQ=="}], "type": "inlineReview"}, {"oid": "77afd0986811ab5c91e5616a6d83e26f2f3be393", "url": "https://github.com/quran/quran_android/commit/77afd0986811ab5c91e5616a6d83e26f2f3be393", "message": "Add a fallback url for when main urls don't work", "committedDate": "2020-12-29T16:14:13Z", "type": "forcePushed"}, {"oid": "ef8005a46d036c86ef0ec112e5bc9d7051b0d529", "url": "https://github.com/quran/quran_android/commit/ef8005a46d036c86ef0ec112e5bc9d7051b0d529", "message": "Add a fallback url for when main urls don't work", "committedDate": "2020-12-29T16:55:22Z", "type": "commit"}, {"oid": "ef8005a46d036c86ef0ec112e5bc9d7051b0d529", "url": "https://github.com/quran/quran_android/commit/ef8005a46d036c86ef0ec112e5bc9d7051b0d529", "message": "Add a fallback url for when main urls don't work", "committedDate": "2020-12-29T16:55:22Z", "type": "forcePushed"}]}