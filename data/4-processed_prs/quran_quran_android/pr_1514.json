{"pr_number": 1514, "pr_title": "Add Bulk Download Dialog", "pr_createdAt": "2020-12-26T19:35:10Z", "pr_url": "https://github.com/quran/quran_android/pull/1514", "timeline": [{"oid": "ac38987bd58177d1adc947c93402d49471147b9e", "url": "https://github.com/quran/quran_android/commit/ac38987bd58177d1adc947c93402d49471147b9e", "message": "Add Bulk Download Dialog", "committedDate": "2020-12-26T19:31:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzMzMTE4NA==", "url": "https://github.com/quran/quran_android/pull/1514#discussion_r567331184", "bodyText": "val activity = requireActivity()\nval inflater = activity.layoutInflater", "author": "ahmedre", "createdAt": "2021-01-30T22:55:51Z", "path": "app/src/main/java/com/quran/labs/androidquran/ui/fragment/BulkDownloadFragment.kt", "diffHunk": "@@ -0,0 +1,220 @@\n+package com.quran.labs.androidquran.ui.fragment\n+\n+import android.annotation.SuppressLint\n+import android.app.Activity\n+import android.app.Dialog\n+import android.content.Context\n+import android.content.DialogInterface\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import android.view.WindowManager.LayoutParams\n+import android.widget.BaseAdapter\n+import android.widget.Filter\n+import android.widget.Filterable\n+import android.widget.TextView\n+import androidx.annotation.LayoutRes\n+import androidx.appcompat.app.AlertDialog.Builder\n+import androidx.fragment.app.DialogFragment\n+import com.quran.data.core.QuranInfo\n+import com.quran.labs.androidquran.R\n+import com.quran.labs.androidquran.R.*\n+import com.quran.labs.androidquran.ui.SheikhAudioManagerActivity\n+import com.quran.labs.androidquran.util.QuranUtils\n+import com.quran.labs.androidquran.view.ForceCompleteTextView\n+import timber.log.Timber\n+import java.util.*\n+import javax.inject.Inject\n+\n+/**\n+ * [BulkDownloadFragment] is a dialog for selecting audio download first Surah and last Surah\n+ */\n+class BulkDownloadFragment : DialogFragment() {\n+\n+  @Inject\n+  lateinit var quranInfo: QuranInfo\n+\n+  private lateinit var suraFirstInput: ForceCompleteTextView\n+  private lateinit var suraLastInput: ForceCompleteTextView\n+\n+  override fun onCreateDialog(savedInstanceState: Bundle?): Dialog {\n+    val activity: Activity? = activity\n+    val inflater = activity!!.layoutInflater", "originalCommit": "ac38987bd58177d1adc947c93402d49471147b9e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzMzMTI0NQ==", "url": "https://github.com/quran/quran_android/pull/1514#discussion_r567331245", "bodyText": "val suraFirst = max(suras.indexOf(suraFirstName) + 1, 1)", "author": "ahmedre", "createdAt": "2021-01-30T22:56:40Z", "path": "app/src/main/java/com/quran/labs/androidquran/ui/fragment/BulkDownloadFragment.kt", "diffHunk": "@@ -0,0 +1,220 @@\n+package com.quran.labs.androidquran.ui.fragment\n+\n+import android.annotation.SuppressLint\n+import android.app.Activity\n+import android.app.Dialog\n+import android.content.Context\n+import android.content.DialogInterface\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import android.view.WindowManager.LayoutParams\n+import android.widget.BaseAdapter\n+import android.widget.Filter\n+import android.widget.Filterable\n+import android.widget.TextView\n+import androidx.annotation.LayoutRes\n+import androidx.appcompat.app.AlertDialog.Builder\n+import androidx.fragment.app.DialogFragment\n+import com.quran.data.core.QuranInfo\n+import com.quran.labs.androidquran.R\n+import com.quran.labs.androidquran.R.*\n+import com.quran.labs.androidquran.ui.SheikhAudioManagerActivity\n+import com.quran.labs.androidquran.util.QuranUtils\n+import com.quran.labs.androidquran.view.ForceCompleteTextView\n+import timber.log.Timber\n+import java.util.*\n+import javax.inject.Inject\n+\n+/**\n+ * [BulkDownloadFragment] is a dialog for selecting audio download first Surah and last Surah\n+ */\n+class BulkDownloadFragment : DialogFragment() {\n+\n+  @Inject\n+  lateinit var quranInfo: QuranInfo\n+\n+  private lateinit var suraFirstInput: ForceCompleteTextView\n+  private lateinit var suraLastInput: ForceCompleteTextView\n+\n+  override fun onCreateDialog(savedInstanceState: Bundle?): Dialog {\n+    val activity: Activity? = activity\n+    val inflater = activity!!.layoutInflater\n+\n+    @SuppressLint(\"InflateParams\")\n+    val layout = inflater.inflate(layout.bulk_download_dialog, null)\n+\n+    val builder = Builder(activity)\n+    builder.setTitle(activity.getString(string.audio_manager_download_all))\n+\n+    // First Sura chooser\n+    suraFirstInput = layout.findViewById(R.id.first_sura_spinner)\n+    val suras = activity.resources.getStringArray(array.sura_names)\n+        .mapIndexed { index: Int, sura: String? ->\n+          QuranUtils.getLocalizedNumber(activity, index + 1) + \". \" + sura\n+        }\n+\n+    val suraFirstAdapter = InfixFilterArrayAdapter(\n+        activity,\n+        android.R.layout.simple_spinner_dropdown_item, suras\n+    )\n+    suraFirstInput.setAdapter(suraFirstAdapter)\n+\n+    suraFirstInput.setOnForceCompleteListener { _: ForceCompleteTextView?, position: Int, _: Long ->\n+      val enteredFirstText = suraFirstInput.text.toString()\n+      val suraFirstName: String?\n+\n+      suraFirstName = when {\n+        // user selects\n+        position >= 0 -> { suraFirstAdapter.getItem(position) }\n+        suras.contains(enteredFirstText) -> { enteredFirstText }\n+        // leave to the next code\n+        suraFirstAdapter.isEmpty -> { null }\n+        // maybe first initialization or invalid input\n+        else -> { suraFirstAdapter.getItem(0) }\n+      }\n+\n+      var suraFirst = suras.indexOf(suraFirstName) + 1\n+      // default to Al-Fatiha\n+      if (suraFirst == 0) suraFirst = 1", "originalCommit": "ac38987bd58177d1adc947c93402d49471147b9e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}