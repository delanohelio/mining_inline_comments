{"pr_number": 3027, "pr_title": "[GEOT-6643] Shapefile write fails when encountering MULTIPOLYGON EMPTY geometries", "pr_createdAt": "2020-06-30T13:54:20Z", "pr_url": "https://github.com/geotools/geotools/pull/3027", "timeline": [{"oid": "381951a54dcf85a682f1900bdab5db5023db19e5", "url": "https://github.com/geotools/geotools/commit/381951a54dcf85a682f1900bdab5db5023db19e5", "message": "[GEOT-6643] Shapefile write fails when encountering MULTIPOLYGON EMPTY geometries", "committedDate": "2020-06-30T13:49:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzczOTc1MQ==", "url": "https://github.com/geotools/geotools/pull/3027#discussion_r447739751", "bodyText": "It could be argued that JTSUtilities is at fault here and should return null when fed an empty geometry of any type. But I'm not sure what the knock on effects would be.", "author": "ianturton", "createdAt": "2020-06-30T14:43:59Z", "path": "modules/plugin/shapefile/src/main/java/org/geotools/data/shapefile/ShapefileFeatureWriter.java", "diffHunk": "@@ -376,7 +376,13 @@ public void write() throws IOException {\n         }\n \n         // convert geometry\n-        g = JTSUtilities.convertToCollection(g, shapeType);\n+        if (g != null) {\n+            if (g.isEmpty()) {\n+                g = null;\n+            } else {\n+                g = JTSUtilities.convertToCollection(g, shapeType);", "originalCommit": "381951a54dcf85a682f1900bdab5db5023db19e5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzc0MjA1NA==", "url": "https://github.com/geotools/geotools/pull/3027#discussion_r447742054", "bodyText": "Thought about it, but the method says \"convert to collection\", going from empty to null geometry seems something else to me.", "author": "aaime", "createdAt": "2020-06-30T14:46:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzczOTc1MQ=="}], "type": "inlineReview"}]}