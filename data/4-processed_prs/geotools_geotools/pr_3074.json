{"pr_number": 3074, "pr_title": "[GEOT-6663]: added topology preserving simplification option to jdbc-\u2026", "pr_createdAt": "2020-07-16T14:10:07Z", "pr_url": "https://github.com/geotools/geotools/pull/3074", "timeline": [{"oid": "1eedd5f20a1febc026fc43229f2ee04c60a61c14", "url": "https://github.com/geotools/geotools/commit/1eedd5f20a1febc026fc43229f2ee04c60a61c14", "message": "[GEOT-6663]: added topology preserving simplification option to jdbc-postgis datastore", "committedDate": "2020-07-16T14:08:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU2ODkzMw==", "url": "https://github.com/geotools/geotools/pull/3074#discussion_r456568933", "bodyText": "If we are going to keep this up we should break out an enum with different options for how to simplify.", "author": "jodygarnett", "createdAt": "2020-07-17T17:12:07Z", "path": "modules/plugin/jdbc/jdbc-postgis/src/main/java/org/geotools/data/postgis/GeometryColumnEncoder.java", "diffHunk": "@@ -24,19 +24,22 @@\n \n     private final boolean atLeast2_2_0;\n     private final boolean stSimplifyEnabled;\n+    private final boolean stPreserveTopologyEnabled;\n     private final boolean encodeBase64;\n     private final PostGISDialect dialect;\n \n     GeometryColumnEncoder(\n             Version version,\n             boolean stSimplifyEnabled,\n+            boolean stPreserveTopologyEnabled,", "originalCommit": "1eedd5f20a1febc026fc43229f2ee04c60a61c14", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzE3MzQzOA==", "url": "https://github.com/geotools/geotools/pull/3074#discussion_r457173438", "bodyText": "I thought the same. However, up to what level should it be brought? Here? Dialect? Factory?\nIf factory, then backwards compatibility for old settings should be accounted for (if the simplification mode is missing, look for the legacy \"simplify\" flag and use that).", "author": "aaime", "createdAt": "2020-07-20T08:29:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU2ODkzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE2NTI1Mg==", "url": "https://github.com/geotools/geotools/pull/3074#discussion_r458165252", "bodyText": "@aaime @jodygarnett maybe we can (for backward compatibility) leave the simplify flag there and just add the enum to choose between ST_Simplify and ST_SimplifyPreserveTopology if simplify is true. I think WKB simplification is a different thing and is handled separately.", "author": "mbarto", "createdAt": "2020-07-21T14:59:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU2ODkzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAzNjM2NA==", "url": "https://github.com/geotools/geotools/pull/3074#discussion_r460036364", "bodyText": "@mbarto works for me", "author": "aaime", "createdAt": "2020-07-24T12:59:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU2ODkzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ4MTg1OQ==", "url": "https://github.com/geotools/geotools/pull/3074#discussion_r461481859", "bodyText": "@aaime I added the SimplificationMethod enum to replace the boolean flag with options FAST (ST_Simplify) and PRESERVETOPOLOGY", "author": "mbarto", "createdAt": "2020-07-28T10:31:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU2ODkzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU3MDc2Ng==", "url": "https://github.com/geotools/geotools/pull/3074#discussion_r456570766", "bodyText": "I must be missing something, what is the difference with PostgisDontPreserveTopologyOnlineTest above? Both classes setup:\nnew PostgisPreserveTopologyTestSetup(new PostGISPSTestSetup());", "author": "jodygarnett", "createdAt": "2020-07-17T17:15:37Z", "path": "modules/plugin/jdbc/jdbc-postgis/src/test/java/org/geotools/data/postgis/ps/PostgisPreserveTopologyOnlineTest.java", "diffHunk": "@@ -0,0 +1,27 @@\n+/*\n+ *    GeoTools - The Open Source Java GIS Toolkit\n+ *    http://geotools.org\n+ *\n+ *    (C) 2020, Open Source Geospatial Foundation (OSGeo)\n+ *\n+ *    This library is free software; you can redistribute it and/or\n+ *    modify it under the terms of the GNU Lesser General Public\n+ *    License as published by the Free Software Foundation;\n+ *    version 2.1 of the License.\n+ *\n+ *    This library is distributed in the hope that it will be useful,\n+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ *    Lesser General Public License for more details.\n+ */\n+package org.geotools.data.postgis.ps;\n+\n+import org.geotools.data.postgis.PostgisPreserveTopologyTestSetup;\n+\n+public class PostgisPreserveTopologyOnlineTest", "originalCommit": "1eedd5f20a1febc026fc43229f2ee04c60a61c14", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzE2OTQ4Ng==", "url": "https://github.com/geotools/geotools/pull/3074#discussion_r457169486", "bodyText": "Agreed. @mbarto  multiple tests can share the same test setup, if the actions that need to be done to prepare the database are the same.", "author": "aaime", "createdAt": "2020-07-20T08:25:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU3MDc2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE2Mjk3Ng==", "url": "https://github.com/geotools/geotools/pull/3074#discussion_r458162976", "bodyText": "@aaime @jodygarnett I made two classes to have a different createDataStoreFactoryParams, so that I can set the flag on for one class and off in the other one and have two different stores. Can you think of a different (better) way of doing that? I couldn't find one. Maybe I can make one extend the other one and just override createDataStoreFactoryParams?", "author": "mbarto", "createdAt": "2020-07-21T14:56:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU3MDc2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAzNzcyNA==", "url": "https://github.com/geotools/geotools/pull/3074#discussion_r460037724", "bodyText": "Nah, it's ok, I just forgot that every test in PostGIS is run with and without prepared statements, the classes in the ps sub-package subclass the one in the upper level package.", "author": "aaime", "createdAt": "2020-07-24T13:01:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU3MDc2Ng=="}], "type": "inlineReview"}, {"oid": "856c1646a85df4bac978b7a28e70249b0bd5aefb", "url": "https://github.com/geotools/geotools/commit/856c1646a85df4bac978b7a28e70249b0bd5aefb", "message": "[GEOT-6663]: added enum SimplificationMethod to allow introduction of new simplification methods in the future", "committedDate": "2020-07-28T10:30:00Z", "type": "commit"}]}