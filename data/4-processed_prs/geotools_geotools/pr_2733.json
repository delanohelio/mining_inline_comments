{"pr_number": 2733, "pr_title": "Mbstyles, disables partials, enable multi-font search, fix labelling as a consequence", "pr_createdAt": "2020-01-02T14:12:16Z", "pr_url": "https://github.com/geotools/geotools/pull/2733", "timeline": [{"oid": "e400cb05f27f9e0254472fadf00bd55c0edb1f9e", "url": "https://github.com/geotools/geotools/commit/e400cb05f27f9e0254472fadf00bd55c0edb1f9e", "message": "[GEOT-6480] MBStyle, disable partials=true exports", "committedDate": "2020-01-02T14:57:04Z", "type": "forcePushed"}, {"oid": "9069af2811fc3b7b4388591e554da2b42bc47ca8", "url": "https://github.com/geotools/geotools/commit/9069af2811fc3b7b4388591e554da2b42bc47ca8", "message": "[GEOT-6462] MBStyle font management can lead to tofu chars", "committedDate": "2020-01-04T14:06:57Z", "type": "forcePushed"}, {"oid": "fc9fd6c32db78f890a33f41d7b1d96b1bed2f1a5", "url": "https://github.com/geotools/geotools/commit/fc9fd6c32db78f890a33f41d7b1d96b1bed2f1a5", "message": "[GEOT-6462] MBStyle font management can lead to tofu chars", "committedDate": "2020-01-04T14:46:19Z", "type": "forcePushed"}, {"oid": "2f57abf72f77a6856730685a19735596aad3cfbc", "url": "https://github.com/geotools/geotools/commit/2f57abf72f77a6856730685a19735596aad3cfbc", "message": "[GEOT-6462] MBStyle font management can lead to tofu chars", "committedDate": "2020-01-13T09:46:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwODQ3MA==", "url": "https://github.com/geotools/geotools/pull/2733#discussion_r366608470", "bodyText": "Should this put the result into alternatives before returning? As far as I can tell, nothing ever gets written to alternatives currently.", "author": "tbarsballe", "createdAt": "2020-01-14T22:33:45Z", "path": "modules/library/render/src/main/java/org/geotools/renderer/style/FontCache.java", "diffHunk": "@@ -252,4 +259,31 @@ public synchronized void resetCache() {\n \n         return availableFonts;\n     }\n+\n+    /**\n+     * Given a font name, returns alternatives for other scripts, based on the assumption they start\n+     * with the same base name.\n+     *\n+     * @param name\n+     * @return A list of font names with the same base name\n+     */\n+    public List<String> getAlternatives(String name) {\n+        List<String> result = alternatives.get(name);\n+        if (result == null) {\n+            result =\n+                    FontCache.getDefaultInstance()\n+                            .getAvailableFonts()\n+                            .stream()\n+                            .filter(f -> f.startsWith(name))\n+                            .filter(\n+                                    f -> { // leave out alterations, use base fonts\n+                                        String lc = f.toLowerCase();\n+                                        return !lc.contains(\" bold\") && !lc.contains(\" italic\");\n+                                    })\n+                            .sorted() // leave further altered fonts down the line, base ones first\n+                            .collect(Collectors.toList());\n+        }", "originalCommit": "2f57abf72f77a6856730685a19735596aad3cfbc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM1OTE0NA==", "url": "https://github.com/geotools/geotools/pull/2733#discussion_r367359144", "bodyText": "Good catch, thanks!", "author": "aaime", "createdAt": "2020-01-16T11:08:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwODQ3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwOTk5OQ==", "url": "https://github.com/geotools/geotools/pull/2733#discussion_r366609999", "bodyText": "This should be restored to its prior state before merging", "author": "tbarsballe", "createdAt": "2020-01-14T22:37:52Z", "path": "modules/library/render/src/test/java/org/geotools/renderer/lite/LetterConflictTest.java", "diffHunk": "@@ -55,8 +55,8 @@\n      *\n      * <p>Build with mvn -P image.interactive\n      */\n-    static final boolean IMAGE_INTERACTIVE =\n-            Boolean.getBoolean(\"org.geotools.image.test.interactive\");\n+    static final boolean IMAGE_INTERACTIVE = true;\n+    // Boolean.getBoolean(\"org.geotools.image.test.interactive\");", "originalCommit": "2f57abf72f77a6856730685a19735596aad3cfbc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM1OTQwNQ==", "url": "https://github.com/geotools/geotools/pull/2733#discussion_r367359405", "bodyText": "Yep", "author": "aaime", "createdAt": "2020-01-16T11:08:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwOTk5OQ=="}], "type": "inlineReview"}, {"oid": "2ca6ba3e70aecb44512372848b3836722fcab891", "url": "https://github.com/geotools/geotools/commit/2ca6ba3e70aecb44512372848b3836722fcab891", "message": "[GEOT-6462] MBStyle font management can lead to tofu chars", "committedDate": "2020-01-16T11:15:06Z", "type": "forcePushed"}, {"oid": "6e8da8fa6ccc320787aaa806813f340bccd0e5db", "url": "https://github.com/geotools/geotools/commit/6e8da8fa6ccc320787aaa806813f340bccd0e5db", "message": "[GEOT-6462] MBStyle font management can lead to tofu chars", "committedDate": "2020-01-16T11:22:54Z", "type": "forcePushed"}, {"oid": "117648bff165134f2795bb00e5bfc49aa8269768", "url": "https://github.com/geotools/geotools/commit/117648bff165134f2795bb00e5bfc49aa8269768", "message": "[GEOT-6484] LabelPainter miscalculates the position of a labels background graphic, might result in the label not being placed", "committedDate": "2020-01-16T11:25:13Z", "type": "commit"}, {"oid": "1277b122712a3602bb429626e9f6cbcd39150f28", "url": "https://github.com/geotools/geotools/commit/1277b122712a3602bb429626e9f6cbcd39150f28", "message": "[GEOT-6480] MBStyle, disable partials=true exports", "committedDate": "2020-01-16T11:25:13Z", "type": "commit"}, {"oid": "15e461c62ba7582a4318b34dd04fd4983c86f70d", "url": "https://github.com/geotools/geotools/commit/15e461c62ba7582a4318b34dd04fd4983c86f70d", "message": "[GEOT-6485] Reduce memory allocation while rendering labels", "committedDate": "2020-01-16T11:25:13Z", "type": "commit"}, {"oid": "cef0dfee972bef4b492519e48e9fb211ca5627e8", "url": "https://github.com/geotools/geotools/commit/cef0dfee972bef4b492519e48e9fb211ca5627e8", "message": "[GEOT-6486] Excessive line spacing, especially when arabic chars are in use, when wrapping lines", "committedDate": "2020-01-16T11:26:12Z", "type": "commit"}, {"oid": "b6fe316e0a55aa7169b5ca08a87ccfada27ede6a", "url": "https://github.com/geotools/geotools/commit/b6fe316e0a55aa7169b5ca08a87ccfada27ede6a", "message": "[GEOT-6462] MBStyle font management can lead to tofu chars", "committedDate": "2020-01-16T11:26:12Z", "type": "commit"}, {"oid": "b6fe316e0a55aa7169b5ca08a87ccfada27ede6a", "url": "https://github.com/geotools/geotools/commit/b6fe316e0a55aa7169b5ca08a87ccfada27ede6a", "message": "[GEOT-6462] MBStyle font management can lead to tofu chars", "committedDate": "2020-01-16T11:26:12Z", "type": "forcePushed"}]}