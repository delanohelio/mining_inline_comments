{"pr_number": 2931, "pr_title": "[23.x backport] [GEOT-3377] Charset not used for DBF header", "pr_createdAt": "2020-05-13T10:08:57Z", "pr_url": "https://github.com/geotools/geotools/pull/2931", "timeline": [{"oid": "e97ff0a4d7bac9c55b201ebf11af0679a4951863", "url": "https://github.com/geotools/geotools/commit/e97ff0a4d7bac9c55b201ebf11af0679a4951863", "message": "[23.x backport] [GEOT-3377] Charset not used for DBF header", "committedDate": "2020-05-13T08:37:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYxOTc1MQ==", "url": "https://github.com/geotools/geotools/pull/2931#discussion_r424619751", "bodyText": "We tend not to backport API changes, I understand that this a protected constructor so the change is \"internal\".", "author": "jodygarnett", "createdAt": "2020-05-13T17:45:49Z", "path": "modules/plugin/shapefile/src/main/java/org/geotools/data/shapefile/ShapefileDataStore.java", "diffHunk": "@@ -320,10 +320,10 @@ String toSingleLineWKT(CoordinateReferenceSystem crs) {\n      * Attempt to create a DbaseFileHeader for the FeatureType. Note, we cannot set the number of\n      * records until the write has completed.\n      */\n-    protected static DbaseFileHeader createDbaseHeader(SimpleFeatureType featureType)\n-            throws IOException, DbaseFileException {\n+    protected static DbaseFileHeader createDbaseHeader(\n+            SimpleFeatureType featureType, Charset charset) throws IOException, DbaseFileException {", "originalCommit": "e97ff0a4d7bac9c55b201ebf11af0679a4951863", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYyMDY2Ng==", "url": "https://github.com/geotools/geotools/pull/2931#discussion_r424620666", "bodyText": "Thanks for preserving backwards compatibility", "author": "jodygarnett", "createdAt": "2020-05-13T17:47:24Z", "path": "modules/plugin/shapefile/src/main/java/org/geotools/data/shapefile/dbf/DbaseFileHeader.java", "diffHunk": "@@ -504,17 +524,26 @@ public int getHeaderLength() {\n      * @throws IOException If errors occur while reading.\n      */\n     public void readHeader(ReadableByteChannel channel) throws IOException {\n-        readHeader(channel, Charset.defaultCharset());\n+        readHeaderInternal(channel, this.charset);\n     }\n \n     /**\n      * Read the header data from the DBF file.\n      *\n      * @param channel A readable byte channel. If you have an InputStream you need to use, you can\n      *     call java.nio.Channels.getChannel(InputStream in).\n+     * @param charset A charset that will be used to read header field's names.\n      * @throws IOException If errors occur while reading.\n+     * @deprecated Use constructor {@link #constructor(Charset)} and {@link\n+     *     #readHeader(ReadableByteChannel)} method instead.\n      */\n+    @Deprecated\n     public void readHeader(ReadableByteChannel channel, Charset charset) throws IOException {", "originalCommit": "e97ff0a4d7bac9c55b201ebf11af0679a4951863", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}