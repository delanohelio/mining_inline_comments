{"pr_number": 2882, "pr_title": "[GEOT-6552] MBTilesSource getBoundsInternal should return BBOX from m\u2026", "pr_createdAt": "2020-04-16T16:09:45Z", "pr_url": "https://github.com/geotools/geotools/pull/2882", "timeline": [{"oid": "25961fd6fa66818d337dc7ab45829e16c915095e", "url": "https://github.com/geotools/geotools/commit/25961fd6fa66818d337dc7ab45829e16c915095e", "message": "[GEOT-6552] MBTilesSource getBoundsInternal should return BBOX from metadata", "committedDate": "2020-04-20T11:25:03Z", "type": "forcePushed"}, {"oid": "4904b7db36844a88b5357092533ad375530b3012", "url": "https://github.com/geotools/geotools/commit/4904b7db36844a88b5357092533ad375530b3012", "message": "[GEOT-6552] MBTilesSource getBoundsInternal should return BBOX from metadata", "committedDate": "2020-04-20T15:47:01Z", "type": "commit"}, {"oid": "4904b7db36844a88b5357092533ad375530b3012", "url": "https://github.com/geotools/geotools/commit/4904b7db36844a88b5357092533ad375530b3012", "message": "[GEOT-6552] MBTilesSource getBoundsInternal should return BBOX from metadata", "committedDate": "2020-04-20T15:47:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ5MTA2OQ==", "url": "https://github.com/geotools/geotools/pull/2882#discussion_r411491069", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (f != null && f.equals(Filter.INCLUDE)) {\n          \n          \n            \n                    if (f == null || f.equals(Filter.INCLUDE)) {", "author": "aaime", "createdAt": "2020-04-20T15:52:32Z", "path": "modules/unsupported/mbtiles/src/main/java/org/geotools/mbtiles/MBTilesFeatureSource.java", "diffHunk": "@@ -69,11 +73,19 @@ protected void addHints(Set<Hints.Key> hints) {\n \n     @Override\n     protected ReferencedEnvelope getBoundsInternal(Query query) throws IOException {\n-        // all mbtiles likely have a root tile that covers the world, the real intended\n-        // bound is normally found at the max zoom level. However, the latest zoom level is the one\n-        // with the most tiles, this takes ages on large mbtiles,\n-        // so best to have it disabled... or maybe make it optional later\n-        return null;\n+        Filter f = query.getFilter();\n+        if (f != null && f.equals(Filter.INCLUDE)) {", "originalCommit": "4904b7db36844a88b5357092533ad375530b3012", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ5NDg0Mw==", "url": "https://github.com/geotools/geotools/pull/2882#discussion_r411494843", "bodyText": "Was a bit surprised but indeed the bbox in the medatata is the whole world:\n\nSo looking good.", "author": "aaime", "createdAt": "2020-04-20T15:57:09Z", "path": "modules/unsupported/mbtiles/src/test/java/org/geotools/mbtiles/MBTilesFeatureSourceTest.java", "diffHunk": "@@ -293,6 +294,35 @@ public void testReadOutsideWorld() throws Exception {\n         assertThat(rangesRead, Matchers.empty());\n     }\n \n+    @Test\n+    public void testGetBBOXQueryALL() throws Exception {\n+        File file =\n+                URLs.urlToFile(MBTilesFileVectorTileTest.class.getResource(\"madagascar.mbtiles\"));\n+        this.store = new MBTilesDataStore(new MBTilesFile(file));\n+        ReferencedEnvelope envelope = store.getFeatureSource(\"water\").getBounds();\n+        assertNotNull(envelope);\n+        assertEquals(\n+                new ReferencedEnvelope(", "originalCommit": "4904b7db36844a88b5357092533ad375530b3012", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fe339f315dad578e5f7b4839a5708df4c5489878", "url": "https://github.com/geotools/geotools/commit/fe339f315dad578e5f7b4839a5708df4c5489878", "message": "reviewer's feedback applied", "committedDate": "2020-04-20T16:12:37Z", "type": "commit"}]}