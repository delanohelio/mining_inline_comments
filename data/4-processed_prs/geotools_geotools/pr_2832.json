{"pr_number": 2832, "pr_title": "GEOT-6529 Update Oracle JDBC driver", "pr_createdAt": "2020-03-09T13:40:39Z", "pr_url": "https://github.com/geotools/geotools/pull/2832", "timeline": [{"oid": "f9e479abbb5ee0d5089cabdd95a739c3456058ea", "url": "https://github.com/geotools/geotools/commit/f9e479abbb5ee0d5089cabdd95a739c3456058ea", "message": "WIP GEOT-6529 initial steps to update oracle driver", "committedDate": "2020-03-10T09:49:21Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIwMjIyMQ==", "url": "https://github.com/geotools/geotools/pull/2832#discussion_r390202221", "bodyText": "You got long Februaries where you live :-D", "author": "aaime", "createdAt": "2020-03-10T09:56:29Z", "path": "docs/user/build/install/ojdbc.rst", "diffHunk": "@@ -1,34 +1,5 @@\n Oracle (Optional)\n -----------------\n \n-In order to use the Oracle module you need the proprietary JDBC driver from Oracle.\n+As of Feb 287 2020 Oracle has started hosting their JDBC drivers and required dependencies on Maven Central, special actions are no longer required.", "originalCommit": "f9e479abbb5ee0d5089cabdd95a739c3456058ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIwMzc5Mw==", "url": "https://github.com/geotools/geotools/pull/2832#discussion_r390203793", "bodyText": "\ud83e\udd23", "author": "mprins", "createdAt": "2020-03-10T09:59:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIwMjIyMQ=="}], "type": "inlineReview"}, {"oid": "88726cd709eaa7b956f7cf5167059865dbe4db63", "url": "https://github.com/geotools/geotools/commit/88726cd709eaa7b956f7cf5167059865dbe4db63", "message": "Fix oracle STRUCT and ARRAY deprecation", "committedDate": "2020-03-12T13:51:15Z", "type": "forcePushed"}, {"oid": "525566de57500bb0f9945c95afa49a918db4069d", "url": "https://github.com/geotools/geotools/commit/525566de57500bb0f9945c95afa49a918db4069d", "message": "factor-out deprecated oracle.sql.StructDescriptor and fixup javadoc", "committedDate": "2020-03-12T14:54:42Z", "type": "forcePushed"}, {"oid": "3a5112aa60e8a3be6a798607142b22b90fe6cd6b", "url": "https://github.com/geotools/geotools/commit/3a5112aa60e8a3be6a798607142b22b90fe6cd6b", "message": "factor-out deprecated oracle.sql.StructDescriptor and fixup javadoc\n\nuse StringBuilder for improved performance\n\nIgnore  as even in plain SQL it seems to fail\n\nremove/cleanup deprecated ArrayDescriptor and StructDescriptor", "committedDate": "2020-03-16T14:16:23Z", "type": "forcePushed"}, {"oid": "b16fe7cccb1677432a4ec259c433926a6bb90add", "url": "https://github.com/geotools/geotools/commit/b16fe7cccb1677432a4ec259c433926a6bb90add", "message": "GEOT-6529 update oracle driver\n\nAlso factor out all Oracle deprecations, notably any use of:\n\n- oracle.sql.STRUCT\n- oracle.sql.ARRAY\n- oracle.sql.StructDescriptor\n- oracle.sql.ArrayDescriptor\n\nMake sure to use the proper driver classname, which is `oracle.jdbc.OracleDriver`,\nas well as some javadoc fixes and some replacement of StringBuffer by StringBuilder for improved performance.\n\nIgnore `Oracle3DOnlineTest#testBBOX3DOutsideLine()` as even in plain SQL it seems to fail", "committedDate": "2020-03-17T11:32:00Z", "type": "forcePushed"}, {"oid": "cc675f159978e2635eb3f2a6958a5de2f4c17f2f", "url": "https://github.com/geotools/geotools/commit/cc675f159978e2635eb3f2a6958a5de2f4c17f2f", "message": "[GEOT-6529] Update Oracle JDBC driver\n\nAlso factor out all Oracle deprecations, notably any use of:\n\n- oracle.sql.STRUCT\n- oracle.sql.ARRAY\n- oracle.sql.StructDescriptor\n- oracle.sql.ArrayDescriptor\n\nMake sure to use the proper driver classname, which is `oracle.jdbc.OracleDriver`,\nas well as some javadoc fixes and some replacement of StringBuffer by StringBuilder for improved performance.\n\nIgnore `Oracle3DOnlineTest#testBBOX3DOutsideLine()` as even in plain SQL it seems to fail", "committedDate": "2020-03-17T12:31:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkzNzQ4NQ==", "url": "https://github.com/geotools/geotools/pull/2832#discussion_r393937485", "bodyText": "I think you could remove this whole section, rather than leave a note that will gradually expire over time.", "author": "jodygarnett", "createdAt": "2020-03-17T20:04:30Z", "path": "docs/user/build/install/ojdbc.rst", "diffHunk": "@@ -1,34 +1,4 @@\n Oracle (Optional)\n -----------------\n \n-In order to use the Oracle module you need the proprietary JDBC driver from Oracle.\n-\n-This page provides instructions for the ``plugins/jdbc/jdbc-oracle`` plugin:\n-\n-* The old unsupported Oracle datastore can be built with similar instructions. You will  have to use ``-Doracle.jdbc`` in place of ``-Doracle`` when creating the Eclipse projects\n-* As of Oracle 10.2 oracle has decided to \"seal\" its jar files (a security option that can be turned on in the manifest file). This option limits access to package-protected members to classes defined in the package and in the same JAR file. This means that the only way to create a connection is via a DataSource (and we are not there yet since we still use JDBC Drivers).\n-   \n-  Please download a driver from the 10.1.x series in order to avoid the above problem.\n-\n-Download the Driver and place into the Repository\n-^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-Unlike most external libraries used in GeoTools, we cannot redistribute this jar. However, you can obtain them from the Oracle website, free of charge, after registering:\n-\n-1. Download the Oracle JDBC Driver: http://otn.oracle.com/software/tech/java/sqlj_jdbc/content.html\n-2. Once you download the jar, you should place them in the Oracle Maven repository directory::\n-      \n-      mvn install:install-file -Dfile=ojdbc7.jar -DgroupId=com.oracle -DartifactId=ojdbc7 -Dversion=12.1.0.2 -Dpackaging=jar -DgeneratePom=true\n-\n-Switching between Oracle Profiles with oracle.jdbc property\n-^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-The oracle modules are all set up to work with a pretend \"mock\" jdbc driver in order to compile. To actually use the real thing you are going to need to set the ``oracle.jdbc`` property.\n-\n-You will need to do this each time on the command line (as of Maven 2.0.4 there is no way to set a property in your ``settings.xml`` file that can be used to configure other profiles):\n-\n-Here is an example that builds eclipse .classpath and .project files using the real driver::\n-   \n-   mvn eclipse:eclipse -Doracle\n-\n-If the property is not set the \u201cdummy\u201d jdbc driver will be used.\n+As of Feb 27 2020 Oracle has started hosting their JDBC drivers and required dependencies on Maven Central, special actions are no longer required.", "originalCommit": "cc675f159978e2635eb3f2a6958a5de2f4c17f2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI0MTI4MA==", "url": "https://github.com/geotools/geotools/pull/2832#discussion_r394241280", "bodyText": "that would leave the file empty, so the file can then be deleted?", "author": "mprins", "createdAt": "2020-03-18T10:22:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkzNzQ4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzNzQyNQ==", "url": "https://github.com/geotools/geotools/pull/2832#discussion_r408337425", "bodyText": "Yes the file can be removed then.", "author": "jodygarnett", "createdAt": "2020-04-14T18:11:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkzNzQ4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYyMTY3Nw==", "url": "https://github.com/geotools/geotools/pull/2832#discussion_r408621677", "bodyText": "done", "author": "mprins", "createdAt": "2020-04-15T07:00:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkzNzQ4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkzODAzMg==", "url": "https://github.com/geotools/geotools/pull/2832#discussion_r393938032", "bodyText": "TODO: We should make a note of this in our updating.rst file", "author": "jodygarnett", "createdAt": "2020-03-17T20:05:37Z", "path": "docs/user/library/referencing/oracle.rst", "diffHunk": "@@ -91,7 +91,7 @@ The following connection management facilities are provided:\n Example using the popular ``commons-dbcp`` implementation of DataSource::\n     \n     BasicDataSource source = new BasicDataSource();\n-    source.setDriverClassName(\"oracle.jdbc.driver.OracleDriver\");\n+    source.setDriverClassName(\"oracle.jdbc.OracleDriver\");", "originalCommit": "cc675f159978e2635eb3f2a6958a5de2f4c17f2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIzODYyOQ==", "url": "https://github.com/geotools/geotools/pull/2832#discussion_r394238629", "bodyText": "The old class is still there in ojdbc8/19.3.x, but was deprecated some years ago.\nWhen upgrading  to ojdbc10 (java 10+) or a higher version eg. 20.??.x it may disappear.", "author": "mprins", "createdAt": "2020-03-18T10:18:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkzODAzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk0MDUyMg==", "url": "https://github.com/geotools/geotools/pull/2832#discussion_r393940522", "bodyText": "Can we correct the test? JTS does now support the Z and M parameters so it should finally be possible to make this work.", "author": "jodygarnett", "createdAt": "2020-03-17T20:10:36Z", "path": "modules/plugin/jdbc/jdbc-oracle/src/test/java/org/geotools/data/oracle/Oracle3DOnlineTest.java", "diffHunk": "@@ -32,5 +33,28 @@ protected JDBC3DTestSetup createTestSetup() {\n      * GEOT-4133\n      */\n     @Override\n-    public void testCreateSchemaAndInsertPolyRectangle() throws Exception {}\n+    public void testCreateSchemaAndInsertPolyRectangle() {}\n+\n+    /**\n+     * This test does not work in Oracle, not even in SQL.", "originalCommit": "cc675f159978e2635eb3f2a6958a5de2f4c17f2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI1MDU0NQ==", "url": "https://github.com/geotools/geotools/pull/2832#discussion_r394250545", "bodyText": "I'll take another look at this, I think SDOSqlDumper only ever outputs 2D SDO geometries; but I'm not sure that is used or that GeometryConverter is used which should output 3D geometries (apart from Rectangle which seems a requirement for SDO filters - this may of course have changed), see:\n\n  \n    \n      geotools/modules/plugin/jdbc/jdbc-oracle/src/main/java/org/geotools/data/oracle/sdo/GeometryConverter.java\n    \n    \n        Lines 161 to 182\n      in\n      ff084ef\n    \n    \n    \n    \n\n        \n          \n           if (env.getWidth() > 0 \n        \n\n        \n          \n                   && env.getHeight() > 0 \n        \n\n        \n          \n                   && !(geom instanceof GeometryCollection) \n        \n\n        \n          \n                   && geom.isRectangle()) { \n        \n\n        \n          \n               // rectangle optimization. Actually, more than an optimization. A few operators \n        \n\n        \n          \n               // do not work properly if they don't get rectangular geoms encoded as rectangles \n        \n\n        \n          \n               // SDO_FILTER is an example of this silly situation \n        \n\n        \n          \n               SDO_POINT = null; \n        \n\n        \n          \n               int elemInfo[] = new int[] {1, 1003, 3}; \n        \n\n        \n          \n               double ordinates[]; \n        \n\n        \n          \n               if (SDO.D(geom) == 2) \n        \n\n        \n          \n                   ordinates = \n        \n\n        \n          \n                           new double[] { \n        \n\n        \n          \n                               env.getMinX(), env.getMinY(), env.getMaxX(), env.getMaxY() \n        \n\n        \n          \n                           }; \n        \n\n        \n          \n               else \n        \n\n        \n          \n                   ordinates = \n        \n\n        \n          \n                           new double[] { \n        \n\n        \n          \n                               env.getMinX(), env.getMinY(), 0, env.getMaxX(), env.getMaxY(), 0 \n        \n\n        \n          \n                           }; \n        \n\n        \n          \n            \n        \n\n        \n          \n               SDO_POINT = null;", "author": "mprins", "createdAt": "2020-03-18T10:38:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk0MDUyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk0MDk4NQ==", "url": "https://github.com/geotools/geotools/pull/2832#discussion_r393940985", "bodyText": "Happy to see this.", "author": "jodygarnett", "createdAt": "2020-03-17T20:11:25Z", "path": "pom.xml", "diffHunk": "@@ -1284,11 +1278,10 @@\n       </dependency>\n \n       <!-- ORACLE -->\n-      <!-- Download and install into your own repo -->\n       <dependency>\n-        <artifactId>ojdbc7</artifactId>\n-        <groupId>com.oracle</groupId>\n-        <version>12.1.0.2</version>\n+        <artifactId>ojdbc8</artifactId>\n+        <groupId>com.oracle.database.jdbc</groupId>\n+        <version>19.3.0.0</version>", "originalCommit": "cc675f159978e2635eb3f2a6958a5de2f4c17f2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "28f9001e452261b2d637c26537ef70ecdd674a0c", "url": "https://github.com/geotools/geotools/commit/28f9001e452261b2d637c26537ef70ecdd674a0c", "message": "[GEOT-6529] Update Oracle JDBC driver\n\nAlso factor out all Oracle deprecations, notably any use of:\n\n- oracle.sql.STRUCT\n- oracle.sql.ARRAY\n- oracle.sql.StructDescriptor\n- oracle.sql.ArrayDescriptor\n\nMake sure to use the proper driver classname, which is `oracle.jdbc.OracleDriver`,\nas well as some javadoc fixes and some replacement of StringBuffer by StringBuilder for improved performance.\n\nIgnore `Oracle3DOnlineTest#testBBOX3DOutsideLine()` as even in plain SQL it seems to fail\n\nAdd a note to use the proper oracle driver class name in the upgrade notes", "committedDate": "2020-03-18T10:41:11Z", "type": "forcePushed"}, {"oid": "d1d73472a6430caa099ca9176ca88f33cc65c6b7", "url": "https://github.com/geotools/geotools/commit/d1d73472a6430caa099ca9176ca88f33cc65c6b7", "message": "[GEOT-6529] Update Oracle JDBC driver\n\nAlso factor out all Oracle deprecations, notably any use of:\n\n- oracle.sql.STRUCT\n- oracle.sql.ARRAY\n- oracle.sql.StructDescriptor\n- oracle.sql.ArrayDescriptor\n\nMake sure to use the proper driver classname, which is `oracle.jdbc.OracleDriver`,\nas well as some javadoc fixes and some replacement of StringBuffer by StringBuilder for improved performance.\n\nIgnore `Oracle3DOnlineTest#testBBOX3DOutsideLine()` as even in plain SQL it seems to fail\n\nAdd a note to use the proper oracle driver class name in the upgrade notes", "committedDate": "2020-03-19T09:38:00Z", "type": "forcePushed"}, {"oid": "68fd4ad0a2314deeb5e18bc86abeb85c4e8c3df5", "url": "https://github.com/geotools/geotools/commit/68fd4ad0a2314deeb5e18bc86abeb85c4e8c3df5", "message": "[GEOT-6529] Update Oracle JDBC driver\n\nAlso factor out all Oracle deprecations, notably any use of:\n\n- oracle.sql.STRUCT\n- oracle.sql.ARRAY\n- oracle.sql.StructDescriptor\n- oracle.sql.ArrayDescriptor\n\nMake sure to use the proper driver classname, which is `oracle.jdbc.OracleDriver`,\nas well as some javadoc fixes and some replacement of StringBuffer by StringBuilder for improved performance.\n\nIgnore `Oracle3DOnlineTest#testBBOX3DOutsideLine()` as even in plain SQL it seems to fail\n\nAdd a note to use the proper oracle driver class name in the upgrade notes\n\nRemove no longer useful user instructions for getting the oracle driver", "committedDate": "2020-04-15T07:03:51Z", "type": "forcePushed"}, {"oid": "8946eda1c14f94bf580f329c18ddc06e968b1874", "url": "https://github.com/geotools/geotools/commit/8946eda1c14f94bf580f329c18ddc06e968b1874", "message": "[GEOT-6529] Update Oracle JDBC driver\n\nAlso factor out all Oracle deprecations, notably any use of:\n\n- oracle.sql.STRUCT\n- oracle.sql.ARRAY\n- oracle.sql.StructDescriptor\n- oracle.sql.ArrayDescriptor\n\nMake sure to use the proper driver classname, which is `oracle.jdbc.OracleDriver`,\nas well as some javadoc fixes and some replacement of StringBuffer by StringBuilder for improved performance.\n\nIgnore `Oracle3DOnlineTest#testBBOX3DOutsideLine()` as even in plain SQL it seems to fail\n\nAdd a note to use the proper oracle driver class name in the upgrade notes\n\nRemove no longer useful user instructions for getting the oracle driver", "committedDate": "2020-04-21T13:40:45Z", "type": "forcePushed"}, {"oid": "75c042abff9a341416106c8751bf5ff6b835f0ff", "url": "https://github.com/geotools/geotools/commit/75c042abff9a341416106c8751bf5ff6b835f0ff", "message": "[GEOT-6529] Update Oracle JDBC driver\n\nAlso factor out all Oracle deprecations, notably any use of:\n\n- oracle.sql.STRUCT\n- oracle.sql.ARRAY\n- oracle.sql.StructDescriptor\n- oracle.sql.ArrayDescriptor\n\nMake sure to use the proper driver classname, which is `oracle.jdbc.OracleDriver`,\nas well as some javadoc fixes and some replacement of StringBuffer by StringBuilder for improved performance.\n\nIgnore `Oracle3DOnlineTest#testBBOX3DOutsideLine()` as even in plain SQL it seems to fail\n\nAdd a note to use the proper oracle driver class name in the upgrade notes\n\nRemove no longer useful user instructions for getting the oracle driver", "committedDate": "2020-04-23T10:42:43Z", "type": "commit"}, {"oid": "75c042abff9a341416106c8751bf5ff6b835f0ff", "url": "https://github.com/geotools/geotools/commit/75c042abff9a341416106c8751bf5ff6b835f0ff", "message": "[GEOT-6529] Update Oracle JDBC driver\n\nAlso factor out all Oracle deprecations, notably any use of:\n\n- oracle.sql.STRUCT\n- oracle.sql.ARRAY\n- oracle.sql.StructDescriptor\n- oracle.sql.ArrayDescriptor\n\nMake sure to use the proper driver classname, which is `oracle.jdbc.OracleDriver`,\nas well as some javadoc fixes and some replacement of StringBuffer by StringBuilder for improved performance.\n\nIgnore `Oracle3DOnlineTest#testBBOX3DOutsideLine()` as even in plain SQL it seems to fail\n\nAdd a note to use the proper oracle driver class name in the upgrade notes\n\nRemove no longer useful user instructions for getting the oracle driver", "committedDate": "2020-04-23T10:42:43Z", "type": "forcePushed"}]}