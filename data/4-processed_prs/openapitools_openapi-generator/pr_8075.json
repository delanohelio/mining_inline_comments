{"pr_number": 8075, "pr_title": "Fix bug [python][client] generated python client code cannot POST object in multipart/form-data", "pr_createdAt": "2020-12-02T14:40:29Z", "pr_url": "https://github.com/OpenAPITools/openapi-generator/pull/8075", "timeline": [{"oid": "c3b021d16c3d02f6fbc51dbc31cbea77522d45ef", "url": "https://github.com/OpenAPITools/openapi-generator/commit/c3b021d16c3d02f6fbc51dbc31cbea77522d45ef", "message": "update samples again, by ./bin/generate-samples.sh", "committedDate": "2020-12-03T09:16:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ5MjE2NA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8075#discussion_r535492164", "bodyText": "If we keep your code as-is, then it will always ingest tuples for params.\nSo if you want to keep it as-is, please change this docstring to describe params as tuples not a dict.", "author": "spacether", "createdAt": "2020-12-03T18:47:46Z", "path": "modules/openapi-generator/src/main/resources/python/api_client.mustache", "diffHunk": "@@ -243,6 +247,26 @@ class ApiClient(object):\n                                       response_data.getheaders()))\n {{/tornado}}\n \n+    def parameters_to_multipart(self, params, collection_types):\n+        \"\"\"Get parameters as list of tuples, formatting as json if value is collection_types\n+\n+        :param params: Parameters as dict or list of two-tuples", "originalCommit": "c3b021d16c3d02f6fbc51dbc31cbea77522d45ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTc5ODMwNw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8075#discussion_r535798307", "bodyText": "@spacether ,  thank you for your feed back. Do You mean docstring should be changed as bellow, collect? just confirming before update & push.\n-                    :param params: Parameters as dict or list of two-tuples\n+                    :param params: Parameters as list of two-tuples", "author": "itaru2622", "createdAt": "2020-12-04T02:55:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ5MjE2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUyMzA2MA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8075#discussion_r537523060", "bodyText": "docstring updated by 1f74d2e, please check it.", "author": "itaru2622", "createdAt": "2020-12-07T13:54:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ5MjE2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzcwNDY1NQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8075#discussion_r537704655", "bodyText": "Thank you!", "author": "spacether", "createdAt": "2020-12-07T17:49:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ5MjE2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ5MjcwMw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8075#discussion_r535492703", "bodyText": "How about:\nif header_params['Content-Type'].startswith(\"multipart\"):\n    post_params = self.parameters_to_multipart(post_params, (dict))\nelse:\n    post_params = self.parameters_to_tuples(post_params, collection_formats)\n\nThat way we don't run parameters_to_tuples when we don't need it.", "author": "spacether", "createdAt": "2020-12-03T18:48:40Z", "path": "modules/openapi-generator/src/main/resources/python/api_client.mustache", "diffHunk": "@@ -169,6 +170,9 @@ class ApiClient(object):\n             post_params = self.parameters_to_tuples(post_params,\n                                                     collection_formats)\n             post_params.extend(self.files_parameters(files))\n+            if header_params['Content-Type'].startswith(\"multipart\"):\n+                post_params = self.parameters_to_multipart(post_params,\n+                                                          (dict) )", "originalCommit": "c3b021d16c3d02f6fbc51dbc31cbea77522d45ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTgyMjgzMQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8075#discussion_r535822831", "bodyText": "@spacether, Your changes may not work as you expect. For example,\nnon dict parameter in multipart will be almost passthrough-ed by parameters_to_multipart(just became tuple) and not converted by parameters_to_tuples manner.\ni.e There is no csv handling in parameters_to_multipart but  parameters_to_tuples has it.\nin my code,  non dict parameter is converted by legacy manner and only if parameter is dict in multipart, it is converted to json.", "author": "itaru2622", "createdAt": "2020-12-04T04:12:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ5MjcwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg4NTM0MQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8075#discussion_r536885341", "bodyText": "So we need them to always be tuples as inputs in parameters_to_multipart?\nIf so, please update the docstring there to correctly describe that params will always be tuples and will never be a dict.", "author": "spacether", "createdAt": "2020-12-05T20:16:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ5MjcwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzIwOTIzMQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8075#discussion_r537209231", "bodyText": "@spacether, do you mean I need to change docstring more in addition to the first comment? I think the change by first comment (1f74d2e) is enough, but if you feel something lacked, I can add it in docstring.", "author": "itaru2622", "createdAt": "2020-12-07T03:38:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ5MjcwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzcwNDI5NA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8075#discussion_r537704294", "bodyText": "Thanks. I am all set here. I wanted the change that you made:\n    def parameters_to_multipart(self, params, collection_types):\n        \"\"\"Get parameters as list of tuples, formatting as json if value is collection_types\n\n        :param params: Parameters as list of two-tuple", "author": "spacether", "createdAt": "2020-12-07T17:48:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ5MjcwMw=="}], "type": "inlineReview"}, {"oid": "013cbed589d52f5c3f6cd7b83fdccb875ef10eba", "url": "https://github.com/OpenAPITools/openapi-generator/commit/013cbed589d52f5c3f6cd7b83fdccb875ef10eba", "message": "update samples again, by ./bin/generate-samples.sh", "committedDate": "2020-12-07T10:35:04Z", "type": "forcePushed"}, {"oid": "c891d5cb6ec5a6b00cea5214b122a6f17e960bb8", "url": "https://github.com/OpenAPITools/openapi-generator/commit/c891d5cb6ec5a6b00cea5214b122a6f17e960bb8", "message": "encode object in json and add content-type:application/json for multipart/form-data\n\nfix issue https://github.com/OpenAPITools/openapi-generator/issues/8068", "committedDate": "2020-12-07T13:44:06Z", "type": "commit"}, {"oid": "e3127b1a953fff4297a38a9a478ab9354c150492", "url": "https://github.com/OpenAPITools/openapi-generator/commit/e3127b1a953fff4297a38a9a478ab9354c150492", "message": "update samples by ./bin/generate-samples.sh", "committedDate": "2020-12-07T13:44:06Z", "type": "commit"}, {"oid": "c7803dcf9f6858fb3c4f18331ecb9e1fcbe68be1", "url": "https://github.com/OpenAPITools/openapi-generator/commit/c7803dcf9f6858fb3c4f18331ecb9e1fcbe68be1", "message": "non-ascii chars supported in encoding object to json, and add \"content-type:application/json; charset=utf-8\"", "committedDate": "2020-12-07T13:44:06Z", "type": "commit"}, {"oid": "378bb638e6d3ea937c94d472b60be6b7d999e215", "url": "https://github.com/OpenAPITools/openapi-generator/commit/378bb638e6d3ea937c94d472b60be6b7d999e215", "message": "update samples again, by ./bin/generate-samples.sh", "committedDate": "2020-12-07T13:44:07Z", "type": "commit"}, {"oid": "1f74d2e31f6ea571af5fdf507bf0b331a4782c4b", "url": "https://github.com/OpenAPITools/openapi-generator/commit/1f74d2e31f6ea571af5fdf507bf0b331a4782c4b", "message": "update comment(docstring) in parameters_to_multipart according to the discussion in PR review.", "committedDate": "2020-12-07T13:44:07Z", "type": "commit"}, {"oid": "a6c8d1a0a5b97e75dab22c12e36ffd179637b99f", "url": "https://github.com/OpenAPITools/openapi-generator/commit/a6c8d1a0a5b97e75dab22c12e36ffd179637b99f", "message": "fix default value in parameters_to_multipart function as described in PR review comment.", "committedDate": "2020-12-07T13:44:07Z", "type": "commit"}, {"oid": "db523234f79539d45e34c1b67fdf13720bbd5e87", "url": "https://github.com/OpenAPITools/openapi-generator/commit/db523234f79539d45e34c1b67fdf13720bbd5e87", "message": "update samples again, by ./bin/generate-samples.sh", "committedDate": "2020-12-07T13:44:07Z", "type": "commit"}, {"oid": "db523234f79539d45e34c1b67fdf13720bbd5e87", "url": "https://github.com/OpenAPITools/openapi-generator/commit/db523234f79539d45e34c1b67fdf13720bbd5e87", "message": "update samples again, by ./bin/generate-samples.sh", "committedDate": "2020-12-07T13:44:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzIxMjA1Ng==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8075#discussion_r537212056", "bodyText": "I should fix my mistake about line 259, as below:\n        if collection_types is None:\n-          collection_types = (dict,list)\n+          collection_types = (dict)", "author": "itaru2622", "createdAt": "2020-12-07T03:48:42Z", "path": "modules/openapi-generator/src/main/resources/python/api_client.mustache", "diffHunk": "@@ -243,6 +247,26 @@ class ApiClient(object):\n                                       response_data.getheaders()))\n {{/tornado}}\n \n+    def parameters_to_multipart(self, params, collection_types):\n+        \"\"\"Get parameters as list of tuples, formatting as json if value is collection_types\n+\n+        :param params: Parameters as dict or list of two-tuples\n+        :param dict collection_types: Parameter collection types\n+        :return: Parameters as list of tuple or urllib3.fields.RequestField\n+        \"\"\"\n+        new_params = []\n+        if collection_types is None:\n+            collection_types = (dict,list)", "originalCommit": "c3b021d16c3d02f6fbc51dbc31cbea77522d45ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUyMzg4Mw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8075#discussion_r537523883", "bodyText": "the above is fixed by a6c8d1a.", "author": "itaru2622", "createdAt": "2020-12-07T13:55:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzIxMjA1Ng=="}], "type": "inlineReview"}]}