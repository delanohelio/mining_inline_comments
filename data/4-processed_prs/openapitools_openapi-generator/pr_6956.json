{"pr_number": 6956, "pr_title": "[Java][jersey2] Fix `serializeToString`", "pr_createdAt": "2020-07-16T03:30:54Z", "pr_url": "https://github.com/OpenAPITools/openapi-generator/pull/6956", "timeline": [{"oid": "a0e627a729721bfbdff363601264a97986097d55", "url": "https://github.com/OpenAPITools/openapi-generator/commit/a0e627a729721bfbdff363601264a97986097d55", "message": "fix empty get body in serializeToString, add tests", "committedDate": "2020-07-16T03:10:08Z", "type": "commit"}, {"oid": "7ad472b4ff3deac6751dbe02f3f0a0630400fecf", "url": "https://github.com/OpenAPITools/openapi-generator/commit/7ad472b4ff3deac6751dbe02f3f0a0630400fecf", "message": "add new file", "committedDate": "2020-07-16T03:10:34Z", "type": "commit"}, {"oid": "5bd6419dfc05b0ec40bb35acc18f2c0b05c48f71", "url": "https://github.com/OpenAPITools/openapi-generator/commit/5bd6419dfc05b0ec40bb35acc18f2c0b05c48f71", "message": "Merge remote-tracking branch 'origin/master' into fix-jersey2-serializetostring", "committedDate": "2020-07-16T06:53:13Z", "type": "commit"}, {"oid": "cfe97a54fef276200cf427501d5cb8d7fbd01e17", "url": "https://github.com/OpenAPITools/openapi-generator/commit/cfe97a54fef276200cf427501d5cb8d7fbd01e17", "message": "fix serialize to better handle null string", "committedDate": "2020-07-16T07:49:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg1MTg5OA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6956#discussion_r455851898", "bodyText": "Did you mean\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // nullable string \"string\" should give \"\\\"null\\\"\"\n          \n          \n            \n                    // nullable string \"null\" should give \"\\\"null\\\"\"", "author": "sebastien-rosset", "createdAt": "2020-07-16T14:57:37Z", "path": "samples/openapi3/client/petstore/java/jersey2-java8/src/test/java/org/openapitools/client/ApiClientTest.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package org.openapitools.client;\n+\n+import org.openapitools.client.model.*;\n+import org.openapitools.client.ApiClient;\n+\n+import java.lang.Exception;\n+import java.util.Arrays;\n+import java.util.Date;\n+import java.util.TimeZone;\n+import java.text.SimpleDateFormat;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneId;\n+import java.time.format.DateTimeFormatter;\n+import org.junit.*;\n+import static org.junit.Assert.*;\n+\n+public class ApiClientTest {\n+    ApiClient apiClient = null;\n+    Pet pet = null;\n+\n+    @Before\n+    public void setup() {\n+        apiClient = new ApiClient();\n+        pet = new Pet();\n+    }\n+\n+    @Test\n+    public void testSerializeToString() throws Exception {\n+        Long petId = 4321L;\n+        pet.setId(petId);\n+        pet.setName(\"jersey2 java8 pet\");\n+        Category category = new Category();\n+        category.setId(petId);\n+        category.setName(\"jersey2 java8 category\");\n+        pet.setCategory(category);\n+        pet.setStatus(Pet.StatusEnum.AVAILABLE);\n+        pet.setPhotoUrls(Arrays.asList(\"A\", \"B\", \"C\"));\n+        Tag tag = new Tag();\n+        tag.setId(petId);\n+        tag.setName(\"jersey2 java8 tag\");\n+        pet.setTags(Arrays.asList(tag));\n+\n+        String result = \"{\\\"id\\\":4321,\\\"category\\\":{\\\"id\\\":4321,\\\"name\\\":\\\"jersey2 java8 category\\\"},\\\"name\\\":\\\"jersey2 java8 pet\\\",\\\"photoUrls\\\":[\\\"A\\\",\\\"B\\\",\\\"C\\\"],\\\"tags\\\":[{\\\"id\\\":4321,\\\"name\\\":\\\"jersey2 java8 tag\\\"}],\\\"status\\\":\\\"available\\\"}\";\n+        assertEquals(result, apiClient.serializeToString(pet, null, \"application/json\", false));\n+        // nulllable and there should be no diffencne as the payload is not null\n+        assertEquals(result, apiClient.serializeToString(pet, null, \"application/json\", true));\n+\n+        // non-nullable null object should give \"\" (empty body)\n+        assertEquals(\"\", apiClient.serializeToString(null, null, \"application/json\", false));\n+        // nullable null object should give \"null\"\n+        assertEquals(\"null\", apiClient.serializeToString(null, null, \"application/json\", true));\n+\n+        // non-nullable empty string should give \"\\\"\\\"\" (empty json string)\n+        assertEquals(\"\\\"\\\"\", apiClient.serializeToString(\"\", null, \"application/json\", false));\n+        // nullable null empty string should give \"\\\"\\\"\" (empty json string)\n+        assertEquals(\"\\\"\\\"\", apiClient.serializeToString(\"\", null, \"application/json\", true));\n+\n+        // non-nullable string \"null\"  should give \"\\\"null\\\"\"\n+        assertEquals(\"\\\"null\\\"\", apiClient.serializeToString(\"null\", null, \"application/json\", false));\n+        // nullable string \"string\" should give \"\\\"null\\\"\"", "originalCommit": "cfe97a54fef276200cf427501d5cb8d7fbd01e17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg1MzIzMA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6956#discussion_r455853230", "bodyText": "Did you mean?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // nullable null empty string should give \"\\\"\\\"\" (empty json string)\n          \n          \n            \n                    // nullable empty string should give \"\\\"\\\"\" (empty json string)", "author": "sebastien-rosset", "createdAt": "2020-07-16T14:59:23Z", "path": "samples/openapi3/client/petstore/java/jersey2-java8/src/test/java/org/openapitools/client/ApiClientTest.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package org.openapitools.client;\n+\n+import org.openapitools.client.model.*;\n+import org.openapitools.client.ApiClient;\n+\n+import java.lang.Exception;\n+import java.util.Arrays;\n+import java.util.Date;\n+import java.util.TimeZone;\n+import java.text.SimpleDateFormat;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneId;\n+import java.time.format.DateTimeFormatter;\n+import org.junit.*;\n+import static org.junit.Assert.*;\n+\n+public class ApiClientTest {\n+    ApiClient apiClient = null;\n+    Pet pet = null;\n+\n+    @Before\n+    public void setup() {\n+        apiClient = new ApiClient();\n+        pet = new Pet();\n+    }\n+\n+    @Test\n+    public void testSerializeToString() throws Exception {\n+        Long petId = 4321L;\n+        pet.setId(petId);\n+        pet.setName(\"jersey2 java8 pet\");\n+        Category category = new Category();\n+        category.setId(petId);\n+        category.setName(\"jersey2 java8 category\");\n+        pet.setCategory(category);\n+        pet.setStatus(Pet.StatusEnum.AVAILABLE);\n+        pet.setPhotoUrls(Arrays.asList(\"A\", \"B\", \"C\"));\n+        Tag tag = new Tag();\n+        tag.setId(petId);\n+        tag.setName(\"jersey2 java8 tag\");\n+        pet.setTags(Arrays.asList(tag));\n+\n+        String result = \"{\\\"id\\\":4321,\\\"category\\\":{\\\"id\\\":4321,\\\"name\\\":\\\"jersey2 java8 category\\\"},\\\"name\\\":\\\"jersey2 java8 pet\\\",\\\"photoUrls\\\":[\\\"A\\\",\\\"B\\\",\\\"C\\\"],\\\"tags\\\":[{\\\"id\\\":4321,\\\"name\\\":\\\"jersey2 java8 tag\\\"}],\\\"status\\\":\\\"available\\\"}\";\n+        assertEquals(result, apiClient.serializeToString(pet, null, \"application/json\", false));\n+        // nulllable and there should be no diffencne as the payload is not null\n+        assertEquals(result, apiClient.serializeToString(pet, null, \"application/json\", true));\n+\n+        // non-nullable null object should give \"\" (empty body)\n+        assertEquals(\"\", apiClient.serializeToString(null, null, \"application/json\", false));\n+        // nullable null object should give \"null\"\n+        assertEquals(\"null\", apiClient.serializeToString(null, null, \"application/json\", true));\n+\n+        // non-nullable empty string should give \"\\\"\\\"\" (empty json string)\n+        assertEquals(\"\\\"\\\"\", apiClient.serializeToString(\"\", null, \"application/json\", false));\n+        // nullable null empty string should give \"\\\"\\\"\" (empty json string)", "originalCommit": "cfe97a54fef276200cf427501d5cb8d7fbd01e17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg1NjM0Mg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6956#discussion_r455856342", "bodyText": "I think this use case is non trivial to understand because there may be two variants:\n\nThe request is supposed to have an empty body by design, i.e. the OpenAPI doc request or response schema indicates the body is empty.\nThe client or server is setting the data incorrectly. I.e. the OpenAPI doc indicates the object is not nullable, but the actually either the client or server are setting to a null value.\n\nIs it even possible?", "author": "sebastien-rosset", "createdAt": "2020-07-16T15:03:36Z", "path": "samples/openapi3/client/petstore/java/jersey2-java8/src/test/java/org/openapitools/client/ApiClientTest.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package org.openapitools.client;\n+\n+import org.openapitools.client.model.*;\n+import org.openapitools.client.ApiClient;\n+\n+import java.lang.Exception;\n+import java.util.Arrays;\n+import java.util.Date;\n+import java.util.TimeZone;\n+import java.text.SimpleDateFormat;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneId;\n+import java.time.format.DateTimeFormatter;\n+import org.junit.*;\n+import static org.junit.Assert.*;\n+\n+public class ApiClientTest {\n+    ApiClient apiClient = null;\n+    Pet pet = null;\n+\n+    @Before\n+    public void setup() {\n+        apiClient = new ApiClient();\n+        pet = new Pet();\n+    }\n+\n+    @Test\n+    public void testSerializeToString() throws Exception {\n+        Long petId = 4321L;\n+        pet.setId(petId);\n+        pet.setName(\"jersey2 java8 pet\");\n+        Category category = new Category();\n+        category.setId(petId);\n+        category.setName(\"jersey2 java8 category\");\n+        pet.setCategory(category);\n+        pet.setStatus(Pet.StatusEnum.AVAILABLE);\n+        pet.setPhotoUrls(Arrays.asList(\"A\", \"B\", \"C\"));\n+        Tag tag = new Tag();\n+        tag.setId(petId);\n+        tag.setName(\"jersey2 java8 tag\");\n+        pet.setTags(Arrays.asList(tag));\n+\n+        String result = \"{\\\"id\\\":4321,\\\"category\\\":{\\\"id\\\":4321,\\\"name\\\":\\\"jersey2 java8 category\\\"},\\\"name\\\":\\\"jersey2 java8 pet\\\",\\\"photoUrls\\\":[\\\"A\\\",\\\"B\\\",\\\"C\\\"],\\\"tags\\\":[{\\\"id\\\":4321,\\\"name\\\":\\\"jersey2 java8 tag\\\"}],\\\"status\\\":\\\"available\\\"}\";\n+        assertEquals(result, apiClient.serializeToString(pet, null, \"application/json\", false));\n+        // nulllable and there should be no diffencne as the payload is not null\n+        assertEquals(result, apiClient.serializeToString(pet, null, \"application/json\", true));\n+\n+        // non-nullable null object should give \"\" (empty body)", "originalCommit": "cfe97a54fef276200cf427501d5cb8d7fbd01e17", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg2NzY2Nw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6956#discussion_r455867667", "bodyText": "The client or server is setting the data incorrectly\n\nThis can be prevented by marking the \"body\" parameter (OAS v2 term) as required.", "author": "wing328", "createdAt": "2020-07-16T15:19:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg1NjM0Mg=="}], "type": "inlineReview"}, {"oid": "d10b73da534fd074e2703d1386685a1512e0316c", "url": "https://github.com/OpenAPITools/openapi-generator/commit/d10b73da534fd074e2703d1386685a1512e0316c", "message": "update test comments", "committedDate": "2020-07-16T15:33:30Z", "type": "commit"}]}