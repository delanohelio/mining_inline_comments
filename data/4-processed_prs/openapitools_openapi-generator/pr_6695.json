{"pr_number": 6695, "pr_title": "[Java][jersey2] fix oneOf, anyOf documentation", "pr_createdAt": "2020-06-17T10:18:25Z", "pr_url": "https://github.com/OpenAPITools/openapi-generator/pull/6695", "timeline": [{"oid": "8015d28b7a5e394b2790680716ad315d1eb063be", "url": "https://github.com/OpenAPITools/openapi-generator/commit/8015d28b7a5e394b2790680716ad315d1eb063be", "message": "fix oneOf doc in Java jersey2", "committedDate": "2020-06-17T09:53:06Z", "type": "commit"}, {"oid": "6014c8938cd64df4df82ad900b08b1cd50cdb5c0", "url": "https://github.com/OpenAPITools/openapi-generator/commit/6014c8938cd64df4df82ad900b08b1cd50cdb5c0", "message": "fix sample code", "committedDate": "2020-06-17T10:01:46Z", "type": "commit"}, {"oid": "05d65d83ced5117293d9deecf16c2e9dd5d18fa4", "url": "https://github.com/OpenAPITools/openapi-generator/commit/05d65d83ced5117293d9deecf16c2e9dd5d18fa4", "message": "add new files", "committedDate": "2020-06-17T10:02:29Z", "type": "commit"}, {"oid": "6884c1671c0531678bd6d9000eadf44f55b923c7", "url": "https://github.com/OpenAPITools/openapi-generator/commit/6884c1671c0531678bd6d9000eadf44f55b923c7", "message": "minor tweat to the doc", "committedDate": "2020-06-17T10:14:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwOTk3Nw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6695#discussion_r441609977", "bodyText": "What about when we combine allOf and oneOf together?", "author": "spacether", "createdAt": "2020-06-17T14:55:57Z", "path": "modules/openapi-generator/src/main/resources/Java/libraries/jersey2/model_oneof_doc.mustache", "diffHunk": "@@ -0,0 +1,38 @@\n+# {{classname}}\n+\n+{{#description}}\n+{{&description}}\n+\n+{{/description}}\n+## oneOf schemas\n+{{#oneOf}}\n+* [{{{.}}}]({{{.}}}.md)\n+{{/oneOf}}", "originalCommit": "6884c1671c0531678bd6d9000eadf44f55b923c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY1ODA1Mg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6695#discussion_r441658052", "bodyText": "Let's step back. What does \"combine allOf and oneOf together\" really mean? Can you give an example of use case on that? What does the payload look like?", "author": "wing328", "createdAt": "2020-06-17T16:02:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwOTk3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcwMDY2Nw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6695#discussion_r441700667", "bodyText": "Sure. A use case for this is when a user extracts common shared properties into a schema and they choose to have those properties stored in the oneOf schema as additionalProperties, not through allOf inheritance.\nLet's look at an example:\nEdibleInterface:\n  type: object\n  properties:\n    calories:\n      type: integer\nApple:\n  type: object\n  properties:\n    color:\n      type: string\n    varietal:\n      type: string\nComposedSchema:\n  allOf:\n    - $ref: '#/components/schemas/EdibleInterface'\n  oneOf:\n    - $ref: '#/components/schemas/Apple'\n\nAnd a sample payload is:\n{\"calories\": 110, \"color\": \"yellow\", \"varietal\": \"golden delicious\"}\nAt the ComposedSchema level, allOf validates + oneOf validates, and if we chose to return an instance of Apple when deserializing ComposedSchema, Apple includes the property calories as an additionalProperty.\nAren't json schema definitions additive?\nComposedSchema says that a payload must validate both EdibleInterface + Apple, schemas together, correct?", "author": "spacether", "createdAt": "2020-06-17T17:12:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwOTk3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkxODY4Mw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6695#discussion_r441918683", "bodyText": "Let's focus on \"ComposedSchema\" and please forget about my implementation for the time being. Given the following:\nComposedSchema:\n  allOf:\n    - $ref: '#/components/schemas/EdibleInterface'\n  oneOf:\n    - $ref: '#/components/schemas/Apple'\n\noneOf and allOf are defined at the same level. Your understanding is that the properties defined in the oneOf schema are automatically unfolded and included in the object \"ComposedSchema\" (same level as the properties defined in the allOf schema), right?", "author": "wing328", "createdAt": "2020-06-18T01:30:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwOTk3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkyMDQyNA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6695#discussion_r441920424", "bodyText": "Yes, that's what I am trying to convey with the question\nComposedSchema says that a payload must validate both EdibleInterface + Apple, schemas together, correct?", "author": "spacether", "createdAt": "2020-06-18T01:37:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwOTk3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkzMDA4NQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6695#discussion_r441930085", "bodyText": "Assuming the answer to your question is yes, then the following is also valid, right?\nComposedSchema:\n  allOf:\n    - $ref: '#/components/schemas/EdibleInterface'\n  oneOf:\n    - type: string\n    - type: integer\n\nDoes it make sense to you? If it does, what does the payload (e.g. JSON) look like?", "author": "wing328", "createdAt": "2020-06-18T02:16:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwOTk3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkzNTk5Mw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6695#discussion_r441935993", "bodyText": "I think that it can only be combined when they are of the same type. What do you think?\nBecause your example asks us to do this\n3 + {\"calories\": 3}\nAlso, your example also applies to allof of different types which is not possible:\nallOf:\n\nApple\ninteger", "author": "spacether", "createdAt": "2020-06-18T02:40:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwOTk3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk0MTA0MQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6695#discussion_r441941041", "bodyText": "I think that it can only be combined when they are of the same type. What do you think?\n\nMy view is that it's not up to me (or you) whether there's such a rule to ensure the same type. It comes down to the definition in JSON schema. I may have missed it but I don't see such a rule explicitly (or implicitly) defined.\nOne more example. What about the following:\nComposedSchema:\n  allOf:\n    - $ref: '#/components/schemas/EdibleInterface'\n  oneOf:\n    - $ref: '#/components/schemas/Apple'\n    - $ref: '#/components/schemas/Banana'\n  oneOf:\n    - $ref: '#/components/schemas/Dog'\n    - $ref: '#/components/schemas/Cat'\n\nI assume it's also valid. Do you agree?", "author": "wing328", "createdAt": "2020-06-18T02:59:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwOTk3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk0NjIwNw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6695#discussion_r441946207", "bodyText": "Hmm isn't oneof a key? I thought that it was and that you can't have two of the same key.\nBased on that thought, I think that it is not valid.\nI will need to look at the spec to see what it says. Yup it is not up to us, I am asking about your understanding and interpretation.\nIs allOf of mixed types valid to you? If so, what payload can meet those requirements?", "author": "spacether", "createdAt": "2020-06-18T03:21:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwOTk3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk0OTExOQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6695#discussion_r441949119", "bodyText": "From the spec allof is defined as:\nThe OpenAPI Specification allows combining and extending model definitions using the allOf property of JSON Schema, in effect offering model composition. allOf takes an array of object definitions that are validated independently but together compose a single object.", "author": "spacether", "createdAt": "2020-06-18T03:34:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwOTk3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYxNDY3Mw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6695#discussion_r441614673", "bodyText": "What about when properties are set in the composed schema and we have oneOf or anyOf?", "author": "spacether", "createdAt": "2020-06-17T15:01:46Z", "path": "modules/openapi-generator/src/main/resources/Java/libraries/jersey2/model_doc.mustache", "diffHunk": "@@ -0,0 +1,19 @@\n+{{#models}}{{#model}}\n+\n+{{#isEnum}}\n+{{>enum_outer_doc}}\n+{{/isEnum}}\n+{{^isEnum}}\n+{{^oneOf.isEmpty}}\n+{{>model_oneof_doc}}", "originalCommit": "6884c1671c0531678bd6d9000eadf44f55b923c7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}