{"pr_number": 5175, "pr_title": "[go-experimental] Add model constructors to initialize non-container vars with defaults", "pr_createdAt": "2020-01-31T11:10:42Z", "pr_url": "https://github.com/OpenAPITools/openapi-generator/pull/5175", "timeline": [{"oid": "9df0d30588383359169a54e2eee6008c117619f5", "url": "https://github.com/OpenAPITools/openapi-generator/commit/9df0d30588383359169a54e2eee6008c117619f5", "message": "[go-experimental] Add model constructors to initialize non-container vars with defaults", "committedDate": "2020-01-31T11:21:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzNDQwMg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5175#discussion_r373434402", "bodyText": "can you add a docstring?", "author": "jirikuncar", "createdAt": "2020-01-31T11:25:31Z", "path": "modules/openapi-generator/src/main/resources/go-experimental/model.mustache", "diffHunk": "@@ -38,6 +38,19 @@ type {{classname}} struct {\n \t{{name}} {{^required}}*{{/required}}{{{dataType}}} `json:\"{{baseName}}{{^required}},omitempty{{/required}}\"{{#withXml}} xml:\"{{baseName}}{{#isXmlAttribute}},attr{{/isXmlAttribute}}\"{{/withXml}}{{#vendorExtensions.x-go-custom-tag}} {{{.}}}{{/vendorExtensions.x-go-custom-tag}}`\n {{/vars}}\n }\n+", "originalCommit": "9df0d30588383359169a54e2eee6008c117619f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzODU1NQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5175#discussion_r373438555", "bodyText": "Any reason not to require the required Params in the input?", "author": "platinummonkey", "createdAt": "2020-01-31T11:36:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzNDQwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ2OTEwOQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5175#discussion_r373469109", "bodyText": "@jirikuncar thanks for pointing out the docs I'll fix that.\n@platinummonkey I think the problem here is that it's not straightforward what to do with required params that have defaults set. Should these be required arguments for the constructor or not? I think that this uncertainty is why generated constructors in other similar languages don't have required params either. I'd like to stay consistent here, so that's why I chose this approach.", "author": "bkabrda", "createdAt": "2020-01-31T13:04:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzNDQwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ3MTczNA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5175#discussion_r373471734", "bodyText": "I pushed a new commit that adds both the docstring and also documentation in model_doc.", "author": "bkabrda", "createdAt": "2020-01-31T13:11:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzNDQwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ5MDYyNg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5175#discussion_r373490626", "bodyText": "New<ClassName>(args....) vs NewDefault<ClassName>() maybe is more clear?", "author": "platinummonkey", "createdAt": "2020-01-31T13:56:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzNDQwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUxODA0Nw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5175#discussion_r373518047", "bodyText": "@platinummonkey I just realized one more reason that is problematic with the required properties:\nImagine that you have required properties A and B and code generated for that: NewFoo(A, B). Now a change happens that makes B optional. You regenerate the code and suddenly you get NewFoo(A) - so that's backwards incompatible. But the change you did in API is backwards compatible, so this breaks the promise of not breaking API of the generated client when a non-breaking API change happens.", "author": "bkabrda", "createdAt": "2020-01-31T14:51:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzNDQwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU0OTcwMw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5175#discussion_r373549703", "bodyText": "I'm not actually sure that's a problem, if you need to introduce a var, this this method signature is also changed. The alternative is to list all variables, and if one becomes non-optional though or a new one is added then still the signature is changed. Seem moot given go's syntax.", "author": "platinummonkey", "createdAt": "2020-01-31T15:52:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzNDQwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY2MzEyOA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5175#discussion_r373663128", "bodyText": "The signature of this method will never change, as it never accepts any arguments. But I think I'm starting to like the solution proposed in your previous comment with New(required, args, ...) and NewWithDefaults(). Assuming we clearly document that the contract of the former will always change when the set of required arguments changes, it should be ok. I'll work on this.", "author": "bkabrda", "createdAt": "2020-01-31T20:06:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzNDQwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzOTAyMw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5175#discussion_r373439023", "bodyText": "Typically vars are camelCase. Types are TitleCase. So these two lines read very oddly", "author": "platinummonkey", "createdAt": "2020-01-31T11:38:19Z", "path": "samples/client/petstore/go-experimental/go-petstore/model_animal.go", "diffHunk": "@@ -20,6 +20,13 @@ type Animal struct {\n \tColor *string `json:\"color,omitempty\"`\n }\n \n+func NewAnimal() *Animal {\n+    this := Animal{}\n+    var Color string = \"red\"", "originalCommit": "9df0d30588383359169a54e2eee6008c117619f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ5MTY5Mg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5175#discussion_r373491692", "bodyText": "Yeah, I just used the name of the var. I think there might be a camelCase version of this somewhere in the rendering context, let me try to find and use it.", "author": "bkabrda", "createdAt": "2020-01-31T13:59:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzOTAyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUyNDI0Nw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5175#discussion_r373524247", "bodyText": "Fixed.", "author": "bkabrda", "createdAt": "2020-01-31T15:02:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzOTAyMw=="}], "type": "inlineReview"}, {"oid": "d2d9dd45550ac537f468ebea70cd5d153147d487", "url": "https://github.com/OpenAPITools/openapi-generator/commit/d2d9dd45550ac537f468ebea70cd5d153147d487", "message": "Provide 2 different constructurs as suggested + couple fixes to generate constructors right under all circumstances", "committedDate": "2020-02-03T13:30:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDkyMjM1Mw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5175#discussion_r374922353", "bodyText": "\ud83d\udc4d", "author": "jirikuncar", "createdAt": "2020-02-04T21:05:54Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/GoClientExperimentalCodegen.java", "diffHunk": "@@ -122,7 +130,11 @@ public String toDefaultValue(Schema p) {\n     @Override\n     public CodegenProperty fromProperty(String name, Schema p) {\n         CodegenProperty prop = super.fromProperty(name, p);\n-        prop.nameInCamelCase = camelize(prop.name, true);\n+        String cc = camelize(prop.name, true);\n+        if (isReservedWord(cc)) {\n+            cc = escapeReservedWord(cc);", "originalCommit": "8661844eccbce4064a6cde9e0fd421a99077d5ff", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cb5c54b51719135a1c6bcc05db73b775f83669c5", "url": "https://github.com/OpenAPITools/openapi-generator/commit/cb5c54b51719135a1c6bcc05db73b775f83669c5", "message": "[go-experimental] Add model constructors to initialize non-container vars with defaults", "committedDate": "2020-02-11T08:08:30Z", "type": "commit"}, {"oid": "fb7db905e73457679a392154b0d420e111ef9d5c", "url": "https://github.com/OpenAPITools/openapi-generator/commit/fb7db905e73457679a392154b0d420e111ef9d5c", "message": "Add docstring and extend model_doc to include the constructor", "committedDate": "2020-02-11T08:10:37Z", "type": "commit"}, {"oid": "a02abb5ef032cb438c935a59f92c9cd7001f349d", "url": "https://github.com/OpenAPITools/openapi-generator/commit/a02abb5ef032cb438c935a59f92c9cd7001f349d", "message": "Make variable names in constructor follow Go naming guidelines", "committedDate": "2020-02-11T08:10:40Z", "type": "commit"}, {"oid": "6e4e53855eafbc1d210b20ec617683b8cdb0ec7f", "url": "https://github.com/OpenAPITools/openapi-generator/commit/6e4e53855eafbc1d210b20ec617683b8cdb0ec7f", "message": "Provide 2 different constructurs as suggested + couple fixes to generate constructors right under all circumstances", "committedDate": "2020-02-11T08:10:43Z", "type": "commit"}, {"oid": "af2e0dc493877ccc9bb84b4ad73a68918aa47296", "url": "https://github.com/OpenAPITools/openapi-generator/commit/af2e0dc493877ccc9bb84b4ad73a68918aa47296", "message": "Fix defaults for enums", "committedDate": "2020-02-11T08:11:40Z", "type": "commit"}, {"oid": "f8543739ca2ba37d8c4d32193e55b8b76933f027", "url": "https://github.com/OpenAPITools/openapi-generator/commit/f8543739ca2ba37d8c4d32193e55b8b76933f027", "message": "Remove erroneously added file", "committedDate": "2020-02-11T08:11:42Z", "type": "commit"}, {"oid": "5298995dcc4e37606d3e21ff6420a83985c6cdd6", "url": "https://github.com/OpenAPITools/openapi-generator/commit/5298995dcc4e37606d3e21ff6420a83985c6cdd6", "message": "Properly escape vars that have reserved names", "committedDate": "2020-02-11T08:12:23Z", "type": "commit"}, {"oid": "358648b56d285a27b5a9a77f01b156ef7adc2a46", "url": "https://github.com/OpenAPITools/openapi-generator/commit/358648b56d285a27b5a9a77f01b156ef7adc2a46", "message": "Fix after rebasing", "committedDate": "2020-02-11T08:25:50Z", "type": "commit"}, {"oid": "358648b56d285a27b5a9a77f01b156ef7adc2a46", "url": "https://github.com/OpenAPITools/openapi-generator/commit/358648b56d285a27b5a9a77f01b156ef7adc2a46", "message": "Fix after rebasing", "committedDate": "2020-02-11T08:25:50Z", "type": "forcePushed"}]}