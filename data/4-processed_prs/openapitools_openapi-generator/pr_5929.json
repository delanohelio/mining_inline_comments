{"pr_number": 5929, "pr_title": "[C#][NetCore] adding retry configuration", "pr_createdAt": "2020-04-14T13:03:06Z", "pr_url": "https://github.com/OpenAPITools/openapi-generator/pull/5929", "timeline": [{"oid": "bc271e706048c7bcac69f6a989fb7fafec2fc639", "url": "https://github.com/OpenAPITools/openapi-generator/commit/bc271e706048c7bcac69f6a989fb7fafec2fc639", "message": "feat(csharp): adding retry configuration", "committedDate": "2020-04-14T12:58:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzIwMzAzMw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5929#discussion_r417203033", "bodyText": "The inability to customize the retry strategy is a concern, and I think a design that injects the retry strategy via IConfiguration would be better.", "author": "shibayan", "createdAt": "2020-04-29T10:05:22Z", "path": "modules/openapi-generator/src/main/resources/csharp-netcore/ApiClient.mustache", "diffHunk": "@@ -408,7 +410,26 @@ namespace {{packageName}}.Client\n \n             InterceptRequest(req);\n \n-            var response = client.Execute<T>(req);\n+            IRestResponse<T> response;\n+            if (configuration.RetryStatusCodes != null)\t\n+            {\n+                Random jitterer = new Random();\n+                var policy = Policy\n+                    .HandleResult<IRestResponse<T>>(resp => (configuration.RetryStatusCodes.Contains(resp.StatusCode)))\n+                    .WaitAndRetry(configuration.MaxRetries, retryAttempt => TimeSpan.FromSeconds(Math.Pow(2, retryAttempt))\n+                                                          + TimeSpan.FromMilliseconds(jitterer.Next(0, 1000))\n+                     );\n+                var policyResult = policy.ExecuteAndCapture(() => client.Execute<T>(req));\n+                response = (policyResult.Outcome == OutcomeType.Successful) ? policyResult.Result : new RestResponse<T>\n+                {\n+                    Request = req,\n+                    ErrorException = policyResult.FinalException\n+                };\n+            }\n+            else\n+            {\n+                response = client.Execute<T>(req);\n+            }", "originalCommit": "bc271e706048c7bcac69f6a989fb7fafec2fc639", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc0NjE4MQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5929#discussion_r417746181", "bodyText": "@shibayan agree with you, thought of implementing that way itself, but the return type being a generic type IRestReponse< T > is what making it difficult to implement it via configuration.\nOr least i couldn't think of a solution to implement that in a easier way. Any inputs along that lines will be helpful.", "author": "Ramanth", "createdAt": "2020-04-30T04:27:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzIwMzAzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMzNTAzOQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5929#discussion_r424335039", "bodyText": "@shibayan  Figured out a way to have the retry policy through configuration. As a workaround found that the RestSharp's ExecAsync< T > can be seperated in two steps ExecAsync and then Deserialize< T > which makes ExecAsync free from having generic type and thus i can define the retry policy free from generic and so able to inject through configuration..\nPlease take a look at it once...", "author": "Ramanth", "createdAt": "2020-05-13T10:27:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzIwMzAzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjYzOTI5MQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5929#discussion_r426639291", "bodyText": "@shibayan can you take a look again when you get time.", "author": "Ramanth", "createdAt": "2020-05-18T13:48:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzIwMzAzMw=="}], "type": "inlineReview"}, {"oid": "e1e5605f7a2cb461d850a9f6e99dda95f067f23e", "url": "https://github.com/OpenAPITools/openapi-generator/commit/e1e5605f7a2cb461d850a9f6e99dda95f067f23e", "message": "fix(csharp-retry) : adding retry policy through configuration", "committedDate": "2020-05-13T05:53:12Z", "type": "commit"}, {"oid": "258a80f5f5435f5619b0e28b27ba7347c9212c64", "url": "https://github.com/OpenAPITools/openapi-generator/commit/258a80f5f5435f5619b0e28b27ba7347c9212c64", "message": "Merge branch 'master' into feat/csharp/retry-configuration", "committedDate": "2020-05-13T06:05:07Z", "type": "commit"}, {"oid": "f2d85525d80cff0f833805e6c234d45b290e0665", "url": "https://github.com/OpenAPITools/openapi-generator/commit/f2d85525d80cff0f833805e6c234d45b290e0665", "message": "Merge branch 'master' into feat/csharp/retry-configuration", "committedDate": "2020-05-14T09:19:03Z", "type": "commit"}, {"oid": "943388665c2e53e49bf8032938ac9b3fafea66b0", "url": "https://github.com/OpenAPITools/openapi-generator/commit/943388665c2e53e49bf8032938ac9b3fafea66b0", "message": "Merge branch 'master' into feat/csharp/retry-configuration", "committedDate": "2020-05-15T03:02:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDk1NDQ5Mw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5929#discussion_r434954493", "bodyText": "This configuration object is meant to be framework agnostic.\nBy adding RestSharp and Polly here, this breaks our contract of allowing users to build without RestSharp as a dependency and now adds Polly into the mix.\nIf the decision here is to tightly couple Polly with the RestSharp implementation of ApiClient, please modify only the ApiClient (preferably via constructor or thread-safe property injection).", "author": "jimschubert", "createdAt": "2020-06-04T02:18:10Z", "path": "modules/openapi-generator/src/main/resources/csharp-netcore/Configuration.mustache", "diffHunk": "@@ -10,6 +10,10 @@ using System.IO;\n using System.Linq;\n using System.Security.Cryptography.X509Certificates;\n using System.Text;\n+using System.Net;\n+using Polly;\n+using Polly.Retry;", "originalCommit": "943388665c2e53e49bf8032938ac9b3fafea66b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDk1NDgzNw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5929#discussion_r434954837", "bodyText": "We can't mix non-System types into this interface.", "author": "jimschubert", "createdAt": "2020-06-04T02:19:45Z", "path": "modules/openapi-generator/src/main/resources/csharp-netcore/IReadableConfiguration.mustache", "diffHunk": "@@ -2,7 +2,11 @@\n \n using System;\n using System.Collections.Generic;\n+using System.Net;\n using System.Security.Cryptography.X509Certificates;\n+using Polly;\n+using Polly.Retry;", "originalCommit": "943388665c2e53e49bf8032938ac9b3fafea66b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4181ca8314911b31ee3d377e427850da108fb3ba", "url": "https://github.com/OpenAPITools/openapi-generator/commit/4181ca8314911b31ee3d377e427850da108fb3ba", "message": "Merge branch 'master' into feat/csharp/retry-configuration", "committedDate": "2020-06-22T05:42:05Z", "type": "commit"}, {"oid": "5d743ed58e2ef650cc5bb299addcc3c209d79fbc", "url": "https://github.com/OpenAPITools/openapi-generator/commit/5d743ed58e2ef650cc5bb299addcc3c209d79fbc", "message": "fix(csharp): moving RetryConfiguration out of Configuration class", "committedDate": "2020-06-22T07:02:48Z", "type": "commit"}, {"oid": "7956383011c6a116a6e62a7bdc621600186c3795", "url": "https://github.com/OpenAPITools/openapi-generator/commit/7956383011c6a116a6e62a7bdc621600186c3795", "message": "fix(csharp): minor changes", "committedDate": "2020-06-22T10:21:03Z", "type": "commit"}, {"oid": "f167dd4426daa0c9ca97be8afcc1d752b90628fc", "url": "https://github.com/OpenAPITools/openapi-generator/commit/f167dd4426daa0c9ca97be8afcc1d752b90628fc", "message": "fix(csharp): fixing tabs", "committedDate": "2020-06-23T10:45:29Z", "type": "commit"}, {"oid": "2f92656f08620a06236326dab791f777615ffb59", "url": "https://github.com/OpenAPITools/openapi-generator/commit/2f92656f08620a06236326dab791f777615ffb59", "message": "fix(csharp): reverting FILES", "committedDate": "2020-06-23T12:58:31Z", "type": "commit"}, {"oid": "ff2898417740478a3e92b6af364e324db4226b05", "url": "https://github.com/OpenAPITools/openapi-generator/commit/ff2898417740478a3e92b6af364e324db4226b05", "message": "fix(csharp) :reverting some file changes", "committedDate": "2020-06-24T05:21:16Z", "type": "commit"}, {"oid": "c5b7ab9f9dc8034156d8e5fda0e26cb2254cc8d3", "url": "https://github.com/OpenAPITools/openapi-generator/commit/c5b7ab9f9dc8034156d8e5fda0e26cb2254cc8d3", "message": "fix(csharp): reverting changes", "committedDate": "2020-06-24T05:29:12Z", "type": "commit"}, {"oid": "e0b188c1213785a525b44a7e7744037dab6d5381", "url": "https://github.com/OpenAPITools/openapi-generator/commit/e0b188c1213785a525b44a7e7744037dab6d5381", "message": "update samples", "committedDate": "2020-06-30T09:26:40Z", "type": "commit"}, {"oid": "f8ceac7bde476f364a791886dcd6cac2618c00d0", "url": "https://github.com/OpenAPITools/openapi-generator/commit/f8ceac7bde476f364a791886dcd6cac2618c00d0", "message": "Merge branch 'master' into feat/csharp/retry-configuration", "committedDate": "2020-08-18T07:53:27Z", "type": "commit"}, {"oid": "ad602514875bdb13c91eb6219e4ba62988863499", "url": "https://github.com/OpenAPITools/openapi-generator/commit/ad602514875bdb13c91eb6219e4ba62988863499", "message": "fix(csharp-retry) : fixing merge conflicts and build failure", "committedDate": "2020-08-18T09:49:29Z", "type": "commit"}, {"oid": "65d703be155d3f093e17b7beb8a13159020826c7", "url": "https://github.com/OpenAPITools/openapi-generator/commit/65d703be155d3f093e17b7beb8a13159020826c7", "message": "fix(chsarp-retry) : FILES changes", "committedDate": "2020-08-19T05:16:31Z", "type": "commit"}, {"oid": "1d2c474e0fe1420b9298154f61160f527e8c5f9f", "url": "https://github.com/OpenAPITools/openapi-generator/commit/1d2c474e0fe1420b9298154f61160f527e8c5f9f", "message": "update samples", "committedDate": "2020-08-19T07:00:27Z", "type": "commit"}]}