{"pr_number": 4969, "pr_title": "[Java] Fixes Spring generator devaultValues for int64/float/double", "pr_createdAt": "2020-01-10T18:49:15Z", "pr_url": "https://github.com/OpenAPITools/openapi-generator/pull/4969", "timeline": [{"oid": "4be281e895143b262e7552d6a705bce66c8ccc16", "url": "https://github.com/OpenAPITools/openapi-generator/commit/4be281e895143b262e7552d6a705bce66c8ccc16", "message": "Updates spring generator to omit type suffixes from int float double defaults, adds testDefaultValuesFixed\n\nAdds the test testDefaultValuesFixed", "committedDate": "2020-01-10T18:40:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYzODcwMg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/4969#discussion_r365638702", "bodyText": "We need a case for Long (isLongSchema) and add \"L\" at the end of the default value. Please see the error message below for details.", "author": "wing328", "createdAt": "2020-01-13T03:30:09Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/SpringCodegen.java", "diffHunk": "@@ -849,4 +852,83 @@ public void setPerformBeanValidation(boolean performBeanValidation) {\n     public void setUseOptional(boolean useOptional) {\n         this.useOptional = useOptional;\n     }\n+\n+    @Override\n+    public String toDefaultValue(Schema p) {\n+        // we use a custom version of this function to remove the l, d, and f suffixes from integer and double values\n+        // these values are later converted from strings to the primitive types using parseInt, parseLong etc so they\n+        // should not include type suffix literals\n+        // https://docs.oracle.com/javase/specs/jls/se7/html/jls-3.html#jls-3.10\n+        if (ModelUtils.isArraySchema(p)) {\n+            final ArraySchema ap = (ArraySchema) p;\n+            final String pattern;\n+            if (fullJavaUtil) {\n+                pattern = \"new java.util.ArrayList<%s>()\";\n+            } else {\n+                pattern = \"new ArrayList<%s>()\";\n+            }\n+            if (ap.getItems() == null) {\n+                return null;\n+            }\n+\n+            String typeDeclaration = getTypeDeclaration(ap.getItems());\n+            Object java8obj = additionalProperties.get(\"java8\");\n+            if (java8obj != null) {\n+                Boolean java8 = Boolean.valueOf(java8obj.toString());\n+                if (java8 != null && java8) {\n+                    typeDeclaration = \"\";\n+                }\n+            }\n+\n+            return String.format(Locale.ROOT, pattern, typeDeclaration);\n+        } else if (ModelUtils.isMapSchema(p)) {\n+            final String pattern;\n+            if (fullJavaUtil) {\n+                pattern = \"new java.util.HashMap<%s>()\";\n+            } else {\n+                pattern = \"new HashMap<%s>()\";\n+            }\n+            if (ModelUtils.getAdditionalProperties(p) == null) {\n+                return null;\n+            }\n+\n+            String typeDeclaration = String.format(Locale.ROOT, \"String, %s\", getTypeDeclaration(ModelUtils.getAdditionalProperties(p)));\n+            Object java8obj = additionalProperties.get(\"java8\");\n+            if (java8obj != null) {\n+                Boolean java8 = Boolean.valueOf(java8obj.toString());\n+                if (java8 != null && java8) {\n+                    typeDeclaration = \"\";\n+                }\n+            }\n+\n+            return String.format(Locale.ROOT, pattern, typeDeclaration);\n+        } else if (ModelUtils.isIntegerSchema(p)) {\n+            if (p.getDefault() != null) {\n+                return p.getDefault().toString();\n+            }\n+            return null;", "originalCommit": "4be281e895143b262e7552d6a705bce66c8ccc16", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTk2Nzk5MA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/4969#discussion_r365967990", "bodyText": "For CodegenProperty, I changed the code back to preserve the \"l\" suffix for this case. If you need me to change our existing code in AbstractJavaCodegen.java from adding \"l\" to \"L\" please let me know.", "author": "spacether", "createdAt": "2020-01-13T18:51:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYzODcwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYzODczNQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/4969#discussion_r365638735", "bodyText": "We need a case for Float (isFloatSchema) and add \"F\" at the end of the default value. Please see the error message below for details.", "author": "wing328", "createdAt": "2020-01-13T03:30:27Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/SpringCodegen.java", "diffHunk": "@@ -849,4 +852,83 @@ public void setPerformBeanValidation(boolean performBeanValidation) {\n     public void setUseOptional(boolean useOptional) {\n         this.useOptional = useOptional;\n     }\n+\n+    @Override\n+    public String toDefaultValue(Schema p) {\n+        // we use a custom version of this function to remove the l, d, and f suffixes from integer and double values\n+        // these values are later converted from strings to the primitive types using parseInt, parseLong etc so they\n+        // should not include type suffix literals\n+        // https://docs.oracle.com/javase/specs/jls/se7/html/jls-3.html#jls-3.10\n+        if (ModelUtils.isArraySchema(p)) {\n+            final ArraySchema ap = (ArraySchema) p;\n+            final String pattern;\n+            if (fullJavaUtil) {\n+                pattern = \"new java.util.ArrayList<%s>()\";\n+            } else {\n+                pattern = \"new ArrayList<%s>()\";\n+            }\n+            if (ap.getItems() == null) {\n+                return null;\n+            }\n+\n+            String typeDeclaration = getTypeDeclaration(ap.getItems());\n+            Object java8obj = additionalProperties.get(\"java8\");\n+            if (java8obj != null) {\n+                Boolean java8 = Boolean.valueOf(java8obj.toString());\n+                if (java8 != null && java8) {\n+                    typeDeclaration = \"\";\n+                }\n+            }\n+\n+            return String.format(Locale.ROOT, pattern, typeDeclaration);\n+        } else if (ModelUtils.isMapSchema(p)) {\n+            final String pattern;\n+            if (fullJavaUtil) {\n+                pattern = \"new java.util.HashMap<%s>()\";\n+            } else {\n+                pattern = \"new HashMap<%s>()\";\n+            }\n+            if (ModelUtils.getAdditionalProperties(p) == null) {\n+                return null;\n+            }\n+\n+            String typeDeclaration = String.format(Locale.ROOT, \"String, %s\", getTypeDeclaration(ModelUtils.getAdditionalProperties(p)));\n+            Object java8obj = additionalProperties.get(\"java8\");\n+            if (java8obj != null) {\n+                Boolean java8 = Boolean.valueOf(java8obj.toString());\n+                if (java8 != null && java8) {\n+                    typeDeclaration = \"\";\n+                }\n+            }\n+\n+            return String.format(Locale.ROOT, pattern, typeDeclaration);\n+        } else if (ModelUtils.isIntegerSchema(p)) {\n+            if (p.getDefault() != null) {\n+                return p.getDefault().toString();\n+            }\n+            return null;\n+        } else if (ModelUtils.isNumberSchema(p)) {\n+            if (p.getDefault() != null) {\n+                return p.getDefault().toString();\n+            }\n+            return null;", "originalCommit": "4be281e895143b262e7552d6a705bce66c8ccc16", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTk2ODIzMQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/4969#discussion_r365968231", "bodyText": "For CodegenProperty, I changed the code back to preserve the \"f\" suffix for this case. If you need me to change our existing code in AbstractJavaCodegen.java from adding \"f\" to \"F\" please let me know.", "author": "spacether", "createdAt": "2020-01-13T18:51:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYzODczNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYzODg2Ng==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/4969#discussion_r365638866", "bodyText": "FYI. I got the following when testing the spring app generated from this spec:\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.7.0:compile (default-compile) on project openapi-spring: Compilation failure\n[ERROR] /private/tmp/spring/src/main/java/org/openapitools/model/NumberHolder.java:[20,24] integer number too large: 9223372036854775807\n\nAppended \"L\" at the end of the default value fixes it.\nFor float, I fixed the issue by appending \"F\" to the default value.", "author": "wing328", "createdAt": "2020-01-13T03:31:29Z", "path": "modules/openapi-generator/src/test/resources/2_0/issue1226.yaml", "diffHunk": "@@ -0,0 +1,71 @@\n+swagger: '2.0'\n+info:\n+  description: 'blah'\n+  version: 1.0.0\n+  title: sample spec\n+host: fake.site.com\n+tags: []\n+schemes:\n+  - https\n+paths:\n+  /numberdata:\n+    post:\n+      summary: Get back a NumberHolder\n+      description: ''\n+      operationId: getNumberHolder\n+      consumes:\n+        - application/json\n+      produces:\n+        - application/json\n+      parameters: []\n+      responses:\n+        '200':\n+          description: successful operation\n+          schema:\n+            $ref: '#/definitions/NumberHolder'\n+  /numericqueryparams:\n+    get:\n+      tags:\n+        - user\n+      summary: a test route for numeric query params\n+      description: ''\n+      operationId: numericQueryParams\n+      produces:\n+        - application/json\n+      parameters:\n+        - in: query\n+          name: int64\n+          type: integer\n+          format: int64\n+          default: 9223372036854775807", "originalCommit": "4be281e895143b262e7552d6a705bce66c8ccc16", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTk2ODU1NQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/4969#discussion_r365968555", "bodyText": "For CodegenProperty, I changed the code back to preserve the \"l\" suffix for this case. If you need me to change our existing code in AbstractJavaCodegen.java from adding \"l\" to \"L\" please let me know.\nFor CodegenProperty, I changed the code back to preserve the \"f\" suffix for this case. If you need me to change our existing code in AbstractJavaCodegen.java from adding \"f\" to \"F\" please let me know.", "author": "spacether", "createdAt": "2020-01-13T18:52:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYzODg2Ng=="}], "type": "inlineReview"}, {"oid": "c0db5354b7bccbc5cf4ce91d2233b0619adcecce", "url": "https://github.com/OpenAPITools/openapi-generator/commit/c0db5354b7bccbc5cf4ce91d2233b0619adcecce", "message": "Updates SpringCodegen to only remove character suffixes from CodegenParameter defaultValues, updates tests", "committedDate": "2020-01-13T18:44:33Z", "type": "commit"}, {"oid": "72acf7da94eaad6133fd9977b855ec1602b32433", "url": "https://github.com/OpenAPITools/openapi-generator/commit/72acf7da94eaad6133fd9977b855ec1602b32433", "message": "Updates java function comment", "committedDate": "2020-01-13T18:55:11Z", "type": "commit"}, {"oid": "3643f448b7c8d05babfb8ae88eb9645bbad94ec9", "url": "https://github.com/OpenAPITools/openapi-generator/commit/3643f448b7c8d05babfb8ae88eb9645bbad94ec9", "message": "Adds early return in postProcessParameter", "committedDate": "2020-01-13T20:01:17Z", "type": "commit"}, {"oid": "235768c412b76107edab279ad87b57e8a73d1fee", "url": "https://github.com/OpenAPITools/openapi-generator/commit/235768c412b76107edab279ad87b57e8a73d1fee", "message": "Removes unneeded imports", "committedDate": "2020-01-13T20:04:13Z", "type": "commit"}, {"oid": "8d4a23ed800a5eceeca4c2d4e0fe539859c45893", "url": "https://github.com/OpenAPITools/openapi-generator/commit/8d4a23ed800a5eceeca4c2d4e0fe539859c45893", "message": "Fixes decorators on java method postProcessParameter", "committedDate": "2020-01-13T20:06:04Z", "type": "commit"}, {"oid": "f5c365491518df9823aa76d807d14f6322254ac3", "url": "https://github.com/OpenAPITools/openapi-generator/commit/f5c365491518df9823aa76d807d14f6322254ac3", "message": "Fixes typo", "committedDate": "2020-01-13T20:07:13Z", "type": "commit"}, {"oid": "0c99ebbd7417e52de17814aa940b26158b0ee9a7", "url": "https://github.com/OpenAPITools/openapi-generator/commit/0c99ebbd7417e52de17814aa940b26158b0ee9a7", "message": "Fixes paste error", "committedDate": "2020-01-13T20:08:09Z", "type": "commit"}, {"oid": "8190af61ff71eebcdc9aa177d7e1a2c28d08c8fc", "url": "https://github.com/OpenAPITools/openapi-generator/commit/8190af61ff71eebcdc9aa177d7e1a2c28d08c8fc", "message": "Removes unused import", "committedDate": "2020-01-13T20:09:16Z", "type": "commit"}]}