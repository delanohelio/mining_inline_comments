{"pr_number": 5706, "pr_title": "[ruby] fix oneOf handling", "pr_createdAt": "2020-03-25T08:41:15Z", "pr_url": "https://github.com/OpenAPITools/openapi-generator/pull/5706", "timeline": [{"oid": "dcbd3312cdbc6bb678878a1cbda962c3a5017a3a", "url": "https://github.com/OpenAPITools/openapi-generator/commit/dcbd3312cdbc6bb678878a1cbda962c3a5017a3a", "message": "[ruby] fix oneOf handling", "committedDate": "2020-05-26T04:42:17Z", "type": "forcePushed"}, {"oid": "4116696d09a69392ac859c513da36474edd82fe9", "url": "https://github.com/OpenAPITools/openapi-generator/commit/4116696d09a69392ac859c513da36474edd82fe9", "message": "fix module name to look up constants", "committedDate": "2020-07-01T07:55:44Z", "type": "forcePushed"}, {"oid": "646ef7478ac82756659a5fccb75f4d93479b8a40", "url": "https://github.com/OpenAPITools/openapi-generator/commit/646ef7478ac82756659a5fccb75f4d93479b8a40", "message": "update docs", "committedDate": "2020-08-21T09:48:48Z", "type": "forcePushed"}, {"oid": "4d040c1740abe4c576856ec8ca3f1d462a66d1b9", "url": "https://github.com/OpenAPITools/openapi-generator/commit/4d040c1740abe4c576856ec8ca3f1d462a66d1b9", "message": "re-gen samples", "committedDate": "2020-08-23T09:10:23Z", "type": "forcePushed"}, {"oid": "a0a7464786eb727d1ca4b483ad711bc79bc2bdf6", "url": "https://github.com/OpenAPITools/openapi-generator/commit/a0a7464786eb727d1ca4b483ad711bc79bc2bdf6", "message": "[ruby] fix oneOf handling", "committedDate": "2020-08-23T15:20:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA3NzgyMA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5706#discussion_r498077820", "bodyText": "This should be wrapped in a try/rescue. build_from_hash for enum values can raise. And when that's the case, the loop should continue to try the next model.", "author": "zippolyte", "createdAt": "2020-10-01T08:39:04Z", "path": "modules/openapi-generator/src/main/resources/ruby-client/partial_oneof_module.mustache", "diffHunk": "@@ -0,0 +1,69 @@\n+  {{#description}}\n+  # {{{description}}}\n+  {{/description}}\n+  module {{classname}}\n+    {{#oneOf}}\n+    {{#-first}}\n+    # List of class defined in oneOf (OpenAPI v3)\n+    def self.openapi_one_of\n+      [\n+    {{/-first}}\n+        :'{{{.}}}'{{^-last}},{{/-last}}\n+    {{#-last}}\n+      ]\n+    end\n+\n+    {{/-last}}\n+    {{/oneOf}}\n+    {{#discriminator}}\n+    {{#propertyName}}\n+    # discriminator's property name in OpenAPI v3\n+    def self.openapi_discriminator_name\n+      :'{{{.}}}'\n+    end\n+\n+    {{/propertyName}}\n+    {{#mappedModels}}\n+    {{#-first}}\n+    # discriminator's mapping in OpenAPI v3\n+    def self.openapi_discriminator_mapping\n+      {\n+    {{/-first}}\n+        :'{{{mappingName}}}' => :'{{{modelName}}}'{{^-last}},{{/-last}}\n+    {{#-last}}\n+      }\n+    end\n+    {{/-last}}\n+    {{/mappedModels}}\n+\n+    {{/discriminator}}\n+    # Builds the object from hash\n+    # @param [Hash] attributes Model attributes in the form of hash\n+    # @return [Object] Returns the model itself\n+    def self.build_from_hash(attributes)\n+    {{#discriminator}}\n+      discriminator_value = attributes[openapi_discriminator_name]\n+      return nil unless discriminator_value\n+    {{#mappedModels}}\n+    {{#-first}}\n+\n+      _class = openapi_discriminator_mapping[discriminator_value.to_sym]\n+      return nil unless _class\n+\n+      {{moduleName}}.const_get(_class).build_from_hash(attributes)\n+    {{/-first}}\n+    {{/mappedModels}}\n+    {{^mappedModels}}\n+      {{moduleName}}.const_get(discriminator_value).build_from_hash(attributes)\n+    {{/mappedModels}}\n+    {{/discriminator}}\n+    {{^discriminator}}\n+      openapi_one_of.each do |_class|\n+        model = {{moduleName}}.const_get(_class).build_from_hash(attributes)", "originalCommit": "a0a7464786eb727d1ca4b483ad711bc79bc2bdf6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY0NDg1NQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5706#discussion_r498644855", "bodyText": "build_from_hash for enum values can raise\n\ncan you provide an example?", "author": "jfeltesse-mdsol", "createdAt": "2020-10-02T06:56:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA3NzgyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY0OTMyMg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5706#discussion_r498649322", "bodyText": "It's in here \n  \n    \n      openapi-generator/modules/openapi-generator/src/main/resources/ruby-client/partial_model_enum_class.mustache\n    \n    \n         Line 17\n      in\n      a0a7464\n    \n    \n    \n    \n\n        \n          \n           raise \"Invalid ENUM value #{value} for class #{{{classname}}}\" if constantValues.empty?", "author": "zippolyte", "createdAt": "2020-10-02T07:09:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA3NzgyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzNDYwMQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5706#discussion_r501534601", "bodyText": "Oh one more thing I noticed, as I'm trying out this PR on our spec: the oneOf types can be primitive types like Float, String, ... so we can't call build_from_hash on those. Maybe you could add some special cases, comparing the openapi_one_of value to primitive types, and try to directly parse the value in that case ?", "author": "zippolyte", "createdAt": "2020-10-08T08:21:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA3NzgyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzNzQ5Mw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5706#discussion_r501537493", "bodyText": "Yes, this has been pointed out and it is something I plan to address #5706 (comment)", "author": "jfeltesse-mdsol", "createdAt": "2020-10-08T08:26:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA3NzgyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU2MjI5Mg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5706#discussion_r501562292", "bodyText": "Ah right, sorry for the noise \ud83d\ude48", "author": "zippolyte", "createdAt": "2020-10-08T09:05:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA3NzgyMA=="}], "type": "inlineReview"}, {"oid": "80bbd45dcd51d3fde554f48fc195eb4347a4e67c", "url": "https://github.com/OpenAPITools/openapi-generator/commit/80bbd45dcd51d3fde554f48fc195eb4347a4e67c", "message": "[ruby] fix oneOf handling", "committedDate": "2020-10-09T08:48:39Z", "type": "forcePushed"}, {"oid": "24af61c49d7367b34fd29a196777c5891646a1af", "url": "https://github.com/OpenAPITools/openapi-generator/commit/24af61c49d7367b34fd29a196777c5891646a1af", "message": "update ruby clients configs", "committedDate": "2020-10-12T09:46:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzIyNTUwNw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5706#discussion_r503225507", "bodyText": "probably missing a {{#-first}} here", "author": "zippolyte", "createdAt": "2020-10-12T11:19:31Z", "path": "modules/openapi-generator/src/main/resources/ruby-client/model_test.mustache", "diffHunk": "@@ -43,6 +44,42 @@ describe '{{classname}}' do\n   end\n \n {{/vars}}\n+{{/oneOf}}\n+{{#oneOf}}", "originalCommit": "24af61c49d7367b34fd29a196777c5891646a1af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjE3MjczMQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5706#discussion_r506172731", "bodyText": "Indeed. Thanks for spotting that!", "author": "jfeltesse-mdsol", "createdAt": "2020-10-16T08:34:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzIyNTUwNw=="}], "type": "inlineReview"}, {"oid": "4e07e26012df55aefe398a4821b24b3955532806", "url": "https://github.com/OpenAPITools/openapi-generator/commit/4e07e26012df55aefe398a4821b24b3955532806", "message": "update the ruby and ruby-faraday samples", "committedDate": "2020-10-27T07:31:34Z", "type": "forcePushed"}, {"oid": "035b170ecb0121044bf18f81ccdd7e2804872a94", "url": "https://github.com/OpenAPITools/openapi-generator/commit/035b170ecb0121044bf18f81ccdd7e2804872a94", "message": "update the samples", "committedDate": "2020-10-27T08:23:46Z", "type": "forcePushed"}, {"oid": "528a64acc0143354b952a1c60f5a3995919fa685", "url": "https://github.com/OpenAPITools/openapi-generator/commit/528a64acc0143354b952a1c60f5a3995919fa685", "message": "use previous ruby configs due to issue #4690", "committedDate": "2020-10-28T08:55:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2MjM1MQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5706#discussion_r513462351", "bodyText": "Hmm I think you need to do the same check you did here  in api_client.mustache for build vs build_from_hash in the _deserialize method of base_object (line 72) in case the oneOf is a property of a regular object.", "author": "zippolyte", "createdAt": "2020-10-28T13:55:31Z", "path": "modules/openapi-generator/src/main/resources/ruby-client/base_object.mustache", "diffHunk": "@@ -93,7 +95,7 @@\n           is_nullable = self.class.openapi_nullable.include?(attr)\n           next if !is_nullable || (is_nullable && !instance_variable_defined?(:\"@#{attr}\"))\n         end\n-        \n+", "originalCommit": "528a64acc0143354b952a1c60f5a3995919fa685", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4b646e04b7842786c8ef5fcf6a9d51c8f73cd441", "url": "https://github.com/OpenAPITools/openapi-generator/commit/4b646e04b7842786c8ef5fcf6a9d51c8f73cd441", "message": "validate the attributes in partial_oneof_module", "committedDate": "2020-10-30T06:16:01Z", "type": "forcePushed"}, {"oid": "dca441ec207db42186f7e57a4c60abb8af05b94a", "url": "https://github.com/OpenAPITools/openapi-generator/commit/dca441ec207db42186f7e57a4c60abb8af05b94a", "message": "validate the attributes in partial_oneof_module", "committedDate": "2020-10-30T07:40:48Z", "type": "forcePushed"}, {"oid": "1be37d3537d8b645cc6c9893f3f6c04c1d78c71e", "url": "https://github.com/OpenAPITools/openapi-generator/commit/1be37d3537d8b645cc6c9893f3f6c04c1d78c71e", "message": "validate the attributes in partial_oneof_module", "committedDate": "2020-10-30T14:48:56Z", "type": "forcePushed"}, {"oid": "9cba8ccebfd97dcaa6d357915539c5001c84a1d6", "url": "https://github.com/OpenAPITools/openapi-generator/commit/9cba8ccebfd97dcaa6d357915539c5001c84a1d6", "message": "validate the attributes in partial_oneof_module", "committedDate": "2020-10-31T12:13:43Z", "type": "forcePushed"}, {"oid": "64998c0de2356c3c4ab8bce5ccfcebcf3830b2ef", "url": "https://github.com/OpenAPITools/openapi-generator/commit/64998c0de2356c3c4ab8bce5ccfcebcf3830b2ef", "message": "[ruby] fix oneOf handling", "committedDate": "2020-11-04T06:40:44Z", "type": "commit"}, {"oid": "c4e632b762c00e08c5825018725bff5fc1947acb", "url": "https://github.com/OpenAPITools/openapi-generator/commit/c4e632b762c00e08c5825018725bff5fc1947acb", "message": "use previous ruby configs due to issue #4690", "committedDate": "2020-11-04T06:42:35Z", "type": "commit"}, {"oid": "01d0eee54bf94a6331c8a7b603d6915ae0761d64", "url": "https://github.com/OpenAPITools/openapi-generator/commit/01d0eee54bf94a6331c8a7b603d6915ae0761d64", "message": "check for oneOf model in base_object", "committedDate": "2020-11-04T06:42:40Z", "type": "commit"}, {"oid": "ba2aaf8c8c0fb3b23f456b4e017fa33d3d3a5718", "url": "https://github.com/OpenAPITools/openapi-generator/commit/ba2aaf8c8c0fb3b23f456b4e017fa33d3d3a5718", "message": "validate the attributes in partial_oneof_module", "committedDate": "2020-11-04T08:25:46Z", "type": "commit"}, {"oid": "ba2aaf8c8c0fb3b23f456b4e017fa33d3d3a5718", "url": "https://github.com/OpenAPITools/openapi-generator/commit/ba2aaf8c8c0fb3b23f456b4e017fa33d3d3a5718", "message": "validate the attributes in partial_oneof_module", "committedDate": "2020-11-04T08:25:46Z", "type": "forcePushed"}]}