{"pr_number": 6690, "pr_title": "[Core, Rust Server] anyOf / oneOf support for Rust Server", "pr_createdAt": "2020-06-16T23:08:39Z", "pr_url": "https://github.com/OpenAPITools/openapi-generator/pull/6690", "timeline": [{"oid": "609ce148f1c6d34bbb0281e9e4ee657fdd51a3d9", "url": "https://github.com/OpenAPITools/openapi-generator/commit/609ce148f1c6d34bbb0281e9e4ee657fdd51a3d9", "message": "[Core] Inline Model Resolution of Enums\n\nEnums need to be named types, so handle them as part of inline model resolution", "committedDate": "2020-06-16T22:57:34Z", "type": "commit"}, {"oid": "2f51f0c6273ed60bdd64bcf174193a477bde21e7", "url": "https://github.com/OpenAPITools/openapi-generator/commit/2f51f0c6273ed60bdd64bcf174193a477bde21e7", "message": "[Rust Server] Handle models starting with a number correctly", "committedDate": "2020-06-16T22:57:34Z", "type": "commit"}, {"oid": "cf6c4522163ce869c89887be5b8c67ed1c23c528", "url": "https://github.com/OpenAPITools/openapi-generator/commit/cf6c4522163ce869c89887be5b8c67ed1c23c528", "message": "[Rust Server] Additional debug logs", "committedDate": "2020-06-16T22:57:34Z", "type": "commit"}, {"oid": "af12d5fd53d995d80849c757d41ab7bbef956a41", "url": "https://github.com/OpenAPITools/openapi-generator/commit/af12d5fd53d995d80849c757d41ab7bbef956a41", "message": "[Rust Server] Add support for oneOf/anyOf", "committedDate": "2020-06-16T22:57:34Z", "type": "commit"}, {"oid": "15fd91a9ba343c63f469f36ed8c75a198f14ec1d", "url": "https://github.com/OpenAPITools/openapi-generator/commit/15fd91a9ba343c63f469f36ed8c75a198f14ec1d", "message": "[Rust Server] Update supported features", "committedDate": "2020-06-16T22:57:34Z", "type": "commit"}, {"oid": "8e70b79a4fb6437523d985c4e925824a7f96cb4a", "url": "https://github.com/OpenAPITools/openapi-generator/commit/8e70b79a4fb6437523d985c4e925824a7f96cb4a", "message": "[Rust Server] General template tidy up", "committedDate": "2020-06-16T22:57:34Z", "type": "commit"}, {"oid": "3171e57b35c4d8f32c9a75aa360565dbafbe52ba", "url": "https://github.com/OpenAPITools/openapi-generator/commit/3171e57b35c4d8f32c9a75aa360565dbafbe52ba", "message": "[Rust Server] Implement IntoHeaderValue for wrapped data types", "committedDate": "2020-06-16T22:57:34Z", "type": "commit"}, {"oid": "ca56ff833da0dc3e80d17f6273eed1f3cb491ca0", "url": "https://github.com/OpenAPITools/openapi-generator/commit/ca56ff833da0dc3e80d17f6273eed1f3cb491ca0", "message": "[Rust Server] Convert from string correctly", "committedDate": "2020-06-16T22:57:34Z", "type": "commit"}, {"oid": "c2d433d6e16485f8d27a488927bc23c3babf4431", "url": "https://github.com/OpenAPITools/openapi-generator/commit/c2d433d6e16485f8d27a488927bc23c3babf4431", "message": "[Rust Server] Test for anyOf/oneOf", "committedDate": "2020-06-16T22:57:34Z", "type": "commit"}, {"oid": "7f967bc0e4b3b8759bdd16aa19ac06975dde447a", "url": "https://github.com/OpenAPITools/openapi-generator/commit/7f967bc0e4b3b8759bdd16aa19ac06975dde447a", "message": "Update samples", "committedDate": "2020-06-16T22:57:34Z", "type": "commit"}, {"oid": "d868d32f3e3c0d179b65c6e747005e38a1e8d2a4", "url": "https://github.com/OpenAPITools/openapi-generator/commit/d868d32f3e3c0d179b65c6e747005e38a1e8d2a4", "message": "Update samples", "committedDate": "2020-06-17T08:37:50Z", "type": "commit"}, {"oid": "0a15ecbf43bfc7b7106da601b81be3dc469f6d76", "url": "https://github.com/OpenAPITools/openapi-generator/commit/0a15ecbf43bfc7b7106da601b81be3dc469f6d76", "message": "Update docs", "committedDate": "2020-06-17T17:51:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk2MTY2Nw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6690#discussion_r444961667", "bodyText": "cc @OpenAPITools/generator-core-team for review", "author": "etherealjoy", "createdAt": "2020-06-24T15:01:49Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/InlineModelResolver.java", "diffHunk": "@@ -362,38 +362,33 @@ private void flattenComposedChildren(OpenAPI openAPI, String key, List<Schema> c\n         ListIterator<Schema> listIterator = children.listIterator();\n         while (listIterator.hasNext()) {\n             Schema component = listIterator.next();\n-            if (component instanceof ObjectSchema || // for inline schema with type:object\n-                    (component != null && component.getProperties() != null &&\n-                            !component.getProperties().isEmpty())) { // for inline schema without type:object\n-                Schema op = component;\n-                if (op.get$ref() == null && op.getProperties() != null && op.getProperties().size() > 0) {\n-                    // If a `title` attribute is defined in the inline schema, codegen uses it to name the\n-                    // inline schema. Otherwise, we'll use the default naming such as InlineObject1, etc.\n-                    // We know that this is not the best way to name the model.\n-                    //\n-                    // Such naming strategy may result in issues. If the value of the 'title' attribute\n-                    // happens to match a schema defined elsewhere in the specification, 'innerModelName'\n-                    // will be the same as that other schema.\n-                    //\n-                    // To have complete control of the model naming, one can define the model separately\n-                    // instead of inline.\n-                    String innerModelName = resolveModelName(op.getTitle(), key);\n-                    Schema innerModel = modelFromProperty(openAPI, op, innerModelName);\n-                    String existing = matchGenerated(innerModel);\n-                    if (existing == null) {\n-                        openAPI.getComponents().addSchemas(innerModelName, innerModel);\n-                        addGenerated(innerModelName, innerModel);\n-                        Schema schema = new Schema().$ref(innerModelName);\n-                        schema.setRequired(op.getRequired());\n-                        listIterator.set(schema);\n-                    } else {\n-                        Schema schema = new Schema().$ref(existing);\n-                        schema.setRequired(op.getRequired());\n-                        listIterator.set(schema);\n-                    }\n+            if ((component.get$ref() == null) &&", "originalCommit": "0a15ecbf43bfc7b7106da601b81be3dc469f6d76", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDQ5NTYwNA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6690#discussion_r554495604", "bodyText": "This needs the component != null check that's part of the removed check condition because, unfortunately, people using the generator code programmatically could provide a component array with null as an array item. As an alternative, I guess we could convert from direct iterator usage to a stream and filter by Object::nonNull.", "author": "jimschubert", "createdAt": "2021-01-10T01:37:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk2MTY2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDQ5NTk4Ng==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6690#discussion_r554495986", "bodyText": "As a user with debug enabled, I'd have three concerns:\n\nThe use of debug calls in this method will cause a ton of noise as it'll be invoked with somewhat large object dumps every time for every model, potentially more than once per model\nIt's not clear from the log message what the difference is between fromModel (schema):, fromModel (base end):, and fromModel (end):.\nThe types being dumped are all different (Schema input, ADT before mutation, and ADT after mutation), which could be confusing especially if they have similar properties.\n\nAs a small point, the logging framework will interpolate content based on whether or not this log level is enabled using the {} formatter. Without this, a new string and model dump (which may or may not just be member reference string in this case, depends on the toString of the types) will be concatenated every time this line is hit regardless of whether or not debug is enabled.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    LOGGER.debug(\"fromModel (schema): \" + model);\n          \n          \n            \n                    LOGGER.debug(\"fromModel (schema): {}\", model);", "author": "jimschubert", "createdAt": "2021-01-10T01:43:11Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/RustServerCodegen.java", "diffHunk": "@@ -1191,8 +1189,13 @@ public String toInstantiationType(Schema p) {\n \n     @Override\n     public CodegenModel fromModel(String name, Schema model) {\n+        LOGGER.debug(\"fromModel (schema): \" + model);", "originalCommit": "0a15ecbf43bfc7b7106da601b81be3dc469f6d76", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzE1NjcxOA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6690#discussion_r563156718", "bodyText": "I wanted to leave these in as they were very helpful debugging issues, so to address your feedback:\nFor 1, I've downgraded these to trace\nFor 2 and 3. I've clarified the logs to make it clearer that the first is the schema, and the last is the model. I've eliminated the middle line.", "author": "richardwhiuk", "createdAt": "2021-01-23T14:06:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDQ5NTk4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDQ5NjAwOA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6690#discussion_r554496008", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    LOGGER.debug(\"fromModel (base end): \" + mdl);\n          \n          \n            \n                    LOGGER.debug(\"fromModel (base end): {}\", mdl);", "author": "jimschubert", "createdAt": "2021-01-10T01:43:25Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/RustServerCodegen.java", "diffHunk": "@@ -1191,8 +1189,13 @@ public String toInstantiationType(Schema p) {\n \n     @Override\n     public CodegenModel fromModel(String name, Schema model) {\n+        LOGGER.debug(\"fromModel (schema): \" + model);\n+\n         Map<String, Schema> allDefinitions = ModelUtils.getSchemas(this.openAPI);\n         CodegenModel mdl = super.fromModel(name, model);\n+\n+        LOGGER.debug(\"fromModel (base end): \" + mdl);", "originalCommit": "0a15ecbf43bfc7b7106da601b81be3dc469f6d76", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDQ5NjAzMw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6690#discussion_r554496033", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    LOGGER.debug(\"fromModel (end): \" + mdl);\n          \n          \n            \n                    LOGGER.debug(\"fromModel (end): {}\", mdl);", "author": "jimschubert", "createdAt": "2021-01-10T01:43:37Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/RustServerCodegen.java", "diffHunk": "@@ -1245,6 +1250,8 @@ public CodegenModel fromModel(String name, Schema model) {\n             mdl.additionalPropertiesType = getTypeDeclaration(additionalProperties);\n         }\n \n+        LOGGER.debug(\"fromModel (end): \" + mdl);", "originalCommit": "0a15ecbf43bfc7b7106da601b81be3dc469f6d76", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDQ5NjExNQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6690#discussion_r554496115", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        LOGGER.debug(\"postProcessModels: \" + cm);\n          \n          \n            \n                        LOGGER.debug(\"postProcessModels: {}\", cm);", "author": "jimschubert", "createdAt": "2021-01-10T01:44:35Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/RustServerCodegen.java", "diffHunk": "@@ -1529,6 +1558,8 @@ private String matchingIntType(boolean unsigned, Long inclusiveMin, Long inclusi\n             Map<String, Object> mo = (Map<String, Object>) _mo;\n             CodegenModel cm = (CodegenModel) mo.get(\"model\");\n \n+            LOGGER.debug(\"postProcessModels: \" + cm);", "originalCommit": "0a15ecbf43bfc7b7106da601b81be3dc469f6d76", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2bcd59a70696ccc7fec93cebcf68c6f903b0ad71", "url": "https://github.com/OpenAPITools/openapi-generator/commit/2bcd59a70696ccc7fec93cebcf68c6f903b0ad71", "message": "[Core, Rust Server] Address review comments", "committedDate": "2021-01-23T13:51:02Z", "type": "commit"}, {"oid": "2bcd59a70696ccc7fec93cebcf68c6f903b0ad71", "url": "https://github.com/OpenAPITools/openapi-generator/commit/2bcd59a70696ccc7fec93cebcf68c6f903b0ad71", "message": "[Core, Rust Server] Address review comments", "committedDate": "2021-01-23T13:51:02Z", "type": "forcePushed"}, {"oid": "472ce46a4c23b41cb9851b81e3a74d20b9be5ec6", "url": "https://github.com/OpenAPITools/openapi-generator/commit/472ce46a4c23b41cb9851b81e3a74d20b9be5ec6", "message": "Merge branch 'master' into rust-server-any-of", "committedDate": "2021-01-23T14:01:36Z", "type": "commit"}, {"oid": "255bfd76823acc0ec55737a47989340b145e435d", "url": "https://github.com/OpenAPITools/openapi-generator/commit/255bfd76823acc0ec55737a47989340b145e435d", "message": "[Rust Server] Downgrade logs to trace", "committedDate": "2021-01-23T14:05:33Z", "type": "commit"}]}