{"pr_number": 6121, "pr_title": "[Python-experimental] JSON schema 'null' type should be modeled as 'none_type'", "pr_createdAt": "2020-04-30T19:38:33Z", "pr_url": "https://github.com/OpenAPITools/openapi-generator/pull/6121", "timeline": [{"oid": "489985d3be058757099b5d60ba02aa29a4cf617b", "url": "https://github.com/OpenAPITools/openapi-generator/commit/489985d3be058757099b5d60ba02aa29a4cf617b", "message": "Handle null type", "committedDate": "2020-04-30T19:34:56Z", "type": "commit"}, {"oid": "c16089e080edc1baa529068a5a09fef3850778c1", "url": "https://github.com/OpenAPITools/openapi-generator/commit/c16089e080edc1baa529068a5a09fef3850778c1", "message": "Handle null type", "committedDate": "2020-04-30T20:54:12Z", "type": "commit"}, {"oid": "26865b3f58281b479609fd7826fe58166451d17b", "url": "https://github.com/OpenAPITools/openapi-generator/commit/26865b3f58281b479609fd7826fe58166451d17b", "message": "Handle null type. Add 'null' type in the OAS document for testing purpose", "committedDate": "2020-04-30T21:09:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODI5OTY1MQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r418299651", "bodyText": "@spacether , I need to fix this such that this import is not generated.", "author": "sebastien-rosset", "createdAt": "2020-04-30T21:28:34Z", "path": "samples/openapi3/client/petstore/python-experimental/petstore_api/models/fruit_req.py", "diffHunk": "@@ -39,6 +39,11 @@\n except ImportError:\n     banana_req = sys.modules[\n         'petstore_api.models.banana_req']\n+try:", "originalCommit": "26865b3f58281b479609fd7826fe58166451d17b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODMwMDEzOQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r418300139", "bodyText": "I've just added this \"null\" type here to have one scenario with the \"null\" type in OneOf and validate the impact of having this type. @spacether , are you ok with this?", "author": "sebastien-rosset", "createdAt": "2020-04-30T21:29:37Z", "path": "samples/openapi3/client/petstore/go-experimental/go-petstore/api/openapi.yaml", "diffHunk": "@@ -1973,6 +1973,7 @@ components:\n           type: string\n     fruitReq:\n       oneOf:\n+      - type: \"null\"", "originalCommit": "26865b3f58281b479609fd7826fe58166451d17b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM2OTA4NQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r418369085", "bodyText": "Yup, I am okay adding this to our sample spec", "author": "spacether", "createdAt": "2020-05-01T00:56:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODMwMDEzOQ=="}], "type": "inlineReview"}, {"oid": "48c310e2acca71894b531445f3b6e99a7e7bb551", "url": "https://github.com/OpenAPITools/openapi-generator/commit/48c310e2acca71894b531445f3b6e99a7e7bb551", "message": "Handle null type. Add 'null' type in the OAS document for testing purpose", "committedDate": "2020-04-30T21:49:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODMxMDYzMw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r418310633", "bodyText": "@spacether , this is one way to ensure the import below is not generated, but it's brittle. Is there a better way to skip these special case imports?\ntry:\n    from openapi_client.models import null\nexcept ImportError:\n    null = sys.modules[\n        'openapi_client.models.null']\nUPDATE: I've made a change which I think is more robust.", "author": "sebastien-rosset", "createdAt": "2020-04-30T21:53:42Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/PythonClientExperimentalCodegen.java", "diffHunk": "@@ -388,7 +388,9 @@ private void fixModelImports(Set<String> imports) {\n                 composedSchemaSets.add(cm.oneOf);\n                 for (Set<String> importSet : composedSchemaSets) {\n                     for (String otherModelName : importSet) {\n-                        cm.imports.add(otherModelName);\n+                        if (!\"none_type\".equals(otherModelName)) {", "originalCommit": "48c310e2acca71894b531445f3b6e99a7e7bb551", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fddb63bdbb52e1efabacf1573ebe82e7167855cc", "url": "https://github.com/OpenAPITools/openapi-generator/commit/fddb63bdbb52e1efabacf1573ebe82e7167855cc", "message": "Handle null type. Add 'null' type in the OAS document for testing purpose", "committedDate": "2020-04-30T22:01:48Z", "type": "commit"}, {"oid": "cf4e9f84bd22c8a5d93c9060632338745ac1dae6", "url": "https://github.com/OpenAPITools/openapi-generator/commit/cf4e9f84bd22c8a5d93c9060632338745ac1dae6", "message": "Handle null type. Add 'null' type in the OAS document for testing purpose", "committedDate": "2020-04-30T22:08:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODMxNzA1Mg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r418317052", "bodyText": "This is to avoid creating an import for \"none_type\".", "author": "sebastien-rosset", "createdAt": "2020-04-30T22:08:53Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/PythonClientExperimentalCodegen.java", "diffHunk": "@@ -388,7 +388,9 @@ private void fixModelImports(Set<String> imports) {\n                 composedSchemaSets.add(cm.oneOf);\n                 for (Set<String> importSet : composedSchemaSets) {\n                     for (String otherModelName : importSet) {\n-                        cm.imports.add(otherModelName);\n+                        if (!languageSpecificPrimitives.contains(otherModelName)) {", "originalCommit": "cf4e9f84bd22c8a5d93c9060632338745ac1dae6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3b59b47c183566efa5055eaae472b157cb7ae74e", "url": "https://github.com/OpenAPITools/openapi-generator/commit/3b59b47c183566efa5055eaae472b157cb7ae74e", "message": "Handle null type. Add 'null' type in the OAS document for testing purpose", "committedDate": "2020-05-01T00:22:33Z", "type": "commit"}, {"oid": "b362f92a47253bc76b7bd59236adaa3a170b4e3c", "url": "https://github.com/OpenAPITools/openapi-generator/commit/b362f92a47253bc76b7bd59236adaa3a170b4e3c", "message": "Handle null type. Add 'null' type in the OAS document for testing purpose", "committedDate": "2020-05-01T00:25:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM3MDExNA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r418370114", "bodyText": "Did you mean anyof_instances.append..?\nAlso, I don't think that we should add model_args to anyof_instances.\nanyof_instances is meant to store ModelSimple or ModelComposed instances, not None.\nIn my mind, this None case should return None in the place of a model instance\nIf we wait for #6124 to land, then we can do this in the __new__ method.\nThis logic would apply to none_type in oneOf + anyOf\nWhat do you think?\nThis is what I think should happen:\na = FruitReq(None)\na == None -> True\n\nWe need access to the positional argument None, which we get in __new__", "author": "spacether", "createdAt": "2020-05-01T01:00:38Z", "path": "modules/openapi-generator/src/main/resources/python/python-experimental/model_utils.mustache", "diffHunk": "@@ -1043,6 +1050,13 @@ def get_anyof_instances(self, model_args, constant_args):\n         return anyof_instances\n \n     for anyof_class in self._composed_schemas()['anyOf']:\n+        if anyof_class is none_type:\n+            # The only way the input data can match the 'None' type\n+            # is if the input data is the 'null' value.\n+            if model_args is None:\n+                # The input data matches the 'None' type.\n+                oneof_instances.append(model_args)", "originalCommit": "b362f92a47253bc76b7bd59236adaa3a170b4e3c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM3MDk1OQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r418370959", "bodyText": "Yes, good catch, I copy/pasted.", "author": "sebastien-rosset", "createdAt": "2020-05-01T01:04:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM3MDExNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM3MTU3Mw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r418371573", "bodyText": "Also, I don't think that we should add model_args to anyof_instances.\nanyof_instances is meant to store ModelSimple or ModelComposed instances, not None.\nLet's just delete this if clause and continue.\n\nBut then potentially if len(anyof_instances) == 0: would be true, if the input data is the null value and the OAS schema has anyOf: [type: 'null', a, b, c]\nSo do you mean just return None? The caller needs to know there was a match for the None value.", "author": "sebastien-rosset", "createdAt": "2020-05-01T01:07:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM3MDExNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM3Mzk4Nw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r418373987", "bodyText": "Yes, return None. The spec says that None is a valid value. We raise exceptions if deserialization fails. We return None with no exception, so deserialization succeeded.", "author": "spacether", "createdAt": "2020-05-01T01:17:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM3MDExNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM3NDU5Ng==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r418374596", "bodyText": "We never get to counting oneOf or anyOf instance because we returned None in the ComposedSchema.__new__ method and ComposedSchema.__init__ is never called.", "author": "spacether", "createdAt": "2020-05-01T01:20:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM3MDExNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM3NTA5Mw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r418375093", "bodyText": "a = FruitReq(None)\na == None -> True\nisisnstance(a, FruitReq) -> False\nisisnstance(a, none_type) -> True", "author": "spacether", "createdAt": "2020-05-01T01:22:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM3MDExNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM5NDI2Mg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r418394262", "bodyText": "done", "author": "sebastien-rosset", "createdAt": "2020-05-01T02:52:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM3MDExNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM3MDQwNQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r418370405", "bodyText": "With my suggested below solution, None types deserialization would never reach here.\nIf we do reach here though:\nIf model_args can be None please update our docstrings to show that\n\nhere +\nget_oneof_instance\nany calling function that passes it in", "author": "spacether", "createdAt": "2020-05-01T01:01:48Z", "path": "modules/openapi-generator/src/main/resources/python/python-experimental/model_utils.mustache", "diffHunk": "@@ -1043,6 +1050,13 @@ def get_anyof_instances(self, model_args, constant_args):\n         return anyof_instances\n \n     for anyof_class in self._composed_schemas()['anyOf']:\n+        if anyof_class is none_type:\n+            # The only way the input data can match the 'None' type\n+            # is if the input data is the 'null' value.\n+            if model_args is None:", "originalCommit": "b362f92a47253bc76b7bd59236adaa3a170b4e3c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM5MzMzNQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r418393335", "bodyText": "done", "author": "sebastien-rosset", "createdAt": "2020-05-01T02:47:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM3MDQwNQ=="}], "type": "inlineReview"}, {"oid": "ae93643e50532b056eec24d04234d129b9161ee6", "url": "https://github.com/OpenAPITools/openapi-generator/commit/ae93643e50532b056eec24d04234d129b9161ee6", "message": "improve documentation", "committedDate": "2020-05-01T01:15:07Z", "type": "commit"}, {"oid": "f5acfba661b4751bfa31ff1a6950a2460580d8d5", "url": "https://github.com/OpenAPITools/openapi-generator/commit/f5acfba661b4751bfa31ff1a6950a2460580d8d5", "message": "Handle 'null' type", "committedDate": "2020-05-01T02:52:28Z", "type": "commit"}, {"oid": "6ba15238e57df1238cd4265eb91dfb0f7f6cecc5", "url": "https://github.com/OpenAPITools/openapi-generator/commit/6ba15238e57df1238cd4265eb91dfb0f7f6cecc5", "message": "Handle 'null' type. Add unit tests", "committedDate": "2020-05-01T04:29:58Z", "type": "commit"}, {"oid": "de13169b79fb23a107d144a75fe56f2404545286", "url": "https://github.com/OpenAPITools/openapi-generator/commit/de13169b79fb23a107d144a75fe56f2404545286", "message": "Merge branch 'master' of github.com:CiscoM31/openapi-generator into python-null-type", "committedDate": "2020-05-01T20:23:04Z", "type": "commit"}, {"oid": "2a6a87a0af80802f2246f688f01f4619135b643a", "url": "https://github.com/OpenAPITools/openapi-generator/commit/2a6a87a0af80802f2246f688f01f4619135b643a", "message": "Add NullType for go", "committedDate": "2020-05-02T00:56:44Z", "type": "commit"}, {"oid": "86bc4c005aa4eedcf18ea816c61c760cf2aa142d", "url": "https://github.com/OpenAPITools/openapi-generator/commit/86bc4c005aa4eedcf18ea816c61c760cf2aa142d", "message": "Add NullType for go", "committedDate": "2020-05-02T01:45:07Z", "type": "commit"}, {"oid": "6b9c0cedbae345e4f6f40818121332ffd4913286", "url": "https://github.com/OpenAPITools/openapi-generator/commit/6b9c0cedbae345e4f6f40818121332ffd4913286", "message": "fix modeling of AnyType for go-experimental", "committedDate": "2020-05-02T16:49:41Z", "type": "commit"}, {"oid": "b0d221e723c7c83e395cf140177c18a2d383f8e2", "url": "https://github.com/OpenAPITools/openapi-generator/commit/b0d221e723c7c83e395cf140177c18a2d383f8e2", "message": "Merge branch 'master' of github.com:CiscoM31/openapi-generator into python-null-type", "committedDate": "2020-05-02T17:19:17Z", "type": "commit"}, {"oid": "a302894c3cfa1ee7314876ebc5a8b021a64e21e8", "url": "https://github.com/OpenAPITools/openapi-generator/commit/a302894c3cfa1ee7314876ebc5a8b021a64e21e8", "message": "execute scripts in bin directory", "committedDate": "2020-05-03T16:15:43Z", "type": "commit"}, {"oid": "e449c82139bea9402160e5829b84be8b04809fc2", "url": "https://github.com/OpenAPITools/openapi-generator/commit/e449c82139bea9402160e5829b84be8b04809fc2", "message": "resolve merge conflicts", "committedDate": "2020-05-03T20:54:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE1OTY4MA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r419159680", "bodyText": "Can you add this to the v3 python-experimental spec also?", "author": "spacether", "createdAt": "2020-05-03T21:01:34Z", "path": "modules/openapi-generator/src/test/resources/3_0/petstore-with-fake-endpoints-models-for-testing-with-http-signature.yaml", "diffHunk": "@@ -1855,6 +1855,7 @@ components:\n           - $ref: '#/components/schemas/banana'\n     fruitReq:\n        oneOf:\n+          - type: 'null'", "originalCommit": "e449c82139bea9402160e5829b84be8b04809fc2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUzMjc1Mw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r419532753", "bodyText": "done", "author": "sebastien-rosset", "createdAt": "2020-05-04T15:42:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE1OTY4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2MDMyNQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r419160325", "bodyText": "With the neswest code we will never reach here when deserializing None.\nCan you remove the None additions from this docstirng?\n\nthis also applies to get_anyof_instances", "author": "spacether", "createdAt": "2020-05-03T21:07:10Z", "path": "modules/openapi-generator/src/main/resources/python/python-experimental/model_utils.mustache", "diffHunk": "@@ -1024,9 +1024,10 @@ def get_oneof_instance(self, model_args, constant_args):\n     schemas described by oneOf.\n     Args:\n         self: the class we are handling\n-        model_args (dict): var_name to var_value\n+        model_args (dict/None): var_name to var_value", "originalCommit": "e449c82139bea9402160e5829b84be8b04809fc2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2MDQ1Nw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r419160457", "bodyText": "Can you delete this if model_args is None: block?\nWe will still go through this code path for deserializing pojo payloads but we should continue through the None like you are doing.\n\nthis also applies to get_anyof_instances", "author": "spacether", "createdAt": "2020-05-03T21:08:26Z", "path": "modules/openapi-generator/src/main/resources/python/python-experimental/model_utils.mustache", "diffHunk": "@@ -1041,6 +1042,13 @@ def get_oneof_instance(self, model_args, constant_args):\n     # Iterate over each oneOf schema and determine if the input data\n     # matches the oneOf schemas.\n     for oneof_class in self._composed_schemas['oneOf']:\n+        if oneof_class is none_type:\n+            # The only way the input data can match the 'None' type\n+            # is if the input data is the 'null' value.\n+            if model_args is None:\n+                # The input data matches the 'None' type.\n+                oneof_instances.append(model_args)", "originalCommit": "e449c82139bea9402160e5829b84be8b04809fc2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUyMzE4MQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r419523181", "bodyText": "done", "author": "sebastien-rosset", "createdAt": "2020-05-04T15:29:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2MDQ1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2MjA0OQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r419162049", "bodyText": "I don't think that this will work anymore.\nHow about here\nadding:\noneof_anyof_classes = cls._composed_schemas.get('oneOf', ()) + cls._composed_schemas.get('anyOf', ())\nif oneof_anyof_classes and none_type in oneof_anyof_classes and args[0] is None:\n  return None\n\nThen you can also delete the oneof_anyof_classes definition from lines 78-80.", "author": "spacether", "createdAt": "2020-05-03T21:22:07Z", "path": "samples/openapi3/client/petstore/python-experimental/tests/test_deserialization.py", "diffHunk": "@@ -125,4 +125,16 @@ def test_deserialize_mammal(self):\n         deserialized = self.deserialize(response, (petstore_api.Mammal,), True)\n         self.assertTrue(isinstance(deserialized, petstore_api.Zebra))\n         self.assertEqual(deserialized.type, zebra_type)\n-        self.assertEqual(deserialized.class_name, class_name)\n\\ No newline at end of file\n+        self.assertEqual(deserialized.class_name, class_name)\n+\n+    def test_deserialize_fruit(self):\n+        \"\"\"\n+        deserialize fruit\n+        fruitReq is a oneOf composed schema model with discriminator, including 'null' type.\n+        \"\"\"\n+\n+        # Unmarshal 'null' value\n+        data = None\n+        response = MockResponse(data=json.dumps(data))\n+        deserialized = self.deserialize(response, (petstore_api.FruitReq, type(None)), True)\n+        self.assertEqual(type(deserialized), type(None))", "originalCommit": "e449c82139bea9402160e5829b84be8b04809fc2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTYzMTY4Mg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r419631682", "bodyText": "Where was this done? In the PR I don't see any code added in the __new__ method.", "author": "spacether", "createdAt": "2020-05-04T18:15:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2MjA0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg2OTA0OA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r419869048", "bodyText": "Where was this done? In the PR I don't see any code added in the __new__ method.\n\nWhere was what done?", "author": "sebastien-rosset", "createdAt": "2020-05-05T05:20:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2MjA0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg5MTM1MQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r419891351", "bodyText": "My above suggestion asked that you add code in the new method. So I am asking where the requested code was added.", "author": "spacether", "createdAt": "2020-05-05T06:34:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2MjA0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIyMTM3MA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r420221370", "bodyText": "ok, I missed that proposed change.", "author": "sebastien-rosset", "createdAt": "2020-05-05T15:58:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2MjA0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIyMjU5MA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r420222590", "bodyText": "Is it expected that your proposed change has no check for \"allOf\"?", "author": "sebastien-rosset", "createdAt": "2020-05-05T16:00:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2MjA0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzMDAxNA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r420230014", "bodyText": "Can you describe a payload and schema that would need this allOf check where the check is missing?\nwhen deserializing None where none is in OneOf or AnyOf, any allOf definition of object property fields can never be met by a None payload because None is not a pojo.\nFurther down in the new function we cover the use case where we have allof definitions, verify that the payload conforms to it then deserialize to an anyof or oneof pojo payload.", "author": "spacether", "createdAt": "2020-05-05T16:10:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2MjA0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzMTg3Mw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r420231873", "bodyText": "That was a question for you. You wrote this code, so I am asking you.", "author": "sebastien-rosset", "createdAt": "2020-05-05T16:13:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2MjA0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0MDk2OA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r420240968", "bodyText": "Does my above answer meet your needs? I don't understand when we would need to check allof but we miss that check. In the answer I describe both cases that do and don't check allof and why.", "author": "spacether", "createdAt": "2020-05-05T16:26:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2MjA0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI1NDcxOQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r420254719", "bodyText": "Thanks. I just copied your code as is without checking the correctness.", "author": "sebastien-rosset", "createdAt": "2020-05-05T16:47:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2MjA0OQ=="}], "type": "inlineReview"}, {"oid": "043f247758c02d7d28f0b4fb3a019da26c756c50", "url": "https://github.com/OpenAPITools/openapi-generator/commit/043f247758c02d7d28f0b4fb3a019da26c756c50", "message": "Merge branch 'master' of github.com:CiscoM31/openapi-generator into python-null-type", "committedDate": "2020-05-04T15:18:57Z", "type": "commit"}, {"oid": "1e14c94136190027c78c11cc6c901573ef4394c0", "url": "https://github.com/OpenAPITools/openapi-generator/commit/1e14c94136190027c78c11cc6c901573ef4394c0", "message": "Add review comments", "committedDate": "2020-05-04T15:28:34Z", "type": "commit"}, {"oid": "747803e4e00cd73043e1f8d08f38d41ea3c8bcb5", "url": "https://github.com/OpenAPITools/openapi-generator/commit/747803e4e00cd73043e1f8d08f38d41ea3c8bcb5", "message": "Add 'null' type in oneOf", "committedDate": "2020-05-04T15:33:10Z", "type": "commit"}, {"oid": "aa06a8940565754eee6058ca90b41c1fbd4568c8", "url": "https://github.com/OpenAPITools/openapi-generator/commit/aa06a8940565754eee6058ca90b41c1fbd4568c8", "message": "Improve OAS YAML file for golang openapi3 samples", "committedDate": "2020-05-04T18:30:21Z", "type": "commit"}, {"oid": "543d4060ca95186737018e95107adba5729df35b", "url": "https://github.com/OpenAPITools/openapi-generator/commit/543d4060ca95186737018e95107adba5729df35b", "message": "'Any type' includes the null value, so 'isNullable' should be set to TRUE", "committedDate": "2020-05-04T18:51:48Z", "type": "commit"}, {"oid": "81093c7f8ba6f5a3e75708a78c06c584cf257b3d", "url": "https://github.com/OpenAPITools/openapi-generator/commit/81093c7f8ba6f5a3e75708a78c06c584cf257b3d", "message": "'Any type' includes the null value, so 'isNullable' should be set to TRUE", "committedDate": "2020-05-04T19:12:38Z", "type": "commit"}, {"oid": "9a54ea10b567557d9b4d02c211c44ec618969eba", "url": "https://github.com/OpenAPITools/openapi-generator/commit/9a54ea10b567557d9b4d02c211c44ec618969eba", "message": "Handle AnyType and NullType", "committedDate": "2020-05-05T01:03:57Z", "type": "commit"}, {"oid": "dc7a7e05b4d1890c36e40507d3edbce67e5c006b", "url": "https://github.com/OpenAPITools/openapi-generator/commit/dc7a7e05b4d1890c36e40507d3edbce67e5c006b", "message": "handle anytype for go-experimental", "committedDate": "2020-05-05T05:09:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEyODU0Mw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r420128543", "bodyText": "I would use LOGGER.warn instead and make it clear it's for the upcoming OAS v3.1\n(after OAS v3.1 release, I would expect the parser (swagger-parser) to catch this kind of issue)", "author": "wing328", "createdAt": "2020-05-05T13:55:56Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/DefaultCodegen.java", "diffHunk": "@@ -2986,6 +2993,12 @@ public CodegenProperty fromProperty(String name, Schema p) {\n         } else if (ModelUtils.isFreeFormObject(p)) {\n             property.isFreeFormObject = true;\n         } else if (ModelUtils.isAnyTypeSchema(p)) {\n+            // The 'null' value is allowed when the OAS schema is 'any type'.\n+            // See https://github.com/OAI/OpenAPI-Specification/issues/1389\n+            if (Boolean.FALSE.equals(p.getNullable())) {\n+                LOGGER.error(\"Schema '{}' is any type, which includes the 'null' value. 'nullable' cannot be set to 'false'\", p.getName());", "originalCommit": "dc7a7e05b4d1890c36e40507d3edbce67e5c006b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIxNzQwNg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r420217406", "bodyText": "done", "author": "sebastien-rosset", "createdAt": "2020-05-05T15:53:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEyODU0Mw=="}], "type": "inlineReview"}, {"oid": "ddc810c7208688fdd2ec81913237e5d3d8ecd3da", "url": "https://github.com/OpenAPITools/openapi-generator/commit/ddc810c7208688fdd2ec81913237e5d3d8ecd3da", "message": "Merge branch 'master' of github.com:CiscoM31/openapi-generator into python-null-type", "committedDate": "2020-05-05T15:52:45Z", "type": "commit"}, {"oid": "03ec9149e16c117e841d565276e589b3f0ab109c", "url": "https://github.com/OpenAPITools/openapi-generator/commit/03ec9149e16c117e841d565276e589b3f0ab109c", "message": "Log warning instead of error", "committedDate": "2020-05-05T15:53:19Z", "type": "commit"}, {"oid": "bdf3653778a78076c75eda000c079aceffab5306", "url": "https://github.com/OpenAPITools/openapi-generator/commit/bdf3653778a78076c75eda000c079aceffab5306", "message": "anyOf/oneOf", "committedDate": "2020-05-05T16:00:36Z", "type": "commit"}, {"oid": "9dbae45a54f8018b5c51e95485dd983c9b4edcd8", "url": "https://github.com/OpenAPITools/openapi-generator/commit/9dbae45a54f8018b5c51e95485dd983c9b4edcd8", "message": "Change x-golang-is-container extension to x-golang-has-wrapper", "committedDate": "2020-05-05T16:57:14Z", "type": "commit"}, {"oid": "e1417ecd5e5880b253a817a96ea54eba55c2b3c3", "url": "https://github.com/OpenAPITools/openapi-generator/commit/e1417ecd5e5880b253a817a96ea54eba55c2b3c3", "message": "Add code comments", "committedDate": "2020-05-05T17:25:21Z", "type": "commit"}, {"oid": "480ecbefdbcd0838ec3faac22fb841750aa863f4", "url": "https://github.com/OpenAPITools/openapi-generator/commit/480ecbefdbcd0838ec3faac22fb841750aa863f4", "message": "Handle Object and any type", "committedDate": "2020-05-05T17:26:36Z", "type": "commit"}, {"oid": "a58f121343c1a50a559691fcf1a52559b0ed8866", "url": "https://github.com/OpenAPITools/openapi-generator/commit/a58f121343c1a50a559691fcf1a52559b0ed8866", "message": "Handle Object and any type", "committedDate": "2020-05-05T17:27:41Z", "type": "commit"}, {"oid": "01ff36e8937cb811389030d4aef8a425a851046b", "url": "https://github.com/OpenAPITools/openapi-generator/commit/01ff36e8937cb811389030d4aef8a425a851046b", "message": "Handle object and any type", "committedDate": "2020-05-05T17:28:58Z", "type": "commit"}, {"oid": "ec97db3363beb36b5157ffec0d366fd3b7811478", "url": "https://github.com/OpenAPITools/openapi-generator/commit/ec97db3363beb36b5157ffec0d366fd3b7811478", "message": "add code comments", "committedDate": "2020-05-06T13:32:54Z", "type": "commit"}, {"oid": "431356c557cdb3de46817189f56b347df1e38727", "url": "https://github.com/OpenAPITools/openapi-generator/commit/431356c557cdb3de46817189f56b347df1e38727", "message": "handle additional properties", "committedDate": "2020-05-06T16:37:02Z", "type": "commit"}, {"oid": "93752ff6e82e7b0d938a20c5fadbf87360edba36", "url": "https://github.com/OpenAPITools/openapi-generator/commit/93752ff6e82e7b0d938a20c5fadbf87360edba36", "message": "handle additional properties", "committedDate": "2020-05-06T16:37:28Z", "type": "commit"}, {"oid": "261dbcdb33bc98df86b803f5e96d2167c75fa01e", "url": "https://github.com/OpenAPITools/openapi-generator/commit/261dbcdb33bc98df86b803f5e96d2167c75fa01e", "message": "handle additional properties", "committedDate": "2020-05-06T16:38:25Z", "type": "commit"}, {"oid": "aa6b6dfcec737e2c03fe2a0c3cc17db894b50c4d", "url": "https://github.com/OpenAPITools/openapi-generator/commit/aa6b6dfcec737e2c03fe2a0c3cc17db894b50c4d", "message": "handle anytype and objecttype for go-exerimental", "committedDate": "2020-05-06T21:35:53Z", "type": "commit"}, {"oid": "90c0c9ed7a47eee28f05bc079c600bcee7e03af5", "url": "https://github.com/OpenAPITools/openapi-generator/commit/90c0c9ed7a47eee28f05bc079c600bcee7e03af5", "message": "Move golang changes to a separate branch", "committedDate": "2020-05-07T19:23:56Z", "type": "commit"}, {"oid": "f56c812a50a51bd14890a8e9ded1ada615548af0", "url": "https://github.com/OpenAPITools/openapi-generator/commit/f56c812a50a51bd14890a8e9ded1ada615548af0", "message": "Move golang changes to a separate branch", "committedDate": "2020-05-07T19:27:08Z", "type": "commit"}, {"oid": "b159356fb73060a0dcef2336a05020dfb165599e", "url": "https://github.com/OpenAPITools/openapi-generator/commit/b159356fb73060a0dcef2336a05020dfb165599e", "message": "Better names for the OAS document test properties", "committedDate": "2020-05-07T19:34:36Z", "type": "commit"}, {"oid": "ef5149ef2b19c5dff503bafdc7bf81cc73450a47", "url": "https://github.com/OpenAPITools/openapi-generator/commit/ef5149ef2b19c5dff503bafdc7bf81cc73450a47", "message": "Move golang changes to a separate branch", "committedDate": "2020-05-07T19:35:53Z", "type": "commit"}, {"oid": "84162bea7c8e7c0ab7e6e5d6e74aefb8859ede98", "url": "https://github.com/OpenAPITools/openapi-generator/commit/84162bea7c8e7c0ab7e6e5d6e74aefb8859ede98", "message": "Run samples scripts", "committedDate": "2020-05-07T19:39:21Z", "type": "commit"}, {"oid": "ee786cb6797518ff624384f49d99c2fa6a9208f7", "url": "https://github.com/OpenAPITools/openapi-generator/commit/ee786cb6797518ff624384f49d99c2fa6a9208f7", "message": "Run samples scripts", "committedDate": "2020-05-07T19:45:47Z", "type": "commit"}, {"oid": "058694b8d1addb0c5909d2970fd059bfa9a4b63e", "url": "https://github.com/OpenAPITools/openapi-generator/commit/058694b8d1addb0c5909d2970fd059bfa9a4b63e", "message": "Merge branch 'master' of github.com:CiscoM31/openapi-generator into python-null-type", "committedDate": "2020-05-07T20:17:41Z", "type": "commit"}, {"oid": "82cb0e91d3758bc510ca893640eef73d513da796", "url": "https://github.com/OpenAPITools/openapi-generator/commit/82cb0e91d3758bc510ca893640eef73d513da796", "message": "fix unit test issues", "committedDate": "2020-05-08T01:31:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg5MDkwOA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r421890908", "bodyText": "We will only reach this code if we are deserializing a dict payload.\nThis is because the __new__ method is run before the __init__ method. And in __new__ we return None rather than an instance of the composed class when we pass in None and oneOf contains None type.\nSo in that case, get_oneof_instance is never called. So in this loop, all we need to do is skip over the none_types.\nCan you change this if block to be only this?\nif oneof_class is none_type:\n  # skip none_types because we are deserializing dict data. none_type deserialization is handled in the __new__ method\n  continue", "author": "spacether", "createdAt": "2020-05-08T01:48:40Z", "path": "modules/openapi-generator/src/main/resources/python/python-experimental/model_utils.mustache", "diffHunk": "@@ -1041,6 +1043,16 @@ def get_oneof_instance(self, model_args, constant_args):\n     # Iterate over each oneOf schema and determine if the input data\n     # matches the oneOf schemas.\n     for oneof_class in self._composed_schemas['oneOf']:\n+        # The composed oneOf schema allows the 'null' type and the input data\n+        # is the null value. This is a OAS >= 3.1 feature.\n+        if oneof_class is none_type:", "originalCommit": "82cb0e91d3758bc510ca893640eef73d513da796", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg5MTMyMg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r421891322", "bodyText": "Actually, I just added this code because otherwise the existing unit tests fail. This code IS executed when the unit tests are executed, but let me try your proposed change.", "author": "sebastien-rosset", "createdAt": "2020-05-08T01:50:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg5MDkwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg5MjQ5Mw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r421892493", "bodyText": "Thank you for the change. I just tested it. It works.", "author": "sebastien-rosset", "createdAt": "2020-05-08T01:54:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg5MDkwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg5MTA5OA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6121#discussion_r421891098", "bodyText": "We will only reach this code if we are deserializing a dict payload.\nThis is because the __new__ method is run before the __init__ method. And in __new__ we return None rather than an instance of the composed class when we pass in None and oneOf contains None type.\nSo in that case, get_anyof_instances is never called. So in this loop, all we need to do is skip over the none_types.\nCan you change this if block to be only this?\nif anyof_class is none_type:\n  # skip none_types because we are deserializing dict data. none_type deserialization is handled in the __new__ method\n  continue", "author": "spacether", "createdAt": "2020-05-08T01:49:16Z", "path": "modules/openapi-generator/src/main/resources/python/python-experimental/model_utils.mustache", "diffHunk": "@@ -1098,6 +1112,16 @@ def get_anyof_instances(self, model_args, constant_args):\n         return anyof_instances\n \n     for anyof_class in self._composed_schemas['anyOf']:\n+        # The composed oneOf schema allows the 'null' type and the input data\n+        # is the null value. This is a OAS >= 3.1 feature.\n+        if anyof_class is none_type:", "originalCommit": "82cb0e91d3758bc510ca893640eef73d513da796", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2c5c1cf3b7566990a388ac13266a1eea86c40e81", "url": "https://github.com/OpenAPITools/openapi-generator/commit/2c5c1cf3b7566990a388ac13266a1eea86c40e81", "message": "Handle none type", "committedDate": "2020-05-08T01:53:50Z", "type": "commit"}, {"oid": "0694f83dc6d5a3c80c9d17bdca2345b8781f810b", "url": "https://github.com/OpenAPITools/openapi-generator/commit/0694f83dc6d5a3c80c9d17bdca2345b8781f810b", "message": "Merge branch 'master' of github.com:CiscoM31/openapi-generator into python-null-type", "committedDate": "2020-05-08T04:21:34Z", "type": "commit"}, {"oid": "b6afbc6883bd9b93c1347d0f99195f6ad2f63cc3", "url": "https://github.com/OpenAPITools/openapi-generator/commit/b6afbc6883bd9b93c1347d0f99195f6ad2f63cc3", "message": "Merge branch 'master' of github.com:CiscoM31/openapi-generator into python-null-type", "committedDate": "2020-05-08T19:24:07Z", "type": "commit"}, {"oid": "f275dc92a15675738fecef4f34c999e1bfd58dca", "url": "https://github.com/OpenAPITools/openapi-generator/commit/f275dc92a15675738fecef4f34c999e1bfd58dca", "message": "Fix index out of range exception", "committedDate": "2020-05-08T19:32:12Z", "type": "commit"}, {"oid": "93cc8c8053d4d817274547187434c4be2f8ce535", "url": "https://github.com/OpenAPITools/openapi-generator/commit/93cc8c8053d4d817274547187434c4be2f8ce535", "message": "fix formatting issues", "committedDate": "2020-05-08T19:38:17Z", "type": "commit"}, {"oid": "69396481c6d94787ac94955b0a9fe0a366b3d648", "url": "https://github.com/OpenAPITools/openapi-generator/commit/69396481c6d94787ac94955b0a9fe0a366b3d648", "message": "fix formatting issues", "committedDate": "2020-05-08T20:40:04Z", "type": "commit"}, {"oid": "8bdca05fa36a0811d01c9e1c3c8b86847fcd2b76", "url": "https://github.com/OpenAPITools/openapi-generator/commit/8bdca05fa36a0811d01c9e1c3c8b86847fcd2b76", "message": "fix formatting issues. Finally figured out how to check formatting in local workspace", "committedDate": "2020-05-08T21:43:51Z", "type": "commit"}, {"oid": "4c0134444b8d81e908c9e4d366b32f1e2864b7ad", "url": "https://github.com/OpenAPITools/openapi-generator/commit/4c0134444b8d81e908c9e4d366b32f1e2864b7ad", "message": "fix formatting issues", "committedDate": "2020-05-08T22:48:34Z", "type": "commit"}, {"oid": "537c28bdf2765788320de830fb79556247f38a19", "url": "https://github.com/OpenAPITools/openapi-generator/commit/537c28bdf2765788320de830fb79556247f38a19", "message": "resolve merge conflicts", "committedDate": "2020-05-11T01:53:17Z", "type": "commit"}, {"oid": "71d550c72e699765ddcf668b1071b58737384ec5", "url": "https://github.com/OpenAPITools/openapi-generator/commit/71d550c72e699765ddcf668b1071b58737384ec5", "message": "resolve merge conflicts", "committedDate": "2020-05-11T15:52:50Z", "type": "commit"}, {"oid": "11c52e4ed608a83f686e3e0fde5976ed69821a81", "url": "https://github.com/OpenAPITools/openapi-generator/commit/11c52e4ed608a83f686e3e0fde5976ed69821a81", "message": "resolve merge conflicts", "committedDate": "2020-05-12T01:36:23Z", "type": "commit"}, {"oid": "e16c24ea937962dc4dd5e6130baebd03eb3fb7df", "url": "https://github.com/OpenAPITools/openapi-generator/commit/e16c24ea937962dc4dd5e6130baebd03eb3fb7df", "message": "Merge branch 'master' of github.com:CiscoM31/openapi-generator into python-null-type", "committedDate": "2020-05-12T13:32:35Z", "type": "commit"}, {"oid": "8f1c202ee6d1ded6d2c9d580897716f6c655beb6", "url": "https://github.com/OpenAPITools/openapi-generator/commit/8f1c202ee6d1ded6d2c9d580897716f6c655beb6", "message": "Merge branch 'master' of github.com:CiscoM31/openapi-generator into python-null-type", "committedDate": "2020-05-12T18:15:57Z", "type": "commit"}, {"oid": "5e48c724f2ddf5fb14b8a4772c53f67199c300a4", "url": "https://github.com/OpenAPITools/openapi-generator/commit/5e48c724f2ddf5fb14b8a4772c53f67199c300a4", "message": "run samples scripts", "committedDate": "2020-05-12T18:20:34Z", "type": "commit"}]}