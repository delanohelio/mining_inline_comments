{"pr_number": 8269, "pr_title": "[Java] refactor: improve additionalModelTypeAnnotations generation", "pr_createdAt": "2020-12-24T15:19:39Z", "pr_url": "https://github.com/OpenAPITools/openapi-generator/pull/8269", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg0MjEyNA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8269#discussion_r548842124", "bodyText": "remove", "author": "agilob", "createdAt": "2020-12-25T09:24:28Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/AbstractJavaCodegen.java", "diffHunk": "@@ -32,6 +32,7 @@\n import org.apache.commons.io.FilenameUtils;\n import org.apache.commons.lang3.BooleanUtils;\n import org.apache.commons.lang3.StringUtils;\n+import org.apache.commons.logging.Log;", "originalCommit": "da509c39f363da046fbd457e1ab67ef0f62f3561", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg0MjI3OA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8269#discussion_r548842278", "bodyText": "these all will need to be reverted and squashed to prevent git history pollution", "author": "agilob", "createdAt": "2020-12-25T09:25:30Z", "path": "samples/client/petstore/dart-dio/petstore_client_lib/README.md", "diffHunk": "@@ -57,36 +57,36 @@ All URIs are relative to *http://petstore.swagger.io/v2*\n \n Class | Method | HTTP request | Description\n ------------ | ------------- | ------------- | -------------\n-*PetApi* | [**addPet**](doc//PetApi.md#addpet) | **post** /pet | Add a new pet to the store\n-*PetApi* | [**deletePet**](doc//PetApi.md#deletepet) | **delete** /pet/{petId} | Deletes a pet\n-*PetApi* | [**findPetsByStatus**](doc//PetApi.md#findpetsbystatus) | **get** /pet/findByStatus | Finds Pets by status\n-*PetApi* | [**findPetsByTags**](doc//PetApi.md#findpetsbytags) | **get** /pet/findByTags | Finds Pets by tags\n-*PetApi* | [**getPetById**](doc//PetApi.md#getpetbyid) | **get** /pet/{petId} | Find pet by ID\n-*PetApi* | [**updatePet**](doc//PetApi.md#updatepet) | **put** /pet | Update an existing pet\n-*PetApi* | [**updatePetWithForm**](doc//PetApi.md#updatepetwithform) | **post** /pet/{petId} | Updates a pet in the store with form data\n-*PetApi* | [**uploadFile**](doc//PetApi.md#uploadfile) | **post** /pet/{petId}/uploadImage | uploads an image\n-*StoreApi* | [**deleteOrder**](doc//StoreApi.md#deleteorder) | **delete** /store/order/{orderId} | Delete purchase order by ID\n-*StoreApi* | [**getInventory**](doc//StoreApi.md#getinventory) | **get** /store/inventory | Returns pet inventories by status\n-*StoreApi* | [**getOrderById**](doc//StoreApi.md#getorderbyid) | **get** /store/order/{orderId} | Find purchase order by ID\n-*StoreApi* | [**placeOrder**](doc//StoreApi.md#placeorder) | **post** /store/order | Place an order for a pet\n-*UserApi* | [**createUser**](doc//UserApi.md#createuser) | **post** /user | Create user\n-*UserApi* | [**createUsersWithArrayInput**](doc//UserApi.md#createuserswitharrayinput) | **post** /user/createWithArray | Creates list of users with given input array\n-*UserApi* | [**createUsersWithListInput**](doc//UserApi.md#createuserswithlistinput) | **post** /user/createWithList | Creates list of users with given input array\n-*UserApi* | [**deleteUser**](doc//UserApi.md#deleteuser) | **delete** /user/{username} | Delete user\n-*UserApi* | [**getUserByName**](doc//UserApi.md#getuserbyname) | **get** /user/{username} | Get user by user name\n-*UserApi* | [**loginUser**](doc//UserApi.md#loginuser) | **get** /user/login | Logs user into the system\n-*UserApi* | [**logoutUser**](doc//UserApi.md#logoutuser) | **get** /user/logout | Logs out current logged in user session\n-*UserApi* | [**updateUser**](doc//UserApi.md#updateuser) | **put** /user/{username} | Updated user\n+*PetApi* | [**addPet**](doc\\/PetApi.md#addpet) | **post** /pet | Add a new pet to the store", "originalCommit": "da509c39f363da046fbd457e1ab67ef0f62f3561", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI4MjUxMA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8269#discussion_r551282510", "bodyText": "Ok the \"last\" one.\nI don't really understand what I have to do. I follow contribution by using git bash, as I'm on windows,  to run generate-samples.sh\nI already revert the commit but don't know what to do then ?", "author": "UnleashSpirit", "createdAt": "2021-01-04T12:15:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg0MjI3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg0MjM3MQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8269#discussion_r548842371", "bodyText": "Arrays.asList use set to remove duplicates", "author": "agilob", "createdAt": "2020-12-25T09:25:55Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/AbstractJavaCodegen.java", "diffHunk": "@@ -289,8 +290,7 @@ public void processOpts() {\n \n         if (additionalProperties.containsKey(ADDITIONAL_MODEL_TYPE_ANNOTATIONS)) {\n             String additionalAnnotationsList = additionalProperties.get(ADDITIONAL_MODEL_TYPE_ANNOTATIONS).toString();\n-\n-            this.setAdditionalModelTypeAnnotations(Arrays.asList(additionalAnnotationsList.split(\";\")));\n+            this.setAdditionalModelTypeAnnotations(Arrays.asList(additionalAnnotationsList.split(\"\\\\s*(;|\\\\r?\\\\n)\\\\s*\")));", "originalCommit": "da509c39f363da046fbd457e1ab67ef0f62f3561", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE5MzMwMw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8269#discussion_r550193303", "bodyText": "I didn't want to change the original code that List uses.\nDo you think this is \"necessary\"?", "author": "UnleashSpirit", "createdAt": "2020-12-30T13:22:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg0MjM3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTE5NzU4OQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8269#discussion_r551197589", "bodyText": "Using stream and distinct to avoid duplicates and potentiel side effect of using Set", "author": "UnleashSpirit", "createdAt": "2021-01-04T09:22:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg0MjM3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTE5OTA3NA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8269#discussion_r551199074", "bodyText": "From performance perspective stream.distinct is many times slower than loading things to hashset.", "author": "agilob", "createdAt": "2021-01-04T09:24:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg0MjM3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIwODE2NA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8269#discussion_r551208164", "bodyText": "So something like String[] -> Set -> List\nnew ArrayList<>(Sets.newHashSet(additionalAnnotationsList.trim().split(\"\\\\s*(;|\\\\r?\\\\n)\\\\s*\")))", "author": "UnleashSpirit", "createdAt": "2021-01-04T09:42:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg0MjM3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg0MjUyMA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8269#discussion_r548842520", "bodyText": "0 tests for this. please add tests for ; and the new splitting characters too (including \\r\\n and \\n", "author": "agilob", "createdAt": "2020-12-25T09:26:44Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/AbstractJavaCodegen.java", "diffHunk": "@@ -289,8 +290,7 @@ public void processOpts() {\n \n         if (additionalProperties.containsKey(ADDITIONAL_MODEL_TYPE_ANNOTATIONS)) {\n             String additionalAnnotationsList = additionalProperties.get(ADDITIONAL_MODEL_TYPE_ANNOTATIONS).toString();\n-\n-            this.setAdditionalModelTypeAnnotations(Arrays.asList(additionalAnnotationsList.split(\";\")));\n+            this.setAdditionalModelTypeAnnotations(Arrays.asList(additionalAnnotationsList.split(\"\\\\s*(;|\\\\r?\\\\n)\\\\s*\")));", "originalCommit": "da509c39f363da046fbd457e1ab67ef0f62f3561", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE5NDE4MQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8269#discussion_r550194181", "bodyText": "I tried in AbstractJavaCodegenTest.java but without getter for additionalModelTypeAnnotations, I found irrelevant to do\n@Test\npublic void testAdditionalModelTypeAnnotations() throws Exception {\n\tOpenAPI openAPI = TestUtils.createOpenAPI();\n\n        final AbstractJavaCodegen codegen = new P_AbstractJavaCodegen();\n        codegen.additionalProperties().put(AbstractJavaCodegen.ADDITIONAL_MODEL_TYPE_ANNOTATIONS, \"@Foo;@Bar\");\n        codegen.processOpts();\n        codegen.preprocessOpenAPI(openAPI);\n\n        Assert.assertEquals(codegen.additionalProperties().get(AbstractJavaCodegen.ADDITIONAL_MODEL_TYPE_ANNOTATIONS), \"@Foo;@Bar\");\n}\n\nAny idea ?", "author": "UnleashSpirit", "createdAt": "2020-12-30T13:25:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg0MjUyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTE3NDQ1Ng==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8269#discussion_r551174456", "bodyText": "Well, I add a getter for additionalModelTypeAnnotations to test the list easily", "author": "UnleashSpirit", "createdAt": "2021-01-04T08:29:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg0MjUyMA=="}], "type": "inlineReview"}, {"oid": "1b8133a2efab3ac3d4bd21582c433e2fc5cc4b74", "url": "https://github.com/OpenAPITools/openapi-generator/commit/1b8133a2efab3ac3d4bd21582c433e2fc5cc4b74", "message": "doc: update info additionalModelTypeAnnotations", "committedDate": "2021-01-04T17:20:23Z", "type": "forcePushed"}, {"oid": "b47bf5edff4a1cea4836b8a732efbbb5ff9b3e29", "url": "https://github.com/OpenAPITools/openapi-generator/commit/b47bf5edff4a1cea4836b8a732efbbb5ff9b3e29", "message": "doc: update info additionalModelTypeAnnotations", "committedDate": "2021-01-06T07:13:15Z", "type": "forcePushed"}, {"oid": "a9ecc7d06ed6862ffba8ab15773eb06a416ac864", "url": "https://github.com/OpenAPITools/openapi-generator/commit/a9ecc7d06ed6862ffba8ab15773eb06a416ac864", "message": "doc: update info additionalModelTypeAnnotations", "committedDate": "2021-01-06T14:47:32Z", "type": "forcePushed"}, {"oid": "76971dd7a036486483901139b89376f8c1583e72", "url": "https://github.com/OpenAPITools/openapi-generator/commit/76971dd7a036486483901139b89376f8c1583e72", "message": "refactor: move doc in code for autogen", "committedDate": "2021-01-22T11:28:29Z", "type": "forcePushed"}, {"oid": "0ea53faecdcb49d8eae17ff130fc91eb2f8081be", "url": "https://github.com/OpenAPITools/openapi-generator/commit/0ea53faecdcb49d8eae17ff130fc91eb2f8081be", "message": "refactor: add imports lost in rebase", "committedDate": "2021-05-17T07:30:56Z", "type": "forcePushed"}, {"oid": "4531a72063c54cf7e0c2b3536f817c8cf0470a35", "url": "https://github.com/OpenAPITools/openapi-generator/commit/4531a72063c54cf7e0c2b3536f817c8cf0470a35", "message": "docs: regenerate docs", "committedDate": "2021-05-20T06:14:13Z", "type": "forcePushed"}, {"oid": "62181960260f5f510fcdf0eaed322b4f5a66764b", "url": "https://github.com/OpenAPITools/openapi-generator/commit/62181960260f5f510fcdf0eaed322b4f5a66764b", "message": "docs: regenerate docs", "committedDate": "2021-05-25T08:03:04Z", "type": "forcePushed"}, {"oid": "0f4d348b213c1991f5ba77f0b5f44b8af84e0211", "url": "https://github.com/OpenAPITools/openapi-generator/commit/0f4d348b213c1991f5ba77f0b5f44b8af84e0211", "message": "docs: update", "committedDate": "2021-05-25T08:35:21Z", "type": "forcePushed"}, {"oid": "a8f7419801126614ca5e098d22880f3d15f75a83", "url": "https://github.com/OpenAPITools/openapi-generator/commit/a8f7419801126614ca5e098d22880f3d15f75a83", "message": "docs: update", "committedDate": "2021-05-28T10:01:33Z", "type": "forcePushed"}, {"oid": "cce8495d5b5c58f4d1e9054002bab1c3526df95d", "url": "https://github.com/OpenAPITools/openapi-generator/commit/cce8495d5b5c58f4d1e9054002bab1c3526df95d", "message": "refactor: improve additionalModelTypeAnnotations generation\n\nSplit by ';' and/or newline\nTrim value\n\nfix: #7032\n\nRun ./bin/generate-samples.sh to regenerate model files\n\nRevert \"Run ./bin/generate-samples.sh to regenerate model files\"\n\nThis reverts commit da509c39f363da046fbd457e1ab67ef0f62f3561.\n\nrefector: remove unnecessary import\n\ntest: multiples tests for AdditionalModelTypeAnnotations\n\nAdd a getter to test the list\n\nrefactor: remove duplicate AdditionalModelTypeAnnotations\n\nWithout using Set to avoid any side effect somewhere, I use stream and\ndistinct to avoid duplicates\n\nrefactor: using Set instead of stream\n\nRemove stream distinct for performance reason, use newHashSet\nKeep AdditionalModelTypeAnnotations as List\n\ndoc: update info additionalModelTypeAnnotations\n\nrefactor: move doc in code for autogen\n\nstyle: tab in java class\n\ndoc: run ensure-up-to-date\n\nrefactor: add imports lost in rebase\n\ndocs: regenerate docs\n\ndocs: update", "committedDate": "2021-06-03T15:36:07Z", "type": "forcePushed"}, {"oid": "711946db8d83d9c4645639571d42f2078b29464d", "url": "https://github.com/OpenAPITools/openapi-generator/commit/711946db8d83d9c4645639571d42f2078b29464d", "message": "refactor: improve additionalModelTypeAnnotations generation\n\nSplit by ';' and/or newline\nTrim value\n\nfix: #7032\n\nRun ./bin/generate-samples.sh to regenerate model files\n\nRevert \"Run ./bin/generate-samples.sh to regenerate model files\"\n\nThis reverts commit da509c39f363da046fbd457e1ab67ef0f62f3561.\n\nrefector: remove unnecessary import\n\ntest: multiples tests for AdditionalModelTypeAnnotations\n\nAdd a getter to test the list\n\nrefactor: remove duplicate AdditionalModelTypeAnnotations\n\nWithout using Set to avoid any side effect somewhere, I use stream and\ndistinct to avoid duplicates\n\nrefactor: using Set instead of stream\n\nRemove stream distinct for performance reason, use newHashSet\nKeep AdditionalModelTypeAnnotations as List\n\ndoc: update info additionalModelTypeAnnotations\n\nrefactor: move doc in code for autogen\n\nstyle: tab in java class\n\ndoc: run ensure-up-to-date\n\nrefactor: add imports lost in rebase\n\ndocs: regenerate docs\n\ndocs: update", "committedDate": "2021-06-17T06:15:13Z", "type": "forcePushed"}, {"oid": "3dcbef3d04786e84a0d37c49aea4828f413438ae", "url": "https://github.com/OpenAPITools/openapi-generator/commit/3dcbef3d04786e84a0d37c49aea4828f413438ae", "message": "refactor: improve additionalModelTypeAnnotations generation\n\nSplit by ';' and/or newline\nTrim value\n\nfix: #7032\n\nRun ./bin/generate-samples.sh to regenerate model files\n\nRevert \"Run ./bin/generate-samples.sh to regenerate model files\"\n\nThis reverts commit da509c39f363da046fbd457e1ab67ef0f62f3561.\n\nrefector: remove unnecessary import\n\ntest: multiples tests for AdditionalModelTypeAnnotations\n\nAdd a getter to test the list\n\nrefactor: remove duplicate AdditionalModelTypeAnnotations\n\nWithout using Set to avoid any side effect somewhere, I use stream and\ndistinct to avoid duplicates\n\nrefactor: using Set instead of stream\n\nRemove stream distinct for performance reason, use newHashSet\nKeep AdditionalModelTypeAnnotations as List\n\ndoc: update info additionalModelTypeAnnotations\n\nrefactor: move doc in code for autogen\n\nstyle: tab in java class\n\ndoc: run ensure-up-to-date\n\nrefactor: add imports lost in rebase\n\ndocs: regenerate docs\n\ndocs: update", "committedDate": "2021-07-16T08:16:47Z", "type": "forcePushed"}, {"oid": "f1c3b1f763a12d9bc8b1f090bc48abae182f1391", "url": "https://github.com/OpenAPITools/openapi-generator/commit/f1c3b1f763a12d9bc8b1f090bc48abae182f1391", "message": "refactor: improve additionalModelTypeAnnotations generation\n\nSplit by ';' and/or newline\nTrim value\n\nfix: #7032\n\nRun ./bin/generate-samples.sh to regenerate model files\n\nRevert \"Run ./bin/generate-samples.sh to regenerate model files\"\n\nThis reverts commit da509c39f363da046fbd457e1ab67ef0f62f3561.\n\nrefector: remove unnecessary import\n\ntest: multiples tests for AdditionalModelTypeAnnotations\n\nAdd a getter to test the list\n\nrefactor: remove duplicate AdditionalModelTypeAnnotations\n\nWithout using Set to avoid any side effect somewhere, I use stream and\ndistinct to avoid duplicates\n\nrefactor: using Set instead of stream\n\nRemove stream distinct for performance reason, use newHashSet\nKeep AdditionalModelTypeAnnotations as List\n\ndoc: update info additionalModelTypeAnnotations\n\nrefactor: move doc in code for autogen\n\nstyle: tab in java class\n\ndoc: run ensure-up-to-date\n\nrefactor: add imports lost in rebase\n\ndocs: regenerate docs\n\ndocs: update", "committedDate": "2021-08-17T07:31:25Z", "type": "commit"}, {"oid": "f1c3b1f763a12d9bc8b1f090bc48abae182f1391", "url": "https://github.com/OpenAPITools/openapi-generator/commit/f1c3b1f763a12d9bc8b1f090bc48abae182f1391", "message": "refactor: improve additionalModelTypeAnnotations generation\n\nSplit by ';' and/or newline\nTrim value\n\nfix: #7032\n\nRun ./bin/generate-samples.sh to regenerate model files\n\nRevert \"Run ./bin/generate-samples.sh to regenerate model files\"\n\nThis reverts commit da509c39f363da046fbd457e1ab67ef0f62f3561.\n\nrefector: remove unnecessary import\n\ntest: multiples tests for AdditionalModelTypeAnnotations\n\nAdd a getter to test the list\n\nrefactor: remove duplicate AdditionalModelTypeAnnotations\n\nWithout using Set to avoid any side effect somewhere, I use stream and\ndistinct to avoid duplicates\n\nrefactor: using Set instead of stream\n\nRemove stream distinct for performance reason, use newHashSet\nKeep AdditionalModelTypeAnnotations as List\n\ndoc: update info additionalModelTypeAnnotations\n\nrefactor: move doc in code for autogen\n\nstyle: tab in java class\n\ndoc: run ensure-up-to-date\n\nrefactor: add imports lost in rebase\n\ndocs: regenerate docs\n\ndocs: update", "committedDate": "2021-08-17T07:31:25Z", "type": "forcePushed"}, {"oid": "bb0e43863c2101a3baede01dd8e41656ab526014", "url": "https://github.com/OpenAPITools/openapi-generator/commit/bb0e43863c2101a3baede01dd8e41656ab526014", "message": "fix: docs", "committedDate": "2021-08-17T09:27:04Z", "type": "commit"}]}