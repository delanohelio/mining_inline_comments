{"pr_number": 5837, "pr_title": "C client generator improvements to support petstore", "pr_createdAt": "2020-04-06T04:46:43Z", "pr_url": "https://github.com/OpenAPITools/openapi-generator/pull/5837", "timeline": [{"oid": "8514ae6354f4a3492f43b045c0e0447597362323", "url": "https://github.com/OpenAPITools/openapi-generator/commit/8514ae6354f4a3492f43b045c0e0447597362323", "message": "C client generator improvement to support:\nopenapi-generator/modules/openapi-generator/src/test/resources/3_0/petstore.yaml", "committedDate": "2020-04-06T04:36:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2ODgxMA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5837#discussion_r403868810", "bodyText": "Why this fake encode/decode is needed ?  If uses do not define -DOPENSSL, but use the function base64decode or base64encode ,  they will not get the result that they want.\nI think if the users want to use the function base64decode or base64encode defined by openapi-generator/c-libcurl , they must define -DOPENSSL in CMakefile.", "author": "ityuhui", "createdAt": "2020-04-06T07:02:42Z", "path": "modules/openapi-generator/src/main/resources/C-libcurl/apiClient.c.mustache", "diffHunk": "@@ -632,7 +632,12 @@ char *base64encode (const void *b64_encode_this, int encode_this_many_bytes){\n     BUF_MEM_grow(mem_bio_mem_ptr, (*mem_bio_mem_ptr).length + 1);   //Makes space for end null.\n     (*mem_bio_mem_ptr).data[(*mem_bio_mem_ptr).length] = '\\0';  //Adds null-terminator to tail.\n     return (*mem_bio_mem_ptr).data; //Returns base-64 encoded data. (See: \"buf_mem_st\" struct).\n-#endif\n+#else // OPENSSL\n+    char* ret = malloc(encode_this_many_bytes);\n+    memcpy(ret, b64_encode_this, encode_this_many_bytes-1);\n+    ret[encode_this_many_bytes] = 0;\n+    return ret;\n+#endif // OPENSSL\n }", "originalCommit": "8514ae6354f4a3492f43b045c0e0447597362323", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkwNzQwNQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5837#discussion_r403907405", "bodyText": "I didn't get it. What if -DOPENSSL is not defined? What do you intend to happen in that case? I didn't have it defined, and the function \"returned\" without issuing a return statement.", "author": "michelealbano", "createdAt": "2020-04-06T08:17:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2ODgxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkyMDU1NQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5837#discussion_r403920555", "bodyText": "e.g.\nIf uses do not define -DOPENSSL, but use the function base64encode, the returned char * is still equal to the original string, not a base64 encoded string.", "author": "ityuhui", "createdAt": "2020-04-06T08:39:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2ODgxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkyMTMzNg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5837#discussion_r403921336", "bodyText": "I thought that was idea, and that's the code I implemented. The original code did nothing (not even return a buffer).", "author": "michelealbano", "createdAt": "2020-04-06T08:40:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2ODgxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkzMTgwMA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5837#discussion_r403931800", "bodyText": "Yes. I know.\nSo I suggest adding a warning message here if this code is needed:\ne.g.\n#else // OPENSSL\n    fprintf(stderr, \"The data will not be decoded. If you want to use this function, please define \\\"-DOPENSSL\\\" when building.\\n\");\n    char* ret = malloc(decode_this_many_bytes);\n    memcpy(ret, b64_decode_this, decode_this_many_bytes-1);\n    ret[decode_this_many_bytes] = 0;\n   *decoded_bytes = decode_this_many_bytes;\n    return ret;\n#endif // OPENSSL", "author": "ityuhui", "createdAt": "2020-04-06T08:57:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2ODgxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkzODUxMw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5837#discussion_r403938513", "bodyText": "ok, will do that", "author": "michelealbano", "createdAt": "2020-04-06T09:07:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2ODgxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzk0MjEyOQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5837#discussion_r403942129", "bodyText": "Message proposal:\nThe data will not be encoded. If you want to use this function \"base64encode\", please define \"-DOPENSSL\" when building the library.\nThe base64 data will not be decoded. If you want to use this function, \"base64decode\", please define \"-DOPENSSL\" when building the library.", "author": "ityuhui", "createdAt": "2020-04-06T09:13:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2ODgxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzk0NDQ3Ng==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5837#discussion_r403944476", "bodyText": "I would suggest returning NULL so the whole API call exits with an error.  this is because we use strlen to get the length of the data when we add data to curl handle. This will break if the data has binary(may include null termination). So for a safer side, I would suggest to return NULL or mandate OpenSSL installation as a prerequisite.\nAlso if the server is expecting a base64 encoded string then we cannot send unencoded data.", "author": "zhemant", "createdAt": "2020-04-06T09:17:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2ODgxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzk0ODMxMw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5837#discussion_r403948313", "bodyText": "What if I don't have OpenSSL, and I just want to generate unencrypted APIs?", "author": "michelealbano", "createdAt": "2020-04-06T09:23:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2ODgxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzk1MTI3Ng==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5837#discussion_r403951276", "bodyText": "If you don't have OpenSSL then you cannot send or receive binary data.\nAlso, I didn't get what you mean by unencrypted API? Because OpenSSL is used only for encoding binary data. It is not used for encryption.", "author": "zhemant", "createdAt": "2020-04-06T09:28:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2ODgxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzk2Mzg2Mg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5837#discussion_r403963862", "bodyText": "Ok.", "author": "michelealbano", "createdAt": "2020-04-06T09:48:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2ODgxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA2NDc1MQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5837#discussion_r404064751", "bodyText": "I updated also CMakeLists.txt, but I am not an expert on cmake.", "author": "michelealbano", "createdAt": "2020-04-06T12:50:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2ODgxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2OTMxOA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5837#discussion_r403869318", "bodyText": "The two functions base64encode or base64decode are declarated in apiClient.h\nSo why are they needed here ?", "author": "ityuhui", "createdAt": "2020-04-06T07:03:48Z", "path": "modules/openapi-generator/src/main/resources/C-libcurl/model-header.mustache", "diffHunk": "@@ -11,6 +11,11 @@\n #include \"../external/cJSON.h\"\n #include \"../include/list.h\"\n #include \"../include/keyValuePair.h\"\n+#include \"../include/binary.h\"\n+\n+char *base64encode(const void *b64_encode_this, int encode_this_many_bytes);\n+\n+char *base64decode(const void *b64_decode_this, int decode_this_many_bytes, int *decoded_bytes);\n ", "originalCommit": "8514ae6354f4a3492f43b045c0e0447597362323", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkwODQzNA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5837#discussion_r403908434", "bodyText": "Because I don't #include apiClient.h everywhere. I am actually considering to move base64* to binary.h / binary.c", "author": "michelealbano", "createdAt": "2020-04-06T08:18:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2OTMxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkxNjU4NA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5837#discussion_r403916584", "bodyText": "OK. I got it.\nBut users may want to use these 2 functions , but they do not want to include \"binary.h\"\nSo I suggest keeping the definition and decalration of the base64* functions in apiClient.h|c, but add the declarations to binary.h\nMoving to binary.h/binary.c is also acceptable for me.", "author": "ityuhui", "createdAt": "2020-04-06T08:32:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2OTMxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkyMTY4Nw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5837#discussion_r403921687", "bodyText": "ok", "author": "michelealbano", "createdAt": "2020-04-06T08:41:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2OTMxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkyMzMxNg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5837#discussion_r403923316", "bodyText": "Moving to binary.h/binary.c is also acceptable for me.", "author": "ityuhui", "createdAt": "2020-04-06T08:43:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2OTMxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkyNDA4Nw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5837#discussion_r403924087", "bodyText": "@michelealbano you dont need to include apiClient.h any where. You just need to import the main api's api.h this will import all the models required and supporting files for that API", "author": "zhemant", "createdAt": "2020-04-06T08:44:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2OTMxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkyNDMxMQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5837#discussion_r403924311", "bodyText": "Thinking about it, I will move them to binary.h/binary.c. I #include \"../include/binary.h\" in apiClient.h, thus the functions are available to whoever includes apiClient.h.", "author": "michelealbano", "createdAt": "2020-04-06T08:45:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2OTMxOA=="}], "type": "inlineReview"}, {"oid": "f4a3717d579ae2d26b4ef49de339efb14e66696d", "url": "https://github.com/OpenAPITools/openapi-generator/commit/f4a3717d579ae2d26b4ef49de339efb14e66696d", "message": "Improvements to the C client generator:\n- moved base64* from apiClient.c to binary.h/binary.c\n- changed CR/LF to LF in binary.h/binary.c", "committedDate": "2020-04-06T09:24:21Z", "type": "commit"}, {"oid": "e05af82d3aeaf30a051b3d7618841d6f6cd9da8e", "url": "https://github.com/OpenAPITools/openapi-generator/commit/e05af82d3aeaf30a051b3d7618841d6f6cd9da8e", "message": "C client generator: better support for base64encode / base64decode", "committedDate": "2020-04-06T13:00:08Z", "type": "commit"}]}