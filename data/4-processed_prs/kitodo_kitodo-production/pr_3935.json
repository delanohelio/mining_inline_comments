{"pr_number": 3935, "pr_title": "Fix several folder issues", "pr_createdAt": "2020-08-13T08:01:50Z", "pr_url": "https://github.com/kitodo/kitodo-production/pull/3935", "timeline": [{"oid": "d6f1be81aa7e51c360e727ab2ea866030fd343ef", "url": "https://github.com/kitodo/kitodo-production/commit/d6f1be81aa7e51c360e727ab2ea866030fd343ef", "message": "Implement hashCode() and equals() based on the business key\n\nSee https://docs.jboss.org/hibernate/stable/core.old/reference/en/html/persistent-classes-equalshashcode.html", "committedDate": "2020-08-13T07:59:22Z", "type": "commit"}, {"oid": "ff0d3e020e19e010924da9e6bc68a024f1ab6a05", "url": "https://github.com/kitodo/kitodo-production/commit/ff0d3e020e19e010924da9e6bc68a024f1ab6a05", "message": "Prevent changing the file group once entered", "committedDate": "2020-08-13T07:59:24Z", "type": "commit"}, {"oid": "b0762c4d7fcec10a8741325d1f8bedebf60537b8", "url": "https://github.com/kitodo/kitodo-production/commit/b0762c4d7fcec10a8741325d1f8bedebf60537b8", "message": "Prevent a new folder entry from being duplicated\n\nFixes #3187, #3731, #3775", "committedDate": "2020-08-13T07:59:26Z", "type": "commit"}, {"oid": "905a4907a93db1ab83f00a03a7bdc093943a46cd", "url": "https://github.com/kitodo/kitodo-production/commit/905a4907a93db1ab83f00a03a7bdc093943a46cd", "message": "Address the folders via their file group\n\nFixes #3340", "committedDate": "2020-08-13T07:59:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTgxMjAzNQ==", "url": "https://github.com/kitodo/kitodo-production/pull/3935#discussion_r469812035", "bodyText": "You are throwing an Exception to the frontend, this will lead to the error page. Please handle the \"else\" different. Maybe just don't set the fileGroup for now.", "author": "Kathrin-Huber", "createdAt": "2020-08-13T09:13:36Z", "path": "Kitodo-DataManagement/src/main/java/org/kitodo/data/database/beans/Folder.java", "diffHunk": "@@ -388,13 +391,21 @@ public void setDpi(Integer dpi) {\n     }\n \n     /**\n-     * Sets the file group of the folder.\n+     * Sets the file group of the folder. The file group is the business key of\n+     * the folder and may therefore only be set if the object is not yet\n+     * persisted ({@code id} is null) or the object is being created\n+     * ({@code fileGroup} is null).\n      *\n      * @param fileGroup\n      *            file group to set\n      */\n     public void setFileGroup(String fileGroup) {\n-        this.fileGroup = fileGroup;\n+        if (fileGroup.equals(this.fileGroup) || Objects.isNull(this.fileGroup) || Objects.isNull(id)) {", "originalCommit": "905a4907a93db1ab83f00a03a7bdc093943a46cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTgzMTM4NQ==", "url": "https://github.com/kitodo/kitodo-production/pull/3935#discussion_r469831385", "bodyText": "I don't like this suggestion. This is an unchecked exception. Unchecked exceptions should be thrown if there is a programming error. At the moment this exception is never thrown because our program behaves correctly. It would be thrown if someone programmed something new and used the object incorrectly. That was the reason why I programmed it that way. Simply not setting the filegroup would lead to data loss and, as a consequence, to behavior that is difficult to understand. I find that awkward. If you do not agree with this, it would be better not to check here at all. If someone changes the value and doesn't know what he's doing, it's his own fault then.", "author": "matthias-ronge", "createdAt": "2020-08-13T09:46:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTgxMjAzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDU1MDQ3MA==", "url": "https://github.com/kitodo/kitodo-production/pull/3935#discussion_r470550470", "bodyText": "so don't check at all", "author": "Kathrin-Huber", "createdAt": "2020-08-14T10:42:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTgxMjAzNQ=="}], "type": "inlineReview"}, {"oid": "5f9d6f449acd9c8219fe864d712cac18db20c565", "url": "https://github.com/kitodo/kitodo-production/commit/5f9d6f449acd9c8219fe864d712cac18db20c565", "message": "Remove business key invariance check", "committedDate": "2020-08-17T12:48:35Z", "type": "commit"}]}