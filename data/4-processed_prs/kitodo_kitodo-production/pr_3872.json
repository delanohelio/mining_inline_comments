{"pr_number": 3872, "pr_title": "Prevent NumberFormatException in task filter", "pr_createdAt": "2020-07-29T08:54:42Z", "pr_url": "https://github.com/kitodo/kitodo-production/pull/3872", "timeline": [{"oid": "13613721ea4b9417f59090e911919603fc03925e", "url": "https://github.com/kitodo/kitodo-production/commit/13613721ea4b9417f59090e911919603fc03925e", "message": "Prevent NumberFormatException when entering filter values with leading or trailing whitespaces in task filter", "committedDate": "2020-07-29T08:53:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjE0ODcxOA==", "url": "https://github.com/kitodo/kitodo-production/pull/3872#discussion_r462148718", "bodyText": "parseInt is throwing an NumberFormatException if tempId does not contain a parsable integer. See https://docs.oracle.com/javase/8/docs/api/java/lang/Integer.html#parseInt-java.lang.String-\nMaybe you should catch this exception and do not add this value to the list in this case?", "author": "henning-gerhardt", "createdAt": "2020-07-29T09:00:56Z", "path": "Kitodo/src/main/java/org/kitodo/production/services/data/FilterService.java", "diffHunk": "@@ -837,8 +837,10 @@ private QueryBuilder filterAutomaticTasks(String filter, ObjectType objectType)\n         Set<Integer> ids = new HashSet<>();\n         List<String> stringIds = getFilterValuesFromFilterString(filter, filterString);\n         for (String tempId : stringIds) {\n-            Integer id = Integer.parseInt(tempId);\n-            ids.add(id);\n+            if (!tempId.isEmpty()) {\n+                Integer id = Integer.parseInt(tempId);", "originalCommit": "13613721ea4b9417f59090e911919603fc03925e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjE1OTQxOA==", "url": "https://github.com/kitodo/kitodo-production/pull/3872#discussion_r462159418", "bodyText": "AFAIK in Java the idiom of \"look before you leap\" is preferred over willingly risking and catching exceptions, which would probably be a more \"pythonic\" way to deal with exceptions (see https://docs.python.org/3.5/glossary.html#term-eafp).\nSo I guess you are right that different potential reasons for NumberFormatExceptions should be prevented, but I would prefer doing that by explicitly testing whether a String is numeric or not instead of willingly provoking an Exception in Java.\nPlease check if you can agree with my updated changes.", "author": "solth", "createdAt": "2020-07-29T09:18:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjE0ODcxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjE2Nzk5Ng==", "url": "https://github.com/kitodo/kitodo-production/pull/3872#discussion_r462167996", "bodyText": "Your last change (from !tempId.isEmpty() to !tempId.isEmpty() && StringUtils.isNumeric(tempId)) is ok for me.", "author": "henning-gerhardt", "createdAt": "2020-07-29T09:33:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjE0ODcxOA=="}], "type": "inlineReview"}, {"oid": "f7afc6a22b5f06f1fd27e81c93317f06b2d19b5f", "url": "https://github.com/kitodo/kitodo-production/commit/f7afc6a22b5f06f1fd27e81c93317f06b2d19b5f", "message": "Add explicit check whether non-empty filter string is numeric or not", "committedDate": "2020-07-29T09:18:33Z", "type": "commit"}]}