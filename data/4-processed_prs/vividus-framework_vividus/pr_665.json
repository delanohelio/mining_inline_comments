{"pr_number": 665, "pr_title": "Add known issues into categories in Allure report", "pr_createdAt": "2020-06-11T14:13:51Z", "pr_url": "https://github.com/vividus-framework/vividus/pull/665", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgyNTAyMQ==", "url": "https://github.com/vividus-framework/vividus/pull/665#discussion_r438825021", "bodyText": "since writeExecutorInfo creates ObjectMapper as well and ObjectMapper is thread-safe, I propose\n\nto create a new field: ObjectMapper obejctMapper\nto use it in both writeCategoriesInfo and writeExecutorInfo", "author": "valfirst", "createdAt": "2020-06-11T14:23:53Z", "path": "vividus-allure-adaptor/src/main/java/org/vividus/bdd/report/allure/AllureReportGenerator.java", "diffHunk": "@@ -111,6 +116,20 @@ private void generateReport()\n         LOGGER.info(\"Allure report is successfully generated at: {}\", reportDirectory.getAbsolutePath());\n     }\n \n+    private void writeCategoriesInfo() throws IOException\n+    {\n+        List<AllureCategory> categories = Arrays.asList(\n+                new AllureCategory(\"Test defects\", Collections.singletonList(Status.BROKEN)),\n+                new AllureCategory(\"Product defects\", Collections.singletonList(Status.FAILED)),\n+                new AllureCategory(\"Known issue\", Collections.singletonList(Status.UNKNOWN)));\n+\n+        try (BufferedWriter writer = Files.newBufferedWriter(resultsDirectory.toPath().resolve(\"categories.json\")))\n+        {\n+            ObjectMapper objectMapper = new ObjectMapper();", "originalCommit": "3e42d46369f57b6489accdebf023b4f38bce25f0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgyNjIyMg==", "url": "https://github.com/vividus-framework/vividus/pull/665#discussion_r438826222", "bodyText": "this logic of writing the data to the file is very similar to the logic from writeExecutorInfo so I propose to move the common part to a new method and reuse it", "author": "valfirst", "createdAt": "2020-06-11T14:25:36Z", "path": "vividus-allure-adaptor/src/main/java/org/vividus/bdd/report/allure/AllureReportGenerator.java", "diffHunk": "@@ -111,6 +116,20 @@ private void generateReport()\n         LOGGER.info(\"Allure report is successfully generated at: {}\", reportDirectory.getAbsolutePath());\n     }\n \n+    private void writeCategoriesInfo() throws IOException\n+    {\n+        List<AllureCategory> categories = Arrays.asList(\n+                new AllureCategory(\"Test defects\", Collections.singletonList(Status.BROKEN)),\n+                new AllureCategory(\"Product defects\", Collections.singletonList(Status.FAILED)),\n+                new AllureCategory(\"Known issue\", Collections.singletonList(Status.UNKNOWN)));\n+\n+        try (BufferedWriter writer = Files.newBufferedWriter(resultsDirectory.toPath().resolve(\"categories.json\")))", "originalCommit": "3e42d46369f57b6489accdebf023b4f38bce25f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTAwMjEyMQ==", "url": "https://github.com/vividus-framework/vividus/pull/665#discussion_r439002121", "bodyText": "Then we don't need to create ObjectMapper obejctMapper field?", "author": "ngrudnitsky", "createdAt": "2020-06-11T18:54:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgyNjIyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTAyNzg2Ng==", "url": "https://github.com/vividus-framework/vividus/pull/665#discussion_r439027866", "bodyText": "you can create ObjectMapper field or variable, the key is to create it once and reuse (do not create it in the method invoked twice)", "author": "valfirst", "createdAt": "2020-06-11T19:45:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgyNjIyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgyNjQyOQ==", "url": "https://github.com/vividus-framework/vividus/pull/665#discussion_r438826429", "bodyText": "Collections.singletonList -> List.of ?", "author": "valfirst", "createdAt": "2020-06-11T14:25:52Z", "path": "vividus-allure-adaptor/src/main/java/org/vividus/bdd/report/allure/AllureReportGenerator.java", "diffHunk": "@@ -111,6 +116,20 @@ private void generateReport()\n         LOGGER.info(\"Allure report is successfully generated at: {}\", reportDirectory.getAbsolutePath());\n     }\n \n+    private void writeCategoriesInfo() throws IOException\n+    {\n+        List<AllureCategory> categories = Arrays.asList(\n+                new AllureCategory(\"Test defects\", Collections.singletonList(Status.BROKEN)),\n+                new AllureCategory(\"Product defects\", Collections.singletonList(Status.FAILED)),\n+                new AllureCategory(\"Known issue\", Collections.singletonList(Status.UNKNOWN)));", "originalCommit": "3e42d46369f57b6489accdebf023b4f38bce25f0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgyNjYwOQ==", "url": "https://github.com/vividus-framework/vividus/pull/665#discussion_r438826609", "bodyText": "Arrays.asList -> List.of ?", "author": "valfirst", "createdAt": "2020-06-11T14:26:06Z", "path": "vividus-allure-adaptor/src/main/java/org/vividus/bdd/report/allure/AllureReportGenerator.java", "diffHunk": "@@ -111,6 +116,20 @@ private void generateReport()\n         LOGGER.info(\"Allure report is successfully generated at: {}\", reportDirectory.getAbsolutePath());\n     }\n \n+    private void writeCategoriesInfo() throws IOException\n+    {\n+        List<AllureCategory> categories = Arrays.asList(", "originalCommit": "3e42d46369f57b6489accdebf023b4f38bce25f0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "15a53ed354096a00cd8803c294f31614a9da6ac4", "url": "https://github.com/vividus-framework/vividus/commit/15a53ed354096a00cd8803c294f31614a9da6ac4", "message": "Add known issues into categories in Allure report", "committedDate": "2020-06-11T18:58:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTAzNjQ1Mg==", "url": "https://github.com/vividus-framework/vividus/pull/665#discussion_r439036452", "bodyText": "private void createJsonFileInResultsDirectory(ObjectMapper objectMapper, String fileName, Object content) throws IOException\n{\n    try (BufferedWriter writer = Files.newBufferedWriter(resultsDirectory.toPath().resolve(fileName)))\n    {\n        objectMapper.writeValue(writer, content);\n    }\n}", "author": "valfirst", "createdAt": "2020-06-11T20:03:04Z", "path": "vividus-allure-adaptor/src/main/java/org/vividus/bdd/report/allure/AllureReportGenerator.java", "diffHunk": "@@ -111,16 +115,29 @@ private void generateReport()\n         LOGGER.info(\"Allure report is successfully generated at: {}\", reportDirectory.getAbsolutePath());\n     }\n \n-    private void writeExecutorInfo() throws IOException\n+    private void writeCategoriesInfo() throws IOException\n     {\n-        ExecutorInfo executorInfo = propertyMapper.readValue(\"allure.executor.\", ExecutorInfo.class);\n+        List<AllureCategory> categories = List.of(\n+                new AllureCategory(\"Test defects\", List.of(Status.BROKEN)),\n+                new AllureCategory(\"Product defects\", List.of(Status.FAILED)),\n+                new AllureCategory(\"Known issue\", List.of(Status.UNKNOWN)));\n+        writeJsonToFile(resultsDirectory.toPath().resolve(\"categories.json\"), categories);\n+    }\n \n-        try (BufferedWriter writer = Files.newBufferedWriter(resultsDirectory.toPath().resolve(\"executor.json\")))\n+    private void writeJsonToFile(Path path, Object value) throws IOException\n+    {\n+        try (BufferedWriter writer = Files.newBufferedWriter(path))\n         {\n-            new ObjectMapper().writeValue(writer, executorInfo);\n+            new ObjectMapper().writeValue(writer, value);\n         }\n     }", "originalCommit": "15a53ed354096a00cd8803c294f31614a9da6ac4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4d1ac488ee6e62a263df1214d447715592e64876", "url": "https://github.com/vividus-framework/vividus/commit/4d1ac488ee6e62a263df1214d447715592e64876", "message": "Add known issues into categories in Allure report", "committedDate": "2020-06-12T07:32:14Z", "type": "forcePushed"}, {"oid": "6322f49bf4c0ecd0721747a8ae019f908260a76d", "url": "https://github.com/vividus-framework/vividus/commit/6322f49bf4c0ecd0721747a8ae019f908260a76d", "message": "Add known issues into categories in Allure report", "committedDate": "2020-06-12T07:43:19Z", "type": "forcePushed"}, {"oid": "f760255bc6c83c70ef5735d4a87e37ab150767ae", "url": "https://github.com/vividus-framework/vividus/commit/f760255bc6c83c70ef5735d4a87e37ab150767ae", "message": "Add known issues into categories in Allure report", "committedDate": "2020-06-12T07:56:26Z", "type": "forcePushed"}, {"oid": "b72f84e3ac28bcbf37f8ab527be8ad922c5a8839", "url": "https://github.com/vividus-framework/vividus/commit/b72f84e3ac28bcbf37f8ab527be8ad922c5a8839", "message": "Add known issues into categories in Allure report", "committedDate": "2020-06-12T08:08:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMwNjI2Mg==", "url": "https://github.com/vividus-framework/vividus/pull/665#discussion_r439306262", "bodyText": "as you decided to make ObjectMapper a field of class, there is no reason to pass it as input parameter to the method of the same class", "author": "valfirst", "createdAt": "2020-06-12T09:17:57Z", "path": "vividus-allure-adaptor/src/main/java/org/vividus/bdd/report/allure/AllureReportGenerator.java", "diffHunk": "@@ -111,16 +115,30 @@ private void generateReport()\n         LOGGER.info(\"Allure report is successfully generated at: {}\", reportDirectory.getAbsolutePath());\n     }\n \n-    private void writeExecutorInfo() throws IOException\n+    private void writeCategoriesInfo() throws IOException\n     {\n-        ExecutorInfo executorInfo = propertyMapper.readValue(\"allure.executor.\", ExecutorInfo.class);\n+        List<AllureCategory> categories = List.of(\n+                new AllureCategory(\"Test defects\", List.of(Status.BROKEN)),\n+                new AllureCategory(\"Product defects\", List.of(Status.FAILED)),\n+                new AllureCategory(\"Known issue\", List.of(Status.UNKNOWN)));\n+        createJsonFileInResultsDirectory(objectMapper, \"categories.json\", categories);\n+    }\n \n-        try (BufferedWriter writer = Files.newBufferedWriter(resultsDirectory.toPath().resolve(\"executor.json\")))\n+    private void createJsonFileInResultsDirectory(ObjectMapper objectMapper, String fileName, Object content)", "originalCommit": "b72f84e3ac28bcbf37f8ab527be8ad922c5a8839", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c74a9d776fe980d68bfe1cd823e603c3d35cf046", "url": "https://github.com/vividus-framework/vividus/commit/c74a9d776fe980d68bfe1cd823e603c3d35cf046", "message": "Add known issues into categories in Allure report", "committedDate": "2020-06-12T09:22:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM0NTM0Mw==", "url": "https://github.com/vividus-framework/vividus/pull/665#discussion_r439345343", "bodyText": "I believe you need to add validations to unit tests to be sure, that categories.json is generated", "author": "valfirst", "createdAt": "2020-06-12T10:45:30Z", "path": "vividus-allure-adaptor/src/main/java/org/vividus/bdd/report/allure/AllureReportGenerator.java", "diffHunk": "@@ -111,16 +115,29 @@ private void generateReport()\n         LOGGER.info(\"Allure report is successfully generated at: {}\", reportDirectory.getAbsolutePath());\n     }\n \n-    private void writeExecutorInfo() throws IOException\n+    private void writeCategoriesInfo() throws IOException", "originalCommit": "c74a9d776fe980d68bfe1cd823e603c3d35cf046", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b28953be11fd5dcefa309fdfd1573ed46be1c551", "url": "https://github.com/vividus-framework/vividus/commit/b28953be11fd5dcefa309fdfd1573ed46be1c551", "message": "Add known issues into categories in Allure report", "committedDate": "2020-06-14T11:19:18Z", "type": "forcePushed"}, {"oid": "491bf085b79822ce0125379c8f7316a59415caca", "url": "https://github.com/vividus-framework/vividus/commit/491bf085b79822ce0125379c8f7316a59415caca", "message": "Add known issues into categories in Allure report", "committedDate": "2020-06-14T11:32:14Z", "type": "commit"}, {"oid": "491bf085b79822ce0125379c8f7316a59415caca", "url": "https://github.com/vividus-framework/vividus/commit/491bf085b79822ce0125379c8f7316a59415caca", "message": "Add known issues into categories in Allure report", "committedDate": "2020-06-14T11:32:14Z", "type": "forcePushed"}]}