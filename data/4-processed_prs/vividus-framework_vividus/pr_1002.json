{"pr_number": 1002, "pr_title": "[vividus] Add while-like step", "pr_createdAt": "2020-10-08T15:17:52Z", "pr_url": "https://github.com/vividus-framework/vividus/pull/1002", "timeline": [{"oid": "871959bfe0bfb92d0085285450c0038b92f4d87c", "url": "https://github.com/vividus-framework/vividus/commit/871959bfe0bfb92d0085285450c0038b92f4d87c", "message": "[vividus] Add while-like step", "committedDate": "2020-10-08T15:19:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgwNjk0Mw==", "url": "https://github.com/vividus-framework/vividus/pull/1002#discussion_r501806943", "bodyText": "lets move it outside commons", "author": "valfirst", "createdAt": "2020-10-08T15:20:57Z", "path": "docs/modules/commons/nav.adoc", "diffHunk": "@@ -1,3 +1,4 @@\n-.Tests development\n+.Commons\n+* xref:vividus-steps.adoc[Steps]\n * xref:tests-configuration.adoc[Tests Configuration]", "originalCommit": "871959bfe0bfb92d0085285450c0038b92f4d87c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgwNzMwNw==", "url": "https://github.com/vividus-framework/vividus/pull/1002#discussion_r501807307", "bodyText": "that are delivered", "author": "valfirst", "createdAt": "2020-10-08T15:21:26Z", "path": "docs/modules/commons/pages/vividus-steps.adoc", "diffHunk": "@@ -0,0 +1,44 @@\n+= Steps available out of the box\n+\n+Here one could find description of the steps that delivered with Vividus itself without any plugins required.", "originalCommit": "871959bfe0bfb92d0085285450c0038b92f4d87c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgwNzU4OA==", "url": "https://github.com/vividus-framework/vividus/pull/1002#discussion_r501807588", "bodyText": "while -> until", "author": "valfirst", "createdAt": "2020-10-08T15:21:50Z", "path": "docs/modules/commons/pages/vividus-steps.adoc", "diffHunk": "@@ -0,0 +1,44 @@\n+= Steps available out of the box\n+\n+Here one could find description of the steps that delivered with Vividus itself without any plugins required.\n+\n+=== While-like steps executor\n+\n+==== *_Info_*\n+\n+Executes steps while condition or iteration limit reached.", "originalCommit": "871959bfe0bfb92d0085285450c0038b92f4d87c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgwNzkwMg==", "url": "https://github.com/vividus-framework/vividus/pull/1002#discussion_r501807902", "bodyText": "is reached", "author": "valfirst", "createdAt": "2020-10-08T15:22:14Z", "path": "docs/modules/commons/pages/vividus-steps.adoc", "diffHunk": "@@ -0,0 +1,44 @@\n+= Steps available out of the box\n+\n+Here one could find description of the steps that delivered with Vividus itself without any plugins required.\n+\n+=== While-like steps executor\n+\n+==== *_Info_*\n+\n+Executes steps while condition or iteration limit reached.\n+\n+[IMPORTANT]\n+If iteration limit reached no failure or exception will happen", "originalCommit": "871959bfe0bfb92d0085285450c0038b92f4d87c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgwODIxNw==", "url": "https://github.com/vividus-framework/vividus/pull/1002#discussion_r501808217", "bodyText": "happen -> occur", "author": "valfirst", "createdAt": "2020-10-08T15:22:40Z", "path": "docs/modules/commons/pages/vividus-steps.adoc", "diffHunk": "@@ -0,0 +1,44 @@\n+= Steps available out of the box\n+\n+Here one could find description of the steps that delivered with Vividus itself without any plugins required.\n+\n+=== While-like steps executor\n+\n+==== *_Info_*\n+\n+Executes steps while condition or iteration limit reached.\n+\n+[IMPORTANT]\n+If iteration limit reached no failure or exception will happen", "originalCommit": "871959bfe0bfb92d0085285450c0038b92f4d87c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgwODU1Ng==", "url": "https://github.com/vividus-framework/vividus/pull/1002#discussion_r501808556", "bodyText": "please elaborate", "author": "valfirst", "createdAt": "2020-10-08T15:23:06Z", "path": "docs/modules/commons/pages/vividus-steps.adoc", "diffHunk": "@@ -0,0 +1,44 @@\n+= Steps available out of the box\n+\n+Here one could find description of the steps that delivered with Vividus itself without any plugins required.\n+\n+=== While-like steps executor\n+\n+==== *_Info_*\n+\n+Executes steps while condition or iteration limit reached.\n+\n+[IMPORTANT]\n+If iteration limit reached no failure or exception will happen\n+\n+==== *_Wording_*\n+\n+[source,gherkin]\n+----\n+When I execute steps at most $max times while `$variableName` is $comparisonRule `$expectedValue`:$stepsToExecute\n+----\n+\n+==== *_Parameters_*\n+\n+. `$max` - iterations", "originalCommit": "871959bfe0bfb92d0085285450c0038b92f4d87c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgwOTQyMg==", "url": "https://github.com/vividus-framework/vividus/pull/1002#discussion_r501809422", "bodyText": "... while variable '$name' is $comparisonRule...\n\nlets make variable reference more explicit", "author": "valfirst", "createdAt": "2020-10-08T15:24:15Z", "path": "docs/modules/commons/pages/vividus-steps.adoc", "diffHunk": "@@ -0,0 +1,44 @@\n+= Steps available out of the box\n+\n+Here one could find description of the steps that delivered with Vividus itself without any plugins required.\n+\n+=== While-like steps executor\n+\n+==== *_Info_*\n+\n+Executes steps while condition or iteration limit reached.\n+\n+[IMPORTANT]\n+If iteration limit reached no failure or exception will happen\n+\n+==== *_Wording_*\n+\n+[source,gherkin]\n+----\n+When I execute steps at most $max times while `$variableName` is $comparisonRule `$expectedValue`:$stepsToExecute", "originalCommit": "871959bfe0bfb92d0085285450c0038b92f4d87c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI1NDM3OQ==", "url": "https://github.com/vividus-framework/vividus/pull/1002#discussion_r502254379", "bodyText": "@ikalinin1 \u261d\ufe0f", "author": "valfirst", "createdAt": "2020-10-09T07:59:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgwOTQyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgxMDA2Ng==", "url": "https://github.com/vividus-framework/vividus/pull/1002#discussion_r501810066", "bodyText": "a name of the variable to check", "author": "valfirst", "createdAt": "2020-10-08T15:25:03Z", "path": "docs/modules/commons/pages/vividus-steps.adoc", "diffHunk": "@@ -0,0 +1,44 @@\n+= Steps available out of the box\n+\n+Here one could find description of the steps that delivered with Vividus itself without any plugins required.\n+\n+=== While-like steps executor\n+\n+==== *_Info_*\n+\n+Executes steps while condition or iteration limit reached.\n+\n+[IMPORTANT]\n+If iteration limit reached no failure or exception will happen\n+\n+==== *_Wording_*\n+\n+[source,gherkin]\n+----\n+When I execute steps at most $max times while `$variableName` is $comparisonRule `$expectedValue`:$stepsToExecute\n+----\n+\n+==== *_Parameters_*\n+\n+. `$max` - iterations\n+. `$variableName` - variable name to check", "originalCommit": "871959bfe0bfb92d0085285450c0038b92f4d87c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgxMTkyMw==", "url": "https://github.com/vividus-framework/vividus/pull/1002#discussion_r501811923", "bodyText": "noisy change", "author": "valfirst", "createdAt": "2020-10-08T15:27:28Z", "path": "docs/modules/plugins/pages/plugin-web-app.adoc", "diffHunk": "@@ -11,7 +11,6 @@ The plugin provides functionality to interact with Web applications.\n implementation(group: 'org.vividus', name: 'vividus-plugin-web-app', version: '{page-component-version}')\n ----\n \n-", "originalCommit": "871959bfe0bfb92d0085285450c0038b92f4d87c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgxMjE5MA==", "url": "https://github.com/vividus-framework/vividus/pull/1002#discussion_r501812190", "bodyText": "I think we need to document alias as well", "author": "valfirst", "createdAt": "2020-10-08T15:27:53Z", "path": "docs/modules/commons/pages/vividus-steps.adoc", "diffHunk": "@@ -0,0 +1,44 @@\n+= Steps available out of the box\n+\n+Here one could find description of the steps that delivered with Vividus itself without any plugins required.\n+\n+=== While-like steps executor\n+\n+==== *_Info_*\n+\n+Executes steps while condition or iteration limit reached.\n+\n+[IMPORTANT]\n+If iteration limit reached no failure or exception will happen\n+\n+==== *_Wording_*\n+\n+[source,gherkin]\n+----\n+When I execute steps at most $max times while `$variableName` is $comparisonRule `$expectedValue`:$stepsToExecute", "originalCommit": "871959bfe0bfb92d0085285450c0038b92f4d87c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgxMjg4MQ==", "url": "https://github.com/vividus-framework/vividus/pull/1002#discussion_r501812881", "bodyText": "doesVariableValueMatch", "author": "valfirst", "createdAt": "2020-10-08T15:28:53Z", "path": "vividus/src/main/java/org/vividus/bdd/steps/ExecutableSteps.java", "diffHunk": "@@ -81,6 +81,54 @@ public void ifVariableNotSetPerformSteps(String name, SubSteps stepsToExecute)\n         }\n     }\n \n+    /**\n+     * Executes the steps while variable doesn't have a value fitting defined rules or limit is reached.\n+     * <br>\n+     * <b>Example:</b>\n+     * <br>\n+     * <code>\n+     * When I execute steps at most 5 times while `var` is &lt; `3`:\n+     * <br>\n+     * |step                                                                        |\n+     * <br>\n+     * |When I click on element located `id(counter)`                               |\n+     * <br>\n+     * |When I set the text found in search context to the 'scenario' variable 'var'|\n+     * <br>\n+     * </code>\n+     * @param max Maximum iteration number\n+     * @param name Variable name to check\n+     * @param comparisonRule The rule to compare values\n+     * (&lt;i&gt;Possible values:&lt;b&gt; LESS_THAN, LESS_THAN_OR_EQUAL_TO, GREATER_THAN, GREATER_THAN_OR_EQUAL_TO,\n+     * EQUAL_TO&lt;/b&gt;&lt;/i&gt;)\n+     * @param expectedValue The expected value of the variable\n+     * @param stepsToExecute The examples table with the steps to execute\n+     */\n+    @When(\"I execute steps at most $max times while `$variableName` is $comparisonRule `$expectedValue`:$stepsToExeute\")\n+    @Alias(\n+        \"I execute steps at most $max times while '$variableName' is $comparisonRule '$expectedValue':$stepsToExeute\")\n+    public void executeStepsWhile(int max, String name, ComparisonRule comparisonRule, String expectedValue,\n+            SubSteps stepsToExecute)\n+    {\n+        Matcher<String> valueVerifier = comparisonRule.getComparisonRule(expectedValue);\n+        int iterationsLeft = max;\n+        while (iterationsLeft > 0 && variableValueFits(name, valueVerifier))\n+        {\n+            --iterationsLeft;\n+            stepsToExecute.execute(Optional.empty());\n+        }\n+    }\n+\n+    private boolean variableValueFits(String name, Matcher<String> verifier)", "originalCommit": "871959bfe0bfb92d0085285450c0038b92f4d87c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgxMzI4Ng==", "url": "https://github.com/vividus-framework/vividus/pull/1002#discussion_r501813286", "bodyText": "return variable == null || verifier.matches(variable);", "author": "valfirst", "createdAt": "2020-10-08T15:29:26Z", "path": "vividus/src/main/java/org/vividus/bdd/steps/ExecutableSteps.java", "diffHunk": "@@ -81,6 +81,54 @@ public void ifVariableNotSetPerformSteps(String name, SubSteps stepsToExecute)\n         }\n     }\n \n+    /**\n+     * Executes the steps while variable doesn't have a value fitting defined rules or limit is reached.\n+     * <br>\n+     * <b>Example:</b>\n+     * <br>\n+     * <code>\n+     * When I execute steps at most 5 times while `var` is &lt; `3`:\n+     * <br>\n+     * |step                                                                        |\n+     * <br>\n+     * |When I click on element located `id(counter)`                               |\n+     * <br>\n+     * |When I set the text found in search context to the 'scenario' variable 'var'|\n+     * <br>\n+     * </code>\n+     * @param max Maximum iteration number\n+     * @param name Variable name to check\n+     * @param comparisonRule The rule to compare values\n+     * (&lt;i&gt;Possible values:&lt;b&gt; LESS_THAN, LESS_THAN_OR_EQUAL_TO, GREATER_THAN, GREATER_THAN_OR_EQUAL_TO,\n+     * EQUAL_TO&lt;/b&gt;&lt;/i&gt;)\n+     * @param expectedValue The expected value of the variable\n+     * @param stepsToExecute The examples table with the steps to execute\n+     */\n+    @When(\"I execute steps at most $max times while `$variableName` is $comparisonRule `$expectedValue`:$stepsToExeute\")\n+    @Alias(\n+        \"I execute steps at most $max times while '$variableName' is $comparisonRule '$expectedValue':$stepsToExeute\")\n+    public void executeStepsWhile(int max, String name, ComparisonRule comparisonRule, String expectedValue,\n+            SubSteps stepsToExecute)\n+    {\n+        Matcher<String> valueVerifier = comparisonRule.getComparisonRule(expectedValue);\n+        int iterationsLeft = max;\n+        while (iterationsLeft > 0 && variableValueFits(name, valueVerifier))\n+        {\n+            --iterationsLeft;\n+            stepsToExecute.execute(Optional.empty());\n+        }\n+    }\n+\n+    private boolean variableValueFits(String name, Matcher<String> verifier)\n+    {\n+        String variable = bddVariableContext.getVariable(name);\n+        if (variable == null)\n+        {\n+            return true;\n+        }\n+        return verifier.matches(variable);", "originalCommit": "871959bfe0bfb92d0085285450c0038b92f4d87c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "96e2112f7fa4d537a02d494725cc3a21ecc20e3c", "url": "https://github.com/vividus-framework/vividus/commit/96e2112f7fa4d537a02d494725cc3a21ecc20e3c", "message": "[vividus] Add while-like step", "committedDate": "2020-10-09T07:06:19Z", "type": "forcePushed"}, {"oid": "26248ece2276f0c9ac9506a5afeef65398121f97", "url": "https://github.com/vividus-framework/vividus/commit/26248ece2276f0c9ac9506a5afeef65398121f97", "message": "[vividus] Add while-like step", "committedDate": "2020-10-09T08:16:14Z", "type": "commit"}, {"oid": "26248ece2276f0c9ac9506a5afeef65398121f97", "url": "https://github.com/vividus-framework/vividus/commit/26248ece2276f0c9ac9506a5afeef65398121f97", "message": "[vividus] Add while-like step", "committedDate": "2020-10-09T08:16:14Z", "type": "forcePushed"}]}