{"pr_number": 1277, "pr_title": "[plugin-saucelabs] Add session link for SauceLabs jobs", "pr_createdAt": "2020-12-28T08:38:34Z", "pr_url": "https://github.com/vividus-framework/vividus/pull/1277", "timeline": [{"oid": "83ce19648a040f1b4653c9ef571a006088e67b1c", "url": "https://github.com/vividus-framework/vividus/commit/83ce19648a040f1b4653c9ef571a006088e67b1c", "message": "[plugin-saucelabs] Add session link for SauceLabs jobs", "committedDate": "2020-12-28T08:45:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI2NDk2Nw==", "url": "https://github.com/vividus-framework/vividus/pull/1277#discussion_r549264967", "bodyText": "it's possible to get App Server by region: https://github.com/saucelabs/saucerest-java/blob/master/src/main/java/com/saucelabs/saucerest/DataCenter.java (but it's not released yet)", "author": "valfirst", "createdAt": "2020-12-28T08:47:02Z", "path": "docs/modules/plugins/pages/plugin-sauce-labs.adoc", "diffHunk": "@@ -69,6 +69,11 @@ a|URL\n |\n |Sauce Labs REST endpoint (it must match to the selected data center)\n \n+|[subs=+quotes]`*saucelabs.app-url*`\n+a|URL\n+|\n+|Sauce Labs App Server URL, e.g. `https://app.eu-central-1.saucelabs.com` (it must match to the selected data center)", "originalCommit": "83ce19648a040f1b4653c9ef571a006088e67b1c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI2NTMwOA==", "url": "https://github.com/vividus-framework/vividus/pull/1277#discussion_r549265308", "bodyText": "it's not util, it's for reporting", "author": "valfirst", "createdAt": "2020-12-28T08:48:18Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/ui/util/AbstractSessionLinkPublisher.java", "diffHunk": "@@ -14,46 +14,44 @@\n  * limitations under the License.\n  */\n \n-package org.vividus.bdd.browserstack.steps;\n+package org.vividus.ui.util;", "originalCommit": "83ce19648a040f1b4653c9ef571a006088e67b1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI2Nzg5NA==", "url": "https://github.com/vividus-framework/vividus/pull/1277#discussion_r549267894", "bodyText": "ops, miss click :)", "author": "uarlouski", "createdAt": "2020-12-28T08:56:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI2NTMwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI2NTM2NA==", "url": "https://github.com/vividus-framework/vividus/pull/1277#discussion_r549265364", "bodyText": "getTestCloudName", "author": "valfirst", "createdAt": "2020-12-28T08:48:29Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/ui/util/AbstractSessionLinkPublisher.java", "diffHunk": "@@ -14,46 +14,44 @@\n  * limitations under the License.\n  */\n \n-package org.vividus.bdd.browserstack.steps;\n+package org.vividus.ui.util;\n+\n+import static java.lang.String.format;\n \n import java.util.Optional;\n \n-import com.browserstack.automate.model.Session;\n import com.google.common.eventbus.EventBus;\n import com.google.common.eventbus.Subscribe;\n \n import org.jbehave.core.annotations.AfterScenario;\n import org.jbehave.core.annotations.BeforeScenario;\n import org.jbehave.core.annotations.ScenarioType;\n import org.openqa.selenium.remote.RemoteWebDriver;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n-import org.vividus.browserstack.BrowserStackAutomateClient;\n import org.vividus.reporter.event.LinkPublishEvent;\n import org.vividus.selenium.IWebDriverProvider;\n import org.vividus.selenium.event.WebDriverQuitEvent;\n import org.vividus.testcontext.TestContext;\n \n-public class BrowserStackSteps\n+public abstract class AbstractSessionLinkPublisher\n {\n-    private static final Logger LOGGER = LoggerFactory.getLogger(BrowserStackSteps.class);\n-\n     private static final Object KEY = SessionLinkPublishState.class;\n \n     private final IWebDriverProvider webDriverProvider;\n     private final EventBus eventBus;\n-    private final BrowserStackAutomateClient appAutomateClient;\n     private final TestContext testContext;\n \n-    public BrowserStackSteps(IWebDriverProvider webDriverProvider, EventBus eventBus,\n-            BrowserStackAutomateClient appAutomateClient, TestContext testContext)\n+    public AbstractSessionLinkPublisher(IWebDriverProvider webDriverProvider, EventBus eventBus,\n+            TestContext testContext)\n     {\n         this.webDriverProvider = webDriverProvider;\n         this.eventBus = eventBus;\n-        this.appAutomateClient = appAutomateClient;\n         this.testContext = testContext;\n     }\n \n+    protected abstract String getProviderName();", "originalCommit": "83ce19648a040f1b4653c9ef571a006088e67b1c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI2NTUyMw==", "url": "https://github.com/vividus-framework/vividus/pull/1277#discussion_r549265523", "bodyText": "getSessionUrl ?", "author": "valfirst", "createdAt": "2020-12-28T08:48:55Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/ui/util/AbstractSessionLinkPublisher.java", "diffHunk": "@@ -14,46 +14,44 @@\n  * limitations under the License.\n  */\n \n-package org.vividus.bdd.browserstack.steps;\n+package org.vividus.ui.util;\n+\n+import static java.lang.String.format;\n \n import java.util.Optional;\n \n-import com.browserstack.automate.model.Session;\n import com.google.common.eventbus.EventBus;\n import com.google.common.eventbus.Subscribe;\n \n import org.jbehave.core.annotations.AfterScenario;\n import org.jbehave.core.annotations.BeforeScenario;\n import org.jbehave.core.annotations.ScenarioType;\n import org.openqa.selenium.remote.RemoteWebDriver;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n-import org.vividus.browserstack.BrowserStackAutomateClient;\n import org.vividus.reporter.event.LinkPublishEvent;\n import org.vividus.selenium.IWebDriverProvider;\n import org.vividus.selenium.event.WebDriverQuitEvent;\n import org.vividus.testcontext.TestContext;\n \n-public class BrowserStackSteps\n+public abstract class AbstractSessionLinkPublisher\n {\n-    private static final Logger LOGGER = LoggerFactory.getLogger(BrowserStackSteps.class);\n-\n     private static final Object KEY = SessionLinkPublishState.class;\n \n     private final IWebDriverProvider webDriverProvider;\n     private final EventBus eventBus;\n-    private final BrowserStackAutomateClient appAutomateClient;\n     private final TestContext testContext;\n \n-    public BrowserStackSteps(IWebDriverProvider webDriverProvider, EventBus eventBus,\n-            BrowserStackAutomateClient appAutomateClient, TestContext testContext)\n+    public AbstractSessionLinkPublisher(IWebDriverProvider webDriverProvider, EventBus eventBus,\n+            TestContext testContext)\n     {\n         this.webDriverProvider = webDriverProvider;\n         this.eventBus = eventBus;\n-        this.appAutomateClient = appAutomateClient;\n         this.testContext = testContext;\n     }\n \n+    protected abstract String getProviderName();\n+\n+    protected abstract Optional<String> getTestExecutionUrl(String sessionId);", "originalCommit": "83ce19648a040f1b4653c9ef571a006088e67b1c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7a33b02d00fd0e4e2af9e2e50077c1dba45c77f4", "url": "https://github.com/vividus-framework/vividus/commit/7a33b02d00fd0e4e2af9e2e50077c1dba45c77f4", "message": "[plugin-saucelabs] Add session link for SauceLabs jobs", "committedDate": "2020-12-28T09:22:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI4Njk3MA==", "url": "https://github.com/vividus-framework/vividus/pull/1277#discussion_r549286970", "bodyText": "org.vividus.ui.reporter", "author": "valfirst", "createdAt": "2020-12-28T09:57:18Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/ui/session/AbstractSessionLinkPublisher.java", "diffHunk": "@@ -14,46 +14,44 @@\n  * limitations under the License.\n  */\n \n-package org.vividus.bdd.browserstack.steps;\n+package org.vividus.ui.session;", "originalCommit": "7a33b02d00fd0e4e2af9e2e50077c1dba45c77f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI5NDEwNg==", "url": "https://github.com/vividus-framework/vividus/pull/1277#discussion_r549294106", "bodyText": "reporter makes me thinking about report module and asking question why reporter thing does in selenium extension, but when we name the package session we like make a reference to selenium session which is suitable for the extension-selenium module", "author": "uarlouski", "createdAt": "2020-12-28T10:20:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI4Njk3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMxNTc2Nw==", "url": "https://github.com/vividus-framework/vividus/pull/1277#discussion_r549315767", "bodyText": "no, the goal of this class is to provide the data for the report, as for session - we don't manage sessions, the session is just a data\n\nwhy reporter thing does in selenium extension\n\nbecause it's a test automation solution, which includes reporting, logging and etc. and each module can report, log and etc.", "author": "valfirst", "createdAt": "2020-12-28T11:34:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI4Njk3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMxOTY4MA==", "url": "https://github.com/vividus-framework/vividus/pull/1277#discussion_r549319680", "bodyText": "I didn't mean managing sessions, but what we do here is providing link to remote selenium session and this can be used not only for reporting", "author": "uarlouski", "createdAt": "2020-12-28T11:48:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI4Njk3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI4NzU1OQ==", "url": "https://github.com/vividus-framework/vividus/pull/1277#discussion_r549287559", "bodyText": "you can replace getTestCloudName() with constructor parameter and generate this string once", "author": "valfirst", "createdAt": "2020-12-28T09:58:59Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/ui/session/AbstractSessionLinkPublisher.java", "diffHunk": "@@ -87,25 +85,8 @@ private SessionLinkPublishState getPublishState()\n \n     private void publishSessionLink(String sessionId)\n     {\n-        getSessionLink(sessionId)\n-                .ifPresent(link -> eventBus.post(new LinkPublishEvent(\"BrowserStack Session URL\", link)));\n-    }\n-\n-    @SuppressWarnings(\"IllegalCatchExtended\")\n-    private Optional<String> getSessionLink(String sessionId)\n-    {\n-        try\n-        {\n-            Session session = appAutomateClient.getSession(sessionId);\n-            return Optional.of(session.getPublicUrl());\n-        }\n-        catch (Exception exception)\n-        {\n-            LOGGER.atError().addArgument(sessionId)\n-                            .setCause(exception)\n-                            .log(\"Unable to get an URL for BrowserStack session with the ID {}\");\n-            return Optional.empty();\n-        }\n+        getSessionUrl(sessionId).ifPresent(\n+            link -> eventBus.post(new LinkPublishEvent(format(\"%s Session URL\", getTestCloudName()), link)));", "originalCommit": "7a33b02d00fd0e4e2af9e2e50077c1dba45c77f4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI5MDYwNA==", "url": "https://github.com/vividus-framework/vividus/pull/1277#discussion_r549290604", "bodyText": "create RelaxedEnumPropertyEditor instead", "author": "valfirst", "createdAt": "2020-12-28T10:09:19Z", "path": "vividus-plugin-saucelabs/src/main/resources/spring.xml", "diffHunk": "@@ -25,11 +28,19 @@\n         </property>\n     </bean>\n \n+    <bean id=\"sauceLabsLinkPublisher\" class=\"org.vividus.saucelabs.SauceLabsSessionLinkPublisher\">\n+        <!-- Workaround for: https://github.com/saucelabs/saucerest-java/pull/127 -->\n+        <constructor-arg index=\"0\" value=\"#{'${saucelabs.data-center}'.toUpperCase()}\" />", "originalCommit": "7a33b02d00fd0e4e2af9e2e50077c1dba45c77f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI5MjE2MA==", "url": "https://github.com/vividus-framework/vividus/pull/1277#discussion_r549292160", "bodyText": "but there is a change to get null if saucelabs.data-center is empty, isn't it better here to fail at context startup?", "author": "uarlouski", "createdAt": "2020-12-28T10:14:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI5MDYwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMxNjIxOA==", "url": "https://github.com/vividus-framework/vividus/pull/1277#discussion_r549316218", "bodyText": "please elaborate", "author": "valfirst", "createdAt": "2020-12-28T11:36:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI5MDYwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMxODA5MQ==", "url": "https://github.com/vividus-framework/vividus/pull/1277#discussion_r549318091", "bodyText": "RelaxedEnumPropertyEditor interprets empty string as null", "author": "uarlouski", "createdAt": "2020-12-28T11:42:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI5MDYwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMyMDU4NA==", "url": "https://github.com/vividus-framework/vividus/pull/1277#discussion_r549320584", "bodyText": "okay, it turned out that we convert all empty values to nulls", "author": "uarlouski", "createdAt": "2020-12-28T11:52:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI5MDYwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMyMjAyNg==", "url": "https://github.com/vividus-framework/vividus/pull/1277#discussion_r549322026", "bodyText": "with current code Spring will also convert an empty value to null", "author": "valfirst", "createdAt": "2020-12-28T11:57:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI5MDYwNA=="}], "type": "inlineReview"}, {"oid": "aee8aec3354bd06623b9e658ad33e2c322b71482", "url": "https://github.com/vividus-framework/vividus/commit/aee8aec3354bd06623b9e658ad33e2c322b71482", "message": "[plugin-saucelabs] Add session link for SauceLabs jobs", "committedDate": "2020-12-28T12:24:21Z", "type": "forcePushed"}, {"oid": "dffb7e0d22f7103df3b861f76feead33926fa54d", "url": "https://github.com/vividus-framework/vividus/commit/dffb7e0d22f7103df3b861f76feead33926fa54d", "message": "[plugin-saucelabs] Add session link for SauceLabs jobs", "committedDate": "2020-12-28T12:31:29Z", "type": "forcePushed"}, {"oid": "e873c153a8d13221e08fdadb00ae66788d4c7b95", "url": "https://github.com/vividus-framework/vividus/commit/e873c153a8d13221e08fdadb00ae66788d4c7b95", "message": "[plugin-saucelabs] Add session link for SauceLabs jobs", "committedDate": "2020-12-28T12:36:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTM4NDA4OA==", "url": "https://github.com/vividus-framework/vividus/pull/1277#discussion_r549384088", "bodyText": "linkName", "author": "valfirst", "createdAt": "2020-12-28T15:18:35Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/ui/report/AbstractSessionLinkPublisher.java", "diffHunk": "@@ -14,46 +14,45 @@\n  * limitations under the License.\n  */\n \n-package org.vividus.bdd.browserstack.steps;\n+package org.vividus.ui.report;\n+\n+import static java.lang.String.format;\n \n import java.util.Optional;\n \n-import com.browserstack.automate.model.Session;\n import com.google.common.eventbus.EventBus;\n import com.google.common.eventbus.Subscribe;\n \n import org.jbehave.core.annotations.AfterScenario;\n import org.jbehave.core.annotations.BeforeScenario;\n import org.jbehave.core.annotations.ScenarioType;\n import org.openqa.selenium.remote.RemoteWebDriver;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n-import org.vividus.browserstack.BrowserStackAutomateClient;\n import org.vividus.reporter.event.LinkPublishEvent;\n import org.vividus.selenium.IWebDriverProvider;\n import org.vividus.selenium.event.WebDriverQuitEvent;\n import org.vividus.testcontext.TestContext;\n \n-public class BrowserStackSteps\n+public abstract class AbstractSessionLinkPublisher\n {\n-    private static final Logger LOGGER = LoggerFactory.getLogger(BrowserStackSteps.class);\n-\n     private static final Object KEY = SessionLinkPublishState.class;\n \n+    private final String sessionLink;\n+\n     private final IWebDriverProvider webDriverProvider;\n     private final EventBus eventBus;\n-    private final BrowserStackAutomateClient appAutomateClient;\n     private final TestContext testContext;\n \n-    public BrowserStackSteps(IWebDriverProvider webDriverProvider, EventBus eventBus,\n-            BrowserStackAutomateClient appAutomateClient, TestContext testContext)\n+    protected AbstractSessionLinkPublisher(String testCloudName, IWebDriverProvider webDriverProvider,\n+            EventBus eventBus, TestContext testContext)\n     {\n+        this.sessionLink = format(\"%s Session URL\", testCloudName);", "originalCommit": "e873c153a8d13221e08fdadb00ae66788d4c7b95", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2df5765c706627184a70f92d9479b036f4143225", "url": "https://github.com/vividus-framework/vividus/commit/2df5765c706627184a70f92d9479b036f4143225", "message": "[plugin-saucelabs] Add session link for SauceLabs jobs", "committedDate": "2020-12-28T20:01:49Z", "type": "commit"}, {"oid": "2df5765c706627184a70f92d9479b036f4143225", "url": "https://github.com/vividus-framework/vividus/commit/2df5765c706627184a70f92d9479b036f4143225", "message": "[plugin-saucelabs] Add session link for SauceLabs jobs", "committedDate": "2020-12-28T20:01:49Z", "type": "forcePushed"}, {"oid": "969c3058ecf70bf766fddfd0d6877bc1943816fc", "url": "https://github.com/vividus-framework/vividus/commit/969c3058ecf70bf766fddfd0d6877bc1943816fc", "message": "Fix BS docs", "committedDate": "2020-12-29T07:38:32Z", "type": "commit"}, {"oid": "d0c07f225ef4d0627cd0be9e6b4608214689200e", "url": "https://github.com/vividus-framework/vividus/commit/d0c07f225ef4d0627cd0be9e6b4608214689200e", "message": "Fix SL docs", "committedDate": "2020-12-29T07:39:14Z", "type": "commit"}]}