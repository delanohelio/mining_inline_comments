{"pr_number": 604, "pr_title": "[bdd-engine] Use TableParsers to parse table as string into object representation", "pr_createdAt": "2020-05-22T16:10:18Z", "pr_url": "https://github.com/vividus-framework/vividus/pull/604", "timeline": [{"oid": "cf6c1bcb7bcd0dfd8dc053a4ae1da2be8380b6da", "url": "https://github.com/vividus-framework/vividus/commit/cf6c1bcb7bcd0dfd8dc053a4ae1da2be8380b6da", "message": "[bdd-engine] Use TableParsers to parse string into object representation", "committedDate": "2020-05-22T18:16:29Z", "type": "forcePushed"}, {"oid": "57e17f89aa0c83125a510f06d37e950eae3390a3", "url": "https://github.com/vividus-framework/vividus/commit/57e17f89aa0c83125a510f06d37e950eae3390a3", "message": "[bdd-engine] Use TableParsers to parse table as string into object representation", "committedDate": "2020-05-22T18:24:30Z", "type": "forcePushed"}, {"oid": "5db8a4918a72360336f5e9bb49e2f05b5c10c33f", "url": "https://github.com/vividus-framework/vividus/commit/5db8a4918a72360336f5e9bb49e2f05b5c10c33f", "message": "[bdd-engine] Use TableParsers to parse table as string into object representation", "committedDate": "2020-05-22T18:26:57Z", "type": "forcePushed"}, {"oid": "5955af5f439deb4afd3f7fcfe681ff4af4df81fd", "url": "https://github.com/vividus-framework/vividus/commit/5955af5f439deb4afd3f7fcfe681ff4af4df81fd", "message": "[bdd-engine] Use TableParsers to parse table as string into object representation", "committedDate": "2020-05-22T18:29:35Z", "type": "forcePushed"}, {"oid": "f53ae5db968b43631f19c6471c079b6c0c4e0029", "url": "https://github.com/vividus-framework/vividus/commit/f53ae5db968b43631f19c6471c079b6c0c4e0029", "message": "[bdd-engine] Use TableParsers to parse table as string into object representation", "committedDate": "2020-05-22T21:14:18Z", "type": "commit"}, {"oid": "f53ae5db968b43631f19c6471c079b6c0c4e0029", "url": "https://github.com/vividus-framework/vividus/commit/f53ae5db968b43631f19c6471c079b6c0c4e0029", "message": "[bdd-engine] Use TableParsers to parse table as string into object representation", "committedDate": "2020-05-22T21:14:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUzMzQxMw==", "url": "https://github.com/vividus-framework/vividus/pull/604#discussion_r429533413", "bodyText": "why not ExamplesTableProcessor.buildExamplesTable(filteredColumns, result, properties, true, true); ?", "author": "valfirst", "createdAt": "2020-05-23T10:11:58Z", "path": "vividus-bdd-engine/src/main/java/org/vividus/bdd/transformer/FilteringTableTransformer.java", "diffHunk": "@@ -57,18 +52,13 @@ public String transform(String tableAsString, TableParsers tableParsers, TablePr\n         isTrue(!(byMaxColumns != null && byColumnNames != null),\n                 \"Conflicting properties declaration found: '%s' and '%s'\",\n                 BY_MAX_COLUMNS_PROPERTY, BY_COLUMNS_NAMES_PROPERTY);\n-        ExamplesTable examplesTable = examplesTableFactory.get().createExamplesTable(tableAsString);\n-\n-        List<String> filteredColumns = getFilteredHeaders(byMaxColumns, byColumnNames, examplesTable.getHeaders());\n-        List<Map<String, String>> result = filterByHeaders(filteredColumns, getFilteredRows(byMaxRows, examplesTable));\n+        TableRows tableRows = tableParsers.parseRows(tableAsString, properties);\n \n-        List<List<String>> resultRows = result.stream()\n-                .map(LinkedHashMap::new)\n-                .map(Map::values)\n-                .map(ArrayList::new)\n-                .collect(Collectors.toList());\n+        List<String> filteredColumns = getFilteredHeaders(byMaxColumns, byColumnNames, tableRows.getHeaders());\n+        List<Map<String, String>> result = filterByHeaders(filteredColumns,\n+                getFilteredRows(byMaxRows, tableRows.getRows()));\n \n-        return ExamplesTableProcessor.buildExamplesTable(filteredColumns, resultRows, properties, true, true);\n+        return ExamplesTableProcessor.buildExamplesTable(filteredColumns, result, properties);", "originalCommit": "f53ae5db968b43631f19c6471c079b6c0c4e0029", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUzOTk3MA==", "url": "https://github.com/vividus-framework/vividus/pull/604#discussion_r429539970", "bodyText": "are you suggesting to refactor all the existing classes that rely on List List String?", "author": "uarlouski", "createdAt": "2020-05-23T12:02:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUzMzQxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUzNDE4Ng==", "url": "https://github.com/vividus-framework/vividus/pull/604#discussion_r429534186", "bodyText": "what is the reason of this change?", "author": "valfirst", "createdAt": "2020-05-23T10:24:41Z", "path": "vividus-bdd-engine/src/main/java/org/vividus/bdd/transformer/SortingTableTransformer.java", "diffHunk": "@@ -34,28 +36,28 @@\n     @Override\n     public String transform(String tableAsString, TableParsers tableParsers, TableProperties properties)\n     {\n+        TableRows tableRows = tableParsers.parseRows(tableAsString, properties);\n         String byColumns = ExtendedTableTransformer.getMandatoryNonBlankProperty(properties, \"byColumns\");\n-        List<String> rowsToSort = ExamplesTableProcessor.parseRows(tableAsString);\n-        String header = rowsToSort.get(0);\n-        List<String> headerValues = tableParsers.parseRow(header, true, properties);\n-        List<Integer> columnsToCompare = Stream.of(StringUtils.split(byColumns, '|'))\n+        List<String> headerValues = tableRows.getHeaders();\n+        List<String> columnsToCompare = Stream.of(StringUtils.split(byColumns, '|'))\n                 .map(String::trim)\n-                .map(headerValues::indexOf)\n-                .filter(i -> i > -1)\n                 .collect(Collectors.toList());\n-        List<List<String>> rows = ExamplesTableProcessor.parseDataRows(rowsToSort, tableParsers, properties).stream()\n+        List<Map<String, String>> rows = tableRows.getRows().stream()\n                 .sorted((r1, r2) ->\n                 {\n                     int result = 0;\n-                    Iterator<Integer> indexIterator = columnsToCompare.iterator();\n-                    while (result == 0 && indexIterator.hasNext())\n+                    Iterator<String> columnIterator = columnsToCompare.iterator();\n+                    while (result == 0 && columnIterator.hasNext())\n                     {\n-                        int index = indexIterator.next();\n-                        result = r1.get(index).compareTo(r2.get(index));\n+                        String column = columnIterator.next();\n+                        if (headerValues.contains(column))\n+                        {\n+                            result = r1.get(column).compareTo(r2.get(column));\n+                        }\n                     }\n                     return result;\n                 })\n                 .collect(Collectors.toList());\n-        return ExamplesTableProcessor.buildExamplesTable(headerValues, rows, properties, true);\n+        return ExamplesTableProcessor.buildExamplesTable(headerValues, rows, properties);", "originalCommit": "f53ae5db968b43631f19c6471c079b6c0c4e0029", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUzOTQwOQ==", "url": "https://github.com/vividus-framework/vividus/pull/604#discussion_r429539409", "bodyText": "As to transformers, we know that TableProperties object contains actual separators and other table properties so there is no need in additional separator checks", "author": "uarlouski", "createdAt": "2020-05-23T11:54:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUzNDE4Ng=="}], "type": "inlineReview"}]}