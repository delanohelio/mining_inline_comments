{"pr_number": 566, "pr_title": "[plugin-web-app] Fix scrolling script", "pr_createdAt": "2020-05-12T10:02:24Z", "pr_url": "https://github.com/vividus-framework/vividus/pull/566", "timeline": [{"oid": "fe4bb1c7d39fc97eb6782a80e62ac8923e8a49ee", "url": "https://github.com/vividus-framework/vividus/commit/fe4bb1c7d39fc97eb6782a80e62ac8923e8a49ee", "message": "[plugin-web-app] Fix scrolling script\n\nScript scrolling element into viewport center was executed endlessly with timeout 500 seconds;\nThe strategy brokes the tests for example in the case when the user clicked anchor link, the page has never scrolled to the anchor because of the script;\nNew approach: Add scroll waiting listener -> Wait for the scroll end -> remove listener -> call selenium exit callback", "committedDate": "2020-05-12T10:49:57Z", "type": "forcePushed"}, {"oid": "2d91dadb59ec7a42c7696680fd9d5265df725b69", "url": "https://github.com/vividus-framework/vividus/commit/2d91dadb59ec7a42c7696680fd9d5265df725b69", "message": "[plugin-web-app] Fix scrolling script\n\nScript scrolling element into viewport center was executed endlessly with timeout 500 seconds;\nThe strategy brokes the tests for example in the case when the user clicked anchor link, the page has never scrolled to the anchor because of the script;\nNew approach: Add scroll waiting listener -> Wait for the scroll end -> remove listener -> call selenium exit callback", "committedDate": "2020-05-12T11:22:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY4MDk3Ng==", "url": "https://github.com/vividus-framework/vividus/pull/566#discussion_r423680976", "bodyText": "please indent the line", "author": "valfirst", "createdAt": "2020-05-12T12:07:57Z", "path": "vividus-plugin-web-app/src/main/resources/org/vividus/ui/web/action/scroll-element-into-viewport-center.js", "diffHunk": "@@ -1,20 +1,32 @@\n var elementToScroll = arguments[0];\n var exit = arguments[arguments.length-1];\n-(scrollElementIntoViewportCenter = function() {\n-    var currentWindow = window;\n-    try {\n-        // Check, if we have an access to top level document\n-        window.top.document;\n-        while (currentWindow !== window.top) {\n-            elementToScroll = currentWindow.frameElement;\n-            currentWindow = currentWindow.parent;\n-        }\n-        currentWindow.scrollBy(0, elementToScroll.getBoundingClientRect().top - currentWindow.innerHeight * 0.25);\n-        setTimeout(scrollElementIntoViewportCenter, 500);\n-    }\n-    catch(e) {\n-        // swallow error quietly\n+var waitForScroll;\n+var currentWindow = window;\n+\n+try {\n+    // Check, if we have an access to top level document\n+    window.top.document;\n+    while (currentWindow !== window.top) {\n+        elementToScroll = currentWindow.frameElement;\n+        currentWindow = currentWindow.parent;\n     }\n-    exit();\n-}) ();\n+    currentWindow.addEventListener('scroll', clearTimeoutAndWait, false);\n+    currentWindow.scrollBy(0, elementToScroll.getBoundingClientRect().top - currentWindow.innerHeight * 0.25);\n+}\n+catch(e) {\n+    // swallow error quietly\n+}\n+\n+function wait() {\n+waitForScroll =  setTimeout(function() {", "originalCommit": "2d91dadb59ec7a42c7696680fd9d5265df725b69", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "947695b42ba0050e092c927c21a3594b4f1a1d98", "url": "https://github.com/vividus-framework/vividus/commit/947695b42ba0050e092c927c21a3594b4f1a1d98", "message": "[plugin-web-app] Fix scrolling script\n\nScript scrolling element into viewport center was executed endlessly with timeout 500 seconds;\nThe strategy brokes the tests for example in the case when the user clicked anchor link, the page has never scrolled to the anchor because of the script;\nNew approach: Add scroll waiting listener -> Wait for the scroll end -> remove listener -> call selenium exit callback", "committedDate": "2020-05-12T14:18:23Z", "type": "commit"}, {"oid": "947695b42ba0050e092c927c21a3594b4f1a1d98", "url": "https://github.com/vividus-framework/vividus/commit/947695b42ba0050e092c927c21a3594b4f1a1d98", "message": "[plugin-web-app] Fix scrolling script\n\nScript scrolling element into viewport center was executed endlessly with timeout 500 seconds;\nThe strategy brokes the tests for example in the case when the user clicked anchor link, the page has never scrolled to the anchor because of the script;\nNew approach: Add scroll waiting listener -> Wait for the scroll end -> remove listener -> call selenium exit callback", "committedDate": "2020-05-12T14:18:23Z", "type": "forcePushed"}]}