{"pr_number": 1291, "pr_title": "LUCENE-9016: RefGuide meta doc for how to publish website", "pr_createdAt": "2020-02-26T15:36:14Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1291", "timeline": [{"oid": "95af386596a9185fdeb19aeb6f9baab4d08dec10", "url": "https://github.com/apache/lucene-solr/commit/95af386596a9185fdeb19aeb6f9baab4d08dec10", "message": "LUCENE-9016: RefGuide meta doc for how to publish website with the new git site", "committedDate": "2020-02-26T15:35:10Z", "type": "commit"}, {"oid": "cf0b60bfbd8eae398ceb9bda74f753ba66bf978e", "url": "https://github.com/apache/lucene-solr/commit/cf0b60bfbd8eae398ceb9bda74f753ba66bf978e", "message": "Merge the two NOTE sections", "committedDate": "2020-02-26T15:38:31Z", "type": "commit"}, {"oid": "3316cb5268d66792e13136ca33cfe6d080184a09", "url": "https://github.com/apache/lucene-solr/commit/3316cb5268d66792e13136ca33cfe6d080184a09", "message": "Move note higher up", "committedDate": "2020-02-26T15:40:59Z", "type": "commit"}, {"oid": "4747be04e916703bd790af8b95bd96e0c72f6732", "url": "https://github.com/apache/lucene-solr/commit/4747be04e916703bd790af8b95bd96e0c72f6732", "message": "Fix link to PR generation", "committedDate": "2020-02-26T15:43:44Z", "type": "commit"}, {"oid": "222cb16b3454d04dd08ebc7711daa5c79bf08649", "url": "https://github.com/apache/lucene-solr/commit/222cb16b3454d04dd08ebc7711daa5c79bf08649", "message": "Fix precommit", "committedDate": "2020-02-26T22:36:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg0MTc4Mg==", "url": "https://github.com/apache/lucene-solr/pull/1291#discussion_r385841782", "bodyText": "Headline case in section titles please....\nBut not sure why this needed to change? I don't care, just struck me as extraneous and then I realized that the other section heading doesn't say you're publishing a draft so it probably really doesn't matter. I'm the only one who reads this anyway.", "author": "ctargett", "createdAt": "2020-02-28T18:03:56Z", "path": "solr/solr-ref-guide/src/meta-docs/publish.adoc", "diffHunk": "@@ -47,54 +49,20 @@ To build the HTML:\n [source,bash]\n $ ant clean default\n +\n-This will produce pages with a DRAFT watermark across them. While these are fine for initial DRAFT publication, see the section <<Publish the Guide>> for steps to produce final production-ready HTML pages.\n+This will produce pages with a DRAFT watermark across them. While these are fine for initial DRAFT publication, see the section <<Publish the Guide without watermark>> for steps to produce final production-ready HTML pages.\n . The resulting Guide will be in `solr/build/solr-ref-guide`. The HTML files themselves will be in `solr/build/solr-ref-guide/html-site`.\n \n == Upload to the Website\n \n-// A lot of this was copied from https://wiki.apache.org/lucene-java/ReleaseTodo#Website_.2B-.3D_javadocs. See that section for explanations for why some steps are required.\n-\n-*Step 1: Update extpaths.txt in CMS Staging*\n-\n-. Checkout CMS trunk:\n-+\n-[source,bash]\n-$ svn co --depth=immediates https://svn.apache.org/repos/asf/lucene/cms/trunk/content website-source\n-+\n-* If you already have this repo checked out, you can simply `svn up website-source` to update to the latest revision.\n-. `$ cd website-source` (where you just checked out the repo)\n-. Add the path for the new Guide version:\n-+\n-[source,bash]\n-$ echo solr/guide/X_Y >> extpaths.txt\n-+\n-where `X_Y` is the new version (i.e, `7_7`)\n-. Commit changes:\n-+\n-[source,bash]\n-$ svn commit -m \"Update CMS production sync exceptions for X_Y_Z Guide\" extpaths.txt\n-\n-*Step 2: Push Guide to Website Production*\n-\n Push the Guide directly to production via Subversion `import` from where you built it.\n \n-You must push it to the path you just added to `extpaths.txt`, so if the path you added was `solr/guide/7_7`, you'll use the path as shown in the below example:\n-\n [source,bash]\n svn -m \"Add Ref Guide for Solr 7.7\" import <checkoutroot>/solr/build/solr-ref-guide/html-site https://svn.apache.org/repos/infra/websites/production/lucene/content/solr/guide/7_7\n \n Confirm you can browse to Guide manually by going to the new URL. For example:\n https://lucene.apache.org/solr/guide/7_7\n \n-*Step 3: Push Staging extpaths.txt to Production*\n-\n-The `extpaths.txt` works by listing paths that should be ignored when the CMS syncs the staging and production repositories. Publishing staging to production will only succeed if the paths listed in `extpaths.txt` exist in production. At the same time, if a path exists in production but not in staging it will be deleted unless it is defined in `extpaths.txt`.\n-\n-After pushing the content to production, check that the `extpaths.txt` in production includes the proper path to ensure that the Guide is not deleted incorrectly. If it does not exist in production, try to publish the site again to make sure it is updated.\n-\n-Production URL: https://lucene.apache.org/extpaths.txt\n-\n-== Publish the Guide\n+== Publish the Guide without watermark", "originalCommit": "222cb16b3454d04dd08ebc7711daa5c79bf08649", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk1MTkxOA==", "url": "https://github.com/apache/lucene-solr/pull/1291#discussion_r385951918", "bodyText": "Reverted to old header", "author": "janhoy", "createdAt": "2020-02-28T22:28:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg0MTc4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg0MjIyMQ==", "url": "https://github.com/apache/lucene-solr/pull/1291#discussion_r385842221", "bodyText": "This paragraph sort of conflates a couple points together IMO.\nFirst, I don't know the value of keeping the idea that there used to be a need to edit the extpaths.txt file - it assumes the reader had a knowledge of how things used to be done, and we know from experience that next to no one does.\nNext, the 2nd sentence assumes a knowledge of the binary release process and only links to a script to provide more context. Perhaps it would just be simpler for these two sentences to just say:\n\"The binary release process [insert link to it] will update the LUCENE_LATEST_RELEASE property which will ensure that Ref Guide URLs without a version in the path will automatically redirect to the latest Guide.\"\nAnd with that simplification, I'm no longer sure it warrants a special NOTE callout style.\nLastly, extpaths.txt being gone and the RM changing a parameter are not the reasons why we push a DRAFT version (as far as I understand - unless there is a new dependency that's not reflected here that I'm not aware of?), so the 2nd-to-last sentence shouldn't imply that it does. We push the DRAFT so people can look at it as part of the vote process. That may not be appropriately reflected in the rest of the doc, though, so easy to see how it could be confusing.", "author": "ctargett", "createdAt": "2020-02-28T18:04:58Z", "path": "solr/solr-ref-guide/src/meta-docs/publish.adoc", "diffHunk": "@@ -37,6 +37,8 @@ NOTE: Builds are available via https://builds.apache.org/view/L/view/Lucene/[Jen\n \n == Build the DRAFT Guide\n \n+NOTE: After the switch to website in GIT, built by Pelican (https://github.com/apache/lucene-site) we no longer need to update `extpaths.txt`. When the RM changes the `LUCENE_LATEST_RELEASE` variable in https://github.com/apache/lucene-site/blob/master/pelicanconf.py in the website git repo, the default redirect for https://lucene.apache.org/solr/guide/mypage.html will automatically redirect to the latest `X_Y` version. Thus you should always publish a DRAFT guide to that location *before* the release of Solr. Then you can publish a final version later, overwriting the previous.", "originalCommit": "222cb16b3454d04dd08ebc7711daa5c79bf08649", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk1MTgwMg==", "url": "https://github.com/apache/lucene-solr/pull/1291#discussion_r385951802", "bodyText": "Agree. I added a similar text at the bottom of the page.", "author": "janhoy", "createdAt": "2020-02-28T22:28:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg0MjIyMQ=="}], "type": "inlineReview"}, {"oid": "eb1bafc9223a312e6c27f6ab7b5721b6a00f0ca0", "url": "https://github.com/apache/lucene-solr/commit/eb1bafc9223a312e6c27f6ab7b5721b6a00f0ca0", "message": "Review updates", "committedDate": "2020-02-28T22:31:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM0ODg3Mg==", "url": "https://github.com/apache/lucene-solr/pull/1291#discussion_r388348872", "bodyText": "Since you changed the heading this refers to back to its original, this reference should be changed too. This is why precommit failed.", "author": "ctargett", "createdAt": "2020-03-05T15:00:41Z", "path": "solr/solr-ref-guide/src/meta-docs/publish.adoc", "diffHunk": "@@ -47,61 +47,26 @@ To build the HTML:\n [source,bash]\n $ ant clean default\n +\n-This will produce pages with a DRAFT watermark across them. While these are fine for initial DRAFT publication, see the section <<Publish the Guide>> for steps to produce final production-ready HTML pages.\n+This will produce pages with a DRAFT watermark across them. While these are fine for initial DRAFT publication, see the section <<Publish the Guide without watermark>> for steps to produce final production-ready HTML pages.\n . The resulting Guide will be in `solr/build/solr-ref-guide`. The HTML files themselves will be in `solr/build/solr-ref-guide/html-site`.", "originalCommit": "eb1bafc9223a312e6c27f6ab7b5721b6a00f0ca0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e443b524b7b6c1dedcbf28cf8be09ca4ce7147a7", "url": "https://github.com/apache/lucene-solr/commit/e443b524b7b6c1dedcbf28cf8be09ca4ce7147a7", "message": "Merge branch 'master' into lucene-9016-publish-refguide", "committedDate": "2020-03-05T15:03:47Z", "type": "commit"}, {"oid": "6e11eee4564939500bd7c9efdc098ff962070416", "url": "https://github.com/apache/lucene-solr/commit/6e11eee4564939500bd7c9efdc098ff962070416", "message": "Review comment", "committedDate": "2020-03-05T15:05:52Z", "type": "commit"}]}