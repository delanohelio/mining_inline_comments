{"pr_number": 1170, "pr_title": "LUCENE-9141: Simplify LatLonShapeXQuery API.", "pr_createdAt": "2020-01-15T14:17:27Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1170", "timeline": [{"oid": "6e1875919c543291cf550fe79acca3dfbbdc66f8", "url": "https://github.com/apache/lucene-solr/commit/6e1875919c543291cf550fe79acca3dfbbdc66f8", "message": "Simplify LatLonShape query API.", "committedDate": "2020-01-15T14:10:28Z", "type": "commit"}, {"oid": "2f66a0a10b065f2e575cf4ad77e347c4e2828760", "url": "https://github.com/apache/lucene-solr/commit/2f66a0a10b065f2e575cf4ad77e347c4e2828760", "message": "javadocs", "committedDate": "2020-01-15T15:30:31Z", "type": "commit"}, {"oid": "de70544df021263cb71b03cdca48d0e4a9f98cef", "url": "https://github.com/apache/lucene-solr/commit/de70544df021263cb71b03cdca48d0e4a9f98cef", "message": "remove check from crossing dateline, it is job of the components\nto support that.", "committedDate": "2020-01-15T18:59:39Z", "type": "commit"}, {"oid": "3d65ee5c29a12bf4d856027d09e7eb60c7af6bf4", "url": "https://github.com/apache/lucene-solr/commit/3d65ee5c29a12bf4d856027d09e7eb60c7af6bf4", "message": "Merge branch 'master' into simplifyLatLonShapeQuery\n\n# Conflicts:\n#\tlucene/core/src/java/org/apache/lucene/document/LatLonShapeLineQuery.java\n#\tlucene/core/src/java/org/apache/lucene/document/LatLonShapePointQuery.java\n#\tlucene/core/src/java/org/apache/lucene/document/LatLonShapePolygonQuery.java\n#\tlucene/sandbox/src/java/org/apache/lucene/document/LatLonShapeComponent2DQuery.java\n#\tlucene/sandbox/src/java/org/apache/lucene/document/LatLonShapePolygonQuery.java", "committedDate": "2020-01-17T23:26:39Z", "type": "commit"}, {"oid": "5a98b70b97d7c22274cb3e8ad4d63e9c0d6f5784", "url": "https://github.com/apache/lucene-solr/commit/5a98b70b97d7c22274cb3e8ad4d63e9c0d6f5784", "message": "clean up", "committedDate": "2020-01-17T23:41:27Z", "type": "commit"}, {"oid": "f15f852840d8820dba93d3a0776743bd2c2abc69", "url": "https://github.com/apache/lucene-solr/commit/f15f852840d8820dba93d3a0776743bd2c2abc69", "message": "make point final", "committedDate": "2020-01-17T23:45:48Z", "type": "commit"}, {"oid": "a49388f0d8387dba287da909444e7066cd548e41", "url": "https://github.com/apache/lucene-solr/commit/a49388f0d8387dba287da909444e7066cd548e41", "message": "clean up", "committedDate": "2020-01-19T22:01:30Z", "type": "commit"}, {"oid": "752d50de1c28f8f427edf33d577227efcb4b1d23", "url": "https://github.com/apache/lucene-solr/commit/752d50de1c28f8f427edf33d577227efcb4b1d23", "message": "remove toJson method from interface.", "committedDate": "2020-01-19T22:22:43Z", "type": "commit"}, {"oid": "941545a8cac4f7ba9d854bb37b620c15813e47a9", "url": "https://github.com/apache/lucene-solr/commit/941545a8cac4f7ba9d854bb37b620c15813e47a9", "message": "add point test", "committedDate": "2020-01-19T22:40:30Z", "type": "commit"}, {"oid": "92e7f84ced05e4c694169786973f3e37f909b0c4", "url": "https://github.com/apache/lucene-solr/commit/92e7f84ced05e4c694169786973f3e37f909b0c4", "message": "javadoc", "committedDate": "2020-01-19T22:48:20Z", "type": "commit"}, {"oid": "e1423fecc35784b559563bea52453a4984ef4837", "url": "https://github.com/apache/lucene-solr/commit/e1423fecc35784b559563bea52453a4984ef4837", "message": "Make LatLonGeometry abstract and simplify it", "committedDate": "2020-01-20T07:37:28Z", "type": "commit"}, {"oid": "fb6ff46ac7b8ded3c76b143f35aa144c15d28ebd", "url": "https://github.com/apache/lucene-solr/commit/fb6ff46ac7b8ded3c76b143f35aa144c15d28ebd", "message": "clean up", "committedDate": "2020-01-20T07:50:09Z", "type": "commit"}, {"oid": "3f158cdc5ce811ae06aa0d40a6007f0f3c11027a", "url": "https://github.com/apache/lucene-solr/commit/3f158cdc5ce811ae06aa0d40a6007f0f3c11027a", "message": "clean up", "committedDate": "2020-01-20T14:36:25Z", "type": "commit"}, {"oid": "a1448272bb454f94adc7593704a899f01724b630", "url": "https://github.com/apache/lucene-solr/commit/a1448272bb454f94adc7593704a899f01724b630", "message": "reject WITHIN queries with line geometries", "committedDate": "2020-01-21T09:16:41Z", "type": "commit"}, {"oid": "afd917b4b455688637e47e82e9a16e5ec5680b70", "url": "https://github.com/apache/lucene-solr/commit/afd917b4b455688637e47e82e9a16e5ec5680b70", "message": "add comment", "committedDate": "2020-01-21T09:24:30Z", "type": "commit"}, {"oid": "d248978538308263609469bb08296236212c08d5", "url": "https://github.com/apache/lucene-solr/commit/d248978538308263609469bb08296236212c08d5", "message": "javadocs", "committedDate": "2020-01-21T16:12:50Z", "type": "commit"}, {"oid": "485f12b2f2e5a8417f583326f20b6c8914a95b96", "url": "https://github.com/apache/lucene-solr/commit/485f12b2f2e5a8417f583326f20b6c8914a95b96", "message": "javadocs", "committedDate": "2020-01-21T16:14:29Z", "type": "commit"}, {"oid": "1f43576a47f20810072ddc5d3d7ac906ec450062", "url": "https://github.com/apache/lucene-solr/commit/1f43576a47f20810072ddc5d3d7ac906ec450062", "message": "rename class", "committedDate": "2020-01-21T17:35:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQ3NTgwNA==", "url": "https://github.com/apache/lucene-solr/pull/1170#discussion_r372475804", "bodyText": "nit: do you think we could just name this newGeometryQuery? This way we just treat geometries and single and/or collections? Feels a little less confusing IMHO.", "author": "nknize", "createdAt": "2020-01-29T16:05:22Z", "path": "lucene/core/src/java/org/apache/lucene/document/LatLonShape.java", "diffHunk": "@@ -107,40 +111,36 @@ public static Query newBoxQuery(String field, QueryRelation queryRelation, doubl\n    *  note: does not support dateline crossing\n    **/\n   public static Query newLineQuery(String field, QueryRelation queryRelation, Line... lines) {\n-    if (queryRelation == QueryRelation.CONTAINS && lines.length > 1) {\n-      BooleanQuery.Builder builder = new BooleanQuery.Builder();\n-      for (int i =0; i < lines.length; i++) {\n-        builder.add(newLineQuery(field, queryRelation, lines[i]), BooleanClause.Occur.MUST);\n-      }\n-      return builder.build();\n-    }\n-    return new LatLonShapeLineQuery(field, queryRelation, lines);\n+    return newGeometryCollectionQuery(field, queryRelation, lines);\n   }\n \n   /** create a query to find all indexed geo shapes that intersect a provided polygon (or array of polygons)\n    *  note: does not support dateline crossing\n    **/\n   public static Query newPolygonQuery(String field, QueryRelation queryRelation, Polygon... polygons) {\n-    if (queryRelation == QueryRelation.CONTAINS && polygons.length > 1) {\n-      BooleanQuery.Builder builder = new BooleanQuery.Builder();\n-      for (int i =0; i < polygons.length; i++) {\n-        builder.add(newPolygonQuery(field, queryRelation, polygons[i]), BooleanClause.Occur.MUST);\n-      }\n-      return builder.build();\n-    }\n-    return new LatLonShapePolygonQuery(field, queryRelation, polygons);\n+    return newGeometryCollectionQuery(field, queryRelation, polygons);\n   }\n \n-  /** create a query to find all indexed shapes that comply the {@link QueryRelation} with the provided point\n+  /** create a query to find all indexed shapes that comply the {@link QueryRelation} with the provided points\n    **/\n   public static Query newPointQuery(String field, QueryRelation queryRelation, double[]... points) {\n-    if (queryRelation == QueryRelation.CONTAINS && points.length > 1) {\n+    Point[] pointArray = new Point[points.length];\n+    for (int i =0; i < points.length; i++) {\n+      pointArray[i] = new Point(points[i][0], points[i][1]);\n+    }\n+    return newGeometryCollectionQuery(field, queryRelation, pointArray);\n+  }\n+\n+  /** create a query to find all indexed geo shapes that intersect a provided geometry collection.\n+   **/\n+  public static Query newGeometryCollectionQuery(String field, QueryRelation queryRelation, LatLonGeometry... latLonGeometries) {", "originalCommit": "1f43576a47f20810072ddc5d3d7ac906ec450062", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQ5MjczNg==", "url": "https://github.com/apache/lucene-solr/pull/1170#discussion_r372492736", "bodyText": "Yes, I think it is a better name", "author": "iverase", "createdAt": "2020-01-29T16:32:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQ3NTgwNA=="}], "type": "inlineReview"}, {"oid": "736e3207b25f7fb027f8dc6869ed66fa4dea09ed", "url": "https://github.com/apache/lucene-solr/commit/736e3207b25f7fb027f8dc6869ed66fa4dea09ed", "message": "rename method", "committedDate": "2020-01-29T18:36:29Z", "type": "commit"}, {"oid": "38bf5c3e81635dca4f8659063893089e2965bacb", "url": "https://github.com/apache/lucene-solr/commit/38bf5c3e81635dca4f8659063893089e2965bacb", "message": "Merge branch 'master' into simplifyLatLonShapeQuery", "committedDate": "2020-01-29T18:41:46Z", "type": "commit"}, {"oid": "10a47340e5e23c47619ab30f8a06f0a1d523ffc2", "url": "https://github.com/apache/lucene-solr/commit/10a47340e5e23c47619ab30f8a06f0a1d523ffc2", "message": "Add entry in CHANGES.txt", "committedDate": "2020-01-29T18:45:38Z", "type": "commit"}]}