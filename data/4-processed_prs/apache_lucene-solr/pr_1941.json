{"pr_number": 1941, "pr_title": "LUCENE-9554: Expose IndexWriter#pendingNumDocs", "pr_createdAt": "2020-10-02T14:40:58Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1941", "timeline": [{"oid": "a0b0e78e5c47a8ede92981b74c22b3ce0050e8bf", "url": "https://github.com/apache/lucene-solr/commit/a0b0e78e5c47a8ede92981b74c22b3ce0050e8bf", "message": "LUCENE-9554: Expose IndexWriter#pendingNumDocs", "committedDate": "2020-10-02T14:39:39Z", "type": "commit"}, {"oid": "16269e556a44dac582fe548e4845a5a79bdbfb8d", "url": "https://github.com/apache/lucene-solr/commit/16269e556a44dac582fe548e4845a5a79bdbfb8d", "message": "stylecheck", "committedDate": "2020-10-02T15:01:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkwNzc3OA==", "url": "https://github.com/apache/lucene-solr/pull/1941#discussion_r498907778", "bodyText": "I'm confused why we are calling separate methods when numDocs is negative or not?", "author": "mikemccand", "createdAt": "2020-10-02T15:54:37Z", "path": "lucene/core/src/java/org/apache/lucene/index/IndexWriter.java", "diffHunk": "@@ -1072,7 +1073,14 @@ public IndexWriter(Directory d, IndexWriterConfig conf) throws IOException {\n \n       config.getFlushPolicy().init(config);\n       bufferedUpdatesStream = new BufferedUpdatesStream(infoStream);\n-      docWriter = new DocumentsWriter(flushNotifications, segmentInfos.getIndexCreatedVersionMajor(), pendingNumDocs,\n+      final IntConsumer reserveDocs = numDocs -> {\n+        if (numDocs > 0) {\n+          reserveDocs(numDocs);", "originalCommit": "16269e556a44dac582fe548e4845a5a79bdbfb8d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "655b7d9f8c0014bd879e90f22e1d9aa5d3096efd", "url": "https://github.com/apache/lucene-solr/commit/655b7d9f8c0014bd879e90f22e1d9aa5d3096efd", "message": "smaller change", "committedDate": "2020-10-02T16:39:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkzNzAwMw==", "url": "https://github.com/apache/lucene-solr/pull/1941#discussion_r498937003", "bodyText": "Maybe add @lucene.experimental?  We are exposing (slightly) internal details about IndexWriter so maybe we need to reserve the right to change this API in the future ...", "author": "mikemccand", "createdAt": "2020-10-02T16:52:26Z", "path": "lucene/core/src/java/org/apache/lucene/index/IndexWriter.java", "diffHunk": "@@ -5463,6 +5463,13 @@ private void tooManyDocs(long addedNumDocs) {\n     throw new IllegalArgumentException(\"number of documents in the index cannot exceed \" + actualMaxDocs + \" (current document count is \" + pendingNumDocs.get() + \"; added numDocs is \" + addedNumDocs + \")\");\n   }\n \n+  /**\n+   * Returns the number of documents in the index including documents are being added (i.e., reserved).\n+   */", "originalCommit": "655b7d9f8c0014bd879e90f22e1d9aa5d3096efd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk1NzM0NQ==", "url": "https://github.com/apache/lucene-solr/pull/1941#discussion_r498957345", "bodyText": "++. I pushed 61d4fbc", "author": "dnhatn", "createdAt": "2020-10-02T17:34:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkzNzAwMw=="}], "type": "inlineReview"}, {"oid": "61d4fbc4a01cbfc50f386a8a88064e82d1027ee0", "url": "https://github.com/apache/lucene-solr/commit/61d4fbc4a01cbfc50f386a8a88064e82d1027ee0", "message": "lucene experimental", "committedDate": "2020-10-02T17:19:25Z", "type": "commit"}, {"oid": "501c1414680d99b6ada17e305ac27c1f722e73a5", "url": "https://github.com/apache/lucene-solr/commit/501c1414680d99b6ada17e305ac27c1f722e73a5", "message": "rename", "committedDate": "2020-10-02T19:36:17Z", "type": "commit"}]}