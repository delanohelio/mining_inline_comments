{"pr_number": 1522, "pr_title": "LUCENE-9374: Add checkBrokenLinks gradle task", "pr_createdAt": "2020-05-16T09:24:33Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1522", "timeline": [{"oid": "d5d1ced987568b0bc2a703c51d8ff5b25b3baa43", "url": "https://github.com/apache/lucene-solr/commit/d5d1ced987568b0bc2a703c51d8ff5b25b3baa43", "message": "LUCENE-9374: Add doclumentationLint gradle task", "committedDate": "2020-05-16T09:01:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzNjg4Ng==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426136886", "bodyText": "There is already a comment about include ordering above I believe, but fine.", "author": "dweiss", "createdAt": "2020-05-16T09:27:57Z", "path": "build.gradle", "diffHunk": "@@ -134,3 +134,4 @@ apply from: file('gradle/ant-compat/forbidden-api-rules-in-sync.gradle')\n apply from: file('gradle/documentation/documentation.gradle')\n apply from: file('gradle/documentation/changes-to-html.gradle')\n apply from: file('gradle/render-javadoc.gradle')\n+apply from: file('gradle/validation/documentation-lint.gradle')  // should be placed here; needs to be evaluated after documentation.gradle", "originalCommit": "d5d1ced987568b0bc2a703c51d8ff5b25b3baa43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE0MzgyMw==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426143823", "bodyText": "With lazy evaluation for 'docroot', the evaluation order does not matter so I moved this line to proper location. (I clearly missed the comment \"The order of inclusion of these files shouldn't matter\".)", "author": "mocobeta", "createdAt": "2020-05-16T11:06:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzNjg4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzNjk1Mg==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426136952", "bodyText": "This can be explicit since there are only two? (\":lucene:checkBrokenLinks\", \":solr:checkBrokenLinks\")?", "author": "dweiss", "createdAt": "2020-05-16T09:28:55Z", "path": "gradle/validation/documentation-lint.gradle", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+configure(rootProject) {\n+\n+  task documentationLint {\n+    group 'Verification'\n+    description 'Verify all documentation'\n+\n+    dependsOn 'documentation'\n+    dependsOn subprojects.collect { prj ->", "originalCommit": "d5d1ced987568b0bc2a703c51d8ff5b25b3baa43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE0NDI0OA==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426144248", "bodyText": "I updated the task dependencies.\nShould we remove entire documentationLink task, or is it useful to have?", "author": "mocobeta", "createdAt": "2020-05-16T11:12:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzNjk1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzNzExOA==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426137118", "bodyText": "I would add (commented out) check.dependsOn checkBrokenLinks to task declaration per-project as well so that when you run gradlew -p lucene check the validation runs on a per-project basis too.", "author": "dweiss", "createdAt": "2020-05-16T09:31:03Z", "path": "gradle/validation/documentation-lint.gradle", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+configure(rootProject) {\n+\n+  task documentationLint {\n+    group 'Verification'\n+    description 'Verify all documentation'\n+\n+    dependsOn 'documentation'\n+    dependsOn subprojects.collect { prj ->\n+      prj.tasks.matching { task -> task.name == 'checkBrokenLinks'}\n+    }\n+  }\n+\n+  // TODO: uncomment this line after fixing all broken links.", "originalCommit": "d5d1ced987568b0bc2a703c51d8ff5b25b3baa43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE0NDM3MA==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426144370", "bodyText": "Removed this, instead I added \"check.dependsOn checkBrokenLinks\".", "author": "mocobeta", "createdAt": "2020-05-16T11:14:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzNzExOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzNzIzMg==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426137232", "bodyText": "(I don't know how to do this without changing field signature) but ideally this should be a lazy provider returning project.docroot. This would make it evaluation-order independent and would trigger input evaluation only if the task actually runs.\nJust a thought if you want to get deeper into gradle. ;)", "author": "dweiss", "createdAt": "2020-05-16T09:32:52Z", "path": "gradle/validation/documentation-lint.gradle", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+configure(rootProject) {\n+\n+  task documentationLint {\n+    group 'Verification'\n+    description 'Verify all documentation'\n+\n+    dependsOn 'documentation'\n+    dependsOn subprojects.collect { prj ->\n+      prj.tasks.matching { task -> task.name == 'checkBrokenLinks'}\n+    }\n+  }\n+\n+  // TODO: uncomment this line after fixing all broken links.\n+  // (we can't fix the cross-project links until ant build is disabled.)\n+  // check.dependsOn documentationLint\n+}\n+\n+configure(subprojects.findAll { it.path in [':lucene', ':solr'] }) {\n+  task checkBrokenLinks(type: CheckBrokenLinksTask)\n+}\n+\n+class CheckBrokenLinksTask extends DefaultTask {\n+  @Input\n+  File docsDir = project.docroot", "originalCommit": "d5d1ced987568b0bc2a703c51d8ff5b25b3baa43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE0NDczMA==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426144730", "bodyText": "Thanks, project.afterEvaluate() works for me (though can't figure out the way to lazily evaluate ext properties for the task field).", "author": "mocobeta", "createdAt": "2020-05-16T11:19:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzNzIzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE0NjIxNg==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426146216", "bodyText": "Btw, render-javadoc.gradle (renderSiteJavadoc) also eagarly evaluate the property (I first referred the task and did the same), so it fails if the order is changed in root build.gradle.\nhttps://github.com/apache/lucene-solr/blob/master/gradle/render-javadoc.gradle#L59", "author": "mocobeta", "createdAt": "2020-05-16T11:41:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzNzIzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE4MzY1OQ==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426183659", "bodyText": "I wasn't talking about afterEvaluate, actually. I think some properties can be declared as lazy and then assigned a provider - this is different than afterEvaluate. Look here:\nhttps://docs.gradle.org/current/userguide/lazy_configuration.html\nAs for order dependencies: afterEvaluate only shifts the problem until later because you still can have dependency ordering problems between afterEvaluate closures... ;) It's not the perfect solution (but of course works reasonably well most of the time).", "author": "dweiss", "createdAt": "2020-05-16T19:31:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzNzIzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE5ODg2OQ==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426198869", "bodyText": "ah... thanks for correction. I misunderstood the meaning of afterEvaluation. I will come back next week.", "author": "mocobeta", "createdAt": "2020-05-16T23:05:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzNzIzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI1ODUzNw==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426258537", "bodyText": "You can have a look at #1477, there I am also using lazy evaluation (see bindings) property. It's a MapProvider and the values are lazily evaluated using project.providers.property{ ... lazy code ... }", "author": "uschindler", "createdAt": "2020-05-17T12:57:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzNzIzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQwMTM2OA==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426401368", "bodyText": "You can use a DirectoryProperty instead of a File and then use providers.property{...} to assign value. Gradle DSL does not change, just when using it from Groovy code or Java code, you have to call .getAsFile().get() (which does lazy evaluation).\nI did not use that for render-javadocs, becuase it was not needed.\nAnother \"simple\" way for lazy evaluation (works only with Strings, but its often helpful) is to use GString (double quoted Strings): GString someProperty = \"${->project.docroot}\" (please note the ->). Whenever toString() or as String is called, its lazinly evaluated. Without the -> the value is inserted into the string at parsing time.\nI had the same problem with #1477, but I will plan to do this for the URL coming from an extension:\n  @Input\n  def luceneDocUrl = \"${->project.luceneDocUrl}\"\n\n  @Input\n  def solrDocUrl = \"${->project.solrDocUrl}\"", "author": "uschindler", "createdAt": "2020-05-18T06:47:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzNzIzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQwODI4NA==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426408284", "bodyText": "See b7c60e5", "author": "uschindler", "createdAt": "2020-05-18T07:04:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzNzIzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY1NjkzMQ==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426656931", "bodyText": "Thanks for the pointers. project.providers.provider { project.docroot } perfectly works for me. ac195d1\n(${->project.docroot} also works fine; I like using Provider<File> signature here.)\nOn the master branch, gradlew renderSiteJavadoc fails with this error when I reverse evaluation order of gradle/render-javadoc.gradle and gradle/documentation/documentation.gradle.\n> Could not get unknown property 'docroot' for project ':solr:core' of type org.gradle.api.Project.\n\nI think it'd be better doing the same for render-javadoc.gradle just for safety, or add some comments about the ordering on build.gradle to prevent someone accidentally changes the file?", "author": "mocobeta", "createdAt": "2020-05-18T14:13:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzNzIzMg=="}], "type": "inlineReview"}, {"oid": "3e178c3feb3b5cb98364833001939e28037bc2c6", "url": "https://github.com/apache/lucene-solr/commit/3e178c3feb3b5cb98364833001939e28037bc2c6", "message": "make check task depends on 'checkBrokenLinks'; lazily evaluate 'docroot' property", "committedDate": "2020-05-16T10:55:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE0NjUzOQ==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426146539", "bodyText": "I think that should just depend on the documentation task, so it can also check the index.html files and all other stuff.\nI think the python script will also find errors introduced by the markdown stuff. At least it did when I broke the ant task in #1477.\n#1477 is ready for review, once it is merged you can test more.", "author": "uschindler", "createdAt": "2020-05-16T11:46:42Z", "path": "gradle/validation/documentation-lint.gradle", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+configure(rootProject) {\n+\n+  task documentationLint {\n+    group 'Verification'\n+    description 'Verify all documentation'\n+\n+    dependsOn ':lucene:checkBrokenLinks'\n+    dependsOn ':solr:checkBrokenLinks'\n+  }\n+}\n+\n+configure(subprojects.findAll { it.path in [':lucene', ':solr'] }) {\n+\n+  project.afterEvaluate {\n+    task checkBrokenLinks(type: CheckBrokenLinksTask) {\n+      docsDir = project.docroot\n+      dependsOn subprojects.collect { prj ->", "originalCommit": "3e178c3feb3b5cb98364833001939e28037bc2c6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI1NjA5Nw==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426256097", "bodyText": "Sorry I forgot to submit the review. I hate that github page, especially on smartphone!", "author": "uschindler", "createdAt": "2020-05-17T12:31:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE0NjUzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI1NjI4NQ==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426256285", "bodyText": "Just depend on :lucene:documentationand :solr:documentation. Will merge #1477 soon.", "author": "uschindler", "createdAt": "2020-05-17T12:33:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE0NjUzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI1NjQ0OQ==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426256449", "bodyText": "Thats the IMHO \"better\" code after #1477 is merged:\ndependsOn \"documentation\"", "author": "uschindler", "createdAt": "2020-05-17T12:35:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE0NjUzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI1NzYwNQ==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426257605", "bodyText": "OK #1477 is merged to master, just update your PR and change dependency. Thanks, Uwe", "author": "uschindler", "createdAt": "2020-05-17T12:47:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE0NjUzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI2MzQ1OQ==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426263459", "bodyText": "Thanks for the change. I merged the latest master and made \"checkBrokenLinks\" depend on \"documentation\".", "author": "mocobeta", "createdAt": "2020-05-17T13:45:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE0NjUzOQ=="}], "type": "inlineReview"}, {"oid": "9b689a58728e7113e50dd733c02fbb464cff1afd", "url": "https://github.com/apache/lucene-solr/commit/9b689a58728e7113e50dd733c02fbb464cff1afd", "message": "Merge branch 'master' into jira/LUCENE-9374-check-broken-links", "committedDate": "2020-05-17T13:17:15Z", "type": "commit"}, {"oid": "231f029658c60912f295685de928f086a0c0e5ba", "url": "https://github.com/apache/lucene-solr/commit/231f029658c60912f295685de928f086a0c0e5ba", "message": "make 'checkBrokenLinks' depend on 'documentation'; get rid of top level 'documentationLint' task.", "committedDate": "2020-05-17T13:38:14Z", "type": "commit"}, {"oid": "ac195d147a3b7d25605ca98034028f9719913782", "url": "https://github.com/apache/lucene-solr/commit/ac195d147a3b7d25605ca98034028f9719913782", "message": "use Provider to lazily evaluate docroot property", "committedDate": "2020-05-18T13:43:55Z", "type": "commit"}, {"oid": "988f7db0c2e8c6f3c20e49e29220c3d2eca54bf3", "url": "https://github.com/apache/lucene-solr/commit/988f7db0c2e8c6f3c20e49e29220c3d2eca54bf3", "message": "move script file path to @Input field.", "committedDate": "2020-05-18T14:23:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcxNTc2MA==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426715760", "bodyText": "Should be @InputFile", "author": "uschindler", "createdAt": "2020-05-18T15:35:59Z", "path": "gradle/validation/check-broken-links.gradle", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+configure(rootProject) {\n+\n+  task checkBrokenLinks {\n+    group 'Verification'\n+    description 'Check broken links in the entire documentation'\n+\n+    dependsOn ':lucene:checkBrokenLinks'\n+    dependsOn ':solr:checkBrokenLinks'\n+  }\n+\n+}\n+configure(subprojects.findAll { it.path in [':lucene', ':solr'] }) {\n+\n+  task checkBrokenLinks(type: CheckBrokenLinksTask, 'dependsOn': 'documentation')\n+\n+  // TODO: uncomment this line after fixing all broken links.\n+  // (we can't fix the cross-project links until ant build is disabled.)\n+  // check.dependsOn checkBrokenLinks\n+}\n+\n+class CheckBrokenLinksTask extends DefaultTask {\n+\n+  @Input", "originalCommit": "988f7db0c2e8c6f3c20e49e29220c3d2eca54bf3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3MjI5NQ==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426972295", "bodyText": "I replaced it with @InputDirectory (since @InputFile does not work for me.)", "author": "mocobeta", "createdAt": "2020-05-19T01:04:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcxNTc2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA4NzY0Mw==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r427087643", "bodyText": "of course it's a directory, sorry!", "author": "uschindler", "createdAt": "2020-05-19T07:31:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcxNTc2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA4OTQ2OQ==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r427089469", "bodyText": "For reference - the difference is that Input is  just the file, InputFIle is the file and its contents (!).\nhttps://docs.gradle.org/current/javadoc/org/gradle/api/tasks/InputFile.html", "author": "dweiss", "createdAt": "2020-05-19T07:34:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcxNTc2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzEyNDA2Mw==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r427124063", "bodyText": "This works for me and is what I had in mind:\n configure(subprojects.findAll { it.path in [':lucene', ':solr'] }) {\n \n-  task checkBrokenLinks(type: CheckBrokenLinksTask, 'dependsOn': 'documentation')\n+  task checkBrokenLinks(type: CheckBrokenLinksTask, 'dependsOn': 'documentation') {\n+    docsDir = project.layout.dir provider { project.docroot }\n+  }\n \n   // TODO: uncomment this line after fixing all broken links.\n   // (we can't fix the cross-project links until ant build is disabled.)\n@@ -38,7 +39,7 @@ configure(subprojects.findAll { it.path in [':lucene', ':solr'] }) {\n class CheckBrokenLinksTask extends DefaultTask {\n \n   @InputDirectory\n-  final Provider<File> docsDir = project.providers.provider { project.docroot }\n+  final DirectoryProperty docsDir = project.objects.directoryProperty()\n \n   @InputFile\n   File script = project.rootProject.file(\"dev-tools/scripts/checkJavadocLinks.py\")\n@@ -56,7 +57,7 @@ class CheckBrokenLinksTask extends DefaultTask {\n         args = [\n           \"-B\",\n           script.absolutePath,\n-          docsDir.get().absolutePath\n+          docsDir.get().asFile\n         ]\n       }\n     } \n\nAny version is fine though, I don't mind.", "author": "dweiss", "createdAt": "2020-05-19T08:31:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcxNTc2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI0OTQxOQ==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r427249419", "bodyText": "Thank you, 778701c works for me.", "author": "mocobeta", "createdAt": "2020-05-19T12:06:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcxNTc2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI1Mjc4Ng==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r427252786", "bodyText": "Thanks!", "author": "uschindler", "createdAt": "2020-05-19T12:12:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcxNTc2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcxNTg0NA==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426715844", "bodyText": "same here", "author": "uschindler", "createdAt": "2020-05-18T15:36:08Z", "path": "gradle/validation/check-broken-links.gradle", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+configure(rootProject) {\n+\n+  task checkBrokenLinks {\n+    group 'Verification'\n+    description 'Check broken links in the entire documentation'\n+\n+    dependsOn ':lucene:checkBrokenLinks'\n+    dependsOn ':solr:checkBrokenLinks'\n+  }\n+\n+}\n+configure(subprojects.findAll { it.path in [':lucene', ':solr'] }) {\n+\n+  task checkBrokenLinks(type: CheckBrokenLinksTask, 'dependsOn': 'documentation')\n+\n+  // TODO: uncomment this line after fixing all broken links.\n+  // (we can't fix the cross-project links until ant build is disabled.)\n+  // check.dependsOn checkBrokenLinks\n+}\n+\n+class CheckBrokenLinksTask extends DefaultTask {\n+\n+  @Input\n+  Provider<File> docsDir = project.providers.provider { project.docroot }\n+\n+  @Input", "originalCommit": "988f7db0c2e8c6f3c20e49e29220c3d2eca54bf3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3MTAyOA==", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426971028", "bodyText": "Fixed.", "author": "mocobeta", "createdAt": "2020-05-19T00:59:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcxNTg0NA=="}], "type": "inlineReview"}, {"oid": "5f280310accb06861d94800854ddafba11132ee4", "url": "https://github.com/apache/lucene-solr/commit/5f280310accb06861d94800854ddafba11132ee4", "message": "Fix input annotations.", "committedDate": "2020-05-19T00:58:19Z", "type": "commit"}, {"oid": "45f381778e271a3b10ca663e8193254157b5e52a", "url": "https://github.com/apache/lucene-solr/commit/45f381778e271a3b10ca663e8193254157b5e52a", "message": "make docsDir field final.", "committedDate": "2020-05-19T01:09:24Z", "type": "commit"}, {"oid": "778701c97120fbc2e6578a545d7719ac19d82d75", "url": "https://github.com/apache/lucene-solr/commit/778701c97120fbc2e6578a545d7719ac19d82d75", "message": "use DirectoryProperty instead of directly having Provider", "committedDate": "2020-05-19T12:04:55Z", "type": "commit"}]}