{"pr_number": 1258, "pr_title": "LUCENE-9225: Rectangle should extend LatLonGeometry", "pr_createdAt": "2020-02-14T12:02:56Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1258", "timeline": [{"oid": "8d075932a3b0c8212034fdab0a8d9aacacd2fbb1", "url": "https://github.com/apache/lucene-solr/commit/8d075932a3b0c8212034fdab0a8d9aacacd2fbb1", "message": "make Rectangle extends LatLonGeometry", "committedDate": "2020-02-14T10:15:34Z", "type": "commit"}, {"oid": "c3fd5bad0da72907d51e7b95db2276e3ab35e71c", "url": "https://github.com/apache/lucene-solr/commit/c3fd5bad0da72907d51e7b95db2276e3ab35e71c", "message": "Merge branch 'master' into rectlatlongeometry\n\n# Conflicts:\n#\tlucene/core/src/java/org/apache/lucene/geo/XYRectangle2D.java\n#\tlucene/core/src/test/org/apache/lucene/geo/TestXYRectangle2D.java", "committedDate": "2020-02-14T11:12:00Z", "type": "commit"}, {"oid": "e143444deb996273cef01c311dceb779037c6b6e", "url": "https://github.com/apache/lucene-solr/commit/e143444deb996273cef01c311dceb779037c6b6e", "message": "Use specialize query whenever possible", "committedDate": "2020-02-14T11:59:05Z", "type": "commit"}, {"oid": "269e92891d65a7782f368dd8be76e010213aa537", "url": "https://github.com/apache/lucene-solr/commit/269e92891d65a7782f368dd8be76e010213aa537", "message": "Merge branch 'master' into rectlatlongeometry\n\n# Conflicts:\n#\tlucene/core/src/test/org/apache/lucene/document/TestLatLonShape.java", "committedDate": "2020-02-19T15:50:33Z", "type": "commit"}, {"oid": "7dc090ac79e30645cd3dac6be41dad421f01cd58", "url": "https://github.com/apache/lucene-solr/commit/7dc090ac79e30645cd3dac6be41dad421f01cd58", "message": "clean up building queries from LatLonGeometries", "committedDate": "2020-02-19T15:57:13Z", "type": "commit"}, {"oid": "f95187b499dccf1a50473a2bf89ea61f9229496a", "url": "https://github.com/apache/lucene-solr/commit/f95187b499dccf1a50473a2bf89ea61f9229496a", "message": "Merge branch 'master' into rectlatlongeometry", "committedDate": "2020-03-02T08:15:02Z", "type": "commit"}, {"oid": "9654c1de71fa43bce5092f2e2f5f52f7ba20f24a", "url": "https://github.com/apache/lucene-solr/commit/9654c1de71fa43bce5092f2e2f5f52f7ba20f24a", "message": "add entry in CHANGES.txt", "committedDate": "2020-03-02T08:42:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM4MTk3Mw==", "url": "https://github.com/apache/lucene-solr/pull/1258#discussion_r380381973", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private static double MIN_LON_INCL_QUANTIZE = decodeLongitude(encodeLongitude(MIN_LON_INCL));\n          \n          \n            \n              private static double MIN_LON_INCL_QUANTIZE = decodeLongitude(GeoEncodingUtils.MIN_LON_ENCODED);", "author": "nknize", "createdAt": "2020-02-17T22:14:02Z", "path": "lucene/core/src/java/org/apache/lucene/geo/Rectangle2D.java", "diffHunk": "@@ -415,16 +217,63 @@ public boolean equals(Object o) {\n     return minX == that.minX &&\n         maxX == that.maxX &&\n         minY == that.minY &&\n-        maxY == that.maxY &&\n-        Arrays.equals(bbox, that.bbox) &&\n-        Arrays.equals(west, that.west);\n+        maxY == that.maxY;\n   }\n \n   @Override\n   public int hashCode() {\n     int result = Objects.hash(minX, maxX, minY, maxY);\n-    result = 31 * result + Arrays.hashCode(bbox);\n-    result = 31 * result + Arrays.hashCode(west);\n     return result;\n   }\n-}\n+\n+  @Override\n+  public String toString() {\n+    final StringBuilder sb = new StringBuilder();\n+    sb.append(\"XYRectangle(x=\");\n+    sb.append(minX);\n+    sb.append(\" TO \");\n+    sb.append(maxX);\n+    sb.append(\" y=\");\n+    sb.append(minY);\n+    sb.append(\" TO \");\n+    sb.append(maxY);\n+    sb.append(\")\");\n+    return sb.toString();\n+  }\n+\n+  /** create a component2D from the provided XY rectangle */\n+  static Component2D create(XYRectangle rectangle) {\n+    return new Rectangle2D(rectangle.minX, rectangle.maxX, rectangle.minY, rectangle.maxY);\n+  }\n+\n+  private static double MIN_LON_INCL_QUANTIZE = decodeLongitude(encodeLongitude(MIN_LON_INCL));", "originalCommit": "e143444deb996273cef01c311dceb779037c6b6e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM4MjEwOQ==", "url": "https://github.com/apache/lucene-solr/pull/1258#discussion_r380382109", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private static double MAX_LON_INCL_QUANTIZE = decodeLongitude(encodeLongitude(MAX_LON_INCL));\n          \n          \n            \n              private static double MAX_LON_INCL_QUANTIZE = decodeLongitude(GeoEncodingUtils.MAX_LON_ENCODED);", "author": "nknize", "createdAt": "2020-02-17T22:14:31Z", "path": "lucene/core/src/java/org/apache/lucene/geo/Rectangle2D.java", "diffHunk": "@@ -415,16 +217,63 @@ public boolean equals(Object o) {\n     return minX == that.minX &&\n         maxX == that.maxX &&\n         minY == that.minY &&\n-        maxY == that.maxY &&\n-        Arrays.equals(bbox, that.bbox) &&\n-        Arrays.equals(west, that.west);\n+        maxY == that.maxY;\n   }\n \n   @Override\n   public int hashCode() {\n     int result = Objects.hash(minX, maxX, minY, maxY);\n-    result = 31 * result + Arrays.hashCode(bbox);\n-    result = 31 * result + Arrays.hashCode(west);\n     return result;\n   }\n-}\n+\n+  @Override\n+  public String toString() {\n+    final StringBuilder sb = new StringBuilder();\n+    sb.append(\"XYRectangle(x=\");\n+    sb.append(minX);\n+    sb.append(\" TO \");\n+    sb.append(maxX);\n+    sb.append(\" y=\");\n+    sb.append(minY);\n+    sb.append(\" TO \");\n+    sb.append(maxY);\n+    sb.append(\")\");\n+    return sb.toString();\n+  }\n+\n+  /** create a component2D from the provided XY rectangle */\n+  static Component2D create(XYRectangle rectangle) {\n+    return new Rectangle2D(rectangle.minX, rectangle.maxX, rectangle.minY, rectangle.maxY);\n+  }\n+\n+  private static double MIN_LON_INCL_QUANTIZE = decodeLongitude(encodeLongitude(MIN_LON_INCL));\n+  private static double MAX_LON_INCL_QUANTIZE = decodeLongitude(encodeLongitude(MAX_LON_INCL));", "originalCommit": "e143444deb996273cef01c311dceb779037c6b6e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM4NTA5MQ==", "url": "https://github.com/apache/lucene-solr/pull/1258#discussion_r380385091", "bodyText": "Is this class needed because Rectangle2D is package private?", "author": "nknize", "createdAt": "2020-02-17T22:28:25Z", "path": "lucene/core/src/java/org/apache/lucene/document/LatLonShapeBoundingBoxQuery.java", "diffHunk": "@@ -108,4 +115,385 @@ public String toString(String field) {\n     sb.append(rectangle.toString());\n     return sb.toString();\n   }\n+\n+  /** Holds spatial logic for a bounding box that works in the encoded space */\n+  private static class EncodedRectangle {", "originalCommit": "e143444deb996273cef01c311dceb779037c6b6e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjgyMjYzNg==", "url": "https://github.com/apache/lucene-solr/pull/1258#discussion_r386822636", "bodyText": "This class is an specialisation for bounding box queries working on the encoded space. As such it feels like the correct place to package this logic is in the query itself. I am pushing this change, if you disagree we can re-think how to package this logic later on.", "author": "iverase", "createdAt": "2020-03-03T06:35:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM4NTA5MQ=="}], "type": "inlineReview"}, {"oid": "dc1fd31551ab84e66e4c340d43517d4e6e047b4b", "url": "https://github.com/apache/lucene-solr/commit/dc1fd31551ab84e66e4c340d43517d4e6e047b4b", "message": "Merge branch 'master' into rectlatlongeometry\n\n# Conflicts:\n#\tlucene/CHANGES.txt", "committedDate": "2020-03-03T06:14:03Z", "type": "commit"}, {"oid": "dc2641cae0dd430a107bb5fdaceae4a453661857", "url": "https://github.com/apache/lucene-solr/commit/dc2641cae0dd430a107bb5fdaceae4a453661857", "message": "address comments", "committedDate": "2020-03-03T06:16:45Z", "type": "commit"}]}