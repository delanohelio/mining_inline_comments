{"pr_number": 1371, "pr_title": "SOLR-14333: print readable version of CollapsedPostFilter query", "pr_createdAt": "2020-03-21T09:56:30Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1371", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ2NDc1NQ==", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r396464755", "bodyText": "shouldn't we include type?", "author": "munendrasn", "createdAt": "2020-03-23T13:50:41Z", "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -184,6 +184,11 @@ public boolean equals(final Object other) {\n     public int hashCode() {\n       return 17 * (31 + selectorText.hashCode()) * (31 + type.hashCode());\n     }\n+\n+    @Override\n+    public String toString(){\n+      return selectorText;", "originalCommit": "044b0a83b7b1bfe57968ea5c0b9a35c8b1709b7c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwOTg5MQ==", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r397209891", "bodyText": "Added type too", "author": "gunasekhardora", "createdAt": "2020-03-24T14:47:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ2NDc1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ2NTA2NQ==", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r396465065", "bodyText": "Maybe add curly braces for beginning and end", "author": "munendrasn", "createdAt": "2020-03-23T13:51:11Z", "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -276,7 +281,19 @@ public int getCost() {\n     }\n \n     public String toString(String s) {\n-      return s;\n+      return \"!collapse field=\" + this.collapseField +", "originalCommit": "044b0a83b7b1bfe57968ea5c0b9a35c8b1709b7c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMDAyMg==", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r397210022", "bodyText": "Added them", "author": "gunasekhardora", "createdAt": "2020-03-24T14:47:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ2NTA2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ2NTU4Nw==", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r396465587", "bodyText": "check if converting them enum makes it cleaner", "author": "munendrasn", "createdAt": "2020-03-23T13:51:56Z", "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -276,7 +281,19 @@ public int getCost() {\n     }\n \n     public String toString(String s) {\n-      return s;\n+      return \"!collapse field=\" + this.collapseField +\n+          \", nullPolicy=\" + getNullPolicyString(this.nullPolicy) +\n+          \", groupHeadSelector=\" + this.groupHeadSelector.toString() +\n+          (hint == null ? \"\": \", hint=\" + this.hint) +\n+          \", size=\" + this.size;\n+    }\n+\n+    private String getNullPolicyString(int nullPolicy) {", "originalCommit": "044b0a83b7b1bfe57968ea5c0b9a35c8b1709b7c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMDEyNg==", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r397210126", "bodyText": "Converted this to enum", "author": "gunasekhardora", "createdAt": "2020-03-24T14:47:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ2NTU4Nw=="}], "type": "inlineReview"}, {"oid": "f78bbb373246c9e92d71d8d6d33c492960309fad", "url": "https://github.com/apache/lucene-solr/commit/f78bbb373246c9e92d71d8d6d33c492960309fad", "message": "SOLR-14333: update CHANGES.txt", "committedDate": "2020-03-24T14:06:10Z", "type": "forcePushed"}, {"oid": "8813566d32612bd376ed8c7ac8edeecdff729452", "url": "https://github.com/apache/lucene-solr/commit/8813566d32612bd376ed8c7ac8edeecdff729452", "message": "SOLR-14333: update CHANGES.txt", "committedDate": "2020-04-05T14:09:07Z", "type": "forcePushed"}, {"oid": "fd5de861da78930a49f5a09be5c7e2089a6ad5d7", "url": "https://github.com/apache/lucene-solr/commit/fd5de861da78930a49f5a09be5c7e2089a6ad5d7", "message": "SOLR-14333: update CHANGES.txt", "committedDate": "2020-04-05T14:12:31Z", "type": "forcePushed"}, {"oid": "9543abeaca92db78c55a9058a07cbbc1b2c048ac", "url": "https://github.com/apache/lucene-solr/commit/9543abeaca92db78c55a9058a07cbbc1b2c048ac", "message": "SOLR-14333: update CHANGES.txt", "committedDate": "2020-04-05T14:30:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY1NDY3MA==", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r414654670", "bodyText": "These constants can be removed and everything routed through the NullPolicy enum. Same for the NULL_COLLAPSE string above and others.", "author": "madrob", "createdAt": "2020-04-24T15:14:32Z", "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -218,7 +245,7 @@ public static GroupHeadSelector build(final SolrParams localParams) {\n     public String hint;\n     private boolean needsScores = true;\n     private boolean needsScores4Collapsing = false;\n-    private int nullPolicy;\n+    private NullPolicy nullPolicy;\n     private Set<BytesRef> boosted; // ordered by \"priority\"\n     public static final int NULL_POLICY_IGNORE = 0;", "originalCommit": "9543abeaca92db78c55a9058a07cbbc1b2c048ac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODUwMTY5MQ==", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r418501691", "bodyText": "@madrob Missed your comment somehow. Added the change that you have suggested. Can you please review this now?", "author": "gunasekhardora", "createdAt": "2020-05-01T11:06:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY1NDY3MA=="}], "type": "inlineReview"}, {"oid": "05c53497ae5be967b26f998fcd4eeeb160a20c6d", "url": "https://github.com/apache/lucene-solr/commit/05c53497ae5be967b26f998fcd4eeeb160a20c6d", "message": "SOLR-14333: use NullPolicy enum everywhere", "committedDate": "2020-05-01T10:46:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODcxODU0Ng==", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r418718546", "bodyText": "Can we get rid of the earlier String declarations too? Lines 125-127?", "author": "madrob", "createdAt": "2020-05-01T20:15:29Z", "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -128,6 +128,28 @@ field collapsing (with ngroups) when the number of distinct groups\n   public static final String HINT_TOP_FC = \"top_fc\";\n   public static final String HINT_MULTI_DOCVALUES = \"multi_docvalues\";\n \n+  public enum NullPolicy {\n+    IGNORE(\"ignore\", 0),", "originalCommit": "05c53497ae5be967b26f998fcd4eeeb160a20c6d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkyNjQ2OA==", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r418926468", "bodyText": "@madrob Removed them. Added an unit test to validate if null policy is an illegal argument as well.", "author": "gunasekhardora", "createdAt": "2020-05-02T07:40:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODcxODU0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTMxNzg3OA==", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r491317878", "bodyText": "I agree with @madrob about removing the unused declarations but as access the public for these variables. I think we should deprecate it in this PR(for 8x) and remove it in different PR\nwdyt?", "author": "munendrasn", "createdAt": "2020-09-19T07:49:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODcxODU0Ng=="}], "type": "inlineReview"}, {"oid": "596f130fc07d9cb5edc0de3d9dabbfb802310d60", "url": "https://github.com/apache/lucene-solr/commit/596f130fc07d9cb5edc0de3d9dabbfb802310d60", "message": "SOLR-14333: use NullPolicy enum everywhere", "committedDate": "2020-05-02T07:15:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTMxMjU3Mw==", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r491312573", "bodyText": "would it be better to include the class name too here?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  return \"groupHeadSelectorText=\" +this.selectorText + \", groupHeadSelectorType=\" +this.type;\n          \n          \n            \n                  return \"GroupHeadSelector[selectorText=\" +this.selectorText + \", type=\" +this.type + \"]\";", "author": "munendrasn", "createdAt": "2020-09-19T07:32:18Z", "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -188,6 +206,11 @@ public int hashCode() {\n       return 17 * (31 + selectorText.hashCode()) * (31 + type.hashCode());\n     }\n \n+    @Override\n+    public String toString(){\n+      return \"groupHeadSelectorText=\" +this.selectorText + \", groupHeadSelectorType=\" +this.type;", "originalCommit": "596f130fc07d9cb5edc0de3d9dabbfb802310d60", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTMxMzQ3OA==", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r491313478", "bodyText": "{!collapse specifies the query parser, I think we shouldn't include it in toString()\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  return \"{!collapse field=\" + this.collapseField +\n          \n          \n            \n                      \", nullPolicy=\" + this.nullPolicy.getName() + \", \" +\n          \n          \n            \n                      this.groupHeadSelector.toString() +\n          \n          \n            \n                      (hint == null ? \"\": \", hint=\" + this.hint) +\n          \n          \n            \n                      \", size=\" + this.size\n          \n          \n            \n                      + \"}\";\n          \n          \n            \n                  return \"CollapsingPostFilter[field=\" + this.collapseField +\n          \n          \n            \n                      \", nullPolicy=\" + this.nullPolicy.getName() + \", \" +\n          \n          \n            \n                      this.groupHeadSelector +\n          \n          \n            \n                      (hint == null ? \"\": \", hint=\" + this.hint) +\n          \n          \n            \n                      \", size=\" + this.size\n          \n          \n            \n                      + \"]\";", "author": "munendrasn", "createdAt": "2020-09-19T07:35:23Z", "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -279,7 +299,12 @@ public int getCost() {\n     }\n \n     public String toString(String s) {\n-      return s;\n+      return \"{!collapse field=\" + this.collapseField +\n+          \", nullPolicy=\" + this.nullPolicy.getName() + \", \" +\n+          this.groupHeadSelector.toString() +\n+          (hint == null ? \"\": \", hint=\" + this.hint) +\n+          \", size=\" + this.size\n+          + \"}\";", "originalCommit": "596f130fc07d9cb5edc0de3d9dabbfb802310d60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTMxNjc0NQ==", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r491316745", "bodyText": "The above suggestion might lead cause this in debug response\nCollapsingPostFilter([CollapsingPostFilter field=id, nullPolicy=expand, GroupHeadSelector[selectorText=_version_ asc, type=SORT], hint=top_fc, size=5000])\n\n\nThis is caused due to how Query is converted to String by QueryParsing Class but I think that should be handled separately as issue exists for different query type\n\n  \n    \n      lucene-solr/solr/core/src/java/org/apache/solr/search/QueryParsing.java\n    \n    \n         Line 336\n      in\n      ab3f1f0\n    \n    \n    \n    \n\n        \n          \n           out.append(query.getClass().getSimpleName()).append('(').append(query.toString()).append(')');", "author": "munendrasn", "createdAt": "2020-09-19T07:45:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTMxMzQ3OA=="}], "type": "inlineReview"}, {"oid": "5d25416da97f6d0d2788bbac296505b6f0cb34e6", "url": "https://github.com/apache/lucene-solr/commit/5d25416da97f6d0d2788bbac296505b6f0cb34e6", "message": "SOLR-14333: include class names", "committedDate": "2020-09-23T14:39:21Z", "type": "forcePushed"}, {"oid": "e4d8d291a49ccae12036e47b76d809f99b42e5b6", "url": "https://github.com/apache/lucene-solr/commit/e4d8d291a49ccae12036e47b76d809f99b42e5b6", "message": "SOLR-14333: deprecate unused public declarations", "committedDate": "2020-09-23T16:25:50Z", "type": "forcePushed"}, {"oid": "3b91ae45e2da494d3eb2d27a0fc6c1b1fac0ea83", "url": "https://github.com/apache/lucene-solr/commit/3b91ae45e2da494d3eb2d27a0fc6c1b1fac0ea83", "message": "SOLR-14333: update changes entry with note about deprecation", "committedDate": "2020-09-24T10:10:18Z", "type": "forcePushed"}, {"oid": "ea1129d81b98e22dffe881151e7644cb22ed9034", "url": "https://github.com/apache/lucene-solr/commit/ea1129d81b98e22dffe881151e7644cb22ed9034", "message": "SOLR-14333: print readable version of collapsedPostFilter query", "committedDate": "2020-09-28T13:17:33Z", "type": "commit"}, {"oid": "5677e37825e8646cd700767ab887e0dba98b1eed", "url": "https://github.com/apache/lucene-solr/commit/5677e37825e8646cd700767ab887e0dba98b1eed", "message": "SOLR-14333: wrap all null policies into an enum", "committedDate": "2020-09-28T13:17:33Z", "type": "commit"}, {"oid": "ca21730e35cca5b87fd66fea9d6a8a0d09130536", "url": "https://github.com/apache/lucene-solr/commit/ca21730e35cca5b87fd66fea9d6a8a0d09130536", "message": "SOLR-14333: add tests", "committedDate": "2020-09-28T13:17:33Z", "type": "commit"}, {"oid": "7bb7b0bc05db124fb981b62fe99ba897fb656a00", "url": "https://github.com/apache/lucene-solr/commit/7bb7b0bc05db124fb981b62fe99ba897fb656a00", "message": "SOLR-14333: update CHANGES.txt", "committedDate": "2020-09-28T13:17:33Z", "type": "commit"}, {"oid": "02198b5405a9d227382cf2bec2e12f33957420b8", "url": "https://github.com/apache/lucene-solr/commit/02198b5405a9d227382cf2bec2e12f33957420b8", "message": "SOLR-14333: use NullPolicy enum everywhere", "committedDate": "2020-09-28T13:17:33Z", "type": "commit"}, {"oid": "df8c6b4d2405b577af842bac017b2fee6e60c909", "url": "https://github.com/apache/lucene-solr/commit/df8c6b4d2405b577af842bac017b2fee6e60c909", "message": "SOLR-14333: include class names", "committedDate": "2020-09-28T13:17:33Z", "type": "commit"}, {"oid": "ddb16c4a6706362e4e25caab65fc4f7e9f7c2f7e", "url": "https://github.com/apache/lucene-solr/commit/ddb16c4a6706362e4e25caab65fc4f7e9f7c2f7e", "message": "SOLR-14333: deprecate unused public declarations", "committedDate": "2020-09-28T13:17:33Z", "type": "commit"}, {"oid": "05dbba5780d08e1143608efee9db7698a681bbcd", "url": "https://github.com/apache/lucene-solr/commit/05dbba5780d08e1143608efee9db7698a681bbcd", "message": "SOLR-14333: fix failing tests and minor changes", "committedDate": "2020-09-28T13:17:33Z", "type": "commit"}, {"oid": "071d488bcaac8859b5fe64f5cedf87f0eee4a3dd", "url": "https://github.com/apache/lucene-solr/commit/071d488bcaac8859b5fe64f5cedf87f0eee4a3dd", "message": "SOLR-14333: update changes entry with note about deprecation", "committedDate": "2020-09-28T13:17:33Z", "type": "commit"}, {"oid": "07d39fe29aebd36614516c8ecab34646281ae8d8", "url": "https://github.com/apache/lucene-solr/commit/07d39fe29aebd36614516c8ecab34646281ae8d8", "message": "SOLR-14333: minor change use open braces", "committedDate": "2020-09-28T13:34:12Z", "type": "commit"}, {"oid": "07d39fe29aebd36614516c8ecab34646281ae8d8", "url": "https://github.com/apache/lucene-solr/commit/07d39fe29aebd36614516c8ecab34646281ae8d8", "message": "SOLR-14333: minor change use open braces", "committedDate": "2020-09-28T13:34:12Z", "type": "forcePushed"}]}