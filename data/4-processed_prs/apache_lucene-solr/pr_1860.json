{"pr_number": 1860, "pr_title": "LUCENE-9488 Update release process to work with gradle", "pr_createdAt": "2020-09-11T19:25:19Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1860", "timeline": [{"oid": "da48deaab47aaed2263bed139a211be66def9d29", "url": "https://github.com/apache/lucene-solr/commit/da48deaab47aaed2263bed139a211be66def9d29", "message": "LUCENE-9475 Restore lucene/version.properties", "committedDate": "2020-09-11T18:03:03Z", "type": "commit"}, {"oid": "e90f858dbcf23ad9e799ef62a26e287eb43f381c", "url": "https://github.com/apache/lucene-solr/commit/e90f858dbcf23ad9e799ef62a26e287eb43f381c", "message": "LUCENE-9488 Move releasewizrds commands ant to gradle\n\nRename a few of the trivial commands", "committedDate": "2020-09-11T18:04:58Z", "type": "commit"}, {"oid": "0bd3a7c2386a3188922a12bb45b127ab3da47ad7", "url": "https://github.com/apache/lucene-solr/commit/0bd3a7c2386a3188922a12bb45b127ab3da47ad7", "message": "drop check for ant", "committedDate": "2020-09-11T18:09:47Z", "type": "commit"}, {"oid": "e172e2f78eeff0b32a285ab64c550c099334369b", "url": "https://github.com/apache/lucene-solr/commit/e172e2f78eeff0b32a285ab64c550c099334369b", "message": "Only need Java 11 defined", "committedDate": "2020-09-11T18:12:17Z", "type": "commit"}, {"oid": "6acd444ca99abe3ace925ddf34972ce5783c3966", "url": "https://github.com/apache/lucene-solr/commit/6acd444ca99abe3ace925ddf34972ce5783c3966", "message": "copyright", "committedDate": "2020-09-11T19:12:06Z", "type": "commit"}, {"oid": "94c4cca26b3b4603ece6d22e6ecdef4968420193", "url": "https://github.com/apache/lucene-solr/commit/94c4cca26b3b4603ece6d22e6ecdef4968420193", "message": "Back to JAVA11_HOME", "committedDate": "2020-09-11T19:15:36Z", "type": "commit"}, {"oid": "37023bf93dd484034488c979359da986f72560ba", "url": "https://github.com/apache/lucene-solr/commit/37023bf93dd484034488c979359da986f72560ba", "message": "typo", "committedDate": "2020-09-11T19:17:18Z", "type": "commit"}, {"oid": "9a574ab8192a63e085aacd571799af9f2ebcaffc", "url": "https://github.com/apache/lucene-solr/commit/9a574ab8192a63e085aacd571799af9f2ebcaffc", "message": "typo", "committedDate": "2020-09-11T19:17:48Z", "type": "commit"}, {"oid": "15c155488730ccec99f6406772f407bab4efa3f0", "url": "https://github.com/apache/lucene-solr/commit/15c155488730ccec99f6406772f407bab4efa3f0", "message": "clear gradle artifact cache", "committedDate": "2020-09-11T19:24:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQwNTc0NQ==", "url": "https://github.com/apache/lucene-solr/pull/1860#discussion_r487405745", "bodyText": "Will the ./ syntax work on Windows?", "author": "janhoy", "createdAt": "2020-09-12T12:39:57Z", "path": "dev-tools/scripts/releaseWizard.yaml", "diffHunk": "@@ -411,7 +410,7 @@ groups:\n         cmd: git pull\n         stdout: true\n       - !Command\n-        cmd: ant clean precommit\n+        cmd: ./gradlew clean check -x test", "originalCommit": "15c155488730ccec99f6406772f407bab4efa3f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYyMzk3OQ==", "url": "https://github.com/apache/lucene-solr/pull/1860#discussion_r487623979", "bodyText": "It works in PowerShell but not Command Prompt. I don't know how important this distinction is.", "author": "madrob", "createdAt": "2020-09-14T02:47:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQwNTc0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODE3NjE4Mg==", "url": "https://github.com/apache/lucene-solr/pull/1860#discussion_r488176182", "bodyText": "You can definere a variable like we do for rename command, that used gradlew.bat for win?", "author": "janhoy", "createdAt": "2020-09-14T19:40:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQwNTc0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODI3MzU4MA==", "url": "https://github.com/apache/lucene-solr/pull/1860#discussion_r488273580", "bodyText": "Works great!", "author": "madrob", "createdAt": "2020-09-14T22:37:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQwNTc0NQ=="}], "type": "inlineReview"}, {"oid": "64b339aa5b49c312b6fb9a7c995de588ea94ae71", "url": "https://github.com/apache/lucene-solr/commit/64b339aa5b49c312b6fb9a7c995de588ea94ae71", "message": "generate local gradle settings", "committedDate": "2020-09-14T15:50:16Z", "type": "commit"}, {"oid": "7d2a7412edd204313224395c29fd28cfdd3bb172", "url": "https://github.com/apache/lucene-solr/commit/7d2a7412edd204313224395c29fd28cfdd3bb172", "message": "ant to gradlew in buildAndRelease.py", "committedDate": "2020-09-14T18:31:31Z", "type": "commit"}, {"oid": "674e1db60a9179ef55094a8becfbe850d18f7e40", "url": "https://github.com/apache/lucene-solr/commit/674e1db60a9179ef55094a8becfbe850d18f7e40", "message": "dynamic gradle command", "committedDate": "2020-09-14T22:00:53Z", "type": "commit"}, {"oid": "21d57315112c348e6077f995c7ca6164e49d491e", "url": "https://github.com/apache/lucene-solr/commit/21d57315112c348e6077f995c7ca6164e49d491e", "message": "WIP prepare-release to new targets", "committedDate": "2020-09-14T22:01:29Z", "type": "commit"}, {"oid": "223b656106acf77f5da8e6c67321695af142c3df", "url": "https://github.com/apache/lucene-solr/commit/223b656106acf77f5da8e6c67321695af142c3df", "message": "quote syntax", "committedDate": "2020-09-14T22:04:29Z", "type": "commit"}, {"oid": "34a7bf3fcf6f5bf1340ba78c7974ebbb5e77ef0c", "url": "https://github.com/apache/lucene-solr/commit/34a7bf3fcf6f5bf1340ba78c7974ebbb5e77ef0c", "message": "three components for all version numbers", "committedDate": "2020-09-14T22:05:47Z", "type": "commit"}, {"oid": "c39dc09d51e6c0947fec9b0b2d127ef82fc5e47e", "url": "https://github.com/apache/lucene-solr/commit/c39dc09d51e6c0947fec9b0b2d127ef82fc5e47e", "message": "only major release gets next stable", "committedDate": "2020-09-14T22:23:47Z", "type": "commit"}, {"oid": "916e09b4aca0fab441cc74668e168fed22ae910b", "url": "https://github.com/apache/lucene-solr/commit/916e09b4aca0fab441cc74668e168fed22ae910b", "message": "ant javadoc renamed", "committedDate": "2020-09-14T22:29:37Z", "type": "commit"}, {"oid": "7921e69aece72f542ec9595f4157b50c4363e1b8", "url": "https://github.com/apache/lucene-solr/commit/7921e69aece72f542ec9595f4157b50c4363e1b8", "message": "git pull ff-only", "committedDate": "2020-09-14T22:32:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc2NjY4NQ==", "url": "https://github.com/apache/lucene-solr/pull/1860#discussion_r488766685", "bodyText": "Please remove that file, it wont be used.\nIf release scripts need to edit the version number after a release, /build.gradle is your friend. Theres also a version.base and that's the source of information.\nhttps://github.com/apache/lucene-solr/blob/master/build.gradle#L38\nThere is a reason why this file was removed, so dont restore it!", "author": "uschindler", "createdAt": "2020-09-15T15:37:45Z", "path": "lucene/version.properties", "diffHunk": "@@ -0,0 +1,10 @@\n+# This file contains some version properties as used by various build files.", "originalCommit": "7921e69aece72f542ec9595f4157b50c4363e1b8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc3MTQzMw==", "url": "https://github.com/apache/lucene-solr/pull/1860#discussion_r488771433", "bodyText": "This must be -Dversion.release=%s, as gradle has some reserved meaning of version.", "author": "uschindler", "createdAt": "2020-09-15T15:44:10Z", "path": "dev-tools/scripts/buildAndPushRelease.py", "diffHunk": "@@ -108,37 +107,26 @@ def prepare(root, version, gpgKeyID, gpgPassword):\n   print('  Check DOAP files')\n   checkDOAPfiles(version)\n \n-  print('  ant -Dtests.badapples=false clean validate documentation-lint test')\n-  run('ant -Dtests.badapples=false clean validate documentation-lint test')\n+  print('  ./gradlew -Dtests.badapples=false clean check')\n+  run('./gradlew -Dtests.badapples=false clean check')\n \n   open('rev.txt', mode='wb').write(rev.encode('UTF-8'))\n   \n-  print('  lucene prepare-release')\n-  os.chdir('lucene')\n-  cmd = 'ant -Dversion=%s' % version\n+  print('  prepare-release')\n+  cmd = './gradlew -Dversion=%s clean' % version", "originalCommit": "7921e69aece72f542ec9595f4157b50c4363e1b8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc3MjM3MA==", "url": "https://github.com/apache/lucene-solr/pull/1860#discussion_r488772370", "bodyText": "This must be -Dversion.release=%s, as gradle has some reserved meaning of version.", "author": "uschindler", "createdAt": "2020-09-15T15:45:27Z", "path": "dev-tools/scripts/releaseWizard.yaml", "diffHunk": "@@ -1059,7 +1056,7 @@ groups:\n         logfile: checkout-release-tag.log\n         tee: true\n       - !Command\n-        cmd: ant documentation -Dversion={{ release_version }}\n+        cmd: \"{{ gradle_cmd }} documentation -Dversion={{ release_version }}\"", "originalCommit": "7921e69aece72f542ec9595f4157b50c4363e1b8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}