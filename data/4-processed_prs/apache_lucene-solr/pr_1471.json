{"pr_number": 1471, "pr_title": "SOLR-14014 PR Against Master", "pr_createdAt": "2020-04-30T21:58:03Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1471", "timeline": [{"oid": "26c74d0954ceee8566e27151b42ffb981a2f81bb", "url": "https://github.com/apache/lucene-solr/commit/26c74d0954ceee8566e27151b42ffb981a2f81bb", "message": "Fix typo in `cloud-scripts` path", "committedDate": "2020-04-26T18:29:25Z", "type": "commit"}, {"oid": "9dd4a84b3255afea970bb72d1d18716573b4ae13", "url": "https://github.com/apache/lucene-solr/commit/9dd4a84b3255afea970bb72d1d18716573b4ae13", "message": "t push :Merge branch 'master' of github.com:MarcusSorealheis/lucene-solr\n\n* 'master' of github.com:MarcusSorealheis/lucene-solr:\n  Fix typo in `cloud-scripts` path", "committedDate": "2020-04-28T22:34:28Z", "type": "commit"}, {"oid": "4fbeb9d42095bcdc2cfd687efc15c27bc9f2fe77", "url": "https://github.com/apache/lucene-solr/commit/4fbeb9d42095bcdc2cfd687efc15c27bc9f2fe77", "message": "Merge remote-tracking branch 'upstream/master'\n\n* upstream/master:\n  SOLR-14237: Fix HDFS nightly test failure\n  LUCENE-9278: concatenate paths for sourcepath using path separator rather than whitespace (which causes invalid option to be passed to javadoc).\n  LUCENE-9333: Add gradle task to compile changes.txt to a html (#1468)\n  update CHANGES for #807\n  Fix tests to survive nightly runs with many documents\n  SOLR-14173: Don't use JQuery-Slim as it breaks the sidebar sub-menu system.\n  SOLR-14237: A new panel with security info in admin UI's dashboard\n  SOLR-14237: A new panel with security info in admin UI's dashboard\n  LUCENE-7788: fail precommit on unparameterised log messages and examine for wasted work/objects\n  SOLR-14173: Change left nav item highlighting to fix menu jumpiness when hovering/selecting\n  LUCENE-9349: TermInSetQuery should use consumeMatchingTerms in visit() (#1465)\n  LUCENE-9089: update FST usage example", "committedDate": "2020-04-30T21:40:51Z", "type": "commit"}, {"oid": "55b0c109d4438937dc8719159f90e0cfbcbc34ec", "url": "https://github.com/apache/lucene-solr/commit/55b0c109d4438937dc8719159f90e0cfbcbc34ec", "message": "create a revised PR against master", "committedDate": "2020-04-30T21:54:08Z", "type": "commit"}, {"oid": "896b1454a722a7f96a83a120122d3b55b1a73678", "url": "https://github.com/apache/lucene-solr/commit/896b1454a722a7f96a83a120122d3b55b1a73678", "message": "fix imports", "committedDate": "2020-05-01T07:15:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyMjczMQ==", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418622731", "bodyText": "This clobbers the previous START_OPTS", "author": "madrob", "createdAt": "2020-05-01T16:36:17Z", "path": "solr/bin/solr.cmd", "diffHunk": "@@ -1288,6 +1295,7 @@ REM '-OmitStackTraceInFastThrow' ensures stack traces in errors,\n REM users who don't care about useful error msgs can override in SOLR_OPTS with +OmitStackTraceInFastThrow\n set \"START_OPTS=%START_OPTS% -XX:-OmitStackTraceInFastThrow\"\n set START_OPTS=%START_OPTS% !GC_TUNE! %GC_LOG_OPTS%\n+set START_OPTS=-DdisableAdminUI=%DISABLE_ADMIN_UI%", "originalCommit": "896b1454a722a7f96a83a120122d3b55b1a73678", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3Nzg0Mw==", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418677843", "bodyText": "I believe this one is fixed as well @madrob", "author": "MarcusSorealheis", "createdAt": "2020-05-01T18:37:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyMjczMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyMzA3MA==", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418623070", "bodyText": "It doesn't look like this property is ever passed to the run command?", "author": "madrob", "createdAt": "2020-05-01T16:37:00Z", "path": "solr/bin/solr", "diffHunk": "@@ -2097,6 +2097,14 @@ else\n   SECURITY_MANAGER_OPTS=()\n fi\n \n+# Enable ADMIN UI by default, and give the option for users to disable it\n+if [ \"$SOLR_ADMIN_UI_DISABLED\" == \"true\" ]; then\n+  SOLR_ADMIN_UI=\"-DdisableAdminUI=true\"\n+  echo -e \"ADMIN UI Disabled\"\n+else\n+  SOLR_ADMIN_UI=\"-DdisableAdminUI=false\"", "originalCommit": "896b1454a722a7f96a83a120122d3b55b1a73678", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYzMDEyMQ==", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418630121", "bodyText": "You have to explicitly pass it, or you can pass the system property", "author": "MarcusSorealheis", "createdAt": "2020-05-01T16:53:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyMzA3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY0NDkxNQ==", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418644915", "bodyText": "So if I set SOLR_ADMIN_UI_DISABLED=true in my solr.in.sh, then it sets SOLR_ADMIN_UI=\"-DdisableAdminUI=true\" here, and then... does nothing? Because the SOLR_ADMIN_UI variable is never read. What am I missing?", "author": "madrob", "createdAt": "2020-05-01T17:25:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyMzA3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY0NjEwMA==", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418646100", "bodyText": "Yes, that was an error on my part. I forgot to carry that over from the previous PR. I've added it. See line 2219", "author": "MarcusSorealheis", "createdAt": "2020-05-01T17:28:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyMzA3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3MTIzOQ==", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418671239", "bodyText": "dedcdfe @madrob", "author": "MarcusSorealheis", "createdAt": "2020-05-01T18:22:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyMzA3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyMzQxNA==", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418623414", "bodyText": "nit: did you mean to move these imports around?", "author": "madrob", "createdAt": "2020-05-01T16:37:40Z", "path": "solr/core/src/java/org/apache/solr/servlet/LoadAdminUiServlet.java", "diffHunk": "@@ -15,6 +15,13 @@\n  * limitations under the License.\n  */\n package org.apache.solr.servlet;\n+import javax.servlet.http.HttpServletRequest;", "originalCommit": "896b1454a722a7f96a83a120122d3b55b1a73678", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyOTU2OA==", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418629568", "bodyText": "Yes. I did that because the precommit failed before locally.", "author": "MarcusSorealheis", "createdAt": "2020-05-01T16:51:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyMzQxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyNTU4Mw==", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418625583", "bodyText": "Would this make sense to do before the close shield methods?", "author": "madrob", "createdAt": "2020-05-01T16:42:56Z", "path": "solr/core/src/java/org/apache/solr/servlet/LoadAdminUiServlet.java", "diffHunk": "@@ -24,29 +31,26 @@\n import org.apache.solr.core.CoreContainer;\n import org.apache.solr.core.SolrCore;\n \n-import javax.servlet.http.HttpServletRequest;\n-import javax.servlet.http.HttpServletResponse;\n-\n-import java.io.IOException;\n-import java.io.InputStream;\n-import java.io.OutputStreamWriter;\n-import java.io.Writer;\n-import java.nio.charset.StandardCharsets;\n-\n /**\n  * A simple servlet to load the Solr Admin UI\n  * \n  * @since solr 4.0\n  */\n public final class LoadAdminUiServlet extends BaseSolrServlet {\n \n+  // check system properties for whether or not admin UI is disabled, default is false\n+  private static final boolean disabled = Boolean.parseBoolean(System.getProperty(\"disableAdminUI\", \"false\"));\n+\n   @Override\n-  public void doGet(HttpServletRequest _request,\n-                    HttpServletResponse _response)\n-      throws IOException {\n+  public void doGet(HttpServletRequest _request, HttpServletResponse _response) throws IOException {\n     HttpServletRequest request = SolrDispatchFilter.closeShield(_request, false);\n     HttpServletResponse response = SolrDispatchFilter.closeShield(_response, false);\n-    \n+\n+    if(disabled){", "originalCommit": "896b1454a722a7f96a83a120122d3b55b1a73678", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY4OTY2OQ==", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418689669", "bodyText": "Not in its current state because response object won't exist, but I could refactor if you have a good reason for that. Or, if I think of one. Gonna peep those methods again now.", "author": "MarcusSorealheis", "createdAt": "2020-05-01T19:03:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyNTU4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc3OTc1NQ==", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418779755", "bodyText": "So, I got pulled away by some work. I'll update. I think it makes sense to drop the response before the close shield if possible.", "author": "MarcusSorealheis", "createdAt": "2020-05-01T23:36:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyNTU4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc3OTk4MQ==", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418779981", "bodyText": "I'm testing it now.", "author": "MarcusSorealheis", "createdAt": "2020-05-01T23:38:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyNTU4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIxMDk3MA==", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r419210970", "bodyText": "Handling the raw response works better. Looking at the snippet on this page originally I didn't have the full context. Good suggestion. Thanks \ud83d\udc4d", "author": "MarcusSorealheis", "createdAt": "2020-05-04T04:40:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyNTU4Mw=="}], "type": "inlineReview"}, {"oid": "dedcdfe8b9af18d1a4662937be96b4d710963826", "url": "https://github.com/apache/lucene-solr/commit/dedcdfe8b9af18d1a4662937be96b4d710963826", "message": "add back in the SOLR OPT", "committedDate": "2020-05-01T17:27:13Z", "type": "commit"}, {"oid": "eeced031ad207628ec467a53a046278962f53d7b", "url": "https://github.com/apache/lucene-solr/commit/eeced031ad207628ec467a53a046278962f53d7b", "message": "fix windows start opts.", "committedDate": "2020-05-01T17:54:55Z", "type": "commit"}, {"oid": "5024ec3f1a33da33bf6f78fafb8ce944311530c7", "url": "https://github.com/apache/lucene-solr/commit/5024ec3f1a33da33bf6f78fafb8ce944311530c7", "message": "block the HTTPServletResponse before closeShield", "committedDate": "2020-05-01T23:43:29Z", "type": "commit"}, {"oid": "88040a2ee364ebf08857907c76d998036811ec13", "url": "https://github.com/apache/lucene-solr/commit/88040a2ee364ebf08857907c76d998036811ec13", "message": "fixing docs so that people do not try to add -D java option.", "committedDate": "2020-05-04T17:30:21Z", "type": "commit"}, {"oid": "f12cbe92a2f04e0a88a3750367dd46a8acaf0d92", "url": "https://github.com/apache/lucene-solr/commit/f12cbe92a2f04e0a88a3750367dd46a8acaf0d92", "message": "remove the directives for how to start the app with java properties explicitly.", "committedDate": "2020-05-04T17:34:58Z", "type": "commit"}, {"oid": "d30a14f5622377f028d2320d9c647943d9dd4787", "url": "https://github.com/apache/lucene-solr/commit/d30a14f5622377f028d2320d9c647943d9dd4787", "message": "add set prefix for Windows.", "committedDate": "2020-05-04T17:41:46Z", "type": "commit"}]}