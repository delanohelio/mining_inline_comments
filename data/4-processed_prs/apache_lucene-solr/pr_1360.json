{"pr_number": 1360, "pr_title": "LUCENE-9281: Retire SPIClassIterator from master because Java 9+ uses different mechanism to load services when module system is used", "pr_createdAt": "2020-03-18T12:29:38Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1360", "timeline": [{"oid": "f5aa10a7d8f429e7357c7486d79b08e62e2d553f", "url": "https://github.com/apache/lucene-solr/commit/f5aa10a7d8f429e7357c7486d79b08e62e2d553f", "message": "LUCENE-9281: First mockup of SPIClassIterator retirement", "committedDate": "2020-03-18T12:34:10Z", "type": "commit"}, {"oid": "f5aa10a7d8f429e7357c7486d79b08e62e2d553f", "url": "https://github.com/apache/lucene-solr/commit/f5aa10a7d8f429e7357c7486d79b08e62e2d553f", "message": "LUCENE-9281: First mockup of SPIClassIterator retirement", "committedDate": "2020-03-18T12:34:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTU0OTc2Ng==", "url": "https://github.com/apache/lucene-solr/pull/1360#discussion_r395549766", "bodyText": "This could be package private (since the original method was not public and still this is called only from classes in the same package)?", "author": "mocobeta", "createdAt": "2020-03-20T10:30:07Z", "path": "lucene/analysis/common/src/java/org/apache/lucene/analysis/util/AnalysisSPILoader.java", "diffHunk": "@@ -143,6 +144,24 @@ public S newInstance(String name, Map<String,String> args) {\n   public Set<String> availableServices() {\n     return originalNames;\n   }  \n+\n+  /**\n+   * Looks up SPI name (static \"NAME\" field) with appropriate modifiers.\n+   * Also it must be a String class and declared in the concrete class.\n+   * @return the SPI name\n+   * @throws NoSuchFieldException - if the \"NAME\" field is not defined.\n+   * @throws IllegalAccessException - if the \"NAME\" field is inaccessible.\n+   * @throws IllegalStateException - if the \"NAME\" field does not have appropriate modifiers or isn't a String field.\n+   */\n+  public static String lookupSPIName(Class<? extends AbstractAnalysisFactory> service) throws NoSuchFieldException, IllegalAccessException, IllegalStateException {", "originalCommit": "f5aa10a7d8f429e7357c7486d79b08e62e2d553f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzMzNjc1Mw==", "url": "https://github.com/apache/lucene-solr/pull/1360#discussion_r397336753", "bodyText": "I thought that this method is useful if you want to figure out the name of a factory where you only have class reference. There is no reason to hide it.", "author": "uschindler", "createdAt": "2020-03-24T17:32:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTU0OTc2Ng=="}], "type": "inlineReview"}, {"oid": "6775c0ca029d136d9323f3f1dff2252d293840f8", "url": "https://github.com/apache/lucene-solr/commit/6775c0ca029d136d9323f3f1dff2252d293840f8", "message": "Merge branch 'master' of https://gitbox.apache.org/repos/asf/lucene-solr into jira/LUCENE-9281", "committedDate": "2020-03-24T16:18:15Z", "type": "commit"}, {"oid": "1b5c3e5647fe70471be09b6b750d8b3cca3230fb", "url": "https://github.com/apache/lucene-solr/commit/1b5c3e5647fe70471be09b6b750d8b3cca3230fb", "message": "LUCENE-9281: Add empty ctor to all factories to make them compatible with SPI requirements enforced by ServiceLoader", "committedDate": "2020-03-24T17:29:34Z", "type": "commit"}, {"oid": "c0183775684fc61f230113b0690d51dfad04e20e", "url": "https://github.com/apache/lucene-solr/commit/c0183775684fc61f230113b0690d51dfad04e20e", "message": "LUCENE-9281: Javadocs updates and formatting changes", "committedDate": "2020-03-25T13:30:42Z", "type": "commit"}, {"oid": "d90d1b35e5b37a89220c5f4a3f1fb9efca414bf3", "url": "https://github.com/apache/lucene-solr/commit/d90d1b35e5b37a89220c5f4a3f1fb9efca414bf3", "message": "LUCENE-9281: Add migration guide and changes entry", "committedDate": "2020-03-25T13:51:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk0Njc3Ng==", "url": "https://github.com/apache/lucene-solr/pull/1360#discussion_r397946776", "bodyText": "i did nothing here and had no idea about this issue...", "author": "mocobeta", "createdAt": "2020-03-25T15:29:30Z", "path": "lucene/CHANGES.txt", "diffHunk": "@@ -47,6 +47,13 @@ API Changes\n * LUCENE-9264: SimpleFSDirectory has been removed in favor of NIOFSDirectory.\n   (Yannick Welsch)\n \n+* LUCENE-9281: Use java.util.ServiceLoader to load codec components and analysis\n+  factories to be compatible with Java Module System. This allows to load factories\n+  without META-INF/service from a Java module exposing the factory in the module\n+  descriptor. This breaks backwards compatibility as custom factories must now\n+  also implement the default constructor (see MIGRATE.txt).\n+  (Uwe Schindler, Dawid Weiss, Tomoko Uchida)", "originalCommit": "d90d1b35e5b37a89220c5f4a3f1fb9efca414bf3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk1NTM3Mw==", "url": "https://github.com/apache/lucene-solr/pull/1360#discussion_r397955373", "bodyText": "Removed you, I just added you because you were doing a lot of preparatory work and also commented on some changes.", "author": "uschindler", "createdAt": "2020-03-25T15:40:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk0Njc3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAxNDU2Nw==", "url": "https://github.com/apache/lucene-solr/pull/1360#discussion_r398014567", "bodyText": "Thanks... I just looked through the changes and approved (though i don't fully understand about it).", "author": "mocobeta", "createdAt": "2020-03-25T16:56:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk0Njc3Ng=="}], "type": "inlineReview"}, {"oid": "9d792a6a2b701701125cdcec02f96bcd9cced6e1", "url": "https://github.com/apache/lucene-solr/commit/9d792a6a2b701701125cdcec02f96bcd9cced6e1", "message": "LUCENE-9281: Remove Tomoko from CHANGES.txt", "committedDate": "2020-03-25T15:38:50Z", "type": "commit"}, {"oid": "b97449c0075561ff3bfdc76a03b52a0eebcda48c", "url": "https://github.com/apache/lucene-solr/commit/b97449c0075561ff3bfdc76a03b52a0eebcda48c", "message": "LUCENE-9281: be more specific in CHANGES.txt", "committedDate": "2020-03-25T16:22:43Z", "type": "commit"}]}