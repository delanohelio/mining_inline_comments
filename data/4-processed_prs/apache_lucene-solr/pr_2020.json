{"pr_number": 2020, "pr_title": "SOLR-14949: Ability to customize Solr Docker build", "pr_createdAt": "2020-10-22T15:40:23Z", "pr_url": "https://github.com/apache/lucene-solr/pull/2020", "timeline": [{"oid": "407d9cfc38476c27bc720b23a29783d490bb4721", "url": "https://github.com/apache/lucene-solr/commit/407d9cfc38476c27bc720b23a29783d490bb4721", "message": "SOLR-14949: Ability to customize Solr Docker build\n\nCustom inputs:\n- Docker Image repo\n- Docker Image tag\n- Docker Image name\n- Base Docker Image\n\nAlso added a gradlew helpDocker page.", "committedDate": "2020-10-22T15:37:58Z", "type": "commit"}, {"oid": "147a16faed5ef5337f62f8ba305f9088d0c2d7c4", "url": "https://github.com/apache/lucene-solr/commit/147a16faed5ef5337f62f8ba305f9088d0c2d7c4", "message": "Removing unnecessary version test. We can add something when adding a release process.", "committedDate": "2020-10-22T16:31:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk2OTU3OA==", "url": "https://github.com/apache/lucene-solr/pull/2020#discussion_r510969578", "bodyText": "Should this be solr.docker instead of docker.solr?", "author": "madrob", "createdAt": "2020-10-23T15:35:08Z", "path": "help/docker.txt", "diffHunk": "@@ -0,0 +1,53 @@\n+Docker Images for Solr\n+======================\n+\n+Solr docker images are built using Palantir's Docker Gradle plugin, https://github.com/palantir/gradle-docker.\n+\n+Common Inputs\n+-------------\n+\n+The docker image and it's tag can be customized via the following options, all accepted via both Environment Variables and Gradle Properties.\n+\n+Docker Image Repository:\n+   Default: \"apache/solr\"\n+   EnvVar: DOCKER_SOLR_IMAGE_REPO\n+   Gradle Property: -Pdocker.solr.imageRepo", "originalCommit": "147a16faed5ef5337f62f8ba305f9088d0c2d7c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk5NzA5Mg==", "url": "https://github.com/apache/lucene-solr/pull/2020#discussion_r510997092", "bodyText": "I could go either way.\nSay we add a prometheus exporter. Which would we prefer?\n\ndocker.solr.imageRepo and docker.prometheusExporter.imageRepo\nsolr.docker.imageRepo and prometheusExporter.docker.imageRepo", "author": "HoustonPutman", "createdAt": "2020-10-23T16:20:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk2OTU3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjgyNTI1MA==", "url": "https://github.com/apache/lucene-solr/pull/2020#discussion_r512825250", "bodyText": "Nevermind, I agree with you. Made the changes.", "author": "HoustonPutman", "createdAt": "2020-10-27T16:06:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk2OTU3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4NjU2MA==", "url": "https://github.com/apache/lucene-solr/pull/2020#discussion_r510986560", "bodyText": "s/it's/its", "author": "madrob", "createdAt": "2020-10-23T16:02:40Z", "path": "help/docker.txt", "diffHunk": "@@ -0,0 +1,53 @@\n+Docker Images for Solr\n+======================\n+\n+Solr docker images are built using Palantir's Docker Gradle plugin, https://github.com/palantir/gradle-docker.\n+\n+Common Inputs\n+-------------\n+\n+The docker image and it's tag can be customized via the following options, all accepted via both Environment Variables and Gradle Properties.", "originalCommit": "147a16faed5ef5337f62f8ba305f9088d0c2d7c4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4NjkwMQ==", "url": "https://github.com/apache/lucene-solr/pull/2020#discussion_r510986901", "bodyText": "Does this mean we will publish all of our PR docker images somewhere?", "author": "madrob", "createdAt": "2020-10-23T16:03:18Z", "path": ".github/workflows/docker-test.yml", "diffHunk": "@@ -17,6 +17,10 @@ jobs:\n \n     runs-on: ubuntu-latest\n \n+    env:\n+      DOCKER_SOLR_IMAGE_REPO: github-pr/solr", "originalCommit": "147a16faed5ef5337f62f8ba305f9088d0c2d7c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk5NTYwOA==", "url": "https://github.com/apache/lucene-solr/pull/2020#discussion_r510995608", "bodyText": "nah this doesn't actually push. It's just testing that the custom repo/tag works.\nI'm pretty sure it would fail if it tried, because github-pr isn't a docker hub repo.", "author": "HoustonPutman", "createdAt": "2020-10-23T16:18:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4NjkwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4ODExMg==", "url": "https://github.com/apache/lucene-solr/pull/2020#discussion_r510988112", "bodyText": "This is displayed as plain text, not markdown.", "author": "madrob", "createdAt": "2020-10-23T16:05:23Z", "path": "help/docker.txt", "diffHunk": "@@ -0,0 +1,53 @@\n+Docker Images for Solr\n+======================\n+\n+Solr docker images are built using Palantir's Docker Gradle plugin, https://github.com/palantir/gradle-docker.\n+\n+Common Inputs\n+-------------\n+\n+The docker image and it's tag can be customized via the following options, all accepted via both Environment Variables and Gradle Properties.\n+\n+Docker Image Repository:\n+   Default: \"apache/solr\"\n+   EnvVar: DOCKER_SOLR_IMAGE_REPO\n+   Gradle Property: -Pdocker.solr.imageRepo\n+\n+Docker Image Tag:\n+   Default: the Solr version, e.g. \"9.0.0-SNAPSHOT\"\n+   EnvVar: DOCKER_SOLR_IMAGE_TAG\n+   Gradle Property: -Pdocker.solr.imageTag\n+\n+Docker Image Name: (Use this to explicitly set a whole image name. If given, the image repo and image version options above are ignored.)\n+   Default: {image_repo}/{image_tag} (both options provided above, with defaults)\n+   EnvVar: DOCKER_SOLR_IMAGE_NAME\n+   Gradle Property: -Pdocker.solr.imageName\n+\n+Building\n+--------\n+\n+In order to build the Solr Docker image, run:\n+\n+gradlew docker\n+\n+The docker build task (`gradlew docker`) accepts the following inputs, in addition to the common inputs listed above:", "originalCommit": "147a16faed5ef5337f62f8ba305f9088d0c2d7c4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4OTYzNg==", "url": "https://github.com/apache/lucene-solr/pull/2020#discussion_r510989636", "bodyText": "Deleted because we can set the tag and version to be anything now?", "author": "madrob", "createdAt": "2020-10-23T16:07:52Z", "path": "solr/docker/tests/cases/version/test.sh", "diffHunk": "@@ -1,45 +0,0 @@\n-#!/bin/bash", "originalCommit": "147a16faed5ef5337f62f8ba305f9088d0c2d7c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk5NDk5OQ==", "url": "https://github.com/apache/lucene-solr/pull/2020#discussion_r510994999", "bodyText": "Yeah, this is something that might be useful when we start creating release artifacts, but the test we want will probably look quite different. This is pretty shallow and doesn't actually provide a whole lot.", "author": "HoustonPutman", "createdAt": "2020-10-23T16:17:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4OTYzNg=="}], "type": "inlineReview"}, {"oid": "3c7aab02a1d6829fc4be87793e8b38e5d5c99b42", "url": "https://github.com/apache/lucene-solr/commit/3c7aab02a1d6829fc4be87793e8b38e5d5c99b42", "message": "Fixes in docker help.", "committedDate": "2020-10-23T16:29:29Z", "type": "commit"}, {"oid": "b9de1a0475d124f14dcd49468408acede71bc5f6", "url": "https://github.com/apache/lucene-solr/commit/b9de1a0475d124f14dcd49468408acede71bc5f6", "message": "Merge branch 'master' into docker-inputs", "committedDate": "2020-10-27T15:58:09Z", "type": "commit"}, {"oid": "5faf73587dbbcbcdb05dcf818481cf17f86df223", "url": "https://github.com/apache/lucene-solr/commit/5faf73587dbbcbcdb05dcf818481cf17f86df223", "message": "Changing to solr.docker instead of docker.solr", "committedDate": "2020-10-27T16:05:53Z", "type": "commit"}, {"oid": "b7f8e136173b93eca702ce9f1a41edd1f8561be8", "url": "https://github.com/apache/lucene-solr/commit/b7f8e136173b93eca702ce9f1a41edd1f8561be8", "message": "Fixing changes.txt mistake", "committedDate": "2020-10-27T16:08:12Z", "type": "commit"}, {"oid": "71e93fdf5938157db75580f1a8f05d6aed26f0a0", "url": "https://github.com/apache/lucene-solr/commit/71e93fdf5938157db75580f1a8f05d6aed26f0a0", "message": "Merge branch 'master' into docker-inputs", "committedDate": "2020-11-06T18:19:27Z", "type": "commit"}]}