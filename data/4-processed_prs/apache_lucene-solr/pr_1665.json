{"pr_number": 1665, "pr_title": "SOLR-11262: XML writer implements writeMap and writeIterator", "pr_createdAt": "2020-07-11T07:18:38Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1665", "timeline": [{"oid": "d7346409465cfc2d44e153b1ff592f36d32c6f66", "url": "https://github.com/apache/lucene-solr/commit/d7346409465cfc2d44e153b1ff592f36d32c6f66", "message": "SOLR-11262: XML writer implements writeMap and writeIterator", "committedDate": "2020-07-11T07:16:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2Njk2NA==", "url": "https://github.com/apache/lucene-solr/pull/1665#discussion_r453166964", "bodyText": "what is this LocalSolrQueryRequest for?", "author": "noblepaul", "createdAt": "2020-07-11T07:22:37Z", "path": "solr/core/src/test/org/apache/solr/response/TestPushWriter.java", "diffHunk": "@@ -45,26 +46,47 @@\n \n   public void testStandardResponse() throws IOException {\n     ByteArrayOutputStream baos = new ByteArrayOutputStream();\n-    OutputStreamWriter osw = new OutputStreamWriter(baos, StandardCharsets.UTF_8);\n-    PushWriter pw = new JSONWriter(osw,\n-        new LocalSolrQueryRequest(null, new ModifiableSolrParams()), new SolrQueryResponse());\n-    writeData(pw);\n-    osw.flush();\n-    if (log.isInfoEnabled()) {\n-      log.info(\"{}\", new String(baos.toByteArray(), StandardCharsets.UTF_8));\n+    Map m;\n+    try (OutputStreamWriter osw = new OutputStreamWriter(baos, StandardCharsets.UTF_8)) {\n+      JSONWriter pw = new JSONWriter(osw,\n+          new LocalSolrQueryRequest(null, new ModifiableSolrParams()), new SolrQueryResponse());\n+      writeData(null, pw);\n+      osw.flush();\n+      if (log.isInfoEnabled()) {\n+        log.info(\"{}\", new String(baos.toByteArray(), StandardCharsets.UTF_8));\n+      }\n+      m = (Map) Utils.fromJSON(baos.toByteArray());\n+      checkValues(m);\n     }\n-    @SuppressWarnings({\"rawtypes\"})\n-    Map m = (Map) Utils.fromJSON(baos.toByteArray());\n-    checkValues(m);\n+\n     try (JavaBinCodec jbc = new JavaBinCodec(baos= new ByteArrayOutputStream(), null)) {\n       writeData(jbc);\n-      try (JavaBinCodec jbcUn = new JavaBinCodec()) {\n-        m = (Map) jbcUn.unmarshal(new ByteArrayInputStream(baos.toByteArray()));\n-      }\n+      m = (Map) Utils.fromJavabin(baos.toByteArray());\n     }\n     checkValues(m);\n   }\n \n+  public void testXmlWriter() throws Exception {\n+    try (ByteArrayOutputStream baos = new ByteArrayOutputStream();\n+        OutputStreamWriter osw = new OutputStreamWriter(baos, StandardCharsets.UTF_8)) {\n+      XMLWriter xml = new XMLWriter(osw,\n+          new LocalSolrQueryRequest(null, new ModifiableSolrParams()), new SolrQueryResponse());", "originalCommit": "d7346409465cfc2d44e153b1ff592f36d32c6f66", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2OTE2MA==", "url": "https://github.com/apache/lucene-solr/pull/1665#discussion_r453169160", "bodyText": "XmlWriter takes SolrQueryRequest as one of the arg. so, I have created localSolrQueryRequest", "author": "munendrasn", "createdAt": "2020-07-11T07:51:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2Njk2NA=="}], "type": "inlineReview"}, {"oid": "9985691e6713ec570da74da36e7d9ce9ae9e444d", "url": "https://github.com/apache/lucene-solr/commit/9985691e6713ec570da74da36e7d9ce9ae9e444d", "message": "SOLR-11262: fix gradle precommit failure", "committedDate": "2020-07-11T08:17:53Z", "type": "commit"}, {"oid": "b3c36e7001bf74f89c376f458683fac0cec847a5", "url": "https://github.com/apache/lucene-solr/commit/b3c36e7001bf74f89c376f458683fac0cec847a5", "message": "SOLR-11262: add changes.txt entry", "committedDate": "2020-07-12T14:36:02Z", "type": "commit"}]}