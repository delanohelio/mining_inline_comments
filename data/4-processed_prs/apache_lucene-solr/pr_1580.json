{"pr_number": 1580, "pr_title": "LUCENE-9405: Ensure IndexWriter only closes merge readers once.", "pr_createdAt": "2020-06-15T19:33:04Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1580", "timeline": [{"oid": "601501947c724a2327c973e42fa67f4e36c7081a", "url": "https://github.com/apache/lucene-solr/commit/601501947c724a2327c973e42fa67f4e36c7081a", "message": "LUCENE-9405: Ensure IndexWriter only closes merge readers once.\n\nIndexWriter incorrectly calls closeMergeReaders twice when the\nmerged segment is 100% deleted ie. would produce a fully deleted\nsegment.", "committedDate": "2020-06-15T19:31:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQwMzQ3OQ==", "url": "https://github.com/apache/lucene-solr/pull/1580#discussion_r440403479", "bodyText": "Maybe also add @msfroh (Michael Froh)?  -- I think he fixed this originally in the first PR.", "author": "mikemccand", "createdAt": "2020-06-15T19:39:35Z", "path": "lucene/CHANGES.txt", "diffHunk": "@@ -266,6 +266,9 @@ Bug Fixes\n * LUCENE-9362: Fix equality check in ExpressionValueSource#rewrite. This fixes rewriting of inner value sources.\n   (Dmitry Emets)\n \n+* LUCENE-9405: IndexWriter incorrectly calls closeMergeReaders twice when the merged segment is 100% deleted.\n+  (Simon Willnauer, Mike Mccandless, Mike Sokolov)", "originalCommit": "601501947c724a2327c973e42fa67f4e36c7081a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQwNTIyNg==", "url": "https://github.com/apache/lucene-solr/pull/1580#discussion_r440405226", "bodyText": "yeah, and you can remove me - I am just a conduit!", "author": "msokolov", "createdAt": "2020-06-15T19:42:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQwMzQ3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQwNTQ3NA==", "url": "https://github.com/apache/lucene-solr/pull/1580#discussion_r440405474", "bodyText": "I added him, thanks for pointing this out.", "author": "s1monw", "createdAt": "2020-06-15T19:43:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQwMzQ3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQwNTY5Mg==", "url": "https://github.com/apache/lucene-solr/pull/1580#discussion_r440405692", "bodyText": "I will keep you anyways @msokolov", "author": "s1monw", "createdAt": "2020-06-15T19:43:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQwMzQ3OQ=="}], "type": "inlineReview"}, {"oid": "b6c2d11cca7bfbe408577d8de4c0a060d2e2878a", "url": "https://github.com/apache/lucene-solr/commit/b6c2d11cca7bfbe408577d8de4c0a060d2e2878a", "message": "add Michael Froh to changes since he found this issue originally", "committedDate": "2020-06-15T19:42:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQwNTYxMw==", "url": "https://github.com/apache/lucene-solr/pull/1580#discussion_r440405613", "bodyText": "Thanks for the test", "author": "msokolov", "createdAt": "2020-06-15T19:43:40Z", "path": "lucene/core/src/test/org/apache/lucene/index/TestIndexWriter.java", "diffHunk": "@@ -4167,4 +4167,38 @@ public void testSegmentCommitInfoId() throws IOException {\n       }\n     }\n   }\n+\n+  public void testMergeZeroDocsMergeIsClosedOnce() throws IOException {", "originalCommit": "601501947c724a2327c973e42fa67f4e36c7081a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}