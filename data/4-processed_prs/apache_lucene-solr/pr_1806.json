{"pr_number": 1806, "pr_title": "LUCENE-9475: Switch validateSourcePatterns away from Ant legacy", "pr_createdAt": "2020-08-30T23:40:17Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1806", "timeline": [{"oid": "82cfc1afd32305e68c5afec249400334318d5fb8", "url": "https://github.com/apache/lucene-solr/commit/82cfc1afd32305e68c5afec249400334318d5fb8", "message": "LUCENE-9475: Switch validateSourcePatters away from Ant legacy", "committedDate": "2020-08-30T23:37:19Z", "type": "commit"}, {"oid": "b249b2d9fcd83c0d658afa726ff5c3b6a9d42c60", "url": "https://github.com/apache/lucene-solr/commit/b249b2d9fcd83c0d658afa726ff5c3b6a9d42c60", "message": "Use gradle FileTree instead of Ant's FileScanner (in prepartion to inputs for this task)", "committedDate": "2020-08-31T09:17:03Z", "type": "commit"}, {"oid": "8f68caae693d826208caea3bf436a0ce29a1bc14", "url": "https://github.com/apache/lucene-solr/commit/8f68caae693d826208caea3bf436a0ce29a1bc14", "message": "Merge branch 'master' of https://gitbox.apache.org/repos/asf/lucene-solr into jira/LUCENE-9475", "committedDate": "2020-08-31T09:21:57Z", "type": "commit"}, {"oid": "3edd1b520fd98b0b0e63b66db6f61cf9e71efff2", "url": "https://github.com/apache/lucene-solr/commit/3edd1b520fd98b0b0e63b66db6f61cf9e71efff2", "message": "Convert the task to a class; add @InputFiles (please note we need outputs.uptodateWhen(true), see gradle docs!)", "committedDate": "2020-08-31T10:01:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDAzMDk5MQ==", "url": "https://github.com/apache/lucene-solr/pull/1806#discussion_r480030991", "bodyText": "I would move it to the class's constructor? Then inputs and outputs are consistently in the same code.", "author": "dweiss", "createdAt": "2020-08-31T10:17:09Z", "path": "gradle/validation/validate-source-patterns.gradle", "diffHunk": "@@ -15,27 +15,233 @@\n  * limitations under the License.\n  */\n \n-// This should be eventually rewritten in plain gradle. For now, delegate to\n-// the ant/groovy script we already have.\n+import org.apache.rat.Defaults;\n+import org.apache.rat.document.impl.FileDocument;\n+import org.apache.rat.api.MetaData;\n \n-configure(rootProject) {\n-  configurations {\n-    checkSourceDeps\n+buildscript {\n+  repositories {\n+    mavenCentral()\n   }\n \n   dependencies {\n-    checkSourceDeps \"org.codehaus.groovy:groovy-all:2.4.17\"\n-    checkSourceDeps \"org.apache.rat:apache-rat:${scriptDepVersions['apache-rat']}\"\n+    classpath \"org.apache.rat:apache-rat:${scriptDepVersions['apache-rat']}\"\n+  }\n+}\n+\n+configure(rootProject) {\n+  task(\"validateSourcePatterns\", type: ValidateSourcePatternsTask) {\n+    group = 'Verification'\n+    description = 'Validate Source Patterns'\n+    \n+    // this task has no outputs, so it's always uptodate (if inputs don't change).\n+    outputs.upToDateWhen { true }", "originalCommit": "3edd1b520fd98b0b0e63b66db6f61cf9e71efff2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDAzMTMwMg==", "url": "https://github.com/apache/lucene-solr/pull/1806#discussion_r480031302", "bodyText": "And this I'd move to the task declaration block (so that it's not hardcoded but configured :)", "author": "dweiss", "createdAt": "2020-08-31T10:17:52Z", "path": "gradle/validation/validate-source-patterns.gradle", "diffHunk": "@@ -15,27 +15,233 @@\n  * limitations under the License.\n  */\n \n-// This should be eventually rewritten in plain gradle. For now, delegate to\n-// the ant/groovy script we already have.\n+import org.apache.rat.Defaults;\n+import org.apache.rat.document.impl.FileDocument;\n+import org.apache.rat.api.MetaData;\n \n-configure(rootProject) {\n-  configurations {\n-    checkSourceDeps\n+buildscript {\n+  repositories {\n+    mavenCentral()\n   }\n \n   dependencies {\n-    checkSourceDeps \"org.codehaus.groovy:groovy-all:2.4.17\"\n-    checkSourceDeps \"org.apache.rat:apache-rat:${scriptDepVersions['apache-rat']}\"\n+    classpath \"org.apache.rat:apache-rat:${scriptDepVersions['apache-rat']}\"\n+  }\n+}\n+\n+configure(rootProject) {\n+  task(\"validateSourcePatterns\", type: ValidateSourcePatternsTask) {\n+    group = 'Verification'\n+    description = 'Validate Source Patterns'\n+    \n+    // this task has no outputs, so it's always uptodate (if inputs don't change).\n+    outputs.upToDateWhen { true }\n   }\n+}\n+\n+class ValidateSourcePatternsTask extends DefaultTask {\n+\n+  @InputFiles\n+  final ConfigurableFileTree sourceFiles = project.fileTree(project.rootDir) {\n+    [", "originalCommit": "3edd1b520fd98b0b0e63b66db6f61cf9e71efff2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1224f6be3aa004202ad0de0dc23ab17cefe7a3cc", "url": "https://github.com/apache/lucene-solr/commit/1224f6be3aa004202ad0de0dc23ab17cefe7a3cc", "message": "Improve logging (especially for the debug case)", "committedDate": "2020-08-31T10:20:27Z", "type": "commit"}, {"oid": "d4b7cdd96285c144b343a71f31f1539c02350022", "url": "https://github.com/apache/lucene-solr/commit/d4b7cdd96285c144b343a71f31f1539c02350022", "message": "Apply Dawid's changes", "committedDate": "2020-08-31T10:35:10Z", "type": "commit"}]}