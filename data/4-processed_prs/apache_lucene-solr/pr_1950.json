{"pr_number": 1950, "pr_title": "LUCENE-9564: add spotless and gjf.", "pr_createdAt": "2020-10-06T07:38:12Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1950", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQwMTUwMw==", "url": "https://github.com/apache/lucene-solr/pull/1950#discussion_r501401503", "bodyText": "can we exempt other generated files? Otherwise it will make a lot of regeneration tasks stuff no longer idempotent.", "author": "rmuir", "createdAt": "2020-10-08T01:40:42Z", "path": "gradle/validation/spotless.gradle", "diffHunk": "@@ -0,0 +1,31 @@\n+\n+def resources = scriptResources(buildscript)\n+ \n+allprojects { prj ->\n+  plugins.withType(JavaPlugin) {\n+    prj.apply plugin: 'com.diffplug.spotless'\n+\n+    spotless {\n+      java {\n+        licenseHeaderFile file(\"${resources}/asl-header.txt\"), '^(\\\\s*package)'\n+        lineEndings 'UNIX'\n+        endWithNewline()\n+        googleJavaFormat('1.9')\n+\n+        // Known problematic files.\n+        targetExclude \"**/HTMLStripCharFilter.java\", \"**/UAX29URLEmailTokenizerImpl.java\", \n+           \"**/PatternParser.java\", \"**/BuildNavDataFiles.java\", \"**/CheckLinksAndAnchors.java\",\n+           \"**/TestSubQueryTransformer.java\"", "originalCommit": "1083eefa88095dbac473a7917342f7a61b0d3cff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQ3MzM4MA==", "url": "https://github.com/apache/lucene-solr/pull/1950#discussion_r501473380", "bodyText": "I was thinking the other way around, actually always apply formatting after they run so that you get the same code in the output after regenerating these source files. This should be idempotent and have clean formatting too.\nI excluded these particular files because they break the formatter... Some of them have no package and others cause stack overflows - google/google-java-format#528", "author": "dweiss", "createdAt": "2020-10-08T06:20:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQwMTUwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQ4ODc2Ng==", "url": "https://github.com/apache/lucene-solr/pull/1950#discussion_r501488766", "bodyText": "sorry, wrong button click. I still think this might be the wrong tradeoff. while it might make the gradle look simpler, it makes it awful for the one trying to work with the actual regeneration, it is really hard to keep in working correctly.", "author": "rmuir", "createdAt": "2020-10-08T06:58:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQwMTUwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQ5Mjc3Mw==", "url": "https://github.com/apache/lucene-solr/pull/1950#discussion_r501492773", "bodyText": "Ok, fair enough. I also suggested elsewhere that we might want to just move those generated files into a different sourceset so that it's clear they are generated and they can be wiped easier upon regeneration. Or is there value in keeping them together, do you think?", "author": "dweiss", "createdAt": "2020-10-08T07:07:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQwMTUwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUxMTkyOA==", "url": "https://github.com/apache/lucene-solr/pull/1950#discussion_r501511928", "bodyText": "its worth thinking about yeah. if there was a consolidated list of them maybe it would make other tasks more intuitive: e.g. remove the crazy \"Generated\" matching that's in RAT and simply exclude them from license analysis too.", "author": "rmuir", "createdAt": "2020-10-08T07:43:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQwMTUwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUxOTQ3OQ==", "url": "https://github.com/apache/lucene-solr/pull/1950#discussion_r501519479", "bodyText": "Ok, I'll see what can be done when I get there.", "author": "dweiss", "createdAt": "2020-10-08T07:56:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQwMTUwMw=="}], "type": "inlineReview"}, {"oid": "2500dfac923d5f9d8656efdc825f036cc879dca5", "url": "https://github.com/apache/lucene-solr/commit/2500dfac923d5f9d8656efdc825f036cc879dca5", "message": "LUCENE-9564: add spotless and gjf.", "committedDate": "2020-12-17T10:41:17Z", "type": "commit"}, {"oid": "51b8b451ba0ebca3d21e4b8118ccbeedbc13e104", "url": "https://github.com/apache/lucene-solr/commit/51b8b451ba0ebca3d21e4b8118ccbeedbc13e104", "message": "Excluded problematic files that have comments inside imports or just break the formatter. :)", "committedDate": "2020-12-17T10:41:18Z", "type": "commit"}, {"oid": "51b8b451ba0ebca3d21e4b8118ccbeedbc13e104", "url": "https://github.com/apache/lucene-solr/commit/51b8b451ba0ebca3d21e4b8118ccbeedbc13e104", "message": "Excluded problematic files that have comments inside imports or just break the formatter. :)", "committedDate": "2020-12-17T10:41:18Z", "type": "forcePushed"}, {"oid": "2fec8325e3b51be81219bd0d661eefca41b749bd", "url": "https://github.com/apache/lucene-solr/commit/2fec8325e3b51be81219bd0d661eefca41b749bd", "message": "Update spotless. Reconfigure so that incremental reformats are possible.", "committedDate": "2020-12-17T11:05:20Z", "type": "commit"}, {"oid": "2dae3dbc71b2b7dd0fb8a1cda9449992dfecf67e", "url": "https://github.com/apache/lucene-solr/commit/2dae3dbc71b2b7dd0fb8a1cda9449992dfecf67e", "message": "Exclude generated files.", "committedDate": "2020-12-17T11:09:48Z", "type": "commit"}, {"oid": "fa4d0af42622341e369f5115ff6eef6bc3b7c27d", "url": "https://github.com/apache/lucene-solr/commit/fa4d0af42622341e369f5115ff6eef6bc3b7c27d", "message": "Add a little help about automatic formatting.", "committedDate": "2020-12-17T11:18:16Z", "type": "commit"}, {"oid": "1ed8c8e6eee97c3d05bf35a7aff0cf922ba06e8b", "url": "https://github.com/apache/lucene-solr/commit/1ed8c8e6eee97c3d05bf35a7aff0cf922ba06e8b", "message": "Restructure the initial configuration so that it doesn't change anything in all java projects.", "committedDate": "2020-12-17T11:38:43Z", "type": "commit"}]}