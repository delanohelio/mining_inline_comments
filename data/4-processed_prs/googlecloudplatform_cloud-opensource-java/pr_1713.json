{"pr_number": 1713, "pr_title": "add commands to run Rapid", "pr_createdAt": "2020-10-16T18:05:06Z", "pr_url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1713", "timeline": [{"oid": "fbe1175b38dde18c9ac21f7ba77d4aef82b488da", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/fbe1175b38dde18c9ac21f7ba77d4aef82b488da", "message": "add commands to run Rapid", "committedDate": "2020-10-16T18:04:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY1MDc1Nw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1713#discussion_r506650757", "bodyText": "script name", "author": "suztomo", "createdAt": "2020-10-16T18:24:08Z", "path": "scripts/release_bom.sh", "diffHunk": "@@ -0,0 +1,114 @@\n+#!/bin/bash -\n+# Usage: ./prepare_release.sh <dependencies|bom> <release version>", "originalCommit": "fbe1175b38dde18c9ac21f7ba77d4aef82b488da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzA4NjMzNg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1713#discussion_r507086336", "bodyText": "done", "author": "elharo", "createdAt": "2020-10-18T10:37:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY1MDc1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY1MDg2Nw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1713#discussion_r506650867", "bodyText": "Script name", "author": "suztomo", "createdAt": "2020-10-16T18:24:23Z", "path": "scripts/release_bom.sh", "diffHunk": "@@ -0,0 +1,114 @@\n+#!/bin/bash -\n+# Usage: ./prepare_release.sh <dependencies|bom> <release version>\n+\n+set -e\n+\n+EchoRed() {\n+  echo \"$(tput setaf 1; tput bold)$1$(tput sgr0)\"\n+}\n+EchoGreen() {\n+  echo \"$(tput setaf 2; tput bold)$1$(tput sgr0)\"\n+}\n+\n+Die() {\n+  EchoRed \"$1\"\n+  exit 1\n+}\n+\n+DieUsage() {\n+  Die \"Usage: ./prepare_release.sh <dependencies|bom> <release version> [<post-release-version>]\"", "originalCommit": "fbe1175b38dde18c9ac21f7ba77d4aef82b488da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY3NjgyMQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1713#discussion_r506676821", "bodyText": "done", "author": "elharo", "createdAt": "2020-10-16T19:20:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY1MDg2Nw=="}], "type": "inlineReview"}, {"oid": "c97fc38ec15883f66e4e12b83d6ee400eb7e0b7b", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/c97fc38ec15883f66e4e12b83d6ee400eb7e0b7b", "message": "Update release_bom.sh", "committedDate": "2020-10-16T19:20:16Z", "type": "commit"}, {"oid": "eb29944c9d137445cc44a30cfa7f1e679fa2fb99", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/eb29944c9d137445cc44a30cfa7f1e679fa2fb99", "message": "To use g4d functionality in a script, you'll need to use `p4 g4d`.", "committedDate": "2020-10-16T19:26:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzA5NTE5Ng==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1713#discussion_r507095196", "bodyText": "period turns out not to be an allowed character in CITC client names, but we can substitute an underscore.", "author": "elharo", "createdAt": "2020-10-18T11:03:16Z", "path": "scripts/release_bom.sh", "diffHunk": "@@ -0,0 +1,114 @@\n+#!/bin/bash -\n+# Usage: ./release_bom.sh <dependencies|bom> <release version>\n+\n+set -e\n+\n+EchoRed() {\n+  echo \"$(tput setaf 1; tput bold)$1$(tput sgr0)\"\n+}\n+EchoGreen() {\n+  echo \"$(tput setaf 2; tput bold)$1$(tput sgr0)\"\n+}\n+\n+Die() {\n+  EchoRed \"$1\"\n+  exit 1\n+}\n+\n+DieUsage() {\n+  Die \"Usage: ./release_bom.sh <dependencies|bom> <release version> [<post-release-version>]\"\n+}\n+\n+# Usage: CheckVersion <version>\n+CheckVersion() {\n+  [[ $1 =~ ^[0-9]+\\.[0-9]+\\.[0-9]+(-[0-9A-Za-z]+)?$ ]] || Die \"Version: $1 not in ###.###.###[-XXX] format.\"\n+}\n+\n+# Usage: IncrementVersion <version>\n+IncrementVersion() {\n+  local version=$1\n+  local minorVersion=$(echo $version | sed 's/[0-9][0-9]*\\.[0-9][0-9]*\\.\\([0-9][0-9]\\)*/\\1/')\n+  local nextMinorVersion=$((minorVersion+1))\n+  echo $version | sed \"s/\\([0-9][0-9]*\\.[0-9][0-9]*\\)\\.[0-9][0-9]*/\\1.$nextMinorVersion/\"\n+}\n+\n+[ $# -ne 2 ] && [ $# -ne 3 ] && DieUsage\n+\n+EchoGreen '===== RELEASE SETUP SCRIPT ====='\n+\n+SUFFIX=$1\n+\n+if [[ \"${SUFFIX}\" != \"dependencies\" && \"${SUFFIX}\" != \"bom\" ]]; then\n+  DieUsage\n+fi\n+\n+VERSION=$2\n+CheckVersion ${VERSION}\n+\n+if [ -n \"$3\" ]; then\n+  NEXT_VERSION=$3\n+  CheckVersion ${NEXT_VERSION}\n+else\n+  NEXT_VERSION=$(IncrementVersion $VERSION)\n+  CheckVersion ${NEXT_VERSION}\n+fi\n+\n+if [[ $(git status -uno --porcelain) ]]; then\n+  Die 'There are uncommitted changes.'\n+fi\n+\n+# Make sure client is up to date with the latest changes.\n+git checkout master\n+git pull\n+\n+# Checks out a new branch for this version release (eg. 1.5.7).\n+git checkout -b ${VERSION}-${SUFFIX}\n+\n+\n+# Updates the pom.xml with the next snapshot version.\n+# For example, when releasing 1.5.7, the next snapshot version would be 1.5.8-SNAPSHOT.\n+NEXT_SNAPSHOT=${NEXT_VERSION}\n+if [[ \"${NEXT_SNAPSHOT}\" != *-SNAPSHOT ]]; then\n+  NEXT_SNAPSHOT=${NEXT_SNAPSHOT}-SNAPSHOT\n+fi\n+\n+if [[ \"${SUFFIX}\" = \"bom\" ]]; then\n+  cd boms/cloud-oss-bom\n+fi\n+\n+# Updates the pom.xml with the version to release.\n+mvn versions:set versions:commit -DnewVersion=${VERSION} -DgenerateBackupPoms=false\n+\n+if [[ \"${SUFFIX}\" = \"dependencies\" ]]; then\n+  sed -i \"\" \"s/version = .*/version = ${VERSION}/\" gradle-plugin/gradle.properties\n+fi\n+\n+# Tags a new commit for this release.\n+git commit -am \"preparing release ${VERSION}-${SUFFIX}\"\n+git tag v${VERSION}-${SUFFIX}\n+mvn versions:set versions:commit -DnewVersion=${NEXT_SNAPSHOT} -DgenerateBackupPoms=false\n+\n+if [[ \"${SUFFIX}\" = \"dependencies\" ]]; then\n+  sed -i \"\" \"s/version = .*/version = ${NEXT_SNAPSHOT}/\" gradle-plugin/gradle.properties\n+fi\n+\n+# Commits this next snapshot version.\n+git commit -am \"${NEXT_SNAPSHOT}\"\n+\n+# Pushes the tag and release branch to Github.\n+git push origin v${VERSION}-${SUFFIX}\n+git push --set-upstream origin ${VERSION}-${SUFFIX}\n+\n+# Create the PR\n+gh pr create -t \"Release ${VERSION}-${SUFFIX}\" -b \"Release ${VERSION}-${SUFFIX}\"\n+\n+# File a PR on Github for the new branch. Have someone LGTM it, which gives you permission to continue.\n+EchoGreen 'Ask someone to approve this PR.'\n+\n+p4 g4d -f release-${VERSION}-${SUFFIX}", "originalCommit": "eb29944c9d137445cc44a30cfa7f1e679fa2fb99", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1e1ac80f59f26cd91fb98cabb231e572fd81b9b9", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/1e1ac80f59f26cd91fb98cabb231e572fd81b9b9", "message": "CITC client names can't contain periods", "committedDate": "2020-10-18T11:08:42Z", "type": "commit"}, {"oid": "399f1bda537ecc12c98de9b3357e79f0d68777aa", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/399f1bda537ecc12c98de9b3357e79f0d68777aa", "message": "more TODOs", "committedDate": "2020-10-18T11:11:19Z", "type": "commit"}, {"oid": "e1718aec31eac56b3279884a282682a219f7f7e1", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/e1718aec31eac56b3279884a282682a219f7f7e1", "message": "Merge branch 'master' into rel", "committedDate": "2020-10-19T11:21:51Z", "type": "commit"}, {"oid": "004b97f2f746a04f7226b97a1a05656be56ddf71", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/004b97f2f746a04f7226b97a1a05656be56ddf71", "message": "Merge branch 'master' into rel", "committedDate": "2020-10-19T17:16:23Z", "type": "commit"}]}