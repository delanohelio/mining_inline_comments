{"pr_number": 1500, "pr_title": "add method to get verbose graph for list of artifacts", "pr_createdAt": "2020-06-25T18:35:12Z", "pr_url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1500", "timeline": [{"oid": "6ec77f117759984b7bc522dc152f9c9abd1b00df", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/6ec77f117759984b7bc522dc152f9c9abd1b00df", "message": "add method to get verbose graph for list of artifacts", "committedDate": "2020-06-25T18:34:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIzMDc3MQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1500#discussion_r446230771", "bodyText": "Shouldn't the tests assert that the whole graph is what we expect not just the first node and the amount of nodes?", "author": "ian-lavallee", "createdAt": "2020-06-26T14:49:08Z", "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilderTest.java", "diffHunk": "@@ -199,6 +201,45 @@ public void testBuildLinkageCheckDependencyGraph_multipleArtifacts() {\n         secondElement.getLeaf().getArtifactId());\n   }\n \n+  @Test\n+  public void testBuildVerboseDependencyGraph_singleArtifact() {\n+    DependencyGraph graph =\n+        dependencyGraphBuilder.buildVerboseDependencyGraph(logging);\n+\n+    List<DependencyPath> list = graph.list();\n+    DependencyPath firstElement = list.get(0);\n+    Assert.assertEquals(\n+        \"commons-logging\",\n+        firstElement.getLeaf().getArtifactId());\n+    Assert.assertEquals(6, list.size()); // optional dependencies are included", "originalCommit": "6ec77f117759984b7bc522dc152f9c9abd1b00df", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwMDU2Ng==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1500#discussion_r446300566", "bodyText": "Ideally yes, assuming that's fixed (and I think it is) so you caught me taking a shortcut. That said, I generally write the simplest test I can until something fails (and this did fail at one point) the fix the code until it passes. Then I write a test for something else until the test fails. Here I don't expect adding that test would cause a failure though the only way to be sure of that would be to actually write it. :-)", "author": "elharo", "createdAt": "2020-06-26T16:55:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIzMDc3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyNzA2NA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1500#discussion_r446327064", "bodyText": "In any case, I added several more asserts here to cover more of the graph. I'm still not testing the exact expected value since that would be quite onerous to setup even for this simple an example. Instead I'm sampling a few know properties of particular parts of the graph.", "author": "elharo", "createdAt": "2020-06-26T17:51:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIzMDc3MQ=="}], "type": "inlineReview"}, {"oid": "1fb2ba83832d064f6e60d4b01824e6c26f9c441b", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/1fb2ba83832d064f6e60d4b01824e6c26f9c441b", "message": "assert more of the graph", "committedDate": "2020-06-26T17:50:08Z", "type": "commit"}, {"oid": "c5e48e2b1d29a3b4d530b1f9e1b475c7d6c9d335", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/c5e48e2b1d29a3b4d530b1f9e1b475c7d6c9d335", "message": "Merge branch 'master' into list", "committedDate": "2020-06-29T13:57:50Z", "type": "commit"}, {"oid": "acdd0b4865e72c48e0817fcf813db3d3a4d7de84", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/acdd0b4865e72c48e0817fcf813db3d3a4d7de84", "message": "Merge branch 'master' into list", "committedDate": "2020-06-29T15:24:27Z", "type": "commit"}, {"oid": "15cf0e9ac4afe6ef554698abe857eb819658939d", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/15cf0e9ac4afe6ef554698abe857eb819658939d", "message": "Merge branch 'master' into list", "committedDate": "2020-06-30T18:06:49Z", "type": "commit"}, {"oid": "79805079d3603f574a924bc17f7133bc7d67b800", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/79805079d3603f574a924bc17f7133bc7d67b800", "message": "Merge branch 'master' into list", "committedDate": "2020-07-06T10:58:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUyMTYwNQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1500#discussion_r450521605", "bodyText": "To follow Maven's default behavior, we need to include \"direct optional dependencies\" (depth 1).\norg.eclipse.aether.util.graph.selector.OptionalDependencySelector does that.", "author": "suztomo", "createdAt": "2020-07-06T22:59:47Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/BanOptionalDependencySelector.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.dependencies;\n+\n+import org.eclipse.aether.collection.DependencyCollectionContext;\n+import org.eclipse.aether.collection.DependencySelector;\n+import org.eclipse.aether.graph.Dependency;\n+\n+/**\n+ * A dependency selector that disallows all optional dependencies regardless of depth.", "originalCommit": "79805079d3603f574a924bc17f7133bc7d67b800", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk1MDU4Nw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1500#discussion_r450950587", "bodyText": "That would be only for a specific artifact. This is for a lost of artifacts so all optional dependencies are effectively transitive.", "author": "elharo", "createdAt": "2020-07-07T15:25:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUyMTYwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTEwMjgyMA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1500#discussion_r451102820", "bodyText": "Per docs,  OptionalDependencySelector \"excludes optional dependencies which occur beyond level one of the dependency graph.\" This need to exclude all optional dependencies, at level one and beyond.", "author": "elharo", "createdAt": "2020-07-07T19:46:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUyMTYwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTEwOTY5Ng==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1500#discussion_r451109696", "bodyText": "Indeed using that instead of this breaks the tests.", "author": "elharo", "createdAt": "2020-07-07T20:00:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUyMTYwNQ=="}], "type": "inlineReview"}, {"oid": "a2726cd9ca4ce63dd8e94aaeb074ef9bf0e4f875", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/a2726cd9ca4ce63dd8e94aaeb074ef9bf0e4f875", "message": "Merge branch 'master' into list", "committedDate": "2020-07-07T12:35:30Z", "type": "commit"}, {"oid": "634f4a8e378f873ee1043b522c8af4bc049fdf1d", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/634f4a8e378f873ee1043b522c8af4bc049fdf1d", "message": "Merge branch 'master' into list", "committedDate": "2020-07-07T18:21:37Z", "type": "commit"}, {"oid": "95b3830cc76fda9727acb74f67d4a20464124aa2", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/95b3830cc76fda9727acb74f67d4a20464124aa2", "message": "Merge branch 'master' into list", "committedDate": "2020-07-07T18:56:00Z", "type": "commit"}]}