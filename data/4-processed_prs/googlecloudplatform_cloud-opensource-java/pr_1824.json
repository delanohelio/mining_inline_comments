{"pr_number": 1824, "pr_title": "No tools.jar in testFindLinkageProblems_unusedClassReferenceInByteCode", "pr_createdAt": "2020-11-19T19:59:16Z", "pr_url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1824", "timeline": [{"oid": "746d01c4133d85178c1276a1489af32e66e26b39", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/746d01c4133d85178c1276a1489af32e66e26b39", "message": "No tools.jar", "committedDate": "2020-11-19T19:57:51Z", "type": "commit"}, {"oid": "0550bb0741314746e22ac9e2517a0cec0b6195c6", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/0550bb0741314746e22ac9e2517a0cec0b6195c6", "message": "javadoc", "committedDate": "2020-11-19T20:02:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2NzU1Nw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1824#discussion_r527167557", "bodyText": "This class is a private class.", "author": "suztomo", "createdAt": "2020-11-19T20:10:59Z", "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerTest.java", "diffHunk": "@@ -1152,22 +1151,39 @@ public void testFindLinkageProblems_referenceToJava11Method() throws IOException\n \n   @Test\n   public void testFindLinkageProblems_unusedClassReferenceInByteCode() throws IOException {\n-    // JDK's tools.jar contains com.sun.tools.internal.ws.wscompile.WsgenOptions class. The class\n-    // has the class reference to JDK's com.sun.xml.internal.ws.api.BindingID$SOAPHTTPImpl in its\n-    // constant pool section. The referenced class is private but it's not used in the JVM\n-    // instructions in the class file.\n-    // https://github.com/GoogleCloudPlatform/cloud-opensource-java/issues/1608\n-\n-    String javaHomeDirectory = System.getProperty(\"java.home\");\n-    Path toolsJar = Paths.get(javaHomeDirectory, \"..\", \"lib\", \"tools.jar\");\n-    Artifact toolsArtifact =\n-        new DefaultArtifact(\"com.sun:tools:jar:1.8\").setFile(toolsJar.toFile());\n-\n-    LinkageChecker linkageChecker =\n-        LinkageChecker.create(ImmutableList.of(new ClassPathEntry(toolsArtifact)));\n+    // com.sun.tools.ws.wscompile.WsgenOptions in jaxws-tools has the class reference to\n+    // com.sun.xml.ws.api.BindingID$SOAPHTTPImpl in its constant pool section. The referenced class\n+    // is private but it's not used in the JVM instruction in the referencing class file. Therefore\n+    // the Linkage Checker should not report it as a symbol problem.\n+    // The problem was observed in Java 8's tools.jar (\n+    // https://github.com/GoogleCloudPlatform/cloud-opensource-java/issues/1608). In Java 11, the\n+    // JDK does not provide the class any more. The two artifacts below have the classes with\n+    // different packages (they are no longer 'internal').\n+    ImmutableList<ClassPathEntry> classPath =\n+        TestHelper.resolve(\n+            \"com.sun.xml.ws:jaxws-tools:2.3.3\", // This contains WsgenOptions\n+            \"com.sun.xml.ws:jaxws-rt:2.3.3\"); // This contains BindingID$SOAPHTTPImpl\n+    String wsgenOptionsClassName = \"com.sun.tools.ws.wscompile.WsgenOptions\";\n+\n+    // Ensure the class path contains the two classes in the issue (#1608).\n+    ClassDumper classDumper = ClassDumper.create(classPath);\n+    SymbolReferences symbolReferences = classDumper.findSymbolReferences();\n+    ImmutableSet<ClassSymbol> classSymbols =\n+        symbolReferences.getClassSymbols(new ClassFile(classPath.get(0), wsgenOptionsClassName));\n+    Truth.assertThat(classSymbols)\n+        .contains(new ClassSymbol(\"com.sun.xml.ws.api.BindingID$SOAPHTTPImpl\"));", "originalCommit": "0550bb0741314746e22ac9e2517a0cec0b6195c6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}