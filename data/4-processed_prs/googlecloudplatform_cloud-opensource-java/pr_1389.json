{"pr_number": 1389, "pr_title": "remove dependency on multimap", "pr_createdAt": "2020-05-06T13:02:05Z", "pr_url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1389", "timeline": [{"oid": "a9b12fa83171778838a734e444cb84c2f3034694", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/a9b12fa83171778838a734e444cb84c2f3034694", "message": "hide a multimap", "committedDate": "2020-05-06T13:01:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDgyMzAwOQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1389#discussion_r420823009", "bodyText": "As in the previous javadoc, the values are all ClassPathEntrys in the subtree of the key.\nThe below is copy from https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1371/files#r417496064 :\n\nThis method groups dependencies by its direct dependencies of the root. For example, suppose we have the following tree:\n+- g:a:1\n|  +- g:b:1\n|     +- g:c:1\n|\n+- g:d:1\n   +- g:c:1\n   +- g:e:1\n\nThe method returns a multimap of\n{\n\"g:a:1\" => {g:a:1, g:b:1, g:c:1}\n\"g:d:1\" => {g:d:1, g:c:1, g:e:1}\n}\n\nDashboardMain uses this map to group linkage errors by BOM members. E.g.,\nDependency Analysis of io.grpc:grpc-netty:1.29.0 has linkage errors that has source classes in the JAR files of the subtree of io.grpc:grpc-netty:1.29.0.\n\nI'm feeling this logic is very specific to DashboardMain (no other places need this) and it has been confusing to have this method in ClassPathResult. Do you want to move this logic to DashboardMain?", "author": "suztomo", "createdAt": "2020-05-06T14:11:27Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathResult.java", "diffHunk": "@@ -93,21 +105,14 @@ public String formatDependencyPaths(Iterable<ClassPathEntry> entries) {\n     }\n     return message.toString();\n   }\n-\n+  \n   /**\n-   * Returns mapping from the Maven coordinates to {@link ClassPathEntry}. The keys are the\n-   * coordinates of the direct dependencies of the root nodes in {@link #dependencyPaths}. The\n-   * values are all {@link ClassPathEntry}s in the subtree of the key.\n+   * Returns the classpath entries for the specified coordinates.\n+   * \n+   * TODO: Explain why this is plural. Shouldn't there be exactly one?", "originalCommit": "a9b12fa83171778838a734e444cb84c2f3034694", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAwNTg5MA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1389#discussion_r421005890", "bodyText": "Probably not though we can revisit. The focus is on not passing a bunch of weird data structures around. Instead I'd like public classes that represent our entities (ClassFile, ClassPathEntry, ClassPath, Artifact, Dependency, etc.) and operations on those.", "author": "elharo", "createdAt": "2020-05-06T18:33:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDgyMzAwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAzMDk0Mg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1389#discussion_r421030942", "bodyText": "That's good. Would you update the javadoc using the word subtree or something similar? The previous javadoc explains why the values are plural.", "author": "suztomo", "createdAt": "2020-05-06T19:14:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDgyMzAwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAzOTY3Nw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1389#discussion_r421039677", "bodyText": "I'm not sure it did. Or rather what it said didn't match the code. Notice that this returns class path entries, not dependency paths.", "author": "elharo", "createdAt": "2020-05-06T19:30:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDgyMzAwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTA1Mjc5NA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1389#discussion_r421052794", "bodyText": "How about \"Returns the class path entries in the subtree of the specified coordinates\"?", "author": "suztomo", "createdAt": "2020-05-06T19:54:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDgyMzAwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTA2NTA4Ng==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1389#discussion_r421065086", "bodyText": "done", "author": "elharo", "createdAt": "2020-05-06T20:16:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDgyMzAwOQ=="}], "type": "inlineReview"}, {"oid": "a90923045521861e46a439e7259aa648fd9ead7d", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/a90923045521861e46a439e7259aa648fd9ead7d", "message": "adjust constructor to not call instance methods", "committedDate": "2020-05-06T17:41:30Z", "type": "commit"}, {"oid": "dc72618aa72e51c20945b65b19f666db6f5c3751", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/dc72618aa72e51c20945b65b19f666db6f5c3751", "message": "avoid index out of bounds", "committedDate": "2020-05-06T18:27:38Z", "type": "commit"}, {"oid": "bf547961a2ffe01d8d5644765f85e441868cbc51", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/bf547961a2ffe01d8d5644765f85e441868cbc51", "message": "remove set multimap dependence", "committedDate": "2020-05-06T19:28:00Z", "type": "commit"}, {"oid": "7724bda6bec93ab0bca368725c968014756d1181", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/7724bda6bec93ab0bca368725c968014756d1181", "message": "clarify javadoc", "committedDate": "2020-05-06T20:15:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTA4OTk5Mg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1389#discussion_r421089992", "bodyText": "It's the other way around. The artifact with the specified coordinates contains the class path entries as (transitive and direct) dependencies.", "author": "suztomo", "createdAt": "2020-05-06T21:02:17Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathResult.java", "diffHunk": "@@ -93,21 +92,24 @@ public String formatDependencyPaths(Iterable<ClassPathEntry> entries) {\n     }\n     return message.toString();\n   }\n-\n+  \n   /**\n-   * Returns mapping from the Maven coordinates to {@link ClassPathEntry}. The keys are the\n-   * coordinates of the direct dependencies of the root nodes in {@link #dependencyPaths}. The\n-   * values are all {@link ClassPathEntry}s in the subtree of the key.\n+   * Returns the classpath entries whose transitive dependencies contain\n+   * the artifact with the specified coordinates.", "originalCommit": "7724bda6bec93ab0bca368725c968014756d1181", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQyODM1NA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1389#discussion_r421428354", "bodyText": "fixed", "author": "elharo", "createdAt": "2020-05-07T11:18:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTA4OTk5Mg=="}], "type": "inlineReview"}, {"oid": "cc3e84164d6c3ba25be929c0e26b91cdabb0befd", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/cc3e84164d6c3ba25be929c0e26b91cdabb0befd", "message": "fix javadoc", "committedDate": "2020-05-07T11:16:30Z", "type": "commit"}]}