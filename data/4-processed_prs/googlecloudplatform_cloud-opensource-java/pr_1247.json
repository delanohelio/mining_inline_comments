{"pr_number": 1247, "pr_title": "LinkageCheckerMain should not fail upon missing Maven artifact", "pr_createdAt": "2020-02-24T16:56:16Z", "pr_url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1247", "timeline": [{"oid": "4722d977b78c55187fe62532a9952df43473cf6d", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/4722d977b78c55187fe62532a9952df43473cf6d", "message": "getInputClasspath not to throw exception", "committedDate": "2020-02-24T16:50:41Z", "type": "commit"}, {"oid": "634a3ad2a6c5dc97babafd9000a8e08147a1aae6", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/634a3ad2a6c5dc97babafd9000a8e08147a1aae6", "message": "Fixed LinkageCheckerTest", "committedDate": "2020-02-24T16:54:21Z", "type": "commit"}, {"oid": "c4f6a73fdaafbac2a94a0ecf1cac39e9a120b136", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/c4f6a73fdaafbac2a94a0ecf1cac39e9a120b136", "message": "Format", "committedDate": "2020-02-24T16:54:59Z", "type": "commit"}, {"oid": "782ff55a174e2190ebe3ce607df64c85ebd5082c", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/782ff55a174e2190ebe3ce607df64c85ebd5082c", "message": "Adding tests", "committedDate": "2020-02-24T17:00:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ0ODIzMA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1247#discussion_r383448230", "bodyText": "It feels very strange that there's a classpath result hiding inside the command line arguments class. Is there a more appropriate abstraction here?", "author": "elharo", "createdAt": "2020-02-24T18:51:16Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerArguments.java", "diffHunk": "@@ -60,7 +58,7 @@\n   private static final HelpFormatter helpFormatter = new HelpFormatter();\n \n   private final CommandLine commandLine;\n-  private ImmutableList<Path> cachedInputClasspath;\n+  private ClassPathResult classPathResult;", "originalCommit": "782ff55a174e2190ebe3ce607df64c85ebd5082c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ1OTQyMQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1247#discussion_r383459421", "bodyText": "I've been feeling that strangeness. Let me update them.", "author": "suztomo", "createdAt": "2020-02-24T19:13:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ0ODIzMA=="}], "type": "inlineReview"}, {"oid": "760d768ac9ed8d7101e478b5bf33905f8d92c637", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/760d768ac9ed8d7101e478b5bf33905f8d92c637", "message": "Merge remote-tracking branch 'origin/master' into i1242", "committedDate": "2020-02-24T19:14:45Z", "type": "commit"}, {"oid": "e2d5b88d32d0c17a5603c0518a575214b3e9afa7", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/e2d5b88d32d0c17a5603c0518a575214b3e9afa7", "message": "Argument class not to have ClassPathResult", "committedDate": "2020-02-24T19:39:57Z", "type": "commit"}, {"oid": "f3e64a9f338241e10ff87ef3ad5fbc8a6f095d3a", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/f3e64a9f338241e10ff87ef3ad5fbc8a6f095d3a", "message": "Format", "committedDate": "2020-02-24T19:47:26Z", "type": "commit"}, {"oid": "3c8d895cdeb55b5fa0cc20e5513a7f8bf55dd048", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/3c8d895cdeb55b5fa0cc20e5513a7f8bf55dd048", "message": "Format", "committedDate": "2020-02-24T19:49:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ3NDIyNQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1247#discussion_r383474225", "bodyText": "Now it's LinkageCheckerMain's responsibility to resolve the class path through dependency graphs.", "author": "suztomo", "createdAt": "2020-02-24T19:42:18Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerArguments.java", "diffHunk": "@@ -190,47 +184,15 @@ private static Options configureOptions() {\n     }\n   }\n \n-  /**\n-   * Returns a list of absolute paths to jar files for the option. The list includes dependencies if\n-   * BOM or Maven coordinates are specified in the option.\n-   */\n-  ImmutableList<Path> getInputClasspath() throws RepositoryException {\n-    if (cachedInputClasspath != null) {\n-      // Avoid unnecessary dependency resolution, which Cloud OSS BOM takes around 4 seconds\n-      return cachedInputClasspath;\n-    }\n-\n-    if (commandLine.hasOption(\"b\") || commandLine.hasOption(\"a\")) {\n-      List<Artifact> artifacts = getArtifacts();\n-      ClassPathResult result = classPathBuilder.resolve(artifacts);", "originalCommit": "e2d5b88d32d0c17a5603c0518a575214b3e9afa7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ3OTEwMA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1247#discussion_r383479100", "bodyText": "This test has been moved to LinkageCheckerArgumentTest.testGetJarFiles_jarFileList", "author": "suztomo", "createdAt": "2020-02-24T19:51:36Z", "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerTest.java", "diffHunk": "@@ -658,44 +663,32 @@ public void testGenerateInputClasspathFromLinkageCheckOption_mavenCoordinates_mi\n     LinkageCheckerArguments parsedArguments =\n         LinkageCheckerArguments.readCommandLine(\"--artifacts\", \"com.google.guava:guava-gwt:20.0\");\n \n-    ImmutableList<Path> inputClasspath = parsedArguments.getInputClasspath();\n+    ImmutableList<Path> inputClasspath =\n+        classPathBuilder.resolve(parsedArguments.getArtifacts()).getClassPath();\n \n     Truth.assertThat(inputClasspath)\n         .comparingElementsUsing(PATH_FILE_NAMES)\n         .contains(\"apache-jsp-8.0.9.M3.jar\");\n   }\n \n   @Test\n-  public void testGenerateInputClasspathFromLinkageCheckOption_failOnMissingDependency()\n-      throws ParseException {\n+  public void testGenerateInputClasspathFromLinkageCheckOption_recordMissingDependency()\n+      throws ParseException, RepositoryException {\n     // tomcat-jasper has missing dependency (not optional):\n     //   org.apache.tomcat:tomcat-jasper:jar:8.0.9\n     //     org.eclipse.jdt.core.compiler:ecj:jar:4.4RC4 (not found in Maven central)\n     LinkageCheckerArguments parsedArguments =\n         LinkageCheckerArguments.readCommandLine(\n             \"--artifacts\", \"org.apache.tomcat:tomcat-jasper:8.0.9\");\n \n-    try {\n-      parsedArguments.getInputClasspath();\n-      Assert.fail(\n-          \"Because the unavailable dependency is not optional, it should throw an exception\");\n-    } catch (RepositoryException ex) {\n-      Truth.assertThat(ex.getMessage())\n-          .startsWith(\"Unresolved artifacts: org.eclipse.jdt.core.compiler:ecj:jar:4.4RC4\");\n-    }\n-  }\n-\n-  @Test\n-  public void testGenerateInputClasspath_jarFileList()", "originalCommit": "3c8d895cdeb55b5fa0cc20e5513a7f8bf55dd048", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ3OTQzOA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1247#discussion_r383479438", "bodyText": "LinkageCheckerArguments is no longer responsible to resolve the class path.", "author": "suztomo", "createdAt": "2020-02-24T19:52:24Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerArguments.java", "diffHunk": "@@ -60,12 +56,10 @@\n   private static final HelpFormatter helpFormatter = new HelpFormatter();\n \n   private final CommandLine commandLine;\n-  private ImmutableList<Path> cachedInputClasspath;\n   private ImmutableList<Artifact> cachedArtifacts;\n   private final ImmutableList<String> extraMavenRepositoryUrls;\n   private final boolean addMavenCentral;\n   private final boolean reportOnlyReachable;\n-  private final ClassPathBuilder classPathBuilder = new ClassPathBuilder();", "originalCommit": "3c8d895cdeb55b5fa0cc20e5513a7f8bf55dd048", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ3OTkwMw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1247#discussion_r383479903", "bodyText": "LinkageCheckerArguments is no longer responsible to resolve the class path. Therefore it does not know class path (cachedInputClasspath variable).", "author": "suztomo", "createdAt": "2020-02-24T19:53:19Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerArguments.java", "diffHunk": "@@ -60,12 +56,10 @@\n   private static final HelpFormatter helpFormatter = new HelpFormatter();\n \n   private final CommandLine commandLine;\n-  private ImmutableList<Path> cachedInputClasspath;", "originalCommit": "3c8d895cdeb55b5fa0cc20e5513a7f8bf55dd048", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0fd5447d22d87d0adfee4e8d620becfc20e83adb", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/0fd5447d22d87d0adfee4e8d620becfc20e83adb", "message": "Merge branch 'master' into i1242", "committedDate": "2020-02-24T20:36:53Z", "type": "commit"}]}