{"pr_number": 1190, "pr_title": "secondary id improvements", "pr_createdAt": "2020-05-12T17:36:08Z", "pr_url": "https://github.com/bakdata/conquery/pull/1190", "timeline": [{"oid": "b5631ac81459638fd10582e460f793e4e62b1afd", "url": "https://github.com/bakdata/conquery/commit/b5631ac81459638fd10582e460f793e4e62b1afd", "message": "added support to SECONDARY_ID_QUERY queries for tables without secondary\nids", "committedDate": "2020-05-03T22:10:58Z", "type": "commit"}, {"oid": "da078e8751b24fbc073bfe350ec8c22c436e2212", "url": "https://github.com/bakdata/conquery/commit/da078e8751b24fbc073bfe350ec8c22c436e2212", "message": "added secondary id information to REST API", "committedDate": "2020-05-03T22:29:36Z", "type": "commit"}, {"oid": "381defd5c54bdb80668d4642f33a15c039fe2df5", "url": "https://github.com/bakdata/conquery/commit/381defd5c54bdb80668d4642f33a15c039fe2df5", "message": "Merge branch 'develop' into feature/secondary_id_improvements", "committedDate": "2020-05-12T17:36:13Z", "type": "commit"}, {"oid": "97a6ca4b89acfe8cd96a64e3c21d3dd327056c13", "url": "https://github.com/bakdata/conquery/commit/97a6ca4b89acfe8cd96a64e3c21d3dd327056c13", "message": "Merge 381defd5c54bdb80668d4642f33a15c039fe2df5 into 3567834601be40d3e38a5b1ef8293ecc0c41778b", "committedDate": "2020-05-12T17:36:15Z", "type": "commit"}, {"oid": "6b068cbc8c54330e6fb9b53d2847b43c25de3820", "url": "https://github.com/bakdata/conquery/commit/6b068cbc8c54330e6fb9b53d2847b43c25de3820", "message": "automatic update to docs", "committedDate": "2020-05-12T17:38:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc3NjUzNw==", "url": "https://github.com/bakdata/conquery/pull/1190#discussion_r425776537", "bodyText": "Warum nicht die Ids?", "author": "awildturtok", "createdAt": "2020-05-15T12:46:01Z", "path": "backend/src/main/java/com/bakdata/conquery/models/api/description/FERoot.java", "diffHunk": "@@ -12,5 +16,6 @@\n  */\n @Getter\n public class FERoot {\n+\tprivate Set<String> secondaryIds = new HashSet<>();", "originalCommit": "6b068cbc8c54330e6fb9b53d2847b43c25de3820", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc4MjMwNg==", "url": "https://github.com/bakdata/conquery/pull/1190#discussion_r425782306", "bodyText": "Kannst du die tables vorher auf trennen und dann die schleifen machen? Der Code macht schon so viel, da muss das nicht noch mit drin rumschwirren", "author": "awildturtok", "createdAt": "2020-05-15T12:56:26Z", "path": "backend/src/main/java/com/bakdata/conquery/models/query/queryplan/SecondaryIdQueryPlan.java", "diffHunk": "@@ -74,32 +72,24 @@ public EntityResult execute(QueryExecutionContext ctx, Entity entity) {\n \t\t\treturn EntityResult.notContained();\n \t\t}\n \n+\t\tList<Table> tablesWithoutSecondary = new ArrayList<>();\n+\t\t//first execute only tables with secondaryIds\n \t\tfor(Table currentTable : query.getRequiredTables()) {\n-\t\t\tcurrentSecondaryIdColumn = findSecondaryIdColumn(currentTable);\n-\t\t\tnextTable(ctx, currentTable);\n-\t\t\tfor(Bucket bucket : entity.getBucket(currentTable.getId())) {\n-\t\t\t\tint localEntity = bucket.toLocal(entity.getId());\n-\t\t\t\tAStringType<?> secondaryIdType = (AStringType<?>)currentSecondaryIdColumn.getTypeFor(bucket);\n-\t\t\t\tnextBlock(bucket);\n-\t\t\t\tif(bucket.containsLocalEntity(localEntity)) {\n-\t\t\t\t\tif(isOfInterest(bucket)) {\n-\t\t\t\t\t\tint start = bucket.getFirstEventOfLocal(localEntity);\n-\t\t\t\t\t\tint end = bucket.getLastEventOfLocal(localEntity);\n-\t\t\t\t\t\tfor(int event = start; event < end ; event++) {\n-\t\t\t\t\t\t\t//we ignore events with no value in the secondaryIdColumn\n-\t\t\t\t\t\t\tif(bucket.has(event, currentSecondaryIdColumn)) {\n-\t\t\t\t\t\t\t\tString key = secondaryIdType.getElement(bucket.getString(event, currentSecondaryIdColumn));\n-\t\t\t\t\t\t\t\tchildPerKey\n-\t\t\t\t\t\t\t\t\t.computeIfAbsent(key, k->this.createChild(k, ctx, bucket))\n-\t\t\t\t\t\t\t\t\t.nextEvent(bucket, event);\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n+\t\t\tColumn secondaryIdColumn = findSecondaryIdColumn(currentTable);", "originalCommit": "6b068cbc8c54330e6fb9b53d2847b43c25de3820", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc4MjY2MA==", "url": "https://github.com/bakdata/conquery/pull/1190#discussion_r425782660", "bodyText": "Bitte unterschiedliche namen anstatt overloading", "author": "awildturtok", "createdAt": "2020-05-15T12:57:05Z", "path": "backend/src/main/java/com/bakdata/conquery/models/query/queryplan/SecondaryIdQueryPlan.java", "diffHunk": "@@ -112,6 +102,50 @@ public EntityResult execute(QueryExecutionContext ctx, Entity entity) {\n \t\treturn EntityResult.multilineOf(entity.getId(), result);\n \t}\n \n+\tprivate void execute(QueryExecutionContext ctx, Entity entity, Column secondaryIdColumn) {", "originalCommit": "6b068cbc8c54330e6fb9b53d2847b43c25de3820", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3fa3727efb1c9234a940671c7afc013cf29bd9bc", "url": "https://github.com/bakdata/conquery/commit/3fa3727efb1c9234a940671c7afc013cf29bd9bc", "message": "Merge remote-tracking branch 'origin/develop' into feature/secondary_id_improvements\n\n# Conflicts:\n#\tbackend/src/main/java/com/bakdata/conquery/models/query/queryplan/SecondaryIdQueryPlan.java", "committedDate": "2020-09-30T12:39:33Z", "type": "commit"}, {"oid": "0b9358e318581706270aa5a02951f2c5a09ba0df", "url": "https://github.com/bakdata/conquery/commit/0b9358e318581706270aa5a02951f2c5a09ba0df", "message": "automatic update to docs", "committedDate": "2020-09-30T12:42:02Z", "type": "commit"}, {"oid": "f4926dd24dc011e3adddb3c0f553f03c32c5c8a1", "url": "https://github.com/bakdata/conquery/commit/f4926dd24dc011e3adddb3c0f553f03c32c5c8a1", "message": "fix table of columns", "committedDate": "2020-10-01T12:47:15Z", "type": "commit"}, {"oid": "19593d07950b9501fb057d07a57d87a4a66b69ef", "url": "https://github.com/bakdata/conquery/commit/19593d07950b9501fb057d07a57d87a4a66b69ef", "message": "Merge remote-tracking branch 'origin/develop' into feature/secondary_id_improvements\n\n# Conflicts:\n#\tbackend/src/main/java/com/bakdata/conquery/models/query/queryplan/SecondaryIdQueryPlan.java\n#\tdocs/Concept JSONs.md", "committedDate": "2020-10-01T14:19:25Z", "type": "commit"}, {"oid": "e18f2299c1eb1fa27b956b3800f24d015bbcb1ed", "url": "https://github.com/bakdata/conquery/commit/e18f2299c1eb1fa27b956b3800f24d015bbcb1ed", "message": "automatic update to docs", "committedDate": "2020-10-01T14:21:34Z", "type": "commit"}, {"oid": "91b4d30f942371c44433d3540ea718f18ffd6b2b", "url": "https://github.com/bakdata/conquery/commit/91b4d30f942371c44433d3540ea718f18ffd6b2b", "message": "fix execution order", "committedDate": "2020-10-01T14:37:26Z", "type": "commit"}, {"oid": "f89c048c46a6cad055832b7ac98fdff796fb61ee", "url": "https://github.com/bakdata/conquery/commit/f89c048c46a6cad055832b7ac98fdff796fb61ee", "message": "Merge branch 'develop' into feature/secondary_id_improvements", "committedDate": "2020-10-07T14:58:42Z", "type": "commit"}]}