{"pr_number": 555, "pr_title": "setup prerequisites and dependencies with Nix", "pr_createdAt": "2020-03-14T09:43:37Z", "pr_url": "https://github.com/vmware/differential-datalog/pull/555", "timeline": [{"oid": "10e075b7a94681da3ecee78cfe84496209b11b21", "url": "https://github.com/vmware/differential-datalog/commit/10e075b7a94681da3ecee78cfe84496209b11b21", "message": "setup prerequisites and dependencies with Nix", "committedDate": "2020-03-14T09:31:04Z", "type": "commit"}, {"oid": "a87cbc62ee8b10ca6e9ad2bfd7f15a1c1a91460b", "url": "https://github.com/vmware/differential-datalog/commit/a87cbc62ee8b10ca6e9ad2bfd7f15a1c1a91460b", "message": "fail fast if program does not compile and don't build in release mode, as it is too slow", "committedDate": "2020-03-14T13:22:15Z", "type": "commit"}, {"oid": "bbc3b3e43f8d7ff4fcf9bf580860896b254201f8", "url": "https://github.com/vmware/differential-datalog/commit/bbc3b3e43f8d7ff4fcf9bf580860896b254201f8", "message": "D'oh", "committedDate": "2020-03-14T13:55:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY4Mjk1MA==", "url": "https://github.com/vmware/differential-datalog/pull/555#discussion_r392682950", "bodyText": "There are a couple of problems with debug builds in Rust: they are 10x slower (literally) and also take 10x more disk space than release builds. The release build is indeed slow, but after a recent refactoring only the first build is really slow; subsequent rebuilds usually take a few seconds, so I would stick to release builds here.", "author": "ryzhyk", "createdAt": "2020-03-15T15:11:51Z", "path": "default.nix", "diffHunk": "@@ -70,8 +70,8 @@ let\n             input_file=\"$dat_name\"\n           fi\n         fi\n-        ddlog -i \"$program\" -L '${builtins.toPath ./lib}'\n-        (cd \"''${program_noext}_ddlog\" && cargo build --release)", "originalCommit": "a87cbc62ee8b10ca6e9ad2bfd7f15a1c1a91460b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY4NDMwOA==", "url": "https://github.com/vmware/differential-datalog/pull/555#discussion_r392684308", "bodyText": "indeed, rebuild with --release is only a few seconds longer than with --debug on a multicore machine. And disk space usage is greatly reduced. I'll revert back", "author": "danbst", "createdAt": "2020-03-15T15:26:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY4Mjk1MA=="}], "type": "inlineReview"}, {"oid": "32548a5355a802339ac293b837d9f0d8ccc4265a", "url": "https://github.com/vmware/differential-datalog/commit/32548a5355a802339ac293b837d9f0d8ccc4265a", "message": "revert back to cargo build --release - incremental rebuild lasts reasonable time and much less disk space is used", "committedDate": "2020-03-15T15:28:41Z", "type": "commit"}, {"oid": "eb8f96923b0792fca2c8b53ee981803ac79dffe7", "url": "https://github.com/vmware/differential-datalog/commit/eb8f96923b0792fca2c8b53ee981803ac79dffe7", "message": "use GHC from Nix\n\nthis solves 2 problems:\n- template haskell and quasi qoutes will try run GHC installed by stack\n  which **may** cause linker issue if system glibc is different from Nix glibc\n- well we download GHC with Nix already, why duplicate this with Stack?\n  So this actually speeds up initial setup and reduces disk space usage\n\nNow GHC specified in `default.nix` overrides any setting used by LTS or whatever.\nSo upgrading LTS release now requires adjusting GHC version in Nix.", "committedDate": "2020-03-15T17:14:36Z", "type": "commit"}, {"oid": "bda4590d46362ac14c4c557dea2437ac4b1e8b63", "url": "https://github.com/vmware/differential-datalog/commit/bda4590d46362ac14c4c557dea2437ac4b1e8b63", "message": "README.md: Document both manual and Nix-based setups.", "committedDate": "2020-03-17T07:21:55Z", "type": "commit"}, {"oid": "768fefb05d2f98eb3cc0fd2d9bf319ab4012841c", "url": "https://github.com/vmware/differential-datalog/commit/768fefb05d2f98eb3cc0fd2d9bf319ab4012841c", "message": "move nix-specific hardcode out from stack.yaml", "committedDate": "2020-03-17T07:26:00Z", "type": "commit"}, {"oid": "33b85091ddf0cc37e7b1a31493c18f0d10d57ea0", "url": "https://github.com/vmware/differential-datalog/commit/33b85091ddf0cc37e7b1a31493c18f0d10d57ea0", "message": "static haskell builds with Nix", "committedDate": "2020-03-17T08:35:37Z", "type": "commit"}, {"oid": "dc4e17c362c5af546b4bea097a0ea4b3c13b5684", "url": "https://github.com/vmware/differential-datalog/commit/dc4e17c362c5af546b4bea097a0ea4b3c13b5684", "message": "add go", "committedDate": "2020-03-17T18:12:21Z", "type": "commit"}]}