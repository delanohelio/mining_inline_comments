{"pr_number": 754, "pr_title": "Improved static variable generation", "pr_createdAt": "2020-08-27T05:15:43Z", "pr_url": "https://github.com/vmware/differential-datalog/pull/754", "timeline": [{"oid": "358c798a5e8dff74690215340ae040f3c6e2230b", "url": "https://github.com/vmware/differential-datalog/commit/358c798a5e8dff74690215340ae040f3c6e2230b", "message": "Improved static variable generation", "committedDate": "2020-08-27T05:08:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODEzMzI2OQ==", "url": "https://github.com/vmware/differential-datalog/pull/754#discussion_r478133269", "bodyText": "Unfortunately, this does not work.  I don't remember the exact error, but basically rustc failed when there were too many static variables within a single lazy_static.", "author": "ryzhyk", "createdAt": "2020-08-27T05:20:37Z", "path": "src/Language/DifferentialDatalog/Compile.hs", "diffHunk": "@@ -624,13 +624,19 @@ collectStatics d = execState (progExprMapCtxM d (checkStaticExpr)) M.empty\n -- computed by 'collectStatics'.\n mkStatics :: DatalogProgram -> Statics -> Doc\n mkStatics d statics =\n-    vcat $\n-    map (\\((e, t), i) ->\n-            let static_name = \"__STATIC_\" <> pp i in\n-            let ?statics = deleteStatic e t statics in\n-            let e' = mkExpr d CtxTop (eTyped e t) EVal in\n-            \"lazy_static!{ pub static ref\" <+> static_name <> \":\" <+> mkType t <+> \"=\" <+> e' <+> \"; }\")\n-        $ M.toList statics\n+    \"lazy_static! {\"", "originalCommit": "358c798a5e8dff74690215340ae040f3c6e2230b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODEzNzk4MA==", "url": "https://github.com/vmware/differential-datalog/pull/754#discussion_r478137980", "bodyText": "That's really bizarre, and rather unfortunate. I revered the change, should be good now", "author": "Kixiron", "createdAt": "2020-08-27T05:28:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODEzMzI2OQ=="}], "type": "inlineReview"}, {"oid": "d7a463547a67b7295b5c9895609e717530bb1cea", "url": "https://github.com/vmware/differential-datalog/commit/d7a463547a67b7295b5c9895609e717530bb1cea", "message": "It was too good to be true", "committedDate": "2020-08-27T05:27:24Z", "type": "commit"}]}