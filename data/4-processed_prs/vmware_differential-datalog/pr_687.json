{"pr_number": 687, "pr_title": "Add ddlog_dump_index(), ddlog_query_index() methods to the C API.", "pr_createdAt": "2020-06-19T14:37:50Z", "pr_url": "https://github.com/vmware/differential-datalog/pull/687", "timeline": [{"oid": "18ce44a2ee6f42cf35c543be9eee6f5ddb45198c", "url": "https://github.com/vmware/differential-datalog/commit/18ce44a2ee6f42cf35c543be9eee6f5ddb45198c", "message": "ddlog_dump_index() C API.", "committedDate": "2020-06-18T18:16:32Z", "type": "commit"}, {"oid": "35fc1335453e00db442faef2c80f37bd892f5cd2", "url": "https://github.com/vmware/differential-datalog/commit/35fc1335453e00db442faef2c80f37bd892f5cd2", "message": "api.rs: Remove unnecessary Arc::from_raw/into_raw.\n\nFunctions in api.rs were not using the Arc API correctslu: there\nis no need to convert `&prog` into `Arc<prog>` and back, unless we\nintend to take over the ownership of the handle.", "committedDate": "2020-06-18T18:38:55Z", "type": "commit"}, {"oid": "a29df5d3eb6a578c820afd98d4ea949a1dd1094d", "url": "https://github.com/vmware/differential-datalog/commit/a29df5d3eb6a578c820afd98d4ea949a1dd1094d", "message": "ddlog_query_index() C API.", "committedDate": "2020-06-18T19:10:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk3MTQxMA==", "url": "https://github.com/vmware/differential-datalog/pull/687#discussion_r442971410", "bodyText": "typo", "author": "mbudiu-vmw", "createdAt": "2020-06-19T17:47:33Z", "path": "rust/template/ddlog.h", "diffHunk": "@@ -409,6 +409,26 @@ extern int ddlog_apply_updates_from_flatbuf(ddlog_prog prog,\n                                             const unsigned char *buf,\n                                             size_t n);\n \n+/*\n+ * Query index by key.\n+ *\n+ * `idxid` - id of the index to dump.\n+ * `key` - query key.\n+ *     NOTE: the caller keeps ownership of `key` after the call and\n+ *     must deallocate it usin `ddlog_free()`.", "originalCommit": "a29df5d3eb6a578c820afd98d4ea949a1dd1094d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk3MTUxNQ==", "url": "https://github.com/vmware/differential-datalog/pull/687#discussion_r442971515", "bodyText": "misplaced quotes?", "author": "mbudiu-vmw", "createdAt": "2020-06-19T17:47:47Z", "path": "rust/template/ddlog.h", "diffHunk": "@@ -409,6 +409,26 @@ extern int ddlog_apply_updates_from_flatbuf(ddlog_prog prog,\n                                             const unsigned char *buf,\n                                             size_t n);\n \n+/*\n+ * Query index by key.\n+ *\n+ * `idxid` - id of the index to dump.\n+ * `key` - query key.\n+ *     NOTE: the caller keeps ownership of `key` after the call and\n+ *     must deallocate it usin `ddlog_free()`.\n+ * `cb` - callback invoked for each returned record.\n+ * `cb_arg` - opaque handle passed to each `cb invocation`.", "originalCommit": "a29df5d3eb6a578c820afd98d4ea949a1dd1094d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk3MjA1NA==", "url": "https://github.com/vmware/differential-datalog/pull/687#discussion_r442972054", "bodyText": "no message written here", "author": "mbudiu-vmw", "createdAt": "2020-06-19T17:49:03Z", "path": "rust/template/src/api.rs", "diffHunk": "@@ -959,14 +953,68 @@ pub unsafe extern \"C\" fn ddlog_query_index_from_flatbuf(\n     if prog.is_null() {\n         return -1;\n     };\n-    let prog = Arc::from_raw(prog);\n+    let prog = &*prog;\n     prog.eprintln(\n         \"ddlog_query_index_from_flatbuf(): error: DDlog was compiled without FlatBuffers support\",\n     );\n-    Arc::into_raw(prog);\n     -1\n }\n \n+#[no_mangle]\n+pub unsafe extern \"C\" fn ddlog_dump_index(\n+    prog: *const HDDlog,\n+    idxid: libc::size_t,\n+    cb: Option<extern \"C\" fn(arg: libc::uintptr_t, rec: *const record::Record)>,\n+    cb_arg: libc::uintptr_t,\n+) -> raw::c_int {\n+    if prog.is_null() {\n+        return -1;", "originalCommit": "a29df5d3eb6a578c820afd98d4ea949a1dd1094d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c08d9cd44edeae1c9f6efffc02ecdb92ca8f1786", "url": "https://github.com/vmware/differential-datalog/commit/c08d9cd44edeae1c9f6efffc02ecdb92ca8f1786", "message": "ddlog.h: Export two more APIs to C.\n\nExport ddlog_get_index_id(), ddlog_get_table_name() APIs from Rust to C.", "committedDate": "2020-06-29T23:14:03Z", "type": "commit"}]}