{"pr_number": 6963, "pr_title": "#6956 Implement possibility to easy switch from QR Bill to ESR ", "pr_createdAt": "2020-07-06T12:42:37Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/6963", "timeline": [{"oid": "d0e24874024fbe943f9106421cc418a52470073b", "url": "https://github.com/metasfresh/metasfresh/commit/d0e24874024fbe943f9106421cc418a52470073b", "message": "#6956 Adfd function isShowQRBill\n\nImplement possibility to easy switch from QR Bill to ESR", "committedDate": "2020-07-03T08:21:19Z", "type": "commit"}, {"oid": "57989e9a865d937a965ea4ee81d92f73c6aa4b4a", "url": "https://github.com/metasfresh/metasfresh/commit/57989e9a865d937a965ea4ee81d92f73c6aa4b4a", "message": "#6956 Add sys config ShowQRBill\n\n#6956 Implement possibility to easy switch from QR Bill to ESR", "committedDate": "2020-07-03T08:22:27Z", "type": "commit"}, {"oid": "ea4931d813ddc916181adccaed54e54b4c4123fc", "url": "https://github.com/metasfresh/metasfresh/commit/ea4931d813ddc916181adccaed54e54b4c4123fc", "message": "#6956 Add printWhen logic in the jasper invoice report\n\n#6956 Implement possibility to easy switch from QR Bill to ESR", "committedDate": "2020-07-03T08:40:49Z", "type": "commit"}, {"oid": "40d94307c626e3ae53cc1c07414b4b5357c063d1", "url": "https://github.com/metasfresh/metasfresh/commit/40d94307c626e3ae53cc1c07414b4b5357c063d1", "message": "#6956 Minor cleaning", "committedDate": "2020-07-06T12:44:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIwOTA5Nw==", "url": "https://github.com/metasfresh/metasfresh/pull/6963#discussion_r450209097", "bodyText": "maybe we should leave the loop here?", "author": "metas-ts", "createdAt": "2020-07-06T13:10:25Z", "path": "backend/de.metas.fresh/de.metas.fresh.base/src/main/sql/postgresql/ddl/functions/isShowQRBill.sql", "diffHunk": "@@ -0,0 +1,43 @@\n+DROP FUNCTION IF EXISTS report.isShowQRBill(IN p_AD_Client_ID numeric, IN p_AD_Org_ID numeric);\n+\n+create or replace function report.isShowQRBill(IN p_AD_Client_ID numeric, IN p_AD_Org_ID numeric) RETURNS CHAR AS\n+$$\n+DECLARE\n+    isShowQRBill CHAR DEFAULT 'Y';\n+    foundValue   BOOLEAN DEFAULT FALSE;\n+    rec_config   RECORD;\n+    sysConfigs CURSOR FOR SELECT *\n+                          from AD_SysConfig\n+                          where Name = 'ShowQRBill';\n+BEGIN\n+    OPEN sysConfigs;\n+\n+    LOOP\n+        -- fetch row into the film\n+        FETCH sysConfigs INTO rec_config;\n+        -- exit when no more row to fetch\n+        EXIT WHEN NOT FOUND;\n+\n+        -- build the output\n+        IF rec_config.AD_Client_ID = p_AD_Client_ID AND rec_config.AD_Org_ID = p_AD_Org_ID THEN\n+            isShowQRBill := rec_config.value;\n+            foundValue := TRUE;", "originalCommit": "40d94307c626e3ae53cc1c07414b4b5357c063d1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIxMTU3OQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6963#discussion_r450211579", "bodyText": "I might be underthinking the problem, but maybe the function could also have done something along the lines of\nselect ... from AD_SysConfig where AD_Client_ID IN (0,1000000) AND AD_Org_ID IN (0, p_AD_Org_ID) ORDER BY AD_Org_ID DESC, AD_Client_ID DESC LIMIT 1", "author": "metas-ts", "createdAt": "2020-07-06T13:14:38Z", "path": "backend/de.metas.fresh/de.metas.fresh.base/src/main/sql/postgresql/ddl/functions/isShowQRBill.sql", "diffHunk": "@@ -0,0 +1,43 @@\n+DROP FUNCTION IF EXISTS report.isShowQRBill(IN p_AD_Client_ID numeric, IN p_AD_Org_ID numeric);\n+\n+create or replace function report.isShowQRBill(IN p_AD_Client_ID numeric, IN p_AD_Org_ID numeric) RETURNS CHAR AS\n+$$\n+DECLARE\n+    isShowQRBill CHAR DEFAULT 'Y';\n+    foundValue   BOOLEAN DEFAULT FALSE;\n+    rec_config   RECORD;\n+    sysConfigs CURSOR FOR SELECT *\n+                          from AD_SysConfig\n+                          where Name = 'ShowQRBill';\n+BEGIN\n+    OPEN sysConfigs;\n+\n+    LOOP\n+        -- fetch row into the film\n+        FETCH sysConfigs INTO rec_config;\n+        -- exit when no more row to fetch\n+        EXIT WHEN NOT FOUND;\n+\n+        -- build the output\n+        IF rec_config.AD_Client_ID = p_AD_Client_ID AND rec_config.AD_Org_ID = p_AD_Org_ID THEN\n+            isShowQRBill := rec_config.value;\n+            foundValue := TRUE;\n+        END IF;\n+\n+    END LOOP;\n+\n+    -- Close the cursor\n+    CLOSE sysConfigs;\n+\n+\n+    IF foundValue = FALSE THEN\n+        SELECT VALUE\n+        INTO isShowQRBill\n+        from AD_SysConfig\n+        where Name = 'ShowQRBill' AND AD_Client_ID = 0 AND AD_Org_ID = 0;\n+    END IF;\n+\n+    return isShowQRBill;\n+END\n+$$\n+    LANGUAGE plpgsql;", "originalCommit": "40d94307c626e3ae53cc1c07414b4b5357c063d1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIxMTgxNw==", "url": "https://github.com/metasfresh/metasfresh/pull/6963#discussion_r450211817", "bodyText": "please add a description that explains what the function switches between", "author": "metas-ts", "createdAt": "2020-07-06T13:15:07Z", "path": "backend/de.metas.fresh/de.metas.fresh.base/src/main/sql/postgresql/system/70-de.metas.fresh/5562680_sys_gh6956_AddSHowQRBIllSysCOnfig.sql", "diffHunk": "@@ -0,0 +1,10 @@\n+-- 2020-07-02T12:08:05.045Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+INSERT INTO AD_SysConfig (AD_Client_ID,AD_Org_ID,AD_SysConfig_ID,ConfigurationLevel,Created,CreatedBy,EntityType,IsActive,Name,Updated,UpdatedBy,Value) VALUES (0,0,541328,'S',TO_TIMESTAMP('2020-07-02 15:08:04','YYYY-MM-DD HH24:MI:SS'),100,'D','Y','ShowQRBill',TO_TIMESTAMP('2020-07-02 15:08:04','YYYY-MM-DD HH24:MI:SS'),100,'Y')", "originalCommit": "40d94307c626e3ae53cc1c07414b4b5357c063d1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cce53313092adaaef0d4676c687a714d768205fe", "url": "https://github.com/metasfresh/metasfresh/commit/cce53313092adaaef0d4676c687a714d768205fe", "message": "#6956 Simplify things", "committedDate": "2020-07-06T13:40:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIzNjM5OQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6963#discussion_r450236399", "bodyText": "clarified with cris, if there is no value, it will stay 'Y' and not be reassigned NULL", "author": "metas-ts", "createdAt": "2020-07-06T13:54:12Z", "path": "backend/de.metas.fresh/de.metas.fresh.base/src/main/sql/postgresql/ddl/functions/isShowQRBill.sql", "diffHunk": "@@ -0,0 +1,17 @@\n+DROP FUNCTION IF EXISTS report.isShowQRBill(IN p_AD_Client_ID numeric, IN p_AD_Org_ID numeric);\n+\n+create or replace function report.isShowQRBill(IN p_AD_Client_ID numeric, IN p_AD_Org_ID numeric) RETURNS CHAR AS\n+$$\n+DECLARE\n+    isShowQRBill CHAR DEFAULT 'Y';\n+BEGIN\n+ \n+        SELECT VALUE\n+        INTO isShowQRBill", "originalCommit": "cce53313092adaaef0d4676c687a714d768205fe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}