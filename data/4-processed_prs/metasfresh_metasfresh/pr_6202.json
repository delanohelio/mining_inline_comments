{"pr_number": 6202, "pr_title": "Support packing instructions for invoice line 'Batch entry'", "pr_createdAt": "2020-02-17T15:35:12Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/6202", "timeline": [{"oid": "cc49d527bf2df4adcc890f086ef114e163228bd5", "url": "https://github.com/metasfresh/metasfresh/commit/cc49d527bf2df4adcc890f086ef114e163228bd5", "message": "Support packing instructions for invoice line 'Batch entry'\nhttps://github.com/metasfresh/metasfresh/issues/6201", "committedDate": "2020-02-17T15:32:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ1Mzk4Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6202#discussion_r380453986", "bodyText": "Adding this method is fine, but now we have two ways of creating an instance and devs won't know which one to take.\nSo, suggestion: clean up the InvoiceLineHUPackingAware constructor:\n\nmake it private\nremove the super() (compiler will add it to the bytecode for you ;-) )\nremove the Check.assumeNotNull and instead annotate the parameter with lombok @NonNull", "author": "metas-ts", "createdAt": "2020-02-18T04:50:18Z", "path": "de.metas.handlingunits.base/src/main/java/de/metas/adempiere/gui/search/impl/InvoiceLineHUPackingAware.java", "diffHunk": "@@ -50,6 +50,11 @@ public InvoiceLineHUPackingAware(final I_C_InvoiceLine invoiceLine)\n \t\tthis.invoiceLine = invoiceLine;\n \t}\n \n+\tpublic static InvoiceLineHUPackingAware of( org.compiere.model.I_C_InvoiceLine invoiceLine )", "originalCommit": "cc49d527bf2df4adcc890f086ef114e163228bd5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ1NDQxNg==", "url": "https://github.com/metasfresh/metasfresh/pull/6202#discussion_r380454416", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\tAND M_PriceList_Version.ValidFrom <=  ''@DateInvoiced@''\n          \n          \n            \n            \t\t\t\t\tAND M_PriceList_Version.ValidFrom <=  ''@DateInvoiced@''\n          \n          \n            \n            \t\t\t\t\tAND M_PriceList_Version.IsActive = ''Y''\n          \n      \n    \n    \n  \n\notherwise the ValidFrom you select in here might belong to an inactive PLV and then the subselect for pp.M_PriceList_Version_ID would not find anything", "author": "metas-ts", "createdAt": "2020-02-18T04:52:36Z", "path": "de.metas.swat/de.metas.swat.base/src/main/sql/postgresql/system/48-de.metas.order/5552410_sys_gh6201_add_packing_item_validation_rule_for_invoiceLine.sql", "diffHunk": "@@ -0,0 +1,54 @@\n+-- 2020-02-17T13:14:26.869Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+INSERT INTO AD_Val_Rule (AD_Client_ID,AD_Org_ID,AD_Val_Rule_ID,Code,Created,CreatedBy,EntityType,IsActive,Name,Type,Updated,UpdatedBy) VALUES (0,0,540480,'-- GENERAL\n+M_HU_PI_Item_Product.AD_Org_ID IN (0, @AD_Org_ID@)\n+AND (M_HU_PI_Item_Product.M_Product_ID=@M_Product_ID@ OR (M_HU_PI_Item_Product.isAllowAnyProduct=''Y'' AND M_HU_PI_Item_Product.M_HU_PI_Item_Product_ID not in (100)))\n+AND ( M_HU_PI_Item_Product.C_BPartner_ID = @C_BPartner_ID@ OR M_HU_PI_Item_Product.C_BPartner_ID IS NULL)\n+AND M_HU_PI_Item_Product.ValidFrom <= ''@DateInvoiced@'' AND ( ''@DateInvoiced@'' <= M_HU_PI_Item_Product.ValidTo OR M_HU_PI_Item_Product.ValidTo IS NULL )\n+AND M_HU_PI_Item_Product.M_HU_PI_Item_ID IN\n+\t( SELECT i.M_HU_PI_Item_ID \n+\tfrom M_HU_PI_Item i \n+\twhere i.M_HU_PI_Version_ID IN\n+\t\t(SELECT v.M_HU_PI_Version_ID \n+\t\tfrom M_HU_PI_Version v \n+\t\twhere v.HU_UnitType = ''TU''\n+\t\t)\n+\t)\n+\t\n+-- Price list\n+AND\n+(\n+\t-- AUFTRAG\n+\t(\n+\t\t''@IsSOTrx@'' = ''Y''\n+\t)\n+\n+\t-- BESTELLUNG\n+\tOR\n+\t(\n+\t\t''@IsSOTrx@'' = ''N''\n+\t\tAND M_HU_PI_Item_Product.M_HU_PI_Item_Product_ID IN\n+\t\t(\n+\t\t\tSELECT pp.M_HU_PI_Item_Product_ID\n+\t\t\tfrom M_ProductPrice pp\n+\t\t\twhere pp.M_Product_ID = @M_Product_ID@ AND pp.IsActive = ''Y''\n+\t\t\tAND pp.M_PriceList_Version_ID =\n+\t\t\t(\n+\t\t\t\tSELECT M_PriceList_Version.M_PriceList_Version_ID\n+\t\t\t\tfrom M_PriceList_Version\n+\t\t\t\twhere M_PriceList_Version.M_PriceList_ID = @M_PriceList_ID@\n+\t\t\t\tAND M_PriceList_Version.IsActive = ''Y''\n+\t\t\t\tAND M_PriceList_Version.ValidFrom =\n+\t\t\t\t(\n+\t\t\t\t\tSELECT MAX(M_PriceList_Version.ValidFrom)\n+\t\t\t\t\tfrom M_PriceList_Version\n+\t\t\t\t\twhere M_PriceList_Version.M_PriceList_ID = @M_PriceList_ID@\n+\t\t\t\t\tAND M_PriceList_Version.ValidFrom <=  ''@DateInvoiced@''", "originalCommit": "cc49d527bf2df4adcc890f086ef114e163228bd5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ1NDg0OQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6202#discussion_r380454849", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t-- AUFTRAG\n          \n          \n            \n            \t-- SALES INVOICE", "author": "metas-ts", "createdAt": "2020-02-18T04:55:00Z", "path": "de.metas.swat/de.metas.swat.base/src/main/sql/postgresql/system/48-de.metas.order/5552410_sys_gh6201_add_packing_item_validation_rule_for_invoiceLine.sql", "diffHunk": "@@ -0,0 +1,54 @@\n+-- 2020-02-17T13:14:26.869Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+INSERT INTO AD_Val_Rule (AD_Client_ID,AD_Org_ID,AD_Val_Rule_ID,Code,Created,CreatedBy,EntityType,IsActive,Name,Type,Updated,UpdatedBy) VALUES (0,0,540480,'-- GENERAL\n+M_HU_PI_Item_Product.AD_Org_ID IN (0, @AD_Org_ID@)\n+AND (M_HU_PI_Item_Product.M_Product_ID=@M_Product_ID@ OR (M_HU_PI_Item_Product.isAllowAnyProduct=''Y'' AND M_HU_PI_Item_Product.M_HU_PI_Item_Product_ID not in (100)))\n+AND ( M_HU_PI_Item_Product.C_BPartner_ID = @C_BPartner_ID@ OR M_HU_PI_Item_Product.C_BPartner_ID IS NULL)\n+AND M_HU_PI_Item_Product.ValidFrom <= ''@DateInvoiced@'' AND ( ''@DateInvoiced@'' <= M_HU_PI_Item_Product.ValidTo OR M_HU_PI_Item_Product.ValidTo IS NULL )\n+AND M_HU_PI_Item_Product.M_HU_PI_Item_ID IN\n+\t( SELECT i.M_HU_PI_Item_ID \n+\tfrom M_HU_PI_Item i \n+\twhere i.M_HU_PI_Version_ID IN\n+\t\t(SELECT v.M_HU_PI_Version_ID \n+\t\tfrom M_HU_PI_Version v \n+\t\twhere v.HU_UnitType = ''TU''\n+\t\t)\n+\t)\n+\t\n+-- Price list\n+AND\n+(\n+\t-- AUFTRAG", "originalCommit": "cc49d527bf2df4adcc890f086ef114e163228bd5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ1NDg4NQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6202#discussion_r380454885", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t-- BESTELLUNG\n          \n          \n            \n            \t-- PURCHASE INVOICE", "author": "metas-ts", "createdAt": "2020-02-18T04:55:13Z", "path": "de.metas.swat/de.metas.swat.base/src/main/sql/postgresql/system/48-de.metas.order/5552410_sys_gh6201_add_packing_item_validation_rule_for_invoiceLine.sql", "diffHunk": "@@ -0,0 +1,54 @@\n+-- 2020-02-17T13:14:26.869Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+INSERT INTO AD_Val_Rule (AD_Client_ID,AD_Org_ID,AD_Val_Rule_ID,Code,Created,CreatedBy,EntityType,IsActive,Name,Type,Updated,UpdatedBy) VALUES (0,0,540480,'-- GENERAL\n+M_HU_PI_Item_Product.AD_Org_ID IN (0, @AD_Org_ID@)\n+AND (M_HU_PI_Item_Product.M_Product_ID=@M_Product_ID@ OR (M_HU_PI_Item_Product.isAllowAnyProduct=''Y'' AND M_HU_PI_Item_Product.M_HU_PI_Item_Product_ID not in (100)))\n+AND ( M_HU_PI_Item_Product.C_BPartner_ID = @C_BPartner_ID@ OR M_HU_PI_Item_Product.C_BPartner_ID IS NULL)\n+AND M_HU_PI_Item_Product.ValidFrom <= ''@DateInvoiced@'' AND ( ''@DateInvoiced@'' <= M_HU_PI_Item_Product.ValidTo OR M_HU_PI_Item_Product.ValidTo IS NULL )\n+AND M_HU_PI_Item_Product.M_HU_PI_Item_ID IN\n+\t( SELECT i.M_HU_PI_Item_ID \n+\tfrom M_HU_PI_Item i \n+\twhere i.M_HU_PI_Version_ID IN\n+\t\t(SELECT v.M_HU_PI_Version_ID \n+\t\tfrom M_HU_PI_Version v \n+\t\twhere v.HU_UnitType = ''TU''\n+\t\t)\n+\t)\n+\t\n+-- Price list\n+AND\n+(\n+\t-- AUFTRAG\n+\t(\n+\t\t''@IsSOTrx@'' = ''Y''\n+\t)\n+\n+\t-- BESTELLUNG", "originalCommit": "cc49d527bf2df4adcc890f086ef114e163228bd5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ1NTk3Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6202#discussion_r380455976", "bodyText": "Why do we need all this pricing stuff this only for purchase invoices and not for sales invoices?\nSpoiler: we do need it for both :-) !\nBackground:\nin sales orders, the packaging is decided on shipment-time. So the sales order does not have to worry about what packaging will be shippend and invoiced later. Only for purchase orders we need the packaging products' prices on order time.\nHowever AFAIU\nthe invoice line does need to worry if the invoiced packaing product has a price!", "author": "metas-ts", "createdAt": "2020-02-18T05:00:51Z", "path": "de.metas.swat/de.metas.swat.base/src/main/sql/postgresql/system/48-de.metas.order/5552410_sys_gh6201_add_packing_item_validation_rule_for_invoiceLine.sql", "diffHunk": "@@ -0,0 +1,54 @@\n+-- 2020-02-17T13:14:26.869Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+INSERT INTO AD_Val_Rule (AD_Client_ID,AD_Org_ID,AD_Val_Rule_ID,Code,Created,CreatedBy,EntityType,IsActive,Name,Type,Updated,UpdatedBy) VALUES (0,0,540480,'-- GENERAL\n+M_HU_PI_Item_Product.AD_Org_ID IN (0, @AD_Org_ID@)\n+AND (M_HU_PI_Item_Product.M_Product_ID=@M_Product_ID@ OR (M_HU_PI_Item_Product.isAllowAnyProduct=''Y'' AND M_HU_PI_Item_Product.M_HU_PI_Item_Product_ID not in (100)))\n+AND ( M_HU_PI_Item_Product.C_BPartner_ID = @C_BPartner_ID@ OR M_HU_PI_Item_Product.C_BPartner_ID IS NULL)\n+AND M_HU_PI_Item_Product.ValidFrom <= ''@DateInvoiced@'' AND ( ''@DateInvoiced@'' <= M_HU_PI_Item_Product.ValidTo OR M_HU_PI_Item_Product.ValidTo IS NULL )\n+AND M_HU_PI_Item_Product.M_HU_PI_Item_ID IN\n+\t( SELECT i.M_HU_PI_Item_ID \n+\tfrom M_HU_PI_Item i \n+\twhere i.M_HU_PI_Version_ID IN\n+\t\t(SELECT v.M_HU_PI_Version_ID \n+\t\tfrom M_HU_PI_Version v \n+\t\twhere v.HU_UnitType = ''TU''\n+\t\t)\n+\t)\n+\t\n+-- Price list\n+AND\n+(\n+\t-- AUFTRAG\n+\t(\n+\t\t''@IsSOTrx@'' = ''Y''\n+\t)\n+\n+\t-- BESTELLUNG\n+\tOR\n+\t(\n+\t\t''@IsSOTrx@'' = ''N''", "originalCommit": "cc49d527bf2df4adcc890f086ef114e163228bd5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ1NjM3Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6202#discussion_r380456376", "bodyText": "replace @M_Product_ID@ with @M_Product_ID/0@ to avoid errors in the log if this val-rule is run before a product was selected.\nMake sure with @dragospodariu96 you both know wtf the /0 is about", "author": "metas-ts", "createdAt": "2020-02-18T05:03:09Z", "path": "de.metas.swat/de.metas.swat.base/src/main/sql/postgresql/system/48-de.metas.order/5552410_sys_gh6201_add_packing_item_validation_rule_for_invoiceLine.sql", "diffHunk": "@@ -0,0 +1,54 @@\n+-- 2020-02-17T13:14:26.869Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+INSERT INTO AD_Val_Rule (AD_Client_ID,AD_Org_ID,AD_Val_Rule_ID,Code,Created,CreatedBy,EntityType,IsActive,Name,Type,Updated,UpdatedBy) VALUES (0,0,540480,'-- GENERAL\n+M_HU_PI_Item_Product.AD_Org_ID IN (0, @AD_Org_ID@)", "originalCommit": "cc49d527bf2df4adcc890f086ef114e163228bd5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b81a9da3f67e4742133d83cab540745d63e2f475", "url": "https://github.com/metasfresh/metasfresh/commit/b81a9da3f67e4742133d83cab540745d63e2f475", "message": "Support packing instructions for invoice line 'Batch entry'\nhttps://github.com/metasfresh/metasfresh/issues/6201", "committedDate": "2020-02-18T09:17:34Z", "type": "commit"}, {"oid": "fb76e2d04dc85d89784af46cea1cf9176c736790", "url": "https://github.com/metasfresh/metasfresh/commit/fb76e2d04dc85d89784af46cea1cf9176c736790", "message": "Support packing instructions for invoice line 'Batch entry'\nhttps://github.com/metasfresh/metasfresh/issues/6201", "committedDate": "2020-02-18T09:26:14Z", "type": "commit"}]}