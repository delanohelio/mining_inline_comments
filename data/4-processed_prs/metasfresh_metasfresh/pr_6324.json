{"pr_number": 6324, "pr_title": "Unconditionally migrate `AD_Org_ID` process parameter to `Search` from whatever it is now", "pr_createdAt": "2020-03-10T07:24:39Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/6324", "timeline": [{"oid": "241520b9d3bc94d6b1adac0a6e2204d5aedaafb9", "url": "https://github.com/metasfresh/metasfresh/commit/241520b9d3bc94d6b1adac0a6e2204d5aedaafb9", "message": "Unconditionally migrate `AD_Org_ID` process parameter to `Search` from whatever it is now\n\nhttps://github.com/metasfresh/metasfresh/issues/6298", "committedDate": "2020-03-10T07:23:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQyNDAyNg==", "url": "https://github.com/metasfresh/metasfresh/pull/6324#discussion_r390424026", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              AND ad_element_id = (SELECT ad_element_id FROM ad_element WHERE columnname = 'AD_Org_ID')\n          \n          \n            \n              AND ad_element_id = (SELECT ad_element_id FROM ad_element WHERE columnname = 'AD_Org_ID')\n          \n          \n            \n              AND ad_reference_id != (SELECT ad_reference_id FROM ad_reference WHERE name = 'Search')", "author": "metas-ts", "createdAt": "2020-03-10T15:58:25Z", "path": "de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5554220_sys_gh6298_Update_AD_Org_ID_InProcessesToSearch.sql", "diffHunk": "@@ -0,0 +1,18 @@\n+-- Backup the table AD_Process_Para, Even though only the rows containing 'AD_Org_ID' will be modified\n+CREATE TABLE backup.ad_process_para_gh6298_ad_org_id_as_search AS\n+    (\n+        SELECT *\n+        FROM ad_process_para\n+    )\n+;\n+\n+\n+-- Unconditionally update the `ad_reference_id` to `Search`\n+UPDATE ad_process_para\n+SET --\n+    ad_reference_id = (SELECT ad_reference_id FROM ad_reference WHERE name = 'Search'),\n+    UpdatedBy=0,\n+    Updated=now()\n+WHERE TRUE\n+  AND ad_element_id = (SELECT ad_element_id FROM ad_element WHERE columnname = 'AD_Org_ID')", "originalCommit": "241520b9d3bc94d6b1adac0a6e2204d5aedaafb9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQyOTY4MA==", "url": "https://github.com/metasfresh/metasfresh/pull/6324#discussion_r390429680", "bodyText": "please stick with teos suggestion to update only the record that actually need updating", "author": "metas-ts", "createdAt": "2020-03-10T16:06:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQyNDAyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc1ODc5OQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6324#discussion_r390758799", "bodyText": "updated sql", "author": "TheBestPessimist", "createdAt": "2020-03-11T05:55:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQyNDAyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQyNzc0MA==", "url": "https://github.com/metasfresh/metasfresh/pull/6324#discussion_r390427740", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                Updated=now()\n          \n          \n            \n                Updated=`2020-03-10 17:01:56.767453+01`\n          \n      \n    \n    \n  \n\nuse a hardcoded date string that will be the same in the SQL and the DB", "author": "metas-ts", "createdAt": "2020-03-10T16:03:19Z", "path": "de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5554220_sys_gh6298_Update_AD_Org_ID_InProcessesToSearch.sql", "diffHunk": "@@ -0,0 +1,18 @@\n+-- Backup the table AD_Process_Para, Even though only the rows containing 'AD_Org_ID' will be modified\n+CREATE TABLE backup.ad_process_para_gh6298_ad_org_id_as_search AS\n+    (\n+        SELECT *\n+        FROM ad_process_para\n+    )\n+;\n+\n+\n+-- Unconditionally update the `ad_reference_id` to `Search`\n+UPDATE ad_process_para\n+SET --\n+    ad_reference_id = (SELECT ad_reference_id FROM ad_reference WHERE name = 'Search'),\n+    UpdatedBy=0,\n+    Updated=now()", "originalCommit": "241520b9d3bc94d6b1adac0a6e2204d5aedaafb9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc1ODc2Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6324#discussion_r390758766", "bodyText": "done", "author": "TheBestPessimist", "createdAt": "2020-03-11T05:55:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQyNzc0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQyODI3Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6324#discussion_r390428276", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                UpdatedBy=0,\n          \n          \n            \n                UpdatedBy=99,\n          \n      \n    \n    \n  \n\nuse AD_User_ID 99 which is generally used for \"manual\" migrations", "author": "metas-ts", "createdAt": "2020-03-10T16:04:03Z", "path": "de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5554220_sys_gh6298_Update_AD_Org_ID_InProcessesToSearch.sql", "diffHunk": "@@ -0,0 +1,18 @@\n+-- Backup the table AD_Process_Para, Even though only the rows containing 'AD_Org_ID' will be modified\n+CREATE TABLE backup.ad_process_para_gh6298_ad_org_id_as_search AS\n+    (\n+        SELECT *\n+        FROM ad_process_para\n+    )\n+;\n+\n+\n+-- Unconditionally update the `ad_reference_id` to `Search`\n+UPDATE ad_process_para\n+SET --\n+    ad_reference_id = (SELECT ad_reference_id FROM ad_reference WHERE name = 'Search'),\n+    UpdatedBy=0,", "originalCommit": "241520b9d3bc94d6b1adac0a6e2204d5aedaafb9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc1ODg3Mg==", "url": "https://github.com/metasfresh/metasfresh/pull/6324#discussion_r390758872", "bodyText": "Updated user id", "author": "TheBestPessimist", "createdAt": "2020-03-11T05:55:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQyODI3Ng=="}], "type": "inlineReview"}, {"oid": "b9d7fbd21c332fcad2f95c8db74b1dc8f0890a0f", "url": "https://github.com/metasfresh/metasfresh/commit/b9d7fbd21c332fcad2f95c8db74b1dc8f0890a0f", "message": "Fixes after review\n\n- update only the records that actually need updating\n- use a hardcoded date string that will be the same in the SQL and the DB\n- use AD_User_ID 99 which is generally used for \"manual\" migrations\n\nhttps://github.com/metasfresh/metasfresh/issues/6298", "committedDate": "2020-03-11T06:02:37Z", "type": "commit"}, {"oid": "70ffbf45ea553e3d81c94dc13cf0adb805ee0915", "url": "https://github.com/metasfresh/metasfresh/commit/70ffbf45ea553e3d81c94dc13cf0adb805ee0915", "message": "Bugfix: Update only those process params which are not of type `Search`\n\nhttps://github.com/metasfresh/metasfresh/issues/6298", "committedDate": "2020-03-11T06:15:06Z", "type": "commit"}]}