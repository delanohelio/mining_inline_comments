{"pr_number": 6895, "pr_title": "Refactoring selections and TableItems component ", "pr_createdAt": "2020-06-23T10:15:19Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/6895", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE1ODA3Mw==", "url": "https://github.com/metasfresh/metasfresh/pull/6895#discussion_r444158073", "bodyText": "Pls add Doc this + param. Thanks", "author": "petrican", "createdAt": "2020-06-23T11:39:26Z", "path": "frontend/src/utils/tableHelpers.js", "diffHunk": "@@ -121,6 +121,24 @@ export function getSizeClass(col) {\n   }\n }\n ", "originalCommit": "f2076e9b3102526699c8f7e5c67645bcc470148b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY1MzA1NQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6895#discussion_r444653055", "bodyText": "As I understood this is used such that we don't mess master.docId with params.docId.   I dunno I would put instead of dataId masterDocId maybe. So something like const { docId: masterDocId } = master;  Same for the params.docId", "author": "petrican", "createdAt": "2020-06-24T05:30:45Z", "path": "frontend/src/components/app/MasterWindow.js", "diffHunk": "@@ -295,6 +295,8 @@ export default class MasterWindow extends PureComponent {\n       introHints,\n     } = this.state;\n     const { docActionElement, documentSummaryElement } = master.layout;\n+\n+    // TODO: Do we need to have docId and dataId ?", "originalCommit": "012799b0b2c90dcf0655c40d104cf2d678876fb6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk3NDc5OQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6895#discussion_r444974799", "bodyText": "Maybe. Still this is not the scope of this effort, so just leaving it here.", "author": "siemiatj", "createdAt": "2020-06-24T15:19:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY1MzA1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY1MzY2Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6895#discussion_r444653666", "bodyText": "viewId,", "author": "petrican", "createdAt": "2020-06-24T05:33:02Z", "path": "frontend/src/components/app/Modal.js", "diffHunk": "@@ -227,32 +208,34 @@ class Modal extends Component {\n         try {\n           const options = {\n             processType: windowId,\n-            viewId: modalViewId,\n-            type: parentType,\n-            ids: modalViewId\n+            viewId: viewId,", "originalCommit": "012799b0b2c90dcf0655c40d104cf2d678876fb6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY1NTY3MA==", "url": "https://github.com/metasfresh/metasfresh/pull/6895#discussion_r444655670", "bodyText": "Can't this just be string for both Title and Desc ?", "author": "petrican", "createdAt": "2020-06-24T05:39:54Z", "path": "frontend/src/components/app/RawModal.js", "diffHunk": "@@ -409,38 +405,46 @@ ModalButton.propTypes = {\n /**\n  * @typedef {object} Props Component props\n  * @prop {func} dispatch\n- * @prop {func} [closeCallback]\n- * @prop {node} [children]\n- * @prop {array} [allowedCloseActions]\n- * @prop {string} [windowId]\n- * @prop {string} [viewId]\n- * @prop {string|node} [masterDocumentList]\n- * @prop {string|node} [modalTitle]\n- * @prop {string|node} [modalDescription]\n  * @prop {bool} [modalVisible]\n  * @prop {object} rawModal\n  * @prop {object} requests\n  * @prop {bool} success\n- * @prop {*} [name]\n- * @prop {func} [onShowTooltip]\n- * @prop {func} [onHideTooltip]\n- * @prop {func} [onClick]\n- * @prop {*} [tabIndex]\n+ * @prop {string} [indicator]\n+ * @prop {string|node} [modalTitle]\n+ * @prop {string|node} [modalDescription]\n+ * @prop {array} [allowedCloseActions]\n+ * @prop {string} [windowId]\n+ * @prop {string} [viewId]\n+ * @prop {string|node} [masterDocumentList]\n+ * @prop {node} [children]\n  */\n RawModal.propTypes = {\n   dispatch: PropTypes.func.isRequired,\n-  closeCallback: PropTypes.func,\n-  children: PropTypes.node,\n-  allowedCloseActions: PropTypes.array,\n-  windowId: PropTypes.string,\n-  viewId: PropTypes.string,\n-  masterDocumentList: PropTypes.any,\n-  modalTitle: PropTypes.oneOfType([PropTypes.string, PropTypes.node]),\n-  modalDescription: PropTypes.oneOfType([PropTypes.string, PropTypes.node]),\n   modalVisible: PropTypes.bool,\n   rawModal: PropTypes.object.isRequired,\n   requests: PropTypes.object.isRequired,\n   success: PropTypes.bool.isRequired,\n+  indicator: PropTypes.string.isRequired,\n+  modalTitle: PropTypes.oneOfType([PropTypes.string, PropTypes.node]),\n+  modalDescription: PropTypes.oneOfType([PropTypes.string, PropTypes.node]),", "originalCommit": "012799b0b2c90dcf0655c40d104cf2d678876fb6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcwMTA5Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6895#discussion_r444701096", "bodyText": "I wish, but I think for some reason sometimes we're sending a node. But this is not the focus of this PR so I won't dive into that. If you have spare cycles you can try to figure that out.", "author": "siemiatj", "createdAt": "2020-06-24T07:35:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY1NTY3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY1OTAxNw==", "url": "https://github.com/metasfresh/metasfresh/pull/6895#discussion_r444659017", "bodyText": "setRef = (ref) => (this.subHeader = ref);", "author": "petrican", "createdAt": "2020-06-24T05:50:52Z", "path": "frontend/src/components/header/SubHeader.js", "diffHunk": "@@ -503,26 +500,23 @@ class SubHeader extends Component {\n         closeSubheader={closeSubheader}\n         notfound={notfound}\n         docId={dataId ? dataId : viewId}\n-        rowId={selected}\n+        selected={selected}\n         activeTab={activeTab}\n-        activeTabSelected={activeTab && selected ? selected : []}\n       />\n     );\n   };\n \n-  /**\n-   * @method render\n-   * @summary ToDo: Describe the method.\n-   */\n+  setRef = (ref) => {", "originalCommit": "012799b0b2c90dcf0655c40d104cf2d678876fb6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcwMTMyMw==", "url": "https://github.com/metasfresh/metasfresh/pull/6895#discussion_r444701323", "bodyText": "For some reason I thought our linter settings forbid that.", "author": "siemiatj", "createdAt": "2020-06-24T07:35:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY1OTAxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY2MDQ1OQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6895#discussion_r444660459", "bodyText": "Pls add a doc in here explaining also the difference between isEditableOnDemand and isCellEditable. Thanks", "author": "petrican", "createdAt": "2020-06-24T05:55:32Z", "path": "frontend/src/components/table/TableItem.js", "diffHunk": "@@ -72,19 +71,32 @@ class TableItem extends PureComponent {\n ", "originalCommit": "012799b0b2c90dcf0655c40d104cf2d678876fb6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY2MDkyOA==", "url": "https://github.com/metasfresh/metasfresh/pull/6895#discussion_r444660928", "bodyText": "Small doc pls", "author": "petrican", "createdAt": "2020-06-24T05:57:02Z", "path": "frontend/src/components/table/TableItem.js", "diffHunk": "@@ -339,10 +314,54 @@ class TableItem extends PureComponent {\n     return [{}];\n   };\n \n+  updateRow = () => {", "originalCommit": "012799b0b2c90dcf0655c40d104cf2d678876fb6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY2MTAyMA==", "url": "https://github.com/metasfresh/metasfresh/pull/6895#discussion_r444661020", "bodyText": "Doc + parrams pls", "author": "petrican", "createdAt": "2020-06-24T05:57:23Z", "path": "frontend/src/components/table/TableItem.js", "diffHunk": "@@ -339,10 +314,54 @@ class TableItem extends PureComponent {\n     return [{}];\n   };\n \n+  updateRow = () => {\n+    this.setState(\n+      {\n+        updatedRow: true,\n+      },\n+      () => {\n+        setTimeout(() => {\n+          this.setState({\n+            updatedRow: false,\n+          });\n+        }, 1000);\n+      }\n+    );\n+  };\n+\n+  nestedSelect = (elem, cb) => {", "originalCommit": "012799b0b2c90dcf0655c40d104cf2d678876fb6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY2MTc2NQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6895#discussion_r444661765", "bodyText": "We can leave if as a \"hook\" for possible future adjustments of the data from the field but we first need to make sure editing works smooth", "author": "petrican", "createdAt": "2020-06-24T05:59:49Z", "path": "frontend/src/components/table/TableItem.js", "diffHunk": "@@ -360,19 +379,22 @@ class TableItem extends PureComponent {\n       isGerman,\n       isSelected,\n       focusOnFieldName,\n-      activeLocale,\n+      /*", "originalCommit": "012799b0b2c90dcf0655c40d104cf2d678876fb6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA2OTU5NA==", "url": "https://github.com/metasfresh/metasfresh/pull/6895#discussion_r445069594", "bodyText": "? What's this comment all about ?", "author": "siemiatj", "createdAt": "2020-06-24T17:52:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY2MTc2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwMzMxMw==", "url": "https://github.com/metasfresh/metasfresh/pull/6895#discussion_r445303313", "bodyText": "is about removing or not onItemChange", "author": "petrican", "createdAt": "2020-06-25T04:42:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY2MTc2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY2MzE1OQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6895#discussion_r444663159", "bodyText": "shrink the code by using destructuring  { includedView } pls", "author": "petrican", "createdAt": "2020-06-24T06:04:13Z", "path": "frontend/src/utils/documentListHelper.js", "diffHunk": "@@ -100,6 +98,24 @@ const DLmapStateToProps = (state, props) => {\n     viewId = null;\n   }\n \n+  let childTableId = null;\n+  const childSelector = getSelection();\n+  if (props.includedView && props.includedView.windowType) {", "originalCommit": "012799b0b2c90dcf0655c40d104cf2d678876fb6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY2MzQ3NA==", "url": "https://github.com/metasfresh/metasfresh/pull/6895#discussion_r444663474", "bodyText": "const { parentWindowType, parentDefaultViewId } = props;", "author": "petrican", "createdAt": "2020-06-24T06:05:15Z", "path": "frontend/src/utils/documentListHelper.js", "diffHunk": "@@ -100,6 +98,24 @@ const DLmapStateToProps = (state, props) => {\n     viewId = null;\n   }\n \n+  let childTableId = null;\n+  const childSelector = getSelection();\n+  if (props.includedView && props.includedView.windowType) {\n+    childTableId = getTableId({\n+      windowId: props.includedView.windowType,\n+      viewId: props.includedView.viewId,\n+    });\n+  }\n+\n+  let parentTableId = null;\n+  const parentSelector = getSelection();\n+  if (props.parentWindowType) {", "originalCommit": "012799b0b2c90dcf0655c40d104cf2d678876fb6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6dbef64fc5318ba69ed49485eba0c64974dda921", "url": "https://github.com/metasfresh/metasfresh/commit/6dbef64fc5318ba69ed49485eba0c64974dda921", "message": "- import `getSizeClass` directly in `TableCell`", "committedDate": "2020-06-25T10:46:20Z", "type": "commit"}, {"oid": "54032fc5a9d3ee1dc123298b04ea7644e9e97939", "url": "https://github.com/metasfresh/metasfresh/commit/54032fc5a9d3ee1dc123298b04ea7644e9e97939", "message": "#6854 TableItem initial refactoring", "committedDate": "2020-06-25T10:46:21Z", "type": "commit"}, {"oid": "194d28ae2acc88fd2a18cbe750dc1236800e552d", "url": "https://github.com/metasfresh/metasfresh/commit/194d28ae2acc88fd2a18cbe750dc1236800e552d", "message": "#6873 fix changing selection with multiple rows selected\n\n- remove some old code\n- add missing props", "committedDate": "2020-06-25T10:46:21Z", "type": "commit"}, {"oid": "3261c127f26c488aea62986ecd0f719f246efe9b", "url": "https://github.com/metasfresh/metasfresh/commit/3261c127f26c488aea62986ecd0f719f246efe9b", "message": "#6873 rewrite SubHeader's selections\n\n- use redux as data source", "committedDate": "2020-06-25T10:46:21Z", "type": "commit"}, {"oid": "925fce0ce21309516837bf2525141e4e991f54aa", "url": "https://github.com/metasfresh/metasfresh/commit/925fce0ce21309516837bf2525141e4e991f54aa", "message": "#6854 add removed helper fn back", "committedDate": "2020-06-25T10:46:21Z", "type": "commit"}, {"oid": "48b30c1693432609e313068c5bd0ea8e166ff951", "url": "https://github.com/metasfresh/metasfresh/commit/48b30c1693432609e313068c5bd0ea8e166ff951", "message": "#6873 rewrite selections for Actions\n\n- use redux as data source", "committedDate": "2020-06-25T10:46:21Z", "type": "commit"}, {"oid": "e09c9b50dc111ed9592116df17fc353e7b6a301b", "url": "https://github.com/metasfresh/metasfresh/commit/e09c9b50dc111ed9592116df17fc353e7b6a301b", "message": "#6873 rewrite selections for Modal\n\n- and small refactoring along the way", "committedDate": "2020-06-25T10:46:21Z", "type": "commit"}, {"oid": "a517ac6f546498f535a59effa39e63bbb18f93e3", "url": "https://github.com/metasfresh/metasfresh/commit/a517ac6f546498f535a59effa39e63bbb18f93e3", "message": "#6873 ditch old selections completely", "committedDate": "2020-06-25T10:46:21Z", "type": "commit"}, {"oid": "90ae9d6ba615afc74c159e494d01524d360e170f", "url": "https://github.com/metasfresh/metasfresh/commit/90ae9d6ba615afc74c159e494d01524d360e170f", "message": "#6873 small cleanup along the way", "committedDate": "2020-06-25T10:46:22Z", "type": "commit"}, {"oid": "adbca1f539d362dd0409658add7b57c1f5b05b0d", "url": "https://github.com/metasfresh/metasfresh/commit/adbca1f539d362dd0409658add7b57c1f5b05b0d", "message": "Fix linter error", "committedDate": "2020-06-25T10:46:22Z", "type": "commit"}, {"oid": "395a29c282d90d7b1ea1719200dc32b5cc1838f1", "url": "https://github.com/metasfresh/metasfresh/commit/395a29c282d90d7b1ea1719200dc32b5cc1838f1", "message": "#6873 update selections again", "committedDate": "2020-06-25T10:46:22Z", "type": "commit"}, {"oid": "b30becbb74edf6b47c734fafba79e2d582753fe0", "url": "https://github.com/metasfresh/metasfresh/commit/b30becbb74edf6b47c734fafba79e2d582753fe0", "message": "#6873 fix props, other small refactorings", "committedDate": "2020-06-25T10:46:22Z", "type": "commit"}, {"oid": "16395e2b92105c9cbfe7e4a3e4a05bd10aa604fb", "url": "https://github.com/metasfresh/metasfresh/commit/16395e2b92105c9cbfe7e4a3e4a05bd10aa604fb", "message": "- get rid of `editedCells`", "committedDate": "2020-06-25T10:59:04Z", "type": "commit"}, {"oid": "7ae339c9e6eff26b2c03a9d4eea1aaf8f3bc5995", "url": "https://github.com/metasfresh/metasfresh/commit/7ae339c9e6eff26b2c03a9d4eea1aaf8f3bc5995", "message": "#6854 remove unused code", "committedDate": "2020-06-25T10:59:12Z", "type": "commit"}, {"oid": "f7e3f3088bf3a19b25a5abf66714981221ac45ce", "url": "https://github.com/metasfresh/metasfresh/commit/f7e3f3088bf3a19b25a5abf66714981221ac45ce", "message": "#6854 add doc", "committedDate": "2020-06-25T10:59:12Z", "type": "commit"}, {"oid": "3a26b26b4a80337d819e6680fba7c8b1e1c5cc59", "url": "https://github.com/metasfresh/metasfresh/commit/3a26b26b4a80337d819e6680fba7c8b1e1c5cc59", "message": "Add back the test that renders with store data", "committedDate": "2020-06-25T10:59:12Z", "type": "commit"}, {"oid": "fc93fae62629ea0544d6341b1e1155f88b79a08e", "url": "https://github.com/metasfresh/metasfresh/commit/fc93fae62629ea0544d6341b1e1155f88b79a08e", "message": "Add extra safety check in Table and some unit tests", "committedDate": "2020-06-25T10:59:12Z", "type": "commit"}, {"oid": "c47ec3ef9badbd10e21fe2ed33161817449dd50a", "url": "https://github.com/metasfresh/metasfresh/commit/c47ec3ef9badbd10e21fe2ed33161817449dd50a", "message": "#6854 check if rows have length before selecting", "committedDate": "2020-06-25T10:59:12Z", "type": "commit"}, {"oid": "fa40929932e4f6edeb8b879b17a358250b314aed", "url": "https://github.com/metasfresh/metasfresh/commit/fa40929932e4f6edeb8b879b17a358250b314aed", "message": "#6854 cleanup TableItem\n\n- move some logic to utils\n- add code comments\n- other small changes", "committedDate": "2020-06-25T10:59:12Z", "type": "commit"}, {"oid": "85097e25f2b3ad7ae475506d194c022062f02e6c", "url": "https://github.com/metasfresh/metasfresh/commit/85097e25f2b3ad7ae475506d194c022062f02e6c", "message": "#6873 fix rendering table actions buttons", "committedDate": "2020-06-25T10:59:12Z", "type": "commit"}, {"oid": "19c7f2d8abfbeb146bba1dd158aea6e7db5e69fe", "url": "https://github.com/metasfresh/metasfresh/commit/19c7f2d8abfbeb146bba1dd158aea6e7db5e69fe", "message": "#6854 support storing change of a row property", "committedDate": "2020-06-25T10:59:13Z", "type": "commit"}, {"oid": "ceadf32ad7431f04456192a9d34621c8cd279fca", "url": "https://github.com/metasfresh/metasfresh/commit/ceadf32ad7431f04456192a9d34621c8cd279fca", "message": "#6854 improve comments", "committedDate": "2020-06-25T10:59:13Z", "type": "commit"}, {"oid": "774f5e54f06b57d1ce3f4eef8f04c09e1a5d03a9", "url": "https://github.com/metasfresh/metasfresh/commit/774f5e54f06b57d1ce3f4eef8f04c09e1a5d03a9", "message": "#6783 send same props to modals as in master", "committedDate": "2020-06-25T10:59:13Z", "type": "commit"}, {"oid": "59d0c0f33dc0746f1df0e0afd26b20786ca91ce8", "url": "https://github.com/metasfresh/metasfresh/commit/59d0c0f33dc0746f1df0e0afd26b20786ca91ce8", "message": "#6783 fix error when sorting", "committedDate": "2020-06-25T11:02:25Z", "type": "commit"}, {"oid": "59d0c0f33dc0746f1df0e0afd26b20786ca91ce8", "url": "https://github.com/metasfresh/metasfresh/commit/59d0c0f33dc0746f1df0e0afd26b20786ca91ce8", "message": "#6783 fix error when sorting", "committedDate": "2020-06-25T11:02:25Z", "type": "forcePushed"}, {"oid": "dc205ef8444483ce0b8729b37d655e28bb042b25", "url": "https://github.com/metasfresh/metasfresh/commit/dc205ef8444483ce0b8729b37d655e28bb042b25", "message": "Fix linter error", "committedDate": "2020-06-25T11:51:07Z", "type": "commit"}]}