{"pr_number": 6462, "pr_title": "Make sure `C_InvoiceLine.Price_UOM_ID` and `C_UOM_ID` are always set", "pr_createdAt": "2020-04-09T08:03:47Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/6462", "timeline": [{"oid": "f9431664d692c34b3958e1af15ba9e4a8abd45c0", "url": "https://github.com/metasfresh/metasfresh/commit/f9431664d692c34b3958e1af15ba9e4a8abd45c0", "message": "Ad migration script for handling empty `C_InvoiceLine.C_UOM_ID` and `C_InvoiceLine.Price_UOM_ID`\n\nhttps://github.com/metasfresh/metasfresh/issues/6458", "committedDate": "2020-04-08T12:36:16Z", "type": "commit"}, {"oid": "9c7dd1cbb6988856289f631bafe16a827d830961", "url": "https://github.com/metasfresh/metasfresh/commit/9c7dd1cbb6988856289f631bafe16a827d830961", "message": "Add model validator After Complete for handling empty `C_InvoiceLine.C_UOM_ID` and `C_InvoiceLine.Price_UOM_ID`\n\nhttps://github.com/metasfresh/metasfresh/issues/6458", "committedDate": "2020-04-09T08:01:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjEzNjcxNA==", "url": "https://github.com/metasfresh/metasfresh/pull/6462#discussion_r406136714", "bodyText": "pls add UpdatedBy and Updated with a \"hardcoded\" timestamp, e.g. 2020-04-09 13:23:07.035603+02\non some DBs there might be \"a lot\" of C_InvoiceLines affected by this SQL", "author": "metas-ts", "createdAt": "2020-04-09T11:24:22Z", "path": "de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5556570_sys_gh6458_Fix_C_InvoiceLines_With_Invalid_C_Uom_ID_or_Price_Uom_ID.sql", "diffHunk": "@@ -0,0 +1,9 @@\n+UPDATE c_invoiceline il", "originalCommit": "9c7dd1cbb6988856289f631bafe16a827d830961", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE2MTczMQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6462#discussion_r406161731", "bodyText": "done", "author": "TheBestPessimist", "createdAt": "2020-04-09T12:15:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjEzNjcxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjEzODIxMQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6462#discussion_r406138211", "bodyText": "ok - getStockUOMId never returns null", "author": "metas-ts", "createdAt": "2020-04-09T11:27:25Z", "path": "de.metas.swat/de.metas.swat.base/src/main/java/org/adempiere/invoice/service/impl/AbstractInvoiceBL.java", "diffHunk": "@@ -674,6 +678,29 @@ public void updateDescriptionFromDocTypeTargetId(final org.compiere.model.I_C_In\n \t\t}\n \t}\n \n+\t@Override\n+\tpublic void ensureUOMsAreNotNull(final @NonNull InvoiceId invoiceId)\n+\t{\n+\t\tfinal IInvoiceDAO invoiceDAO = Services.get(IInvoiceDAO.class);\n+\t\tfinal IProductBL productBL = Services.get(IProductBL.class);\n+\n+\t\tfinal List<I_C_InvoiceLine> lines = invoiceDAO.retrieveLines(invoiceId); // // TODO tbp: create this method!\n+\t\tfor (final I_C_InvoiceLine line : lines)\n+\t\t{\n+\t\t\tif (line.getC_UOM_ID() < 1)\n+\t\t\t{\n+\t\t\t\tfinal ProductId productId = ProductId.ofRepoId(line.getM_Product_ID());\n+\t\t\t\tfinal UomId stockUOMId = productBL.getStockUOMId(productId);", "originalCommit": "9c7dd1cbb6988856289f631bafe16a827d830961", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE2MjY2NQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6462#discussion_r406162665", "bodyText": "Added @NonNull to make that explicit", "author": "TheBestPessimist", "createdAt": "2020-04-09T12:17:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjEzODIxMQ=="}], "type": "inlineReview"}, {"oid": "fd1be6035c7e5f5378fd6f072da2d8cbfa941f8b", "url": "https://github.com/metasfresh/metasfresh/commit/fd1be6035c7e5f5378fd6f072da2d8cbfa941f8b", "message": "Update migration script to set `Updated` and `UpdatedBy`\n\nhttps://github.com/metasfresh/metasfresh/issues/6458", "committedDate": "2020-04-09T12:15:16Z", "type": "commit"}, {"oid": "15377882f305fff97422f719bfdf2de618c2558f", "url": "https://github.com/metasfresh/metasfresh/commit/15377882f305fff97422f719bfdf2de618c2558f", "message": "Make it explicit that function returns NonNull\n\nhttps://github.com/metasfresh/metasfresh/issues/6458", "committedDate": "2020-04-09T12:17:11Z", "type": "commit"}]}