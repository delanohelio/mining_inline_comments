{"pr_number": 6729, "pr_title": "#6713 Can Now Print Distribution Orders.", "pr_createdAt": "2020-05-25T17:00:49Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/6729", "timeline": [{"oid": "5c9ed8b64de61073491a2686d06a5293c51e84b9", "url": "https://github.com/metasfresh/metasfresh/commit/5c9ed8b64de61073491a2686d06a5293c51e84b9", "message": "#6713 Can Now Print Distribution Orders.", "committedDate": "2020-05-25T17:00:10Z", "type": "commit"}, {"oid": "c35aac5696895b2cb37f104d273d7d33a931ac22", "url": "https://github.com/metasfresh/metasfresh/commit/c35aac5696895b2cb37f104d273d7d33a931ac22", "message": "#6713 Fixed failing function due to wrong column name.", "committedDate": "2020-05-26T08:04:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0MzgzMQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6729#discussion_r430243831", "bodyText": "Do we need this?", "author": "cristinamghita", "createdAt": "2020-05-26T08:31:18Z", "path": "backend/de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5559960_sys_gh6713AddFunctionsForDistributionOrderPrint.sql", "diffHunk": "@@ -0,0 +1,438 @@\n+DROP FUNCTION IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root (IN Record_ID numeric, IN AD_Language Character Varying(6))\n+;\n+\n+DROP TABLE IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root\n+;\n+\n+CREATE TABLE de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root\n+(\n+    AD_User_ID                           numeric(10, 0),\n+    AD_Org_ID                            numeric(10, 0),\n+    DD_Order_ID                          numeric(10, 0),\n+    DocStatus                            Character(2),\n+    C_BPartner_ID                        numeric(10, 0),\n+    C_BPartner_Location_ID               numeric(10, 0),\n+    PrintName                            Character Varying(60),\n+    AD_Language                          Text,\n+    IsHidePackingMaterialInShipmentPrint Character(1),\n+    email                                Character Varying(50),\n+    displayhu                            text,", "originalCommit": "c35aac5696895b2cb37f104d273d7d33a931ac22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0NDE3Mw==", "url": "https://github.com/metasfresh/metasfresh/pull/6729#discussion_r430244173", "bodyText": "Do we need this?", "author": "cristinamghita", "createdAt": "2020-05-26T08:31:51Z", "path": "backend/de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5559960_sys_gh6713AddFunctionsForDistributionOrderPrint.sql", "diffHunk": "@@ -0,0 +1,438 @@\n+DROP FUNCTION IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root (IN Record_ID numeric, IN AD_Language Character Varying(6))\n+;\n+\n+DROP TABLE IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root\n+;\n+\n+CREATE TABLE de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root\n+(\n+    AD_User_ID                           numeric(10, 0),\n+    AD_Org_ID                            numeric(10, 0),\n+    DD_Order_ID                          numeric(10, 0),\n+    DocStatus                            Character(2),\n+    C_BPartner_ID                        numeric(10, 0),\n+    C_BPartner_Location_ID               numeric(10, 0),\n+    PrintName                            Character Varying(60),\n+    AD_Language                          Text,\n+    IsHidePackingMaterialInShipmentPrint Character(1),\n+    email                                Character Varying(50),\n+    displayhu                            text,", "originalCommit": "c35aac5696895b2cb37f104d273d7d33a931ac22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0NTA4Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6729#discussion_r430245086", "bodyText": "Do we need it?", "author": "cristinamghita", "createdAt": "2020-05-26T08:33:27Z", "path": "backend/de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5559960_sys_gh6713AddFunctionsForDistributionOrderPrint.sql", "diffHunk": "@@ -0,0 +1,438 @@\n+DROP FUNCTION IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root (IN Record_ID numeric, IN AD_Language Character Varying(6))\n+;\n+\n+DROP TABLE IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root\n+;\n+\n+CREATE TABLE de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root\n+(\n+    AD_User_ID                           numeric(10, 0),\n+    AD_Org_ID                            numeric(10, 0),\n+    DD_Order_ID                          numeric(10, 0),\n+    DocStatus                            Character(2),\n+    C_BPartner_ID                        numeric(10, 0),\n+    C_BPartner_Location_ID               numeric(10, 0),\n+    PrintName                            Character Varying(60),\n+    AD_Language                          Text,\n+    IsHidePackingMaterialInShipmentPrint Character(1),\n+    email                                Character Varying(50),\n+    displayhu                            text,\n+    issourcesupplycert                   character(1)\n+)\n+;\n+\n+\n+CREATE FUNCTION de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root(IN Record_ID   numeric,\n+                                                                            IN AD_Language Character Varying(6))\n+    RETURNS SETOF de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root\n+AS\n+$$\n+SELECT ddo.ad_user_id,\n+       ddo.ad_org_id,\n+       ddo.DD_Order_ID,\n+       ddo.docstatus,\n+       ddo.c_bpartner_id,\n+       ddo.c_bpartner_location_id,\n+       CASE\n+           WHEN ddo.DocStatus = 'DR'\n+               THEN dt.printname\n+               ELSE COALESCE(dtt.printname, dt.printname)\n+       END                                                              AS printname,\n+       CASE WHEN ddo.DocStatus IN ('DR', 'IP') THEN 'de_CH' ELSE $2 END AS AD_Language,\n+       isHidePackingMaterialInShipmentPrint,\n+       mb.email,\n+       CASE\n+           WHEN\n+               EXISTS(\n+                       SELECT 0\n+                       FROM DD_Orderline ddol\n+                                INNER JOIN M_Product p ON ddol.M_Product_ID = p.M_Product_ID AND p.isActive = 'Y'\n+                                INNER JOIN M_Product_Category pc ON p.M_Product_Category_ID = pc.M_Product_Category_ID AND pc.isActive = 'Y'\n+                       WHERE pc.M_Product_Category_ID = getSysConfigAsNumeric('PackingMaterialProductCategoryID', ddol.AD_Client_ID, ddol.AD_Org_ID)\n+                         AND ddo.DD_Order_ID = ddol.DD_Order_ID\n+                         AND ddol.isActive = 'Y'\n+                   )\n+               THEN 'Y'\n+               ELSE 'N'\n+       END                                                              AS displayhu,\n+       bp.issourcesupplycert\n+FROM DD_Order ddo\n+         JOIN C_BPartner bp ON ddo.C_BPartner_ID = bp.C_BPartner_ID AND bp.isActive = 'Y'\n+         INNER JOIN C_DocType dt ON ddo.C_DocType_ID = dt.C_DocType_ID AND dt.isActive = 'Y'\n+         LEFT OUTER JOIN C_DocType_Trl dtt ON ddo.C_DocType_ID = dtt.C_DocType_ID AND dtt.AD_Language = $2 AND dtt.isActive = 'Y'\n+    --get the email from AD_MailConfig for org, docbasetype and docsubtype, with fallback to org, docbasetype\n+         LEFT OUTER JOIN (\n+    SELECT email, ddo.DD_Order_ID\n+    FROM DD_Order ddo\n+             INNER JOIN C_DocType dt ON ddo.C_DocType_ID = dt.C_DocType_ID AND dt.isActive = 'Y'\n+             LEFT OUTER JOIN AD_MailConfig mc1 ON ddo.AD_Org_ID = mc1.AD_Org_ID AND mc1.DocBaseType = dt.DocBaseType AND mc1.DocSubType = dt.DocSubType AND mc1.isActive = 'Y'\n+             LEFT OUTER JOIN AD_MailConfig mc2 ON ddo.AD_Org_ID = mc2.AD_Org_ID AND mc2.DocBaseType = dt.DocBaseType AND mc2.DocSubType IS NULL AND mc2.isActive = 'Y'\n+             LEFT OUTER JOIN AD_MailConfig mc3 ON ddo.AD_Org_ID = mc3.AD_Org_ID AND mc3.DocBaseType IS NULL AND mc3.DocSubType IS NULL AND mc3.isActive = 'Y'\n+             LEFT OUTER JOIN AD_Mailbox mb ON COALESCE(COALESCE(mc1.AD_Mailbox_ID, mc2.AD_Mailbox_ID), mc3.AD_Mailbox_ID) = mb.AD_Mailbox_ID AND mb.isActive = 'Y'\n+\n+    WHERE ddo.DD_Order_ID = $1\n+      AND ddo.isActive = 'Y'\n+    LIMIT 1\n+) mb ON mb.DD_Order_ID = ddo.DD_Order_ID\n+\n+WHERE ddo.DD_Order_ID = $1\n+  AND ddo.isActive = 'Y'\n+\n+$$\n+    LANGUAGE SQL STABLE\n+;\n+\n+DROP FUNCTION IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details_HU (IN Record_ID numeric, IN AD_Language Character Varying(6))\n+;\n+\n+DROP TABLE IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details_HU\n+;\n+\n+CREATE TABLE de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details_HU\n+(\n+    MovementQty numeric,\n+    Name        Character Varying,\n+    UOMSymbol   Character Varying(10),\n+    Description Character Varying\n+)\n+;\n+\n+\n+CREATE FUNCTION de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details_HU(IN Record_ID   numeric,\n+                                                                                  IN AD_Language Character Varying(6))\n+    RETURNS SETOF de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details_HU\n+AS\n+$$\n+SELECT SUM(ddol.QtyEntered)                    AS MovementQty,\n+       COALESCE(pt.Name, p.name)               AS Name,\n+       COALESCE(uomt.UOMSymbol, uom.UOMSymbol) AS UOMSymbol,\n+       ddol.Description\n+FROM DD_Order ddo\n+         INNER JOIN DD_Orderline ddol ON ddo.DD_Order_ID = ddol.DD_Order_ID AND ddol.isActive = 'Y'\n+    -- Product and its translation\n+         LEFT OUTER JOIN M_Product p ON ddol.M_Product_ID = p.M_Product_ID AND p.isActive = 'Y'\n+         LEFT OUTER JOIN M_Product_Trl pt ON ddol.M_Product_ID = pt.M_Product_ID AND pt.AD_Language = $2 AND pt.isActive = 'Y'\n+         LEFT OUTER JOIN M_Product_Category pc ON p.M_Product_Category_ID = pc.M_Product_Category_ID AND pc.isActive = 'Y'\n+    -- Unit of measurement and its translation\n+         LEFT OUTER JOIN C_UOM uom ON ddol.C_UOM_ID = uom.C_UOM_ID AND uom.isActive = 'Y'\n+         LEFT OUTER JOIN C_UOM_Trl uomt ON ddol.C_UOM_ID = uomt.C_UOM_ID AND uomt.AD_Language = $2 AND uomt.isActive = 'Y'\n+    --ordering gebinde if config exists\n+         LEFT OUTER JOIN C_BPartner bp ON ddo.C_BPartner_ID = bp.C_BPartner_ID AND bp.isActive = 'Y'\n+         LEFT OUTER JOIN C_DocType dt ON ddo.C_DocType_ID = dt.C_DocType_ID AND dt.isActive = 'Y'\n+         LEFT OUTER JOIN C_DocLine_Sort dls ON dt.DocBaseType = dls.DocBaseType AND dls.isActive = 'Y'\n+    AND EXISTS(\n+                                                       SELECT 0\n+                                                       FROM C_BP_DocLine_Sort bpdls\n+                                                       WHERE bpdls.C_DocLine_Sort_ID = dls.C_DocLine_Sort_ID\n+                                                         AND bpdls.C_BPartner_ID = bp.C_BPartner_ID\n+                                                         AND bpdls.isActive = 'Y'\n+                                                   )\n+         LEFT OUTER JOIN C_DocLine_Sort_Item dlsi ON dls.C_DocLine_Sort_ID = dlsi.C_DocLine_Sort_ID AND dlsi.M_Product_ID = ddol.M_Product_ID AND dlsi.isActive = 'Y'\n+\n+WHERE ddo.DD_Order_ID = $1\n+  AND ddo.isActive = 'Y'\n+  AND pc.M_Product_Category_ID = getSysConfigAsNumeric('PackingMaterialProductCategoryID', ddol.AD_Client_ID, ddol.AD_Org_ID)\n+  AND QtyEntered != 0 -- Don't display lines without a Qty. See 08293\n+GROUP BY COALESCE(pt.Name, p.name), COALESCE(uomt.UOMSymbol, uom.UOMSymbol), dlsi.SeqNo, ddol.description\n+ORDER BY dlsi.SeqNo NULLS LAST\n+\n+$$\n+    LANGUAGE SQL STABLE\n+;\n+\n+DROP FUNCTION IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details (IN Record_ID numeric, IN AD_Language Character Varying(6))\n+;\n+\n+DROP TABLE IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details\n+;\n+\n+CREATE TABLE de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details\n+(\n+    Line                 Numeric(10, 0),\n+    Name                 Character Varying,\n+    Attributes           Text,\n+    HUQty                Numeric,\n+    HUName               Text,\n+    qtyEntered           Numeric,\n+    UOMSymbol            Character Varying(10),\n+    LineNetAmt           Numeric,\n+    IsDiscountPrinted    Character(1),", "originalCommit": "c35aac5696895b2cb37f104d273d7d33a931ac22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0NTE5MA==", "url": "https://github.com/metasfresh/metasfresh/pull/6729#discussion_r430245190", "bodyText": "Do we need it?", "author": "cristinamghita", "createdAt": "2020-05-26T08:33:38Z", "path": "backend/de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5559960_sys_gh6713AddFunctionsForDistributionOrderPrint.sql", "diffHunk": "@@ -0,0 +1,438 @@\n+DROP FUNCTION IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root (IN Record_ID numeric, IN AD_Language Character Varying(6))\n+;\n+\n+DROP TABLE IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root\n+;\n+\n+CREATE TABLE de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root\n+(\n+    AD_User_ID                           numeric(10, 0),\n+    AD_Org_ID                            numeric(10, 0),\n+    DD_Order_ID                          numeric(10, 0),\n+    DocStatus                            Character(2),\n+    C_BPartner_ID                        numeric(10, 0),\n+    C_BPartner_Location_ID               numeric(10, 0),\n+    PrintName                            Character Varying(60),\n+    AD_Language                          Text,\n+    IsHidePackingMaterialInShipmentPrint Character(1),\n+    email                                Character Varying(50),\n+    displayhu                            text,\n+    issourcesupplycert                   character(1)\n+)\n+;\n+\n+\n+CREATE FUNCTION de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root(IN Record_ID   numeric,\n+                                                                            IN AD_Language Character Varying(6))\n+    RETURNS SETOF de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root\n+AS\n+$$\n+SELECT ddo.ad_user_id,\n+       ddo.ad_org_id,\n+       ddo.DD_Order_ID,\n+       ddo.docstatus,\n+       ddo.c_bpartner_id,\n+       ddo.c_bpartner_location_id,\n+       CASE\n+           WHEN ddo.DocStatus = 'DR'\n+               THEN dt.printname\n+               ELSE COALESCE(dtt.printname, dt.printname)\n+       END                                                              AS printname,\n+       CASE WHEN ddo.DocStatus IN ('DR', 'IP') THEN 'de_CH' ELSE $2 END AS AD_Language,\n+       isHidePackingMaterialInShipmentPrint,\n+       mb.email,\n+       CASE\n+           WHEN\n+               EXISTS(\n+                       SELECT 0\n+                       FROM DD_Orderline ddol\n+                                INNER JOIN M_Product p ON ddol.M_Product_ID = p.M_Product_ID AND p.isActive = 'Y'\n+                                INNER JOIN M_Product_Category pc ON p.M_Product_Category_ID = pc.M_Product_Category_ID AND pc.isActive = 'Y'\n+                       WHERE pc.M_Product_Category_ID = getSysConfigAsNumeric('PackingMaterialProductCategoryID', ddol.AD_Client_ID, ddol.AD_Org_ID)\n+                         AND ddo.DD_Order_ID = ddol.DD_Order_ID\n+                         AND ddol.isActive = 'Y'\n+                   )\n+               THEN 'Y'\n+               ELSE 'N'\n+       END                                                              AS displayhu,\n+       bp.issourcesupplycert\n+FROM DD_Order ddo\n+         JOIN C_BPartner bp ON ddo.C_BPartner_ID = bp.C_BPartner_ID AND bp.isActive = 'Y'\n+         INNER JOIN C_DocType dt ON ddo.C_DocType_ID = dt.C_DocType_ID AND dt.isActive = 'Y'\n+         LEFT OUTER JOIN C_DocType_Trl dtt ON ddo.C_DocType_ID = dtt.C_DocType_ID AND dtt.AD_Language = $2 AND dtt.isActive = 'Y'\n+    --get the email from AD_MailConfig for org, docbasetype and docsubtype, with fallback to org, docbasetype\n+         LEFT OUTER JOIN (\n+    SELECT email, ddo.DD_Order_ID\n+    FROM DD_Order ddo\n+             INNER JOIN C_DocType dt ON ddo.C_DocType_ID = dt.C_DocType_ID AND dt.isActive = 'Y'\n+             LEFT OUTER JOIN AD_MailConfig mc1 ON ddo.AD_Org_ID = mc1.AD_Org_ID AND mc1.DocBaseType = dt.DocBaseType AND mc1.DocSubType = dt.DocSubType AND mc1.isActive = 'Y'\n+             LEFT OUTER JOIN AD_MailConfig mc2 ON ddo.AD_Org_ID = mc2.AD_Org_ID AND mc2.DocBaseType = dt.DocBaseType AND mc2.DocSubType IS NULL AND mc2.isActive = 'Y'\n+             LEFT OUTER JOIN AD_MailConfig mc3 ON ddo.AD_Org_ID = mc3.AD_Org_ID AND mc3.DocBaseType IS NULL AND mc3.DocSubType IS NULL AND mc3.isActive = 'Y'\n+             LEFT OUTER JOIN AD_Mailbox mb ON COALESCE(COALESCE(mc1.AD_Mailbox_ID, mc2.AD_Mailbox_ID), mc3.AD_Mailbox_ID) = mb.AD_Mailbox_ID AND mb.isActive = 'Y'\n+\n+    WHERE ddo.DD_Order_ID = $1\n+      AND ddo.isActive = 'Y'\n+    LIMIT 1\n+) mb ON mb.DD_Order_ID = ddo.DD_Order_ID\n+\n+WHERE ddo.DD_Order_ID = $1\n+  AND ddo.isActive = 'Y'\n+\n+$$\n+    LANGUAGE SQL STABLE\n+;\n+\n+DROP FUNCTION IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details_HU (IN Record_ID numeric, IN AD_Language Character Varying(6))\n+;\n+\n+DROP TABLE IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details_HU\n+;\n+\n+CREATE TABLE de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details_HU\n+(\n+    MovementQty numeric,\n+    Name        Character Varying,\n+    UOMSymbol   Character Varying(10),\n+    Description Character Varying\n+)\n+;\n+\n+\n+CREATE FUNCTION de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details_HU(IN Record_ID   numeric,\n+                                                                                  IN AD_Language Character Varying(6))\n+    RETURNS SETOF de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details_HU\n+AS\n+$$\n+SELECT SUM(ddol.QtyEntered)                    AS MovementQty,\n+       COALESCE(pt.Name, p.name)               AS Name,\n+       COALESCE(uomt.UOMSymbol, uom.UOMSymbol) AS UOMSymbol,\n+       ddol.Description\n+FROM DD_Order ddo\n+         INNER JOIN DD_Orderline ddol ON ddo.DD_Order_ID = ddol.DD_Order_ID AND ddol.isActive = 'Y'\n+    -- Product and its translation\n+         LEFT OUTER JOIN M_Product p ON ddol.M_Product_ID = p.M_Product_ID AND p.isActive = 'Y'\n+         LEFT OUTER JOIN M_Product_Trl pt ON ddol.M_Product_ID = pt.M_Product_ID AND pt.AD_Language = $2 AND pt.isActive = 'Y'\n+         LEFT OUTER JOIN M_Product_Category pc ON p.M_Product_Category_ID = pc.M_Product_Category_ID AND pc.isActive = 'Y'\n+    -- Unit of measurement and its translation\n+         LEFT OUTER JOIN C_UOM uom ON ddol.C_UOM_ID = uom.C_UOM_ID AND uom.isActive = 'Y'\n+         LEFT OUTER JOIN C_UOM_Trl uomt ON ddol.C_UOM_ID = uomt.C_UOM_ID AND uomt.AD_Language = $2 AND uomt.isActive = 'Y'\n+    --ordering gebinde if config exists\n+         LEFT OUTER JOIN C_BPartner bp ON ddo.C_BPartner_ID = bp.C_BPartner_ID AND bp.isActive = 'Y'\n+         LEFT OUTER JOIN C_DocType dt ON ddo.C_DocType_ID = dt.C_DocType_ID AND dt.isActive = 'Y'\n+         LEFT OUTER JOIN C_DocLine_Sort dls ON dt.DocBaseType = dls.DocBaseType AND dls.isActive = 'Y'\n+    AND EXISTS(\n+                                                       SELECT 0\n+                                                       FROM C_BP_DocLine_Sort bpdls\n+                                                       WHERE bpdls.C_DocLine_Sort_ID = dls.C_DocLine_Sort_ID\n+                                                         AND bpdls.C_BPartner_ID = bp.C_BPartner_ID\n+                                                         AND bpdls.isActive = 'Y'\n+                                                   )\n+         LEFT OUTER JOIN C_DocLine_Sort_Item dlsi ON dls.C_DocLine_Sort_ID = dlsi.C_DocLine_Sort_ID AND dlsi.M_Product_ID = ddol.M_Product_ID AND dlsi.isActive = 'Y'\n+\n+WHERE ddo.DD_Order_ID = $1\n+  AND ddo.isActive = 'Y'\n+  AND pc.M_Product_Category_ID = getSysConfigAsNumeric('PackingMaterialProductCategoryID', ddol.AD_Client_ID, ddol.AD_Org_ID)\n+  AND QtyEntered != 0 -- Don't display lines without a Qty. See 08293\n+GROUP BY COALESCE(pt.Name, p.name), COALESCE(uomt.UOMSymbol, uom.UOMSymbol), dlsi.SeqNo, ddol.description\n+ORDER BY dlsi.SeqNo NULLS LAST\n+\n+$$\n+    LANGUAGE SQL STABLE\n+;\n+\n+DROP FUNCTION IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details (IN Record_ID numeric, IN AD_Language Character Varying(6))\n+;\n+\n+DROP TABLE IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details\n+;\n+\n+CREATE TABLE de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details\n+(\n+    Line                 Numeric(10, 0),\n+    Name                 Character Varying,\n+    Attributes           Text,\n+    HUQty                Numeric,\n+    HUName               Text,\n+    qtyEntered           Numeric,\n+    UOMSymbol            Character Varying(10),\n+    LineNetAmt           Numeric,\n+    IsDiscountPrinted    Character(1),\n+    Description          Character Varying,\n+    bp_product_no        character varying(30),\n+    bp_product_name      character varying(100),\n+    best_before_date     text,", "originalCommit": "c35aac5696895b2cb37f104d273d7d33a931ac22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0NTI5Nw==", "url": "https://github.com/metasfresh/metasfresh/pull/6729#discussion_r430245297", "bodyText": "Do we need it?", "author": "cristinamghita", "createdAt": "2020-05-26T08:33:47Z", "path": "backend/de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5559960_sys_gh6713AddFunctionsForDistributionOrderPrint.sql", "diffHunk": "@@ -0,0 +1,438 @@\n+DROP FUNCTION IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root (IN Record_ID numeric, IN AD_Language Character Varying(6))\n+;\n+\n+DROP TABLE IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root\n+;\n+\n+CREATE TABLE de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root\n+(\n+    AD_User_ID                           numeric(10, 0),\n+    AD_Org_ID                            numeric(10, 0),\n+    DD_Order_ID                          numeric(10, 0),\n+    DocStatus                            Character(2),\n+    C_BPartner_ID                        numeric(10, 0),\n+    C_BPartner_Location_ID               numeric(10, 0),\n+    PrintName                            Character Varying(60),\n+    AD_Language                          Text,\n+    IsHidePackingMaterialInShipmentPrint Character(1),\n+    email                                Character Varying(50),\n+    displayhu                            text,\n+    issourcesupplycert                   character(1)\n+)\n+;\n+\n+\n+CREATE FUNCTION de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root(IN Record_ID   numeric,\n+                                                                            IN AD_Language Character Varying(6))\n+    RETURNS SETOF de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root\n+AS\n+$$\n+SELECT ddo.ad_user_id,\n+       ddo.ad_org_id,\n+       ddo.DD_Order_ID,\n+       ddo.docstatus,\n+       ddo.c_bpartner_id,\n+       ddo.c_bpartner_location_id,\n+       CASE\n+           WHEN ddo.DocStatus = 'DR'\n+               THEN dt.printname\n+               ELSE COALESCE(dtt.printname, dt.printname)\n+       END                                                              AS printname,\n+       CASE WHEN ddo.DocStatus IN ('DR', 'IP') THEN 'de_CH' ELSE $2 END AS AD_Language,\n+       isHidePackingMaterialInShipmentPrint,\n+       mb.email,\n+       CASE\n+           WHEN\n+               EXISTS(\n+                       SELECT 0\n+                       FROM DD_Orderline ddol\n+                                INNER JOIN M_Product p ON ddol.M_Product_ID = p.M_Product_ID AND p.isActive = 'Y'\n+                                INNER JOIN M_Product_Category pc ON p.M_Product_Category_ID = pc.M_Product_Category_ID AND pc.isActive = 'Y'\n+                       WHERE pc.M_Product_Category_ID = getSysConfigAsNumeric('PackingMaterialProductCategoryID', ddol.AD_Client_ID, ddol.AD_Org_ID)\n+                         AND ddo.DD_Order_ID = ddol.DD_Order_ID\n+                         AND ddol.isActive = 'Y'\n+                   )\n+               THEN 'Y'\n+               ELSE 'N'\n+       END                                                              AS displayhu,\n+       bp.issourcesupplycert\n+FROM DD_Order ddo\n+         JOIN C_BPartner bp ON ddo.C_BPartner_ID = bp.C_BPartner_ID AND bp.isActive = 'Y'\n+         INNER JOIN C_DocType dt ON ddo.C_DocType_ID = dt.C_DocType_ID AND dt.isActive = 'Y'\n+         LEFT OUTER JOIN C_DocType_Trl dtt ON ddo.C_DocType_ID = dtt.C_DocType_ID AND dtt.AD_Language = $2 AND dtt.isActive = 'Y'\n+    --get the email from AD_MailConfig for org, docbasetype and docsubtype, with fallback to org, docbasetype\n+         LEFT OUTER JOIN (\n+    SELECT email, ddo.DD_Order_ID\n+    FROM DD_Order ddo\n+             INNER JOIN C_DocType dt ON ddo.C_DocType_ID = dt.C_DocType_ID AND dt.isActive = 'Y'\n+             LEFT OUTER JOIN AD_MailConfig mc1 ON ddo.AD_Org_ID = mc1.AD_Org_ID AND mc1.DocBaseType = dt.DocBaseType AND mc1.DocSubType = dt.DocSubType AND mc1.isActive = 'Y'\n+             LEFT OUTER JOIN AD_MailConfig mc2 ON ddo.AD_Org_ID = mc2.AD_Org_ID AND mc2.DocBaseType = dt.DocBaseType AND mc2.DocSubType IS NULL AND mc2.isActive = 'Y'\n+             LEFT OUTER JOIN AD_MailConfig mc3 ON ddo.AD_Org_ID = mc3.AD_Org_ID AND mc3.DocBaseType IS NULL AND mc3.DocSubType IS NULL AND mc3.isActive = 'Y'\n+             LEFT OUTER JOIN AD_Mailbox mb ON COALESCE(COALESCE(mc1.AD_Mailbox_ID, mc2.AD_Mailbox_ID), mc3.AD_Mailbox_ID) = mb.AD_Mailbox_ID AND mb.isActive = 'Y'\n+\n+    WHERE ddo.DD_Order_ID = $1\n+      AND ddo.isActive = 'Y'\n+    LIMIT 1\n+) mb ON mb.DD_Order_ID = ddo.DD_Order_ID\n+\n+WHERE ddo.DD_Order_ID = $1\n+  AND ddo.isActive = 'Y'\n+\n+$$\n+    LANGUAGE SQL STABLE\n+;\n+\n+DROP FUNCTION IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details_HU (IN Record_ID numeric, IN AD_Language Character Varying(6))\n+;\n+\n+DROP TABLE IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details_HU\n+;\n+\n+CREATE TABLE de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details_HU\n+(\n+    MovementQty numeric,\n+    Name        Character Varying,\n+    UOMSymbol   Character Varying(10),\n+    Description Character Varying\n+)\n+;\n+\n+\n+CREATE FUNCTION de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details_HU(IN Record_ID   numeric,\n+                                                                                  IN AD_Language Character Varying(6))\n+    RETURNS SETOF de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details_HU\n+AS\n+$$\n+SELECT SUM(ddol.QtyEntered)                    AS MovementQty,\n+       COALESCE(pt.Name, p.name)               AS Name,\n+       COALESCE(uomt.UOMSymbol, uom.UOMSymbol) AS UOMSymbol,\n+       ddol.Description\n+FROM DD_Order ddo\n+         INNER JOIN DD_Orderline ddol ON ddo.DD_Order_ID = ddol.DD_Order_ID AND ddol.isActive = 'Y'\n+    -- Product and its translation\n+         LEFT OUTER JOIN M_Product p ON ddol.M_Product_ID = p.M_Product_ID AND p.isActive = 'Y'\n+         LEFT OUTER JOIN M_Product_Trl pt ON ddol.M_Product_ID = pt.M_Product_ID AND pt.AD_Language = $2 AND pt.isActive = 'Y'\n+         LEFT OUTER JOIN M_Product_Category pc ON p.M_Product_Category_ID = pc.M_Product_Category_ID AND pc.isActive = 'Y'\n+    -- Unit of measurement and its translation\n+         LEFT OUTER JOIN C_UOM uom ON ddol.C_UOM_ID = uom.C_UOM_ID AND uom.isActive = 'Y'\n+         LEFT OUTER JOIN C_UOM_Trl uomt ON ddol.C_UOM_ID = uomt.C_UOM_ID AND uomt.AD_Language = $2 AND uomt.isActive = 'Y'\n+    --ordering gebinde if config exists\n+         LEFT OUTER JOIN C_BPartner bp ON ddo.C_BPartner_ID = bp.C_BPartner_ID AND bp.isActive = 'Y'\n+         LEFT OUTER JOIN C_DocType dt ON ddo.C_DocType_ID = dt.C_DocType_ID AND dt.isActive = 'Y'\n+         LEFT OUTER JOIN C_DocLine_Sort dls ON dt.DocBaseType = dls.DocBaseType AND dls.isActive = 'Y'\n+    AND EXISTS(\n+                                                       SELECT 0\n+                                                       FROM C_BP_DocLine_Sort bpdls\n+                                                       WHERE bpdls.C_DocLine_Sort_ID = dls.C_DocLine_Sort_ID\n+                                                         AND bpdls.C_BPartner_ID = bp.C_BPartner_ID\n+                                                         AND bpdls.isActive = 'Y'\n+                                                   )\n+         LEFT OUTER JOIN C_DocLine_Sort_Item dlsi ON dls.C_DocLine_Sort_ID = dlsi.C_DocLine_Sort_ID AND dlsi.M_Product_ID = ddol.M_Product_ID AND dlsi.isActive = 'Y'\n+\n+WHERE ddo.DD_Order_ID = $1\n+  AND ddo.isActive = 'Y'\n+  AND pc.M_Product_Category_ID = getSysConfigAsNumeric('PackingMaterialProductCategoryID', ddol.AD_Client_ID, ddol.AD_Org_ID)\n+  AND QtyEntered != 0 -- Don't display lines without a Qty. See 08293\n+GROUP BY COALESCE(pt.Name, p.name), COALESCE(uomt.UOMSymbol, uom.UOMSymbol), dlsi.SeqNo, ddol.description\n+ORDER BY dlsi.SeqNo NULLS LAST\n+\n+$$\n+    LANGUAGE SQL STABLE\n+;\n+\n+DROP FUNCTION IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details (IN Record_ID numeric, IN AD_Language Character Varying(6))\n+;\n+\n+DROP TABLE IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details\n+;\n+\n+CREATE TABLE de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Details\n+(\n+    Line                 Numeric(10, 0),\n+    Name                 Character Varying,\n+    Attributes           Text,\n+    HUQty                Numeric,\n+    HUName               Text,\n+    qtyEntered           Numeric,\n+    UOMSymbol            Character Varying(10),\n+    LineNetAmt           Numeric,\n+    IsDiscountPrinted    Character(1),\n+    Description          Character Varying,\n+    bp_product_no        character varying(30),\n+    bp_product_name      character varying(100),\n+    best_before_date     text,\n+    lotno                character varying,", "originalCommit": "c35aac5696895b2cb37f104d273d7d33a931ac22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1269e0b63f53d3374687935f82a380d7b4d3980a", "url": "https://github.com/metasfresh/metasfresh/commit/1269e0b63f53d3374687935f82a380d7b4d3980a", "message": "#6713 Simplified report & removed functions & sub-reports.", "committedDate": "2020-05-26T12:25:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM3OTY3MQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6729#discussion_r430379671", "bodyText": "don we really need email?", "author": "cristinamghita", "createdAt": "2020-05-26T12:38:28Z", "path": "backend/de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5559960_sys_gh6713AddFunctionsForDistributionOrderPrint.sql", "diffHunk": "@@ -0,0 +1,361 @@\n+DROP FUNCTION IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root (IN Record_ID numeric, IN AD_Language Character Varying(6))\n+;\n+\n+DROP TABLE IF EXISTS de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root\n+;\n+\n+CREATE TABLE de_metas_endcustomer_fresh_reports.Docs_Sales_DD_Order_Root\n+(\n+    AD_User_ID             numeric(10, 0),\n+    AD_Org_ID              numeric(10, 0),\n+    DD_Order_ID            numeric(10, 0),\n+    DocStatus              Character(2),\n+    C_BPartner_ID          numeric(10, 0),\n+    C_BPartner_Location_ID numeric(10, 0),\n+    PrintName              Character Varying(60),\n+    AD_Language            Text,\n+    email                  Character Varying(50),", "originalCommit": "1269e0b63f53d3374687935f82a380d7b4d3980a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}