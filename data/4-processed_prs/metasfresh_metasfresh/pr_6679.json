{"pr_number": 6679, "pr_title": "Frontend 6653 selection", "pr_createdAt": "2020-05-18T09:23:36Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/6679", "timeline": [{"oid": "e1f8d834eabd1efd517d2e647a6729080e36b3c0", "url": "https://github.com/metasfresh/metasfresh/commit/e1f8d834eabd1efd517d2e647a6729080e36b3c0", "message": "Prereq for updating the tables selections over the new structure #6653", "committedDate": "2020-05-14T14:40:09Z", "type": "commit"}, {"oid": "5de9f8998131d30e90e7a0015cd820985e7b0d91", "url": "https://github.com/metasfresh/metasfresh/commit/5de9f8998131d30e90e7a0015cd820985e7b0d91", "message": "Selection by default if nothing selected #6653", "committedDate": "2020-05-18T07:02:54Z", "type": "commit"}, {"oid": "7bda8c69906b6acbdd9c4210b4a2881196a4ad61", "url": "https://github.com/metasfresh/metasfresh/commit/7bda8c69906b6acbdd9c4210b4a2881196a4ad61", "message": "Fix linter error 6653", "committedDate": "2020-05-18T07:05:31Z", "type": "commit"}, {"oid": "bdab7f50a7ec3e6026b5aaf8bef3546569546982", "url": "https://github.com/metasfresh/metasfresh/commit/bdab7f50a7ec3e6026b5aaf8bef3546569546982", "message": "Fix selection #6653", "committedDate": "2020-05-18T09:20:31Z", "type": "commit"}, {"oid": "3154ba5ed31494326ea4c4551f91ee85a12a137a", "url": "https://github.com/metasfresh/metasfresh/commit/3154ba5ed31494326ea4c4551f91ee85a12a137a", "message": "Fix linter errors", "committedDate": "2020-05-18T09:25:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUxMDE5Nw==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426510197", "bodyText": "So the idea behind the action creators for tables was that they will just accept an ID and we won't have to deal with that in the reducer. So please align this with the already existing ACs.", "author": "siemiatj", "createdAt": "2020-05-18T09:59:20Z", "path": "frontend/src/actions/TableActions.js", "diffHunk": "@@ -192,3 +192,13 @@ export function updateTabTable(tableId, tableResponse) {\n     }\n   };\n }\n+\n+/**\n+ * Update table selection - select items\n+ */\n+export function updateTableSelection({ windowId, viewId, ids }) {", "originalCommit": "3154ba5ed31494326ea4c4551f91ee85a12a137a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU3ODM0Nw==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426578347", "bodyText": "Ok set tableId only", "author": "petrican", "createdAt": "2020-05-18T12:10:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUxMDE5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUxMTA5OA==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426511098", "bodyText": "Maybe we sholud just set parentView to null if it doesn't exist ? We won't have to make those computation-heavy checks here.", "author": "siemiatj", "createdAt": "2020-05-18T10:00:53Z", "path": "frontend/src/components/app/QuickActions.js", "diffHunk": "@@ -249,7 +249,11 @@ export class QuickActions extends Component {\n             const relatedActions =\n               resp && resp.data ? respRel.data.actions : null;\n \n-            if ((parentView.viewId || childView.viewId) && relatedActions) {\n+            if (\n+              (parentView.viewId || childView.viewId) &&\n+              relatedActions &&\n+              !_.isEmpty(parentView)", "originalCommit": "3154ba5ed31494326ea4c4551f91ee85a12a137a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY4OTQ5Nw==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426689497", "bodyText": "agree", "author": "teosarca", "createdAt": "2020-05-18T14:58:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUxMTA5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY5Nzk1OQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426697959", "bodyText": "Already explained to @siemiatj why that check is needed. Along with the <Table component refactoring which follows to be done this is most probably going to be gone.", "author": "petrican", "createdAt": "2020-05-18T15:10:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUxMTA5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUxMjEyOA==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426512128", "bodyText": "if rows is an array (and same for selected) why can't we just check the length property ?", "author": "siemiatj", "createdAt": "2020-05-18T10:02:35Z", "path": "frontend/src/components/table/Table.js", "diffHunk": "@@ -90,6 +92,25 @@ class Table extends Component {\n       page,\n     } = this.props;\n     const { selected, rows } = this.state;\n+\n+    /**\n+     * Selection by default of first row if nothing selected\n+     */\n+    if (\n+      (_.isEmpty(defaultSelected) || _.isEmpty(selected)) &&\n+      !_.isEmpty(rows)", "originalCommit": "3154ba5ed31494326ea4c4551f91ee85a12a137a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY5MDk0MQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426690941", "bodyText": "agree. data shall be correct and valid from the beginning.", "author": "teosarca", "createdAt": "2020-05-18T15:00:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUxMjEyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUxMjczMA==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426512730", "bodyText": "I think this can be moved to TableTypes", "author": "siemiatj", "createdAt": "2020-05-18T10:03:34Z", "path": "frontend/src/constants/ActionTypes.js", "diffHunk": "@@ -616,3 +616,9 @@ export const UPDATE_TAB_ROWS_DATA = 'UPDATE_TAB_ROWS_DATA';\n  * @type {string} set languages in the app handler\n  */\n export const SET_LANGUAGES = 'SET_LANGUAGES';\n+\n+/**\n+ * @constant\n+ * @type {string} update table selection\n+ */\n+export const UPDATE_TABLE_SELECTION = 'UPDATE_TABLE_SELECTION';", "originalCommit": "3154ba5ed31494326ea4c4551f91ee85a12a137a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU2NjUxMQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426566511", "bodyText": "Ok. Will move it", "author": "petrican", "createdAt": "2020-05-18T11:47:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUxMjczMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUxNDYwOA==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426514608", "bodyText": "draftState is already a copy of the object so it's easier to just set the selected property (like for activeState) , since we're not merging anything but setting it fresh.", "author": "siemiatj", "createdAt": "2020-05-18T10:06:55Z", "path": "frontend/src/reducers/tables.js", "diffHunk": "@@ -107,6 +107,17 @@ const reducer = produce((draftState, action) => {\n       return;\n     }\n \n+    case types.UPDATE_TABLE_SELECTION: {\n+      const { windowId, viewId, selection } = action.payload;\n+      const tableId = getTableId({ windowType: windowId, viewId });\n+      draftState[tableId] = {", "originalCommit": "3154ba5ed31494326ea4c4551f91ee85a12a137a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU5MTMxNw==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426591317", "bodyText": "You mean like draftState[tableId].selected = selection;\nbut that doesn't work. I get undefined for the draftState[tableId]", "author": "petrican", "createdAt": "2020-05-18T12:33:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUxNDYwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY5NjM1NA==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426696354", "bodyText": "agree", "author": "teosarca", "createdAt": "2020-05-18T15:08:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUxNDYwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc1NTkxMA==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426755910", "bodyText": "@petrican  any idea why?", "author": "teosarca", "createdAt": "2020-05-18T16:36:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUxNDYwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzAzMDQwMA==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r427030400", "bodyText": "Yes. Setting the selection before the creation of the table data. This happens in the Table component. This I'm sure will be fixed along with the refactoring but as a precaution I will add a TODO in here also.", "author": "petrican", "createdAt": "2020-05-19T04:58:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUxNDYwOA=="}], "type": "inlineReview"}, {"oid": "0306f03b69c168805f37b16698be2992ce1c5418", "url": "https://github.com/metasfresh/metasfresh/commit/0306f03b69c168805f37b16698be2992ce1c5418", "message": "Fix tests", "committedDate": "2020-05-18T10:10:58Z", "type": "commit"}, {"oid": "62af334b703ffbc3b7cfb13e42322b272eae004c", "url": "https://github.com/metasfresh/metasfresh/commit/62af334b703ffbc3b7cfb13e42322b272eae004c", "message": "Call action with tableId only #6653", "committedDate": "2020-05-18T12:09:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcyNjc3OA==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426726778", "bodyText": "this should be fixed when we refactor TableItem.\nWe cannot allow having a prop which is sometimes bool and sometimes string.\nPlease add a FIXME/TODO marker to be handled later and not forget.", "author": "teosarca", "createdAt": "2020-05-18T15:51:50Z", "path": "frontend/src/components/table/TableItem.js", "diffHunk": "@@ -715,7 +715,7 @@ TableItem.propTypes = {\n   tabIndex: PropTypes.number,\n   entity: PropTypes.string,\n   getSizeClass: PropTypes.func,\n-  colspan: PropTypes.string,\n+  colspan: PropTypes.oneOfType([PropTypes.bool, PropTypes.string]),", "originalCommit": "62af334b703ffbc3b7cfb13e42322b272eae004c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzAyNjMwOA==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r427026308", "bodyText": "ok. thanks", "author": "petrican", "createdAt": "2020-05-19T04:42:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcyNjc3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc0MTc1MA==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426741750", "bodyText": "@siemiatj  @petrican  IMHO this shall be called initialTableState", "author": "teosarca", "createdAt": "2020-05-18T16:13:26Z", "path": "frontend/src/reducers/tables.js", "diffHunk": "@@ -3,6 +3,7 @@ import { get } from 'lodash';\n import { createSelector } from 'reselect';\n \n import * as types from '../constants/ActionTypes';\n+import { UPDATE_TABLE_SELECTION } from '../constants/actions/TableTypes';\n \n export const tableState = {", "originalCommit": "62af334b703ffbc3b7cfb13e42322b272eae004c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzAyNTc2Nw==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r427025767", "bodyText": "Ok. Renaming it.", "author": "petrican", "createdAt": "2020-05-19T04:39:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc0MTc1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc0MjkwOQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426742909", "bodyText": "why do we have selectTableItems along with updateTableSelection?", "author": "teosarca", "createdAt": "2020-05-18T16:15:10Z", "path": "frontend/src/components/table/Table.js", "diffHunk": "@@ -375,6 +409,12 @@ class Table extends Component {\n       const { selected } = this.state;\n \n       if (tabInfo) {\n+        dispatch(\n+          updateTableSelection({\n+            tableId: getTableId({ windowType: windowId, viewId }),\n+            ids: selected,\n+          })\n+        );\n         dispatch(\n           selectTableItems({", "originalCommit": "62af334b703ffbc3b7cfb13e42322b272eae004c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkzNjA1Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426936056", "bodyText": "We're adding the new way of handling selections to work alongside the previous solution. This way we don't introduce breaking changes and can potentially roll it out anytime, and the old code will be removed completely with metasfresh/me03#4539", "author": "siemiatj", "createdAt": "2020-05-18T22:56:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc0MjkwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA4NTkzNA==", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r427085934", "bodyText": "@siemiatj  @petrican  Ok, then I would suggest adding a TODO/FIXME which mentions that will be deleted on .\nIn this way we make sure we won't forget about it and it's also transparent for reviewer what's the intention.", "author": "teosarca", "createdAt": "2020-05-19T07:28:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc0MjkwOQ=="}], "type": "inlineReview"}, {"oid": "7af776309a133c85e791978e2916462216c93c49", "url": "https://github.com/metasfresh/metasfresh/commit/7af776309a133c85e791978e2916462216c93c49", "message": "Small fmixes after review #6653", "committedDate": "2020-05-19T05:06:21Z", "type": "commit"}, {"oid": "d90d0bd209e8fa446c42269f3481f22ba2d1def9", "url": "https://github.com/metasfresh/metasfresh/commit/d90d0bd209e8fa446c42269f3481f22ba2d1def9", "message": "Merged master branch to current and updated the unit tests", "committedDate": "2020-05-19T06:03:45Z", "type": "commit"}]}