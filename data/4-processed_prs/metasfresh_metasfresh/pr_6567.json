{"pr_number": 6567, "pr_title": "Move tables to redux", "pr_createdAt": "2020-05-05T12:31:56Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/6567", "timeline": [{"oid": "eb6484aea401ba88732e3edb3c9f646dcfc2c291", "url": "https://github.com/metasfresh/metasfresh/commit/eb6484aea401ba88732e3edb3c9f646dcfc2c291", "message": "#4538 create redux essentials for tables\n\nRedux state structure for tables and actions/action creators for grids", "committedDate": "2020-05-11T14:21:52Z", "type": "commit"}, {"oid": "82079073bcfb873162e16cae2bde008e27d8502f", "url": "https://github.com/metasfresh/metasfresh/commit/82079073bcfb873162e16cae2bde008e27d8502f", "message": "#4538 basic fetching for tabs", "committedDate": "2020-05-11T14:21:53Z", "type": "commit"}, {"oid": "2fc5266eff854b6a74a68dcf1f88af0f4844ac95", "url": "https://github.com/metasfresh/metasfresh/commit/2fc5266eff854b6a74a68dcf1f88af0f4844ac95", "message": "#4538 progress with tabs\n\nTabs now fetch data via the action creator", "committedDate": "2020-05-11T14:21:53Z", "type": "commit"}, {"oid": "1e60e36d468493d8c4d56d3eeca351cd8378f45b", "url": "https://github.com/metasfresh/metasfresh/commit/1e60e36d468493d8c4d56d3eeca351cd8378f45b", "message": "#5438 comment-out `initTabs` action creator", "committedDate": "2020-05-11T14:21:53Z", "type": "commit"}, {"oid": "1ba5cf42fee8b88397d18cc01f6a869c8c37669d", "url": "https://github.com/metasfresh/metasfresh/commit/1ba5cf42fee8b88397d18cc01f6a869c8c37669d", "message": "#5438 use selectors for getting views data\n\nboth locally (in the reducer) and in the app", "committedDate": "2020-05-11T14:21:53Z", "type": "commit"}, {"oid": "849c6004deb351da24389c10053edc7ee731e2fa", "url": "https://github.com/metasfresh/metasfresh/commit/849c6004deb351da24389c10053edc7ee731e2fa", "message": "#5438 extract table elements from layout\n\nand store them in the tables reducer", "committedDate": "2020-05-11T14:21:54Z", "type": "commit"}, {"oid": "53194bdc1f4413d6b3d7f31da18aa06558ab6789", "url": "https://github.com/metasfresh/metasfresh/commit/53194bdc1f4413d6b3d7f31da18aa06558ab6789", "message": "#5438 cleanup actions", "committedDate": "2020-05-11T14:21:54Z", "type": "commit"}, {"oid": "6ca2f7f7b263c08d806ee620697b90051fe1e774", "url": "https://github.com/metasfresh/metasfresh/commit/6ca2f7f7b263c08d806ee620697b90051fe1e774", "message": "#5438 refactoring tables reducer and some action creators", "committedDate": "2020-05-11T14:21:54Z", "type": "commit"}, {"oid": "59b153f107a4e66f30488f37ca502cb5e2f38fcd", "url": "https://github.com/metasfresh/metasfresh/commit/59b153f107a4e66f30488f37ca502cb5e2f38fcd", "message": "#4538 finishing basic redux handling for Tables\n\n- deleting tables\n- fix data types\n- use Lists for columns\n- comments", "committedDate": "2020-05-11T14:21:55Z", "type": "commit"}, {"oid": "5c4b64086549c86b6c9ca137d8b0779f4b9103a7", "url": "https://github.com/metasfresh/metasfresh/commit/5c4b64086549c86b6c9ca137d8b0779f4b9103a7", "message": "#4538 support activeSort in redux tables\n\nNot used in components, just testing for now so a temporary action type is used.", "committedDate": "2020-05-11T14:21:55Z", "type": "commit"}, {"oid": "ffc779715fa0ac94bac97e542e835b417e492043", "url": "https://github.com/metasfresh/metasfresh/commit/ffc779715fa0ac94bac97e542e835b417e492043", "message": "#4538 lint fixes", "committedDate": "2020-05-11T14:21:55Z", "type": "commit"}, {"oid": "705ee18fef07a7e22bd6f230a1573c4e3f7f3509", "url": "https://github.com/metasfresh/metasfresh/commit/705ee18fef07a7e22bd6f230a1573c4e3f7f3509", "message": "#4538 another lint fix", "committedDate": "2020-05-11T14:21:56Z", "type": "commit"}, {"oid": "b382871673ff079118c2e975006fcb62d15e2782", "url": "https://github.com/metasfresh/metasfresh/commit/b382871673ff079118c2e975006fcb62d15e2782", "message": "#4538 cleanup creating tables\n\n- add comments", "committedDate": "2020-05-11T14:21:56Z", "type": "commit"}, {"oid": "4c555f780b9b603e52fc21f2178e15b22eb1612d", "url": "https://github.com/metasfresh/metasfresh/commit/4c555f780b9b603e52fc21f2178e15b22eb1612d", "message": "#4538 delete grid table when resetting view", "committedDate": "2020-05-11T14:21:56Z", "type": "commit"}, {"oid": "058ae431619b1689fc64e2d5e39883517e93e170", "url": "https://github.com/metasfresh/metasfresh/commit/058ae431619b1689fc64e2d5e39883517e93e170", "message": "#4538 code comments", "committedDate": "2020-05-11T14:21:57Z", "type": "commit"}, {"oid": "058ae431619b1689fc64e2d5e39883517e93e170", "url": "https://github.com/metasfresh/metasfresh/commit/058ae431619b1689fc64e2d5e39883517e93e170", "message": "#4538 code comments", "committedDate": "2020-05-11T14:21:57Z", "type": "forcePushed"}, {"oid": "07d0d554c0ac33d54789d8a98a8d6c167c686c01", "url": "https://github.com/metasfresh/metasfresh/commit/07d0d554c0ac33d54789d8a98a8d6c167c686c01", "message": "#4538 fix tests", "committedDate": "2020-05-11T15:38:00Z", "type": "commit"}, {"oid": "54800519b049621e98515574c7da922be355de59", "url": "https://github.com/metasfresh/metasfresh/commit/54800519b049621e98515574c7da922be355de59", "message": "#4538 fix tests\n\nimprove error handling", "committedDate": "2020-05-11T21:50:22Z", "type": "commit"}, {"oid": "eab95018e36d110ebae9ea8dfc6cf384792ce327", "url": "https://github.com/metasfresh/metasfresh/commit/eab95018e36d110ebae9ea8dfc6cf384792ce327", "message": "#4538 switch to immer\n\ncreate selectors for data", "committedDate": "2020-05-12T18:22:56Z", "type": "commit"}, {"oid": "bb0eecb6edd79c5e19373e402b9d720f67d6302c", "url": "https://github.com/metasfresh/metasfresh/commit/bb0eecb6edd79c5e19373e402b9d720f67d6302c", "message": "#4538 rename api function to avoid naming collisions\n\nt", "committedDate": "2020-05-12T18:23:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2NzUzNA==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424167534", "bodyText": "Can you pls use one single param and that to be and object containing those ? Thanks", "author": "petrican", "createdAt": "2020-05-13T04:36:15Z", "path": "frontend/src/api/view.js", "diffHunk": "@@ -180,7 +180,7 @@ export function locationConfigRequest() {\n   return get(`${config.API_URL}/geolocation/config`);\n }\n \n-export function deleteView(windowId, viewId, action) {\n+export function deleteViewRequest(windowId, viewId, action) {", "originalCommit": "bb0eecb6edd79c5e19373e402b9d720f67d6302c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDIzNzAwOA==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424237008", "bodyText": "You are aware it's not in the scope of the issue, right ? Also though I see a reason to switch to object properties when we have 5+ parameters, here I don't really see any advantage", "author": "siemiatj", "createdAt": "2020-05-13T07:45:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2NzUzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMwMzY5Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424303696", "bodyText": "5+ it's not my taste, to be honest, but if that's easy to follow in javascript world, I am ready to obey.", "author": "teosarca", "createdAt": "2020-05-13T09:33:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2NzUzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2ODE2Mg==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424168162", "bodyText": "Same as above. Pls use an object as param contaning the windowType, viewId, type. Thanks", "author": "petrican", "createdAt": "2020-05-13T04:39:18Z", "path": "frontend/src/components/app/RawModal.js", "diffHunk": "@@ -232,8 +232,7 @@ class RawModal extends Component {\n       }\n \n       await this.removeModal();\n-\n-      await deleteView(windowType, viewId, type);\n+      await deleteViewRequest(windowType, viewId, type);", "originalCommit": "bb0eecb6edd79c5e19373e402b9d720f67d6302c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDIzOTU1MA==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424239550", "bodyText": "also, where possible and time/budget fit, pls rename windowType to windowId. So we would share the same ubiquitous across the whole application.", "author": "teosarca", "createdAt": "2020-05-13T07:49:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2ODE2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI3MjMwMQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424272301", "bodyText": "We're over the budget already so I don't want to get sidetracked doing things that are not in the scope of this issue. I've only renamed this function because it has the same name as a redux action creator.", "author": "siemiatj", "createdAt": "2020-05-13T08:43:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2ODE2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMwNDYxMw==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424304613", "bodyText": "ok, i understand.\nNext time, pls make sure to consider the 'ubiquitous language` fixes when doing the estimation.", "author": "teosarca", "createdAt": "2020-05-13T09:34:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2ODE2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MDU0MA==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424170540", "bodyText": "Add pls doc about params and a brief description of what this function does and what's its purpose. Thanks", "author": "petrican", "createdAt": "2020-05-13T04:49:53Z", "path": "frontend/src/actions/ViewActions.js", "diffHunk": "@@ -136,20 +198,32 @@ export function updateViewData(id, rows, tabId) {\n   };\n }\n \n+/**\n+ * @method fetchLocationConfigSuccess\n+ * @summary\n+ */\n function fetchLocationConfigSuccess(id, data) {\n   return {\n     type: FETCH_LOCATION_CONFIG_SUCCESS,\n     payload: { id, data },\n   };\n }\n \n+/**\n+ * @method fetchLocationConfigError\n+ * @summary\n+ */\n function fetchLocationConfigError(id, error) {\n   return {\n     type: FETCH_LOCATION_CONFIG_ERROR,\n     payload: { id, error },\n   };\n }\n \n+/**\n+ * @method addLocationData\n+ * @summary", "originalCommit": "bb0eecb6edd79c5e19373e402b9d720f67d6302c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDIzNzY3OA==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424237678", "bodyText": "Not in the scope. I just added it to have anything as far as the code comments go.", "author": "siemiatj", "createdAt": "2020-05-13T07:46:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MDU0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MTgzMw==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424171833", "bodyText": "If this is not needed we can remove the commented code. We can always find this function from previous versions of the code if it's really needed.", "author": "petrican", "createdAt": "2020-05-13T04:55:08Z", "path": "frontend/src/actions/WindowActions.js", "diffHunk": "@@ -521,38 +528,64 @@ export function deselectTableItems(ids, windowType, viewId) {\n \n // THUNK ACTIONS\n \n-export function initTabs(layout, windowType, docId, isModal) {\n-  return async (dispatch) => {\n-    const requests = [];\n-    const tabTmp = {};\n-\n-    if (layout) {\n-      layout.map((tab, index) => {\n-        tabTmp[tab.tabId] = {};\n-\n-        if ((tab.tabId && index === 0) || !tab.queryOnActivate) {\n-          requests.push(getTab(tab.tabId, windowType, docId));\n-        }\n-      });\n+// TODO: Just a quick thunk action creator to test Tables reducer\n+// but looks like this can actually replace the `initTabs`.\n+/*\n+ * @method fetchTab\n+ * @summary Action creator for fetching single tab's rows\n+ */\n+export function fetchTab(tabId, windowType, docId) {\n+  return (dispatch) => {\n+    return getTabRequest(tabId, windowType, docId)\n+      .then((response) => {\n+        const tableId = `${windowType}_${docId}_${tabId}`;\n+        const tableData = { result: response };\n \n-      return await Promise.all(requests).then((responses) => {\n-        responses.forEach((res) => {\n-          // needed for finding tabId\n-          const rowZero = res && res[0];\n-          if (rowZero) {\n-            const tabId = rowZero.tabId;\n-            tabTmp[tabId] = res;\n-          }\n-        });\n+        dispatch(updateTabTable(tableId, tableData));\n \n-        dispatch(addRowData(tabTmp, getScope(isModal)));\n+        return Promise.resolve(response);\n+      })\n+      .catch((error) => {\n+        //show error message ?\n+        return Promise.resolve(error);\n       });\n-    }\n-\n-    return Promise.resolve(null);\n   };\n }\n \n+// TODO: Figure out if we still need this as it looks like we can just fetch", "originalCommit": "bb0eecb6edd79c5e19373e402b9d720f67d6302c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDIzODU0Mw==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424238543", "bodyText": "Yeeah so I'm kinda reluctant to do it at this point as it's gonna be easier to revert it by just uncommenting code imho.", "author": "siemiatj", "createdAt": "2020-05-13T07:48:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MTgzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI2OTU4OA==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424269588", "bodyText": "Maybe leave some small comment in here instead with link to the PR/commit in which we removed the function to find our way around quick in case of an urgent fix/revert ?", "author": "petrican", "createdAt": "2020-05-13T08:39:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MTgzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MzI5NQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424173295", "bodyText": "pls use ===. here .  Also maybe it's wise to use  documentId.toLowerCase() === 'new' in case someone does pass by mistake 'New' or 'nEw' or something like that. Might not happen but just as a safety check", "author": "petrican", "createdAt": "2020-05-13T05:01:09Z", "path": "frontend/src/actions/WindowActions.js", "diffHunk": "@@ -620,87 +653,123 @@ export function initWindow(windowType, docId, tabId, rowId = null, isAdvanced) {\n  * Main method to generate window\n  */\n export function createWindow(\n-  windowId,\n-  docId = 'NEW',\n+  windowType,\n+  documentId = 'NEW',\n   tabId,\n   rowId,\n   isModal = false,\n   isAdvanced\n ) {\n   return (dispatch) => {\n-    if (docId == 'new') {\n-      docId = 'NEW';\n+    if (documentId == 'new') {", "originalCommit": "bb0eecb6edd79c5e19373e402b9d720f67d6302c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MzY1Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424173656", "bodyText": "===", "author": "petrican", "createdAt": "2020-05-13T05:02:33Z", "path": "frontend/src/actions/WindowActions.js", "diffHunk": "@@ -620,87 +653,123 @@ export function initWindow(windowType, docId, tabId, rowId = null, isAdvanced) {\n  * Main method to generate window\n  */\n export function createWindow(\n-  windowId,\n-  docId = 'NEW',\n+  windowType,\n+  documentId = 'NEW',\n   tabId,\n   rowId,\n   isModal = false,\n   isAdvanced\n ) {\n   return (dispatch) => {\n-    if (docId == 'new') {\n-      docId = 'NEW';\n+    if (documentId == 'new') {\n+      documentId = 'NEW';\n     }\n \n     // this chain is really important,\n     // to do not re-render widgets on init\n-    return dispatch(initWindow(windowId, docId, tabId, rowId, isAdvanced)).then(\n-      (response) => {\n-        if (!response || !response.data) {\n-          return Promise.resolve(null);\n-        }\n-\n-        if (docId == 'NEW' && !isModal) {\n-          dispatch(setLatestNewDocument(response.data[0].id));\n-          // redirect immedietely\n-          return dispatch(\n-            replace(`/window/${windowId}/${response.data[0].id}`)\n-          );\n-        }\n+    return dispatch(\n+      initWindow(windowType, documentId, tabId, rowId, isAdvanced)\n+    ).then((response) => {\n+      if (!response || !response.data) {\n+        return Promise.resolve(null);\n+      }\n \n-        let elem = 0;\n+      const data = response.data[0];\n+      const tabs = data.includedTabsInfo;\n+      let docId = data.id;\n \n-        response.data.forEach((value, index) => {\n-          if (value.rowId === rowId) {\n-            elem = index;\n-          }\n+      if (tabs) {\n+        Object.values(tabs).forEach((tab) => {\n+          const { tabId } = tab;\n+          const tableId = `${windowType}_${docId}_${tabId}`;\n+          const tableData = {\n+            windowType,\n+            docId,\n+            tabId,\n+            ...tab,\n+          };\n+          dispatch(createTabTable(tableId, tableData));\n         });\n+      }\n \n-        if (docId === 'NEW') {\n-          dispatch(updateModal(null, response.data[0].id));\n+      if (documentId == 'NEW' && !isModal) {", "originalCommit": "bb0eecb6edd79c5e19373e402b9d720f67d6302c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3Mzk2OA==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424173968", "bodyText": "also you might wanna do a similar check documentId.toUpperCase() === 'NEW' for safety", "author": "petrican", "createdAt": "2020-05-13T05:03:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MzY1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3NDQ1MA==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424174450", "bodyText": "Should we have a safety check for such case to be sure ?", "author": "petrican", "createdAt": "2020-05-13T05:05:37Z", "path": "frontend/src/actions/WindowActions.js", "diffHunk": "@@ -620,87 +653,123 @@ export function initWindow(windowType, docId, tabId, rowId = null, isAdvanced) {\n  * Main method to generate window\n  */\n export function createWindow(\n-  windowId,\n-  docId = 'NEW',\n+  windowType,\n+  documentId = 'NEW',\n   tabId,\n   rowId,\n   isModal = false,\n   isAdvanced\n ) {\n   return (dispatch) => {\n-    if (docId == 'new') {\n-      docId = 'NEW';\n+    if (documentId == 'new') {\n+      documentId = 'NEW';\n     }\n \n     // this chain is really important,\n     // to do not re-render widgets on init\n-    return dispatch(initWindow(windowId, docId, tabId, rowId, isAdvanced)).then(\n-      (response) => {\n-        if (!response || !response.data) {\n-          return Promise.resolve(null);\n-        }\n-\n-        if (docId == 'NEW' && !isModal) {\n-          dispatch(setLatestNewDocument(response.data[0].id));\n-          // redirect immedietely\n-          return dispatch(\n-            replace(`/window/${windowId}/${response.data[0].id}`)\n-          );\n-        }\n+    return dispatch(\n+      initWindow(windowType, documentId, tabId, rowId, isAdvanced)\n+    ).then((response) => {\n+      if (!response || !response.data) {\n+        return Promise.resolve(null);\n+      }\n \n-        let elem = 0;\n+      const data = response.data[0];\n+      const tabs = data.includedTabsInfo;\n+      let docId = data.id;\n \n-        response.data.forEach((value, index) => {\n-          if (value.rowId === rowId) {\n-            elem = index;\n-          }\n+      if (tabs) {\n+        Object.values(tabs).forEach((tab) => {\n+          const { tabId } = tab;\n+          const tableId = `${windowType}_${docId}_${tabId}`;\n+          const tableData = {\n+            windowType,\n+            docId,\n+            tabId,\n+            ...tab,\n+          };\n+          dispatch(createTabTable(tableId, tableData));\n         });\n+      }\n \n-        if (docId === 'NEW') {\n-          dispatch(updateModal(null, response.data[0].id));\n+      if (documentId == 'NEW' && !isModal) {\n+        dispatch(setLatestNewDocument(docId));\n+        // redirect immedietely\n+        return dispatch(replace(`/window/${windowType}/${docId}`));\n+      }\n+\n+      let elem = 0;\n+\n+      response.data.forEach((value, index) => {\n+        if (value.rowId === rowId) {\n+          elem = index;\n         }\n+      });\n \n-        docId = response.data[elem].id;\n-        dispatch(\n-          initDataSuccess({\n-            data: parseToDisplay(response.data[elem].fieldsByName),\n-            docId,\n-            saveStatus: response.data[0].saveStatus,\n-            scope: getScope(isModal),\n-            standardActions: response.data[0].standardActions,\n-            validStatus: response.data[0].validStatus,\n-            includedTabsInfo: response.data[0].includedTabsInfo,\n-            websocket: response.data[0].websocketEndpoint,\n-          })\n-        );\n+      if (documentId === 'NEW') {\n+        dispatch(updateModal(null, docId));\n+      }\n \n-        if (isModal) {\n-          if (rowId === 'NEW') {\n-            dispatch(\n-              mapDataToState(response.data, false, 'NEW', docId, windowId)\n-            );\n-            dispatch(updateStatus(response.data));\n-            dispatch(updateModal(response.data[0].rowId));\n-          }\n-        } else {\n-          dispatch(getWindowBreadcrumb(windowId));\n+      // TODO: Is `elem` ever different than 0 ?", "originalCommit": "bb0eecb6edd79c5e19373e402b9d720f67d6302c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3NTkwNA==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424175904", "bodyText": "Remove it pls if it's the case . Like I said in one of my previous comment we can always get the code back from the repo. Code should be clean without forgotten spread comments within it. Thanks", "author": "petrican", "createdAt": "2020-05-13T05:10:43Z", "path": "frontend/src/actions/WindowActions.js", "diffHunk": "@@ -620,87 +653,123 @@ export function initWindow(windowType, docId, tabId, rowId = null, isAdvanced) {\n  * Main method to generate window\n  */\n export function createWindow(\n-  windowId,\n-  docId = 'NEW',\n+  windowType,\n+  documentId = 'NEW',\n   tabId,\n   rowId,\n   isModal = false,\n   isAdvanced\n ) {\n   return (dispatch) => {\n-    if (docId == 'new') {\n-      docId = 'NEW';\n+    if (documentId == 'new') {\n+      documentId = 'NEW';\n     }\n \n     // this chain is really important,\n     // to do not re-render widgets on init\n-    return dispatch(initWindow(windowId, docId, tabId, rowId, isAdvanced)).then(\n-      (response) => {\n-        if (!response || !response.data) {\n-          return Promise.resolve(null);\n-        }\n-\n-        if (docId == 'NEW' && !isModal) {\n-          dispatch(setLatestNewDocument(response.data[0].id));\n-          // redirect immedietely\n-          return dispatch(\n-            replace(`/window/${windowId}/${response.data[0].id}`)\n-          );\n-        }\n+    return dispatch(\n+      initWindow(windowType, documentId, tabId, rowId, isAdvanced)\n+    ).then((response) => {\n+      if (!response || !response.data) {\n+        return Promise.resolve(null);\n+      }\n \n-        let elem = 0;\n+      const data = response.data[0];\n+      const tabs = data.includedTabsInfo;\n+      let docId = data.id;\n \n-        response.data.forEach((value, index) => {\n-          if (value.rowId === rowId) {\n-            elem = index;\n-          }\n+      if (tabs) {\n+        Object.values(tabs).forEach((tab) => {\n+          const { tabId } = tab;\n+          const tableId = `${windowType}_${docId}_${tabId}`;\n+          const tableData = {\n+            windowType,\n+            docId,\n+            tabId,\n+            ...tab,\n+          };\n+          dispatch(createTabTable(tableId, tableData));\n         });\n+      }\n \n-        if (docId === 'NEW') {\n-          dispatch(updateModal(null, response.data[0].id));\n+      if (documentId == 'NEW' && !isModal) {\n+        dispatch(setLatestNewDocument(docId));\n+        // redirect immedietely\n+        return dispatch(replace(`/window/${windowType}/${docId}`));\n+      }\n+\n+      let elem = 0;\n+\n+      response.data.forEach((value, index) => {\n+        if (value.rowId === rowId) {\n+          elem = index;\n         }\n+      });\n \n-        docId = response.data[elem].id;\n-        dispatch(\n-          initDataSuccess({\n-            data: parseToDisplay(response.data[elem].fieldsByName),\n-            docId,\n-            saveStatus: response.data[0].saveStatus,\n-            scope: getScope(isModal),\n-            standardActions: response.data[0].standardActions,\n-            validStatus: response.data[0].validStatus,\n-            includedTabsInfo: response.data[0].includedTabsInfo,\n-            websocket: response.data[0].websocketEndpoint,\n-          })\n-        );\n+      if (documentId === 'NEW') {\n+        dispatch(updateModal(null, docId));\n+      }\n \n-        if (isModal) {\n-          if (rowId === 'NEW') {\n-            dispatch(\n-              mapDataToState(response.data, false, 'NEW', docId, windowId)\n-            );\n-            dispatch(updateStatus(response.data));\n-            dispatch(updateModal(response.data[0].rowId));\n-          }\n-        } else {\n-          dispatch(getWindowBreadcrumb(windowId));\n+      // TODO: Is `elem` ever different than 0 ?\n+      docId = response.data[elem].id;\n+      dispatch(\n+        initDataSuccess({\n+          data: parseToDisplay(response.data[elem].fieldsByName),\n+          docId,\n+          saveStatus: data.saveStatus,\n+          scope: getScope(isModal),\n+          standardActions: data.standardActions,\n+          validStatus: data.validStatus,\n+          includedTabsInfo: data.includedTabsInfo,\n+          websocket: data.websocketEndpoint,\n+        })\n+      );\n+\n+      if (isModal) {\n+        if (rowId === 'NEW') {\n+          dispatch(\n+            mapDataToState(response.data, false, 'NEW', docId, windowType)\n+          );\n+          dispatch(updateStatus(response.data));\n+          dispatch(updateModal(data.rowId));\n         }\n+      } else {\n+        dispatch(getWindowBreadcrumb(windowType));\n+      }\n \n-        return getLayout('window', windowId, tabId, null, null, isAdvanced)\n-          .then((response) =>\n-            dispatch(initLayoutSuccess(response.data, getScope(isModal)))\n-          )\n-          .then((response) => {\n-            if (!isModal) {\n-              return dispatch(\n-                initTabs(response.layout.tabs, windowId, docId, isModal)\n-              );\n+      return (\n+        getLayout('window', windowType, tabId, null, null, isAdvanced)\n+          .then(({ data }) => {\n+            const layoutTabs = data.tabs;\n+\n+            if (layoutTabs.length) {\n+              Object.values(layoutTabs).forEach((tab) => {\n+                const { tabId } = tab;\n+                const tableId = `${windowType}_${docId}_${tabId}`;\n+                const tableData = {\n+                  windowType,\n+                  docId,\n+                  tabId,\n+                  ...tab,\n+                };\n+                dispatch(updateTabTable(tableId, tableData));\n+              });\n             }\n-            return Promise.resolve(null);\n+\n+            dispatch(initLayoutSuccess(data, getScope(isModal)));\n           })\n-          .catch((e) => Promise.reject(e));\n-      }\n-    );\n+          // TODO: looks like this can be removed ?", "originalCommit": "bb0eecb6edd79c5e19373e402b9d720f67d6302c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3NjIwMw==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424176203", "bodyText": "Has this been clarified after the meeting with Teo ? Can we remove it ?", "author": "petrican", "createdAt": "2020-05-13T05:11:56Z", "path": "frontend/src/components/app/DocumentList/index.js", "diffHunk": "@@ -524,6 +528,7 @@ class DocumentListContainer extends Component {\n \n         const pageColumnInfosByFieldName = response.columnsByFieldName;\n \n+        // TODO: There is some sorcery happening here. Why are we doing this ?", "originalCommit": "bb0eecb6edd79c5e19373e402b9d720f67d6302c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI3MTAzMg==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424271032", "bodyText": "Yeah, I'll create an issue and mention it here.", "author": "siemiatj", "createdAt": "2020-05-13T08:41:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3NjIwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3NjcxMw==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424176713", "bodyText": "Pls use object for params", "author": "petrican", "createdAt": "2020-05-13T05:13:50Z", "path": "frontend/src/actions/WindowActions.js", "diffHunk": "@@ -521,38 +528,64 @@ export function deselectTableItems(ids, windowType, viewId) {\n \n // THUNK ACTIONS\n \n-export function initTabs(layout, windowType, docId, isModal) {\n-  return async (dispatch) => {\n-    const requests = [];\n-    const tabTmp = {};\n-\n-    if (layout) {\n-      layout.map((tab, index) => {\n-        tabTmp[tab.tabId] = {};\n-\n-        if ((tab.tabId && index === 0) || !tab.queryOnActivate) {\n-          requests.push(getTab(tab.tabId, windowType, docId));\n-        }\n-      });\n+// TODO: Just a quick thunk action creator to test Tables reducer\n+// but looks like this can actually replace the `initTabs`.\n+/*\n+ * @method fetchTab\n+ * @summary Action creator for fetching single tab's rows\n+ */\n+export function fetchTab(tabId, windowType, docId) {", "originalCommit": "bb0eecb6edd79c5e19373e402b9d720f67d6302c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDIzOTI3OA==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424239278", "bodyText": "Same as above. I don't see the advantage especially that we're still using windowId in some places so it might turn out this will cause some unexpected issues.", "author": "siemiatj", "createdAt": "2020-05-13T07:49:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3NjcxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3NzA4MA==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424177080", "bodyText": "should we have a dedicated function for forming the tableId ? wdyt ?", "author": "petrican", "createdAt": "2020-05-13T05:15:13Z", "path": "frontend/src/actions/WindowActions.js", "diffHunk": "@@ -521,38 +528,64 @@ export function deselectTableItems(ids, windowType, viewId) {\n \n // THUNK ACTIONS\n \n-export function initTabs(layout, windowType, docId, isModal) {\n-  return async (dispatch) => {\n-    const requests = [];\n-    const tabTmp = {};\n-\n-    if (layout) {\n-      layout.map((tab, index) => {\n-        tabTmp[tab.tabId] = {};\n-\n-        if ((tab.tabId && index === 0) || !tab.queryOnActivate) {\n-          requests.push(getTab(tab.tabId, windowType, docId));\n-        }\n-      });\n+// TODO: Just a quick thunk action creator to test Tables reducer\n+// but looks like this can actually replace the `initTabs`.\n+/*\n+ * @method fetchTab\n+ * @summary Action creator for fetching single tab's rows\n+ */\n+export function fetchTab(tabId, windowType, docId) {\n+  return (dispatch) => {\n+    return getTabRequest(tabId, windowType, docId)\n+      .then((response) => {\n+        const tableId = `${windowType}_${docId}_${tabId}`;", "originalCommit": "bb0eecb6edd79c5e19373e402b9d720f67d6302c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3OTIyOQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424179229", "bodyText": "You already have a function for forming that right ? Can you pls use that here instead and whenever we have similar table id formatting? Thanks", "author": "petrican", "createdAt": "2020-05-13T05:23:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3NzA4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3Nzc2Nw==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424177767", "bodyText": "https://github.com/ryanmcdermott/clean-code-javascript#functions", "author": "petrican", "createdAt": "2020-05-13T05:17:59Z", "path": "frontend/src/components/window/Tab.js", "diffHunk": "@@ -31,16 +35,17 @@ class Tab extends Component {\n         : '';\n \n       if (singleRowView) {\n-        getTab(tabId, windowId, docId).then((res) => {\n+        fetchTab(tabId, windowId, docId).then((res) => {\n           if (res.length) {\n-            dispatch(updateMasterData(res[0]));\n-            dispatch(addRowData({ [tabId]: res }, 'master'));\n+            updateMasterData(res[0]);\n+            addRowData({ [tabId]: res }, 'master');\n             onChange && onChange();\n           }\n         });\n+        fetchTab(tabId, windowId, docId);\n       } else {\n-        getTab(tabId, windowId, docId, query).then((res) => {\n-          dispatch(addRowData({ [tabId]: res }, 'master'));\n+        fetchTab(tabId, windowId, docId, query).then((res) => {", "originalCommit": "bb0eecb6edd79c5e19373e402b9d720f67d6302c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI0MzIxMg==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424243212", "bodyText": "I don't know who Ryan McDermott is so not really convinced his style guide is any kind of market standard. As mentioned above - although it does make sense to switch to named parameters in some cases, most of the time it's a premature optimization. And in our case we're not great at naming conventions, and often we use different names for the same parameter (windowId/windowType) or have duplicated names (docId/docid). So there might be unexpected side effects.", "author": "siemiatj", "createdAt": "2020-05-13T07:55:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3Nzc2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI2OTA4OA==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424269088", "bodyText": "I don't know who Ryan McDermott\n\nme neither but those are the coding standards we (all) agreed to use.\nOfc we can improve them but i am eager to understand why when having a certain number of params, why is not using named parameters?\nPS: that coding style was adapted from Uncle Bob's Clean Code book.... which is widely adopted.\n\nAnd in our case we're not great at naming conventions,\n\nThat's true.\n\nand often we use different names for the same parameter (windowId/windowType) or have duplicated names (docId/docid).\n\nThat's also true.\n\nSo there might be unexpected side effects.\n\ncan u pls enumarete a couple of those side effects?", "author": "teosarca", "createdAt": "2020-05-13T08:38:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3Nzc2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI3MDgzMQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424270831", "bodyText": "Like... shit breaks because we're not sending the right parameter ? windowId is undefined in the URL ? The problem is that without having static typing changes like this will always be prone to errors if done in a hurry. So I'd rather create a separate task for this than to learn the hard way that we've missed the variable in one critical spot.", "author": "siemiatj", "createdAt": "2020-05-13T08:40:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3Nzc2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMwMjE2Nw==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424302167", "bodyText": "can u give me a concrete example? i.e. which functions might break?\nI briefly scrolled over the code and I saw those param names are quite local.\nAlso pressing F2 in VSCode will do the rename for you without any trouble.\nE separate task would mean separate testing.\nAnd a task like 'refactor the var name' i barely can see approved.\nI could understand refactoring in interactions and have different iterations because you want to refactor & stabilize  (btw, Martin Fowler has a nice book about Refactoring techniques),\nbut it's hard for me to see a refactor var names task realistic.\nI know that we were not good at naming things, so we named the same thing in several ways introducing to developers.\nBut we can change. We can fix it one by one when we touch that part of the code.\nElse, my fear is that in one year we will talk about same problems and we will contemplate same issues.", "author": "teosarca", "createdAt": "2020-05-13T09:30:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3Nzc2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3ODY5NQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424178695", "bodyText": "Oh I see we have the table Id gen function in here. I didn't spot it on the first check. Pls use it in all the places where table ID is formed.", "author": "petrican", "createdAt": "2020-05-13T05:21:39Z", "path": "frontend/src/reducers/tables.js", "diffHunk": "@@ -0,0 +1,115 @@\n+import produce from 'immer';\n+import { get } from 'lodash';\n+import { createSelector } from 'reselect';\n+\n+import * as types from '../constants/ActionTypes';\n+\n+export const tableState = {\n+  windowType: null,\n+  viewId: null,\n+  docId: null,\n+  tabId: null,\n+  selected: [],\n+  rows: [],\n+  // row columns\n+  columns: [],\n+  activeSort: false,\n+  headerProperties: {},\n+\n+  //header columns\n+  headerElements: {},\n+  emptyText: null,\n+  emptyHint: null,\n+  page: 0,\n+  firstRow: 0,\n+  size: 0,\n+  orderBy: [],\n+  defaultOrderBys: [],\n+  pageLength: 0,\n+  queryLimit: 0,\n+  queryLimitHit: false,\n+  dataPending: false,\n+  dataError: false,\n+  tabIndex: 0,\n+  internalName: null,\n+  queryOnActivate: true,\n+  supportQuickInput: true,\n+\n+  // includedTabsInfo\n+  allowCreateNew: true,\n+  allowCreateNewReason: null,\n+  allowDelete: true,\n+  stale: false,\n+};\n+\n+// we store the length of the tables structure for the sake of testing and debugging\n+export const initialState = { length: 0 };\n+\n+/**\n+ * @method getTableId\n+ * @summary Small helper function to generate the table id depending on the values (if viewId is\n+ * provided, we'll use only that for grids, and if not - it's a tab table so document id\n+ * and tab ids are expected ).\n+ */\n+export const getTableId = ({ windowType, viewId, docId, tabId }) => {", "originalCommit": "bb0eecb6edd79c5e19373e402b9d720f67d6302c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI0MDUzOQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6567#discussion_r424240539", "bodyText": "consider renaming\n\nwindowType to windowId\ndocId to documentId", "author": "teosarca", "createdAt": "2020-05-13T07:51:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3ODY5NQ=="}], "type": "inlineReview"}, {"oid": "574351bf20fb6b366deb509ae42cf4cf6e3a9052", "url": "https://github.com/metasfresh/metasfresh/commit/574351bf20fb6b366deb509ae42cf4cf6e3a9052", "message": "Fix linter error #4538", "committedDate": "2020-05-13T06:21:48Z", "type": "commit"}, {"oid": "f436e00277ccb050494e21c1e8c9a04270ad9292", "url": "https://github.com/metasfresh/metasfresh/commit/f436e00277ccb050494e21c1e8c9a04270ad9292", "message": "#4538 fix details view when there are no tables\n\n- use `getTableId` everywhere\n- cleanup", "committedDate": "2020-05-13T10:19:17Z", "type": "commit"}, {"oid": "8017cfcd2e0b670a72c392763f4ed162ca366223", "url": "https://github.com/metasfresh/metasfresh/commit/8017cfcd2e0b670a72c392763f4ed162ca366223", "message": "#4538 small refactor\n\nf", "committedDate": "2020-05-13T10:31:38Z", "type": "commit"}]}