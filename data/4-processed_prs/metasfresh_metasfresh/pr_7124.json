{"pr_number": 7124, "pr_title": "Table edit shortcut", "pr_createdAt": "2020-08-12T08:10:01Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/7124", "timeline": [{"oid": "fb8479b6a31388ace2c9b0441671abec137f9b62", "url": "https://github.com/metasfresh/metasfresh/commit/fb8479b6a31388ace2c9b0441671abec137f9b62", "message": "Skel for triggering an action on ALT+F combination for a field", "committedDate": "2020-08-12T07:24:16Z", "type": "commit"}, {"oid": "4731f96d6d68b052385ee412d7fa17f0fc444eeb", "url": "https://github.com/metasfresh/metasfresh/commit/4731f96d6d68b052385ee412d7fa17f0fc444eeb", "message": "Update snapshot", "committedDate": "2020-08-12T08:12:19Z", "type": "commit"}, {"oid": "09398f93a322696c8b27bbb02b2fef09503ea923", "url": "https://github.com/metasfresh/metasfresh/commit/09398f93a322696c8b27bbb02b2fef09503ea923", "message": "Calling existing edit functionality on ALT+F combination", "committedDate": "2020-08-12T12:45:16Z", "type": "commit"}, {"oid": "4b0b21a396dee2a3433e9c9328d07e4c878c3e28", "url": "https://github.com/metasfresh/metasfresh/commit/4b0b21a396dee2a3433e9c9328d07e4c878c3e28", "message": "Mark edited text", "committedDate": "2020-08-12T13:38:09Z", "type": "commit"}, {"oid": "e6da66b26f0f7e6e6ec2f026a301d56c43e84544", "url": "https://github.com/metasfresh/metasfresh/commit/e6da66b26f0f7e6e6ec2f026a301d56c43e84544", "message": "Merged master into local branch", "committedDate": "2020-08-14T12:15:56Z", "type": "commit"}, {"oid": "4aae248ccea3a704ea807776981a5a78b57ad30d", "url": "https://github.com/metasfresh/metasfresh/commit/4aae248ccea3a704ea807776981a5a78b57ad30d", "message": "Merge branch 'master' into 7119-editShortcut", "committedDate": "2020-08-17T05:57:12Z", "type": "commit"}, {"oid": "0f3ad16eab00a175a9bf81deeeecfb6b1fce0a77", "url": "https://github.com/metasfresh/metasfresh/commit/0f3ad16eab00a175a9bf81deeeecfb6b1fce0a77", "message": "Fix conflicts", "committedDate": "2020-08-17T06:05:04Z", "type": "commit"}, {"oid": "294caef929919d76e42170239933dc5706bf6999", "url": "https://github.com/metasfresh/metasfresh/commit/294caef929919d76e42170239933dc5706bf6999", "message": "Comment disabling shortcut dispatch on focusing the widget", "committedDate": "2020-08-17T12:27:43Z", "type": "commit"}, {"oid": "eb991cf5aea3bf98b4500bfea6f7c76271c41890", "url": "https://github.com/metasfresh/metasfresh/commit/eb991cf5aea3bf98b4500bfea6f7c76271c41890", "message": "Fixes to restrict the editing only to allowed fields", "committedDate": "2020-08-17T13:05:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4NDY2Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/7124#discussion_r471484666", "bodyText": "what mark stands for ?", "author": "siemiatj", "createdAt": "2020-08-17T13:38:55Z", "path": "frontend/src/components/table/TableItem.js", "diffHunk": "@@ -75,7 +75,7 @@ class TableItem extends PureComponent {\n     }\n   }\n \n-  initPropertyEditor = (fieldName) => {\n+  initPropertyEditor = ({ fieldName, mark }) => {", "originalCommit": "eb991cf5aea3bf98b4500bfea6f7c76271c41890", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ5NTk3Mw==", "url": "https://github.com/metasfresh/metasfresh/pull/7124#discussion_r471495973", "bodyText": "Done", "author": "petrican", "createdAt": "2020-08-17T13:56:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4NDY2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4NTAyOA==", "url": "https://github.com/metasfresh/metasfresh/pull/7124#discussion_r471485028", "bodyText": "Same -> add a comment what mark property is.", "author": "siemiatj", "createdAt": "2020-08-17T13:39:25Z", "path": "frontend/src/components/table/TableItem.js", "diffHunk": "@@ -195,9 +203,9 @@ class TableItem extends PureComponent {\n    * @param {object} [item] - widget data object\n    * @param {boolean} [select] - flag if selected cell should be cleared\n    */\n-  handleEditProperty = (e, property, focus, item, select) => {\n+  handleEditProperty = (e, property, focus, item, select, mark) => {", "originalCommit": "eb991cf5aea3bf98b4500bfea6f7c76271c41890", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ5NTg4Nw==", "url": "https://github.com/metasfresh/metasfresh/pull/7124#discussion_r471495887", "bodyText": "Done", "author": "petrican", "createdAt": "2020-08-17T13:55:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4NTAyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4NzQxMA==", "url": "https://github.com/metasfresh/metasfresh/pull/7124#discussion_r471487410", "bodyText": "Why do we need to persist the event ? Are we using it in any way and need to access it past this point ?", "author": "siemiatj", "createdAt": "2020-08-17T13:43:04Z", "path": "frontend/src/components/table/TableItem.js", "diffHunk": "@@ -212,9 +220,9 @@ class TableItem extends PureComponent {\n    * @param {object} [item] - widget data object\n    * @param {boolean} [select] - flag if selected cell should be cleared\n    */\n-  _editProperty = (e, property, focus, item, select) => {\n+  _editProperty = ({ e, property, focus, item, select, mark }) => {\n     if (item ? !item.readonly : true) {\n-      if (this.state.edited === property && e) e.stopPropagation();\n+      if (this.state.edited === property && e) e.persist(); // e.stopPropagation();", "originalCommit": "eb991cf5aea3bf98b4500bfea6f7c76271c41890", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUwMTAyMA==", "url": "https://github.com/metasfresh/metasfresh/pull/7124#discussion_r471501020", "bodyText": "It is being used when you get the focus on child components. If you are to use e.stopPropagation while editing you will get a bunch of warnings as in the screenshot. This is the reason I removed it and persisted the event.", "author": "petrican", "createdAt": "2020-08-17T14:03:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4NzQxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4ODUxMQ==", "url": "https://github.com/metasfresh/metasfresh/pull/7124#discussion_r471488511", "bodyText": "What's this comment for ? Is this routine something we need now ? In the future ?", "author": "siemiatj", "createdAt": "2020-08-17T13:44:46Z", "path": "frontend/src/components/table/TableWrapper.js", "diffHunk": "@@ -156,6 +156,32 @@ class TableWrapper extends PureComponent {\n     }\n   };\n \n+  handleFocusAction = ({ fieldName, supportFieldEdit }) => {\n+    this.setState({\n+      contextMenu: {\n+        ...this.state.contextMenu,\n+        fieldName,\n+      },\n+      supportFieldEdit,\n+    });\n+  };\n+\n+  handleFastInlineEdit = () => {\n+    const { selected } = this.props;\n+    const { contextMenu, supportFieldEdit } = this.state;\n+    // a routine needs to be added in here - to check if field is allowed to be edited\n+    // if (contextMenu.supportFieldEdit && selected.length === 1) {", "originalCommit": "eb991cf5aea3bf98b4500bfea6f7c76271c41890", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ5Mjg0OQ==", "url": "https://github.com/metasfresh/metasfresh/pull/7124#discussion_r471492849", "bodyText": "Is just from an initial attempt to restrict using the shortcut. Commented out and forgot to remove the comment. Removed now", "author": "petrican", "createdAt": "2020-08-17T13:51:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4ODUxMQ=="}], "type": "inlineReview"}, {"oid": "9653118a9b7fe8d0c466409d91b537d538340409", "url": "https://github.com/metasfresh/metasfresh/commit/9653118a9b7fe8d0c466409d91b537d538340409", "message": "Removed commented code", "committedDate": "2020-08-17T13:50:19Z", "type": "commit"}, {"oid": "1d2cdcb568b9ad1c97f2fb9ef1f9c1f01a5d833b", "url": "https://github.com/metasfresh/metasfresh/commit/1d2cdcb568b9ad1c97f2fb9ef1f9c1f01a5d833b", "message": "Add doc for param", "committedDate": "2020-08-17T13:55:49Z", "type": "commit"}, {"oid": "4099e9ee38e86b62b06610392e8395200b3f2932", "url": "https://github.com/metasfresh/metasfresh/commit/4099e9ee38e86b62b06610392e8395200b3f2932", "message": "Removed e.stopPropagation()", "committedDate": "2020-08-17T14:00:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0NTk2MA==", "url": "https://github.com/metasfresh/metasfresh/pull/7124#discussion_r471545960", "bodyText": "My comment was about persist, not stopPropagation", "author": "siemiatj", "createdAt": "2020-08-17T15:10:32Z", "path": "frontend/src/components/table/TableItem.js", "diffHunk": "@@ -228,7 +228,7 @@ class TableItem extends PureComponent {\n    */\n   _editProperty = ({ e, property, focus, item, select, mark }) => {\n     if (item ? !item.readonly : true) {\n-      if (this.state.edited === property && e) e.persist(); // e.stopPropagation();\n+      if (this.state.edited === property && e) e.persist();", "originalCommit": "4099e9ee38e86b62b06610392e8395200b3f2932", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkxNDM3MQ==", "url": "https://github.com/metasfresh/metasfresh/pull/7124#discussion_r471914371", "bodyText": "\"If you want to access the event properties in an asynchronous way, you should call event.persist() on the event, which will remove the synthetic event from the pool and allow references to the event to be retained by user code.\"  - With other words if we do a setState down below using the event and we need data from it we use that\n\nIf you do otherwise you'll get nullified event props.", "author": "petrican", "createdAt": "2020-08-18T04:58:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0NTk2MA=="}], "type": "inlineReview"}]}