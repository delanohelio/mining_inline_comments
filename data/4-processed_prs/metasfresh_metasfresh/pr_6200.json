{"pr_number": 6200, "pr_title": "Jasper Report: `Summary and balance Report` - Summen- und Saldenliste", "pr_createdAt": "2020-02-17T14:16:22Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/6200", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIwNzUwOQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6200#discussion_r380207509", "bodyText": "activity filtering shall be applied on Fact_Acct, Fact_Acct_Summary.\nIf we don't have the Fact_Acct_Summary.C_Activity_ID then pls:\n\nskip it\ninform Mark\ncreate a follow-up to introduce it", "author": "teosarca", "createdAt": "2020-02-17T14:19:09Z", "path": "de.metas.acct.base/src/main/sql/postgresql/ddl/functions/SummaryAndBalanceListReport.sql", "diffHunk": "@@ -0,0 +1,66 @@\n+--- backup for erpit\n+CREATE INDEX fas_dateacct\n+    ON fact_acct_summary (dateacct);\n+DROP INDEX fas_dateacct;\n+-- todo @ teo observation: it seems the query runs faster without the index fas_dateacct. (27 sec avg -> 22 sec avg => >10% perf change)\n+-- todo extract the index drop to own migration script\n+--------------------------------------\n+\n+\n+CREATE OR REPLACE FUNCTION SummaryAndBalanceListReport(p_dateFrom date,\n+                                                       p_dateTo date,\n+                                                       p_c_acctschema_id NUMERIC,\n+                                                       p_ad_org_id numeric,\n+                                                       p_account_id NUMERIC=NULL,\n+                                                       p_c_activity_id numeric=NULL)\n+    RETURNS table\n+            (\n+                AccountValue     text,\n+                AccountName      text,\n+                beginningBalance numeric,\n+                debit            numeric,\n+                credit           numeric,\n+                endingBalancw    numeric\n+            )\n+AS\n+$$\n+WITH filteredElementValues AS\n+         (\n+             SELECT ev.c_elementvalue_id,\n+                    ev.name  AccountName,\n+                    ev.value AccountValue\n+             FROM c_elementvalue ev\n+             WHERE TRUE\n+               AND (p_account_id IS NULL OR ev.c_elementvalue_id = p_account_id)\n+               AND (p_c_activity_id IS NULL OR ev.c_activity_id = p_c_activity_id)", "originalCommit": "55370ad0d1bba3c685cfa587c7139292af007456", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ2MjUzNg==", "url": "https://github.com/metasfresh/metasfresh/pull/6200#discussion_r380462536", "bodyText": "create a follow-up to introduce it\n\ndiscussed with @teosarca - there's no need to introduce it\n\nskip it\n\nWill do", "author": "TheBestPessimist", "createdAt": "2020-02-18T05:35:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIwNzUwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ3MTA4MA==", "url": "https://github.com/metasfresh/metasfresh/pull/6200#discussion_r380471080", "bodyText": "no longer filtering by activity_id.", "author": "TheBestPessimist", "createdAt": "2020-02-18T06:14:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIwNzUwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIwODY0Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6200#discussion_r380208646", "bodyText": "cannot follow what's changed here. u will have to tell me....", "author": "teosarca", "createdAt": "2020-02-17T14:21:22Z", "path": "de.metas.acct.base/src/main/sql/postgresql/ddl/functions/acctBalanceToDate.sql", "diffHunk": "@@ -15,89 +15,93 @@ CREATE TYPE de_metas_acct.BalanceAmt AS\n );\n \n  */\n-create or replace function de_metas_acct.acctBalanceToDate(p_Account_ID numeric, p_C_AcctSchema_ID numeric, p_DateAcct date, p_AD_Org_ID numeric(10,0),  p_IncludePostingTypeStatistical char(1) = 'N',  p_ExcludePostingTypeYearEnd char(1) = 'N')\n-RETURNS de_metas_acct.BalanceAmt AS\n+CREATE OR REPLACE FUNCTION de_metas_acct.acctBalanceToDate_test(p_Account_ID numeric,", "originalCommit": "55370ad0d1bba3c685cfa587c7139292af007456", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ3MTUzOA==", "url": "https://github.com/metasfresh/metasfresh/pull/6200#discussion_r380471538", "bodyText": "I have refactored the create or replace line, so that each param is shown on different lines. This will help with future diffing.\nI have also extracted all the joins in the 3 subqueries into a CTE, which brings a speedup of about 30%.\nwe can skype about this for more details.", "author": "TheBestPessimist", "createdAt": "2020-02-18T06:16:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIwODY0Ng=="}], "type": "inlineReview"}, {"oid": "3abb64611f1ba21367e1712c2a9c726837587cd2", "url": "https://github.com/metasfresh/metasfresh/commit/3abb64611f1ba21367e1712c2a9c726837587cd2", "message": "Stop filtering by `c_elementvalue.c_activity_id`\n\nhttps://github.com/metasfresh/metasfresh/issues/6190", "committedDate": "2020-02-18T06:27:50Z", "type": "forcePushed"}, {"oid": "00ab3fdf0bb54565eb7a27917ecba808b9a7c233", "url": "https://github.com/metasfresh/metasfresh/commit/00ab3fdf0bb54565eb7a27917ecba808b9a7c233", "message": "Add migration script\n\nhttps://github.com/metasfresh/metasfresh/issues/6190", "committedDate": "2020-02-18T09:56:48Z", "type": "forcePushed"}, {"oid": "f2685ab2c6189be54d6d1f265a9aa57765a35f19", "url": "https://github.com/metasfresh/metasfresh/commit/f2685ab2c6189be54d6d1f265a9aa57765a35f19", "message": "Use CTE instead of pasting the same query 4 times.\n\nSeems like this reduces query time to about 70% of original. (30% reduction)\n\nhttps://github.com/metasfresh/metasfresh/issues/6190", "committedDate": "2020-02-18T11:41:26Z", "type": "commit"}, {"oid": "11196f1d4b4c96a88759809621e208c816410c4e", "url": "https://github.com/metasfresh/metasfresh/commit/11196f1d4b4c96a88759809621e208c816410c4e", "message": "First draft of SummaryAndBalanceListReport\n\nhttps://github.com/metasfresh/metasfresh/issues/6190", "committedDate": "2020-02-18T11:41:26Z", "type": "commit"}, {"oid": "b9730a3761bd93b5ba595232d3079009e718849c", "url": "https://github.com/metasfresh/metasfresh/commit/b9730a3761bd93b5ba595232d3079009e718849c", "message": "Stop filtering by `c_elementvalue.c_activity_id`\n\nhttps://github.com/metasfresh/metasfresh/issues/6190", "committedDate": "2020-02-18T11:41:26Z", "type": "commit"}, {"oid": "5bfad459a8ef8df3e5c802e698b7b6a210e328e8", "url": "https://github.com/metasfresh/metasfresh/commit/5bfad459a8ef8df3e5c802e698b7b6a210e328e8", "message": "DROP INDEX fas_dateacct\n\nhttps://github.com/metasfresh/metasfresh/issues/6190", "committedDate": "2020-02-18T11:41:26Z", "type": "commit"}, {"oid": "75de20931933b48d042e1fe55608469525c7e596", "url": "https://github.com/metasfresh/metasfresh/commit/75de20931933b48d042e1fe55608469525c7e596", "message": "Add migration script\n\nhttps://github.com/metasfresh/metasfresh/issues/6190", "committedDate": "2020-02-18T11:41:26Z", "type": "commit"}, {"oid": "75de20931933b48d042e1fe55608469525c7e596", "url": "https://github.com/metasfresh/metasfresh/commit/75de20931933b48d042e1fe55608469525c7e596", "message": "Add migration script\n\nhttps://github.com/metasfresh/metasfresh/issues/6190", "committedDate": "2020-02-18T11:41:26Z", "type": "forcePushed"}, {"oid": "4db3aee75c299077337f7066425da2b7b0e08a59", "url": "https://github.com/metasfresh/metasfresh/commit/4db3aee75c299077337f7066425da2b7b0e08a59", "message": "Rename report to `SummaryAndBalanceReport` from `SummaryAndBalanceListReport`\n\nhttps://github.com/metasfresh/metasfresh/issues/6190", "committedDate": "2020-02-19T06:43:32Z", "type": "commit"}, {"oid": "9be690a1fcede3773da2875d22f9f0e1b561637e", "url": "https://github.com/metasfresh/metasfresh/commit/9be690a1fcede3773da2875d22f9f0e1b561637e", "message": "Exclude empty lines via param\n\nhttps://github.com/metasfresh/metasfresh/issues/6190", "committedDate": "2020-02-19T09:02:58Z", "type": "commit"}, {"oid": "567fb03de0cf5cd011dac28987197f6f5a0db4b3", "url": "https://github.com/metasfresh/metasfresh/commit/567fb03de0cf5cd011dac28987197f6f5a0db4b3", "message": "Add migration script for Summary and Balance Report\n\nhttps://github.com/metasfresh/metasfresh/issues/6190", "committedDate": "2020-02-19T09:03:46Z", "type": "commit"}, {"oid": "e8a334d0306d72c9a7e95acb4ab4b00802fd44c7", "url": "https://github.com/metasfresh/metasfresh/commit/e8a334d0306d72c9a7e95acb4ab4b00802fd44c7", "message": "Remove redundant order by inside CTE\n\nhttps://github.com/metasfresh/metasfresh/issues/6190", "committedDate": "2020-02-19T13:14:18Z", "type": "commit"}]}