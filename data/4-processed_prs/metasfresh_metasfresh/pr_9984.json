{"pr_number": 9984, "pr_title": "Store the data in the redux store instead of local state", "pr_createdAt": "2020-09-22T06:45:01Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/9984", "timeline": [{"oid": "774acd910e77ccd20d7d6792c276034ad1134d75", "url": "https://github.com/metasfresh/metasfresh/commit/774acd910e77ccd20d7d6792c276034ad1134d75", "message": "Store the data in the redux store instead of local state", "committedDate": "2020-09-22T06:41:04Z", "type": "commit"}, {"oid": "c0fa19338714d5de4dfb267a06a822fc2c7c286c", "url": "https://github.com/metasfresh/metasfresh/commit/c0fa19338714d5de4dfb267a06a822fc2c7c286c", "message": "Adapt the tests with the changes did in the component", "committedDate": "2020-09-22T07:00:46Z", "type": "commit"}, {"oid": "99eccfe7b0ef110221a6cfbfee97de8dd3e15041", "url": "https://github.com/metasfresh/metasfresh/commit/99eccfe7b0ef110221a6cfbfee97de8dd3e15041", "message": "Adapts to the Table tests also", "committedDate": "2020-09-22T08:32:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4MTI5Nw==", "url": "https://github.com/metasfresh/metasfresh/pull/9984#discussion_r492581297", "bodyText": "Why not add a named export of a component disconnected from the store ? This way you won't have to do the whole shenanigans in the tests and use what we've had instead. Then the reducers/actions can be tested separately. We know, that mapStateToProps works as redux has a pretty good test coverage.", "author": "siemiatj", "createdAt": "2020-09-22T09:03:57Z", "path": "frontend/src/components/table/TableHeader.js", "diffHunk": "@@ -145,4 +145,23 @@ TableHeader.propTypes = {\n   cols: PropTypes.any,\n   indentSupported: PropTypes.any,\n   setActiveSort: PropTypes.func,\n+  headersFields: PropTypes.object,\n+  setActiveSortFields: PropTypes.func,\n };\n+\n+const mapStateToProps = (state, ownProps) => {\n+  const { viewId, windowType: windowId, docId, tabId } = ownProps;\n+  const tableId = getTableId({ windowId, viewId, docId, tabId });\n+\n+  return {\n+    headersFields:\n+      state.tables && state.tables.headers ? state.tables.headers[tableId] : {},\n+  };\n+};\n+\n+export default connect(\n+  mapStateToProps,\n+  {\n+    setActiveSortFields,\n+  }\n+)(TableHeader);", "originalCommit": "99eccfe7b0ef110221a6cfbfee97de8dd3e15041", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYwNTczMQ==", "url": "https://github.com/metasfresh/metasfresh/pull/9984#discussion_r492605731", "bodyText": "Not sure what you mean in here. Don't we want the components to be independent of each other ?", "author": "petrican", "createdAt": "2020-09-22T09:44:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4MTI5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY2MzAwNw==", "url": "https://github.com/metasfresh/metasfresh/pull/9984#discussion_r492663007", "bodyText": "I believe you were thinking on importing directly the component disconnected from the file. Done that and replaced the test with old one. With some small adapts", "author": "petrican", "createdAt": "2020-09-22T11:34:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4MTI5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4NzM1Mg==", "url": "https://github.com/metasfresh/metasfresh/pull/9984#discussion_r492587352", "bodyText": "I'm strongly against this. Since we have everything we need in the redux store already, why not use it when instantiating the table instead ? On FETCH_DOCUMENT_SUCCESS we get the orderBy value, and immediately update the table. So we can move this logic there and this whole lifecycle handler won't be needed anymore.", "author": "siemiatj", "createdAt": "2020-09-22T09:13:45Z", "path": "frontend/src/components/table/TableHeader.js", "diffHunk": "@@ -1,27 +1,27 @@\n import React, { PureComponent } from 'react';\n+import { connect } from 'react-redux';\n import classnames from 'classnames';\n import PropTypes from 'prop-types';\n-\n+import { setActiveSortFields } from '../../actions/TableActions';\n import { shouldRenderColumn, getSizeClass } from '../../utils/tableHelpers';\n import { getTableId } from '../../reducers/tables';\n \n-export default class TableHeader extends PureComponent {\n+class TableHeader extends PureComponent {\n   UNSAFE_componentWillMount() {\n     this.setInitialState();", "originalCommit": "99eccfe7b0ef110221a6cfbfee97de8dd3e15041", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYwNjI3Nw==", "url": "https://github.com/metasfresh/metasfresh/pull/9984#discussion_r492606277", "bodyText": "I agree. Will try to move it in there.", "author": "petrican", "createdAt": "2020-09-22T09:45:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4NzM1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4OTQ5MQ==", "url": "https://github.com/metasfresh/metasfresh/pull/9984#discussion_r492589491", "bodyText": "Shouldn't this be in the tables[tableId].headers ? Or even with a more meaningful name like sortOptions or something ?", "author": "siemiatj", "createdAt": "2020-09-22T09:17:10Z", "path": "frontend/src/reducers/tables.js", "diffHunk": "@@ -326,6 +326,13 @@ const reducer = produce((draftState, action) => {\n       const { id, active } = action.payload;\n \n       draftState[id].activeSort = active;\n+      return;\n+    }\n+    case types.SET_SORT_FIELDS: {\n+      const { id, fields } = action.payload;\n+      draftState.headers = {};", "originalCommit": "99eccfe7b0ef110221a6cfbfee97de8dd3e15041", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYzNTkwNg==", "url": "https://github.com/metasfresh/metasfresh/pull/9984#discussion_r492635906", "bodyText": "whatever name we put if we put it under tables[tableId] it will be overwritten on refresh of the view so it must be outside like tables[sortOptions][id]", "author": "petrican", "createdAt": "2020-09-22T10:40:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4OTQ5MQ=="}], "type": "inlineReview"}, {"oid": "15283b4aecd2d19dd6781a5ed069c0e18955df2b", "url": "https://github.com/metasfresh/metasfresh/commit/15283b4aecd2d19dd6781a5ed069c0e18955df2b", "message": "Ditch some lifecycle methods in TableHeader", "committedDate": "2020-09-22T11:19:23Z", "type": "commit"}, {"oid": "87d018f1a6e4a2e4383d0196d1bc39c239683119", "url": "https://github.com/metasfresh/metasfresh/commit/87d018f1a6e4a2e4383d0196d1bc39c239683119", "message": "Merge branch 'master' into 9980-indicatorVanished", "committedDate": "2020-09-22T11:19:56Z", "type": "commit"}, {"oid": "092fcd9e26909ae8a8855ba6714c05f9f50d5b99", "url": "https://github.com/metasfresh/metasfresh/commit/092fcd9e26909ae8a8855ba6714c05f9f50d5b99", "message": "Restore the initial TableHeader test", "committedDate": "2020-09-22T11:33:05Z", "type": "commit"}, {"oid": "b1c71e4526bd7640c3add026d7d5f2aa3b10f9ad", "url": "https://github.com/metasfresh/metasfresh/commit/b1c71e4526bd7640c3add026d7d5f2aa3b10f9ad", "message": "Changed headers name to sortOptions", "committedDate": "2020-09-22T11:37:22Z", "type": "commit"}, {"oid": "bedbc5cb03370a6af7faa7658b44263da19612f4", "url": "https://github.com/metasfresh/metasfresh/commit/bedbc5cb03370a6af7faa7658b44263da19612f4", "message": "Fix path in redux store", "committedDate": "2020-09-22T11:55:49Z", "type": "commit"}]}