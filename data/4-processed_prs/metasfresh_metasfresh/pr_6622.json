{"pr_number": 6622, "pr_title": "frontend: Refactor Window to smaller components", "pr_createdAt": "2020-05-10T13:27:27Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/6622", "timeline": [{"oid": "78c7e39767fe1db0038d789bc3fceb18a200cdbd", "url": "https://github.com/metasfresh/metasfresh/commit/78c7e39767fe1db0038d789bc3fceb18a200cdbd", "message": "extract Element", "committedDate": "2020-05-09T19:27:20Z", "type": "commit"}, {"oid": "0639e269e495c003421670e57616a04ea36d3e6c", "url": "https://github.com/metasfresh/metasfresh/commit/0639e269e495c003421670e57616a04ea36d3e6c", "message": "extract ElementsLine", "committedDate": "2020-05-09T20:30:18Z", "type": "commit"}, {"oid": "9c6a35a25103af3ff8a95f4e006825c6ab452426", "url": "https://github.com/metasfresh/metasfresh/commit/9c6a35a25103af3ff8a95f4e006825c6ab452426", "message": "extract ElementGroup", "committedDate": "2020-05-09T22:16:36Z", "type": "commit"}, {"oid": "31cfb9eb309c103093be0aa40f77b7d2c3650405", "url": "https://github.com/metasfresh/metasfresh/commit/31cfb9eb309c103093be0aa40f77b7d2c3650405", "message": "extract Column", "committedDate": "2020-05-09T23:23:26Z", "type": "commit"}, {"oid": "10f061eec9890574393b9974078f89d43e93bb2b", "url": "https://github.com/metasfresh/metasfresh/commit/10f061eec9890574393b9974078f89d43e93bb2b", "message": "hotfix", "committedDate": "2020-05-09T23:23:38Z", "type": "commit"}, {"oid": "2406e88d03b103162b1ee85e694ee7a5a2e75141", "url": "https://github.com/metasfresh/metasfresh/commit/2406e88d03b103162b1ee85e694ee7a5a2e75141", "message": "extract Section", "committedDate": "2020-05-10T00:12:04Z", "type": "commit"}, {"oid": "ac6e714970d7876f3dc9d33007afeb988707a8bd", "url": "https://github.com/metasfresh/metasfresh/commit/ac6e714970d7876f3dc9d33007afeb988707a8bd", "message": "move Tabs to ./window folder", "committedDate": "2020-05-10T00:16:36Z", "type": "commit"}, {"oid": "7848bed4039f55242181fe4883175951c9ac3b0f", "url": "https://github.com/metasfresh/metasfresh/commit/7848bed4039f55242181fe4883175951c9ac3b0f", "message": "Update Window.js", "committedDate": "2020-05-10T00:29:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY0OTY5MQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6622#discussion_r422649691", "bodyText": "this should be a separated component", "author": "petrican", "createdAt": "2020-05-10T14:01:57Z", "path": "frontend/src/components/window/Column.js", "diffHunk": "@@ -0,0 +1,163 @@\n+import React, { PureComponent } from 'react';\n+import PropTypes from 'prop-types';\n+import classnames from 'classnames';\n+import ElementGroup from './ElementGroup';\n+import EntryTable from '../table/EntryTable';\n+\n+class Column extends PureComponent {\n+  constructor(props) {\n+    super(props);\n+\n+    if (props.isModal) {\n+      this.tabIndex = {\n+        firstColumn: 0,\n+        secondColumn: 0,\n+      };\n+    } else {\n+      this.tabIndex = {\n+        firstColumn: 1,\n+        secondColumn: 2,\n+      };\n+    }\n+  }\n+\n+  render() {\n+    const { columnLayout, colWidth } = this.props;\n+    const { isDataEntry } = this.props;\n+    const elementGroups = columnLayout.elementGroups;\n+\n+    if (isDataEntry) {\n+      return (\n+        <div className=\"col-sm-12\">{this.renderEntryTable(elementGroups)}</div>\n+      );\n+    } else {\n+      if (elementGroups === undefined || elementGroups.length == 0) {\n+        return null;\n+      }\n+\n+      return (\n+        <div className={`col-sm-${colWidth}`}>\n+          {elementGroups && this.renderElementGroups(elementGroups)}\n+        </div>\n+      );\n+    }\n+  }\n+\n+  renderElementGroups = (groups) => {", "originalCommit": "7848bed4039f55242181fe4883175951c9ac3b0f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY0OTczMg==", "url": "https://github.com/metasfresh/metasfresh/pull/6622#discussion_r422649732", "bodyText": "this should be a separated component also", "author": "petrican", "createdAt": "2020-05-10T14:02:25Z", "path": "frontend/src/components/window/Column.js", "diffHunk": "@@ -0,0 +1,163 @@\n+import React, { PureComponent } from 'react';\n+import PropTypes from 'prop-types';\n+import classnames from 'classnames';\n+import ElementGroup from './ElementGroup';\n+import EntryTable from '../table/EntryTable';\n+\n+class Column extends PureComponent {\n+  constructor(props) {\n+    super(props);\n+\n+    if (props.isModal) {\n+      this.tabIndex = {\n+        firstColumn: 0,\n+        secondColumn: 0,\n+      };\n+    } else {\n+      this.tabIndex = {\n+        firstColumn: 1,\n+        secondColumn: 2,\n+      };\n+    }\n+  }\n+\n+  render() {\n+    const { columnLayout, colWidth } = this.props;\n+    const { isDataEntry } = this.props;\n+    const elementGroups = columnLayout.elementGroups;\n+\n+    if (isDataEntry) {\n+      return (\n+        <div className=\"col-sm-12\">{this.renderEntryTable(elementGroups)}</div>\n+      );\n+    } else {\n+      if (elementGroups === undefined || elementGroups.length == 0) {\n+        return null;\n+      }\n+\n+      return (\n+        <div className={`col-sm-${colWidth}`}>\n+          {elementGroups && this.renderElementGroups(elementGroups)}\n+        </div>\n+      );\n+    }\n+  }\n+\n+  renderElementGroups = (groups) => {\n+    const { windowId, tabId, rowId, dataId } = this.props;\n+    const { data } = this.props;\n+    const { isFirst, isModal, isAdvanced, isFullScreen } = this.props;\n+    const {\n+      onBlurWidget,\n+      addRefToWidgets,\n+      requestElementGroupFocus,\n+    } = this.props;\n+\n+    return groups.map((elementGroupLayout, elementGroupIndex) => {\n+      const shouldBeFocused = isFirst && elementGroupIndex === 0;\n+      const tabIndex =\n+        elementGroupLayout.type === 'primary'\n+          ? this.tabIndex.firstColumn\n+          : this.tabIndex.secondColumn;\n+\n+      return (\n+        <ElementGroup\n+          key={'elemGroups' + elementGroupIndex}\n+          //\n+          elementGroupLayout={elementGroupLayout}\n+          //\n+          windowId={windowId}\n+          tabId={tabId}\n+          rowId={rowId}\n+          dataId={dataId}\n+          //\n+          data={data}\n+          //\n+          shouldBeFocused={shouldBeFocused}\n+          tabIndex={tabIndex}\n+          isModal={isModal}\n+          isAdvanced={isAdvanced}\n+          isFullScreen={isFullScreen}\n+          //\n+          onBlurWidget={onBlurWidget}\n+          addRefToWidgets={addRefToWidgets}\n+          requestElementGroupFocus={requestElementGroupFocus}\n+        />\n+      );\n+    });\n+  };\n+\n+  renderEntryTable = (groups) => {", "originalCommit": "7848bed4039f55242181fe4883175951c9ac3b0f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY1MDEyNA==", "url": "https://github.com/metasfresh/metasfresh/pull/6622#discussion_r422650124", "bodyText": "Why -1 ? Pls explain", "author": "petrican", "createdAt": "2020-05-10T14:05:59Z", "path": "frontend/src/components/window/Element.js", "diffHunk": "@@ -0,0 +1,66 @@\n+import React, { PureComponent } from 'react';\n+import PropTypes from 'prop-types';\n+import MasterWidget from '../widget/MasterWidget';\n+\n+class Element extends PureComponent {\n+  render() {\n+    const { windowId, tabId, rowId, dataId } = this.props;\n+    const { elementLayout, elementIndex } = this.props;\n+    const { isFocused, tabIndex } = this.props;\n+    const { data } = this.props;\n+    const { isModal, isAdvanced, isFullScreen } = this.props;\n+    const { addRefToWidgets, onBlurWidget } = this.props;\n+\n+    const autoFocus = isFocused && elementIndex === 0;\n+    const widgetData = elementLayout.fields.map(\n+      (item) => data[item.field] || -1", "originalCommit": "7848bed4039f55242181fe4883175951c9ac3b0f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY1MDczMg==", "url": "https://github.com/metasfresh/metasfresh/pull/6622#discussion_r422650732", "bodyText": "You can remove those // . You you think the propTypes is too big you can put it in a separated file.", "author": "petrican", "createdAt": "2020-05-10T14:11:03Z", "path": "frontend/src/components/window/Element.js", "diffHunk": "@@ -0,0 +1,66 @@\n+import React, { PureComponent } from 'react';\n+import PropTypes from 'prop-types';\n+import MasterWidget from '../widget/MasterWidget';\n+\n+class Element extends PureComponent {\n+  render() {\n+    const { windowId, tabId, rowId, dataId } = this.props;\n+    const { elementLayout, elementIndex } = this.props;\n+    const { isFocused, tabIndex } = this.props;\n+    const { data } = this.props;\n+    const { isModal, isAdvanced, isFullScreen } = this.props;\n+    const { addRefToWidgets, onBlurWidget } = this.props;\n+\n+    const autoFocus = isFocused && elementIndex === 0;\n+    const widgetData = elementLayout.fields.map(\n+      (item) => data[item.field] || -1\n+    );\n+    const fieldName = elementLayout.fields ? elementLayout.fields[0].field : '';\n+    const relativeDocId = data.ID && data.ID.value;\n+\n+    return (\n+      <MasterWidget\n+        ref={addRefToWidgets}\n+        entity=\"window\"\n+        key={'element' + elementIndex}\n+        windowType={windowId}\n+        dataId={dataId}\n+        widgetData={widgetData}\n+        isModal={!!isModal}\n+        tabId={tabId}\n+        rowId={rowId}\n+        relativeDocId={relativeDocId}\n+        isAdvanced={isAdvanced}\n+        tabIndex={tabIndex}\n+        autoFocus={!isModal && autoFocus}\n+        fullScreen={isFullScreen}\n+        fieldName={fieldName}\n+        onBlurWidget={onBlurWidget}\n+        {...elementLayout}\n+      />\n+    );\n+  }\n+}\n+\n+Element.propTypes = {\n+  elementLayout: PropTypes.object.isRequired,\n+  elementIndex: PropTypes.number.isRequired,\n+  //", "originalCommit": "7848bed4039f55242181fe4883175951c9ac3b0f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY1MDgyNg==", "url": "https://github.com/metasfresh/metasfresh/pull/6622#discussion_r422650826", "bodyText": "Separated component", "author": "petrican", "createdAt": "2020-05-10T14:12:02Z", "path": "frontend/src/components/window/ElementGroup.js", "diffHunk": "@@ -0,0 +1,99 @@\n+import React, { PureComponent } from 'react';\n+import PropTypes from 'prop-types';\n+import classnames from 'classnames';\n+\n+import ElementsLine from './ElementsLine';\n+\n+class ElementGroup extends PureComponent {\n+  render() {\n+    const {\n+      elementGroupLayout,\n+      shouldBeFocused,\n+      isModal,\n+      requestElementGroupFocus,\n+    } = this.props;\n+\n+    if (\n+      elementGroupLayout.elementsLine === undefined ||\n+      elementGroupLayout.elementsLine.length == 0\n+    ) {\n+      return null;\n+    }\n+\n+    return (\n+      <div\n+        ref={(c) => {\n+          if (c && isModal && shouldBeFocused) {\n+            requestElementGroupFocus(c);\n+          }\n+        }}\n+        className={classnames('panel panel-spaced panel-distance', {\n+          'panel-bordered panel-primary': elementGroupLayout.type === 'primary',\n+          'panel-secondary': elementGroupLayout.type !== 'primary',\n+        })}\n+      >\n+        {this.renderElementsLinesArray(elementGroupLayout.elementsLine)}\n+      </div>\n+    );\n+  }\n+\n+  renderElementsLinesArray = (elementsLinesLayoutArray) => {", "originalCommit": "7848bed4039f55242181fe4883175951c9ac3b0f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY1MDk5Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6622#discussion_r422650996", "bodyText": "Separated component", "author": "petrican", "createdAt": "2020-05-10T14:13:27Z", "path": "frontend/src/components/window/ElementsLine.js", "diffHunk": "@@ -0,0 +1,78 @@\n+import React, { PureComponent } from 'react';\n+import PropTypes from 'prop-types';\n+\n+import Element from './Element';\n+\n+class ElementsLine extends PureComponent {\n+  render() {\n+    const { elementsLineLayout } = this.props;\n+\n+    if (\n+      elementsLineLayout.elements === undefined ||\n+      elementsLineLayout.elements.length == 0\n+    ) {\n+      return null;\n+    }\n+\n+    return (\n+      <div className=\"elements-line\">\n+        {this.renderElements(elementsLineLayout.elements)}\n+      </div>\n+    );\n+  }\n+\n+  renderElements = (elements) => {", "originalCommit": "7848bed4039f55242181fe4883175951c9ac3b0f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY1MTA5OQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6622#discussion_r422651099", "bodyText": "separate component", "author": "petrican", "createdAt": "2020-05-10T14:14:10Z", "path": "frontend/src/components/window/Section.js", "diffHunk": "@@ -0,0 +1,117 @@\n+import React, { PureComponent } from 'react';\n+import PropTypes from 'prop-types';\n+import classnames from 'classnames';\n+import Separator from '../Separator';\n+import Column from './Column';\n+import { INITIALLY_OPEN, INITIALLY_CLOSED } from '../../constants/Constants';\n+\n+class Section extends PureComponent {\n+  render() {\n+    const { sectionLayout, sectionIndex } = this.props;\n+    const { extendedData } = this.props;\n+    const { isSectionCollapsed, toggleSectionCollapsed } = this.props;\n+\n+    const { title, columns, closableMode } = sectionLayout;\n+    const collapsible =\n+      closableMode === INITIALLY_OPEN || closableMode === INITIALLY_CLOSED;\n+\n+    return (\n+      <div className={classnames('section', { collapsed: isSectionCollapsed })}>\n+        {title && (\n+          <Separator\n+            title={title}\n+            idx={sectionIndex}\n+            sectionCollapsed={isSectionCollapsed}\n+            collapsible={collapsible}\n+            tabId={extendedData.tabId}\n+            onClick={toggleSectionCollapsed}\n+          />\n+        )}\n+        <div\n+          className={classnames('row', {\n+            'collapsible-section': collapsible,\n+            collapsed: isSectionCollapsed,\n+          })}\n+        >\n+          {columns && this.renderColumns(columns)}\n+        </div>\n+      </div>\n+    );\n+  }\n+\n+  renderColumns = (columns) => {", "originalCommit": "7848bed4039f55242181fe4883175951c9ac3b0f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY1MTMxMA==", "url": "https://github.com/metasfresh/metasfresh/pull/6622#discussion_r422651310", "bodyText": "you can use uuid combined with col for optimisation", "author": "petrican", "createdAt": "2020-05-10T14:16:03Z", "path": "frontend/src/components/window/Section.js", "diffHunk": "@@ -0,0 +1,117 @@\n+import React, { PureComponent } from 'react';\n+import PropTypes from 'prop-types';\n+import classnames from 'classnames';\n+import Separator from '../Separator';\n+import Column from './Column';\n+import { INITIALLY_OPEN, INITIALLY_CLOSED } from '../../constants/Constants';\n+\n+class Section extends PureComponent {\n+  render() {\n+    const { sectionLayout, sectionIndex } = this.props;\n+    const { extendedData } = this.props;\n+    const { isSectionCollapsed, toggleSectionCollapsed } = this.props;\n+\n+    const { title, columns, closableMode } = sectionLayout;\n+    const collapsible =\n+      closableMode === INITIALLY_OPEN || closableMode === INITIALLY_CLOSED;\n+\n+    return (\n+      <div className={classnames('section', { collapsed: isSectionCollapsed })}>\n+        {title && (\n+          <Separator\n+            title={title}\n+            idx={sectionIndex}\n+            sectionCollapsed={isSectionCollapsed}\n+            collapsible={collapsible}\n+            tabId={extendedData.tabId}\n+            onClick={toggleSectionCollapsed}\n+          />\n+        )}\n+        <div\n+          className={classnames('row', {\n+            'collapsible-section': collapsible,\n+            collapsed: isSectionCollapsed,\n+          })}\n+        >\n+          {columns && this.renderColumns(columns)}\n+        </div>\n+      </div>\n+    );\n+  }\n+\n+  renderColumns = (columns) => {\n+    const { sectionIndex } = this.props;\n+    const { windowId, tabId, rowId, dataId } = this.props;\n+    const { data, isDataEntry, extendedData, rowData } = this.props;\n+    const { isModal, isAdvanced, isFullScreen } = this.props;\n+    const {\n+      addRefToWidgets,\n+      onBlurWidget,\n+      requestElementGroupFocus,\n+    } = this.props;\n+\n+    const maxRows = 12;\n+    const colWidth = Math.floor(maxRows / columns.length);\n+\n+    const isFirstSection = sectionIndex === 0;\n+\n+    return columns.map((columnLayout, columnIndex) => {\n+      const isFirstColumn = isFirstSection && columnIndex === 0;\n+      return (\n+        <Column\n+          key={`col-${columnIndex}`}", "originalCommit": "7848bed4039f55242181fe4883175951c9ac3b0f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}