{"pr_number": 1052, "pr_title": "Introduce Counter protocol", "pr_createdAt": "2020-08-26T23:59:49Z", "pr_url": "https://github.com/envoyproxy/envoy-mobile/pull/1052", "timeline": [{"oid": "222e0671c57b96982c7fcb1741c0a5be64fe090d", "url": "https://github.com/envoyproxy/envoy-mobile/commit/222e0671c57b96982c7fcb1741c0a5be64fe090d", "message": "Make class open to allow subclassing\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>", "committedDate": "2020-08-27T00:02:25Z", "type": "commit"}, {"oid": "20dca5a5c039db1f5b231f1d2a3b03a9cc75cfc1", "url": "https://github.com/envoyproxy/envoy-mobile/commit/20dca5a5c039db1f5b231f1d2a3b03a9cc75cfc1", "message": "Introduce Counter protocol\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>", "committedDate": "2020-08-27T00:02:25Z", "type": "commit"}, {"oid": "178eb952d9a732f3c1272325b8cd9ce501b98415", "url": "https://github.com/envoyproxy/envoy-mobile/commit/178eb952d9a732f3c1272325b8cd9ce501b98415", "message": "Add missing files\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>", "committedDate": "2020-08-27T00:02:25Z", "type": "commit"}, {"oid": "178eb952d9a732f3c1272325b8cd9ce501b98415", "url": "https://github.com/envoyproxy/envoy-mobile/commit/178eb952d9a732f3c1272325b8cd9ce501b98415", "message": "Add missing files\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>", "committedDate": "2020-08-27T00:02:25Z", "type": "forcePushed"}, {"oid": "736792be9262f6d7defc4dbc12fcbcf09472b3a1", "url": "https://github.com/envoyproxy/envoy-mobile/commit/736792be9262f6d7defc4dbc12fcbcf09472b3a1", "message": "fix\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>", "committedDate": "2020-08-27T00:06:11Z", "type": "commit"}, {"oid": "736792be9262f6d7defc4dbc12fcbcf09472b3a1", "url": "https://github.com/envoyproxy/envoy-mobile/commit/736792be9262f6d7defc4dbc12fcbcf09472b3a1", "message": "fix\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>", "committedDate": "2020-08-27T00:06:11Z", "type": "forcePushed"}, {"oid": "11cd6f58d06e4b13ce8770ac3883005539e92a70", "url": "https://github.com/envoyproxy/envoy-mobile/commit/11cd6f58d06e4b13ce8770ac3883005539e92a70", "message": "fix\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>", "committedDate": "2020-08-27T00:50:33Z", "type": "commit"}, {"oid": "bbe021bc928ea34d8a8acf1f0ef105123942a9f8", "url": "https://github.com/envoyproxy/envoy-mobile/commit/bbe021bc928ea34d8a8acf1f0ef105123942a9f8", "message": "remove unnecessary import\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>", "committedDate": "2020-08-27T00:53:04Z", "type": "commit"}, {"oid": "8dd194801c9a385535eed4e6a1e3bc819637c17b", "url": "https://github.com/envoyproxy/envoy-mobile/commit/8dd194801c9a385535eed4e6a1e3bc819637c17b", "message": "empty\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>", "committedDate": "2020-08-27T01:48:52Z", "type": "commit"}, {"oid": "d959fd406858e39779aed35046bd4cb59475c9e0", "url": "https://github.com/envoyproxy/envoy-mobile/commit/d959fd406858e39779aed35046bd4cb59475c9e0", "message": "improve test\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>", "committedDate": "2020-08-27T15:33:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY5NDkxMw==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1052#discussion_r478694913", "bodyText": "no default value of an argument can be specified in Swift's protocol - that's why I need to have a method defined in an extension.", "author": "Augustyniak", "createdAt": "2020-08-27T21:04:55Z", "path": "library/swift/src/stats/Counter.swift", "diffHunk": "@@ -1,24 +1,15 @@\n-@_implementationOnly import EnvoyEngine\n import Foundation\n \n /// A time series counter.\n-@objcMembers\n-public class Counter: NSObject {\n-  private let series: String\n-  private weak var engine: EnvoyEngine?\n-\n-  init(elements: [Element], engine: EnvoyEngine) {\n-    self.series = elements.map { $0.value }.joined(separator: \".\")\n-    self.engine = engine\n-    super.init()\n-  }\n-\n+@objc\n+public protocol Counter: AnyObject {\n   /// Increment the counter by the given count.\n-  public func increment(count: Int = 1) {\n-    guard let engine = self.engine else {\n-      return\n-    }\n+  func increment(count: Int)", "originalCommit": "d959fd406858e39779aed35046bd4cb59475c9e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY5OTQ1Mw==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1052#discussion_r478699453", "bodyText": "nit: on android we usually use I to prefix an interface (similar to swift protocol). if this was an android class, it would be named ICounter.\npersonally i don't have too strong of an opinion on this, but Counter definitely doesn't not intuitively suggest an interface.\nis there a similar naming convention for swift @Augustyniak? im guessing not, but would like to confirm.", "author": "jingwei99", "createdAt": "2020-08-27T21:14:04Z", "path": "library/swift/src/stats/Counter.swift", "diffHunk": "@@ -1,24 +1,15 @@\n-@_implementationOnly import EnvoyEngine", "originalCommit": "d959fd406858e39779aed35046bd4cb59475c9e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcwMDA0Nw==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1052#discussion_r478700047", "bodyText": "looking at other protocols on iOS - StatsClient being one example - we don't use I prefix for protocols on iOS. Instead, we add Impl suffix to objects implementing a given protocol.", "author": "Augustyniak", "createdAt": "2020-08-27T21:15:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY5OTQ1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcxMzMwMg==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1052#discussion_r478713302", "bodyText": "looking at other protocols on iOS\n\nim assuming you are referencing to other protocols in this repo (instead of swift in general), my original question was more about swift in general.\nso for swift in general, is there such naming convention - again im assuming not, but would like to confirm.", "author": "jingwei99", "createdAt": "2020-08-27T21:45:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY5OTQ1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcxNjE5Mg==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1052#discussion_r478716192", "bodyText": "In general, I is not used as prefix for protocol names in Swift. This is what official Swift guidelines say:\n\nsource: https://swift.org/documentation/api-design-guidelines/", "author": "Augustyniak", "createdAt": "2020-08-27T21:51:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY5OTQ1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcxNjU4Mg==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1052#discussion_r478716582", "bodyText": "An I- prefix is much more a Java convention. In Swift, if a distinction is necessary, the -Protocol suffix would be more typical. Here, we've simply standardized on -Impl for the implementation, since it's common enough across languages, and what Envoy itself uses as well.", "author": "goaway", "createdAt": "2020-08-27T21:52:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY5OTQ1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcxNzIxOA==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1052#discussion_r478717218", "bodyText": "i see, thank you both.", "author": "jingwei99", "createdAt": "2020-08-27T21:54:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY5OTQ1Mw=="}], "type": "inlineReview"}]}