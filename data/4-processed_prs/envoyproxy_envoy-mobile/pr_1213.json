{"pr_number": 1213, "pr_title": "android: split comma-delimited header values when creating platform representation", "pr_createdAt": "2020-12-18T12:21:41Z", "pr_url": "https://github.com/envoyproxy/envoy-mobile/pull/1213", "timeline": [{"oid": "9e9c3d3319b4ada10afb005e58af7dc9acc121d3", "url": "https://github.com/envoyproxy/envoy-mobile/commit/9e9c3d3319b4ada10afb005e58af7dc9acc121d3", "message": "android split comma-delimited header values when creating platform representation\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-12-18T12:22:03Z", "type": "commit"}, {"oid": "9e9c3d3319b4ada10afb005e58af7dc9acc121d3", "url": "https://github.com/envoyproxy/envoy-mobile/commit/9e9c3d3319b4ada10afb005e58af7dc9acc121d3", "message": "android split comma-delimited header values when creating platform representation\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-12-18T12:22:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg1NTA3OA==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1213#discussion_r545855078", "bodyText": "Similar comment as on the iOS PR as to whether we want to trim here", "author": "rebello95", "createdAt": "2020-12-18T14:12:21Z", "path": "library/java/src/io/envoyproxy/envoymobile/engine/JvmBridgeUtility.java", "diffHunk": "@@ -45,12 +45,26 @@ void passHeader(byte[] key, byte[] value, boolean start) {\n       throw new RuntimeException(e);\n     }\n \n+    // Ensure list is present in dictionary value\n     List<String> values = headerAccumulator.get(headerKey);\n     if (values == null) {\n       values = new ArrayList(1);\n       headerAccumulator.put(headerKey, values);\n     }\n-    values.add(headerValue);\n+\n+    // By convention, these headers disregard the RFC and contain commas single values.\n+    if (headerKey.equals(\"set-cookie\") ||\n+        headerKey.equals(\"www-authenticate\") ||\n+        headerKey.equals(\"proxy-authenticate\")) {\n+      values.add(headerValue);\n+    } else {\n+      // Add trimmed, comma-separated values as individual members of the list.\n+      String[] newValues = headerValue.split(\",\");\n+      for (int i = 0; i < newValues.length; i++) {\n+        values.add(newValues[i].trim());", "originalCommit": "9e9c3d3319b4ada10afb005e58af7dc9acc121d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5ODE4NA==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1213#discussion_r545998184", "bodyText": "Replied on the other PR. :)", "author": "goaway", "createdAt": "2020-12-18T18:02:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg1NTA3OA=="}], "type": "inlineReview"}, {"oid": "3e71522da8c0c21ccd5fd8b24547bc7b25a468bd", "url": "https://github.com/envoyproxy/envoy-mobile/commit/3e71522da8c0c21ccd5fd8b24547bc7b25a468bd", "message": "format\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-12-18T18:02:53Z", "type": "commit"}, {"oid": "abfa059c1ff3d3385f6978196117657e2d7b95ff", "url": "https://github.com/envoyproxy/envoy-mobile/commit/abfa059c1ff3d3385f6978196117657e2d7b95ff", "message": "add test\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-12-18T18:07:07Z", "type": "commit"}, {"oid": "3f82e9710e969511420826149ab2e2498fc80989", "url": "https://github.com/envoyproxy/envoy-mobile/commit/3f82e9710e969511420826149ab2e2498fc80989", "message": "add one more header\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-12-18T18:15:50Z", "type": "commit"}]}