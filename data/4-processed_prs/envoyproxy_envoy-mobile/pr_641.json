{"pr_number": 641, "pr_title": "ios: remove domain from engine configuration", "pr_createdAt": "2020-01-22T22:02:11Z", "pr_url": "https://github.com/envoyproxy/envoy-mobile/pull/641", "timeline": [{"oid": "d2c824b434a1f1dfd7ebd24389996dae26d0ff07", "url": "https://github.com/envoyproxy/envoy-mobile/commit/d2c824b434a1f1dfd7ebd24389996dae26d0ff07", "message": "ios: remove stream from engine configuration\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-01-31T16:34:31Z", "type": "commit"}, {"oid": "0cf0a28d5b285907b6fa36464108c104f81c4a0b", "url": "https://github.com/envoyproxy/envoy-mobile/commit/0cf0a28d5b285907b6fa36464108c104f81c4a0b", "message": "swiftlint\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-01-31T16:34:31Z", "type": "commit"}, {"oid": "cbe7500253196bc424d9bd45aa6929484d756bd2", "url": "https://github.com/envoyproxy/envoy-mobile/commit/cbe7500253196bc424d9bd45aa6929484d756bd2", "message": "fix swift tests\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-01-31T16:34:31Z", "type": "commit"}, {"oid": "2683bd0335dee1613915d5b0c4cc8355f04da4d0", "url": "https://github.com/envoyproxy/envoy-mobile/commit/2683bd0335dee1613915d5b0c4cc8355f04da4d0", "message": "fix example apps\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-01-31T16:34:31Z", "type": "commit"}, {"oid": "2683bd0335dee1613915d5b0c4cc8355f04da4d0", "url": "https://github.com/envoyproxy/envoy-mobile/commit/2683bd0335dee1613915d5b0c4cc8355f04da4d0", "message": "fix example apps\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-01-31T16:34:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYxMDUyOA==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/641#discussion_r373610528", "bodyText": "do we want to protect at the core layer against sendHeaders calls that do not set an authority header?", "author": "junr03", "createdAt": "2020-01-31T18:04:24Z", "path": "library/swift/test/EnvoyClientTests.swift", "diffHunk": "@@ -67,7 +67,7 @@ final class EnvoyClientTests: XCTestCase {\n       method: .get, scheme: \"https\", authority: \"www.envoyproxy.io\", path: \"/docs\")", "originalCommit": "2683bd0335dee1613915d5b0c4cc8355f04da4d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc4NzY5Ng==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/641#discussion_r373787696", "bodyText": "That's a good callout and something we've discussed before. Right now we don't check to see if this is a valid HTTP/2 request at this layer, but we certainly could. I think it's worth discussing and/or tracking in an issue, but somewhat orthogonal to this change (since we haven't done it before either).", "author": "goaway", "createdAt": "2020-02-01T16:13:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYxMDUyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc4OTM0Ng==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/641#discussion_r373789346", "bodyText": "FWIW authority is a required property when initializing the RequestBuilder, so consumers would have to explicitly set an invalid/empty authority value here. Could be worth asserting or logging in the core layer as you mentioned, though", "author": "rebello95", "createdAt": "2020-02-01T16:48:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYxMDUyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYxMTQ1NA==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/641#discussion_r373611454", "bodyText": "I think we have a templating bug. Which is that now we are not setting SNI in the template if we don't populate domain. Which actually brings the larger question of how we want to do that (and relatedly #630) for the dynamic proxy? I need to read the docs to see if that can be dynamic as well.", "author": "junr03", "createdAt": "2020-01-31T18:06:46Z", "path": "library/objective-c/EnvoyEngine.h", "diffHunk": "@@ -143,11 +142,10 @@ typedef NSDictionary<NSString *, NSArray<NSString *> *> EnvoyHeaders;\n /**\n  Create a new instance of the configuration.\n  */\n-- (instancetype)initWithDomain:(NSString *)domain\n-                   statsDomain:(NSString *)statsDomain\n-         connectTimeoutSeconds:(UInt32)connectTimeoutSeconds\n-             dnsRefreshSeconds:(UInt32)dnsRefreshSeconds\n-             statsFlushSeconds:(UInt32)statsFlushSeconds;\n+- (instancetype)initWithStatsDomain:(NSString *)statsDomain", "originalCommit": "2683bd0335dee1613915d5b0c4cc8355f04da4d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc4NzU2Ng==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/641#discussion_r373787566", "bodyText": "According to the docs here it sounds like SNI will happen automatically as long as there's a TLS context on the cluster:\nhttps://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/http/http_proxy", "author": "goaway", "createdAt": "2020-02-01T16:11:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYxMTQ1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc4NzU4OA==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/641#discussion_r373787588", "bodyText": "Will update.", "author": "goaway", "createdAt": "2020-02-01T16:11:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYxMTQ1NA=="}], "type": "inlineReview"}, {"oid": "e0a0822bd343d5d236a101194770f65eb6b8ff16", "url": "https://github.com/envoyproxy/envoy-mobile/commit/e0a0822bd343d5d236a101194770f65eb6b8ff16", "message": "remove sni key from config\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-02-01T16:15:50Z", "type": "commit"}]}