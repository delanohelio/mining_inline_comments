{"pr_number": 1002, "pr_title": "filters: wire Android invocation path", "pr_createdAt": "2020-08-05T14:14:26Z", "pr_url": "https://github.com/envoyproxy/envoy-mobile/pull/1002", "timeline": [{"oid": "783b9e7e8f4382672a36b3eac0d3e21c3168ea9a", "url": "https://github.com/envoyproxy/envoy-mobile/commit/783b9e7e8f4382672a36b3eac0d3e21c3168ea9a", "message": "format\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-08-10T03:15:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE5MTYyOQ==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1002#discussion_r468191629", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  .addFilter({ DemoFilter() })\n          \n          \n            \n                  .addFilter { DemoFilter() }\n          \n      \n    \n    \n  \n\nYou don't have to add the parens for this case", "author": "buildbreaker", "createdAt": "2020-08-10T21:18:31Z", "path": "examples/kotlin/hello_world/MainActivity.kt", "diffHunk": "@@ -36,7 +37,9 @@ class MainActivity : Activity() {\n     super.onCreate(savedInstanceState)\n     setContentView(R.layout.activity_main)\n \n-    streamClient = AndroidStreamClientBuilder(application).build()\n+    streamClient = AndroidStreamClientBuilder(application)\n+      .addFilter({ DemoFilter() })", "originalCommit": "16d37ce46d3b91a40f1839325306400f70a3e1a7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIwNzI4OA==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1002#discussion_r468207288", "bodyText": "Is it possible for us to add unit tests to just ensure the the filters are called appropriately?", "author": "buildbreaker", "createdAt": "2020-08-10T21:53:33Z", "path": "library/java/src/io/envoyproxy/envoymobile/engine/JvmFilterContext.java", "diffHunk": "@@ -0,0 +1,104 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+import java.nio.ByteBuffer;\n+import java.util.Map;\n+\n+import io.envoyproxy.envoymobile.engine.types.EnvoyHTTPFilter;\n+\n+/**\n+ * Wrapper class for EnvoyHTTPFilter for receiving JNI calls.\n+ */\n+class JvmFilterContext {", "originalCommit": "16d37ce46d3b91a40f1839325306400f70a3e1a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODk4OTgyMg==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1002#discussion_r468989822", "bodyText": "#1024", "author": "goaway", "createdAt": "2020-08-12T03:54:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIwNzI4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTM4NTA0MA==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1002#discussion_r469385040", "bodyText": "Could we also have a JvmFilterContext unit test which helps us with exercising the interaction between the JvmBridgeUtility and EnvoyHTTPFilter?", "author": "buildbreaker", "createdAt": "2020-08-12T16:24:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIwNzI4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTUyODgxMw==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1002#discussion_r469528813", "bodyText": "Stepping back for a second, I'm honestly skeptical of the value of unit testing functions that purely perform delegation. There's no real black box logic to test; the function makes another call, and you implement that call on one hand and then assert you've implemented it on the other. In my opinion, integration testing is a much better mechanism for testing for correct wiring/coupling of layers.\nTranslation on the other hand, I think merits unit testing - which is partly why I've extracted logic into the JvmBridgeUtility (and also the JniBridgeUtility in the upcoming PR).", "author": "goaway", "createdAt": "2020-08-12T20:36:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIwNzI4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTUzNDYxNA==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1002#discussion_r469534614", "bodyText": "That's fair. I would like to capture and exercise the delegation path somewhere.\nI assume you have in mind an integration test which would exercise this?", "author": "buildbreaker", "createdAt": "2020-08-12T20:42:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIwNzI4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwNjM3MQ==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1002#discussion_r470206371", "bodyText": "Yes, I'd like to cover the paths through the layer wiring using the AssertionFilter that @junr03 has implemented.", "author": "goaway", "createdAt": "2020-08-13T19:47:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIwNzI4OA=="}], "type": "inlineReview"}, {"oid": "6f08e1217e9eefdff6a680ecafdccfd9ca9d3365", "url": "https://github.com/envoyproxy/envoy-mobile/commit/6f08e1217e9eefdff6a680ecafdccfd9ca9d3365", "message": "filters: wire Android invocation path\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-08-12T04:00:31Z", "type": "commit"}, {"oid": "5b2ad18da31d29ca29ec16fbe092dc91e64fad9e", "url": "https://github.com/envoyproxy/envoy-mobile/commit/5b2ad18da31d29ca29ec16fbe092dc91e64fad9e", "message": "format\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-08-12T04:00:31Z", "type": "commit"}, {"oid": "5a0e436c83b110c9d4cb23828d28cb897089c22f", "url": "https://github.com/envoyproxy/envoy-mobile/commit/5a0e436c83b110c9d4cb23828d28cb897089c22f", "message": "registration\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-08-12T04:01:45Z", "type": "commit"}, {"oid": "3fdcdfe38acee0e56b5bd9074566d7da8d52b098", "url": "https://github.com/envoyproxy/envoy-mobile/commit/3fdcdfe38acee0e56b5bd9074566d7da8d52b098", "message": "progress\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-08-12T04:02:48Z", "type": "commit"}, {"oid": "491435826eef727a2a6292b22a7bdb722098c956", "url": "https://github.com/envoyproxy/envoy-mobile/commit/491435826eef727a2a6292b22a7bdb722098c956", "message": "success\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-08-12T04:02:48Z", "type": "commit"}, {"oid": "16840a85d730c56cc73a06093cf141b12803c921", "url": "https://github.com/envoyproxy/envoy-mobile/commit/16840a85d730c56cc73a06093cf141b12803c921", "message": "format\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-08-12T04:02:48Z", "type": "commit"}, {"oid": "0fe652a7a212979d24fee5778e4d2ca07062c9f7", "url": "https://github.com/envoyproxy/envoy-mobile/commit/0fe652a7a212979d24fee5778e4d2ca07062c9f7", "message": "style\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-08-12T04:03:12Z", "type": "commit"}, {"oid": "0fe652a7a212979d24fee5778e4d2ca07062c9f7", "url": "https://github.com/envoyproxy/envoy-mobile/commit/0fe652a7a212979d24fee5778e4d2ca07062c9f7", "message": "style\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-08-12T04:03:12Z", "type": "forcePushed"}, {"oid": "a5870342ba4c761045a65e15f9880fb122698b33", "url": "https://github.com/envoyproxy/envoy-mobile/commit/a5870342ba4c761045a65e15f9880fb122698b33", "message": "test fixes\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-08-12T05:31:38Z", "type": "commit"}, {"oid": "43eeedf348327b854e0bfb083591d052b546ed40", "url": "https://github.com/envoyproxy/envoy-mobile/commit/43eeedf348327b854e0bfb083591d052b546ed40", "message": "format\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-08-12T05:33:10Z", "type": "commit"}, {"oid": "4aa0a837b87332f38231f167de20634094d296a9", "url": "https://github.com/envoyproxy/envoy-mobile/commit/4aa0a837b87332f38231f167de20634094d296a9", "message": "kotlin lint\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-08-12T09:03:54Z", "type": "commit"}, {"oid": "87a82932ec0ae70db169f6f4b5c89fc6d0573c39", "url": "https://github.com/envoyproxy/envoy-mobile/commit/87a82932ec0ae70db169f6f4b5c89fc6d0573c39", "message": "further kotlin lint\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-08-13T19:58:20Z", "type": "commit"}]}