{"pr_number": 1155, "pr_title": "Revert \"Revert \"stats: update method names of counter\"", "pr_createdAt": "2020-10-29T00:38:18Z", "pr_url": "https://github.com/envoyproxy/envoy-mobile/pull/1155", "timeline": [{"oid": "00312ac179c74f36f1dd6610da775cc968d214c1", "url": "https://github.com/envoyproxy/envoy-mobile/commit/00312ac179c74f36f1dd6610da775cc968d214c1", "message": "stats: update method names of counter\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>", "committedDate": "2020-11-10T20:31:04Z", "type": "forcePushed"}, {"oid": "d609b390d3ea3446fa651aba1b59065803effb4f", "url": "https://github.com/envoyproxy/envoy-mobile/commit/d609b390d3ea3446fa651aba1b59065803effb4f", "message": "stats: update method names of counter\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>", "committedDate": "2020-11-10T21:39:54Z", "type": "commit"}, {"oid": "d609b390d3ea3446fa651aba1b59065803effb4f", "url": "https://github.com/envoyproxy/envoy-mobile/commit/d609b390d3ea3446fa651aba1b59065803effb4f", "message": "stats: update method names of counter\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>", "committedDate": "2020-11-10T21:39:54Z", "type": "forcePushed"}, {"oid": "c67d76434d82785012013b7a5875a059fe6c274e", "url": "https://github.com/envoyproxy/envoy-mobile/commit/c67d76434d82785012013b7a5875a059fe6c274e", "message": "lint precommit format\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>", "committedDate": "2020-11-10T22:06:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzNDYyNg==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155#discussion_r520934626", "bodyText": "Maybe vary these numbers?", "author": "rebello95", "createdAt": "2020-11-10T23:15:35Z", "path": "examples/java/hello_world/MainActivity.java", "diffHunk": "@@ -127,4 +131,19 @@ private void makeRequest() {\n         .start(Executors.newSingleThreadExecutor())\n         .sendHeaders(requestHeaders, true);\n   }\n+\n+  private void recordStats() {\n+    final Counter counter = engine.statsClient().counter(new Element(\"foo\"), new Element(\"bar\"),\n+                                                         new Element(\"counter\"));\n+\n+    final Gauge gauge =\n+        engine.statsClient().gauge(new Element(\"foo\"), new Element(\"bar\"), new Element(\"gauge\"));\n+\n+    counter.increment(1);\n+    counter.increment(5);\n+\n+    gauge.set(5);\n+    gauge.add(5);\n+    gauge.sub(5);", "originalCommit": "c67d76434d82785012013b7a5875a059fe6c274e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzNDY4Mg==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155#discussion_r520934682", "bodyText": "@buildbreaker is this file required?", "author": "rebello95", "createdAt": "2020-11-10T23:15:43Z", "path": "examples/java/hello_world/hello_world.iml", "diffHunk": "@@ -0,0 +1,11 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "originalCommit": "c67d76434d82785012013b7a5875a059fe6c274e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzODY2NQ==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155#discussion_r520938665", "bodyText": "my ide generated it, it's not required", "author": "jingwei99", "createdAt": "2020-11-10T23:26:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzNDY4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzNDkxOQ==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155#discussion_r520934919", "bodyText": "Please spell out \"element\" (more idiomatic on iOS)", "author": "rebello95", "createdAt": "2020-11-10T23:16:19Z", "path": "examples/objective-c/hello_world/ViewController.m", "diffHunk": "@@ -123,6 +126,20 @@ - (void)addResponseMessage:(NSString *)message\n   [self.tableView reloadData];\n }\n \n+- (void)sendStats {\n+  Element *eleFoo = [[Element alloc] initWithStringLiteral:@\"foo\"];", "originalCommit": "c67d76434d82785012013b7a5875a059fe6c274e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzNTA5Mw==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155#discussion_r520935093", "bodyText": "Why are these different from Android?", "author": "rebello95", "createdAt": "2020-11-10T23:16:46Z", "path": "examples/objective-c/hello_world/ViewController.m", "diffHunk": "@@ -123,6 +126,20 @@ - (void)addResponseMessage:(NSString *)message\n   [self.tableView reloadData];\n }\n \n+- (void)sendStats {\n+  Element *eleFoo = [[Element alloc] initWithStringLiteral:@\"foo\"];\n+  Element *eleBar = [[Element alloc] initWithStringLiteral:@\"bar\"];\n+  Element *eleCounter = [[Element alloc] initWithStringLiteral:@\"counter\"];\n+  Element *eleGauge = [[Element alloc] initWithStringLiteral:@\"gauge\"];\n+  id<Counter> counter = [self.statsClient counterWithElements:@[ eleFoo, eleBar, eleCounter ]];\n+  [counter incrementWithCount:1];\n+\n+  id<Gauge> gauge = [self.statsClient gaugeWithElements:@[ eleFoo, eleBar, eleGauge ]];\n+  [gauge setWithValue:1];\n+  [gauge addWithAmount:1];\n+  [gauge subWithAmount:1];", "originalCommit": "c67d76434d82785012013b7a5875a059fe6c274e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzOTI3OA==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155#discussion_r520939278", "bodyText": "you mean the method names?\nthey come from the swift generated Envoy/Envoy-Swift.h", "author": "jingwei99", "createdAt": "2020-11-10T23:27:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzNTA5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzOTY5NA==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155#discussion_r520939694", "bodyText": "I meant the amounts", "author": "rebello95", "createdAt": "2020-11-10T23:28:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzNTA5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDk0MDQxMg==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155#discussion_r520940412", "bodyText": "to clarify: you mean the actual numbers sent (instead of the method names)", "author": "jingwei99", "createdAt": "2020-11-10T23:30:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzNTA5Mw=="}], "type": "inlineReview"}, {"oid": "e3dc81aa74d8990bf1a783c053866f092a4c19a9", "url": "https://github.com/envoyproxy/envoy-mobile/commit/e3dc81aa74d8990bf1a783c053866f092a4c19a9", "message": "comments\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>", "committedDate": "2020-11-10T23:43:32Z", "type": "commit"}, {"oid": "056289d4023644bdff2ccf1c32c4ce7db12b3505", "url": "https://github.com/envoyproxy/envoy-mobile/commit/056289d4023644bdff2ccf1c32c4ce7db12b3505", "message": "reset envoy version\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>", "committedDate": "2020-11-10T23:48:05Z", "type": "commit"}, {"oid": "056289d4023644bdff2ccf1c32c4ce7db12b3505", "url": "https://github.com/envoyproxy/envoy-mobile/commit/056289d4023644bdff2ccf1c32c4ce7db12b3505", "message": "reset envoy version\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>", "committedDate": "2020-11-10T23:48:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDk5MDcxNQ==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155#discussion_r520990715", "bodyText": "I just noticed this - it looks like iOS is sending stats only once whereas Android is sending them with each request, is that correct? If so, these should be consistent", "author": "rebello95", "createdAt": "2020-11-11T01:23:10Z", "path": "examples/objective-c/hello_world/ViewController.m", "diffHunk": "@@ -46,8 +47,10 @@ - (void)startEnvoy {\n     NSLog(@\"starting Envoy failed: %@\", error);\n   } else {\n     NSLog(@\"started Envoy, beginning requests...\");\n-    self.client = [engine streamClient];\n+    self.streamClient = [engine streamClient];\n+    self.statsClient = [engine statsClient];\n     [self startRequests];\n+    [self sendStats];", "originalCommit": "056289d4023644bdff2ccf1c32c4ce7db12b3505", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTAwNDA4Nw==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155#discussion_r521004087", "bodyText": "looking, the structure of the code for ios and android are pretty different", "author": "jingwei99", "createdAt": "2020-11-11T01:42:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDk5MDcxNQ=="}], "type": "inlineReview"}, {"oid": "3cb62e388a836f6078f8b22377fc0ada07db5593", "url": "https://github.com/envoyproxy/envoy-mobile/commit/3cb62e388a836f6078f8b22377fc0ada07db5593", "message": "record stats for every request\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>", "committedDate": "2020-11-11T02:02:31Z", "type": "commit"}, {"oid": "3cb62e388a836f6078f8b22377fc0ada07db5593", "url": "https://github.com/envoyproxy/envoy-mobile/commit/3cb62e388a836f6078f8b22377fc0ada07db5593", "message": "record stats for every request\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>", "committedDate": "2020-11-11T02:02:31Z", "type": "forcePushed"}, {"oid": "cda0a8b16d45004e6c16d6c0bc589434ce86759b", "url": "https://github.com/envoyproxy/envoy-mobile/commit/cda0a8b16d45004e6c16d6c0bc589434ce86759b", "message": "Merge branch 'main' into revert-1153-revert-1134-rename_counter", "committedDate": "2020-11-11T22:00:13Z", "type": "commit"}, {"oid": "0d7f2918da8fa9a2d09b1d3c511bac976a68ca4b", "url": "https://github.com/envoyproxy/envoy-mobile/commit/0d7f2918da8fa9a2d09b1d3c511bac976a68ca4b", "message": "Merge branch 'main' into revert-1153-revert-1134-rename_counter", "committedDate": "2020-11-11T22:10:23Z", "type": "commit"}, {"oid": "730e76cd56eae50cbe889fd68f10c6b4c8389508", "url": "https://github.com/envoyproxy/envoy-mobile/commit/730e76cd56eae50cbe889fd68f10c6b4c8389508", "message": "Merge branch 'main' into revert-1153-revert-1134-rename_counter", "committedDate": "2020-11-11T22:42:41Z", "type": "commit"}]}