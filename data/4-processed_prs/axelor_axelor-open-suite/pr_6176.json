{"pr_number": 6176, "pr_title": "Anomaly #33519: Broken import from geonames", "pr_createdAt": "2020-12-10T11:52:12Z", "pr_url": "https://github.com/axelor/axelor-open-suite/pull/6176", "timeline": [{"oid": "2aad155686cdd1d6da14f197a0d38d80b959be4a", "url": "https://github.com/axelor/axelor-open-suite/commit/2aad155686cdd1d6da14f197a0d38d80b959be4a", "message": "Anomaly #33519: Broken import from geonames", "committedDate": "2020-12-15T06:03:05Z", "type": "forcePushed"}, {"oid": "646147744e3f43bea96d80e14e72a5e198ef3645", "url": "https://github.com/axelor/axelor-open-suite/commit/646147744e3f43bea96d80e14e72a5e198ef3645", "message": "Anomaly #33519: Broken import from geonames", "committedDate": "2020-12-15T08:47:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk2NTYyMA==", "url": "https://github.com/axelor/axelor-open-suite/pull/6176#discussion_r544965620", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t   \t<string name=\"geoNamesUrl\" title=\"Geo names url\"/>\n          \n          \n            \n            \t   \t<string name=\"geoNamesUrl\" title=\"GeoNames URL\"/>\n          \n      \n    \n    \n  \n\nDon't forget to regenerate i18n", "author": "dtr-axelor", "createdAt": "2020-12-17T10:08:48Z", "path": "axelor-base/src/main/resources/domains/AppBase.xml", "diffHunk": "@@ -82,6 +82,8 @@\n \t   \t<many-to-one name=\"defaultMailMessageTemplate\" title=\"Default mail message template for notifications\" ref=\"com.axelor.apps.message.db.Template\"/>\n \n \t   \t<one-to-many name=\"mailTemplateAssociationList\" title=\"Email template list for notifications\" ref=\"com.axelor.apps.base.db.MailTemplateAssociation\"/>\n+\t   \t<string name=\"geoNamesUrl\" title=\"Geo names url\"/>", "originalCommit": "646147744e3f43bea96d80e14e72a5e198ef3645", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk2NjI2Ng==", "url": "https://github.com/axelor/axelor-open-suite/pull/6176#discussion_r544966266", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t<panel name=\"geonamesPanel\" title=\"Geonames\"  colSpan=\"12\">\n          \n          \n            \n            \t\t\t\t<panel name=\"geoNamesPanel\" title=\"GeoNames\" colSpan=\"12\">", "author": "dtr-axelor", "createdAt": "2020-12-17T10:09:45Z", "path": "axelor-base/src/main/resources/views/AppBase.xml", "diffHunk": "@@ -69,6 +69,11 @@\n \t\t\t\t<panel name=\"wsPanel\" title=\"Webservices\"  colSpan=\"12\">\n \t\t\t\t\t<field name=\"currencyWsURL\" colSpan=\"12\"/>\n \t\t\t\t</panel>\n+\t\t\t\t\n+\t\t\t\t<panel name=\"geonamesPanel\" title=\"Geonames\"  colSpan=\"12\">", "originalCommit": "646147744e3f43bea96d80e14e72a5e198ef3645", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d32d16470a41d5b498005357e36ae2944ad8fc26", "url": "https://github.com/axelor/axelor-open-suite/commit/d32d16470a41d5b498005357e36ae2944ad8fc26", "message": "Anomaly #33519: Broken import from geonames", "committedDate": "2020-12-17T12:10:56Z", "type": "forcePushed"}, {"oid": "67c86f9a65a6f976c85032f0e7be2a37fd05bd07", "url": "https://github.com/axelor/axelor-open-suite/commit/67c86f9a65a6f976c85032f0e7be2a37fd05bd07", "message": "Anomaly #33519: Broken import from geonames", "committedDate": "2020-12-21T11:38:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njc1Mzg0MQ==", "url": "https://github.com/axelor/axelor-open-suite/pull/6176#discussion_r546753841", "bodyText": "There are several occurrences of this delimiter. You should create a constant for it.", "author": "dtr-axelor", "createdAt": "2020-12-21T15:00:52Z", "path": "axelor-base/src/main/java/com/axelor/apps/base/service/imports/ImportCityServiceImpl.java", "diffHunk": "@@ -278,4 +296,92 @@ private MetaFile extractCityZip(MetaFile dataFile) throws Exception {\n \n     return metaFile;\n   }\n+\n+  private StringBuilder extractDataFromDownloadedFile(BufferedReader downloadedCityFileStream)\n+      throws IOException {\n+\n+    HashMap<String, String> regionMap = new HashMap<>();\n+    HashMap<String, String> departmentMap = new HashMap<>();\n+    HashMap<String, String> cantonMap = new HashMap<>();\n+    List<String> cityList = new ArrayList<>();\n+\n+    String line;\n+\n+    while ((line = downloadedCityFileStream.readLine()) != null) {\n+      String[] values = line.split(\"\\t\");", "originalCommit": "67c86f9a65a6f976c85032f0e7be2a37fd05bd07", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njc1NTU0Mg==", "url": "https://github.com/axelor/axelor-open-suite/pull/6176#discussion_r546755542", "bodyText": "All these constants should be protected instead of public.", "author": "dtr-axelor", "createdAt": "2020-12-21T15:03:53Z", "path": "axelor-base/src/main/java/com/axelor/apps/base/service/imports/ImportCityServiceImpl.java", "diffHunk": "@@ -53,9 +62,21 @@\n \n   @Inject private MetaFiles metaFiles;\n \n-  public static String CITYTEXTFILE = \"cityTextFile.txt\";\n+  public static final String CITYTEXTFILE = \"cityTextFile.txt\";\n \n-  public static String DOWNLOAD_LINK = \"http://download.geonames.org/export/zip/\";\n+  public static final String FEATURE_CLASS_FOR_CANTON_REGION_DEPARTMENT = \"A\";\n+\n+  public static final String FEATURE_CLASS_FOR_CITY = \"P\";\n+\n+  public static final String FEATURE_CLASS_CODE_FOR_CANTON = \"ADM3\";\n+\n+  public static final String FEATURE_CLASS_CODE_FOR_REGION = \"ADM1\";\n+\n+  public static final String FEATURE_CLASS_CODE_FOR_DEPARTMENT = \"ADM2\";\n+\n+  public static final String FEATURE_CLASS_CODE_FOR_CITY = \"ADM4\";\n+\n+  public static final String CITY_NO_LONGER_EXIST_CODE = \"PPLH\";", "originalCommit": "67c86f9a65a6f976c85032f0e7be2a37fd05bd07", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "440b29fbc5b932c78d07e3278d971f0118f68e4b", "url": "https://github.com/axelor/axelor-open-suite/commit/440b29fbc5b932c78d07e3278d971f0118f68e4b", "message": "Anomaly #33519: Broken import from geonames", "committedDate": "2020-12-22T10:46:14Z", "type": "forcePushed"}, {"oid": "9bc8abd2b6b2f3fff09df08670d4b4f54133c931", "url": "https://github.com/axelor/axelor-open-suite/commit/9bc8abd2b6b2f3fff09df08670d4b4f54133c931", "message": "Anomaly #33519: Broken import from geonames", "committedDate": "2020-12-22T10:50:21Z", "type": "forcePushed"}, {"oid": "48a8cd97e7a4194e66b6b08abb21afbeee95fcdb", "url": "https://github.com/axelor/axelor-open-suite/commit/48a8cd97e7a4194e66b6b08abb21afbeee95fcdb", "message": "Anomaly #33519: Broken import from geonames", "committedDate": "2020-12-23T04:59:22Z", "type": "commit"}, {"oid": "48a8cd97e7a4194e66b6b08abb21afbeee95fcdb", "url": "https://github.com/axelor/axelor-open-suite/commit/48a8cd97e7a4194e66b6b08abb21afbeee95fcdb", "message": "Anomaly #33519: Broken import from geonames", "committedDate": "2020-12-23T04:59:22Z", "type": "forcePushed"}]}