{"pr_number": 5351, "pr_title": "RM27523 : Add inventory valuation config", "pr_createdAt": "2020-04-22T10:30:29Z", "pr_url": "https://github.com/axelor/axelor-open-suite/pull/5351", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYzNzkwOA==", "url": "https://github.com/axelor/axelor-open-suite/pull/5351#discussion_r414637908", "bodyText": "Please compare selection value to static constant", "author": "ale-axelor", "createdAt": "2020-04-24T14:52:24Z", "path": "axelor-stock/src/main/java/com/axelor/apps/stock/service/InventoryLineService.java", "diffHunk": "@@ -101,10 +100,28 @@ public InventoryLine compute(InventoryLine inventoryLine, Inventory inventory) {\n               : BigDecimal.ZERO;\n       inventoryLine.setGap(gap);\n \n+      BigDecimal price;\n+      int value = stockLocation.getCompany().getStockConfig().getInventoryValuationTypeSelect();\n+      if (value == 2) {", "originalCommit": "bee84abe1dac0b200995b32511b30417c42b9e43", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYzODc4Nw==", "url": "https://github.com/axelor/axelor-open-suite/pull/5351#discussion_r414638787", "bodyText": "do not comment out code, simply remove it.", "author": "ale-axelor", "createdAt": "2020-04-24T14:53:34Z", "path": "axelor-stock/src/main/java/com/axelor/apps/stock/service/InventoryLineService.java", "diffHunk": "@@ -101,10 +100,28 @@ public InventoryLine compute(InventoryLine inventoryLine, Inventory inventory) {\n               : BigDecimal.ZERO;\n       inventoryLine.setGap(gap);\n \n+      BigDecimal price;\n+      int value = stockLocation.getCompany().getStockConfig().getInventoryValuationTypeSelect();\n+      if (value == 2) {\n+        price = product.getSalePrice();\n+      } else if (value == 3) {\n+        price = product.getCostPrice();\n+      } else {\n+        price = product.getAvgPrice();\n+      }\n+      inventoryLine.setGapValue(gap.multiply(price).setScale(2, RoundingMode.HALF_EVEN));\n+      inventoryLine.setRealValue(\n+          inventoryLine.getRealQty() != null\n+              ? inventoryLine.getRealQty().multiply(price).setScale(2, RoundingMode.HALF_EVEN)\n+              : BigDecimal.ZERO\n+      );\n+\n+      /*StockLocationLine stockLocationLine =\n+              Beans.get(StockLocationLineService.class).getStockLocationLine(stockLocation, product);\n       if (stockLocationLine != null) {\n         inventoryLine.setGapValue(\n             stockLocationLine.getAvgPrice().multiply(gap).setScale(2, RoundingMode.HALF_EVEN));\n-      }\n+      }*/", "originalCommit": "bee84abe1dac0b200995b32511b30417c42b9e43", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ee16370140064383ede7d7504d2da5e922a59447", "url": "https://github.com/axelor/axelor-open-suite/commit/ee16370140064383ede7d7504d2da5e922a59447", "message": "RM27523 : Add inventory valuation config", "committedDate": "2020-04-27T07:36:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY1ODg1OA==", "url": "https://github.com/axelor/axelor-open-suite/pull/5351#discussion_r485658858", "bodyText": "I think sale price should be chosen if we value using sale.", "author": "ale-axelor", "createdAt": "2020-09-09T14:30:55Z", "path": "axelor-stock/src/main/java/com/axelor/apps/stock/service/InventoryLineService.java", "diffHunk": "@@ -101,10 +102,21 @@ public InventoryLine compute(InventoryLine inventoryLine, Inventory inventory) {\n               : BigDecimal.ZERO;\n       inventoryLine.setGap(gap);\n \n-      if (stockLocationLine != null) {\n-        inventoryLine.setGapValue(\n-            stockLocationLine.getAvgPrice().multiply(gap).setScale(2, RoundingMode.HALF_EVEN));\n+      BigDecimal price;\n+      int value = stockLocation.getCompany().getStockConfig().getInventoryValuationTypeSelect();\n+      if (value == StockConfigRepository.VALUATION_TYPE_ACCOUNTING_VALUE) {", "originalCommit": "ee16370140064383ede7d7504d2da5e922a59447", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2cc44d069ed7667c4f6dda7f069d7467588b8eb1", "url": "https://github.com/axelor/axelor-open-suite/commit/2cc44d069ed7667c4f6dda7f069d7467588b8eb1", "message": "Add github workflow", "committedDate": "2020-09-16T15:33:11Z", "type": "commit"}, {"oid": "7429320151cb9f1d871a50abf00b5ada8c4218f8", "url": "https://github.com/axelor/axelor-open-suite/commit/7429320151cb9f1d871a50abf00b5ada8c4218f8", "message": "Anomaly RM#31259 - Fix NPE when invoice has interco enabled and invoiceLine not having product", "committedDate": "2020-09-17T04:58:18Z", "type": "commit"}, {"oid": "a76f97b3b99c4946a83a955574054b0c51cfc223", "url": "https://github.com/axelor/axelor-open-suite/commit/a76f97b3b99c4946a83a955574054b0c51cfc223", "message": "Code format fix", "committedDate": "2020-09-17T05:03:02Z", "type": "commit"}, {"oid": "57528be290c75e61005e36d009b33d0334b9e1af", "url": "https://github.com/axelor/axelor-open-suite/commit/57528be290c75e61005e36d009b33d0334b9e1af", "message": "Anomaly RM#31300 TEAM : sale order and partner", "committedDate": "2020-09-18T09:48:07Z", "type": "commit"}, {"oid": "c35695c6f43e4732f158c30b817441fe77cdc8a3", "url": "https://github.com/axelor/axelor-open-suite/commit/c35695c6f43e4732f158c30b817441fe77cdc8a3", "message": "RM27523 : Add inventory valuation config", "committedDate": "2020-09-21T09:15:30Z", "type": "commit"}, {"oid": "c35695c6f43e4732f158c30b817441fe77cdc8a3", "url": "https://github.com/axelor/axelor-open-suite/commit/c35695c6f43e4732f158c30b817441fe77cdc8a3", "message": "RM27523 : Add inventory valuation config", "committedDate": "2020-09-21T09:15:30Z", "type": "forcePushed"}, {"oid": "64defd3a722049f6e26a9f8d044802dc2abe81ae", "url": "https://github.com/axelor/axelor-open-suite/commit/64defd3a722049f6e26a9f8d044802dc2abe81ae", "message": "Merge branch '5.3-dev' into dev-27523", "committedDate": "2020-09-24T07:28:16Z", "type": "forcePushed"}, {"oid": "bc312a6ac3eca6aa298fae6304f74d5f4b65b93f", "url": "https://github.com/axelor/axelor-open-suite/commit/bc312a6ac3eca6aa298fae6304f74d5f4b65b93f", "message": "Merge branch '5.3-dev' into dev-27523", "committedDate": "2020-09-30T08:50:04Z", "type": "forcePushed"}, {"oid": "56c2ac8b3c4ac0b786d657207e2a8028578db369", "url": "https://github.com/axelor/axelor-open-suite/commit/56c2ac8b3c4ac0b786d657207e2a8028578db369", "message": "Merge branch '5.3-dev' into dev-27523", "committedDate": "2020-09-30T09:38:56Z", "type": "commit"}, {"oid": "56c2ac8b3c4ac0b786d657207e2a8028578db369", "url": "https://github.com/axelor/axelor-open-suite/commit/56c2ac8b3c4ac0b786d657207e2a8028578db369", "message": "Merge branch '5.3-dev' into dev-27523", "committedDate": "2020-09-30T09:38:56Z", "type": "forcePushed"}, {"oid": "6bdd18342e1cad90c53d98b39de0b36c25aa9b42", "url": "https://github.com/axelor/axelor-open-suite/commit/6bdd18342e1cad90c53d98b39de0b36c25aa9b42", "message": "Merge branch 'dev' into dev-27523", "committedDate": "2020-11-04T08:54:59Z", "type": "commit"}]}