{"pr_number": 10578, "pr_title": "Remove old processor detection code on Z", "pr_createdAt": "2020-09-11T20:37:06Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10578", "timeline": [{"oid": "f18065ad8e8cc22b967fa953ac61d19610a0907a", "url": "https://github.com/eclipse-openj9/openj9/commit/f18065ad8e8cc22b967fa953ac61d19610a0907a", "message": "Remove old processor detection code on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-11T21:30:15Z", "type": "forcePushed"}, {"oid": "ee6204fe53153d3ace4d71a6018e69c79d80092b", "url": "https://github.com/eclipse-openj9/openj9/commit/ee6204fe53153d3ace4d71a6018e69c79d80092b", "message": "Remove old processor detection code on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-11T21:36:04Z", "type": "forcePushed"}, {"oid": "4ec45619ee72c9469ea2b8eb7bb384992af7f35c", "url": "https://github.com/eclipse-openj9/openj9/commit/4ec45619ee72c9469ea2b8eb7bb384992af7f35c", "message": "Remove old processor detection code on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-11T21:52:33Z", "type": "forcePushed"}, {"oid": "73db8443e2b8331282a1658aec585d2bd0fac154", "url": "https://github.com/eclipse-openj9/openj9/commit/73db8443e2b8331282a1658aec585d2bd0fac154", "message": "Remove old processor detection code on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-11T22:19:57Z", "type": "commit"}, {"oid": "73db8443e2b8331282a1658aec585d2bd0fac154", "url": "https://github.com/eclipse-openj9/openj9/commit/73db8443e2b8331282a1658aec585d2bd0fac154", "message": "Remove old processor detection code on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-11T22:19:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA2MzM4Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/10578#discussion_r488063383", "bodyText": "So where are things initialized now? Is it in OMR?", "author": "fjeremic", "createdAt": "2020-09-14T16:25:08Z", "path": "runtime/compiler/env/ProcessorDetection.cpp", "diffHunk": "@@ -653,62 +653,12 @@ TR_J9VM::initializeProcessorType()\n    if (TR::Compiler->target.cpu.isZ())\n       {\n #if defined(TR_HOST_S390)\n-      initializeS390ProcessorFeatures();\n-\n #if defined(J9ZOS390)\n       // Cache whether current process is running in Supervisor State (i.e. Control Region of WAS).", "originalCommit": "73db8443e2b8331282a1658aec585d2bd0fac154", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA2NjkwMw==", "url": "https://github.com/eclipse-openj9/openj9/pull/10578#discussion_r488066903", "bodyText": "Step 1. OMR detects and initializes the CPU using omr port library.\nvoid\nOMR::CompilerEnv::initializeHostEnvironment()\n   {\n\n   // Host processor bitness\n   //\n#ifdef TR_HOST_64BIT\n   host.setBitness(TR::bits_64);\n#elif TR_HOST_32BIT\n   host.setBitness(TR::bits_32);\n#else\n   host.setBitness(TR::bits_unknown);\n#endif\n\n   // Initialize the host CPU by querying the host processor\n   //\n   host.cpu = TR::CPU::detect(TR::Compiler->omrPortLib);\nStep 2. OpenJ9 calls J9::Z::CPU::applyUserOptions() to apply command line options from user and initialize the J9-specific features that couldn't be done in OMR.\nvoid\nTR_J9VM::initializeProcessorType()\n   {\n   TR_ASSERT(_compInfo,\"compInfo not defined\");\n   TR::Compiler->target.cpu.applyUserOptions();", "author": "harryyu1994", "createdAt": "2020-09-14T16:30:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA2MzM4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA2NzYwNQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10578#discussion_r488067605", "bodyText": "applyUserOptions() mirrors the things that were done in initializeS390ProcessorFeatures()", "author": "harryyu1994", "createdAt": "2020-09-14T16:32:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA2MzM4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA2ODc0NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10578#discussion_r488068745", "bodyText": "Thanks for the explanation! Leaving this as unresolved for future reference. We'll wait until the OMR change has propagated.", "author": "fjeremic", "createdAt": "2020-09-14T16:34:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA2MzM4Mw=="}], "type": "inlineReview"}, {"oid": "5817a8e3e544a6c44b656c534729c8f367f5504d", "url": "https://github.com/eclipse-openj9/openj9/commit/5817a8e3e544a6c44b656c534729c8f367f5504d", "message": "Replace old version CPU detection API with new version for verbose log\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-14T19:52:51Z", "type": "commit"}, {"oid": "5817a8e3e544a6c44b656c534729c8f367f5504d", "url": "https://github.com/eclipse-openj9/openj9/commit/5817a8e3e544a6c44b656c534729c8f367f5504d", "message": "Replace old version CPU detection API with new version for verbose log\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-14T19:52:51Z", "type": "forcePushed"}]}