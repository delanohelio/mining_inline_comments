{"pr_number": 10410, "pr_title": "Avoid the static initialization of class in getCPMethodHandleAt", "pr_createdAt": "2020-08-18T18:38:46Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10410", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQwODIxMw==", "url": "https://github.com/eclipse-openj9/openj9/pull/10410#discussion_r472408213", "bodyText": "Bit of a nitpick - I'd leave the line long here rather than trying to figure out the \"right\" level of indent for the second line of parameters\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\tmethodHandleObject = vmFunctions->resolveMethodHandleRef(vmThread, J9_CP_FROM_CLASS(ramClass), cpIndex,\n          \n          \n            \n            \t\t\t\t\t\t\t\t\t\tJ9_RESOLVE_FLAG_RUNTIME_RESOLVE | J9_RESOLVE_FLAG_NO_CLASS_INIT);\n          \n          \n            \n            \t\t\t\tmethodHandleObject = vmFunctions->resolveMethodHandleRef(vmThread, J9_CP_FROM_CLASS(ramClass), cpIndex, J9_RESOLVE_FLAG_RUNTIME_RESOLVE | J9_RESOLVE_FLAG_NO_CLASS_INIT);", "author": "DanHeidinga", "createdAt": "2020-08-18T18:48:12Z", "path": "runtime/jcl/common/sun_reflect_ConstantPool.c", "diffHunk": "@@ -752,7 +752,11 @@ Java_java_lang_invoke_MethodHandle_getCPMethodHandleAt(JNIEnv *env, jclass unuse\n \t\t\tj9object_t methodHandleObject = J9STATIC_OBJECT_LOAD(vmThread, ramClass, &ramMethodHandleRef->methodHandle);\n \n \t\t\tif (NULL == methodHandleObject) {\n-\t\t\t\tmethodHandleObject = vmFunctions->resolveMethodHandleRef(vmThread, J9_CP_FROM_CLASS(ramClass), cpIndex, J9_RESOLVE_FLAG_RUNTIME_RESOLVE);\n+\t\t\t\t/* Avoid initializing the class from there so as to postpone the static initialization\n+\t\t\t\t * to the invocation of the specified method of the class.\n+\t\t\t\t */\n+\t\t\t\tmethodHandleObject = vmFunctions->resolveMethodHandleRef(vmThread, J9_CP_FROM_CLASS(ramClass), cpIndex,\n+\t\t\t\t\t\t\t\t\t\tJ9_RESOLVE_FLAG_RUNTIME_RESOLVE | J9_RESOLVE_FLAG_NO_CLASS_INIT);", "originalCommit": "960d8e8e15134c1c951f5ab44d0a1427b8d8a4bd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQxMTUwMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10410#discussion_r472411501", "bodyText": "Agreed and restored it back to the original line.", "author": "ChengJin01", "createdAt": "2020-08-18T18:54:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQwODIxMw=="}], "type": "inlineReview"}, {"oid": "ac3cd7299d79258701a88196600e6fa3c42a0021", "url": "https://github.com/eclipse-openj9/openj9/commit/ac3cd7299d79258701a88196600e6fa3c42a0021", "message": "Avoid the static initialization of class in getCPMethodHandleAt\n\nThe change is to avoid initializing the specified class\nin getCPMethodHandleAt so as to postpone the static\ninitialization to the invocation of the method of this class.\n\nFixes: #10356\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-08-18T18:53:15Z", "type": "commit"}, {"oid": "ac3cd7299d79258701a88196600e6fa3c42a0021", "url": "https://github.com/eclipse-openj9/openj9/commit/ac3cd7299d79258701a88196600e6fa3c42a0021", "message": "Avoid the static initialization of class in getCPMethodHandleAt\n\nThe change is to avoid initializing the specified class\nin getCPMethodHandleAt so as to postpone the static\ninitialization to the invocation of the method of this class.\n\nFixes: #10356\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-08-18T18:53:15Z", "type": "forcePushed"}]}