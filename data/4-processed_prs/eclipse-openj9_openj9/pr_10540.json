{"pr_number": 10540, "pr_title": "Add a flag named J9VM_OPT_OPENJDK_METHODHANDLE", "pr_createdAt": "2020-09-08T20:21:28Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10540", "timeline": [{"oid": "4bff5941115f792ea67b57e14a45e39e4919cf8f", "url": "https://github.com/eclipse-openj9/openj9/commit/4bff5941115f792ea67b57e14a45e39e4919cf8f", "message": "Add a flag named J9VM_OPT_OPENJDK_METHODHANDLE for CMake builds\n\nThis flag will enable OpenJDK MethodHandles. J9VM_OPT_METHOD_HANDLE\nneeds to disabled before enabling J9VM_OPT_OPENJDK_METHODHANDLE, and\nvice-versa.\n\nCo-authored-by: Jack Lu <Jack.S.Lu@ibm.com>\n\nSigned-off-by: Babneet Singh <sbabneet@ca.ibm.com>", "committedDate": "2020-09-08T20:29:34Z", "type": "forcePushed"}, {"oid": "85c875c7629a96fbab0bb47eabe5caa93f68ebb5", "url": "https://github.com/eclipse-openj9/openj9/commit/85c875c7629a96fbab0bb47eabe5caa93f68ebb5", "message": "Add a flag named J9VM_OPT_OPENJDK_METHODHANDLE for UMA builds\n\nThis flag will enable OpenJDK MethodHandles. J9VM_OPT_METHOD_HANDLE\nneeds to disabled before enabling J9VM_OPT_OPENJDK_METHODHANDLE, and\nvice-versa.\n\nJ9VM_OPT_METHOD_HANDLE and J9VM_OPT_OPENJDK_METHODHANDLE have been moved\nto core.feature since they are enabled on all platforms.\n\nCo-authored-by: Jack Lu <Jack.S.Lu@ibm.com>\nSigned-off-by: Babneet Singh <sbabneet@ca.ibm.com>", "committedDate": "2020-09-08T20:39:53Z", "type": "commit"}, {"oid": "7752d5a0b1984d3af2131bec4bd713a97fa036a1", "url": "https://github.com/eclipse-openj9/openj9/commit/7752d5a0b1984d3af2131bec4bd713a97fa036a1", "message": "Add a flag named J9VM_OPT_OPENJDK_METHODHANDLE for CMake builds\n\nThis flag will enable OpenJDK MethodHandles. J9VM_OPT_METHOD_HANDLE\nneeds to disabled before enabling J9VM_OPT_OPENJDK_METHODHANDLE, and\nvice-versa.\n\nCo-authored-by: Jack Lu <Jack.S.Lu@ibm.com>\nSigned-off-by: Babneet Singh <sbabneet@ca.ibm.com>", "committedDate": "2020-09-08T20:40:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU4NDQ4Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/10540#discussion_r489584486", "bodyText": "Please retain sorted order of flags.", "author": "keithc-ca", "createdAt": "2020-09-16T16:54:53Z", "path": "runtime/include/j9cfg.h.in", "diffHunk": "@@ -223,6 +223,7 @@ extern \"C\" {\n #cmakedefine J9VM_OPT_JXE_LOAD_SUPPORT\n #cmakedefine J9VM_OPT_MEMORY_CHECK_SUPPORT\n #cmakedefine J9VM_OPT_METHOD_HANDLE\n+#cmakedefine J9VM_OPT_OPENJDK_METHODHANDLE", "originalCommit": "7752d5a0b1984d3af2131bec4bd713a97fa036a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYxNjg1MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10540#discussion_r489616851", "bodyText": "Retained sorted order.", "author": "babsingh", "createdAt": "2020-09-16T17:51:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU4NDQ4Ng=="}], "type": "inlineReview"}, {"oid": "02acca3d02db22f4d8f7c1d7a6be4fd70bf3ed79", "url": "https://github.com/eclipse-openj9/openj9/commit/02acca3d02db22f4d8f7c1d7a6be4fd70bf3ed79", "message": "Add a flag named J9VM_OPT_OPENJDK_METHODHANDLE for CMake builds\n\nThis flag will enable OpenJDK MethodHandles. J9VM_OPT_METHOD_HANDLE\nneeds to disabled before enabling J9VM_OPT_OPENJDK_METHODHANDLE, and\nvice-versa.\n\nCo-authored-by: Jack Lu <Jack.S.Lu@ibm.com>\nSigned-off-by: Babneet Singh <sbabneet@ca.ibm.com>", "committedDate": "2020-09-16T17:45:44Z", "type": "forcePushed"}, {"oid": "e8d2c9dec0dd7a38806be018b76e3e0ca58dc1e0", "url": "https://github.com/eclipse-openj9/openj9/commit/e8d2c9dec0dd7a38806be018b76e3e0ca58dc1e0", "message": "Add a flag named J9VM_OPT_OPENJDK_METHODHANDLE for CMake builds\n\nThis flag will enable OpenJDK MethodHandles. J9VM_OPT_METHOD_HANDLE\nneeds to disabled before enabling J9VM_OPT_OPENJDK_METHODHANDLE, and\nvice-versa.\n\nCo-authored-by: Jack Lu <Jack.S.Lu@ibm.com>\nSigned-off-by: Babneet Singh <sbabneet@ca.ibm.com>", "committedDate": "2020-09-16T17:48:36Z", "type": "commit"}, {"oid": "e8d2c9dec0dd7a38806be018b76e3e0ca58dc1e0", "url": "https://github.com/eclipse-openj9/openj9/commit/e8d2c9dec0dd7a38806be018b76e3e0ca58dc1e0", "message": "Add a flag named J9VM_OPT_OPENJDK_METHODHANDLE for CMake builds\n\nThis flag will enable OpenJDK MethodHandles. J9VM_OPT_METHOD_HANDLE\nneeds to disabled before enabling J9VM_OPT_OPENJDK_METHODHANDLE, and\nvice-versa.\n\nCo-authored-by: Jack Lu <Jack.S.Lu@ibm.com>\nSigned-off-by: Babneet Singh <sbabneet@ca.ibm.com>", "committedDate": "2020-09-16T17:48:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYxNDQ3OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10540#discussion_r489614478", "bodyText": "Perhaps this should be opt_openjdkMethodHandle (with a capital 'H') for consistency with opt_methodHandle?", "author": "keithc-ca", "createdAt": "2020-09-16T17:47:14Z", "path": "buildspecs/core.feature", "diffHunk": "@@ -110,8 +110,10 @@ SPDX-License-Identifier: EPL-2.0 OR Apache-2.0 OR GPL-2.0 WITH Classpath-excepti\n \t\t<flag id=\"opt_inlineJsrs\" value=\"true\"/>\n \t\t<flag id=\"opt_jitserver\" value=\"false\"/>\n \t\t<flag id=\"opt_module\" value=\"true\"/>\n+\t\t<flag id=\"opt_methodHandle\" value=\"true\"/>\n \t\t<flag id=\"opt_newObjectHash\" value=\"true\"/>\n \t\t<flag id=\"opt_newRomClassBuilder\" value=\"true\"/>\n+\t\t<flag id=\"opt_openjdkMethodhandle\" value=\"false\"/>", "originalCommit": "02acca3d02db22f4d8f7c1d7a6be4fd70bf3ed79", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYyMzE1Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/10540#discussion_r489623153", "bodyText": "This syntax is already being used by 4+ developers across their branches. Worried that it may be a hassle for them to update it across all their changes. Also, the JPP tag is OPENJDK_METHODHANDLES, which has been merged. There is already inconsistency w.r.t. OPENJDK_METHODHANDLES. I would let the name stay as-is since we are prioritizing on functional completion.", "author": "babsingh", "createdAt": "2020-09-16T18:02:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYxNDQ3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYzMjQ1NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10540#discussion_r489632454", "bodyText": "Fair enough.", "author": "keithc-ca", "createdAt": "2020-09-16T18:19:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYxNDQ3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYxNTgwOA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10540#discussion_r489615808", "bodyText": "Is there code somewhere that will yield an error if both J9VM_OPT_METHOD_HANDLE and J9VM_OPT_OPENJDK_METHODHANDLE are enabled? Same question for UMA builds?", "author": "keithc-ca", "createdAt": "2020-09-16T17:49:37Z", "path": "runtime/cmake/options.cmake", "diffHunk": "@@ -132,9 +132,10 @@ option(J9VM_OPT_FRAGMENT_RAM_CLASSES \"Transitional flag for the the GC during th\n option(J9VM_OPT_JVMTI \"Support for the JVMTI interface\")\n option(J9VM_OPT_JXE_LOAD_SUPPORT \"Controls if main will allow -jxe: and relocate the disk image for you.\")\n \n-option(J9VM_OPT_METHOD_HANDLE \"Turns on methodhandle support\")\n+option(J9VM_OPT_METHOD_HANDLE \"Enables support for OpenJ9 MethodHandles. J9VM_OPT_OPENJDK_METHODHANDLE should be disabled.\")\n option(J9VM_OPT_MODULE \"Turns on module support\")\n option(J9VM_OPT_MULTI_VM \"Decides if multiple VMs can be created in the same address space\")\n+option(J9VM_OPT_OPENJDK_METHODHANDLE \"Enables support for OpenJDK MethodHandles. J9VM_OPT_METHOD_HANDLE should be disabled.\")", "originalCommit": "e8d2c9dec0dd7a38806be018b76e3e0ca58dc1e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYxODI0Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/10540#discussion_r489618246", "bodyText": "No. Do you have examples where such error-checks were introduced?", "author": "babsingh", "createdAt": "2020-09-16T17:53:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYxNTgwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYzMTg2Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/10540#discussion_r489631866", "bodyText": "On second thought, perhaps it's not worth worrying about; the code in OpenJ9.gmk in the extension repos won't permit that situation.", "author": "keithc-ca", "createdAt": "2020-09-16T18:18:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYxNTgwOA=="}], "type": "inlineReview"}]}