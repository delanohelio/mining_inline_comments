{"pr_number": 9158, "pr_title": "Clear peeking ilgen callNode from callsite", "pr_createdAt": "2020-04-07T15:09:37Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/9158", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTAxMzA2MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9158#discussion_r405013061", "bodyText": "I can see why you moved this out, but I worry that with such a common/simple name that is often used in loops we may get some weird interactions - could we just leave the int i inside and just add the extra call to callNode->getByteCodeIndex(). If we did want to pull it up we would need a better name IMO, but I don't think we want to consider a rename right now - just keep the scope as it was would be safest.", "author": "andrewcraik", "createdAt": "2020-04-07T18:11:25Z", "path": "runtime/compiler/optimizer/J9EstimateCodeSize.cpp", "diffHunk": "@@ -1239,9 +1239,10 @@ TR_J9EstimateCodeSize::realEstimateCodeSize(TR_CallTarget *calltarget, TR_CallSt\n             TR::Node* parent = tt->getNode();\n             TR::Node* callNode = tt->getNode()->getFirstChild();\n             TR::SymbolReference* symRef =  callNode->getSymbolReference();\n-            if (!callNode->getSymbolReference()->isUnresolved() && !visited.contains(callNode))\n+            int i = callNode->getByteCodeIndex();", "originalCommit": "e9823555c0901ae702116e050da4ea8cde3cd84e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTAyNTE5Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/9158#discussion_r405025193", "bodyText": "changed as suggested.", "author": "cathyzhyi", "createdAt": "2020-04-07T18:31:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTAxMzA2MQ=="}], "type": "inlineReview"}, {"oid": "25184bfe02661a17167cc2de8b0208e34ca8ea9f", "url": "https://github.com/eclipse-openj9/openj9/commit/25184bfe02661a17167cc2de8b0208e34ca8ea9f", "message": "Clear peeking ilgen callNode from callsite\n\nThe callNode generated from peeking ilgen is used to create the\ncallsite of appropriate type and check for targets. Set it to NULL when\nboth are done so that inliner code can reliably figure out whether the\ncallsite has been updated with proper ilgen callNode or not.\n\nSigned-off-by: Yi Zhang <yizhang@ca.ibm.com>", "committedDate": "2020-04-07T18:33:27Z", "type": "commit"}, {"oid": "25184bfe02661a17167cc2de8b0208e34ca8ea9f", "url": "https://github.com/eclipse-openj9/openj9/commit/25184bfe02661a17167cc2de8b0208e34ca8ea9f", "message": "Clear peeking ilgen callNode from callsite\n\nThe callNode generated from peeking ilgen is used to create the\ncallsite of appropriate type and check for targets. Set it to NULL when\nboth are done so that inliner code can reliably figure out whether the\ncallsite has been updated with proper ilgen callNode or not.\n\nSigned-off-by: Yi Zhang <yizhang@ca.ibm.com>", "committedDate": "2020-04-07T18:33:27Z", "type": "forcePushed"}]}