{"pr_number": 10153, "pr_title": "CMake: Update flag handling on interpreter sources", "pr_createdAt": "2020-07-13T17:57:07Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10153", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA1MjMxOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10153#discussion_r461052319", "bodyText": "This doesn't apply to pLinux BE, only AIX (although pLinux BE uses gcc for the interpreter).", "author": "pshipton", "createdAt": "2020-07-27T17:28:51Z", "path": "runtime/vm/CMakeLists.txt", "diffHunk": "@@ -21,23 +21,50 @@\n ################################################################################\n \n omr_add_tracegen(j9vm.tdf)\n-j9vm_add_library(j9vm SHARED\n-\tOUTPUT_NAME j9vm${J9VM_VERSION_SUFFIX}\n+\n+set(interp_flags_to_remove) # list of flags removed when compiling the interpreter\n+set(interp_new_flags) # flags to be added when compiling the interpreter\n+\n+if(OMR_ARCH_POWER)\n+\tif(OMR_TOOLCONFIG STREQUAL \"xlc\")\n+\t\tlist(APPEND interp_flags_to_remove \"-O3\")\n+\t\tlist(APPEND interp_new_flags \"-O2\" \"-qdebug=lincomm:ptranl:tfbagg\")", "originalCommit": "8810ea447848ec7f7d3405db99ff5bef914773c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA1MjM2Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/10153#discussion_r461052367", "bodyText": "I don't think we support any Linux compiling the interpreter with xlc.", "author": "pshipton", "createdAt": "2020-07-27T17:28:55Z", "path": "runtime/vm/CMakeLists.txt", "diffHunk": "@@ -21,23 +21,50 @@\n ################################################################################\n \n omr_add_tracegen(j9vm.tdf)\n-j9vm_add_library(j9vm SHARED\n-\tOUTPUT_NAME j9vm${J9VM_VERSION_SUFFIX}\n+\n+set(interp_flags_to_remove) # list of flags removed when compiling the interpreter\n+set(interp_new_flags) # flags to be added when compiling the interpreter\n+\n+if(OMR_ARCH_POWER)\n+\tif(OMR_TOOLCONFIG STREQUAL \"xlc\")\n+\t\tlist(APPEND interp_flags_to_remove \"-O3\")\n+\t\tlist(APPEND interp_new_flags \"-O2\" \"-qdebug=lincomm:ptranl:tfbagg\")\n+\t\tif(OMR_OS_LINUX)", "originalCommit": "8810ea447848ec7f7d3405db99ff5bef914773c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTIxNDk4MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10153#discussion_r465214981", "bodyText": "It is in the codebase, although I don't know if it actually works or not (https://github.com/eclipse/openj9/blob/2020312e3247a65fa6e1e9dbe405d4a67f19bf62/runtime/makelib/targets.mk.ftl#L566)", "author": "dnakamura", "createdAt": "2020-08-04T17:32:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA1MjM2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTM3MDM1OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10153#discussion_r469370358", "bodyText": "We can never get to this if statement, can we?  It's enclosed in a if power && AIX check", "author": "DanHeidinga", "createdAt": "2020-08-12T16:00:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA1MjM2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4NDg3NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10153#discussion_r471584875", "bodyText": "See above comment about bracket comments.\nI decided to leave code in, along with explanation at top of if block,\nto closer reflect the uma builds", "author": "dnakamura", "createdAt": "2020-08-17T16:08:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA1MjM2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIyMjA4MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10153#discussion_r480222080", "bodyText": "Can you add a comment to explain the reason for this code to be here, and that it's commented out?  Having that expressed in the code will make it easier to understand in the future", "author": "DanHeidinga", "createdAt": "2020-08-31T15:49:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA1MjM2Nw=="}], "type": "inlineReview"}, {"oid": "1c71e0eca330b201e36cd066d98d7a02a8c3b812", "url": "https://github.com/eclipse-openj9/openj9/commit/1c71e0eca330b201e36cd066d98d7a02a8c3b812", "message": "CMake: Update flag handling on interpreter sources\n\nSigned-off-by: Devin Nakamura <devinn@ca.ibm.com>", "committedDate": "2020-08-10T17:12:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTM2OTUzNw==", "url": "https://github.com/eclipse-openj9/openj9/pull/10153#discussion_r469369537", "bodyText": "This is commented but the closing ]] aren't.  Am I missing something about the cmake syntax?", "author": "DanHeidinga", "createdAt": "2020-08-12T15:59:31Z", "path": "runtime/vm/CMakeLists.txt", "diffHunk": "@@ -21,23 +21,54 @@\n ################################################################################\n \n omr_add_tracegen(j9vm.tdf)\n-j9vm_add_library(j9vm SHARED\n-\tOUTPUT_NAME j9vm${J9VM_VERSION_SUFFIX}\n+\n+set(interp_flags_to_remove) # list of flags removed when compiling the interpreter\n+set(interp_new_flags) # flags to be added when compiling the interpreter\n+\n+# Note: the uma makefiles also specify this for pLinux, however it appears we no longer\n+# support building the interpreter with xlc on linux\n+if(OMR_ARCH_POWER AND OMR_OS_AIX)\n+\tif(OMR_TOOLCONFIG STREQUAL \"xlc\")\n+\t\tlist(APPEND interp_flags_to_remove \"-O3\")\n+\t\tlist(APPEND interp_new_flags \"-O2\" \"-qdebug=lincomm:ptranl:tfbagg\")\n+\t\t#[[", "originalCommit": "1c71e0eca330b201e36cd066d98d7a02a8c3b812", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4Mjc5Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/10153#discussion_r471582796", "bodyText": "its the not often used cmake bracket comment\nhttps://cmake.org/cmake/help/v3.18/manual/cmake-language.7.html#bracket-comment", "author": "dnakamura", "createdAt": "2020-08-17T16:05:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTM2OTUzNw=="}], "type": "inlineReview"}, {"oid": "2270d6d53a56d36e25ad782cb96c22cbe7678725", "url": "https://github.com/eclipse-openj9/openj9/commit/2270d6d53a56d36e25ad782cb96c22cbe7678725", "message": "CMake: Update flag handling on interpreter sources\n\nSigned-off-by: Devin Nakamura <devinn@ca.ibm.com>", "committedDate": "2020-08-31T15:26:35Z", "type": "forcePushed"}, {"oid": "2c50ff509bb51cee8e42e0299158df214f526266", "url": "https://github.com/eclipse-openj9/openj9/commit/2c50ff509bb51cee8e42e0299158df214f526266", "message": "CMake: Update flag handling on interpreter sources\n\nSigned-off-by: Devin Nakamura <devinn@ca.ibm.com>", "committedDate": "2020-08-31T17:19:51Z", "type": "commit"}, {"oid": "2c50ff509bb51cee8e42e0299158df214f526266", "url": "https://github.com/eclipse-openj9/openj9/commit/2c50ff509bb51cee8e42e0299158df214f526266", "message": "CMake: Update flag handling on interpreter sources\n\nSigned-off-by: Devin Nakamura <devinn@ca.ibm.com>", "committedDate": "2020-08-31T17:19:51Z", "type": "forcePushed"}]}