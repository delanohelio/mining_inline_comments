{"pr_number": 10469, "pr_title": "Set build variables on the node instead of setup node", "pr_createdAt": "2020-08-27T14:27:00Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10469", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2MDIyMA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10469#discussion_r478560220", "bodyText": "This only gets executed on the nodes themselves correct, not on master?", "author": "jdekonin", "createdAt": "2020-08-27T16:52:01Z", "path": "buildenv/jenkins/common/variables-functions.groovy", "diffHunk": "@@ -1436,4 +1433,31 @@ def create_job(JOB_NAME, SDK_VERSION, SPEC, downstreamJobType, id) {\n         3, 120)\n }\n \n+def set_build_variables_per_node() {", "originalCommit": "d0f6fe7111922b6a8403e494c668a5dfdb8e26c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2MTkxMg==", "url": "https://github.com/eclipse-openj9/openj9/pull/10469#discussion_r478561912", "bodyText": "To answer my own question based on a review of your PR build, yes it only executes on the node in the build job, not the higher level pipeline jobs.", "author": "jdekonin", "createdAt": "2020-08-27T16:55:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2MDIyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2MjAxNg==", "url": "https://github.com/eclipse-openj9/openj9/pull/10469#discussion_r478562016", "bodyText": "correct, see: https://github.com/eclipse/openj9/blob/d0f6fe7111922b6a8403e494c668a5dfdb8e26c8/buildenv/jenkins/common/build.groovy#L582", "author": "vsebe", "createdAt": "2020-08-27T16:55:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2MDIyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2NDYwMA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10469#discussion_r478564600", "bodyText": "Do we want to have a slightly more detailed message here instead of just blank?  Maybe a 'not configured for this node' to be more meaningful if its not present?", "author": "jdekonin", "createdAt": "2020-08-27T16:59:31Z", "path": "buildenv/jenkins/common/variables-functions.groovy", "diffHunk": "@@ -1436,4 +1433,31 @@ def create_job(JOB_NAME, SDK_VERSION, SPEC, downstreamJobType, id) {\n         3, 120)\n }\n \n+def set_build_variables_per_node() {\n+    BOOT_JDK = check_path(buildspec.getScalarField('boot_jdk', SDK_VERSION), true)\n+    println(\"BOOT_JDK: ${BOOT_JDK}\")\n+    if (!BOOT_JDK) {\n+        error(\"BOOT_JDK: ${BOOT_JDK} does not exist!\")\n+    }\n+\n+    def freemarkerPath = buildspec.getScalarField('freemarker', SDK_VERSION)\n+    FREEMARKER = check_path(buildspec.getScalarField('freemarker', SDK_VERSION), false)\n+    println(\"FREEMARKER: ${FREEMARKER}\")\n+    if (!FREEMARKER) {\n+        error(\"FREEMARKER: ${FREEMARKER} does not exist!\")\n+    }\n+\n+    OPENJDK_REFERENCE_REPO = check_path(buildspec.getScalarField(\"openjdk_reference_repo\", SDK_VERSION), true)\n+    println(\"OPENJDK_REFERENCE_REPO: ${OPENJDK_REFERENCE_REPO}\")", "originalCommit": "d0f6fe7111922b6a8403e494c668a5dfdb8e26c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU4MTIyMA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10469#discussion_r478581220", "bodyText": "We could add a warning, but should not stop the build.", "author": "vsebe", "createdAt": "2020-08-27T17:28:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2NDYwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYxNzcyNw==", "url": "https://github.com/eclipse-openj9/openj9/pull/10469#discussion_r478617727", "bodyText": "Agreed.  I like this change, 99% of the time nobody will notice, but for those few of us that debug to figure out why jobs (or clone) are slow this will be important information.", "author": "jdekonin", "createdAt": "2020-08-27T18:34:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2NDYwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYxOTI4MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10469#discussion_r478619281", "bodyText": "I added a message The git cache OPENJDK_REFERENCE_REPO: <path or null> does not exist on <node name>! (see L1453 below).\nIt will output:\n\npath does not exist\n\n14:19:29  OPENJDK_REFERENCE_REPO: \n[Pipeline] echo\n14:19:29  The git cache OPENJDK_REFERENCE_REPO: ${HOME}/openjdk_cache_x does not exist on fyrec51l!\n\n\npath not set (openjdk_reference_repo not set in variables file)\n\n14:27:31  OPENJDK_REFERENCE_REPO: null\n[Pipeline] echo\n14:27:31  The git cache OPENJDK_REFERENCE_REPO: null does not exist on fyrec51g!", "author": "vsebe", "createdAt": "2020-08-27T18:37:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2NDYwMA=="}], "type": "inlineReview"}, {"oid": "8445514c2164b365c5d024157898cde096705c09", "url": "https://github.com/eclipse-openj9/openj9/commit/8445514c2164b365c5d024157898cde096705c09", "message": "Set build variables on the node instead of setup node\n\nSet freemarkers, boot_jdk and git cache on the node for correct\ninterpolation and update commands accordingly.\nCheck if locations exist.\n\n[ci skip]\n\nSigned-off-by: Violeta Sebe <vsebe@ca.ibm.com>", "committedDate": "2020-08-27T17:49:17Z", "type": "forcePushed"}, {"oid": "c0a75e57c9ccc60fbdb08b99499212b769bf0192", "url": "https://github.com/eclipse-openj9/openj9/commit/c0a75e57c9ccc60fbdb08b99499212b769bf0192", "message": "Set build variables on the node instead of setup node\n\nSet freemarkers, boot_jdk and git cache on the node for correct\ninterpolation and update commands accordingly.\nCheck if locations exist.\n\n[ci skip]\n\nSigned-off-by: Violeta Sebe <vsebe@ca.ibm.com>", "committedDate": "2020-08-27T18:11:56Z", "type": "forcePushed"}, {"oid": "584441beeeeb1073fbf79dff739012bc1a0ac451", "url": "https://github.com/eclipse-openj9/openj9/commit/584441beeeeb1073fbf79dff739012bc1a0ac451", "message": "Set build variables on the node instead of setup node\n\nSet freemarkers, boot_jdk and git cache on the node for correct\ninterpolation and update commands accordingly.\nCheck if locations exist.\n\n[ci skip]\n\nSigned-off-by: Violeta Sebe <vsebe@ca.ibm.com>", "committedDate": "2020-08-27T18:16:56Z", "type": "commit"}, {"oid": "584441beeeeb1073fbf79dff739012bc1a0ac451", "url": "https://github.com/eclipse-openj9/openj9/commit/584441beeeeb1073fbf79dff739012bc1a0ac451", "message": "Set build variables on the node instead of setup node\n\nSet freemarkers, boot_jdk and git cache on the node for correct\ninterpolation and update commands accordingly.\nCheck if locations exist.\n\n[ci skip]\n\nSigned-off-by: Violeta Sebe <vsebe@ca.ibm.com>", "committedDate": "2020-08-27T18:16:56Z", "type": "forcePushed"}]}