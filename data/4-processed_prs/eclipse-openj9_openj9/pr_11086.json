{"pr_number": 11086, "pr_title": "Reduce the optimization level of bcverify.c in compilation", "pr_createdAt": "2020-11-03T05:42:18Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/11086", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ0MDAyNQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11086#discussion_r516440025", "bodyText": "I don't think this should be inside the USE_PPC_GCC check, it is unrelated. Also, it should be restricted to plinux LE, unless the problem has been seen on BE (which uses a different compiler).", "author": "pshipton", "createdAt": "2020-11-03T05:54:17Z", "path": "runtime/makelib/targets.mk.linux.inc.ftl", "diffHunk": "@@ -539,6 +539,10 @@ MHInterpreterFull$(UMA_DOT_O) : MHInterpreterFull.cpp\n MHInterpreterCompressed$(UMA_DOT_O) : MHInterpreterCompressed.cpp\n \t$(PPC_GCC_CXX) $(PPC_GCC_CXXFLAGS) -c $<\n \n+# special handling bcverify.c for unexpected crash due to over-optimization in compilation\n+bcverify$(UMA_DOT_O) : bcverify.c\n+\t$(CC) $(CFLAGS) -O2 -c -o $@ $<", "originalCommit": "f92d7175414de899543a86392ffba021e40d1c6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ0MTY5Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/11086#discussion_r516441693", "bodyText": "While the problem and fix is related to using gcc, that isn't what the USE_PPC_GCC flag is about. It's about using gcc to compile the above files even when the main compiler is different (xlc).", "author": "pshipton", "createdAt": "2020-11-03T06:01:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ0MDAyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ0NTM5Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/11086#discussion_r516445396", "bodyText": "Agreed and updated the setting against the suggestion above (restricted to: ppcle64bit_linux & gcc)", "author": "ChengJin01", "createdAt": "2020-11-03T06:16:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ0MDAyNQ=="}], "type": "inlineReview"}, {"oid": "d87fdec721bc1741d717dd0f9ad2614de335b5a8", "url": "https://github.com/eclipse-openj9/openj9/commit/d87fdec721bc1741d717dd0f9ad2614de335b5a8", "message": "Reduce the optimization level of bcverify.c in compilation\n\nThe change is to reduce the optimization level in compilation\non PowerPC 64bit platform so as to avoid unexpected crash\ndue to the over-optimization on the verifier-related variables\nin creating stackmaps.\n\nFixes: #10947\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-11-03T06:15:57Z", "type": "forcePushed"}, {"oid": "9350289b165370759328f32ffa962d9c177aa082", "url": "https://github.com/eclipse-openj9/openj9/commit/9350289b165370759328f32ffa962d9c177aa082", "message": "Reduce the optimization level of bcverify.c in compilation\n\nThe change is to reduce the optimization level in compilation\non PowerPC LE 64bit platform so as to avoid unexpected crash\ndue to the over-optimization on the verifier-related variables\nin creating stackmaps.\n\nFixes: #10947\n\n[ci skip]\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-11-03T06:38:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY5NDg0NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11086#discussion_r516694844", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # special handling bcverify.c for unexpected crash due to over-optimization in compilation\n          \n          \n            \n            # special handling bcverify.c to deal with ppcle64-specific crash when compiling with gcc 7.5", "author": "DanHeidinga", "createdAt": "2020-11-03T14:12:38Z", "path": "runtime/makelib/targets.mk.linux.inc.ftl", "diffHunk": "@@ -517,6 +517,13 @@ endif\n </#if>\n \n <#if uma.spec.processor.ppc && !uma.spec.type.aix>\n+\n+<#if uma.spec.flags.env_littleEndian.enabled && uma.spec.flags.env_gcc.enabled>\n+# special handling bcverify.c for unexpected crash due to over-optimization in compilation", "originalCommit": "9350289b165370759328f32ffa962d9c177aa082", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY5NzA3Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/11086#discussion_r516697076", "bodyText": "Updated the comment against the suggestion above.", "author": "ChengJin01", "createdAt": "2020-11-03T14:15:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY5NDg0NA=="}], "type": "inlineReview"}, {"oid": "58164aeef55adeb3d472c7c877081402e3433c32", "url": "https://github.com/eclipse-openj9/openj9/commit/58164aeef55adeb3d472c7c877081402e3433c32", "message": "Reduce the optimization level of bcverify.c in compilation\n\nThe change is to reduce the optimization level in compilation\non PowerPC LE 64bit platform so as to avoid unexpected crash\ndue to the over-optimization on the verifier-related variables\nin creating stackmaps.\n\nFixes: #10947\n\n[ci skip]\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-11-03T14:14:53Z", "type": "forcePushed"}, {"oid": "669dba491c44f3de4945525e2515a80c98f640b9", "url": "https://github.com/eclipse-openj9/openj9/commit/669dba491c44f3de4945525e2515a80c98f640b9", "message": "Reduce the optimization level of bcverify.c in compilation\n\nThe change is to reduce the optimization level in compilation\non PowerPC LE 64bit platform so as to avoid unexpected crash\ndue to the over-optimization on the verifier-related variables\nin creating stackmaps.\n\nFixes: #10947\n\n[ci skip]\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-11-03T17:24:06Z", "type": "commit"}, {"oid": "669dba491c44f3de4945525e2515a80c98f640b9", "url": "https://github.com/eclipse-openj9/openj9/commit/669dba491c44f3de4945525e2515a80c98f640b9", "message": "Reduce the optimization level of bcverify.c in compilation\n\nThe change is to reduce the optimization level in compilation\non PowerPC LE 64bit platform so as to avoid unexpected crash\ndue to the over-optimization on the verifier-related variables\nin creating stackmaps.\n\nFixes: #10947\n\n[ci skip]\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-11-03T17:24:06Z", "type": "forcePushed"}]}