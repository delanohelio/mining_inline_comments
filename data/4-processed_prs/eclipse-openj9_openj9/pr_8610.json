{"pr_number": 8610, "pr_title": "Override definingClassFromCPFieldRef for JITServer", "pr_createdAt": "2020-02-19T07:34:06Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/8610", "timeline": [{"oid": "d6a6111211440e146fe7911715245ab6a6415434", "url": "https://github.com/eclipse-openj9/openj9/commit/d6a6111211440e146fe7911715245ab6a6415434", "message": "Override definingClassFromCPFieldRef for JITServer\n\ndefiningClassFromCPFieldRef is a newly introduced frontend method that\nneeds to be overridden at the server for correct functionality.\n\nFixes: #8605\n\nSigned-off-by: Marius Pirvu <mpirvu@ca.ibm.com>", "committedDate": "2020-02-19T07:30:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM1OTk1OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8610#discussion_r381359959", "bodyText": "Is there an optimization opportunity here for isStatic == false? It seems like we can call the parent class method and avoid the network.", "author": "ymanton", "createdAt": "2020-02-19T15:32:17Z", "path": "runtime/compiler/env/j9methodServer.cpp", "diffHunk": "@@ -152,6 +152,15 @@ TR_ResolvedJ9JITServerMethod::staticAttributes(TR::Compilation * comp, I_32 cpIn\n    return result;\n    }\n \n+TR_OpaqueClassBlock * \n+TR_ResolvedJ9JITServerMethod::definingClassFromCPFieldRef(TR::Compilation *comp, int32_t cpIndex, bool isStatic)\n+   {\n+   // Send a message to the client\n+   _stream->write(JITServer::MessageType::ResolvedMethod_definingClassFromCPFieldRef, _remoteMirror, cpIndex, isStatic);", "originalCommit": "d6a6111211440e146fe7911715245ab6a6415434", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ5Nzg5Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/8610#discussion_r381497896", "bodyText": "I don't understand.", "author": "mpirvu", "createdAt": "2020-02-19T19:33:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM1OTk1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTUwMjEwMA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8610#discussion_r381502100", "bodyText": "Sorry, my mistake, I thought the code in TR_ResolvedJ9Method::definingClassFromCPFieldRef() that we were trying to avoid executing on the server was inside an if (isStatic) check and that for isStatic == false we could still call the original implementation rather than going over the network, but it's not.", "author": "ymanton", "createdAt": "2020-02-19T19:41:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM1OTk1OQ=="}], "type": "inlineReview"}]}