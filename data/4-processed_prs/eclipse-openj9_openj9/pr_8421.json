{"pr_number": 8421, "pr_title": "Ability to pass extra labels to test jobs if defined in variable file", "pr_createdAt": "2020-01-27T20:44:00Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/8421", "timeline": [{"oid": "7726aa5c1eba0b39993ff86d9316f297ebe58788", "url": "https://github.com/eclipse-openj9/openj9/commit/7726aa5c1eba0b39993ff86d9316f297ebe58788", "message": "Ability to pass extra labels to test jobs if defined in variable file\n\n- Adds the ability to pass parameter LABEL_ADDITION to\n  the test pipelines when extra_test_labels is defined\n  in the variable file.\n- Refactor some of the code that initializes the test\n  targets.\n- Remove default test targets from variable file. Simplifies\n  processing of tests_targets. All builds are setup to specify\n  the test targets to run so this is unnecessary code.\n- Keep sanity and extended definition mapping to functional\n  testing respectively.\n\n[skip ci]\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>", "committedDate": "2020-01-29T16:06:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAxMTEzNQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8421#discussion_r373011135", "bodyText": "Please combine the 2 case statements, e.g. case ['sanity', 'extended'].", "author": "vsebe", "createdAt": "2020-01-30T15:18:39Z", "path": "buildenv/jenkins/common/variables-functions.groovy", "diffHunk": "@@ -637,14 +637,38 @@ def get_date() {\n }\n \n /*\n-* Set TESTS_TARGETS, indicating the level of testing\n-* and sets TEST_FLAG for all targets if defined in variable file\n+* Set TESTS_TARGETS, indicating the level of testing.\n */\n def set_test_targets() {\n-    TESTS_TARGETS = params.TESTS_TARGETS\n-    if (!TESTS_TARGETS) {\n-        // set default TESTS_TARGETS for pipeline job (fetch from variables file)\n-        TESTS_TARGETS = get_default_test_targets()\n+    TESTS_TARGETS = (params.TESTS_TARGETS) ? params.TESTS_TARGETS.trim() : \"none\"\n+    TARGET_NAMES = []\n+\n+    if (TESTS_TARGETS != 'none') {\n+        for (target in TESTS_TARGETS.replaceAll(\"\\\\s\",\"\").toLowerCase().tokenize(',')) {\n+            switch (target) {\n+                case \"sanity\":", "originalCommit": "7726aa5c1eba0b39993ff86d9316f297ebe58788", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzNjM1Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/8421#discussion_r373036356", "bodyText": "done", "author": "AdamBrousseau", "createdAt": "2020-01-30T15:58:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAxMTEzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAxNzA0Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8421#discussion_r373017047", "bodyText": "\"none\" and 'none' be consistent. As there is no no interpolation single quotes will do.", "author": "vsebe", "createdAt": "2020-01-30T15:27:55Z", "path": "buildenv/jenkins/common/variables-functions.groovy", "diffHunk": "@@ -637,14 +637,38 @@ def get_date() {\n }\n \n /*\n-* Set TESTS_TARGETS, indicating the level of testing\n-* and sets TEST_FLAG for all targets if defined in variable file\n+* Set TESTS_TARGETS, indicating the level of testing.\n */\n def set_test_targets() {\n-    TESTS_TARGETS = params.TESTS_TARGETS\n-    if (!TESTS_TARGETS) {\n-        // set default TESTS_TARGETS for pipeline job (fetch from variables file)\n-        TESTS_TARGETS = get_default_test_targets()\n+    TESTS_TARGETS = (params.TESTS_TARGETS) ? params.TESTS_TARGETS.trim() : \"none\"", "originalCommit": "7726aa5c1eba0b39993ff86d9316f297ebe58788", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzNjM5NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8421#discussion_r373036395", "bodyText": "done", "author": "AdamBrousseau", "createdAt": "2020-01-30T15:58:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAxNzA0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAyNDA1OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8421#discussion_r373024058", "bodyText": "Extra test labels can be added only in the variables file, no build parameters available. Should users be able to set them in the UI when a build is launched?", "author": "vsebe", "createdAt": "2020-01-30T15:39:22Z", "path": "buildenv/jenkins/common/variables-functions.groovy", "diffHunk": "@@ -637,14 +637,38 @@ def get_date() {\n }\n \n /*\n-* Set TESTS_TARGETS, indicating the level of testing\n-* and sets TEST_FLAG for all targets if defined in variable file\n+* Set TESTS_TARGETS, indicating the level of testing.\n */\n def set_test_targets() {\n-    TESTS_TARGETS = params.TESTS_TARGETS\n-    if (!TESTS_TARGETS) {\n-        // set default TESTS_TARGETS for pipeline job (fetch from variables file)\n-        TESTS_TARGETS = get_default_test_targets()\n+    TESTS_TARGETS = (params.TESTS_TARGETS) ? params.TESTS_TARGETS.trim() : \"none\"\n+    TARGET_NAMES = []\n+\n+    if (TESTS_TARGETS != 'none') {\n+        for (target in TESTS_TARGETS.replaceAll(\"\\\\s\",\"\").toLowerCase().tokenize(',')) {\n+            switch (target) {\n+                case \"sanity\":\n+                case \"extended\":\n+                    TARGET_NAMES.add(\"${target}.functional\")\n+                    break\n+                default:\n+                    TARGET_NAMES.add(target)\n+            }\n+        }\n+    }\n+}\n+\n+/*\n+* Set TEST_FLAG for all targets if defined in variable file.\n+* Set EXCLUDED_TESTS if defined in variable file.\n+* Set EXTRA_TEST_LABELS map if defined in variable file.\n+*/\n+def set_test_misc() {\n+    EXTRA_TEST_LABELS = [:]", "originalCommit": "7726aa5c1eba0b39993ff86d9316f297ebe58788", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzNjg1MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8421#discussion_r373036851", "bodyText": "I don't think it's a necessary use case. Can be added later if needed. Use in a grinder would be more likely.", "author": "AdamBrousseau", "createdAt": "2020-01-30T15:59:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAyNDA1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAyNjEzMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8421#discussion_r373026131", "bodyText": "TESTS_TARGETS are set by set_test_targets() function in variables-functions.groovy. This  is not necessary.", "author": "vsebe", "createdAt": "2020-01-30T15:42:36Z", "path": "buildenv/jenkins/jobs/pipelines/Pipeline-Build-Test-All.groovy", "diffHunk": "@@ -136,7 +136,7 @@ SHORT_NAMES = ['all' : ['ppc64le_linux','ppc64le_linux_xl','s390x_linux','s390x_\n echo \"Initialize all PARAMETERS...\"\n SETUP_LABEL = (params.SETUP_LABEL) ? params.SETUP_LABEL : \"worker\"\n echo \"Setup SETUP_LABEL:'${SETUP_LABEL}'\"\n-TESTS_TARGETS = (params.TESTS_TARGETS) ? params.TESTS_TARGETS : \"\"\n+TESTS_TARGETS = (params.TESTS_TARGETS) ? params.TESTS_TARGETS : \"none\"", "originalCommit": "7726aa5c1eba0b39993ff86d9316f297ebe58788", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAzNjkwNg==", "url": "https://github.com/eclipse-openj9/openj9/pull/8421#discussion_r373036906", "bodyText": "Done", "author": "AdamBrousseau", "createdAt": "2020-01-30T15:59:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAyNjEzMQ=="}], "type": "inlineReview"}, {"oid": "e6ea7307cfd7bef9679da9da40453196c52ef81c", "url": "https://github.com/eclipse-openj9/openj9/commit/e6ea7307cfd7bef9679da9da40453196c52ef81c", "message": "Ability to pass extra labels to test jobs if defined in variable file\n\n- Adds the ability to pass parameter LABEL_ADDITION to\n  the test pipelines when extra_test_labels is defined\n  in the variable file.\n- Refactor some of the code that initializes the test\n  targets.\n- Remove default test targets from variable file. Simplifies\n  processing of tests_targets. All builds are setup to specify\n  the test targets to run so this is unnecessary code.\n- Keep sanity and extended definition mapping to functional\n  testing respectively.\n\n[skip ci]\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>", "committedDate": "2020-01-30T15:58:20Z", "type": "forcePushed"}, {"oid": "fa5cbaf158f4df1d73fcd6808f318e0d015705bf", "url": "https://github.com/eclipse-openj9/openj9/commit/fa5cbaf158f4df1d73fcd6808f318e0d015705bf", "message": "Ability to pass extra labels to test jobs if defined in variable file\n\n- Adds the ability to pass parameter LABEL_ADDITION to\n  the test pipelines when extra_test_labels is defined\n  in the variable file.\n- Refactor some of the code that initializes the test\n  targets.\n- Remove default test targets from variable file. Simplifies\n  processing of tests_targets. All builds are setup to specify\n  the test targets to run so this is unnecessary code.\n- Keep sanity and extended definition mapping to functional\n  testing respectively.\n\n[skip ci]\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>", "committedDate": "2020-01-30T16:23:21Z", "type": "forcePushed"}, {"oid": "d1c6c3137975776a398f8973652f1f3234e03f0d", "url": "https://github.com/eclipse-openj9/openj9/commit/d1c6c3137975776a398f8973652f1f3234e03f0d", "message": "Ability to pass extra labels to test jobs if defined in variable file\n\n- Adds the ability to pass parameter LABEL_ADDITION to\n  the test pipelines when extra_test_labels is defined\n  in the variable file.\n- Refactor some of the code that initializes the test\n  targets.\n- Remove default test targets from variable file. Simplifies\n  processing of tests_targets. All builds are setup to specify\n  the test targets to run so this is unnecessary code.\n- Keep sanity and extended definition mapping to functional\n  testing respectively.\n\n[skip ci]\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>", "committedDate": "2020-01-30T16:24:31Z", "type": "forcePushed"}, {"oid": "c41560218dcd486619c055a0651875fe9f4f936b", "url": "https://github.com/eclipse-openj9/openj9/commit/c41560218dcd486619c055a0651875fe9f4f936b", "message": "Ability to pass extra labels to test jobs if defined in variable file\n\n- Adds the ability to pass parameter LABEL_ADDITION to\n  the test pipelines when extra_test_labels is defined\n  in the variable file.\n- Refactor some of the code that initializes the test\n  targets.\n- Remove default test targets from variable file. Simplifies\n  processing of tests_targets. All builds are setup to specify\n  the test targets to run so this is unnecessary code.\n- Keep sanity and extended definition mapping to functional\n  testing respectively.\n\n[skip ci]\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>", "committedDate": "2020-01-30T23:25:54Z", "type": "commit"}, {"oid": "c41560218dcd486619c055a0651875fe9f4f936b", "url": "https://github.com/eclipse-openj9/openj9/commit/c41560218dcd486619c055a0651875fe9f4f936b", "message": "Ability to pass extra labels to test jobs if defined in variable file\n\n- Adds the ability to pass parameter LABEL_ADDITION to\n  the test pipelines when extra_test_labels is defined\n  in the variable file.\n- Refactor some of the code that initializes the test\n  targets.\n- Remove default test targets from variable file. Simplifies\n  processing of tests_targets. All builds are setup to specify\n  the test targets to run so this is unnecessary code.\n- Keep sanity and extended definition mapping to functional\n  testing respectively.\n\n[skip ci]\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>", "committedDate": "2020-01-30T23:25:54Z", "type": "forcePushed"}]}