{"pr_number": 11276, "pr_title": "Improve error message on duplicate class definition", "pr_createdAt": "2020-11-25T19:13:43Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/11276", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU5NDgxMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11276#discussion_r530594811", "bodyText": "There isn't necessary anything wrong with the classfile, this message needs to be updated.", "author": "pshipton", "createdAt": "2020-11-25T19:19:01Z", "path": "runtime/nls/j9cl/j9jcl.nls", "diffHunk": "@@ -436,3 +436,11 @@ J9NLS_JCL_NEST_MEMBER_CLAIMS_DIFFERENT_NEST_HOST.system_action=The JVM will thro\n J9NLS_JCL_NEST_MEMBER_CLAIMS_DIFFERENT_NEST_HOST.user_response=Contact the provider of the classfile for a corrected version.\n # END NON-TRANSLATABLE\n \n+J9NLS_JCL_DUPLICATE_CLASS_DEFINITION=A duplicate class definition for %2$.*1$s is found\n+# START NON-TRANSLATABLE\n+J9NLS_JCL_DUPLICATE_CLASS_DEFINITION.sample_input_1=3\n+J9NLS_JCL_DUPLICATE_CLASS_DEFINITION.sample_input_2=Foo\n+J9NLS_JCL_DUPLICATE_CLASS_DEFINITION.explanation=A duplicated class definition is found.\n+J9NLS_JCL_DUPLICATE_CLASS_DEFINITION.system_action=The JVM will throw a LinkageError\n+J9NLS_JCL_DUPLICATE_CLASS_DEFINITION.user_response=Contact the provider of the classfile for a corrected version.", "originalCommit": "f25cd1130c870af6ec71f420b3b528e913b31ca2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDYwMDgyNg==", "url": "https://github.com/eclipse-openj9/openj9/pull/11276#discussion_r530600826", "bodyText": "Message updated.", "author": "hangshao0", "createdAt": "2020-11-25T19:31:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDU5NDgxMQ=="}], "type": "inlineReview"}, {"oid": "bb4734213d56d2cd69e5d56f72eaa2a6c0d1940a", "url": "https://github.com/eclipse-openj9/openj9/commit/bb4734213d56d2cd69e5d56f72eaa2a6c0d1940a", "message": "Improve error message on duplicate class definition\n\n1. Add an error message on LinkageError when a duplicate class \ndefinition is found.\n2. Change setCurrentExceptionNLSWithArgs() to pass in NULL rather \nthan an empty string as the default message.\nj9nls_lookup_message() directly returns the default message when it \nis not NULL and the locale is English, making the message in\nsetCurrentExceptionNLSWithArgs() always to be the default empty string.\n\nFixes #11243\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>", "committedDate": "2020-11-25T19:30:35Z", "type": "commit"}, {"oid": "bb4734213d56d2cd69e5d56f72eaa2a6c0d1940a", "url": "https://github.com/eclipse-openj9/openj9/commit/bb4734213d56d2cd69e5d56f72eaa2a6c0d1940a", "message": "Improve error message on duplicate class definition\n\n1. Add an error message on LinkageError when a duplicate class \ndefinition is found.\n2. Change setCurrentExceptionNLSWithArgs() to pass in NULL rather \nthan an empty string as the default message.\nj9nls_lookup_message() directly returns the default message when it \nis not NULL and the locale is English, making the message in\nsetCurrentExceptionNLSWithArgs() always to be the default empty string.\n\nFixes #11243\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>", "committedDate": "2020-11-25T19:30:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDYwNDQ3Mg==", "url": "https://github.com/eclipse-openj9/openj9/pull/11276#discussion_r530604472", "bodyText": "We can't return NULL here as the nlsMsgFormat is used as the format string to the j9str_vprintf which doesn't check it for null.", "author": "DanHeidinga", "createdAt": "2020-11-25T19:39:37Z", "path": "runtime/vm/exceptionsupport.c", "diffHunk": "@@ -135,7 +135,7 @@ setCurrentExceptionNLSWithArgs(J9VMThread * vmThread, U_32 nlsModule, U_32 nlsID\n \tnlsMsgFormat = omrnls_lookup_message(J9NLS_DO_NOT_PRINT_MESSAGE_TAG | J9NLS_DO_NOT_APPEND_NEWLINE,\n \t\t\tnlsModule,\n \t\t\tnlsID,\n-\t\t\t\"\");\n+\t\t\tNULL);", "originalCommit": "bb4734213d56d2cd69e5d56f72eaa2a6c0d1940a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDYwOTcyNA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11276#discussion_r530609724", "bodyText": "j9nls_lookup_message does not return NULL, it returns a failure string if the message cannot be found:\nhttps://github.com/eclipse/omr/blob/57e8ed7a39d2f0570ff5218d3fc2758b0ef68e1c/port/common/j9nls.c#L401toL406,", "author": "hangshao0", "createdAt": "2020-11-25T19:50:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDYwNDQ3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDYzNTI1Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/11276#discussion_r530635253", "bodyText": "You're right.  If parse_catalog returns the default_string, null in this case, that code will return an error message.", "author": "DanHeidinga", "createdAt": "2020-11-25T20:48:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDYwNDQ3Mg=="}], "type": "inlineReview"}]}