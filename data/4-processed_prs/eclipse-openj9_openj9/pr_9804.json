{"pr_number": 9804, "pr_title": "Created helper for inline array allocation", "pr_createdAt": "2020-06-04T19:23:08Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/9804", "timeline": [{"oid": "60504c72db4664ee1a7ea0d43690d7b47b8d657b", "url": "https://github.com/eclipse-openj9/openj9/commit/60504c72db4664ee1a7ea0d43690d7b47b8d657b", "message": "Created inlineAllocateIndexableObject", "committedDate": "2020-06-04T19:34:45Z", "type": "forcePushed"}, {"oid": "bdd83621d106ce3c4707bb820983258670787dfa", "url": "https://github.com/eclipse-openj9/openj9/commit/bdd83621d106ce3c4707bb820983258670787dfa", "message": "Created inlineAllocateIndexableObject", "committedDate": "2020-06-04T21:02:34Z", "type": "forcePushed"}, {"oid": "57f1be1996e8828f501d5d90e5a545a1d8e9ae71", "url": "https://github.com/eclipse-openj9/openj9/commit/57f1be1996e8828f501d5d90e5a545a1d8e9ae71", "message": "Created inlineAllocateIndexableObject", "committedDate": "2020-06-03T14:01:49Z", "type": "forcePushed"}, {"oid": "e0b762f6f8dd2d96b5a03f98f5a6eccd01cd42ba", "url": "https://github.com/eclipse-openj9/openj9/commit/e0b762f6f8dd2d96b5a03f98f5a6eccd01cd42ba", "message": "Created inlineAllocateIndexableObject", "committedDate": "2020-06-04T21:27:13Z", "type": "forcePushed"}, {"oid": "38abef81cb57799ace32e005512a44d6f7d12115", "url": "https://github.com/eclipse-openj9/openj9/commit/38abef81cb57799ace32e005512a44d6f7d12115", "message": "Created inlineAllocateIndexableObject\n\nSigned-off-by: Oussama Saoudi <oussama.saoudi@ibm.com>", "committedDate": "2020-06-04T21:29:15Z", "type": "forcePushed"}, {"oid": "e34a9f57fcff5bd6ef1cc48e7359d6a0bd224d73", "url": "https://github.com/eclipse-openj9/openj9/commit/e34a9f57fcff5bd6ef1cc48e7359d6a0bd224d73", "message": "Created inlineAllocateIndexableObject\n\nSigned-off-by: Oussama Saoudi <oussama.saoudi@ibm.com>", "committedDate": "2020-06-04T21:39:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk5NjQ1Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/9804#discussion_r436996456", "bodyText": "Add a comment saying \"unflattened class that contain the J9ClassContainsUnflattenedFlattenables flag will return NULL\"", "author": "tajila", "createdAt": "2020-06-08T20:57:25Z", "path": "runtime/oti/VMHelpers.hpp", "diffHunk": "@@ -768,6 +768,36 @@ class VM_VMHelpers\n \t{\n \t\tj9object_t instance = NULL;\n \n+\t\tinstance = inlineAllocateIndexableObject(currentThread, objectAllocate, arrayClass, size, initializeSlots, memoryBarrier, sizeCheck);\n+\n+\t\tif (NULL == instance) {\n+\t\t\tinstance = currentThread->javaVM->memoryManagerFunctions->J9AllocateIndexableObject(currentThread, arrayClass, size, J9_GC_ALLOCATE_OBJECT_NON_INSTRUMENTABLE);\n+\t\t\tif (J9_UNEXPECTED(NULL == instance)) {\n+\t\t\t\tsetHeapOutOfMemoryError(currentThread);\n+\t\t\t}\n+\t\t}\n+\t\treturn instance;\n+\t}\n+\n+\t/**\n+\t *\n+\t * Perform a non-instrumentable allocation of an indexable flattened or unflattened class.\n+\t *", "originalCommit": "e34a9f57fcff5bd6ef1cc48e7359d6a0bd224d73", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "363cb41b0da3a9b51f98d976293d72459864af91", "url": "https://github.com/eclipse-openj9/openj9/commit/363cb41b0da3a9b51f98d976293d72459864af91", "message": "Created inlineAllocateIndexableObject\n\nSigned-off-by: Oussama Saoudi <oussama.saoudi@ibm.com>", "committedDate": "2020-06-09T14:43:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE4MzM4NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9804#discussion_r438183385", "bodyText": "this comment should be moved to the inlineAllocateIndexableObject header.\nAlso, minor nitpick: Perhaps re-word as Unflattened array classes that contain", "author": "tajila", "createdAt": "2020-06-10T14:49:32Z", "path": "runtime/oti/VMHelpers.hpp", "diffHunk": "@@ -753,6 +753,8 @@ class VM_VMHelpers\n \t *\n \t * If allocation fails, a heap OutOfMemory error is set pending on the thread.\n \t *\n+\t * Unflattened class that contain the J9ClassContainsUnflattenedFlattenables flag will return NULL", "originalCommit": "363cb41b0da3a9b51f98d976293d72459864af91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "25b74094f013e02f18bb57b6832314c0e7e447f1", "url": "https://github.com/eclipse-openj9/openj9/commit/25b74094f013e02f18bb57b6832314c0e7e447f1", "message": "Created inlineAllocateIndexableObject helper function to handle allocation of indexable flattened or unflatted\nclass by calling one of:\n- inlineAllocateIndexableValueTypeObject for flattened array classes\n- inlineAllocateIndexableObject for unflattened array classes with no unflattened flattenables\n\nSigned-off-by: Oussama Saoudi <oussama.saoudi@ibm.com>", "committedDate": "2020-06-10T15:32:55Z", "type": "forcePushed"}, {"oid": "7884ac53b8c2d2ddf81c5d90e76af3a617598f4c", "url": "https://github.com/eclipse-openj9/openj9/commit/7884ac53b8c2d2ddf81c5d90e76af3a617598f4c", "message": "Created inlineAllocateIndexableObject helper function to handle allocation of indexable flattened or unflattened\nclasses by calling one of:\n- inlineAllocateIndexableValueTypeObject for flattened array classes\n- inlineAllocateIndexableObject for unflattened array classes with no unflattened flattenables\n\nSigned-off-by: Oussama Saoudi <oussama.saoudi@ibm.com>", "committedDate": "2020-06-10T15:46:16Z", "type": "forcePushed"}, {"oid": "22717e133cdb09fae4e9ec77c65d55f7646a0117", "url": "https://github.com/eclipse-openj9/openj9/commit/22717e133cdb09fae4e9ec77c65d55f7646a0117", "message": "Created inlineAllocateIndexableObject helper function to handle allocation of indexable flattened or unflattened\nclasses by calling one of:\n- inlineAllocateIndexableValueTypeObject for flattened array classes\n- inlineAllocateIndexableObject for unflattened array classes with no unflattened flattenables\n\nSigned-off-by: Oussama Saoudi <oussama.saoudi@ibm.com>", "committedDate": "2020-06-11T00:47:24Z", "type": "forcePushed"}, {"oid": "5d81612a59d6bfd4c1ebb9f2f48500662b7aa33b", "url": "https://github.com/eclipse-openj9/openj9/commit/5d81612a59d6bfd4c1ebb9f2f48500662b7aa33b", "message": "Created inlineAllocateIndexableObject helper function to handle\n allocation of indexable flattened or unflattened\nclasses by calling one of:\n- inlineAllocateIndexableValueTypeObject for flattened\narray classes\n- inlineAllocateIndexableObject for unflattened array classes\nwith no unflattened flattenables\n\nSigned-off-by: Oussama Saoudi <oussama.saoudi@ibm.com>", "committedDate": "2020-06-11T15:42:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ5NjcwNA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9804#discussion_r439496704", "bodyText": "avoid whitespace changes", "author": "tajila", "createdAt": "2020-06-12T15:43:21Z", "path": "runtime/oti/VMHelpers.hpp", "diffHunk": "@@ -752,7 +752,7 @@ class VM_VMHelpers\n \t * This function assumes that the stack and live values are in a valid state for GC.\n \t *\n \t * If allocation fails, a heap OutOfMemory error is set pending on the thread.\n-\t *\n+\t * ", "originalCommit": "5d81612a59d6bfd4c1ebb9f2f48500662b7aa33b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "dd05e55956079e649778d8a4b16aad991686c480", "url": "https://github.com/eclipse-openj9/openj9/commit/dd05e55956079e649778d8a4b16aad991686c480", "message": "Created helper for inline array allocation\n\nCreated inlineAllocateIndexableObject helper function to handle\nallocation of indexable flattened or unflattened classes by calling one\nof:\n- inlineAllocateIndexableValueTypeObject for flattened array classes\n- inlineAllocateIndexableObject for unflattened array classes with no\nunflattened flattenables\n\nReplaced explicit usages of the inlineAllocateIndexableValueTypeObject\nmethod with the new inlineAllocateIndexableObject helper.\n\nRelated to: https://github.com/eclipse/openj9/issues/9200\n\nSigned-off-by: Oussama Saoudi <oussama.saoudi@ibm.com>", "committedDate": "2020-06-12T15:48:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTUwNjM5Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/9804#discussion_r439506396", "bodyText": "undo this change completely", "author": "tajila", "createdAt": "2020-06-12T16:01:25Z", "path": "runtime/oti/VMHelpers.hpp", "diffHunk": "@@ -752,7 +752,6 @@ class VM_VMHelpers\n \t * This function assumes that the stack and live values are in a valid state for GC.\n \t *\n \t * If allocation fails, a heap OutOfMemory error is set pending on the thread.\n-\t *", "originalCommit": "dd05e55956079e649778d8a4b16aad991686c480", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5275c569e028174fc40507fc55b596d2b70e62a3", "url": "https://github.com/eclipse-openj9/openj9/commit/5275c569e028174fc40507fc55b596d2b70e62a3", "message": "Created helper for inline array allocation\n\nCreated inlineAllocateIndexableObject helper function to handle\nallocation of indexable flattened or unflattened classes by calling one\nof:\n- inlineAllocateIndexableValueTypeObject for flattened array classes\n- inlineAllocateIndexableObject for unflattened array classes with no\nunflattened flattenables\n\nReplaced explicit usages of the inlineAllocateIndexableValueTypeObject\nmethod with the new inlineAllocateIndexableObject helper.\n\nRelated to: https://github.com/eclipse/openj9/issues/9200\n\nSigned-off-by: Oussama Saoudi <oussama.saoudi@ibm.com>", "committedDate": "2020-06-12T16:07:08Z", "type": "commit"}, {"oid": "5275c569e028174fc40507fc55b596d2b70e62a3", "url": "https://github.com/eclipse-openj9/openj9/commit/5275c569e028174fc40507fc55b596d2b70e62a3", "message": "Created helper for inline array allocation\n\nCreated inlineAllocateIndexableObject helper function to handle\nallocation of indexable flattened or unflattened classes by calling one\nof:\n- inlineAllocateIndexableValueTypeObject for flattened array classes\n- inlineAllocateIndexableObject for unflattened array classes with no\nunflattened flattenables\n\nReplaced explicit usages of the inlineAllocateIndexableValueTypeObject\nmethod with the new inlineAllocateIndexableObject helper.\n\nRelated to: https://github.com/eclipse/openj9/issues/9200\n\nSigned-off-by: Oussama Saoudi <oussama.saoudi@ibm.com>", "committedDate": "2020-06-12T16:07:08Z", "type": "forcePushed"}]}