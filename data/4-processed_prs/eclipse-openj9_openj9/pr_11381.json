{"pr_number": 11381, "pr_title": "AArch64: Change -fpic to -fPIC", "pr_createdAt": "2020-12-07T13:12:38Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/11381", "timeline": [{"oid": "c72759015e942f22b99cbf2bababf5e466c2ea91", "url": "https://github.com/eclipse-openj9/openj9/commit/c72759015e942f22b99cbf2bababf5e466c2ea91", "message": "AArch64: Change -fpic to -fPIC\n\n`-fpic` and `-fPIC` options are mixed in the build for AArch64 Linux.\nThis commit changes `-fpic` to `-fPIC` to make the options consistent.\n\nSigned-off-by: KONNO Kazuhiro <konno@jp.ibm.com>", "committedDate": "2020-12-07T12:57:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY5NjI0OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11381#discussion_r537696248", "bodyText": "My (limited) understanding of the -fPIC option is that it can produce larger and slower code than -fpic, albeit with less target dependence.  Given the interest in keeping the AArch64 JIT shared library as small as possible, is there a footprint difference observed between the two link options that needs to be taken into consideration here?", "author": "0xdaryl", "createdAt": "2020-12-07T17:37:28Z", "path": "runtime/makelib/targets.mk.linux.inc.ftl", "diffHunk": "@@ -273,7 +273,7 @@ CPPFLAGS += -DLINUX -D_REENTRANT\n </#if>\n \n <#-- Add Position Independent compile flag -->\n-<#if uma.spec.processor.amd64 || uma.spec.processor.arm || uma.spec.processor.s390 || uma.spec.processor.riscv64>\n+<#if uma.spec.processor.amd64 || uma.spec.processor.arm || uma.spec.processor.aarch64 || uma.spec.processor.s390 || uma.spec.processor.riscv64>", "originalCommit": "c72759015e942f22b99cbf2bababf5e466c2ea91", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkyMjQ0MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11381#discussion_r537922441", "bodyText": "The JIT and GC binaries compiled with -fPIC are smaller than those with -fpic, while some other files are bigger with -fPIC.\n-fPIC makes the total footprint smaller.\nwith -fPIC:\n 12614192  2020-12-07 21:30   jdk/lib/compressedrefs/libj9jit29.so\n  3249176  2020-12-07 21:30   jdk/lib/compressedrefs/libj9gc29.so\n\n  1570584  2020-12-07 21:30   jdk/lib/compressedrefs/libj9vm29.so\n   657800  2020-12-07 21:30   jdk/lib/compressedrefs/libj9shr29.so\n\n(total)\n297659854                     774 files\n\nwith -fpic:\n 12626872  2020-12-07 20:38   jdk/lib/compressedrefs/libj9jit29.so\n  3253512  2020-12-07 20:38   jdk/lib/compressedrefs/libj9gc29.so\n\n  1566416  2020-12-07 20:38   jdk/lib/compressedrefs/libj9vm29.so\n   648888  2020-12-07 20:38   jdk/lib/compressedrefs/libj9shr29.so\n\n(total)\n297685871                     774 files", "author": "knn-k", "createdAt": "2020-12-07T23:48:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY5NjI0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk1NTE3NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11381#discussion_r537955175", "bodyText": "Thanks for measuring real data.  I'll have to dig into the real differences between those two options someday.  Change looks good.", "author": "0xdaryl", "createdAt": "2020-12-08T01:10:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY5NjI0OA=="}], "type": "inlineReview"}]}