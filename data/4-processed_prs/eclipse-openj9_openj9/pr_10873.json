{"pr_number": 10873, "pr_title": "Support -Xsyslog and -XX:+/-LegacyXlogOption", "pr_createdAt": "2020-10-13T18:11:33Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10873", "timeline": [{"oid": "6f8dff337d5261a94188737f9f60db6a35a2b910", "url": "https://github.com/eclipse-openj9/openj9/commit/6f8dff337d5261a94188737f9f60db6a35a2b910", "message": "Support -Xsyslog and -XX:+/-LegacyXlogOption\n\n-Xsyslog is the replacement for the -Xlog option. If\n-XX:-LegacyXlogOption is specified, no processing of -Xlog is done.\n\nIssue https://github.com/eclipse/openj9/issues/10799\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>", "committedDate": "2020-10-13T21:14:03Z", "type": "commit"}, {"oid": "f96d8e5b573d971b205bfb9d30aa5b10f51bbc86", "url": "https://github.com/eclipse-openj9/openj9/commit/f96d8e5b573d971b205bfb9d30aa5b10f51bbc86", "message": "Update -Xlog nls messages to use -Xsyslog\n\nIssue https://github.com/eclipse/openj9/issues/10799\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>", "committedDate": "2020-10-13T21:14:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDYzMDQ2NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10873#discussion_r504630465", "bodyText": "This should say 'Print JVM -Xsyslog help.'; all *.nls files seem to be missing that change.", "author": "keithc-ca", "createdAt": "2020-10-14T12:20:13Z", "path": "runtime/nls/j9vm/j9vm.nls", "diffHunk": "@@ -970,72 +970,72 @@ J9NLS_VM_XSCDMX_IGNORED.system_action=-Xscdmx will be ignored.\n J9NLS_VM_XSCDMX_IGNORED.user_response=Ignore this message, remove -Xscdmx, or enable -Xshareclasses.\n # END NON-TRANSLATABLE\n \n-# Help text for the -Xlog option. Note: please do not translate the text of the option flags: help, all, none, warn, error, info, config, vital\n+# Help text for the -Xsyslog option. Note: please do not translate the text of the option flags: help, all, none, warn, error, info, config, vital\n J9NLS_VM_XLOG_HELP01=\\nUsage:\\n\n # START NON-TRANSLATABLE\n J9NLS_VM_XLOG_HELP01.explanation=NOTAG\n J9NLS_VM_XLOG_HELP01.system_action=\n J9NLS_VM_XLOG_HELP01.user_response=\n # END NON-TRANSLATABLE\n \n-# -Xlog:help is not translatable\n-J9NLS_VM_XLOG_HELP02=  -Xlog:help              Print JVM -Xlog help.\n+# -Xsyslog:help is not translatable\n+J9NLS_VM_XLOG_HELP02=  -Xsyslog:help              Print JVM -Xlog help.", "originalCommit": "f96d8e5b573d971b205bfb9d30aa5b10f51bbc86", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcxNDc3Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/10873#discussion_r504714773", "bodyText": "Updated", "author": "pshipton", "createdAt": "2020-10-14T14:17:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDYzMDQ2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDYzMTEwMw==", "url": "https://github.com/eclipse-openj9/openj9/pull/10873#discussion_r504631103", "bodyText": "Why is this buffer needed (it wasn't before)?", "author": "keithc-ca", "createdAt": "2020-10-14T12:21:19Z", "path": "runtime/vm/logsupport.c", "diffHunk": "@@ -264,42 +265,39 @@ parseLogOptions(char *options, UDATA *optionsFlags, UDATA *parseSucceeded)\n jint\n processXLogOptions(J9JavaVM * vm)\n {\n-\tIDATA xlogindex;\n-\tUDATA xlogflags, printhelp, tempflags;\n+\tIDATA xlogindex = FIND_ARG_IN_VMARGS_FORWARD(OPTIONAL_LIST_MATCH, VMOPT_XSYSLOG_OPT, NULL);\n+\t/* The default for -Xsyslog is to be turned on and capture 'error' and 'vital' type messages */\n+\tUDATA xlogflags = defaultLogOptions;\n+\tUDATA printhelp = FALSE;\n+\tUDATA tempflags = 0;\n \tjint rc = JNI_OK;\n \tJ9VMInitArgs* j9vm_args = vm->vmArgsArray;\n \n \tPORT_ACCESS_FROM_JAVAVM(vm);\n \n-\tprinthelp = FALSE;\n-\n-\t/* The default for -Xlog is to be turned on and capture 'error' and 'vital' type messages */\n-\txlogflags = defaultLogOptions;\n-\n-\txlogindex = FIND_ARG_IN_VMARGS_FORWARD(OPTIONAL_LIST_MATCH, XLOG_OPT, NULL);\n-\n \t/* If xlogindex == -1 nothing was specified, so use the default setting from above */\n \n \twhile (xlogindex >= 0) {\n-\t\tIDATA optionsfound;\n+\t\tIDATA optionsfound = 0;\n \t\tUDATA optionsparsed = FALSE;\n-\t\tchar *xlogoptions = NULL;\n+\t\tchar xlogoptionsbuf[SMALL_STRING_BUF_SIZE];", "originalCommit": "f96d8e5b573d971b205bfb9d30aa5b10f51bbc86", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDY4NDAyNg==", "url": "https://github.com/eclipse-openj9/openj9/pull/10873#discussion_r504684026", "bodyText": "In order to be compatible with mapped options, the code was changed to use COPY_OPTION_VALUE(), which requires a buffer, instead of GET_OPTION_VALUE().", "author": "pshipton", "createdAt": "2020-10-14T13:38:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDYzMTEwMw=="}], "type": "inlineReview"}, {"oid": "78944999797428229f6febd3618a9fe81164f3c5", "url": "https://github.com/eclipse-openj9/openj9/commit/78944999797428229f6febd3618a9fe81164f3c5", "message": "Update -Xlog nls messages to use -Xsyslog\n\nIssue https://github.com/eclipse/openj9/issues/10799\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>", "committedDate": "2020-10-14T13:58:31Z", "type": "commit"}, {"oid": "78944999797428229f6febd3618a9fe81164f3c5", "url": "https://github.com/eclipse-openj9/openj9/commit/78944999797428229f6febd3618a9fe81164f3c5", "message": "Update -Xlog nls messages to use -Xsyslog\n\nIssue https://github.com/eclipse/openj9/issues/10799\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>", "committedDate": "2020-10-14T13:58:31Z", "type": "forcePushed"}]}