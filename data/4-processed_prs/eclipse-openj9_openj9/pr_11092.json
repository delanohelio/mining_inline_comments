{"pr_number": 11092, "pr_title": "Use the right symbol for constant string placeholder", "pr_createdAt": "2020-11-03T18:39:24Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/11092", "timeline": [{"oid": "8d634e92e604cc5185621735fb348fe9478a02c9", "url": "https://github.com/eclipse-openj9/openj9/commit/8d634e92e604cc5185621735fb348fe9478a02c9", "message": "Set the right flag on symbol for constant string placeholder\n\nConstant string in customized LambdaForm method is just a placeholder\nand can be patched to other object. Set the flag on the symbol according\nto the actual object type.\n\nSigned-off-by: Liqun Liu <liqunl@ca.ibm.com>", "committedDate": "2020-11-06T01:10:24Z", "type": "forcePushed"}, {"oid": "2a733047908a94cb6a24885e02cbd84277d86a21", "url": "https://github.com/eclipse-openj9/openj9/commit/2a733047908a94cb6a24885e02cbd84277d86a21", "message": "Set the right flag on symbol for constant string placeholder\n\nConstant string in customized LambdaForm method is just a placeholder\nand can be patched to other object. Set the flag on the symbol according\nto the actual object type.\n\nSigned-off-by: Liqun Liu <liqunl@ca.ibm.com>", "committedDate": "2020-11-06T17:28:15Z", "type": "forcePushed"}, {"oid": "e62af43a63784be9911ab57d370419339bf12232", "url": "https://github.com/eclipse-openj9/openj9/commit/e62af43a63784be9911ab57d370419339bf12232", "message": "Set the right flag on symbol for constant string placeholder\n\nConstant string in customized LambdaForm method is just a placeholder\nand can be patched to other object. Set the flag on the symbol according\nto the actual object type.\n\nSigned-off-by: Liqun Liu <liqunl@ca.ibm.com>", "committedDate": "2020-11-09T15:34:55Z", "type": "forcePushed"}, {"oid": "066e81e4e336dea65019b2eeca0b5fa31e291152", "url": "https://github.com/eclipse-openj9/openj9/commit/066e81e4e336dea65019b2eeca0b5fa31e291152", "message": "Set the right flag on symbol for constant string placeholder\n\nConstant string can be used as a placeholder and be patched to other\nobject. Set the flag on the symbol according to the actual object type.\n\nSigned-off-by: Liqun Liu <liqunl@ca.ibm.com>", "committedDate": "2020-11-09T15:36:34Z", "type": "forcePushed"}, {"oid": "299e80167ff40e3e4ccdc76e97684b9d86ccabae", "url": "https://github.com/eclipse-openj9/openj9/commit/299e80167ff40e3e4ccdc76e97684b9d86ccabae", "message": "Set the right flag on symbol for constant string placeholder\n\nConstant string can be used as a placeholder and be patched to other\nobject. Set the flag on the symbol according to the actual object type.\n\nSigned-off-by: Liqun Liu <liqunl@ca.ibm.com>", "committedDate": "2020-11-11T02:26:55Z", "type": "forcePushed"}, {"oid": "d19110c02c4b9393dffe7b199681ffa91445c5ea", "url": "https://github.com/eclipse-openj9/openj9/commit/d19110c02c4b9393dffe7b199681ffa91445c5ea", "message": "Set the right flag on symbol for constant string placeholder\n\nConstant string can be used as a placeholder and be patched to other\nobject. Set the flag on the symbol according to the actual object type.\n\nSigned-off-by: Liqun Liu <liqunl@ca.ibm.com>", "committedDate": "2020-11-11T04:40:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjMzMDk0NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11092#discussion_r522330944", "bodyText": "Question - should this be recoverable? We can recover only with a non-AOT compile so wanted ot make sure this is the right semantics", "author": "andrewcraik", "createdAt": "2020-11-12T18:39:43Z", "path": "runtime/compiler/exceptions/AOTFailure.hpp", "diffHunk": "@@ -90,6 +90,16 @@ class AOTHasMethodTypeConstant : public virtual TR::RecoverableILGenException\n    virtual const char* what() const throw() { return \"AOT Has Method Type Constant\"; }\n    };\n \n+/**\n+ * AOT Has patched CP constant exception type.\n+ *\n+ * Thrown when a method that has a constant object in CP entry patched to a different type is AOT Compiled.\n+ */\n+class AOTHasPatchedCPConstant: public virtual TR::RecoverableILGenException", "originalCommit": "d19110c02c4b9393dffe7b199681ffa91445c5ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA2NDgxOA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11092#discussion_r523064818", "bodyText": "Yes.  Added code to disable AOT in recompilation.", "author": "liqunl", "createdAt": "2020-11-13T16:33:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjMzMDk0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjMzOTc5Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/11092#discussion_r522339793", "bodyText": "Could you please update message numbers that come after this message?", "author": "dmitry-ten", "createdAt": "2020-11-12T18:54:11Z", "path": "runtime/compiler/net/MessageTypes.hpp", "diffHunk": "@@ -135,6 +135,7 @@ enum MessageType : uint16_t\n    VM_isPrimitiveArray,\n    VM_getAllocationSize,\n    VM_getObjectClass,\n+   VM_getObjectClassAt,", "originalCommit": "d19110c02c4b9393dffe7b199681ffa91445c5ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA2NTQ2Mg==", "url": "https://github.com/eclipse-openj9/openj9/pull/11092#discussion_r523065462", "bodyText": "Updated", "author": "liqunl", "createdAt": "2020-11-13T16:34:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjMzOTc5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjMzOTk2Mg==", "url": "https://github.com/eclipse-openj9/openj9/pull/11092#discussion_r522339962", "bodyText": "Same here, please update message numbers.", "author": "dmitry-ten", "createdAt": "2020-11-12T18:54:26Z", "path": "runtime/compiler/net/MessageTypes.hpp", "diffHunk": "@@ -407,6 +408,7 @@ static const char *messageNames[MessageType_ARRAYSIZE] =\n    \"VM_isPrimitiveArray\",\n    \"VM_getAllocationSize\",\n    \"VM_getObjectClass\",\n+   \"VM_getObjectClassAt\",", "originalCommit": "d19110c02c4b9393dffe7b199681ffa91445c5ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA2NTYwOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11092#discussion_r523065609", "bodyText": "Updated", "author": "liqunl", "createdAt": "2020-11-13T16:34:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjMzOTk2Mg=="}], "type": "inlineReview"}, {"oid": "68e95b272df5d460ab7771901cf1d262c9fa1bc8", "url": "https://github.com/eclipse-openj9/openj9/commit/68e95b272df5d460ab7771901cf1d262c9fa1bc8", "message": "Set the right flag on symbol for constant string placeholder\n\nConstant string can be used as a placeholder and be patched to other\nobject. Set the flag on the symbol according to the actual object type.\n\nSigned-off-by: Liqun Liu <liqunl@ca.ibm.com>", "committedDate": "2020-11-13T16:08:31Z", "type": "forcePushed"}, {"oid": "757022dd5bcba2f65bb01bad3236e9f3f1290181", "url": "https://github.com/eclipse-openj9/openj9/commit/757022dd5bcba2f65bb01bad3236e9f3f1290181", "message": "Set the right flag on symbol for constant string placeholder\n\nConstant string can be used as a placeholder and be patched to other\nobject. Set the flag on the symbol according to the actual object type.\n\nSigned-off-by: Liqun Liu <liqunl@ca.ibm.com>", "committedDate": "2020-11-13T17:25:31Z", "type": "forcePushed"}, {"oid": "d16b22fee47b5bc2e75d7ff0fb776fa145f16600", "url": "https://github.com/eclipse-openj9/openj9/commit/d16b22fee47b5bc2e75d7ff0fb776fa145f16600", "message": "Set the right flag on symbol for constant string placeholder\n\nConstant string can be used as a placeholder and be patched to other\nobject. Set the flag on the symbol according to the actual object type.\n\nSigned-off-by: Liqun Liu <liqunl@ca.ibm.com>", "committedDate": "2020-11-13T17:27:18Z", "type": "forcePushed"}, {"oid": "d0c0b2db07d987fee83f00808413d59be285bb40", "url": "https://github.com/eclipse-openj9/openj9/commit/d0c0b2db07d987fee83f00808413d59be285bb40", "message": "Set the right flag on symbol for constant string placeholder\n\nConstant string can be used as a placeholder and be patched to other\nobject. Set the flag on the symbol according to the actual object type.\n\nSigned-off-by: Liqun Liu <liqunl@ca.ibm.com>", "committedDate": "2020-11-16T16:05:47Z", "type": "forcePushed"}, {"oid": "2af5b949ea0107c957484f1e1cdf997954d69118", "url": "https://github.com/eclipse-openj9/openj9/commit/2af5b949ea0107c957484f1e1cdf997954d69118", "message": "Add getObjectClassAt\n\nAdd function getObjectClassAt to get class of an object stored at an\naddress.\n\nSigned-off-by: Liqun Liu <liqunl@ca.ibm.com>", "committedDate": "2020-11-16T19:09:39Z", "type": "commit"}, {"oid": "ba1bec5d057081917b17b690ad4197a734ce5982", "url": "https://github.com/eclipse-openj9/openj9/commit/ba1bec5d057081917b17b690ad4197a734ce5982", "message": "Set the right flag on symbol for constant string placeholder\n\nConstant string can be used as a placeholder and be patched to other\nobject. Set the flag on the symbol according to the actual object type.\n\nSigned-off-by: Liqun Liu <liqunl@ca.ibm.com>", "committedDate": "2020-11-16T19:09:46Z", "type": "commit"}, {"oid": "ba1bec5d057081917b17b690ad4197a734ce5982", "url": "https://github.com/eclipse-openj9/openj9/commit/ba1bec5d057081917b17b690ad4197a734ce5982", "message": "Set the right flag on symbol for constant string placeholder\n\nConstant string can be used as a placeholder and be patched to other\nobject. Set the flag on the symbol according to the actual object type.\n\nSigned-off-by: Liqun Liu <liqunl@ca.ibm.com>", "committedDate": "2020-11-16T19:09:46Z", "type": "forcePushed"}]}