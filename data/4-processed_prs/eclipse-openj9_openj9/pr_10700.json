{"pr_number": 10700, "pr_title": "Fix isConstructor for value type factory method", "pr_createdAt": "2020-09-25T14:27:09Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10700", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA2OTA3OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10700#discussion_r495069078", "bodyText": "do we need to case this? I would have thought these tests would always work for constructors? It might make sense from a compile-time perspective to do something like the strncmp last?", "author": "andrewcraik", "createdAt": "2020-09-25T15:34:20Z", "path": "runtime/compiler/env/j9method.cpp", "diffHunk": "@@ -5122,7 +5122,10 @@ TR_ResolvedJ9Method::methodModifiers()\n bool\n TR_ResolvedJ9Method::isConstructor()\n    {\n-   return nameLength()==6 && !strncmp(nameChars(), \"<init>\", 6);\n+   if (!TR::Compiler->om.areValueTypesEnabled())", "originalCommit": "332076fcfbc65b9e7fc99c63fa8a8bcd2aa80895", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA4NTY3NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10700#discussion_r495085674", "bodyText": "It might make sense from a compile-time perspective to do something like the strncmp last?\n\nstrncmp should be moved to last.\n\ndo we need to case this? I would have thought these tests would always work for constructors?\n\nIt'd work. However when value type is disabled, if the method is a constructor, the check on returnType and !isStatic will always return true and then strncmp is performed. With checking on areValueTypesEnabled(), the extra checks on returnType and !isStatic could be avoided.", "author": "a7ehuo", "createdAt": "2020-09-25T16:01:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA2OTA3OA=="}], "type": "inlineReview"}, {"oid": "77eee88c3c4de378d26ea4ced69790e73e343f56", "url": "https://github.com/eclipse-openj9/openj9/commit/77eee88c3c4de378d26ea4ced69790e73e343f56", "message": "Fix isConstructor for value type factory method\n\nInline class values are created with static factory\nmethods with method name <init>. <init> is also the method\nname for identity class constructor name. isConstructor()\nshould return false for inline class value factory method.\n\nSigned-off-by: Annabelle Huo <Annabelle.Huo@ibm.com>", "committedDate": "2020-09-25T16:04:58Z", "type": "forcePushed"}, {"oid": "8db2c30445fc2f4cc8e5ae7740aa18bb8740de3e", "url": "https://github.com/eclipse-openj9/openj9/commit/8db2c30445fc2f4cc8e5ae7740aa18bb8740de3e", "message": "Fix isConstructor for value type factory method\n\nInline class values are created with static factory\nmethods with method name <init>. <init> is also the method\nname for identity class constructor name. isConstructor()\nshould return false for inline class value factory method.\n\nSigned-off-by: Annabelle Huo <Annabelle.Huo@ibm.com>", "committedDate": "2020-09-28T20:53:21Z", "type": "commit"}, {"oid": "8db2c30445fc2f4cc8e5ae7740aa18bb8740de3e", "url": "https://github.com/eclipse-openj9/openj9/commit/8db2c30445fc2f4cc8e5ae7740aa18bb8740de3e", "message": "Fix isConstructor for value type factory method\n\nInline class values are created with static factory\nmethods with method name <init>. <init> is also the method\nname for identity class constructor name. isConstructor()\nshould return false for inline class value factory method.\n\nSigned-off-by: Annabelle Huo <Annabelle.Huo@ibm.com>", "committedDate": "2020-09-28T20:53:21Z", "type": "forcePushed"}]}