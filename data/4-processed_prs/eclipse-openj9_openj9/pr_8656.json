{"pr_number": 8656, "pr_title": "Replace JITSERVER_SUPPORT with J9VM_OPT_JITSERVER", "pr_createdAt": "2020-02-25T18:47:42Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/8656", "timeline": [{"oid": "b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e", "url": "https://github.com/eclipse-openj9/openj9/commit/b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e", "message": "Replace JITSERVER_SUPPORT with J9VM_OPT_JITSERVER\n\nReplace macro JITSERVER_SUPPORT with J9VM_OPT_JITSERVER so as to have\na single macro to enable the JITServer support both in VM and JIT.\n\nCloses: #8229\n\nSigned-off-by: Ashutosh Mehra <mehra.ashutosh@ibm.com>", "committedDate": "2020-02-25T19:47:39Z", "type": "commit"}, {"oid": "b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e", "url": "https://github.com/eclipse-openj9/openj9/commit/b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e", "message": "Replace JITSERVER_SUPPORT with J9VM_OPT_JITSERVER\n\nReplace macro JITSERVER_SUPPORT with J9VM_OPT_JITSERVER so as to have\na single macro to enable the JITServer support both in VM and JIT.\n\nCloses: #8229\n\nSigned-off-by: Ashutosh Mehra <mehra.ashutosh@ibm.com>", "committedDate": "2020-02-25T19:47:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDUzMzM0MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384533340", "bodyText": "Don't we need these defines? Are the definitions added in some other place?", "author": "mpirvu", "createdAt": "2020-02-26T14:39:44Z", "path": "runtime/compiler/build/toolcfg/gnu/common.mk", "diffHunk": "@@ -138,10 +138,6 @@ ifeq ($(HOST_ARCH),x)\n         CX_DEFINES+=J9HAMMER\n         CX_FLAGS+=-m64 -fPIC\n     endif\n-\n-    ifneq ($(JITSERVER_SUPPORT),)", "originalCommit": "b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYxMzYxMw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384613613", "bodyText": "This check is for defining the macro JITSERVER_SUPPORT. We should instead use J9VM_OPT_JITSERVER which gets defined in j9cfg.h (when using UMA build system) or by CMakeLists.txt in VM and JIT.\nNormally j9cfg.h gets included via j9.h and any code using J9VM_OPT_JITSERVER should now include j9.h.\nBefore this PR, JIT files didn't include j9.h if there isn't any dependency on it, but with this PR if the JIT files need to see J9VM_OPT_JITSERVER, then j9.h needs to be included.\nA case in point is https://github.com/eclipse/openj9/pull/8656/files#diff-65a548d2a6dcefcbcdd234568cac76ab where I have to explicitly include j9.h.", "author": "ashu-mehra", "createdAt": "2020-02-26T16:33:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDUzMzM0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384628267", "bodyText": "Isn't this now redundant given J9VM_OPT_JITSERVER is defined in runtime/CMakeLists.txt?", "author": "keithc-ca", "createdAt": "2020-02-26T16:55:47Z", "path": "runtime/compiler/CMakeLists.txt", "diffHunk": "@@ -80,10 +80,10 @@ add_custom_command(\n )\n add_custom_target(j9jit_tracegen DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/env/ut_j9jit.h)\n \n-# JITSERVER_SUPPORT and protobuf\n-if(JITSERVER_SUPPORT)\n+# J9VM_OPT_JITSERVER and protobuf\n+if(J9VM_OPT_JITSERVER)\n \tmessage(STATUS \"JITServer is supported\")\n-\tadd_definitions(-DJITSERVER_SUPPORT)\n+\tadd_definitions(-DJ9VM_OPT_JITSERVER)", "originalCommit": "b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY3MDQ2MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384670460", "bodyText": "I am not sure if defines in runtime/CMakeLists.txt propagate to JIT CMakeLists.txt. If so, then yes it should be removed.\n@keithc-ca Can you please confirm it.", "author": "ashu-mehra", "createdAt": "2020-02-26T18:09:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY4NTg3NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384685874", "bodyText": "@dnakamura might know off the top of his head, but please try without what I hope is redundant.", "author": "keithc-ca", "createdAt": "2020-02-26T18:37:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY5Mzc5Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384693797", "bodyText": "Instead of using an add_definition the proper way would be to add #cmakedefine J9VM_OPT_JITSERVER to runtime/include/j9cfg.h.in", "author": "dnakamura", "createdAt": "2020-02-26T18:52:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY5NTI4MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384695280", "bodyText": "I think that will play better with DDR should J9VM_OPT_JITSERVER ever need to be used there.", "author": "keithc-ca", "createdAt": "2020-02-26T18:55:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgwMjE3NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384802174", "bodyText": "@dnakamura how would cmake know whether to define or undef J9VM_OPT_JITSERVER in the generated j9cfg.h file?", "author": "ashu-mehra", "createdAt": "2020-02-26T22:19:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg0MTAzMw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384841033", "bodyText": "Would I need to add the following towards the end of cmake/caches/common.cmake:\nif (J9VM_OPT_JITSERVER)\n    set(J9VM_OPT_JITSERVER ON CACHE BOOL \"\")\nendif()\n\nand an entry in cmake/options.cmake:\noption(J9VM_OPT_JITSERVER, \"some text\")", "author": "ashu-mehra", "createdAt": "2020-02-27T00:03:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEyODMxNg==", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r385128316", "bodyText": "In some cmake file, we want\nset(J9VM_OPT_JITSERVER OFF CACHE BOOL \"Enable JIT Server\")\n\nThis tells cmake about the flag so it know what to do with #cmakedefine J9VM_OPT_JITSERVER.\nNotice the default is OFF; it can be modified by a command-line option or via logic in cmake files.", "author": "keithc-ca", "createdAt": "2020-02-27T13:35:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTE0MTYwOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r385141609", "bodyText": "I think I am getting confused with env variable J9VM_OPT_JITSERVER and cmake variable J9VM_OPT_JITSERVER.\nLets say I have added set(J9VM_OPT_JITSERVER OFF CACHE BOOL \"Enable JIT Server\") to cmake/caches/common.cmake.\nNow if env variable J9VM_OPT_JITSERVER is defined, is that sufficient for cmake to convert #cmakedefine J9VM_OPT_JITSERVER to #define J9VM_OPT_JITSERVER in the header file?", "author": "ashu-mehra", "createdAt": "2020-02-27T13:58:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTIzMjM2NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r385232365", "bodyText": "In the cmake case, it is not an environment variable, but this command-line option that affects that flag:\nCMAKE_ARGS += -DJ9VM_OPT_JITSERVER=ON", "author": "keithc-ca", "createdAt": "2020-02-27T16:44:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYzNjY2NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384636664", "bodyText": "Can you please fix the inconsistent indentation while you're here.", "author": "keithc-ca", "createdAt": "2020-02-26T17:09:30Z", "path": "runtime/compiler/runtime/CMakeLists.txt", "diffHunk": "@@ -60,7 +60,7 @@ j9jit_files(\n \t${omr_SOURCE_DIR}/compiler/runtime/OMRRuntimeAssumptions.cpp\n )\n \n-if(JITSERVER_SUPPORT)\n+if(J9VM_OPT_JITSERVER)\n \tj9jit_files(\n                 runtime/CompileService.cpp\n \t\truntime/JITClientSession.cpp", "originalCommit": "b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c5f120ff37ee929f5539c17ff06f477ced21775c", "url": "https://github.com/eclipse-openj9/openj9/commit/c5f120ff37ee929f5539c17ff06f477ced21775c", "message": "Add J9VM_OPT_JITSERVER to j9cfg.h.in for cmake build system\n\nInstead of adding -DJ9VM_OPT_JITSERVER, add it to j9cfg.h.in\nso that cmake system can convert it to define or undef depending\non the env variable with same name.\n\nSigned-off-by: Ashutosh Mehra <mehra.ashutosh@ibm.com>", "committedDate": "2020-02-27T16:56:13Z", "type": "commit"}, {"oid": "c5f120ff37ee929f5539c17ff06f477ced21775c", "url": "https://github.com/eclipse-openj9/openj9/commit/c5f120ff37ee929f5539c17ff06f477ced21775c", "message": "Add J9VM_OPT_JITSERVER to j9cfg.h.in for cmake build system\n\nInstead of adding -DJ9VM_OPT_JITSERVER, add it to j9cfg.h.in\nso that cmake system can convert it to define or undef depending\non the env variable with same name.\n\nSigned-off-by: Ashutosh Mehra <mehra.ashutosh@ibm.com>", "committedDate": "2020-02-27T16:56:13Z", "type": "forcePushed"}]}