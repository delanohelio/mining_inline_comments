{"pr_number": 11439, "pr_title": "Update docker container script for use with OpenJ9 builds", "pr_createdAt": "2020-12-10T21:00:15Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/11439", "timeline": [{"oid": "212df13bb3902d793f5b48a8000bef74b92efbb9", "url": "https://github.com/eclipse-openj9/openj9/commit/212df13bb3902d793f5b48a8000bef74b92efbb9", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update git version\n* update to url for autoconf\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>", "committedDate": "2020-12-10T21:02:01Z", "type": "forcePushed"}, {"oid": "8605127d73de53023d41d9764caf084d5632b0e0", "url": "https://github.com/eclipse-openj9/openj9/commit/8605127d73de53023d41d9764caf084d5632b0e0", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update git version\n* update to url for autoconf\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>", "committedDate": "2020-12-10T21:04:04Z", "type": "forcePushed"}, {"oid": "df6390138125032a2ad6011549b7cf501413c760", "url": "https://github.com/eclipse-openj9/openj9/commit/df6390138125032a2ad6011549b7cf501413c760", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update git version\n* update to url for autoconf\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>", "committedDate": "2020-12-11T20:02:40Z", "type": "forcePushed"}, {"oid": "dc1d01a45d8b15f0825337065beb7bdf0c64c340", "url": "https://github.com/eclipse-openj9/openj9/commit/dc1d01a45d8b15f0825337065beb7bdf0c64c340", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update git version\n* update to url for autoconf\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>", "committedDate": "2021-05-12T13:49:59Z", "type": "forcePushed"}, {"oid": "24dfa611361c35dc2b121c8054c469e6c8845cdb", "url": "https://github.com/eclipse-openj9/openj9/commit/24dfa611361c35dc2b121c8054c469e6c8845cdb", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update git version\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>", "committedDate": "2021-05-14T17:28:54Z", "type": "forcePushed"}, {"oid": "30ebdf25291e941eb4cc2f84b1f6e8835980bb4c", "url": "https://github.com/eclipse-openj9/openj9/commit/30ebdf25291e941eb4cc2f84b1f6e8835980bb4c", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update git version\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>", "committedDate": "2021-05-14T17:35:25Z", "type": "forcePushed"}, {"oid": "fa0877e787498f589b0e154929e9be4d70fc7ed0", "url": "https://github.com/eclipse-openj9/openj9/commit/fa0877e787498f589b0e154929e9be4d70fc7ed0", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n* revert namespace change as that shouldn't have been updated\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>", "committedDate": "2021-05-14T17:36:53Z", "type": "forcePushed"}, {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8", "url": "https://github.com/eclipse-openj9/openj9/commit/4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n* revert namespace change as that shouldn't have been updated\n* move perms adjusting to end of dockerfile so all content is owned by $user\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>", "committedDate": "2021-05-14T17:45:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDU4MTk5Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634581996", "bodyText": "This change doesn't appear to be necessary: the tag 'centos:6.10' is available.", "author": "keithc-ca", "createdAt": "2021-05-18T16:54:02Z", "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -219,12 +220,22 @@ if [ $cuda != no ] ; then\n   echo \"FROM nvidia/cuda:${cuda}-devel-ubuntu16.04 AS cuda-dev\"\n   echo \"\"\n fi\n+if [ $dist = centos ] ; then\n+  echo \"FROM $dist:$dist$version\"\n+else\n   echo \"FROM $dist:$version\"\n+fi", "originalCommit": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDg1MTUwNQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634851505", "bodyText": "When I initially did the tag change and repo change was what I needed to get this functional.  I'll try a run with this and the repo reverted.", "author": "jdekonin", "createdAt": "2021-05-19T01:24:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDU4MTk5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDEzMjkwNQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640132905", "bodyText": "Not required and removed from my next push.", "author": "jdekonin", "createdAt": "2021-05-26T21:26:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDU4MTk5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDU4ODIwOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634588209", "bodyText": "Why do we care about the shell prompt string?\nMuch escaping can be avoided by using single quotes ('); the $ should be escaped, though.\nThe two limits can be changed in one command: ulimit -n 2048 -u 32000.", "author": "keithc-ca", "createdAt": "2021-05-18T17:02:41Z", "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -532,32 +543,33 @@ prepare_user() {\n create_user() {\n   echo \"\"\n   echo \"# Add user home and copy authorized_keys and known_hosts.\"\n-  echo \"RUN useradd -ms /bin/bash $user \\\\\"\n+  echo \"RUN useradd -ms /bin/bash --uid $userid $user \\\\\"\n   echo \" && mkdir /home/$user/.ssh \\\\\"\n   echo \" && chmod 700 /home/$user/.ssh\"\n   echo \"COPY authorized_keys known_hosts /home/$user/.ssh/\"\n-  echo \"RUN chown -R $user:$user /home/$user \\\\\"\n-  echo \" && chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts\"\n+  echo \"RUN chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts \\\\\"\n+  echo \" && echo \\\"PS1=\\\\\\\"\\\\u:DOCKER-CONTAINER $ \\\\\\\"\\\" > /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -u 32000\\\" >> /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -n 2048\\\" >> /home/$user/.bashrc\"", "originalCommit": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDg1MjgwMw==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634852803", "bodyText": "I'll play with modifying.  The reason for the shell prompt was so there was an obvious eyecatcher to indicate that the docker container launch worked and that the job is compiling in the container and not the host.  Purely a debugging/confirmation bit of output for the user.", "author": "jdekonin", "createdAt": "2021-05-19T01:28:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDU4ODIwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDEzNDMyNA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640134324", "bodyText": "In my latest push I cleaned up the ulimit required change for an added user, running as root ulimit value are unlimited so no compile issues are seen.  Also removed PS1 as it not added huge value.", "author": "jdekonin", "createdAt": "2021-05-26T21:28:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDU4ODIwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDUwOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634600509", "bodyText": "CUDA should be selected for ppc64le and x86, independent of the O/S.", "author": "keithc-ca", "createdAt": "2021-05-18T17:21:12Z", "path": "buildenv/jenkins/docker-nodes/jenkinsfile-build-container.groovy", "diffHunk": "@@ -42,9 +42,9 @@ if (\"${OS}\" == \"unknown\" || !(validArch.contains(ARCH))) {\n }\n \n def BUILD_OPTS = \"\"\n-if (\"${OS}\" == \"centos6.9\") {\n+if (\"${OS}\" == \"centos6.10\") {\n     if (\"${ARCH}\" == \"x86\") {\n-        BUILD_OPTS = \"--dist=centos --version=6.9\"\n+        BUILD_OPTS = \"--dist=centos --version=6.10 --cuda\"", "originalCommit": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDg1NDM4Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634854387", "bodyText": "I'll work in for all platforms.", "author": "jdekonin", "createdAt": "2021-05-19T01:34:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDUwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDEzNjU0Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640136547", "bodyText": "I decided against enabling cuda for all platforms here as the files extracted would be from ub16.  I doubt many will be wanting to use ub16 as a container as its out of support.  UB18+ and RH7+ we should likely aim for a version of cuda that would more closely align with the arch and os release.  I think that should be done under a different PR.", "author": "jdekonin", "createdAt": "2021-05-26T21:33:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDUwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk5NDM2Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640994367", "bodyText": "It's only copying some header files from that image; only the version of CUDA should be relevant, but it should probably be updated to a supported OS version.", "author": "keithc-ca", "createdAt": "2021-05-27T21:52:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDUwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MTcwNDc5OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r641704798", "bodyText": "I expect we want to stick with version 9.0 for a while, which is only available on ubuntu 16.04; see https://hub.docker.com/r/nvidia/cuda/tags?page=1&ordering=last_updated&name=9.0.", "author": "keithc-ca", "createdAt": "2021-05-28T17:25:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDUwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDk5NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634600995", "bodyText": "This is the namespace at dockerhub, right?", "author": "keithc-ca", "createdAt": "2021-05-18T17:21:58Z", "path": "buildenv/jenkins/docker-nodes/jenkinsfile-build-container.groovy", "diffHunk": "@@ -62,7 +62,7 @@ if (\"${BUILD_OPTS}\" == \"\") {\n }\n \n def NODE = (params.NODE) ? params.NODE : \"sw.tool.docker && hw.arch.${ARCH}\"\n-def NAMESPACE = (params.NAMESPACE) ? params.NAMESPACE : \"eclipse-openj9\"\n+def NAMESPACE = (params.NAMESPACE) ? params.NAMESPACE : \"openj9\"", "originalCommit": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwOTQyNw==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634609427", "bodyText": "eclipseopenj9, not openj9?\nhttps://hub.docker.com/r/eclipseopenj9/jenkins-agent-x86-centos6", "author": "pshipton", "createdAt": "2021-05-18T17:34:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDk5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDg1NDY2NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634854665", "bodyText": "Correct, I hadn't had the update from the bugzilla I opened to create that repo until earlier today.  I will correct this as well.", "author": "jdekonin", "createdAt": "2021-05-19T01:34:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDk5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDEzNzI5Mg==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640137292", "bodyText": "Corrected to the location in the bugzilla with in my latest push.  I also fixed the REPOSITORY value for the same reason.", "author": "jdekonin", "createdAt": "2021-05-26T21:34:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDk5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMTc1MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634601750", "bodyText": "Why is this needed? Don't the default repo configurations work?", "author": "keithc-ca", "createdAt": "2021-05-18T17:23:03Z", "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -219,12 +220,22 @@ if [ $cuda != no ] ; then\n   echo \"FROM nvidia/cuda:${cuda}-devel-ubuntu16.04 AS cuda-dev\"\n   echo \"\"\n fi\n+if [ $dist = centos ] ; then\n+  echo \"FROM $dist:$dist$version\"\n+else\n   echo \"FROM $dist:$version\"\n+fi\n }\n \n install_centos_packages() {\n+if [ $version = 6.10 ] ; then\n+  echo \"RUN sed -i -e 's|mirrorlist|#mirrorlist|' \\\\\"\n+  echo \"           -e 's|#baseurl=http://mirror.centos.org/centos/\\$releasever|baseurl=https://vault.centos.org/6.10|' \\\\\"\n+  echo \"           /etc/yum.repos.d/CentOS-Base.repo\"\n+  echo \"\"\n+fi", "originalCommit": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDg1MTUxMA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634851510", "bodyText": "When I initially did the tag change and repo change was what I needed to get this functional.  I'll try a run with this and the repo reverted.", "author": "jdekonin", "createdAt": "2021-05-19T01:24:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMTc1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDEzMzU2Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640133563", "bodyText": "CentOS 6 is no longer hosted at mirror.centos.org as per http://mirror.centos.org/centos/6/readme so I modify the system default to redirected to the vault/archive location.", "author": "jdekonin", "createdAt": "2021-05-26T21:27:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMTc1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDc1NzAzOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640757039", "bodyText": "Why are we not heeding the warning in that readme file?\n\nThe whole CentOS 6 is dead and shouldn't be used anywhere at all", "author": "keithc-ca", "createdAt": "2021-05-27T15:53:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMTc1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk2NTQyOA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640965428", "bodyText": "We are still using as this is the operating system that is used at Eclipse Adoptium for JDK8 x86(-64) support.", "author": "jdekonin", "createdAt": "2021-05-27T21:05:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMTc1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk5NTU4MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640995580", "bodyText": "Not just jdk8, but jdk11+ as well.", "author": "pshipton", "createdAt": "2021-05-27T21:55:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMTc1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMzM0NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634603345", "bodyText": "Does buildenv/ansible/roles/openj9-from-sources/tasks/main.yml need to change too?", "author": "keithc-ca", "createdAt": "2021-05-18T17:25:26Z", "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -532,32 +543,33 @@ prepare_user() {\n create_user() {\n   echo \"\"\n   echo \"# Add user home and copy authorized_keys and known_hosts.\"\n-  echo \"RUN useradd -ms /bin/bash $user \\\\\"\n+  echo \"RUN useradd -ms /bin/bash --uid $userid $user \\\\\"\n   echo \" && mkdir /home/$user/.ssh \\\\\"\n   echo \" && chmod 700 /home/$user/.ssh\"\n   echo \"COPY authorized_keys known_hosts /home/$user/.ssh/\"\n-  echo \"RUN chown -R $user:$user /home/$user \\\\\"\n-  echo \" && chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts\"\n+  echo \"RUN chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts \\\\\"\n+  echo \" && echo \\\"PS1=\\\\\\\"\\\\u:DOCKER-CONTAINER $ \\\\\\\"\\\" > /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -u 32000\\\" >> /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -n 2048\\\" >> /home/$user/.bashrc\"\n+}\n+\n+adjust_user_directory_perms() {\n+  echo \"RUN chown -R $user:$user /home/$user\"\n }\n \n install_freemarker() {\n   echo \"\"\n   local freemarker_version=2.3.8\n-  echo \"# Download and extract freemarker.jar to /root/freemarker.jar.\"\n-  echo \"RUN mkdir -p /root \\\\\"\n-  echo \" && cd /root \\\\\"\n+  echo \"# Download and extract freemarker.jar to /home/$user/freemarker.jar.\"", "originalCommit": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDg1NDI3Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634854276", "bodyText": "I don't see how that is related to this bit of code?  But I suppose that can be modified as well.  The docker files that were replaced with this script were originally written for the build system to use which uses a basic user and not root user.  The user specific changes from /root -> /home/$user/ will mean a minor change to devs that use these yes, but if they are running as root they should have full access /home/$user/.\nFor freemarker.jar...is this actually a requirement for x/p/z linux platforms any more?", "author": "jdekonin", "createdAt": "2021-05-19T01:33:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMzM0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNTQ2NjU2MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r635466560", "bodyText": "x/p/z Linux all use cmake by default. It may be time to remove freemarker from the script.\nOpinions, @pshipton?", "author": "keithc-ca", "createdAt": "2021-05-19T17:57:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMzM0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNTUyMTEwNQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r635521105", "bodyText": "How about we comment it out, so it's not installed by default, but a user can uncomment if needed.", "author": "pshipton", "createdAt": "2021-05-19T19:20:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMzM0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNTU0MTcxMA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r635541710", "bodyText": "If you mean hide the call to install_freemarker like this, I agree:\n# install_freemarker", "author": "keithc-ca", "createdAt": "2021-05-19T19:54:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMzM0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNTU0Nzk1NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r635547955", "bodyText": "Yes, that is what I mean.", "author": "pshipton", "createdAt": "2021-05-19T20:05:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMzM0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDEzNDgzMg==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640134832", "bodyText": "Commented out in my latest push.", "author": "jdekonin", "createdAt": "2021-05-26T21:29:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMzM0NQ=="}], "type": "inlineReview"}, {"oid": "b51d668322ab259e81c3fda831180c8056b56ab1", "url": "https://github.com/eclipse-openj9/openj9/commit/b51d668322ab259e81c3fda831180c8056b56ab1", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* update namespace to reference new repo location\n* move perms adjusting to end of dockerfile so all content is owned by $user\n* comment out freemarker requirement as its no longer in use\n* remove non-existent ius-release-el6.rpm\n* modified SDK location as builds were modified to reference $USER_HOME/bootjdks/\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>", "committedDate": "2021-05-26T21:51:36Z", "type": "forcePushed"}, {"oid": "367bf68e3396e4032dd7d65be9993b36dccf80c0", "url": "https://github.com/eclipse-openj9/openj9/commit/367bf68e3396e4032dd7d65be9993b36dccf80c0", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* update namespace to reference new repo location\n* move perms adjusting to end of dockerfile so all content is owned by $user\n* comment out freemarker requirement as its no longer in use\n* remove non-existent ius-release-el6.rpm\n* modified SDK location as builds were modified to reference $USER_HOME/bootjdks/\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>", "committedDate": "2021-05-27T02:09:37Z", "type": "forcePushed"}, {"oid": "76db7afff254ae22071c15755ef61542626db6a4", "url": "https://github.com/eclipse-openj9/openj9/commit/76db7afff254ae22071c15755ef61542626db6a4", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* update namespace to reference new repo location\n* move perms adjusting to end of dockerfile so all content is owned by $user\n* comment out freemarker requirement as its no longer in use\n* remove non-existent ius-release-el6.rpm\n* modified SDK location as builds were modified to reference $USER_HOME/bootjdks/\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>", "committedDate": "2021-05-27T02:21:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDc1MjIzMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640752231", "bodyText": "This could be simplified so it doesn't need to mention individual files:\n  chmod -R go= /home/$user/.ssh", "author": "keithc-ca", "createdAt": "2021-05-27T15:48:04Z", "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -532,32 +536,31 @@ prepare_user() {\n create_user() {\n   echo \"\"\n   echo \"# Add user home and copy authorized_keys and known_hosts.\"\n-  echo \"RUN useradd -ms /bin/bash $user \\\\\"\n+  echo \"RUN useradd -ms /bin/bash --uid $userid $user \\\\\"\n   echo \" && mkdir /home/$user/.ssh \\\\\"\n   echo \" && chmod 700 /home/$user/.ssh\"\n   echo \"COPY authorized_keys known_hosts /home/$user/.ssh/\"\n-  echo \"RUN chown -R $user:$user /home/$user \\\\\"\n-  echo \" && chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts\"\n+  echo \"RUN chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts \\\\\"", "originalCommit": "76db7afff254ae22071c15755ef61542626db6a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk2NTMyNg==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640965326", "bodyText": "Added to this latest commit.", "author": "jdekonin", "createdAt": "2021-05-27T21:05:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDc1MjIzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDc1MzQ4Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640753483", "bodyText": "I'd prefer to see this controlled by an option, say, --freemarker.", "author": "keithc-ca", "createdAt": "2021-05-27T15:49:32Z", "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -671,7 +674,7 @@ print_dockerfile() {\n if [ $cuda != no ] ; then\n   install_cuda\n fi\n-  install_freemarker\n+  #install_freemarker", "originalCommit": "76db7afff254ae22071c15755ef61542626db6a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk2NTA3MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640965070", "bodyText": "Added to this latest commit.", "author": "jdekonin", "createdAt": "2021-05-27T21:04:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDc1MzQ4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDc1NDExNQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640754115", "bodyText": "Is the slash in /https intentional?", "author": "keithc-ca", "createdAt": "2021-05-27T15:50:18Z", "path": "buildenv/jenkins/docker-nodes/README.md", "diffHunk": "@@ -34,32 +34,32 @@ same environment every time.\n |:---------:|:------------:|:-------------:|:-------------:|\n | Ubuntu16  |  Test Only   | Build & Test  |   Test Only   |\n | Ubuntu18  |  Test Only   |   Test Only   |   Test Only   |\n-| Centos6.9 | Build & Test | Not Available | Not Available |\n+| Centos6   | Build & Test | Not Available | Not Available |\n | Centos7   | To be Added  |  To be Added  | Build & Test  |\n | Windows   | To be Added  | Not Available | Not Available |\n \n ## Eclipse OpenJ9 CI\n Generated Dockerfiles are used by two Jenkins jobs at Eclipse to\n-build docker images. The first [job](https://ci.eclipse.org/openj9/view/Build/job/Build-Jenkins-Agent-Container/) is run manually\n+build docker images. The first [job](/https://openj9-jenkins.osuosl.org/job/Build-Jenkins-Agent-Container/) is run manually", "originalCommit": "76db7afff254ae22071c15755ef61542626db6a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk2NTI0Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640965243", "bodyText": "Accidental, corrected in the latest commit.", "author": "jdekonin", "createdAt": "2021-05-27T21:04:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDc1NDExNQ=="}], "type": "inlineReview"}, {"oid": "cf51c6e8e0801cddf5a12f78ff50b48817ae2e00", "url": "https://github.com/eclipse-openj9/openj9/commit/cf51c6e8e0801cddf5a12f78ff50b48817ae2e00", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* update namespace to reference new repo location\n** add epel repo to get libdwarf\n* move perms adjusting to end of dockerfile so all content is owned by $user\n* make freemarker option\n* remove non-existent ius-release-el6.rpm\n* modified SDK location as builds were modified to reference $USER_HOME/bootjdks/\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>", "committedDate": "2021-05-27T21:00:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk3MjczMA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640972730", "bodyText": "The options were listed in alphabetical order, and the variables and cases were ordered likewise.", "author": "keithc-ca", "createdAt": "2021-05-27T21:16:35Z", "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -33,16 +33,17 @@ usage() {\n   echo \"  --arch=...     specify the processor architecture (default: host architecture)\"\n   echo \"  --build        build the docker image (overrides '--print')\"\n   echo \"  --cuda         include CUDA header files\"\n+  echo \"  --freemarker   include freemarker.jar\"", "originalCommit": "cf51c6e8e0801cddf5a12f78ff50b48817ae2e00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk4NzQwMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640987401", "bodyText": "Moved", "author": "jdekonin", "createdAt": "2021-05-27T21:38:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk3MjczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk5NDY1NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640994655", "bodyText": "I wasn't going to insist, but thanks.", "author": "keithc-ca", "createdAt": "2021-05-27T21:52:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk3MjczMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk3ODY5Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640978696", "bodyText": "What is this for? Isn't it redundant with the -y option in yum install -y?", "author": "keithc-ca", "createdAt": "2021-05-27T21:26:08Z", "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -223,10 +229,15 @@ fi\n }\n \n install_centos_packages() {\n-  echo \"RUN yum -y update \\\\\"\n-if [ $version = 6.9 ] ; then\n-  echo \" && yum -y install https://repo.ius.io/ius-release-el6.rpm \\\\\"\n+if [ $version = 6 ] ; then\n+  echo \"RUN sed -i -e 's|mirrorlist|#mirrorlist|' \\\\\"\n+  echo \"           -e 's|#baseurl=http://mirror.centos.org/centos/\\$releasever|baseurl=https://vault.centos.org/6.10|' \\\\\"\n+  echo \"           /etc/yum.repos.d/CentOS-Base.repo\"\n+  echo \"\"\n fi\n+  echo \"RUN yum -y update \\\\\"\n+  echo \" && echo \"assumeyes=1\" >> /etc/yum.conf \\\\\"", "originalCommit": "cf51c6e8e0801cddf5a12f78ff50b48817ae2e00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk4ODc1NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640988755", "bodyText": "The extra line for yum.conf was because I had a failure/prompt with the epel-release repo line.  But I cannot seem to reproduce in a minimal testcase.  I removed.", "author": "jdekonin", "createdAt": "2021-05-27T21:40:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk3ODY5Ng=="}], "type": "inlineReview"}, {"oid": "3b548d51cc02031024938279a66421f458b7144a", "url": "https://github.com/eclipse-openj9/openj9/commit/3b548d51cc02031024938279a66421f458b7144a", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* update namespace to reference new repo location\n** add epel repo to get libdwarf\n* move perms adjusting to end of dockerfile so all content is owned by $user\n* make freemarker option\n* remove non-existent ius-release-el6.rpm\n* modified SDK location as builds were modified to reference $USER_HOME/bootjdks/\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>", "committedDate": "2021-05-27T21:36:40Z", "type": "commit"}, {"oid": "3b548d51cc02031024938279a66421f458b7144a", "url": "https://github.com/eclipse-openj9/openj9/commit/3b548d51cc02031024938279a66421f458b7144a", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* update namespace to reference new repo location\n** add epel repo to get libdwarf\n* move perms adjusting to end of dockerfile so all content is owned by $user\n* make freemarker option\n* remove non-existent ius-release-el6.rpm\n* modified SDK location as builds were modified to reference $USER_HOME/bootjdks/\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>", "committedDate": "2021-05-27T21:36:40Z", "type": "forcePushed"}]}