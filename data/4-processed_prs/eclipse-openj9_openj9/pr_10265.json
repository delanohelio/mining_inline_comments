{"pr_number": 10265, "pr_title": "Switch to using fixedLoadLabelAddressIntoReg when loading snippet addresses", "pr_createdAt": "2020-07-28T03:16:03Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10265", "timeline": [{"oid": "2628732dfe516453b63918c8add6f2f4fb140381", "url": "https://github.com/eclipse-openj9/openj9/commit/2628732dfe516453b63918c8add6f2f4fb140381", "message": "Use fixedLoadLabelAddressIntoReg for PPCInterfaceCallSnippet\n\nPreviously, the address of the PPCInterfaceCallSnippet data section\nwould be loaded in mainline code by having the snippet manually either\npatch instructions in mainline code or fill in the pTOC with the correct\naddress.\n\nIn order to simplify this code and allow exploitation of P10 PC-relative\npaddi, this code has been modified to use the fixedLoadLabelAddressIntoReg\nhelper to accomplish this task.\n\nSigned-off-by: Ben Thomas <ben@benthomas.ca>", "committedDate": "2020-07-28T18:50:46Z", "type": "forcePushed"}, {"oid": "db165c3057092eff9bfb9524ab29931a9e4e74fa", "url": "https://github.com/eclipse-openj9/openj9/commit/db165c3057092eff9bfb9524ab29931a9e4e74fa", "message": "Use fixedLoadLabelAddressIntoReg for Power field watch snippets\n\nPreviously, the address of Power static and instance field watch\nsnippets was being loaded into a register by having the snippet manually\npatch mainline code and fill in the pTOC where necessary. This has been\nsimplified by using fixedLoadLabelAddressIntoReg to load the address of\nthe snippet label. In addition to reducing code complexity, this allows\nPC-relative paddi to be used when POWER10 support is enabled.\n\nSigned-off-by: Ben Thomas <ben@benthomas.ca>", "committedDate": "2020-07-27T20:39:37Z", "type": "forcePushed"}, {"oid": "3fb2dfd068ca332095c5ff8948c9f1afa2e9bea6", "url": "https://github.com/eclipse-openj9/openj9/commit/3fb2dfd068ca332095c5ff8948c9f1afa2e9bea6", "message": "Use fixedLoadLabelAddressIntoReg for Power field watch snippets\n\nPreviously, the address of Power static and instance field watch\nsnippets was being loaded into a register by having the snippet manually\npatch mainline code and fill in the pTOC where necessary. This has been\nsimplified by using fixedLoadLabelAddressIntoReg to load the address of\nthe snippet label. In addition to reducing code complexity, this allows\nPC-relative paddi to be used when POWER10 support is enabled.\n\nSigned-off-by: Ben Thomas <ben@benthomas.ca>", "committedDate": "2020-08-11T19:55:16Z", "type": "commit"}, {"oid": "3fb2dfd068ca332095c5ff8948c9f1afa2e9bea6", "url": "https://github.com/eclipse-openj9/openj9/commit/3fb2dfd068ca332095c5ff8948c9f1afa2e9bea6", "message": "Use fixedLoadLabelAddressIntoReg for Power field watch snippets\n\nPreviously, the address of Power static and instance field watch\nsnippets was being loaded into a register by having the snippet manually\npatch mainline code and fill in the pTOC where necessary. This has been\nsimplified by using fixedLoadLabelAddressIntoReg to load the address of\nthe snippet label. In addition to reducing code complexity, this allows\nPC-relative paddi to be used when POWER10 support is enabled.\n\nSigned-off-by: Ben Thomas <ben@benthomas.ca>", "committedDate": "2020-08-11T19:55:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ0NzY4Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/10265#discussion_r472447686", "bodyText": "I suppose TR::J9WatchedInstanceFieldSnippet::emitSnippetBody()  is still going to happen?", "author": "gita-omr", "createdAt": "2020-08-18T20:02:48Z", "path": "runtime/compiler/p/codegen/J9PPCWatchedInstanceFieldSnippet.cpp", "diffHunk": "@@ -1,65 +0,0 @@\n-/*******************************************************************************\n- * Copyright (c) 2019, 2020 IBM Corp. and others\n- *\n- * This program and the accompanying materials are made available under\n- * the terms of the Eclipse Public License 2.0 which accompanies this\n- * distribution and is available at https://www.eclipse.org/legal/epl-2.0/\n- * or the Apache License, Version 2.0 which accompanies this distribution and\n- * is available at https://www.apache.org/licenses/LICENSE-2.0.\n- *\n- * This Source Code may also be made available under the following\n- * Secondary Licenses when the conditions for such availability set\n- * forth in the Eclipse Public License, v. 2.0 are satisfied: GNU\n- * General Public License, version 2 with the GNU Classpath\n- * Exception [1] and GNU General Public License, version 2 with the\n- * OpenJDK Assembly Exception [2].\n- *\n- * [1] https://www.gnu.org/software/classpath/license.html\n- * [2] http://openjdk.java.net/legal/assembly-exception.html\n- *\n- * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0 OR GPL-2.0 WITH Classpath-exception-2.0 OR LicenseRef-GPL-2.0 WITH Assembly-exception\n- *******************************************************************************/\n-\n-#include \"codegen/J9PPCWatchedInstanceFieldSnippet.hpp\"\n-#include \"p/codegen/PPCTableOfConstants.hpp\" //PTOC\n-\n-\n-uint8_t *TR::J9PPCWatchedInstanceFieldSnippet::emitSnippetBody()\n-   {\n-   // Call Base class's emitSnippetBody() to populate the snippet\n-   // Here Binary Buffer will be ahead by the size of the struct J9JITWatchedInstanceFieldData\n-   uint8_t *snippetLocation = (TR::J9WatchedInstanceFieldSnippet::emitSnippetBody() - TR::J9WatchedInstanceFieldSnippet::getLength(0));", "originalCommit": "3fb2dfd068ca332095c5ff8948c9f1afa2e9bea6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ2Mzc0Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/10265#discussion_r472463746", "bodyText": "Yes. By removing the overridden version of emitSnippetBody() from this class, the superclass implementation from TR::J9WatchedInstanceFieldSnippet will be called directly.", "author": "aviansie-ben", "createdAt": "2020-08-18T20:20:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ0NzY4Ng=="}], "type": "inlineReview"}]}