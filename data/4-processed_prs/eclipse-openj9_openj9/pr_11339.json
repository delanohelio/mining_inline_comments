{"pr_number": 11339, "pr_title": "Fix withField access check", "pr_createdAt": "2020-12-02T18:49:59Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/11339", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDYwMjU4NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11339#discussion_r534602585", "bodyText": "C++ file, so you can declare the variable when it is assigned below.", "author": "gacholio", "createdAt": "2020-12-03T01:40:46Z", "path": "runtime/vm/resolvesupport.cpp", "diffHunk": "@@ -931,6 +931,7 @@ resolveInstanceFieldRefInto(J9VMThread *vmStruct, J9Method *method, J9ConstantPo\n \t\tJ9Class *flattenableClass = NULL;\n \t\tJ9FlattenedClassCache *flattenedClassCache = NULL;\n #endif\t\t\n+\t\tbool isWithField = false;", "originalCommit": "5e95ba88f0111b4fadd3c1eebeaaf0a4c7bdc891", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM0NTEzNw==", "url": "https://github.com/eclipse-openj9/openj9/pull/11339#discussion_r535345137", "bodyText": "If I move the declaration to where it is assigned below, I get a compilation error. There is a goto illegalAccess before the assignment.", "author": "hangshao0", "createdAt": "2020-12-03T15:41:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDYwMjU4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM2NDkyNA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11339#discussion_r535364924", "bodyText": "OK.", "author": "gacholio", "createdAt": "2020-12-03T16:02:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDYwMjU4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTMzNzgwMw==", "url": "https://github.com/eclipse-openj9/openj9/pull/11339#discussion_r535337803", "bodyText": "why is the J9FieldFlagPutResolved check removed", "author": "tajila", "createdAt": "2020-12-03T15:34:33Z", "path": "runtime/vm/BytecodeInterpreter.hpp", "diffHunk": "@@ -8674,12 +8674,12 @@ class INTERPRETER_CLASS\n \t\t * a field ref as resolved if only one of the two values has been set (by\n \t\t * another thread that is in the middle of a resolve).\n \t\t */\n-\t\tif (J9_UNEXPECTED((flags <= valueOffset) || J9_ARE_NO_BITS_SET(flags, J9FieldFlagPutResolved))) {", "originalCommit": "5e95ba88f0111b4fadd3c1eebeaaf0a4c7bdc891", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTMzOTk4Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/11339#discussion_r535339986", "bodyText": "ah I see, its only set with the J9_RESOLVE_FLAG_FIELD_SETTER flag", "author": "tajila", "createdAt": "2020-12-03T15:36:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTMzNzgwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM0OTg0OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/11339#discussion_r535349848", "bodyText": "Minor: we can start using !VM_VMHelpers::instanceFieldRefIsResolved(flags, valueOffset) for this check", "author": "tajila", "createdAt": "2020-12-03T15:45:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTMzNzgwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ5Nzg4OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/11339#discussion_r535497889", "bodyText": "Updated.", "author": "hangshao0", "createdAt": "2020-12-03T18:57:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTMzNzgwMw=="}], "type": "inlineReview"}, {"oid": "5947ed6b081e44e0a57c37fe05ce09b025a04296", "url": "https://github.com/eclipse-openj9/openj9/commit/5947ed6b081e44e0a57c37fe05ce09b025a04296", "message": "Fix withField access check\n\n1. Remove J9_RESOLVE_FLAG_FIELD_SETTER on withField.\n2. Add nestmate check for withField.\n\nFixes #11084\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>", "committedDate": "2020-12-03T18:57:02Z", "type": "forcePushed"}, {"oid": "5947ed6b081e44e0a57c37fe05ce09b025a04296", "url": "https://github.com/eclipse-openj9/openj9/commit/5947ed6b081e44e0a57c37fe05ce09b025a04296", "message": "Fix withField access check\n\n1. Remove J9_RESOLVE_FLAG_FIELD_SETTER on withField.\n2. Add nestmate check for withField.\n\nFixes #11084\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>", "committedDate": "2020-12-03T18:57:02Z", "type": "commit"}]}