{"pr_number": 9904, "pr_title": "Retrieve info from the client in isClassRefValueType", "pr_createdAt": "2020-06-16T16:59:27Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/9904", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAzNjI5Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/9904#discussion_r441036297", "bodyText": "Could we shed one level of indirection by calling comp->fej9()->getJ9JITConfig()->javaVM here?", "author": "mpirvu", "createdAt": "2020-06-16T17:53:52Z", "path": "runtime/compiler/env/J9ClassEnv.cpp", "diffHunk": "@@ -735,7 +735,17 @@ J9::ClassEnv::containsZeroOrOneConcreteClass(TR::Compilation *comp, List<TR_Pers\n bool\n J9::ClassEnv::isClassRefValueType(TR::Compilation *comp, TR_OpaqueClassBlock *cpContextClass, int32_t cpIndex)\n    {\n-   J9Class * j9class = reinterpret_cast<J9Class *>(cpContextClass);\n-   J9JavaVM *vm = getJ9JitConfigFromFE(comp->fej9())->javaVM;\n-   return vm->internalVMFunctions->isClassRefQtype(j9class, cpIndex);\n+#if defined(J9VM_OPT_JITSERVER)\n+   if (auto stream = TR::CompilationInfo::getStream())\n+      {\n+      stream->write(JITServer::MessageType::ClassEnv_isClassRefValueType, cpContextClass, cpIndex);\n+      return std::get<0>(stream->read<bool>());\n+      }\n+   else // non-jitserver\n+#endif /* defined(J9VM_OPT_JITSERVER) */\n+      {\n+      J9Class * j9class = reinterpret_cast<J9Class *>(cpContextClass);\n+      J9JavaVM *vm = getJ9JitConfigFromFE(comp->fej9())->javaVM;", "originalCommit": "2e6f38680299c86c4f747987ba8838129bc7cf68", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b5bc4e897d607999d1c6462a80fb1886184da4db", "url": "https://github.com/eclipse-openj9/openj9/commit/b5bc4e897d607999d1c6462a80fb1886184da4db", "message": "Retrieve info from the client in isClassRefValueType\n\nThe query of isClassRefValueType should be done at the client\ninstead of the server. Sending a message to the client to\ncheck if a class reference entry in the constant pool\nrepresents a value type class.\n\nFixes #9892\n\nSigned-off-by: Annabelle Huo <Annabelle.Huo@ibm.com>", "committedDate": "2020-06-16T18:31:26Z", "type": "commit"}, {"oid": "b5bc4e897d607999d1c6462a80fb1886184da4db", "url": "https://github.com/eclipse-openj9/openj9/commit/b5bc4e897d607999d1c6462a80fb1886184da4db", "message": "Retrieve info from the client in isClassRefValueType\n\nThe query of isClassRefValueType should be done at the client\ninstead of the server. Sending a message to the client to\ncheck if a class reference entry in the constant pool\nrepresents a value type class.\n\nFixes #9892\n\nSigned-off-by: Annabelle Huo <Annabelle.Huo@ibm.com>", "committedDate": "2020-06-16T18:31:26Z", "type": "forcePushed"}]}