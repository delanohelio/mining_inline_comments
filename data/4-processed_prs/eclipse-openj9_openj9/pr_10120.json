{"pr_number": 10120, "pr_title": "Part 1: JEP 360 Sealed Classes", "pr_createdAt": "2020-07-08T18:30:43Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10120", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc1MDI2Mg==", "url": "https://github.com/eclipse-openj9/openj9/pull/10120#discussion_r453750262", "bodyText": "Please use a local to avoid the multiple returns.", "author": "gacholio", "createdAt": "2020-07-13T15:49:19Z", "path": "runtime/bcutil/ClassFileOracle.hpp", "diffHunk": "@@ -973,6 +973,16 @@ class RecordComponentIterator\n \tbool needsStaticConstantInit() const { return _needsStaticConstantInit; }\n \tbool isRecord() const { return _isRecord; }\n \tU_16 getRecordComponentCount() const { return _recordComponentCount; }\n+\tbool isSealed() const { return _isSealed; }\n+\tU_16 getPermittedSubclassesClassCount() const { return _isSealed ? _permittedSubclassesAttribute->numberOfClasses : 0; }\n+\n+\tU_16 getPermittedSubclassesClassNameAtIndex(U_16 index) const {\n+\t\tif (!_isSealed) return 0;", "originalCommit": "93e5f539c1ce8135db3450dec3a7a324de6f4d2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc1ODQ4MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10120#discussion_r453758481", "bodyText": "This only returns NULL if passed NULL as the object, so I don't think you need to native OOM handling at all.", "author": "gacholio", "createdAt": "2020-07-13T16:01:29Z", "path": "runtime/jcl/common/reflecthelp.c", "diffHunk": "@@ -1952,3 +1952,72 @@ getRecordComponentsHelper(JNIEnv *env, jobject cls)\n \tvmFuncs->internalExitVMToJNI(vmThread);\n \treturn result;\n }\n+\n+/* Create an array of string names for class's PermittedSubclasses */\n+jarray\n+permittedSubclassesHelper(JNIEnv *env, jobject cls)\n+{\n+\tJ9VMThread *vmThread = (J9VMThread *)env;\n+\tJ9JavaVM *vm = vmThread->javaVM;\n+\tJ9InternalVMFunctions *vmFuncs = vm->internalVMFunctions;\n+\tJ9MemoryManagerFunctions *mmFuncs = vm->memoryManagerFunctions;\n+\tJ9Class *clazz = NULL;\n+\tJ9ROMClass *romClass = NULL;\n+\tjarray result = NULL;\n+\tJ9Class *stringClass = NULL;\n+\tJ9Class *stringArrayClass = NULL;\n+\tU_32 *permittedSubclassesCountPtr = 0;\n+\tj9array_t stringArrayObject = NULL;\n+\n+\tvmFuncs->internalEnterVMFromJNI(vmThread);\n+\n+\tclazz = J9VM_J9CLASS_FROM_JCLASS(vmThread, (jclass)cls);\n+\tromClass = clazz->romClass;\n+\n+\t/* allocate String array for results */\n+\tstringClass = J9VMJAVALANGSTRING(vm);\n+\tif (NULL != vmThread->currentException) {\n+\t\tgoto done;\n+\t}\n+\tstringArrayClass = fetchArrayClass(vmThread, stringClass);\n+\tif (NULL != vmThread->currentException) {\n+\t\tgoto done;\n+\t}\n+\n+\tpermittedSubclassesCountPtr = getNumberOfPermittedSubclassesPtr(romClass);\n+\n+\tstringArrayObject = (j9array_t) mmFuncs->J9AllocateIndexableObject(vmThread, stringArrayClass,\n+\t\t\t\t*permittedSubclassesCountPtr, J9_GC_ALLOCATE_OBJECT_NON_INSTRUMENTABLE);\n+\tif (NULL == stringArrayObject) {\n+\t\tgoto heapoutofmemory;\n+\t}\n+\n+\tresult = vmFuncs->j9jni_createLocalRef(env, (j9object_t)stringArrayObject);", "originalCommit": "93e5f539c1ce8135db3450dec3a7a324de6f4d2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc3MjE3OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10120#discussion_r453772178", "bodyText": "If you or J9_STR_XLAT into the flags here, you could avoid the translation in the java code.", "author": "gacholio", "createdAt": "2020-07-13T16:23:16Z", "path": "runtime/jcl/common/reflecthelp.c", "diffHunk": "@@ -1952,3 +1952,72 @@ getRecordComponentsHelper(JNIEnv *env, jobject cls)\n \tvmFuncs->internalExitVMToJNI(vmThread);\n \treturn result;\n }\n+\n+/* Create an array of string names for class's PermittedSubclasses */\n+jarray\n+permittedSubclassesHelper(JNIEnv *env, jobject cls)\n+{\n+\tJ9VMThread *vmThread = (J9VMThread *)env;\n+\tJ9JavaVM *vm = vmThread->javaVM;\n+\tJ9InternalVMFunctions *vmFuncs = vm->internalVMFunctions;\n+\tJ9MemoryManagerFunctions *mmFuncs = vm->memoryManagerFunctions;\n+\tJ9Class *clazz = NULL;\n+\tJ9ROMClass *romClass = NULL;\n+\tjarray result = NULL;\n+\tJ9Class *stringClass = NULL;\n+\tJ9Class *stringArrayClass = NULL;\n+\tU_32 *permittedSubclassesCountPtr = 0;\n+\tj9array_t stringArrayObject = NULL;\n+\n+\tvmFuncs->internalEnterVMFromJNI(vmThread);\n+\n+\tclazz = J9VM_J9CLASS_FROM_JCLASS(vmThread, (jclass)cls);\n+\tromClass = clazz->romClass;\n+\n+\t/* allocate String array for results */\n+\tstringClass = J9VMJAVALANGSTRING(vm);\n+\tif (NULL != vmThread->currentException) {\n+\t\tgoto done;\n+\t}\n+\tstringArrayClass = fetchArrayClass(vmThread, stringClass);\n+\tif (NULL != vmThread->currentException) {\n+\t\tgoto done;\n+\t}\n+\n+\tpermittedSubclassesCountPtr = getNumberOfPermittedSubclassesPtr(romClass);\n+\n+\tstringArrayObject = (j9array_t) mmFuncs->J9AllocateIndexableObject(vmThread, stringArrayClass,\n+\t\t\t\t*permittedSubclassesCountPtr, J9_GC_ALLOCATE_OBJECT_NON_INSTRUMENTABLE);\n+\tif (NULL == stringArrayObject) {\n+\t\tgoto heapoutofmemory;\n+\t}\n+\n+\tresult = vmFuncs->j9jni_createLocalRef(env, (j9object_t)stringArrayObject);\n+\tif (NULL == result) {\n+\t\tgoto nativeoutofmemory;\n+\t}\n+\n+\tfor (U_32 index = 0; index < *permittedSubclassesCountPtr; index++) {\n+\t\tJ9UTF8* nameUTF = NULL;\n+\t\tj9object_t nameString = NULL;\n+\n+\t\tnameUTF = permittedSubclassesNameAtIndex(permittedSubclassesCountPtr, index);\n+\t\tnameString = mmFuncs->j9gc_createJavaLangString(vmThread, J9UTF8_DATA(nameUTF), (U_32) J9UTF8_LENGTH(nameUTF), J9_STR_INTERN);", "originalCommit": "93e5f539c1ce8135db3450dec3a7a324de6f4d2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc3MzU0Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/10120#discussion_r453773543", "bodyText": "explaination is misspelled", "author": "gacholio", "createdAt": "2020-07-13T16:25:25Z", "path": "runtime/nls/cfre/cfrerr.nls", "diffHunk": "@@ -1529,3 +1529,34 @@ J9NLS_CFR_LVTT_DOES_NOT_MATCH_LVT.explanation=Please consult the Java Virtual Ma\n J9NLS_CFR_LVTT_DOES_NOT_MATCH_LVT.system_action=The JVM will throw a verification or classloading-related exception such as java.lang.ClassFormatError.\n J9NLS_CFR_LVTT_DOES_NOT_MATCH_LVT.user_response=Contact the provider of the classfile for a corrected version.\n # END NON-TRANSLATABLE\n+\n+# PermittedSubclasses is not translatable\n+J9NLS_CFR_ERR_MULTIPLE_PERMITTEDSUBCLASSES_ATTRIBUTES=multiple PermittedSubclasses attributes\n+# START NON-TRANSLATABLE\n+J9NLS_CFR_ERR_MULTIPLE_PERMITTEDSUBCLASSES_ATTRIBUTES.explanation=Please consult the Java Virtual Machine Specification for a detailed explaination.", "originalCommit": "93e5f539c1ce8135db3450dec3a7a324de6f4d2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc3MzcxMw==", "url": "https://github.com/eclipse-openj9/openj9/pull/10120#discussion_r453773713", "bodyText": "Same misspelling", "author": "gacholio", "createdAt": "2020-07-13T16:25:39Z", "path": "runtime/nls/cfre/cfrerr.nls", "diffHunk": "@@ -1529,3 +1529,34 @@ J9NLS_CFR_LVTT_DOES_NOT_MATCH_LVT.explanation=Please consult the Java Virtual Ma\n J9NLS_CFR_LVTT_DOES_NOT_MATCH_LVT.system_action=The JVM will throw a verification or classloading-related exception such as java.lang.ClassFormatError.\n J9NLS_CFR_LVTT_DOES_NOT_MATCH_LVT.user_response=Contact the provider of the classfile for a corrected version.\n # END NON-TRANSLATABLE\n+\n+# PermittedSubclasses is not translatable\n+J9NLS_CFR_ERR_MULTIPLE_PERMITTEDSUBCLASSES_ATTRIBUTES=multiple PermittedSubclasses attributes\n+# START NON-TRANSLATABLE\n+J9NLS_CFR_ERR_MULTIPLE_PERMITTEDSUBCLASSES_ATTRIBUTES.explanation=Please consult the Java Virtual Machine Specification for a detailed explaination.\n+J9NLS_CFR_ERR_MULTIPLE_PERMITTEDSUBCLASSES_ATTRIBUTES.system_action=The JVM will throw a verification or classloading-related exception such as java.lang.ClassFormatError.\n+J9NLS_CFR_ERR_MULTIPLE_PERMITTEDSUBCLASSES_ATTRIBUTES.user_response=Contact the provider of the classfile for a corrected version.\n+# END NON-TRANSLATABLE\n+\n+J9NLS_CFR_FINAL_CLASS_CANNOT_BE_SEALED=final classes cannot be sealed\n+# START NON-TRANSLATABLE\n+J9NLS_CFR_FINAL_CLASS_CANNOT_BE_SEALED.explanation=Please consult the Java Virtual Machine Specification for a detailed explaination.", "originalCommit": "93e5f539c1ce8135db3450dec3a7a324de6f4d2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc3Mzg2NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10120#discussion_r453773865", "bodyText": "spelling", "author": "gacholio", "createdAt": "2020-07-13T16:25:53Z", "path": "runtime/nls/cfre/cfrerr.nls", "diffHunk": "@@ -1529,3 +1529,34 @@ J9NLS_CFR_LVTT_DOES_NOT_MATCH_LVT.explanation=Please consult the Java Virtual Ma\n J9NLS_CFR_LVTT_DOES_NOT_MATCH_LVT.system_action=The JVM will throw a verification or classloading-related exception such as java.lang.ClassFormatError.\n J9NLS_CFR_LVTT_DOES_NOT_MATCH_LVT.user_response=Contact the provider of the classfile for a corrected version.\n # END NON-TRANSLATABLE\n+\n+# PermittedSubclasses is not translatable\n+J9NLS_CFR_ERR_MULTIPLE_PERMITTEDSUBCLASSES_ATTRIBUTES=multiple PermittedSubclasses attributes\n+# START NON-TRANSLATABLE\n+J9NLS_CFR_ERR_MULTIPLE_PERMITTEDSUBCLASSES_ATTRIBUTES.explanation=Please consult the Java Virtual Machine Specification for a detailed explaination.\n+J9NLS_CFR_ERR_MULTIPLE_PERMITTEDSUBCLASSES_ATTRIBUTES.system_action=The JVM will throw a verification or classloading-related exception such as java.lang.ClassFormatError.\n+J9NLS_CFR_ERR_MULTIPLE_PERMITTEDSUBCLASSES_ATTRIBUTES.user_response=Contact the provider of the classfile for a corrected version.\n+# END NON-TRANSLATABLE\n+\n+J9NLS_CFR_FINAL_CLASS_CANNOT_BE_SEALED=final classes cannot be sealed\n+# START NON-TRANSLATABLE\n+J9NLS_CFR_FINAL_CLASS_CANNOT_BE_SEALED.explanation=Please consult the Java Virtual Machine Specification for a detailed explaination.\n+J9NLS_CFR_FINAL_CLASS_CANNOT_BE_SEALED.system_action=The JVM will throw a verification or classloading-related exception such as java.lang.ClassFormatError.\n+J9NLS_CFR_FINAL_CLASS_CANNOT_BE_SEALED.user_response=Contact the provider of the classfile for a corrected version.\n+# END NON-TRANSLATABLE\n+\n+# PermittedSubclasses is not translatable\n+J9NLS_CFR_ERR_PERMITTEDSUBCLASSES_NAME_NOT_UTF8=PermittedSubclasses name must be a string\n+# START NON-TRANSLATABLE\n+J9NLS_CFR_ERR_PERMITTEDSUBCLASSES_NAME_NOT_UTF8.explanation=Please consult the Java Virtual Machine Specification for a detailed explaination.", "originalCommit": "93e5f539c1ce8135db3450dec3a7a324de6f4d2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc3Mzk1OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10120#discussion_r453773958", "bodyText": "spelling", "author": "gacholio", "createdAt": "2020-07-13T16:26:04Z", "path": "runtime/nls/cfre/cfrerr.nls", "diffHunk": "@@ -1529,3 +1529,34 @@ J9NLS_CFR_LVTT_DOES_NOT_MATCH_LVT.explanation=Please consult the Java Virtual Ma\n J9NLS_CFR_LVTT_DOES_NOT_MATCH_LVT.system_action=The JVM will throw a verification or classloading-related exception such as java.lang.ClassFormatError.\n J9NLS_CFR_LVTT_DOES_NOT_MATCH_LVT.user_response=Contact the provider of the classfile for a corrected version.\n # END NON-TRANSLATABLE\n+\n+# PermittedSubclasses is not translatable\n+J9NLS_CFR_ERR_MULTIPLE_PERMITTEDSUBCLASSES_ATTRIBUTES=multiple PermittedSubclasses attributes\n+# START NON-TRANSLATABLE\n+J9NLS_CFR_ERR_MULTIPLE_PERMITTEDSUBCLASSES_ATTRIBUTES.explanation=Please consult the Java Virtual Machine Specification for a detailed explaination.\n+J9NLS_CFR_ERR_MULTIPLE_PERMITTEDSUBCLASSES_ATTRIBUTES.system_action=The JVM will throw a verification or classloading-related exception such as java.lang.ClassFormatError.\n+J9NLS_CFR_ERR_MULTIPLE_PERMITTEDSUBCLASSES_ATTRIBUTES.user_response=Contact the provider of the classfile for a corrected version.\n+# END NON-TRANSLATABLE\n+\n+J9NLS_CFR_FINAL_CLASS_CANNOT_BE_SEALED=final classes cannot be sealed\n+# START NON-TRANSLATABLE\n+J9NLS_CFR_FINAL_CLASS_CANNOT_BE_SEALED.explanation=Please consult the Java Virtual Machine Specification for a detailed explaination.\n+J9NLS_CFR_FINAL_CLASS_CANNOT_BE_SEALED.system_action=The JVM will throw a verification or classloading-related exception such as java.lang.ClassFormatError.\n+J9NLS_CFR_FINAL_CLASS_CANNOT_BE_SEALED.user_response=Contact the provider of the classfile for a corrected version.\n+# END NON-TRANSLATABLE\n+\n+# PermittedSubclasses is not translatable\n+J9NLS_CFR_ERR_PERMITTEDSUBCLASSES_NAME_NOT_UTF8=PermittedSubclasses name must be a string\n+# START NON-TRANSLATABLE\n+J9NLS_CFR_ERR_PERMITTEDSUBCLASSES_NAME_NOT_UTF8.explanation=Please consult the Java Virtual Machine Specification for a detailed explaination.\n+J9NLS_CFR_ERR_PERMITTEDSUBCLASSES_NAME_NOT_UTF8.system_action=The JVM will throw a verification or classloading-related exception such as java.lang.ClassFormatError.\n+J9NLS_CFR_ERR_PERMITTEDSUBCLASSES_NAME_NOT_UTF8.user_response=Contact the provider of the classfile for a corrected version.\n+# END NON-TRANSLATABLE\n+\n+# PermittedSubclasses is not translatable\n+J9NLS_CFR_ERR_PERMITTEDSUBCLASSES_CLASS_ENTRY_NOT_CLASS_TYPE=PermittedSubclasses class entry is not a class type\n+# START NON-TRANSLATABLE\n+J9NLS_CFR_ERR_PERMITTEDSUBCLASSES_CLASS_ENTRY_NOT_CLASS_TYPE.explanation=Please consult the Java Virtual Machine Specification for a detailed explaination.", "originalCommit": "93e5f539c1ce8135db3450dec3a7a324de6f4d2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc3NTY4NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10120#discussion_r453775684", "bodyText": "Incorrect parameter list", "author": "gacholio", "createdAt": "2020-07-13T16:28:37Z", "path": "runtime/oti/util_api.h", "diffHunk": "@@ -1274,6 +1274,26 @@ void validateLibrary(J9JavaVM *javaVM, J9NativeLibrary *library);\n \n /* ---------------- optinfo.c ---------------- */\n \n+/**\n+ * Retrieves number of permitted subclasses in this sealed class. Assumes that \n+ * ROM class parameter references a record class.\n+ * \n+ * @param J9ROMClass sealed class\n+ * @return U_32 number of permitted subclasses in optionalinfo\n+ */\n+U_32*\n+getNumberOfPermittedSubclassesPtr(J9ROMClass *romClass);\n+\n+/**\n+ * Find the permitted subclass name constant pool entry at index in the optional data of the ROM class parameter.\n+ * This method assumes there is at least one permitted subclass in the ROM class.\n+ * \n+ * @param J9UTF8* sealed class", "originalCommit": "93e5f539c1ce8135db3450dec3a7a324de6f4d2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc3NjQ4MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10120#discussion_r453776481", "bodyText": "Will this not be NULL for unsealed classes? Likely better to NULL check around the SRP get and allow NULL to be returned.", "author": "gacholio", "createdAt": "2020-07-13T16:29:50Z", "path": "runtime/util/optinfo.c", "diffHunk": "@@ -673,6 +673,24 @@ getLineNumberForROMClassFromROMMethod(J9JavaVM *vm, J9ROMMethod *romMethod, J9RO\n \treturn number;\n }\n \n+U_32*\n+getNumberOfPermittedSubclassesPtr(J9ROMClass *romClass)\n+{\n+\tU_32 *ptr = getSRPPtr(J9ROMCLASS_OPTIONALINFO(romClass), romClass->optionalFlags, J9_ROMCLASS_OPTINFO_PERMITTEDSUBCLASSES_ATTRIBUTE);\n+\n+\tAssert_VMUtil_true(ptr != NULL);", "originalCommit": "93e5f539c1ce8135db3450dec3a7a324de6f4d2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg1MjMxNQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10120#discussion_r453852315", "bodyText": "The method declaration description indicates that this method is called only for a sealed class.", "author": "theresa-m", "createdAt": "2020-07-13T18:37:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc3NjQ4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc3Njc2OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10120#discussion_r453776769", "bodyText": "{ on a new line please", "author": "gacholio", "createdAt": "2020-07-13T16:30:15Z", "path": "runtime/util/optinfo.c", "diffHunk": "@@ -673,6 +673,24 @@ getLineNumberForROMClassFromROMMethod(J9JavaVM *vm, J9ROMMethod *romMethod, J9RO\n \treturn number;\n }\n \n+U_32*\n+getNumberOfPermittedSubclassesPtr(J9ROMClass *romClass)\n+{\n+\tU_32 *ptr = getSRPPtr(J9ROMCLASS_OPTIONALINFO(romClass), romClass->optionalFlags, J9_ROMCLASS_OPTINFO_PERMITTEDSUBCLASSES_ATTRIBUTE);\n+\n+\tAssert_VMUtil_true(ptr != NULL);\n+\n+\treturn SRP_PTR_GET(ptr, U_32*);\n+}\n+\n+J9UTF8*\n+permittedSubclassesNameAtIndex(U_32* permittedSubclassesCountPtr, U_32 index) {", "originalCommit": "93e5f539c1ce8135db3450dec3a7a324de6f4d2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0a333e62792b3222c0e1ec9e6c5a747f50e2e149", "url": "https://github.com/eclipse-openj9/openj9/commit/0a333e62792b3222c0e1ec9e6c5a747f50e2e149", "message": "Write PermittedSubclasses attribute to ROM class\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-13T18:38:53Z", "type": "commit"}, {"oid": "774b7c5f225c89df9b446223d941ac1a8fe526de", "url": "https://github.com/eclipse-openj9/openj9/commit/774b7c5f225c89df9b446223d941ac1a8fe526de", "message": "New JCL Class.isSealed method and tests\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-13T18:38:53Z", "type": "commit"}, {"oid": "a1f964b372a6ab8d90560feea291992342cd27e8", "url": "https://github.com/eclipse-openj9/openj9/commit/a1f964b372a6ab8d90560feea291992342cd27e8", "message": "New JCL Class.permittedSubclasses method and tests\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-13T18:38:53Z", "type": "commit"}, {"oid": "0e498c8de8cd094cdaa2c3cc6d8118233ec800d8", "url": "https://github.com/eclipse-openj9/openj9/commit/0e498c8de8cd094cdaa2c3cc6d8118233ec800d8", "message": "Update Subclasses from Subtypes\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-13T18:38:54Z", "type": "commit"}, {"oid": "080f1c3880d4549146260d941959f6870cbdb6ce", "url": "https://github.com/eclipse-openj9/openj9/commit/080f1c3880d4549146260d941959f6870cbdb6ce", "message": "First review changes\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-13T18:38:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg5NzEyNw==", "url": "https://github.com/eclipse-openj9/openj9/pull/10120#discussion_r453897127", "bodyText": "Windows does not allow declarations inside for statements in C files.", "author": "gacholio", "createdAt": "2020-07-13T19:58:57Z", "path": "runtime/jcl/common/reflecthelp.c", "diffHunk": "@@ -1957,3 +1957,66 @@ getRecordComponentsHelper(JNIEnv *env, jobject cls)\n \tvmFuncs->internalExitVMToJNI(vmThread);\n \treturn result;\n }\n+\n+/* Create an array of string names for class's PermittedSubclasses */\n+jarray\n+permittedSubclassesHelper(JNIEnv *env, jobject cls)\n+{\n+\tJ9VMThread *vmThread = (J9VMThread *)env;\n+\tJ9JavaVM *vm = vmThread->javaVM;\n+\tJ9InternalVMFunctions *vmFuncs = vm->internalVMFunctions;\n+\tJ9MemoryManagerFunctions *mmFuncs = vm->memoryManagerFunctions;\n+\tJ9Class *clazz = NULL;\n+\tJ9ROMClass *romClass = NULL;\n+\tjarray result = NULL;\n+\tJ9Class *stringClass = NULL;\n+\tJ9Class *stringArrayClass = NULL;\n+\tU_32 *permittedSubclassesCountPtr = 0;\n+\tj9array_t stringArrayObject = NULL;\n+\n+\tvmFuncs->internalEnterVMFromJNI(vmThread);\n+\n+\tclazz = J9VM_J9CLASS_FROM_JCLASS(vmThread, (jclass)cls);\n+\tromClass = clazz->romClass;\n+\n+\t/* allocate String array for results */\n+\tstringClass = J9VMJAVALANGSTRING(vm);\n+\tif (NULL != vmThread->currentException) {\n+\t\tgoto done;\n+\t}\n+\tstringArrayClass = fetchArrayClass(vmThread, stringClass);\n+\tif (NULL != vmThread->currentException) {\n+\t\tgoto done;\n+\t}\n+\n+\tpermittedSubclassesCountPtr = getNumberOfPermittedSubclassesPtr(romClass);\n+\n+\tstringArrayObject = (j9array_t) mmFuncs->J9AllocateIndexableObject(vmThread, stringArrayClass,\n+\t\t\t\t*permittedSubclassesCountPtr, J9_GC_ALLOCATE_OBJECT_NON_INSTRUMENTABLE);\n+\tif (NULL == stringArrayObject) {\n+\t\tgoto heapoutofmemory;\n+\t}\n+\n+\tresult = vmFuncs->j9jni_createLocalRef(env, (j9object_t)stringArrayObject);\n+\n+\tfor (U_32 index = 0; index < *permittedSubclassesCountPtr; index++) {", "originalCommit": "080f1c3880d4549146260d941959f6870cbdb6ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkwODQ3NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10120#discussion_r453908475", "bodyText": "Updated.", "author": "theresa-m", "createdAt": "2020-07-13T20:20:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg5NzEyNw=="}], "type": "inlineReview"}, {"oid": "11d61611ce44d8115eac32f349f361e34759170d", "url": "https://github.com/eclipse-openj9/openj9/commit/11d61611ce44d8115eac32f349f361e34759170d", "message": "First review changes\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-13T20:19:18Z", "type": "commit"}, {"oid": "11d61611ce44d8115eac32f349f361e34759170d", "url": "https://github.com/eclipse-openj9/openj9/commit/11d61611ce44d8115eac32f349f361e34759170d", "message": "First review changes\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-13T20:19:18Z", "type": "forcePushed"}]}