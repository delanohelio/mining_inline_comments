{"pr_number": 8600, "pr_title": "Add jit helper stub for acmp", "pr_createdAt": "2020-02-18T15:51:39Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/8600", "timeline": [{"oid": "844e6f71c0b88072d7509dd38d2e09f167acec4c", "url": "https://github.com/eclipse-openj9/openj9/commit/844e6f71c0b88072d7509dd38d2e09f167acec4c", "message": "Add jit helper stub for acmp\n\nDepends on https://github.com/eclipse/omr/pull/4841\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-02-18T15:55:34Z", "type": "forcePushed"}, {"oid": "b4a1a5726b15fde0dc1dff42fa2a5e3faef161df", "url": "https://github.com/eclipse-openj9/openj9/commit/b4a1a5726b15fde0dc1dff42fa2a5e3faef161df", "message": "Add jit helper stub for acmp\n\nDepends on https://github.com/eclipse/omr/pull/4841\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-02-18T15:58:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc3NTU2NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8600#discussion_r380775565", "bodyText": "I don't think this needs a return value.", "author": "gacholio", "createdAt": "2020-02-18T16:12:01Z", "path": "runtime/codert_vm/cnathelp.cpp", "diffHunk": "@@ -2250,6 +2250,18 @@ old_fast_jitTypeCheckArrayStoreWithNullCheck(J9VMThread *currentThread)\n \treturn slowPath;\n }\n \n+void* J9FASTCALL", "originalCommit": "b4a1a5726b15fde0dc1dff42fa2a5e3faef161df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc3NjE5NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8600#discussion_r380776194", "bodyText": "If this is the direct call version, you need to return the value from the function, not use the macro.", "author": "gacholio", "createdAt": "2020-02-18T16:12:58Z", "path": "runtime/codert_vm/cnathelp.cpp", "diffHunk": "@@ -3102,6 +3114,21 @@ fast_jitTypeCheckArrayStoreWithNullCheck(J9VMThread *currentThread, j9object_t d\n \treturn slowPath;\n }\n \n+void* J9FASTCALL", "originalCommit": "b4a1a5726b15fde0dc1dff42fa2a5e3faef161df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc3NjY5OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8600#discussion_r380776698", "bodyText": "Does not need a table entry.", "author": "gacholio", "createdAt": "2020-02-18T16:13:43Z", "path": "runtime/codert_vm/cnathelp.cpp", "diffHunk": "@@ -3357,6 +3384,8 @@ initPureCFunctionTable(J9JavaVM *vm)\n \tjitConfig->old_slow_jitNewInstanceImplAccessCheck = (void*)old_slow_jitNewInstanceImplAccessCheck;\n \tjitConfig->old_slow_jitTranslateNewInstanceMethod = (void*)old_slow_jitTranslateNewInstanceMethod;\n \tjitConfig->old_slow_jitReportFinalFieldModified = (void*)old_slow_jitReportFinalFieldModified;\n+\tjitConfig->fast_jitAcmpHelper = (void*)fast_jitAcmpHelper;", "originalCommit": "b4a1a5726b15fde0dc1dff42fa2a5e3faef161df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc3NzE0Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8600#discussion_r380777147", "bodyText": "Not needed.", "author": "gacholio", "createdAt": "2020-02-18T16:14:23Z", "path": "runtime/jilgen/jilconsts.c", "diffHunk": "@@ -632,6 +632,8 @@ writeConstants(OMRPortLibrary *OMRPORTLIB, IDATA fd)\n \t\t\twriteConstant(OMRPORTLIB, fd, \"J9TR_JitConfig_old_slow_jitReportStaticFieldRead\", offsetof(J9JITConfig, old_slow_jitReportStaticFieldRead)) |\n \t\t\twriteConstant(OMRPORTLIB, fd, \"J9TR_JitConfig_old_slow_jitReportStaticFieldWrite\", offsetof(J9JITConfig, old_slow_jitReportStaticFieldWrite)) |\n \n+\t\t\twriteConstant(OMRPORTLIB, fd, \"J9TR_JitConfig_fast_jitAcmpHelper\", offsetof(J9JITConfig, fast_jitAcmpHelper)) |", "originalCommit": "b4a1a5726b15fde0dc1dff42fa2a5e3faef161df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc3NzI1Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8600#discussion_r380777257", "bodyText": "Not needed.", "author": "gacholio", "createdAt": "2020-02-18T16:14:33Z", "path": "runtime/oti/j9nonbuilder.h", "diffHunk": "@@ -3504,6 +3504,8 @@ typedef struct J9JITConfig {\n \tvoid *old_slow_jitNewInstanceImplAccessCheck;\n \tvoid *old_slow_jitTranslateNewInstanceMethod;\n \tvoid *old_slow_jitReportFinalFieldModified;\n+\tvoid *fast_jitAcmpHelper;", "originalCommit": "b4a1a5726b15fde0dc1dff42fa2a5e3faef161df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc3ODQ1NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8600#discussion_r380778455", "bodyText": "Maybe write this as an else followed by the if, which wraps the class fetch/call.", "author": "gacholio", "createdAt": "2020-02-18T16:16:18Z", "path": "runtime/vm/valueTypeHelpers.cpp", "diffHunk": "@@ -54,4 +54,29 @@ defaultValueWithUnflattenedFlattenables(J9VMThread *currentThread, J9Class *claz\n                 }\n         }\n }\n+\n+BOOLEAN\n+valueTypeCapableAcmp(J9VMThread *currentThread, j9object_t lhs, j9object_t rhs)\n+{\n+#if defined(J9VM_OPT_VALHALLA_VALUE_TYPES)\n+\t\tbool acmpResult = false;\n+\t\tif (rhs == lhs) {\n+\t\t\tacmpResult = true;\n+\t\t} else if ((NULL == rhs) || (NULL == lhs)) {", "originalCommit": "b4a1a5726b15fde0dc1dff42fa2a5e3faef161df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "08da81b0067e5d73fe287e63dc9ebc7e21913580", "url": "https://github.com/eclipse-openj9/openj9/commit/08da81b0067e5d73fe287e63dc9ebc7e21913580", "message": "Add jit helper stub for acmp\n\nDepends on https://github.com/eclipse/omr/pull/4841\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-02-18T16:41:26Z", "type": "forcePushed"}, {"oid": "18d87fe60ea7b2b652505fa425c005c651c375e8", "url": "https://github.com/eclipse-openj9/openj9/commit/18d87fe60ea7b2b652505fa425c005c651c375e8", "message": "Add jit helper stub for acmp\n\nDepends on https://github.com/eclipse/omr/pull/4841\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-02-18T16:52:36Z", "type": "commit"}, {"oid": "18d87fe60ea7b2b652505fa425c005c651c375e8", "url": "https://github.com/eclipse-openj9/openj9/commit/18d87fe60ea7b2b652505fa425c005c651c375e8", "message": "Add jit helper stub for acmp\n\nDepends on https://github.com/eclipse/omr/pull/4841\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>", "committedDate": "2020-02-18T16:52:36Z", "type": "forcePushed"}]}