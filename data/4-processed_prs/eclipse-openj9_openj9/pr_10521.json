{"pr_number": 10521, "pr_title": "Add Portable AOT Support on Z", "pr_createdAt": "2020-09-04T02:56:05Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10521", "timeline": [{"oid": "a142caeec4c086ff9470f5761c38ddfa2500a5f0", "url": "https://github.com/eclipse-openj9/openj9/commit/a142caeec4c086ff9470f5761c38ddfa2500a5f0", "message": "Add Portable AOT Support on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-04T02:56:54Z", "type": "forcePushed"}, {"oid": "2322c3e73aa05c287a1100fb59c20ce7c3de8be7", "url": "https://github.com/eclipse-openj9/openj9/commit/2322c3e73aa05c287a1100fb59c20ce7c3de8be7", "message": "Add Portable AOT Support on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-04T06:21:39Z", "type": "forcePushed"}, {"oid": "9f5a1508e2e682bd2d514ea290a0fba23a6aa60b", "url": "https://github.com/eclipse-openj9/openj9/commit/9f5a1508e2e682bd2d514ea290a0fba23a6aa60b", "message": "Add Portable AOT Support on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-10T15:29:28Z", "type": "forcePushed"}, {"oid": "e25ca770bc25202dac186bab91c7b950ac673327", "url": "https://github.com/eclipse-openj9/openj9/commit/e25ca770bc25202dac186bab91c7b950ac673327", "message": "Add Portable AOT Support on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-10T15:47:00Z", "type": "forcePushed"}, {"oid": "d742d8cf67e9ff8b883ab6a10527a9eeb59e5c65", "url": "https://github.com/eclipse-openj9/openj9/commit/d742d8cf67e9ff8b883ab6a10527a9eeb59e5c65", "message": "Add Portable AOT Support on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-10T15:58:30Z", "type": "forcePushed"}, {"oid": "e084c28e3f71aeb792f9104d076d09274e32d639", "url": "https://github.com/eclipse-openj9/openj9/commit/e084c28e3f71aeb792f9104d076d09274e32d639", "message": "Add Portable AOT Support on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-10T16:08:00Z", "type": "forcePushed"}, {"oid": "9115c19df6c7d4afadcae6adafbb20d8a6155f4e", "url": "https://github.com/eclipse-openj9/openj9/commit/9115c19df6c7d4afadcae6adafbb20d8a6155f4e", "message": "Add Portable AOT Support on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-10T16:13:35Z", "type": "forcePushed"}, {"oid": "8fceaa69cd53dae997aca9a5608c6e8856f1cd92", "url": "https://github.com/eclipse-openj9/openj9/commit/8fceaa69cd53dae997aca9a5608c6e8856f1cd92", "message": "Add Portable AOT Support on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-10T16:16:38Z", "type": "forcePushed"}, {"oid": "1037e7e698cd948c2b958789c35a8a6e8b2a1bc6", "url": "https://github.com/eclipse-openj9/openj9/commit/1037e7e698cd948c2b958789c35a8a6e8b2a1bc6", "message": "Add Portable AOT Support on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-10T16:29:36Z", "type": "forcePushed"}, {"oid": "1ea8a57391e1987615da2c6029ef63f3dd179fa3", "url": "https://github.com/eclipse-openj9/openj9/commit/1ea8a57391e1987615da2c6029ef63f3dd179fa3", "message": "Add Portable AOT Support on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-11T21:12:13Z", "type": "forcePushed"}, {"oid": "8a71fe6221aa1f420f28cca7d104274e6c230e2e", "url": "https://github.com/eclipse-openj9/openj9/commit/8a71fe6221aa1f420f28cca7d104274e6c230e2e", "message": "Add Portable AOT Support on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-14T17:01:07Z", "type": "forcePushed"}, {"oid": "ab7ef1c8e9f3fadba590132d136d4871346376da", "url": "https://github.com/eclipse-openj9/openj9/commit/ab7ef1c8e9f3fadba590132d136d4871346376da", "message": "Enable -XX:[+|-]PortableSharedCache for Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-17T21:39:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk2NjI2OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10521#discussion_r490966268", "bodyText": "I would use explicit list of supported platforms rather than use \"all except Power\". What about ARM, RiscV, ZTPF etc?", "author": "dmitripivkine", "createdAt": "2020-09-18T13:54:58Z", "path": "runtime/vm/jvminit.c", "diffHunk": "@@ -1682,10 +1682,10 @@ IDATA VMInitStages(J9JavaVM *vm, IDATA stage, void* reserved) {\n \t\t\t\tIDATA argIndex9 = 0;\n \t\t\t\tBOOLEAN sharedClassDisabled = FALSE;\n \n-#if defined(J9VM_ARCH_X86)\n+#if !defined(J9VM_ARCH_POWER)", "originalCommit": "ab7ef1c8e9f3fadba590132d136d4871346376da", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk3MjMwNg==", "url": "https://github.com/eclipse-openj9/openj9/pull/10521#discussion_r490972306", "bodyText": "Does this code change the behavior when AOT is enabled? We want a change in behavior if AOT and portableAOT enabled.", "author": "mpirvu", "createdAt": "2020-09-18T14:04:13Z", "path": "runtime/gc_modron_startup/mminit.cpp", "diffHunk": "@@ -2927,7 +2927,7 @@ gcInitializeDefaults(J9JavaVM* vm)\n \n \t\t\t\tif (hwSupported) {\n \t\t\t\t\t/* Software Barrier request overwrites HW usage on supported HW */\n-\t\t\t\t\textensions->concurrentScavengerHWSupport = hwSupported && !extensions->softwareRangeCheckReadBarrier;\n+\t\t\t\t\textensions->concurrentScavengerHWSupport = hwSupported && !extensions->softwareRangeCheckReadBarrier && !J9_ARE_ANY_BITS_SET(vm->extendedRuntimeFlags2, J9_EXTENDED_RUNTIME2_ENABLE_AOT);", "originalCommit": "ab7ef1c8e9f3fadba590132d136d4871346376da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk3NjExNg==", "url": "https://github.com/eclipse-openj9/openj9/pull/10521#discussion_r490976116", "bodyText": "Right. Is it the same flag we check to force 3-bit shift?", "author": "dmitripivkine", "createdAt": "2020-09-18T14:10:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk3MjMwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTA1MTg4MQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10521#discussion_r491051881", "bodyText": "You are checking J9_EXTENDED_RUNTIME2_ENABLE_PORTABLE_SHARED_CACHE to force shift selection. Should check here be the same?", "author": "dmitripivkine", "createdAt": "2020-09-18T16:10:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk3MjMwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTA3MTc3NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10521#discussion_r491071775", "bodyText": "Yes sorry I used the wrong flag, should be J9_EXTENDED_RUNTIME2_ENABLE_PORTABLE_SHARED_CACHE", "author": "harryyu1994", "createdAt": "2020-09-18T16:48:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk3MjMwNg=="}], "type": "inlineReview"}, {"oid": "dd9d99577fb53d8dab78022cd61e1b2c57c905e9", "url": "https://github.com/eclipse-openj9/openj9/commit/dd9d99577fb53d8dab78022cd61e1b2c57c905e9", "message": "Add Portable AOT Support on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-21T15:28:03Z", "type": "commit"}, {"oid": "38daf9579f031a2cd8ebdff1a91250f5ed4452f8", "url": "https://github.com/eclipse-openj9/openj9/commit/38daf9579f031a2cd8ebdff1a91250f5ed4452f8", "message": "Enable -XX:[+|-]PortableSharedCache for Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-21T15:28:03Z", "type": "forcePushed"}, {"oid": "5af65d0a44e81f9a9bef0e37bdac3a483d316a38", "url": "https://github.com/eclipse-openj9/openj9/commit/5af65d0a44e81f9a9bef0e37bdac3a483d316a38", "message": "Enable -XX:[+|-]PortableSharedCache for Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-21T15:38:48Z", "type": "commit"}, {"oid": "5af65d0a44e81f9a9bef0e37bdac3a483d316a38", "url": "https://github.com/eclipse-openj9/openj9/commit/5af65d0a44e81f9a9bef0e37bdac3a483d316a38", "message": "Enable -XX:[+|-]PortableSharedCache for Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>", "committedDate": "2020-09-21T15:38:48Z", "type": "forcePushed"}]}