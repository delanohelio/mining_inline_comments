{"pr_number": 9130, "pr_title": "Changing compare and branch for unresolved snippets within FieldWatch", "pr_createdAt": "2020-04-06T13:29:08Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/9130", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDEwMzg3NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9130#discussion_r404103874", "bodyText": "Since we're reading the value of scratchReg as an address-sized value using Op_load, shouldn't this be an address-sized compare (i.e. Op_cmpi)?", "author": "aviansie-ben", "createdAt": "2020-04-06T13:48:01Z", "path": "runtime/compiler/p/codegen/J9TreeEvaluator.cpp", "diffHunk": "@@ -988,8 +988,8 @@ J9::Power::TreeEvaluator::generateFillInDataBlockSequenceForUnresolvedField(TR::\n    TR::Register *cndReg = cg->allocateRegister(TR_CCR);\n    generateTrg1MemInstruction(cg, TR::InstOpCode::Op_load, node, scratchReg,\n                      new (cg->trHeapMemory()) TR::MemoryReference(dataSnippetRegister, offsetInDataBlock, TR::Compiler->om.sizeofReferenceAddress(), cg));\n-   generateTrg1Src1ImmInstruction(cg, TR::InstOpCode::andi_r, node, scratchReg, scratchReg, cndReg, -1);\n-   generateConditionalBranchInstruction(cg, TR::InstOpCode::bne, node, unresolvedLabel, cndReg);\n+   generateTrg1Src1ImmInstruction(cg, TR::InstOpCode::cmpi4, node, cndReg, scratchReg, -1);", "originalCommit": "6443fbd14e98a93ac4d96fa217a959223f4eb465", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDExMzQ2MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9130#discussion_r404113460", "bodyText": "I think you're right @aviansie-ben. On Z it is an address-sized compare as well (via getCmpOpCode()):\nhttps://github.com/eclipse/openj9/blob/9ef399f4f32fdf48b8bbae6bacd1ac3949e73940/runtime/compiler/z/codegen/J9TreeEvaluator.cpp#L3748-L3757\nGood catch!", "author": "fjeremic", "createdAt": "2020-04-06T14:00:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDEwMzg3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDExNzUyNQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9130#discussion_r404117525", "bodyText": "Right. I was thinking of the offset being 32 bits longs. This will be changed to the 64 bit flavor Op_cmpi.\nSee 46e2850", "author": "AlenBadel", "createdAt": "2020-04-06T14:05:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDEwMzg3NA=="}], "type": "inlineReview"}, {"oid": "46e2850b1244f83213a495488db4a831d6758438", "url": "https://github.com/eclipse-openj9/openj9/commit/46e2850b1244f83213a495488db4a831d6758438", "message": "Change compare to Op_cmpi", "committedDate": "2020-04-06T14:11:22Z", "type": "forcePushed"}, {"oid": "263f12d091904bf098ed99a0e7f486e375478fb0", "url": "https://github.com/eclipse-openj9/openj9/commit/263f12d091904bf098ed99a0e7f486e375478fb0", "message": "Changing compare and branch for unresolved snippets within FieldWatch\n\nReplacing Andi. with Cmpi to branch into unresolved snippet routine.\n\nSigned-off-by: AlenBadel <Alen.Badel@ibm.com>", "committedDate": "2020-04-06T14:34:51Z", "type": "commit"}, {"oid": "263f12d091904bf098ed99a0e7f486e375478fb0", "url": "https://github.com/eclipse-openj9/openj9/commit/263f12d091904bf098ed99a0e7f486e375478fb0", "message": "Changing compare and branch for unresolved snippets within FieldWatch\n\nReplacing Andi. with Cmpi to branch into unresolved snippet routine.\n\nSigned-off-by: AlenBadel <Alen.Badel@ibm.com>", "committedDate": "2020-04-06T14:34:51Z", "type": "forcePushed"}]}