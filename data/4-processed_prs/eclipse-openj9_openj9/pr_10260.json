{"pr_number": 10260, "pr_title": "Clear non-zAAP eligible bit for JCL natives", "pr_createdAt": "2020-07-27T23:37:08Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10260", "timeline": [{"oid": "8a2f383712de9cb9f00e8c30378c2e14d8178f17", "url": "https://github.com/eclipse-openj9/openj9/commit/8a2f383712de9cb9f00e8c30378c2e14d8178f17", "message": "Clear non-zAAP eligible bit for JCL natives\n\nInvoke clearNonZAAPEligibleBit() for JCL natives:\nJava_sun_misc_Perf\nJava_sun_misc_Unsafe\nJava_sun_reflect_ConstantPool\n\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-07-27T22:03:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIzOTI2MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10260#discussion_r461239260", "bodyText": "Pls declare c variables at the beginning of a scope.", "author": "pshipton", "createdAt": "2020-07-28T00:04:37Z", "path": "runtime/jcl/common/sun_reflect_ConstantPool.c", "diffHunk": "@@ -907,6 +908,7 @@ registerJdkInternalReflectConstantPoolNatives(JNIEnv *env) {\n \t\t\t(void *)&Java_sun_reflect_ConstantPool_getUTF8At0,\n \t\t},\n \t};\n+\tjint numNatives = sizeof(natives)/sizeof(JNINativeMethod);", "originalCommit": "8a2f383712de9cb9f00e8c30378c2e14d8178f17", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI3MDQ3Nw==", "url": "https://github.com/eclipse-openj9/openj9/pull/10260#discussion_r461270477", "bodyText": "Should have looked at more context, this is the beginning.", "author": "pshipton", "createdAt": "2020-07-28T01:54:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIzOTI2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI4MTY5MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10260#discussion_r461281690", "bodyText": "Yes, it is.", "author": "JasonFengJ9", "createdAt": "2020-07-28T02:35:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIzOTI2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIzOTUwMg==", "url": "https://github.com/eclipse-openj9/openj9/pull/10260#discussion_r461239502", "bodyText": "Pls declare c variables at the beginning of a scope.", "author": "pshipton", "createdAt": "2020-07-28T00:05:20Z", "path": "runtime/jcl/common/sun_misc_Perf.c", "diffHunk": "@@ -125,7 +126,11 @@ registerJdkInternalPerfPerfNatives(JNIEnv *env, jclass clazz) {\n \t\t\t(void *)&Java_sun_misc_Perf_highResFrequency\n \t\t},\n \t};\n-\t(*env)->RegisterNatives(env, clazz, natives, sizeof(natives)/sizeof(JNINativeMethod));\n+\tjint numNatives = sizeof(natives)/sizeof(JNINativeMethod);", "originalCommit": "8a2f383712de9cb9f00e8c30378c2e14d8178f17", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI3MDUxOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10260#discussion_r461270519", "bodyText": "Should have looked at more context, this is the beginning.", "author": "pshipton", "createdAt": "2020-07-28T01:54:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIzOTUwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI4MjAzMA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10260#discussion_r461282030", "bodyText": "Same here.", "author": "JasonFengJ9", "createdAt": "2020-07-28T02:36:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIzOTUwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIzOTY4Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/10260#discussion_r461239686", "bodyText": "This declaration needs to be in a .h file.", "author": "pshipton", "createdAt": "2020-07-28T00:05:52Z", "path": "runtime/jcl/common/java_dyn_methodhandle.c", "diffHunk": "@@ -55,9 +56,6 @@ static void JNICALL vmInvalidate(JNIEnv *env, jclass mutableCallSiteClass, jlong\n static BOOLEAN accessCheckMethodSignature(J9VMThread *currentThread, J9Method *method, j9object_t methodType, J9UTF8 *lookupSig);\n static BOOLEAN accessCheckFieldSignature(J9VMThread *currentThread, J9Class* lookupClass, UDATA romField, j9object_t methodType, J9UTF8 *lookupSig);\n static char * expandNLSTemplate(J9VMThread *vmThread, const char *nlsTemplate, ...);\n-#if defined(J9VM_OPT_JAVA_OFFLOAD_SUPPORT)\n-static void clearNonZAAPEligibleBit(JNIEnv *env, jclass nativeClass, const JNINativeMethod *nativeMethods, jint nativeMethodCount);", "originalCommit": "8a2f383712de9cb9f00e8c30378c2e14d8178f17", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIzOTkwOA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10260#discussion_r461239908", "bodyText": "Ah, I see it now.", "author": "pshipton", "createdAt": "2020-07-28T00:06:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIzOTY4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI4MjE1NQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10260#discussion_r461282155", "bodyText": "Yes, it is.", "author": "JasonFengJ9", "createdAt": "2020-07-28T02:37:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIzOTY4Ng=="}], "type": "inlineReview"}]}