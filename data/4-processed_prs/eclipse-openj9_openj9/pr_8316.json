{"pr_number": 8316, "pr_title": "CMake: Update atomic configuration", "pr_createdAt": "2020-01-15T20:50:20Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/8316", "timeline": [{"oid": "e6cb192d063e1b0cafd19832c59fa6af8059a585", "url": "https://github.com/eclipse-openj9/openj9/commit/e6cb192d063e1b0cafd19832c59fa6af8059a585", "message": "CMake: Update atomic configuration\n\n- Add J9VM_INTERP_ATOMIC_FREE_JNI_USES_FLUSH option\n- Add J9VM_INTERP_TWO_PASS_EXCLUSIVE\n- Enable both on all cmake builds\n- Enable J9VM_INTERP_ATOMIC_FREE_JNI on all cmake builds\n\nSigned-off-by: Devin Nakamura <devinn@ca.ibm.com>", "committedDate": "2020-01-16T16:25:20Z", "type": "forcePushed"}, {"oid": "97aae240bf4782a04d87fb0a344d39ee0882f1fa", "url": "https://github.com/eclipse-openj9/openj9/commit/97aae240bf4782a04d87fb0a344d39ee0882f1fa", "message": "CMake: Update atomic configuration\n\n- Add J9VM_INTERP_ATOMIC_FREE_JNI_USES_FLUSH option\n- Add J9VM_INTERP_TWO_PASS_EXCLUSIVE\n- Enable both on all cmake builds\n- Enable J9VM_INTERP_ATOMIC_FREE_JNI on all cmake builds\n\nSigned-off-by: Devin Nakamura <devinn@ca.ibm.com>", "committedDate": "2020-01-16T18:32:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzYxNjU5Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8316#discussion_r367616593", "bodyText": "This change looks to be gratuitous.  Unintentional?", "author": "DanHeidinga", "createdAt": "2020-01-16T19:49:19Z", "path": "buildspecs/j9.flags", "diffHunk": "@@ -1003,14 +1003,14 @@ all data is stored in their own region. It additionaly reduces footprint, mainly\n \t\t<description>DEBUGGING FEATURE.  Determines if the interpreter produces debug information at every bytecode.</description>\n \t\t<ifRemoved>No full trace available.</ifRemoved>\n \t</flag>\n-\t<flag id=\"interp_updateVMCTracing\">\n-\t\t<description>Debug mode for tracing uses of updateVMStruct</description>\n-\t\t<ifRemoved>No tracing of updateVMStruct helpers</ifRemoved>\n-\t</flag>\n \t<flag id=\"interp_twoPassExclusive\">\n \t\t<description>Exclusive VM access - Set halt bit in one pass, count responders in another pass</description>\n \t\t<ifRemoved>Set and count in a single pass</ifRemoved>\n \t</flag>\n+\t<flag id=\"interp_updateVMCTracing\">\n+\t\t<description>Debug mode for tracing uses of updateVMStruct</description>\n+\t\t<ifRemoved>No tracing of updateVMStruct helpers</ifRemoved>\n+\t</flag>", "originalCommit": "97aae240bf4782a04d87fb0a344d39ee0882f1fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzY0NjEzMA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8316#discussion_r367646130", "bodyText": "Its to make the flags be in alphabetical order. Makes my life easier so that order between the uma flags and the cmake flags stays the same", "author": "dnakamura", "createdAt": "2020-01-16T20:58:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzYxNjU5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzY0ODE3OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8316#discussion_r367648179", "bodyText": "That makes sense.  I'm fine with including it then", "author": "DanHeidinga", "createdAt": "2020-01-16T21:03:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzYxNjU5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzYxOTkxMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8316#discussion_r367619911", "bodyText": "two pass exclusive isn't enabled for all specs in the UMA world.  Should this be gated with per-platform checks in the same way?  Similar concern about the other two options", "author": "DanHeidinga", "createdAt": "2020-01-16T19:57:01Z", "path": "runtime/cmake/caches/common.cmake", "diffHunk": "@@ -170,6 +172,7 @@ set(J9VM_INTERP_NEW_HEADER_SHAPE ON CACHE BOOL \"\")\n set(J9VM_INTERP_PROFILING_BYTECODES ON CACHE BOOL \"\")\n set(J9VM_INTERP_SIG_QUIT_THREAD ON CACHE BOOL \"\")\n set(J9VM_INTERP_SIG_QUIT_THREAD_USES_SEMAPHORES ON CACHE BOOL \"\")\n+set(J9VM_TWO_PASS_EXCLUSIVE ON CACHE BOOL \"\")", "originalCommit": "97aae240bf4782a04d87fb0a344d39ee0882f1fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzY0NjcyMw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8316#discussion_r367646723", "bodyText": "I believe it is currently enabled for all specs which we support under cmake. The thought being that we can then factor it out when we bring a new platform online which does not support it", "author": "dnakamura", "createdAt": "2020-01-16T20:59:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzYxOTkxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEzMTE3OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/8316#discussion_r368131179", "bodyText": "Given some of the issues so far with turning on cmake, I'm not a fan of this approach.  It means having to validate every flag on every spec over and over again.  If we handle the flags once, we'll be confident it's set correctly when support for a new spec is added", "author": "DanHeidinga", "createdAt": "2020-01-17T20:51:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzYxOTkxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3Nzk5Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/8316#discussion_r370277993", "bodyText": "Moved out into the individual configs", "author": "dnakamura", "createdAt": "2020-01-23T18:17:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzYxOTkxMQ=="}], "type": "inlineReview"}, {"oid": "d86a52d5f05841d8fb97947833d4ffc7b2eba321", "url": "https://github.com/eclipse-openj9/openj9/commit/d86a52d5f05841d8fb97947833d4ffc7b2eba321", "message": "CMake: Update atomic configuration\n\n- Add J9VM_INTERP_ATOMIC_FREE_JNI_USES_FLUSH option\n- Add J9VM_INTERP_TWO_PASS_EXCLUSIVE\n- Enable both on all cmake builds\n- Enable J9VM_INTERP_ATOMIC_FREE_JNI on all cmake builds\n\nSigned-off-by: Devin Nakamura <devinn@ca.ibm.com>", "committedDate": "2020-01-23T18:16:35Z", "type": "forcePushed"}, {"oid": "f896a1f7bfaaf58faf19ddd1d6014a4c39036c24", "url": "https://github.com/eclipse-openj9/openj9/commit/f896a1f7bfaaf58faf19ddd1d6014a4c39036c24", "message": "CMake: Update atomic configuration\n\n- Add J9VM_INTERP_ATOMIC_FREE_JNI_USES_FLUSH option\n- Add J9VM_INTERP_TWO_PASS_EXCLUSIVE\n- Enable both on all cmake builds\n- Enable J9VM_INTERP_ATOMIC_FREE_JNI on all cmake builds\n\nSigned-off-by: Devin Nakamura <devinn@ca.ibm.com>", "committedDate": "2020-01-23T18:20:15Z", "type": "forcePushed"}, {"oid": "ee4ef1363b213f018d002adbe7162fae92e8a38e", "url": "https://github.com/eclipse-openj9/openj9/commit/ee4ef1363b213f018d002adbe7162fae92e8a38e", "message": "CMake: Update atomic configuration\n\n- Add J9VM_INTERP_ATOMIC_FREE_JNI_USES_FLUSH option\n- Add J9VM_INTERP_TWO_PASS_EXCLUSIVE\n- Enable both on all cmake builds\n- Enable J9VM_INTERP_ATOMIC_FREE_JNI on all cmake builds\n\nSigned-off-by: Devin Nakamura <devinn@ca.ibm.com>", "committedDate": "2020-03-02T17:37:38Z", "type": "commit"}, {"oid": "ee4ef1363b213f018d002adbe7162fae92e8a38e", "url": "https://github.com/eclipse-openj9/openj9/commit/ee4ef1363b213f018d002adbe7162fae92e8a38e", "message": "CMake: Update atomic configuration\n\n- Add J9VM_INTERP_ATOMIC_FREE_JNI_USES_FLUSH option\n- Add J9VM_INTERP_TWO_PASS_EXCLUSIVE\n- Enable both on all cmake builds\n- Enable J9VM_INTERP_ATOMIC_FREE_JNI on all cmake builds\n\nSigned-off-by: Devin Nakamura <devinn@ca.ibm.com>", "committedDate": "2020-03-02T17:37:38Z", "type": "forcePushed"}]}